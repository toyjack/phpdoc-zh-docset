<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>获取指定的IP地址对应的主机名</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.fsockopen.html">? fsockopen</a></li>
      <li style="float: right;"><a href="function.gethostbyname.html">gethostbyname ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.network.html">网络 函数</a></li>
    <li>获取指定的IP地址对应的主机名</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.gethostbyaddr" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">gethostbyaddr</h1>
  <p class="verinfo">(PHP 4, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">gethostbyaddr</span> &mdash; <span class="dc-title">
   获取指定的IP地址对应的主机名
  </span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.gethostbyaddr-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>gethostbyaddr</strong></span>(<span class="methodparam"><span class="type">string</span> <code class="parameter">$ip_address</code></span>): <span class="type">string</span></div>

  <p class="para rdfs-comment">
   返回指定的IP地址（<code class="parameter">ip_address</code>）对应的主机名。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.gethostbyaddr-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>
    
     <dt>
<code class="parameter">ip_address</code></dt>

     <dd>

      <p class="para">
       主机的IP地址。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.gethostbyaddr-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   成功则返回主机名；失败则原样输出（输出IP地址）；如果输入的格式不正常，则返回<strong><code>false</code></strong>。
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.gethostbyaddr-examples">
  <h3 class="title">范例</h3>
  <p class="para">
   <div class="example" id="example-4339">
    <p><strong>Example #1 一个使用 <span class="function"><strong>gethostbyaddr()</strong></span> 的简单例子</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$hostname&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">gethostbyaddr</span><span style="color: #007700">(</span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #DD0000">'REMOTE_ADDR'</span><span style="color: #007700">]);<br /><br />echo&nbsp;</span><span style="color: #0000BB">$hostname</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.gethostbyaddr-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.gethostbyname.html" class="function" rel="rdfs-seeAlso">gethostbyname()</a> - 返回主机名对应的 IPv4地址。</span></li>
    <li class="member"><span class="function"><a href="function.gethostbynamel.html" class="function" rel="rdfs-seeAlso">gethostbynamel()</a> - 获取互联网主机名对应的 IPv4 地址列表</span></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="125456""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#125456" class="date">23-Oct-2020 08:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There is 1 bug in gethostbyaddr_timeout() function that king dot macro at gmail dot com posted in the most important line of all, setting the timeout with socket_set_timeout(). It should be:<br />
<br />
@socket_set_timeout($handle, intdiv($timeout_ms, 1000), $timeout_ms % 1000);<br />
<br />
I'd also make the $dns parameter last and optional and parse it from /etc/resolve.conf (or something else) if not given.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="123908""></a>
  <div class="note">
   <strong class="user">chris at ocproducts dot com</strong>
   <a href="#123908" class="date">06-Jun-2019 01:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This function does respect overrides made in the 'hosts' file, at least on Linux.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="123563""></a>
  <div class="note">
   <strong class="user">Vincent</strong>
   <a href="#123563" class="date">29-Jan-2019 07:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I discovered that gethostbyaddr sometimes returned the same host name with some uppercase letters in it and sometimes with all lowercase letters.<br />
<br />
example:<br />
<br />
d54c34fa1.access.example.com<br />
d54C34FA1.access.example.com<br />
<br />
This is probably not the fault of gethostbyaddr, but this can be a problem when comparing or storing, because it will give two entries instead of one.<br />
<br />
A simple solution to this is to use strtolower on the host name.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="121797""></a>
  <div class="note">
   <strong class="user">nisha dot com126 at gmail dot com</strong>
   <a href="#121797" class="date">26-Oct-2017 11:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
gethostbyaddr('10.176.xx.xx') returns IP address only not the host name....<br />
<br />
Could you please suggest any solution..</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="105566""></a>
  <div class="note">
   <strong class="user">Mark in Sussex</strong>
   <a href="#105566" class="date">28-Aug-2011 11:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you use gethostbyaddr() with a bad IP address then it will send an error message to the error log.
<br />
If you don't want your error log file getting too big then first check that the IP address is valid.
<br />

<br />
In the following example I first check if the IP number starts with a number,
<br />
if not then don't use gethostbyaddr('..')
<br />

<br />
<span class="default">&lt;?php
<br />
&nbsp; $IP </span><span class="keyword">= </span><span class="string">"BadValue.123.123.123"</span><span class="keyword">;
<br />
&nbsp; if(</span><span class="default">intval</span><span class="keyword">(</span><span class="default">$IP</span><span class="keyword">)&gt;</span><span class="default">0</span><span class="keyword">){
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ServerIP </span><span class="keyword">= </span><span class="default">gethostbyaddr</span><span class="keyword">(</span><span class="default">$IP</span><span class="keyword">);
<br />
&nbsp; } else {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ServerIP </span><span class="keyword">= </span><span class="default">$IP</span><span class="keyword">; </span><span class="comment">// A bad address.
<br />
&nbsp; </span><span class="keyword">}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="101820""></a>
  <div class="note">
   <strong class="user">james at trnxs dot net</strong>
   <a href="#101820" class="date">12-Jan-2011 12:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You should be careful in the use of $_SERVER['HTTP_X_FORWARDED_FOR'], as I discovered, once using Amazon AWS's Elastic Load Balancer's, this value may be a comma separated list of IP addresses and will thusly not compare as conceived in almost every example I have seen posted by users in the comments.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100105""></a>
  <div class="note">
   <strong class="user">dhjdhj at gmail dot com</strong>
   <a href="#100105" class="date">25-Sep-2010 06:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I have observed that there are problems with all approaches that use the existence of an IP address to verify that the name being looked up actually exists.<br />
<br />
If you're using opendns, then a request to a non-existent server returns an IP address anyway, the address being one for an opendns server. This is process is presumably in place so that errant URLs in browser requests take you to a "legitimate" page, i.e, the openDNS website where they can notify you of a problem.<br />
<br />
Unfortunately, that mechanism seems to occur for ANY non-existent hostname. Appending a single period to the hostname does not seem to help.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99648""></a>
  <div class="note">
   <strong class="user">Stuart Macdonald</strong>
   <a href="#99648" class="date">28-Aug-2010 05:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's a simple function that uses Dig to obtain the hostname for a given IP address. If no hostname can be found it returns the IP again.<br />
<br />
Works only on linux / unix, or whatever other platform with dig installed as a command line utility.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">tryGetHost</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$string </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">exec</span><span class="keyword">(</span><span class="string">"dig +short -x </span><span class="default">$ip</span><span class="string"> 2&gt;&amp;1"</span><span class="keyword">, </span><span class="default">$output</span><span class="keyword">, </span><span class="default">$retval</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$retval </span><span class="keyword">!= </span><span class="default">0</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; { <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// there was an error performing the command<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">} <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$x</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; while (</span><span class="default">$x </span><span class="keyword">&lt; (</span><span class="default">sizeof</span><span class="keyword">(</span><span class="default">$output</span><span class="keyword">)))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$string</span><span class="keyword">.= </span><span class="default">$output</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$x</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (empty(</span><span class="default">$string</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$string </span><span class="keyword">= </span><span class="default">$ip</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else </span><span class="comment">//remove the trailing dot<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$string </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, -</span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$string</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="94386""></a>
  <div class="note">
   <strong class="user">marco[DOT]ceppi[@T]seacrow[DOT]org</strong>
   <a href="#94386" class="date">01-Nov-2009 07:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Anonymous has a good point (though I don't agree with pushing to execution to shell unless I have to. However this is a faster example (explode then loop is a little too intensive for a simple check)<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">gethost </span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//Make sure the input is not going to do anything unexpected<br />
&nbsp;&nbsp;&nbsp; //IPs must be in the form x.x.x.x with each x as a number<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if( </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'/^(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)(?:[.]<br />
(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}$/'</span><span class="keyword">, </span><span class="default">$ip</span><span class="keyword">) )<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$host </span><span class="keyword">= `</span><span class="string">host </span><span class="default">$ip</span><span class="keyword">`;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return ((</span><span class="default">$host </span><span class="keyword">? </span><span class="default">end </span><span class="keyword">( </span><span class="default">explode </span><span class="keyword">(</span><span class="string">' '</span><span class="keyword">, </span><span class="default">$host</span><span class="keyword">)) : </span><span class="default">$ip</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; else<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Though to be honest I would use:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">gethost </span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; return ( </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'/^(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)(?:[.]<br />
(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}$/'</span><span class="keyword">, </span><span class="default">$ip</span><span class="keyword">) ) ? </span><span class="default">gethostbyaddr</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">) : </span><span class="default">false</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86496""></a>
  <div class="note">
   <strong class="user">webmaster at askapache dot com</strong>
   <a href="#86496" class="date">22-Oct-2008 01:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is a simple function I compiled from user-notes that works great.. any improvements?
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">get_ip</span><span class="keyword">( </span><span class="default">$host </span><span class="keyword">){
<br />
&nbsp; </span><span class="default">$hostip </span><span class="keyword">= @</span><span class="default">gethostbyname</span><span class="keyword">( </span><span class="default">$host </span><span class="keyword">);
<br />
&nbsp; </span><span class="default">$ip </span><span class="keyword">= ( </span><span class="default">$hostip </span><span class="keyword">== </span><span class="default">$host </span><span class="keyword">) ? </span><span class="default">$host </span><span class="keyword">: </span><span class="default">long2ip</span><span class="keyword">( </span><span class="default">ip2long</span><span class="keyword">( </span><span class="default">$hostip </span><span class="keyword">) );
<br />
&nbsp; </span><span class="comment">//echo sprintf("Resolved %s to %s", $host, $ip);
<br />
&nbsp; </span><span class="keyword">return </span><span class="default">$ip</span><span class="keyword">;
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83654""></a>
  <div class="note">
   <strong class="user">robbakAgmail_com</strong>
   <a href="#83654" class="date">05-Jun-2008 11:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
it appears that gethostbyname() fails if the domain name contains unicode. Example:<br />
<br />
&nbsp;$ host 10.10.10.128<br />
128.10.10.10.in-addr.arpa domain name pointer PC-de-S\130bastien.flexi.robbak.com.<br />
&nbsp;$ php&nbsp;&nbsp; <br />
<span class="default">&lt;?php </span><span class="keyword">echo </span><span class="default">gethostbyaddr</span><span class="keyword">( </span><span class="string">'10.10.10.128' </span><span class="keyword">); </span><span class="default">?&gt;<br />
</span>10.10.10.128<br />
<br />
gethostbyaddr is listed as unicode compatable in version 6, so a fix may be in the works.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="79887""></a>
  <div class="note">
   <strong class="user">billyblue</strong>
   <a href="#79887" class="date">17-Dec-2007 08:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I just spent a dickens of a time trying to figure out why my gethostbyaddr's were simply failing halfway through.<br />
<br />
I'm returning a log of page visits, and with each new IP, I wanted to pull the hostname of the IP. On each report page, I'm pulling 500 lines from my Db, but only maybe 25 IPs on average. Sometimes this report would generate in under 15 seconds, other times it would fail with a connection reset.<br />
<br />
It turns out that several of the IPs in my Db looked like this: x.255.x.x. gethostbyaddr really hates that and simply dies when it reaches one of these IPs.<br />
<br />
For my case, I purged the Db and prevented the logging of IPs that contain 255.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="62449""></a>
  <div class="note">
   <strong class="user">oryan at zareste dot com</strong>
   <a href="#62449" class="date">28-Feb-2006 03:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If all else fails, but you have shell access, Unix/Linux servers can use this for a timeout response:<br />
<br />
shell_exec('host -W 2 0.0.0.0');<br />
<br />
Where 0.0.0.0 is of course the IP, and '2' is the number of seconds for the timeout.&nbsp; This returns a more detailed string of info, with some additional text which might vary depending on the system, so if you want a string with the hostname and nothing else, you'll have to do some substring cutting.&nbsp; There should be an equivalent of 'host' for Windows users to execute, but it isn't my platform.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="57553""></a>
  <div class="note">
   <strong class="user">tom</strong>
   <a href="#57553" class="date">07-Oct-2005 01:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Be careful with the usage of this function - it will slow down a server to a crawl if called a lot and the slowness won't be reflected in any of the obvious places, like CPU usage, apache requests, SQL etc. When you do use it make a special note of where!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="51820""></a>
  <div class="note">
   <strong class="user">reinhard at ess dot co dot at</strong>
   <a href="#51820" class="date">12-Apr-2005 02:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
tried out some of the examples below, but no one worked for me.<br />
(<br />
"host" returns something if domain-name wasn't found<br />
"gethostbyaddr" has a too long&nbsp; timeout when it fails<br />
"the udp-example" returns some strange characters...<br />
)<br />
so i have changed the "host"-example a little bit. hope someone can need it. (maybe with little changes like without error-description)<br />
<br />
&lt;?<br />
function gethost($ip)<br />
{<br />
&nbsp;&nbsp; $host = `host $ip`;<br />
&nbsp;&nbsp; $host=end(explode(' ',$host));<br />
&nbsp;&nbsp; $host=substr($host,0,strlen($host)-2);<br />
&nbsp;&nbsp; $chk=split("\(",$host);<br />
&nbsp;&nbsp; if($chk[1]) return $ip." (".$chk[1].")";<br />
&nbsp;&nbsp; else return $host;<br />
}<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="46869""></a>
  <div class="note">
   <strong class="user">king dot macro at gmail dot com</strong>
   <a href="#46869" class="date">26-Oct-2004 07:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The problem of broken DNS servers was causing me a problem because i had a page for user statistics that required around 20 reverse dns lookups to be done, and even as many as 5/6 of them being broken was causing a huge delay in loading the page. so i wrote a function that uses a UDP socket to talk directly to the DNS server (instead of going via the normal gethostbyaddr function) this let me set a timeout.<br />
<br />
The only requirement is that your DNS server must be able to do recursive lookups, it wont go to other DNS servers if its told to... and of course you need to know your DNS servers IP address :-)<br />
<br />
&lt;?<br />
function gethostbyaddr_timeout($ip, $dns, $timeout=1000)<br />
{<br />
&nbsp;&nbsp;&nbsp; // random transaction number (for routers etc to get the reply back)<br />
&nbsp;&nbsp;&nbsp; $data = rand(0, 99);<br />
&nbsp;&nbsp;&nbsp; // trim it to 2 bytes<br />
&nbsp;&nbsp;&nbsp; $data = substr($data, 0, 2);<br />
&nbsp;&nbsp;&nbsp; // request header<br />
&nbsp;&nbsp;&nbsp; $data .= "\1\0\0\1\0\0\0\0\0\0";<br />
&nbsp;&nbsp;&nbsp; // split IP up<br />
&nbsp;&nbsp;&nbsp; $bits = explode(".", $ip);<br />
&nbsp;&nbsp;&nbsp; // error checking<br />
&nbsp;&nbsp;&nbsp; if (count($bits) != 4) return "ERROR";<br />
&nbsp;&nbsp;&nbsp; // there is probably a better way to do this bit...<br />
&nbsp;&nbsp;&nbsp; // loop through each segment<br />
&nbsp;&nbsp;&nbsp; for ($x=3; $x&gt;=0; $x--)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // needs a byte to indicate the length of each segment of the request<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; switch (strlen($bits[$x]))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case 1: // 1 byte long segment<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $data .= "\1"; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case 2: // 2 byte long segment<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $data .= "\2"; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case 3: // 3 byte long segment<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $data .= "\3"; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; default: // segment is too big, invalid IP<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return "INVALID";<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // and the segment itself<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $data .= $bits[$x];<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; // and the final bit of the request<br />
&nbsp;&nbsp;&nbsp; $data .= "\7in-addr\4arpa\0\0\x0C\0\1";<br />
&nbsp;&nbsp;&nbsp; // create UDP socket<br />
&nbsp;&nbsp;&nbsp; $handle = @fsockopen("udp://$dns", 53);<br />
&nbsp;&nbsp;&nbsp; // send our request (and store request size so we can cheat later)<br />
&nbsp;&nbsp;&nbsp; $requestsize=@fwrite($handle, $data);<br />
<br />
&nbsp;&nbsp;&nbsp; @socket_set_timeout($handle, $timeout - $timeout%1000, $timeout%1000);<br />
&nbsp;&nbsp;&nbsp; // hope we get a reply<br />
&nbsp;&nbsp;&nbsp; $response = @fread($handle, 1000);<br />
&nbsp;&nbsp;&nbsp; @fclose($handle);<br />
&nbsp;&nbsp;&nbsp; if ($response == "")<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return $ip;<br />
&nbsp;&nbsp;&nbsp; // find the response type<br />
&nbsp;&nbsp;&nbsp; $type = @unpack("s", substr($response, $requestsize+2));<br />
&nbsp;&nbsp;&nbsp; if ($type[1] == 0x0C00)&nbsp; // answer<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // set up our variables<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $host="";<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $len = 0;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // set our pointer at the beginning of the hostname<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // uses the request size from earlier rather than work it out<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $position=$requestsize+12;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // reconstruct hostname<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; do<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // get segment size<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $len = unpack("c", substr($response, $position));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // null terminated string, so length 0 = finished<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($len[1] == 0)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // return the hostname, without the trailing .<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return substr($host, 0, strlen($host) -1);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // add segment to our host<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $host .= substr($response, $position+1, $len[1]) . ".";<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // move pointer on to the next segment<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $position += $len[1] + 1;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while ($len != 0);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // error - return the hostname we constructed (without the . on the end)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return $ip;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return $ip;<br />
}<br />
?&gt;<br />
<br />
This could be expanded quite a bit and improved but it works and i've seen quite a few people trying various methods to achieve something like this so i decided to post it here. on most servers it should also be more efficient than other methods such as calling nslookup because it doesn't need to run external programs<br />
<br />
Note: I'm more a C person than a PHP person, so just ignore it if anything hasn't been done the *recomended* way :-)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="40788""></a>
  <div class="note">
   <strong class="user">Matt AKA Junkie</strong>
   <a href="#40788" class="date">14-Mar-2004 08:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Going through numerous tests, the following results are concluded:<br />
<br />
&lt;?<br />
// If you're using a server on Windows, this is faster<br />
function getisp($ip='') {<br />
&nbsp;&nbsp; if ($ip=='') $ip = $_SERVER['REMOTE_ADDR'];<br />
&nbsp;&nbsp; $longisp = @gethostbyaddr($ip);<br />
&nbsp;&nbsp; $isp = explode('.', $longisp);<br />
&nbsp;&nbsp; $isp = array_reverse($isp);<br />
&nbsp;&nbsp; $tmp = $isp[1];<br />
&nbsp;&nbsp; if (preg_match("/\&lt;(org?|com?|net)\&gt;/i", $tmp)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; $myisp = $isp[2].'.'.$isp[1].'.'.$isp[0];<br />
&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; $myisp = $isp[1].'.'.$isp[0];<br />
&nbsp;&nbsp; }<br />
&nbsp;&nbsp; if (preg_match("/[0-9]{1,3}\.[0-9]{1,3}/", $myisp))<br />
&nbsp;&nbsp; &nbsp;&nbsp; return 'ISP lookup failed.';<br />
&nbsp;&nbsp; return $myisp;<br />
}<br />
<br />
// If your server is on a *nix system, this is faster<br />
function gethost ($ip) {<br />
&nbsp;$host = `host $ip`;<br />
&nbsp;return (($host ? end ( explode (' ', $host)) : $ip));<br />
}<br />
<br />
// be warned, however, that gethost() will issue a warning<br />
// if safe mode is on with the use of backticked variables<br />
<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="40770""></a>
  <div class="note">
   <strong class="user">webmaster at script-tease dot net</strong>
   <a href="#40770" class="date">14-Mar-2004 04:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
gethostbyaddr() tends to lag on various systems for whatever reason. Here are two functions that should prove their worth speedwise.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// For Linux...<br />
<br />
</span><span class="keyword">function </span><span class="default">gethost </span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">) {<br />
&nbsp;</span><span class="default">$host </span><span class="keyword">= `</span><span class="string">host </span><span class="default">$ip</span><span class="keyword">`;<br />
&nbsp;return ((</span><span class="default">$host </span><span class="keyword">? </span><span class="default">end </span><span class="keyword">( </span><span class="default">explode </span><span class="keyword">(</span><span class="string">' '</span><span class="keyword">, </span><span class="default">$host</span><span class="keyword">)) : </span><span class="default">$ip</span><span class="keyword">));<br />
}<br />
<br />
</span><span class="comment">// For Win32...<br />
<br />
</span><span class="keyword">function </span><span class="default">nslookup </span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">) {<br />
&nbsp;</span><span class="default">$host </span><span class="keyword">= </span><span class="default">split</span><span class="keyword">(</span><span class="string">'Name:'</span><span class="keyword">,`</span><span class="string">nslookup </span><span class="default">$ip</span><span class="keyword">`);<br />
&nbsp;return ( </span><span class="default">trim </span><span class="keyword">(isset(</span><span class="default">$host</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]) ? </span><span class="default">str_replace </span><span class="keyword">(</span><span class="string">"\n"</span><span class="keyword">.</span><span class="string">'Address:&nbsp; '</span><span class="keyword">.</span><span class="default">$ip</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$host</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]) : </span><span class="default">$ip</span><span class="keyword">));<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Pretty basic, but it should get the job done.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="40343""></a>
  <div class="note">
   <strong class="user">Matt AKA Junkie</strong>
   <a href="#40343" class="date">29-Feb-2004 04:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Since my little ISP thing isn't globally acceptable, here's an update.<br />
<br />
&lt;?<br />
function getisp($ip='') {<br />
&nbsp;&nbsp;&nbsp; if ($ip=='') $ip = $_SERVER['REMOTE_ADDR'];<br />
&nbsp;&nbsp;&nbsp; $longisp = @gethostbyaddr($ip);<br />
&nbsp;&nbsp;&nbsp; $isp = explode('.', $longisp);<br />
&nbsp;&nbsp;&nbsp; $isp = array_reverse($isp);<br />
&nbsp;&nbsp;&nbsp; $tmp = $isp[1];<br />
&nbsp;&nbsp;&nbsp; if (preg_match("/\&lt;(org?|com?|net)\&gt;/i", $tmp)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $myisp = $isp[2].'.'.$isp[1].'.'.$isp[0];<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $myisp = $isp[1].'.'.$isp[0];<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; preg_match("/[0-9]{1,3}\.[0-9]{1,3}/", $myisp) ? return 'ISP lookup failed.' : return $myisp;<br />
}<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="34598""></a>
  <div class="note">
   <strong class="user">grimNOSPAMtraffic at hotNOSPAMmail dot com</strong>
   <a href="#34598" class="date">31-Jul-2003 02:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you have found the host of the ip, the shortest way to cut it not to display the full hostname to the public would be:<br />
<br />
$host = substr($host, strpos($host, ".") + 1);<br />
<br />
P.S. strpos() can also be easily used if you want to put "*" for every simbol you ommit, like so:<br />
<br />
$os = strpos($host, ".");<br />
$host = substr($host, $os);<br />
$host = str_repeat("*", $os) . $host;<br />
<br />
--McTrafik</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="31635""></a>
  <div class="note">
   <strong class="user">www.ad-rotator.com</strong>
   <a href="#31635" class="date">28-Apr-2003 04:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For ad-rotator.com, we need to do a lot of IP lookups, gethostbyaddr is very easy get timed-out and the script stucks there forever. Here is a fail-safe alternative, 1 sec max for timeout per IP.<br />
<br />
function ar_gethostbyaddr($ip) {<br />
&nbsp; $output = `host -W 1 $ip`;<br />
&nbsp; if (ereg('.*pointer ([A-Za-z0-9.-]+)\..*',$output,$regs)) {<br />
&nbsp;&nbsp;&nbsp; return $regs[1]; <br />
&nbsp; }<br />
&nbsp; return $ip;<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="31150""></a>
  <div class="note">
   <strong class="user">jz at NOSPAM dot nplu dot kiev dot ua</strong>
   <a href="#31150" class="date">11-Apr-2003 03:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just to fun that gethostbyadd() returns server machine name known in LAN rather then its DNS if I try to call it against my own host (from workstation), whether it would local (behind the proxy) or global (of proxy itself) IP or just loop 127.0.0.1.<br />
<br />
And thus you can get LAN names of other workstations by its intranet IPs (I mean smth like 192.168.0.???)<br />
<br />
Fun :)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="30543""></a>
  <div class="note">
   <strong class="user">kriek at jonkriek dot com</strong>
   <a href="#30543" class="date">21-Mar-2003 08:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In response to god at weaponzero dot f2s dot com: I found this much easier to write.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; $ip </span><span class="keyword">= </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'REMOTE_ADDR'</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fullhost </span><span class="keyword">= </span><span class="default">gethostbyaddr</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$host </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"/^[^.]+./"</span><span class="keyword">, </span><span class="string">"*."</span><span class="keyword">, </span><span class="default">$fullhost</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
IP address <span class="default">&lt;?=$ip?&gt;</span> | Host: <span class="default">&lt;?=$host?&gt;<br />
</span><br />
You can still protect the IP of your visitors and only show the hostname or show them both.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="26696""></a>
  <div class="note">
   <strong class="user">lukevb_at_iafrica.com</strong>
   <a href="#26696" class="date">09-Nov-2002 02:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Sometimes when using $_SERVER['HTTP_X_FORWARDED_FOR'] OR $_SERVER['REMOTE_ADDR'] more than 1 IP address is returned, for example '155.240.132.261, 196.250.25.120'. When this string is passed as an argument for gethostbyaddr() PHP gives the following error: Warning: Address is not a valid IPv4 or IPv6 address in... <br />
<br />
To work around this I use the following code to extract the first IP address from the string and discard the rest. (If you wish to use the other IPs they will be in the other elements of the $ips array).<br />
<br />
if (strstr($remoteIP, ', ')) {<br />
&nbsp;&nbsp;&nbsp; $ips = explode(', ', $remoteIP);<br />
&nbsp;&nbsp;&nbsp; $remoteIP = $ips[0];<br />
}<br />
<br />
Hope this helps someone :)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="26641""></a>
  <div class="note">
   <strong class="user">abe at abe2k dot net</strong>
   <a href="#26641" class="date">07-Nov-2002 06:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
gethostbyaddr() doesn't seem to be able to resolve ip6.int<br />
(ipv6) adresses, so I made a function that can, and works<br />
just like the normal gethostbyaddr().<br />
<br />
You need dig and ipv6calc, dig should come with most<br />
distributions, if not, install bind from <a href="http://www.isc.org." rel="nofollow" target="_blank">http://www.isc.org.</a><br />
ipv6calc can be found at <a href="http://www.bieringer.de/linux/IPv6/ipv6calc/index.html." rel="nofollow" target="_blank">http://www.bieringer.de/linux/IPv6/ipv6calc/index.html.</a><br />
<br />
&nbsp;function gethostbyaddr6($ip6) {<br />
&nbsp; $ipv6calc = "/bin/ipv6calc";<br />
&nbsp; $dig = "/usr/bin/dig";<br />
&nbsp; $file = popen($ipv6calc." --in ipv6addr --out revnibbles.int ".escapeshellarg($ip6), r);<br />
&nbsp; $ip = fread($file, 128);<br />
&nbsp; pclose($file);<br />
&nbsp; if ((substr($ip, 0, 5) == "Error") || (!$ip)) return "Address is not a valid IPv6 address";<br />
&nbsp; $file = popen($dig." ptr ".$ip, r);&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; while (!feof ($file)) {<br />
&nbsp;&nbsp;&nbsp; $buffer = fgets($file, 128);<br />
&nbsp;&nbsp;&nbsp; if (substr($buffer, 0, 1) == ";") continue;<br />
&nbsp;&nbsp;&nbsp; $buffer = explode(" ", $buffer);<br />
&nbsp;&nbsp;&nbsp; if ($buffer[3] == "PTR") {<br />
&nbsp;&nbsp; &nbsp; $host = substr(trim($buffer[4]), 0, -1);<br />
&nbsp;&nbsp; &nbsp; pclose($file);<br />
&nbsp;&nbsp; &nbsp; return $host;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp; }<br />
&nbsp; pclose($file);<br />
&nbsp; return $ip6;<br />
&nbsp;}<br />
<br />
&nbsp;echo gethostbyaddr6($_SERVER[REMOTE_ADDR]);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="25608""></a>
  <div class="note">
   <strong class="user">dominique at vdx dot nl</strong>
   <a href="#25608" class="date">30-Sep-2002 05:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To convert an IP to a numeric value, just use the ip2long (...) function.<br />
<br />
Vice versa; use: long2ip (...)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="25373""></a>
  <div class="note">
   <strong class="user">pulstar at mail dot com</strong>
   <a href="#25373" class="date">20-Sep-2002 02:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you need to store an IP addresses in a database, you can convert and store it in an INT type column (4 bytes). The functions below can convert IP addresses to its integer decimal value and vice-versa.<br />
<br />
function ip2dec($ipaddr) {<br />
&nbsp; $base=explode(".",$ipaddr);<br />
&nbsp; $decimal=(double) $base[0]*16777216;<br />
&nbsp; $decimal+=$base[1]*65536;<br />
&nbsp; $decimal+=$base[2]*256;<br />
&nbsp; $decimal+=$base[3];<br />
&nbsp; if($decimal&gt;2147483647) {<br />
&nbsp;&nbsp;&nbsp; $decimal-=4294967296;<br />
&nbsp; }<br />
&nbsp; return (int) $decimal;<br />
}<br />
<br />
function dec2ip($dec) {<br />
&nbsp; if($dec&lt;0) {<br />
&nbsp;&nbsp;&nbsp; $dec=(double) 4294967296+$dec;<br />
&nbsp; }<br />
&nbsp; if($dec&gt;16777215) {<br />
&nbsp;&nbsp;&nbsp; $ip=$dec-(intval($dec/256)*256);<br />
&nbsp;&nbsp;&nbsp; $dec=(double) intval($dec/256);<br />
&nbsp; } else $ip="0";<br />
&nbsp; if($dec&gt;65535) {<br />
&nbsp;&nbsp;&nbsp; $ip=($dec-(intval($dec/256)*256)).".".$ip;<br />
&nbsp;&nbsp;&nbsp; $dec=(double) intval($dec/256);<br />
&nbsp; } else $ip="0.".$ip;<br />
&nbsp; if($dec&gt;255) {<br />
&nbsp;&nbsp;&nbsp; $ip=($dec-(intval($dec/256)*256)).".".$ip;<br />
&nbsp;&nbsp;&nbsp; $dec=(double) intval($dec/256);<br />
&nbsp; } else $ip="0.".$ip;<br />
&nbsp; $ip=$dec.".".$ip;<br />
&nbsp; return (string) $ip;<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="25226""></a>
  <div class="note">
   <strong class="user">alexey at ozerov dot de</strong>
   <a href="#25226" class="date">15-Sep-2002 10:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This function seems to be very slow on IIS 4.0 Server (Win32). I use system call to NSLOOKUP instead to get PC-Hostname:
<br />

<br />
unset ($execoutput);
<br />
exec ("nslookup $IPAdresse 2&gt;nul",$execoutput,$nslookstatus);
<br />
if (isset ($execoutput[3]) &amp;&amp; ereg ("^Name: *([A-Za-z0-9]{2,})\.",$execoutput[3],$regs)) 
<br />
$nslookname=strtoupper($regs[1]);
<br />
else $nslookname="Unknown";
<br />

<br />
Note by members: This is not portable to Windows platforms. so you would be better to stay with our function.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="25091""></a>
  <div class="note">
   <strong class="user">stephane at metacites dot net</strong>
   <a href="#25091" class="date">10-Sep-2002 07:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
gethostbyaddr_with_cache()<br />
<br />
As someone truely said upper in the forum, some unresolved addresses may slow down your script to the point it times out.<br />
<br />
Althought I had thought gethostbyaddr() would use some kind of cache, it doesn't seem to when the IP is unresolved (at least on my win machine).<br />
<br />
So, I've coded a little gethostbyaddr_with_cache() function that will greatly speed your page if you have many gethostbyaddr() to perform on the same page.<br />
<br />
function gethostbyaddr_with_cache($a) {<br />
&nbsp; global $dns_cache;<br />
&nbsp; if ($dns_cache[$a]) {<br />
&nbsp;&nbsp;&nbsp; return $dns_cache[$a];<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp;&nbsp; $temp = gethostbyaddr($a);<br />
&nbsp;&nbsp;&nbsp; $dns_cache[$a] = $temp;<br />
&nbsp;&nbsp;&nbsp; return $temp;<br />
&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="24245""></a>
  <div class="note">
   <strong class="user">inny at core dot fetchnet dot org</strong>
   <a href="#24245" class="date">10-Aug-2002 09:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Turning on the HostnameLookup function on in the apache configuration file will severely increase the loading times of all the pages serviced by the httpd-server.<br />
It's mostly a better idea to just use gethostbyaddr($REMOTE_ADDR); instead of $REMOTE_HOST if you turned HostnameLookups On, unless you want the hostnames specified in apache's log file...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="23346""></a>
  <div class="note">
   <strong class="user">ven  at  PragaKhan dot com</strong>
   <a href="#23346" class="date">16-Jul-2002 03:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
$REMOTE_HOST or $_SERVER['REMOTE_HOST'] will give you the reversed ip IF apache is setup to do hostname lookups.<br />
<br />
HostnameLookups On</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="21870""></a>
  <div class="note">
   <strong class="user">elpmille at indiana dot edu</strong>
   <a href="#21870" class="date">30-May-2002 12:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I previously used something very similar to what god@weaponzero.f2s.com posted but found it to be quite tedious for getting the 'nicehost'. This method below is a lot cleaner, and it also works for numeric addresses.<br />
<br />
function nicehost($host) {<br />
&nbsp;&nbsp;&nbsp; if (ereg('^([0-9]{1,3}\.){3}[0-9]{1,3}$', $host)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return(ereg_replace('\.[0-9]{1,3}$', '.*', $host));<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return(ereg_replace('^.{' . strpos($host, '.') . '}', '*', $host));<br />
&nbsp;&nbsp;&nbsp; }<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="21551""></a>
  <div class="note">
   <strong class="user">nothanks at nospam dot com</strong>
   <a href="#21551" class="date">16-May-2002 03:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is also very useful if you'd like to ban these annoying people that keep spamming your forums. It requires a clever use of mySql but can be great:<br />
<br />
First, make a table for the bans, then make the query:<br />
<br />
"SELECT banReason from tBans where '". gethostbyaddr($REMOTE_ADDR) ."' LIKE banMask"<br />
<br />
If your results aren't null it means his host matched a banMask in your DB, so you can redirect him with header() to a banned.php page and prevent him from accessing any content on your page!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="13291""></a>
  <div class="note">
   <strong class="user">phalkon at nospam dot home dot com</strong>
   <a href="#13291" class="date">08-Jun-2001 03:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Be cautious when looking up many hostnames.&nbsp; If your DNS server is slow to respond, you may have to pump up your Max execution time for your scripts, otherwise, it will timeout.&nbsp; I found that even 3 unresolvable hosts can cause a 30 second delay in processing.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="10608""></a>
  <div class="note">
   <strong class="user">andy at occ dot nu</strong>
   <a href="#10608" class="date">12-Jan-2001 06:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
if the user is sitting behind a proxy server, you can do this;
<br />

<br />
&lt;?
<br />
&nbsp;&nbsp;&nbsp; if ($HTTP_SERVER_VARS["HTTP_X_FORWARDED_FOR"] != ""){
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $IP = $HTTP_SERVER_VARS["HTTP_X_FORWARDED_FOR"];
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $proxy = $HTTP_SERVER_VARS["REMOTE_ADDR"];
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $host = @gethostbyaddr($HTTP_SERVER_VARS["HTTP_X_FORWARDED_FOR"]);
<br />
&nbsp;&nbsp;&nbsp; }else{
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $IP = $HTTP_SERVER_VARS["REMOTE_ADDR"];
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $host = @gethostbyaddr($HTTP_SERVER_VARS["REMOTE_ADDR"]);
<br />
&nbsp;&nbsp;&nbsp; }
<br />
?&gt;
<br />

<br />
ps; i use $HTTP_SERVER_VARS["something"] instead of just $something;
<br />
you can get most of the $HTTP_SERVER_VARS by just using there $something equivalent, see the manual for that (preserved variables)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
