<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>Validates the document based on its DTD</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="domdocument.schemavalidatesource.html">? DOMDocument::schemaValidateSource</a></li>
      <li style="float: right;"><a href="domdocument.xinclude.html">DOMDocument::xinclude ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="class.domdocument.html">DOMDocument</a></li>
    <li>Validates the document based on its DTD</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="domdocument.validate" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">DOMDocument::validate</h1>
  <p class="verinfo">(PHP 5, PHP 7)</p><p class="refpurpose"><span class="refname">DOMDocument::validate</span> &mdash; <span class="dc-title">
   Validates the document based on its DTD
  </span></p>

 </div>
 <div class="refsect1 description" id="refsect1-domdocument.validate-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="modifier">public</span> <span class="methodname"><strong>DOMDocument::validate</strong></span>
    ( <span class="methodparam">void</span>
   ) : <span class="type">bool</span></div>

  <p class="para rdfs-comment">
   Validates the document based on its DTD. 
  </p>
  <p class="para">
   You can also use the <em>validateOnParse</em> property of 
   <a href="class.domdocument.html" class="classname">DOMDocument</a> to make a DTD validation.
  </p>
 </div>

 <div class="refsect1 returnvalues" id="refsect1-domdocument.validate-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   成功时返回 <strong><code>TRUE</code></strong>， 或者在失败时返回 <strong><code>FALSE</code></strong>。
   If the document has no DTD attached, this method will return <strong><code>FALSE</code></strong>.
  </p>
 </div>

 <div class="refsect1 examples" id="refsect1-domdocument.validate-examples">
  <h3 class="title">范例</h3>
  <p class="para">
   <div class="example" id="example-6534">
    <p><strong>Example #1 Example of DTD validation</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$dom&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">DOMDocument</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$dom</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">load</span><span style="color: #007700">(</span><span style="color: #DD0000">'book.xml'</span><span style="color: #007700">);<br />if&nbsp;(</span><span style="color: #0000BB">$dom</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">validate</span><span style="color: #007700">())&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"This&nbsp;document&nbsp;is&nbsp;valid!\n"</span><span style="color: #007700">;<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>
     You can also validate your XML file while loading it:
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$dom&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">DOMDocument</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$dom</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">validateOnParse&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$dom</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">load</span><span style="color: #007700">(</span><span style="color: #DD0000">'book.xml'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>

 <div class="refsect1 seealso" id="refsect1-domdocument.validate-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="methodname"><a href="domdocument.schemavalidate.html" class="methodname" rel="rdfs-seeAlso">DOMDocument::schemaValidate()</a> - Validates a document based on a schema</span></li>
    <li class="member"><span class="methodname"><a href="domdocument.schemavalidatesource.html" class="methodname" rel="rdfs-seeAlso">DOMDocument::schemaValidateSource()</a> - Validates a document based on a schema</span></li>
    <li class="member"><span class="methodname"><a href="domdocument.relaxngvalidate.html" class="methodname" rel="rdfs-seeAlso">DOMDocument::relaxNGValidate()</a> - Performs relaxNG validation on the document</span></li>
    <li class="member"><span class="methodname"><a href="domdocument.relaxngvalidatesource.html" class="methodname" rel="rdfs-seeAlso">DOMDocument::relaxNGValidateSource()</a> - Performs relaxNG validation on the document</span></li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="99818""></a>
  <div class="note">
   <strong class="user">cabral dot brc at gmail dot com</strong>
   <a href="#99818" class="date">08-Sep-2010 12:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I was trying to validate my SVG file just to get the IDs with getElementById(), <br />
<br />
&lt;?xml version="1.0"?&gt;<br />
&lt;!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "<a href="http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd" rel="nofollow" target="_blank">http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd</a>"&gt;<br />
&lt;svg xmlns="<a href="http://www.w3.org/2000/svg" rel="nofollow" target="_blank">http://www.w3.org/2000/svg</a>" xmlns:xlink="<a href="http://www.w3.org/1999/xlink" rel="nofollow" target="_blank">http://www.w3.org/1999/xlink</a>"&gt;<br />
&lt;text id="text_titulo" x="150" y="20" font-family="Arial" font-size="15px" style="font-weight:bold;"&gt;Title&lt;/text&gt;<br />
&lt;text id="text_subtitulo" x="200" y="35" font-family="Arial" font-size="10px"&gt;Sub Title&lt;/text&gt;<br />
&lt;g transform="translate(0,50) scale(0.1)"&gt;<br />
&nbsp; &lt;a id="a_AC" ...... &gt;<br />
&nbsp;&nbsp;&nbsp; &lt;polygon id="polygon_AC" ....... /&gt;<br />
&nbsp; &lt;/a&gt;<br />
&lt;/g&gt;<br />
&lt;/svg&gt;<br />
<br />
but when calling $dom-&gt;load(), it was getting the errors "failed to open stream" and "Validation failed: no DTD found !I/O warning : failed to load external entity"<br />
so I created my own validation wrapper (I just want to find the IDs with getElementById() )<br />
<br />
<span class="default">&lt;?php<br />
&nbsp; $docSVG </span><span class="keyword">= new </span><span class="default">DOMDocument</span><span class="keyword">();<br />
&nbsp; </span><span class="default">$docSVG</span><span class="keyword">-&gt;</span><span class="default">load</span><span class="keyword">(</span><span class="default">realpath</span><span class="keyword">(</span><span class="default">$filepath</span><span class="keyword">));<br />
&nbsp; </span><span class="default">setAllId</span><span class="keyword">(</span><span class="default">$docSVG</span><span class="keyword">);<br />
<br />
&nbsp; <br />
function </span><span class="default">setAllId</span><span class="keyword">(</span><span class="default">$DOMNode</span><span class="keyword">){<br />
&nbsp; if(</span><span class="default">$DOMNode</span><span class="keyword">-&gt;</span><span class="default">hasChildNodes</span><span class="keyword">()){<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$DOMNode</span><span class="keyword">-&gt;</span><span class="default">childNodes </span><span class="keyword">as </span><span class="default">$DOMElement</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; if(</span><span class="default">$DOMElement</span><span class="keyword">-&gt;</span><span class="default">hasAttributes</span><span class="keyword">()){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$id</span><span class="keyword">=</span><span class="default">$DOMElement</span><span class="keyword">-&gt;</span><span class="default">getAttribute</span><span class="keyword">(</span><span class="string">"id"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$id</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$DOMElement</span><span class="keyword">-&gt;</span><span class="default">setIdAttribute</span><span class="keyword">(</span><span class="string">"id"</span><span class="keyword">,</span><span class="default">$id</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">setAllId</span><span class="keyword">(</span><span class="default">$DOMElement</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85792""></a>
  <div class="note">
   <strong class="user">a dot schaffhirt at sedna-soft dot de</strong>
   <a href="#85792" class="date">17-Sep-2008 02:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When validating documents with this method there are two issues I don't like about it. First, it creates a bunch of warnings, which one would not expect, as the plot of calling this method is preventing any warnings that could occur when erroneously relying on the document's validity. Second, it only returns a boolean with no chance of getting additional details about the reasons for rendering invalid.<br />
<br />
That's the reason for me to use a little wrapper, which I post here in case anyone finds it useful.<br />
<br />
Please note that it only works with PHP5 or later.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">class </span><span class="default">MyDOMDocument </span><span class="keyword">{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; private </span><span class="default">$_delegate</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; private </span><span class="default">$_validationErrors</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; public function </span><span class="default">__construct </span><span class="keyword">(</span><span class="default">DOMDocument $pDocument</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_delegate </span><span class="keyword">= </span><span class="default">$pDocument</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_validationErrors </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; public function </span><span class="default">__call </span><span class="keyword">(</span><span class="default">$pMethodName</span><span class="keyword">, </span><span class="default">$pArgs</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$pMethodName </span><span class="keyword">== </span><span class="string">"validate"</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$eh </span><span class="keyword">= </span><span class="default">set_error_handler</span><span class="keyword">(array(</span><span class="default">$this</span><span class="keyword">, </span><span class="string">"onValidateError"</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$rv </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_delegate</span><span class="keyword">-&gt;</span><span class="default">validate</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$eh</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">set_error_handler</span><span class="keyword">(</span><span class="default">$eh</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$rv</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">call_user_func_array</span><span class="keyword">(array(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_delegate</span><span class="keyword">, </span><span class="default">$pMethodName</span><span class="keyword">), </span><span class="default">$pArgs</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; public function </span><span class="default">__get </span><span class="keyword">(</span><span class="default">$pMemberName</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$pMemberName </span><span class="keyword">== </span><span class="string">"errors"</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_validationErrors</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_delegate</span><span class="keyword">-&gt;</span><span class="default">$pMemberName</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; public function </span><span class="default">__set </span><span class="keyword">(</span><span class="default">$pMemberName</span><span class="keyword">, </span><span class="default">$pValue</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_delegate</span><span class="keyword">-&gt;</span><span class="default">$pMemberName </span><span class="keyword">= </span><span class="default">$pValue</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; public function </span><span class="default">onValidateError </span><span class="keyword">(</span><span class="default">$pNo</span><span class="keyword">, </span><span class="default">$pString</span><span class="keyword">, </span><span class="default">$pFile </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">, </span><span class="default">$pLine </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">, </span><span class="default">$pContext </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_validationErrors</span><span class="keyword">[] = </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"/^.+: */"</span><span class="keyword">, </span><span class="string">""</span><span class="keyword">, </span><span class="default">$pString</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;<br />
</span><br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// $doc is a DOMDocument object<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$myDoc </span><span class="keyword">= new </span><span class="default">MyDOMDocument</span><span class="keyword">(</span><span class="default">$doc</span><span class="keyword">); </span><span class="comment">// copy constructor<br />
<br />
&nbsp;&nbsp;&nbsp; // do anything with $myDoc that you would with $doc<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$isValid </span><span class="keyword">= </span><span class="default">$myDoc</span><span class="keyword">-&gt;</span><span class="default">validate</span><span class="keyword">(); </span><span class="comment">// won't create warnings<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (!</span><span class="default">$isValid</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$myDoc</span><span class="keyword">-&gt;</span><span class="default">errors</span><span class="keyword">); </span><span class="comment">// the array all warnings are collected in<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">}<br />
</span><span class="default">?&gt;<br />
</span><br />
Maybe you need to change the the part<br />
preg_replace("/^.+: */", "", $pString)<br />
to something different depending on your system's error reporting settings (HTML or plain text), whatsoever<br />
<br />
Best Regards,<br />
<br />
Anja</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84905""></a>
  <div class="note">
   <strong class="user">darren at viamedia dot co dot za</strong>
   <a href="#84905" class="date">05-Aug-2008 07:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are loading xml with the intention of validating it against an internal dtd and you have experienced issues with the validation it could be related to missing LIBXML constants.<br />
<br />
I found this post by "aidan at php dot net" in root level dom docs and thought it might be more useful here:<br />
As of PHP 5.1, libxml options may be set using constants rather than the use of proprietary DomDocument properties.<br />
<br />
DomDocument-&gt;resolveExternals is equivilant to setting<br />
LIBXML_DTDLOAD<br />
LIBXML_DTDATTR<br />
<br />
DomDocument-&gt;validateOnParse is equivilant to setting<br />
LIBXML_DTDLOAD<br />
LIBXML_DTDVALID<br />
<br />
PHP 5.1 users are encouraged to use the new constants.<br />
<br />
Example:<br />
<span class="default">&lt;?php<br />
$dom </span><span class="keyword">= new </span><span class="default">DOMDocument</span><span class="keyword">;<br />
</span><span class="comment">// Resolve externals<br />
</span><span class="default">$dom</span><span class="keyword">-&gt;</span><span class="default">load</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="default">LIBXML_DTDLOAD</span><span class="keyword">|</span><span class="default">LIBXML_DTDATTR</span><span class="keyword">);<br />
</span><span class="comment">// OR <br />
// Validate against DTD<br />
</span><span class="default">$dom</span><span class="keyword">-&gt;</span><span class="default">load</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="default">LIBXML_DTDLOAD</span><span class="keyword">|</span><span class="default">LIBXML_DTDVALID</span><span class="keyword">);<br />
</span><span class="default">$dom</span><span class="keyword">-&gt;</span><span class="default">validate</span><span class="keyword">();<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
