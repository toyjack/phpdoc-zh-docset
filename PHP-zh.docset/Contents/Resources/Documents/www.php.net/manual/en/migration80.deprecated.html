<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>PHP 8.0 废弃的功能</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="migration80.incompatible.html">? 不向后兼容的变更</a></li>
      <li style="float: right;"><a href="migration80.other-changes.html">其他变更 ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="migration80.html">从 PHP 7.4.x 移植到 PHP 8.0.x</a></li>
    <li>PHP 8.0 废弃的功能</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="migration80.deprecated" class="sect1">
 <h2 class="title">PHP 8.0 废弃的功能</h2>

 <div class="sect2" id="migration80.deprecated.core">
  <h3 class="title">PHP 核心中废弃的功能</h3>

  <ul class="itemizedlist">
   <li class="listitem">
    <p class="para">
     如果带有默认值的参数后面跟着一个必要的参数，那么默认值就会无效。这在
     PHP 8.0.0 中已被废弃，通常可以通过删除默认值，不影响现有功能：
    </p>
    <p class="para">
     <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">function&nbsp;</span><span style="color: #0000BB">test</span><span style="color: #007700">(</span><span style="color: #0000BB">$a&nbsp;</span><span style="color: #007700">=&nbsp;[],&nbsp;</span><span style="color: #0000BB">$b</span><span style="color: #007700">)&nbsp;{}&nbsp;</span><span style="color: #FF8000">//&nbsp;之前<br /></span><span style="color: #007700">function&nbsp;</span><span style="color: #0000BB">test</span><span style="color: #007700">(</span><span style="color: #0000BB">$a</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$b</span><span style="color: #007700">)&nbsp;{}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;之后<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
     </div>

    </p>
    <p class="para">
      这条规则的一个例外是 <code class="code">Type $param = null</code>
      形式的参数，其中 null
      的默认值使得类型隐式为空。这种用法仍然是允许的，但仍建议使用显式可空类型。
    </p>
    <p class="para">
     <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">function&nbsp;</span><span style="color: #0000BB">test</span><span style="color: #007700">(</span><span style="color: #0000BB">A&nbsp;$a&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$b</span><span style="color: #007700">)&nbsp;{}&nbsp;</span><span style="color: #FF8000">//&nbsp;旧写法，仍可用<br /></span><span style="color: #007700">function&nbsp;</span><span style="color: #0000BB">test</span><span style="color: #007700">(?</span><span style="color: #0000BB">A&nbsp;$a</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$b</span><span style="color: #007700">)&nbsp;{}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;推荐写法<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
     </div>

    </p>
   </li>
   <li class="listitem">
    <p class="para">
     参数 <code class="parameter">exclude_disabled</code> 不能设置为 <strong><code>false</code></strong>
     来调用 <span class="function"><a href="function.get-defined-functions.html" class="function">get_defined_functions()</a></span>，该参数已被废弃，不再起作用。
     <span class="function"><a href="function.get-defined-functions.html" class="function">get_defined_functions()</a></span> 绝不会再包含禁用的函数。
    </p>
   </li>
  </ul>
 </div>

 <div class="sect2" id="migration80.deprecated.enchant">
  <h3 class="title">Enchant</h3>

  <ul class="itemizedlist">
   <li class="listitem">
    <p class="para">
     <span class="function"><a href="function.enchant-broker-set-dict-path.html" class="function">enchant_broker_set_dict_path()</a></span> and
     <span class="function"><a href="function.enchant-broker-get-dict-path.html" class="function">enchant_broker_get_dict_path()</a></span>
     are deprecated, because that functionality is neither available in libenchant &lt; 1.5 nor in
     libenchant-2.
    </p>
   </li>
   <li class="listitem">
    <p class="para">
     <span class="function"><a href="function.enchant-dict-add-to-personal.html" class="function">enchant_dict_add_to_personal()</a></span> is deprecated; use
     <span class="function"><a href="function.enchant-dict-add.html" class="function">enchant_dict_add()</a></span> instead.
    </p>
   </li>
   <li class="listitem">
    <p class="para">
     <span class="function"><a href="function.enchant-dict-is-in-session.html" class="function">enchant_dict_is_in_session()</a></span> is deprecated; use
     <span class="function"><a href="function.enchant-dict-is-added.html" class="function">enchant_dict_is_added()</a></span> instead.
    </p>
   </li>
   <li class="listitem">
    <p class="para">
     <span class="function"><a href="function.enchant-broker-free.html" class="function">enchant_broker_free()</a></span> and <span class="function"><a href="function.enchant-broker-free-dict.html" class="function">enchant_broker_free_dict()</a></span> are
     deprecated; unset the object instead.
    </p>
   </li>
   <li class="listitem">
    <p class="para">
     The <strong><code>ENCHANT_MYSPELL</code></strong> and <strong><code>ENCHANT_ISPELL</code></strong> constants are
     deprecated.
    </p>
   </li>
  </ul>
 </div>

 <div class="sect2" id="migration80.deprecated.libxml">
  <h3 class="title">LibXML</h3>

  <p class="para">
   <span class="function"><a href="function.libxml-disable-entity-loader.html" class="function">libxml_disable_entity_loader()</a></span> has been deprecated. As libxml 2.9.0 is now
   required, external entity loading is guaranteed to be disabled by default, and this function is
   no longer needed to protect against XXE attacks, unless the (still vulnerable).
   <strong><code>LIBXML_NOENT</code></strong> is used.
   In that case, it is recommended to refactor the code using
   <span class="function"><a href="function.libxml-set-external-entity-loader.html" class="function">libxml_set_external_entity_loader()</a></span> to suppress loading of external entities.

  </p>
 </div>

 <div class="sect2" id="migration80.deprecated.pgsql">
  <h3 class="title">PGSQL / PDO PGSQL</h3>

  <ul class="itemizedlist">
   <li class="listitem">
    <p class="para">
     The constant <strong><code>PGSQL_LIBPQ_VERSION_STR</code></strong> now has the same value as
     <strong><code>PGSQL_LIBPQ_VERSION</code></strong>, and thus is deprecated.
    </p>
   </li>
   <li class="listitem">
    <p class="para">
     Function aliases in the pgsql extension have been deprecated.
     See the following list for which functions should be used instead:
    </p>
    <p class="para">
     <ul class="simplelist">
      <li class="member"><span class="function"><strong>pg_errormessage()</strong></span> → <span class="function"><a href="function.pg-last-error.html" class="function">pg_last_error()</a></span></li>
      <li class="member"><span class="function"><strong>pg_numrows()</strong></span> → <span class="function"><a href="function.pg-num-rows.html" class="function">pg_num_rows()</a></span></li>
      <li class="member"><span class="function"><strong>pg_numfields()</strong></span> → <span class="function"><a href="function.pg-num-fields.html" class="function">pg_num_fields()</a></span></li>
      <li class="member"><span class="function"><strong>pg_cmdtuples()</strong></span> → <span class="function"><a href="function.pg-affected-rows.html" class="function">pg_affected_rows()</a></span></li>
      <li class="member"><span class="function"><strong>pg_fieldname()</strong></span> → <span class="function"><a href="function.pg-field-name.html" class="function">pg_field_name()</a></span></li>
      <li class="member"><span class="function"><strong>pg_fieldsize()</strong></span> → <span class="function"><a href="function.pg-field-size.html" class="function">pg_field_size()</a></span></li>
      <li class="member"><span class="function"><strong>pg_fieldtype()</strong></span> → <span class="function"><a href="function.pg-field-type.html" class="function">pg_field_type()</a></span></li>
      <li class="member"><span class="function"><strong>pg_fieldnum()</strong></span> → <span class="function"><a href="function.pg-field-num.html" class="function">pg_field_num()</a></span></li>
      <li class="member"><span class="function"><strong>pg_result()</strong></span> → <span class="function"><a href="function.pg-fetch-result.html" class="function">pg_fetch_result()</a></span></li>
      <li class="member"><span class="function"><strong>pg_fieldprtlen()</strong></span> → <span class="function"><a href="function.pg-field-prtlen.html" class="function">pg_field_prtlen()</a></span></li>
      <li class="member"><span class="function"><strong>pg_fieldisnull()</strong></span> → <span class="function"><a href="function.pg-field-is-null.html" class="function">pg_field_is_null()</a></span></li>
      <li class="member"><span class="function"><strong>pg_freeresult()</strong></span> → <span class="function"><a href="function.pg-free-result.html" class="function">pg_free_result()</a></span></li>
      <li class="member"><span class="function"><strong>pg_getlastoid()</strong></span> → <span class="function"><a href="function.pg-last-oid.html" class="function">pg_last_oid()</a></span></li>
      <li class="member"><span class="function"><strong>pg_locreate()</strong></span> → <span class="function"><a href="function.pg-lo-create.html" class="function">pg_lo_create()</a></span></li>
      <li class="member"><span class="function"><strong>pg_lounlink()</strong></span> → <span class="function"><a href="function.pg-lo-unlink.html" class="function">pg_lo_unlink()</a></span></li>
      <li class="member"><span class="function"><strong>pg_loopen()</strong></span> → <span class="function"><a href="function.pg-lo-open.html" class="function">pg_lo_open()</a></span></li>
      <li class="member"><span class="function"><strong>pg_loclose()</strong></span> → <span class="function"><a href="function.pg-lo-close.html" class="function">pg_lo_close()</a></span></li>
      <li class="member"><span class="function"><strong>pg_loread()</strong></span> → <span class="function"><a href="function.pg-lo-read.html" class="function">pg_lo_read()</a></span></li>
      <li class="member"><span class="function"><strong>pg_lowrite()</strong></span> → <span class="function"><a href="function.pg-lo-write.html" class="function">pg_lo_write()</a></span></li>
      <li class="member"><span class="function"><strong>pg_loreadall()</strong></span> → <span class="function"><a href="function.pg-lo-read-all.html" class="function">pg_lo_read_all()</a></span></li>
      <li class="member"><span class="function"><strong>pg_loimport()</strong></span> → <span class="function"><a href="function.pg-lo-import.html" class="function">pg_lo_import()</a></span></li>
      <li class="member"><span class="function"><strong>pg_loexport()</strong></span> → <span class="function"><a href="function.pg-lo-export.html" class="function">pg_lo_export()</a></span></li>
      <li class="member"><span class="function"><strong>pg_setclientencoding()</strong></span> → <span class="function"><a href="function.pg-set-client-encoding.html" class="function">pg_set_client_encoding()</a></span></li>
      <li class="member"><span class="function"><strong>pg_clientencoding()</strong></span> -&gt; <span class="function"><a href="function.pg-client-encoding.html" class="function">pg_client_encoding()</a></span></li>
     </ul>
    </p>
   </li>
  </ul>
 </div>

 <div class="sect2" id="migration80.deprecated.standard">
  <h3 class="title">Standard Library</h3>

  <ul class="itemizedlist">
   <li class="listitem">
    <p class="para">
     Sort comparison functions that return <strong><code>true</code></strong> or <strong><code>false</code></strong> will now throw a deprecation warning, and
     should be replaced with an implementation that returns an integer less than, equal to, or greater
     than zero.
    </p>
    <p class="para">
     <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;Replace<br /></span><span style="color: #0000BB">usort</span><span style="color: #007700">(</span><span style="color: #0000BB">$array</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">fn</span><span style="color: #007700">(</span><span style="color: #0000BB">$a</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$b</span><span style="color: #007700">)&nbsp;=&gt;&nbsp;</span><span style="color: #0000BB">$a&nbsp;</span><span style="color: #007700">&gt;&nbsp;</span><span style="color: #0000BB">$b</span><span style="color: #007700">);<br /></span><span style="color: #FF8000">//&nbsp;With<br /></span><span style="color: #0000BB">usort</span><span style="color: #007700">(</span><span style="color: #0000BB">$array</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">fn</span><span style="color: #007700">(</span><span style="color: #0000BB">$a</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$b</span><span style="color: #007700">)&nbsp;=&gt;&nbsp;</span><span style="color: #0000BB">$a&nbsp;</span><span style="color: #007700">&lt;=&gt;&nbsp;</span><span style="color: #0000BB">$b</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
     </div>
 
    </p>
   </li>
  </ul>
 </div>

 <div class="sect2" id="migration80.deprecated.zip">
  <h3 class="title">Zip</h3>

  <ul class="itemizedlist">
   <li class="listitem">
    <p class="para">
     Using an empty file as ZipArchive is deprecated. Libzip 1.6.0 does not accept empty files as
     valid zip archives any longer. The existing workaround will be removed in the next version.
    </p>
   </li>
   <li class="listitem">
    <p class="para">
     The procedural API of Zip is deprecated. Use <span class="classname"><a href="class.ziparchive.html" class="classname">ZipArchive</a></span> instead.
     Iteration over all entries can be accomplished using <span class="methodname"><a href="ziparchive.statindex.html" class="methodname">ZipArchive::statIndex()</a></span>
     and a <a href="control-structures.for.html" class="link">for</a> loop:
    </p>
    <p class="para">
     <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;iterate&nbsp;using&nbsp;the&nbsp;procedural&nbsp;API<br /></span><span style="color: #0000BB">assert</span><span style="color: #007700">(</span><span style="color: #0000BB">is_resource</span><span style="color: #007700">(</span><span style="color: #0000BB">$zip</span><span style="color: #007700">));<br />while&nbsp;(</span><span style="color: #0000BB">$entry&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">zip_read</span><span style="color: #007700">(</span><span style="color: #0000BB">$zip</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">zip_entry_name</span><span style="color: #007700">(</span><span style="color: #0000BB">$entry</span><span style="color: #007700">);<br />}<br /><br /></span><span style="color: #FF8000">//&nbsp;iterate&nbsp;using&nbsp;the&nbsp;object-oriented&nbsp;API<br /></span><span style="color: #0000BB">assert</span><span style="color: #007700">(</span><span style="color: #0000BB">$zip&nbsp;</span><span style="color: #007700">instanceof&nbsp;</span><span style="color: #0000BB">ZipArchive</span><span style="color: #007700">);<br />for&nbsp;(</span><span style="color: #0000BB">$i&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">;&nbsp;</span><span style="color: #0000BB">$entry&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$zip</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">statIndex</span><span style="color: #007700">(</span><span style="color: #0000BB">$i</span><span style="color: #007700">);&nbsp;</span><span style="color: #0000BB">$i</span><span style="color: #007700">++)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">$entry</span><span style="color: #007700">[</span><span style="color: #DD0000">'name'</span><span style="color: #007700">];<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
     </div>

    </p>
   </li>
  </ul>
 </div>

 <div class="sect2" id="migration80.deprecated.reflection">
  <h3 class="title">Reflection</h3>

  <ul class="itemizedlist">
   <li class="listitem">
    <p class="para">
     <span class="methodname"><a href="reflectionfunction.isdisabled.html" class="methodname">ReflectionFunction::isDisabled()</a></span> is deprecated, as it is no longer
     possible to create a <span class="classname"><a href="class.reflectionfunction.html" class="classname">ReflectionFunction</a></span> for a disabled function. This
     method now always returns <strong><code>false</code></strong>.
    </p>
   </li>
   <li class="listitem">
    <p class="para">
     <span class="methodname"><a href="reflectionparameter.getclass.html" class="methodname">ReflectionParameter::getClass()</a></span>,
     <span class="methodname"><a href="reflectionparameter.isarray.html" class="methodname">ReflectionParameter::isArray()</a></span>, and
     <span class="methodname"><a href="reflectionparameter.iscallable.html" class="methodname">ReflectionParameter::isCallable()</a></span> are deprecated.
     <span class="methodname"><a href="reflectionparameter.gettype.html" class="methodname">ReflectionParameter::getType()</a></span> and the
     <span class="classname"><a href="class.reflectiontype.html" class="classname">ReflectionType</a></span> APIs should be used instead.
    </p>
   </li>
  </ul>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="126181""></a>
  <div class="note">
   <strong class="user">dominique dot vienne at ik dot me</strong>
   <a href="#126181" class="date">21-Jun-2021 01:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you try to get all methods / functions assigning an optional argument before a mandatory one, try this regex (single line)<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function\</span><span class="default">s</span><span class="keyword">+[</span><span class="default">a</span><span class="keyword">-</span><span class="default">z</span><span class="keyword">][</span><span class="default">a</span><span class="keyword">-</span><span class="default">zA</span><span class="keyword">-</span><span class="default">Z0</span><span class="keyword">-</span><span class="default">9_</span><span class="keyword">]*\((?:\$[</span><span class="default">a</span><span class="keyword">-</span><span class="default">z</span><span class="keyword">][</span><span class="default">a</span><span class="keyword">-</span><span class="default">zA</span><span class="keyword">-</span><span class="default">Z0</span><span class="keyword">-</span><span class="default">9</span><span class="keyword">]*\</span><span class="default">s</span><span class="keyword">*,\</span><span class="default">s</span><span class="keyword">*)*<br />
(?:\$[</span><span class="default">a</span><span class="keyword">-</span><span class="default">z</span><span class="keyword">][</span><span class="default">A</span><span class="keyword">-</span><span class="default">Za</span><span class="keyword">-</span><span class="default">z0</span><span class="keyword">-</span><span class="default">9_</span><span class="keyword">]*\</span><span class="default">s</span><span class="keyword">*=[^\$\)]+)+\$[</span><span class="default">a</span><span class="keyword">-</span><span class="default">z</span><span class="keyword">][</span><span class="default">a</span><span class="keyword">-</span><span class="default">zA</span><span class="keyword">-</span><span class="default">Z0</span><span class="keyword">-</span><span class="default">9_</span><span class="keyword">]*\)<br />
</span><span class="default">?&gt;<br />
</span><br />
for<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">public function </span><span class="default">test</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">, </span><span class="default">$b</span><span class="keyword">) {<br />
</span><span class="default">$a </span><span class="keyword">= [];<br />
</span><span class="default">$b </span><span class="keyword">= [</span><span class="default">$abc </span><span class="keyword">=&gt; </span><span class="default">$ss</span><span class="keyword">[],<br />
];<br />
}<br />
<br />
private function </span><span class="default">too</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">, </span><span class="default">$a </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">, </span><span class="default">$b</span><span class="keyword">) {<br />
}<br />
<br />
protected function </span><span class="default">bar</span><span class="keyword">(</span><span class="default">$a </span><span class="keyword">= []) {<br />
}<br />
<br />
public function </span><span class="default">foo</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">, </span><span class="default">$b </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">) {<br />
} <br />
<br />
public function </span><span class="default">fooBar32</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">=</span><span class="default">true</span><span class="keyword">, </span><span class="default">$b </span><span class="keyword">= [], </span><span class="default">$c</span><span class="keyword">) {<br />
}<br />
<br />
private function </span><span class="default">oo_bAr</span><span class="keyword">(</span><span class="default">$a </span><span class="keyword">= []) {<br />
}<br />
</span><span class="default">?&gt;<br />
</span>it will match too() and fooBar32() <br />
<br />
Have a nice migration! ;)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
