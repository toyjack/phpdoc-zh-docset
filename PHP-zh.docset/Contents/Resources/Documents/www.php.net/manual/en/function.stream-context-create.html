<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>创建资源流上下文</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.stream-bucket-prepend.html">? stream_bucket_prepend</a></li>
      <li style="float: right;"><a href="function.stream-context-get-default.html">stream_context_get_default ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.stream.html">Stream 函数</a></li>
    <li>创建资源流上下文</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.stream-context-create" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">stream_context_create</h1>
  <p class="verinfo">(PHP 4 &gt;= 4.3.0, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">stream_context_create</span> &mdash; <span class="dc-title">创建资源流上下文</span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.stream-context-create-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>stream_context_create</strong></span>
    ( <span class="methodparam"><span class="type">array</span> <code class="parameter">$options</code> = ?</span>
   , <span class="methodparam"><span class="type">array</span> <code class="parameter">$params</code> = ?</span>
   ) : <span class="type">resource</span></div>

  <p class="para rdfs-comment">
   创建并返回一个资源流上下文，该资源流中包含了 <code class="parameter">options</code> 中提前设定的所有参数的值。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.stream-context-create-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">options</code></dt>

     <dd>

      <p class="para">
       必须是一个二维关联数组，格式如下：<code class="literal">$arr[&#039;wrapper&#039;][&#039;option&#039;] = $value</code> 。
      </p>
      <p class="para">
       默认是一个空数组。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">params</code></dt>

     <dd>

      <p class="para">
       必须是 <code class="literal">$arr[&#039;parameter&#039;] = $value</code> 格式的关联数组。
       请参考 <a href="context.html" class="link">context parameters</a> 里的标准资源流参数列表。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.stream-context-create-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   上下文资源流，类型为 <span class="type">resource</span> 。
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.stream-context-create-changelog">
  <h3 class="title">更新日志</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead>
      <tr>
       <th>版本</th>
       <th>说明</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
       <td>5.3.0</td>
       <td>
        增加了可选参数 <code class="parameter">params</code> 。
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.stream-context-create-examples">
  <h3 class="title">范例</h3>
  <div class="example" id="example-4122">
   <p><strong>Example #1 使用 <span class="function"><strong>stream_context_create()</strong></span></strong></p>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$opts&nbsp;</span><span style="color: #007700">=&nbsp;array(<br />&nbsp;&nbsp;</span><span style="color: #DD0000">'http'</span><span style="color: #007700">=&gt;array(<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'method'</span><span style="color: #007700">=&gt;</span><span style="color: #DD0000">"GET"</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'header'</span><span style="color: #007700">=&gt;</span><span style="color: #DD0000">"Accept-language:&nbsp;en\r\n"&nbsp;</span><span style="color: #007700">.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"Cookie:&nbsp;foo=bar\r\n"<br />&nbsp;&nbsp;</span><span style="color: #007700">)<br />);<br /><br /></span><span style="color: #0000BB">$context&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">stream_context_create</span><span style="color: #007700">(</span><span style="color: #0000BB">$opts</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">/*&nbsp;Sends&nbsp;an&nbsp;http&nbsp;request&nbsp;to&nbsp;www.example.com<br />&nbsp;&nbsp;&nbsp;with&nbsp;additional&nbsp;headers&nbsp;shown&nbsp;above&nbsp;*/<br /></span><span style="color: #0000BB">$fp&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">fopen</span><span style="color: #007700">(</span><span style="color: #DD0000">'http://www.example.com'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'r'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$context</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">fpassthru</span><span style="color: #007700">(</span><span style="color: #0000BB">$fp</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">fclose</span><span style="color: #007700">(</span><span style="color: #0000BB">$fp</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

  </div>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.stream-context-create-seealso">
  <h3 class="title">参见</h3>
  <ul class="simplelist">
   <li class="member"><span class="function"><a href="function.stream-context-set-option.html" class="function" rel="rdfs-seeAlso">stream_context_set_option()</a> - 对资源流、数据包或者上下文设置参数</span></li>
   <li class="member">Listing of supported wrappers (<a href="wrappers.html" class="xref">支持的协议和封装协议</a>)</li>
   <li class="member">Context options (<a href="context.html" class="xref">上下文（Context）选项和参数</a>)</li>
  </ul>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="117361""></a>
  <div class="note">
   <strong class="user">Andi</strong>
   <a href="#117361" class="date">27-May-2015 01:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Don't try to re-use the ressource returned by stream_context_create. It seems not to work when connecting to different domains using https.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="111032""></a>
  <div class="note">
   <strong class="user">Ben J</strong>
   <a href="#111032" class="date">08-Jan-2013 03:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I spent a good five hours trying to figure this out, so hopefully it will save someone else some time.
<br />

<br />
When you are trying to download a file via ftp through an HTTP proxy note that the following will not be enough:
<br />
<span class="default">&lt;?php
<br />
$opts </span><span class="keyword">= array(</span><span class="string">'ftp' </span><span class="keyword">=&gt; array(
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'proxy' </span><span class="keyword">=&gt; </span><span class="string">'tcp://vbinprst10:8080'</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'request_fulluri'</span><span class="keyword">=&gt;</span><span class="default">true</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'header' </span><span class="keyword">=&gt; array(
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"Proxy-Authorization: Basic </span><span class="default">$auth</span><span class="string">"
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; )
<br />
);
<br />
</span><span class="default">$context </span><span class="keyword">= </span><span class="default">stream_context_create</span><span class="keyword">(</span><span class="default">$opts</span><span class="keyword">);
<br />
</span><span class="default">$s </span><span class="keyword">= </span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="string">"<a href="ftp://anonymous:anonymous@ftp.example.org" rel="nofollow" target="_blank">ftp://anonymous:anonymous@ftp.example.org</a>"</span><span class="keyword">,</span><span class="default">false</span><span class="keyword">,</span><span class="default">$context</span><span class="keyword">);
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Your proxy will respond that authentication is required. You may scratch your head and think "but I'm providing authentication!"
<br />

<br />
The issue is that the 'header' value is only applicable to http connections. So to authenticate on a proxy, you first have to pull a file from HTTP, before the context is valid for using on FTP.
<br />
<span class="default">&lt;?php
<br />
$opts </span><span class="keyword">= array(</span><span class="string">'ftp' </span><span class="keyword">=&gt; array(
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'proxy' </span><span class="keyword">=&gt; </span><span class="string">'tcp://vbinprst10:8080'</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'request_fulluri'</span><span class="keyword">=&gt;</span><span class="default">true</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'header' </span><span class="keyword">=&gt; array(
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"Proxy-Authorization: Basic </span><span class="default">$auth</span><span class="string">"
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; ),
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'http' </span><span class="keyword">=&gt; array(
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'proxy' </span><span class="keyword">=&gt; </span><span class="string">'tcp://vbinprst10:8080'</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'request_fulluri'</span><span class="keyword">=&gt;</span><span class="default">true</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'header' </span><span class="keyword">=&gt; array(
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"Proxy-Authorization: Basic </span><span class="default">$auth</span><span class="string">"
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; )
<br />
);
<br />
</span><span class="default">$context </span><span class="keyword">= </span><span class="default">stream_context_create</span><span class="keyword">(</span><span class="default">$opts</span><span class="keyword">);
<br />
</span><span class="default">$s </span><span class="keyword">= </span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="string">"<a href="http://www.example.com" rel="nofollow" target="_blank">http://www.example.com</a>"</span><span class="keyword">,</span><span class="default">false</span><span class="keyword">,</span><span class="default">$context</span><span class="keyword">);
<br />
</span><span class="default">$s </span><span class="keyword">= </span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="string">"<a href="ftp://anonymous:anonymous@ftp.example.org" rel="nofollow" target="_blank">ftp://anonymous:anonymous@ftp.example.org</a>"</span><span class="keyword">,</span><span class="default">false</span><span class="keyword">,</span><span class="default">$context</span><span class="keyword">);
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
It's a bit roundabout, but it works. Note that the 'header' val in the ftp array is redundant, but I kept it in anyway.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="110158""></a>
  <div class="note">
   <strong class="user">louis dot huppenbauer at gmail dot com</strong>
   <a href="#110158" class="date">25-Sep-2012 06:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When using the https protocol you'll have to make sure to set the right context options to use the full "power" of the ssl/tls encryption.<br />
<br />
<span class="default">&lt;?php<br />
$url </span><span class="keyword">= </span><span class="string">'https://secure.example.com/test/1'</span><span class="keyword">;<br />
</span><span class="default">$contextOptions </span><span class="keyword">= array(<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'ssl' </span><span class="keyword">=&gt; array(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'verify_peer'&nbsp;&nbsp; </span><span class="keyword">=&gt; </span><span class="default">true</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'cafile'&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">=&gt; </span><span class="default">__DIR__ </span><span class="keyword">. </span><span class="string">'/cacert.pem'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'verify_depth'&nbsp; </span><span class="keyword">=&gt; </span><span class="default">5</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'CN_match'&nbsp; &nbsp; &nbsp; </span><span class="keyword">=&gt; </span><span class="string">'secure.example.com'<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">)<br />
);<br />
</span><span class="default">$sslContext </span><span class="keyword">= </span><span class="default">stream_context_create</span><span class="keyword">(</span><span class="default">$contextOptions</span><span class="keyword">);<br />
</span><span class="default">$result </span><span class="keyword">= </span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">, </span><span class="default">NULL</span><span class="keyword">, </span><span class="default">$sslContext</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
More information about those context options can be found at <a href="http://php.net/manual/en/context.ssl.php" rel="nofollow" target="_blank">http://php.net/manual/en/context.ssl.php</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100559""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#100559" class="date">22-Oct-2010 10:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are trying to set a custom http header on php 5.2.x, try this:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="comment">// build header and set it the usual way
<br />
</span><span class="default">$authenticationHeader </span><span class="keyword">= </span><span class="default">$headername </span><span class="keyword">. </span><span class="string">': ' </span><span class="keyword">. </span><span class="default">$headervalue</span><span class="keyword">;
<br />
</span><span class="default">$opts </span><span class="keyword">= array(
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'http' </span><span class="keyword">=&gt; array(
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'header'&nbsp; </span><span class="keyword">=&gt; </span><span class="default">$authenticationHeader
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">)
<br />
);
<br />
</span><span class="comment">// workaround for php bug where http headers don't get sent in php 5.2
<br />
</span><span class="keyword">if(</span><span class="default">version_compare</span><span class="keyword">(</span><span class="default">PHP_VERSION</span><span class="keyword">, </span><span class="string">'5.3.0'</span><span class="keyword">) == -</span><span class="default">1</span><span class="keyword">){
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">ini_set</span><span class="keyword">(</span><span class="string">'user_agent'</span><span class="keyword">, </span><span class="string">'PHP-SOAP/' </span><span class="keyword">. </span><span class="default">PHP_VERSION </span><span class="keyword">. </span><span class="string">"\r\n" </span><span class="keyword">. </span><span class="default">$authenticationHeader</span><span class="keyword">);
<br />
}
<br />

<br />
</span><span class="default">$context&nbsp; </span><span class="keyword">= </span><span class="default">stream_context_create</span><span class="keyword">(</span><span class="default">$opts</span><span class="keyword">);
<br />

<br />
</span><span class="comment">// now use context for soap call or whatever...
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
this is the only option that worked for me.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99353""></a>
  <div class="note">
   <strong class="user">contact (at) thepointsolution.com</strong>
   <a href="#99353" class="date">12-Aug-2010 05:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I big NOTE that i hope will help some one. Something that is not mentioned in the documentation, is that when php is compiled --with-curlwrappers,
<br />

<br />
So, instead of:
<br />

<br />
<span class="default">&lt;?php
<br />
$opts </span><span class="keyword">= array(
<br />
&nbsp; </span><span class="string">'http'</span><span class="keyword">=&gt;array(
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'method'</span><span class="keyword">=&gt;</span><span class="string">"GET"</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'header'</span><span class="keyword">=&gt;</span><span class="string">"Accept-language: en\r\n" </span><span class="keyword">.
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"Cookie: foo=bar\r\n"
<br />
&nbsp; </span><span class="keyword">)
<br />
);
<br />

<br />
</span><span class="default">$context </span><span class="keyword">= </span><span class="default">stream_context_create</span><span class="keyword">(</span><span class="default">$opts</span><span class="keyword">);
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
You would setup the header this way: 
<br />

<br />
<span class="default">&lt;?php
<br />
$opts </span><span class="keyword">= array(
<br />
&nbsp; </span><span class="string">'http'</span><span class="keyword">=&gt;array(
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'method'</span><span class="keyword">=&gt;</span><span class="string">"GET"</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'header'</span><span class="keyword">=&gt;array(</span><span class="string">"Accept-language: en"</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"Cookie: foo=bar"</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"Custom-Header: value"</span><span class="keyword">)
<br />
&nbsp; )
<br />
);
<br />

<br />
</span><span class="default">$context </span><span class="keyword">= </span><span class="default">stream_context_create</span><span class="keyword">(</span><span class="default">$opts</span><span class="keyword">);
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
This will work.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92586""></a>
  <div class="note">
   <strong class="user">mathieu dot laurent at gmail dot com</strong>
   <a href="#92586" class="date">30-Jul-2009 06:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Connection via Proxy<br />
<br />
<span class="default">&lt;?php<br />
<br />
$opts </span><span class="keyword">= array(</span><span class="string">'http' </span><span class="keyword">=&gt; array(</span><span class="string">'proxy' </span><span class="keyword">=&gt; </span><span class="string">'tcp://127.0.0.1:8080'</span><span class="keyword">, </span><span class="string">'request_fulluri' </span><span class="keyword">=&gt; </span><span class="default">true</span><span class="keyword">));<br />
</span><span class="default">$context </span><span class="keyword">= </span><span class="default">stream_context_create</span><span class="keyword">(</span><span class="default">$opts</span><span class="keyword">);<br />
<br />
</span><span class="default">$data </span><span class="keyword">= </span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="string">'<a href="http://www.php.net" rel="nofollow" target="_blank">http://www.php.net</a>'</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">, </span><span class="default">$context</span><span class="keyword">);<br />
<br />
echo </span><span class="default">$data</span><span class="keyword">;<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="90927""></a>
  <div class="note">
   <strong class="user">Brian Gottier</strong>
   <a href="#90927" class="date">16-May-2009 12:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In some cases, set a header option as an array, and not a string, depending on server configuration.
<br />

<br />
<span class="default">&lt;?php
<br />
$opts </span><span class="keyword">= array(
<br />
&nbsp; </span><span class="string">'http'</span><span class="keyword">=&gt; array(
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'method'</span><span class="keyword">=&gt;&nbsp;&nbsp; </span><span class="string">"GET"</span><span class="keyword">,
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'header'</span><span class="keyword">=&gt;&nbsp; &nbsp; array( </span><span class="string">"Cookie: foo="</span><span class="default">bar</span><span class="string">"l ),
<br />
&nbsp;&nbsp;&nbsp; 'user_agent'=&gt;&nbsp; &nbsp; </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'HTTP_USER_AGENT']
<br />
&nbsp; )
<br />
);
<br />
?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="89080""></a>
  <div class="note">
   <strong class="user">rlintern at gmail dot com</strong>
   <a href="#89080" class="date">20-Feb-2009 09:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I found the following code worked for me for POSTing some binary data to a remote server. I am putting it here since I could not find a quick solution to this by 'googling' or looking through this documentation. <br />
<br />
Disclaimer:&nbsp; I have no idea if this a 'good' solution, since I'm new to PHP, but it may just suit your needs as it did mine.&nbsp; I am assuming bad things will happen with very large files since the entire file is read into $fileContents. <br />
<br />
I am using PHP 5.2.8.<br />
<br />
&nbsp;&nbsp; $fileHandle = fopen("someImage.jpg", "rb");<br />
&nbsp;&nbsp; $fileContents = stream_get_contents($fileHandle);<br />
&nbsp;&nbsp; fclose($fileHandle);<br />
<br />
&nbsp;&nbsp; $params = array(<br />
&nbsp;&nbsp; &nbsp;&nbsp; 'http' =&gt; array<br />
&nbsp;&nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 'method' =&gt; 'POST',<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 'header'=&gt;"Content-Type: multipart/form-data\r\n",<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 'content' =&gt; $fileContents<br />
&nbsp;&nbsp; &nbsp;&nbsp; )<br />
&nbsp;&nbsp; );<br />
&nbsp;&nbsp; $url = "<a href="http://somesite.somecompany.com?someParam=someValue" rel="nofollow" target="_blank">http://somesite.somecompany.com?someParam=someValue</a>";<br />
&nbsp;&nbsp; $ctx = stream_context_create($params);<br />
&nbsp;&nbsp; $fp = fopen($url, 'rb', false, $ctx);<br />
<br />
&nbsp;&nbsp; $response = stream_get_contents($fp);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75211""></a>
  <div class="note">
   <strong class="user">davep at atomicdroplet dot com</strong>
   <a href="#75211" class="date">17-May-2007 04:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In addition to the context options mentioned above (appendix N), lower down context options for sockets can be found in appendix P - <a href="http://www.php.net/manual/en/transports.php" rel="nofollow" target="_blank">http://www.php.net/manual/en/transports.php</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74795""></a>
  <div class="note">
   <strong class="user">jrubenstein at gmail dot com</strong>
   <a href="#74795" class="date">27-Apr-2007 09:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Something to keep in mind when creating SSL streams (using https://):<br />
<br />
<span class="default">&lt;?php<br />
$context </span><span class="keyword">= </span><span class="default">context_create_stream</span><span class="keyword">(</span><span class="default">$context_options</span><span class="keyword">)<br />
</span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="string">'https://url'</span><span class="keyword">, </span><span class="string">'r'</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">, </span><span class="default">$context</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
One would think - the proper way to create a stream options array, would be as follows: <br />
<br />
<span class="default">&lt;?php<br />
$context_options </span><span class="keyword">= array (<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'https' </span><span class="keyword">=&gt; array (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'method' </span><span class="keyword">=&gt; </span><span class="string">'POST'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'header'</span><span class="keyword">=&gt; </span><span class="string">"Content-type: application/x-www-form-urlencoded\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"Content-Length: " </span><span class="keyword">. </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">) . </span><span class="string">"\r\n"</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'content' </span><span class="keyword">=&gt; </span><span class="default">$data<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; );<br />
</span><span class="default">?&gt;<br />
</span><br />
THAT IS THE WRONG WAY!!!<br />
Take notice to the 3rd line: 'https' =&gt; array (<br />
<br />
The CORRECT way, is as follows:<br />
<br />
<span class="default">&lt;?php<br />
$context_options </span><span class="keyword">= array (<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'http' </span><span class="keyword">=&gt; array (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'method' </span><span class="keyword">=&gt; </span><span class="string">'POST'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'header'</span><span class="keyword">=&gt; </span><span class="string">"Content-type: application/x-www-form-urlencoded\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"Content-Length: " </span><span class="keyword">. </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">) . </span><span class="string">"\r\n"</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'content' </span><span class="keyword">=&gt; </span><span class="default">$data<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; );<br />
</span><span class="default">?&gt;<br />
</span><br />
Notice, the NEW 3rd line: 'http' =&gt; array (<br />
<br />
Now - keep this in mind - I spent several hours trying to trouble shoot my issue, when I finally stumbled upon this non-documented issue.<br />
<br />
The complete code to post to a secure page is as follows:<br />
<br />
<span class="default">&lt;?php<br />
$data </span><span class="keyword">= array (</span><span class="string">'foo' </span><span class="keyword">=&gt; </span><span class="string">'bar'</span><span class="keyword">, </span><span class="string">'bar' </span><span class="keyword">=&gt; </span><span class="string">'baz'</span><span class="keyword">);<br />
</span><span class="default">$data </span><span class="keyword">= </span><span class="default">http_build_query</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">);<br />
<br />
</span><span class="default">$context_options </span><span class="keyword">= array (<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'http' </span><span class="keyword">=&gt; array (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'method' </span><span class="keyword">=&gt; </span><span class="string">'POST'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'header'</span><span class="keyword">=&gt; </span><span class="string">"Content-type: application/x-www-form-urlencoded\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"Content-Length: " </span><span class="keyword">. </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">) . </span><span class="string">"\r\n"</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'content' </span><span class="keyword">=&gt; </span><span class="default">$data<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; );<br />
<br />
</span><span class="default">$context </span><span class="keyword">= </span><span class="default">context_create_stream</span><span class="keyword">(</span><span class="default">$context_options</span><span class="keyword">)<br />
</span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="string">'https://url'</span><span class="keyword">, </span><span class="string">'r'</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">, </span><span class="default">$context</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74431""></a>
  <div class="note">
   <strong class="user">chris dot vigelius at gmx dot net</strong>
   <a href="#74431" class="date">11-Apr-2007 05:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It seems that the authorization example given below by"php at charlesconsulting dot com" does NOT work with PHP 5.2.1, since the 'header' option will be simply ignored if it is not an array (but a string).<br />
<br />
The following works:<br />
$url = '<a href="http://protectedstuff.com" rel="nofollow" target="_blank">http://protectedstuff.com</a>';<br />
$auth = base64_encode('user:password');<br />
$header = array("Authorization: Basic $auth");<br />
$opts = array( 'http' =&gt; array ('method'=&gt;'GET',<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'header'=&gt;$header));<br />
$ctx = stream_context_create($opts);<br />
file_get_contents($url,false,$ctx);<br />
<br />
See also <a href="http://bugs.php.net/bug.php?id=41051" rel="nofollow" target="_blank">http://bugs.php.net/bug.php?id=41051</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="72317""></a>
  <div class="note">
   <strong class="user">php at charlesconsulting dot com</strong>
   <a href="#72317" class="date">13-Jan-2007 07:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's an example of retrieving a page which requests a username and password using the basic authorization scheme.&nbsp; This calls the w3.org web page validator for a password protected page.<br />
//$fileurl contains page to validate<br />
$validateurl="<a href="http://validator.w3.org/check?uri=$fileurl" rel="nofollow" target="_blank">http://validator.w3.org/check?uri=$fileurl</a>";<br />
<br />
$cred = sprintf('Authorization: Basic %s',<br />
&nbsp;&nbsp;&nbsp; base64_encode('username:password') );<br />
$opts = array(<br />
&nbsp;&nbsp;&nbsp; 'http'=&gt;array(<br />
&nbsp;&nbsp;&nbsp; 'method'=&gt;'GET',<br />
&nbsp;&nbsp;&nbsp; 'header'=&gt;$cred) <br />
);<br />
$ctx = stream_context_create($opts);<br />
<br />
$validate=file_get_contents($validateurl,false,$ctx);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="72017""></a>
  <div class="note">
   <strong class="user">sp0n9e at gmail dot com</strong>
   <a href="#72017" class="date">28-Dec-2006 10:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's a very simple way to do posts easily without need of cURL or writing an http request by hand using the tcp:// wrapper.&nbsp; I like using contexts just because of their ubiquity and the lack of an optional library such as cURL (though one of the more popular libraries).<br />
<br />
<span class="default">&lt;?php<br />
<br />
$options </span><span class="keyword">= array(<br />
&nbsp; </span><span class="string">'http'</span><span class="keyword">=&gt;array(<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'method'</span><span class="keyword">=&gt;</span><span class="string">"POST"</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'header'</span><span class="keyword">=&gt;<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="string">"Accept-language: en\r\n"</span><span class="keyword">.<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="string">"Content-type: application/x-www-form-urlencoded\r\n"</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'content'</span><span class="keyword">=&gt;</span><span class="default">http_build_query</span><span class="keyword">(array(</span><span class="string">'foo'</span><span class="keyword">=&gt;</span><span class="string">'bar'</span><span class="keyword">))<br />
));<br />
<br />
</span><span class="default">$context </span><span class="keyword">= </span><span class="default">stream_context_create</span><span class="keyword">(</span><span class="default">$options</span><span class="keyword">);<br />
<br />
</span><span class="default">fopen</span><span class="keyword">(</span><span class="string">'<a href="http://www.example.com/" rel="nofollow" target="_blank">http://www.example.com/</a>'</span><span class="keyword">,</span><span class="default">false</span><span class="keyword">,</span><span class="default">$context</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="59583""></a>
  <div class="note">
   <strong class="user">net_navard at yahoo dot com</strong>
   <a href="#59583" class="date">09-Dec-2005 10:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hi,you can create an array of parameters(what it's called a stream context),which can be transmitted each time you read or write a stream through a socket.In the below example:<br />
<br />
$opts =array('http'=&gt;arra('method'=&gt;"GET",<br />
'header'=&gt;"Accept-language:en\r\n"."Cookie: foo=bar\r\n");<br />
<br />
What you're actually doing is create a set of parameters(the protocol to be used,the request method,additional http headers and a cookie) which will be used each time you open a socket connection to request www.example.com.This saves a lot of time if you want to use these parameters (called a stream context) whenever you include them when making a request to www.example.com,instead of having to specify them over and over again.<br />
Using the previous example,say you want to create a stream context,which sends a "Content-Type" http header and utilize it when making a request to www.example.com.Take a look:<br />
<br />
$opts = array('http'=&gt;array('method'=&gt;"GET",<br />
'header'=&gt;"Content-Type: text/xml; CHARSET=gb2312");<br />
<br />
$context = stream_context_create($opts);<br />
$fp = fopen('<a href="http://www.example.com" rel="nofollow" target="_blank">http://www.example.com</a>','r',false,$context);<br />
fpassthru($fp);<br />
fclose($fp);<br />
<br />
Now,when you make a request to www.example.com,the above http header will be included within the socket and transmitted to the server.Best of luck for you friends,Hossein</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
