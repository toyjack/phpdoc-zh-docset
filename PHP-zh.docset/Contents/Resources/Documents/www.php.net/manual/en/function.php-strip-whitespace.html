<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>返回删除注释和空格后的PHP源码</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.pack.html">? pack</a></li>
      <li style="float: right;"><a href="function.sapi-windows-cp-conv.html">sapi_windows_cp_conv ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.misc.html">杂项 函数</a></li>
    <li>返回删除注释和空格后的PHP源码</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.php-strip-whitespace" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">php_strip_whitespace</h1>
  <p class="verinfo">(PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">php_strip_whitespace</span> &mdash; <span class="dc-title">返回删除注释和空格后的PHP源码</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.php-strip-whitespace-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>php_strip_whitespace</strong></span>(<span class="methodparam"><span class="type">string</span> <code class="parameter">$filename</code></span>): <span class="type">string</span></div>

  <p class="para rdfs-comment">
   返回删除注释和空格后 <code class="parameter">filename</code> 的PHP源码。这对实际代码数量和注释数量的对比很有用。
   此函数与 <a href="features.commandline.html" class="link">命令行</a> 下执行 <strong class="command">php -w</strong> 相似。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.php-strip-whitespace-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>
    
     <dt>
<code class="parameter">filename</code></dt>

     <dd>

      <p class="para">
       PHP文件的路径。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.php-strip-whitespace-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   在成功时返回过滤后的代码，或者在失败时返回空字符串。
  </p>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    此函数在PHP 5.0.1后以所述方式工作。之前它仅会返回一个空字符串。关于更多此BUG的信息与其行为，详见BUG报告 <a href="https://github.com/php/php-src/issues29606" class="link external" title="Link : https://github.com/php/php-src/issues29606">&raquo;&nbsp;#29606</a>。
   </p>
  </p></blockquote>
 </div>

 
 <div class="refsect1 examples" id="refsect1-function.php-strip-whitespace-examples">
  <h3 class="title">范例</h3>
  <p class="para">
   <div class="example" id="example-3409">
    <p><strong>Example #1 <span class="function"><strong>php_strip_whitespace()</strong></span> 的例子</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;PHP&nbsp;comment&nbsp;here<br /><br />/*<br />&nbsp;*&nbsp;Another&nbsp;PHP&nbsp;comment<br />&nbsp;*/<br /><br /></span><span style="color: #007700">echo&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">php_strip_whitespace</span><span style="color: #007700">(</span><span style="color: #0000BB">__FILE__</span><span style="color: #007700">);<br /></span><span style="color: #FF8000">//&nbsp;Newlines&nbsp;are&nbsp;considered&nbsp;whitespace,&nbsp;and&nbsp;are&nbsp;removed&nbsp;too:<br /></span><span style="color: #0000BB">do_nothing</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>以上例程会输出：</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
&lt;?php
 echo php_strip_whitespace(__FILE__); do_nothing(); ?&gt;
</pre></div>
    </div>
    <div class="example-contents"><p>
     可以注意到PHP的注释已不存在，成为第一个echo语句前的换行和空格。
    </p></div>
   </div>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="123863""></a>
  <div class="note">
   <strong class="user">razvan_bc at yahoo dot com</strong>
   <a href="#123863" class="date">20-May-2019 11:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
i notice that on 45=75kb php file compressed using php_strip_whitespace i got slowest speed results in my apache benchmark&nbsp; .bat tests so doing on a normal php file 10 tests and another 10 tests on a compressed one ,calculating the math average value&nbsp; I got fastest results on&nbsp; normal php files.<br />
<br />
well,seeing that results i think&nbsp; SO ,NICE,BUT IF WE COMBINE THESE "METHODS" : what if i use a partial minified method using this function ????<br />
<br />
here is the code:<br />
(if you run this in xampp and you are beginner you got a blank page in firefox&nbsp; ,but if you right click it then you click on the option "view source" you'll get the php partial stripped by comments and tabs) :<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/*&nbsp;&nbsp; hi there !!!<br />
here are the comments */<br />
//another try<br />
<br />
</span><span class="keyword">echo </span><span class="default">removecomments</span><span class="keyword">(</span><span class="string">'index.php'</span><span class="keyword">);<br />
<br />
</span><span class="comment">/*&nbsp;&nbsp; hi there !!!<br />
here are the comments */<br />
//another try<br />
</span><span class="keyword">function </span><span class="default">removecomments</span><span class="keyword">(</span><span class="default">$f</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$w</span><span class="keyword">=Array(</span><span class="string">';'</span><span class="keyword">,</span><span class="string">'{'</span><span class="keyword">,</span><span class="string">'}'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ts </span><span class="keyword">= </span><span class="default">token_get_all</span><span class="keyword">(</span><span class="default">php_strip_whitespace</span><span class="keyword">(</span><span class="default">$f</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$s</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; foreach(</span><span class="default">$ts </span><span class="keyword">as </span><span class="default">$t</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$t</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$s </span><span class="keyword">.=</span><span class="default">$t</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }else{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$s </span><span class="keyword">.=</span><span class="default">$t</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="default">in_array</span><span class="keyword">(</span><span class="default">$t</span><span class="keyword">,</span><span class="default">$w</span><span class="keyword">) ) </span><span class="default">$s</span><span class="keyword">.=</span><span class="default">chr</span><span class="keyword">(</span><span class="default">13</span><span class="keyword">).</span><span class="default">chr</span><span class="keyword">(</span><span class="default">10</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$s</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91065""></a>
  <div class="note">
   <strong class="user">TK</strong>
   <a href="#91065" class="date">22-May-2009 06:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I was looking earlier for a way to strip php comments from my source files but didn't come up with much.&nbsp; I wrote the following function to do the trick using the tokenizer.&nbsp; I've tested in on an entire phpMyAdmin install and it worked fine afterward... so it should be good to go.&nbsp; You may also specify any number of tokens to strip such as T_WHITESPACE rather the default of T_COMMENT and T_DOC_COMMENT.<br />
<br />
Hopefully someone finds it useful.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">strip_tokens</span><span class="keyword">(</span><span class="default">$code</span><span class="keyword">) {<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$args </span><span class="keyword">= </span><span class="default">func_get_args</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$arg_count </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$args</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// if no tokens to strip have been specified then strip comments by default<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if( </span><span class="default">$arg_count </span><span class="keyword">=== </span><span class="default">1 </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$args</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] = </span><span class="default">T_COMMENT</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$args</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">] = </span><span class="default">T_DOC_COMMENT</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// build a keyed array of tokens to strip<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">for( </span><span class="default">$i </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$arg_count</span><span class="keyword">; ++</span><span class="default">$i </span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$strip</span><span class="keyword">[ </span><span class="default">$args</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] ] = </span><span class="default">true</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// set a keyed array of newline characters used to preserve line numbering<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$newlines </span><span class="keyword">= array(</span><span class="string">"\n" </span><span class="keyword">=&gt; </span><span class="default">true</span><span class="keyword">, </span><span class="string">"\r" </span><span class="keyword">=&gt; </span><span class="default">true</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$tokens </span><span class="keyword">= </span><span class="default">token_get_all</span><span class="keyword">(</span><span class="default">$code</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">reset</span><span class="keyword">(</span><span class="default">$tokens</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$return </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$token </span><span class="keyword">= </span><span class="default">current</span><span class="keyword">(</span><span class="default">$tokens</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; while( </span><span class="default">$token </span><span class="keyword">) {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( !</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$token</span><span class="keyword">) )<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$return</span><span class="keyword">.= </span><span class="default">$token</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; elseif(&nbsp; &nbsp; !isset(</span><span class="default">$strip</span><span class="keyword">[ </span><span class="default">$token</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] ]) )<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$return</span><span class="keyword">.= </span><span class="default">$token</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// return only the token's newline characters to preserve line numbering<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">for( </span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">, </span><span class="default">$token_length </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$token</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]); </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$token_length</span><span class="keyword">; ++</span><span class="default">$i </span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if( isset(</span><span class="default">$newlines</span><span class="keyword">[ </span><span class="default">$token</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">] ]) )<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$return</span><span class="keyword">.= </span><span class="default">$token</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">];<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$token </span><span class="keyword">= </span><span class="default">next</span><span class="keyword">(</span><span class="default">$tokens</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; } </span><span class="comment">// while more tokens<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">$return</span><span class="keyword">;<br />
<br />
} </span><span class="comment">// function<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82437""></a>
  <div class="note">
   <strong class="user">gelamu at gmail dot com</strong>
   <a href="#82437" class="date">10-Apr-2008 02:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
With this function You can compress Your PHP source code.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">compress_php_src</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Whitespaces left and right from this signs can be ignored<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">static </span><span class="default">$IW </span><span class="keyword">= array(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">T_CONCAT_EQUAL</span><span class="keyword">,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// .=<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">T_DOUBLE_ARROW</span><span class="keyword">,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// =&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">T_BOOLEAN_AND</span><span class="keyword">,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// &amp;&amp;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">T_BOOLEAN_OR</span><span class="keyword">,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// ||<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">T_IS_EQUAL</span><span class="keyword">,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// ==<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">T_IS_NOT_EQUAL</span><span class="keyword">,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// != or &lt;&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">T_IS_SMALLER_OR_EQUAL</span><span class="keyword">,&nbsp; &nbsp; &nbsp; </span><span class="comment">// &lt;=<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">T_IS_GREATER_OR_EQUAL</span><span class="keyword">,&nbsp; &nbsp; &nbsp; </span><span class="comment">// &gt;=<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">T_INC</span><span class="keyword">,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// ++<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">T_DEC</span><span class="keyword">,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// --<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">T_PLUS_EQUAL</span><span class="keyword">,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// +=<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">T_MINUS_EQUAL</span><span class="keyword">,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// -=<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">T_MUL_EQUAL</span><span class="keyword">,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// *=<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">T_DIV_EQUAL</span><span class="keyword">,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// /=<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">T_IS_IDENTICAL</span><span class="keyword">,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// ===<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">T_IS_NOT_IDENTICAL</span><span class="keyword">,&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// !==<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">T_DOUBLE_COLON</span><span class="keyword">,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// ::<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">T_PAAMAYIM_NEKUDOTAYIM</span><span class="keyword">,&nbsp; &nbsp;&nbsp; </span><span class="comment">// ::<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">T_OBJECT_OPERATOR</span><span class="keyword">,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// -&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">T_DOLLAR_OPEN_CURLY_BRACES</span><span class="keyword">, </span><span class="comment">// ${<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">T_AND_EQUAL</span><span class="keyword">,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// &amp;=<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">T_MOD_EQUAL</span><span class="keyword">,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// %=<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">T_XOR_EQUAL</span><span class="keyword">,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// ^=<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">T_OR_EQUAL</span><span class="keyword">,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// |=<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">T_SL</span><span class="keyword">,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// &lt;&lt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">T_SR</span><span class="keyword">,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// &gt;&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">T_SL_EQUAL</span><span class="keyword">,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// &lt;&lt;=<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">T_SR_EQUAL</span><span class="keyword">,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// &gt;&gt;=<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">is_file</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(!</span><span class="default">$src </span><span class="keyword">= </span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$tokens </span><span class="keyword">= </span><span class="default">token_get_all</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$new </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$c </span><span class="keyword">= </span><span class="default">sizeof</span><span class="keyword">(</span><span class="default">$tokens</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$iw </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">; </span><span class="comment">// ignore whitespace<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ih </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">; </span><span class="comment">// in HEREDOC<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ls </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">// last sign<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ot </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;&nbsp; </span><span class="comment">// open tag<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">for(</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$c</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$token </span><span class="keyword">= </span><span class="default">$tokens</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$token</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; list(</span><span class="default">$tn</span><span class="keyword">, </span><span class="default">$ts</span><span class="keyword">) = </span><span class="default">$token</span><span class="keyword">; </span><span class="comment">// tokens: number, string, line<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tname </span><span class="keyword">= </span><span class="default">token_name</span><span class="keyword">(</span><span class="default">$tn</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$tn </span><span class="keyword">== </span><span class="default">T_INLINE_HTML</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new </span><span class="keyword">.= </span><span class="default">$ts</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$iw </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$tn </span><span class="keyword">== </span><span class="default">T_OPEN_TAG</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$ts</span><span class="keyword">, </span><span class="string">" "</span><span class="keyword">) || </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$ts</span><span class="keyword">, </span><span class="string">"\n"</span><span class="keyword">) || </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$ts</span><span class="keyword">, </span><span class="string">"\t"</span><span class="keyword">) || </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$ts</span><span class="keyword">, </span><span class="string">"\r"</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ts </span><span class="keyword">= </span><span class="default">rtrim</span><span class="keyword">(</span><span class="default">$ts</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ts </span><span class="keyword">.= </span><span class="string">" "</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new </span><span class="keyword">.= </span><span class="default">$ts</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ot </span><span class="keyword">= </span><span class="default">T_OPEN_TAG</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$iw </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } elseif(</span><span class="default">$tn </span><span class="keyword">== </span><span class="default">T_OPEN_TAG_WITH_ECHO</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new </span><span class="keyword">.= </span><span class="default">$ts</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ot </span><span class="keyword">= </span><span class="default">T_OPEN_TAG_WITH_ECHO</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$iw </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } elseif(</span><span class="default">$tn </span><span class="keyword">== </span><span class="default">T_CLOSE_TAG</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$ot </span><span class="keyword">== </span><span class="default">T_OPEN_TAG_WITH_ECHO</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new </span><span class="keyword">= </span><span class="default">rtrim</span><span class="keyword">(</span><span class="default">$new</span><span class="keyword">, </span><span class="string">"; "</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ts </span><span class="keyword">= </span><span class="string">" "</span><span class="keyword">.</span><span class="default">$ts</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new </span><span class="keyword">.= </span><span class="default">$ts</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ot </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$iw </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } elseif(</span><span class="default">in_array</span><span class="keyword">(</span><span class="default">$tn</span><span class="keyword">, </span><span class="default">$IW</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new </span><span class="keyword">.= </span><span class="default">$ts</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$iw </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } elseif(</span><span class="default">$tn </span><span class="keyword">== </span><span class="default">T_CONSTANT_ENCAPSED_STRING<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">|| </span><span class="default">$tn </span><span class="keyword">== </span><span class="default">T_ENCAPSED_AND_WHITESPACE</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$ts</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] == </span><span class="string">'"'</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ts </span><span class="keyword">= </span><span class="default">addcslashes</span><span class="keyword">(</span><span class="default">$ts</span><span class="keyword">, </span><span class="string">"\n\t\r"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new </span><span class="keyword">.= </span><span class="default">$ts</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$iw </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } elseif(</span><span class="default">$tn </span><span class="keyword">== </span><span class="default">T_WHITESPACE</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nt </span><span class="keyword">= @</span><span class="default">$tokens</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(!</span><span class="default">$iw </span><span class="keyword">&amp;&amp; (!</span><span class="default">is_string</span><span class="keyword">(</span><span class="default">$nt</span><span class="keyword">) || </span><span class="default">$nt </span><span class="keyword">== </span><span class="string">'$'</span><span class="keyword">) &amp;&amp; !</span><span class="default">in_array</span><span class="keyword">(</span><span class="default">$nt</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="default">$IW</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new </span><span class="keyword">.= </span><span class="string">" "</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$iw </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } elseif(</span><span class="default">$tn </span><span class="keyword">== </span><span class="default">T_START_HEREDOC</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new </span><span class="keyword">.= </span><span class="string">"&lt;&lt;&lt;S\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$iw </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ih </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">; </span><span class="comment">// in HEREDOC<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">} elseif(</span><span class="default">$tn </span><span class="keyword">== </span><span class="default">T_END_HEREDOC</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new </span><span class="keyword">.= </span><span class="string">"S;"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$iw </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ih </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">; </span><span class="comment">// in HEREDOC<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">for(</span><span class="default">$j </span><span class="keyword">= </span><span class="default">$i</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">; </span><span class="default">$j </span><span class="keyword">&lt; </span><span class="default">$c</span><span class="keyword">; </span><span class="default">$j</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">is_string</span><span class="keyword">(</span><span class="default">$tokens</span><span class="keyword">[</span><span class="default">$j</span><span class="keyword">]) &amp;&amp; </span><span class="default">$tokens</span><span class="keyword">[</span><span class="default">$j</span><span class="keyword">] == </span><span class="string">";"</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$i </span><span class="keyword">= </span><span class="default">$j</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else if(</span><span class="default">$tokens</span><span class="keyword">[</span><span class="default">$j</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">] == </span><span class="default">T_CLOSE_TAG</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } elseif(</span><span class="default">$tn </span><span class="keyword">== </span><span class="default">T_COMMENT </span><span class="keyword">|| </span><span class="default">$tn </span><span class="keyword">== </span><span class="default">T_DOC_COMMENT</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$iw </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(!</span><span class="default">$ih</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ts </span><span class="keyword">= </span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">$ts</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new </span><span class="keyword">.= </span><span class="default">$ts</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$iw </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ls </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if((</span><span class="default">$token </span><span class="keyword">!= </span><span class="string">";" </span><span class="keyword">&amp;&amp; </span><span class="default">$token </span><span class="keyword">!= </span><span class="string">":"</span><span class="keyword">) || </span><span class="default">$ls </span><span class="keyword">!= </span><span class="default">$token</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new </span><span class="keyword">.= </span><span class="default">$token</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ls </span><span class="keyword">= </span><span class="default">$token</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$iw </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$new</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
For example:<br />
<span class="default">&lt;?php<br />
<br />
$src </span><span class="keyword">= &lt;&lt;&lt;EOT<br />
</span><span class="string">&lt;?php<br />
// some comment<br />
for ( </span><span class="default">$i</span><span class="string"> = 0; </span><span class="default">$i</span><span class="string"> &lt; 99; </span><span class="default">$i</span><span class="string"> ++ ) {<br />
&nbsp;&nbsp; echo "i=</span><span class="keyword">${ </span><span class="default">i </span><span class="keyword">}</span><span class="string">\n";<br />
&nbsp;&nbsp; /* ... */<br />
}<br />
/** ... */<br />
function abc() {<br />
&nbsp;&nbsp; return&nbsp;&nbsp; "abc";<br />
};<br />
<br />
abc();<br />
?&gt;<br />
&lt;h1&gt;&lt;?= "Some text " . str_repeat("_-x-_ ", 32);;; ?&gt;&lt;/h1&gt;<br />
</span><span class="keyword">EOT;<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">compress_php_src</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">));<br />
</span><span class="default">?&gt;<br />
</span><br />
And the result is:<br />
string(125) "<span class="default">&lt;?php </span><span class="keyword">for(=</span><span class="default">0</span><span class="keyword">;&lt;</span><span class="default">99</span><span class="keyword">;++){echo </span><span class="string">"i=\n"</span><span class="keyword">;}function </span><span class="default">abc</span><span class="keyword">(){return </span><span class="string">"abc"</span><span class="keyword">;};</span><span class="default">abc</span><span class="keyword">(); </span><span class="default">?&gt;<br />
</span>&lt;h1&gt;<span class="default">&lt;?=</span><span class="string">"Some text "</span><span class="keyword">.</span><span class="default">str_repeat</span><span class="keyword">(</span><span class="string">"_-x-_ "</span><span class="keyword">,</span><span class="default">32</span><span class="keyword">)</span><span class="default">?&gt;</span>&lt;/h1&gt;"</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="78216""></a>
  <div class="note">
   <strong class="user">Jouni</strong>
   <a href="#78216" class="date">03-Oct-2007 05:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you wish to just remove excess whitespace from a string, see the example "Strip whitespace" in the preg_replace documentation (<a href="http://www.php.net/manual/en/function.preg-replace.php" rel="nofollow" target="_blank">http://www.php.net/manual/en/function.preg-replace.php</a>).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="67983""></a>
  <div class="note">
   <strong class="user">flconseil at yahoo dot fr</strong>
   <a href="#67983" class="date">08-Jul-2006 08:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Beware that this function uses the output buffering mechanism.<br />
<br />
If you give a 'stream wrapped' path as argument, anything echoed by the stream wrapper during this call (e.g. trace messages) won't be displayed to the screen but will be inserted in php_strip_whitespace's result.<br />
<br />
If you execute this stripped code later, it will display the messages which should have been output during php_strip_whitespace's execution !</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
