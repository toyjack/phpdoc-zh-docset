<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>设置环境变量的值</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.phpversion.html">? phpversion</a></li>
      <li style="float: right;"><a href="function.restore-include-path.html">restore_include_path ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.info.html">PHP 选项/信息 函数</a></li>
    <li>设置环境变量的值</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.putenv" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">putenv</h1>
  <p class="verinfo">(PHP 4, PHP 5, PHP 7)</p><p class="refpurpose"><span class="refname">putenv</span> &mdash; <span class="dc-title">设置环境变量的值</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.putenv-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>putenv</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$setting</code></span>
   ) : <span class="type">bool</span></div>

  <p class="para rdfs-comment">
   添加 <code class="parameter">setting</code> 到服务器环境变量。
   环境变量仅存活于当前请求期间。
   在请求结束时环境会恢复到初始状态。
  </p>
  <p class="para">
   设置特定的环境变量也有可能是一个潜在的安全漏洞。
   <em>safe_mode_allowed_env_vars</em> 包含了一个以逗号分隔的前缀列表。
   在安全模式下，用户可以仅能修改用该指令设定的前缀名称的指令。
   默认情况下，用户仅能够修改以 <em>PHP_</em> 开头的环境变量（例如 <em>PHP_FOO=BAR</em>）。
   注意：如果此指令是空的，PHP允许用户设定任意环境变量！
  </p>
  <p class="para">
   <em>safe_mode_protected_env_vars</em> 指令包含了逗号分隔的环境变量列表，使用户最终无法通过 <span class="function"><strong>putenv()</strong></span> 修改。
   即使 <em>safe_mode_allowed_env_vars</em> 设置允许修改，这些变量也会被保护。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.putenv-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">setting</code></dt>

     <dd>

      <p class="para">
       设置，例如 <em>&quot;FOO=BAR&quot;</em>
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.putenv-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   成功时返回 <strong><code>TRUE</code></strong>， 或者在失败时返回 <strong><code>FALSE</code></strong>。
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.putenv-examples">
  <h3 class="title">范例</h3>
  <p class="para">
   <div class="example" id="example-539">
    <p><strong>Example #1 设置一个环境变量</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />putenv</span><span style="color: #007700">(</span><span style="color: #DD0000">"UNIQID=</span><span style="color: #0000BB">$uniqid</span><span style="color: #DD0000">"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 notes" id="refsect1-function.putenv-notes">
  <h3 class="title">注释</h3>
  <div class="warning"><strong class="warning">Warning</strong>
   <p class="para">
    The <em>safe_mode_allowed_env_vars</em> 和
    <em>safe_mode_protected_env_vars</em> 指令仅仅在启用<a href="features.safe-mode.html" class="link">安全模式</a>时有效。
   </p>
  </div>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.putenv-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.getenv.html" class="function" rel="rdfs-seeAlso">getenv()</a> - 获取一个环境变量的值</span></li>
    <li class="member"><span class="function"><a href="function.apache-setenv.html" class="function" rel="rdfs-seeAlso">apache_setenv()</a> - 设置 Apache 子进程环境变量</span></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="124159""></a>
  <div class="note">
   <strong class="user">t7to7</strong>
   <a href="#124159" class="date">01-Sep-2019 11:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
White spaces are allowed in environment variable names so :<br />
<br />
<span class="default">&lt;?php<br />
putenv</span><span class="keyword">(</span><span class="string">'U =33'</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Is not equivalent to <br />
<br />
<span class="default">&lt;?php<br />
putenv</span><span class="keyword">(</span><span class="string">'U=33'</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="121551""></a>
  <div class="note">
   <strong class="user">broussardrobert at sbcglobal dot net</strong>
   <a href="#121551" class="date">22-Aug-2017 11:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Multiple invocations of putenv() work as expected: the real problem was that some of the putenv() invocations in my script contained typographical errors.<br />
<br />
I typed, e.g., putenv( "IMAGE_DATABASE=" . $_SERVER{'IMAGE_DATABASE'} );<br />
which of course is incorrect.&nbsp; '{' and '}' should have been '[' and ']'.<br />
Because my first call to putenv() did not have that typo, it worked correctly, but the remaining three calls I coded with the typo merely cleared the corresponding environment variables and thus did not make it into the external script I invoked via a system() call.&nbsp; I suspect the fact my first invocation was typed correctly affected my efforts looking at the syntax in the following invocations.<br />
<br />
The trivial extension to the example provided is to merely call putenv() multiple times, once for each variable.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="121549""></a>
  <div class="note">
   <strong class="user">broussardrobert at sbcglobal dot net</strong>
   <a href="#121549" class="date">22-Aug-2017 05:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Great examples for the trivial case that most can figure out directly from the manual, but where is the trivially more complex example describing how to set multiple variables?&nbsp; I tried separating with spaces, commas, semicolons, multiple invocations of setenv, all to no avail.&nbsp; Please try to include trivial extensions to the examples...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="108085""></a>
  <div class="note">
   <strong class="user">Anonymous Coder</strong>
   <a href="#108085" class="date">27-Mar-2012 06:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It's the putenv() type of environment variables that get passed to a child process executed via exec().<br />
<br />
If you need to delete an existing environment variable so the child process does not see it, use:<br />
<br />
putenv('FOOBAR');<br />
<br />
That is, leave out both the "=" and a value.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="98540""></a>
  <div class="note">
   <strong class="user">php at keith tyler dot com</strong>
   <a href="#98540" class="date">21-Jun-2010 05:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
putenv/getenv, $_ENV, and phpinfo(INFO_ENVIRONMENT) are three completely distinct environment stores. doing putenv("x=y") does not affect $_ENV; but also doing $_ENV["x"]="y" likewise does not affect getenv("x"). And neither affect what is returned in phpinfo().<br />
<br />
Assuming the USER environment variable is defined as "dave" before running the following:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">print </span><span class="string">"env is: "</span><span class="keyword">.</span><span class="default">$_ENV</span><span class="keyword">[</span><span class="string">"USER"</span><span class="keyword">].</span><span class="string">"\n"</span><span class="keyword">;<br />
print </span><span class="string">"(doing: putenv fred)\n"</span><span class="keyword">;<br />
</span><span class="default">putenv</span><span class="keyword">(</span><span class="string">"USER=fred"</span><span class="keyword">);<br />
print </span><span class="string">"env is: "</span><span class="keyword">.</span><span class="default">$_ENV</span><span class="keyword">[</span><span class="string">"USER"</span><span class="keyword">].</span><span class="string">"\n"</span><span class="keyword">;<br />
print </span><span class="string">"getenv is: "</span><span class="keyword">.</span><span class="default">getenv</span><span class="keyword">(</span><span class="string">"USER"</span><span class="keyword">).</span><span class="string">"\n"</span><span class="keyword">;<br />
print </span><span class="string">"(doing: set _env barney)\n"</span><span class="keyword">;<br />
</span><span class="default">$_ENV</span><span class="keyword">[</span><span class="string">"USER"</span><span class="keyword">]=</span><span class="string">"barney"</span><span class="keyword">;<br />
print </span><span class="string">"getenv is: "</span><span class="keyword">.</span><span class="default">getenv</span><span class="keyword">(</span><span class="string">"USER"</span><span class="keyword">).</span><span class="string">"\n"</span><span class="keyword">;<br />
print </span><span class="string">"env is: "</span><span class="keyword">.</span><span class="default">$_ENV</span><span class="keyword">[</span><span class="string">"USER"</span><span class="keyword">].</span><span class="string">"\n"</span><span class="keyword">;<br />
</span><span class="default">phpinfo</span><span class="keyword">(</span><span class="default">INFO_ENVIRONMENT</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
prints:<br />
<br />
env is: dave<br />
(doing: putenv fred)<br />
env is: dave<br />
getenv is: fred<br />
(doing: set _env barney)<br />
getenv is: fred<br />
env is: barney<br />
phpinfo()<br />
<br />
Environment<br />
<br />
Variable =&gt; Value<br />
...<br />
USER =&gt; dave<br />
...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73308""></a>
  <div class="note">
   <strong class="user">JM</strong>
   <a href="#73308" class="date">16-Feb-2007 06:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The other problem with the code from av01 at bugfix dot cc is that<br />
the behaviour is as per the comments here, not there:<br />
<span class="default">&lt;?php<br />
putenv</span><span class="keyword">(</span><span class="string">'MYVAR='</span><span class="keyword">); </span><span class="comment">// set MYVAR to an empty value.&nbsp; It is in the environment<br />
</span><span class="default">putenv</span><span class="keyword">(</span><span class="string">'MYVAR'</span><span class="keyword">); </span><span class="comment">// unset MYVAR.&nbsp; It is removed from the environment<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="8496""></a>
  <div class="note">
   <strong class="user">david dot boyce at messagingdirect dot comnospam</strong>
   <a href="#8496" class="date">13-Sep-2000 10:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Environment variables are part of the underlying operating system's
<br />
way of doing things, and are used to pass information between a parent
<br />
process and its child, as well as to affect the way some internal
<br />
functions behave.&nbsp; They should not be regarded as ordinary PHP
<br />
variables.
<br />

<br />
A primary purpose of setting environment variables in a PHP script is
<br />
so that they are available to processes invoked by that script using
<br />
e.g. the system() function, and it's unlikely that they would need to
<br />
be changed for other reasons.
<br />

<br />
For example, if a particular system command required a special value
<br />
of the environment variable LD_LIBRARY_PATH to execute successfully,
<br />
then the following code might be used on a *NIX system:
<br />

<br />
<span class="default">&lt;?php
<br />
&nbsp;$saved </span><span class="keyword">= </span><span class="default">getenv</span><span class="keyword">(</span><span class="string">"LD_LIBRARY_PATH"</span><span class="keyword">);&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// save old value
<br />
&nbsp;</span><span class="default">$newld </span><span class="keyword">= </span><span class="string">"/extra/library/dir:/another/path/to/lib"</span><span class="keyword">;&nbsp; </span><span class="comment">// extra paths to add
<br />
&nbsp;</span><span class="keyword">if (</span><span class="default">$saved</span><span class="keyword">) { </span><span class="default">$newld </span><span class="keyword">.= </span><span class="string">":</span><span class="default">$saved</span><span class="string">"</span><span class="keyword">; }&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// append old paths if any
<br />
&nbsp;</span><span class="default">putenv</span><span class="keyword">(</span><span class="string">"LD_LIBRARY_PATH=</span><span class="default">$newld</span><span class="string">"</span><span class="keyword">);&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// set new value
<br />
&nbsp;</span><span class="default">system</span><span class="keyword">(</span><span class="string">"mycommand -with args"</span><span class="keyword">);&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// do system command; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // mycommand is loaded using
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // libs in the new path list
<br />
&nbsp;</span><span class="default">putenv</span><span class="keyword">(</span><span class="string">"LD_LIBRARY_PATH=</span><span class="default">$saved</span><span class="string">"</span><span class="keyword">);&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// restore old value
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
It will usually be appropriate to restore the old value after use;
<br />
LD_LIBRARY_PATH is a particularly good example of a variable which it
<br />
is important to restore immediately, as it is used by internal
<br />
functions.
<br />

<br />
If php.ini configuration allows, the values of environment variables
<br />
are made available as PHP global variables on entry to a script, but
<br />
these global variables are merely copies and do not track the actual
<br />
environment variables once the script is entered.&nbsp; Changing
<br />
$REMOTE_ADDR (or even $HTTP_ENV_VARS["REMOTE_ADDR"]) should not be
<br />
expected to affect the actual environment variable; this is why
<br />
putenv() is needed.
<br />

<br />
Finally, do not rely on environment variables maintaining the same
<br />
value from one script invocation to the next, especially if you have
<br />
used putenv().&nbsp; The result depends on many factors, such as CGI vs
<br />
apache module, and the exact way in which the environment is
<br />
manipulated before entering the script.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
