<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>解析一个x.509证书并返回一个资源标识符</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.openssl-x509-parse.html">? openssl_x509_parse</a></li>
      <li style="float: right;"><a href="function.openssl-x509-verify.html">openssl_x509_verify ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.openssl.html">OpenSSL 函数</a></li>
    <li>解析一个x.509证书并返回一个资源标识符</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.openssl-x509-read" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">openssl_x509_read</h1>
  <p class="verinfo">(PHP 4 &gt;= 4.0.6, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">openssl_x509_read</span> &mdash; <span class="dc-title">解析一个x.509证书并返回一个资源标识符</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.openssl-x509-read-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>openssl_x509_read</strong></span>
    ( <span class="methodparam"><span class="type"><a href="language.types.declarations.html#language.types.declarations.mixed" class="type mixed">mixed</a></span> <code class="parameter">$x509certdata</code></span>
   ) : <span class="type">resource</span></div>

  <p class="para rdfs-comment">
   <span class="function"><strong>openssl_x509_read()</strong></span> 解析<code class="parameter">x509certdata</code>提供的证书，并返回一个资源标识符。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.openssl-x509-read-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">x509certdata</code></dt>

     <dd>

      <p class="para">
        X509 证书。参见 <a href="openssl.certparams.html" class="link">Key/Certificate parameters</a> 获取可用的值。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.openssl-x509-read-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   成功，返回一个资源标识符， 或者在失败时返回 <strong><code>false</code></strong>.
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="103906""></a>
  <div class="note">
   <strong class="user">marc theat nwd thedot mx</strong>
   <a href="#103906" class="date">10-May-2011 09:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To get the real timestamps as integer values for the validity daterange you can use as follows:<br />
<br />
<span class="default">&lt;?php<br />
$data </span><span class="keyword">= </span><span class="default">openssl_x509_parse</span><span class="keyword">(</span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="string">'/path/to/cert.crt'</span><span class="keyword">));<br />
<br />
</span><span class="default">$validFrom </span><span class="keyword">= </span><span class="default">date</span><span class="keyword">(</span><span class="string">'Y-m-d H:i:s'</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">[</span><span class="string">'validFrom_time_t'</span><span class="keyword">]);<br />
</span><span class="default">$validTo </span><span class="keyword">) </span><span class="default">date</span><span class="keyword">(</span><span class="string">'Y-m-d H:i:s'</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">[</span><span class="string">'validTo_time_t'</span><span class="keyword">]);<br />
<br />
echo </span><span class="default">$validFrom </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">;<br />
echo </span><span class="default">$validTo </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">;<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="32690""></a>
  <div class="note">
   
   <a href="#32690" class="date">04-Jun-2003 09:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
After some tests I've been able to get some results this way ...
<br />

<br />
<span class="default">&lt;?php
<br />

<br />
&nbsp;$fp </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="string">"/etc/httpd/conf/ssl/moncertif.crt"</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">);
<br />
&nbsp;</span><span class="default">$cert </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">8192</span><span class="keyword">);
<br />
&nbsp;</span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);
<br />

<br />
echo </span><span class="string">"Read&lt;br&gt;"</span><span class="keyword">;
<br />
echo </span><span class="default">openssl_x509_read</span><span class="keyword">(</span><span class="default">$cert</span><span class="keyword">);
<br />
echo </span><span class="string">"&lt;br&gt;"</span><span class="keyword">;
<br />
echo </span><span class="string">"*********************"</span><span class="keyword">;
<br />
echo </span><span class="string">"&lt;br&gt;"</span><span class="keyword">;
<br />
echo </span><span class="string">"Parse&lt;br&gt;"</span><span class="keyword">;
<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">openssl_x509_parse</span><span class="keyword">(</span><span class="default">$cert</span><span class="keyword">));
<br />
</span><span class="comment">/*
<br />
// or
<br />
print_r(openssl_x509_parse( openssl_x509_read($cert) ) );
<br />
*/
<br />

<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
enjoy
<br />
;)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="29117""></a>
  <div class="note">
   <strong class="user">anthony dot whitehead at rfv dot sfa dot se</strong>
   <a href="#29117" class="date">03-Feb-2003 05:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Short HOWTO for getting data out of a client certificate via an SSL enabled iPlanet (Netscape Enterprise or Sun ONE) web server.<br />
<br />
The iPlanet server sets $_SERVER["CLIENT_CERT"] whenever a client authenticates with a certificate. This variable contains an encoded representation of the certificate presented by the client. This in itself is useless to scripts or applications, we need to extract the actual information from the encoding. It turns out that we are in luck, the encoding is NEARLY a standard PEM encoding which can be read by the openssl_x509_read() function. A standard PEM has a begin line, an end line and inbetween is a base64 encoding of the DER representation of the certificate. PEM requires that linefeeds be present every 64 characters, however this is already the case with our CLIENT_CERT variable. For some reason the iPlanet server neglects to attach the begin and end headers, all that is required to allow access to the certificate is replacing these headers. Here is a small code excerpt for doing just that and printing out the raw certificate data.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; $beginpem </span><span class="keyword">= </span><span class="string">"-----BEGIN CERTIFICATE-----\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$endpem </span><span class="keyword">= </span><span class="string">"-----END CERTIFICATE-----\n"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Small function to print the data recursivly.<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">print_element</span><span class="keyword">(</span><span class="default">$item</span><span class="keyword">, </span><span class="default">$key</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="default">is_array</span><span class="keyword">( </span><span class="default">$item </span><span class="keyword">) )<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"</span><span class="default">$key</span><span class="string"> is Array:\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">array_walk</span><span class="keyword">( </span><span class="default">$item</span><span class="keyword">, </span><span class="string">'print_element' </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"</span><span class="default">$key</span><span class="string"> done\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"</span><span class="default">$key</span><span class="string"> = </span><span class="default">$item</span><span class="string">\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Build the PEM string.<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$pemdata </span><span class="keyword">= </span><span class="default">$beginpem</span><span class="keyword">.</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">"CLIENT_CERT"</span><span class="keyword">].</span><span class="string">"\n"</span><span class="keyword">.</span><span class="default">$endpem</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Get a certificate resource from the PEM string.<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$cert </span><span class="keyword">= </span><span class="default">openssl_x509_read</span><span class="keyword">( </span><span class="default">$pemdata </span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Parse the resource and print out the contents.<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$cert_data </span><span class="keyword">= </span><span class="default">openssl_x509_parse</span><span class="keyword">( </span><span class="default">$cert </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">array_walk</span><span class="keyword">( </span><span class="default">$cert_data</span><span class="keyword">, </span><span class="string">'print_element' </span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Free the resource<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">openssl_x509_free</span><span class="keyword">( </span><span class="default">$cert </span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
