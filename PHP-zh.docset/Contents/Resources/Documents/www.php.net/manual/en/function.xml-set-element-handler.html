<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>建立起始和终止元素处理器</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.xml-set-default-handler.html">? xml_set_default_handler</a></li>
      <li style="float: right;"><a href="function.xml-set-end-namespace-decl-handler.html">xml_set_end_namespace_decl_handler ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.xml.html">XML 解析器函数</a></li>
    <li>建立起始和终止元素处理器</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.xml-set-element-handler" class="refentry">
   <div class="refnamediv">
    <h1 class="refname">xml_set_element_handler</h1>
    <p class="verinfo">(PHP 4, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">xml_set_element_handler</span> &mdash; <span class="dc-title">建立起始和终止元素处理器</span></p>

   </div>
   
 <div class="refsect1 description" id="refsect1-function.xml-set-element-handler-description">
  <h3 class="title">说明</h3>
    <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>xml_set_element_handler</strong></span>(<span class="methodparam"><span class="type">resource</span> <code class="parameter">$parser</code></span>, <span class="methodparam"><span class="type"><a href="language.types.callable.html" class="type callable">callable</a></span> <code class="parameter">$start_element_handler</code></span>, <span class="methodparam"><span class="type"><a href="language.types.callable.html" class="type callable">callable</a></span> <code class="parameter">$end_element_handler</code></span>): <span class="type">bool</span></div>

    <p class="para rdfs-comment">
     为 <code class="parameter">parser</code> 参数指定的 XML 解析器建立元素处理器函数。参数 <code class="parameter">start_element_handler</code> 和 <code class="parameter">end_element_handler</code> 为表示函数名称的字符串，这些函数必须在为 <code class="parameter">parser</code> 指定的解析器调用 <span class="function"><a href="function.xml-parse.html" class="function">xml_parse()</a></span> 函数时已存在。
    </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.xml-set-element-handler-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>
    
     <dt>
<code class="parameter">parser</code></dt>

     <dd>

      <p class="para">
       XML 解析器的引用，用于建立起始和终止元素处理器。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">start_element_handler</code></dt>

     <dd>

      <p class="para">
            由 <code class="parameter">start_element_handler</code> 参数命名的函数名必须接受三个参数：
       <div class="methodsynopsis dc-description">
        <span class="methodname"><span class="replaceable">start_element_handler</span></span>(<span class="methodparam"><span class="type">resource</span> <code class="parameter">$parser</code></span>, <span class="methodparam"><span class="type">string</span> <code class="parameter">$name</code></span>, <span class="methodparam"><span class="type">array</span> <code class="parameter">$attribs</code></span>)</div>

       <dl>
        
         <dt>
<code class="parameter">parser</code></dt>
 
         <dd>

          <span class="simpara">
           第一个参数 <span class="replaceable">parser</span> 为指向要调用处理器的 XML 解析器的指针。
          </span>
         </dd>

        
        
         <dt>
<code class="parameter">name</code></dt>

         <dd>

          <span class="simpara">
           第二个参数 <code class="parameter">name</code> 为该处理器为之被调用的元素名。如果<a href="xml.case-folding.html" class="link">大小写折叠（case-folding）</a>对该解析器有效，元素名将用大写字母表示。
          </span>
         </dd>

        
        
         <dt>
<code class="parameter">attribs</code></dt>

         <dd>

          <span class="simpara">
           第三个参数 <code class="parameter">attribs</code> 为一个包含有对应元素的属性的数组（如果该元素有属性）。数组元素的下标为属性名，元素的值即为属性的值。属性名将以和元素名同样的标准进行<a href="xml.case-folding.html" class="link">大小写折叠（case-folded）</a>，其值<em class="emphasis">不</em>进行大小写折叠。
          </span>
          <span class="simpara">
           属性的原始顺序将会被参数保留，用 <span class="function"><a href="function.each.html" class="function">each()</a></span> 函数遍历 <code class="parameter">attribs</code> 时，该数组下表的顺序和属性的顺序相同。
          </span>
         </dd>

        
       </dl>

      </p>
      <blockquote class="note"><p><strong class="note">Note</strong>: <span class="simpara">除了函数名，含有对象引用的数组和方法名也可以作为参数。</span></p></blockquote>
     </dd>

    
    
     <dt>
<code class="parameter">end_element_handler</code></dt>

     <dd>

      <p class="para">
            由 <code class="parameter">end_element_handler</code> 参数命名的函数名必须接受两个参数：
       <div class="methodsynopsis dc-description">
        <span class="methodname"><span class="replaceable">end_element_handler</span></span>(<span class="methodparam"><span class="type">resource</span> <code class="parameter">$parser</code></span>, <span class="methodparam"><span class="type">string</span> <code class="parameter">$name</code></span>)</div>

       <dl>
        
         <dt>
<code class="parameter">parser</code></dt>
 
         <dd>

          <span class="simpara">
           第一个参数 <span class="replaceable">parser</span> 为指向要调用处理器的 XML 解析器的指针。
          </span>
         </dd>

        
        
         <dt>
<code class="parameter">name</code></dt>

         <dd>

          <span class="simpara">
          第二个参数 <code class="parameter">name</code> 为该处理器为之被调用的元素名。如果<a href="xml.case-folding.html" class="link">大小写折叠（case-folding）</a>对该解析器有效，元素名将用大写字母表示。
          </span>
         </dd>

        
       </dl>

      </p>
      <p class="para">
       如果处理器函数名被设置为空字符串或者 <strong><code>false</code></strong>，则该有问题的处理器将被屏蔽。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.xml-set-element-handler-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   成功时返回 <strong><code>true</code></strong>， 或者在失败时返回 <strong><code>false</code></strong>。
  </p>
 </div>

  </div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="85970""></a>
  <div class="note">
   <strong class="user">kok at nachon dot nl</strong>
   <a href="#85970" class="date">26-Sep-2008 06:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is another example of detecting empty elements. I works with libxml2. Note that it handles buffer boundaries.<br />
<br />
<span class="default">&lt;?php<br />
<br />
$depth </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="comment">//current depth, used for pretty printing<br />
</span><span class="default">$empty </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">; </span><span class="comment">//whether the tag is empty<br />
</span><span class="default">$offset </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="comment">//the index of the start of the current buffer within the stream<br />
<br />
</span><span class="keyword">function </span><span class="default">tagStart</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$name</span><span class="keyword">, array </span><span class="default">$attribs</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; global </span><span class="default">$depth</span><span class="keyword">, </span><span class="default">$empty</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">, </span><span class="default">$offset</span><span class="keyword">, </span><span class="default">$lastchar</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$idx </span><span class="keyword">= </span><span class="default">xml_get_current_byte_index</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/* xml_get_current_byte_index returns index within the streams and not<br />
&nbsp;&nbsp; &nbsp; &nbsp; within the buffer.*/<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; /* Check if the index is within the buffer. */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (isset(</span><span class="default">$data</span><span class="keyword">[</span><span class="default">$idx </span><span class="keyword">- </span><span class="default">$offset</span><span class="keyword">])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$c </span><span class="keyword">= </span><span class="default">$data</span><span class="keyword">[</span><span class="default">$idx </span><span class="keyword">- </span><span class="default">$offset</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/* If it isn't simple use the last character of the buffer. */<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$c </span><span class="keyword">= </span><span class="default">$lastchar</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$empty </span><span class="keyword">= </span><span class="default">$c </span><span class="keyword">== </span><span class="string">'/'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">str_repeat</span><span class="keyword">(</span><span class="string">"\t"</span><span class="keyword">, </span><span class="default">$depth</span><span class="keyword">), </span><span class="string">"&lt;</span><span class="default">$name</span><span class="string">"</span><span class="keyword">, (</span><span class="default">$empty </span><span class="keyword">? </span><span class="string">'/&gt;' </span><span class="keyword">: </span><span class="string">'&gt;'</span><span class="keyword">), </span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if (!</span><span class="default">$empty</span><span class="keyword">) ++</span><span class="default">$depth</span><span class="keyword">;<br />
}<br />
<br />
function </span><span class="default">tagEnd</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$name</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; global </span><span class="default">$depth</span><span class="keyword">, </span><span class="default">$empty</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if (!</span><span class="default">$empty</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; --</span><span class="default">$depth</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">str_repeat</span><span class="keyword">(</span><span class="string">"\t"</span><span class="keyword">, </span><span class="default">$depth</span><span class="keyword">), </span><span class="string">"&lt;/</span><span class="default">$name</span><span class="string">&gt;\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$empty </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">$parser </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">();<br />
</span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">XML_OPTION_CASE_FOLDING</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br />
</span><span class="default">xml_set_element_handler</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="string">'tagStart'</span><span class="keyword">, </span><span class="string">'tagEnd'</span><span class="keyword">);<br />
<br />
</span><span class="default">$data1 </span><span class="keyword">= </span><span class="string">'<br />
&lt;test&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;empty att="3" /&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;nocontent&gt;&lt;/nocontent&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;content&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;empty/&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;empty/&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;/content&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;empty/'</span><span class="keyword">;<br />
<br />
</span><span class="default">$data2 </span><span class="keyword">= </span><span class="string">'&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;empty att="5" /&gt;<br />
&lt;/test&gt;<br />
'</span><span class="keyword">;<br />
<br />
</span><span class="default">$data </span><span class="keyword">= &amp;</span><span class="default">$data1</span><span class="keyword">;<br />
</span><span class="default">$length </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$data1</span><span class="keyword">);<br />
</span><span class="default">$lastchar </span><span class="keyword">= </span><span class="default">$data</span><span class="keyword">[</span><span class="default">$length</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">];<br />
</span><span class="default">xml_parse</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$data1</span><span class="keyword">);<br />
</span><span class="default">$offset </span><span class="keyword">.= </span><span class="default">$length</span><span class="keyword">;<br />
</span><span class="default">$data </span><span class="keyword">= &amp;</span><span class="default">$data2</span><span class="keyword">;<br />
</span><span class="default">xml_parse</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$data2</span><span class="keyword">);</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73189""></a>
  <div class="note">
   <strong class="user">darien at etelos dot com</strong>
   <a href="#73189" class="date">12-Feb-2007 10:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This documentation is somewhat awry. I know it's been said many times before, but it bears repeating...<br />
<br />
If using PHP4, you may be required to use xml_set_object() instead of calling any of the xml_set_*_handler() functions with a two-item array. It will work fine on PHP5, but move the same code to PHP4 and it will create one copie of $this (even if you use &amp;$this) for each handler you set!<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// This code will fail mysteriously on PHP4.<br />
</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">();<br />
</span><span class="default">xml_set_element_handler</span><span class="keyword">(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; array(&amp;</span><span class="default">$this</span><span class="keyword">,</span><span class="string">"start_tag"</span><span class="keyword">),<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; array(&amp;</span><span class="default">$this</span><span class="keyword">,</span><span class="string">"end_tag"</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; );<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_set_character_data_handler</span><span class="keyword">(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; array(&amp;</span><span class="default">$this</span><span class="keyword">,</span><span class="string">"tag_data"</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; );<br />
</span><span class="default">?&gt;<br />
</span><br />
<span class="default">&lt;?php<br />
</span><span class="comment">// This code will work on PHP4.<br />
</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">();<br />
</span><span class="default">xml_set_object</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">,&amp;</span><span class="default">$this</span><span class="keyword">); <br />
</span><span class="default">xml_set_element_handler</span><span class="keyword">(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"start_tag"</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"end_tag"<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_set_character_data_handler</span><span class="keyword">(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"tag_data"<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="70840""></a>
  <div class="note">
   <strong class="user">lloeki at gmail dot com</strong>
   <a href="#70840" class="date">31-Oct-2006 03:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I modified the previous script, so that it is associative. I find it more useful that way. BTW I prefer strtolower() things, but that's not mandatory at all.<br />
<br />
<span class="default">&lt;?php<br />
<br />
$file </span><span class="keyword">= </span><span class="string">"data.xml"</span><span class="keyword">;<br />
</span><span class="default">$depth </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
</span><span class="default">$tree </span><span class="keyword">= array();<br />
</span><span class="default">$tree</span><span class="keyword">[</span><span class="string">'name'</span><span class="keyword">] = </span><span class="string">"root"</span><span class="keyword">;<br />
</span><span class="default">$stack</span><span class="keyword">[] = &amp;</span><span class="default">$tree</span><span class="keyword">;<br />
<br />
function </span><span class="default">startElement</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$name</span><span class="keyword">, </span><span class="default">$attrs</span><span class="keyword">) {<br />
&nbsp;&nbsp; global </span><span class="default">$depth</span><span class="keyword">;<br />
&nbsp;&nbsp; global </span><span class="default">$stack</span><span class="keyword">;<br />
&nbsp;&nbsp; global </span><span class="default">$tree</span><span class="keyword">;<br />
&nbsp; <br />
&nbsp;&nbsp; </span><span class="default">$element </span><span class="keyword">= array();<br />
&nbsp;&nbsp; foreach (</span><span class="default">$attrs </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$element</span><span class="keyword">[</span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">)]=</span><span class="default">$value</span><span class="keyword">;<br />
&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; </span><span class="default">end</span><span class="keyword">(</span><span class="default">$stack</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">$stack</span><span class="keyword">[</span><span class="default">key</span><span class="keyword">(</span><span class="default">$stack</span><span class="keyword">)][</span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">)] = &amp;</span><span class="default">$element</span><span class="keyword">;<br />
&nbsp;&nbsp; </span><span class="default">$stack</span><span class="keyword">[</span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">)] = &amp;</span><span class="default">$element</span><span class="keyword">;<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp; </span><span class="default">$depth</span><span class="keyword">++;<br />
}<br />
<br />
function </span><span class="default">endElement</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$name</span><span class="keyword">) {<br />
&nbsp;&nbsp; global </span><span class="default">$depth</span><span class="keyword">;<br />
&nbsp;&nbsp; global </span><span class="default">$stack</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; </span><span class="default">array_pop</span><span class="keyword">(</span><span class="default">$stack</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">$depth</span><span class="keyword">--;<br />
}<br />
<br />
</span><span class="default">$xml_parser </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">();<br />
</span><span class="default">xml_set_element_handler</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">, </span><span class="string">"startElement"</span><span class="keyword">, </span><span class="string">"endElement"</span><span class="keyword">);<br />
if (!(</span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">))) {<br />
&nbsp;&nbsp; die(</span><span class="string">"could not open XML input"</span><span class="keyword">);<br />
}<br />
<br />
while (</span><span class="default">$data </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">4096</span><span class="keyword">)) {<br />
&nbsp;&nbsp; if (!</span><span class="default">xml_parse</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">, </span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">))) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; die(</span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">"XML error: %s at line %d"</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">xml_error_string</span><span class="keyword">(</span><span class="default">xml_get_error_code</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">)),<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">xml_get_current_line_number</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">)));<br />
&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">);<br />
</span><span class="default">$tree </span><span class="keyword">= </span><span class="default">end</span><span class="keyword">(</span><span class="default">end</span><span class="keyword">(</span><span class="default">$stack</span><span class="keyword">));<br />
echo </span><span class="string">"&lt;pre&gt;"</span><span class="keyword">;<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$tree</span><span class="keyword">);<br />
echo </span><span class="string">"&lt;/pre&gt;"</span><span class="keyword">;<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69284""></a>
  <div class="note">
   <strong class="user">rubentrancoso at gmail dot com</strong>
   <a href="#69284" class="date">29-Aug-2006 01:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
My 25 cents. This example show how to parse a XML in a associative array tree.<br />
<br />
<span class="default">&lt;?php<br />
<br />
$file </span><span class="keyword">= </span><span class="string">"flow/flow.xml"</span><span class="keyword">;<br />
</span><span class="default">$depth </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
</span><span class="default">$tree </span><span class="keyword">= array();<br />
</span><span class="default">$tree</span><span class="keyword">[</span><span class="string">'name'</span><span class="keyword">] = </span><span class="string">"root"</span><span class="keyword">; <br />
</span><span class="default">$stack</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$stack</span><span class="keyword">)] = &amp;</span><span class="default">$tree</span><span class="keyword">;<br />
<br />
function </span><span class="default">startElement</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$name</span><span class="keyword">, </span><span class="default">$attrs</span><span class="keyword">) {<br />
&nbsp;&nbsp; global </span><span class="default">$depth</span><span class="keyword">;<br />
&nbsp;&nbsp; global </span><span class="default">$stack</span><span class="keyword">;<br />
&nbsp;&nbsp; global </span><span class="default">$tree</span><span class="keyword">;<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp; </span><span class="default">$element </span><span class="keyword">= array();<br />
&nbsp;&nbsp; </span><span class="default">$element</span><span class="keyword">[</span><span class="string">'name'</span><span class="keyword">] = </span><span class="default">$name</span><span class="keyword">;<br />
&nbsp;&nbsp; foreach (</span><span class="default">$attrs </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">) { <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//echo $key."=".$value;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$element</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">]=</span><span class="default">$value</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; </span><span class="default">$last </span><span class="keyword">= &amp;</span><span class="default">$stack</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$stack</span><span class="keyword">)-</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp; </span><span class="default">$last</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$last</span><span class="keyword">)-</span><span class="default">1</span><span class="keyword">] = &amp;</span><span class="default">$element</span><span class="keyword">;<br />
&nbsp;&nbsp; </span><span class="default">$stack</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$stack</span><span class="keyword">)] = &amp;</span><span class="default">$element</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; </span><span class="default">$depth</span><span class="keyword">++;<br />
}<br />
<br />
function </span><span class="default">endElement</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$name</span><span class="keyword">) {<br />
&nbsp;&nbsp; global </span><span class="default">$depth</span><span class="keyword">;<br />
&nbsp;&nbsp; global </span><span class="default">$stack</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; </span><span class="default">array_pop</span><span class="keyword">(</span><span class="default">$stack</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">$depth</span><span class="keyword">--;<br />
}<br />
<br />
</span><span class="default">$xml_parser </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">();<br />
</span><span class="default">xml_set_element_handler</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">, </span><span class="string">"startElement"</span><span class="keyword">, </span><span class="string">"endElement"</span><span class="keyword">);<br />
if (!(</span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">))) {<br />
&nbsp;&nbsp; die(</span><span class="string">"could not open XML input"</span><span class="keyword">);<br />
}<br />
<br />
while (</span><span class="default">$data </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">4096</span><span class="keyword">)) {<br />
&nbsp;&nbsp; if (!</span><span class="default">xml_parse</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">, </span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">))) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; die(</span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">"XML error: %s at line %d"</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">xml_error_string</span><span class="keyword">(</span><span class="default">xml_get_error_code</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">)),<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">xml_get_current_line_number</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">)));<br />
&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">);<br />
</span><span class="default">$tree </span><span class="keyword">= </span><span class="default">$stack</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">];<br />
echo </span><span class="string">"&lt;pre&gt;"</span><span class="keyword">;<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$tree</span><span class="keyword">);<br />
echo </span><span class="string">"&lt;/pre&gt;"</span><span class="keyword">;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="66128""></a>
  <div class="note">
   <strong class="user">redb</strong>
   <a href="#66128" class="date">15-May-2006 05:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Example below (BadParser) works fine with some changes.<br />
<br />
xml_set_element_handler ( $parser, array ( &amp;$this, 'tagStart' ), array ( &amp;$this, 'tagEnd' ) );<br />
xml_set_character_data_handler ( $parser, array ( &amp;$this, 'tagContent' ) );</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="59694""></a>
  <div class="note">
   <strong class="user">vladimir-leontiev at uiowa dot edu</strong>
   <a href="#59694" class="date">13-Dec-2005 09:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It seems that characterData() gets characters in chuncks of 1024; therefore if you have string of characters between you tags that is longer than 1024 then characterData() will be called more that once for single pair of tags. I don't know if this feature(bug?) is documented anywhere, I just wanted to warn everyone about this; it had tripped me. I use php 4.3.10 on Linux.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="58893""></a>
  <div class="note">
   <strong class="user">hendra_g at hotmail dot com</strong>
   <a href="#58893" class="date">19-Nov-2005 08:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I ran into the same problem with 'ibjoel at hotmail dot com' in regards to self-closing tags, and found that the script that he/she wrote did not work as I expected.<br />
I played around with some of php's functions and examples and compiled something, which may not be the neatest solution, but it works for the data that 'ibjoel at hotmail dot com' provided.<br />
The data needs to be read from a file though, so the fp can be utilised. It still uses the xml_get_current_byte_index(resource parser) trick, but this time, I check for the last 2 character before the index and test if it's "/&gt;".<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/* myxmltest.xml:<br />
&lt;normal_tag&gt;<br />
&nbsp; &lt;self_close_tag /&gt;<br />
&nbsp;&nbsp; &nbsp; data<br />
&nbsp; &lt;normal_tag&gt;data<br />
&nbsp;&nbsp; &nbsp; &lt;self_close_tag attr="value" /&gt;<br />
&nbsp; &lt;/normal_tag&gt;<br />
&nbsp;&nbsp; &nbsp; data<br />
&nbsp; &lt;normal_tag&gt;&lt;/normal_tag&gt;<br />
&lt;/normal_tag&gt;<br />
*/<br />
<br />
//## Global Variables ##//<br />
</span><span class="default">$file </span><span class="keyword">= </span><span class="string">"myxmltest.xml"</span><span class="keyword">;<br />
</span><span class="default">$character_data_on </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
</span><span class="default">$tag_complete </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />
<br />
function </span><span class="default">startElement</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$name</span><span class="keyword">, </span><span class="default">$attrs</span><span class="keyword">) <br />
{<br />
&nbsp;&nbsp;&nbsp; global </span><span class="default">$character_data_on</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; global </span><span class="default">$tag_complete</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"&amp;lt;&lt;font color=\"#0000cc\"&gt;</span><span class="default">$name</span><span class="string">&lt;/font&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//## Print the attributes ##//<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">sizeof</span><span class="keyword">(</span><span class="default">$attrs</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while (list(</span><span class="default">$k</span><span class="keyword">, </span><span class="default">$v</span><span class="keyword">) = </span><span class="default">each</span><span class="keyword">(</span><span class="default">$attrs</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">" &lt;font color=\"#009900\"&gt;</span><span class="default">$k</span><span class="string">&lt;/font&gt;=\"&lt;font <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; color=\"#990000\"&gt;</span><span class="default">$v</span><span class="string">&lt;/font&gt;\""</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//## Tag is still still incomplete,<br />
&nbsp;&nbsp;&nbsp; //## will be completed at either endElement or characterData ##//<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$tag_complete </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$character_data_on </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
}<br />
<br />
function </span><span class="default">endElement</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$name</span><span class="keyword">) <br />
{<br />
&nbsp;&nbsp;&nbsp; global </span><span class="default">$fp</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; global </span><span class="default">$character_data_on</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; global </span><span class="default">$tag_complete</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//#### Test for self-closing tag ####//<br />
&nbsp;&nbsp;&nbsp; //## xml_get_current_byte_index(resource parser) when run in this<br />
&nbsp;&nbsp;&nbsp; //## function, gives the index at (indicated by *):<br />
&nbsp;&nbsp;&nbsp; //##&nbsp;&nbsp; for self closing tag: &lt;br /&gt;*<br />
&nbsp;&nbsp;&nbsp; //##&nbsp;&nbsp; for individual closing tag: &lt;div&gt;character data*&lt;/div&gt;<br />
&nbsp;&nbsp;&nbsp; //## So to test for self-closing tag, we can just test for the last 2 <br />
&nbsp;&nbsp;&nbsp; //## characters from the index<br />
&nbsp;&nbsp;&nbsp; //###################################//<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (!</span><span class="default">$character_data_on</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//## Record current fp position ##//<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$temp_fp </span><span class="keyword">= </span><span class="default">ftell</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//## Point fp to 2 bytes before the end element byte index ##//<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$end_element_byte_index </span><span class="keyword">= </span><span class="default">xml_get_current_byte_index</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fseek</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">,</span><span class="default">$end_element_byte_index</span><span class="keyword">-</span><span class="default">2</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//## Gets the last 2 characters before the end element byte index ##//<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$validator </span><span class="keyword">= </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//## Restore fp position ##//<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fseek</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">,</span><span class="default">$temp_fp</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//## If the last 2 character is "/&gt;" ##//<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$validator</span><span class="keyword">==</span><span class="string">"/&gt;"</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//// Complete the self-closing tag ////<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">echo </span><span class="string">" /&amp;gt"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//// Otherwise it is an individual closing tag ////<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">} else echo </span><span class="string">"&amp;gt&amp;lt/&lt;font color=\"#0000cc\"&gt;</span><span class="default">$name</span><span class="string">&lt;/font&gt;&amp;gt"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tag_complete </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; } else echo </span><span class="string">"&amp;lt/&lt;font color=\"#0000cc\"&gt;</span><span class="default">$name</span><span class="string">&lt;/font&gt;&amp;gt"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$character_data_on </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
}<br />
<br />
function </span><span class="default">characterData</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">) <br />
{<br />
&nbsp;&nbsp;&nbsp; global </span><span class="default">$character_data_on</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; global </span><span class="default">$tag_complete</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; if ((!</span><span class="default">$character_data_on</span><span class="keyword">)&amp;&amp;(!</span><span class="default">$tag_complete</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"&amp;gt"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tag_complete </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"&lt;b&gt;</span><span class="default">$data</span><span class="string">&lt;/b&gt;"</span><span class="keyword">; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$character_data_on </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">$xml_parser </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">();<br />
</span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">, </span><span class="default">XML_OPTION_CASE_FOLDING</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br />
</span><span class="default">xml_set_element_handler</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">, </span><span class="string">"startElement"</span><span class="keyword">, </span><span class="string">"endElement"</span><span class="keyword">);<br />
</span><span class="default">xml_set_character_data_handler</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">, </span><span class="string">"characterData"</span><span class="keyword">);<br />
if (!(</span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">))) {<br />
&nbsp;&nbsp;&nbsp; die(</span><span class="string">"could not open XML input"</span><span class="keyword">);<br />
}<br />
<br />
echo </span><span class="string">"&lt;pre&gt;"</span><span class="keyword">;<br />
while (</span><span class="default">$file_content </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">4096</span><span class="keyword">)) {<br />
&nbsp;&nbsp;&nbsp; if (!</span><span class="default">xml_parse</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">, </span><span class="default">$file_content</span><span class="keyword">, </span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">))) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; die(</span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">"XML error: %s at line %d"</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_error_string</span><span class="keyword">(</span><span class="default">xml_get_error_code</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">)),<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_get_current_line_number</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">)));<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
echo </span><span class="string">"&lt;/pre&gt;"</span><span class="keyword">;<br />
</span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="56955""></a>
  <div class="note">
   <strong class="user">turan dot yuksel at tcmb dot gov dot tr</strong>
   <a href="#56955" class="date">20-Sep-2005 03:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The method that 'ibjoel at hotmail dot com' have described requires libxml2 as the xml parser, it does not work with expat. For a brief explanation, see xml_get_current_byte_index.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="55360""></a>
  <div class="note">
   <strong class="user">ibjoel at hotmail dot com</strong>
   <a href="#55360" class="date">01-Aug-2005 03:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I noticed that in the example below, and all the examples I've seen on this site for viewing xml in html, the look of self closing tags such as &lt;br /&gt; are not preserved. The parser cannot distinguish between &lt;tag /&gt; and &lt;tag&gt;&lt;/tag&gt;, and if your start and end element functions are like these examples, both instances will be output with both an indvidual start and end tag.&nbsp; I needed to preserve self-closing tags and it took me a while to figure out this work around. Hope this helps someone...<br />
&nbsp; <br />
The start tag is left open, and then completed by it's first child, the next start tag or its end tag.&nbsp; The end tag will complete with " /&gt;", or &lt;/tag&gt; depending on the number of bytes between the start and end tags in the parsed data.<br />
<span class="default">&lt;?php<br />
</span><span class="comment">//$data=filepath or string<br />
</span><span class="default">$data</span><span class="keyword">=&lt;&lt;&lt;DATA<br />
</span><span class="string">&lt;normal_tag&gt;<br />
&nbsp; &lt;self_close_tag /&gt;<br />
&nbsp;&nbsp; &nbsp;&nbsp; data<br />
&nbsp; &lt;normal_tag&gt;data<br />
&nbsp;&nbsp; &nbsp; &lt;self_close_tag attr="value" /&gt;<br />
&nbsp; &lt;/normal_tag&gt;<br />
&nbsp;&nbsp; &nbsp;&nbsp; data<br />
&nbsp; &lt;normal_tag&gt;&lt;/normal_tag&gt;<br />
&lt;/normal_tag&gt;<br />
</span><span class="keyword">DATA;<br />
<br />
function </span><span class="default">startElement</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$name</span><span class="keyword">, </span><span class="default">$attrs</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_set_character_data_handler</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="string">"characterData"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; global </span><span class="default">$first_child</span><span class="keyword">, </span><span class="default">$start_byte</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$first_child</span><span class="keyword">)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">//close start tag if neccessary<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">echo </span><span class="string">"&gt;&lt;br /&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$first_child</span><span class="keyword">=</span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$start_byte</span><span class="keyword">=</span><span class="default">xml_get_current_byte_index </span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">count</span><span class="keyword">(</span><span class="default">$attrs</span><span class="keyword">)&gt;=</span><span class="default">1</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$attrs </span><span class="keyword">as </span><span class="default">$x</span><span class="keyword">=&gt;</span><span class="default">$y</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$attr_string </span><span class="keyword">.= </span><span class="string">" </span><span class="default">$x</span><span class="string">=\"</span><span class="default">$y</span><span class="string">\""</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">htmlentities</span><span class="keyword">(</span><span class="string">"&lt;</span><span class="keyword">{</span><span class="default">$name</span><span class="keyword">}{</span><span class="default">$attr_string</span><span class="keyword">}</span><span class="string">"</span><span class="keyword">); </span><span class="comment">//unclosed starttag<br />
</span><span class="keyword">}<br />
<br />
function </span><span class="default">endElement</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$name</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; global </span><span class="default">$first_child</span><span class="keyword">, </span><span class="default">$start_byte</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$byte</span><span class="keyword">=</span><span class="default">xml_get_current_byte_index </span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$byte</span><span class="keyword">-</span><span class="default">$start_byte</span><span class="keyword">&gt;</span><span class="default">2</span><span class="keyword">){&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//if end tag is more than 2 bytes from start tag<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">$first_child</span><span class="keyword">)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">//close start tag if neccessary<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">echo </span><span class="string">"&gt;&lt;br /&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">htmlentities</span><span class="keyword">(</span><span class="string">"&lt;/</span><span class="keyword">{</span><span class="default">$name</span><span class="keyword">}</span><span class="string">&gt;"</span><span class="keyword">).</span><span class="string">"&lt;br /&gt;"</span><span class="keyword">;&nbsp; </span><span class="comment">//individual end tag<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">}else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">" /&gt;&lt;br /&gt;"</span><span class="keyword">;&nbsp; </span><span class="comment">// self closing tag<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$first_child</span><span class="keyword">=</span><span class="default">false</span><span class="keyword">;<br />
<br />
}<br />
<br />
function </span><span class="default">characterData</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; global </span><span class="default">$first_child</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$first_child</span><span class="keyword">)&nbsp; </span><span class="comment">//if $data is first child, close start tag<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">echo </span><span class="string">"&gt;&lt;br /&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$data</span><span class="keyword">=</span><span class="default">trim</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"&lt;font color='blue'&gt;</span><span class="default">$data</span><span class="string">&lt;/font&gt;&lt;br /&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$first_child</span><span class="keyword">=</span><span class="default">false</span><span class="keyword">;<br />
}<br />
<br />
function </span><span class="default">ParseData</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$xml_parser </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_set_element_handler</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">, </span><span class="string">"startElement"</span><span class="keyword">, </span><span class="string">"endElement"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">,</span><span class="default">XML_OPTION_CASE_FOLDING</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">is_file</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!(</span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">))) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; die(</span><span class="string">"could not open XML input"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; while (</span><span class="default">$data </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">4096</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">xml_parse</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">, </span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">))) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$error</span><span class="keyword">=</span><span class="default">xml_error_string</span><span class="keyword">(</span><span class="default">xml_get_error_code</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$line</span><span class="keyword">=</span><span class="default">xml_get_current_line_number</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; die(</span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">"XML error: %s at line %d"</span><span class="keyword">,</span><span class="default">$error</span><span class="keyword">,</span><span class="default">$line</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }else{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">xml_parse</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$error</span><span class="keyword">=</span><span class="default">xml_error_string</span><span class="keyword">(</span><span class="default">xml_get_error_code</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$line</span><span class="keyword">=</span><span class="default">xml_get_current_line_number</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; die(</span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">"XML error: %s at line %d"</span><span class="keyword">,</span><span class="default">$error</span><span class="keyword">,</span><span class="default">$line</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">ParseData</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="52420""></a>
  <div class="note">
   <strong class="user">youniforever at naver dot com</strong>
   <a href="#52420" class="date">30-Apr-2005 03:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
&lt;html&gt; <br />
&nbsp; &lt;head&gt; <br />
&nbsp;&nbsp;&nbsp; &lt;title&gt;SAX Demonstration&lt;/title&gt; <br />
&nbsp;&nbsp; &lt;META HTTP-EQUIV='Content-type' CONTENT='text/html; charset=euc-kr'&gt; <br />
&nbsp; &lt;/head&gt; <br />
&nbsp; &lt;body&gt; <br />
&nbsp;&nbsp;&nbsp; &lt;h1&gt;RSS ??????&lt;/h1&gt; <br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp;&nbsp; <span class="default">&lt;?php <br />
<br />
&nbsp;&nbsp; &nbsp; $file </span><span class="keyword">= </span><span class="string">"data.xml"</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$currentTag </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$currentAttribs </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">; <br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; function </span><span class="default">startElement</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$name</span><span class="keyword">, </span><span class="default">$attribs</span><span class="keyword">) <br />
&nbsp;&nbsp; &nbsp;&nbsp; { <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; global </span><span class="default">$currentTag</span><span class="keyword">, </span><span class="default">$currentAttribs</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$currentTag </span><span class="keyword">= </span><span class="default">$name</span><span class="keyword">; <br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$currentAttribs </span><span class="keyword">= </span><span class="default">$attribs</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; switch (</span><span class="default">$name</span><span class="keyword">) { <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; default: <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo(</span><span class="string">"&lt;b&gt;&amp;lt</span><span class="default">$name</span><span class="string">&amp;gt&lt;/b&gt;&lt;br&gt;"</span><span class="keyword">); <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } <br />
&nbsp;&nbsp; &nbsp;&nbsp; } <br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; function </span><span class="default">endElement</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$name</span><span class="keyword">) <br />
&nbsp;&nbsp; &nbsp;&nbsp; { <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; global </span><span class="default">$currentTag</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; switch (</span><span class="default">$name</span><span class="keyword">) { <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; default: <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo(</span><span class="string">"&lt;br&gt;&lt;b&gt;&amp;lt/</span><span class="default">$name</span><span class="string">&amp;gt&lt;/b&gt;&lt;br&gt;&lt;br&gt;"</span><span class="keyword">); <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$currentTag </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$currentAttribs </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp;&nbsp; } <br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; function </span><span class="default">characterData</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">) <br />
&nbsp;&nbsp; &nbsp;&nbsp; { <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; global </span><span class="default">$currentTag</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; switch (</span><span class="default">$currentTag</span><span class="keyword">) { <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">"link"</span><span class="keyword">: <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo(</span><span class="string">"&lt;a href=\"</span><span class="default">$data</span><span class="string">\"&gt;</span><span class="default">$data</span><span class="string">&lt;/a&gt;\n"</span><span class="keyword">); <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">"title"</span><span class="keyword">: <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo(</span><span class="string">"title : </span><span class="default">$data</span><span class="string">"</span><span class="keyword">); <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; default: <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo(</span><span class="default">$data</span><span class="keyword">); <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } <br />
&nbsp;&nbsp; &nbsp;&nbsp; } <br />
<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$xmlParser </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">(); <br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$caseFold </span><span class="keyword">= </span><span class="default">xml_parser_get_option</span><span class="keyword">(</span><span class="default">$xmlParser</span><span class="keyword">, <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">XML_OPTION_CASE_FOLDING</span><span class="keyword">); <br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$targetEncoding </span><span class="keyword">= </span><span class="default">xml_parser_get_option</span><span class="keyword">(</span><span class="default">$xmlParser</span><span class="keyword">, <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">XML_OPTION_TARGET_ENCODING</span><span class="keyword">); <br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (</span><span class="default">$caseFold </span><span class="keyword">== </span><span class="default">1</span><span class="keyword">) { <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$xmlParser</span><span class="keyword">, </span><span class="default">XML_OPTION_CASE_FOLDING</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">); <br />
&nbsp;&nbsp; &nbsp;&nbsp; } <br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">xml_set_element_handler</span><span class="keyword">(</span><span class="default">$xmlParser</span><span class="keyword">, </span><span class="string">"startElement"</span><span class="keyword">, </span><span class="string">"endElement"</span><span class="keyword">); <br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">xml_set_character_data_handler</span><span class="keyword">(</span><span class="default">$xmlParser</span><span class="keyword">, </span><span class="string">"characterData"</span><span class="keyword">); <br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (!(</span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">))) { <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; die(</span><span class="string">"Cannot open XML data file: </span><span class="default">$file</span><span class="string">"</span><span class="keyword">); <br />
&nbsp;&nbsp; &nbsp;&nbsp; } <br />
<br />
&nbsp;&nbsp; &nbsp; while (</span><span class="default">$data </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">4096</span><span class="keyword">)) { <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">xml_parse</span><span class="keyword">(</span><span class="default">$xmlParser</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">, </span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">))) { <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; die(</span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">"XML error: %s at line %d"</span><span class="keyword">, <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_error_string</span><span class="keyword">(</span><span class="default">xml_get_error_code</span><span class="keyword">(</span><span class="default">$xmlParser</span><span class="keyword">)), <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_get_current_line_number</span><span class="keyword">(</span><span class="default">$xmlParser</span><span class="keyword">))); <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$xmlParser</span><span class="keyword">); <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } <br />
&nbsp;&nbsp; &nbsp;&nbsp; } <br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$xmlParser</span><span class="keyword">); <br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">?&gt;</span> <br />
&nbsp;&nbsp;&nbsp; &lt;/table&gt; <br />
&nbsp; &lt;/body&gt; <br />
&lt;/html&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="50906""></a>
  <div class="note">
   
   <a href="#50906" class="date">13-Mar-2005 01:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In response to aw at avatartechnology dot com...<br />
In response to landb at mail dot net...<br />
<br />
When your functions are in an object:<br />
Careful ! Don't forget to add: &amp; (reference) to your parameters.<br />
<br />
xml_set_element_handler($parser, array(&amp;$this,"_startElement"), array(&amp;$this,"_endElement"));<br />
--&gt; xmlparse will work on your object (good).<br />
<br />
instead of:<br />
xml_set_element_handler($parser, array($this,"_startElement"), array($this,"_endElement"));<br />
---&gt; xmlparse will work on a COPY of your object (often bad)<br />
<br />
Vin-s<br />
(sorry for my english)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="46731""></a>
  <div class="note">
   <strong class="user">aw at avatartechnology dot com</strong>
   <a href="#46731" class="date">21-Oct-2004 08:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In response to landb at mail dot net...<br />
<br />
As the notes mention, you can pass an array that contains the reference to an object and a method name when you need... so you can call methods in your own class as handlers like this:<br />
<br />
xml_set_element_handler($parser, array($this,"_startElement"), array($this,"_endElement"));<br />
<br />
Hope it helps...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="29053""></a>
  <div class="note">
   <strong class="user">tj at tobyjoe dot com</strong>
   <a href="#29053" class="date">31-Jan-2003 11:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It seems that the tag handlers don't block on one another (the end handler is called whether or not the begin handler has finished). this can put you in a tight spot if you don't realize it while planning your app.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="15985""></a>
  <div class="note">
   
   <a href="#15985" class="date">11-Oct-2001 04:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You CAN use classes to parse XML. Just take a look at the following function:
<br />

<br />
xml_set_object</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="12782""></a>
  <div class="note">
   <strong class="user">jg at jmkg dot net</strong>
   <a href="#12782" class="date">07-May-2001 11:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are using a class for xml parsing, and want to check the return value of xml_set_element_handler in case it&nbsp; fails, you must do this outside of the class's constructor. Inside the constructor, PHP-4.0.5 will die.
<br />

<br />
Basically, put all your xml initialisation code in another function of the class, and keep it out of the constructor.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
