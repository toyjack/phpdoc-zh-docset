<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>解析 CSV 字符串为一个数组</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.sscanf.html">? sscanf</a></li>
      <li style="float: right;"><a href="function.str-ireplace.html">str_ireplace ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.strings.html">字符串 函数</a></li>
    <li>解析 CSV 字符串为一个数组</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.str-getcsv" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">str_getcsv</h1>
  <p class="verinfo">(PHP 5 &gt;= 5.3.0, PHP 7)</p><p class="refpurpose"><span class="refname">str_getcsv</span> &mdash; <span class="dc-title">
   解析 CSV 字符串为一个数组
  </span></p>

 </div>

 <div class="refsect1 description" id="refsect1-function.str-getcsv-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>str_getcsv</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$input</code></span>
   [, <span class="methodparam"><span class="type">string</span> <code class="parameter">$delimiter</code><span class="initializer"> = &quot;,&quot;</span></span>
   [, <span class="methodparam"><span class="type">string</span> <code class="parameter">$enclosure</code><span class="initializer"> = &#039;&quot;&#039;</span></span>
   [, <span class="methodparam"><span class="type">string</span> <code class="parameter">$escape</code><span class="initializer"> = &quot;\\&quot;</span></span>
  ]]] ) : <span class="type">array</span></div>

  <p class="para rdfs-comment">
   以 <acronym title="Comma Separated Value">CSV</acronym> 字段格式解析字符串输入，并返回包含读取字段的数组。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.str-getcsv-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">input</code></dt>

     <dd>

      <p class="para">
       待解析的字符串。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">delimiter</code></dt>

     <dd>

      <p class="para">
       设定字段界定符（仅单个字符）。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">enclosure</code></dt>

     <dd>

      <p class="para">
       设定字段包裹字符（仅单个字符）。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">escape</code></dt>

     <dd>

      <p class="para">
       设置转义字符（仅单个字符）。默认为反斜线（<em>\</em>）。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.str-getcsv-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   返回一个包含读取到的字段的索引数组。
  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.str-getcsv-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.fgetcsv.html" class="function" rel="rdfs-seeAlso">fgetcsv()</a> - 从文件指针中读入一行并解析 CSV 字段</span></li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="124237""></a>
  <div class="note">
   <strong class="user">r dot borjovsky at gmail dot com</strong>
   <a href="#124237" class="date">26-Sep-2019 11:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Improving James' line, now allowing to set the delimiter.<br />
<br />
$csv = array_map(function($v){return str_getcsv($v, ';');}, file('data.csv'));</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="123029""></a>
  <div class="note">
   <strong class="user">sunilp dot coderevolts at gmail dot com</strong>
   <a href="#123029" class="date">14-Aug-2018 08:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hello,<br />
<br />
I want to set formula in csv file using php code . When I download csv file formula should be inserted (data from databse) and when we put column values then values should be calculated as per the formula.<br />
<br />
Anyone help me.<br />
<br />
Thanks.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="121412""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#121412" class="date">21-Jul-2017 05:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
public function csv_to_array($filename = '', $delimiter = ',', $boolean_include_title_row = false, $field_names = array()){<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; try {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!file_exists($filename) || !is_readable($filename)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return false;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (is_array($field_names) &amp;&amp; !empty($field_names)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $header = $field_names;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } elseif (is_string($field_names) &amp;&amp; (strlen($field_names) &gt; 0)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $header = explode(",", $field_names);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $header = null;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $csv = array_map('str_getcsv', file($filename));<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $data = array();<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach ($csv as $key =&gt; $row) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $data[] = array_combine($header, $row);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!$boolean_include_title_row) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; unset($data[0]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $data = array_values($data);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return $data;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } catch (Exception $e) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return false;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; }</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="120361""></a>
  <div class="note">
   <strong class="user">Xkang</strong>
   <a href="#120361" class="date">21-Dec-2016 01:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
how to solve the UTF-8 BOM's problem<br />
如何处理UTF-8编码的CSV文件中的BOM问题<br />
$bom =( chr(0xEF) . chr(0xBB) . chr(0xBF) ); //define bom<br />
$f = file_get_contents('a.csv'); //open the CSV file<br />
#$csv = str_getcsv($f); //it will have bom&nbsp; 这样会出现bom的问题<br />
$csv = str_getcsv(str_replace($bom,'',$f)); //replace the bom 替换掉bom<br />
var_dump($csv);&nbsp; //dump 输出</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="117692""></a>
  <div class="note">
   <strong class="user">starrychloe at oliveyou dot net</strong>
   <a href="#117692" class="date">23-Jul-2015 06:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Based on James' line, this will create an array of associative arrays with the first row column headers as the keys.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; $csv </span><span class="keyword">= </span><span class="default">array_map</span><span class="keyword">(</span><span class="string">'str_getcsv'</span><span class="keyword">, </span><span class="default">file</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">array_walk</span><span class="keyword">(</span><span class="default">$csv</span><span class="keyword">, function(&amp;</span><span class="default">$a</span><span class="keyword">) use (</span><span class="default">$csv</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$a </span><span class="keyword">= </span><span class="default">array_combine</span><span class="keyword">(</span><span class="default">$csv</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="default">$a</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; });<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">array_shift</span><span class="keyword">(</span><span class="default">$csv</span><span class="keyword">); </span><span class="comment"># remove column header<br />
</span><span class="default">?&gt;</span> <br />
<br />
This will yield something like<br />
&nbsp;&nbsp;&nbsp; [2] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [Campaign ID] =&gt; 295095038<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [Ad group ID] =&gt; 22460178158<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [Keyword ID] =&gt; 3993587178</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="117585""></a>
  <div class="note">
   <strong class="user">peter dot mlich at volny dot cz</strong>
   <a href="#117585" class="date">02-Jul-2015 10:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
&gt; 49 durik at 3ilab dot net /&nbsp; 4 years ago<br />
$rows = str_getcsv($csv_data, "\n");<br />
- bug, data in csv can have "\n"<br />
'aaa','bb<br />
b','ccc'</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="117366""></a>
  <div class="note">
   <strong class="user">pasmanik at gmail dot com</strong>
   <a href="#117366" class="date">28-May-2015 08:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I prepared some better function for parsing CSV string.<br />
<br />
function csv_to_array($string='', $row_delimiter=PHP_EOL, $delimiter = "," , $enclosure = '"' , $escape = "\\" )<br />
{<br />
&nbsp;&nbsp;&nbsp; $rows = array_filter(explode($row_delimiter, $string));<br />
&nbsp;&nbsp;&nbsp; $header = NULL;<br />
&nbsp;&nbsp;&nbsp; $data = array();<br />
<br />
&nbsp;&nbsp;&nbsp; foreach($rows as $row)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $row = str_getcsv ($row, $delimiter, $enclosure , $escape);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(!$header)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $header = $row;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $data[] = array_combine($header, $row);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; return $data;<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="117230""></a>
  <div class="note">
   <strong class="user">csver at phper dot com</strong>
   <a href="#117230" class="date">06-May-2015 10:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Quick and proper way:<br />
<br />
&nbsp;&nbsp;&nbsp; $temp = fopen('php://temp', 'r+');<br />
&nbsp;&nbsp;&nbsp; fputs($csvString, $temp);<br />
&nbsp;&nbsp;&nbsp; rewind($temp);<br />
<br />
&nbsp;&nbsp;&nbsp; $csvArray = array();<br />
<br />
&nbsp;&nbsp;&nbsp; while( $csvRow = fgetcsv($temp) )<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $csvArray[] = $csvRow;<br />
&nbsp;&nbsp;&nbsp; fclose($temp);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="116763""></a>
  <div class="note">
   <strong class="user">sven at e7o dot de</strong>
   <a href="#116763" class="date">24-Feb-2015 02:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
PHP is failing when parsing UTF-8 with Byte Order Mark. Strip it with this one from string before passing it to csv parser:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $bom </span><span class="keyword">= </span><span class="default">pack</span><span class="keyword">(</span><span class="string">'CCC'</span><span class="keyword">, </span><span class="default">0xEF</span><span class="keyword">, </span><span class="default">0xBB</span><span class="keyword">, </span><span class="default">0xBF</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">strncmp</span><span class="keyword">(</span><span class="default">$yourString</span><span class="keyword">, </span><span class="default">$bom</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">) === </span><span class="default">0</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$body </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$yourString</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="116688""></a>
  <div class="note">
   <strong class="user">okonomiyaki3000 at gmail dot com</strong>
   <a href="#116688" class="date">12-Feb-2015 10:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
`durik at 3ilab dot net` brings up a good point but the solution provided may fail in certain (very rare) edge cases. I believe a more perfect solution is as follows:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// Use an I/O stream instead of an actual file.<br />
</span><span class="default">$handle </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="string">'php://temp/myCSV'</span><span class="keyword">, </span><span class="string">'w+b'</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Write all the data to it<br />
</span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="default">$CSVString</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Rewind for reading<br />
</span><span class="default">rewind</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">);<br />
<br />
</span><span class="comment">// use fgetcsv which tends to work better than str_getcsv in some cases<br />
</span><span class="default">$rows </span><span class="keyword">= array();<br />
while (</span><span class="default">$row </span><span class="keyword">= </span><span class="default">fgetcsv</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">)) </span><span class="default">$rows</span><span class="keyword">[] = </span><span class="default">$row</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
A variation on this technique can also be used to implement an 'str_putcsv' which PHP lacks.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="115776""></a>
  <div class="note">
   <strong class="user">dejiakala at gmail dot com</strong>
   <a href="#115776" class="date">21-Sep-2014 06:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I wanted the best of the 2 solutions by james at moss dot io and Jay Williams (csv_to_array()) - create associative array from a CSV file with a header row.<br />
<br />
<span class="default">&lt;?php<br />
<br />
$array </span><span class="keyword">= </span><span class="default">array_map</span><span class="keyword">(</span><span class="string">'str_getcsv'</span><span class="keyword">, </span><span class="default">file</span><span class="keyword">(</span><span class="string">'data.csv'</span><span class="keyword">));<br />
<br />
</span><span class="default">$header </span><span class="keyword">= </span><span class="default">array_shift</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">);<br />
<br />
</span><span class="default">array_walk</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">, </span><span class="string">'_combine_array'</span><span class="keyword">, </span><span class="default">$header</span><span class="keyword">);<br />
<br />
function </span><span class="default">_combine_array</span><span class="keyword">(&amp;</span><span class="default">$row</span><span class="keyword">, </span><span class="default">$key</span><span class="keyword">, </span><span class="default">$header</span><span class="keyword">) {<br />
&nbsp; </span><span class="default">$row </span><span class="keyword">= </span><span class="default">array_combine</span><span class="keyword">(</span><span class="default">$header</span><span class="keyword">, </span><span class="default">$row</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Then I thought why not try some benchmarking? I grabbed a sample CSV file with 50,000 rows (10 columns each) and Vulcan Logic Disassembler (VLD) which hooks into the Zend Engine and dumps all the opcodes (execution units) of a script - see <a href="http://pecl.php.net/package/vld and example here: http://fabien.potencier.org/article/8/print-vs-echo-which-one-is-faster" rel="nofollow" target="_blank">http://pecl.php.net/package/vld and example here: http://fabien.potencier.org/article/8/print-vs-echo-which-one-is-faster</a><br />
<br />
Result: <br />
<br />
array_walk() and array_map() - 39 opcodes<br />
csv_to_array() - 69 opcodes</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="115656""></a>
  <div class="note">
   <strong class="user">enmanuelcorvo at gmail dot com</strong>
   <a href="#115656" class="date">02-Sep-2014 08:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I always use this:<br />
<br />
function convert_to_csv($input_array, $output_file_name, $delimiter)<br />
{<br />
&nbsp;&nbsp;&nbsp; /** open raw memory as file, no need for temp files */<br />
&nbsp;&nbsp;&nbsp; $temp_memory = fopen('php://memory', 'w');<br />
&nbsp;&nbsp;&nbsp; /** loop through array */<br />
&nbsp;&nbsp;&nbsp; foreach ($input_array as $line) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; /** default php csv handler **/<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; fputcsv($temp_memory, $line, $delimiter);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; /** rewrind the "file" with the csv lines **/<br />
&nbsp;&nbsp;&nbsp; fseek($temp_memory, 0);<br />
&nbsp;&nbsp;&nbsp; /** modify header to be downloadable csv file **/<br />
&nbsp;&nbsp;&nbsp; header('Content-Type: application/csv');<br />
&nbsp;&nbsp;&nbsp; header('Content-Disposition: attachement; filename="' . $output_file_name . '";');<br />
&nbsp;&nbsp;&nbsp; /** Send file to browser for download */<br />
&nbsp;&nbsp;&nbsp; fpassthru($temp_memory);<br />
}<br />
<br />
/** Array to convert to csv */<br />
$array_to_csv = Array(Array(12566, 'Enmanuel', 'Corvo'), Array(56544, 'John', 'Doe'), Array(78550, 'Mark', 'Smith'));<br />
convert_to_csv($array_to_csv, 'report.csv', ',');<br />
<br />
you can read the full post here:<br />
<br />
&lt;a href="<a href="http://webtricksandtreats.com/export-to-csv-php/" rel="nofollow" target="_blank">http://webtricksandtreats.com/export-to-csv-php/</a>"&gt;PHP to CSV&nbsp; Download &lt;/a&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="114764""></a>
  <div class="note">
   <strong class="user">james at moss dot io</strong>
   <a href="#114764" class="date">03-Apr-2014 10:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
[Editor's Note (cmb): that does not produce the desired results, if fields contain linebreaks.]
<br />

<br />
Handy one liner to parse a CSV file into an array
<br />

<br />
<span class="default">&lt;?php
<br />

<br />
$csv </span><span class="keyword">= </span><span class="default">array_map</span><span class="keyword">(</span><span class="string">'str_getcsv'</span><span class="keyword">, </span><span class="default">file</span><span class="keyword">(</span><span class="string">'data.csv'</span><span class="keyword">));
<br />

<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="114684""></a>
  <div class="note">
   <strong class="user">peter at icb dot at</strong>
   <a href="#114684" class="date">21-Mar-2014 05:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Optimized JayWilliams function a little bit:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">csv_to_array</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">, </span><span class="default">$delimiter</span><span class="keyword">=</span><span class="string">','</span><span class="keyword">, </span><span class="default">$enclosure</span><span class="keyword">=</span><span class="string">'"'</span><span class="keyword">, </span><span class="default">$escape </span><span class="keyword">= </span><span class="string">'\\'</span><span class="keyword">)<br />
{<br />
&nbsp; if(!</span><span class="default">file_exists</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">) || !</span><span class="default">is_readable</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">)) return </span><span class="default">false</span><span class="keyword">;<br />
<br />
&nbsp; </span><span class="default">$header </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$data </span><span class="keyword">= array();<br />
&nbsp; </span><span class="default">$lines </span><span class="keyword">= </span><span class="default">file</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">);<br />
<br />
&nbsp; foreach(</span><span class="default">$lines </span><span class="keyword">as </span><span class="default">$line</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$values </span><span class="keyword">= </span><span class="default">str_getcsv</span><span class="keyword">(</span><span class="default">$line</span><span class="keyword">, </span><span class="default">$delimiter</span><span class="keyword">, </span><span class="default">$enclosure</span><span class="keyword">, </span><span class="default">$escape</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if(!</span><span class="default">$header</span><span class="keyword">) </span><span class="default">$header </span><span class="keyword">= </span><span class="default">$values</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; else </span><span class="default">$data</span><span class="keyword">[] = </span><span class="default">array_combine</span><span class="keyword">(</span><span class="default">$header</span><span class="keyword">, </span><span class="default">$values</span><span class="keyword">);<br />
&nbsp; }<br />
<br />
&nbsp; return </span><span class="default">$data</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="114345""></a>
  <div class="note">
   <strong class="user">lewis</strong>
   <a href="#114345" class="date">11-Feb-2014 01:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
str_getcsv can be really fussy about trailing spaces - it will not necessarily recognise a final element in a quote delimited set of strings with a space following the final string for example. Using trim() before str_getcsv() quickly fixes this.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="113220""></a>
  <div class="note">
   <strong class="user">Ryan Rubley</strong>
   <a href="#113220" class="date">13-Sep-2013 08:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
@normadize - that is a nice start, but it fails on situations where a field is empty but quoted (returning a string with one double quote instead of an empty string) and cases like """""foo""""" that should result in ""foo"" but instead return "foo". I also get a row with 1 empty field at the end because of the final CRLF in the CSV. Plus, I don't really like the !!Q!! magic or urlencoding to get around things. Also, \R doesn't work in pcre on any of my php installations.<br />
<br />
Here is my take on this, without anonymous functions (so it works on PHP &lt; 5.3), and without your options (because I believe the only correct way to parse according to the RFC would be $skip_empty_lines = false and $trim_fields = false).<br />
<br />
//parse a CSV file into a two-dimensional array<br />
//this seems as simple as splitting a string by lines and commas, but this only works if tricks are performed<br />
//to ensure that you do NOT split on lines and commas that are inside of double quotes.<br />
function parse_csv($str)<br />
{<br />
&nbsp;&nbsp;&nbsp; //match all the non-quoted text and one series of quoted text (or the end of the string)<br />
&nbsp;&nbsp;&nbsp; //each group of matches will be parsed with the callback, with $matches[1] containing all the non-quoted text,<br />
&nbsp;&nbsp;&nbsp; //and $matches[3] containing everything inside the quotes<br />
&nbsp;&nbsp;&nbsp; $str = preg_replace_callback('/([^"]*)("((""|[^"])*)"|$)/s', 'parse_csv_quotes', $str);<br />
<br />
&nbsp;&nbsp;&nbsp; //remove the very last newline to prevent a 0-field array for the last line<br />
&nbsp;&nbsp;&nbsp; $str = preg_replace('/\n$/', '', $str);<br />
<br />
&nbsp;&nbsp;&nbsp; //split on LF and parse each line with a callback<br />
&nbsp;&nbsp;&nbsp; return array_map('parse_csv_line', explode("\n", $str));<br />
}<br />
<br />
//replace all the csv-special characters inside double quotes with markers using an escape sequence<br />
function parse_csv_quotes($matches)<br />
{<br />
&nbsp;&nbsp;&nbsp; //anything inside the quotes that might be used to split the string into lines and fields later,<br />
&nbsp;&nbsp;&nbsp; //needs to be quoted. The only character we can guarantee as safe to use, because it will never appear in the unquoted text, is a CR<br />
&nbsp;&nbsp;&nbsp; //So we're going to use CR as a marker to make escape sequences for CR, LF, Quotes, and Commas.<br />
&nbsp;&nbsp;&nbsp; $str = str_replace("\r", "\rR", $matches[3]);<br />
&nbsp;&nbsp;&nbsp; $str = str_replace("\n", "\rN", $str);<br />
&nbsp;&nbsp;&nbsp; $str = str_replace('""', "\rQ", $str);<br />
&nbsp;&nbsp;&nbsp; $str = str_replace(',', "\rC", $str);<br />
<br />
&nbsp;&nbsp;&nbsp; //The unquoted text is where commas and newlines are allowed, and where the splits will happen<br />
&nbsp;&nbsp;&nbsp; //We're going to remove all CRs from the unquoted text, by normalizing all line endings to just LF<br />
&nbsp;&nbsp;&nbsp; //This ensures us that the only place CR is used, is as the escape sequences for quoted text<br />
&nbsp;&nbsp;&nbsp; return preg_replace('/\r\n?/', "\n", $matches[1]) . $str;<br />
}<br />
<br />
//split on comma and parse each field with a callback<br />
function parse_csv_line($line)<br />
{<br />
&nbsp;&nbsp;&nbsp; return array_map('parse_csv_field', explode(',', $line));<br />
}<br />
<br />
//restore any csv-special characters that are part of the data<br />
function parse_csv_field($field) {<br />
&nbsp;&nbsp;&nbsp; $field = str_replace("\rC", ',', $field);<br />
&nbsp;&nbsp;&nbsp; $field = str_replace("\rQ", '"', $field);<br />
&nbsp;&nbsp;&nbsp; $field = str_replace("\rN", "\n", $field);<br />
&nbsp;&nbsp;&nbsp; $field = str_replace("\rR", "\r", $field);<br />
&nbsp;&nbsp;&nbsp; return $field;<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="111665""></a>
  <div class="note">
   <strong class="user">normadize -a- gmail -d- com</strong>
   <a href="#111665" class="date">13-Mar-2013 11:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Like some other users here noted, str_getcsv() cannot be used if you want to comply with either the RFC or with most spreadsheet tools like Excel or Google Docs.<br />
<br />
These tools do not escape commas or new lines, but instead place double-quotes (") around the field. If there are any double-quotes in the field, these are escaped with another double-quote (" becomes ""). All this may look odd, but it is what the RFC and most tools do ... <br />
<br />
For instance, try exporting as .csv a Google Docs spreadsheet (File &gt; Download as &gt; .csv) which has new lines and commas as part of the field values and see how the .csv content looks, then try to parse it using str_getcsv() ... it will spectacularly regardless of the arguments you pass to it.<br />
<br />
Here is a function that can handle everything correctly, and more:<br />
<br />
- doesn't use any for or while loops,<br />
- it allows for any separator (any string of any length),<br />
- option to skip empty lines,<br />
- option to trim fields,<br />
- can handle UTF8 data too (although .csv files are likely non-unicode).<br />
<br />
Here is the more human readable version of the function:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">// returns a two-dimensional array or rows and fields<br />
<br />
</span><span class="keyword">function </span><span class="default">parse_csv </span><span class="keyword">(</span><span class="default">$csv_string</span><span class="keyword">, </span><span class="default">$delimiter </span><span class="keyword">= </span><span class="string">","</span><span class="keyword">, </span><span class="default">$skip_empty_lines </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">, </span><span class="default">$trim_fields </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$enc </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/(?&lt;!")""/'</span><span class="keyword">, </span><span class="string">'!!Q!!'</span><span class="keyword">, </span><span class="default">$csv_string</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$enc </span><span class="keyword">= </span><span class="default">preg_replace_callback</span><span class="keyword">(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'/"(.*?)"/s'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; function (</span><span class="default">$field</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">urlencode</span><span class="keyword">(</span><span class="default">utf8_encode</span><span class="keyword">(</span><span class="default">$field</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; },<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$enc<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$lines </span><span class="keyword">= </span><span class="default">preg_split</span><span class="keyword">(</span><span class="default">$skip_empty_lines </span><span class="keyword">? (</span><span class="default">$trim_fields </span><span class="keyword">? </span><span class="string">'/( *\R)+/s' </span><span class="keyword">: </span><span class="string">'/\R+/s'</span><span class="keyword">) : </span><span class="string">'/\R/s'</span><span class="keyword">, </span><span class="default">$enc</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">array_map</span><span class="keyword">(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; function (</span><span class="default">$line</span><span class="keyword">) use (</span><span class="default">$delimiter</span><span class="keyword">, </span><span class="default">$trim_fields</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fields </span><span class="keyword">= </span><span class="default">$trim_fields </span><span class="keyword">? </span><span class="default">array_map</span><span class="keyword">(</span><span class="string">'trim'</span><span class="keyword">, </span><span class="default">explode</span><span class="keyword">(</span><span class="default">$delimiter</span><span class="keyword">, </span><span class="default">$line</span><span class="keyword">)) : </span><span class="default">explode</span><span class="keyword">(</span><span class="default">$delimiter</span><span class="keyword">, </span><span class="default">$line</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">array_map</span><span class="keyword">(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; function (</span><span class="default">$field</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'!!Q!!'</span><span class="keyword">, </span><span class="string">'"'</span><span class="keyword">, </span><span class="default">utf8_decode</span><span class="keyword">(</span><span class="default">urldecode</span><span class="keyword">(</span><span class="default">$field</span><span class="keyword">)));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; },<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fields<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; },<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$lines<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Since this is not using any loops, you can actually write it as a one-line statement (one-liner).<br />
<br />
Here's the function using just one line of code for the function body, formatted nicely though:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">// returns the same two-dimensional array as above, but with a one-liner code<br />
<br />
</span><span class="keyword">function </span><span class="default">parse_csv </span><span class="keyword">(</span><span class="default">$csv_string</span><span class="keyword">, </span><span class="default">$delimiter </span><span class="keyword">= </span><span class="string">","</span><span class="keyword">, </span><span class="default">$skip_empty_lines </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">, </span><span class="default">$trim_fields </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">array_map</span><span class="keyword">(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; function (</span><span class="default">$line</span><span class="keyword">) use (</span><span class="default">$delimiter</span><span class="keyword">, </span><span class="default">$trim_fields</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">array_map</span><span class="keyword">(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; function (</span><span class="default">$field</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'!!Q!!'</span><span class="keyword">, </span><span class="string">'"'</span><span class="keyword">, </span><span class="default">utf8_decode</span><span class="keyword">(</span><span class="default">urldecode</span><span class="keyword">(</span><span class="default">$field</span><span class="keyword">)));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; },<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$trim_fields </span><span class="keyword">? </span><span class="default">array_map</span><span class="keyword">(</span><span class="string">'trim'</span><span class="keyword">, </span><span class="default">explode</span><span class="keyword">(</span><span class="default">$delimiter</span><span class="keyword">, </span><span class="default">$line</span><span class="keyword">)) : </span><span class="default">explode</span><span class="keyword">(</span><span class="default">$delimiter</span><span class="keyword">, </span><span class="default">$line</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; );<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; },<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">preg_split</span><span class="keyword">(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$skip_empty_lines </span><span class="keyword">? (</span><span class="default">$trim_fields </span><span class="keyword">? </span><span class="string">'/( *\R)+/s' </span><span class="keyword">: </span><span class="string">'/\R+/s'</span><span class="keyword">) : </span><span class="string">'/\R/s'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">preg_replace_callback</span><span class="keyword">(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'/"(.*?)"/s'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; function (</span><span class="default">$field</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">urlencode</span><span class="keyword">(</span><span class="default">utf8_encode</span><span class="keyword">(</span><span class="default">$field</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; },<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$enc </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/(?&lt;!")""/'</span><span class="keyword">, </span><span class="string">'!!Q!!'</span><span class="keyword">, </span><span class="default">$csv_string</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
&nbsp;&nbsp;&nbsp; );<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Replace !!Q!! with another placeholder if you wish.<br />
<br />
Have fun.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="111579""></a>
  <div class="note">
   <strong class="user">V.Krishn</strong>
   <a href="#111579" class="date">06-Mar-2013 01:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
Note</span><span class="keyword">: </span><span class="default">The </span><span class="keyword">function </span><span class="default">trims all values unlike&nbsp; str_getcsv </span><span class="keyword">(</span><span class="default">v5.3</span><span class="keyword">).<br />
</span><span class="comment">/**<br />
&nbsp; * @link https://github.com/insteps/phputils (for updated code)<br />
&nbsp; * Parse a CSV string into an array for php 4+.<br />
&nbsp; * @param string $input String<br />
&nbsp; * @param string $delimiter String<br />
&nbsp; * @param string $enclosure String<br />
&nbsp; * @return array<br />
&nbsp; */<br />
</span><span class="keyword">function </span><span class="default">str_getcsv4</span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">, </span><span class="default">$delimiter </span><span class="keyword">= </span><span class="string">','</span><span class="keyword">, </span><span class="default">$enclosure </span><span class="keyword">= </span><span class="string">'"'</span><span class="keyword">) {<br />
<br />
&nbsp;&nbsp;&nbsp; if( ! </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/[</span><span class="default">$enclosure</span><span class="string">]/"</span><span class="keyword">, </span><span class="default">$input</span><span class="keyword">) ) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; return (array)</span><span class="default">preg_replace</span><span class="keyword">(array(</span><span class="string">"/^\\s*/"</span><span class="keyword">, </span><span class="string">"/\\s*$/"</span><span class="keyword">), </span><span class="string">''</span><span class="keyword">, </span><span class="default">explode</span><span class="keyword">(</span><span class="default">$delimiter</span><span class="keyword">, </span><span class="default">$input</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$token </span><span class="keyword">= </span><span class="string">"##"</span><span class="keyword">; </span><span class="default">$token2 </span><span class="keyword">= </span><span class="string">"::"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//alternate tokens "\034\034", "\035\035", "%%";<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$t1 </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(array(</span><span class="string">"/\\\[</span><span class="default">$enclosure</span><span class="string">]/"</span><span class="keyword">, </span><span class="string">"/</span><span class="default">$enclosure</span><span class="string">{2}/"</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"/[</span><span class="default">$enclosure</span><span class="string">]\\s*[</span><span class="default">$delimiter</span><span class="string">]\\s*[</span><span class="default">$enclosure</span><span class="string">]\\s*/"</span><span class="keyword">, </span><span class="string">"/\\s*[</span><span class="default">$enclosure</span><span class="string">]\\s*/"</span><span class="keyword">),<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; array(</span><span class="default">$token2</span><span class="keyword">, </span><span class="default">$token2</span><span class="keyword">, </span><span class="default">$token</span><span class="keyword">, </span><span class="default">$token</span><span class="keyword">), </span><span class="default">trim</span><span class="keyword">(</span><span class="default">trim</span><span class="keyword">(</span><span class="default">trim</span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">), </span><span class="default">$enclosure</span><span class="keyword">)));<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$a </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="default">$token</span><span class="keyword">, </span><span class="default">$t1</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; foreach(</span><span class="default">$a </span><span class="keyword">as </span><span class="default">$k</span><span class="keyword">=&gt;</span><span class="default">$v</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/^</span><span class="keyword">{</span><span class="default">$delimiter</span><span class="keyword">}</span><span class="string">/"</span><span class="keyword">, </span><span class="default">$v</span><span class="keyword">) || </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/</span><span class="keyword">{</span><span class="default">$delimiter</span><span class="keyword">}</span><span class="string">$/"</span><span class="keyword">, </span><span class="default">$v</span><span class="keyword">) ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$a</span><span class="keyword">[</span><span class="default">$k</span><span class="keyword">] = </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$v</span><span class="keyword">, </span><span class="default">$delimiter</span><span class="keyword">); </span><span class="default">$a</span><span class="keyword">[</span><span class="default">$k</span><span class="keyword">] = </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"/</span><span class="default">$delimiter</span><span class="string">/"</span><span class="keyword">, </span><span class="string">"</span><span class="default">$token</span><span class="string">"</span><span class="keyword">, </span><span class="default">$a</span><span class="keyword">[</span><span class="default">$k</span><span class="keyword">]); }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$a </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="default">$token</span><span class="keyword">, </span><span class="default">implode</span><span class="keyword">(</span><span class="default">$token</span><span class="keyword">, </span><span class="default">$a</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; return (array)</span><span class="default">preg_replace</span><span class="keyword">(array(</span><span class="string">"/^\\s/"</span><span class="keyword">, </span><span class="string">"/\\s$/"</span><span class="keyword">, </span><span class="string">"/</span><span class="default">$token2</span><span class="string">/"</span><span class="keyword">), array(</span><span class="string">''</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$enclosure</span><span class="keyword">), </span><span class="default">$a</span><span class="keyword">);<br />
<br />
}<br />
<br />
if ( ! </span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">'str_getcsv'</span><span class="keyword">)) {<br />
&nbsp; function </span><span class="default">str_getcsv</span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">, </span><span class="default">$delimiter </span><span class="keyword">= </span><span class="string">','</span><span class="keyword">, </span><span class="default">$enclosure </span><span class="keyword">= </span><span class="string">'"'</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">str_getcsv4</span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">, </span><span class="default">$delimiter</span><span class="keyword">, </span><span class="default">$enclosure</span><span class="keyword">);<br />
&nbsp; }<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="111577""></a>
  <div class="note">
   <strong class="user">V.Krishn</strong>
   <a href="#111577" class="date">06-Mar-2013 01:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note: The function trims all values unlike&nbsp; str_getcsv (v5.3).<br />
/**<br />
&nbsp; * @link https://github.com/insteps/phputils (for updated code)<br />
&nbsp; * Parse a CSV string into an array for php 4+.<br />
&nbsp; * @param string $input String<br />
&nbsp; * @param string $delimiter String<br />
&nbsp; * @param string $enclosure String<br />
&nbsp; * @return array<br />
&nbsp; */<br />
function str_getcsv4($input, $delimiter = ',', $enclosure = '"') {<br />
<br />
&nbsp;&nbsp;&nbsp; if( ! preg_match("/[$enclosure]/", $input) ) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; return (array)preg_replace(array("/^\\s*/", "/\\s*$/"), '', explode($delimiter, $input));<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; $token = "##"; $token2 = "::";<br />
&nbsp;&nbsp;&nbsp; //alternate tokens "\034\034", "\035\035", "%%";<br />
&nbsp;&nbsp;&nbsp; $t1 = preg_replace(array("/\\\[$enclosure]/", "/$enclosure{2}/",<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; "/[$enclosure]\\s*[$delimiter]\\s*[$enclosure]\\s*/", "/\\s*[$enclosure]\\s*/"),<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; array($token2, $token2, $token, $token), trim(trim(trim($input), $enclosure)));<br />
<br />
&nbsp;&nbsp;&nbsp; $a = explode($token, $t1);<br />
&nbsp;&nbsp;&nbsp; foreach($a as $k=&gt;$v) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( preg_match("/^{$delimiter}/", $v) || preg_match("/{$delimiter}$/", $v) ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $a[$k] = trim($v, $delimiter); $a[$k] = preg_replace("/$delimiter/", "$token", $a[$k]); }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; $a = explode($token, implode($token, $a));<br />
&nbsp;&nbsp;&nbsp; return (array)preg_replace(array("/^\\s/", "/\\s$/", "/$token2/"), array('', '', $enclosure), $a);<br />
<br />
}<br />
<br />
if ( ! function_exists('str_getcsv')) {<br />
&nbsp; function str_getcsv($input, $delimiter = ',', $enclosure = '"') {<br />
&nbsp;&nbsp;&nbsp; return str_getcsv4($input, $delimiter, $enclosure);<br />
&nbsp; }<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="109948""></a>
  <div class="note">
   <strong class="user">khelibert at gmail dot com</strong>
   <a href="#109948" class="date">04-Sep-2012 04:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I've written this to handle :<br />
- fields with or without enclosure;<br />
- escape and enclosure characters using the same character (ie &lt;&lt;"&gt;&gt; in Excel) <br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; * Converts a csv file into an array of lines and columns.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; * khelibert@gmail.com<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; * @param $fileContent String<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; * @param string $escape String<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; * @param string $enclosure String<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; * @param string $delimiter String<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; * @return array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; */<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">csvToArray</span><span class="keyword">(</span><span class="default">$fileContent</span><span class="keyword">,</span><span class="default">$escape </span><span class="keyword">= </span><span class="string">'\\'</span><span class="keyword">, </span><span class="default">$enclosure </span><span class="keyword">= </span><span class="string">'"'</span><span class="keyword">, </span><span class="default">$delimiter </span><span class="keyword">= </span><span class="string">';'</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$lines </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fields </span><span class="keyword">= array();<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$escape </span><span class="keyword">== </span><span class="default">$enclosure</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$escape </span><span class="keyword">= </span><span class="string">'\\'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fileContent </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(array(</span><span class="string">'\\'</span><span class="keyword">,</span><span class="default">$enclosure</span><span class="keyword">.</span><span class="default">$enclosure</span><span class="keyword">,</span><span class="string">"\r\n"</span><span class="keyword">,</span><span class="string">"\r"</span><span class="keyword">),<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; array(</span><span class="string">'\\\\'</span><span class="keyword">,</span><span class="default">$escape</span><span class="keyword">.</span><span class="default">$enclosure</span><span class="keyword">,</span><span class="string">"\\n"</span><span class="keyword">,</span><span class="string">"\\n"</span><span class="keyword">),</span><span class="default">$fileContent</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fileContent </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(array(</span><span class="string">"\r\n"</span><span class="keyword">,</span><span class="string">"\r"</span><span class="keyword">),array(</span><span class="string">"\\n"</span><span class="keyword">,</span><span class="string">"\\n"</span><span class="keyword">),</span><span class="default">$fileContent</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nb </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$fileContent</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$field </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$inEnclosure </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$previous </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for(</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">$nb</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$c </span><span class="keyword">= </span><span class="default">$fileContent</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$c </span><span class="keyword">=== </span><span class="default">$enclosure</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$previous </span><span class="keyword">!== </span><span class="default">$escape</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$inEnclosure </span><span class="keyword">^= </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$field </span><span class="keyword">.= </span><span class="default">$enclosure</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else if(</span><span class="default">$c </span><span class="keyword">=== </span><span class="default">$escape</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$next </span><span class="keyword">= </span><span class="default">$fileContent</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$next </span><span class="keyword">!= </span><span class="default">$enclosure </span><span class="keyword">&amp;&amp; </span><span class="default">$next </span><span class="keyword">!= </span><span class="default">$escape</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$field </span><span class="keyword">.= </span><span class="default">$escape</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else if(</span><span class="default">$c </span><span class="keyword">=== </span><span class="default">$delimiter</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$inEnclosure</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$field </span><span class="keyword">.= </span><span class="default">$delimiter</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//end of the field<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fields</span><span class="keyword">[] = </span><span class="default">$field</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$field </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else if(</span><span class="default">$c </span><span class="keyword">=== </span><span class="string">"\n"</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fields</span><span class="keyword">[] = </span><span class="default">$field</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$field </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$lines</span><span class="keyword">[] = </span><span class="default">$fields</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fields </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$field </span><span class="keyword">.= </span><span class="default">$c</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$previous </span><span class="keyword">= </span><span class="default">$c</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//we add the last element<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">true </span><span class="keyword">|| </span><span class="default">$field </span><span class="keyword">!== </span><span class="string">''</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fields</span><span class="keyword">[] = </span><span class="default">$field</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$lines</span><span class="keyword">[] = </span><span class="default">$fields</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$lines</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="106674""></a>
  <div class="note">
   <strong class="user">xoneca at gmail dot com</strong>
   <a href="#106674" class="date">27-Nov-2011 04:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that this function can also be used to parse other types of constructions. For example, I have used to parse .htaccess AddDescription lines:<br />
<br />
&nbsp;&nbsp;&nbsp; AddDescription "My description to the file." filename.jpg<br />
<br />
Those lines can be parsed like this:<br />
<br />
<span class="default">&lt;?php<br />
<br />
$line </span><span class="keyword">= </span><span class="string">'AddDescription "My description to the file." filename.jpg'</span><span class="keyword">;<br />
<br />
</span><span class="default">$parsed </span><span class="keyword">= </span><span class="default">str_getcsv</span><span class="keyword">(<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$line</span><span class="keyword">, </span><span class="comment"># Input line<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">' '</span><span class="keyword">,&nbsp;&nbsp; </span><span class="comment"># Delimiter<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'"'</span><span class="keyword">,&nbsp;&nbsp; </span><span class="comment"># Enclosure<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'\\'&nbsp;&nbsp; </span><span class="comment"># Escape char<br />
</span><span class="keyword">);<br />
<br />
</span><span class="default">var_dump</span><span class="keyword">( </span><span class="default">$parsed </span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
The output:<br />
<br />
array(3) {<br />
&nbsp; [0]=&gt;<br />
&nbsp; string(14) "AddDescription"<br />
&nbsp; [1]=&gt;<br />
&nbsp; string(27) "My description to the file."<br />
&nbsp; [2]=&gt;<br />
&nbsp; string(12) "filename.jpg"<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="101888""></a>
  <div class="note">
   <strong class="user">durik at 3ilab dot net</strong>
   <a href="#101888" class="date">16-Jan-2011 11:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As the str_getcsv(), unlike to fgetcsv(), does not parse the rows in CSV string, I have found following easy workaround:
<br />

<br />
<span class="default">&lt;?php
<br />
$Data </span><span class="keyword">= </span><span class="default">str_getcsv</span><span class="keyword">(</span><span class="default">$CsvString</span><span class="keyword">, </span><span class="string">"\n"</span><span class="keyword">); </span><span class="comment">//parse the rows
<br />
</span><span class="keyword">foreach(</span><span class="default">$Data </span><span class="keyword">as &amp;</span><span class="default">$Row</span><span class="keyword">) </span><span class="default">$Row </span><span class="keyword">= </span><span class="default">str_getcsv</span><span class="keyword">(</span><span class="default">$Row</span><span class="keyword">, </span><span class="string">";"</span><span class="keyword">); </span><span class="comment">//parse the items in rows
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Why not use explode() instead of str_getcsv() to parse rows? Because explode() would not treat possible enclosured parts of string or escaped characters correctly.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99323""></a>
  <div class="note">
   <strong class="user">Jay Williams</strong>
   <a href="#99323" class="date">10-Aug-2010 01:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is a quick and easy way to convert a CSV file to an associated array:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/**<br />
&nbsp;* @link <a href="http://gist.github.com/385876" rel="nofollow" target="_blank">http://gist.github.com/385876</a><br />
&nbsp;*/<br />
</span><span class="keyword">function </span><span class="default">csv_to_array</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">, </span><span class="default">$delimiter</span><span class="keyword">=</span><span class="string">','</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; if(!</span><span class="default">file_exists</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">) || !</span><span class="default">is_readable</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">FALSE</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$header </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">= array();<br />
&nbsp;&nbsp;&nbsp; if ((</span><span class="default">$handle </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">, </span><span class="string">'r'</span><span class="keyword">)) !== </span><span class="default">FALSE</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while ((</span><span class="default">$row </span><span class="keyword">= </span><span class="default">fgetcsv</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="default">1000</span><span class="keyword">, </span><span class="default">$delimiter</span><span class="keyword">)) !== </span><span class="default">FALSE</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(!</span><span class="default">$header</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$header </span><span class="keyword">= </span><span class="default">$row</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$data</span><span class="keyword">[] = </span><span class="default">array_combine</span><span class="keyword">(</span><span class="default">$header</span><span class="keyword">, </span><span class="default">$row</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$data</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="98088""></a>
  <div class="note">
   <strong class="user">hpartidas at deuz dot net</strong>
   <a href="#98088" class="date">25-May-2010 09:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I found myself wanting to parse a CSV and didn't have access to str_getcsv, so I wrote substitute for PHP &lt; 5.3, hope it helps someone out there stuck in the same situation.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">if (!</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">'str_getcsv'</span><span class="keyword">)) { 
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">str_getcsv</span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">, </span><span class="default">$delimiter </span><span class="keyword">= </span><span class="string">','</span><span class="keyword">, </span><span class="default">$enclosure </span><span class="keyword">= </span><span class="string">'"'</span><span class="keyword">, </span><span class="default">$escape </span><span class="keyword">= </span><span class="string">'\\'</span><span class="keyword">, </span><span class="default">$eol </span><span class="keyword">= </span><span class="string">'\n'</span><span class="keyword">) { 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_string</span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">) &amp;&amp; !empty(</span><span class="default">$input</span><span class="keyword">)) { 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$output </span><span class="keyword">= array(); 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tmp&nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">preg_split</span><span class="keyword">(</span><span class="string">"/"</span><span class="keyword">.</span><span class="default">$eol</span><span class="keyword">.</span><span class="string">"/"</span><span class="keyword">,</span><span class="default">$input</span><span class="keyword">); 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">) &amp;&amp; !empty(</span><span class="default">$tmp</span><span class="keyword">)) { 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; while (list(</span><span class="default">$line_num</span><span class="keyword">, </span><span class="default">$line</span><span class="keyword">) = </span><span class="default">each</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">)) { 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/"</span><span class="keyword">.</span><span class="default">$escape</span><span class="keyword">.</span><span class="default">$enclosure</span><span class="keyword">.</span><span class="string">"/"</span><span class="keyword">,</span><span class="default">$line</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; while (</span><span class="default">$strlen </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$line</span><span class="keyword">)) { 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pos_delimiter&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$line</span><span class="keyword">,</span><span class="default">$delimiter</span><span class="keyword">); 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pos_enclosure_start </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$line</span><span class="keyword">,</span><span class="default">$enclosure</span><span class="keyword">); 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">is_int</span><span class="keyword">(</span><span class="default">$pos_delimiter</span><span class="keyword">) &amp;&amp; </span><span class="default">is_int</span><span class="keyword">(</span><span class="default">$pos_enclosure_start</span><span class="keyword">) 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &amp;&amp; (</span><span class="default">$pos_enclosure_start </span><span class="keyword">&lt; </span><span class="default">$pos_delimiter</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$enclosed_str </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$line</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">); 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pos_enclosure_end </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$enclosed_str</span><span class="keyword">,</span><span class="default">$enclosure</span><span class="keyword">); 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$enclosed_str </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$enclosed_str</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$pos_enclosure_end</span><span class="keyword">); 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$output</span><span class="keyword">[</span><span class="default">$line_num</span><span class="keyword">][] = </span><span class="default">$enclosed_str</span><span class="keyword">; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$offset </span><span class="keyword">= </span><span class="default">$pos_enclosure_end</span><span class="keyword">+</span><span class="default">3</span><span class="keyword">; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (empty(</span><span class="default">$pos_delimiter</span><span class="keyword">) &amp;&amp; empty(</span><span class="default">$pos_enclosure_start</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$output</span><span class="keyword">[</span><span class="default">$line_num</span><span class="keyword">][] = </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$line</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$offset </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$line</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$output</span><span class="keyword">[</span><span class="default">$line_num</span><span class="keyword">][] = </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$line</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$pos_delimiter</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$offset </span><span class="keyword">= (
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; !empty(</span><span class="default">$pos_enclosure_start</span><span class="keyword">) 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &amp;&amp; (</span><span class="default">$pos_enclosure_start </span><span class="keyword">&lt; </span><span class="default">$pos_delimiter</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ?</span><span class="default">$pos_enclosure_start
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">:</span><span class="default">$pos_delimiter</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$line </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$line</span><span class="keyword">,</span><span class="default">$offset</span><span class="keyword">); 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else { 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$line </span><span class="keyword">= </span><span class="default">preg_split</span><span class="keyword">(</span><span class="string">"/"</span><span class="keyword">.</span><span class="default">$delimiter</span><span class="keyword">.</span><span class="string">"/"</span><span class="keyword">,</span><span class="default">$line</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/*
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; * Validating against pesky extra line breaks creating false rows.
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; */
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$line</span><span class="keyword">) &amp;&amp; !empty(</span><span class="default">$line</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">])) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$output</span><span class="keyword">[</span><span class="default">$line_num</span><span class="keyword">] = </span><span class="default">$line</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$output</span><span class="keyword">; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else { 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else { 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } 
<br />
&nbsp;&nbsp;&nbsp; }
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="95132""></a>
  <div class="note">
   <strong class="user">Raymond</strong>
   <a href="#95132" class="date">14-Dec-2009 05:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's a little function to convert a multi-line CSV string to an array:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">csv_to_array</span><span class="keyword">(</span><span class="default">$csv</span><span class="keyword">, </span><span class="default">$delimiter </span><span class="keyword">= </span><span class="string">','</span><span class="keyword">, </span><span class="default">$enclosure </span><span class="keyword">= </span><span class="string">'"'</span><span class="keyword">, </span><span class="default">$escape </span><span class="keyword">= </span><span class="string">'\\'</span><span class="keyword">, </span><span class="default">$terminator </span><span class="keyword">= </span><span class="string">"\n"</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$r </span><span class="keyword">= array();
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$rows </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="default">$terminator</span><span class="keyword">,</span><span class="default">trim</span><span class="keyword">(</span><span class="default">$csv</span><span class="keyword">));
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$names </span><span class="keyword">= </span><span class="default">array_shift</span><span class="keyword">(</span><span class="default">$rows</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$names </span><span class="keyword">= </span><span class="default">str_getcsv</span><span class="keyword">(</span><span class="default">$names</span><span class="keyword">,</span><span class="default">$delimiter</span><span class="keyword">,</span><span class="default">$enclosure</span><span class="keyword">,</span><span class="default">$escape</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$nc </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$names</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$rows </span><span class="keyword">as </span><span class="default">$row</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">trim</span><span class="keyword">(</span><span class="default">$row</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$values </span><span class="keyword">= </span><span class="default">str_getcsv</span><span class="keyword">(</span><span class="default">$row</span><span class="keyword">,</span><span class="default">$delimiter</span><span class="keyword">,</span><span class="default">$enclosure</span><span class="keyword">,</span><span class="default">$escape</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">$values</span><span class="keyword">) </span><span class="default">$values </span><span class="keyword">= </span><span class="default">array_fill</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,</span><span class="default">$nc</span><span class="keyword">,</span><span class="default">null</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$r</span><span class="keyword">[] = </span><span class="default">array_combine</span><span class="keyword">(</span><span class="default">$names</span><span class="keyword">,</span><span class="default">$values</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$r</span><span class="keyword">;
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="89619""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#89619" class="date">16-Mar-2009 10:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For some reason o'connor's code only reads one line of a csv for me... I had to replace the line <br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; $data = fgetcsv($fp, 1000, $delimiter, $enclosure); //&nbsp; $escape only got added in 5.3.0 <br />
<br />
with this:<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; $data;<br />
&nbsp;&nbsp; &nbsp;&nbsp; while (!feof($fp))<br />
&nbsp;&nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $data[] = fgetcsv($fp, 0, $delimiter, $enclosure); //&nbsp; $escape only got added in 5.3.0<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
<br />
...to get all of the data out of my string (some post data pasted into a textbox and processed only with stripslashes).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="88773""></a>
  <div class="note">
   <strong class="user">dave_walter at NOSPAM dot yahoo dot com</strong>
   <a href="#88773" class="date">06-Feb-2009 03:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Drawing inspiration from daniel dot oconnor at gmail dot com, here's an alternative str_putcsv() that leverages existing PHP core functionality (5.1.0+) to avoid re-inventing the wheel.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">if(!</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">'str_putcsv'</span><span class="keyword">)) {<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">str_putcsv</span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">, </span><span class="default">$delimiter </span><span class="keyword">= </span><span class="string">','</span><span class="keyword">, </span><span class="default">$enclosure </span><span class="keyword">= </span><span class="string">'"'</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Open a memory "file" for read/write...<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="string">'php://temp'</span><span class="keyword">, </span><span class="string">'r+'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// ... write the $input array to the "file" using fputcsv()...<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fputcsv</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$input</span><span class="keyword">, </span><span class="default">$delimiter</span><span class="keyword">, </span><span class="default">$enclosure</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// ... rewind the "file" so we can read what we just wrote...<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">rewind</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// ... read the entire line into a variable...<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// ... close the "file"...<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// ... and return the $data to the caller, with the trailing newline from fgets() removed.<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">rtrim</span><span class="keyword">( </span><span class="default">$data</span><span class="keyword">, </span><span class="string">"\n" </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="88353""></a>
  <div class="note">
   <strong class="user">Jeremy</strong>
   <a href="#88353" class="date">20-Jan-2009 05:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
After using several methods in the past to create CSV strings without using files (disk IO sucks), I finally decided it's time to write a function to handle it all. This function could use some cleanup, and the variable type test might be overkill for what is needed, I haven't thought about it too much.
<br />

<br />
Also, I took the liberty of replacing fields with certain data types with strings which I find much easier to work with. Some of you may not agree with those. Also, please note that the type "double" or float has been coded specifically for two digit precision because if I am using a float, it's most likely for currency.
<br />

<br />
I am sure some of you out there would appreciate this function.
<br />

<br />
<span class="default">&lt;?php
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">str_putcsv</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">, </span><span class="default">$delimiter </span><span class="keyword">= </span><span class="string">','</span><span class="keyword">, </span><span class="default">$enclosure </span><span class="keyword">= </span><span class="string">'"'</span><span class="keyword">, </span><span class="default">$terminator </span><span class="keyword">= </span><span class="string">"\n"</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment"># First convert associative array to numeric indexed array
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">foreach (</span><span class="default">$array </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">) </span><span class="default">$workArray</span><span class="keyword">[] = </span><span class="default">$value</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$returnString </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment"># Initialize return string
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$arraySize </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$workArray</span><span class="keyword">);&nbsp; &nbsp;&nbsp; </span><span class="comment"># Get size of array
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">$arraySize</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment"># Nested array, process nest item
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$workArray</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">])) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$returnString </span><span class="keyword">.= </span><span class="default">str_putcsv</span><span class="keyword">(</span><span class="default">$workArray</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">], </span><span class="default">$delimiter</span><span class="keyword">, </span><span class="default">$enclosure</span><span class="keyword">, </span><span class="default">$terminator</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; switch (</span><span class="default">gettype</span><span class="keyword">(</span><span class="default">$workArray</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">])) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment"># Manually set some strings
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">case </span><span class="string">"NULL"</span><span class="keyword">:&nbsp; &nbsp;&nbsp; </span><span class="default">$_spFormat </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">; break;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">"boolean"</span><span class="keyword">:&nbsp; </span><span class="default">$_spFormat </span><span class="keyword">= (</span><span class="default">$workArray</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] == </span><span class="default">true</span><span class="keyword">) ? </span><span class="string">'true'</span><span class="keyword">: </span><span class="string">'false'</span><span class="keyword">; break;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment"># Make sure sprintf has a good datatype to work with
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">case </span><span class="string">"integer"</span><span class="keyword">:&nbsp; </span><span class="default">$_spFormat </span><span class="keyword">= </span><span class="string">'%i'</span><span class="keyword">; break;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">"double"</span><span class="keyword">:&nbsp;&nbsp; </span><span class="default">$_spFormat </span><span class="keyword">= </span><span class="string">'%0.2f'</span><span class="keyword">; break;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">"string"</span><span class="keyword">:&nbsp;&nbsp; </span><span class="default">$_spFormat </span><span class="keyword">= </span><span class="string">'%s'</span><span class="keyword">; break;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment"># Unknown or invalid items for a csv - note: the datatype of array is already handled above, assuming the data is nested
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">case </span><span class="string">"object"</span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">"resource"</span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; default:&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$_spFormat </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">; break;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$returnString </span><span class="keyword">.= </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">'%2$s'</span><span class="keyword">.</span><span class="default">$_spFormat</span><span class="keyword">.</span><span class="string">'%2$s'</span><span class="keyword">, </span><span class="default">$workArray</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">], </span><span class="default">$enclosure</span><span class="keyword">);
<br />
</span><span class="default">$returnString </span><span class="keyword">.= (</span><span class="default">$i </span><span class="keyword">&lt; (</span><span class="default">$arraySize</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">)) ? </span><span class="default">$delimiter </span><span class="keyword">: </span><span class="default">$terminator</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment"># Done the workload, return the output information
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">$returnString</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="88311""></a>
  <div class="note">
   <strong class="user">daniel dot oconnor at gmail dot com</strong>
   <a href="#88311" class="date">19-Jan-2009 04:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Don't have this? Ask fgetcsv() to do it for you.
<br />

<br />
5.1.0+
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">if (!</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">'str_getcsv'</span><span class="keyword">)) {
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">str_getcsv</span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">, </span><span class="default">$delimiter </span><span class="keyword">= </span><span class="string">","</span><span class="keyword">, </span><span class="default">$enclosure </span><span class="keyword">= </span><span class="string">'"'</span><span class="keyword">, </span><span class="default">$escape </span><span class="keyword">= </span><span class="string">"\\"</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fiveMBs </span><span class="keyword">= </span><span class="default">5 </span><span class="keyword">* </span><span class="default">1024 </span><span class="keyword">* </span><span class="default">1024</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="string">"php://temp/maxmemory:</span><span class="default">$fiveMBs</span><span class="string">"</span><span class="keyword">, </span><span class="string">'r+'</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$input</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">rewind</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">fgetcsv</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">1000</span><span class="keyword">, </span><span class="default">$delimiter</span><span class="keyword">, </span><span class="default">$enclosure</span><span class="keyword">); </span><span class="comment">//&nbsp; $escape only got added in 5.3.0
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$data</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85799""></a>
  <div class="note">
   <strong class="user">william dot j dot weir at gmail dot com</strong>
   <a href="#85799" class="date">18-Sep-2008 03:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If your happy enough having just a multi-dimensional array, this should work fine. I had wanted to use the one provided by keananda but it was choking on pr($lines).<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">f_parse_csv</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="default">$longest</span><span class="keyword">, </span><span class="default">$delimiter</span><span class="keyword">) {<br />
&nbsp; </span><span class="default">$mdarray </span><span class="keyword">= array();<br />
&nbsp; </span><span class="default">$file&nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">);<br />
&nbsp; while (</span><span class="default">$line </span><span class="keyword">= </span><span class="default">fgetcsv</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="default">$longest</span><span class="keyword">, </span><span class="default">$delimiter</span><span class="keyword">)) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">array_push</span><span class="keyword">(</span><span class="default">$mdarray</span><span class="keyword">, </span><span class="default">$line</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);<br />
&nbsp; return </span><span class="default">$mdarray</span><span class="keyword">;<br />
&nbsp; }<br />
</span><span class="default">?&gt;<br />
</span><br />
$longest is a number that represents the longest line in the csv file as required by fgetcsv().&nbsp; The page for fgetcsv() said that the longest line could be set to 0 or left out, but I couldn't get it to work without. I just made it extra large when I had to use it.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85733""></a>
  <div class="note">
   <strong class="user">keananda at gmail dot com</strong>
   <a href="#85733" class="date">15-Sep-2008 04:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For those who need this function but not yet installed in their environment, you can use my function bellow.<br />
<br />
You can parse your csv file into an associative array (by default) for each lines, or into an object.<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">parse_csv</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="default">$options </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$delimiter </span><span class="keyword">= empty(</span><span class="default">$options</span><span class="keyword">[</span><span class="string">'delimiter'</span><span class="keyword">]) ? </span><span class="string">"," </span><span class="keyword">: </span><span class="default">$options</span><span class="keyword">[</span><span class="string">'delimiter'</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$to_object </span><span class="keyword">= empty(</span><span class="default">$options</span><span class="keyword">[</span><span class="string">'to_object'</span><span class="keyword">]) ? </span><span class="default">false </span><span class="keyword">: </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$str </span><span class="keyword">= </span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$lines </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">"\n"</span><span class="keyword">, </span><span class="default">$str</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">pr</span><span class="keyword">(</span><span class="default">$lines</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$field_names </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="default">$delimiter</span><span class="keyword">, </span><span class="default">array_shift</span><span class="keyword">(</span><span class="default">$lines</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$lines </span><span class="keyword">as </span><span class="default">$line</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Skip the empty line<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (empty(</span><span class="default">$line</span><span class="keyword">)) continue;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fields </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="default">$delimiter</span><span class="keyword">, </span><span class="default">$line</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$_res </span><span class="keyword">= </span><span class="default">$to_object </span><span class="keyword">? new </span><span class="default">stdClass </span><span class="keyword">: array();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$field_names </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$f</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$to_object</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$_res</span><span class="keyword">-&gt;{</span><span class="default">$f</span><span class="keyword">} = </span><span class="default">$fields</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$_res</span><span class="keyword">[</span><span class="default">$f</span><span class="keyword">] = </span><span class="default">$fields</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$res</span><span class="keyword">[] = </span><span class="default">$_res</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$res</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
NOTE:<br />
Line number 1 of the csv file will be considered as header (field names).<br />
<br />
TODO:<br />
- Enclosure handling<br />
- Escape character handling<br />
- Other features/enhancements as you need<br />
<br />
EXAMPLE USE:<br />
Content of /path/to/file.csv:<br />
CODE,COUNTRY<br />
AD,Andorra<br />
AE,United Arab Emirates<br />
AF,Afghanistan<br />
AG,Antigua and Barbuda<br />
<br />
<span class="default">&lt;?php<br />
$arr_csv </span><span class="keyword">= </span><span class="default">parse_csv</span><span class="keyword">(</span><span class="string">"/path/to/file.csv"</span><span class="keyword">);<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$arr_csv</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span>// Output:<br />
Array<br />
(<br />
&nbsp;&nbsp;&nbsp; [0] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [CODE] =&gt; AD<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [COUNTRY] =&gt; Andorra<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
&nbsp;&nbsp;&nbsp; [1] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [CODE] =&gt; AE<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [COUNTRY] =&gt; United Arab Emirates<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
&nbsp;&nbsp;&nbsp; [2] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [CODE] =&gt; AF<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [COUNTRY] =&gt; Afghanistan<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
&nbsp;&nbsp;&nbsp; [3] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [CODE] =&gt; AG<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [COUNTRY] =&gt; Antigua and Barbuda<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
)<br />
<br />
<span class="default">&lt;?php<br />
$obj_csv </span><span class="keyword">= </span><span class="default">parse_csv</span><span class="keyword">(</span><span class="string">"/path/to/file.csv"</span><span class="keyword">, array(</span><span class="string">"to_object" </span><span class="keyword">=&gt; </span><span class="default">true</span><span class="keyword">));<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$obj_csv</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span>// Output:<br />
Array<br />
(<br />
&nbsp;&nbsp;&nbsp; [0] =&gt; stdClass Object<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [CODE] =&gt; AD<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [COUNTRY] =&gt; Andorra&nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
&nbsp;&nbsp;&nbsp; [1] =&gt; stdClass Object<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [CODE] =&gt; AE<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [COUNTRY] =&gt; United Arab Emirates&nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
&nbsp;&nbsp;&nbsp; [2] =&gt; stdClass Object<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [CODE] =&gt; AF<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [COUNTRY] =&gt; Afghanistan&nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
&nbsp;&nbsp;&nbsp; [3] =&gt; stdClass Object<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [CODE] =&gt; AG<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [COUNTRY] =&gt; Antigua and Barbuda&nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
&nbsp;&nbsp;&nbsp; [4] =&gt; stdClass Object<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [CODE] =&gt; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [COUNTRY] =&gt; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
)<br />
<br />
// If you use character | (pipe) as delimiter in your csv file, use:<br />
<span class="default">&lt;?php<br />
$arr_csv </span><span class="keyword">= </span><span class="default">parse_csv</span><span class="keyword">(</span><span class="string">"/path/to/file.csv"</span><span class="keyword">, array(</span><span class="string">"delimiter"</span><span class="keyword">=&gt;</span><span class="string">"|"</span><span class="keyword">));<br />
</span><span class="default">?&gt;<br />
</span><br />
==NSD==</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82995""></a>
  <div class="note">
   <strong class="user">csv at rfc dot org</strong>
   <a href="#82995" class="date">05-May-2008 01:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
RFC 4180 which deals with CSVs states the escape character is supposed to be a double quotation mark: (page 2)<br />
&nbsp;&nbsp; 7.&nbsp; If double-quotes are used to enclose fields, then a double-quote<br />
&nbsp;&nbsp; &nbsp; &nbsp; appearing inside a field must be escaped by preceding it with<br />
&nbsp;&nbsp; &nbsp; &nbsp; another double quote.&nbsp; For example:<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; "aaa","b""bb","ccc"</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
