<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>The MongoDB\BSON\UTCDateTime class</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="mongodb-bson-timestamp.unserialize.html">? MongoDB\BSON\Timestamp::unserialize</a></li>
      <li style="float: right;"><a href="mongodb-bson-utcdatetime.construct.html">MongoDB\BSON\UTCDateTime::__construct ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="book.bson.html">MongoDB\BSON</a></li>
    <li>The MongoDB\BSON\UTCDateTime class</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="class.mongodb-bson-utcdatetime" class="reference">

 <h1 class="title">The MongoDB\BSON\UTCDateTime class</h1>
 

 <div class="partintro"><p class="verinfo">(mongodb &gt;=1.0.0)</p>


  <div class="section" id="mongodb-bson-utcdatetime.intro">
   <h2 class="title">简介</h2>
   <p class="para">
    Represents a
    <a href="https://docs.mongodb.com/manual/reference/bson-types/#date" class="link external" title="Link : https://docs.mongodb.com/manual/reference/bson-types/#date">&raquo;&nbsp;BSON date</a>. The value
    is a 64-bit integer that represents the number of milliseconds since the
    Unix epoch (Jan 1, 1970). Negative values represent dates before 1970.
   </p>
  </div>


  <div class="section" id="mongodb-bson-utcdatetime.synopsis">
   <h2 class="title">类摘要</h2>


   <div class="classsynopsis">
    <div class="ooclass"></div>


    <div class="classsynopsisinfo">
     <span class="modifier">final</span>
     <span class="ooclass">
      <strong class="classname">MongoDB\BSON\UTCDateTime</strong>
     </span>

     <span class="oointerface">implements 
      <span class="interfacename"><a href="class.mongodb-bson-utcdatetimeinterface.html" class="interfacename">MongoDB\BSON\UTCDateTimeInterface</a></span>
     </span>

     <span class="oointerface">, 
      <span class="interfacename"><a href="class.mongodb-bson-type.html" class="interfacename">MongoDB\BSON\Type</a></span>
     </span>

     <span class="oointerface">, 
      <span class="interfacename"><strong class="interfacename">Serializable</strong></span>
     </span>

     <span class="oointerface">, 
      <span class="interfacename"><a href="class.jsonserializable.html" class="interfacename">JsonSerializable</a></span>
     </span>
     {</div>

    
    <div class="classsynopsisinfo classsynopsisinfo_comment">/* 方法 */</div>
    <div class="methodsynopsis dc-description">
   <span class="modifier">final</span> <span class="modifier">public</span> <span class="methodname"><a href="mongodb-bson-utcdatetime.construct.html" class="methodname">__construct</a></span>
    ( <span class="methodparam"><span class="type"><span class="type">int</span>|<span class="type">float</span>|<span class="type">string</span>|<span class="type"><a href="class.datetimeinterface.html" class="type DateTimeInterface">DateTimeInterface</a></span></span> <code class="parameter">$milliseconds</code><span class="initializer"> = <strong><code>null</code></strong></span></span>
   )</div>
<div class="methodsynopsis dc-description">
   <span class="modifier">final</span> <span class="modifier">public</span> <span class="methodname"><a href="mongodb-bson-utcdatetime.jsonserialize.html" class="methodname">jsonSerialize</a></span>
    (
   ) : <span class="type"><a href="language.types.declarations.html#language.types.declarations.mixed" class="type mixed">mixed</a></span></div>
<div class="methodsynopsis dc-description">
   <span class="modifier">final</span> <span class="modifier">public</span> <span class="methodname"><a href="mongodb-bson-utcdatetime.serialize.html" class="methodname">serialize</a></span>
    (
   ) : <span class="type">string</span></div>
<div class="methodsynopsis dc-description">
   <span class="modifier">final</span> <span class="modifier">public</span> <span class="methodname"><a href="mongodb-bson-utcdatetime.todatetime.html" class="methodname">toDateTime</a></span>
    (
   ) : <span class="type"><a href="class.datetime.html" class="type DateTime">DateTime</a></span></div>
<div class="methodsynopsis dc-description">
   <span class="modifier">final</span> <span class="modifier">public</span> <span class="methodname"><a href="mongodb-bson-utcdatetime.tostring.html" class="methodname">__toString</a></span>
    (
   ) : <span class="type">string</span></div>
<div class="methodsynopsis dc-description">
   <span class="modifier">final</span> <span class="modifier">public</span> <span class="methodname"><a href="mongodb-bson-utcdatetime.unserialize.html" class="methodname">unserialize</a></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$serialized</code></span>
   ) : <span class="type"><span class="type void">void</span></span></div>

   }</div>


  </div>

  <div class="section">
   <h2 class="title">更新日志</h2>
   <p class="para">
    <table class="doctable informaltable">
     
      <thead>
       <tr>
        <th>版本</th>
        <th>说明</th>
       </tr>

      </thead>

      <tbody class="tbody">
       <tr>
        <td>PECL mongodb 1.3.0</td>
        <td>
         Implements <span class="interfacename"><a href="class.mongodb-bson-utcdatetimeinterface.html" class="interfacename">MongoDB\BSON\UTCDateTimeInterface</a></span>.
        </td>
       </tr>

       <tr>
        <td>PECL mongodb 1.2.0</td>
        <td>
         Implements <span class="interfacename"><strong class="interfacename">Serializable</strong></span> and
         <span class="interfacename"><a href="class.jsonserializable.html" class="interfacename">JsonSerializable</a></span>.
        </td>
       </tr>

      </tbody>
     
    </table>

   </p>
  </div>

 </div>

 
 






 






 






 






 






 







<h2>Table of Contents</h2><ul class="chunklist chunklist_reference"><li><a href="mongodb-bson-utcdatetime.construct.html">MongoDB\BSON\UTCDateTime::__construct</a> &mdash; Construct a new UTCDateTime</li><li><a href="mongodb-bson-utcdatetime.jsonserialize.html">MongoDB\BSON\UTCDateTime::jsonSerialize</a> &mdash; Returns a representation that can be converted to JSON</li><li><a href="mongodb-bson-utcdatetime.serialize.html">MongoDB\BSON\UTCDateTime::serialize</a> &mdash; Serialize a UTCDateTime</li><li><a href="mongodb-bson-utcdatetime.todatetime.html">MongoDB\BSON\UTCDateTime::toDateTime</a> &mdash; Returns the DateTime representation of this UTCDateTime</li><li><a href="mongodb-bson-utcdatetime.tostring.html">MongoDB\BSON\UTCDateTime::__toString</a> &mdash; Returns the string representation of this UTCDateTime</li><li><a href="mongodb-bson-utcdatetime.unserialize.html">MongoDB\BSON\UTCDateTime::unserialize</a> &mdash; Unserialize a UTCDateTime</li></ul>
</div>
<div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="122989""></a>
  <div class="note">
   <strong class="user">Stephen</strong>
   <a href="#122989" class="date">30-Jul-2018 08:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When using MongoDB\BSON\UTCDateTime to query be sure for instances of strtotime you are putting the constructor in milliseconds:<br />
<br />
$start = new MongoDB\BSON\UTCDateTime(strtotime("midnight") * 1000);<br />
$filter = ['date' =&gt; ['$gte' =&gt; $start]];<br />
$options = ['sort' =&gt; ['date' =&gt; -1]];<br />
$query = new MongoDB\Driver\Query($filter,$options);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="122012""></a>
  <div class="note">
   <strong class="user">mike at brenden dot com</strong>
   <a href="#122012" class="date">12-Dec-2017 07:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
SOURCE [url]https://github.com/mongodb/mongo-php-driver/issues/187[/url]<br />
<br />
MichaelBrenden --<br />
<br />
How do the two Mongo drivers determine if they can translate something into the ISODate format?<br />
<br />
Does mongo.so require a class type of MongoDate, or does it determine by data returned by __toString() (i.e., "0.12345678 1234567890")?<br />
<br />
Does mongodb.so require a class type of \MongoDB\BSON\UTCDateTime, or does it determine by data returned by __toString() (i.e., "1234567890123")?<br />
<br />
jmikola --<br />
<br />
&gt;&gt; the ISODate format?<br />
<br />
For the record, ISODate is just a helper function in the mongo shell. The actual BSON type is 0x09 in the BSON spec and is best referred to as "UTC date time".<br />
[url]https://docs.mongodb.com/manual/core/shell-types/#return-date[/url]<br />
[url]<a href="http://bsonspec.org/spec.html[/url]" rel="nofollow" target="_blank">http://bsonspec.org/spec.html[/url]</a><br />
<br />
&nbsp;&gt;&gt; Does mongodb.so require a class type of \MongoDB\BSON\UTCDateTime, or does it determine by data returned by __toString() (i.e., "1234567890123")?<br />
<br />
The driver requires a MongoDB\BSON\UTCDateTime object in order to encode a BSON date type. The relevant instanceof check during BSON encoding is here if you care to see it. The __toString() function exists purely as a convenience for userland applications. The driver does not use it outside of tests.<br />
[url]https://github.com/mongodb/mongo-php-driver/blob/1.3.4/src/bson-encode.c#L215[/url]<br />
<br />
The legacy mongo.so driver is similar in that it requires a MongoDate object in order to encode a BSON date type (relevant code is here).<br />
[url]https://github.com/mongodb/mongo-php-driver-legacy/blob/1.6.16/bson.c#L273[/url]</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="120091""></a>
  <div class="note">
   <strong class="user">mark at DONTSPAM dot moderndeveloperllc dot com</strong>
   <a href="#120091" class="date">27-Oct-2016 02:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Be careful using UTCDateTime if you need microsecond precision as this class only stores time to the _millisecond_. You need to store the date as a string in MongoDB if you want the full precision. Casting DateTime to a float can also remove precision.<br />
<br />
An easy way to see the differences is with:<br />
<br />
Code:<br />
var_dump(<br />
&nbsp; (new DateTime)-&gt;format('U.u'), <br />
&nbsp; (float) (new DateTime)-&gt;format('U.u'), <br />
&nbsp; (new MongoDB\BSON\UTCDateTime())-&gt;toDateTime()-&gt;format('U.u')<br />
);<br />
<br />
Output:<br />
string(17) "1477534060.918415"<br />
double(1477534060.9185)<br />
string(17) "1477534060.918000"<br />
<br />
NOTE: Lots of bugs concerning microsecond formatting for DateTimeInterface classes were fixed as of PHP 7.1.0 RC4. The above code is from PHP 7.1.0 RC5 and mongodb 1.2.0alpha3. The 1.2.0 version of the extension added the ability to instantiate this class without passing integer milliseconds.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
