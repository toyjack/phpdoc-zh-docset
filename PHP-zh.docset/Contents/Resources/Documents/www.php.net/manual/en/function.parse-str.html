<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>将字符串解析成多个变量</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.ord.html">? ord</a></li>
      <li style="float: right;"><a href="function.print.html">print ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.strings.html">字符串 函数</a></li>
    <li>将字符串解析成多个变量</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.parse-str" class="refentry">
    <div class="refnamediv">
  <h1 class="refname">parse_str</h1>
  <p class="verinfo">(PHP 4, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">parse_str</span> &mdash; <span class="dc-title">将字符串解析成多个变量</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.parse-str-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>parse_str</strong></span>(<span class="methodparam"><span class="type">string</span> <code class="parameter">$string</code></span>, <span class="methodparam"><span class="type">array</span> <code class="parameter reference">&$result</code></span>): <span class="type"><span class="type void">void</span></span></div>

  <p class="para rdfs-comment">
   如果 <code class="parameter">string</code> 是 URL 传递入的查询字符串（query string），则将它解析为变量并设置到当前作用域（如果提供了 <code class="parameter">result</code> 则会设置到该数组里 ）。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.parse-str-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>
    
     <dt>
<code class="parameter">string</code></dt>

     <dd>

      <p class="para">
       输入的字符串。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">result</code></dt>

     <dd>

      <p class="para">
       如果设置了第二个变量 <code class="parameter">result</code>，
       变量将会以数组元素的形式存入到这个数组，作为替代。
      </p>

      <div class="warning"><strong class="warning">Warning</strong>
       <p class="para">
        极度<em class="emphasis">不建议</em> 在没有 <code class="parameter">result</code> 参数的情况下使用此函数，
        并且在  PHP 7.2 中将<em class="emphasis">废弃</em>不设置参数的行为。
       </p>
      </div>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.parse-str-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   没有返回值。
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.parse-str-changelog">
  <h3 class="title">更新日志</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead>
      <tr>
       <th>版本</th>
       <th>说明</th>
      </tr>

     </thead>

     <tbody class="tbody">
     <tr>
        <td>8.0.0</td>
        <td>
         <code class="parameter">result</code> 是必须项。
        </td>
       </tr>

      <tr>
       <td>7.2.0</td>
       <td>
        不带第二个参数的情况下使用 <span class="function"><strong>parse_str()</strong></span> 会产生 
        <strong><code>E_DEPRECATED</code></strong> 警告。
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.parse-str-examples">
  <h3 class="title">范例</h3>
  <p class="para">
   <div class="example" id="example-4698">
    <p><strong>Example #1 <span class="function"><strong>parse_str()</strong></span> 的使用</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$str&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"first=value&amp;arr[]=foo+bar&amp;arr[]=baz"</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//&nbsp;推荐用法<br /></span><span style="color: #0000BB">parse_str</span><span style="color: #007700">(</span><span style="color: #0000BB">$str</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$output</span><span style="color: #007700">);<br />echo&nbsp;</span><span style="color: #0000BB">$output</span><span style="color: #007700">[</span><span style="color: #DD0000">'first'</span><span style="color: #007700">];&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;value<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">$output</span><span style="color: #007700">[</span><span style="color: #DD0000">'arr'</span><span style="color: #007700">][</span><span style="color: #0000BB">0</span><span style="color: #007700">];&nbsp;</span><span style="color: #FF8000">//&nbsp;foo&nbsp;bar<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">$output</span><span style="color: #007700">[</span><span style="color: #DD0000">'arr'</span><span style="color: #007700">][</span><span style="color: #0000BB">1</span><span style="color: #007700">];&nbsp;</span><span style="color: #FF8000">//&nbsp;baz<br /><br />//&nbsp;不建议这么用<br /></span><span style="color: #0000BB">parse_str</span><span style="color: #007700">(</span><span style="color: #0000BB">$str</span><span style="color: #007700">);<br />echo&nbsp;</span><span style="color: #0000BB">$first</span><span style="color: #007700">;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;value<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">$arr</span><span style="color: #007700">[</span><span style="color: #0000BB">0</span><span style="color: #007700">];&nbsp;</span><span style="color: #FF8000">//&nbsp;foo&nbsp;bar<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">$arr</span><span style="color: #007700">[</span><span style="color: #0000BB">1</span><span style="color: #007700">];&nbsp;</span><span style="color: #FF8000">//&nbsp;baz<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
  <p class="para">
   由于 PHP 的变量名不能带「点」和「空格」，所以它们会被转化成下划线。
   用本函数带 <code class="parameter">result</code> 参数，也会应用同样规则到数组的键名。
   <div class="example" id="example-4699">
    <p><strong>Example #2 <span class="function"><strong>parse_str()</strong></span> 名称改写</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />parse_str</span><span style="color: #007700">(</span><span style="color: #DD0000">"My&nbsp;Value=Something"</span><span style="color: #007700">);<br />echo&nbsp;</span><span style="color: #0000BB">$My_Value</span><span style="color: #007700">;&nbsp;</span><span style="color: #FF8000">//&nbsp;Something<br /><br /></span><span style="color: #0000BB">parse_str</span><span style="color: #007700">(</span><span style="color: #DD0000">"My&nbsp;Value=Something"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$output</span><span style="color: #007700">);<br />echo&nbsp;</span><span style="color: #0000BB">$output</span><span style="color: #007700">[</span><span style="color: #DD0000">'My_Value'</span><span style="color: #007700">];&nbsp;</span><span style="color: #FF8000">//&nbsp;Something<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p> 
 </div>

 
 <div class="refsect1 notes" id="refsect1-function.parse-str-notes">
  <h3 class="title">注释</h3>

  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    所有创建的变量(或者在设置第二个参数的情况下，返回数组里的值)，
    都已经 <span class="function"><a href="function.urldecode.html" class="function">urldecode()</a></span> 了。
   </p>
  </p></blockquote>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    要获取当前的 <code class="literal">QUERY_STRING</code>，可以使用
    <var class="varname"><a href="reserved.variables.server.html" class="classname">$_SERVER['QUERY_STRING']</a></var> 变量。
    所以你可能想要阅读
    <a href="language.variables.external.html" class="link">来自 PHP 之外的变量</a>这个章节。
   </p>
  </p></blockquote>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    本函数受 <a href="info.configuration.html#ini.magic-quotes-gpc" class="link">magic_quotes_gpc</a> 设置的影响，
    和 <var class="varname"><a href="reserved.variables.get.html" class="classname">$_GET</a></var>、
    <var class="varname"><a href="reserved.variables.post.html" class="classname">$_POST</a></var> 在 PHP 中填充变量相似， <span class="function"><strong>parse_str()</strong></span> 也使用了同样的机制。
   </p>
  </p></blockquote>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.parse-str-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.parse-url.html" class="function" rel="rdfs-seeAlso">parse_url()</a> - 解析 URL，返回其组成部分</span></li>
    <li class="member"><span class="function"><a href="function.pathinfo.html" class="function" rel="rdfs-seeAlso">pathinfo()</a> - 返回文件路径的信息</span></li>
    <li class="member"><span class="function"><a href="function.http-build-query.html" class="function" rel="rdfs-seeAlso">http_build_query()</a> - 生成 URL-encode 之后的请求字符串</span></li>
    <li class="member"><span class="function"><a href="function.urldecode.html" class="function" rel="rdfs-seeAlso">urldecode()</a> - 解码已编码的 URL 字符串</span></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="126789""></a>
  <div class="note">
   <strong class="user">Roemer Lievaart</strong>
   <a href="#126789" class="date">21-Jan-2022 09:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you need the key names preserved and don't want spaces or . or unmatched [ or ] replaced by an underscore, yet you want all the other goodies of parse_str(), like turning matched [] into array elements, you can use this code as a base for that.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">const </span><span class="default">periodPlaceholder </span><span class="keyword">= </span><span class="string">'QQleQPunT'</span><span class="keyword">;<br />
const </span><span class="default">spacePlaceholder </span><span class="keyword">= </span><span class="string">'QQleQSpaTIE'</span><span class="keyword">;<br />
<br />
function </span><span class="default">parse_str_clean</span><span class="keyword">(</span><span class="default">$querystr</span><span class="keyword">): array {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// without the converting of spaces and dots etc to underscores.<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$qquerystr </span><span class="keyword">= </span><span class="default">str_ireplace</span><span class="keyword">([</span><span class="string">'.'</span><span class="keyword">,</span><span class="string">'%2E'</span><span class="keyword">,</span><span class="string">'+'</span><span class="keyword">,</span><span class="string">' '</span><span class="keyword">,</span><span class="string">'%20'</span><span class="keyword">], [</span><span class="default">periodPlaceholder</span><span class="keyword">,</span><span class="default">periodPlaceholder</span><span class="keyword">,</span><span class="default">spacePlaceholder</span><span class="keyword">,</span><span class="default">spacePlaceholder</span><span class="keyword">,</span><span class="default">spacePlaceholder</span><span class="keyword">], </span><span class="default">$querystr</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$arr </span><span class="keyword">= </span><span class="default">null </span><span class="keyword">; </span><span class="default">parse_str</span><span class="keyword">(</span><span class="default">$qquerystr</span><span class="keyword">, </span><span class="default">$arr</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">sanitizeKeys</span><span class="keyword">(</span><span class="default">$arr</span><span class="keyword">, </span><span class="default">$querystr</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$arr</span><span class="keyword">;<br />
}<br />
<br />
function </span><span class="default">sanitizeKeys</span><span class="keyword">(&amp;</span><span class="default">$arr</span><span class="keyword">, </span><span class="default">$querystr</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; foreach(</span><span class="default">$arr </span><span class="keyword">as </span><span class="default">$key</span><span class="keyword">=&gt;</span><span class="default">$val</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// restore values to original<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$newval </span><span class="keyword">= </span><span class="default">$val </span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( </span><span class="default">is_string</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$newval </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">([</span><span class="default">periodPlaceholder</span><span class="keyword">,</span><span class="default">spacePlaceholder</span><span class="keyword">], [</span><span class="string">"."</span><span class="keyword">,</span><span class="string">" "</span><span class="keyword">], </span><span class="default">$val</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$newkey </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">([</span><span class="default">periodPlaceholder</span><span class="keyword">,</span><span class="default">spacePlaceholder</span><span class="keyword">], [</span><span class="string">"."</span><span class="keyword">,</span><span class="string">" "</span><span class="keyword">], </span><span class="default">$key</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( </span><span class="default">str_contains</span><span class="keyword">(</span><span class="default">$newkey</span><span class="keyword">, </span><span class="string">'_'</span><span class="keyword">) ) { <br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// periode of space or [ or ] converted to _. Restore with querystring<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$regex </span><span class="keyword">= </span><span class="string">'/&amp;('</span><span class="keyword">.</span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'_'</span><span class="keyword">, </span><span class="string">'[ \.\[\]]'</span><span class="keyword">, </span><span class="default">preg_quote</span><span class="keyword">(</span><span class="default">$newkey</span><span class="keyword">, </span><span class="string">'/'</span><span class="keyword">)).</span><span class="string">')=/'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$matches </span><span class="keyword">= </span><span class="default">null </span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ( </span><span class="default">preg_match_all</span><span class="keyword">(</span><span class="default">$regex</span><span class="keyword">, </span><span class="string">"&amp;"</span><span class="keyword">.</span><span class="default">urldecode</span><span class="keyword">(</span><span class="default">$querystr</span><span class="keyword">), </span><span class="default">$matches</span><span class="keyword">) ) {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ( </span><span class="default">count</span><span class="keyword">(</span><span class="default">array_unique</span><span class="keyword">(</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">])) === </span><span class="default">1 </span><span class="keyword">&amp;&amp; </span><span class="default">$key </span><span class="keyword">!= </span><span class="default">$matches</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">] ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$newkey </span><span class="keyword">= </span><span class="default">$matches</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">] ;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( </span><span class="default">$newkey </span><span class="keyword">!= </span><span class="default">$key </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; unset(</span><span class="default">$arr</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$arr</span><span class="keyword">[</span><span class="default">$newkey</span><span class="keyword">] = </span><span class="default">$newval </span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } elseif( </span><span class="default">$val </span><span class="keyword">!= </span><span class="default">$newval </span><span class="keyword">) <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$arr</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">] = </span><span class="default">$newval</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( </span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">sanitizeKeys</span><span class="keyword">(</span><span class="default">$arr</span><span class="keyword">[</span><span class="default">$newkey</span><span class="keyword">], </span><span class="default">$querystr</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
For example:<br />
<br />
parse_str_clean("code.1=printr%28hahaha&amp;code 1=448044&amp;test.mijn%5B%5D%5B2%5D=test%20Roemer&amp;test%5Bmijn=test%202e%20Roemer");<br />
<br />
Produces:<br />
<br />
array(4) {<br />
&nbsp; ["code.1"]=&gt;<br />
&nbsp; string(13) "printr(hahaha"<br />
&nbsp; ["code 1"]=&gt;<br />
&nbsp; string(6) "448044"<br />
&nbsp; ["test.mijn"]=&gt;<br />
&nbsp; array(1) {<br />
&nbsp;&nbsp;&nbsp; [0]=&gt;<br />
&nbsp;&nbsp;&nbsp; array(1) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; [2]=&gt;<br />
&nbsp;&nbsp; &nbsp;&nbsp; string(11) "test Roemer"<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
&nbsp; ["test[mijn"]=&gt;<br />
&nbsp; string(14) "test 2e Roemer"<br />
}<br />
<br />
Whereas if you feed the same querystring to parse_str, you will get<br />
<br />
array(2) {<br />
&nbsp; ["code_1"]=&gt;<br />
&nbsp; string(6) "448044"<br />
&nbsp; ["test_mijn"]=&gt;<br />
&nbsp; string(14) "test 2e Roemer"<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="126160""></a>
  <div class="note">
   <strong class="user">kawewong at gmail dot com</strong>
   <a href="#126160" class="date">11-Jun-2021 09:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Warning: `parse_str()` can cause "Input variables exceeded 1000" error (1000 is default php.ini setting for `max_input_vars`).<br />
<br />
Test code.<br />
<br />
<span class="default">&lt;?php<br />
<br />
$inputString </span><span class="keyword">= </span><span class="string">'first=firstvalue'</span><span class="keyword">;<br />
<br />
for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt;= </span><span class="default">1100</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$inputString </span><span class="keyword">.= </span><span class="string">'&amp;arrLoopNumber[]=' </span><span class="keyword">. </span><span class="default">$i</span><span class="keyword">;<br />
}<br />
unset(</span><span class="default">$i</span><span class="keyword">);<br />
<br />
echo </span><span class="string">'input string: &lt;code&gt;' </span><span class="keyword">. </span><span class="default">$inputString </span><span class="keyword">. </span><span class="string">'&lt;/code&gt;&lt;br&gt;' </span><span class="keyword">. </span><span class="default">PHP_EOL</span><span class="keyword">;<br />
echo </span><span class="string">'&lt;h5&gt;doing &lt;code&gt;parse_str()&lt;/code&gt;&lt;/h5&gt;' </span><span class="keyword">. </span><span class="default">PHP_EOL</span><span class="keyword">;<br />
<br />
</span><span class="default">$output </span><span class="keyword">= [];<br />
</span><span class="default">parse_str</span><span class="keyword">(</span><span class="default">$inputString</span><span class="keyword">, </span><span class="default">$output</span><span class="keyword">);<br />
</span><span class="comment">// errors!!<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="122294""></a>
  <div class="note">
   <strong class="user">twiddly</strong>
   <a href="#122294" class="date">21-Jan-2018 10:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
proper_parse_str works great and I like that it doesn't replace spaces with underbars, but should urldecode $value</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="119484""></a>
  <div class="note">
   <strong class="user">alxcube at gmail dot com</strong>
   <a href="#119484" class="date">18-Jun-2016 06:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
if you need custom arg separator, you can use this function. it returns parsed&nbsp; query as associative array.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">/**<br />
&nbsp;* Parses http query string into an array<br />
&nbsp;* <br />
&nbsp;* @author Alxcube &lt;alxcube@gmail.com&gt;<br />
&nbsp;* <br />
&nbsp;* @param string $queryString String to parse<br />
&nbsp;* @param string $argSeparator Query arguments separator<br />
&nbsp;* @param integer $decType Decoding type<br />
&nbsp;* @return array<br />
&nbsp;*/<br />
</span><span class="keyword">function </span><span class="default">http_parse_query</span><span class="keyword">(</span><span class="default">$queryString</span><span class="keyword">, </span><span class="default">$argSeparator </span><span class="keyword">= </span><span class="string">'&amp;'</span><span class="keyword">, </span><span class="default">$decType </span><span class="keyword">= </span><span class="default">PHP_QUERY_RFC1738</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$parts&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="default">$argSeparator</span><span class="keyword">, </span><span class="default">$queryString</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$parts </span><span class="keyword">as </span><span class="default">$part</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; list(</span><span class="default">$paramName</span><span class="keyword">, </span><span class="default">$paramValue</span><span class="keyword">)&nbsp;&nbsp; = </span><span class="default">explode</span><span class="keyword">(</span><span class="string">'='</span><span class="keyword">, </span><span class="default">$part</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; switch (</span><span class="default">$decType</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">PHP_QUERY_RFC3986</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$paramName&nbsp; &nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">rawurldecode</span><span class="keyword">(</span><span class="default">$paramName</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$paramValue&nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">rawurldecode</span><span class="keyword">(</span><span class="default">$paramValue</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">PHP_QUERY_RFC1738</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; default:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$paramName&nbsp; &nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">urldecode</span><span class="keyword">(</span><span class="default">$paramName</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$paramValue&nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">urldecode</span><span class="keyword">(</span><span class="default">$paramValue</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">preg_match_all</span><span class="keyword">(</span><span class="string">'/\[([^\]]*)\]/m'</span><span class="keyword">, </span><span class="default">$paramName</span><span class="keyword">, </span><span class="default">$matches</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$paramName&nbsp; &nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$paramName</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$paramName</span><span class="keyword">, </span><span class="string">'['</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$keys&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">array_merge</span><span class="keyword">(array(</span><span class="default">$paramName</span><span class="keyword">), </span><span class="default">$matches</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$keys&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">= array(</span><span class="default">$paramName</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$target&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">= &amp;</span><span class="default">$result</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$keys </span><span class="keyword">as </span><span class="default">$index</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$index </span><span class="keyword">=== </span><span class="string">''</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (isset(</span><span class="default">$target</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$target</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$intKeys&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">array_filter</span><span class="keyword">(</span><span class="default">array_keys</span><span class="keyword">(</span><span class="default">$target</span><span class="keyword">), </span><span class="string">'is_int'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$index&nbsp; </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$intKeys</span><span class="keyword">) ? </span><span class="default">max</span><span class="keyword">(</span><span class="default">$intKeys</span><span class="keyword">)+</span><span class="default">1 </span><span class="keyword">: </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$target </span><span class="keyword">= array(</span><span class="default">$target</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$index&nbsp; </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$target&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$index&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } elseif (isset(</span><span class="default">$target</span><span class="keyword">[</span><span class="default">$index</span><span class="keyword">]) &amp;&amp; !</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$target</span><span class="keyword">[</span><span class="default">$index</span><span class="keyword">])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$target</span><span class="keyword">[</span><span class="default">$index</span><span class="keyword">] = array(</span><span class="default">$target</span><span class="keyword">[</span><span class="default">$index</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$target&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">= &amp;</span><span class="default">$target</span><span class="keyword">[</span><span class="default">$index</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$target</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$target</span><span class="keyword">[]&nbsp;&nbsp; = </span><span class="default">$paramValue</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$target&nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">$paramValue</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$result</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="118008""></a>
  <div class="note">
   <strong class="user">StanE</strong>
   <a href="#118008" class="date">17-Sep-2015 09:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that the characters "." and " " (empty space) will be converted to "_". The characters "[" and "]" have special meaning: They represent arrays but there seems to be some weird behaviour, which I don't really understand:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// Note: "[" = %5B, "]" = %5D<br />
<br />
/*<br />
"v][=a" produces ("[" gets replaced by "_"):<br />
Array<br />
(<br />
&nbsp;&nbsp;&nbsp; [v]_] =&gt; a<br />
)<br />
*/<br />
</span><span class="default">parse_str</span><span class="keyword">(</span><span class="string">"v%5D%5B=a"</span><span class="keyword">, </span><span class="default">$r</span><span class="keyword">);<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$r</span><span class="keyword">);<br />
<br />
</span><span class="comment">/*<br />
"v][[=a" produces (first "[" gets replaced by "_", but not all following):<br />
Array<br />
(<br />
&nbsp;&nbsp;&nbsp; [v]_[] =&gt; a<br />
)<br />
*/<br />
</span><span class="default">parse_str</span><span class="keyword">(</span><span class="string">"v%5D%5B%5B=a"</span><span class="keyword">, </span><span class="default">$r</span><span class="keyword">);<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$r</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="117183""></a>
  <div class="note">
   <strong class="user">zweibieren at yahoo dot com</strong>
   <a href="#117183" class="date">27-Apr-2015 03:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If the arr argument is provided, all its existing elements are removed.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="112568""></a>
  <div class="note">
   <strong class="user">markc</strong>
   <a href="#112568" class="date">30-Jun-2013 04:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Beware using parse_str in a function that has vars passed by reference. It seems that parse_str actually creates new vars even if vars of the same name exist. If you pass by ref vars of the same name as those in a query string being parsed new LOCAL vers will be created and you won't get any values passed back to the caller (relates to what Maikel mentioned below)<br />
<br />
An unrealistic example (vaguely related to what I was doing when I found this out)...<br />
<br />
function get_title($query,&amp;$title)<br />
{<br />
&nbsp; parse_str($query);<br />
&nbsp; $title=str_replace("_"," ",$title);<br />
}<br />
<br />
$title="foo";<br />
$query = "context=something&amp;title=Title_of_Something";<br />
get_title($query,$title);<br />
<br />
echo $title .... "foo"</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="109212""></a>
  <div class="note">
   <strong class="user">jrgns at jadeit dot co dot za</strong>
   <a href="#109212" class="date">27-Jun-2012 08:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The array to be populated does not need to be defined before calling the function:<br />
<br />
<span class="default">&lt;?php<br />
error_reporting</span><span class="keyword">(</span><span class="default">E_ALL </span><span class="keyword">| </span><span class="default">E_STRICT</span><span class="keyword">);<br />
</span><span class="default">parse_str</span><span class="keyword">(</span><span class="string">'var=value'</span><span class="keyword">, </span><span class="default">$array</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
This will not produce a notice.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="108642""></a>
  <div class="note">
   <strong class="user">shagshag</strong>
   <a href="#108642" class="date">14-May-2012 05:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
That's not says in the description but max_input_vars directive affects this function. If there are more input variables on the string than specified by this directive, an E_WARNING is issued, and further input variables are truncated from the request.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="108435""></a>
  <div class="note">
   <strong class="user">Benjamin Garcia</strong>
   <a href="#108435" class="date">26-Apr-2012 09:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
function like parse_str, but doesn't convert spaces and dots to underscores in $_GET AND $_POST<br />
<br />
/**<br />
&nbsp;* GET and POST input containing dots, etc.<br />
&nbsp;*/<br />
function getRealREQUEST() {<br />
&nbsp;&nbsp;&nbsp; $vars = array();<br />
<br />
&nbsp;&nbsp;&nbsp; $input&nbsp; &nbsp; = $_SERVER['REDIRECT_QUERY_STRING'];<br />
&nbsp;&nbsp;&nbsp; if(!empty($input)){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $pairs&nbsp; &nbsp; = explode("&amp;", $input);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach ($pairs&nbsp; &nbsp;&nbsp; as $pair) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $nv&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = explode("=", $pair);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = urldecode($nv[0]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $nameSanitize&nbsp; &nbsp; = preg_replace('/([^\[]*)\[.*$/','$1',$name);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $nameMatched&nbsp; &nbsp; = str_replace('.','_',$nameSanitize);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $nameMatched&nbsp; &nbsp; = str_replace(' ','_',$nameMatched);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $vars[$nameSanitize]&nbsp; &nbsp; = $_REQUEST[$nameMatched];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; $input&nbsp; &nbsp; = file_get_contents("php://input");<br />
&nbsp;&nbsp;&nbsp; if(!empty($input)){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $pairs&nbsp; &nbsp; = explode("&amp;", $input);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach ($pairs as $pair) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $nv&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = explode("=", $pair);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = urldecode($nv[0]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $nameSanitize&nbsp; &nbsp; = preg_replace('/([^\[]*)\[.*$/','$1',$name);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $nameMatched&nbsp; &nbsp; = str_replace('.','_',$nameSanitize);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $nameMatched&nbsp; &nbsp; = str_replace(' ','_',$nameMatched);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $vars[$nameSanitize]&nbsp; &nbsp; = $_REQUEST[$nameMatched];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; return $vars;<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99364""></a>
  <div class="note">
   <strong class="user">Will Voelcker</strong>
   <a href="#99364" class="date">12-Aug-2010 11:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you need a function that does something similar to parse_str, but doesn't convert spaces and dots to underscores, try something like the following:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">parseQueryString</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$op </span><span class="keyword">= array();
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$pairs </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">"&amp;"</span><span class="keyword">, </span><span class="default">$str</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$pairs </span><span class="keyword">as </span><span class="default">$pair</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; list(</span><span class="default">$k</span><span class="keyword">, </span><span class="default">$v</span><span class="keyword">) = </span><span class="default">array_map</span><span class="keyword">(</span><span class="string">"urldecode"</span><span class="keyword">, </span><span class="default">explode</span><span class="keyword">(</span><span class="string">"="</span><span class="keyword">, </span><span class="default">$pair</span><span class="keyword">));
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$op</span><span class="keyword">[</span><span class="default">$k</span><span class="keyword">] = </span><span class="default">$v</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$op</span><span class="keyword">;
<br />
}
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
It may need adapting to handle various edge cases.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84165""></a>
  <div class="note">
   <strong class="user">tobsn at php dot net</strong>
   <a href="#84165" class="date">01-Jul-2008 11:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
just a heads up with the example above:<br />
?var[]=123 - the [] has to be urlencoded.<br />
var names and var values - both have to be urlencoded!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82837""></a>
  <div class="note">
   <strong class="user">helpmepro1 at gmail dot com</strong>
   <a href="#82837" class="date">28-Apr-2008 09:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
&lt;? <br />
//by shimon doodkin<br />
<br />
&nbsp;$url_form=url_to_form($url);<br />
&nbsp;echo '&lt;form action="'.$url_form['action'].'" method="get"&gt;';<br />
&nbsp;echo $url_form['hidden'];<br />
&nbsp;echo '&lt;input name="otherfiled" type="text"&gt;';<br />
&nbsp;echo '&lt;input type="submit"&gt;';<br />
&nbsp;echo '&lt;/form&gt;';<br />
<br />
&nbsp;function url_to_form($url)<br />
&nbsp;{<br />
&nbsp; $url=split('\?',$url,2);<br />
&nbsp; $action=$url[0];<br />
&nbsp; $hidden="";<br />
&nbsp; if(isset($url[1]))<br />
&nbsp; {<br />
&nbsp;&nbsp; $pairs=split('&amp;',$url[1]);<br />
&nbsp;&nbsp; foreach($pairs as $pair)<br />
&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; $pair=split('=',$pair,2);<br />
&nbsp;&nbsp;&nbsp; $name=$pair[0];<br />
&nbsp;&nbsp;&nbsp; if(isset($pair[1]))<br />
&nbsp;&nbsp; &nbsp; $value=$pair[1];<br />
&nbsp;&nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; $value='';<br />
&nbsp;&nbsp;&nbsp; $name=$name;<br />
&nbsp;&nbsp;&nbsp; $value=htmlspecialchars($value);<br />
&nbsp;&nbsp;&nbsp; if($name!='')<br />
&nbsp;&nbsp; &nbsp; $hidden.='&lt;hidden name="'.$name.'" value="'.$value.'"&gt;';<br />
&nbsp;&nbsp; }<br />
&nbsp; }<br />
&nbsp; return array('action'=&gt;$action,'hidden'=&gt;$hidden);<br />
&nbsp;}<br />
<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="79154""></a>
  <div class="note">
   <strong class="user">chris at mcfadyen dot ca</strong>
   <a href="#79154" class="date">13-Nov-2007 04:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I shouldn't've posted the original version, as it only worked with the most basic of query strings.<br />
<br />
This function will parse an html-safe query-like url string for variables and php-like ordered and associative arrays.&nbsp; It places them into the global scope as parse_str does and adds minimal slashes for database insertions without the triple-slash problems that magic quotes can produce (the reason I had to write it in the first place).&nbsp; If you don't need the slashes, they're easy enough to remove.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">parse_query</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Separate all name-value pairs<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$pairs </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">'&amp;'</span><span class="keyword">, </span><span class="default">$str</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; foreach(</span><span class="default">$pairs </span><span class="keyword">as </span><span class="default">$pair</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Pull out the names and the values<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">list(</span><span class="default">$name</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">) = </span><span class="default">explode</span><span class="keyword">(</span><span class="string">'='</span><span class="keyword">, </span><span class="default">$pair</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Decode the variable name and look for arrays<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">list(</span><span class="default">$name</span><span class="keyword">, </span><span class="default">$index</span><span class="keyword">) = </span><span class="default">split</span><span class="keyword">(</span><span class="string">'[][]'</span><span class="keyword">, </span><span class="default">urldecode</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Arrays<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(isset(</span><span class="default">$index</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Declare or add to the global array defined by $name<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">global $</span><span class="default">$name</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(!isset($</span><span class="default">$name</span><span class="keyword">)) $</span><span class="default">$name </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Associative array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">$index </span><span class="keyword">!= </span><span class="string">""</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ${</span><span class="default">$name</span><span class="keyword">}[</span><span class="default">$index</span><span class="keyword">] = </span><span class="default">addslashes</span><span class="keyword">(</span><span class="default">urldecode</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Ordered array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">} else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">array_push</span><span class="keyword">($</span><span class="default">$name</span><span class="keyword">, </span><span class="default">addslashes</span><span class="keyword">(</span><span class="default">urldecode</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">)));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Variables<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">} else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Declare or overwrite the global variable defined by $name<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">global $</span><span class="default">$name</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $</span><span class="default">$name </span><span class="keyword">= </span><span class="default">addslashes</span><span class="keyword">(</span><span class="default">urldecode</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="78882""></a>
  <div class="note">
   <strong class="user">chris at mcfadyen dot ca</strong>
   <a href="#78882" class="date">31-Oct-2007 08:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you wish a version of parse_str sans magic quotes, the following will do the trick:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">parse_query</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$pairs </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">'&amp;'</span><span class="keyword">, </span><span class="default">$str</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; foreach(</span><span class="default">$pairs </span><span class="keyword">as </span><span class="default">$pair</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; list(</span><span class="default">$name</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">) = </span><span class="default">explode</span><span class="keyword">(</span><span class="string">'='</span><span class="keyword">, </span><span class="default">$pair</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; global $</span><span class="default">$name</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $</span><span class="default">$name </span><span class="keyword">= </span><span class="default">$value</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76792""></a>
  <div class="note">
   <strong class="user">Evan K</strong>
   <a href="#76792" class="date">30-Jul-2007 07:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It bears mentioning that the parse_str builtin does NOT process a query string in the CGI standard way, when it comes to duplicate fields.&nbsp; If multiple fields of the same name exist in a query string, every other web processing language would read them into an array, but PHP silently overwrites them:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment"># silently fails to handle multiple values<br />
</span><span class="default">parse_str</span><span class="keyword">(</span><span class="string">'foo=1&amp;foo=2&amp;foo=3'</span><span class="keyword">);<br />
<br />
</span><span class="comment"># the above produces:<br />
</span><span class="default">$foo </span><span class="keyword">= array(</span><span class="string">'foo' </span><span class="keyword">=&gt; </span><span class="string">'3'</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Instead, PHP uses a non-standards compliant practice of including brackets in fieldnames to achieve the same effect.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment"># bizarre php-specific behavior<br />
</span><span class="default">parse_str</span><span class="keyword">(</span><span class="string">'foo[]=1&amp;foo[]=2&amp;foo[]=3'</span><span class="keyword">);<br />
<br />
</span><span class="comment"># the above produces:<br />
</span><span class="default">$foo </span><span class="keyword">= array(</span><span class="string">'foo' </span><span class="keyword">=&gt; array(</span><span class="string">'1'</span><span class="keyword">, </span><span class="string">'2'</span><span class="keyword">, </span><span class="string">'3'</span><span class="keyword">) );<br />
</span><span class="default">?&gt;<br />
</span><br />
This can be confusing for anyone who's used to the CGI standard, so keep it in mind.&nbsp; As an alternative, I use a "proper" querystring parser function:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">proper_parse_str</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">) {<br />
&nbsp; </span><span class="comment"># result array<br />
&nbsp; </span><span class="default">$arr </span><span class="keyword">= array();<br />
<br />
&nbsp; </span><span class="comment"># split on outer delimiter<br />
&nbsp; </span><span class="default">$pairs </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">'&amp;'</span><span class="keyword">, </span><span class="default">$str</span><span class="keyword">);<br />
<br />
&nbsp; </span><span class="comment"># loop through each pair<br />
&nbsp; </span><span class="keyword">foreach (</span><span class="default">$pairs </span><span class="keyword">as </span><span class="default">$i</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment"># split into name and value<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">list(</span><span class="default">$name</span><span class="keyword">,</span><span class="default">$value</span><span class="keyword">) = </span><span class="default">explode</span><span class="keyword">(</span><span class="string">'='</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment"># if name already exists<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if( isset(</span><span class="default">$arr</span><span class="keyword">[</span><span class="default">$name</span><span class="keyword">]) ) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="comment"># stick multiple values into an array<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="keyword">if( </span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$arr</span><span class="keyword">[</span><span class="default">$name</span><span class="keyword">]) ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$arr</span><span class="keyword">[</span><span class="default">$name</span><span class="keyword">][] = </span><span class="default">$value</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$arr</span><span class="keyword">[</span><span class="default">$name</span><span class="keyword">] = array(</span><span class="default">$arr</span><span class="keyword">[</span><span class="default">$name</span><span class="keyword">], </span><span class="default">$value</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment"># otherwise, simply stick it in a scalar<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">else {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$arr</span><span class="keyword">[</span><span class="default">$name</span><span class="keyword">] = </span><span class="default">$value</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
<br />
&nbsp; </span><span class="comment"># return result array<br />
&nbsp; </span><span class="keyword">return </span><span class="default">$arr</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">$query </span><span class="keyword">= </span><span class="default">proper_parse_str</span><span class="keyword">(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'QUERY_STRING'</span><span class="keyword">]);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76481""></a>
  <div class="note">
   <strong class="user">Vladimir Kornea</strong>
   <a href="#76481" class="date">17-Jul-2007 09:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
parse_str() is confused by ampersands (&amp;) being encoded as HTML entities (&amp;amp;). This is relevant if you're extracting your query string from an HTML page (scraping). The solution is to run the string through html_entity_decode() before running it through parse_str().<br />
<br />
(Editors: my original comment was a caution whose solution is obvious, but it has resulted in three replies ("so what?" "as intended" and "this is how to fix it"). Please remove the previous four posts dealing with this (69529, 70234, 72745, 74818) and leave just the above summary. This issue is too trivial to warrant the number of comments it has received.)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75505""></a>
  <div class="note">
   <strong class="user">mike dot coley at inbox dot com</strong>
   <a href="#75505" class="date">02-Jun-2007 12:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is a little function that does the opposite of the parse_str function. It will take an array and build a query string from it.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">/* Converts an array of parameters into a query string to be appended to a URL.<br />
&nbsp;*<br />
&nbsp;* @return&nbsp; string&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : Query string to append to a URL.<br />
&nbsp;* @param&nbsp;&nbsp; array&nbsp; &nbsp; $array&nbsp; &nbsp;&nbsp; : Array of parameters to append to the query string.<br />
&nbsp;* @param&nbsp;&nbsp; string&nbsp;&nbsp; $parent&nbsp; &nbsp; : This should be left blank (it is used internally by the function).<br />
&nbsp;*/<br />
</span><span class="keyword">function </span><span class="default">append_params</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">, </span><span class="default">$parent</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$params </span><span class="keyword">= array();<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$array </span><span class="keyword">as </span><span class="default">$k </span><span class="keyword">=&gt; </span><span class="default">$v</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$v</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$params</span><span class="keyword">[] = </span><span class="default">append_params</span><span class="keyword">(</span><span class="default">$v</span><span class="keyword">, (empty(</span><span class="default">$parent</span><span class="keyword">) ? </span><span class="default">urlencode</span><span class="keyword">(</span><span class="default">$k</span><span class="keyword">) : </span><span class="default">$parent </span><span class="keyword">. </span><span class="string">'[' </span><span class="keyword">. </span><span class="default">urlencode</span><span class="keyword">(</span><span class="default">$k</span><span class="keyword">) . </span><span class="string">']'</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$params</span><span class="keyword">[] = (!empty(</span><span class="default">$parent</span><span class="keyword">) ? </span><span class="default">$parent </span><span class="keyword">. </span><span class="string">'[' </span><span class="keyword">. </span><span class="default">urlencode</span><span class="keyword">(</span><span class="default">$k</span><span class="keyword">) . </span><span class="string">']' </span><span class="keyword">: </span><span class="default">urlencode</span><span class="keyword">(</span><span class="default">$k</span><span class="keyword">)) . </span><span class="string">'=' </span><span class="keyword">. </span><span class="default">urlencode</span><span class="keyword">(</span><span class="default">$v</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$sessid </span><span class="keyword">= </span><span class="default">session_id</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; if (!empty(</span><span class="default">$parent</span><span class="keyword">) || empty(</span><span class="default">$sessid</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">implode</span><span class="keyword">(</span><span class="string">'&amp;'</span><span class="keyword">, </span><span class="default">$params</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Append the session ID to the query string if we have to.<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$sessname </span><span class="keyword">= </span><span class="default">session_name</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">ini_get</span><span class="keyword">(</span><span class="string">'session.use_cookies'</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">ini_get</span><span class="keyword">(</span><span class="string">'session.use_only_cookies'</span><span class="keyword">) &amp;&amp; (!isset(</span><span class="default">$_COOKIE</span><span class="keyword">[</span><span class="default">$sessname</span><span class="keyword">]) || (</span><span class="default">$_COOKIE</span><span class="keyword">[</span><span class="default">$sessname</span><span class="keyword">] != </span><span class="default">$sessid</span><span class="keyword">)))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$params</span><span class="keyword">[] = </span><span class="default">$sessname </span><span class="keyword">. </span><span class="string">'=' </span><span class="keyword">. </span><span class="default">urlencode</span><span class="keyword">(</span><span class="default">$sessid</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; elseif (!</span><span class="default">ini_get</span><span class="keyword">(</span><span class="string">'session.use_only_cookies'</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$params</span><span class="keyword">[] = </span><span class="default">$sessname </span><span class="keyword">. </span><span class="string">'=' </span><span class="keyword">. </span><span class="default">urlencode</span><span class="keyword">(</span><span class="default">$sessid</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">implode</span><span class="keyword">(</span><span class="string">'&amp;'</span><span class="keyword">, </span><span class="default">$params</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Note that the function will also append the session ID to the query string if it needs to be.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74818""></a>
  <div class="note">
   <strong class="user">Michal Zalewski</strong>
   <a href="#74818" class="date">28-Apr-2007 11:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Vladimir Kornea:<br />
Try use html_entity_decode()<br />
<br />
$str = 'first=value&amp;amp;arr[]=foo+bar&amp;amp;arr[]=baz';<br />
parse_str(html_entity_decode($str), $output);<br />
print_r($output);<br />
<br />
Array<br />
(<br />
&nbsp;&nbsp;&nbsp; [first] =&gt; value<br />
&nbsp;&nbsp;&nbsp; [arr] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [0] =&gt; foo bar<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [1] =&gt; baz<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73719""></a>
  <div class="note">
   <strong class="user">php at voodoolabs dot net</strong>
   <a href="#73719" class="date">07-Mar-2007 12:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is probably a better solution than below. The first line makes sure the file doesn't exist then the second line directs all requests to a script. No need to output a 200 header with this method either.<br />
<br />
RewriteEngine On<br />
<br />
RewriteCond %{REQUEST_FILENAME} !-f<br />
RewriteRule ^ index.php&nbsp; &nbsp; &nbsp; [L]</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73151""></a>
  <div class="note">
   <strong class="user">lenix.de</strong>
   <a href="#73151" class="date">10-Feb-2007 04:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
if you would like to get a nice url scheme with php/apache and and want to handle all requests in a central php script there's a simple solution/hack:<br />
<br />
create a .htaccess in your "basedir" where you've got your main script (in this example index.php) containing some lines like:<br />
<br />
"ErrorDocument 404 /index.php"<br />
<br />
inside index.php you can now do<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; $virtual_path </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'REQUEST_URI'</span><span class="keyword">],<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">strlen</span><span class="keyword">( </span><span class="default">dirname</span><span class="keyword">( </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_SELF'</span><span class="keyword">] ) ) + </span><span class="default">1<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if( (</span><span class="default">$pos </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">( </span><span class="default">$virtual_path</span><span class="keyword">, </span><span class="string">'?' </span><span class="keyword">)) !== </span><span class="default">false </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">parse_str</span><span class="keyword">( </span><span class="default">substr</span><span class="keyword">( </span><span class="default">$virtual_path</span><span class="keyword">, </span><span class="default">$pos </span><span class="keyword">+ </span><span class="default">1 </span><span class="keyword">), </span><span class="default">$_GET </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$_REQUEST </span><span class="keyword">= </span><span class="default">array_merge</span><span class="keyword">( </span><span class="default">$_REQUEST</span><span class="keyword">, </span><span class="default">$_GET </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$virtual_path </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">( </span><span class="default">$virtual_path</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$pos </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// some code checking for a valid location, etc...<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">( </span><span class="string">'HTTP/1.1 200 OK' </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">( </span><span class="string">'Content-Type: text/plain' </span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">$virtual_path</span><span class="keyword">.</span><span class="string">"\n\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">print_r</span><span class="keyword">( </span><span class="default">$_REQUEST </span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
// guido 'lenix' boehm</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="72745""></a>
  <div class="note">
   <strong class="user">jgbreezer at gmail dot com</strong>
   <a href="#72745" class="date">31-Jan-2007 04:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Vladimir Kornea wrote on 8 Sep 2006:<br />
"This function is confused by ampersands (&amp;) being encoded as HTML entities (&amp;amp;)"<br />
<br />
Well, it would be - it's not supposed to be passed html entities, that's a different encoding scheme. This function does correctly decode url encoded params for you though (with the rawurlencode rather than urlencode, ie '+' is translated to a space).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="70234""></a>
  <div class="note">
   <strong class="user">Olivier Mengué</strong>
   <a href="#70234" class="date">07-Oct-2006 02:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Vladimir: the function is OK in how it deals with &amp;amp;.<br />
&amp;amp; must only be used when outputing URLs in HTML/XML data.<br />
You should ask yourself why you have &amp;amp; in your URL when you give it to parse_str.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69529""></a>
  <div class="note">
   <strong class="user">Vladimir Kornea</strong>
   <a href="#69529" class="date">08-Sep-2006 02:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This function is confused by ampersands (&amp;) being encoded as HTML entities (&amp;amp;).<br />
<br />
$str = "first=value&amp;amp;arr[]=foo+bar&amp;amp;arr[]=baz";<br />
parse_str($str, $output);<br />
print_r($output);<br />
<br />
Array<br />
(<br />
&nbsp;&nbsp;&nbsp; [first] =&gt; value<br />
&nbsp;&nbsp;&nbsp; [amp;arr] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [0] =&gt; foo bar<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [1] =&gt; baz<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69254""></a>
  <div class="note">
   <strong class="user">PEPE_RIVAS at repixel dot net</strong>
   <a href="#69254" class="date">28-Aug-2006 06:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
CONVERT ANY FORMATTED STRING INTO VARIABLES<br />
<br />
I developed a online payment solution for credit cards using a merchant, and this merchant returns me an answer of the state of the transaction like this:<br />
<br />
estado=1,txnid=5555444-8454445-4455554,monto=100.00<br />
<br />
to have all that data into variables could be fine for me! so i use str_replace(), the problem is this function recognizes each group of variables with the &amp; character... and i have&nbsp; comma separated values... so i replace comma with &amp;<br />
<br />
<span class="default">&lt;?php<br />
$string </span><span class="keyword">= </span><span class="string">"estado=1,txnid=5555444-8454445-4455554,monto=100.00"</span><span class="keyword">;<br />
</span><span class="default">$string </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">","</span><span class="keyword">,</span><span class="string">"&amp;"</span><span class="keyword">,</span><span class="default">$string</span><span class="keyword">);<br />
</span><span class="default">parse_str</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">);<br />
echo </span><span class="default">$monto</span><span class="keyword">; </span><span class="comment">// outputs 100.00<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="64472""></a>
  <div class="note">
   <strong class="user">motin at demomusic dot nu</strong>
   <a href="#64472" class="date">14-Apr-2006 06:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When you have scripts run through the command-line (like locally via cron), you might want to be able to use _GET and _POST vars. Put this in top of your scheduled task files:<br />
<br />
&lt;?<br />
&nbsp;&nbsp;&nbsp; parse_str ($_SERVER['argv'][1], $GLOBALS['_GET']);<br />
&nbsp;&nbsp;&nbsp; parse_str ($_SERVER['argv'][2], $GLOBALS['_POST']);<br />
?&gt;<br />
<br />
And call your script by:<br />
<br />
/usr/local/bin/php /path/to/script.php "id=45&amp;action=delete" "formsubmitted=true"<br />
<br />
Cheers!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="56475""></a>
  <div class="note">
   <strong class="user">avi at amarcus dot com</strong>
   <a href="#56475" class="date">03-Sep-2005 06:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are trying to preserve a complex array, the function serialize might be better than http_build_query or other methods of making a query string.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="54275""></a>
  <div class="note">
   <strong class="user">Tore Bj?lseth</strong>
   <a href="#54275" class="date">29-Jun-2005 05:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As of PHP 5, you can do the exact opposite with http_build_query(). Just remember to use the optional array output parameter.<br />
<br />
This is a very useful combination if you want to re-use a search string url, but also slightly modify it:<br />
<br />
Example:<br />
&lt;?<br />
$url1 = "action=search&amp;interest[]=sports&amp;interest[]=music&amp;sort=id";<br />
$str = parse_str($url1, $output);<br />
<br />
// Modifying criteria:<br />
$output['sort'] = "interest";<br />
<br />
$url2 = http_build_query($output);<br />
<br />
echo "&lt;br&gt;url1: ".$url1;<br />
echo "&lt;br&gt;url2: ".$url2;<br />
?&gt;<br />
<br />
Results in:<br />
url1: action=search&amp;interest[]=sports&amp;interest[]=music&amp;sort=id<br />
url2: action=search&amp;interest[0]=sports&amp;interest[1]=music&amp;sort=interest<br />
<br />
(Array indexes are automatically created.)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="53346""></a>
  <div class="note">
   <strong class="user">kerosuppi</strong>
   <a href="#53346" class="date">29-May-2005 09:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This does not work as expected.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">someclass<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$query_string</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">someclass</span><span class="keyword">(</span><span class="default">$a_query_string</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">query_string </span><span class="keyword">= </span><span class="default">$a_query_string</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">parse_str</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">query_string</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">output</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">action</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">$a_class </span><span class="keyword">= new </span><span class="default">someclass</span><span class="keyword">(</span><span class="string">"action=go"</span><span class="keyword">);<br />
</span><span class="default">$a_class</span><span class="keyword">-&gt;</span><span class="default">output</span><span class="keyword">();<br />
</span><span class="default">?&gt;<br />
</span><br />
Use this instead.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">someclass<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$arr</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">someclass</span><span class="keyword">(</span><span class="default">$a_query_string</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">parse_str</span><span class="keyword">(</span><span class="default">$a_query_string</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">arr</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">output</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">arr</span><span class="keyword">[</span><span class="string">'action'</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">$a_class </span><span class="keyword">= new </span><span class="default">someclass</span><span class="keyword">(</span><span class="string">"action=go"</span><span class="keyword">);<br />
</span><span class="default">$a_class</span><span class="keyword">-&gt;</span><span class="default">output</span><span class="keyword">();<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="53175""></a>
  <div class="note">
   <strong class="user">mortoray at ecircle-ag dot com</strong>
   <a href="#53175" class="date">25-May-2005 12:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In Kent's solution you may wish to switch "urldecode" into "rawurldecode" if you'd like to get rid of the [annoying] plus '+' converted to space ' ' translation.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="52588""></a>
  <div class="note">
   <strong class="user">kent at nospam dot ioflux dot com</strong>
   <a href="#52588" class="date">06-May-2005 08:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You may want to parse the query string into an array. <br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/**<br />
&nbsp;* Similar to parse_str. Returns false if the query string or URL is empty. Because we're not parsing to <br />
&nbsp;* variables but to array key entries, this function will handle ?[]=1&amp;[]=2 "correctly."<br />
&nbsp;*<br />
&nbsp;* @return array Similar to the $_GET formatting that PHP does automagically.<br />
&nbsp;* @param string $url A query string or URL <br />
&nbsp;* @param boolean $qmark Find and strip out everything before the question mark in the string<br />
*/<br />
</span><span class="keyword">function </span><span class="default">parse_query_string</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">, </span><span class="default">$qmark</span><span class="keyword">=</span><span class="default">true</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$qmark</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pos </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">, </span><span class="string">"?"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$pos </span><span class="keyword">!== </span><span class="default">false</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$url </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">, </span><span class="default">$pos </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if (empty(</span><span class="default">$url</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$tokens </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">"&amp;"</span><span class="keyword">, </span><span class="default">$url</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$urlVars </span><span class="keyword">= array();<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$tokens </span><span class="keyword">as </span><span class="default">$token</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$value </span><span class="keyword">= </span><span class="default">string_pair</span><span class="keyword">(</span><span class="default">$token</span><span class="keyword">, </span><span class="string">"="</span><span class="keyword">, </span><span class="string">""</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'/^([^\[]*)(\[.*\])$/'</span><span class="keyword">, </span><span class="default">$token</span><span class="keyword">, </span><span class="default">$matches</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">parse_query_string_array</span><span class="keyword">(</span><span class="default">$urlVars</span><span class="keyword">, </span><span class="default">$matches</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">], </span><span class="default">$matches</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">], </span><span class="default">$value</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$urlVars</span><span class="keyword">[</span><span class="default">urldecode</span><span class="keyword">(</span><span class="default">$token</span><span class="keyword">)] = </span><span class="default">urldecode</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$urlVars</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="comment">/**<br />
&nbsp;* Utility function for parse_query_string. Given a result array, a starting key, and a set of keys formatted like "[a][b][c]" <br />
&nbsp;* and the final value, updates the result array with the correct PHP array keys.<br />
&nbsp;*<br />
&nbsp;* @return void<br />
&nbsp;* @param array $result A result array to populate from the query string<br />
&nbsp;* @param string $k The starting key to populate in $result<br />
&nbsp;* @param string $arrayKeys The key list to parse in the form "[][a][what%20ever]"<br />
&nbsp;* @param string $value The value to place at the destination array key<br />
*/<br />
</span><span class="keyword">function </span><span class="default">parse_query_string_array</span><span class="keyword">(&amp;</span><span class="default">$result</span><span class="keyword">, </span><span class="default">$k</span><span class="keyword">, </span><span class="default">$arrayKeys</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; if (!</span><span class="default">preg_match_all</span><span class="keyword">(</span><span class="string">'/\[([^\]]*)\]/'</span><span class="keyword">, </span><span class="default">$arrayKeys</span><span class="keyword">, </span><span class="default">$matches</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$value</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if (!isset(</span><span class="default">$result</span><span class="keyword">[</span><span class="default">$k</span><span class="keyword">])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result</span><span class="keyword">[</span><span class="default">urldecode</span><span class="keyword">(</span><span class="default">$k</span><span class="keyword">)] = array();<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$temp </span><span class="keyword">=&amp; </span><span class="default">$result</span><span class="keyword">[</span><span class="default">$k</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$last </span><span class="keyword">= </span><span class="default">urldecode</span><span class="keyword">(</span><span class="default">array_pop</span><span class="keyword">(</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]));<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] as </span><span class="default">$k</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$k </span><span class="keyword">= </span><span class="default">urldecode</span><span class="keyword">(</span><span class="default">$k</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$k </span><span class="keyword">=== </span><span class="string">""</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$temp</span><span class="keyword">[] = array();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$temp </span><span class="keyword">=&amp; </span><span class="default">$temp</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$temp</span><span class="keyword">)-</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else if (!isset(</span><span class="default">$temp</span><span class="keyword">[</span><span class="default">$k</span><span class="keyword">])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$temp</span><span class="keyword">[</span><span class="default">$k</span><span class="keyword">] = array();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$temp </span><span class="keyword">=&amp; </span><span class="default">$temp</span><span class="keyword">[</span><span class="default">$k</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$last </span><span class="keyword">=== </span><span class="string">""</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$temp</span><span class="keyword">[] = </span><span class="default">$value</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$temp</span><span class="keyword">[</span><span class="default">urldecode</span><span class="keyword">(</span><span class="default">$last</span><span class="keyword">)] = </span><span class="default">$value</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="comment">/**<br />
* Breaks a string into a pair for a common parsing function. <br />
*<br />
* The string passed in is truncated to the left half of the string pair, if any, and the right half, if anything, is returned.<br />
*<br />
* An example of using this would be:<br />
* &lt;code&gt;<br />
* $path = "Account.Balance";<br />
* $field = string_pair($path);<br />
* <br />
* $path is "Account"<br />
* $field is "Balance"<br />
*<br />
* $path = "Account";<br />
* $field = string_pair($path);<br />
*<br />
* $path is "Account"<br />
* $field is false<br />
* &lt;/code&gt;<br />
*<br />
* @return string The "right" portion of the string is returned if the delimiter is found.<br />
* @param string $a A string to break into a pair. The "left" portion of the string is returned here if the delimiter is found.<br />
* @param string $delim The characters used to delimit a string pair<br />
* @param mixed $default The value to return if the delimiter is not found in the string<br />
* @desc <br />
*/<br />
</span><span class="keyword">function </span><span class="default">string_pair</span><span class="keyword">(&amp;</span><span class="default">$a</span><span class="keyword">, </span><span class="default">$delim</span><span class="keyword">=</span><span class="string">'.'</span><span class="keyword">, </span><span class="default">$default</span><span class="keyword">=</span><span class="default">false</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$n </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">, </span><span class="default">$delim</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$n </span><span class="keyword">=== </span><span class="default">false</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$default</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">, </span><span class="default">$n</span><span class="keyword">+</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$delim</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$a </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$n</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$result</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="46481""></a>
  <div class="note">
   <strong class="user">anatilmizun at gmail dot com</strong>
   <a href="#46481" class="date">12-Oct-2004 04:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I wrote a pair of functions using parse_str() that will write values in an array to a textfile and vice versa, read those values from the textfile back into the array. Quite useful if you need to store lots of data but don't have access to SQL.<br />
<br />
Save the array by calling cfg_save($filename,$array) and load it back using $array=cfg_load($filename)<br />
<br />
<span class="default">&lt;?php<br />
$newline</span><span class="keyword">=</span><span class="string">"?"</span><span class="keyword">;<br />
<br />
function </span><span class="default">cfg_load</span><span class="keyword">(</span><span class="default">$cfgfile</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; global </span><span class="default">$newline</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$setting</span><span class="keyword">=</span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">file_exists</span><span class="keyword">(</span><span class="default">$cfgfile</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$setting</span><span class="keyword">=</span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$cfgfile</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ookk</span><span class="keyword">=</span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while(</span><span class="default">$ook</span><span class="keyword">=</span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$setting</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">#strip comment<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$commt</span><span class="keyword">=</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$ook</span><span class="keyword">,</span><span class="string">"##"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$commt</span><span class="keyword">!==</span><span class="default">false</span><span class="keyword">) </span><span class="default">$ook</span><span class="keyword">=</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$ook</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$commt</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">#append<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">$ook</span><span class="keyword">!=</span><span class="string">""</span><span class="keyword">) </span><span class="default">$ookk</span><span class="keyword">=</span><span class="default">$ookk</span><span class="keyword">.</span><span class="string">"&amp;"</span><span class="keyword">.&nbsp; &nbsp; </span><span class="default">str_replace</span><span class="keyword">(</span><span class="default">$newline</span><span class="keyword">,</span><span class="string">"\n"</span><span class="keyword">,</span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"&amp;"</span><span class="keyword">,</span><span class="string">"%26"</span><span class="keyword">,</span><span class="default">trim</span><span class="keyword">(</span><span class="default">$ook</span><span class="keyword">)));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$setting</span><span class="keyword">);&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">parse_str</span><span class="keyword">(</span><span class="default">$ookk</span><span class="keyword">, </span><span class="default">$setting</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$setting</span><span class="keyword">;<br />
}<br />
<br />
function </span><span class="default">cfg_save</span><span class="keyword">(</span><span class="default">$cfgfile</span><span class="keyword">,</span><span class="default">$setting</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; global </span><span class="default">$intArray</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$intArray</span><span class="keyword">=</span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">2000</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">++)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$intArray</span><span class="keyword">[]=</span><span class="default">$i</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$setting</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$allkeys</span><span class="keyword">=</span><span class="default">array_keys</span><span class="keyword">(</span><span class="default">$setting</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$allkeys </span><span class="keyword">as </span><span class="default">$aKey</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">cfg_recurse</span><span class="keyword">(</span><span class="default">$setting</span><span class="keyword">[</span><span class="default">$aKey</span><span class="keyword">], </span><span class="default">$aKey</span><span class="keyword">, </span><span class="default">$outArray</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$cfgf</span><span class="keyword">=</span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$cfgfile</span><span class="keyword">,</span><span class="string">"w"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; foreach(</span><span class="default">$outArray </span><span class="keyword">as </span><span class="default">$aLine</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$cfgf</span><span class="keyword">,</span><span class="default">stripslashes</span><span class="keyword">(</span><span class="default">$aLine</span><span class="keyword">).</span><span class="string">"\r\n"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$cfgf</span><span class="keyword">);<br />
}<br />
<br />
function </span><span class="default">cfg_recurse</span><span class="keyword">(</span><span class="default">$stuffIn</span><span class="keyword">, </span><span class="default">$keysofar</span><span class="keyword">, &amp;</span><span class="default">$toAppend</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; global </span><span class="default">$intArray</span><span class="keyword">, </span><span class="default">$newline</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$stuffIn</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$allkeys</span><span class="keyword">=</span><span class="default">array_keys</span><span class="keyword">(</span><span class="default">$stuffIn</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">array_slice</span><span class="keyword">(</span><span class="default">$intArray</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">sizeof</span><span class="keyword">(</span><span class="default">$allkeys</span><span class="keyword">))==</span><span class="default">$allkeys</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nokey</span><span class="keyword">=</span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nokey</span><span class="keyword">=</span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$allkeys </span><span class="keyword">as </span><span class="default">$aKey</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(!</span><span class="default">$nokey</span><span class="keyword">) </span><span class="default">$toKey</span><span class="keyword">=</span><span class="default">$aKey</span><span class="keyword">;&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">cfg_recurse</span><span class="keyword">(</span><span class="default">$stuffIn</span><span class="keyword">[</span><span class="default">$aKey</span><span class="keyword">], </span><span class="default">$keysofar</span><span class="keyword">.</span><span class="string">"["</span><span class="keyword">.</span><span class="default">$toKey</span><span class="keyword">.</span><span class="string">"]"</span><span class="keyword">, </span><span class="default">$toAppend</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }else<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$toAppend</span><span class="keyword">[]=</span><span class="default">$keysofar</span><span class="keyword">.</span><span class="string">"="</span><span class="keyword">.</span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"\n"</span><span class="keyword">,</span><span class="default">$newline</span><span class="keyword">,</span><span class="default">$stuffIn</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Note that these functions support nested arrays of unlimited levels ;)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
