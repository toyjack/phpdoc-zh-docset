<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>Append a string message to a specified mailbox</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.imap-alerts.html">? imap_alerts</a></li>
      <li style="float: right;"><a href="function.imap-base64.html">imap_base64 ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.imap.html">IMAP 函数</a></li>
    <li>Append a string message to a specified mailbox</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.imap-append" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">imap_append</h1>
  <p class="verinfo">(PHP 4, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">imap_append</span> &mdash; <span class="dc-title">Append a string message to a specified mailbox</span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.imap-append-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>imap_append</strong></span>
    ( <span class="methodparam"><span class="type">resource</span> <code class="parameter">$imap</code></span>
   , <span class="methodparam"><span class="type">string</span> <code class="parameter">$folder</code></span>
   , <span class="methodparam"><span class="type">string</span> <code class="parameter">$message</code></span>
   , <span class="methodparam"><span class="type"><span class="type">string</span>|<span class="type">null</span></span> <code class="parameter">$options</code><span class="initializer"> = <strong><code>null</code></strong></span></span>
   , <span class="methodparam"><span class="type"><span class="type">string</span>|<span class="type">null</span></span> <code class="parameter">$internal_date</code><span class="initializer"> = <strong><code>null</code></strong></span></span>
   ) : <span class="type">bool</span></div>

  <p class="para rdfs-comment">
   Appends a string <code class="parameter">message</code> to the specified <code class="parameter">folder</code>. 
  </p>
 </div>

 <div class="refsect1 parameters" id="refsect1-function.imap-append-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>

    <dt>
<code class="parameter">
imap</code></dt>
<dd>
<p class="para">由 <span class="function"><a href="function.imap-open.html" class="function">imap_open()</a></span> 返回的 IMAP 流。</p></dd>

    
     <dt>
<code class="parameter">folder</code></dt>

     <dd>

      <p class="para">
       The mailbox name, see <span class="function"><a href="function.imap-open.html" class="function">imap_open()</a></span> for more
       information
      </p>
      <div class="warning"><strong class="warning">Warning</strong><p class="simpara">
Passing untrusted data to this parameter is <em class="emphasis">insecure</em>, unless
<a href="imap.configuration.html#ini.imap.enable-insecure-rsh" class="link">imap.enable_insecure_rsh</a> is disabled.
</p></div>
     </dd>

    
    
     <dt>
<code class="parameter">message</code></dt>

     <dd>

      <p class="para">
       The message to be append, as a string
      </p>
      <p class="para">
       When talking to the Cyrus IMAP server, you must use &quot;\r\n&quot; as
       your end-of-line terminator instead of &quot;\n&quot; or the operation will
       fail
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">options</code></dt>

     <dd>

      <p class="para">
       If provided, the <code class="parameter">options</code> will also be written
       to the <code class="parameter">folder</code>
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">internal_date</code></dt>

     <dd>

      <p class="para">
       If this parameter is set, it will set the INTERNALDATE on the appended message.  The parameter should be a date string that conforms to the rfc2060 specifications for a date_time value.
      </p>
     </dd>

    
   </dl>

  </p>
 </div>

 <div class="refsect1 returnvalues" id="refsect1-function.imap-append-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   成功时返回 <strong><code>true</code></strong>， 或者在失败时返回 <strong><code>false</code></strong>。
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.imap-append-changelog">
  <h3 class="title">更新日志</h3>
  <table class="doctable informaltable">
   
    <thead>
     <tr>
      <th>版本</th>
      <th>说明</th>
     </tr>

    </thead>

    <tbody class="tbody">
     <tr>
      <td>8.0.0</td>
      <td>
       <code class="parameter">options</code> and <code class="parameter">internal_date</code> are now nullable.
      </td>
     </tr>

    </tbody>
   
  </table>

 </div>


 <div class="refsect1 examples" id="refsect1-function.imap-append-examples">
  <h3 class="title">范例</h3>
  <p class="para">
   <div class="example" id="example-3353">
    <p><strong>Example #1 <span class="function"><strong>imap_append()</strong></span> example</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$stream&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">imap_open</span><span style="color: #007700">(</span><span style="color: #DD0000">"{imap.example.org}INBOX.Drafts"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"username"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"password"</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$check&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">imap_check</span><span style="color: #007700">(</span><span style="color: #0000BB">$stream</span><span style="color: #007700">);<br />echo&nbsp;</span><span style="color: #DD0000">"Msg&nbsp;Count&nbsp;before&nbsp;append:&nbsp;"</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$check</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">Nmsgs&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">imap_append</span><span style="color: #007700">(</span><span style="color: #0000BB">$stream</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"{imap.example.org}INBOX.Drafts"<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"From:&nbsp;me@example.com\r\n"<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"To:&nbsp;you@example.com\r\n"<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"Subject:&nbsp;test\r\n"<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"\r\n"<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"this&nbsp;is&nbsp;a&nbsp;test&nbsp;message,&nbsp;please&nbsp;ignore\r\n"<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$check&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">imap_check</span><span style="color: #007700">(</span><span style="color: #0000BB">$stream</span><span style="color: #007700">);<br />echo&nbsp;</span><span style="color: #DD0000">"Msg&nbsp;Count&nbsp;after&nbsp;append&nbsp;:&nbsp;"</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$check</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">Nmsgs&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">imap_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$stream</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="123429""></a>
  <div class="note">
   <strong class="user">scott at threeam dot com dot au</strong>
   <a href="#123429" class="date">13-Dec-2018 10:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
From my testing today, if using PHPMailer to send to an Exchange based IMAP server with an attachment or embedded image greater than 7kb, you will need to change the line returns from unix format to windows format. I simply did a string replace on '\n' and replaced with '\r\n' to get this done.<br />
<br />
$content =&nbsp; str_replace("\n", "\r\n", $mail-&gt;getSentMIMEMessage());<br />
$result = imap_append($imapStream, $path, $content);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="121522""></a>
  <div class="note">
   <strong class="user">Mime email format example</strong>
   <a href="#121522" class="date">14-Aug-2017 09:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Mime message example (smtp telnet DATA example):<br />
<br />
From: from@ccc.cc<br />
To: to@@ccc.cc<br />
Subject: Example Email<br />
MIME-Version: 1.0<br />
Content-Type: multipart/mixed; boundary="MixedBoundaryString"<br />
<br />
--MixedBoundaryString<br />
Content-Type: multipart/related; boundary="RelatedBoundaryString"<br />
<br />
--RelatedBoundaryString<br />
Content-Type: multipart/alternative; boundary="AlternativeBoundaryString"<br />
<br />
--AlternativeBoundaryString<br />
Content-Type: text/plain;charset="utf-8"<br />
Content-Transfer-Encoding: quoted-printable<br />
<br />
This is the plain text part of the email.<br />
<br />
--AlternativeBoundaryString<br />
Content-Type: text/html;charset="utf-8"<br />
Content-Transfer-Encoding: quoted-printable<br />
<br />
&lt;html&gt;<br />
&nbsp; &lt;body&gt;=0D<br />
&nbsp;&nbsp;&nbsp; &lt;img src=3D=22cid:masthead.png=40ccc.cc=22 width 800 height=3D80=<br />
&nbsp;=5C&gt;=0D<br />
&nbsp;&nbsp;&nbsp; &lt;p&gt;This is the html part of the email.&lt;/p&gt;=0D<br />
&nbsp;&nbsp;&nbsp; &lt;img src=3D=22cid:logo.png=40ccc.cc=22 width 200 height=3D60 =5C=<br />
&gt;=0D<br />
&nbsp; &lt;/body&gt;=0D<br />
&lt;/html&gt;=0D<br />
<br />
--AlternativeBoundaryString--<br />
<br />
--RelatedBoundaryString<br />
Content-Type: image/jpgeg;name="logo.png"<br />
Content-Transfer-Encoding: base64<br />
Content-Disposition: inline;filename="logo.png"<br />
Content-ID: &lt;logo.png@ccc.cc&gt;<br />
<br />
amtsb2hiaXVvbHJueXZzNXQ2XHVmdGd5d2VoYmFmaGpremxidTh2b2hydHVqd<br />
dWkgb2l1b3NydGhpdXRvZ2hqdWlyb2h5dWd0aXJlaHN1aWhndXNpaHhidnVqZ<br />
a25qbW9nNXRwbF0nemVycHpvemlnc3k5aDZqcm9wdHo7amlodDhpOTA4N3U5<br />
LGZ2cDBbZWRzcm85eWo1Zmtsc2xrZ3g=<br />
<br />
--RelatedBoundaryString<br />
Content-Type: image/jpgeg;name="masthead.png"<br />
Content-Transfer-Encoding: base64<br />
Content-Disposition: inline;filename="masthead.png"<br />
Content-ID: &lt;masthead.png@ccc.cc&gt;<br />
<br />
aXR4ZGh5Yjd1OHk3MzQ4eXFndzhpYW9wO2tibHB6c2tqOTgwNXE0aW9qYWJ6aX<br />
dGlmOTA0cW05dGkwbWk0OXQwYVttaXZvcnBhXGtsbGo7emt2c2pkZnI7Z2lwb2F<br />
eXN6dWdoeXhiNzhuZzdnaHQ3eW9zemlqb2FqZWt0cmZ1eXZnamhka3JmdDg3aXV2dWd5aGVidXdz<br />
dhyuhehe76YTGSFGA=<br />
<br />
--RelatedBoundaryString--<br />
<br />
--MixedBoundaryString<br />
Content-Type: application/pdf;name="Invoice_1.pdf"<br />
Content-Transfer-Encoding: base64<br />
Content-Disposition: attachment;filename="Invoice_1.pdf"<br />
<br />
aGZqZGtsZ3poZHVpeWZoemd2dXNoamRibngganZodWpyYWRuIHVqO0hmSjtyRVVPIEZSO05SVURF<br />
SEx1aWhudWpoZ3h1XGh1c2loZWRma25kamlsXHpodXZpZmhkcnVsaGpnZmtsaG<br />
a2psajY1ZWxqanNveHV5ZXJ3NTQzYXRnZnJhZXdhcmV0eXRia2xhanNueXVpNjRv<br />
<br />
--MixedBoundaryString<br />
Content-Type: application/pdf;name="SpecialOffer.pdf"<br />
Content-Transfer-Encoding: base64<br />
Content-Disposition: attachment;filename="SpecialOffer.pdf"<br />
<br />
aXBvY21odWl0dnI1dWk4OXdzNHU5NTgwcDN3YTt1OTQwc3U4NTk1dTg0dTV5OG<br />
cS0zNHU4NTk0eWI4OTcwdjg5MHE4cHV0O3BvYTt6dWI7dWlvenZ1em9pdW51dD<br />
OTViOHk5cDV3dTh5bnB3dWZ2OHQ5dTh2cHVpO2p2Ymd1eTg5MGg3ajY4bjZ2ODl1ZGlvcjQ1amts<br />
dfnhgjdfihn=<br />
<br />
--MixedBoundaryString--<br />
<br />
.<br />
<br />
// Or you can download from<br />
https://www.phpclasses.org/browse/file/14672.html</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="119768""></a>
  <div class="note">
   <strong class="user">nanomoow at gmail dot com</strong>
   <a href="#119768" class="date">20-Aug-2016 06:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
// this works for me, better version :]. <br />
<span class="default">&lt;?php<br />
$fn </span><span class="keyword">= </span><span class="string">'filename.zip'</span><span class="keyword">;<br />
</span><span class="default">$IMAPhost </span><span class="keyword">= </span><span class="string">'imap.hostname.com'</span><span class="keyword">;<br />
</span><span class="comment">// IMAP port 143, 995 or POP3 port 110, 995<br />
</span><span class="default">$IMAPport </span><span class="keyword">= </span><span class="string">'143'</span><span class="keyword">;<br />
</span><span class="default">$IMAPssl </span><span class="keyword">= </span><span class="string">'tls'</span><span class="keyword">;<br />
</span><span class="default">$IMAP </span><span class="keyword">= </span><span class="string">'{'</span><span class="keyword">.</span><span class="default">$IMAPhost</span><span class="keyword">.</span><span class="string">':'</span><span class="keyword">.</span><span class="default">$IMAPport</span><span class="keyword">.</span><span class="string">'/imap/'</span><span class="keyword">.</span><span class="default">$IMAPssl</span><span class="keyword">.</span><span class="string">'/novalidate-cert}'</span><span class="keyword">;<br />
</span><span class="default">$IMAPuser </span><span class="keyword">= </span><span class="string">'hello@hostname.com'</span><span class="keyword">;&nbsp; &nbsp; &nbsp;&nbsp; <br />
</span><span class="default">$msg </span><span class="keyword">=</span><span class="string">'Message text &lt;h1 style="color: #093"&gt; Hello &lt;/h1&gt;'</span><span class="keyword">;<br />
</span><span class="comment">// imap email and password<br />
</span><span class="default">$ibox </span><span class="keyword">= </span><span class="default">imap_open</span><span class="keyword">(</span><span class="default">$IMAP</span><span class="keyword">, </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'email'</span><span class="keyword">], </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'pass'</span><span class="keyword">]);<br />
</span><span class="default">$dmy</span><span class="keyword">=</span><span class="default">date</span><span class="keyword">(</span><span class="string">"Y-m-d H:i:s"</span><span class="keyword">);<br />
</span><span class="comment">// pack file contents<br />
</span><span class="default">$attachment </span><span class="keyword">= </span><span class="default">chunk_split</span><span class="keyword">(</span><span class="default">base64_encode</span><span class="keyword">(</span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="string">'tmp/'</span><span class="keyword">.</span><span class="default">$fn</span><span class="keyword">))); <br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$boundary1 </span><span class="keyword">= </span><span class="string">"###"</span><span class="keyword">.</span><span class="default">md5</span><span class="keyword">(</span><span class="default">microtime</span><span class="keyword">()).</span><span class="string">"###"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$boundary2 </span><span class="keyword">= </span><span class="string">"###"</span><span class="keyword">.</span><span class="default">md5</span><span class="keyword">(</span><span class="default">microtime</span><span class="keyword">().</span><span class="default">rand</span><span class="keyword">(</span><span class="default">99</span><span class="keyword">,</span><span class="default">999</span><span class="keyword">)).</span><span class="string">"###"</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imap_append</span><span class="keyword">(</span><span class="default">$ibox</span><span class="keyword">, </span><span class="default">$IMAP</span><span class="keyword">.</span><span class="string">"Send"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">, </span><span class="string">"From: Hello &lt;"</span><span class="keyword">.</span><span class="default">$IMAPuser</span><span class="keyword">.</span><span class="string">"&gt;\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"To: "</span><span class="keyword">.</span><span class="default">$email</span><span class="keyword">.</span><span class="string">"\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"Date: </span><span class="default">$dmy</span><span class="string">\r\n" <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"Subject: "</span><span class="keyword">.</span><span class="default">quoted_printable_encode</span><span class="keyword">(</span><span class="default">$sub</span><span class="keyword">).</span><span class="string">"\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"MIME-Version: 1.0\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"Content-Type: multipart/mixed; boundary=\"</span><span class="default">$boundary1</span><span class="string">\"\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"\r\n\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"--</span><span class="default">$boundary1</span><span class="string">\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"Content-Type: multipart/alternative; boundary=\"</span><span class="default">$boundary2</span><span class="string">\"\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"\r\n\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// ADD Plain text data<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"--</span><span class="default">$boundary2</span><span class="string">\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"Content-Type: text/plain; charset=\"utf-8\"\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"Content-Transfer-Encoding: quoted-printable\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"\r\n\r\n" <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="default">$msg</span><span class="keyword">.</span><span class="string">"\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"\r\n\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// ADD Html content<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"--</span><span class="default">$boundary2</span><span class="string">\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"Content-Type: text/html; charset=\"utf-8\"\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"Content-Transfer-Encoding: quoted-printable \r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"\r\n\r\n" <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="default">html_entity_decode</span><span class="keyword">(</span><span class="default">$msg</span><span class="keyword">).</span><span class="string">"\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"\r\n\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"--</span><span class="default">$boundary2</span><span class="string">\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"\r\n\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// ADD attachment(s)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"--</span><span class="default">$boundary1</span><span class="string">\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"Content-Type: image/gif; name=\"</span><span class="default">$fn</span><span class="string">\"\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"Content-Transfer-Encoding: base64\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"Content-Disposition: attachment; filename=\"</span><span class="default">$fn</span><span class="string">\"\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"\r\n\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="default">$attachment <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"\r\n\r\n"&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"--</span><span class="default">$boundary1</span><span class="string">--\r\n\r\n" <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">);<br />
<br />
</span><span class="comment">// nigdy wi?cej takich dziwactw :) ble..<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="119759""></a>
  <div class="note">
   <strong class="user">nanomoow at gmail dot com</strong>
   <a href="#119759" class="date">19-Aug-2016 08:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
$fn = 'filename.zip';<br />
$IMAPhost = 'imap.hostname.com';<br />
// IMAP port 143, 995 or POP3 port 110, 995<br />
$IMAPport = '143';<br />
$IMAPssl = 'tls';<br />
$IMAP = '{'.$IMAPhost.':'.$IMAPport.'/imap/'.$IMAPssl.'/novalidate-cert}';<br />
$IMAPuser = 'hello@hostname.com';&nbsp; &nbsp; &nbsp; &nbsp; <br />
$msg ='Message text &lt;h1 style="color: #093"&gt; Hello &lt;/h1&gt;';<br />
// imap email and password<br />
$ibox = imap_open($IMAP, $_SESSION['email'], $_SESSION['pass']);<br />
$dmy=date("Y-m-d H:i:s");<br />
// pack file contents<br />
$attachment = chunk_split(base64_encode(file_get_contents('tmp/'.$fn)));&nbsp;&nbsp; <br />
$boundary = "------=".md5(uniqid(rand())); <br />
imap_append($ibox, $IMAP."Send"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; , "From: Hello &lt;".$IMAPuser."&gt;\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; . "To: ".$email."\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; . "Date: $dmy\r\n" <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; . "Subject: ".$sub."\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; . "MIME-Version: 1.0\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; . "Content-Type: multipart/mixed; boundary=\"$boundary\"\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; . "\r\n\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; . "--$boundary\r\n"&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; . "Content-Type: text/html;\r\n\tcharset=\"utf-8\"\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; . "Content-Transfer-Encoding: 8bit \r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; . "\r\n\r\n" <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; . html_entity_decode($msg)."\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; . "\r\n\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; . "--$boundary\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; . "Content-Transfer-Encoding: base64\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; . "Content-Disposition: attachment; filename=\"$fn\"\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; . "\r\n" . $attachment . "\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; . "\r\n\r\n\r\n"&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; . "--$boundary--\r\n\r\n"&nbsp; <br />
);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="117277""></a>
  <div class="note">
   <strong class="user">Krzysiek</strong>
   <a href="#117277" class="date">15-May-2015 12:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You can use PHPMailer ( https://github.com/PHPMailer/PHPMailer/ ) with imap.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// after creating content of mail you have to run preSend() - part of send() method<br />
</span><span class="default">$mail</span><span class="keyword">-&gt;</span><span class="default">send</span><span class="keyword">();<br />
</span><span class="comment">// and you can get whole raw message with getSentMIMEMessage() method<br />
</span><span class="default">imap_append</span><span class="keyword">(</span><span class="default">$imap</span><span class="keyword">, </span><span class="default">$mailserver</span><span class="keyword">.</span><span class="string">'INBOX.Sent'</span><span class="keyword">,</span><span class="default">$mail</span><span class="keyword">-&gt;</span><span class="default">getSentMIMEMessage</span><span class="keyword">(), </span><span class="string">"\\Seen"</span><span class="keyword">);</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="111461""></a>
  <div class="note">
   <strong class="user">rixsta at hotmail dot com</strong>
   <a href="#111461" class="date">21-Feb-2013 08:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hi,<br />
<br />
As we have been struggling with this for some time I wanted to share how we got imap_append working properly with all MIME parts including attachments.&nbsp; If you are sending email and also wish to append the sent message to the Sent Items folder, I cannot think of an easier way to do this, as follows:<br />
<br />
1) Use SwiftMailer to send the message via PHP.<br />
$message = Swift_Message::newInstance("Subject goes here");<br />
(then add from, to, body, attachments etc)<br />
$result = $mailer-&gt;send($message);<br />
<br />
2) When you construct the message in step 1) above save it to a variable as follows:<br />
<br />
$msg = $message-&gt;toString(); (this creates the full MIME message required for imap_append()!!&nbsp; After this you can call imap_append like this:<br />
<br />
imap_append($imap_conn,$mail_box,$msg."\r\n","\\Seen");<br />
<br />
I hope this helps the readers, and prevents saves people from doing what we started doing - hand crafting the MIME messages :-0</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="111323""></a>
  <div class="note">
   <strong class="user">serpent at paradise dot net dot nz</strong>
   <a href="#111323" class="date">06-Feb-2013 08:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
We couldn't get this function to work properly with MS-Exchange/IMAP, not because there's a problem with a the function as such, but because MS-Exchange changed the content-type in the header from multipart/[anything] to text/plain in every instance.&nbsp; We set ImapMessagesRetrievalMimeFormat to HtmlAndTextAlternative<br />
on the Exchange server, and that didn't help either.&nbsp; I even tried wrapping the multipart message in a message/rfc822 wrapper and it reached inside the outer message and tweeked the inner message from multipart/alternative to text/plain.<br />
<br />
Messages emailed to the mbox were unaffected, I suggest you try that route instead, and move the relevant messages to where you want them.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="106637""></a>
  <div class="note">
   <strong class="user">bill at dyndns dot org</strong>
   <a href="#106637" class="date">23-Nov-2011 11:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is how I used this function with an attachment. I used examples from everyone else but made it easier and cleaner to change.
<br />

<br />
<span class="default">&lt;?php
<br />
$authhost</span><span class="keyword">=</span><span class="string">"{000.000.000.000:993/validate-cert/ssl}Drafts"</span><span class="keyword">;
<br />

<br />
</span><span class="default">$user</span><span class="keyword">=</span><span class="string">"sadasd"</span><span class="keyword">;
<br />
</span><span class="default">$pass</span><span class="keyword">=</span><span class="string">"sadasd"</span><span class="keyword">;
<br />

<br />
if (</span><span class="default">$mbox</span><span class="keyword">=</span><span class="default">imap_open</span><span class="keyword">( </span><span class="default">$authhost</span><span class="keyword">, </span><span class="default">$user</span><span class="keyword">, </span><span class="default">$pass</span><span class="keyword">))
<br />
{
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$dmy</span><span class="keyword">=</span><span class="default">date</span><span class="keyword">(</span><span class="string">"d-M-Y H:i:s"</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$filename</span><span class="keyword">=</span><span class="string">"filename.pdf"</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$attachment </span><span class="keyword">= </span><span class="default">chunk_split</span><span class="keyword">(</span><span class="default">base64_encode</span><span class="keyword">(</span><span class="default">$filestring</span><span class="keyword">));
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$boundary </span><span class="keyword">= </span><span class="string">"------="</span><span class="keyword">.</span><span class="default">md5</span><span class="keyword">(</span><span class="default">uniqid</span><span class="keyword">(</span><span class="default">rand</span><span class="keyword">()));
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$msg </span><span class="keyword">= (</span><span class="string">"From: Somebody\r\n"
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"To: test@example.co.uk\r\n"
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"Date: </span><span class="default">$dmy</span><span class="string">\r\n"
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"Subject: This is the subject\r\n"
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"MIME-Version: 1.0\r\n"
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"Content-Type: multipart/mixed; boundary=\"</span><span class="default">$boundary</span><span class="string">\"\r\n"
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"\r\n\r\n"
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"--</span><span class="default">$boundary</span><span class="string">\r\n"
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"Content-Type: text/html;\r\n\tcharset=\"ISO-8859-1\"\r\n"
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"Content-Transfer-Encoding: 8bit \r\n"
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"\r\n\r\n"
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"Hello this is a test\r\n"
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"\r\n\r\n"
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"--</span><span class="default">$boundary</span><span class="string">\r\n"
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"Content-Transfer-Encoding: base64\r\n"
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"Content-Disposition: attachment; filename=\"</span><span class="default">$filename</span><span class="string">\"\r\n"
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"\r\n" </span><span class="keyword">. </span><span class="default">$attachment </span><span class="keyword">. </span><span class="string">"\r\n"
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"\r\n\r\n\r\n"
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"--</span><span class="default">$boundary</span><span class="string">--\r\n\r\n"</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imap_append</span><span class="keyword">(</span><span class="default">$mbox</span><span class="keyword">,</span><span class="default">$authhost</span><span class="keyword">,</span><span class="default">$msg</span><span class="keyword">, </span><span class="string">"\\Draft"</span><span class="keyword">); 
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imap_close</span><span class="keyword">(</span><span class="default">$mbox</span><span class="keyword">);
<br />
}
<br />
else
<br />
{
<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"&lt;h1&gt;FAIL!&lt;/h1&gt;\n"</span><span class="keyword">;
<br />
}
<br />

<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Hope this helps someone.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="105303""></a>
  <div class="note">
   <strong class="user">Tigggger</strong>
   <a href="#105303" class="date">08-Aug-2011 09:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I encountered 3 problems when attempting to get my server to copy messages to the sent folder.
<br />

<br />
1. Wouldn't login until I added /novalidate-cert
<br />
2. No code example of getting the date sent
<br />
3. Including an attachment
<br />

<br />
Hope this code helps others
<br />

<br />
<span class="default">&lt;?php
<br />
$dmy</span><span class="keyword">=</span><span class="default">date</span><span class="keyword">(</span><span class="string">"d-M-Y H:i:s"</span><span class="keyword">);
<br />
</span><span class="default">$dmy</span><span class="keyword">.= </span><span class="string">" +0100"</span><span class="keyword">; </span><span class="comment">// Had to do this bit manually as server and me are in different timezones
<br />
</span><span class="default">$stream</span><span class="keyword">=@</span><span class="default">imap_open</span><span class="keyword">(</span><span class="string">"{mail.example.com/novalidate-cert}INBOX.Sent"</span><span class="keyword">, </span><span class="string">"username"</span><span class="keyword">, </span><span class="string">"password"</span><span class="keyword">);
<br />
</span><span class="default">$boundary </span><span class="keyword">= </span><span class="string">"------="</span><span class="keyword">.</span><span class="default">md5</span><span class="keyword">(</span><span class="default">uniqid</span><span class="keyword">(</span><span class="default">rand</span><span class="keyword">()));
<br />
</span><span class="default">$header </span><span class="keyword">= </span><span class="string">"MIME-Version: 1.0\r\n"</span><span class="keyword">;
<br />
</span><span class="default">$header </span><span class="keyword">.= </span><span class="string">"Content-Type: multipart/mixed; boundary=\"</span><span class="default">$boundary</span><span class="string">\"\r\n"</span><span class="keyword">;
<br />
</span><span class="default">$header </span><span class="keyword">.= </span><span class="string">"\r\n"</span><span class="keyword">;
<br />
</span><span class="default">$file</span><span class="keyword">=</span><span class="string">"../path_to/filename.pdf"</span><span class="keyword">;
<br />
</span><span class="default">$filename</span><span class="keyword">=</span><span class="string">"filename.pdf"</span><span class="keyword">;
<br />
</span><span class="default">$ouv</span><span class="keyword">=</span><span class="default">fopen </span><span class="keyword">(</span><span class="string">"</span><span class="default">$file</span><span class="string">"</span><span class="keyword">, </span><span class="string">"rb"</span><span class="keyword">);</span><span class="default">$lir</span><span class="keyword">=</span><span class="default">fread </span><span class="keyword">(</span><span class="default">$ouv</span><span class="keyword">, </span><span class="default">filesize </span><span class="keyword">(</span><span class="string">"</span><span class="default">$file</span><span class="string">"</span><span class="keyword">));</span><span class="default">fclose
<br />
</span><span class="keyword">(</span><span class="default">$ouv</span><span class="keyword">);
<br />
</span><span class="default">$attachment </span><span class="keyword">= </span><span class="default">chunk_split</span><span class="keyword">(</span><span class="default">base64_encode</span><span class="keyword">(</span><span class="default">$lir</span><span class="keyword">));
<br />
</span><span class="default">$msg2 </span><span class="keyword">.= </span><span class="string">"--</span><span class="default">$boundary</span><span class="string">\r\n"</span><span class="keyword">;
<br />
</span><span class="default">$msg2 </span><span class="keyword">.= </span><span class="string">"Content-Transfer-Encoding: base64\r\n"</span><span class="keyword">;
<br />
</span><span class="default">$msg2 </span><span class="keyword">.= </span><span class="string">"Content-Disposition: attachment; filename=\"</span><span class="default">$filename</span><span class="string">\"\r\n"</span><span class="keyword">;
<br />
</span><span class="default">$msg2 </span><span class="keyword">.= </span><span class="string">"\r\n"</span><span class="keyword">;
<br />
</span><span class="default">$msg2 </span><span class="keyword">.= </span><span class="default">$attachment </span><span class="keyword">. </span><span class="string">"\r\n"</span><span class="keyword">;
<br />
</span><span class="default">$msg2 </span><span class="keyword">.= </span><span class="string">"\r\n\r\n"</span><span class="keyword">;
<br />
</span><span class="default">$msg3 </span><span class="keyword">.= </span><span class="string">"--</span><span class="default">$boundary</span><span class="string">--\r\n"</span><span class="keyword">;
<br />
</span><span class="default">imap_append</span><span class="keyword">(</span><span class="default">$stream</span><span class="keyword">,</span><span class="string">"{mail.example.com/novalidate-cert}INBOX.Sent"</span><span class="keyword">,</span><span class="string">"From: Somebody\r\n"</span><span class="keyword">.</span><span class="string">"To: test@example.co.uk\r\n"</span><span class="keyword">.</span><span class="string">"Date: </span><span class="default">$dmy</span><span class="string">\r\n"</span><span class="keyword">.</span><span class="string">"Subject: This is the subject\r\n"</span><span class="keyword">.</span><span class="string">"</span><span class="default">$header</span><span class="string">\r\n"</span><span class="keyword">.</span><span class="string">"</span><span class="default">$msg2</span><span class="string">\r\n"</span><span class="keyword">.</span><span class="string">"</span><span class="default">$msg3</span><span class="string">\r\n"</span><span class="keyword">);
<br />
</span><span class="default">imap_close </span><span class="keyword">(</span><span class="default">$stream</span><span class="keyword">);
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99407""></a>
  <div class="note">
   <strong class="user">kaminski at istori dot com</strong>
   <a href="#99407" class="date">15-Aug-2010 08:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The date format string to use when creating $internal_date is 'd-M-Y H:i:s O'.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="80951""></a>
  <div class="note">
   <strong class="user">chris at sma-sportsmgmt dot com</strong>
   <a href="#80951" class="date">07-Feb-2008 11:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I spend most of today refining the example to make it work properly when saving to the Inbox.Sent folder.<br />
<br />
The append command now looks like:<br />
<br />
&nbsp;&nbsp;&nbsp; $return = imap_append($stream,$mailbox_addr<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; , "From: $fromReply\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; . "To: $to\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; . "Subject: $subject\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; . "Date: $now&nbsp; \r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; . "X-Mailer: Cmail_v2.0 \r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; . "X-Originating-IP: $ip_addr \r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; . "MIME-Version: 1 \r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; . "Content-Type: text/html;\r\n\tcharset=\"ISO-8859-1\"\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; . "Content-Transfer-Encoding: 8bit \r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; . "\r\n\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; . "$wk_msg\r\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; );<br />
<br />
This inserts the current date into the email and lets it support html content. The one thing that I haven't got working yet is including attachments. I presumably have to make the boundaries and attachment content part of the message body.<br />
<br />
Chris</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74907""></a>
  <div class="note">
   <strong class="user">jille at DIESPAMMERShexon dot cx</strong>
   <a href="#74907" class="date">03-May-2007 07:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The last argument, $options, are flags like for use with imap_setflag_full.<br />
It took a while before I found out</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="72397""></a>
  <div class="note">
   <strong class="user">svicentemolina at gmail dot com</strong>
   <a href="#72397" class="date">17-Jan-2007 07:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I have used this function to copy all the emails of one account from one server to another. The problem was that this function don't copy the original receiving date for each message.<br />
To add a fifth field to provide the date, I have made some changes at some php source files following the steps described in <a href="http://www.zend.com/lists/php-dev/200303/msg00843.html and it has worked fine." rel="nofollow" target="_blank">http://www.zend.com/lists/php-dev/200303/msg00843.html and it has worked fine.</a><br />
The correct date format is the returned by the function mail_date in c-client/mail.c source file, for instance: "17-Jan-2007 10:00:01 +0100"</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="33356""></a>
  <div class="note">
   <strong class="user">bithive</strong>
   <a href="#33356" class="date">23-Jun-2003 03:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The parameter description is misleading.&nbsp; You can pass a string of flags such as '\Seen' [see imap_setflag_full()] as the last argument.&nbsp; In the other imap functions, 'options' seems to usually refer to a bitmask, not message flags.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="31651""></a>
  <div class="note">
   <strong class="user">michel dot jansens at ulb dot ac dot be</strong>
   <a href="#31651" class="date">29-Apr-2003 07:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I use imap_append() to decode message/rfc822 attachments type(embedded emails):<br />
<br />
$attachment = imap_fetchbody($mbox,$mailuid,$atpos,FT_UID);<br />
$attachment = imap_base64($attachment);<br />
$res =&nbsp; imap_append($mbox,mboxspec("INBOX"),$attachment);<br />
//the embedded email is now a normal mail in my INBOX</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="22244""></a>
  <div class="note">
   <strong class="user">bluebiru78 at hotmail dot com</strong>
   <a href="#22244" class="date">12-Jun-2002 12:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
i used imap_append to copy any composed message into INBOX.Sent folder..<br />
<br />
$app = imap_append($stream,"{" . $connectstring . "}INBOX.Sent","$header\r\n" ."$mbody\r\n");<br />
<br />
if (!$app) {<br />
&nbsp;error("Email copying to Sent folder FAILED!");<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="14467""></a>
  <div class="note">
   <strong class="user">owain at vaughan dot com</strong>
   <a href="#14467" class="date">01-Aug-2001 06:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
With SIMS IMAP server you also need to use \r\n as a line terminator, otherwise you will be able to add all the header lines correctly, but the body of the message will not be saved.&lt;br&gt;
<br />
You can use \n by itself for each header line, but when creating the blank line between the headers and the body you must use \r\n\r\n</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="1618""></a>
  <div class="note">
   <strong class="user">jesper at angelo dot dk</strong>
   <a href="#1618" class="date">14-Sep-1999 09:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Please observe that imap_append() do not support NNTP posting. Use fsockopen() instead, and do the work yourself.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
