<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>Request a file via SCP</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.ssh2-publickey-remove.html">? ssh2_publickey_remove</a></li>
      <li style="float: right;"><a href="function.ssh2-scp-send.html">ssh2_scp_send ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.ssh2.html">SSH2 函数</a></li>
    <li>Request a file via SCP</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.ssh2-scp-recv" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">ssh2_scp_recv</h1>
  <p class="verinfo">(PECL ssh2 &gt;= 0.9.0)</p><p class="refpurpose"><span class="refname">ssh2_scp_recv</span> &mdash; <span class="dc-title">Request a file via SCP</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.ssh2-scp-recv-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>ssh2_scp_recv</strong></span>(<span class="methodparam"><span class="type">resource</span> <code class="parameter">$session</code></span>, <span class="methodparam"><span class="type">string</span> <code class="parameter">$remote_file</code></span>, <span class="methodparam"><span class="type">string</span> <code class="parameter">$local_file</code></span>): <span class="type">bool</span></div>

  <p class="para rdfs-comment">
   Copy a file from the remote server to the local filesystem using the SCP protocol.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.ssh2-scp-recv-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>
    
     <dt>
<code class="parameter">session</code></dt>

     <dd>

      <p class="para">
       An SSH connection link identifier, obtained from a call to
       <span class="function"><a href="function.ssh2-connect.html" class="function">ssh2_connect()</a></span>.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">remote_file</code></dt>

     <dd>

      <p class="para">
       Path to the remote file.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">local_file</code></dt>

     <dd>

      <p class="para">
       Path to the local file.
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.ssh2-scp-recv-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   成功时返回 <strong><code>true</code></strong>， 或者在失败时返回 <strong><code>false</code></strong>。
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.ssh2-scp-recv-examples">
  <h3 class="title">范例</h3>
  <p class="para">
   <div class="example" id="example-4433">
    <p><strong>Example #1 Downloading a file via SCP</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$connection&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">ssh2_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">'shell.example.com'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">22</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">ssh2_auth_password</span><span style="color: #007700">(</span><span style="color: #0000BB">$connection</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'username'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'password'</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">ssh2_scp_recv</span><span style="color: #007700">(</span><span style="color: #0000BB">$connection</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'/remote/filename'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'/local/filename'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.ssh2-scp-recv-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.ssh2-scp-send.html" class="function" rel="rdfs-seeAlso">ssh2_scp_send()</a> - Send a file via SCP</span></li>
    <li class="member"><span class="function"><a href="function.copy.html" class="function" rel="rdfs-seeAlso">copy()</a> - 拷贝文件</span></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="119630""></a>
  <div class="note">
   <strong class="user">liubomyr dot pelo at gmail dot com</strong>
   <a href="#119630" class="date">20-Jul-2016 07:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In case if you get:<br />
<br />
Warning: ssh2_scp_recv(): Unable to receive remote file in /some-php-file.php on line 2<br />
<br />
Use `stream_get_contents` function.<br />
<br />
Example:<br />
<span class="default">&lt;?php<br />
$stream </span><span class="keyword">= @</span><span class="default">fopen</span><span class="keyword">(</span><span class="string">"ssh2.s<a href="ftp://" rel="nofollow" target="_blank">ftp://</a></span><span class="default">$sftp$remoteFile</span><span class="string">"</span><span class="keyword">, </span><span class="string">'r'</span><span class="keyword">);<br />
if (! </span><span class="default">$stream</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; throw new \</span><span class="default">Exception</span><span class="keyword">(</span><span class="string">"Could not open file: </span><span class="default">$remoteFile</span><span class="string">"</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">$contents </span><span class="keyword">= </span><span class="default">stream_get_contents</span><span class="keyword">(</span><span class="default">$stream</span><span class="keyword">);<br />
</span><span class="default">file_put_contents </span><span class="keyword">(</span><span class="default">$localFile</span><span class="keyword">, </span><span class="default">$contents</span><span class="keyword">);<br />
@</span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$stream</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="112862""></a>
  <div class="note">
   <strong class="user">Maddie</strong>
   <a href="#112862" class="date">30-Jul-2013 05:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are getting the error - ssh2_scp_recv(): Unable to receive remote file<br />
<br />
Try using file_get_contents("ssh2.s<a href="ftp://$sftp$fileLocation" rel="nofollow" target="_blank">ftp://$sftp$fileLocation</a>") and file_put_contents() as a workaround-- this is after I tried all sorts of different remote file path formats to no avail.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="112508""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#112508" class="date">24-Jun-2013 09:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
May fail when trying to get a remote file from the user's home directory when you try to use a path like '~/filename.txt' .&nbsp; It appears to dislike tildes, so use the full file path.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="110230""></a>
  <div class="note">
   <strong class="user">mark at mohc dot net</strong>
   <a href="#110230" class="date">03-Oct-2012 12:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Transferred files can be truncated if you do not call ssh2_exec($connection,'exit').&nbsp; ssh2_scp_send will return true even if the file did not completely transfer.<br />
<br />
eg.<br />
<br />
ssh2_scp_send($connection, $infile, $remotefile, 0644);<br />
ssh2_exec($connection, 'exit'); // exit the ssh2 connection</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="104124""></a>
  <div class="note">
   <strong class="user">ojovirtual</strong>
   <a href="#104124" class="date">25-May-2011 01:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Trying to get a remote file with spaces in its name?
<br />

<br />
Never forget to use quotes in the remote filename, but never in the local one.
<br />

<br />
Example:
<br />

<br />
<span class="default">&lt;?php
<br />
$remote_file_name</span><span class="keyword">=</span><span class="string">"my name with spaces.ext"
<br />

<br />
</span><span class="default">ssh2_scp_recv</span><span class="keyword">(</span><span class="default">$cn</span><span class="keyword">,</span><span class="default">$remote_file_name</span><span class="keyword">,</span><span class="default">$local_path</span><span class="keyword">.</span><span class="string">"/"</span><span class="keyword">.</span><span class="default">$remote_file_name</span><span class="keyword">); </span><span class="comment">// ERROR
<br />

<br />
</span><span class="default">ssh2_scp_recv</span><span class="keyword">(</span><span class="default">$cn</span><span class="keyword">,</span><span class="string">"\""</span><span class="keyword">.</span><span class="default">$remote_file_name</span><span class="keyword">.</span><span class="string">"\""</span><span class="keyword">,</span><span class="default">$local_path</span><span class="keyword">.</span><span class="string">"/"</span><span class="keyword">.</span><span class="default">$remote_file_name</span><span class="keyword">); </span><span class="comment">//OK
<br />

<br />
</span><span class="default">ssh2_scp_recv</span><span class="keyword">(</span><span class="default">$cn</span><span class="keyword">,</span><span class="string">"\""</span><span class="keyword">.</span><span class="default">$remote_file_name</span><span class="keyword">.</span><span class="string">"\""</span><span class="keyword">,</span><span class="string">"\""</span><span class="keyword">.</span><span class="default">$local_path</span><span class="keyword">.</span><span class="string">"/"</span><span class="keyword">.</span><span class="default">$remote_file_name</span><span class="keyword">.</span><span class="string">"\""</span><span class="keyword">); </span><span class="comment">//ERROR
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
So, the quotes in the file name are needed only for remote, not for local.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="97997""></a>
  <div class="note">
   <strong class="user">luis dot sv at gmail dot com</strong>
   <a href="#97997" class="date">19-May-2010 03:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This function can be used to copy all files into a directory on a remote server, using SSH and SCP.
<br />

<br />
<span class="default">&lt;?php
<br />
$connection </span><span class="keyword">= </span><span class="default">ssh2_connect</span><span class="keyword">(</span><span class="string">'host'</span><span class="keyword">, </span><span class="default">22</span><span class="keyword">);
<br />
</span><span class="default">ssh2_auth_password</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">, </span><span class="string">'user'</span><span class="keyword">, </span><span class="string">'password'</span><span class="keyword">);
<br />

<br />
</span><span class="default">$remote_dir</span><span class="keyword">=</span><span class="string">"/remote_dir/"</span><span class="keyword">;
<br />
</span><span class="default">$local_dir</span><span class="keyword">=</span><span class="string">"/local_dir/"</span><span class="keyword">;
<br />

<br />
</span><span class="default">$com </span><span class="keyword">=</span><span class="string">"ls </span><span class="default">$remote_dir</span><span class="string">"</span><span class="keyword">;
<br />
</span><span class="default">$stream </span><span class="keyword">= </span><span class="default">ssh2_exec</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">, </span><span class="default">$com</span><span class="keyword">);
<br />
</span><span class="default">stream_set_blocking</span><span class="keyword">(</span><span class="default">$stream</span><span class="keyword">,</span><span class="default">true</span><span class="keyword">);
<br />
</span><span class="default">$cmd</span><span class="keyword">=</span><span class="default">fread</span><span class="keyword">(</span><span class="default">$stream</span><span class="keyword">,</span><span class="default">4096</span><span class="keyword">);
<br />

<br />
</span><span class="default">$arr</span><span class="keyword">=</span><span class="default">explode</span><span class="keyword">(</span><span class="string">"\n"</span><span class="keyword">,</span><span class="default">$cmd</span><span class="keyword">);
<br />

<br />
</span><span class="default">$total_files</span><span class="keyword">=</span><span class="default">sizeof</span><span class="keyword">(</span><span class="default">$arr</span><span class="keyword">);
<br />

<br />
for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">$total_files</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">++){
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$file_name</span><span class="keyword">=</span><span class="default">trim</span><span class="keyword">(</span><span class="default">$arr</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]);
<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$file_name</span><span class="keyword">!=</span><span class="string">''</span><span class="keyword">){
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$remote_file</span><span class="keyword">=</span><span class="default">$remote_dir</span><span class="keyword">.</span><span class="default">$file_name</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$local_file</span><span class="keyword">=</span><span class="default">$local_dir</span><span class="keyword">.</span><span class="default">$file_name</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">ssh2_scp_recv</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">, </span><span class="default">$remote_file</span><span class="keyword">,</span><span class="default">$local_file</span><span class="keyword">)){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"File "</span><span class="keyword">.</span><span class="default">$file_name</span><span class="keyword">.</span><span class="string">" was copied to </span><span class="default">$local_dir</span><span class="string">&lt;br /&gt;"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />
}
<br />

<br />
</span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$stream</span><span class="keyword">);
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83487""></a>
  <div class="note">
   <strong class="user">gordon_e_rouse at yahoo dot com dot au</strong>
   <a href="#83487" class="date">28-May-2008 03:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Being still in Beta, I guess it will have it quirks. One I found was that if the remote filename has brackets in it, it just wont work.<br />
<br />
I should file it as a bug report, but find the process all intimidating really - I am always just a stupid user who does not know what he is on about!<br />
<br />
But anyway - the work around of renaming the file before downloading it works fine.<br />
<br />
use:<br />
$_new_path = str_replace("(", "", $_path );<br />
$_new_path = str_replace(")", "", $_new_path );<br />
<br />
ssh2_sftp_rename( $sftp,&nbsp; $_path, $_new_path );<br />
<br />
To tell you the truth I haven't determined if it is the open or close bracket, or both. Someone else can investigate that.<br />
<br />
Meanwhile, it would be good to know all the bad filename characters which this function has problems with, no doubt there are more.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82731""></a>
  <div class="note">
   <strong class="user">miller4980 at msn dot com</strong>
   <a href="#82731" class="date">23-Apr-2008 11:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Problem:<br />
&nbsp; can't pass an array to sftp_scp_rec()<br />
&nbsp; also: for Windows: sftp was not happy when connecting to&nbsp;&nbsp; a&nbsp; Windows dir. <br />
&nbsp; eg: sftp_scp_rec($connection, "remote/directory","local/$directory[$i]");<br />
Solution:<br />
The array was placing whitespace on the end of the variable.<br />
trim(" ","",$directory[$i]);<br />
<br />
connecting to Windows dir:<br />
sftp_scp_rec($connection, "linux/directory","\\windows\share[$i]");<br />
<br />
This script backs up remote Linux directories to a local Windows directory based on modified dates of files.<br />
<br />
The Idea is to get a complete back up of a directory via ftp client etc. <br />
Then when the script runs it will back up newly modified files only.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">//error_reporting(0);<br />
<br />
</span><span class="default">$file&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">=</span><span class="string">''</span><span class="keyword">;<br />
</span><span class="default">$arr2&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">=</span><span class="string">''</span><span class="keyword">;<br />
</span><span class="default">$arr1&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">=</span><span class="string">''</span><span class="keyword">;<br />
</span><span class="default">$ldir&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
<br />
</span><span class="default">$remotedirs</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]&nbsp; &nbsp;&nbsp; = </span><span class="string">"Domain name or IP address/"</span><span class="keyword">;<br />
</span><span class="default">$remotedirs</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]&nbsp; &nbsp;&nbsp; = </span><span class="string">"Domain name or IP address/"</span><span class="keyword">;<br />
</span><span class="default">$remotedirs</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]&nbsp; &nbsp;&nbsp; = </span><span class="string">"Domain name or IP address/"</span><span class="keyword">;<br />
</span><span class="default">$remotedirs</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">]&nbsp; &nbsp;&nbsp; = </span><span class="string">"Domain name or IP address/"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fh </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="string">"c:\dirlist.txt"</span><span class="keyword">,</span><span class="string">"w"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">, </span><span class="string">" "</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">);<br />
foreach (</span><span class="default">$remotedirs </span><span class="keyword">as </span><span class="default">$val</span><span class="keyword">){<br />
echo </span><span class="default">$remotedir </span><span class="keyword">= </span><span class="string">"/data/www/</span><span class="default">$val</span><span class="string">/"</span><span class="keyword">;<br />
</span><span class="default">$localdir&nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="string">"\\\\192.168.0.234\\C$\\xampp\\htdocs\\</span><span class="default">$val</span><span class="string">\\"</span><span class="keyword">;<br />
</span><span class="default">backupwebsites</span><span class="keyword">(</span><span class="default">$remotedir</span><span class="keyword">,</span><span class="default">$localdir</span><span class="keyword">);<br />
}<br />
function </span><span class="default">backupwebsites</span><span class="keyword">(</span><span class="default">$remotedir</span><span class="keyword">,</span><span class="default">$localdir</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$connection </span><span class="keyword">= </span><span class="default">ssh2_connect</span><span class="keyword">(</span><span class="default">Host IP </span><span class="keyword">or </span><span class="default">Domain</span><span class="keyword">, </span><span class="default">22</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$com </span><span class="keyword">=</span><span class="string">"ls -R -lt </span><span class="default">$remotedir</span><span class="string">"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">ssh2_auth_password</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">, </span><span class="string">'user'</span><span class="keyword">, </span><span class="string">'password'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$stream </span><span class="keyword">= </span><span class="default">ssh2_exec</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">, </span><span class="default">$com </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">stream_set_blocking</span><span class="keyword">(</span><span class="default">$stream</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$output </span><span class="keyword">= </span><span class="default">stream_get_contents</span><span class="keyword">(</span><span class="default">$stream</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fh </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="string">"c:\dirlist.txt"</span><span class="keyword">,</span><span class="string">"a+"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">, </span><span class="default">$output</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fh</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$handle </span><span class="keyword">= @</span><span class="default">fopen</span><span class="keyword">(</span><span class="string">'c:\dirlist.txt'</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">);<br />
if (</span><span class="default">$handle</span><span class="keyword">) {<br />
&nbsp;&nbsp; while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$lines</span><span class="keyword">[] = </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="default">4096</span><span class="keyword">);<br />
&nbsp;&nbsp; }<br />
&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">);<br />
}<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$lines </span><span class="keyword">as </span><span class="default">$val</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$yr </span><span class="keyword">= </span><span class="default">date</span><span class="keyword">(</span><span class="string">'Y-m-d'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$i</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$arr1</span><span class="keyword">=</span><span class="default">split</span><span class="keyword">(</span><span class="string">"200"</span><span class="keyword">,</span><span class="default">$val</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$arr2</span><span class="keyword">=</span><span class="default">explode</span><span class="keyword">(</span><span class="string">" "</span><span class="keyword">,</span><span class="default">$arr1</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="string">"200"</span><span class="keyword">.</span><span class="default">$arr2</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]==</span><span class="default">$yr</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//if("200".$arr2[0]=='2008-04-21'){&nbsp; &nbsp; //for testing<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$remotedir </span><span class="keyword">= </span><span class="default">$remotedir</span><span class="keyword">.</span><span class="default">$arr2</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$cpy</span><span class="keyword">=</span><span class="default">$arr2</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$file </span><span class="keyword">= </span><span class="default">$localdir</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">glue</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">,</span><span class="default">$remotedir</span><span class="keyword">,</span><span class="default">$localdir</span><span class="keyword">,</span><span class="default">$cpy</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
}&nbsp; &nbsp; <br />
</span><span class="comment">//echo $i;<br />
</span><span class="keyword">function </span><span class="default">glue</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">,</span><span class="default">$remotedir</span><span class="keyword">,</span><span class="default">$localdir</span><span class="keyword">,</span><span class="default">$cpy</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ldir</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] = </span><span class="string">"</span><span class="default">$localdir</span><span class="string">"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ldir</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]=</span><span class="string">"</span><span class="default">$cpy</span><span class="string">"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$file </span><span class="keyword">= </span><span class="default">$ldir</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">].</span><span class="default">$ldir</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$file </span><span class="keyword">= </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$file</span><span class="keyword">;<br />
&nbsp;</span><span class="default">gop</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">,</span><span class="default">$remotedir</span><span class="keyword">,</span><span class="default">$file</span><span class="keyword">);<br />
}<br />
function </span><span class="default">gop</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">,</span><span class="default">$remotedir</span><span class="keyword">,</span><span class="default">$file</span><span class="keyword">){<br />
echo </span><span class="default">$file</span><span class="keyword">;<br />
<br />
</span><span class="default">ssh2_scp_recv</span><span class="keyword">(<br />
</span><span class="default">$connection</span><span class="keyword">, <br />
</span><span class="default">$remotedir</span><span class="keyword">,<br />
</span><span class="default">$file</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82072""></a>
  <div class="note">
   <strong class="user">chad dot [the letter d] johnson AT gmail</strong>
   <a href="#82072" class="date">26-Mar-2008 12:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If when trying to use this function you get "Warning: ssh2_scp_send(): Failure creating remote file," then try using<br />
<br />
$data = file_get_contents("ssh2.s<a href="ftp://$sftp/path/to/file" rel="nofollow" target="_blank">ftp://$sftp/path/to/file</a>");</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68734""></a>
  <div class="note">
   <strong class="user">jcalcote at novell dot com</strong>
   <a href="#68734" class="date">08-Aug-2006 01:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you scan a remote directory for a list of files by using opendir and readdir on a path obtained from ssh2_sftp(), you'll end up with a list of full file paths containing the ssh2.s<a href="ftp://$sftp prefix, where $sftp is the sftp resource string returned by ssh2_sftp. " rel="nofollow" target="_blank">ftp://$sftp prefix, where $sftp is the sftp resource string returned by ssh2_sftp. </a><br />
<br />
If you later attempt to use ssh2_scp_recv() (even on the same connection!) to copy files locally from the remote path, the copy operation will fail because ssh2_scp_recv() doesn't like the wrapper path prefix. It expects remote file references to be rooted at the base of the remote file system (eg., '/').<br />
<br />
Moral: ssh2_scp_recv() likes paths rooted at the file system root on the remote machine, not full network paths. This routine will fail with an obscure message about not being able to copy the files - yet when you go look it works fine. Worse, when you connect and copy them from an scp shell session, it also works fine.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
