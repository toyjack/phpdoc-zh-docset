<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>用灰度拷贝并合并图像的一部分</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.imagecopymerge.html">? imagecopymerge</a></li>
      <li style="float: right;"><a href="function.imagecopyresampled.html">imagecopyresampled ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.image.html">GD 和图像处理 函数</a></li>
    <li>用灰度拷贝并合并图像的一部分</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.imagecopymergegray" class="refentry">
  <div class="refnamediv">
   <h1 class="refname">imagecopymergegray</h1>
   <p class="verinfo">(PHP 4 &gt;= 4.0.6, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">imagecopymergegray</span> &mdash; <span class="dc-title">用灰度拷贝并合并图像的一部分</span></p>

  </div>
  <div class="refsect1 unknown-unknown-unknown-seealsr" id="refsect1-function.imagecopymergegray-unknown-unknown-unknown-seealsr">
   <h3 class="title">说明</h3>
   <div class="methodsynopsis dc-description">
    <span class="methodname"><strong>imagecopymergegray</strong></span>(<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">resource</span> <code class="parameter">$dst_im</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">resource</span> <code class="parameter">$src_im</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter">$dst_x</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter">$dst_y</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter">$src_x</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter">$src_y</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter">$src_w</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter">$src_h</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter">$pct</code></span><br>): <span class="type">bool</span></div>

   <p class="para rdfs-comment">
    将 <code class="parameter">src_im</code> 图像中坐标从
    <code class="parameter">src_x</code>，<code class="parameter">src_y </code>
    开始，宽度为 <code class="parameter">src_w</code>，高度为 <code class="parameter">src_h</code>
    的一部分拷贝到
    <code class="parameter">dst_im</code> 图像中坐标为
    <code class="parameter">dst_x</code> 和 <code class="parameter">dst_y</code>
    的位置上。两图像将根据 <code class="parameter">pct</code>
    来决定合并程度，其值范围从 0 到 100。当 <code class="parameter">pct</code> = 0
    时，实际上什么也没做，当为 100 时本函数和 <span class="function"><a href="function.imagecopy.html" class="function">imagecopy()</a></span> 完全一样。
   </p>
   <p class="para">
    本函数和 <span class="function"><a href="function.imagecopymerge.html" class="function">imagecopymerge()</a></span>
    完全一样只除了合并时通过在拷贝操作前将目标像素转换为灰度级来保留了原色度。
   </p>
   <blockquote class="note"><p><strong class="note">Note</strong>: 
    <p class="para">
     本函数添加于 PHP 4.0.6。
    </p>
   </p></blockquote>
  </div>

 </div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="94111""></a>
  <div class="note">
   <strong class="user">anonymous at domain dot com</strong>
   <a href="#94111" class="date">16-Oct-2009 03:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
grayscale conversion is built-in with imagefilter(). <br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp; &nbsp; </span><span class="comment">/* other code */<br />
<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$image </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="string">'some.jpg'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">imagefilter</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">IMG_FILTER_GRAYSCALE</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; </span><span class="comment">/* other code (ie save) */<br />
<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; </span><span class="comment">/* other code */<br />
</span><span class="default">?&gt;<br />
</span><br />
you could create the sepia effect by the following:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp; &nbsp; </span><span class="comment">/* other code */<br />
<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$image </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="string">'some.jpg'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">imagefilter</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">IMG_FILTER_GRAYSCALE</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">imagefilter</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">IMG_FILTER_COLORIZE</span><span class="keyword">, </span><span class="default">112</span><span class="keyword">, </span><span class="default">66</span><span class="keyword">, </span><span class="default">20</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; </span><span class="comment">//Wikipedia RGB definition of sepia<br />
<br />
&nbsp;&nbsp; &nbsp; /* other code (ie save) */<br />
<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; </span><span class="comment">/* other code */<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83104""></a>
  <div class="note">
   <strong class="user">amezghal at msn dot com</strong>
   <a href="#83104" class="date">09-May-2008 05:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
gray effect :)<br />
<span class="default">&lt;?php<br />
header</span><span class="keyword">(</span><span class="string">'content-type:image/png'</span><span class="keyword">);<br />
</span><span class="default">$url_img </span><span class="keyword">= </span><span class="string">'my_image.png'</span><span class="keyword">;<br />
</span><span class="default">$img </span><span class="keyword">= </span><span class="default">imagecreatefrompng</span><span class="keyword">(</span><span class="default">$url_img</span><span class="keyword">);<br />
</span><span class="default">$x </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">);<br />
</span><span class="default">$y </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">);<br />
</span><span class="default">$gray_img </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">);<br />
</span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$gray_img</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$x</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {<br />
&nbsp; for (</span><span class="default">$j </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$j </span><span class="keyword">&lt; </span><span class="default">$y</span><span class="keyword">; </span><span class="default">$j</span><span class="keyword">++) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$rgb </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">, </span><span class="default">$j</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$r </span><span class="keyword">= (</span><span class="default">$rgb </span><span class="keyword">&gt;&gt; </span><span class="default">16</span><span class="keyword">) &amp; </span><span class="default">0xFF</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$g </span><span class="keyword">= (</span><span class="default">$rgb </span><span class="keyword">&gt;&gt; </span><span class="default">8</span><span class="keyword">) &amp; </span><span class="default">0xFF</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$b </span><span class="keyword">= </span><span class="default">$rgb </span><span class="keyword">&amp; </span><span class="default">0xFF</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; </span><span class="comment">//for gray mode $r = $g = $b<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$color </span><span class="keyword">= </span><span class="default">max</span><span class="keyword">(array(</span><span class="default">$r</span><span class="keyword">, </span><span class="default">$g</span><span class="keyword">, </span><span class="default">$b</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$gray_color </span><span class="keyword">= </span><span class="default">imagecolorexact</span><span class="keyword">(</span><span class="default">$new_img</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">,&nbsp;&nbsp; </span><span class="default">$color</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$gray_img</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">, </span><span class="default">$j</span><span class="keyword">, </span><span class="default">$gray_color</span><span class="keyword">);<br />
&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74523""></a>
  <div class="note">
   <strong class="user">szamil at ginf dot pl</strong>
   <a href="#74523" class="date">15-Apr-2007 02:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I've changed a little switch251's code and here we have sephia effect<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp; </span><span class="comment">// replace with your files<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$originalFileName&nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">$filename</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$destinationFileName </span><span class="keyword">= </span><span class="string">"2"</span><span class="keyword">.</span><span class="default">$filename</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// create a copy of the original image<br />
&nbsp;&nbsp;&nbsp; // works with jpg images<br />
&nbsp;&nbsp;&nbsp; // fell free to adapt to other formats ;)<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fullPath </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">"."</span><span class="keyword">,</span><span class="default">$originalFileName</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$lastIndex </span><span class="keyword">= </span><span class="default">sizeof</span><span class="keyword">(</span><span class="default">$fullPath</span><span class="keyword">) - </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$extension </span><span class="keyword">= </span><span class="default">$fullPath</span><span class="keyword">[</span><span class="default">$lastIndex</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/jpg|jpeg|JPG|JPEG/"</span><span class="keyword">, </span><span class="default">$extension</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$sourceImage </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$originalFileName</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// get image dimensions<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$img_width&nbsp; </span><span class="keyword">= </span><span class="default">imageSX</span><span class="keyword">(</span><span class="default">$sourceImage</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$img_height </span><span class="keyword">= </span><span class="default">imageSY</span><span class="keyword">(</span><span class="default">$sourceImage</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// convert to grayscale<br />
&nbsp;&nbsp;&nbsp; // note: this will NOT affect your original image, unless<br />
&nbsp;&nbsp;&nbsp; // originalFileName and destinationFileName are the same<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">for (</span><span class="default">$y </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$y </span><span class="keyword">&lt;</span><span class="default">$img_height</span><span class="keyword">; </span><span class="default">$y</span><span class="keyword">++) <br />
&nbsp;&nbsp;&nbsp; { <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for (</span><span class="default">$x </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$x </span><span class="keyword">&lt;</span><span class="default">$img_width</span><span class="keyword">; </span><span class="default">$x</span><span class="keyword">++) <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; { <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$rgb </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$sourceImage</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$red&nbsp;&nbsp; </span><span class="keyword">= (</span><span class="default">$rgb </span><span class="keyword">&gt;&gt; </span><span class="default">16</span><span class="keyword">) &amp; </span><span class="default">0xFF</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$green </span><span class="keyword">= (</span><span class="default">$rgb </span><span class="keyword">&gt;&gt; </span><span class="default">8</span><span class="keyword">)&nbsp; &amp; </span><span class="default">0xFF</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$blue&nbsp; </span><span class="keyword">= </span><span class="default">$rgb </span><span class="keyword">&amp; </span><span class="default">0xFF</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//sephia<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$red2 </span><span class="keyword">= </span><span class="default">min</span><span class="keyword">(</span><span class="default">$red</span><span class="keyword">*</span><span class="default">.393 </span><span class="keyword">+ </span><span class="default">$green</span><span class="keyword">*</span><span class="default">.769 </span><span class="keyword">+ </span><span class="default">$blue</span><span class="keyword">*</span><span class="default">.189</span><span class="keyword">,</span><span class="default">255</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$green2 </span><span class="keyword">= </span><span class="default">min</span><span class="keyword">(</span><span class="default">$red</span><span class="keyword">*</span><span class="default">.349 </span><span class="keyword">+ </span><span class="default">$green</span><span class="keyword">*</span><span class="default">.686 </span><span class="keyword">+ </span><span class="default">$blue</span><span class="keyword">*</span><span class="default">.168</span><span class="keyword">,</span><span class="default">255</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$blue2&nbsp; </span><span class="keyword">= </span><span class="default">min</span><span class="keyword">(</span><span class="default">$red</span><span class="keyword">*</span><span class="default">.272 </span><span class="keyword">+ </span><span class="default">$green</span><span class="keyword">*</span><span class="default">.534 </span><span class="keyword">+ </span><span class="default">$blue</span><span class="keyword">*</span><span class="default">.131</span><span class="keyword">,</span><span class="default">255</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// shift gray level to the left<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$grayR </span><span class="keyword">= </span><span class="default">$red2 </span><span class="keyword">&lt;&lt; </span><span class="default">16</span><span class="keyword">;&nbsp;&nbsp; </span><span class="comment">// R: red<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$grayG </span><span class="keyword">= </span><span class="default">$green2 </span><span class="keyword">&lt;&lt; </span><span class="default">8 </span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">// G: green<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$grayB </span><span class="keyword">= </span><span class="default">$blue2</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// B: blue<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // OR operation to compute gray value<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$grayColor </span><span class="keyword">= </span><span class="default">$grayR </span><span class="keyword">| </span><span class="default">$grayG </span><span class="keyword">| </span><span class="default">$grayB</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// set the pixel color<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagesetpixel </span><span class="keyword">(</span><span class="default">$sourceImage</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$grayColor</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagecolorallocate </span><span class="keyword">(</span><span class="default">$sourceImage</span><span class="keyword">, </span><span class="default">$gray</span><span class="keyword">, </span><span class="default">$gray</span><span class="keyword">, </span><span class="default">$gray</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// copy pixel values to new file buffer<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$destinationImage </span><span class="keyword">= </span><span class="default">ImageCreateTrueColor</span><span class="keyword">(</span><span class="default">$img_width</span><span class="keyword">, </span><span class="default">$img_height</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagecopy</span><span class="keyword">(</span><span class="default">$destinationImage</span><span class="keyword">, </span><span class="default">$sourceImage</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$img_width</span><span class="keyword">, </span><span class="default">$img_height</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// create file on disk<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$destinationImage</span><span class="keyword">, </span><span class="default">$destinationFileName</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// destroy temp image buffers<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$destinationImage</span><span class="keyword">);&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$sourceImage</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="55853""></a>
  <div class="note">
   <strong class="user">Mark Barba</strong>
   <a href="#55853" class="date">15-Aug-2005 12:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
//&nbsp; Using the same code I found here on php.net, <br />
// I was able to figure out how to convert GIF (or any other<br />
// format GD supports) to CIP format.&nbsp; CIP is the image<br />
// format for Cisco IP Phones...&nbsp; 7905/7940 and 7960 <br />
// models...&nbsp; Hope someone finds this useful and make it <br />
// better...&nbsp; <br />
<br />
/////// GIF2CIP PHP code ///////<br />
<br />
// Convert image in memory to grayscale<br />
&nbsp;&nbsp;&nbsp; $img_width&nbsp; = imageSX($im2);<br />
&nbsp;&nbsp;&nbsp; $img_height = imageSY($im2);<br />
<br />
&nbsp;&nbsp; // convert to grayscale<br />
&nbsp;&nbsp; // note: this will NOT affect your original image, unless<br />
&nbsp;&nbsp; // originalFileName and destinationFileName are the same<br />
&nbsp;&nbsp; for ($y = 0; $y &lt;$img_height; $y++) { <br />
&nbsp;&nbsp; &nbsp; &nbsp; for ($x = 0; $x &lt;$img_width; $x++) { <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $rgb = imagecolorat($im2, $x, $y);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $red&nbsp; = ($rgb &gt;&gt; 16) &amp; 0xFF;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $green = ($rgb &gt;&gt; 8)&nbsp; &amp; 0xFF;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $blue&nbsp; = $rgb &amp; 0xFF;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $gray = round(.299*$red + .587*$green + .114*$blue);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // shift gray level to the left<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $grayR = $gray &lt;&lt; 16;&nbsp; // R: red<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $grayG = $gray &lt;&lt; 8;&nbsp; &nbsp; // G: green<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $grayB = $gray;&nbsp; &nbsp; &nbsp; &nbsp; // B: blue<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // OR operation to compute gray value<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $grayColor = $grayR | $grayG | $grayB;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // set the pixel color<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; imagesetpixel ($im2, $x, $y, $grayColor);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; imagecolorallocate ($im2, $gray, $gray, $gray);<br />
&nbsp;&nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; }<br />
/////////////////////////////////////////////////////////<br />
<br />
&nbsp;&nbsp;&nbsp; // Modifies palette to only 4-colors (CIP Images on 7905/7940 &amp; 7960 is 2-bit color)<br />
&nbsp;&nbsp;&nbsp; ImageTrueColorToPalette2($im2,FALSE,4);<br />
<br />
&nbsp;&nbsp;&nbsp; // Basic header for CIP Image files...<br />
&nbsp;&nbsp;&nbsp; header ("Content-type: text/xml");<br />
&nbsp;&nbsp;&nbsp; echo "&lt;CiscoIPPhoneImage&gt; ";<br />
&nbsp;&nbsp;&nbsp; echo "&lt;LocationX&gt;-1&lt;/LocationX&gt; ";<br />
&nbsp;&nbsp;&nbsp; echo "&lt;LocationY&gt;-1&lt;/LocationY&gt; ";<br />
&nbsp;&nbsp;&nbsp; echo "&lt;Width&gt;132&lt;/Width&gt; ";<br />
&nbsp;&nbsp;&nbsp; echo "&lt;Height&gt;65&lt;/Height&gt; ";<br />
&nbsp;&nbsp;&nbsp; echo "&lt;Depth&gt;2&lt;/Depth&gt; ";<br />
&nbsp;&nbsp;&nbsp; echo "&lt;Data&gt;";<br />
<br />
// get image dimensions (almost same code as above)<br />
&nbsp;&nbsp; $img_width&nbsp; = imageSX($im2);<br />
&nbsp;&nbsp; $img_height = imageSY($im2);<br />
<br />
&nbsp;&nbsp; // convert to grayscale<br />
&nbsp;&nbsp; // note: this will NOT affect your original image, unless<br />
&nbsp;&nbsp; // originalFileName and destinationFileName are the same<br />
&nbsp;&nbsp; for ($y = 0; $y &lt;$img_height; $y++) { <br />
&nbsp;&nbsp; &nbsp; &nbsp; for ($x = 0; $x+4 &lt;$img_width; $x = $x+4) <br />
&nbsp;&nbsp; &nbsp; &nbsp; { <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for ($ix = 0; $ix &lt; 4; $ix++)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $rgb = imagecolorat($im2, $x + $ix, $y);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // I came up with this translation on my own<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Some smart person is bound to perfect it<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ($rgb=="2") {$rgb=0;$Gray1[$ix] = $rgb;continue;}<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ($rgb=="0") {$rgb=2;$Gray1[$ix] = $rgb;continue;}<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ($rgb=="1") {$rgb=1;$Gray1[$ix] = $rgb;continue;}<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ($rgb=="3") {$rgb=3;$Gray1[$ix] = $rgb;continue;}<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $gray1 = $Gray1[0];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $gray2 = $Gray1[1] &lt;&lt; 2;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $gray3 = $Gray1[2] &lt;&lt; 4;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $gray4 = $Gray1[3] &lt;&lt; 6;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // Pack 4 pixels into a single byte for CIP images<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $grey = $gray1 | $gray2 | $gray3 | $gray4;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // CIP image data is sent in HEX, strtoupper is not really needed.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $code = strtoupper(dechex($grey)); <br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // My quick fix to padding single HEX values<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (strlen($code)==1) $code = "0".$code;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo $code;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; }<br />
<br />
&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; echo "&lt;/Data&gt;";<br />
&nbsp;&nbsp;&nbsp; echo "&lt;Title&gt;$myvar&lt;/Title&gt; ";<br />
&nbsp;&nbsp;&nbsp; echo "&lt;Prompt&gt;$city&lt;/Prompt&gt; ";<br />
&nbsp;&nbsp;&nbsp; echo "&lt;/CiscoIPPhoneImage&gt;";<br />
&nbsp;&nbsp;&nbsp; exit;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="41579""></a>
  <div class="note">
   <strong class="user">switch251 at netcourrier dot com</strong>
   <a href="#41579" class="date">15-Apr-2004 07:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In addition to code_couturier too: his code will produce blue pictures, because the value he uses to set the pixel color (the code is incomplete: I first thought it should be $gray) is between 0 and 255, which corresponds to blue levels.<br />
<br />
To convert the picture to grayscale, use the following code:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// replace with your files<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$originalFileName&nbsp; &nbsp; </span><span class="keyword">= </span><span class="string">"colorPicture.jpg"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$destinationFileName </span><span class="keyword">= </span><span class="string">"bwPicture.jpg"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// create a copy of the original image<br />
&nbsp;&nbsp;&nbsp; // works with jpg images<br />
&nbsp;&nbsp;&nbsp; // fell free to adapt to other formats ;)<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fullPath </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">"."</span><span class="keyword">,</span><span class="default">$originalFileName</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$lastIndex </span><span class="keyword">= </span><span class="default">sizeof</span><span class="keyword">(</span><span class="default">$fullPath</span><span class="keyword">) - </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$extension </span><span class="keyword">= </span><span class="default">$fullPath</span><span class="keyword">[</span><span class="default">$lastIndex</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/jpg|jpeg|JPG|JPEG/"</span><span class="keyword">, </span><span class="default">$extension</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$sourceImage </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$originalFileName</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// get image dimensions<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$img_width&nbsp; </span><span class="keyword">= </span><span class="default">imageSX</span><span class="keyword">(</span><span class="default">$sourceImage</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$img_height </span><span class="keyword">= </span><span class="default">imageSY</span><span class="keyword">(</span><span class="default">$sourceImage</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// convert to grayscale<br />
&nbsp;&nbsp;&nbsp; // note: this will NOT affect your original image, unless<br />
&nbsp;&nbsp;&nbsp; // originalFileName and destinationFileName are the same<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">for (</span><span class="default">$y </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$y </span><span class="keyword">&lt;</span><span class="default">$img_height</span><span class="keyword">; </span><span class="default">$y</span><span class="keyword">++) { <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for (</span><span class="default">$x </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$x </span><span class="keyword">&lt;</span><span class="default">$img_width</span><span class="keyword">; </span><span class="default">$x</span><span class="keyword">++) { <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$rgb </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$sourceImage</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$red&nbsp;&nbsp; </span><span class="keyword">= (</span><span class="default">$rgb </span><span class="keyword">&gt;&gt; </span><span class="default">16</span><span class="keyword">) &amp; </span><span class="default">0xFF</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$green </span><span class="keyword">= (</span><span class="default">$rgb </span><span class="keyword">&gt;&gt; </span><span class="default">8</span><span class="keyword">)&nbsp; &amp; </span><span class="default">0xFF</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$blue&nbsp; </span><span class="keyword">= </span><span class="default">$rgb </span><span class="keyword">&amp; </span><span class="default">0xFF</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$gray </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">(</span><span class="default">.299</span><span class="keyword">*</span><span class="default">$red </span><span class="keyword">+ </span><span class="default">.587</span><span class="keyword">*</span><span class="default">$green </span><span class="keyword">+ </span><span class="default">.114</span><span class="keyword">*</span><span class="default">$blue</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// shift gray level to the left<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$grayR </span><span class="keyword">= </span><span class="default">$gray </span><span class="keyword">&lt;&lt; </span><span class="default">16</span><span class="keyword">;&nbsp;&nbsp; </span><span class="comment">// R: red<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$grayG </span><span class="keyword">= </span><span class="default">$gray </span><span class="keyword">&lt;&lt; </span><span class="default">8</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">// G: green<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$grayB </span><span class="keyword">= </span><span class="default">$gray</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// B: blue<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // OR operation to compute gray value<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$grayColor </span><span class="keyword">= </span><span class="default">$grayR </span><span class="keyword">| </span><span class="default">$grayG </span><span class="keyword">| </span><span class="default">$grayB</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// set the pixel color<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagesetpixel </span><span class="keyword">(</span><span class="default">$sourceImage</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$grayColor</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagecolorallocate </span><span class="keyword">(</span><span class="default">$sourceImage</span><span class="keyword">, </span><span class="default">$gray</span><span class="keyword">, </span><span class="default">$gray</span><span class="keyword">, </span><span class="default">$gray</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// copy pixel values to new file buffer<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$destinationImage </span><span class="keyword">= </span><span class="default">ImageCreateTrueColor</span><span class="keyword">(</span><span class="default">$img_width</span><span class="keyword">, </span><span class="default">$img_height</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagecopy</span><span class="keyword">(</span><span class="default">$destinationImage</span><span class="keyword">, </span><span class="default">$sourceImage</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$img_width</span><span class="keyword">, </span><span class="default">$img_height</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// create file on disk<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$destinationImage</span><span class="keyword">, </span><span class="default">$destinationFileName</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// destroy temp image buffers<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$destinationImage</span><span class="keyword">);&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$sourceImage</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Copy-paste, replace the file names on the top and there you go (picture files must be in same folder as this script. If not, you will have to do your own file management).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="39920""></a>
  <div class="note">
   <strong class="user">annonymous at example dot com</strong>
   <a href="#39920" class="date">15-Feb-2004 04:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
in addition to code_couturier - try this formula to calculate gray-value (luminance) in his "more exact" way:<br />
<br />
$gray = round(.299*$red + .587*$green + .114*$blue);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="36668""></a>
  <div class="note">
   <strong class="user">code_couturier at graffiti dot net</strong>
   <a href="#36668" class="date">18-Oct-2003 12:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
# very fast way to generate a grayscal-<br />
# image from a true color image<br />
<br />
#...<br />
<br />
# --- quick grayscale image<br />
for ($y = 0; $y &lt;$img_height; $y++) { <br />
&nbsp;for ($x = 0; $x &lt;$img_width; $x++) { <br />
<br />
&nbsp;# here we extract the green from <br />
&nbsp;# the pixel at x,y , to use it as gray value<br />
&nbsp;$gray = (ImageColorAt($image, $x, $y) &gt;&gt; 8) &amp; 0xFF;<br />
<br />
&nbsp;# a more exact way would be this:<br />
&nbsp;# $rgb = ImageColorAt($image, $x, $y);<br />
&nbsp;# $red = ($rgb &gt;&gt; 16) &amp; 0xFF;<br />
&nbsp;# $green = (trgb &gt;&gt; 8) &amp; 0xFF;<br />
&nbsp;# $blue = $rgb &amp; 0xFF;<br />
&nbsp;# $gray = (int)(($red+$green+$blue)/4); <br />
<br />
&nbsp;# and here we set the new pixel/color<br />
&nbsp; imagesetpixel ($image, $x, $y, <br />
&nbsp; ImageColorAllocate ($image, $gray,$gray,$gray));<br />
&nbsp;}<br />
}<br />
&nbsp;<br />
# ...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="36420""></a>
  <div class="note">
   <strong class="user">mail at laeubi dot de</strong>
   <a href="#36420" class="date">09-Oct-2003 12:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This function don't work properly for me on trucolerimages (have not tried yet for other types) it jsut produce a part-grayscale image, and some color get mesed up.<br />
I found a workaround here:<br />
<a href="http://www.phpbuilder.com/columns/cash20030526.php3?page=2" rel="nofollow" target="_blank">http://www.phpbuilder.com/columns/cash20030526.php3?page=2</a><br />
<br />
[quote]<br />
Advanced Image Editing Under the GD Library<br />
Colorizing<br />
Colorizing images is fairly easy to do. The easiest way to colorize an image is fairly simple to grasp. Create an image of the same dimensions and fill that image with the color you want to change it to. This new image is then placed on top of the older image, giving it a colorized look.<br />
<br />
<span class="default">&lt;?php <br />
</span><span class="keyword">function </span><span class="default">imagecolorize</span><span class="keyword">(&amp;</span><span class="default">$im</span><span class="keyword">,&amp;</span><span class="default">$col</span><span class="keyword">,</span><span class="default">$pct</span><span class="keyword">) { <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Get the image's width <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$im_w </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Get the image's height <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$im_h </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Set a pixel with the color, so we can get it easily <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$setpixel </span><span class="keyword">= </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">$im_w</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$col</span><span class="keyword">);&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Get the color <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$index </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">$im_w</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">);&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Find the color in the index <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$rgb </span><span class="keyword">= </span><span class="default">imagecolorsforindex</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">$index</span><span class="keyword">);&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Get the red value <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$r </span><span class="keyword">= </span><span class="default">$rgb</span><span class="keyword">[</span><span class="string">"red"</span><span class="keyword">]; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Get the green value <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$g </span><span class="keyword">= </span><span class="default">$rgb</span><span class="keyword">[</span><span class="string">"green"</span><span class="keyword">];&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Get the blue value <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$b </span><span class="keyword">= </span><span class="default">$rgb</span><span class="keyword">[</span><span class="string">"blue"</span><span class="keyword">];&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Create the layover <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$layover </span><span class="keyword">= </span><span class="default">imagecreate</span><span class="keyword">(</span><span class="default">$im_w</span><span class="keyword">,</span><span class="default">$im_h</span><span class="keyword">);&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Allocate the color on this image <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$color </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$layover</span><span class="keyword">,</span><span class="default">$r</span><span class="keyword">,</span><span class="default">$g</span><span class="keyword">,</span><span class="default">$b</span><span class="keyword">);&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Fill the image with the new color (this really isn't needed) <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fill </span><span class="keyword">= </span><span class="default">imagefill</span><span class="keyword">(</span><span class="default">$layover</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$color</span><span class="keyword">);&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Merge the layover on top of the older image <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$merge </span><span class="keyword">= </span><span class="default">imagecopymerge</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">$layover</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$im_w</span><span class="keyword">,</span><span class="default">$im_h</span><span class="keyword">,</span><span class="default">$pct</span><span class="keyword">); <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$layover</span><span class="keyword">); </span><span class="comment">// Destroy the layover <br />
</span><span class="keyword">} <br />
</span><span class="default">?&gt;</span> <br />
<br />
If we use a blue layover RGB(0,0,255), we get this result:<br />
[/quote]<br />
<br />
if you use black or gray, its not perfekt, but better than nothing ;)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
