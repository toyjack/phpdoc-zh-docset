<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>给指定调色板索引设定颜色</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.imagecolorresolvealpha.html">? imagecolorresolvealpha</a></li>
      <li style="float: right;"><a href="function.imagecolorsforindex.html">imagecolorsforindex ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.image.html">GD 和图像处理 函数</a></li>
    <li>给指定调色板索引设定颜色</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.imagecolorset" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">imagecolorset</h1>
  <p class="verinfo">(PHP 4, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">imagecolorset</span> &mdash; <span class="dc-title">给指定调色板索引设定颜色</span></p>

 </div>
 <div class="refsect1 unknown-seealsp" id="refsect1-function.imagecolorset-unknown-seealsp">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>imagecolorset</strong></span>(<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">resource</span> <code class="parameter">$image</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter">$index</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter">$red</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter">$green</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter">$blue</code></span><br>): <span class="type"><span class="type void">void</span></span></div>

  <p class="para rdfs-comment">
   本函数将调色板中指定的索引设定为指定的颜色。对于在调色板图像中创建类似区域填充（flood-fill）的效果很有用，免去了真的去填充的开销。
  </p>
  <p class="para">
   参见 <span class="function"><a href="function.imagecolorat.html" class="function">imagecolorat()</a></span>。
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="117574""></a>
  <div class="note">
   <strong class="user">Daniel Klein</strong>
   <a href="#117574" class="date">01-Jul-2015 01:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are creating a palette image from scratch you have to use imagecolorallocate() for each index before you can use imagecolorset() on it.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93134""></a>
  <div class="note">
   <strong class="user">Bartman</strong>
   <a href="#93134" class="date">25-Aug-2009 02:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I had the same problem as heavyraptor2 so i made this function...<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">imagecolorize</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">$endcolor</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//funcion takes image and turns black into $endcolor, white to white and<br />
&nbsp;&nbsp;&nbsp; //everything in between in corresponding gradient<br />
&nbsp;&nbsp;&nbsp; //$endcolor should be 6 char html color<br />
<br />
&nbsp;&nbsp;&nbsp; //make sure it has usable palette<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">imageistruecolor</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagetruecolortopalette</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">, </span><span class="default">256</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//first make it gray to be sure of even results (thanks moxleystratton.com)<br />
&nbsp;&nbsp;&nbsp; //comment this loop if you want the output based on, for example, <br />
&nbsp;&nbsp;&nbsp; //the red channel (for this take a look at the $gray-var in the last loop)<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">for (</span><span class="default">$c </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$c </span><span class="keyword">&lt; </span><span class="default">imagecolorstotal</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">); </span><span class="default">$c</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$col </span><span class="keyword">= </span><span class="default">imagecolorsforindex</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">$c</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$gray </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">(</span><span class="default">0.299 </span><span class="keyword">* </span><span class="default">$col</span><span class="keyword">[</span><span class="string">'red'</span><span class="keyword">] + </span><span class="default">0.587 </span><span class="keyword">* </span><span class="default">$col</span><span class="keyword">[</span><span class="string">'green'</span><span class="keyword">] + </span><span class="default">0.114 </span><span class="keyword">* </span><span class="default">$col</span><span class="keyword">[</span><span class="string">'blue'</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagecolorset</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">$c</span><span class="keyword">, </span><span class="default">$gray</span><span class="keyword">, </span><span class="default">$gray</span><span class="keyword">, </span><span class="default">$gray</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//determine end-colors in hexdec<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$EndcolorRGB</span><span class="keyword">[</span><span class="string">'r'</span><span class="keyword">] = </span><span class="default">hexdec</span><span class="keyword">( </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$endcolor</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$EndcolorRGB</span><span class="keyword">[</span><span class="string">'g'</span><span class="keyword">] = </span><span class="default">hexdec</span><span class="keyword">( </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$endcolor</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$EndcolorRGB</span><span class="keyword">[</span><span class="string">'b'</span><span class="keyword">] = </span><span class="default">hexdec</span><span class="keyword">( </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$endcolor</span><span class="keyword">, </span><span class="default">4</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">));<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//determine gradient-delta's<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$stepR </span><span class="keyword">= (</span><span class="default">255</span><span class="keyword">-</span><span class="default">$EndcolorRGB</span><span class="keyword">[</span><span class="string">'r'</span><span class="keyword">])/</span><span class="default">255.0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$stepG </span><span class="keyword">= (</span><span class="default">255</span><span class="keyword">-</span><span class="default">$EndcolorRGB</span><span class="keyword">[</span><span class="string">'g'</span><span class="keyword">])/</span><span class="default">255.0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$stepB </span><span class="keyword">= (</span><span class="default">255</span><span class="keyword">-</span><span class="default">$EndcolorRGB</span><span class="keyword">[</span><span class="string">'b'</span><span class="keyword">])/</span><span class="default">255.0</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//aColor contains the 256 gradations between endcolor(i=0) and white(i=255)<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$aColor </span><span class="keyword">= array();<br />
&nbsp;&nbsp;&nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">&lt;=</span><span class="default">255</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$aColor</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][</span><span class="string">'r'</span><span class="keyword">] = </span><span class="default">$EndcolorRGB</span><span class="keyword">[</span><span class="string">'r'</span><span class="keyword">] + (</span><span class="default">$i</span><span class="keyword">*</span><span class="default">$stepR</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$aColor</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][</span><span class="string">'g'</span><span class="keyword">] = </span><span class="default">$EndcolorRGB</span><span class="keyword">[</span><span class="string">'g'</span><span class="keyword">] + (</span><span class="default">$i</span><span class="keyword">*</span><span class="default">$stepG</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$aColor</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][</span><span class="string">'b'</span><span class="keyword">] = </span><span class="default">$EndcolorRGB</span><span class="keyword">[</span><span class="string">'b'</span><span class="keyword">] + (</span><span class="default">$i</span><span class="keyword">*</span><span class="default">$stepB</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//for every color-index we now replace $gray-values for $aColor<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">for (</span><span class="default">$c </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$c </span><span class="keyword">&lt; </span><span class="default">imagecolorstotal</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">); </span><span class="default">$c</span><span class="keyword">++){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$currentColorRGB </span><span class="keyword">= </span><span class="default">imagecolorsforindex</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">$c</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$gray </span><span class="keyword">= </span><span class="default">$currentColorRGB</span><span class="keyword">[</span><span class="string">'red'</span><span class="keyword">];</span><span class="comment">//image is grayscale, so red,green and blue<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // should be equal. We use this number as key of aColor<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagecolorset</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">$c</span><span class="keyword">,(int)</span><span class="default">$aColor</span><span class="keyword">[</span><span class="default">$gray</span><span class="keyword">][</span><span class="string">'r'</span><span class="keyword">], (int)</span><span class="default">$aColor</span><span class="keyword">[</span><span class="default">$gray</span><span class="keyword">][</span><span class="string">'g'</span><span class="keyword">], (int)</span><span class="default">$aColor</span><span class="keyword">[</span><span class="default">$gray</span><span class="keyword">][</span><span class="string">'b'</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; }<br />
}</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82729""></a>
  <div class="note">
   <strong class="user">Thomas Mueller</strong>
   <a href="#82729" class="date">23-Apr-2008 10:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is a function to colorize a picture gradient style.<br />
<br />
All you have to do is to pass an img-object and an array of colors.<br />
<br />
e.g.<br />
<br />
$arr = array('#000000', '#990000', '#00FFFF', '#FFFFDD');<br />
colorize ($img, $arr);<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">colorize</span><span class="keyword">(</span><span class="default">$imgdata</span><span class="keyword">, </span><span class="default">$palette</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imageTrueColorToPalette</span><span class="keyword">(</span><span class="default">$imgdata</span><span class="keyword">,</span><span class="default">false</span><span class="keyword">,</span><span class="default">0xFF</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$l </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$palette</span><span class="keyword">)-</span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$i </span><span class="keyword">= </span><span class="default">imagecolorstotal</span><span class="keyword">(</span><span class="default">$imgdata</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; while (</span><span class="default">$i</span><span class="keyword">--)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; list(</span><span class="default">$r</span><span class="keyword">,</span><span class="default">$g</span><span class="keyword">,</span><span class="default">$b</span><span class="keyword">) = </span><span class="default">array_values</span><span class="keyword">(</span><span class="default">imageColorsForIndex</span><span class="keyword">(</span><span class="default">$imgdata</span><span class="keyword">,</span><span class="default">$i</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$grayscale </span><span class="keyword">= (</span><span class="default">$r</span><span class="keyword">*</span><span class="default">.3 </span><span class="keyword">+ </span><span class="default">$g</span><span class="keyword">*</span><span class="default">.59 </span><span class="keyword">+</span><span class="default">$b</span><span class="keyword">*</span><span class="default">.11</span><span class="keyword">) / </span><span class="default">0xFF</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pos </span><span class="keyword">= </span><span class="default">$l</span><span class="keyword">*</span><span class="default">$grayscale</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$perc </span><span class="keyword">= </span><span class="default">$pos</span><span class="keyword">-</span><span class="default">floor</span><span class="keyword">(</span><span class="default">$pos</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tbase </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"#"</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$palette</span><span class="keyword">[</span><span class="default">$pos</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$baseR </span><span class="keyword">= </span><span class="default">hexdec</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$tbase</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$baseG </span><span class="keyword">= </span><span class="default">hexdec</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$tbase</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$baseB </span><span class="keyword">= </span><span class="default">hexdec</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$tbase</span><span class="keyword">,</span><span class="default">4</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tmix </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"#"</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$palette</span><span class="keyword">[</span><span class="default">$pos</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$mixR </span><span class="keyword">= </span><span class="default">hexdec</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$tmix</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$mixG </span><span class="keyword">= </span><span class="default">hexdec</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$tmix</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$mixB </span><span class="keyword">= </span><span class="default">hexdec</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$tmix</span><span class="keyword">,</span><span class="default">4</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$resR </span><span class="keyword">= </span><span class="default">$baseR</span><span class="keyword">+(</span><span class="default">$mixR</span><span class="keyword">-</span><span class="default">$baseR</span><span class="keyword">)*</span><span class="default">$perc</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$resG </span><span class="keyword">= </span><span class="default">$baseG</span><span class="keyword">+(</span><span class="default">$mixG</span><span class="keyword">-</span><span class="default">$baseG</span><span class="keyword">)*</span><span class="default">$perc</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$resB </span><span class="keyword">= </span><span class="default">$baseB</span><span class="keyword">+(</span><span class="default">$mixB</span><span class="keyword">-</span><span class="default">$baseB</span><span class="keyword">)*</span><span class="default">$perc</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagecolorset</span><span class="keyword">(</span><span class="default">$imgdata</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">, </span><span class="default">$resR</span><span class="keyword">, </span><span class="default">$resG</span><span class="keyword">, </span><span class="default">$resB</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81252""></a>
  <div class="note">
   <strong class="user">heavyraptor2 at hotmail dot com</strong>
   <a href="#81252" class="date">20-Feb-2008 01:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I've been looking for a simple function which "colorizes" an image, without any success ... it looks like a lot of people mean something different with "colorizing" an image, because actually colorzing means multiplying the old color's grayscale with the new color. So a white pixel would become 100% of the colorize-to-color and a black pixel would stay black (I know I can't explain well ... I hope you understood, otherwise take a look at the example below the functions' code).<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">image_colorize</span><span class="keyword">(&amp;</span><span class="default">$img</span><span class="keyword">,</span><span class="default">$rgb</span><span class="keyword">) {<br />
&nbsp; </span><span class="default">imageTrueColorToPalette</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">,</span><span class="default">true</span><span class="keyword">,</span><span class="default">256</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$numColors </span><span class="keyword">= </span><span class="default">imageColorsTotal</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">);<br />
<br />
&nbsp; for (</span><span class="default">$x </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$x </span><span class="keyword">&lt; </span><span class="default">$numColors</span><span class="keyword">; </span><span class="default">$x</span><span class="keyword">++) {<br />
&nbsp;&nbsp;&nbsp; list(</span><span class="default">$r</span><span class="keyword">,</span><span class="default">$g</span><span class="keyword">,</span><span class="default">$b</span><span class="keyword">) = </span><span class="default">array_values</span><span class="keyword">(</span><span class="default">imageColorsForIndex</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">,</span><span class="default">$x</span><span class="keyword">));<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// calculate grayscale in percent<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$grayscale </span><span class="keyword">= (</span><span class="default">$r </span><span class="keyword">+ </span><span class="default">$g </span><span class="keyword">+ </span><span class="default">$b</span><span class="keyword">) / </span><span class="default">3 </span><span class="keyword">/ </span><span class="default">0xff</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imageColorSet</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">,</span><span class="default">$x</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$grayscale </span><span class="keyword">* </span><span class="default">$rgb</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">],<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$grayscale </span><span class="keyword">* </span><span class="default">$rgb</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">],<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$grayscale </span><span class="keyword">* </span><span class="default">$rgb</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]<br />
&nbsp;&nbsp;&nbsp; );<br />
&nbsp; }<br />
<br />
&nbsp; return </span><span class="default">true</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Example of usage:<br />
<span class="default">&lt;?php<br />
$color </span><span class="keyword">= array(</span><span class="default">0xff</span><span class="keyword">,</span><span class="default">0xaa</span><span class="keyword">,</span><span class="default">0x2a</span><span class="keyword">); </span><span class="comment">// color to convert to<br />
</span><span class="default">$url </span><span class="keyword">= </span><span class="string">'<a href="http://sundog.net/images/uploads/1_google_logo.jpg" rel="nofollow" target="_blank">http://sundog.net/images/uploads/1_google_logo.jpg</a>'</span><span class="keyword">;<br />
</span><span class="default">$img </span><span class="keyword">= </span><span class="default">imageCreateFromJpeg</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">);<br />
<br />
</span><span class="default">image_colorize</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">,</span><span class="default">$color</span><span class="keyword">);<br />
<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-type: image/gif'</span><span class="keyword">);<br />
</span><span class="default">imageGif</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">);<br />
exit;<br />
</span><span class="default">?&gt;<br />
</span><br />
Enjoy</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77351""></a>
  <div class="note">
   <strong class="user">admin at phpgfx dot com</strong>
   <a href="#77351" class="date">25-Aug-2007 11:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is a function to turn an image into pure black and white<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">imagepurebw</span><span class="keyword">( </span><span class="default">$img</span><span class="keyword">, </span><span class="default">$amount </span><span class="keyword">= </span><span class="default">383 </span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$total </span><span class="keyword">= </span><span class="default">imagecolorstotal</span><span class="keyword">( </span><span class="default">$img </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; for ( </span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$total</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++ ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$index </span><span class="keyword">= </span><span class="default">imagecolorsforindex</span><span class="keyword">( </span><span class="default">$img</span><span class="keyword">, </span><span class="default">$i </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">array_pop</span><span class="keyword">( </span><span class="default">$index </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$color </span><span class="keyword">= ( </span><span class="default">array_sum</span><span class="keyword">( </span><span class="default">$index </span><span class="keyword">) &gt; </span><span class="default">$amount </span><span class="keyword">) ? </span><span class="default">255 </span><span class="keyword">: </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagecolorset</span><span class="keyword">( </span><span class="default">$img</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">, </span><span class="default">$color </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="70156""></a>
  <div class="note">
   <strong class="user">moxleystratton.com</strong>
   <a href="#70156" class="date">04-Oct-2006 03:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to convert a Color image to Grayscale without creating a blotchy image, use this color calculation:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">imagetograyscale</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">imageistruecolor</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagetruecolortopalette</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">, </span><span class="default">256</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; for (</span><span class="default">$c </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$c </span><span class="keyword">&lt; </span><span class="default">imagecolorstotal</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">); </span><span class="default">$c</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$col </span><span class="keyword">= </span><span class="default">imagecolorsforindex</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">$c</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$gray </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">(</span><span class="default">0.299 </span><span class="keyword">* </span><span class="default">$col</span><span class="keyword">[</span><span class="string">'red'</span><span class="keyword">] + </span><span class="default">0.587 </span><span class="keyword">* </span><span class="default">$col</span><span class="keyword">[</span><span class="string">'green'</span><span class="keyword">] + </span><span class="default">0.114 </span><span class="keyword">* </span><span class="default">$col</span><span class="keyword">[</span><span class="string">'blue'</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagecolorset</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">$c</span><span class="keyword">, </span><span class="default">$gray</span><span class="keyword">, </span><span class="default">$gray</span><span class="keyword">, </span><span class="default">$gray</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="46219""></a>
  <div class="note">
   <strong class="user">dade dot c at email dot it</strong>
   <a href="#46219" class="date">02-Oct-2004 01:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
this is helpful if you would like to implement a color theme system in your website... try it out<br />
Davide Candiloro Italy<br />
<br />
function colorize ($pngpath, $r, $g, $b) <br />
/*<br />
REQUIRES: $pngpath to be a valid path of a greyscale PNG-8 image with 64 colors palette<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $r, $g, $b to be integers in the range 0..255<br />
EFFECTS: returns the png image colorized with the color represented by $r, $g, $b.<br />
*/<br />
{<br />
&nbsp;&nbsp;&nbsp; header("Content-type: image/png");<br />
&nbsp;&nbsp;&nbsp; $im = imagecreatefrompng("images/table.png");<br />
<br />
&nbsp;&nbsp;&nbsp; imagetruecolortopalette($im, FALSE, 256); <br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp;&nbsp; for ($c = 0; $c &lt; 64; $c++){ /*64 is the number of colors in the PNG-8 palette*/<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $col = imagecolorsforindex($im, $c);&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; imagecolorset ( $im, $c, $r*$col['red']/256, $g*$col['green']/256, $b*$col['blue']/256); /*replaces original greyscale palette with a colorized one*/<br />
&nbsp;&nbsp; &nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; imagepng($im);<br />
&nbsp;&nbsp;&nbsp; imagedestroy($im);<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="41841""></a>
  <div class="note">
   <strong class="user">m4551 at abasoft dot it</strong>
   <a href="#41841" class="date">23-Apr-2004 09:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
here's a function to greyscale an image even from a truecolor source (jpeg or png).<br />
<br />
slightly poor quality, but very fast...<br />
<br />
function imagegreyscale(&amp;$img, $dither=1) {&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; if (!($t = imagecolorstotal($img))) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $t = 256;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; imagetruecolortopalette($img, $dither, $t);&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; for ($c = 0; $c &lt; $t; $c++) {&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $col = imagecolorsforindex($img, $c);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $min = min($col['red'],$col['green'],$col['blue']);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $max = max($col['red'],$col['green'],$col['blue']);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $i = ($max+$min)/2;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; imagecolorset($img, $c, $i, $i, $i);<br />
&nbsp;&nbsp;&nbsp; }<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="24186""></a>
  <div class="note">
   <strong class="user">info at devking dot com</strong>
   <a href="#24186" class="date">08-Aug-2002 02:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
here's a simple function to greyscale an image...<br />
<br />
function imagecolorgrey( &amp;$img ) {<br />
&nbsp;for( $i=0; $i&lt;imagecolorstotal( $img ); $i++ ) {<br />
&nbsp; $c = ImageColorsForIndex( $img, $i );<br />
&nbsp; $t = ($c["red"]+$c["green"]+$c["blue"])/3;<br />
&nbsp; imagecolorset( $img, $i, $t, $t, $t );&nbsp; &nbsp; <br />
&nbsp;}<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="13963""></a>
  <div class="note">
   <strong class="user">olivier at moostik dot net</strong>
   <a href="#13963" class="date">11-Jul-2001 05:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This function change colors of an image with ranges 0&gt;100 for each primary color:
<br />

<br />
int ImageSelectiveColor (int im, int red, int green, int blue)
<br />

<br />
im is image pointer
<br />
red, green and blue are ranges 0-&gt;100
<br />

<br />
function ImageSelectiveColor($im,$red,$green,$blue)
<br />
&nbsp;{
<br />
&nbsp; for($i=0;$i&lt;imagecolorstotal($im);$i++)
<br />
&nbsp;&nbsp; {
<br />
&nbsp;&nbsp;&nbsp; $col=ImageColorsForIndex($im,$i);
<br />
&nbsp;&nbsp;&nbsp; $red_set=$red/100*$col['red'];
<br />
&nbsp;&nbsp;&nbsp; $green_set=$green/100*$col['green'];
<br />
&nbsp;&nbsp;&nbsp; $blue_set=$blue/100*$col['blue'];
<br />
&nbsp;&nbsp;&nbsp; if($red_set&gt;255)$red_set=255;
<br />
&nbsp;&nbsp;&nbsp; if($green_set&gt;255)$green_set=255;
<br />
&nbsp;&nbsp;&nbsp; if($blue_set&gt;255)$blue_set=255;
<br />
&nbsp;&nbsp;&nbsp; imagecolorset($im,$i,$red_set,$green_set,$blue_set);
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp; }
<br />
&nbsp; return $im;
<br />
&nbsp;
<br />
&nbsp;}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
