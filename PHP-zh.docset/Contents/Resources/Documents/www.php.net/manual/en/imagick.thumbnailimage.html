<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>Changes the size of an image</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="imagick.thresholdimage.html">? Imagick::thresholdImage</a></li>
      <li style="float: right;"><a href="imagick.tintimage.html">Imagick::tintImage ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="class.imagick.html">Imagick</a></li>
    <li>Changes the size of an image</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="imagick.thumbnailimage" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">Imagick::thumbnailImage</h1>
  <p class="verinfo">(PECL imagick 2, PECL imagick 3)</p><p class="refpurpose"><span class="refname">Imagick::thumbnailImage</span> &mdash; <span class="dc-title">Changes the size of an image</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-imagick.thumbnailimage-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="modifier">public</span> <span class="methodname"><strong>Imagick::thumbnailImage</strong></span>
    ( <span class="methodparam"><span class="type">int</span> <code class="parameter">$columns</code></span>
   , <span class="methodparam"><span class="type">int</span> <code class="parameter">$rows</code></span>
   , <span class="methodparam"><span class="type">bool</span> <code class="parameter">$bestfit</code><span class="initializer"> = <strong><code>false</code></strong></span></span>
   , <span class="methodparam"><span class="type">bool</span> <code class="parameter">$fill</code><span class="initializer"> = <strong><code>false</code></strong></span></span>
   , <span class="methodparam"><span class="type">bool</span> <code class="parameter">$legacy</code><span class="initializer"> = <strong><code>false</code></strong></span></span>
   ) : <span class="type">bool</span></div>

  <p class="para rdfs-comment">
   Changes the size of an image to the given dimensions and removes any
   associated profiles. The goal is to produce small, low cost thumbnail
   images suited for display on the Web. 

   If <strong><code>true</code></strong> is given as a third parameter then columns and rows parameters
   are used as maximums for each side. Both sides will be scaled down until
   they match or are smaller than the parameter given for the side.
  </p>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
<span class="simpara">
 参数 <code class="parameter">bestfit</code> 的特性在 Imagick 3.0.0 中已改变。在此版本以前，当目标尺寸设为
 400x400 时，原尺寸为 200x150 的图像将不会被改变。自 Imagick 3.0.0
 起，源图像将会被放大到 400x300 因为这将更好的适合目标尺寸。当使用参数
 <code class="parameter">bestfit</code> 时，必须同时给出宽度和高度。
</span>
</p></blockquote>
 </div>


 <div class="refsect1 parameters" id="refsect1-imagick.thumbnailimage-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">columns</code></dt>

     <dd>

      <p class="para">
      Image width
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">rows</code></dt>

     <dd>

      <p class="para">
      Image height
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">bestfit</code></dt>

     <dd>

      <p class="para">
      Whether to force maximum values
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-imagick.thumbnailimage-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   成功时返回 <strong><code>true</code></strong>。
  </p>
 </div>


 <div class="refsect1 errors" id="refsect1-imagick.thumbnailimage-errors">
  <h3 class="title">错误／异常</h3>
  <p class="para">
   错误时抛出 ImagickException。
  </p>
 </div>




 <div class="refsect1 examples" id="refsect1-imagick.thumbnailimage-examples">
  <h3 class="title">范例</h3>
  <p class="para">
    <div class="example" id="example-3267">
      <p><strong>Example #1  <span class="function"><strong>Imagick::thumbnailImage()</strong></span></strong></p>
      <div class="example-contents">
      <div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">function&nbsp;</span><span style="color: #0000BB">thumbnailImage</span><span style="color: #007700">(</span><span style="color: #0000BB">$imagePath</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$imagick&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;\</span><span style="color: #0000BB">Imagick</span><span style="color: #007700">(</span><span style="color: #0000BB">realpath</span><span style="color: #007700">(</span><span style="color: #0000BB">$imagePath</span><span style="color: #007700">));<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$imagick</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setbackgroundcolor</span><span style="color: #007700">(</span><span style="color: #DD0000">'rgb(64,&nbsp;64,&nbsp;64)'</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$imagick</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">thumbnailImage</span><span style="color: #007700">(</span><span style="color: #0000BB">100</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">100</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">header</span><span style="color: #007700">(</span><span style="color: #DD0000">"Content-Type:&nbsp;image/jpg"</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">$imagick</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getImageBlob</span><span style="color: #007700">();<br />}<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
      </div>

    </div>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="108288""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#108288" class="date">14-Apr-2012 08:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If the 3rd parameter is true, the image will be resized in such a way that it'll be contained within the dimensions mentioned.<br />
It's like changing the dimensions of the image so that it can be contained in a box of given dimension.<br />
<br />
Eg: Image's dimension is 1600*800. If we use thumbnailImage(400, 400, true), the new image's dimension will be 400*200.<br />
<br />
Some of the previous notes in this page mentions that the image is resized proportionally so that its _smallest_ dimension matches the width or height specified, NOT both.<br />
But this is not the case now. Both width &amp; height of the image will be &lt;= that mentioned in thumbnailImage().<br />
Maybe imagick changed/updated the functionality.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="108004""></a>
  <div class="note">
   <strong class="user">web at johnbaldock dot com</strong>
   <a href="#108004" class="date">21-Mar-2012 07:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When shrinking a jpg you can get more then double the performance if you use <span class="default">&lt;?php $image</span><span class="keyword">-&gt;</span><span class="default">setOption</span><span class="keyword">(</span><span class="string">'jpeg:size'</span><span class="keyword">, </span><span class="string">'800x532'</span><span class="keyword">) </span><span class="default">?&gt;</span>, exchanging 800x532 to the resolution you want the final image to be. For instance instead of this:<br />
<br />
<span class="default">&lt;?php<br />
$image </span><span class="keyword">= new </span><span class="default">Imagick</span><span class="keyword">(</span><span class="string">'foo.jpg'</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
You would use this:<br />
<br />
<span class="default">&lt;?php<br />
$image </span><span class="keyword">= new </span><span class="default">Imagick</span><span class="keyword">();<br />
</span><span class="default">$image</span><span class="keyword">-&gt;</span><span class="default">setOption</span><span class="keyword">(</span><span class="string">'jpeg:size'</span><span class="keyword">, </span><span class="string">'800x532'</span><span class="keyword">);<br />
</span><span class="default">$image</span><span class="keyword">-&gt;</span><span class="default">readImage</span><span class="keyword">(</span><span class="string">'foo.jpg'</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="106345""></a>
  <div class="note">
   <strong class="user">jarrod at jarrodchristman dot com</strong>
   <a href="#106345" class="date">29-Oct-2011 08:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Even though thumbnailImage is meant to produce the smallest file size image possible, i found it didn't. I put together this code and bordering different compression settings, found it produced the smallest file size:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// Max vert or horiz resolution<br />
</span><span class="default">$maxsize</span><span class="keyword">=</span><span class="default">550</span><span class="keyword">;<br />
<br />
</span><span class="comment">// create new Imagick object<br />
</span><span class="default">$image </span><span class="keyword">= new </span><span class="default">Imagick</span><span class="keyword">(</span><span class="string">'input_image_filename_and_location'</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Resizes to whichever is larger, width or height<br />
</span><span class="keyword">if(</span><span class="default">$image</span><span class="keyword">-&gt;</span><span class="default">getImageHeight</span><span class="keyword">() &lt;= </span><span class="default">$image</span><span class="keyword">-&gt;</span><span class="default">getImageWidth</span><span class="keyword">())<br />
{<br />
</span><span class="comment">// Resize image using the lanczos resampling algorithm based on width<br />
</span><span class="default">$image</span><span class="keyword">-&gt;</span><span class="default">resizeImage</span><span class="keyword">(</span><span class="default">$maxsize</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">Imagick</span><span class="keyword">::</span><span class="default">FILTER_LANCZOS</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">);<br />
}<br />
else<br />
{<br />
</span><span class="comment">// Resize image using the lanczos resampling algorithm based on height<br />
</span><span class="default">$image</span><span class="keyword">-&gt;</span><span class="default">resizeImage</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,</span><span class="default">$maxsize</span><span class="keyword">,</span><span class="default">Imagick</span><span class="keyword">::</span><span class="default">FILTER_LANCZOS</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="comment">// Set to use jpeg compression<br />
</span><span class="default">$image</span><span class="keyword">-&gt;</span><span class="default">setImageCompression</span><span class="keyword">(</span><span class="default">Imagick</span><span class="keyword">::</span><span class="default">COMPRESSION_JPEG</span><span class="keyword">);<br />
</span><span class="comment">// Set compression level (1 lowest quality, 100 highest quality)<br />
</span><span class="default">$image</span><span class="keyword">-&gt;</span><span class="default">setImageCompressionQuality</span><span class="keyword">(</span><span class="default">75</span><span class="keyword">);<br />
</span><span class="comment">// Strip out unneeded meta data<br />
</span><span class="default">$image</span><span class="keyword">-&gt;</span><span class="default">stripImage</span><span class="keyword">();<br />
</span><span class="comment">// Writes resultant image to output directory<br />
</span><span class="default">$image</span><span class="keyword">-&gt;</span><span class="default">writeImage</span><span class="keyword">(</span><span class="string">'output_image_filename_and_location'</span><span class="keyword">);<br />
</span><span class="comment">// Destroys Imagick object, freeing allocated resources in the process<br />
</span><span class="default">$image</span><span class="keyword">-&gt;</span><span class="default">destroy</span><span class="keyword">();<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
I found setCompression to not function at all and had to use setImageCompression. The stripImage call is needed and strips out unneeded meta data. You can choose whatever filter you want, but i found lanczos to be the best for image reduction, though it is more computationally heavy.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84178""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#84178" class="date">02-Jul-2008 04:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is a function to calculate the new dimensions of a thumbnail, to fit within the given dimensions on both sides.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/**<br />
&nbsp;* Calculate new image dimensions to new constraints<br />
&nbsp;*<br />
&nbsp;* @param Original X size in pixels<br />
&nbsp;* @param Original Y size in pixels<br />
&nbsp;* @return New X maximum size in pixels<br />
&nbsp;* @return New Y maximum size in pixels<br />
&nbsp;*/<br />
</span><span class="keyword">function </span><span class="default">scaleImage</span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">,</span><span class="default">$y</span><span class="keyword">,</span><span class="default">$cx</span><span class="keyword">,</span><span class="default">$cy</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//Set the default NEW values to be the old, in case it doesn't even need scaling<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">list(</span><span class="default">$nx</span><span class="keyword">,</span><span class="default">$ny</span><span class="keyword">)=array(</span><span class="default">$x</span><span class="keyword">,</span><span class="default">$y</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//If image is generally smaller, don't even bother<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$x</span><span class="keyword">&gt;=</span><span class="default">$cx </span><span class="keyword">|| </span><span class="default">$y</span><span class="keyword">&gt;=</span><span class="default">$cx</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//Work out ratios<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$x</span><span class="keyword">&gt;</span><span class="default">0</span><span class="keyword">) </span><span class="default">$rx</span><span class="keyword">=</span><span class="default">$cx</span><span class="keyword">/</span><span class="default">$x</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$y</span><span class="keyword">&gt;</span><span class="default">0</span><span class="keyword">) </span><span class="default">$ry</span><span class="keyword">=</span><span class="default">$cy</span><span class="keyword">/</span><span class="default">$y</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//Use the lowest ratio, to ensure we don't go over the wanted image size<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$rx</span><span class="keyword">&gt;</span><span class="default">$ry</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$r</span><span class="keyword">=</span><span class="default">$ry</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$r</span><span class="keyword">=</span><span class="default">$rx</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//Calculate the new size based on the chosen ratio<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nx</span><span class="keyword">=</span><span class="default">intval</span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">*</span><span class="default">$r</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ny</span><span class="keyword">=</span><span class="default">intval</span><span class="keyword">(</span><span class="default">$y</span><span class="keyword">*</span><span class="default">$r</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//Return the results<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">return array(</span><span class="default">$nx</span><span class="keyword">,</span><span class="default">$ny</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Use it like this:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">//Read original image and create Imagick object<br />
</span><span class="default">$thumb</span><span class="keyword">=new </span><span class="default">Imagick</span><span class="keyword">(</span><span class="default">$originalImageFilename</span><span class="keyword">);<br />
<br />
</span><span class="comment">//Work out new dimensions<br />
</span><span class="keyword">list(</span><span class="default">$newX</span><span class="keyword">,</span><span class="default">$newY</span><span class="keyword">)=</span><span class="default">scaleImage</span><span class="keyword">(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$thumb</span><span class="keyword">-&gt;</span><span class="default">getImageWidth</span><span class="keyword">(),<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$thumb</span><span class="keyword">-&gt;</span><span class="default">getImageHeight</span><span class="keyword">(),<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$newMaximumWidth</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$newMaximumHeight</span><span class="keyword">);<br />
<br />
</span><span class="comment">//Scale the image<br />
</span><span class="default">$thumb</span><span class="keyword">-&gt;</span><span class="default">thumbnailImage</span><span class="keyword">(</span><span class="default">$newX</span><span class="keyword">,</span><span class="default">$newY</span><span class="keyword">);<br />
<br />
</span><span class="comment">//Write the new image to a file<br />
</span><span class="default">$thumb</span><span class="keyword">-&gt;</span><span class="default">writeImage</span><span class="keyword">(</span><span class="default">$thumbnailFilename</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83730""></a>
  <div class="note">
   <strong class="user">n-sw-bit at ya dot ru</strong>
   <a href="#83730" class="date">09-Jun-2008 09:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to resize your picture to fit smallest parameter:<br />
<br />
$fitbyWidth = (($maxWidth/$w)&lt;($maxHeight/$h)) ?true:false;<br />
<br />
if($fitbyWidth){<br />
&nbsp;&nbsp;&nbsp; $im-&gt;thumbnailImage($maxWidth, 0, false);<br />
}else{<br />
&nbsp;&nbsp;&nbsp; $im-&gt;thumbnailImage(0, $maxHeight, false);<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="78553""></a>
  <div class="note">
   <strong class="user">sgarner at expio dot co dot nz</strong>
   <a href="#78553" class="date">16-Oct-2007 10:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
With $fit == true, the image is resized proportionally so that its _smallest_ dimension matches the width or height specified, NOT both.<br />
<br />
For example, if you say thumbnailImage(400, 400, true), on an image of 1600x800, it will be resized to 800x400, NOT 400x200 as you might expect.<br />
<br />
The solution is to compare the original image's dimensions to the specified dimensions, and substitute zero for the smaller dimension, and set $fit = false.<br />
<br />
i.e.: thumbnailImage(400, 0, false) would resize that 1600x800 image to 400x200.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77728""></a>
  <div class="note">
   <strong class="user">raybdbomb . gmail</strong>
   <a href="#77728" class="date">10-Sep-2007 04:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As noted here<br />
<a href="http://php.net/manual/en/ref.imagick.php" rel="nofollow" target="_blank">http://php.net/manual/en/ref.imagick.php</a><br />
With either of the params as 0, the aspect ratio is maintained.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
