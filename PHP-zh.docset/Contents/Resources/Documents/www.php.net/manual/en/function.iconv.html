<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>字符串按要求的字符编码来转换</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.iconv-substr.html">? iconv_substr</a></li>
      <li style="float: right;"><a href="function.ob-iconv-handler.html">ob_iconv_handler ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.iconv.html">iconv 函数</a></li>
    <li>字符串按要求的字符编码来转换</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.iconv" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">iconv</h1>
  <p class="verinfo">(PHP 4 &gt;= 4.0.5, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">iconv</span> &mdash; <span class="dc-title">字符串按要求的字符编码来转换</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.iconv-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>iconv</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$in_charset</code></span>
   , <span class="methodparam"><span class="type">string</span> <code class="parameter">$out_charset</code></span>
   , <span class="methodparam"><span class="type">string</span> <code class="parameter">$str</code></span>
   ) : <span class="type">string</span></div>

  <p class="para rdfs-comment">
   将字符串 <code class="parameter">str</code> 从 <code class="parameter">in_charset</code> 转换编码到 <code class="parameter">out_charset</code>。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.iconv-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">in_charset</code></dt>

     <dd>

      <p class="para">
       输入的字符集。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">out_charset</code></dt>

     <dd>

      <p class="para">
       输出的字符集。
      </p>
      <p class="para">
       如果你在 <code class="parameter">out_charset</code> 后添加了字符串 <code class="literal">//TRANSLIT</code>，将启用转写（transliteration）功能。这个意思是，当一个字符不能被目标字符集所表示时，它可以通过一个或多个形似的字符来近似表达。
       如果你添加了字符串 <code class="literal">//IGNORE</code>，不能以目标字符集表达的字符将被默默丢弃。
       否则，会导致一个 <strong><code>E_NOTICE</code></strong>并返回 <strong><code>false</code></strong>。
      </p>
      <div class="caution"><strong class="caution">Caution</strong>
       <p class="para">
        <code class="literal">//TRANSLIT</code> 运行细节高度依赖于系统的  iconv() 实现（参见 <strong><code>ICONV_IMPL</code></strong>）。
        据悉，某些系统上的实现会直接忽略 <code class="literal">//TRANSLIT</code>，所以转换也有可能失败，<code class="parameter">out_charset</code> 会是不合格的。
       </p>
      </div>
     </dd>

    
    
     <dt>
<code class="parameter">str</code></dt>

     <dd>

      <p class="para">
       要转换的字符串。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.iconv-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   返回转换后的字符串， 或者在失败时返回 <strong><code>false</code></strong>。
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.iconv-changelog">
   <h3 class="title">更新日志</h3>
   <p class="para">
    <table class="doctable informaltable">
     
      <thead>
       <tr>
        <th>版本</th>
        <th>说明</th>
       </tr>

      </thead>

      <tbody class="tbody">
       <tr>
        <td>5.4.0</td>
        <td>
         这个版本起，字符非法时候会返回  <strong><code>false</code></strong>，除非在输出字符里指定了 <code class="literal">//IGNORE</code> 。
         在之前版本，它会返回一部分字符串。
        </td>
       </tr>

    </tbody>
   
  </table>

 </p>
</div>


 <div class="refsect1 examples" id="refsect1-function.iconv-examples">
  <h3 class="title">范例</h3>
  <p class="para">
   <div class="example" id="example-2656">
    <p><strong>Example #1 <span class="function"><strong>iconv()</strong></span> 例子</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$text&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"This&nbsp;is&nbsp;the&nbsp;Euro&nbsp;symbol&nbsp;''."</span><span style="color: #007700">;<br /><br />echo&nbsp;</span><span style="color: #DD0000">'Original&nbsp;:&nbsp;'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$text</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">PHP_EOL</span><span style="color: #007700">;<br />echo&nbsp;</span><span style="color: #DD0000">'TRANSLIT&nbsp;:&nbsp;'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">iconv</span><span style="color: #007700">(</span><span style="color: #DD0000">"UTF-8"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"ISO-8859-1//TRANSLIT"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$text</span><span style="color: #007700">),&nbsp;</span><span style="color: #0000BB">PHP_EOL</span><span style="color: #007700">;<br />echo&nbsp;</span><span style="color: #DD0000">'IGNORE&nbsp;&nbsp;&nbsp;:&nbsp;'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">iconv</span><span style="color: #007700">(</span><span style="color: #DD0000">"UTF-8"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"ISO-8859-1//IGNORE"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$text</span><span style="color: #007700">),&nbsp;</span><span style="color: #0000BB">PHP_EOL</span><span style="color: #007700">;<br />echo&nbsp;</span><span style="color: #DD0000">'Plain&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">iconv</span><span style="color: #007700">(</span><span style="color: #DD0000">"UTF-8"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"ISO-8859-1"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$text</span><span style="color: #007700">),&nbsp;</span><span style="color: #0000BB">PHP_EOL</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>以上例程的输出类似于：</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
Original : This is the Euro symbol &#039;&#039;.
TRANSLIT : This is the Euro symbol &#039;EUR&#039;.
IGNORE   : This is the Euro symbol &#039;&#039;.
Plain    :
Notice: iconv(): Detected an illegal character in input string in .\iconv-example.php on line 7
</pre></div>
    </div>
   </div>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="124410""></a>
  <div class="note">
   <strong class="user">Daniel Klein</strong>
   <a href="#124410" class="date">18-Nov-2019 01:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to convert to a Unicode encoding without the byte order mark (BOM), add the endianness to the encoding, e.g. instead of "UTF-16" which will add a BOM to the start of the string, use "UTF-16BE" which will convert the string without adding a BOM.<br />
<br />
i.e.<br />
<br />
<span class="default">&lt;?php<br />
iconv</span><span class="keyword">(</span><span class="string">'CP1252'</span><span class="keyword">, </span><span class="string">'UTF-16'</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">); </span><span class="comment">// with BOM<br />
</span><span class="default">iconv</span><span class="keyword">(</span><span class="string">'CP1252'</span><span class="keyword">, </span><span class="string">'UTF-16BE'</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">); </span><span class="comment">// without BOM</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="124205""></a>
  <div class="note">
   <strong class="user">phpnet at dariosulser dot ch</strong>
   <a href="#124205" class="date">18-Sep-2019 01:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
ANSI = Windows-1252 = CP1252<br />
So UTF-8 -&gt; ANSI:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp; &nbsp;&nbsp; $string </span><span class="keyword">= </span><span class="string">"Winkel γ=200 für 1"</span><span class="keyword">; </span><span class="comment">//"γ"=HTML:&amp;gamma;<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="default">iconv</span><span class="keyword">(</span><span class="string">'UTF-8'</span><span class="keyword">, </span><span class="string">'CP1252//IGNORE'</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; echo </span><span class="default">$result</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
Note1<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp; &nbsp;&nbsp; $string </span><span class="keyword">= </span><span class="string">"Winkel γ=200 für 1"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="default">iconv</span><span class="keyword">(</span><span class="string">'UTF-8'</span><span class="keyword">, </span><span class="string">'CP1252'</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; echo </span><span class="default">$result</span><span class="keyword">; </span><span class="comment">//"conv(): Detected an illegal character in input string"<br />
</span><span class="default">?&gt;<br />
</span><br />
Note2 (ANSI is better than decode in ISO 8859-1 (ISO-8859-1==Latin-1)<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp; &nbsp;&nbsp; $string </span><span class="keyword">= </span><span class="string">"Winkel γ=200 für 1"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="default">utf8_decode</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; echo </span><span class="default">$result</span><span class="keyword">; </span><span class="comment">//"Winkel ?=200 für 1?"<br />
</span><span class="default">?&gt;<br />
</span><br />
Note3 of used languages on Websites:<br />
93.0% = UTF-8;<br />
3.5% = Latin-1; <br />
0.6% = ANSI &lt;----- you shoud use (or utf-8 if your page is in Chinese or has Maths)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="119137""></a>
  <div class="note">
   <strong class="user">Daniel Klein</strong>
   <a href="#119137" class="date">08-Apr-2016 09:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I just found out today that the Windows and *NIX versions of PHP use different iconv libraries and are not very consistent with each other.<br />
<br />
Here is a repost of my earlier code that now works on more systems. It converts as much as possible and replaces the rest with question marks:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">if (!</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">'utf8_to_ascii'</span><span class="keyword">)) {<br />
&nbsp; </span><span class="default">setlocale</span><span class="keyword">(</span><span class="default">LC_CTYPE</span><span class="keyword">, </span><span class="string">'en_AU.utf8'</span><span class="keyword">);<br />
&nbsp; if (@</span><span class="default">iconv</span><span class="keyword">(</span><span class="string">"UTF-8"</span><span class="keyword">, </span><span class="string">"ASCII//IGNORE//TRANSLIT"</span><span class="keyword">, </span><span class="string">'é'</span><span class="keyword">) === </span><span class="default">false</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// PHP is probably using the glibc library (*NIX)<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">utf8_to_ascii</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; return </span><span class="default">iconv</span><span class="keyword">(</span><span class="string">"UTF-8"</span><span class="keyword">, </span><span class="string">"ASCII//TRANSLIT"</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
&nbsp; else {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// PHP is probably using the libiconv library (Windows)<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">utf8_to_ascii</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (</span><span class="default">is_string</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Includes combinations of characters that present as a single glyph<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$text </span><span class="keyword">= </span><span class="default">preg_replace_callback</span><span class="keyword">(</span><span class="string">'/\X/u'</span><span class="keyword">, </span><span class="default">__FUNCTION__</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; elseif (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">) &amp;&amp; </span><span class="default">count</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">) == </span><span class="default">1 </span><span class="keyword">&amp;&amp; </span><span class="default">is_string</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// IGNORE characters that can't be TRANSLITerated to ASCII<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$text </span><span class="keyword">= </span><span class="default">iconv</span><span class="keyword">(</span><span class="string">"UTF-8"</span><span class="keyword">, </span><span class="string">"ASCII//IGNORE//TRANSLIT"</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// The documentation says that iconv() returns false on failure but it returns ''<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$text </span><span class="keyword">=== </span><span class="string">'' </span><span class="keyword">|| !</span><span class="default">is_string</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$text </span><span class="keyword">= </span><span class="string">'?'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; elseif (</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'/\w/'</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">)) {&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// If the text contains any letters...<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$text </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/\W+/'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">); </span><span class="comment">// ...then remove all non-letters<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">}<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; else {&nbsp; </span><span class="comment">// $text was not a string<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$text </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; return </span><span class="default">$text</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
}</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="116951""></a>
  <div class="note">
   <strong class="user">Nopius</strong>
   <a href="#116951" class="date">26-Mar-2015 02:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As orrd101 said, there is a bug with //IGNORE in recent PHP versions (we use 5.6.5) where we couldn't convert some strings (i.e. "?" from UTF8 to CP1251 with //IGNORE). <br />
But we have found a workaround and now we use both //TRANSLIT and //IGNORE flags:<br />
$text="?";<br />
iconv("UTF8", "CP1251//TRANSLIT//IGNORE", $text);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="116178""></a>
  <div class="note">
   <strong class="user">atelier at degoy dot com</strong>
   <a href="#116178" class="date">19-Nov-2014 07:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There may be situations when a new version of a web site, all in UTF-8, has to display some old data remaining in the database with ISO-8859-1 accents. The problem is iconv("ISO-8859-1", "UTF-8", $string) should not be applied if $string is already UTF-8 encoded.<br />
<br />
I use this function that does'nt need any extension :<br />
<br />
function convert_utf8( $string ) { <br />
&nbsp;&nbsp;&nbsp; if ( strlen(utf8_decode($string)) == strlen($string) ) {&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // $string is not UTF-8<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return iconv("ISO-8859-1", "UTF-8", $string);<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // already UTF-8<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return $string;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
&nbsp;I have not tested it extensively, hope it may help.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="115285""></a>
  <div class="note">
   <strong class="user">rasmus at mindplay dot dk</strong>
   <a href="#115285" class="date">27-Jun-2014 11:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note an important difference between iconv() and mb_convert_encoding() - if you're working with strings, as opposed to files, you most likely want mb_convert_encoding() and not iconv(), because iconv() will add a byte-order marker to the beginning of (for example) a UTF-32 string when converting from e.g. ISO-8859-1, which can throw off all your subsequent calculations and operations on the resulting string.<br />
<br />
In other words, iconv() appears to be intended for use when converting the contents of files - whereas mb_convert_encoding() is intended for use when juggling strings internally, e.g. strings that aren't being read/written to/from files, but exchanged with some other media.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="113316""></a>
  <div class="note">
   <strong class="user">chicopeste at gmail dot com</strong>
   <a href="#113316" class="date">25-Sep-2013 07:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
iconv also support CP850.<br />
I used iconv("CP850", "UTF-8//TRANSLIT", $var);<br />
to convert from SQL_Latin1_General_CP850_CI_AI to UTF-8.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="113139""></a>
  <div class="note">
   <strong class="user">jorortega at gmail dot com</strong>
   <a href="#113139" class="date">04-Sep-2013 03:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Be aware that iconv in PHP uses system implementations of locales and languages, what works under linux, normally doesn't in windows.<br />
<br />
Also, you may notice that recent versions of linux (debian, ubuntu, centos, etc) the //TRANSLIT option doesn't work. since most distros doesn't include the intl packages (example: php5-intl and icuxx (where xx is a number) in debian) by default. And this because the intl package conflicts with another package needed for international DNS resolution.<br />
<br />
Problem is that configuration is dependent of the sysadmin of the machine where you're hosted, so iconv is pretty much useless by default,&nbsp; depending on what configuration is used by your distro or the machine's admin.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="112706""></a>
  <div class="note">
   <strong class="user">jessiedeer  at  hotmail dot com</strong>
   <a href="#112706" class="date">15-Jul-2013 02:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
iconv with //IGNORE works as expected: it will skip the character if this one does not exist in the $out_charset encoding.<br />
<br />
If a character is missing from the $in_charset encoding (eg byte \x81 from CP1252 encoding), then iconv will return an error, whether with //IGNORE or not.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="112489""></a>
  <div class="note">
   <strong class="user">jessie at hotmail dot com</strong>
   <a href="#112489" class="date">21-Jun-2013 09:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Provided that there is no invalid code point in the character chain for the input encoding, the //IGNORE option works as expected. No bug here.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="111909""></a>
  <div class="note">
   <strong class="user">admin at iecw dot net</strong>
   <a href="#111909" class="date">10-Apr-2013 05:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to normalize a filename on Mac OS X, because it is in UTF-8 NFD and you need UTF-8 NFC<br />
(See: <a href="http://en.wikipedia.org/wiki/Unicode_equivalence#Combining_and_precomposed_characters" rel="nofollow" target="_blank">http://en.wikipedia.org/wiki/Unicode_equivalence#Combining_and_precomposed_characters</a>)<br />
you may use:<br />
<span class="default">&lt;?php<br />
$filename_nfc </span><span class="keyword">= </span><span class="default">iconv</span><span class="keyword">(</span><span class="string">"UTF-8-MAC"</span><span class="keyword">, </span><span class="string">"UTF-8"</span><span class="keyword">, </span><span class="default">$filename_nfd</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="111652""></a>
  <div class="note">
   <strong class="user">Daniel Klein</strong>
   <a href="#111652" class="date">13-Mar-2013 12:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You can use 'CP1252' instead of 'Windows-1252':<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// These two lines are equivalent<br />
</span><span class="default">$result </span><span class="keyword">= </span><span class="default">iconv</span><span class="keyword">(</span><span class="string">'Windows-1252'</span><span class="keyword">, </span><span class="string">'UTF-8'</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">);<br />
</span><span class="default">$result </span><span class="keyword">= </span><span class="default">iconv</span><span class="keyword">(</span><span class="string">'CP1252'</span><span class="keyword">, </span><span class="string">'UTF-8'</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span>Note: The following code points are not valid in CP1252 and will cause errors.<br />
129 (0x81)<br />
141 (0x8D)<br />
143 (0x8F)<br />
144 (0x90)<br />
157 (0x9D)<br />
Use the following instead:<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// Remove invalid code points, convert everything else<br />
</span><span class="default">$result </span><span class="keyword">= </span><span class="default">iconv</span><span class="keyword">(</span><span class="string">'CP1252'</span><span class="keyword">, </span><span class="string">'UTF-8//IGNORE'</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="108643""></a>
  <div class="note">
   <strong class="user">orrd101 at gmail dot com</strong>
   <a href="#108643" class="date">14-May-2012 06:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The "//ignore" option doesn't work with recent versions of the iconv library.&nbsp; So if you're having trouble with that option, you aren't alone.&nbsp; 
<br />

<br />
That means you can't currently use this function to filter invalid characters.&nbsp; Instead it silently fails and returns an empty string (or you'll get a notice but only if you have E_NOTICE enabled).
<br />

<br />
This has been a known bug with a known solution for at least since 2009 years but no one seems to be willing to fix it (PHP must pass the -c option to iconv).&nbsp; It's still broken as of the latest release 5.4.3. 
<br />

<br />
https://bugs.php.net/bug.php?id=48147
<br />
https://bugs.php.net/bug.php?id=52211
<br />
https://bugs.php.net/bug.php?id=61484
<br />

<br />
[UPDATE 15-JUN-2012]
<br />
Here's a workaround...
<br />

<br />
&nbsp; ini_set('mbstring.substitute_character', "none");
<br />
&nbsp; $text= mb_convert_encoding($text, 'UTF-8', 'UTF-8');
<br />

<br />
That will strip invalid characters from UTF-8 strings (so that you can insert it into a database, etc.).&nbsp; Instead of "none" you can also use the value 32 if you want it to insert spaces in place of the invalid characters.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="105507""></a>
  <div class="note">
   <strong class="user">daniel dot rhodes at warpasylum dot co dot uk</strong>
   <a href="#105507" class="date">23-Aug-2011 08:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Interestingly, setting different target locales results in different, yet appropriate, transliterations. For example:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">//some German<br />
</span><span class="default">$utf8_sentence </span><span class="keyword">= </span><span class="string">'Wei?, Goldmann, G?bel, Weiss, G?the, Goethe und G?tz'</span><span class="keyword">;<br />
<br />
</span><span class="comment">//UK<br />
</span><span class="default">setlocale</span><span class="keyword">(</span><span class="default">LC_ALL</span><span class="keyword">, </span><span class="string">'en_GB'</span><span class="keyword">);<br />
<br />
</span><span class="comment">//transliterate<br />
</span><span class="default">$trans_sentence </span><span class="keyword">= </span><span class="default">iconv</span><span class="keyword">(</span><span class="string">'UTF-8'</span><span class="keyword">, </span><span class="string">'ASCII//TRANSLIT'</span><span class="keyword">, </span><span class="default">$utf8_sentence</span><span class="keyword">);<br />
<br />
</span><span class="comment">//gives [Weiss, Goldmann, Gobel, Weiss, Gothe, Goethe und Gotz]<br />
//which is our original string flattened into 7-bit ASCII as<br />
//an English speaker would do it (ie. simply remove the umlauts)<br />
</span><span class="keyword">echo </span><span class="default">$trans_sentence </span><span class="keyword">. </span><span class="default">PHP_EOL</span><span class="keyword">;<br />
<br />
</span><span class="comment">//Germany<br />
</span><span class="default">setlocale</span><span class="keyword">(</span><span class="default">LC_ALL</span><span class="keyword">, </span><span class="string">'de_DE'</span><span class="keyword">);<br />
<br />
</span><span class="default">$trans_sentence </span><span class="keyword">= </span><span class="default">iconv</span><span class="keyword">(</span><span class="string">'UTF-8'</span><span class="keyword">, </span><span class="string">'ASCII//TRANSLIT'</span><span class="keyword">, </span><span class="default">$utf8_sentence</span><span class="keyword">);<br />
<br />
</span><span class="comment">//gives [Weiss, Goldmann, Goebel, Weiss, Goethe, Goethe und Goetz]<br />
//which is exactly how a German would transliterate those<br />
//umlauted characters if forced to use 7-bit ASCII!<br />
//(because really ? = ae, ? = oe and ü = ue)<br />
</span><span class="keyword">echo </span><span class="default">$trans_sentence </span><span class="keyword">. </span><span class="default">PHP_EOL</span><span class="keyword">;<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="101871""></a>
  <div class="note">
   <strong class="user">ameten</strong>
   <a href="#101871" class="date">14-Jan-2011 04:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I have used iconv to convert from cp1251 into UTF-8. I spent a day to investigate why a string with Russian capital 'Р' (sounds similar to 'r') at the end cannot be inserted into a database.<br />
<br />
The problem is not in iconv. But 'Р' in cp1251 is chr(208) and 'Р' in UTF-8 is chr(208).chr(106). chr(106) is one of the space symbol which match '\s' in regex. So, it can be taken by a greedy '+' or '*' operator. In that case, you loose 'Р' in your string.<br />
<br />
For example, 'ГР&nbsp;&nbsp; ' (Russian, UTF-8). Function preg_match. Regex is '(.+?)[\s]*'. Then '(.+?)' matches 'Г'.chr(208) and '[\s]*' matches chr(106).'&nbsp;&nbsp; '.<br />
<br />
Although, it is not a bug of iconv, but it looks like it very much. That's why I put this comment here.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="98917""></a>
  <div class="note">
   <strong class="user">vb (at) bertola.eu</strong>
   <a href="#98917" class="date">15-Jul-2010 06:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
On my system, according to tests, and also as reported by other people elsewhere, you can combine TRANSLIT and IGNORE only by appending<br />
<br />
//IGNORE//TRANSLIT<br />
<br />
strictly in that order, but NOT by appending //TRANSLIT//IGNORE, which would lead to //IGNORE being ignored ( :) ).<br />
<br />
Anyway, it's hard to understand how one could devise a system of passing options that does not allow to couple both options in a neat manner, and also to understand why the default behaviour should be the less useful and most dangerous one (throwing away most of your data at the first unexpected character). Software design FAIL :-/</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="95726""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#95726" class="date">18-Jan-2010 11:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For text with special characters such as (é) &amp;eacute; which appears at 0xE9 in the ISO-8859-1 and at 0x82 in IBM-850. The correct output character set is 'IBM850' as:<br />
('ISO-8859-1', 'IBM850', 'Québec')</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="94481""></a>
  <div class="note">
   <strong class="user">Andries Seutens</strong>
   <a href="#94481" class="date">07-Nov-2009 11:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When doing transliteration, you have to make sure that your LC_COLLATE is properly set, otherwise the default POSIX will be used.<br />
<br />
To transform "rené" into "rene" we could use the following code snippet:<br />
<br />
<span class="default">&lt;?php<br />
<br />
setlocale</span><span class="keyword">(</span><span class="default">LC_CTYPE</span><span class="keyword">, </span><span class="string">'nl_BE.utf8'</span><span class="keyword">);<br />
<br />
</span><span class="default">$string </span><span class="keyword">= </span><span class="string">'rené'</span><span class="keyword">;<br />
</span><span class="default">$string </span><span class="keyword">= </span><span class="default">iconv</span><span class="keyword">(</span><span class="string">'UTF-8'</span><span class="keyword">, </span><span class="string">'ASCII//TRANSLIT'</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">);<br />
<br />
echo </span><span class="default">$string</span><span class="keyword">; </span><span class="comment">// outputs rene<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="94058""></a>
  <div class="note">
   <strong class="user">annuaireehtp at gmail dot com</strong>
   <a href="#94058" class="date">14-Oct-2009 04:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
to test different combinations of convertions between charsets (when we don't know the source charset and what is the convenient destination charset) this is an example :
<br />

<br />
<span class="default">&lt;?php
<br />
$tab </span><span class="keyword">= array(</span><span class="string">"UTF-8"</span><span class="keyword">, </span><span class="string">"ASCII"</span><span class="keyword">, </span><span class="string">"Windows-1252"</span><span class="keyword">, </span><span class="string">"ISO-8859-15"</span><span class="keyword">, </span><span class="string">"ISO-8859-1"</span><span class="keyword">, </span><span class="string">"ISO-8859-6"</span><span class="keyword">, </span><span class="string">"CP1256"</span><span class="keyword">);
<br />
</span><span class="default">$chain </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;
<br />
foreach (</span><span class="default">$tab </span><span class="keyword">as </span><span class="default">$i</span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$tab </span><span class="keyword">as </span><span class="default">$j</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$chain </span><span class="keyword">.= </span><span class="string">" </span><span class="default">$i$j</span><span class="string"> "</span><span class="keyword">.</span><span class="default">iconv</span><span class="keyword">(</span><span class="default">$i</span><span class="keyword">, </span><span class="default">$j</span><span class="keyword">, </span><span class="string">"</span><span class="default">$my_string</span><span class="string">"</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
echo </span><span class="default">$chain</span><span class="keyword">;
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
then after displaying, you use the $i$j that shows good displaying.
<br />
NB: you can add other charsets to $tab&nbsp; to test other cases.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93609""></a>
  <div class="note">
   <strong class="user">phpmanualspam at netebb dot com</strong>
   <a href="#93609" class="date">17-Sep-2009 11:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
mirek code, dated 16-May-2008 10:17, added the characters `^~'" to the output.<br />
This function will strip out these extra characters:<br />
<span class="default">&lt;?php<br />
setlocale</span><span class="keyword">(</span><span class="default">LC_ALL</span><span class="keyword">, </span><span class="string">'en_US.UTF8'</span><span class="keyword">);<br />
function </span><span class="default">clearUTF</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$r </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$s1 </span><span class="keyword">= @</span><span class="default">iconv</span><span class="keyword">(</span><span class="string">'UTF-8'</span><span class="keyword">, </span><span class="string">'ASCII//TRANSLIT'</span><span class="keyword">, </span><span class="default">$s</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$j </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$s1</span><span class="keyword">); </span><span class="default">$i</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ch1 </span><span class="keyword">= </span><span class="default">$s1</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ch2 </span><span class="keyword">= @</span><span class="default">mb_substr</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">, </span><span class="default">$j</span><span class="keyword">++, </span><span class="default">1</span><span class="keyword">, </span><span class="string">'UTF-8'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">strstr</span><span class="keyword">(</span><span class="string">'`^~\'"'</span><span class="keyword">, </span><span class="default">$ch1</span><span class="keyword">) !== </span><span class="default">false</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$ch1 </span><span class="keyword">&lt;&gt; </span><span class="default">$ch2</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; --</span><span class="default">$j</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; continue;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$r </span><span class="keyword">.= (</span><span class="default">$ch1</span><span class="keyword">==</span><span class="string">'?'</span><span class="keyword">) ? </span><span class="default">$ch2 </span><span class="keyword">: </span><span class="default">$ch1</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$r</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91190""></a>
  <div class="note">
   <strong class="user">martin at front of mind dot co dot uk</strong>
   <a href="#91190" class="date">29-May-2009 03:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For transcoding values in an Excel generated CSV the following seems to work:<br />
<br />
<span class="default">&lt;?php <br />
$value </span><span class="keyword">= </span><span class="default">iconv</span><span class="keyword">(</span><span class="string">'Windows-1252'</span><span class="keyword">, </span><span class="string">'UTF-8//TRANSLIT'</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="90330""></a>
  <div class="note">
   <strong class="user">manuel at kiessling dot net</strong>
   <a href="#90330" class="date">16-Apr-2009 09:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Like many other people, I have encountered massive problems when using iconv() to convert between encodings (from UTF-8 to ISO-8859-15 in my case), especially on large strings.<br />
<br />
The main problem here is that when your string contains illegal UTF-8 characters, there is no really straight forward way to handle those. iconv() simply (and silently!) terminates the string when encountering the problematic characters (also if using //IGNORE), returning a clipped string. The<br />
<br />
<span class="default">&lt;?php<br />
<br />
$newstring </span><span class="keyword">= </span><span class="default">html_entity_decode</span><span class="keyword">(</span><span class="default">htmlentities</span><span class="keyword">(</span><span class="default">$oldstring</span><span class="keyword">, </span><span class="default">ENT_QUOTES</span><span class="keyword">, </span><span class="string">'UTF-8'</span><span class="keyword">), </span><span class="default">ENT_QUOTES </span><span class="keyword">, </span><span class="string">'ISO-8859-15'</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
workaround suggested here and elsewhere will also break when encountering illegal characters, at least dropping a useful note ("htmlentities(): Invalid multibyte sequence in argument in...")<br />
<br />
I have found a lot of hints, suggestions and alternative methods (it's scary and in my opinion no good sign how many ways PHP natively provides to convert the encoding of strings), but none of them really worked, except for this one:<br />
<br />
<span class="default">&lt;?php<br />
<br />
$newstring </span><span class="keyword">= </span><span class="default">mb_convert_encoding</span><span class="keyword">(</span><span class="default">$oldstring</span><span class="keyword">, </span><span class="string">'ISO-8859-15'</span><span class="keyword">, </span><span class="string">'UTF-8'</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="89075""></a>
  <div class="note">
   <strong class="user">kikke</strong>
   <a href="#89075" class="date">20-Feb-2009 04:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You can use native iconv in Linux via passthru if all else failed.<br />
Use the -c parameter to suppress error messages.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86077""></a>
  <div class="note">
   <strong class="user">Leigh Morresi</strong>
   <a href="#86077" class="date">01-Oct-2008 11:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are getting question-marks in your iconv output when transliterating, be sure to 'setlocale' to something your system supports.<br />
<br />
Some PHP CMS's will default setlocale to 'C', this can be a problem.<br />
<br />
use the "locale" command to find out a list..<br />
<br />
$ locale -a<br />
C<br />
en_AU.utf8<br />
POSIX<br />
<br />
<span class="default">&lt;?php<br />
&nbsp; setlocale</span><span class="keyword">(</span><span class="default">LC_CTYPE</span><span class="keyword">, </span><span class="string">'en_AU.utf8'</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$str </span><span class="keyword">= </span><span class="default">iconv</span><span class="keyword">(</span><span class="string">'UTF-8'</span><span class="keyword">, </span><span class="string">'ASCII//TRANSLIT'</span><span class="keyword">, </span><span class="string">"C?te d'Ivoire"</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83238""></a>
  <div class="note">
   <strong class="user">mirek at burkon dot org</strong>
   <a href="#83238" class="date">16-May-2008 03:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you need to strip as many national characters from UTF-8 as possible and keep the rest of input unchanged (i.e. convert whatever can be converted to ASCII and leave the rest), you can do it like this:<br />
<br />
<span class="default">&lt;?php<br />
setlocale</span><span class="keyword">(</span><span class="default">LC_ALL</span><span class="keyword">, </span><span class="string">'en_US.UTF8'</span><span class="keyword">);<br />
<br />
function </span><span class="default">clearUTF</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$r </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$s1 </span><span class="keyword">= </span><span class="default">iconv</span><span class="keyword">(</span><span class="string">'UTF-8'</span><span class="keyword">, </span><span class="string">'ASCII//TRANSLIT'</span><span class="keyword">, </span><span class="default">$s</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$s1</span><span class="keyword">); </span><span class="default">$i</span><span class="keyword">++)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ch1 </span><span class="keyword">= </span><span class="default">$s1</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ch2 </span><span class="keyword">= </span><span class="default">mb_substr</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$r </span><span class="keyword">.= </span><span class="default">$ch1</span><span class="keyword">==</span><span class="string">'?'</span><span class="keyword">?</span><span class="default">$ch2</span><span class="keyword">:</span><span class="default">$ch1</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$r</span><span class="keyword">;<br />
}<br />
<br />
echo </span><span class="default">clearUTF</span><span class="keyword">(</span><span class="string">'?íleně ?lu?ou?ky Va?ek úpěl olol! This will remain untranslated: ??????'</span><span class="keyword">);<br />
</span><span class="comment">//outputs Silene zlutoucky Vasek upel olol! This will remain untranslated: ??????<br />
</span><span class="default">?&gt;<br />
</span><br />
Just remember you HAVE TO set locale to some unicode encoding to make iconv handle //TRANSLIT correctly!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81494""></a>
  <div class="note">
   <strong class="user">berserk220 at mail dot ru</strong>
   <a href="#81494" class="date">29-Feb-2008 06:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
So, as iconv() does not always work correctly, in most cases, much easier to use htmlentities(). <br />
Example: <span class="default">&lt;?php $content</span><span class="keyword">=</span><span class="default">htmlentities</span><span class="keyword">(</span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="string">"incoming.txt"</span><span class="keyword">), </span><span class="default">ENT_QUOTES</span><span class="keyword">, </span><span class="string">"Windows-1252"</span><span class="keyword">);&nbsp; </span><span class="default">file_put_contents</span><span class="keyword">(</span><span class="string">"outbound.txt"</span><span class="keyword">, </span><span class="default">html_entity_decode</span><span class="keyword">(</span><span class="default">$content</span><span class="keyword">, </span><span class="default">ENT_QUOTES </span><span class="keyword">, </span><span class="string">"utf-8"</span><span class="keyword">)); </span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="80838""></a>
  <div class="note">
   <strong class="user">anton dot vakulchik at gmail dot com</strong>
   <a href="#80838" class="date">02-Feb-2008 10:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
function detectUTF8($string)<br />
{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return preg_match('%(?:<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; [\xC2-\xDF][\x80-\xBF]&nbsp; &nbsp; &nbsp; &nbsp; # non-overlong 2-byte<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; |\xE0[\xA0-\xBF][\x80-\xBF]&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; # excluding overlongs<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; |[\xE1-\xEC\xEE\xEF][\x80-\xBF]{2}&nbsp; &nbsp; &nbsp; # straight 3-byte<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; |\xED[\x80-\x9F][\x80-\xBF]&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; # excluding surrogates<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; |\xF0[\x90-\xBF][\x80-\xBF]{2}&nbsp; &nbsp; # planes 1-3<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; |[\xF1-\xF3][\x80-\xBF]{3}&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # planes 4-15<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; |\xF4[\x80-\x8F][\x80-\xBF]{2}&nbsp; &nbsp; # plane 16<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )+%xs', $string);<br />
}<br />
<br />
function cp1251_utf8( $sInput )<br />
{<br />
&nbsp;&nbsp;&nbsp; $sOutput = "";<br />
<br />
&nbsp;&nbsp;&nbsp; for ( $i = 0; $i &lt; strlen( $sInput ); $i++ )<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $iAscii = ord( $sInput[$i] );<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( $iAscii &gt;= 192 &amp;&amp; $iAscii &lt;= 255 )<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $sOutput .=&nbsp; "&amp;#".( 1040 + ( $iAscii - 192 ) ).";";<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else if ( $iAscii == 168 )<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $sOutput .= "&amp;#".( 1025 ).";";<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else if ( $iAscii == 184 )<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $sOutput .= "&amp;#".( 1105 ).";";<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $sOutput .= $sInput[$i];<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; return $sOutput;<br />
}<br />
<br />
function encoding($string){<br />
&nbsp;&nbsp;&nbsp; if (function_exists('iconv')) {&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (@!iconv('utf-8', 'cp1251', $string)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $string = iconv('cp1251', 'utf-8', $string);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return $string;<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (detectUTF8($string)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return $string;&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return cp1251_utf8($string);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
echo encoding($string);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="78972""></a>
  <div class="note">
   <strong class="user">mightye at gmail dot com</strong>
   <a href="#78972" class="date">05-Nov-2007 05:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To strip bogus characters from your input (such as data from an unsanitized or other source which you can't trust to necessarily give you strings encoded according to their advertised encoding set), use the same character set as both the input and the output, with //IGNORE on the output charcter set.<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// assuming '?' is actually UTF8, htmlentities will assume it's iso-8859&nbsp; <br />
// since we did not specify in the 3rd argument of htmlentities.<br />
// This generates "&amp;acirc;[bad utf-8 character]"<br />
// If passed to any libxml, it will generate a fatal error.<br />
</span><span class="default">$badUTF8 </span><span class="keyword">= </span><span class="default">htmlentities</span><span class="keyword">(</span><span class="string">'?'</span><span class="keyword">);<br />
<br />
</span><span class="comment">// iconv() can ignore characters which cannot be encoded in the target character set<br />
</span><span class="default">$goodUTF8 </span><span class="keyword">= </span><span class="default">iconv</span><span class="keyword">(</span><span class="string">"utf-8"</span><span class="keyword">, </span><span class="string">"utf-8//IGNORE"</span><span class="keyword">, </span><span class="default">$badUTF8</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span>The result of the example does not give you back the dagger character which was the original input (it got lost when htmlentities was misused to encode it incorrectly, though this is common from people not accustomed to dealing with extended character sets), but it does at least give you data which is sane in your target character set.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77315""></a>
  <div class="note">
   <strong class="user">gree:.. (gree 4T grees D0T net)</strong>
   <a href="#77315" class="date">24-Aug-2007 02:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In my case, I had to change:<br />
<span class="default">&lt;?php<br />
setlocale</span><span class="keyword">(</span><span class="default">LC_CTYPE</span><span class="keyword">, </span><span class="string">'cs_CZ'</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span>to <br />
<span class="default">&lt;?php<br />
setlocale</span><span class="keyword">(</span><span class="default">LC_CTYPE</span><span class="keyword">, </span><span class="string">'cs_CZ.UTF-8'</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span>Otherwise it returns question marks.<br />
<br />
When I asked my linux for locale (by locale command) it returns "cs_CZ.UTF-8", so there is maybe correlation between it.<br />
<br />
iconv (GNU libc) 2.6.1<br />
glibc 2.3.6</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74101""></a>
  <div class="note">
   <strong class="user">Ritchie</strong>
   <a href="#74101" class="date">24-Mar-2007 04:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Please note that iconv('UTF-8', 'ASCII//TRANSLIT', ...) doesn't work properly when locale category LC_CTYPE is set to C or POSIX. You must choose another locale otherwise all non-ASCII characters will be replaced with question marks. This is at least true with glibc 2.5.<br />
<br />
Example:<br />
<span class="default">&lt;?php<br />
setlocale</span><span class="keyword">(</span><span class="default">LC_CTYPE</span><span class="keyword">, </span><span class="string">'POSIX'</span><span class="keyword">);<br />
echo </span><span class="default">iconv</span><span class="keyword">(</span><span class="string">'UTF-8'</span><span class="keyword">, </span><span class="string">'ASCII//TRANSLIT'</span><span class="keyword">, </span><span class="string">"?lu?ou?ky k?\n"</span><span class="keyword">);<br />
</span><span class="comment">// ?lu?ou?k? k??<br />
<br />
</span><span class="default">setlocale</span><span class="keyword">(</span><span class="default">LC_CTYPE</span><span class="keyword">, </span><span class="string">'cs_CZ'</span><span class="keyword">);<br />
echo </span><span class="default">iconv</span><span class="keyword">(</span><span class="string">'UTF-8'</span><span class="keyword">, </span><span class="string">'ASCII//TRANSLIT'</span><span class="keyword">, </span><span class="string">"?lu?ou?ky k?\n"</span><span class="keyword">);<br />
</span><span class="comment">// Zlutoucky kun<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71192""></a>
  <div class="note">
   <strong class="user">Locoluis</strong>
   <a href="#71192" class="date">15-Nov-2006 12:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The following are Microsoft encodings that are based on ISO-8859 but with the addition of those stupid control characters.<br />
<br />
CP1250 is Eastern European (not ISO-8859-2)<br />
CP1251 is Cyrillic (not ISO-8859-5)<br />
CP1252 is Western European (not ISO-8859-1)<br />
CP1253 is Greek (not ISO-8859-7)<br />
CP1254 is Turkish (not ISO-8859-9)<br />
CP1255 is Hebrew (not ISO-8859-8)<br />
CP1256 is Arabic (not ISO-8859-6)<br />
CP1257 is Baltic (not ISO-8859-4)<br />
<br />
If you know you're getting input from a Windows machine with those encodings, use one of these as a parameter to iconv.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="59030""></a>
  <div class="note">
   <strong class="user">nilcolor at gmail dot coom</strong>
   <a href="#59030" class="date">24-Nov-2005 03:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Didn't know its a feature or not but its works for me (PHP 5.0.4)<br />
<br />
iconv('', 'UTF-8', $str)<br />
<br />
test it to convert from windows-1251 (stored in DB) to UTF-8 (which i use for web pages).<br />
BTW i convert each array i fetch from DB with array_walk_recursive...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="53365""></a>
  <div class="note">
   <strong class="user">anyean at gmail dot com</strong>
   <a href="#53365" class="date">30-May-2005 03:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
</span><span class="comment">//script from <a href="http://zizi.kxup.com/" rel="nofollow" target="_blank">http://zizi.kxup.com/</a><br />
//javascript unesape<br />
</span><span class="keyword">function </span><span class="default">unescape</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">) {<br />
&nbsp; </span><span class="default">$str </span><span class="keyword">= </span><span class="default">rawurldecode</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">);<br />
&nbsp; </span><span class="default">preg_match_all</span><span class="keyword">(</span><span class="string">"/(?:%u.{4})|&amp;#x.{4};|&amp;#\d+;|.+/U"</span><span class="keyword">,</span><span class="default">$str</span><span class="keyword">,</span><span class="default">$r</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$ar </span><span class="keyword">= </span><span class="default">$r</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$ar</span><span class="keyword">);<br />
&nbsp; foreach(</span><span class="default">$ar </span><span class="keyword">as </span><span class="default">$k</span><span class="keyword">=&gt;</span><span class="default">$v</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$v</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">) == </span><span class="string">"%u"</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$ar</span><span class="keyword">[</span><span class="default">$k</span><span class="keyword">] = </span><span class="default">iconv</span><span class="keyword">(</span><span class="string">"UCS-2"</span><span class="keyword">,</span><span class="string">"UTF-8"</span><span class="keyword">,</span><span class="default">pack</span><span class="keyword">(</span><span class="string">"H4"</span><span class="keyword">,</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$v</span><span class="keyword">,-</span><span class="default">4</span><span class="keyword">)));<br />
&nbsp;&nbsp;&nbsp; elseif(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$v</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">3</span><span class="keyword">) == </span><span class="string">"&amp;#x"</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$ar</span><span class="keyword">[</span><span class="default">$k</span><span class="keyword">] = </span><span class="default">iconv</span><span class="keyword">(</span><span class="string">"UCS-2"</span><span class="keyword">,</span><span class="string">"UTF-8"</span><span class="keyword">,</span><span class="default">pack</span><span class="keyword">(</span><span class="string">"H4"</span><span class="keyword">,</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$v</span><span class="keyword">,</span><span class="default">3</span><span class="keyword">,-</span><span class="default">1</span><span class="keyword">)));<br />
&nbsp;&nbsp;&nbsp; elseif(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$v</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">) == </span><span class="string">"&amp;#"</span><span class="keyword">) {<br />
echo </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$v</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">,-</span><span class="default">1</span><span class="keyword">).</span><span class="string">"&lt;br&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$ar</span><span class="keyword">[</span><span class="default">$k</span><span class="keyword">] = </span><span class="default">iconv</span><span class="keyword">(</span><span class="string">"UCS-2"</span><span class="keyword">,</span><span class="string">"UTF-8"</span><span class="keyword">,</span><span class="default">pack</span><span class="keyword">(</span><span class="string">"n"</span><span class="keyword">,</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$v</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">,-</span><span class="default">1</span><span class="keyword">)));<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
&nbsp; return </span><span class="default">join</span><span class="keyword">(</span><span class="string">""</span><span class="keyword">,</span><span class="default">$ar</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="49548""></a>
  <div class="note">
   <strong class="user">zhawari at hotmail dot com</strong>
   <a href="#49548" class="date">01-Feb-2005 03:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is how to convert UTF-8 numbers to UCS-2 numbers in hex:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;<br />
</span><span class="keyword">function </span><span class="default">utf8toucs2</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp; &nbsp; &nbsp; for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">);</span><span class="default">$i</span><span class="keyword">+=</span><span class="default">2</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$substring1 </span><span class="keyword">= </span><span class="default">$str</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">].</span><span class="default">$str</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">];&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$substring2 </span><span class="keyword">= </span><span class="default">$str</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">+</span><span class="default">2</span><span class="keyword">].</span><span class="default">$str</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">+</span><span class="default">3</span><span class="keyword">]; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">hexdec</span><span class="keyword">(</span><span class="default">$substring1</span><span class="keyword">) &lt; </span><span class="default">127</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$results </span><span class="keyword">= </span><span class="string">"00"</span><span class="keyword">.</span><span class="default">$str</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">].</span><span class="default">$str</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$results </span><span class="keyword">= </span><span class="default">dechex</span><span class="keyword">((</span><span class="default">hexdec</span><span class="keyword">(</span><span class="default">$substring1</span><span class="keyword">)-</span><span class="default">192</span><span class="keyword">)*</span><span class="default">64 </span><span class="keyword">+ (</span><span class="default">hexdec</span><span class="keyword">(</span><span class="default">$substring2</span><span class="keyword">)-</span><span class="default">128</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$results </span><span class="keyword">&lt; </span><span class="default">1000</span><span class="keyword">) </span><span class="default">$results </span><span class="keyword">= </span><span class="string">"0"</span><span class="keyword">.</span><span class="default">$results</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$i</span><span class="keyword">+=</span><span class="default">2</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ucs2 </span><span class="keyword">.= </span><span class="default">$results</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$ucs2</span><span class="keyword">;<br />
}<br />
&nbsp;<br />
echo </span><span class="default">strtoupper</span><span class="keyword">(</span><span class="default">utf8toucs2</span><span class="keyword">(</span><span class="string">"D985D8B1D8AD"</span><span class="keyword">)).</span><span class="string">"\n"</span><span class="keyword">;<br />
echo </span><span class="default">strtoupper</span><span class="keyword">(</span><span class="default">utf8toucs2</span><span class="keyword">(</span><span class="string">"456725"</span><span class="keyword">)).</span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp;<br />
</span><span class="default">?&gt;<br />
</span><br />
Input:<br />
D985D8B1D8AD<br />
Output:<br />
06450631062D<br />
<br />
Input:<br />
456725<br />
Output:<br />
004500670025</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="49171""></a>
  <div class="note">
   <strong class="user">zhawari at hotmail dot com</strong>
   <a href="#49171" class="date">18-Jan-2005 03:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is how to convert UCS-2 numbers to UTF-8 numbers in hex:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">ucs2toutf8</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">)
<br />
{
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">);</span><span class="default">$i</span><span class="keyword">+=</span><span class="default">4</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$substring1 </span><span class="keyword">= </span><span class="default">$str</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">].</span><span class="default">$str</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">];
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$substring2 </span><span class="keyword">= </span><span class="default">$str</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">+</span><span class="default">2</span><span class="keyword">].</span><span class="default">$str</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">+</span><span class="default">3</span><span class="keyword">];
<br />
&nbsp;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$substring1 </span><span class="keyword">== </span><span class="string">"00"</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$byte1 </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$byte2 </span><span class="keyword">= </span><span class="default">$substring2</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$substring </span><span class="keyword">= </span><span class="default">$substring1</span><span class="keyword">.</span><span class="default">$substring2</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$byte1 </span><span class="keyword">= </span><span class="default">dechex</span><span class="keyword">(</span><span class="default">192</span><span class="keyword">+(</span><span class="default">hexdec</span><span class="keyword">(</span><span class="default">$substring</span><span class="keyword">)/</span><span class="default">64</span><span class="keyword">));
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$byte2 </span><span class="keyword">= </span><span class="default">dechex</span><span class="keyword">(</span><span class="default">128</span><span class="keyword">+(</span><span class="default">hexdec</span><span class="keyword">(</span><span class="default">$substring</span><span class="keyword">)%</span><span class="default">64</span><span class="keyword">));
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$utf8 </span><span class="keyword">.= </span><span class="default">$byte1</span><span class="keyword">.</span><span class="default">$byte2</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$utf8</span><span class="keyword">;
<br />
}
<br />
&nbsp;
<br />
echo </span><span class="default">strtoupper</span><span class="keyword">(</span><span class="default">ucs2toutf8</span><span class="keyword">(</span><span class="string">"06450631062D0020"</span><span class="keyword">));
<br />

<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Input:
<br />
06450631062D
<br />
Output:
<br />
D985D8B1D8AD
<br />

<br />
regards,
<br />
Ziyad</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="47784""></a>
  <div class="note">
   <strong class="user">aissam at yahoo dot com</strong>
   <a href="#47784" class="date">29-Nov-2004 08:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For those who have troubles in displaying UCS-2 data on browser, here's a simple function that convert ucs2 to html unicode entities :<br />
<br />
<span class="default">&lt;?php<br />
<br />
&nbsp;</span><span class="keyword">function </span><span class="default">ucs2html</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$str</span><span class="keyword">=</span><span class="default">trim</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">); </span><span class="comment">// if you are reading from file<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$len</span><span class="keyword">=</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$html</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">$len</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">+=</span><span class="default">2</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$html</span><span class="keyword">.=</span><span class="string">'&amp;#'</span><span class="keyword">.</span><span class="default">hexdec</span><span class="keyword">(</span><span class="default">dechex</span><span class="keyword">(</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">])).<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">"%02s"</span><span class="keyword">,</span><span class="default">dechex</span><span class="keyword">(</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">])))).</span><span class="string">';'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; return(</span><span class="default">$html</span><span class="keyword">);<br />
&nbsp;}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="47499""></a>
  <div class="note">
   <strong class="user">nikolai-dot-zujev-at-gmail-dot-com</strong>
   <a href="#47499" class="date">18-Nov-2004 01:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is an example how to convert windows-1251 (windows) or cp1251(Linux/Unix) encoded string to UTF-8 encoding.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">cp1251_utf8</span><span class="keyword">( </span><span class="default">$sInput </span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$sOutput </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; for ( </span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">strlen</span><span class="keyword">( </span><span class="default">$sInput </span><span class="keyword">); </span><span class="default">$i</span><span class="keyword">++ )<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$iAscii </span><span class="keyword">= </span><span class="default">ord</span><span class="keyword">( </span><span class="default">$sInput</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] );<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( </span><span class="default">$iAscii </span><span class="keyword">&gt;= </span><span class="default">192 </span><span class="keyword">&amp;&amp; </span><span class="default">$iAscii </span><span class="keyword">&lt;= </span><span class="default">255 </span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$sOutput </span><span class="keyword">.=&nbsp; </span><span class="string">"&amp;#"</span><span class="keyword">.( </span><span class="default">1040 </span><span class="keyword">+ ( </span><span class="default">$iAscii </span><span class="keyword">- </span><span class="default">192 </span><span class="keyword">) ).</span><span class="string">";"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else if ( </span><span class="default">$iAscii </span><span class="keyword">== </span><span class="default">168 </span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$sOutput </span><span class="keyword">.= </span><span class="string">"&amp;#"</span><span class="keyword">.( </span><span class="default">1025 </span><span class="keyword">).</span><span class="string">";"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else if ( </span><span class="default">$iAscii </span><span class="keyword">== </span><span class="default">184 </span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$sOutput </span><span class="keyword">.= </span><span class="string">"&amp;#"</span><span class="keyword">.( </span><span class="default">1105 </span><span class="keyword">).</span><span class="string">";"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$sOutput </span><span class="keyword">.= </span><span class="default">$sInput</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$sOutput</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="47428""></a>
  <div class="note">
   <strong class="user">vitek at 4rome dot ru</strong>
   <a href="#47428" class="date">15-Nov-2004 11:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
On some systems there may be no such function as iconv(); this is due to the following reason: a constant is defined named `iconv` with the value `libiconv`. So, the string PHP_FUNCTION(iconv) transforms to PHP_FUNCTION(libiconv), and you have to call libiconv() function instead of iconv().<br />
I had seen this on FreeBSD, but I am sure that was a rather special build.<br />
If you'd want not to be dependent on this behaviour, add the following to your script:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">if (!</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">'iconv'</span><span class="keyword">) &amp;&amp; </span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">'libiconv'</span><span class="keyword">)) {<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">iconv</span><span class="keyword">(</span><span class="default">$input_encoding</span><span class="keyword">, </span><span class="default">$output_encoding</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">libiconv</span><span class="keyword">(</span><span class="default">$input_encoding</span><span class="keyword">, </span><span class="default">$output_encoding</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;<br />
</span>Thanks to tony2001 at phpclub.net for explaining this behaviour.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="43463""></a>
  <div class="note">
   <strong class="user">ng4rrjanbiah at rediffmail dot com</strong>
   <a href="#43463" class="date">22-Jun-2004 08:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is a code to convert ISO 8859-1 to UTF-8 and vice versa without using iconv.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">//Logic from <a href="http://twiki.org/cgi-bin/view/Codev/InternationalisationUTF8" rel="nofollow" target="_blank">http://twiki.org/cgi-bin/view/Codev/InternationalisationUTF8</a><br />
</span><span class="default">$str_iso8859_1 </span><span class="keyword">= </span><span class="string">'foo in ISO 8859-1'</span><span class="keyword">;<br />
</span><span class="comment">//ISO 8859-1 to UTF-8<br />
</span><span class="default">$str_utf8 </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"/([\x80-\xFF])/e"</span><span class="keyword">, <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"chr(0xC0|ord('\\1')&gt;&gt;6).chr(0x80|ord('\\1')&amp;0x3F)"</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$str_iso8859_1</span><span class="keyword">);<br />
</span><span class="comment">//UTF-8 to ISO 8859-1<br />
</span><span class="default">$str_iso8859_1 </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"/([\xC2\xC3])([\x80-\xBF])/e"</span><span class="keyword">, <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"chr(ord('\\1')&lt;&lt;6&amp;0xC0|ord('\\2')&amp;0x3F)"</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$str_utf8</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
HTH,<br />
R. Rajesh Jeba Anbiah</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
