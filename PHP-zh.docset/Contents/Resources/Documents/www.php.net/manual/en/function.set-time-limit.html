<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>设置脚本最大执行时间</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.set-include-path.html">? set_include_path</a></li>
      <li style="float: right;"><a href="function.sys-get-temp-dir.html">sys_get_temp_dir ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.info.html">PHP 选项/信息 函数</a></li>
    <li>设置脚本最大执行时间</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.set-time-limit" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">set_time_limit</h1>
  <p class="verinfo">(PHP 4, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">set_time_limit</span> &mdash; <span class="dc-title">设置脚本最大执行时间</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.set-time-limit-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>set_time_limit</strong></span>
    ( <span class="methodparam"><span class="type">int</span> <code class="parameter">$seconds</code></span>
   ) : <span class="type">bool</span></div>

  <p class="para rdfs-comment">
  设置允许脚本运行的时间，单位为秒。如果超过了此设置，脚本返回一个致命的错误。默认值为30秒，或者是在<var class="filename">php.ini</var>的<code class="literal">max_execution_time</code>被定义的值，如果此值存在。
  </p>
  <p class="para">
  当此函数被调用时，<span class="function"><strong>set_time_limit()</strong></span>会从零开始重新启动超时计数器。换句话说，如果超时默认是30秒，在脚本运行了了25秒时调用 <code class="literal">set_time_limit(20)</code>，那么，脚本在超时之前可运行总时间为45秒。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.set-time-limit-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">seconds</code></dt>

     <dd>

      <p class="para">
       最大的执行时间，单位为秒。如果设置为0（零），没有时间方面的限制。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.set-time-limit-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
     成功时返回 <strong><code>true</code></strong>，失败时返回  <strong><code>false</code></strong> 。
  </p>
 </div>


 <div class="refsect1 notes" id="refsect1-function.set-time-limit-notes">
  <h3 class="title">注释</h3>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    <span class="function"><strong>set_time_limit()</strong></span>函数和配置指令<a href="info.configuration.html#ini.max-execution-time" class="link">max_execution_time</a>只影响脚本本身执行的时间。任何发生在诸如使用<span class="function"><a href="function.system.html" class="function">system()</a></span>的系统调用，流操作，数据库操作等的脚本执行的最大时间不包括其中，当该脚本已运行。在测量时间是实值的Windows中，情况就不是如此了。   
   </p>
  </p></blockquote>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.set-time-limit-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><a href="info.configuration.html#ini.max-execution-time" class="link">max_execution_time</a></li>
    <li class="member"><a href="info.configuration.html#ini.max-input-time" class="link">max_input_time</a></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="124381""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#124381" class="date">11-Nov-2019 07:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
if you want to check how much time remains, this should work (at least on Windows, on non-Windows platforms, i'm not sure)<br />
<br />
$seconds_remaining_until_termination = ini_get('max_execution_time') === "0" ? null : ((int)ini_get('max_execution_time'))-(microtime(true)-$_SERVER['REQUEST_TIME_FLOAT']);<br />
<br />
gives you number of seconds until the script will be terminated due to the time limit. (tested on Windows 7 X64 SP1 with PHP 7.3.7)&nbsp; - or gives you null if there is no time limit.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="117601""></a>
  <div class="note">
   <strong class="user">f.nakamura</strong>
   <a href="#117601" class="date">06-Jul-2015 07:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
set_tme_limit resets the execution time count.<br />
<br />
test code1:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">echo </span><span class="string">'&lt;html&gt;&lt;body&gt;'</span><span class="keyword">;<br />
</span><span class="default">set_time_limit</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">);<br />
</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
while(++</span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">100000001</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$i </span><span class="keyword">% </span><span class="default">100000 </span><span class="keyword">== </span><span class="default">0</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">$i </span><span class="keyword">/ </span><span class="default">100000</span><span class="keyword">, </span><span class="string">"&lt;br/&gt;\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
}<br />
echo </span><span class="string">"done.&lt;br/&gt;\n"</span><span class="keyword">;<br />
<br />
</span><span class="comment">// will not echo 'done.'.<br />
</span><span class="default">?&gt;<br />
</span><br />
test code2:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">echo </span><span class="string">'&lt;html&gt;&lt;body&gt;'</span><span class="keyword">;<br />
</span><span class="default">set_time_limit</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">);<br />
</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
while(++</span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">100000001</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$i </span><span class="keyword">% </span><span class="default">100000 </span><span class="keyword">== </span><span class="default">0</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">set_time_limit</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">$i </span><span class="keyword">/ </span><span class="default">100000</span><span class="keyword">, </span><span class="string">"&lt;br/&gt;\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
}<br />
echo </span><span class="string">"done.&lt;br/&gt;\n"</span><span class="keyword">;<br />
<br />
</span><span class="comment">// will echo 'done.'<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="115057""></a>
  <div class="note">
   <strong class="user">kexianbin at diyism dot com</strong>
   <a href="#115057" class="date">20-May-2014 09:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Both set_time_limit(...) and&nbsp; ini_set('max_execution_time',...); won't count the time cost of sleep,file_get_contents,shell_exec,mysql_query etc, so i build this function my_background_exec(), to run static method/function in background/detached process and time is out kill it:<br />
<br />
my_exec.php:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">my_background_exec</span><span class="keyword">(</span><span class="default">$function_name</span><span class="keyword">, </span><span class="default">$params</span><span class="keyword">, </span><span class="default">$str_requires</span><span class="keyword">, </span><span class="default">$timeout</span><span class="keyword">=</span><span class="default">600</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; {</span><span class="default">$map</span><span class="keyword">=array(</span><span class="string">'"'</span><span class="keyword">=&gt;</span><span class="string">'\"'</span><span class="keyword">, </span><span class="string">'$'</span><span class="keyword">=&gt;</span><span class="string">'\$'</span><span class="keyword">, </span><span class="string">'`'</span><span class="keyword">=&gt;</span><span class="string">'\`'</span><span class="keyword">, </span><span class="string">'\\'</span><span class="keyword">=&gt;</span><span class="string">'\\\\'</span><span class="keyword">, </span><span class="string">'!'</span><span class="keyword">=&gt;</span><span class="string">'\!'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$str_requires</span><span class="keyword">=</span><span class="default">strtr</span><span class="keyword">(</span><span class="default">$str_requires</span><span class="keyword">, </span><span class="default">$map</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$path_run</span><span class="keyword">=</span><span class="default">dirname</span><span class="keyword">(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'SCRIPT_FILENAME'</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$my_target_exec</span><span class="keyword">=</span><span class="string">"/usr/bin/php -r \"chdir('</span><span class="keyword">{</span><span class="default">$path_run</span><span class="keyword">}</span><span class="string">');</span><span class="keyword">{</span><span class="default">$str_requires</span><span class="keyword">}</span><span class="string"> \\\$params=json_decode(file_get_contents('php://stdin'),true);call_user_func_array('</span><span class="keyword">{</span><span class="default">$function_name</span><span class="keyword">}</span><span class="string">', \\\$params);\""</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$my_target_exec</span><span class="keyword">=</span><span class="default">strtr</span><span class="keyword">(</span><span class="default">strtr</span><span class="keyword">(</span><span class="default">$my_target_exec</span><span class="keyword">, </span><span class="default">$map</span><span class="keyword">), </span><span class="default">$map</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$my_background_exec</span><span class="keyword">=</span><span class="string">"(/usr/bin/php -r \"chdir('</span><span class="keyword">{</span><span class="default">$path_run</span><span class="keyword">}</span><span class="string">');</span><span class="keyword">{</span><span class="default">$str_requires</span><span class="keyword">}</span><span class="string"> my_timeout_exec(\\\"</span><span class="keyword">{</span><span class="default">$my_target_exec</span><span class="keyword">}</span><span class="string">\\\", file_get_contents('php://stdin'), </span><span class="keyword">{</span><span class="default">$timeout</span><span class="keyword">}</span><span class="string">);\" &lt;&amp;3 &amp;) 3&lt;&amp;0"</span><span class="keyword">;</span><span class="comment">//php by default use "sh", and "sh" don't support "&lt;&amp;0"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">my_timeout_exec</span><span class="keyword">(</span><span class="default">$my_background_exec</span><span class="keyword">, </span><span class="default">json_encode</span><span class="keyword">(</span><span class="default">$params</span><span class="keyword">), </span><span class="default">2</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; }<br />
<br />
function </span><span class="default">my_timeout_exec</span><span class="keyword">(</span><span class="default">$cmd</span><span class="keyword">, </span><span class="default">$stdin</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">, </span><span class="default">$timeout</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; {</span><span class="default">$start</span><span class="keyword">=</span><span class="default">time</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$stdout</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$stderr</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//file_put_contents('debug.txt', time().':cmd:'.$cmd."\n", FILE_APPEND);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //file_put_contents('debug.txt', time().':stdin:'.$stdin."\n", FILE_APPEND);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$process</span><span class="keyword">=</span><span class="default">proc_open</span><span class="keyword">(</span><span class="default">$cmd</span><span class="keyword">, [[</span><span class="string">'pipe'</span><span class="keyword">, </span><span class="string">'r'</span><span class="keyword">], [</span><span class="string">'pipe'</span><span class="keyword">, </span><span class="string">'w'</span><span class="keyword">], [</span><span class="string">'pipe'</span><span class="keyword">, </span><span class="string">'w'</span><span class="keyword">]], </span><span class="default">$pipes</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">is_resource</span><span class="keyword">(</span><span class="default">$process</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {return array(</span><span class="string">'return'</span><span class="keyword">=&gt;</span><span class="string">'1'</span><span class="keyword">, </span><span class="string">'stdout'</span><span class="keyword">=&gt;</span><span class="default">$stdout</span><span class="keyword">, </span><span class="string">'stderr'</span><span class="keyword">=&gt;</span><span class="default">$stderr</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$status</span><span class="keyword">=</span><span class="default">proc_get_status</span><span class="keyword">(</span><span class="default">$process</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">posix_setpgid</span><span class="keyword">(</span><span class="default">$status</span><span class="keyword">[</span><span class="string">'pid'</span><span class="keyword">], </span><span class="default">$status</span><span class="keyword">[</span><span class="string">'pid'</span><span class="keyword">]);&nbsp; &nbsp; </span><span class="comment">//seperate pgid(process group id) from parent's pgid<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">stream_set_blocking</span><span class="keyword">(</span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="default">0</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">stream_set_blocking</span><span class="keyword">(</span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">], </span><span class="default">0</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">stream_set_blocking</span><span class="keyword">(</span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">], </span><span class="default">0</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="default">$stdin</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; while (</span><span class="default">1</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {</span><span class="default">$stdout</span><span class="keyword">.=</span><span class="default">stream_get_contents</span><span class="keyword">(</span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$stderr</span><span class="keyword">.=</span><span class="default">stream_get_contents</span><span class="keyword">(</span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">time</span><span class="keyword">()-</span><span class="default">$start</span><span class="keyword">&gt;</span><span class="default">$timeout</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {</span><span class="comment">//proc_terminate($process, 9);&nbsp; &nbsp; //only terminate subprocess, won't terminate sub-subprocess<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">posix_kill</span><span class="keyword">(-</span><span class="default">$status</span><span class="keyword">[</span><span class="string">'pid'</span><span class="keyword">], </span><span class="default">9</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//sends SIGKILL to all processes inside group(negative means GPID, all subprocesses share the top process group, except nested my_timeout_exec)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //file_put_contents('debug.txt', time().":kill group {$status['pid']}\n", FILE_APPEND);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">return array(</span><span class="string">'return'</span><span class="keyword">=&gt;</span><span class="string">'1'</span><span class="keyword">, </span><span class="string">'stdout'</span><span class="keyword">=&gt;</span><span class="default">$stdout</span><span class="keyword">, </span><span class="string">'stderr'</span><span class="keyword">=&gt;</span><span class="default">$stderr</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$status</span><span class="keyword">=</span><span class="default">proc_get_status</span><span class="keyword">(</span><span class="default">$process</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">//file_put_contents('debug.txt', time().':status:'.var_export($status, true)."\n";<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">if (!</span><span class="default">$status</span><span class="keyword">[</span><span class="string">'running'</span><span class="keyword">])<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {</span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">proc_close</span><span class="keyword">(</span><span class="default">$process</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$status</span><span class="keyword">[</span><span class="string">'exitcode'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">usleep</span><span class="keyword">(</span><span class="default">100000</span><span class="keyword">); <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; }<br />
</span><span class="default">?&gt;<br />
</span><br />
a_class.php:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">A<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; static function </span><span class="default">jack</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">, </span><span class="default">$b</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span><span class="default">sleep</span><span class="keyword">(</span><span class="default">4</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">file_put_contents</span><span class="keyword">(</span><span class="string">'debug.txt'</span><span class="keyword">, </span><span class="default">time</span><span class="keyword">().</span><span class="string">":A::jack:"</span><span class="keyword">.</span><span class="default">$a</span><span class="keyword">.</span><span class="string">' '</span><span class="keyword">.</span><span class="default">$b</span><span class="keyword">.</span><span class="string">"\n"</span><span class="keyword">, </span><span class="default">FILE_APPEND</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">sleep</span><span class="keyword">(</span><span class="default">15</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
test.php:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">require </span><span class="string">'my_exec.php'</span><span class="keyword">;<br />
<br />
</span><span class="default">my_background_exec</span><span class="keyword">(</span><span class="string">'A::jack'</span><span class="keyword">, array(</span><span class="string">'hello'</span><span class="keyword">, </span><span class="string">'jack'</span><span class="keyword">), </span><span class="string">'require "my_exec.php";require "a_class.php";'</span><span class="keyword">, </span><span class="default">8</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="114082""></a>
  <div class="note">
   <strong class="user">robertbrogers at gmail dot com</strong>
   <a href="#114082" class="date">09-Jan-2014 08:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Documentation states:<br />
When called, set_time_limit() restarts the timeout counter from zero. In other words, if the timeout is the default 30 seconds, and 25 seconds into script execution a call such as set_time_limit(20) is made, the script will run for a total of 45 seconds before timing out.<br />
<br />
If I have a long running script and i want a exact&nbsp; time limit, I set this as near as possible to the first line.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="108607""></a>
  <div class="note">
   <strong class="user">mingalevme at gmail dot com</strong>
   <a href="#108607" class="date">10-May-2012 07:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you're using PHP_CLI SAPI and getting error "Maximum execution time of N seconds exceeded" where N is an integer value, try to call set_time_limit(0) every M seconds or every iteration. For example:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">require_once(</span><span class="string">'db.php'</span><span class="keyword">);<br />
<br />
</span><span class="default">$stmt </span><span class="keyword">= </span><span class="default">$db</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="default">$sql</span><span class="keyword">);<br />
<br />
while (</span><span class="default">$row </span><span class="keyword">= </span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">fetchRow</span><span class="keyword">()) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">set_time_limit</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// your code here<br />
</span><span class="keyword">}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="106669""></a>
  <div class="note">
   <strong class="user">ratty at brohoof dot com</strong>
   <a href="#106669" class="date">25-Nov-2011 07:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
One thing that I wish I had found sooner is, if you're using php-cli and really need to limit the executation time, and if you're in *nix, you can use "timeout" which is part of coreutils.<br />
For example:<br />
<br />
timeout 5 /usr/bin/php -q /path/to/script<br />
<br />
and it will kill it if it takes longer than 5 seconds.<br />
I had a few quick php scripts I wrote for use with cacti for example.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="105569""></a>
  <div class="note">
   <strong class="user">alexander dot krause at ed-solutions dot de</strong>
   <a href="#105569" class="date">29-Aug-2011 02:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A nice workaround to have a real max_execution_time (needs posix and pcntl):
<br />

<br />
<span class="default">&lt;?php
<br />
$pid</span><span class="keyword">=</span><span class="default">pcntl_fork</span><span class="keyword">();
<br />

<br />
if (</span><span class="default">$pid</span><span class="keyword">) {
<br />
&nbsp; </span><span class="comment">//long time process
<br />
&nbsp; </span><span class="default">$a</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;
<br />
&nbsp; while (</span><span class="default">true</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"a=</span><span class="default">$a</span><span class="string">\n\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">ob_flush</span><span class="keyword">();
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">flush</span><span class="keyword">();
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$a</span><span class="keyword">++;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">shell_exec</span><span class="keyword">(</span><span class="string">'sleep 10&amp;'</span><span class="keyword">);
<br />
&nbsp; }
<br />
} else {
<br />
&nbsp; </span><span class="comment">//time-limit checker
<br />
&nbsp; </span><span class="default">sleep</span><span class="keyword">(</span><span class="default">5</span><span class="keyword">);
<br />
&nbsp; </span><span class="default">posix_kill</span><span class="keyword">(</span><span class="default">posix_getppid</span><span class="keyword">(),</span><span class="default">SIGKILL</span><span class="keyword">);
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100218""></a>
  <div class="note">
   <strong class="user">agvozden at gmail dot com</strong>
   <a href="#100218" class="date">01-Oct-2010 01:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you got something like:
<br />

<br />
msg: set_time_limit() [function.set-time-limit]: Cannot set time limit in safe mode 
<br />

<br />
try this:
<br />

<br />
<span class="default">&lt;?php
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if( !</span><span class="default">ini_get</span><span class="keyword">(</span><span class="string">'safe_mode'</span><span class="keyword">) ){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">set_time_limit</span><span class="keyword">(</span><span class="default">25</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="96923""></a>
  <div class="note">
   <strong class="user">Silver_Knight</strong>
   <a href="#96923" class="date">23-Mar-2010 05:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
if you are running a script that needs to execute for unknown time, or forever.. you may use<br />
set_time_limit(0);<br />
.....<br />
...<br />
..<br />
.<br />
and at the end of the script use flush() function to tell phpto send out what it has generated.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92949""></a>
  <div class="note">
   <strong class="user">ravenswd at gmail dot com</strong>
   <a href="#92949" class="date">15-Aug-2009 04:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Unfortunately, a script which gets into an infinite loop can produce an alarming amount of output in only a few seconds. I was attempting to debug a script, and I added<br />
<br />
<span class="default">&lt;?php<br />
set_time_limit</span><span class="keyword">(</span><span class="default">2</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
to the beginning of the script. Unfortunately, even two seconds of run time produced enough output to overload the memory available to my browser.<br />
<br />
So, I wrote a short routine which would limit the execution time, and also limit the amount of output returned. I added this to the beginning of my script and it worked perfectly:<br />
<br />
<span class="default">&lt;?php<br />
set_time_limit</span><span class="keyword">(</span><span class="default">2</span><span class="keyword">);<br />
<br />
</span><span class="default">ob_start</span><span class="keyword">();&nbsp; &nbsp;&nbsp; </span><span class="comment">// buffer output<br />
<br />
</span><span class="keyword">function </span><span class="default">shutdown </span><span class="keyword">() {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// print only first 2000 characters of output<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">= </span><span class="default">ob_get_clean</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; print </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$out</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">2000</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">register_shutdown_function</span><span class="keyword">(</span><span class="string">'shutdown'</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="90933""></a>
  <div class="note">
   <strong class="user">BW</strong>
   <a href="#90933" class="date">16-May-2009 05:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you use Apache you can change maximum execution time by .htaccess with this line<br />
<br />
php_value max_execution_time 200</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85488""></a>
  <div class="note">
   <strong class="user">cweiske at cweiske dot de</strong>
   <a href="#85488" class="date">02-Sep-2008 04:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To get the currently used time, use getrusage()</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84563""></a>
  <div class="note">
   <strong class="user">jonathon dot keogh at gmail dot com</strong>
   <a href="#84563" class="date">18-Jul-2008 02:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You can do set_time_limit(0); so that the script will run forever - however this is not recommended and your web server might catch you out with an imposed HTTP timeout (usually around 5 minutes).<br />
<br />
You should check your web server's guides for more information about HTTP timeouts.<br />
<br />
Jonathon</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83617""></a>
  <div class="note">
   <strong class="user">AtlantisNet</strong>
   <a href="#83617" class="date">04-Jun-2008 12:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In IIS, there is another global timeout setting which will override any PHP settings.&nbsp; You can alter this timeout by following the following instructions:<br />
<br />
<a href="http://www.iisadmin.co.uk/?p=7" rel="nofollow" target="_blank">http://www.iisadmin.co.uk/?p=7</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="72305""></a>
  <div class="note">
   <strong class="user">php at stock-consulting dot com</strong>
   <a href="#72305" class="date">12-Jan-2007 05:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To find out the currently set time limit, use
<br />

<br />
<span class="default">&lt;?php
<br />
&nbsp;ini_get</span><span class="keyword">(</span><span class="string">'max_execution_time'</span><span class="keyword">);
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
If set_time_limit has been previously called in the script, the result will be the value which was passed to set_time_limit (and not, as the function name "ini_get" appears to suggest, the value from the php.ini file).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="72268""></a>
  <div class="note">
   <strong class="user">bjfieldNO at SPAMgmail dot com</strong>
   <a href="#72268" class="date">10-Jan-2007 02:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Timeouts after five minutes in IIS on Windows are caused by an inherited CGI Timeout value of 300 seconds.&nbsp; This is not a PHP problem.&nbsp; The fix is to add custom values for the files or directories that need longer to run.<br />
<br />
In IIS 5.0 or 7.0 (beta as of this note), you can change this value on a fairly granular level using IIS Manager, under (roughly) YOURSITE -&gt; Properties -&gt; Home Directory -&gt; Configuration (button) -&gt; Options, but in IIS 6.0, this functionality is turned off (!), so you have to get into the Metabase.<br />
<br />
Find the site number in Metabase Explorer (e.g., 12345678), then from CMD prompt:<br />
<br />
[get to the scripts dir]<br />
cd C:\Inetpub\AdminScripts<br />
<br />
[this for each subdirectory from off the site root]<br />
cscript adsutil.vbs CREATE W3SVC/12345678/root/"MY SUBDIRECTORY" IIsWebDirectory<br />
<br />
[this for the file in question]<br />
cscript adsutil.vbs CREATE W3SVC/12345678/root/"MY SUBDIRECTORY"/ILikeToTimeOut.php IIsWebFile<br />
<br />
[this to set the timeout]<br />
cscript adsutil.vbs set W3SVC/12345678/root/"MY SUBDIRECTORY"/ILikeToTimeOut.php/CGITimeout "7200"<br />
<br />
Note:&nbsp; "7200" is 2 hours in seconds, but can be whatever.<br />
<br />
I derived the solution above from this fine article:<br />
<a href="http://www.iis-resources.com/modules/AMS/article.php?" rel="nofollow" target="_blank">http://www.iis-resources.com/modules/AMS/article.php?</a><br />
storyid=509&amp;page=3</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="72167""></a>
  <div class="note">
   <strong class="user">mba_aslam at yahoo dot com</strong>
   <a href="#72167" class="date">05-Jan-2007 05:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
while setting the set_time_limit(), the duration of sleep() will be ignored in the execution time. The following illustrates:<br />
<br />
<span class="default">&lt;?php<br />
<br />
set_time_limit</span><span class="keyword">(</span><span class="default">20</span><span class="keyword">);<br />
<br />
while (</span><span class="default">$i</span><span class="keyword">&lt;=</span><span class="default">10</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"i=</span><span class="default">$i</span><span class="string"> "</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">sleep</span><span class="keyword">(</span><span class="default">100</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$i</span><span class="keyword">++;<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Output:<br />
i=0 i=1 i=2 i=3 i=4 i=5 i=6 i=7 i=8 i=9 i=10</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="63839""></a>
  <div class="note">
   <strong class="user">konrads dot smelkovs at gmail dot com</strong>
   <a href="#63839" class="date">01-Apr-2006 06:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are streaming large data from database, it is counted towards the max exec time.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="62510""></a>
  <div class="note">
   <strong class="user">jatin at jatinchimote dot com</strong>
   <a href="#62510" class="date">01-Mar-2006 10:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you set the number of seconds to a very large number (not many ppl do that, but just in case) then php exits with a fatal error like :
<br />

<br />
Fatal error: Maximum execution time of 1 second exceeded in /path/to/your/script/why.php
<br />

<br />
[EDIT by danbrown AT php DOT net: This is due to the limit of 32-bit signed integers.]</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="62447""></a>
  <div class="note">
   <strong class="user">Cleverduck</strong>
   <a href="#62447" class="date">28-Feb-2006 01:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Regarding what 'nytshadow' said, it's important to realize that max-execution-time and the set_time_limit functions measure the time that the CPU is working on the script.&nbsp; If the script blocks, IE: for input, select, sleep, etc., then the time between blocking and returning is NOT measured.&nbsp; This is the same when running scripts from the command line interface.&nbsp; So if you've got a log parser written in PHP that tails a file, that program WILL fail eventually.&nbsp; It just depends how long it takes to read in enough input to process for 30 seconds.<br />
<br />
If you're writing a command line script that should run infinitely, setting max-execution-time to 0 (never stop) is HIGHLY recommended.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="59053""></a>
  <div class="note">
   <strong class="user">rycardo74 at gmail dot com</strong>
   <a href="#59053" class="date">24-Nov-2005 10:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
this work to fine html streaming AND time pass limit
<br />

<br />
<span class="default">&lt;?php
<br />
header</span><span class="keyword">(</span><span class="string">'Content-type: text/plain'</span><span class="keyword">);
<br />
echo </span><span class="default">date</span><span class="keyword">(</span><span class="string">"H:m:s"</span><span class="keyword">), </span><span class="string">"\n"</span><span class="keyword">;
<br />
</span><span class="default">set_time_limit</span><span class="keyword">(</span><span class="default">30</span><span class="keyword">);
<br />
for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">1000</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++)
<br />
{
<br />

<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">date</span><span class="keyword">(</span><span class="string">"H:m:s"</span><span class="keyword">),</span><span class="string">"\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; for (</span><span class="default">$r </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$r </span><span class="keyword">&lt; </span><span class="default">100000</span><span class="keyword">; </span><span class="default">$r</span><span class="keyword">++){
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$X</span><span class="keyword">.=&nbsp; </span><span class="default">tan</span><span class="keyword">(</span><span class="default">M_LNPI</span><span class="keyword">+</span><span class="default">log</span><span class="keyword">(</span><span class="default">ceil</span><span class="keyword">(&nbsp; </span><span class="default">date</span><span class="keyword">(</span><span class="string">"s"</span><span class="keyword">)*</span><span class="default">M_PI</span><span class="keyword">*</span><span class="default">M_LNPI</span><span class="keyword">+</span><span class="default">100</span><span class="keyword">)));
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">ob_flush</span><span class="keyword">();&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">flush</span><span class="keyword">();
<br />

<br />
}
<br />
echo </span><span class="string">"work! </span><span class="default">$x</span><span class="string">"</span><span class="keyword">;
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="53564""></a>
  <div class="note">
   <strong class="user">eric pecoraro at shepard com</strong>
   <a href="#53564" class="date">06-Jun-2005 12:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I was having trouble with script timeouts in applications where the user prompted long running background actions. I wrote this cURL/CLI background script that solved the problem when making requests from HTTP.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">/* BACKGROUND CLI 1.0<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp; eric pecoraro _at_ shepard dot com - 2005-06-02<br />
&nbsp;&nbsp; Use at your own risk. No warranties expressed or implied.<br />
<br />
&nbsp;&nbsp; Include this file at the top of any script to run it in the background<br />
&nbsp;&nbsp; with no time limitations ... e.g., include('background_cli.php');<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp; The script that calls this file should not return output to the browser. <br />
*/<br />
#&nbsp; REQUIREMENTS - cURL and CLI<br />
&nbsp;&nbsp; </span><span class="keyword">if ( !</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">'curl_setopt'</span><span class="keyword">) OR !</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">'curl_setopt'</span><span class="keyword">)&nbsp; ) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; echo </span><span class="string">'Requires cURL and CLI installations.' </span><span class="keyword">; exit ; <br />
&nbsp;&nbsp; }<br />
&nbsp;&nbsp; <br />
</span><span class="comment">#&nbsp; BUILD PATHS<br />
&nbsp;&nbsp; </span><span class="default">$script </span><span class="keyword">= </span><span class="default">array_pop</span><span class="keyword">(</span><span class="default">explode</span><span class="keyword">(</span><span class="string">'/'</span><span class="keyword">,</span><span class="default">$SCRIPT_NAME</span><span class="keyword">)) ; <br />
&nbsp;&nbsp; </span><span class="default">$script_dir </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$SCRIPT_NAME</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$SCRIPT_NAME</span><span class="keyword">)-</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$script</span><span class="keyword">)) ;<br />
&nbsp;&nbsp; </span><span class="default">$scriptURL </span><span class="keyword">= </span><span class="string">'<a href="http://" rel="nofollow" target="_blank">http://</a>'</span><span class="keyword">. </span><span class="default">$HTTP_HOST </span><span class="keyword">. </span><span class="default">$script_dir </span><span class="keyword">. </span><span class="string">"</span><span class="default">$script</span><span class="string">" </span><span class="keyword">;<br />
&nbsp;&nbsp; </span><span class="default">$curlURL </span><span class="keyword">= </span><span class="string">'<a href="http://" rel="nofollow" target="_blank">http://</a>'</span><span class="keyword">. </span><span class="default">$HTTP_HOST </span><span class="keyword">. </span><span class="default">$script_dir </span><span class="keyword">. </span><span class="string">"</span><span class="default">$script</span><span class="string">?runscript=curl" </span><span class="keyword">;<br />
<br />
</span><span class="comment">#&nbsp; Indicate that script is being called by CLI <br />
&nbsp;&nbsp; </span><span class="keyword">if ( </span><span class="default">php_sapi_name</span><span class="keyword">() == </span><span class="string">'cli' </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$CLI </span><span class="keyword">= </span><span class="default">true </span><span class="keyword">;<br />
&nbsp;&nbsp; }<br />
<br />
</span><span class="comment">#&nbsp; Action if script is being called by cURL_prompt()<br />
&nbsp;&nbsp; </span><span class="keyword">if ( </span><span class="default">$runscript </span><span class="keyword">== </span><span class="string">'curl' </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$cmd </span><span class="keyword">= </span><span class="string">"/usr/local/bin/php "</span><span class="keyword">.</span><span class="default">$PATH_TRANSLATED </span><span class="keyword">; </span><span class="comment">// server location of script to run<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">exec</span><span class="keyword">(</span><span class="default">$cmd</span><span class="keyword">) ;<br />
&nbsp;&nbsp; &nbsp;&nbsp; exit;<br />
&nbsp;&nbsp; }<br />
<br />
</span><span class="comment">#&nbsp; USER INTERFACE<br />
&nbsp;&nbsp; // User answer after submission.<br />
&nbsp;&nbsp; </span><span class="keyword">if ( </span><span class="default">$post </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">cURL_prompt</span><span class="keyword">(</span><span class="default">$curlURL</span><span class="keyword">) ;<br />
&nbsp;&nbsp; &nbsp;&nbsp; echo </span><span class="string">'&lt;div style="margin:25px;"&gt;&lt;title&gt;Background CLI&lt;/title&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; echo </span><span class="string">'O.K. If all goes well, &lt;b&gt;'</span><span class="keyword">.</span><span class="default">$script</span><span class="keyword">.</span><span class="string">'&lt;/b&gt; is working hard in the background with no ' </span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; echo </span><span class="string">'timeout limitations. &lt;br&gt;&lt;br&gt;&lt;form action='</span><span class="keyword">.</span><span class="default">$scriptURL</span><span class="keyword">.</span><span class="string">' method=GET&gt;' </span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; echo </span><span class="string">'&lt;input type=submit value=" RESET BACKGROUND CLI "&gt;&lt;/form&gt;&lt;/div&gt;' </span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; exit ;<br />
&nbsp;&nbsp; }<br />
&nbsp;&nbsp; </span><span class="comment">// Start screen.<br />
&nbsp;&nbsp; </span><span class="keyword">if ( !</span><span class="default">$CLI </span><span class="keyword">AND !</span><span class="default">$runscript </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; echo </span><span class="string">'&lt;title&gt;Background CLI&lt;/title&gt;&lt;div style="margin:25px;"&gt;' </span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; echo </span><span class="string">'&lt;form action='</span><span class="keyword">.</span><span class="default">$scriptURL</span><span class="keyword">.</span><span class="string">' method=POST&gt;' </span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; echo </span><span class="string">'Click to run &lt;b&gt;'</span><span class="keyword">.</span><span class="default">$script</span><span class="keyword">.</span><span class="string">'&lt;/b&gt; from the PHP CLI command line, in the background.&lt;br&gt;&lt;br&gt;' </span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; echo </span><span class="string">'&lt;input type=hidden value=1 name=post&gt;' </span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; echo </span><span class="string">'&lt;input type=submit value=" RUN IN BACKGROUND "&gt;&lt;/form&gt;&lt;/div&gt;' </span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; exit ;<br />
&nbsp;&nbsp; }<br />
<br />
</span><span class="comment">#&nbsp; cURL URL PROMPT FUNCTION<br />
&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">cURL_prompt</span><span class="keyword">(</span><span class="default">$url_path</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">ob_start</span><span class="keyword">(); </span><span class="comment">// start output buffer<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$c</span><span class="keyword">=</span><span class="default">curl_init</span><span class="keyword">(</span><span class="default">$url_path</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">, </span><span class="default">CURLOPT_TIMEOUT</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">); </span><span class="comment">// drop connection after 2 seconds<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">ob_end_clean</span><span class="keyword">(); </span><span class="comment">// discard output buffer<br />
&nbsp;&nbsp; </span><span class="keyword">}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="33462""></a>
  <div class="note">
   <strong class="user">php at mightycpa.com</strong>
   <a href="#33462" class="date">26-Jun-2003 01:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You may also need to look at Apache's timeout setting (Win32 version for me), I changed max execution time value in php.ini, and still got stopped by Apache's timeout value in the httpd.conf file.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="32532""></a>
  <div class="note">
   <strong class="user">rsallo at gna dot NOSPAM dot es</strong>
   <a href="#32532" class="date">30-May-2003 04:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When you are working with IIS, PHP timeout is valid only when it's lower than script timeout defined by IIS.<br />
<br />
IIS 5 has a default timeout of 300 seconds. If you need a higher timeout, you also have to change IIS properties. Otherwise, your server will stop your PHP script before it reaches its own timeout.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
