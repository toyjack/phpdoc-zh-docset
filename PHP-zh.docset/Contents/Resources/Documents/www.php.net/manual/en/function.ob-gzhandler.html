<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>在ob_start中使用的用来压缩输出缓冲区中内容的回调函数。ob_start callback function to gzip output buffer</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.ob-get-status.html">? ob_get_status</a></li>
      <li style="float: right;"><a href="function.ob-implicit-flush.html">ob_implicit_flush ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.outcontrol.html">Output Control 函数</a></li>
    <li>在ob_start中使用的用来压缩输出缓冲区中内容的回调函数。ob_start callback function to gzip output buffer</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.ob-gzhandler" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">ob_gzhandler</h1>
  <p class="verinfo">(PHP 4 &gt;= 4.0.4, PHP 5, PHP 7)</p><p class="refpurpose"><span class="refname">ob_gzhandler</span> &mdash; <span class="dc-title">在ob_start中使用的用来压缩输出缓冲区中内容的回调函数。ob_start callback function to gzip output buffer</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.ob-gzhandler-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>ob_gzhandler</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$buffer</code></span>
   , <span class="methodparam"><span class="type">int</span> <code class="parameter">$mode</code></span>
   ) : <span class="type">string</span></div>

  <p class="para rdfs-comment">
   <span class="function"><strong>ob_gzhandler()</strong></span>目的是用在<span class="function"><a href="function.ob-start.html" class="function">ob_start()</a></span>中作回调函数，以方便将gz   编码的数据发送到支持压缩页面的浏览器。在<span class="function"><strong>ob_gzhandler()</strong></span>真正发送压缩过的数据之前，该   函数会确定（判定）浏览器可以接受哪种类型内容编码（&quot;gzip&quot;,&quot;deflate&quot;,或者根本什么都不支持），然后   返回相应的输出。
   所有可以发送正确头信息表明他自己可以接受压缩的网页的浏览器，都可以支持。
   All browsers are supported since it&#039;s up to the browser to send the
   correct header saying that it accepts compressed web pages. 
   如果一个浏览器不支持压缩过的页面，此函数返回<strong><code>FALSE</code></strong>。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.ob-gzhandler-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">buffer</code></dt>

     <dd>

      <p class="para">
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">mode</code></dt>

     <dd>

      <p class="para">
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.ob-gzhandler-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.ob-gzhandler-changelog">
  <h3 class="title">更新日志</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead>
      <tr>
       <th>版本</th>
       <th>说明</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
       <td>4.0.5</td>
       <td>
        填加了 <code class="parameter">mode</code> 参数。
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.ob-gzhandler-examples">
  <h3 class="title">范例</h3>
  <p class="para">
   <div class="example" id="example-488">
    <p><strong>Example #1 <span class="function"><strong>ob_gzhandler()</strong></span> example</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br />ob_start</span><span style="color: #007700">(</span><span style="color: #DD0000">"ob_gzhandler"</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">?&gt;<br /></span>&lt;html&gt;<br />&lt;body&gt;<br />&lt;p&gt;This&nbsp;should&nbsp;be&nbsp;a&nbsp;compressed&nbsp;page.&lt;/p&gt;<br />&lt;/html&gt;<br />&lt;body&gt;</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 notes" id="refsect1-function.ob-gzhandler-notes">
  <h3 class="title">注释</h3>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    <span class="function"><strong>ob_gzhandler()</strong></span> 需要 <a href="ref.zlib.html" class="link">zlib</a> 扩展。
   </p>
  </p></blockquote>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    不能同时使用<span class="function"><strong>ob_gzhandler()</strong></span> 和 <a href="zlib.configuration.html#ini.zlib.output-compression" class="link">zlib.output_compression</a>。
    也要注意使用 <a href="zlib.configuration.html#ini.zlib.output-compression" class="link">
    zlib.output_compression</a> 要优于 <span class="function"><strong>ob_gzhandler()</strong></span>。
   </p>
  </p></blockquote>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.ob-gzhandler-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.ob-start.html" class="function" rel="rdfs-seeAlso">ob_start()</a> - 打开输出控制缓冲</span></li>
    <li class="member"><span class="function"><a href="function.ob-end-flush.html" class="function" rel="rdfs-seeAlso">ob_end_flush()</a> - 冲刷出（送出）输出缓冲区内容并关闭缓冲</span></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="97385""></a>
  <div class="note">
   <strong class="user">Jer</strong>
   <a href="#97385" class="date">16-Apr-2010 04:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I've just spent 5 hours fighting a bug in my application and outcome is:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// do not use<br />
</span><span class="default">ob_start</span><span class="keyword">(</span><span class="string">"ob_gzhandler"</span><span class="keyword">);<br />
</span><span class="comment">// along with<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">'HTTP/1.1 304 Not Modified'</span><span class="keyword">);<br />
<br />
</span><span class="comment">// or in the end use<br />
</span><span class="default">ob_end_clean</span><span class="keyword">();<br />
</span><span class="default">?&gt;<br />
</span><br />
W3C Standart requires response body to be empty if 304 header set. With compression on it will at least contain a gzip stream header even if your output is completely empty! <br />
<br />
This affects firefox (current ver.3.6.3) in a very subtle way: one of the requests after the one that gets 304 with not empty body gets it response prepended with contents of that body. In my case it was a css file and styles was not rendered at all, which made problem show up.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91685""></a>
  <div class="note">
   <strong class="user">przemekryciuk at gmail dot com</strong>
   <a href="#91685" class="date">23-Jun-2009 02:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The simplest way for gzip compression is:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">if(!</span><span class="default">ob_start</span><span class="keyword">(</span><span class="string">"ob_gzhandler"</span><span class="keyword">)) </span><span class="default">ob_start</span><span class="keyword">();<br />
</span><span class="default">?&gt;<br />
</span>ob_start("ob_gzhandler") returns FALSE if browser doesn't support gzip, so then is called normal ob_start();</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="87595""></a>
  <div class="note">
   <strong class="user">walter</strong>
   <a href="#87595" class="date">11-Dec-2008 07:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I have a very well tested module in my framework (ie: running in production environments for a couple of years) called 'fastpage', which takes care of both memcaching and gzipping for frequently requested content.&nbsp; It memcaches one version of each unique page both gzipped and non-gzipped, and returns the appropriate version based upon the browser's Accept-encoding header.<br />
<br />
Use is: <br />
$page_spec = array($dependent,$variables,$go,$here);<br />
if(!fastpage_display('content_id',$page_spec)) {<br />
&nbsp;... make page here ...<br />
&nbsp;fastpage_displayed('content_id',$page_spec);<br />
}<br />
<br />
Unfortunately, on IE8 beta (in IE8 mode, or in IE7 emulation mode), the fastpage-enabled content was not being un-gzipped.&nbsp; IE would request the content, a 200 status and correct byte count would appear in the server logfile, and IE would show no errors.&nbsp; However, CSS would not be applied and Javascript would not execute.<br />
<br />
The only fix I can find right now is to disable gzip entirely for this browser.&nbsp; User agent string is: Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/4.0; .NET CLR 2.0.50727<br />
<br />
The same output works fine in firefox (windows, linux, mac), and in safari.<br />
<br />
Versions are: zlib 1.2.3-r1 / php 5.2.6-r7 / lighttpd 1.4.20<br />
<br />
So much for the 'this has been fixed in IE7' comment, above...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85327""></a>
  <div class="note">
   <strong class="user">ronald at hidden dot com</strong>
   <a href="#85327" class="date">26-Aug-2008 01:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hi,<br />
<br />
if you are using apache, I think you are much better of using apache's compression, as this will also compress static text files (css, js, html, etc) and it will keep your php-code clean.<br />
<br />
See <a href="http://httpd.apache.org/docs/2.0/mod/mod_deflate.html for an excellent how to." rel="nofollow" target="_blank">http://httpd.apache.org/docs/2.0/mod/mod_deflate.html for an excellent how to.</a><br />
<br />
And for other webservers, I'm pretty sure they have equivalents.<br />
<br />
Cheers, Ronald</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77447""></a>
  <div class="note">
   <strong class="user">maratd at gmail dot com</strong>
   <a href="#77447" class="date">29-Aug-2007 08:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Someone previously mentioned that MSIE doesn't cache gzipped content. This is false. He misread the source of information. In fact, IE will cache gzipped content no matter what. Here is the quote from the mailing list:<br />
<br />
The reason the COMPRESSED responses are, in fact,<br />
always getting cached no matter what "Vary:" field name<br />
is present is just as I suspected... it is because MSIE<br />
decides it MUST cache responses that arrive with<br />
"Content-Encoding: gzip" because it MUST have a<br />
disk ( cache ) file to work with in order to do the<br />
decompression.<br />
<br />
Source: <a href="http://lists.over.net/pipermail/mod_gzip/2002-December/006826.html" rel="nofollow" target="_blank">http://lists.over.net/pipermail/mod_gzip/2002-December/006826.html</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76845""></a>
  <div class="note">
   <strong class="user">tehjosh at gamingg dot net</strong>
   <a href="#76845" class="date">01-Aug-2007 04:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
faisun at sina dot com:<br />
If you read up on output buffering, you'll see that if an output buffer callback returns false, this instructs PHP to output the original string untouched.&nbsp; That's why ob_gzhandler() returns false if the encoding is not supported.&nbsp;&nbsp; When ob_start("ob_gzhandler") is used and encoding is not supported, ob_gzhandler() will return false and PHP outputs the original, uncompressed string.<br />
<br />
jsnell at e-normous dot com:<br />
Output buffering callback functions accept up to two parameters, so this would probably work better for your situation:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">ob_gz_handler_no_errors</span><span class="keyword">(</span><span class="default">$buffer</span><span class="keyword">, </span><span class="default">$mode</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; @</span><span class="default">ob_gzhandler</span><span class="keyword">(</span><span class="default">$buffer</span><span class="keyword">, </span><span class="default">$mode</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">ob_start</span><span class="keyword">(</span><span class="string">'ob_gzhandler_no_errors'</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
However, if you're trying to suppress errors caused by headers already being sent, it would be better to start the output buffering earlier, before any output can be sent.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75468""></a>
  <div class="note">
   <strong class="user">jsnell at e-normous dot com</strong>
   <a href="#75468" class="date">31-May-2007 11:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to suppress errors (such as for cases when headers are already sent) and you don't want to write or patch your error_handler, you need to create an intermediate callback: <br />
<br />
function ob_gz_handler_no_errors($buffer) <br />
{<br />
&nbsp;&nbsp;&nbsp; @ob_gzhandler($buffer);<br />
}<br />
<br />
ob_start('ob_gzhandler_no_errors');</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="72656""></a>
  <div class="note">
   <strong class="user">nicolas dot grekas+php at gmail dot com</strong>
   <a href="#72656" class="date">28-Jan-2007 10:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here are some precisions :<br />
<br />
- the "mode" arg accepts a bit field composed of PHP_OUTPUT_HANDLER_START, PHP_OUTPUT_HANDLER_CONT and PHP_OUTPUT_HANDLER_END. See <a href="http://www.php.net/manual/fr/ref.zlib.php#56216 for an example. The value that jazfresh recommends below (5" rel="nofollow" target="_blank">http://www.php.net/manual/fr/ref.zlib.php#56216 for an example. The value that jazfresh recommends below (5</a>) is the good one, because 5 == PHP_OUTPUT_HANDLER_START | PHP_OUTPUT_HANDLER_END.<br />
<br />
- when called INSIDE an output buffering handler, ob_gzhandler DOES NOT return false when the browser doesn't support compressed pages. It rather returns the original string.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69206""></a>
  <div class="note">
   <strong class="user">spam_this at zleelz dot com</strong>
   <a href="#69206" class="date">26-Aug-2006 11:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When writing scripts for distribution, I would usually "null" out the following deprecated superglobals so that users who uses the script will not be able to use them.<br />
<span class="default">&lt;?php<br />
$HTTP_GET_VARS </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br />
</span><span class="default">$HTTP_POST_VARS </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br />
</span><span class="default">$HTTP_COOKIE_VARS </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br />
</span><span class="default">$HTTP_POST_FILES </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br />
</span><span class="default">$HTTP_SERVER_VARS </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
However, when using ob_start('ob_gzhandler'), one of those superglobals somehow disable this function.<br />
<br />
Found out that it was $HTTP_SERVER_VARS that's causing the problems.<br />
<br />
<span class="default">&lt;?php<br />
ob_start</span><span class="keyword">(</span><span class="string">'ob_gzhandler'</span><span class="keyword">);<br />
<br />
</span><span class="default">$HTTP_GET_VARS </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br />
</span><span class="default">$HTTP_POST_VARS </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br />
</span><span class="default">$HTTP_COOKIE_VARS </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br />
</span><span class="default">$HTTP_POST_FILES </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br />
</span><span class="comment">/**<br />
&nbsp;* Causing the trouble<br />
&nbsp;*/<br />
//$HTTP_SERVER_VARS = null;<br />
</span><span class="default">?&gt;<br />
</span><br />
I don't know why it does that, but I just want to point that out.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68034""></a>
  <div class="note">
   <strong class="user">richard at mf2fm dot com</strong>
   <a href="#68034" class="date">11-Jul-2006 02:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
According to the manual, if ob_gzhander detects that the browser is unable to support deflate or gzip it returns FALSE.&nbsp; Does this mean that if you use ob_start("ob_gzhandler"), any browsers that do not support gzip/deflate will receive a blank page?<br />
<br />
I've been having problems with IE6 displaying gzipped pages and adding a test:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">if (</span><span class="default">substr_count</span><span class="keyword">(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'HTTP_ACCEPT_ENCODING'</span><span class="keyword">], </span><span class="string">'gzip'</span><span class="keyword">)) </span><span class="default">ob_start</span><span class="keyword">(</span><span class="string">"ob_gzhandler"</span><span class="keyword">);<br />
<br />
else </span><span class="default">ob_start</span><span class="keyword">();<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
solved the problem.&nbsp; Surely if ob_gzhandler detects a lack of support for deflation it should return the input unchanged and not FALSE?</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="61474""></a>
  <div class="note">
   <strong class="user">mariusads[at]helpedia[dot]com</strong>
   <a href="#61474" class="date">04-Feb-2006 09:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Please be aware that, as other users have already mentioned, the compression will fail if there are characters before the php start tag "&lt; ?". <br />
<br />
This is also the case when saving files in UTF-8 format with editors such as Ultraedit. Make sure you save the file using the defined option UTF-8 NO BOM or delete the BOM otherwise the two UTF BOM characters will be written at the start of the file.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="56550""></a>
  <div class="note">
   <strong class="user">lapoint2 at msu dot edu</strong>
   <a href="#56550" class="date">06-Sep-2005 06:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
So why doesn't the web server just do this by default?&nbsp; <br />
This works for me if I do:<br />
ini_set('zlib.output_compression_level', 3);&nbsp; ob_start("ob_gzhandler"); <br />
or even just:<br />
ob_start("ob_gzhandler"); <br />
<br />
I did the level 3 compression, I think the default was 6 and I didn't want to put too much load on the server.&nbsp; For a 895k file (my largest) the compression levels were:<br />
1 = 189k<br />
3 = 178k<br />
4 = 163k<br />
6 = 156k&nbsp; &nbsp; (I believe 6 is the default if you leave out the ini_set)<br />
9 = 155k<br />
I use <a href="http://www.whatsmyip.org/mod_gzip_test/ to check the sizes." rel="nofollow" target="_blank">http://www.whatsmyip.org/mod_gzip_test/ to check the sizes.</a><br />
<br />
FYI: This works with dynamic files in Movable Type 3.x (I'm testing it in 3.2) I've got the above command in the first line of my mtview.php file.<br />
<br />
More info here: <a href="http://www.whatsmyip.org/forum/viewtopic.php?t=43" rel="nofollow" target="_blank">http://www.whatsmyip.org/forum/viewtopic.php?t=43</a><br />
<br />
On several sites I've read the some browsers don't like compressed CSS.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="53827""></a>
  <div class="note">
   <strong class="user">Tony Piper</strong>
   <a href="#53827" class="date">14-Jun-2005 07:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I just spent 30 minutes wondering why my browser wasn't getting the gzipped version :-O<br />
<br />
If you're using Google Web Access your pages will&nbsp; be delivered to the browser uncompressed unless you tell GWA to ignore the specific site. <br />
<br />
Obvious, really.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="53157""></a>
  <div class="note">
   
   <a href="#53157" class="date">24-May-2005 03:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
No matter the circumstances, you MUST NOT check the user agent string to find out if gzip compression is enabled. HTTP defines the Accept-Encoding header for exactly this purpose and you MUST check it before enabling compression.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="51949""></a>
  <div class="note">
   <strong class="user">m at rtij dot nl</strong>
   <a href="#51949" class="date">16-Apr-2005 05:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
All versions of MSIE have a bug where they don't cache gzipd contents. If your application depends on caching, this is something to keep in mind. In the end, I did:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">// These are so benificial, they default to true.<br />
</span><span class="keyword">if (!isset(</span><span class="default">$use_page_cache</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$use_page_cache </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;<br />
if (!isset(</span><span class="default">$use_compression</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$use_compression </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;<br />
<br />
</span><span class="comment">// Add browsers here as we must detect them. Opera is an oddball, if we don't detect<br />
// it specifically, it will turn up as MSIE<br />
<br />
</span><span class="default">$browser</span><span class="keyword">=</span><span class="string">"other"</span><span class="keyword">;<br />
if (isset(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'HTTP_USER_AGENT'</span><span class="keyword">])) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$agent </span><span class="keyword">= </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'HTTP_USER_AGENT'</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">eregi</span><span class="keyword">(</span><span class="string">"opera"</span><span class="keyword">,</span><span class="default">$agent</span><span class="keyword">)){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$browser</span><span class="keyword">=</span><span class="string">"opera"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }elseif(</span><span class="default">eregi</span><span class="keyword">(</span><span class="string">"msie"</span><span class="keyword">,</span><span class="default">$agent</span><span class="keyword">)){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$browser</span><span class="keyword">=</span><span class="string">"msie"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
if (</span><span class="default">$use_compression </span><span class="keyword">&amp;&amp; !( </span><span class="default">$use_page_cache </span><span class="keyword">&amp;&amp; </span><span class="default">$browser </span><span class="keyword">== </span><span class="string">"msie"</span><span class="keyword">)) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Turn on compression, makes quite a difference in bandwith usage.<br />
&nbsp;&nbsp;&nbsp; // However, MSIE (all versions) have a bug with compression and caching. So for MSIE<br />
&nbsp;&nbsp;&nbsp; // it's either compression or caching. We choose caching.<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">ob_start</span><span class="keyword">(</span><span class="string">'ob_gzhandler'</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">session_cache_limiter</span><span class="keyword">(</span><span class="string">"must-revalidate"</span><span class="keyword">);<br />
<br />
</span><span class="default">session_start</span><span class="keyword">();<br />
<br />
</span><span class="comment">// ... put stuff in $content ...<br />
<br />
</span><span class="keyword">if (</span><span class="default">$use_page_cache</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// MD5 is slow, however with a fast server (PIII or better) we should be OK<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$hash </span><span class="keyword">= </span><span class="default">md5</span><span class="keyword">(</span><span class="default">$content</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$headers </span><span class="keyword">= </span><span class="default">getallheaders</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; if (isset(</span><span class="default">$headers</span><span class="keyword">[</span><span class="string">'If-None-Match'</span><span class="keyword">]) &amp;&amp; </span><span class="default">ereg</span><span class="keyword">(</span><span class="default">$hash</span><span class="keyword">, </span><span class="default">$headers</span><span class="keyword">[</span><span class="string">'If-None-Match'</span><span class="keyword">]))<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'HTTP/1.1 304 Not Modified'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; exit;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">"ETag: \"</span><span class="default">$hash</span><span class="string">\""</span><span class="keyword">);<br />
}<br />
<br />
print </span><span class="default">$content</span><span class="keyword">;<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="50691""></a>
  <div class="note">
   <strong class="user">grange (at) club-internet (dot) fr</strong>
   <a href="#50691" class="date">07-Mar-2005 07:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It may seem obvious but if you use ob_start("ob_gzhandler"),&nbsp; make sure no content is unintentionally echo'ed before : this could be blank lines before '&lt;?php' or after '?&gt;' tags in included files or even errors.<br />
<br />
Otherwise, only a part of the content (the content sent after ob_start()) will be compressed, which will confuse the client.<br />
<br />
Setting compression using zlib.output_compression either in php.ini or in Apache configuration file (with directive php_flag) is safer in this regard.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="40894""></a>
  <div class="note">
   <strong class="user">mazsolt at yahoo dot com</strong>
   <a href="#40894" class="date">18-Mar-2004 07:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
if you want to send an output to the browser (which accepts gzip), and you haven't set the buffering callback ob_start("ob_gzhandler"), you may use the gzencode() function.<br />
<br />
header("Content-Encoding: gzip");<br />
echo gzencode("some output", 9, FORCE_GZIP);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="35969""></a>
  <div class="note">
   <strong class="user">brewthatistrue at plzYnoAspamHorOevilO dot com</strong>
   <a href="#35969" class="date">21-Sep-2003 02:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
i had a LOT of trouble trying to get gzipping working correctly<br />
i kept getting a blank page on the first load, although subsequent pages loaded fine.<br />
i tried stuff with ob_flush and ob_end_clean and all kinds of stuff i didn't understand. i'm totally confused about different versions of php and different methods of gzipping.<br />
<br />
in the end, i got it working (maybe i'll understand it later).<br />
i ended up using phpBB's code (stripped of non-gz stuff, and ever-so-slightly modified)<br />
<a href="http://phpbb.com/" rel="nofollow" target="_blank">http://phpbb.com/</a><br />
<br />
index.php:<br />
------------<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">require_once(</span><span class="string">'top.php'</span><span class="keyword">);<br />
<br />
echo </span><span class="string">"&lt;html&gt;\n&lt;head&gt;\n&lt;title&gt;Gzip Test&lt;/title&gt;\n&lt;body&gt;\n&lt;h1&gt;testing&lt;/h1&gt;\n&lt;/body&gt;\n&lt;/html&gt;"</span><span class="keyword">;<br />
<br />
require_once(</span><span class="string">'bottom.php'</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
gz_header.php - taken form phpBB's page_header.php<br />
--------------<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; $phpver </span><span class="keyword">= </span><span class="default">phpversion</span><span class="keyword">();<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$useragent </span><span class="keyword">= (isset(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">"HTTP_USER_AGENT"</span><span class="keyword">]) ) ? </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">"HTTP_USER_AGENT"</span><span class="keyword">] : </span><span class="default">$HTTP_USER_AGENT</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; if ( </span><span class="default">$phpver </span><span class="keyword">&gt;= </span><span class="string">'4.0.4pl1' </span><span class="keyword">&amp;&amp; ( </span><span class="default">strstr</span><span class="keyword">(</span><span class="default">$useragent</span><span class="keyword">,</span><span class="string">'compatible'</span><span class="keyword">) || </span><span class="default">strstr</span><span class="keyword">(</span><span class="default">$useragent</span><span class="keyword">,</span><span class="string">'Gecko'</span><span class="keyword">) ) )<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( </span><span class="default">extension_loaded</span><span class="keyword">(</span><span class="string">'zlib'</span><span class="keyword">) )<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ob_start</span><span class="keyword">(</span><span class="string">'ob_gzhandler'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; else if ( </span><span class="default">$phpver </span><span class="keyword">&gt; </span><span class="string">'4.0' </span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( </span><span class="default">strstr</span><span class="keyword">(</span><span class="default">$HTTP_SERVER_VARS</span><span class="keyword">[</span><span class="string">'HTTP_ACCEPT_ENCODING'</span><span class="keyword">], </span><span class="string">'gzip'</span><span class="keyword">) )<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ( </span><span class="default">extension_loaded</span><span class="keyword">(</span><span class="string">'zlib'</span><span class="keyword">) )<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$do_gzip_compress </span><span class="keyword">= </span><span class="default">TRUE</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ob_start</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ob_implicit_flush</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-Encoding: gzip'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;<br />
</span>gz_footer.php - taken form phpBB's page_tail.php<br />
------------<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// Compress buffered output if required and send to browser<br />
</span><span class="keyword">if ( </span><span class="default">$do_gzip_compress </span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//<br />
&nbsp;&nbsp;&nbsp; // Borrowed from php.net!<br />
&nbsp;&nbsp;&nbsp; //<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$gzip_contents </span><span class="keyword">= </span><span class="default">ob_get_contents</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">ob_end_clean</span><span class="keyword">();<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$gzip_size </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$gzip_contents</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$gzip_crc </span><span class="keyword">= </span><span class="default">crc32</span><span class="keyword">(</span><span class="default">$gzip_contents</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$gzip_contents </span><span class="keyword">= </span><span class="default">gzcompress</span><span class="keyword">(</span><span class="default">$gzip_contents</span><span class="keyword">, </span><span class="default">9</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$gzip_contents </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$gzip_contents</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$gzip_contents</span><span class="keyword">) - </span><span class="default">4</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"\x1f\x8b\x08\x00\x00\x00\x00\x00"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">$gzip_contents</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">pack</span><span class="keyword">(</span><span class="string">'V'</span><span class="keyword">, </span><span class="default">$gzip_crc</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">pack</span><span class="keyword">(</span><span class="string">'V'</span><span class="keyword">, </span><span class="default">$gzip_size</span><span class="keyword">);<br />
}<br />
<br />
exit;<br />
</span><span class="default">?&gt;<br />
</span><br />
i must admit to not seeing this working in opera 7.11. perhaps i will figure that one out.<br />
if there is anything i should change email me and i can edit my post</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="35893""></a>
  <div class="note">
   <strong class="user">jazfresh at SPAM-JAVELIN dot hotmail dot com</strong>
   <a href="#35893" class="date">18-Sep-2003 07:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In the set_error_handler notes, there is a technique described for capturing all errors (even parse errors) before they are displayed the user, using a special error handler and output handler. If this output handler detects a fatal error in the output buffer, it's captured and dealt with before it can be displayed to the user. If no error was detected, then output buffer is displayed verbatim (i.e. without being compressed).<br />
<br />
If you are using this method, you can still take advantage of ob_gzhandler's compression. However, you MUST specify a mode argument (I'm using 4.2.2 on RedHat9). The mode value affects which headers are automatically added (Content-Encoding, etc). A value of '5' worked for me. '0' or discarding the argument produces a blank screen under Mozilla. <br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">my_output_handler</span><span class="keyword">(&amp;</span><span class="default">$buffer</span><span class="keyword">) {<br />
&nbsp; </span><span class="comment">// Detect errors in the output<br />
&nbsp; </span><span class="keyword">if(</span><span class="default">ereg</span><span class="keyword">(</span><span class="string">"(error&lt;/b&gt;:)(.+) in &lt;b&gt;(.+)&lt;/b&gt; on line &lt;b&gt;(.+)&lt;/b&gt;"</span><span class="keyword">, </span><span class="default">$buffer</span><span class="keyword">, </span><span class="default">$regs</span><span class="keyword">)) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">my_error_handler</span><span class="keyword">(</span><span class="default">E_ERROR</span><span class="keyword">, </span><span class="default">$regs</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">], </span><span class="default">$regs</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">], </span><span class="default">$regs</span><span class="keyword">[</span><span class="default">4</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// ...<br />
&nbsp;&nbsp;&nbsp; // ... Insert your error handling here ...<br />
&nbsp;&nbsp;&nbsp; // ...<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">return </span><span class="string">'An internal error occurred.'</span><span class="keyword">;<br />
&nbsp; } else {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// The page rendered without any errors, so compress<br />
&nbsp;&nbsp;&nbsp; // and output.<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">ob_gzhandler</span><span class="keyword">(</span><span class="default">$buffer</span><span class="keyword">, </span><span class="default">5</span><span class="keyword">);<br />
&nbsp; }<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="35585""></a>
  <div class="note">
   <strong class="user">daijoubu at videotron dot ca</strong>
   <a href="#35585" class="date">06-Sep-2003 04:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
About the previous note from Davey:<br />
<br />
ob_start(array('ob_gzhandler',9));<br />
<br />
Does not work. The output size isn?t affected at all, stays the same.<br />
<br />
ob_gzhandler compression level use zlib.output_compression_level, which is -1 per default, level 6.<br />
<br />
To change the compression level on the fly, simply use ini_set:<br />
<span class="default">&lt;?php<br />
ini_set</span><span class="keyword">(</span><span class="string">'zlib.output_compression_level'</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
</span><span class="default">ob_start</span><span class="keyword">(</span><span class="string">'ob_gzhandler'</span><span class="keyword">);<br />
echo </span><span class="string">'This is compressed at level 1'</span><span class="keyword">;<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="31096""></a>
  <div class="note">
   
   <a href="#31096" class="date">09-Apr-2003 10:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When using ob_start("ob_gzhandler"), be aware that the output buffer has to be flushed in order to invoke the ob_gzhandler callback function. <br />
<br />
This may not always happen. For example, if you use ob_get_contents() to copy the output buffer to a string for further manipulation and then silently discard the buffer with ob_end_clean(), the output buffer is never "flushed" and as a result, the ob_gzhandler callback function is never invoked. And your pages won't be compressed.<br />
<br />
This will be the case, for example, if you use the PHP Fusebox architecture/framework.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="30943""></a>
  <div class="note">
   <strong class="user">davey at its-explosive dot net</strong>
   <a href="#30943" class="date">03-Apr-2003 06:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To pass the second argument to ob_gzhandler() which specifies what level of compression should be used (which I assume is 1-9 as with the gzip binary, with 9 using the most processor and time to do, 4 is the standard IIRC) you must call ob_start() like so:<br />
<br />
ob_start(array('ob_gzhandler',9));<br />
<br />
- Davey</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="30159""></a>
  <div class="note">
   <strong class="user">nospam at 1111-internet dot com</strong>
   <a href="#30159" class="date">08-Mar-2003 03:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Differences between zlib.output_compression and ob_gzhandler:<br />
<br />
zlib.output_compression runs in parallel with script execution - it begins compressing as soon as it receives any output from your script, and sends data to the client each time its buffer (4K by default) gets full. ob_gzhandler (actually 'ob_start("ob_gzhandler");') will not start compressing until the script flushes (or, usually, exits), and will in turn send the entire compressed document at once - which makes it more susceptible to causing a perception of latency.<br />
<br />
Advantage: zlib.output_compression<br />
<br />
On the other hand, ob_gzhandler gives you script-level control allowing you to use it selectively or to unset it after setting it in certain cases. Despite some documentation to the contrary, zlib.output_compression does not appear to be able to be set or unset on a script level; you must instead set it globally (in php.ini) or in your webserver configs or .htaccess files, possibly using FilesMatch-type mechanisms to control which scripts it will or won't apply to - which could get unwieldy for large projects - particularly those which employ PHP to produce images and other non-text output in addition to normal text output.<br />
<br />
Advantage: ob_gzhandler<br />
<br />
Net advantage: depends on your particular needs. I'm trying zlib.output_compression for now, but I miss the flexibility that ob_gzhandler would provide.<br />
<br />
p.s. here's an Apache 1.3.* httpd.conf/.htaccess file snippet that demonstrates the syntax for conditionally setting zlib.output_compression:<br />
<br />
&lt;FilesMatch "\.(php|html?)$"&gt;<br />
# turn it on with the buffer set to 2K using php_value<br />
php_value zlib.output_compression 2048<br />
# or just turn it on using php_flag<br />
# php_flag zlib.output_compression On<br />
&lt;/FilesMatch&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="30030""></a>
  <div class="note">
   <strong class="user">aki at robotnik dot net</strong>
   <a href="#30030" class="date">04-Mar-2003 11:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
if you get errors like:<br />
"output handler 'ob_gzhandler' cannot be used twice"<br />
if you are using <br />
"ob_start("ob_gzhandler");"<br />
<br />
check for your php.ini file, it should look like this:<br />
<br />
output_buffering = Off&nbsp; ; delete the 4096k value<br />
output_handler = <br />
zlib.output_compression = Off</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="26619""></a>
  <div class="note">
   <strong class="user">dsugar100 at dolphinsoft dot com</strong>
   <a href="#26619" class="date">06-Nov-2002 03:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I have noticed that if you have the php setting for zlib.output_compression set to 'On' AND you attempt to use hte ob_gzhandler handler to ob_start () the output you get in the browser WILL be garbled in PHP 4.2.3.&nbsp; I'm guessing that the output buffering is compressing the output to be sent, and then zlib is doing it a second time, but the browser is only uncompressing it once.<br />
<br />
But using either one will give you the same results (compressed output from the script)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="24157""></a>
  <div class="note">
   <strong class="user">psychones at ifrance dot com</strong>
   <a href="#24157" class="date">08-Aug-2002 05:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Problem revelate by xn@bnw.com<br />
<br />
cause real problem when you have a global call<br />
to ob_gzhandler , for example in an include configuration<br />
file , and you want send a non gzip content , for any reason ...<br />
<br />
To resolve it ,<br />
<br />
put this after your global call to ob_gzhandler <br />
<br />
include("conf_that_call_ob_gzhandler.php");<br />
--&gt;ob_end_clean();<br />
--&gt;header("Content-Encoding: none");<br />
<br />
If you try to overload the header before the the ob_gzhandler call<br />
or during the buffering output , it will not work .<br />
( probably erase at the call of ob_gzhandler&nbsp; and not allow during<br />
buffering ).<br />
<br />
Hope this help</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="22593""></a>
  <div class="note">
   <strong class="user">isoma at altavista dot net</strong>
   <a href="#22593" class="date">24-Jun-2002 07:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
RFC 2616 suggests that a more correct way to compress documents on the fly is to use gzip transfer encoding rather than gzip content encoding.&nbsp; &nbsp; However, it's perhaps not advisable to use this since client support for it is extremely limited.<br />
<br />
The difference is most evident when you come to save a file from your browser.&nbsp; If it's gzip content encoded then the browser should (and may well) save it gzipped.&nbsp; If it's gzip transfer encoded then the browser should uncompress it first.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="20704""></a>
  <div class="note">
   <strong class="user">xn at bnw dot com</strong>
   <a href="#20704" class="date">12-Apr-2002 08:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
if you call ob_end_clean() after ob_start("ob_gzhandler"), the "Content-Encoding: gzip" header will still get sent (assuming the browser supports the encoding).&nbsp; if you don't call ob_start() again with the ob_gzhandler callback function, the output will not be compressed, but the header will say it is.&nbsp; this causes mozilla (as of build 2002032808) to display a blank page.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="19573""></a>
  <div class="note">
   <strong class="user">junior at jaj dot com</strong>
   <a href="#19573" class="date">04-Mar-2002 10:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To get this to work properly, you have to compile PHP with "--with-zlib". If you don't, you won't get any errors, it just won't actually compress anything. This is a phenomenal thing. For just a small bit of processor time, you can DRASTICALLY reduce the bandwidth requirement of your scripts. There are very few circumstances in which this should not be used.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
