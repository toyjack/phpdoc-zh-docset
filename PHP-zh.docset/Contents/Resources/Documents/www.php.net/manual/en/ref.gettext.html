<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>Gettext 函数</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="gettext.constants.html">? 预定义常量</a></li>
      <li style="float: right;"><a href="function.bind-textdomain-codeset.html">bind_textdomain_codeset ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="book.gettext.html">Gettext</a></li>
    <li>Gettext 函数</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="ref.gettext" class="reference">
 <h1 class="title">Gettext 函数</h1>

 


















































<h2>Table of Contents</h2><ul class="chunklist chunklist_reference"><li><a href="function.bind-textdomain-codeset.html">bind_textdomain_codeset</a> &mdash; Specify or get the character encoding in which the messages from the DOMAIN message catalog will be returned</li><li><a href="function.bindtextdomain.html">bindtextdomain</a> &mdash; Sets or gets the path for a domain</li><li><a href="function.dcgettext.html">dcgettext</a> &mdash; Overrides the domain for a single lookup</li><li><a href="function.dcngettext.html">dcngettext</a> &mdash; Plural version of dcgettext</li><li><a href="function.dgettext.html">dgettext</a> &mdash; Override the current domain</li><li><a href="function.dngettext.html">dngettext</a> &mdash; Plural version of dgettext</li><li><a href="function.gettext.html">gettext</a> &mdash; Lookup a message in the current domain</li><li><a href="function.ngettext.html">ngettext</a> &mdash; Plural version of gettext</li><li><a href="function.textdomain.html">textdomain</a> &mdash; Sets the default domain</li></ul>
</div>
<div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="120159""></a>
  <div class="note">
   <strong class="user">richardbrinkman at hotmail dot com</strong>
   <a href="#120159" class="date">14-Nov-2016 11:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Gettext caches the machine readable *.mo files. This makes it pretty fast but also impossible to change a .mo file while running an application. Since PHP is running as a server, you cannot update your .mo file and see your new translation immediately. There are two ways to overcome this caching problem:<br />
<br />
1. Restart your webserver. For example by a `systemctl restart apache2`. This will kill already running php processes and reload them afterwards.<br />
<br />
2. If you don't have rights to restart a webserver (for example you are using a shared host), you can change the domain. Use for example this PHP code to hard link the new domain to the changed .mo files:<br />
<br />
$locale = "nl_NL.utf8"; //set this to your language<br />
setlocale(LC_ALL, $locale);<br />
putenv('LANG=' . $locale);<br />
$mtime = 0;<br />
$translationDir = "locale"; //or where ever you store your translations<br />
$originals = glob("$translationDir/*/LC_MESSAGES/messages.mo");<br />
foreach ($originals as $file)<br />
&nbsp;&nbsp;&nbsp; $mtime = max($mtime, filemtime($file));<br />
$domain = "messages_$mtime";<br />
$current = glob("$translationDir/*/LC_MESSAGES/$domain.mo");<br />
if (count($originals) != count($current)) {<br />
&nbsp;&nbsp;&nbsp; foreach (glob("$translationDir/*/LC_MESSAGES/messages_*.mo") as $file)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; unlink($file);<br />
&nbsp;&nbsp;&nbsp; foreach ($originals as $file)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; link($file, substr($file, 0, -3)."_$mtime.mo");<br />
}<br />
bindtextdomain($domain, $translationDir);<br />
textdomain($domain);<br />
<br />
What this script does is check whether at least one of the translations is updated and if so remove all messages_*.so and hard link all messages.po to corresponding messages_$mtime.po, where $mtime is set to the latest modified translation file. Since it uses a new domain ("messages_$mtime") it is not cached.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85411""></a>
  <div class="note">
   <strong class="user">analpaper{gmail}</strong>
   <a href="#85411" class="date">28-Aug-2008 02:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
in response to richard:<br />
i was using the wildcard * for sometime ago without problem, until today.<br />
<br />
i used:<br />
<span class="default">&lt;?php bindtextdomain</span><span class="keyword">( </span><span class="string">'*'</span><span class="keyword">, </span><span class="string">'./locale' </span><span class="keyword">); </span><span class="default">?&gt;<br />
</span>but it seems to fail under some environments (i dont know why, but in diff machines with same software the result is not always as expected)..<br />
<br />
then, with:<br />
<span class="default">&lt;?php bindtextdomain</span><span class="keyword">( </span><span class="string">"*"</span><span class="keyword">, </span><span class="string">'./locale' </span><span class="keyword">); </span><span class="default">?&gt;<br />
</span>all is nicely translated again.<br />
<br />
i use single quotes always if possible, now there are another think to remember.<br />
---<br />
live2code</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83335""></a>
  <div class="note">
   <strong class="user">Sbastien Ballest-Antich</strong>
   <a href="#83335" class="date">21-May-2008 06:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A workaround to use heredoc and gettext strings with sprintf :<br />
<span class="default">&lt;?php<br />
$hd </span><span class="keyword">= &lt;&lt;&lt;EOD<br />
</span><span class="string">&nbsp;&nbsp; &lt;p&gt;%s&lt;/p&gt;<br />
&nbsp;&nbsp; &lt;p&gt;%s&lt;/p&gt;<br />
</span><span class="keyword">EOD;<br />
</span><span class="default">$hdgt </span><span class="keyword">= </span><span class="default">sprintf</span><span class="keyword">(</span><span class="default">$hd</span><span class="keyword">, </span><span class="default">_</span><span class="keyword">(</span><span class="string">'Heredoc'</span><span class="keyword">), </span><span class="default">_</span><span class="keyword">(</span><span class="string">'gettext'</span><span class="keyword">));<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$hdgt</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81646""></a>
  <div class="note">
   <strong class="user">titan at phpdevshell dot org</strong>
   <a href="#81646" class="date">07-Mar-2008 11:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you would like to create a .po file with include heredoc scripts inside curly brackets {} solution is as follows;<br />
<br />
I want to translate what in here (test.php):<br />
&lt;code&gt;<br />
<span class="default">&lt;?php<br />
$EOF </span><span class="keyword">= &lt;&lt;&lt;EOF<br />
{</span><span class="default">$t</span><span class="keyword">-&gt;</span><span class="default">__</span><span class="keyword">(</span><span class="string">'I want to translate this string.'</span><span class="keyword">)}</span><span class="string"><br />
</span><span class="keyword">EOF;<br />
</span><span class="default">?&gt;<br />
</span>&lt;/code&gt;<br />
<br />
You will have to use the xgettext (gnu utility) with the Python parser like so:<br />
&lt;code&gt;<br />
$ xgettext --default-domain=test --keyword=__ --keyword --language=Python test.php<br />
&lt;/code&gt;<br />
<br />
The above terminal command might seem wrong with --keyword used twice, this is however correct.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76680""></a>
  <div class="note">
   <strong class="user">SEWilco</strong>
   <a href="#76680" class="date">25-Jul-2007 02:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
People have suggested several combinations of configuration options.&nbsp; Consider trying nested loops with various combinations of language names (with and without character set suffixes) and pathnames.&nbsp; A gettext() call in the middle of the loops can test for success (a string being translated).<br />
<br />
"Of 4374 localization setup variations tested there were 0 successes."<br />
<br />
Sometimes one just has to fix the system and PHP configuration.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74741""></a>
  <div class="note">
   <strong class="user">jon at nospam dot foo</strong>
   <a href="#74741" class="date">25-Apr-2007 03:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I'm sure I'll confuse further, but I feel compelled to chime in.&nbsp; I got stuck on this a bit...<br />
<br />
It's absolutely critical that your gettext installation supports the locale you are trying to use in your setlocale(LC_MESSAGES,$locale) call.<br />
<br />
This does not work:<br />
<br />
setlocale(LC_MESSAGES,"en");<br />
<br />
in OpenSUSE 10.2, because /usr/lib/locale does not contain the directory "en" (out of the box), even though your custom LC_MESSAGES domain location might.<br />
<br />
In OpenSUSE 10.2, at least, /usr/lib/locale contains for USA English:<br />
<br />
en_US<br />
en_US.iso885915<br />
en_US.utf8<br />
<br />
(again, not "en").<br />
<br />
It might be possible to set up an alias, I'm not sure (does anyone have a idea about this).<br />
<br />
My goal was to use HTTP_ACCEPT_LANGUAGE to set locale (I realize that locale != language, but it seems that gettext uses locale to assign language (scratches head) ).&nbsp; Opera in OS X does not send "en_US".&nbsp; However, Firefox does out of the box.&nbsp; I'm not sure if it's supposed to work this way, but it seems like it should, and so the way Opera handles this appears to be an issue.&nbsp; Incidentally, Safari simples send "en" in HTTP_ACCEPT_LANGUAGE, and will also not work.<br />
<br />
This compelled me to set a configurable default locale (e.g "en_US") in my PHP app, which one probably should do anyway, because HTTP_ACCEPT_LANGUAGE might be blank.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73376""></a>
  <div class="note">
   <strong class="user">jeremy at jeremy dot se dot nospam</strong>
   <a href="#73376" class="date">20-Feb-2007 11:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As some of you have mentioned, you must have the locales compiled on your system first. How this is done is depending on your system/distribution *sigh*<br />
<br />
In every case you need to have gettext installed on your system. Users running a Linux with a recent version of libc will have gettext in libc already.<br />
<br />
Here's an example for those of you running Ubuntu Edgy.<br />
<br />
First of all, have a look in /usr/share/i18n/SUPPORTED, here are the locales that are supported on your system. To compile a locale we will use the command "locale-gen". ("man 8 locale-gen" is good reading)<br />
<br />
This command reads configuration from files in the folder /var/lib/locales/supported.d/ In these files the locales and charsets are defined.<br />
<br />
If we take swedish as an example, start by creating a file called "sv" in /var/lib/locales/supported.d/ and then put in something like "sv_SE.UTF8 UTF8" (without the " ") This says that we want the locale sv_SE to be built with charmap UTF-8. Check the file /usr/share/i18n/SUPPORTED for other alternatives.<br />
<br />
Now we run "locale-gen" which will compile all locales defined in /var/lib/locales/supported.d/ and put them in /usr/lib/locales (yes that's a lot of locations...)<br />
<br />
Now you're ready to go...<br />
<br />
Create a php-file (e.g. hello.php) where all strings you want to translate are surrounded with _("string here");<br />
<br />
next run "xgettext hello.php", this creates a file called messages.po, which is you translation-file (pot). Change the "Content-Type: text/plain; charset=CHARSET\n" in this file and replace CHARSET with UTF-8 in this case. Next translate all strings like this.<br />
<br />
#: hello.php:3<br />
msgid "hello!"<br />
msgstr "hej!"<br />
<br />
Save and use the command "msgfmt -o hello.mo messages.po" which will create a compiled .mo file called hello.mo<br />
<br />
This file is then placed in a directory structure somewhere your Apache can read it. The structure looks like this:<br />
<br />
"locale/sv/LC_MESSAGES/hello.mo"<br />
<br />
Next, let php know what we're doing. We point to where we have our translations. Add the following at the top of hello.php<br />
<br />
bindtextdomain('hello','/somepath/locale');<br />
<br />
This binds the file hello.mo to the locale/ directory you created.<br />
Then set the locale. LC_ALL tells that we want everything translated. Might not be good at all times, as another person here suggested.<br />
<br />
setlocale(LC_ALL, "sv_SE.UTF-8");<br />
<br />
Finally select the that we want to use hello.mo <br />
<br />
textdomain('hello');<br />
<br />
That should be it! Try it out..<br />
<br />
If you get any problems try restarting Apache as it seems to cache the locales.<br />
<br />
If you are running command line you might have to set the environment variable LANGUAGE to your locale as well. I didn't have to do that to get it working in apache though, but you might...<br />
<br />
putenv("LANGUAGE=sv_SE.UTF-8");</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="70849""></a>
  <div class="note">
   <strong class="user">djogopatrao at gmail dot com</strong>
   <a href="#70849" class="date">31-Oct-2006 03:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Juan Liska, I found an alternative. Instead of renaming or adding a alias to the locale, I simply changed <br />
<br />
$language = 'pt_BR';<br />
<br />
to<br />
<br />
$language = 'pt_BR.UTF-8';<br />
putenv("LANG=$language"); <br />
setlocale(LC_ALL, $language)<br />
<br />
and it did work fine!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="70316""></a>
  <div class="note">
   <strong class="user">konrads/smelkovs/gmail/com</strong>
   <a href="#70316" class="date">11-Oct-2006 07:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
re LC_MESSAGES for windows users, LC_MESSAGES should be defi0ned as 5</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68853""></a>
  <div class="note">
   <strong class="user">C Snover</strong>
   <a href="#68853" class="date">13-Aug-2006 04:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I think that it bears mentioning that most documentation and tutorials you will find say that you should setenv(LC_ALL, $locale), but this only works IF THE LOCALE IS VALID ON THE LOCAL MACHINE. If you are using a locale that does not exist on the system or is not valid (like something returned from the HTTP Accept-Language header, such as 'ja', which is never a valid locale because it does not include the country code JP), you will probably be pulling your hair out for HOURS trying to figure out why the damn thing isn't working.<br />
<br />
What I have found is that setting the LANGUAGE variable (eg. setenv("LANGUAGE=$locale")) will allow gettext to search inside your locale directories, even if the locale is not actually valid on the local system.<br />
<br />
So, to summarize:<br />
<br />
This will work:<br />
<span class="default">&lt;?php<br />
$locale </span><span class="keyword">= </span><span class="string">'ja'</span><span class="keyword">; </span><span class="comment">// Pretend this came from the Accept-Language header<br />
</span><span class="default">$locale_dir </span><span class="keyword">= </span><span class="string">'./locale'</span><span class="keyword">; </span><span class="comment">// your .po and .mo files should be at $locale_dir/$locale/LC_MESSAGES/messages.{po,mo}<br />
<br />
</span><span class="default">putenv</span><span class="keyword">(</span><span class="string">"LANGUAGE=</span><span class="default">$locale</span><span class="string">"</span><span class="keyword">);<br />
</span><span class="default">bindtextdomain</span><span class="keyword">(</span><span class="string">'messages'</span><span class="keyword">, </span><span class="default">$locale_dir</span><span class="keyword">);<br />
</span><span class="default">textdomain</span><span class="keyword">(</span><span class="string">'messages'</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
This will not work:<br />
<span class="default">&lt;?php<br />
$locale </span><span class="keyword">= </span><span class="string">'ja'</span><span class="keyword">;<br />
</span><span class="default">$locale_dir </span><span class="keyword">= </span><span class="string">'./locale'</span><span class="keyword">;<br />
<br />
</span><span class="default">putenv</span><span class="keyword">(</span><span class="string">"LC_ALL=</span><span class="default">$locale</span><span class="string">"</span><span class="keyword">);<br />
</span><span class="default">bindtextdomain</span><span class="keyword">(</span><span class="string">'messages'</span><span class="keyword">, </span><span class="default">$locale_dir</span><span class="keyword">);<br />
</span><span class="default">textdomain</span><span class="keyword">(</span><span class="string">'messages'</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
This will also not work:<br />
<span class="default">&lt;?php<br />
$locale </span><span class="keyword">= </span><span class="string">'ja'</span><span class="keyword">;<br />
</span><span class="default">$locale_dir </span><span class="keyword">= </span><span class="string">'./locale'</span><span class="keyword">;<br />
<br />
</span><span class="default">setlocale</span><span class="keyword">(</span><span class="default">LC_ALL</span><span class="keyword">, </span><span class="default">$locale</span><span class="keyword">);<br />
</span><span class="default">bindtextdomain</span><span class="keyword">(</span><span class="string">'messages'</span><span class="keyword">, </span><span class="default">$locale_dir</span><span class="keyword">);<br />
</span><span class="default">textdomain</span><span class="keyword">(</span><span class="string">'messages'</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Nor will this work:<br />
<span class="default">&lt;?php<br />
$locale </span><span class="keyword">= </span><span class="string">'ja'</span><span class="keyword">;<br />
</span><span class="default">$locale_dir </span><span class="keyword">= </span><span class="string">'./locale'</span><span class="keyword">;<br />
<br />
</span><span class="default">setlocale</span><span class="keyword">(</span><span class="default">LC_MESSAGES</span><span class="keyword">, </span><span class="default">$locale</span><span class="keyword">);<br />
</span><span class="default">bindtextdomain</span><span class="keyword">(</span><span class="string">'messages'</span><span class="keyword">, </span><span class="default">$locale_dir</span><span class="keyword">);<br />
</span><span class="default">textdomain</span><span class="keyword">(</span><span class="string">'messages'</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
For reference, this was tested on PHP 5.1.2 + LigHTTPd 1.4.11 + gettext 0.14.5 on Ubuntu Dapper 6.06. It should be true for any variant of Linux, however, as well as older versions of these software packages.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68124""></a>
  <div class="note">
   <strong class="user">richard at hirner dot at</strong>
   <a href="#68124" class="date">13-Jul-2006 04:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
the * wildcard doesn't work for me (php 5)... I have to use bindtextdomain for each textdomain</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="66405""></a>
  <div class="note">
   <strong class="user">webmaster [at] ttw [dash] tool [dot] de</strong>
   <a href="#66405" class="date">21-May-2006 04:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to use messages from multiple domains with .mo-files residing in non-standard locations remember to place a bindtextdomain()-call for each domain as "unbound" domains will be looked for in the standard location (usually "/usr/share/locale" on *nix)<br />
<br />
<span class="default">&lt;?php<br />
<br />
&nbsp;&nbsp;&nbsp; bindtextdomain</span><span class="keyword">(</span><span class="string">'foo'</span><span class="keyword">,</span><span class="string">'/some/dir/with/mo_files'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">bindtextdomain</span><span class="keyword">(</span><span class="string">'bar'</span><span class="keyword">,</span><span class="string">'/another/mo_file/dir'</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">dgettext</span><span class="keyword">(</span><span class="string">'foo'</span><span class="keyword">,</span><span class="string">'Text to be translated using the foo-catalog.'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">dgettext</span><span class="keyword">(</span><span class="string">'bar'</span><span class="keyword">,</span><span class="string">'Text from a different catalog named bar.'</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
If all the .mo-files you are using reside in one and the same directory, you may use the "*"-wildcard like this:<br />
<br />
<span class="default">&lt;?php<br />
<br />
&nbsp;&nbsp;&nbsp; bindtextdomain</span><span class="keyword">(</span><span class="string">'*'</span><span class="keyword">,</span><span class="string">'/directory/with/all/mo_files'</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
This code was tested on PHP 5.1.4</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="64693""></a>
  <div class="note">
   <strong class="user">info at adaniels dot nl</strong>
   <a href="#64693" class="date">19-Apr-2006 12:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As stated by robert at klugher dot com:<br />
The environment setting 'LANGUAGE' gets priority above any local setting. This means that changing LC_ALL/LC_MESSAGES and LANG as done in almost all examples, won't do anything.<br />
<br />
So if you've done<br />
<span class="default">&lt;?php&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; $language </span><span class="keyword">= </span><span class="string">"nl_NL"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">putenv</span><span class="keyword">(</span><span class="string">"LANG=</span><span class="default">$language</span><span class="string">"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">setlocale</span><span class="keyword">(</span><span class="default">LC_ALL</span><span class="keyword">, </span><span class="default">$language</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; ...<br />
</span><span class="default">?&gt;<br />
</span>but the text is still displayed in english. Try also setting the LANGUAGE variable.<br />
<span class="default">&lt;?php&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; $language </span><span class="keyword">= </span><span class="string">"nl_NL"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">putenv</span><span class="keyword">(</span><span class="string">"LANGUAGE=</span><span class="default">$language</span><span class="string">"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">putenv</span><span class="keyword">(</span><span class="string">"LANG=</span><span class="default">$language</span><span class="string">"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">setlocale</span><span class="keyword">(</span><span class="default">LC_ALL</span><span class="keyword">, </span><span class="default">$language</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; ...<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="63718""></a>
  <div class="note">
   <strong class="user">birkholz at web dot de</strong>
   <a href="#63718" class="date">28-Mar-2006 09:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
&gt; stefan+usenet at froehlich dot priv dot at wrote at 5-May-2004 01:30:<br />
&gt; Reading the line<br />
&gt; <br />
&gt; &lt;? php setlocale(LC_ALL, 'de_DE'); ?&gt;<br />
&gt; <br />
&gt; here over and over again, I have to warn using it, as there are severe caveats.<br />
&gt; For certain locales, LC_NUMERIC swaps period and comma, which may e.g. lead to<br />
&gt; decimals silently stripped of numbers, when inserting rows into an SQL database.<br />
&gt;So DON'T do this, but use<br />
&gt;<br />
&gt; &lt;? php setlocale(LC_MESSAGES, 'de_DE'); ?&gt;<br />
&gt;<br />
&gt; instead, which does exactly what you want, without any nasty side effecs.<br />
<br />
For all Windows-Users:<br />
Be warned the LC_MESSAGES seems to be NOT set on Windows with PHP 5.1.2, so if you develope applications for a Linux-System and want to make it multi-language using gettext, you will get problems using LC_MESSAGES on your Windows-Developement-Box.<br />
You can try to solve this problem by putting a <br />
<br />
<span class="default">&lt;?php </span><span class="keyword">if (!</span><span class="default">defined</span><span class="keyword">(</span><span class="string">'LC_MESSAGES'</span><span class="keyword">)) </span><span class="default">define</span><span class="keyword">(</span><span class="string">'LC_MESSAGES'</span><span class="keyword">, </span><span class="default">6</span><span class="keyword">); </span><span class="default">?&gt;<br />
</span><br />
to your script to get no warning if you pass LC_MESSAGES to the setlocale()-function.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="58781""></a>
  <div class="note">
   <strong class="user">Juan Liska</strong>
   <a href="#58781" class="date">15-Nov-2005 03:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
if you're having trouble with setlocale (if it's returning false) on ubuntu or debian:<br />
<br />
nano /etc/locale.gen<br />
<br />
make sure that the locales taht you want are in the list, if not, add them. for instance, i wanted es_GT (b/c i have an app that must run on redhat and debian, i cant change to es_GT.UTF-8) so, add:<br />
<br />
es_GT UTF-8<br />
<br />
then run:<br />
<br />
locale-gen <br />
<br />
you now have the locales you want, not just the ones the system magically came with</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="53693""></a>
  <div class="note">
   <strong class="user">milky#users:sf/net</strong>
   <a href="#53693" class="date">09-Jun-2005 06:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There exists an emulation for the gettext functions - obviously slower than the native binding, but can be used on shared servers which lack the extension. It is believed to be rather useful as fallback (comes already encapsulated with if-function_exists checks).<br />
See the ext/ directory in the [ <a href="http://freshmeat.net/p/upgradephp ] tarball.&nbsp; Support for plural translations isn" rel="nofollow" target="_blank">http://freshmeat.net/p/upgradephp ] tarball.&nbsp; Support for plural translations isn</a>'t there, because that is too hard to get reimplemented reliably.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="52956""></a>
  <div class="note">
   <strong class="user">tucsi at c2 dot hu</strong>
   <a href="#52956" class="date">18-May-2005 04:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If your gettext translation does not work in safe mode, than try to set this in the php.ini:<br />
safe_mode_allowed_env_vars = PHP_,LANG</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="52290""></a>
  <div class="note">
   <strong class="user">Maxwel Leite -maxwelleite at gmail com-</strong>
   <a href="#52290" class="date">27-Apr-2005 12:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
PHP-gettext is developed to be able to read gettext MO files directly, without requiring anything other than PHP:<br />
https://savannah.nongnu.org/projects/php-gettext/</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="51413""></a>
  <div class="note">
   <strong class="user">elonen at iki dot fi</strong>
   <a href="#51413" class="date">30-Mar-2005 01:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For making localized copies of PHP files (statical l10n), here's a GPL'd command line tool: <a href="http://iki.fi/elonen/code/pophorator/" rel="nofollow" target="_blank">http://iki.fi/elonen/code/pophorator/</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="50424""></a>
  <div class="note">
   <strong class="user">dpatton at confluence dot org</strong>
   <a href="#50424" class="date">27-Feb-2005 10:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Make sure you check your webserver configuration before deciding to use gettext, because if you are running in a multi-threaded environment you should not use gettext, as it is not thread-safe.<br />
<br />
A future version of gettext(possibly 0.15) may be thread-safe.<br />
Any gettext dependencies, such as glibc would also need to be thread-safe.<br />
<br />
Apache 1.3 on Unix generally is non-threaded, but on Windows it is multithreaded.<br />
Apache 2.0 has support for MPMs(Multi-Processing Modules), some of which support multiple threads:<br />
<a href="http://httpd.apache.org/docs-2.0/mpm.html" rel="nofollow" target="_blank">http://httpd.apache.org/docs-2.0/mpm.html</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="43165""></a>
  <div class="note">
   <strong class="user">zixia at zixia dot net</strong>
   <a href="#43165" class="date">11-Jun-2004 02:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If gettext does not work with your locale, ie 'zh_CN', just going to see if the output of command "localedef --list-archive" contains your locale('zh_CN' in this example).<br />
If it not, try to use a exist locale or use "localedef" to create one: "localedef -f GBK -i zh_CN zh_CN" in my case.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="43127""></a>
  <div class="note">
   <strong class="user">mikolaj at webgate dot bg</strong>
   <a href="#43127" class="date">10-Jun-2004 04:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
winXP, PHP 4.3.5 as Apache1.3.29 module<br />
<br />
Two hints for Windows users.<br />
<br />
I found setting locale is neither sufficient nor nessecery. To get it work I needed to set either LC_ALL or LANG enviroment variable to my locale. Anyway this value must be proper for setlocale so it is good to test with it. In my case it was bgr_BGR for bulgarian according to <a href="http://www.unicode.org/onlinedat/countries.html" rel="nofollow" target="_blank">http://www.unicode.org/onlinedat/countries.html</a><br />
<br />
gettext checks for files once and keeps them in cashe. Especially it means that if it doesn't find your files it won't search again, so restart Apache after any directory changes!! <br />
<br />
My minimal working script:<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// translation file: D:\Apache\htdocs\mypage\locale\bgr_BGR\LC_MESSAGES\messages.mo<br />
</span><span class="default">putenv</span><span class="keyword">(</span><span class="string">"LC_ALL=bgr_BGR"</span><span class="keyword">);<br />
</span><span class="default">bindtextdomain</span><span class="keyword">(</span><span class="string">'messages'</span><span class="keyword">, </span><span class="string">'D:\Apache\htdocs\mypage\locale\\'</span><span class="keyword">);<br />
echo </span><span class="default">gettext</span><span class="keyword">(</span><span class="string">"Hello"</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="42142""></a>
  <div class="note">
   <strong class="user">stefan+usenet at froehlich dot priv dot at</strong>
   <a href="#42142" class="date">05-May-2004 04:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Reading the line<br />
<br />
&lt;? php setlocale(LC_ALL, 'de_DE'); ?&gt;<br />
<br />
here over and over again, I have to warn using it, as there are severe caveats. For certain locales, LC_NUMERIC swaps period and comma, which may e.g. lead to decimals silently stripped of numbers, when inserting rows into an SQL database. So DON'T do this, but use<br />
<br />
&lt;? php setlocale(LC_MESSAGES, 'de_DE'); ?&gt;<br />
<br />
instead, which does exactly what you want, without any nasty side effecs.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="42109""></a>
  <div class="note">
   <strong class="user">kocio at irc dot pl</strong>
   <a href="#42109" class="date">03-May-2004 03:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Following three lines take about 0.5 second to execute (Debian, Celeron 2GHz, 256MB RAM):<br />
<br />
setlocale(LC_ALL, 'pl_PL'); <br />
bindtextdomain('my_domain', '../dir/' . 'locale'); <br />
textdomain('my_domain'); <br />
<br />
I think that such delay is important enough to be mentioned in the documentation. In my particular case, it means more than doubled execution time for the entire script.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="35304""></a>
  <div class="note">
   <strong class="user">dev.php at tfelber.net</strong>
   <a href="#35304" class="date">26-Aug-2003 07:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Check your <br />
<br />
/etc/locales.aliases for "english en_GB.ISO-8859-1" (mentioned before) <br />
<br />
and your<br />
<br />
/etc/locales.gen for en_GB.ISO-8859-15 ISO-8859-15 <br />
<br />
I'm not sure if only this entry solved the problem. In my case this entry was made by an dpkg-reconfigure locales (debian), where i created the locales.<br />
<br />
Translation only works with de_GE@euro and&nbsp; en_GB.ISO-8859-15 (first column in you locales.gen)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="34967""></a>
  <div class="note">
   <strong class="user">wouter at grep dot be</strong>
   <a href="#34967" class="date">13-Aug-2003 12:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Of course, translation is only interesting if you provide the user with the language and encoding he asks for. Since there's part of the HTTP protocol that allows you to specify that, it's nice if one can use that information to pick the 'right' translation out of the ones you have available.<br />
<br />
I wrote something that does just that -- it parses the 'Accept-Language' and 'Accept-Charset' HTTP/1.1 headers, and tells you which one the user prefers out of a list you provide. You can download it at <a href="http://www.grep.be/articles/php-accept.php" rel="nofollow" target="_blank">http://www.grep.be/articles/php-accept.php</a><br />
<br />
Note that even if the user's browser may support this, the user may not know about it; as such, it's probably good practice not to remove links to other-languaged versions, so that people can still get a version of your site in another language if they so prefer.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="34022""></a>
  <div class="note">
   <strong class="user">jc</strong>
   <a href="#34022" class="date">14-Jul-2003 01:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I had a lot of problems getting gettext to work (RedHat 7.3). After reading ALL the comments in this manual, I got it to work OK.<br />
<br />
In summary, take care that:<br />
<br />
1) You use a full locale in the setlocale()<br />
2) Your language_country exists in the /usr/share/locale/locale.alias<br />
3) It seems that Apache needs to be restarted (a "graceful" did the trick for me)<br />
4) Your .mo files must be named after the domain<br />
<br />
My code:<br />
<br />
$language = "es_ES";<br />
$locale = setlocale(LC_ALL, $language);<br />
<br />
$gettext_domain = 'messages';<br />
bindtextdomain($gettext_domain, "/full/path/to/locale");<br />
textdomain($gettext_domain);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="33159""></a>
  <div class="note">
   <strong class="user">anim8</strong>
   <a href="#33159" class="date">17-Jun-2003 06:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Even though in some cases setlocale() may require a country code in addition to the language code this does not mean that it is required for gettext. <br />
<br />
If setlocale() is set to either es_ES or es_MX gettext() will still get the text from a po file in the 'es' folder.<br />
<br />
It probably is not a good idea to go changing a systems alias file(s) just to avoid the verbosity of the ISO standard because:<br />
&nbsp; a) you might break something <br />
&nbsp; b) your code just lost it's portability<br />
<br />
.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="33021""></a>
  <div class="note">
   
   <a href="#33021" class="date">13-Jun-2003 07:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The way I got gettext to work with just a standard "de" or "fr" instead of "de_DE" was I overwrote my /usr/share/locale/locale.alias with /usr/lib/X11/locale/locale.alias file.&nbsp; The I restarted Apache.&nbsp; Reason I did this was it appeared the X11 file was more up to date and more modernised!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="32833""></a>
  <div class="note">
   <strong class="user">Picco</strong>
   <a href="#32833" class="date">08-Jun-2003 10:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note to Chinese programmers....<br />
<br />
Took me hours to figure out you cannot use<br />
<br />
LANG=zh<br />
but have to use<br />
LANG=zh_TW <br />
on some machines...<br />
<br />
a good way to test will be to check the return of setlocale()</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="29790""></a>
  <div class="note">
   <strong class="user">robert at klugher dot com</strong>
   <a href="#29790" class="date">25-Feb-2003 05:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
One trick I found after HOURS of tries :<br />
<br />
when you use the setlocale(), PHP will use the locale info it will find in, for example, /usr/share/locale to set the language info for LC_ALL, LC_MESSAGES, ...<br />
<br />
You can check the exact info it will use by using putenv() with LANG=.... and looking at the return value of setlocale(LC_ALL, ""). The language value your gettext function will use to look for your translation file is the one given for LC_MESSAGES.<br />
<br />
Example :<br />
<br />
I was setting the LANG as fr_BE, and placed the translation file in dirxxx/locale/fr_BE/LC_MESSAGES/...<br />
As it was locale info in my system for fr_BE but NOT LC_MESSAGES, PHP choosed to use the LC_MESSAGES settings for fr_FR instead and then, was looking for a translation file in dirxxx/locale/fr_FR/LC_MESSAGES/..., which wasn't found of course.<br />
<br />
So, just make sure to look at the return value of setlocale to see what language value is associated to LC_MESSAGES and, then, to know in which subdirectory the translation file will be looked for by gettext.<br />
<br />
Robert</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="28999""></a>
  <div class="note">
   <strong class="user">php at zpod dot ca</strong>
   <a href="#28999" class="date">29-Jan-2003 07:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For those of you just trying to get a script working and your provider doesn't support gettext, you can bypass the international stuff by adding this:<br />
<br />
function _($str) {<br />
&nbsp;&nbsp;&nbsp; return $str;<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="28542""></a>
  <div class="note">
   <strong class="user">Eneko Lacunza enlar at enlar dot net</strong>
   <a href="#28542" class="date">16-Jan-2003 08:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Some tips from my Red Hat Linux 7.3 system.<br />
<br />
It didn't work for me until I set a full locale (i.e. es_ES) with setlocale.<br />
<br />
I was trying with Michele Manzato's example (thank you!), but as it sets the language without the country, it was failing for me. Here is the example "fixed" with full locale:<br />
<br />
// Change to script directory<br />
// (Not needed in RH 7.3)<br />
$path = dirname(getenv(PATH_TRANSLATED));<br />
chdir($path);<br />
<br />
// Set the language as full locale 'es_ES'<br />
$language = 'es_ES';<br />
putenv("LANG=$language");<br />
setlocale(LC_ALL, $language);<br />
<br />
// Set the text domain as 'mydomain'<br />
$domain = 'mydomain';<br />
bindtextdomain("$domain", "./locale");<br />
textdomain("$domain");<br />
<br />
// The .mo file searched is:<br />
// ./locale/es_ES/LC_MESSAGES/mydomain.mo<br />
// or if previous one doesn't exist:<br />
// ./locale/es/LC_MESSAGES/mydomain.mo<br />
<br />
echo gettext("Hello world!"); <br />
<br />
Hope this helps!<br />
Eneko.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="22615""></a>
  <div class="note">
   <strong class="user">php at dynaperl dot com</strong>
   <a href="#22615" class="date">25-Jun-2002 06:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you install from SuSE Dist. you need glibc-locale.rpm to let gettext work.
<br />

<br />
mfg ralph.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="22052""></a>
  <div class="note">
   <strong class="user">mgvNOSPAM at fx dot ro</strong>
   <a href="#22052" class="date">04-Jun-2002 07:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you're as clueless as I am, please note the following:<br />
1. Although most comments list setlocal() in the code, that's not actually required for translations - read the docs under "string functions" for details (also, the official gettext() examples don't include it);<br />
2. hace_x's example is really cool, except you need to know that all "n"'s at the end of his strings should have a backslash before - they're actually EOL characters, but they somehow got messed up and I needed two hours to find that out...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="15502""></a>
  <div class="note">
   <strong class="user">Michele dot Manzato at verona dot miz dot it</strong>
   <a href="#15502" class="date">14-Sep-2001 03:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Gettext is great, but there are a few caveats you have to consider in order to make it work. Unfortunately the gettext docs isn't so plain and clear...
<br />

<br />
The .mo file created with the gettext utilities must be:
<br />

<br />
[bindtextdomain's dir]/[language]/LC_MESSAGES/[domain].mo
<br />

<br />
otherwise gettext() function will fail to find it (this is true in win32, don't know about Un*ces). By the way you don't get any error message, the strings will simply remain untranslated. 
<br />

<br />
Second, you must make sure which is the current directory if you use a relative path in bindtextdomain. On some systems the script directory isn't the current directory, so you have to chdir() there.
<br />

<br />
Then, of course, make sure that the appropriate gettext extension are loaded by PHP by looking at the php configuration file.
<br />

<br />
Here is some sample code:
<br />

<br />
// Change to the script directory
<br />
$path = dirname(getenv(PATH_TRANSLATED));
<br />
chdir($path);
<br />

<br />
// Set the language as 'it'
<br />
$language = 'it';
<br />
putenv("LANG=$language"); 
<br />
setlocale(LC_ALL, $language);
<br />

<br />
// Set the text domain as 'mydomain'
<br />
$domain = 'mydomain';
<br />
bindtextdomain("$domain", "./locale"); 
<br />
textdomain("$domain");
<br />

<br />
// The .mo file searched is:
<br />
// ./locale/it/LC_MESSAGES/mydomain.mo
<br />

<br />
echo gettext("Hello world!");
<br />

<br />
Have fun!
<br />
Michele</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="13949""></a>
  <div class="note">
   
   <a href="#13949" class="date">11-Jul-2001 05:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It is probably obvious to many of you,&nbsp; but I thought it was worth mentioning that the domain is the name of the .mo files that contain the string catalogue (without the extension).
<br />

<br />
so if you have a catalogue myPage.mo for each page in './locale/lg/LC_MESSAGE' and some generic catalogues (e.g. errorMsg.mo) in '/global/locale/lg/LC_MESSAGE', you can do
<br />

<br />
bindTextDomain("$myPage", './locale');
<br />
bindTextDomain('errorMsg','/global/locale' );
<br />
textDomain('myPage');
<br />
print(getText('Welcome'));
<br />
/.../
<br />
if($err)printf(dGetText('errorMsg','you have an error here'));
<br />

<br />
Ivan</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
