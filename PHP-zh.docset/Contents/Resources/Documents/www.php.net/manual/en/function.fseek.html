<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>在文件指针中定位</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.fscanf.html">? fscanf</a></li>
      <li style="float: right;"><a href="function.fstat.html">fstat ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.filesystem.html">文件系统函数</a></li>
    <li>在文件指针中定位</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.fseek" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">fseek</h1>
  <p class="verinfo">(PHP 4, PHP 5, PHP 7)</p><p class="refpurpose"><span class="refname">fseek</span> &mdash; <span class="dc-title">在文件指针中定位</span></p>

 </div>
 
  <div class="refsect1 description" id="refsect1-function.fseek-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>fseek</strong></span>
    ( <span class="methodparam"><span class="type">resource</span> <code class="parameter">$handle</code></span>
   , <span class="methodparam"><span class="type">int</span> <code class="parameter">$offset</code></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$whence</code><span class="initializer"> = SEEK_SET</span></span>
  ] ) : <span class="type">int</span></div>

  <p class="para rdfs-comment">
   在与
   <code class="parameter">handle</code>
   关联的文件中设定文件指针位置。
   新位置从文件头开始以字节数度量，是以
   <code class="parameter">whence</code>
   指定的位置加上
   <code class="parameter">offset</code>。
  </p>
  <p class="para">
   In general, it is allowed to seek past the end-of-file; if data is then
   written, reads in any unwritten region between the end-of-file and the
   sought position will yield bytes with value 0. However, certain streams
   may not support this behavior, especially when they have an underlying
   fixed size storage.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.fseek-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">handle</code></dt>

     <dd>

      <p class="para">文件系统指针，是典型地由
<span class="function"><a href="function.fopen.html" class="function">fopen()</a></span> 创建的 <span class="type"><a href="language.types.resource.html" class="type resource">resource</a></span>(资源)。</p>
     </dd>

    
    
     <dt>
<code class="parameter">offset</code></dt>

     <dd>

      <p class="para">
       偏移量。
      </p>
      <p class="para">
       要移动到文件尾之前的位置，需要给
    <code class="parameter">offset</code> 传递一个负值，并设置 <code class="parameter">whence</code>
       为 <strong><code>SEEK_END</code></strong>。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">whence</code></dt>

     <dd>

      <p class="para">
       <code class="parameter">whence</code> values are:
       <ul class="simplelist">
        <li class="member"><strong><code>SEEK_SET</code></strong> - 设定位置等于 <code class="parameter">offset</code> 字节。</li>
        <li class="member"><strong><code>SEEK_CUR</code></strong> - 设定位置为当前位置加上 <code class="parameter">offset</code>。</li>
        <li class="member"><strong><code>SEEK_END</code></strong> - 设定位置为文件尾加上
    <code class="parameter">offset</code>。</li>
       </ul>
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


  <div class="refsect1 returnvalues" id="refsect1-function.fseek-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
    成功则返回 0；否则返回 -1。注意移动到 EOF 之后的位置不算错误。
  </p>
 </div>

 
 <div class="refsect1 examples" id="refsect1-function.fseek-examples">
  <h3 class="title">范例</h3>
  <p class="para">
   <div class="example" id="example-2839">
    <p><strong>Example #1 <span class="function"><strong>fseek()</strong></span> 例子</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br />$fp&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">fopen</span><span style="color: #007700">(</span><span style="color: #DD0000">'somefile.txt'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'r'</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;read&nbsp;some&nbsp;data<br /></span><span style="color: #0000BB">$data&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">fgets</span><span style="color: #007700">(</span><span style="color: #0000BB">$fp</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">4096</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;move&nbsp;back&nbsp;to&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;file<br />//&nbsp;same&nbsp;as&nbsp;rewind($fp);<br /></span><span style="color: #0000BB">fseek</span><span style="color: #007700">(</span><span style="color: #0000BB">$fp</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 notes" id="refsect1-function.fseek-notes">
  <h3 class="title">注释</h3>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    如果使用附加模试（<em>a</em> 或 <em>a+</em>），任何写入文件数据都会被附加上去，而文件的位置将会被忽略，调用 <span class="function"><strong>fseek()</strong></span> 的结果尚未定义。
   </p>
  </p></blockquote>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    Not all streams support seeking. For those that do not support seeking,
    forward seeking from the current position is accomplished by reading
    and discarding data; other forms of seeking will fail.
   </p>
  </p></blockquote>
 </div>

 
  <div class="refsect1 seealso" id="refsect1-function.fseek-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.ftell.html" class="function" rel="rdfs-seeAlso">ftell()</a> - 返回文件指针读/写的位置</span></li>
    <li class="member"><span class="function"><a href="function.rewind.html" class="function" rel="rdfs-seeAlso">rewind()</a> - 倒回文件指针的位置</span></li>
   </ul>
  </p>
 </div>

 
</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="119511""></a>
  <div class="note">
   <strong class="user">marin at sagovac dot com</strong>
   <a href="#119511" class="date">26-Jun-2016 01:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Seek to a line of code than break from while to improve performance. Seek to specific line using SEEK_SET and get a specific line. If $range is '0' than will show seeked line. If set to '2' it will show current line + 2 lines above + 2 lines below.<br />
<br />
Useful for get a content of a file in very huge file to get lines range. To improve performance a while loop breaks from iteration than go for seeking.<br />
<br />
I've created a function that read a file and count lines and store into arrays each lines bytes to seek. If maximum specified by `linenum` is set, it will break from while to keep performance than in a new loop function to seek a position in bytes to get a content of file.<br />
<br />
&nbsp;&nbsp;&nbsp; function readFileSeek($source, $linenum = 0, $range = 0)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $fh = fopen($source, 'r');<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $meta = stream_get_meta_data($fh);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!$meta['seekable']) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; throw new Exception(sprintf("A source is not seekable: %s", print_r($source, true)));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $pos = 2;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $result = null;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ($linenum) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $minline = $linenum - $range - 1;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $maxline = $minline+$range+$range;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $totalLines = 0;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while (!feof($fh)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $char = fgetc($fh);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($char == "\n" || $char == "\r") {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ++$totalLines;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $result[$totalLines] = $pos;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $pos++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($maxline+1 == $totalLines) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // break from while to not read entire file<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $buffer = '';<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for ($nr=$minline; $nr&lt;=$maxline; $nr++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (isset($result[$nr])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; fseek($fh, $result[$nr], SEEK_SET);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; while (!feof($fh)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $char = fgetc($fh);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($char == "\n" || $char == "\r") {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $buffer .= $char;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $buffer .= $char;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return $buffer;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
Test results (1.3 GB file, 100000000 lines of codes, seek to 300000 line a code):<br />
<br />
&nbsp;&nbsp;&nbsp; string(55) "299998_abc<br />
&nbsp;&nbsp;&nbsp; 299999_abc<br />
&nbsp;&nbsp;&nbsp; 300000_abc<br />
&nbsp;&nbsp;&nbsp; 300001_abc<br />
&nbsp;&nbsp;&nbsp; 300002_abc<br />
&nbsp;&nbsp;&nbsp; "<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; Time: 612 ms, Memory: 20.00Mb<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; $ ll -h /tmp/testfile<br />
&nbsp;&nbsp;&nbsp; -rw-rw-r-- 1&nbsp; 1,3G /tmp/testfile</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="115516""></a>
  <div class="note">
   <strong class="user">synnus at gmail dot com</strong>
   <a href="#115516" class="date">07-Aug-2014 03:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Write Dummy File 4GB in Php 32bits (X86)<br />
if you want write more GB File (&gt;4GB), use Php(X64) .<br />
this file is created in 0.0041329860687256 second<br />
<br />
CreatFileDummy('data_test.txt',4294967296);<br />
<br />
FUNCTION CreatFileDummy($file_name,$size) {&nbsp; &nbsp; <br />
// 32bits 4&nbsp;294&nbsp;967&nbsp;296 bytes MAX Size <br />
&nbsp;&nbsp;&nbsp; $f = fopen($file_name, 'wb');<br />
&nbsp;&nbsp;&nbsp; if($size &gt;= 1000000000)&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $z = ($size / 1000000000);&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (is_float($z))&nbsp; { <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $z = round($z,0);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; fseek($f, ( $size - ($z * 1000000000) -1 ), SEEK_END);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; fwrite($f, "\0");<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while(--$z &gt; -1) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; fseek($f, 999999999, SEEK_END);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; fwrite($f, "\0");<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; } <br />
&nbsp;&nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; fseek($f, $size - 1, SEEK_END);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; fwrite($f, "\0");<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; fclose($f);<br />
<br />
Return true;<br />
}<br />
<br />
Synx</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="114396""></a>
  <div class="note">
   <strong class="user">lexica98 at gmail dot com</strong>
   <a href="#114396" class="date">15-Feb-2014 05:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Opening the file in a+ mode doesn't work with fseek either, unfortunately. If you want a file created and then want be able to go to any position in the file, you'll have to use append mode when opening the file, then close it, then open it again in r+.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="112647""></a>
  <div class="note">
   <strong class="user">me at php dot net</strong>
   <a href="#112647" class="date">09-Jul-2013 09:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
how to read BIG files using fseek (above 2GB+, upto any size like 4GB+, 100GB+, 100 terabyes+, any file size, 100 petabytes, max limit is php_float_max ) ?<br />
<br />
// seek / set file pointer to 50 GB<br />
my_fseek($fp, floatval(50000000000),1);<br />
<br />
function my_fseek($fp,$pos,$first=0) {<br />
<br />
// set to 0 pos initially, one-time<br />
if($first) fseek($fp,0,SEEK_SET);<br />
<br />
// get pos float value<br />
$pos=floatval($pos);<br />
<br />
&nbsp;// within limits, use normal fseek<br />
if($pos&lt;=PHP_INT_MAX)<br />
&nbsp; fseek($fp,$pos,SEEK_CUR);<br />
&nbsp;// out of limits, use recursive fseek<br />
else {<br />
&nbsp; fseek($fp,PHP_INT_MAX,SEEK_CUR);<br />
&nbsp; $pos -= PHP_INT_MAX;<br />
&nbsp; my_fseek($fp,$pos);<br />
}<br />
<br />
}<br />
<br />
hope this helps.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="111690""></a>
  <div class="note">
   <strong class="user">lorenzo dot stanco at gmail dot com</strong>
   <a href="#111690" class="date">17-Mar-2013 06:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I want to give my contribution about the "read last lines from a file" topic. I've done some researches (starting from here, really) and run many tests for different algorithms and scenarios, and came up with this:<br />
<br />
What is the best way in PHP to read last lines from a file?<br />
<a href="http://stackoverflow.com/a/15025877/995958" rel="nofollow" target="_blank">http://stackoverflow.com/a/15025877/995958</a><br />
<br />
In that mini-article I tried to analyze all different methods and their performance over different files.<br />
<br />
Hope it helps.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="106594""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#106594" class="date">21-Nov-2011 07:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I needed to stream a txt file (here big xml file) to get nodes blockwise. I couldn't find a shorter way. So i did write this class.<br />
<br />
Function: streams a complete file and returns the content between two search strings with their search strings (multi byte safe)<br />
<br />
Hope it helps anyone.<br />
<br />
PS: It lacks any boolean checks / exception handling for non existing files / read errors.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/**<br />
&nbsp;* Reads txt-files blockwise<br />
&nbsp;* Usage:<br />
&nbsp;&nbsp;&nbsp; $c_streamFileTxt = new streamFileTxt;<br />
&nbsp;&nbsp;&nbsp; $_args = array(<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'file' =&gt; 'temporary.xml',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'start_string' =&gt; '&lt;Product&gt;',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'stop_string' =&gt; '&lt;/Product&gt;',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'block_size' =&gt; '8192'<br />
&nbsp;&nbsp;&nbsp; );<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; $c_streamFileTxt-&gt;setArgs($_args);<br />
<br />
&nbsp;&nbsp;&nbsp; while ($txt_block = $c_streamFileTxt-&gt;getNextBlock())<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // use $txt_block for something<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;*/<br />
<br />
</span><span class="keyword">class </span><span class="default">streamFileTxt<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$handle</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$file</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$file_offset</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$block</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$start_string</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$stop_string</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$block_size</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; * Sett class arguments<br />
&nbsp;&nbsp; &nbsp; * @param array $_args<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public function </span><span class="default">setArgs</span><span class="keyword">(</span><span class="default">$_args</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">file </span><span class="keyword">= </span><span class="default">$_args</span><span class="keyword">[</span><span class="string">'file'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">start_string </span><span class="keyword">= </span><span class="default">$_args</span><span class="keyword">[</span><span class="string">'start_string'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">stop_string </span><span class="keyword">= </span><span class="default">$_args</span><span class="keyword">[</span><span class="string">'stop_string'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">block_size </span><span class="keyword">= </span><span class="default">$_args</span><span class="keyword">[</span><span class="string">'block_size'</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; * Get next textblock within a file<br />
&nbsp;&nbsp; &nbsp; * @param void<br />
&nbsp;&nbsp; &nbsp; * @return string $textblock<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public function </span><span class="default">getNextBlock</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">openFile</span><span class="keyword">();<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fseek</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">handle</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">file_offset</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$start_string_found </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$stop_string_found </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">handle</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$txt_block </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">handle</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">block_size</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">$start_string_found</span><span class="keyword">) </span><span class="comment">// while not start start snippet found<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$strpos </span><span class="keyword">= </span><span class="default">mb_strpos</span><span class="keyword">(</span><span class="default">$txt_block</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">start_string</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$strpos </span><span class="keyword">!== </span><span class="default">false</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// cut of first left chunk<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$txt_block </span><span class="keyword">= </span><span class="default">mb_substr</span><span class="keyword">(</span><span class="default">$txt_block</span><span class="keyword">, </span><span class="default">$strpos</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">block_size</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$start_string_found </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$start_string_found </span><span class="keyword">&amp;&amp; !</span><span class="default">$stop_string_found</span><span class="keyword">) </span><span class="comment">// start snipped found, looking for stop snippet<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">{ <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$strpos </span><span class="keyword">= </span><span class="default">mb_strpos</span><span class="keyword">(</span><span class="default">$txt_block</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">stop_string</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$strpos </span><span class="keyword">!== </span><span class="default">false</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$removed_block_size </span><span class="keyword">= </span><span class="default">mb_strlen</span><span class="keyword">(</span><span class="default">$txt_block</span><span class="keyword">) - </span><span class="default">$strpos</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$txt_block </span><span class="keyword">= </span><span class="default">mb_substr</span><span class="keyword">(</span><span class="default">$txt_block</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$strpos </span><span class="keyword">+ </span><span class="default">mb_strlen</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">stop_string</span><span class="keyword">)); <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$stop_string_found </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">setFileOffset</span><span class="keyword">(</span><span class="default">$removed_block_size</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$stop_string_found</span><span class="keyword">) </span><span class="comment">// stop-snippet found, keep file offset, return <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">closeFile</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$txt_block</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">closeFile</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; * Set current file offset and consider the removed block size<br />
&nbsp;&nbsp; &nbsp; * current file position = current file offset - removed block size<br />
&nbsp;&nbsp; &nbsp; * @param int $removed_block_size<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">private function </span><span class="default">setFileOffset</span><span class="keyword">(</span><span class="default">$removed_block_size</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">file_offset </span><span class="keyword">= </span><span class="default">ftell</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">handle</span><span class="keyword">) - </span><span class="default">$removed_block_size</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; * close current file<br />
&nbsp;&nbsp; &nbsp; * @param void<br />
&nbsp;&nbsp; &nbsp; * @return void<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">private function </span><span class="default">openFile</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">handle </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">file</span><span class="keyword">, </span><span class="string">'r'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; * open file<br />
&nbsp;&nbsp; &nbsp; * @param void<br />
&nbsp;&nbsp; &nbsp; * @return void<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">private function </span><span class="default">closeFile</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">handle</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="106336""></a>
  <div class="note">
   <strong class="user">kavoshgar3 at gmail dot com</strong>
   <a href="#106336" class="date">28-Oct-2011 09:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
sometimes we want read file from last line to beginning of file.I use the following.<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">read_backward_line</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">, </span><span class="default">$lines</span><span class="keyword">, </span><span class="default">$revers </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$offset </span><span class="keyword">= -</span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$c </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$read </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fp </span><span class="keyword">= @</span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; while( </span><span class="default">$lines </span><span class="keyword">&amp;&amp; </span><span class="default">fseek</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$offset</span><span class="keyword">, </span><span class="default">SEEK_END</span><span class="keyword">) &gt;= </span><span class="default">0 </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$c </span><span class="keyword">= </span><span class="default">fgetc</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$c </span><span class="keyword">== </span><span class="string">"\n" </span><span class="keyword">|| </span><span class="default">$c </span><span class="keyword">== </span><span class="string">"\r"</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$lines</span><span class="keyword">--;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="default">$revers </span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$read</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] = </span><span class="default">strrev</span><span class="keyword">(</span><span class="default">$read</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$i</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="default">$revers </span><span class="keyword">) </span><span class="default">$read</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] .= </span><span class="default">$c</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else </span><span class="default">$read </span><span class="keyword">.= </span><span class="default">$c</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$offset</span><span class="keyword">--;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fclose </span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if( </span><span class="default">$revers </span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$read</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] == </span><span class="string">"\n" </span><span class="keyword">|| </span><span class="default">$read</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] == </span><span class="string">"\r"</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">array_pop</span><span class="keyword">(</span><span class="default">$read</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else </span><span class="default">$read</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] = </span><span class="default">strrev</span><span class="keyword">(</span><span class="default">$read</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">implode</span><span class="keyword">(</span><span class="string">''</span><span class="keyword">,</span><span class="default">$read</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">strrev</span><span class="keyword">(</span><span class="default">rtrim</span><span class="keyword">(</span><span class="default">$read</span><span class="keyword">,</span><span class="string">"\n\r"</span><span class="keyword">));<br />
}<br />
</span><span class="comment">//if $revers=false function return-&gt;<br />
//line 1000: i am line of 1000<br />
//line 1001: and i am line of 1001<br />
//line 1002: and i am last line<br />
//but if $revers=true function return-&gt;<br />
//line 1002: and i am last line<br />
//line 1001: and i am line of 1001<br />
//line 1000: i am line of 1000<br />
</span><span class="default">?&gt;<br />
</span>Enjoy! Mail me if it works!&nbsp; ;-)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102994""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#102994" class="date">18-Mar-2011 06:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The official docs indicate that not all streams are seekable.<br />
You can try to seek anyway and handle failure:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">if (</span><span class="default">fseek</span><span class="keyword">(</span><span class="default">$stream</span><span class="keyword">, </span><span class="default">$offset</span><span class="keyword">, </span><span class="default">SEEK_CUR</span><span class="keyword">) === -</span><span class="default">1</span><span class="keyword">) {<br />
&nbsp; </span><span class="comment">// whatever<br />
</span><span class="keyword">} <br />
</span><span class="default">?&gt;<br />
</span><br />
Or, you can use the stream_get_meta_data function:<br />
<a href="http://php.net/stream_get_meta_data" rel="nofollow" target="_blank">http://php.net/stream_get_meta_data</a><br />
<br />
<span class="default">&lt;?php <br />
</span><span class="keyword">function </span><span class="default">fseekable</span><span class="keyword">(</span><span class="default">$stream</span><span class="keyword">) {<br />
&nbsp; </span><span class="default">$meta </span><span class="keyword">= </span><span class="default">stream_get_meta_data</span><span class="keyword">(</span><span class="default">$stream</span><span class="keyword">);<br />
&nbsp; return </span><span class="default">$meta</span><span class="keyword">[</span><span class="string">'seekable'</span><span class="keyword">];<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99038""></a>
  <div class="note">
   <strong class="user">necudeco at gmail dot com</strong>
   <a href="#99038" class="date">23-Jul-2010 10:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This a tail php script example for windows system.<br />
<br />
<span class="default">&lt;?php<br />
$n </span><span class="keyword">= ( isset(</span><span class="default">$_REQUEST</span><span class="keyword">[</span><span class="string">'n'</span><span class="keyword">]) == </span><span class="default">true </span><span class="keyword">)? </span><span class="default">$_REQUEST</span><span class="keyword">[</span><span class="string">'n'</span><span class="keyword">]:</span><span class="default">20</span><span class="keyword">;<br />
<br />
</span><span class="default">$offset </span><span class="keyword">= -</span><span class="default">$n </span><span class="keyword">* </span><span class="default">120</span><span class="keyword">;<br />
<br />
</span><span class="default">$rs </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="string">'C:/wamp/logs/apache_error.log'</span><span class="keyword">,</span><span class="string">'r'</span><span class="keyword">);<br />
if ( </span><span class="default">$rs </span><span class="keyword">=== </span><span class="default">false </span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; die(</span><span class="string">"No se pudo abrir el archivo de log"</span><span class="keyword">);<br />
<br />
</span><span class="default">fseek</span><span class="keyword">(</span><span class="default">$rs</span><span class="keyword">,</span><span class="default">$offset</span><span class="keyword">,</span><span class="default">SEEK_END</span><span class="keyword">);<br />
<br />
</span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$rs</span><span class="keyword">);<br />
while(!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$rs</span><span class="keyword">))<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$buffer </span><span class="keyword">= </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$rs</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">$buffer</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"&lt;hr /&gt;"</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$rs</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92406""></a>
  <div class="note">
   <strong class="user">steve at studio831 dot com</strong>
   <a href="#92406" class="date">23-Jul-2009 01:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Modified @ben's function to work for files larger than PHP_INT_MAX bytes.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">longTail</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="default">$numLines </span><span class="keyword">= </span><span class="default">100</span><span class="keyword">)
<br />
{
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$chunk </span><span class="keyword">= </span><span class="default">4096</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fs </span><span class="keyword">= </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">"%u"</span><span class="keyword">, </span><span class="default">filesize</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">));
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$max </span><span class="keyword">= (</span><span class="default">intval</span><span class="keyword">(</span><span class="default">$fs</span><span class="keyword">) == </span><span class="default">PHP_INT_MAX</span><span class="keyword">) ? </span><span class="default">PHP_INT_MAX </span><span class="keyword">: </span><span class="default">filesize</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp;&nbsp; for (</span><span class="default">$len </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$len </span><span class="keyword">&lt; </span><span class="default">$max</span><span class="keyword">; </span><span class="default">$len </span><span class="keyword">+= </span><span class="default">$chunk</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$seekSize </span><span class="keyword">= (</span><span class="default">$max </span><span class="keyword">- </span><span class="default">$len </span><span class="keyword">&gt; </span><span class="default">$chunk</span><span class="keyword">) ? </span><span class="default">$chunk </span><span class="keyword">: </span><span class="default">$max </span><span class="keyword">- </span><span class="default">$len</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fseek</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, (</span><span class="default">$len </span><span class="keyword">+ </span><span class="default">$seekSize</span><span class="keyword">) * -</span><span class="default">1</span><span class="keyword">, </span><span class="default">SEEK_END</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$seekSize</span><span class="keyword">) . </span><span class="default">$data</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">substr_count</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">, </span><span class="string">"\n"</span><span class="keyword">) &gt;= </span><span class="default">$numLines </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"!(.*?\n){"</span><span class="keyword">.(</span><span class="default">$numLines</span><span class="keyword">).</span><span class="string">"}$!"</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">, </span><span class="default">$match</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$match</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$data</span><span class="keyword">;
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="90450""></a>
  <div class="note">
   <strong class="user">Tom Pittlik</strong>
   <a href="#90450" class="date">23-Apr-2009 12:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The tail example functions below will return a PHP memory limit error when trying to open large files. Since tail is convenient for opening large logs, here is a function that lets you (provided you have permission):
<br />

<br />
<span class="default">&lt;?php
<br />

<br />
</span><span class="keyword">function </span><span class="default">unix_tail</span><span class="keyword">(</span><span class="default">$lines</span><span class="keyword">,</span><span class="default">$file</span><span class="keyword">)
<br />
{
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">shell_exec</span><span class="keyword">(</span><span class="string">"tail -n </span><span class="default">$lines</span><span class="string"> </span><span class="default">$file</span><span class="string"> &gt; /tmp/phptail_</span><span class="default">$file</span><span class="string">"</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$output </span><span class="keyword">= </span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="string">"/tmp/phptail_</span><span class="default">$file</span><span class="string">"</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">unlink</span><span class="keyword">(</span><span class="string">"/tmp/phptail_</span><span class="default">$file</span><span class="string">"</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$output</span><span class="keyword">;
<br />
}
<br />

<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86517""></a>
  <div class="note">
   <strong class="user">ben at nullcreations dot net</strong>
   <a href="#86517" class="date">22-Oct-2008 02:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
easier tail() function for php:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">tail</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="default">$num_to_get</span><span class="keyword">=</span><span class="default">10</span><span class="keyword">)
<br />
{
<br />
&nbsp; </span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="string">'r'</span><span class="keyword">);
<br />
&nbsp; </span><span class="default">$position </span><span class="keyword">= </span><span class="default">filesize</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);
<br />
&nbsp; </span><span class="default">fseek</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$position</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">);
<br />
&nbsp; </span><span class="default">$chunklen </span><span class="keyword">= </span><span class="default">4096</span><span class="keyword">;
<br />
&nbsp; while(</span><span class="default">$position </span><span class="keyword">&gt;= </span><span class="default">0</span><span class="keyword">)
<br />
&nbsp; {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$position </span><span class="keyword">= </span><span class="default">$position </span><span class="keyword">- </span><span class="default">$chunklen</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$position </span><span class="keyword">&lt; </span><span class="default">0</span><span class="keyword">) { </span><span class="default">$chunklen </span><span class="keyword">= </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$position</span><span class="keyword">); </span><span class="default">$position</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;}
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fseek</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$position</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$chunklen</span><span class="keyword">). </span><span class="default">$data</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">substr_count</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">, </span><span class="string">"\n"</span><span class="keyword">) &gt;= </span><span class="default">$num_to_get </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"!(.*?\n){"</span><span class="keyword">.(</span><span class="default">$num_to_get</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">).</span><span class="string">"}$!"</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">, </span><span class="default">$match</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; return </span><span class="default">$match</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp; }
<br />
&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);
<br />
&nbsp; return </span><span class="default">$data</span><span class="keyword">;
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82469""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#82469" class="date">11-Apr-2008 10:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To:seeker at example com<br />
Be careful, though. <br />
You can freely position you pointer if you open a file in (r+) mode, but it will "overwrite" the data, not "append it".<br />
<br />
Tested this:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// file.txt content:<br />
// "You can contribute your notes to the PHP manual from the comfort of your browser!"<br />
<br />
</span><span class="default">$handler </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="string">"file.txt"</span><span class="keyword">, </span><span class="string">"r+"</span><span class="keyword">);<br />
</span><span class="default">fseek</span><span class="keyword">(</span><span class="default">$handler</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
</span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$handler</span><span class="keyword">, </span><span class="string">"want to add this"</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span>New contents of the file.txt will be like this:<br />
"want to add thiste your notes to the PHP manual from the comfort of your browser!".<br />
<br />
If you really want to append at the beginning, you have to first get all the contents, save it, clear the file, put the new contents and append the saved contents at the end.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81450""></a>
  <div class="note">
   <strong class="user">seeker at example com</strong>
   <a href="#81450" class="date">28-Feb-2008 08:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
JUST TO QUOTE AND POINT THIS OUT:<br />
<br />
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!<br />
3. if you're using fseek() to write data to a file, remember to open the file in "r+" <br />
mode, example:<br />
<br />
&nbsp; $fp=fopen($filename,"r+");<br />
<br />
DON'T open the file in mode "a" (for append), because it puts<br />
&nbsp;the file pointer at the end of the file and doesn't let you <br />
fseek earlier positions in the file (it didn't for me!). Also, <br />
don't open the file in mode "w" -- although this puts you at <br />
the beginning of the file -- because it wipes out all data in <br />
the file. <br />
<br />
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!<br />
<br />
Took me half a day to figure :/</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73503""></a>
  <div class="note">
   <strong class="user">mhinks at gmail dot com</strong>
   <a href="#73503" class="date">26-Feb-2007 11:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's a function I wrote to binary search for a line of text within a file, particularly useful when the file is too large to read into memory at once and you want a faster search than linear.<br />
<br />
function binary_search_in_file($filename, $search) {<br />
<br />
&nbsp;&nbsp;&nbsp; //Open the file<br />
&nbsp;&nbsp;&nbsp; $fp = fopen($filename, 'r');<br />
<br />
&nbsp;&nbsp;&nbsp; //Seek to the end<br />
&nbsp;&nbsp;&nbsp; fseek($fp, 0, SEEK_END);<br />
<br />
&nbsp;&nbsp;&nbsp; //Get the max value<br />
&nbsp;&nbsp;&nbsp; $high = ftell($fp);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; //Set the low value<br />
&nbsp;&nbsp;&nbsp; $low = 0;<br />
<br />
&nbsp;&nbsp;&nbsp; while ($low &lt;= $high) { <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $mid = floor(($low + $high) / 2);&nbsp; // C floors for you<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; //Seek to half way through<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; fseek($fp, $mid);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if($mid != 0){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //Read a line to move to eol<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $line = fgets($fp);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; //Read a line to get data<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $line = fgets($fp);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ($line == $search) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; fclose($fp);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return $line;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($search &lt; $line) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $high = $mid - 1;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $low = $mid + 1;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; //Close the pointer<br />
&nbsp;&nbsp;&nbsp; fclose($fp);<br />
<br />
&nbsp;&nbsp;&nbsp; return FALSE;<br />
<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69008""></a>
  <div class="note">
   <strong class="user">marc dot roe at gmail dot com</strong>
   <a href="#69008" class="date">19-Aug-2006 09:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I tried to improve and modify (mail at ulf-kosack dot de)'s function. Actually it is very fast, i.e. requires much less time than to get the last five, ten or whatever lines of a file using file() ore file_get_contents().<br />
<br />
function read_file($file, $lines)<br />
{<br />
&nbsp;&nbsp; &nbsp; &nbsp; $handle = fopen($file, "r");<br />
&nbsp;&nbsp; &nbsp; &nbsp; $linecounter = $lines;<br />
&nbsp;&nbsp; &nbsp; &nbsp; $pos = -2;<br />
&nbsp;&nbsp; &nbsp; &nbsp; $beginning = false;<br />
&nbsp;&nbsp; &nbsp; &nbsp; $text = array();<br />
&nbsp;&nbsp; &nbsp; &nbsp; while ($linecounter &gt; 0) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; $t = " ";<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; while ($t != "\n") {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(fseek($handle, $pos, SEEK_END) == -1) {<br />
$beginning = true; break; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $t = fgetc($handle);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $pos --;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; $linecounter --;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; if($beginning) rewind($handle);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; $text[$lines-$linecounter-1] = fgets($handle);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; if($beginning break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; fclose ($handle);<br />
&nbsp;&nbsp; &nbsp; &nbsp; return array_reverse($text); // array_reverse is optional: you can also just return the $text array which consists of the file's lines. <br />
}<br />
<br />
The good thing now is, that you don't get an error when your requesting more lines than the file contains. In this case the function will just return the whole file content.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69000""></a>
  <div class="note">
   <strong class="user">lucky at somnius dot com dot ar</strong>
   <a href="#69000" class="date">18-Aug-2006 05:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Jim's (jim at lfchosting dot com) code for the last-line issue is perfect if the file is not empty, or moreover if it has more than one line. However if the file you're using cotains no new-line character at all (i.e. it is empty or it's got one line and only one) the while loop will stuck indefinitely.<br />
<br />
I know this script is meant for big files which would always contain at least several lines, but it would be clever to make the script error-proof.<br />
<br />
Thus, here's a little modification to his code.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">readLastLine </span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fp </span><span class="keyword">= @</span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$pos </span><span class="keyword">= -</span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$t </span><span class="keyword">= </span><span class="string">" "</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; while (</span><span class="default">$t </span><span class="keyword">!= </span><span class="string">"\n"</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">fseek</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$pos</span><span class="keyword">, </span><span class="default">SEEK_END</span><span class="keyword">)) { </span><span class="comment">// *** - fseek returns 0 if successfull, and -1 if it has no succes as in seeking a byte outside the file's range<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$t </span><span class="keyword">= </span><span class="default">fgetc</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pos </span><span class="keyword">= </span><span class="default">$pos </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else { </span><span class="comment">// ***<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">rewind</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">); </span><span class="comment">// ***<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">break; </span><span class="comment">// ***<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">} </span><span class="comment">// ***<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">}<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$t </span><span class="keyword">= </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$t</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Lines added and/or modified have been marked with "// ***". I hope this helps!<br />
<br />
Regards!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="66727""></a>
  <div class="note">
   <strong class="user">mail at ulf-kosack dot de</strong>
   <a href="#66727" class="date">27-May-2006 10:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here a little extension for the code of ekow.<br />
If you want to read more than one line and more than one file. Some times the last five ore ten lines are interesting in.<br />
<br />
You only have to submit a array with filenames and optionally a number of lines you want to read.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp; </span><span class="keyword">function </span><span class="default">read_logfiles</span><span class="keyword">(</span><span class="default">$files</span><span class="keyword">, </span><span class="default">$lines</span><span class="keyword">=</span><span class="default">5</span><span class="keyword">) <br />
&nbsp; { <br />
&nbsp;&nbsp;&nbsp; foreach(</span><span class="default">$files </span><span class="keyword">as </span><span class="default">$file_num </span><span class="keyword">=&gt; </span><span class="default">$file</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (</span><span class="default">file_exists </span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">) ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$handle </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$linecounter </span><span class="keyword">= </span><span class="default">$lines</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pos </span><span class="keyword">= -</span><span class="default">2</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$t </span><span class="keyword">= </span><span class="string">" "</span><span class="keyword">;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$text</span><span class="keyword">[</span><span class="default">$file_num</span><span class="keyword">] = </span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while (</span><span class="default">$linecounter </span><span class="keyword">&gt; </span><span class="default">0</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; while (</span><span class="default">$t </span><span class="keyword">!= </span><span class="string">"\n"</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fseek</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="default">$pos</span><span class="keyword">, </span><span class="default">SEEK_END</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$t </span><span class="keyword">= </span><span class="default">fgetc</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pos </span><span class="keyword">--;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$t </span><span class="keyword">= </span><span class="string">" "</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$text</span><span class="keyword">[</span><span class="default">$file_num</span><span class="keyword">] .= </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$linecounter </span><span class="keyword">--;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose </span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$text</span><span class="keyword">[</span><span class="default">$file_num</span><span class="keyword">] = </span><span class="string">"The file doesn't exist."</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$text</span><span class="keyword">;<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="59619""></a>
  <div class="note">
   <strong class="user">ekow[at]te.ugm.ac.id</strong>
   <a href="#59619" class="date">11-Dec-2005 05:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A little correction for code to read last line from chenganeyou at eyou dot com.<br />
$linenumber = sizeof($file)-1;<br />
should be<br />
$linenumber = sizeof($contents)-1;<br />
because sizeof will count array element, not file size.<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">readlastline</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$linecontent </span><span class="keyword">= </span><span class="string">" "</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$contents </span><span class="keyword">= </span><span class="default">file</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$linenumber </span><span class="keyword">= </span><span class="default">sizeof</span><span class="keyword">(</span><span class="default">$contents</span><span class="keyword">)-</span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$linecontet </span><span class="keyword">= </span><span class="default">$contents</span><span class="keyword">[</span><span class="default">$linenumber</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; unset(</span><span class="default">$contents</span><span class="keyword">,</span><span class="default">$linenumber</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; return </span><span class="default">$linecontent</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="54199""></a>
  <div class="note">
   <strong class="user">chenganeyou at eyou dot com</strong>
   <a href="#54199" class="date">27-Jun-2005 01:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I use the following codes to read the last line of a file.<br />
Compared to jim at lfchosting dot com, it should be more efficient.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">readlastline</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$linecontent </span><span class="keyword">= </span><span class="string">" "</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$contents </span><span class="keyword">= </span><span class="default">file</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$linenumber </span><span class="keyword">= </span><span class="default">sizeof</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">)-</span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$linecontet </span><span class="keyword">= </span><span class="default">$contents</span><span class="keyword">[</span><span class="default">$linenumber</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; unset(</span><span class="default">$contents</span><span class="keyword">,</span><span class="default">$linenumber</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; return </span><span class="default">$linecontent</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="53220""></a>
  <div class="note">
   <strong class="user">phil at NOSPAM dot blisswebhosting dot com</strong>
   <a href="#53220" class="date">25-May-2005 08:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In order to read a text file from end-&gt;beginning e.g display the most recent contents of a log file first.&nbsp; I use the following.<br />
<br />
It basically just uses fseek to find the end of the file, ftell to find the byte count for a counter, then iterates backwards through the file using fgetc to test for the newline charater.<br />
<br />
$i=0 ;<br />
$lines=500 ;<br />
$fp = fopen($log,"r") ;<br />
if(is_resource($fp)){<br />
&nbsp;&nbsp;&nbsp; fseek($fp,0,SEEK_END) ;<br />
&nbsp;&nbsp;&nbsp; $a = ftell($fp) ;<br />
&nbsp;&nbsp;&nbsp; while($i &lt;= $lines){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(fgetc($fp) == "\n"){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo (fgets($fp));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $i++ ;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; fseek($fp,$a) ;<br />
&nbsp;&nbsp;&nbsp; $a-- ;<br />
&nbsp;&nbsp;&nbsp; }<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="52929""></a>
  <div class="note">
   <strong class="user">alan at peaceconstitution.com</strong>
   <a href="#52929" class="date">17-May-2005 06:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Thanks to Dan, whose above comment provided a key to solve the issue of how to append to a file. <br />
&nbsp;&nbsp; &nbsp; After, using phpinfo(); I made sure my installation of PHP had the requisite settings mentioned in the text to the manual entry for fopen(), I was puzzled as to why my use of fopen() with the append option 'a' (append option) didn't work. Then I&nbsp; read a comment contributed to Appendix L (<a href="http://us2.php.net/manual/en/wrappers.php" rel="nofollow" target="_blank">http://us2.php.net/manual/en/wrappers.php</a>) that the append option 'a' for fopen() doesn't work as expected. The writer suggested using the 'w' option instead, which I found did work. But the 'w' option (write option) overwrites everything in the file.<br />
&nbsp;&nbsp; &nbsp; The question remained how to accomplish appending. Following Dan's suggestion about the 'r+' option, I tried this, which works fine:<br />
&nbsp;&nbsp; &nbsp; &nbsp; $string = "Message to write to log";<br />
&nbsp;&nbsp; &nbsp; &nbsp; $filehandle = fopen ("/home/name/sqllogs/phpsqlerr.txt", 'r+');<br />
&nbsp;&nbsp;&nbsp; fseek ( $filehandle,0, SEEK_END);<br />
&nbsp;&nbsp;&nbsp; fwrite ( $filehandle, $string."\n" );<br />
&nbsp;&nbsp;&nbsp; fclose ($filehandle);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="49992""></a>
  <div class="note">
   <strong class="user">Lutz ( l_broedel at gmx dot net )</strong>
   <a href="#49992" class="date">14-Feb-2005 02:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Based on the function below, provided by info at o08 dot com (thanks), the following should enable you to read a single line from a file, identified by the line number (starting with 1):<br />
<br />
&lt;?<br />
&nbsp;&nbsp;&nbsp; function readLine ($linenum,$fh) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $line = fgets ($fh, 4096);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $pos = -1;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $i = 0;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while (!feof($fh) &amp;&amp; $i&lt;($linenum-1)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $char = fgetc($fh);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($char != "\n" &amp;&amp; $char != "\r") {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; fseek($fh, $pos, SEEK_SET);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $pos ++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else $i ++; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $line = fgets($fh);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return $line;<br />
&nbsp;&nbsp;&nbsp; } //readLine()<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="37147""></a>
  <div class="note">
   <strong class="user">jim at lfchosting dot com</strong>
   <a href="#37147" class="date">04-Nov-2003 06:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is a function that returns the last line of a file.&nbsp; This should be quicker than reading the whole file till you get to the last line.&nbsp; If you want to speed it up a bit, you can set the $pos = some number that is just greater than the line length.&nbsp; The files I was dealing with were various lengths, so this worked for me.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">readlastline</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">)
<br />
{
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fp </span><span class="keyword">= @</span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pos </span><span class="keyword">= -</span><span class="default">1</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$t </span><span class="keyword">= </span><span class="string">" "</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while (</span><span class="default">$t </span><span class="keyword">!= </span><span class="string">"\n"</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fseek</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$pos</span><span class="keyword">, </span><span class="default">SEEK_END</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$t </span><span class="keyword">= </span><span class="default">fgetc</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pos </span><span class="keyword">= </span><span class="default">$pos </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$t </span><span class="keyword">= </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$t</span><span class="keyword">;
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="25250""></a>
  <div class="note">
   
   <a href="#25250" class="date">16-Sep-2002 01:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Don't use filesize() on files that may be accessed and updated by parallel processes or threads (as the filesize() return value is maintained in a cache).<br />
Instead lock the opened file and use fseek($fp,0,SEEK_END) and ftell($fp) to get the actual filesize if you need to perform a fread() call to read the whole file...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
