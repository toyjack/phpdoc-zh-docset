<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>返回当前 FTP 被动模式是否打开</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.ftp-nlist.html">? ftp_nlist</a></li>
      <li style="float: right;"><a href="function.ftp-put.html">ftp_put ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.ftp.html">FTP 函数</a></li>
    <li>返回当前 FTP 被动模式是否打开</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.ftp-pasv" class="refentry">
   <div class="refnamediv">
    <h1 class="refname">ftp_pasv</h1>
    <p class="verinfo">(PHP 4, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">ftp_pasv</span> &mdash; <span class="dc-title">返回当前 FTP 被动模式是否打开</span></p>

   </div>
   <div class="refsect1 description" id="refsect1-function.ftp-pasv-description">
    <h3 class="title">说明</h3>
     <div class="methodsynopsis dc-description">
      <span class="methodname"><strong>ftp_pasv</strong></span>(<span class="methodparam"><span class="type">resource</span> <code class="parameter">$ftp_stream</code></span>, <span class="methodparam"><span class="type">bool</span> <code class="parameter">$pasv</code></span>): <span class="type">bool</span></div>

    <p class="para rdfs-comment">
     在被动模式打开的情况下，数据的传送由客户机启动，而不是由服务器开始。
    </p>
    <p class="para">
     请注意 <span class="function"><strong>ftp_pasv()</strong></span> 只能在 FTP
     登录成功后方可调用，否则会失败。
    </p>
   </div>

   <div class="refsect1 parameters" id="refsect1-function.ftp-pasv-parameters">
   <h3 class="title">参数</h3>
   <p class="para">
    <dl>
     
      <dt>
<code class="parameter">ftp_stream</code></dt>

      <dd>

       <p class="para">
        FTP 连接资源。
       </p>
      </dd>

     
     
      <dt>
<code class="parameter">pasv</code></dt>

      <dd>

       <p class="para">
        如果参数 <code class="parameter">pasv</code> 为 <strong><code>true</code></strong>，打开被动模式传输 (PASV MODE)
     ，否则则关闭被动传输模式。  
       </p>
      </dd>

     
    </dl>
 
   </p>
   </div>

   <div class="refsect1 returnvalues" id="refsect1-function.ftp-pasv-returnvalues">
   <h3 class="title">返回值</h3> 
    <p class="para">
     成功时返回 <strong><code>true</code></strong>， 或者在失败时返回 <strong><code>false</code></strong>。
    </p>
   </div>

  <div class="refsect1 examples" id="refsect1-function.ftp-pasv-examples">
  <h3 class="title">范例</h3>
  <p class="para">
   <div class="example" id="example-4197">
    <p><strong>Example #1 <span class="function"><strong>ftp_pasv()</strong></span> 实例</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$file&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'somefile.txt'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$remote_file&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'readme.txt'</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//&nbsp;set&nbsp;up&nbsp;basic&nbsp;connection<br /></span><span style="color: #0000BB">$conn_id&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">ftp_connect</span><span style="color: #007700">(</span><span style="color: #0000BB">$ftp_server</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;login&nbsp;with&nbsp;username&nbsp;and&nbsp;password<br /></span><span style="color: #0000BB">$login_result&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">ftp_login</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn_id</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$ftp_user_name</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$ftp_user_pass</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;turn&nbsp;passive&nbsp;mode&nbsp;on<br /></span><span style="color: #0000BB">ftp_pasv</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn_id</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;upload&nbsp;a&nbsp;file<br /></span><span style="color: #007700">if&nbsp;(</span><span style="color: #0000BB">ftp_put</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn_id</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$remote_file</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$file</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">FTP_ASCII</span><span style="color: #007700">))&nbsp;{<br />&nbsp;echo&nbsp;</span><span style="color: #DD0000">"successfully&nbsp;uploaded&nbsp;</span><span style="color: #0000BB">$file</span><span style="color: #DD0000">\n"</span><span style="color: #007700">;<br />}&nbsp;else&nbsp;{<br />&nbsp;echo&nbsp;</span><span style="color: #DD0000">"There&nbsp;was&nbsp;a&nbsp;problem&nbsp;while&nbsp;uploading&nbsp;</span><span style="color: #0000BB">$file</span><span style="color: #DD0000">\n"</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #FF8000">//&nbsp;close&nbsp;the&nbsp;connection<br /></span><span style="color: #0000BB">ftp_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn_id</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="123266""></a>
  <div class="note">
   <strong class="user">rrehbein at officesupply dot com</strong>
   <a href="#123266" class="date">26-Oct-2018 01:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For some FTP servers, it seems the sequence of passive and other commands matters more than for other FTP servers. Sorry, I don't know what vendor or version specifically.<br />
<br />
<span class="default">&lt;?php<br />
ftp_pasv</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
echo </span><span class="string">"System type: "</span><span class="keyword">.</span><span class="default">ftp_systype</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">).</span><span class="default">PHP_EOL</span><span class="keyword">;<br />
</span><span class="default">ftp_fput</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="string">'example.txt'</span><span class="keyword">, </span><span class="default">$stream</span><span class="keyword">, </span><span class="default">FTP_BINARY</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
&gt; PHP Warning: ftp_fput(): STOR out of sequence.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">echo </span><span class="string">"System type: "</span><span class="keyword">.</span><span class="default">ftp_systype</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">).</span><span class="default">PHP_EOL</span><span class="keyword">;<br />
</span><span class="default">ftp_pasv</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
</span><span class="default">ftp_fput</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="string">'example.txt'</span><span class="keyword">, </span><span class="default">$stream</span><span class="keyword">, </span><span class="default">FTP_BINARY</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
&gt; no issue</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="115472""></a>
  <div class="note">
   <strong class="user">carda at two-wings dot net</strong>
   <a href="#115472" class="date">30-Jul-2014 08:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It should be noted that ftp_pasv has to be called AFTER ftp_login (not after ftp_connect). May seem obvious to many but it took me three hours to find out...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="114973""></a>
  <div class="note">
   <strong class="user">sameg14 at gmail dot com</strong>
   <a href="#114973" class="date">07-May-2014 11:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are running filezilla in passive mode, on windows, and try to connect using PHP, you might encounter an error that reads "425 Can't open data connection for transfer of ..."<br />
This error is not indicative of a passive mode issue, but can be resolved by using <br />
<span class="default">&lt;?php<br />
ftp_pasv</span><span class="keyword">(</span><span class="default">$conn</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="111439""></a>
  <div class="note">
   <strong class="user">marc at gutt dot it</strong>
   <a href="#111439" class="date">20-Feb-2013 09:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are still having problems after choosing ftp_pasv() you should refresh the connection through ftp_close() / ftp_connect() after x files and/or y GB have been transfered.<br />
<br />
It solved several (random) occurring problems like:<br />
<br />
ftp_get(): Opening BINARY mode data connection<br />
<br />
ftp_get(): Entering Passive Mode<br />
<br />
Hint: fopen() created a file so don't forget to delete it if an error occurred ;)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="98837""></a>
  <div class="note">
   <strong class="user">mac at codegreene dot com</strong>
   <a href="#98837" class="date">09-Jul-2010 03:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I found one place that required passive mode to function properly, but the initial error manifested itself in an odd way:<br />
<br />
PHP Warning:&nbsp; ftp_put(): TYPE is now ASCII in &lt;file.php&gt; on line &lt;#&gt;<br />
<br />
or <br />
<br />
PHP Warning:&nbsp; ftp_put(): TYPE is now 8 BIT BINARY in &lt;file.php&gt; on line &lt;#&gt;<br />
<br />
The other symptom is that it was taking a long time, perhaps the 90 seconds that the timeout was set to. No errors occurred upon connect, just when I tried ftp_put().<br />
<br />
Once I turned on ftp_pasv() it worked, both in the place where active mode worked, and on the server where active mode wouldn't work.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93348""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#93348" class="date">04-Sep-2009 10:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you find that you are receiving "Illegal PORT command" errors you may want to try enabling passive mode.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="20576""></a>
  <div class="note">
   <strong class="user">ybourbeau at edison dot ca</strong>
   <a href="#20576" class="date">08-Apr-2002 03:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Directly from bsd FTP manual pages:<br />
<br />
The PASV command requests that the remote server open a port for the data connection and return the address of that port.&nbsp; The remote server listens on that port and the client connects to it.<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; When using the more traditional PORT command, the client listens on a port and sends that address to the remote server, who connects back to it.&nbsp; Passive mode is useful when using ftp through a gateway router or host that controls the directionality of traffic.&nbsp; (Note that though ftp servers are required to support the PASV command by RFC 1123, some do not.)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="20441""></a>
  <div class="note">
   
   <a href="#20441" class="date">03-Apr-2002 04:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
PASV: For ftp users behind firewall, the server LISTEN for a connection. <br />
<br />
Non-PASV: The client LISTEN for a connection from server.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
