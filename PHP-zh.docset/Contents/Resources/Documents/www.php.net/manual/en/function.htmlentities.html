<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>将字符转换为 HTML 转义字符</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.html-entity-decode.html">? html_entity_decode</a></li>
      <li style="float: right;"><a href="function.htmlspecialchars-decode.html">htmlspecialchars_decode ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.strings.html">字符串 函数</a></li>
    <li>将字符转换为 HTML 转义字符</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.htmlentities" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">htmlentities</h1>
  <p class="verinfo">(PHP 4, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">htmlentities</span> &mdash; <span class="dc-title">将字符转换为 HTML 转义字符</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.htmlentities-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>htmlentities</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$string</code></span>
   , <span class="methodparam"><span class="type">int</span> <code class="parameter">$flags</code><span class="initializer"> = ENT_COMPAT | ENT_HTML401</span></span>
   , <span class="methodparam"><span class="type">string</span> <code class="parameter">$encoding</code><span class="initializer"> = ini_get(&quot;default_charset&quot;)</span></span>
   , <span class="methodparam"><span class="type">bool</span> <code class="parameter">$double_encode</code><span class="initializer"> = <strong><code>true</code></strong></span></span>
   ) : <span class="type">string</span></div>

  <p class="para rdfs-comment">
   本函数各方面都和 <span class="function"><a href="function.htmlspecialchars.html" class="function">htmlspecialchars()</a></span> 一样，
   除了 <span class="function"><strong>htmlentities()</strong></span> 会转换所有具有 HTML 实体的字符。
  </p>
  <p class="para">
   如果要解码（反向操作），可以使用 <span class="function"><a href="function.html-entity-decode.html" class="function">html_entity_decode()</a></span>。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.htmlentities-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">string</code></dt>

     <dd>

      <p class="para">
       输入字符。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">flags</code></dt>

     <dd>

      <p class="para">
       以下一组位掩码标记，用于设置如何处理引号、无效代码序列、使用文档的类型。
       默认是
       <code class="literal">ENT_COMPAT | ENT_HTML401</code>。
       <table class="doctable table">
        <caption><strong>有效 <code class="parameter">flags</code> 标记常量</strong></caption>
        
         <thead>
          <tr>
           <th>常量名</th>
           <th>描述</th>
          </tr>

         </thead>

         <tbody class="tbody">
          <tr>
           <td><strong><code>ENT_COMPAT</code></strong></td>
           <td>会转换双引号，不转换单引号。</td>
          </tr>

          <tr>
           <td><strong><code>ENT_QUOTES</code></strong></td>
           <td>既转换双引号也转换单引号。</td>
          </tr>

          <tr>
           <td><strong><code>ENT_NOQUOTES</code></strong></td>
           <td>单/双引号都不转换</td>
          </tr>

          <tr>
           <td><strong><code>ENT_IGNORE</code></strong></td>
           <td>
            静默丢弃无效的代码单元序列，而不是返回空字符串。
            不建议使用此标记，
            因为它<a href="http://unicode.org/reports/tr36/#Deletion_of_Noncharacters" class="link external" title="Link : http://unicode.org/reports/tr36/#Deletion_of_Noncharacters">&raquo;&nbsp;可能有安全影响</a>。
           </td>
          </tr>

          <tr>
           <td><strong><code>ENT_SUBSTITUTE</code></strong></td>
           <td>
            替换无效的代码单元序列为 Unicode 代替符（Replacement Character），
            U+FFFD (UTF-8) 或者 &amp;#xFFFD; (其他)，而不是返回空字符串。
           </td>
          </tr>

          <tr>
           <td><strong><code>ENT_DISALLOWED</code></strong></td>
           <td>
            为文档的无效代码点替换为  Unicode 代替符（Replacement Character）：
            U+FFFD (UTF-8)，或 &amp;#xFFFD;（其他），而不是把它们留在原处。
            比如以下情况下就很有用：要保证 XML 文档嵌入额外内容时格式合法。
           </td>
          </tr>

          <tr>
           <td><strong><code>ENT_HTML401</code></strong></td>
           <td>
            以 HTML 4.01 处理代码。
           </td>
          </tr>

          <tr>
           <td><strong><code>ENT_XML1</code></strong></td>
           <td>
            以 XML 1 处理代码。
           </td>
          </tr>

          <tr>
           <td><strong><code>ENT_XHTML</code></strong></td>
           <td>
            以 XHTML 处理代码。
           </td>
          </tr>

          <tr>
           <td><strong><code>ENT_HTML5</code></strong></td>
           <td>
            以 HTML 5 处理代码。
           </td>
          </tr>

         </tbody>
        
       </table>

      </p>
     </dd>

    
    
     <dt>
<code class="parameter">encoding</code></dt>

     <dd>

      
 <p class="para">
  An optional argument defining the encoding used when converting characters.
 </p>

 <p class="para">
  If omitted, <code class="parameter">encoding</code> defaults to the value of the
  <a href="ini.core.html#ini.default-charset" class="link">default_charset</a> configuration
  option.
 </p>

 <p class="para">
  Although this argument is technically optional, you are highly encouraged to
  specify the correct value for your code
  if the <a href="ini.core.html#ini.default-charset" class="link">default_charset</a>
  configuration option may be set incorrectly for the given input.
 </p>

      


<p class="para">
 支持以下字符集：
 <table class="doctable table">
  <caption><strong>支持的字符集列表</strong></caption>
  
   <thead>
    <tr>
     <th>字符集</th>
     <th>别名</th>
     <th>描述</th>
    </tr>

   </thead>

   <tbody class="tbody">
    <tr>
     <td>ISO-8859-1</td>
     <td>ISO8859-1</td>
     <td>
      西欧，Latin-1
     </td>
    </tr>

    <tr>
     <td>ISO-8859-5</td>
     <td>ISO8859-5</td>
     <td>
      Little used cyrillic charset (Latin/Cyrillic).
     </td>
    </tr>

    <tr>
     <td>ISO-8859-15</td>
     <td>ISO8859-15</td>
     <td>
      西欧，Latin-9。增加欧元符号，法语和芬兰语字母在 Latin-1(ISO-8859-1) 中缺失。
     </td>
    </tr>

    <tr>
     <td>UTF-8</td>
     <td class="empty">&nbsp;</td>
     <td>
      ASCII 兼容的多字节 8 位 Unicode。
     </td>
    </tr>

    <tr>
     <td>cp866</td>
     <td>ibm866, 866</td>
     <td>
      DOS 特有的西里尔编码。本字符集在 4.3.2 版本中得到支持。
     </td>
    </tr>

    <tr>
     <td>cp1251</td>
     <td>Windows-1251, win-1251, 1251</td>
     <td>
      Windows 特有的西里尔编码。本字符集在 4.3.2 版本中得到支持。
     </td>
    </tr>

    <tr>
     <td>cp1252</td>
     <td>Windows-1252, 1252</td>
     <td>
      Windows 特有的西欧编码。
     </td>
    </tr>

    <tr>
     <td>KOI8-R</td>
     <td>koi8-ru, koi8r</td>
     <td>
      俄语。本字符集在 4.3.2 版本中得到支持。
     </td>
    </tr>

    <tr>
     <td>BIG5</td>
     <td>950</td>
     <td>
      繁体中文，主要用于中国台湾省。
     </td>
    </tr>

    <tr>
     <td>GB2312</td>
     <td>936</td>
     <td>
      简体中文，中国国家标准字符集。
     </td>
    </tr>

    <tr>
     <td>BIG5-HKSCS</td>
     <td class="empty">&nbsp;</td>
     <td>
      繁体中文，附带香港扩展的 Big5 字符集。
     </td>
    </tr>

    <tr>
     <td>Shift_JIS</td>
     <td>SJIS, 932</td>
     <td>
      日语
     </td>
    </tr>

    <tr>
     <td>EUC-JP</td>
     <td>EUCJP</td>
     <td>
      日语
     </td>
    </tr>

    <tr>
     <td>MacRoman</td>
     <td class="empty">&nbsp;</td>
     <td>
      Mac OS 使用的字符串。
     </td>
    </tr>

    <tr>
     <td><code class="literal">&#039;&#039;</code></td>
     <td class="empty">&nbsp;</td>
     <td>
      An empty string activates detection from script encoding (Zend multibyte),
      <a href="ini.core.html#ini.default-charset" class="link">default_charset</a> and current
      locale (see <span class="function"><a href="function.nl-langinfo.html" class="function">nl_langinfo()</a></span> and
      <span class="function"><a href="function.setlocale.html" class="function">setlocale()</a></span>), in this order. Not recommended.
     </td>
    </tr>

   </tbody>
  
 </table>

 <blockquote class="note"><p><strong class="note">Note</strong>: 
  <span class="simpara">
   其他字符集没有认可。将会使用默认编码并抛出异常。
  </span>
 </p></blockquote>
</p>


     </dd>

    
    
     <dt>
<code class="parameter">double_encode</code></dt>

     <dd>

      <p class="para">
       关闭 <code class="parameter">double_encode</code> 时，PHP 不会转换现有的 HTML 实体，
       默认是全部转换。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.htmlentities-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   返回编码后的字符。
  </p>
  <p class="para">
   如果指定的编码 <code class="parameter">encoding</code> 里，
   <code class="parameter">string</code> 包含了无效的代码单元序列，
   没有设置 <strong><code>ENT_IGNORE</code></strong> 或者
   <strong><code>ENT_SUBSTITUTE</code></strong> 标记的情况下，会返回空字符串。
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.htmlentities-changelog">
  <h3 class="title">更新日志</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead>
      <tr>
       <th>版本</th>
       <th>说明</th>
      </tr>

     </thead>

     <tbody class="tbody">
      
 <tr>
  <td>5.6.0</td>
  <td>
   The default value for the <code class="parameter">encoding</code> parameter was
   changed to be the value of the
   <a href="ini.core.html#ini.default-charset" class="link">default_charset</a> configuration
   option.
  </td>
 </tr>


      <tr>
       <td>5.4.0</td>
       <td>
        <code class="parameter">encoding</code> 参数的默认值改成 UTF-8。
       </td>
      </tr>

      <tr>
       <td>5.4.0</td>
       <td>
        增加常量 <strong><code>ENT_SUBSTITUTE</code></strong>、 <strong><code>ENT_DISALLOWED</code></strong>、
        <strong><code>ENT_HTML401</code></strong>、 <strong><code>ENT_XML1</code></strong>、
        <strong><code>ENT_XHTML</code></strong>、 <strong><code>ENT_HTML5</code></strong>。
       </td>
      </tr>

      <tr>
       <td>5.3.0</td>
       <td>
        增加常量 <strong><code>ENT_IGNORE</code></strong>。
       </td>
      </tr>

      <tr>
       <td>5.2.3</td>
       <td>
        增加参数 <code class="parameter">double_encode</code>。
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.htmlentities-examples">
  <h3 class="title">范例</h3>
  <p class="para">
   <div class="example" id="example-5135">
    <p><strong>Example #1 <span class="function"><strong>htmlentities()</strong></span> 例子</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$str&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"A&nbsp;'quote'&nbsp;is&nbsp;&lt;b&gt;bold&lt;/b&gt;"</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//&nbsp;输出:&nbsp;A&nbsp;'quote'&nbsp;is&nbsp;&amp;lt;b&amp;gt;bold&amp;lt;/b&amp;gt;<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">htmlentities</span><span style="color: #007700">(</span><span style="color: #0000BB">$str</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;输出:&nbsp;A&nbsp;&amp;#039;quote&amp;#039;&nbsp;is&nbsp;&amp;lt;b&amp;gt;bold&amp;lt;/b&amp;gt;<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">htmlentities</span><span style="color: #007700">(</span><span style="color: #0000BB">$str</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">ENT_QUOTES</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
  
  <p class="para">
   <div class="example" id="example-5136">
    <p><strong>Example #2 <strong><code>ENT_IGNORE</code></strong> 用法示例</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$str&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"\x8F!!!"</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//&nbsp;输出空&nbsp;string<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">htmlentities</span><span style="color: #007700">(</span><span style="color: #0000BB">$str</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">ENT_QUOTES</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"UTF-8"</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;输出&nbsp;"!!!"<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">htmlentities</span><span style="color: #007700">(</span><span style="color: #0000BB">$str</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">ENT_QUOTES&nbsp;</span><span style="color: #007700">|&nbsp;</span><span style="color: #0000BB">ENT_IGNORE</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"UTF-8"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.htmlentities-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.html-entity-decode.html" class="function" rel="rdfs-seeAlso">html_entity_decode()</a> - Convert HTML entities to their corresponding characters</span></li>
    <li class="member"><span class="function"><a href="function.get-html-translation-table.html" class="function" rel="rdfs-seeAlso">get_html_translation_table()</a> - 返回使用 htmlspecialchars 和 htmlentities 后的转换表</span></li>
    <li class="member"><span class="function"><a href="function.htmlspecialchars.html" class="function" rel="rdfs-seeAlso">htmlspecialchars()</a> - 将特殊字符转换为 HTML 实体</span></li>
    <li class="member"><span class="function"><a href="function.nl2br.html" class="function" rel="rdfs-seeAlso">nl2br()</a> - 在字符串所有新行之前插入 HTML 换行标记</span></li>
    <li class="member"><span class="function"><a href="function.urlencode.html" class="function" rel="rdfs-seeAlso">urlencode()</a> - 编码 URL 字符串</span></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="123190""></a>
  <div class="note">
   <strong class="user">2962051004 at qq dot com</strong>
   <a href="#123190" class="date">03-Oct-2018 04:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">/**<br />
&nbsp;* 将中文转为Html实体<br />
&nbsp;* Convert Chinese in HTML to entity<br />
&nbsp;* Author QiangGe<br />
&nbsp;* Mail 2962051004@qq.com<br />
&nbsp;*<br />
*/<br />
<br />
</span><span class="default">$str </span><span class="keyword">= &lt;&lt;&lt;EOT<br />
</span><span class="string">你好 world<br />
</span><span class="keyword">EOT;<br />
<br />
function </span><span class="default">ChineseToEntity</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">) {<br />
&nbsp;return </span><span class="default">preg_replace_callback</span><span class="keyword">(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'/[\x{4e00}-\x{9fa5}]/u'</span><span class="keyword">, </span><span class="comment">// utf-8 <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // '/[\x7f-\xff]+/', // if gb2312<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">function (</span><span class="default">$matches</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$json </span><span class="keyword">= </span><span class="default">json_encode</span><span class="keyword">(array(</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'/\[\"(.*)\"\]/'</span><span class="keyword">, </span><span class="default">$json</span><span class="keyword">, </span><span class="default">$arr</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/*<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; * 通过json_encode函数将中文转为unicode<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; * 然后用正则取出unicode<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; * Turn the Chinese into Unicode through the json_encode function, then extract Unicode from regular.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; * I think this idea is seamless.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">return </span><span class="string">'&amp;#x'</span><span class="keyword">. </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'\\u'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$arr</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]). </span><span class="string">';'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }, </span><span class="default">$str<br />
&nbsp;&nbsp; </span><span class="keyword">);<br />
}<br />
<br />
echo </span><span class="default">ChineseToEntity</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">);<br />
</span><span class="comment">// &amp;#x4f60;&amp;#x597d; world</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="122790""></a>
  <div class="note">
   <strong class="user">Jeff</strong>
   <a href="#122790" class="date">01-Jun-2018 01:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There is a feature when writing to XML using an AJAX call to PHP that rarely is mentioned. I struggled for many hours using htmlentities() because what was getting written to my XML document was not as expected. I naturally assumed that I should be converting my strings before writing them to XML to adhere to XML rules on illegal characters. To my surprise, when converting with htmlentities() or htmlspecialchars() and then writing to an XML file, the resulting ampersands get converted afterwards! Consider the following example:<br />
<br />
<span class="default">&lt;?php<br />
$str </span><span class="keyword">= </span><span class="string">"&lt;b&gt;I am cool&lt;/b&gt;" </span><span class="keyword">;<br />
</span><span class="default">$str </span><span class="keyword">= </span><span class="default">htmlentities</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">) ;<br />
</span><span class="default">?&gt;<br />
</span><br />
When you append $str to an XML element and save() the document, you would expect the XML document's source code to look something like this:<br />
<br />
&lt;ele&gt;&amp;lt;b&amp;gt;I am cool&amp;lt;/b&amp;gt;&lt;/ele&gt;<br />
<br />
But that is not what happens. The resulting ampersands get converted by PHP automatically to &amp;amp; and your source code ends up looking like this:<br />
<br />
&lt;ele&gt;&amp;amp;lt;b&amp;amp;gt;I am cool&amp;amp;lt;/b&amp;amp;gt;&lt;/ele&gt;<br />
<br />
As you can see, this creates problems when trying to output the XML data back to HTML. It is important to remember that when writing to XML this way, special characters like "&gt;" and "&lt;"; PHP converts them automatically and there becomes no need to use htmlentities() in certain cases. I assume this feature is in place to aid with passing data through header queries, to avoid reserved characters conflicting with others in a header query (e.g. &amp; or =). Now I understand this may not be the case with older versions of PHP and that this might be a feature of my version (PHP version 5.6.32). With older versions, I assume using htmlentities() or htmlspecialchars() is a must, as stated with previous notes here. Also I use the charset UTF-8 in my HTML and XML and am not sure if this also effects the results I get.<br />
<br />
Anyway, I struggled for many hours with using htmlentities() to convert strings for XML writing and saving, when all I had to do was simply not use the function and let PHP convert my strings for me. I hope this helps because I would think I am not the only one who has struggled with this situation.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="120958""></a>
  <div class="note">
   <strong class="user">chris at ocproducts dot com</strong>
   <a href="#120958" class="date">10-Apr-2017 01:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This function throws a warning on bad input even if ENT_SUBSTITUTE is set, so be prepared for this.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="114041""></a>
  <div class="note">
   <strong class="user">hajo-p</strong>
   <a href="#114041" class="date">05-Jan-2014 05:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The flag ENT_HTML5 also strips newline chars like \n with htmlentities while htmlspecialchars is not affected by that.<br />
<br />
If you want to use nl2br on that string afterwards you might end up searching the problem like i did. This does not apply to other flags like e.g. ENT_XHTML which confused me.<br />
<br />
Tested this with PHP 5.4 / 5.5 / 5.6-dev with same results, so it seems that this is an intended "feature".</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="108222""></a>
  <div class="note">
   <strong class="user">ustimenko dot alexander at gmail dot com</strong>
   <a href="#108222" class="date">09-Apr-2012 02:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For those Spanish (and not only) folks, that want their national letters back after htmlentities :)<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">protected function </span><span class="default">_decodeAccented</span><span class="keyword">(</span><span class="default">$encodedValue</span><span class="keyword">, </span><span class="default">$options </span><span class="keyword">= array()) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$options </span><span class="keyword">+= array(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'quote'&nbsp; &nbsp;&nbsp; </span><span class="keyword">=&gt; </span><span class="default">ENT_NOQUOTES</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'encoding'&nbsp; </span><span class="keyword">=&gt; </span><span class="string">'UTF-8'</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; );<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">preg_replace_callback</span><span class="keyword">(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'/&amp;\w(acute|uml|tilde);/'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">create_function</span><span class="keyword">(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'$m'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'return html_entity_decode($m[0], ' </span><span class="keyword">. </span><span class="default">$options</span><span class="keyword">[</span><span class="string">'quote'</span><span class="keyword">] . </span><span class="string">', "' </span><span class="keyword">.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$options</span><span class="keyword">[</span><span class="string">'encoding'</span><span class="keyword">] . </span><span class="string">'");'<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">),<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$encodedValue<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="107985""></a>
  <div class="note">
   <strong class="user">n at erui dot eu</strong>
   <a href="#107985" class="date">20-Mar-2012 12:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
html entities does not encode all unicode characters. It encodes what it can [all of latin1], and the others slip through. &amp;#1033; is the nasty I use. I have searched for a function which encodes everything, but in the end I wrote this. This is as simple as I can get it. Consult an ansii table to custom include/omit chars you want/don't. I'm sure it's not that fast.<br />
<br />
// Unicode-proof htmlentities. <br />
// Returns 'normal' chars as chars and weirdos as numeric html entites.<br />
function superentities( $str ){<br />
&nbsp;&nbsp;&nbsp; // get rid of existing entities else double-escape<br />
&nbsp;&nbsp;&nbsp; $str = html_entity_decode(stripslashes($str),ENT_QUOTES,'UTF-8'); <br />
&nbsp;&nbsp;&nbsp; $ar = preg_split('/(?&lt;!^)(?!$)/u', $str );&nbsp; // return array of every multi-byte character<br />
&nbsp;&nbsp;&nbsp; foreach ($ar as $c){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $o = ord($c);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( (strlen($c) &gt; 1) || /* multi-byte [unicode] */<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ($o &lt;32 || $o &gt; 126) || /* &lt;- control / latin weirdos -&gt; */<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ($o &gt;33 &amp;&amp; $o &lt; 40) ||/* quotes + ambersand */<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ($o &gt;59 &amp;&amp; $o &lt; 63) /* html */<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // convert to numeric entity<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $c = mb_encode_numericentity($c,array (0x0, 0xffff, 0, 0xffff), 'UTF-8');<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $str2 .= $c;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return $str2;<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="106929""></a>
  <div class="note">
   <strong class="user">wd at NOSPAMwd dot it</strong>
   <a href="#106929" class="date">19-Dec-2011 02:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hi there,<br />
<br />
after several and several tests, I figured out that dot:<br />
<br />
- htmlentities() function remove characters like "à","è",etc when you specify a flag and a charset<br />
<br />
- htmlentities() function DOES NOT remove characters like those above when you DO NOT specify anything<br />
<br />
So, let's assume that..<br />
<br />
<span class="default">&lt;?php<br />
<br />
$str </span><span class="keyword">= </span><span class="string">"Hèèèllooo"</span><span class="keyword">;<br />
<br />
</span><span class="default">$res_1 </span><span class="keyword">= </span><span class="default">htmlentities</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">, </span><span class="default">ENT_QUOTES</span><span class="keyword">, </span><span class="string">"UTF-8"</span><span class="keyword">);<br />
</span><span class="default">$res_2 </span><span class="keyword">= </span><span class="default">htmlentities</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">);<br />
<br />
echo </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$res_1</span><span class="keyword">); </span><span class="comment">// Result: string '' (length=0)<br />
</span><span class="keyword">echo </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$res_2</span><span class="keyword">); </span><span class="comment">// string 'H&amp;egrave;&amp;egrave;&amp;egrave;llooo' (length=30)<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
I used this for a textarea content for comments. Anyway, note that using the "$res_2" form the function will leave unconverted single/double quotes. At this point you should use str_replace() function to perform the characters but be careful because..<br />
<br />
<span class="default">&lt;?php<br />
<br />
$str </span><span class="keyword">= </span><span class="string">"'Hèèèllooo'"</span><span class="keyword">;<br />
<br />
</span><span class="default">$res_2 </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"'"</span><span class="keyword">,</span><span class="string">"&amp;#039;"</span><span class="keyword">,</span><span class="default">$str</span><span class="keyword">);<br />
</span><span class="default">$res_2 </span><span class="keyword">= </span><span class="default">htmlentities</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">);<br />
echo </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$res_2</span><span class="keyword">); </span><span class="comment">// string '&amp;amp;#039;H&amp;egrave;&amp;egrave;&amp;egrave;llooo&amp;amp;#039;'<br />
<br />
</span><span class="default">$res_3 </span><span class="keyword">= </span><span class="default">htmlentities</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">);<br />
</span><span class="default">$res_3 </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"'"</span><span class="keyword">,</span><span class="string">"&amp;#039;"</span><span class="keyword">,</span><span class="default">$res_3</span><span class="keyword">);<br />
echo </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$res_3</span><span class="keyword">); </span><span class="comment">// string '&amp;#039;H&amp;egrave;&amp;egrave;&amp;egrave;llooo&amp;#039;' --&gt; Nice<br />
</span><span class="default">?&gt;<br />
</span><br />
Hope it will helps you.<br />
<br />
Regards,<br />
W.D.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="106535""></a>
  <div class="note">
   <strong class="user">steve at mcdragonsoftware dot com</strong>
   <a href="#106535" class="date">16-Nov-2011 08:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I'm glad 5.4 has xml support, but many of us are working with older installations, some of us still have to use PHP4. If you're like me you've been frustrated with trying to use htmlentites/htmlspecial chars with xml output. I was hoping to find an option to force numeric encoding, lacking that, I have written my own xmlencode function, which I now offer:
<br />

<br />
usage: 
<br />

<br />
$string xmlencode( $string )
<br />

<br />
it will use htmlspecialchars for the valid xml entities amp, quote, lt, gt, (apos) and return the numeric entity for all other non alpha-numeric characters.
<br />

<br />
-------------------------------------------
<br />

<br />
<span class="default">&lt;?php 
<br />
</span><span class="keyword">if( !</span><span class="default">function_exists</span><span class="keyword">( </span><span class="string">'xmlentities' </span><span class="keyword">) ) {
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">xmlentities</span><span class="keyword">( </span><span class="default">$string </span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$not_in_list </span><span class="keyword">= </span><span class="string">"A-Z0-9a-z\s_-"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">preg_replace_callback</span><span class="keyword">( </span><span class="string">"/[^</span><span class="keyword">{</span><span class="default">$not_in_list</span><span class="keyword">}</span><span class="string">]/" </span><span class="keyword">, </span><span class="string">'get_xml_entity_at_index_0' </span><span class="keyword">, </span><span class="default">$string </span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">get_xml_entity_at_index_0</span><span class="keyword">( </span><span class="default">$CHAR </span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( !</span><span class="default">is_string</span><span class="keyword">( </span><span class="default">$CHAR</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] ) || ( </span><span class="default">strlen</span><span class="keyword">( </span><span class="default">$CHAR</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] ) &gt; </span><span class="default">1 </span><span class="keyword">) ) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; die( </span><span class="string">"function: 'get_xml_entity_at_index_0' requires data type: 'char' (single character). '</span><span class="keyword">{</span><span class="default">$CHAR</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]}</span><span class="string">' does not match this type." </span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; switch( </span><span class="default">$CHAR</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] ) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">"'"</span><span class="keyword">:&nbsp; &nbsp; case </span><span class="string">'"'</span><span class="keyword">:&nbsp; &nbsp; case </span><span class="string">'&amp;'</span><span class="keyword">:&nbsp; &nbsp; case </span><span class="string">'&lt;'</span><span class="keyword">:&nbsp; &nbsp; case </span><span class="string">'&gt;'</span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">htmlspecialchars</span><span class="keyword">( </span><span class="default">$CHAR</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="default">ENT_QUOTES </span><span class="keyword">);&nbsp; &nbsp; break;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; default:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">numeric_entity_4_char</span><span class="keyword">(</span><span class="default">$CHAR</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]);&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }&nbsp; &nbsp; &nbsp; &nbsp; 
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">numeric_entity_4_char</span><span class="keyword">( </span><span class="default">$char </span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">"&amp;#"</span><span class="keyword">.</span><span class="default">str_pad</span><span class="keyword">(</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$char</span><span class="keyword">), </span><span class="default">3</span><span class="keyword">, </span><span class="string">'0'</span><span class="keyword">, </span><span class="default">STR_PAD_LEFT</span><span class="keyword">).</span><span class="string">";"</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }&nbsp; &nbsp; 
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="104288""></a>
  <div class="note">
   <strong class="user">Waygood</strong>
   <a href="#104288" class="date">06-Jun-2011 02:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When putting values inside comment tags &lt;!-- --&gt; you should replace -- with &amp;#45;&amp;#45; too, as this would end your tag and show the rest of the comment.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="103486""></a>
  <div class="note">
   <strong class="user">robin at robinwinslow dot co dot uk</strong>
   <a href="#103486" class="date">15-Apr-2011 08:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
htmlentities seems to have changed at some point between version 5.1.6 and 5.3.3, such that it now returns an empty string for anything containing a pound sign:<br />
<br />
$ php -v<br />
PHP 5.1.6 (cli) (built: May 22 2008 09:08:44)<br />
$ php -r "echo htmlentities('￡hello', null, 'utf-8');"<br />
&amp;pound;hello<br />
$<br />
<br />
$ php -v<br />
PHP 5.3.3 (cli) (built: Aug 19 2010 12:07:49)<br />
$ php -r "echo htmlentities('￡hello', null, 'utf-8');"<br />
$<br />
<br />
(Returns an empty string the second time)<br />
<br />
Just a heads up.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102621""></a>
  <div class="note">
   <strong class="user">admin at wapforum dot rs</strong>
   <a href="#102621" class="date">24-Feb-2011 01:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A useful little function to convert the symbols in the different inputs.<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">ConvertSimbols</span><span class="keyword">(</span><span class="default">$var</span><span class="keyword">, </span><span class="default">$ConvertQuotes </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">) {<br />
if (</span><span class="default">$ConvertQuotes </span><span class="keyword">&gt; </span><span class="default">0</span><span class="keyword">) {<br />
</span><span class="default">$var </span><span class="keyword">= </span><span class="default">htmlentities</span><span class="keyword">(</span><span class="default">$var</span><span class="keyword">, </span><span class="default">ENT_NOQUOTES</span><span class="keyword">, </span><span class="string">'UTF-8'</span><span class="keyword">);<br />
</span><span class="default">$var </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'\"'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$var</span><span class="keyword">);<br />
</span><span class="default">$var </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"\'"</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$var</span><span class="keyword">);<br />
} else {<br />
</span><span class="default">$var </span><span class="keyword">= </span><span class="default">htmlentities</span><span class="keyword">(</span><span class="default">$var</span><span class="keyword">, </span><span class="default">ENT_QUOTES</span><span class="keyword">, </span><span class="string">'UTF-8'</span><span class="keyword">);<br />
}<br />
return </span><span class="default">$var</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Usage with quotes for example message:<br />
<br />
$message = ConvertSimbols($message);<br />
<br />
Usage without quotes for example link:<br />
<br />
$link = ConvertSimbols($link, 1);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100186""></a>
  <div class="note">
   <strong class="user">drallen at cs dot uwaterloo dot ca</strong>
   <a href="#100186" class="date">29-Sep-2010 04:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A pointer to <a href="http://www.php.net/manual/en/function.mb-convert-encoding.php if your intention is to translate *all* characters in a charset to their corresponding HTML entities, not just named characters. Non-named characters will be replaced with HTML numeric encoding. eg:" rel="nofollow" target="_blank">http://www.php.net/manual/en/function.mb-convert-encoding.php if your intention is to translate *all* characters in a charset to their corresponding HTML entities, not just named characters. Non-named characters will be replaced with HTML numeric encoding. eg:</a><br />
<br />
$text = mb_convert_encoding($text, 'HTML-ENTITIES', "UTF-8");</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99984""></a>
  <div class="note">
   <strong class="user">h_guillaume at hotmail dot com</strong>
   <a href="#99984" class="date">17-Sep-2010 01:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I use this function to encode all the xml entities and also all the &amp;something; that are not defined in xml like &amp;trade;<br />
You can also decode what you encode with my decode function.<br />
My function works a little like the htmlentities.<br />
You can also add other string to the array if you want to exclude them from the encoding.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">xml_entity_decode</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">, </span><span class="default">$charset </span><span class="keyword">= </span><span class="string">'Windows-1252'</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Double decode, so if the value was &amp;amp;trade; it will become Trademark<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$text </span><span class="keyword">= </span><span class="default">html_entity_decode</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">, </span><span class="default">ENT_COMPAT</span><span class="keyword">, </span><span class="default">$charset</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$text </span><span class="keyword">= </span><span class="default">html_entity_decode</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">, </span><span class="default">ENT_COMPAT</span><span class="keyword">, </span><span class="default">$charset</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$text</span><span class="keyword">;<br />
}<br />
<br />
function </span><span class="default">xml_entities</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">, </span><span class="default">$charset </span><span class="keyword">= </span><span class="string">'Windows-1252'</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; </span><span class="comment">// Debug and Test<br />
&nbsp;&nbsp;&nbsp; // $text = "test &amp;amp; &amp;trade; &amp;amp;trade; abc &amp;reg; &amp;amp;reg; &amp;#45;";<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; // First we encode html characters that are also invalid in xml<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$text </span><span class="keyword">= </span><span class="default">htmlentities</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">, </span><span class="default">ENT_COMPAT</span><span class="keyword">, </span><span class="default">$charset</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// XML character entity array from Wiki<br />
&nbsp;&nbsp;&nbsp; // Note: &amp;apos; is useless in UTF-8 or in UTF-16<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$arr_xml_special_char </span><span class="keyword">= array(</span><span class="string">"&amp;quot;"</span><span class="keyword">,</span><span class="string">"&amp;amp;"</span><span class="keyword">,</span><span class="string">"&amp;apos;"</span><span class="keyword">,</span><span class="string">"&amp;lt;"</span><span class="keyword">,</span><span class="string">"&amp;gt;"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Building the regex string to exclude all strings with xml special char<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$arr_xml_special_char_regex </span><span class="keyword">= </span><span class="string">"(?"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; foreach(</span><span class="default">$arr_xml_special_char </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$arr_xml_special_char_regex </span><span class="keyword">.= </span><span class="string">"(?!</span><span class="default">$value</span><span class="string">)"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$arr_xml_special_char_regex </span><span class="keyword">.= </span><span class="string">")"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Scan the array for &amp;something_not_xml; syntax<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$pattern </span><span class="keyword">= </span><span class="string">"/</span><span class="default">$arr_xml_special_char_regex</span><span class="string">&amp;([a-zA-Z0-9]+;)/"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Replace the &amp;something_not_xml; with &amp;amp;something_not_xml;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$replacement </span><span class="keyword">= </span><span class="string">'&amp;amp;${1}'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="default">$pattern</span><span class="keyword">, </span><span class="default">$replacement</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99896""></a>
  <div class="note">
   <strong class="user">Sijmen Ruwhof</strong>
   <a href="#99896" class="date">13-Sep-2010 12:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
An important note below about using this function to secure your application against Cross Site Scripting (XSS) vulnerabilities.<br />
<br />
When printing user input in an attribute of an HTML tag, the default configuration of htmlEntities() doesn't protect you against XSS, when using single quotes to define the border of the tag's attribute-value. XSS is then possible by injecting a single quote:<br />
<br />
<span class="default">&lt;?php<br />
$_GET</span><span class="keyword">[</span><span class="string">'a'</span><span class="keyword">] = </span><span class="string">"#000' onload='alert(document.cookie)"</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
XSS possible (insecure):<br />
<br />
<span class="default">&lt;?php<br />
$href </span><span class="keyword">= </span><span class="default">htmlEntities</span><span class="keyword">(</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'a'</span><span class="keyword">]);<br />
print </span><span class="string">"&lt;body bgcolor='</span><span class="default">$href</span><span class="string">'&gt;"</span><span class="keyword">; </span><span class="comment"># results in: &lt;body bgcolor='#000' onload='alert(document.cookie)'&gt;<br />
</span><span class="default">?&gt;<br />
</span><br />
Use the 'ENT_QUOTES' quote style option, to ensure no XSS is possible and your application is secure:<br />
<br />
<span class="default">&lt;?php<br />
$href </span><span class="keyword">= </span><span class="default">htmlEntities</span><span class="keyword">(</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'a'</span><span class="keyword">], </span><span class="default">ENT_QUOTES</span><span class="keyword">);<br />
print </span><span class="string">"&lt;body bgcolor='</span><span class="default">$href</span><span class="string">'&gt;"</span><span class="keyword">; </span><span class="comment"># results in: &lt;body bgcolor='#000&amp;#039; onload=&amp;#039;alert(document.cookie)'&gt;<br />
</span><span class="default">?&gt;<br />
</span><br />
The 'ENT_QUOTES' option doesn't protect you against javascript evaluation in certain tag's attributes, like the 'href' attribute of the 'a' tag. When clicked on the link below, the given JavaScript will get executed:<br />
<br />
<span class="default">&lt;?php<br />
$_GET</span><span class="keyword">[</span><span class="string">'a'</span><span class="keyword">] = </span><span class="string">'javascript:alert(document.cookie)'</span><span class="keyword">;<br />
</span><span class="default">$href </span><span class="keyword">= </span><span class="default">htmlEntities</span><span class="keyword">(</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'a'</span><span class="keyword">], </span><span class="default">ENT_QUOTES</span><span class="keyword">);<br />
print </span><span class="string">"&lt;a href='</span><span class="default">$href</span><span class="string">'&gt;link&lt;/a&gt;"</span><span class="keyword">; </span><span class="comment"># results in: &lt;a href='javascript:alert(document.cookie)'&gt;link&lt;/a&gt;<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="97215""></a>
  <div class="note">
   <strong class="user">phil at lavin dot me dot uk</strong>
   <a href="#97215" class="date">08-Apr-2010 08:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The following will make a string completely safe for XML:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">philsXMLClean</span><span class="keyword">(</span><span class="default">$strin</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$strout </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$strin</span><span class="keyword">); </span><span class="default">$i</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ord </span><span class="keyword">= </span><span class="default">ord</span><span class="keyword">(</span><span class="default">$strin</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ((</span><span class="default">$ord </span><span class="keyword">&gt; </span><span class="default">0 </span><span class="keyword">&amp;&amp; </span><span class="default">$ord </span><span class="keyword">&lt; </span><span class="default">32</span><span class="keyword">) || (</span><span class="default">$ord </span><span class="keyword">&gt;= </span><span class="default">127</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$strout </span><span class="keyword">.= </span><span class="string">"&amp;amp;#</span><span class="keyword">{</span><span class="default">$ord</span><span class="keyword">}</span><span class="string">;"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; switch (</span><span class="default">$strin</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'&lt;'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$strout </span><span class="keyword">.= </span><span class="string">'&amp;lt;'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'&gt;'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$strout </span><span class="keyword">.= </span><span class="string">'&amp;gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'&amp;'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$strout </span><span class="keyword">.= </span><span class="string">'&amp;amp;'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'"'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$strout </span><span class="keyword">.= </span><span class="string">'&amp;quot;'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; default:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$strout </span><span class="keyword">.= </span><span class="default">$strin</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$strout</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86409""></a>
  <div class="note">
   <strong class="user">Tom Walter</strong>
   <a href="#86409" class="date">16-Oct-2008 07:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that as of 5.2.5 it appears that if the input string contains a character that is not valid for the output encoding you've specified, then this function returns null.<br />
<br />
You might expect it to just strip the invalid char, but it doesn't.<br />
<br />
You can strip the chars yourself like so:<br />
<br />
iconv('utf-8','utf-8',$str);<br />
<br />
You can combine that with htmlentities also:<br />
<br />
$str = htmlentities(iconv('UTF-8', 'UTF-8//IGNORE', $str, ENT_QUOTES, 'UTF-8');<br />
<br />
Should give you a string with htmlentities encoded to utf-8, and any unsupported chars stripped.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82534""></a>
  <div class="note">
   <strong class="user">za at byza dot it</strong>
   <a href="#82534" class="date">15-Apr-2008 09:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Trouble when using files with different charset?
<br />

<br />
htmlentities and html_entity_decode can be used to translate between charset! 
<br />

<br />
Sample function:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">utf2latin</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">) {
<br />
&nbsp;&nbsp; </span><span class="default">$text</span><span class="keyword">=</span><span class="default">htmlentities</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">,</span><span class="default">ENT_COMPAT</span><span class="keyword">,</span><span class="string">'UTF-8'</span><span class="keyword">);
<br />
&nbsp;&nbsp; return </span><span class="default">html_entity_decode</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">,</span><span class="default">ENT_COMPAT</span><span class="keyword">,</span><span class="string">'ISO-8859-1'</span><span class="keyword">);
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73708""></a>
  <div class="note">
   <strong class="user">q (dot) rendeiro (at) gmail (dot) com</strong>
   <a href="#73708" class="date">07-Mar-2007 04:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I've seen lots of functions to convert all the entities, but I needed to do a fulltext search in a db field that had named entities instead of numeric entities (edited by tinymce), so I searched the tinymce source and found a string with the value-&gt;entity mapping. So, i wrote the following function to encode the user's query with named entities.<br />
<br />
The string I used is different of the original, because i didn't want to convert ' or ". The string is too long, so I had to cut it. To get the original check TinyMCE source and search for nbsp or other entity ;)<br />
<br />
<span class="default">&lt;?php<br />
<br />
$entities_unmatched </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">','</span><span class="keyword">, </span><span class="string">'160,nbsp,161,iexcl,162,cent, [...] '</span><span class="keyword">);<br />
</span><span class="default">$even </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;<br />
foreach(</span><span class="default">$entities_unmatched </span><span class="keyword">as </span><span class="default">$c</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$even</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ord </span><span class="keyword">= </span><span class="default">$c</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$entities_table</span><span class="keyword">[</span><span class="default">$ord</span><span class="keyword">] = </span><span class="default">$c</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$even </span><span class="keyword">= </span><span class="default">1 </span><span class="keyword">- </span><span class="default">$even</span><span class="keyword">;<br />
}<br />
<br />
function </span><span class="default">encode_named_entities</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; global </span><span class="default">$entities_table</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$encoded_str </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; for(</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">); </span><span class="default">$i</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ent </span><span class="keyword">= @</span><span class="default">$entities_table</span><span class="keyword">[</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">{</span><span class="default">$i</span><span class="keyword">})];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$ent</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$encoded_str </span><span class="keyword">.= </span><span class="string">"&amp;</span><span class="default">$ent</span><span class="string">;"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$encoded_str </span><span class="keyword">.= </span><span class="default">$str</span><span class="keyword">{</span><span class="default">$i</span><span class="keyword">};<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$encoded_str</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="70964""></a>
  <div class="note">
   <strong class="user">realcj at g mail dt com</strong>
   <a href="#70964" class="date">06-Nov-2006 10:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are building a loadvars page for Flash and have problems with special chars such as " &amp; ", " ' " etc, you should escape them for flash:
<br />

<br />
Try trace(escape("&amp;")); in flash' actionscript to see the escape code for &amp;;
<br />

<br />
% = %25
<br />
&amp; = %26
<br />
' = %27
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">flashentities</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">){
<br />
return </span><span class="default">str_replace</span><span class="keyword">(array(</span><span class="string">"&amp;"</span><span class="keyword">,</span><span class="string">"'"</span><span class="keyword">),array(</span><span class="string">"%26"</span><span class="keyword">,</span><span class="string">"%27"</span><span class="keyword">),</span><span class="default">$string</span><span class="keyword">);
<br />
}
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Those are the two that concerned me. YMMV.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="42020""></a>
  <div class="note">
   <strong class="user">jake_mcmahon at hotmail dot com</strong>
   <a href="#42020" class="date">29-Apr-2004 02:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This fuction is particularly useful against XSS (cross-site-scripting-). XSS makes use of holes in code, whether it be in Javascript or PHP. XSS often, if not always, uses HTML entities to do its evil deeds, so this function in co-operation with your scripts (particularly search or submitting scripts) is a very useful tool in combatting "H4X0rz".</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="28197""></a>
  <div class="note">
   <strong class="user">Bassie (:</strong>
   <a href="#28197" class="date">05-Jan-2003 04:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that you'll have use htmlentities() before any other function who'll edit text like nl2br().<br />
<br />
If you use nl2br() first, the htmlentities() function will change &lt; br &gt; to &amp;lt;br&amp;gt;.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
