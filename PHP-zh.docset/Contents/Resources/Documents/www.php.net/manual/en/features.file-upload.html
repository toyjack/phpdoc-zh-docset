<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>文件上传处理</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="features.xforms.html">? 处理 XForms</a></li>
      <li style="float: right;"><a href="features.file-upload.post-method.html">POST 方法上传 ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="features.html">特点</a></li>
    <li>文件上传处理</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="features.file-upload" class="chapter">
 <h1>文件上传处理</h1>
<h2>Table of Contents</h2><ul class="chunklist chunklist_chapter"><li><a href="features.file-upload.post-method.html">POST 方法上传</a></li><li><a href="features.file-upload.errors.html">错误信息说明</a></li><li><a href="features.file-upload.common-pitfalls.html">常见缺陷</a></li><li><a href="features.file-upload.multiple.html">上传多个文件</a></li><li><a href="features.file-upload.put-method.html">对 PUT 方法的支持</a></li><li><a href="features.file-upload.errors.seealso.html">参见</a></li></ul>


 

 

 

 

 

 

</div>
<div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="116293""></a>
  <div class="note">
   <strong class="user">shubhamtakode at gmail dot com</strong>
   <a href="#116293" class="date">07-Dec-2014 05:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
// code for handling simple http uploads<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">//properties of the uploaded file<br />
</span><span class="default">$name</span><span class="keyword">= </span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">"myfile"</span><span class="keyword">][</span><span class="string">"name"</span><span class="keyword">];<br />
</span><span class="default">$type</span><span class="keyword">= </span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">"myfile"</span><span class="keyword">][</span><span class="string">"type"</span><span class="keyword">];<br />
</span><span class="default">$size</span><span class="keyword">= </span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">"myfile"</span><span class="keyword">][</span><span class="string">"size"</span><span class="keyword">];<br />
</span><span class="default">$temp</span><span class="keyword">= </span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">"myfile"</span><span class="keyword">][</span><span class="string">"temp_name"</span><span class="keyword">];<br />
</span><span class="default">$error</span><span class="keyword">= </span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">"myfile"</span><span class="keyword">][</span><span class="string">"error"</span><span class="keyword">];<br />
<br />
if (</span><span class="default">$error </span><span class="keyword">&gt; </span><span class="default">0</span><span class="keyword">)<br />
</span><span class="default">&nbsp;&nbsp;&nbsp; </span><span class="keyword">die(</span><span class="string">"Error uploading file! code </span><span class="default">$error</span><span class="string">."</span><span class="keyword">);<br />
else<br />
</span><span class="default">&nbsp;&nbsp; </span><span class="keyword">{<br />
</span><span class="default">&nbsp;&nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">$type</span><span class="keyword">==</span><span class="string">"image/png" </span><span class="keyword">|| </span><span class="default">$size </span><span class="keyword">&gt; </span><span class="default">2000000</span><span class="keyword">)</span><span class="comment">//condition for the file<br />
</span><span class="default">&nbsp;&nbsp;&nbsp; </span><span class="keyword">{<br />
</span><span class="default">&nbsp;&nbsp;&nbsp; </span><span class="keyword">die(</span><span class="string">"Format&nbsp; not allowed or file size too big!"</span><span class="keyword">);<br />
</span><span class="default">&nbsp;&nbsp;&nbsp; </span><span class="keyword">}<br />
</span><span class="default">&nbsp;&nbsp;&nbsp; </span><span class="keyword">else<br />
</span><span class="default">&nbsp;&nbsp;&nbsp; </span><span class="keyword">{<br />
</span><span class="default">&nbsp;&nbsp;&nbsp; &nbsp;move_uploaded_file</span><span class="keyword">(</span><span class="default">$temp</span><span class="keyword">, </span><span class="string">"uploaded/" </span><span class="keyword">.</span><span class="default">$name</span><span class="keyword">);<br />
</span><span class="default">&nbsp;&nbsp;&nbsp; &nbsp;echo </span><span class="string">"Upload complete!"</span><span class="keyword">; <br />
</span><span class="default">&nbsp;&nbsp;&nbsp; &nbsp;</span><span class="keyword">}<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="114004""></a>
  <div class="note">
   <strong class="user">CertaiN</strong>
   <a href="#114004" class="date">29-Dec-2013 11:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You'd better check $_FILES structure and values throughly.<br />
The following code cannot cause any errors absolutely.<br />
<br />
Example:<br />
<span class="default">&lt;?php<br />
<br />
header</span><span class="keyword">(</span><span class="string">'Content-Type: text/plain; CHARSET=gb2312'</span><span class="keyword">);<br />
<br />
try {<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Undefined | Multiple Files | $_FILES Corruption Attack<br />
&nbsp;&nbsp;&nbsp; // If this request falls under any of them, treat it invalid.<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; !isset(</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'upfile'</span><span class="keyword">][</span><span class="string">'error'</span><span class="keyword">]) ||<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'upfile'</span><span class="keyword">][</span><span class="string">'error'</span><span class="keyword">])<br />
&nbsp;&nbsp;&nbsp; ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; throw new </span><span class="default">RuntimeException</span><span class="keyword">(</span><span class="string">'Invalid parameters.'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Check $_FILES['upfile']['error'] value.<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">switch (</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'upfile'</span><span class="keyword">][</span><span class="string">'error'</span><span class="keyword">]) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">UPLOAD_ERR_OK</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">UPLOAD_ERR_NO_FILE</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; throw new </span><span class="default">RuntimeException</span><span class="keyword">(</span><span class="string">'No file sent.'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">UPLOAD_ERR_INI_SIZE</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">UPLOAD_ERR_FORM_SIZE</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; throw new </span><span class="default">RuntimeException</span><span class="keyword">(</span><span class="string">'Exceeded filesize limit.'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; default:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; throw new </span><span class="default">RuntimeException</span><span class="keyword">(</span><span class="string">'Unknown errors.'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// You should also check filesize here. <br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'upfile'</span><span class="keyword">][</span><span class="string">'size'</span><span class="keyword">] &gt; </span><span class="default">1000000</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; throw new </span><span class="default">RuntimeException</span><span class="keyword">(</span><span class="string">'Exceeded filesize limit.'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// DO NOT TRUST $_FILES['upfile']['mime'] VALUE !!<br />
&nbsp;&nbsp;&nbsp; // Check MIME Type by yourself.<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$finfo </span><span class="keyword">= new </span><span class="default">finfo</span><span class="keyword">(</span><span class="default">FILEINFO_MIME_TYPE</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">false </span><span class="keyword">=== </span><span class="default">$ext </span><span class="keyword">= </span><span class="default">array_search</span><span class="keyword">(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$finfo</span><span class="keyword">-&gt;</span><span class="default">file</span><span class="keyword">(</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'upfile'</span><span class="keyword">][</span><span class="string">'tmp_name'</span><span class="keyword">]),<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; array(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'jpg' </span><span class="keyword">=&gt; </span><span class="string">'image/jpeg'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'png' </span><span class="keyword">=&gt; </span><span class="string">'image/png'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'gif' </span><span class="keyword">=&gt; </span><span class="string">'image/gif'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; ),<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">true<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; throw new </span><span class="default">RuntimeException</span><span class="keyword">(</span><span class="string">'Invalid file format.'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// You should name it uniquely.<br />
&nbsp;&nbsp;&nbsp; // DO NOT USE $_FILES['upfile']['name'] WITHOUT ANY VALIDATION !!<br />
&nbsp;&nbsp;&nbsp; // On this example, obtain safe unique name from its binary data.<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (!</span><span class="default">move_uploaded_file</span><span class="keyword">(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'upfile'</span><span class="keyword">][</span><span class="string">'tmp_name'</span><span class="keyword">],<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">'./uploads/%s.%s'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">sha1_file</span><span class="keyword">(</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'upfile'</span><span class="keyword">][</span><span class="string">'tmp_name'</span><span class="keyword">]),<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ext<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; )) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; throw new </span><span class="default">RuntimeException</span><span class="keyword">(</span><span class="string">'Failed to move uploaded file.'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">'File is uploaded successfully.'</span><span class="keyword">;<br />
<br />
} catch (</span><span class="default">RuntimeException $e</span><span class="keyword">) {<br />
<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">$e</span><span class="keyword">-&gt;</span><span class="default">getMessage</span><span class="keyword">();<br />
<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="111489""></a>
  <div class="note">
   <strong class="user">jan at lanteraudio dot nl</strong>
   <a href="#111489" class="date">25-Feb-2013 01:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Also stumbled on the max_file_size problem, in particular getting no response, no error whatsoever when uploading a file bigger than the set upload_max_filesize.<br />
<br />
I found that it's not the upload_max_filesize setting, but instead the post_max_size setting causing this no response issue. So if you set post_max_size way larger than upload_max_filesize, at least you are likely to get an error response when filesize exceeds upload_max_filesize but is still within the limits of post_max_size.<br />
<br />
Hope this helps anyone.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="109495""></a>
  <div class="note">
   <strong class="user">Thomas</strong>
   <a href="#109495" class="date">22-Jul-2012 06:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
MIME type can be faked.
<br />

<br />
VVV
<br />

<br />
$_FILES['userfile']['type']
<br />

<br />
The mime type of the file, if the browser provided this information. An example would be "image/gif". This mime type is however not checked on the PHP side and therefore don't take its value for granted.
<br />

<br />
<a href="http://www.php.net/manual/en/features.file-upload.post-method.php" rel="nofollow" target="_blank">http://www.php.net/manual/en/features.file-upload.post-method.php</a>
<br />

<br />
[Editor's note: removed a reference to a deleted note, and edited the note to make sense by itself.]</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="107406""></a>
  <div class="note">
   <strong class="user">xmontero at dsitelecom dot com</strong>
   <a href="#107406" class="date">06-Feb-2012 10:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If "large files" (ie: 50 or 100 MB) fail, check this:<br />
<br />
It may happen that your outgoing connection to the server is slow, and it may timeout not the "execution time" but the "input time", which for example in our system defaulted to 60s. In our case a large upload could take 1 or 2 hours.<br />
<br />
Additionally we had "session settings" that should be preserved after upload.<br />
<br />
1) You might want review those ini entries:<br />
<br />
* session.gc_maxlifetime<br />
* max_input_time<br />
* max_execution_time<br />
* upload_max_filesize<br />
* post_max_size<br />
<br />
2) Still fails? Caution, not all are changeable from the script itself. ini_set() might fail to override.<br />
<br />
More info here:<br />
<a href="http://www.php.net/manual/es/ini.list.php" rel="nofollow" target="_blank">http://www.php.net/manual/es/ini.list.php</a><br />
<br />
You can see that the "upload_max_filesize", among others, is PHP_INI_PERDIR and not PHP_INI_ALL. This invalidates to use ini_set():<br />
<a href="http://www.php.net/manual/en/configuration.changes.modes.php" rel="nofollow" target="_blank">http://www.php.net/manual/en/configuration.changes.modes.php</a><br />
<br />
Use .htaccess instead.<br />
<br />
3) Still fails?. Just make sure you enabled ".htaccess" to overwrite your php settings. This is made in the apache file. You need at least AllowOverride Options.<br />
<br />
See this here:<br />
<a href="http://www.php.net/manual/en/configuration.changes.php" rel="nofollow" target="_blank">http://www.php.net/manual/en/configuration.changes.php</a><br />
<br />
You will necessarily allow this manually in the case your master files come with AllowOverride None.<br />
<br />
Conclussion:<br />
<br />
Depending on the system, to allow "large file uploads" you must go up and up and up and touch your config necessarily up to the apache config.<br />
<br />
Sample files:<br />
<br />
These work for me, for 100MB uploads, lasting 2 hours:<br />
<br />
In apache-virtual-host:<br />
-----------------------------------------------------------<br />
&lt;Directory /var/www/MyProgram&gt;<br />
&nbsp;&nbsp;&nbsp; AllowOverride Options<br />
&lt;/Directory&gt;<br />
-----------------------------------------------------------<br />
<br />
In .htaccess:<br />
-----------------------------------------------------------<br />
php_value session.gc_maxlifetime 10800<br />
php_value max_input_time&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 10800<br />
php_value max_execution_time&nbsp; &nbsp;&nbsp; 10800<br />
php_value upload_max_filesize&nbsp; &nbsp; 110M<br />
php_value post_max_size&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 120M<br />
-----------------------------------------------------------<br />
<br />
In the example,<br />
- As I last 1 to 2 hours, I allow 3 hours (3600x3)<br />
- As I need 100MB, I allow air above for the file (110M) and a bit more for the whole post (120M).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93602""></a>
  <div class="note">
   <strong class="user">Phil Ciebiera</strong>
   <a href="#93602" class="date">17-Sep-2009 01:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
On a Microsoft platform utilizing IIS, you may run into a situation where, upon moving the uploaded file, anonymous web users can't access the content without being prompted to authenticate first...<br />
<br />
The reason for this is, the uploaded file will inherit the permissions of the directory specified in the directive upload_tmp_dir of php.ini.&nbsp; If this directive isn't set, the default of C:\Windows\Temp is used.<br />
<br />
You can work around this by granting the IUSR_[server name] user read access to your temporary upload directory, so that after you move_uploaded_file the permissions will already be set properly.<br />
<br />
It's also a good idea to set the Execute Permissions of the upload directory to NOT include Executables, for security reasons.&nbsp; <br />
To accomplish this:<br />
-Open the IIS Manager<br />
-Browse to the relevant sites directory where the uploads will be placed<br />
-Right Click the folder and select Properties<br />
-In the Directory tab of the resulting dialog, set the Execute permissions to be None<br />
<br />
This took me a while to figure out, so I hope this helps save some other peoples time.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="88591""></a>
  <div class="note">
   <strong class="user">info at levaravel dot com</strong>
   <a href="#88591" class="date">30-Jan-2009 07:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A little codesnippet which returns a filesize in a more legible format.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">display_filesize</span><span class="keyword">(</span><span class="default">$filesize</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">is_numeric</span><span class="keyword">(</span><span class="default">$filesize</span><span class="keyword">)){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$decr </span><span class="keyword">= </span><span class="default">1024</span><span class="keyword">; </span><span class="default">$step </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$prefix </span><span class="keyword">= array(</span><span class="string">'Byte'</span><span class="keyword">,</span><span class="string">'KB'</span><span class="keyword">,</span><span class="string">'MB'</span><span class="keyword">,</span><span class="string">'GB'</span><span class="keyword">,</span><span class="string">'TB'</span><span class="keyword">,</span><span class="string">'PB'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; while((</span><span class="default">$filesize </span><span class="keyword">/ </span><span class="default">$decr</span><span class="keyword">) &gt; </span><span class="default">0.9</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$filesize </span><span class="keyword">= </span><span class="default">$filesize </span><span class="keyword">/ </span><span class="default">$decr</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$step</span><span class="keyword">++;<br />
&nbsp;&nbsp;&nbsp; } <br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">round</span><span class="keyword">(</span><span class="default">$filesize</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">).</span><span class="string">' '</span><span class="keyword">.</span><span class="default">$prefix</span><span class="keyword">[</span><span class="default">$step</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; } else {<br />
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="string">'NaN'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="87989""></a>
  <div class="note">
   <strong class="user">damien from valex</strong>
   <a href="#87989" class="date">04-Jan-2009 05:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is simpler method of checking for too much POST data (alternative to that by v3 from sonic-world.ru).<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'REQUEST_METHOD'</span><span class="keyword">] == </span><span class="string">'POST' </span><span class="keyword">&amp;&amp; empty(</span><span class="default">$_POST</span><span class="keyword">) &amp;&amp; </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'CONTENT_LENGTH'</span><span class="keyword">] &gt; </span><span class="default">0</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">'The server was unable to handle that much POST data (%s bytes) due to its current configuration'</span><span class="keyword">, </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'CONTENT_LENGTH'</span><span class="keyword">]));<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="87216""></a>
  <div class="note">
   <strong class="user">rnagavel at yahoo dot com dot au</strong>
   <a href="#87216" class="date">25-Nov-2008 01:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If $_FILES is always empty, check the method of your form.<br />
It should be POST. Default method of a form is GET.<br />
<br />
&lt;form action="myaction.php"&gt;<br />
&nbsp;&lt;input type="file" name"userfile"&gt;<br />
&lt;/form&gt;<br />
File will not be uploaded as default method of the form is GET.<br />
<br />
&lt;form action="myaction.php" method="POST"&gt;<br />
&nbsp;&lt;input type="file" name"userfile"&gt;<br />
&lt;/form&gt;<br />
Files will be uploaded and $_FILES will be populated.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82869""></a>
  <div class="note">
   <strong class="user">jahajee</strong>
   <a href="#82869" class="date">29-Apr-2008 04:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
hi , i was having difficulty with the upload_max_filesize , if u set the max file size lesser than the php setting then ur script to report error will only work till this difference between ur max set file size and the php set max size .Hence if the uploaded file exceeds the php max file size then php end abruptly without a trace of error that is it behaves like no file is uploaded and hence no error reported .Sure if uploading a file is optional for a form then a user who uploads larger file will get no error and still the form will be processed only without the file.<br />
The method of using GET can't be used for optional uploads. Can't find help even in the bugs .Be careful with optional uploads.<br />
jahajee</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82762""></a>
  <div class="note">
   <strong class="user">Rob</strong>
   <a href="#82762" class="date">24-Apr-2008 01:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You should not have any directories within your website root that has the permissions required for file upload.&nbsp; If you are going to do a file upload, I recommend you use the PHP FTP Functions in conjunction with your file field, that way the files are transferred to a remote FTP location separate from your server.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="78017""></a>
  <div class="note">
   <strong class="user">ragtime at alice-dsl dot com</strong>
   <a href="#78017" class="date">24-Sep-2007 08:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I don't believe the myth that 'memory_size' should be the size of the uploaded file. The files are definitely not kept in memory... instead uploaded chunks of 1MB each are stored under /var/tmp and later on rebuild under /tmp before moving to the web/user space.
<br />

<br />
I'm running a linux-box with only 64MB RAM, setting the memory_limit to 16MB and uploading files of sizes about 100MB is no problem at all! Nevertheless, some users reported a problem at a few 100MB, but that's not confirmed... ;-)
<br />

<br />
The other sizes in php.ini are set to 1GB and the times to 300... maybe the execution_time limits before, since the CPU is just a 233MHz one... :-)
<br />

<br />
====
<br />

<br />
OK,... I got it... finally!
<br />

<br />
If some of you have also problems uploading large files but the usual sizes/times in php.ini are ok, please check 
<br />

<br />
&nbsp;&nbsp;&nbsp; session.gc_maxlifetime
<br />

<br />
when you are using session management with your upload script!
<br />

<br />
The default value is 1440 which is just 24min... so with only 600kbit/s upload rate the session will be closed automatically after uploading
<br />
about 100MB. Actually you are able to upload more, but the file won't be copied from the temporary to the destination folder... ;-)
<br />

<br />
You can set the value also directly inside the php-script via 
<br />
<span class="default">&lt;?php ini_set</span><span class="keyword">(</span><span class="string">"session.gc_maxlifetime"</span><span class="keyword">,</span><span class="string">"10800"</span><span class="keyword">); </span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74692""></a>
  <div class="note">
   <strong class="user">svenr at selfhtml dot org</strong>
   <a href="#74692" class="date">23-Apr-2007 03:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Clarification on the MAX_FILE_SIZE hidden form field:<br />
<br />
PHP has the somewhat strange feature of checking multiple "maximum file sizes". <br />
<br />
The two widely known limits are the php.ini settings "post_max_size" and "upload_max_size", which in combination impose a hard limit on the maximum amount of data that can be received.<br />
<br />
In addition to this PHP somehow got implemented a soft limit feature. It checks the existance of a form field names "max_file_size" (upper case is also OK), which should contain an integer with the maximum number of bytes allowed. If the uploaded file is bigger than the integer in this field, PHP disallows this upload and presents an error code in the $_FILES-Array.<br />
<br />
The PHP documentation also makes (or made - see bug #40387 - <a href="http://bugs.php.net/bug.php?id=40387" rel="nofollow" target="_blank">http://bugs.php.net/bug.php?id=40387</a>) vague references to "allows browsers to check the file size before uploading". This, however, is not true and has never been. Up til today there has never been a RFC proposing the usage of such named form field, nor has there been a browser actually checking its existance or content, or preventing anything. The PHP documentation implies that a browser may alert the user that his upload is too big - this is simply wrong.<br />
<br />
Please note that using this PHP feature is not a good idea. A form field can easily be changed by the client. If you have to check the size of a file, do it conventionally within your script, using a script-defined integer, not an arbitrary number you got from the HTTP client (which always must be mistrusted from a security standpoint).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="70471""></a>
  <div class="note">
   <strong class="user">jedi_aka at yahoo dot com</strong>
   <a href="#70471" class="date">18-Oct-2006 12:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For those of you trying to make the upload work with IIS on windows XP/2000/XP Media and alike here is a quick todo.<br />
<br />
1) Once you have created subdirectories "uploads/"&nbsp; in the same directory wher you code is running use the code from oportocala above and to make absolutely sure sure that the file you are trying to right is written under that folder. ( I recomend printing it using echo $uploadfile; )<br />
<br />
2) In windows explorer browse to the upload directory created above and share it. To do that execute the following substeps.<br />
&nbsp;&nbsp; &nbsp; a) Right click the folder click "sharing and security..."<br />
&nbsp;&nbsp; &nbsp; b) Check 'Share this folder on the network'<br />
&nbsp;&nbsp; &nbsp; c) Check 'Allow network users to change my files' ( THIS STEP IS VERY IMPORTANT )<br />
&nbsp;&nbsp; &nbsp; d) click 'ok' or 'apply' <br />
<br />
3) you can then go in the IIS to set read and write permissions for it. To do that execute the followin substeps.<br />
&nbsp;&nbsp; &nbsp; a) Open IIS (Start/Controp Panel (classic View)/ Admistrative tools/Internet Information Service<br />
&nbsp;&nbsp; &nbsp; b) Browse to your folder (the one we created above)<br />
&nbsp;&nbsp; &nbsp; c) right click and select properties.<br />
&nbsp;&nbsp; &nbsp; d) in the Directory tab, make sure, READ, WRITE, AND DIRECTORY BROWSING are checked.<br />
&nbsp;&nbsp; &nbsp; e) For the security freaks out there, You should also make sure that 'execute permissions:' are set to Script only or lower (DO NOT SET IT TO 'script and executable)'( that is because someone could upload a script to your directory and run it. And, boy, you do not want that to happen).<br />
<br />
there U go.<br />
<br />
Send me feed back it if worked for you or not so that I can update the todo.<br />
<br />
jedi_aka@yahoo.com<br />
<br />
PS: BIG thanks to oportocala</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="66025""></a>
  <div class="note">
   <strong class="user">david at cygnet dot be</strong>
   <a href="#66025" class="date">12-May-2006 05:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are experiencing problems posting files from Internet Explorer to a PHP script over an SSL connection, for instance "Page can not be displayed" or empty $_FILES and $_POST arrays (described by jason 10-Jan-2006 02:08), then check out this microsoft knowledgebase article:<br />
<br />
<a href="http://support.microsoft.com/?kbid=889334" rel="nofollow" target="_blank">http://support.microsoft.com/?kbid=889334</a><br />
<br />
This knowledgebase article explains how since service pack 2 there may be problems posting from IE over SSL. It is worth checking whether your problem is IE specific since this is definitely not a PHP problem!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="60024""></a>
  <div class="note">
   <strong class="user">geert dot php at myrosoft dot com</strong>
   <a href="#60024" class="date">23-Dec-2005 12:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When file names do contain single quote parts of the filename are being lost.<br />
eg.: uploading a filename <br />
&nbsp;&nbsp; &nbsp;&nbsp; startName 'middlepart' endName.txt<br />
will be uploaded (and hence stored in the _Files ['userfile'] variable as <br />
&nbsp;&nbsp; &nbsp;&nbsp; endName.txt <br />
skipping everything before the second single quote.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="59156""></a>
  <div class="note">
   <strong class="user">djot at hotmail dot com</strong>
   <a href="#59156" class="date">27-Nov-2005 02:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
-
<br />
Be carefull with setting max_file_size via
<br />
<span class="default">&lt;?php ini_get</span><span class="keyword">(</span><span class="string">'upload_max_filesize'</span><span class="keyword">); </span><span class="default">?&gt;
<br />
</span>
<br />
ini_get might return values like "2M" which will result in non working uploads.
<br />

<br />
This was the "no no" in my case:
<br />

<br />
<span class="default">&lt;?php
<br />
$form </span><span class="keyword">= </span><span class="string">'&lt;input type="hidden" name="MAX_FILE_SIZE" value=".ini_get('</span><span class="default">upload_max_filesize</span><span class="string">')." /&gt;'</span><span class="keyword">;
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Files were uploaded to the server, but than there was not any upload information, not even an error message. $_FILES was completly empty.
<br />

<br />
djot
<br />
-</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="56138""></a>
  <div class="note">
   <strong class="user">mariodivece at bytedive dot com</strong>
   <a href="#56138" class="date">24-Aug-2005 11:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just wanted to point out a detail that might be of interest to some:<br />
<br />
when using base64_encode to store binary data in a database, you are increasing the size of the data by 1.33 times. There is a nicer way of storing the data directly. Try the following: <br />
<br />
<span class="default">&lt;?php $data </span><span class="keyword">= </span><span class="default">mysql_real_escape_string</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">); </span><span class="default">?&gt;<br />
</span><br />
This will leave the data untouched and formatted in the correct way and ready to be inserted right into a MySQL statement without wasting space.<br />
<br />
By the way, I'd like to thank therebechips for his excellent advice on data chunks.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="55958""></a>
  <div class="note">
   <strong class="user">warwickbarnes at yahoo dot co dot uk</strong>
   <a href="#55958" class="date">18-Aug-2005 04:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You may come across the following problem using PHP on Microsoft IIS: getting permission denied errors from the move_uploaded_file function even when all the folder permissions seem correct. I had to set the following to get it to work:<br />
<br />
1. Write permissions on the the folder through the IIS management console.<br />
2. Write permissions to IUSR_'server' in the folder's security settings.<br />
3. Write permissions to "Domain Users" in the folder's security settings.<br />
<br />
The third setting was required because my application itself lives in a secure folder - using authentication (either Basic or Windows Integrated) to identify the users. When the uploads happen IIS seems to be checking that these users have write access to the folder, not just whether the web server (IUSR_'server') has access.<br />
<br />
Also, remember to set "Execute Permissions" to "None" in the IIS management console, so that people can't upload a script file and then run it. (Other checks of the uploaded file are recommended as well but 'Execute None' is a good start.)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="55886""></a>
  <div class="note">
   <strong class="user">myko AT blue needle DOT com</strong>
   <a href="#55886" class="date">16-Aug-2005 09:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just a quick note that there's an issue with Apache, the MAX_FILE_SIZE hidden form field, and zlib.output_compression = On.&nbsp; Seems that the browser continues to post up the entire file, even though PHP throws the MAX_FILE_SIZE error properly.&nbsp; Turning zlib compression to OFF seems to solve the issue.&nbsp; Don't have time to dig in and see who's at fault, but wanted to save others the hassle of banging their head on this one.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="53133""></a>
  <div class="note">
   <strong class="user">keith at phpdiary dot org</strong>
   <a href="#53133" class="date">24-May-2005 04:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Caution: *DO NOT* trust $_FILES['userfile']['type'] to verify the uploaded filetype; if you do so your server could be compromised.&nbsp; I'll show you why below:<br />
<br />
The manual (if you scroll above) states: $_FILES['userfile']['type'] -&nbsp; The mime type of the file, if the browser provided this information. An example would be "image/gif".<br />
<br />
Be reminded that this mime type can easily be faked as PHP doesn't go very far in verifying whether it really is what the end user reported!<br />
<br />
So, someone could upload a nasty .php script as an "image/gif" and execute the url to the "image".<br />
<br />
My best bet would be for you to check the extension of the file and using exif_imagetype() to check for valid images.&nbsp; Many people have suggested the use of getimagesize() which returns an array if the file is indeed an image and false otherwise, but exif_imagetype() is much faster. (the manual says it so)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="52989""></a>
  <div class="note">
   <strong class="user">ceo at l-i-e dot com</strong>
   <a href="#52989" class="date">19-May-2005 08:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Using /var/www/uploads in the example code is just criminal, imnsho.<br />
<br />
One should *NOT* upload untrusted files into your web tree, on any server.<br />
<br />
Nor should any directory within your web tree have permissions sufficient for an upload to succeed, on a shared server. Any other user on that shared server could write a PHP script to dump anything they want in there!<br />
<br />
The $_FILES['userfile']['type'] is essentially USELESS.<br />
A. Browsers aren't consistent in their mime-types, so you'll never catch all the possible combinations of types for any given file format.<br />
B. It can be forged, so it's crappy security anyway.<br />
<br />
One's code should INSPECT the actual file to see if it looks kosher.<br />
<br />
For example, images can quickly and easily be run through imagegetsize and you at least know the first N bytes LOOK like an image.&nbsp; That doesn't guarantee it's a valid image, but it makes it much less likely to be a workable security breaching file.<br />
<br />
For Un*x based servers, one could use exec and 'file' command to see if the Operating System thinks the internal contents seem consistent with the data type you expect.<br />
<br />
I've had trouble in the past with reading the '/tmp' file in a file upload.&nbsp; It would be nice if PHP let me read that file BEFORE I tried to move_uploaded_file on it, but PHP won't, presumably under the assumption that I'd be doing something dangerous to read an untrusted file.&nbsp; Fine.&nbsp;&nbsp; One should move the uploaded file to some staging directory.&nbsp; Then you check out its contents as thoroughly as you can.&nbsp; THEN, if it seems kosher, move it into a directory outside your web tree.&nbsp; Any access to that file should be through a PHP script which reads the file.&nbsp; Putting it into your web tree, even with all the checks you can think of, is just too dangerous, imnsho.<br />
<br />
There are more than a few User Contributed notes here with naive (bad) advice.&nbsp; Be wary.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="51541""></a>
  <div class="note">
   <strong class="user">robpet at tds dot net</strong>
   <a href="#51541" class="date">02-Apr-2005 10:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
People have remarked that incorrect permissions on the upload directory may prevent photos or other files from uploading.&nbsp; Setting the Apache owner of the directory incorrectly will also prevent files from uploading -- I use a PHP script that creates a directory (if it doesn't exist already) before placing an uploaded file into it.&nbsp; When the script creates the directory and then copies the uploaded file into the directory there is no problem because the owner of the file is whatever Apache is running as, typically "nobody". However, lets say that I've moved the site to a new server and have copied over existing file directories using FTP.&nbsp; In this case the owner will have a different name from the Apache owner and files will not upload. The solution is to TelNet into the site and reset the owner to "nobody" or whatever Apache is running as using the CHOWN command.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="49807""></a>
  <div class="note">
   <strong class="user">Leevi at izilla dot com dot au</strong>
   <a href="#49807" class="date">08-Feb-2005 10:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This may help a newbie to file uploads.. it took advice from a friend to fix it..<br />
<br />
If you are using<br />
-windows xp<br />
-iis 5<br />
-php 5<br />
<br />
If you keep getting permission errors on file uploads... and you have sworn you set the permissions to write to the directory in iis... <br />
<br />
double check that<br />
a) in windows explorer under tools &gt; folder options<br />
click the view tab<br />
scroll down all the way to "use simple file sharing (recommended)"<br />
uncheck this box<br />
<br />
b) find the folder you wish to upload to on your server<br />
c) click properties and then the security tab<br />
d) make sure the appropriate write settings are checked.<br />
<br />
you may want to test by setting "everyone" to have full permission....<br />
<br />
BEWARE doing this will open up big security holes on your server....<br />
<br />
hope this helps<br />
<br />
Leevi Graham</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="48809""></a>
  <div class="note">
   <strong class="user">Tyfud</strong>
   <a href="#48809" class="date">07-Jan-2005 08:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It's important to note that when using the move_uploaded_file() command, that some configurations (Especially IIS) will fail if you prefix the destination path with a leading "/". Try the following:
<br />

<br />
<span class="default">&lt;?php move_uploaded_file</span><span class="keyword">(</span><span class="default">$tmpFileName</span><span class="keyword">,</span><span class="string">'uploads/'</span><span class="keyword">.</span><span class="default">$fileName</span><span class="keyword">); </span><span class="default">?&gt;
<br />
</span>
<br />
Setting up permissions is also a must. Make sure all accounts have write access to your upload directory, and read access if you wish to view these files later. You might have to chmod() the directory or file afterwards as well if you're still getting access errors.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="45168""></a>
  <div class="note">
   <strong class="user">therhinoman at hotmail dot com</strong>
   <a href="#45168" class="date">27-Aug-2004 01:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If your upload script is meant only for uploading images, you can use the image function getimagesize() (does not require the GD image library) to make sure you're really getting an image and also filter image types.
<br />

<br />
<span class="default">&lt;?php getimagesize</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">); </span><span class="default">?&gt;
<br />
</span>
<br />
...will return false if the file is not an image or is not accessable, otherwise it will return an array...
<br />

<br />
<span class="default">&lt;?php
<br />
$file </span><span class="keyword">= </span><span class="string">'somefile.jpg'</span><span class="keyword">;
<br />

<br />
</span><span class="comment"># assuming you've already taken some other
<br />
# preventive measures such as checking file
<br />
# extensions...
<br />

<br />
</span><span class="default">$result_array </span><span class="keyword">= </span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);
<br />

<br />
if (</span><span class="default">$result_array </span><span class="keyword">!== </span><span class="default">false</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$mime_type </span><span class="keyword">= </span><span class="default">$result_array</span><span class="keyword">[</span><span class="string">'mime'</span><span class="keyword">];
<br />
&nbsp;&nbsp;&nbsp; switch(</span><span class="default">$mime_type</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">"image/jpeg"</span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"file is jpeg type"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">"image/gif"</span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"file is gif type"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; default:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"file is an image, but not of gif or jpeg type"</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
} else {
<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"file is not a valid image file"</span><span class="keyword">;
<br />
}
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
using this function along with others mentioned on this page, image ploading can be made pretty much fool-proof.
<br />

<br />
See <a href="http://php.net/manual/en/function.getimagesize.php for supported image types and more info." rel="nofollow" target="_blank">http://php.net/manual/en/function.getimagesize.php for supported image types and more info.</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="43372""></a>
  <div class="note">
   <strong class="user">olijon, iceland</strong>
   <a href="#43372" class="date">18-Jun-2004 08:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When uploading large images, I got a "Document contains no data" error when using Netscape and an error page when using Explorer. My server setup is RH Linux 9, Apache 2 and PHP 4.3.<br />
<br />
I found out that the following entry in the httpd.conf file was missing:<br />
<br />
&lt;Files *.php&gt;<br />
&nbsp; SetOutputFilter PHP<br />
&nbsp; SetInputFilter PHP<br />
&nbsp; LimitRequestBody 524288 (max size in bytes)<br />
&lt;/Files&gt;<br />
<br />
When this had been added, everything worked smoothly.<br />
<br />
- Oli Jon, Iceland</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="41615""></a>
  <div class="note">
   <strong class="user">steve dot criddle at crd-sector dot com</strong>
   <a href="#41615" class="date">16-Apr-2004 11:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
IE on the Mac is a bit troublesome.&nbsp; If you are uploading a file with an unknown file suffix, IE uploads the file with a mime type of "application/x-macbinary".&nbsp; The resulting file includes the resource fork wrapped around the file.&nbsp; Not terribly useful.
<br />

<br />
The following code assumes that the mime type is in $type, and that you have loaded the file's contents into $content.&nbsp; If the file is in MacBinary format, it delves into the resource fork header, gets the length of the data fork (bytes 83-86) and uses that to get rid of the resource fork.
<br />

<br />
(There is probably a better way to do it, but this solved my problem):
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">if (</span><span class="default">$type </span><span class="keyword">== </span><span class="string">'application/x-macbinary'</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$content</span><span class="keyword">) &lt; </span><span class="default">128</span><span class="keyword">) die(</span><span class="string">'File too small'</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$length </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">83</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">&lt;=</span><span class="default">86</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$length </span><span class="keyword">= (</span><span class="default">$length </span><span class="keyword">* </span><span class="default">256</span><span class="keyword">) + </span><span class="default">ord</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$content</span><span class="keyword">,</span><span class="default">$i</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">));
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$content </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$content</span><span class="keyword">,</span><span class="default">128</span><span class="keyword">,</span><span class="default">$length</span><span class="keyword">);
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="39796""></a>
  <div class="note">
   <strong class="user">~caetin~ ( at ) ~hotpop~ ( dot ) ~com~</strong>
   <a href="#39796" class="date">10-Feb-2004 08:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
From the manual: <br />
<br />
&nbsp;&nbsp; &nbsp; If no file is selected for upload in your form, PHP will return $_FILES['userfile']['size'] as 0, and $_FILES['userfile']['tmp_name'] as none. <br />
<br />
As of PHP 4.2.0, the "none" is no longer a reliable determinant of no file uploaded. It's documented if you click on the "error codes" link, but you need to look at the $_FILES['your_file']['error']. If it's 4, then no file was selected.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="39654""></a>
  <div class="note">
   <strong class="user">maya_gomez ~ at ~ mail ~ dot ~ ru</strong>
   <a href="#39654" class="date">06-Feb-2004 05:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
when you upload the file, $_FILES['file']['name'] contains its original name converted into server's default charset.
<br />
if a name contain characters that aren't present in default charset, the conversion fails and the $_FILES['file']['name'] remains in original charset.
<br />

<br />
i've got this behavior when uploading from a windows-1251 environment into koi8-r. if a filename has the number sign "?" (0xb9), it DOES NOT GET CONVERTED as soon as there is no such character in koi8-r.
<br />

<br />
Workaround i use:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">if (</span><span class="default">strstr </span><span class="keyword">(</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'file'</span><span class="keyword">][</span><span class="string">'name'</span><span class="keyword">], </span><span class="default">chr</span><span class="keyword">(</span><span class="default">0xb9</span><span class="keyword">)) != </span><span class="string">""</span><span class="keyword">)
<br />
{
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'file'</span><span class="keyword">][</span><span class="string">'name'</span><span class="keyword">] = </span><span class="default">iconv </span><span class="keyword">(
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"windows-1251"</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"koi8-r"</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">str_replace </span><span class="keyword">(</span><span class="default">chr</span><span class="keyword">(</span><span class="default">0xb9</span><span class="keyword">), </span><span class="string">"N."</span><span class="keyword">, </span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'file'</span><span class="keyword">][</span><span class="string">'name'</span><span class="keyword">]));
<br />
};
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="30377""></a>
  <div class="note">
   <strong class="user">garyds at miraclemedia dot ca</strong>
   <a href="#30377" class="date">15-Mar-2003 06:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As it has been mentioned, Windows-based servers have trouble with the path to move the uploaded file to when using move_uploaded_file()... this may also be the reason copy() works and not move_uploaded_file(), but of course move_uploaded_file() is a much better method to use. The solution in the aforementioned note said you must use "\\" in the path, but I found "/" works as well. So to get a working path, I used something to the effect of:
<br />

<br />
"g:/rootdir/default/www/".$_FILES['userfile']['name']
<br />

<br />
...which worked like a charm.
<br />

<br />
I am using PHP 4.3.0 on a win2k server.
<br />

<br />
Hope this helps!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="19926""></a>
  <div class="note">
   <strong class="user">am at netactor dot NO_SPAN dot com</strong>
   <a href="#19926" class="date">14-Mar-2002 10:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Your binary files may be uploaded incorrectly if you use modules what recode characters. For example, for Russian Apache, you should use <br />
&lt;Files ScriptThatReceivesUploads.php&gt;<br />
CharsetDisable On<br />
&lt;/Files&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
