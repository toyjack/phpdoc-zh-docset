<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>程序执行函数</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="exec.constants.html">? 预定义常量</a></li>
      <li style="float: right;"><a href="function.escapeshellarg.html">escapeshellarg ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="book.exec.html">程序执行</a></li>
    <li>程序执行函数</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="ref.exec" class="reference">
  <h1 class="title">程序执行函数</h1>

  <div class="partintro">

   <div class="section" id="exec.notes">
    <h2 class="title">注释</h2>
    <div class="warning"><strong class="warning">Warning</strong>
     <p class="para">
      以加锁方式打开的文件（特别是在打开会话时），
      必须在执行后台程序之前关闭。
     </p>
    </div>
   </div>

   <div class="section" id="exec.seealso">
   <h2 class="title">参见</h2>
    <p class="para">
     这些函数和
     <a href="language.operators.execution.html" class="link">执行运算符</a> 是紧密关联的。
     因此，当运行在 <a href="ini.sect.safe-mode.html#ini.safe-mode" class="link">安全模式</a> 是，你必须考虑
     <a href="ini.sect.safe-mode.html#ini.safe-mode-exec-dir" class="link">
     safe_mode_exec_dir</a> 指示。
    </p>
   </div>

  </div>


































































  





























 <h2>Table of Contents</h2><ul class="chunklist chunklist_reference"><li><a href="function.escapeshellarg.html">escapeshellarg</a> &mdash; 把字符串转码为可以在 shell 命令里使用的参数</li><li><a href="function.escapeshellcmd.html">escapeshellcmd</a> &mdash; shell 元字符转义</li><li><a href="function.exec.html">exec</a> &mdash; 执行一个外部程序</li><li><a href="function.passthru.html">passthru</a> &mdash; 执行外部程序并且显示原始输出</li><li><a href="function.proc-close.html">proc_close</a> &mdash; 关闭由 proc_open 打开的进程并且返回进程退出码</li><li><a href="function.proc-get-status.html">proc_get_status</a> &mdash; 获取由 proc_open 函数打开的进程的信息</li><li><a href="function.proc-nice.html">proc_nice</a> &mdash; 修改当前进程的优先级</li><li><a href="function.proc-open.html">proc_open</a> &mdash; 执行一个命令，并且打开用来输入/输出的文件指针。</li><li><a href="function.proc-terminate.html">proc_terminate</a> &mdash; 杀除由 proc_open 打开的进程</li><li><a href="function.shell-exec.html">shell_exec</a> &mdash; 通过 shell 环境执行命令，并且将完整的输出以字符串的方式返回。</li><li><a href="function.system.html">system</a> &mdash; 执行外部程序，并且显示输出</li></ul>
</div>
<div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="120738""></a>
  <div class="note">
   <strong class="user">HappyDog, kennel17.co.uk</strong>
   <a href="#120738" class="date">04-Mar-2017 12:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just following up my previous post, in reply to lancelot--du-lac at hotmail dot fr:<br />
<br />
The behaviour described was fixed in PHP 5.3 in the following commit:<br />
<br />
https://github.com/php/php-src/commit/19322fc782af429938da8d3b421c0807cf1b848a#diff-15f2d3ef68f383a87cce668765721041R221<br />
<br />
To replicate the fix in your own code, so it also runs on PHP 5.2, instead of:<br />
<br />
<span class="default">&lt;?php<br />
$cmd </span><span class="keyword">= </span><span class="string">"...any shell command, maybe with multiple quotes..."</span><span class="keyword">;<br />
</span><span class="default">exec</span><span class="keyword">(</span><span class="default">$cmd</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
use<br />
<br />
<span class="default">&lt;?php<br />
$cmd </span><span class="keyword">= </span><span class="string">"...any shell command, maybe with multiple quotes..."</span><span class="keyword">;<br />
<br />
if (</span><span class="default">strtoupper</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">php_uname</span><span class="keyword">(</span><span class="string">'s'</span><span class="keyword">), </span><span class="default">0</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">)) == </span><span class="string">"WIN"<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">&amp;&amp; </span><span class="default">version_compare</span><span class="keyword">(</span><span class="default">PHP_VERSION</span><span class="keyword">, </span><span class="string">"5.3"</span><span class="keyword">, </span><span class="string">"&lt;"</span><span class="keyword">)) <br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$cmd </span><span class="keyword">= </span><span class="string">'"' </span><span class="keyword">. </span><span class="default">$cmd </span><span class="keyword">. </span><span class="string">'"'</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">exec</span><span class="keyword">(</span><span class="default">$cmd</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
This replicates the behaviour of PHP 5.3 and above.&nbsp; Note that this applies to all shell commands (not just exec(), as used in my example).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="120737""></a>
  <div class="note">
   <strong class="user">HappyDog, kennel17.co.uk</strong>
   <a href="#120737" class="date">04-Mar-2017 11:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In response to lancelot--du-lac at hotmail dot fr, who pointed out some issues with commands containing multiple quoted strings when calling shell functions on Windows:&nbsp; I have also recently encountered this issue when trying to run my code on PHP 5.2.&nbsp; The code runs fine on PHP 5.3 and above so I guess the problem has been fixed (though I couldn't find a mention of it in the PHP release notes), but on 5.2 it behaves as described in that post.<br />
<br />
Although the original post says there was no output, this isn't quite right.&nbsp; The reason there was no output is because the error is being sent to stderr, which wasn't being captured.&nbsp; Adding " 2&gt;&amp;1" to the end of the command means you also see this output.&nbsp; This ends up being quite illuminating; I was getting was something like this:<br />
<br />
&nbsp; 'C:\Program' is not recognized as an internal or external command,<br />
&nbsp; operable program or batch file.<br />
<br />
Clearly, having two quoted strings in the command confuses the shell commands; the result is the same as if you ran the command without any quotes.<br />
<br />
I haven't found a workaround for anyone who still needs to support 5.2, but as I say, it doesn't seem to be an issue on later PHP versions.<br />
<br />
[Note: I was also testing on Windows XP (SP3), so I am not sure if this was a general Windows issue or specific to XP.]</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99505""></a>
  <div class="note">
   <strong class="user">benkitzelman at yahoo dot co dot uk</strong>
   <a href="#99505" class="date">20-Aug-2010 08:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Within Linux, when calling the php interpreter directly from popen, or other program execution function to execute a script, it appears as though the script perpetually fails and re-executes. 
<br />

<br />
i.e. <span class="default">&lt;?php popen</span><span class="keyword">(</span><span class="string">"php myscript.php&amp;"</span><span class="keyword">, </span><span class="string">"w"</span><span class="keyword">); </span><span class="comment">// fail </span><span class="default">?&gt;
<br />
</span>
<br />
As each re-execution causes the executing script to load under a new PID, it is incredibly difficult to identify and kill the process manually. 
<br />

<br />
[One solution is] to ensure the executing script has a valid shebang, and execute permissions. This allows you to execute the script directly
<br />

<br />
i.e. <span class="default">&lt;?php popen</span><span class="keyword">(</span><span class="string">"./myscript.php"</span><span class="keyword">, </span><span class="string">"w"</span><span class="keyword">); </span><span class="comment">// ok </span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84330""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#84330" class="date">09-Jul-2008 10:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I found this comment on this page:<br />
<br />
[begin of quote]<br />
Trying to us the following code failed badly with various results: like "unable to fork", "access denied", "empty results", depending on what settings I used, ... even though the same code worked from command line on the server itself.<br />
<br />
$retstr = exec('nslookup -type=mx myhost.com', $retarr);<br />
<br />
Instead of nslookup I believe this would apply to most programs from the \system32\ directory.<br />
<br />
I had to learn that the following finally worked:<br />
$retstr = exec('c:\php\safedir\nslookup -type=mx myhost.com', $retarr);<br />
<br />
... but only under the listed preconditions:<br />
1: nslookup.exe is placed (copied) in the directory \php\safedir\<br />
2: the directory \php\safedir\ is included in the system PATH environement variable<br />
3: the file cmd.exe is placed in \php\ as listed by other notes above<br />
4: the directory "c:\php\safedir\" is set in the php.ini setting <br />
safe_mode_exec_dir = "c:\php\safedir\"<br />
.. maybe set in php-activescript.ini as well, depending on your system setup.<br />
5: nslookup is referenced by the full path as otherwise the file from \windows\system32\ will be called. This happend to me with empty result due to missing rights!<br />
<br />
Hope this helps somebody saving some time and headaches.<br />
[end of quote]<br />
<br />
This is just to complicated. Only two things are needed:<br />
1. Specific permissions for the IUSR account for read &amp; execute to the cmd.exe in C:\Windows\System32 directory<br />
2. Specific permissions for the IUSR account for read &amp; execute to the command that's needed (example: nslookup.exe in C:\Widnows\System23 directory)<br />
<br />
With just this two conditions the exec works fine<br />
<br />
(This is for an IIS server running on a windows platform)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81872""></a>
  <div class="note">
   <strong class="user">mosesdinakaran at yahoo dot co dot in</strong>
   <a href="#81872" class="date">17-Mar-2008 06:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hi <br />
<br />
&nbsp;&nbsp; &nbsp; I had&nbsp; problem with executing&nbsp;&nbsp; exec(),shell_exec() (PHP is not running on Safe Mode).<br />
<br />
&nbsp;&nbsp; &nbsp; After spending some time I was able to find out that the Problem is&nbsp; with SELinux enabled in my system. <br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; You can make sure about this by seeing the log&nbsp; /var/log/messages <br />
&nbsp;&nbsp; &nbsp; So I disabled SELinux and now everything works.<br />
<br />
&nbsp;&nbsp; &nbsp; A Temporary&nbsp; Disable to selinux #&gt; setenforce 0;<br />
<br />
&nbsp;&nbsp; &nbsp; Since I felt this is not a good Idea I still went through some sites and find a solution which I felt good.<br />
<br />
&nbsp;&nbsp; &nbsp; Fedora's SELinux policy has some booleans - let's see what it has for our apache:<br />
# /usr/sbin/getsebool -a | grep httpd<br />
allow_httpd_anon_write -- off<br />
allow_httpd_mod_auth_pam -- off<br />
allow_httpd_sys_script_anon_write -- off<br />
httpd_builtin_scripting -- on<br />
httpd_can_network_connect -- off<br />
httpd_can_network_connect_db -- off<br />
httpd_can_network_relay -- off<br />
httpd_disable_trans -- off<br />
httpd_enable_cgi -- on<br />
httpd_enable_ftp_server -- off<br />
httpd_enable_homedirs -- on<br />
httpd_rotatelogs_disable_trans -- off<br />
httpd_ssi_exec --off<br />
httpd_suexec_disable_trans -- off<br />
httpd_tty_comm -- off<br />
httpd_unified -- on<br />
&nbsp; <br />
&nbsp;&nbsp; From the above we can make sure that exec() is not working&nbsp; because of this httpd_ssi_exec -- off&nbsp;&nbsp; setting<br />
&nbsp; So I turned it On.<br />
&nbsp;&nbsp; <br />
#&gt; setsebool -P httpd_ssi_exec 1;<br />
&nbsp; <br />
&nbsp;&nbsp;&nbsp; Now I was able to see the output of shell_exec('ls -al')<br />
<br />
Moses</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="80721""></a>
  <div class="note">
   <strong class="user">luko post cz</strong>
   <a href="#80721" class="date">29-Jan-2008 06:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
to lancelot:<br />
<br />
it's simple exec($my_cmd) on windows executes 'cmd /c $my_cmd'<br />
if there are any spaces in $my_cmd you have to put it in doublequotes:<br />
cmd /c "$app $target" will work<br />
<br />
further if there are any spaces in $app and $target they also have to be in doublequotes:<br />
cmd /c ""$app" "$target"" <br />
<br />
therefore enclose your $cmd in two more doublequotes and dont forget to escape slashes \\<br />
<br />
$cmd = "\"\"C:\\my path with spaces\\targetapp.exe\" \"C:\\mypathnospaces\\targetfile.xxx\"\""; <br />
<br />
and exec($cmd) will work :)<br />
no chdir anymore...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="80612""></a>
  <div class="note">
   <strong class="user">lancelot--du-lac at hotmail dot fr</strong>
   <a href="#80612" class="date">24-Jan-2008 11:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The note is about usage of exec() under windows...<br />
<br />
In replay to k dot mitz dot NO_SPAM at att dot NO_SPAM dot net: why not enclose your $cmd in simple quotes instead?<br />
<br />
Here is where i'm at right now (also TRYING to use exec() and passthru() on windows XP sp2):<br />
<br />
you can do this:<br />
<br />
$cmd = '"C:\my path with spaces\targetapp.exe" C:\mypathnospaces\targetfile.xxx';<br />
exec($cmd);<br />
<br />
The above works.<br />
________<br />
<br />
Or, you can put your script into your directory C:\my path with spaces\, and work with php directly from there:<br />
<br />
$cmd = 'targetapp.exe "C:\my other path with spaces\targetfile.xxx"';<br />
exec($cmd);<br />
<br />
The above also works, provided of course your script has the correct working directory.<br />
________<br />
<br />
But... In your cmd.exe, you can issue:<br />
<br />
"C:\my path with spaces\targetapp.exe" "C:\my other path with spaces\targetfile.xxx"<br />
<br />
Although the above works perfectly in the cmd, the following php script does NOT work on my system:<br />
<br />
$cmd = '"C:\my path with spaces\targetapp.exe" "C:\my other path with spaces\targetfile.xxx"';<br />
exec($cmd,&amp;$content);<br />
<br />
Not that it sends an error, it just does nothing, and you get nothing written into your $content array... Not that I do understand why.<br />
________<br />
<br />
As far as my few tryings go, the root of the problem lies in the fact that the command to execute has two passages enclosed inside double quotes. Another command which I've had working in the cmd but NOT with php is:<br />
<br />
'"C:\my path with spaces\Apache2\bin\Apache.exe" -w -n "Apache2" -k restart'<br />
<br />
Maybe someone has a solution; I don't (other than using chdir).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="80241""></a>
  <div class="note">
   <strong class="user">jakster at gmx dot net</strong>
   <a href="#80241" class="date">05-Jan-2008 04:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To fork a process I use the following code<br />
<br />
<span class="default">&lt;?php<br />
<br />
fclose</span><span class="keyword">(</span><span class="default">STDOUT</span><span class="keyword">);&nbsp;&nbsp; </span><span class="comment">//Close all output or it WON'T work<br />
</span><span class="default">fclose</span><span class="keyword">(</span><span class="default">STDIN</span><span class="keyword">);<br />
</span><span class="default">fclose</span><span class="keyword">(</span><span class="default">STDERR</span><span class="keyword">);<br />
<br />
if(</span><span class="default">pcntl_fork</span><span class="keyword">()) {<br />
&nbsp;&nbsp;&nbsp; exit;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">//Return to the caller<br />
</span><span class="keyword">}<br />
<br />
</span><span class="comment">//Code to run in the background<br />
<br />
</span><span class="default">pcntl_exec</span><span class="keyword">(</span><span class="string">"/usr/bin/php"</span><span class="keyword">,Array(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'argv'</span><span class="keyword">][</span><span class="default">1</span><span class="keyword">]));<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
I call this script from my website with<br />
<span class="default">&lt;?php <br />
</span><span class="keyword">function </span><span class="default">fork</span><span class="keyword">(</span><span class="default">$script</span><span class="keyword">){&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">//run a forked php script relative to the document root. NO OUTPUT IS DISPLAYED!<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">global </span><span class="default">$config</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$cmd </span><span class="keyword">= </span><span class="string">"/usr/bin/php \"" </span><span class="keyword">. </span><span class="default">dirname</span><span class="keyword">(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'SCRIPT_FILENAME'</span><span class="keyword">]) . </span><span class="string">"/includes/forked/forkHelper.php\" \"" </span><span class="keyword">. </span><span class="default">$script </span><span class="keyword">. </span><span class="string">"\""</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">exec</span><span class="keyword">(</span><span class="default">$cmd</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75270""></a>
  <div class="note">
   <strong class="user">steve dot robinson at frogneck dot com</strong>
   <a href="#75270" class="date">21-May-2007 07:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are trying to use exec to run a cgi and output the contents via a php file, headers need to be seperated from the content and output seperately.<br />
<br />
Also, at least in the case of the cgi I was attempting to execute, line feeds were missing, and some javascript didn't work as a result, so you may have to add line feeds back into the resulting output.&nbsp; Here is the code I used to output my cgi properly...<br />
<br />
<span class="default">&lt;?PHP<br />
putenv</span><span class="keyword">(</span><span class="string">'REQUEST_METHOD=GET'</span><span class="keyword">);<br />
<br />
</span><span class="comment">// to get your parameters passed into the cgi..<br />
</span><span class="default">putenv</span><span class="keyword">(</span><span class="string">'QUERY_STRING=' </span><span class="keyword">. </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'QUERY_STRING'</span><span class="keyword">]);<br />
<br />
</span><span class="comment">//you will know you are past the header when you<br />
//hit a blank line ('')<br />
</span><span class="default">$inheader</span><span class="keyword">=</span><span class="default">true</span><span class="keyword">;<br />
foreach(</span><span class="default">$output </span><span class="keyword">as </span><span class="default">$val</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$val</span><span class="keyword">==</span><span class="string">''</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$inheader</span><span class="keyword">=</span><span class="default">false</span><span class="keyword">;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$inheader</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo(</span><span class="default">$val </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">); </span><span class="comment">// output contents<br />
</span><span class="keyword">}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74897""></a>
  <div class="note">
   <strong class="user">php at fendy dot org</strong>
   <a href="#74897" class="date">02-May-2007 05:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Scheduling WinXP tasks with schtasks.exe and using PHP to execute the command, may sometime fail to work.<br />
<br />
This is because, Apache does not have the privilege to access some of the System Files when placing the scheduling. The way I'd do: is by creating a normal user account and assign Apache service to logon as that account.<br />
<br />
Open the 'services.msc' in the 'Run' window, look for Apache in the listing, right click and get to 'Properties'. Click at the second tab 'Log On' and fill in the 'This account' fields.<br />
<br />
Of course, Apache needs to be installed as Service during its first setup.<br />
<br />
Hope this helps anyone.<br />
<br />
Fendy Ahmad</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74705""></a>
  <div class="note">
   <strong class="user">pawel_do_not at spam_me_lenart dot pl</strong>
   <a href="#74705" class="date">24-Apr-2007 04:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You must remember that if you're running your own compiled C programs and you don't get any output you probably do it like this:
<br />

<br />
printf("some text");
<br />

<br />
shell_exec and similiar functions won't display it, you must do your output as follows:
<br />

<br />
fprintf(stdout, "some text");
<br />

<br />
and then shell_exec and so will correctly read stdout (spent an hour wondering why my program isn't working when connected with PHP :)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="72675""></a>
  <div class="note">
   
   <a href="#72675" class="date">29-Jan-2007 08:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
it seams to me the best way would be to copy cmd.exe to a secure directory somewhere under your web directory, add it to the windows path and then call it from there using system commands. It seams as though that would get arround any security holes</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71630""></a>
  <div class="note">
   <strong class="user">Matt-kun</strong>
   <a href="#71630" class="date">08-Dec-2006 10:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just a simple note to help people get rid of some headaches.<br />
<br />
when using:<br />
&lt;?<br />
&nbsp;&nbsp; &nbsp; &nbsp; $filepath = "the path of the file";<br />
&nbsp;&nbsp; &nbsp; &nbsp; exec("program -command $filepath ");<br />
&nbsp;&nbsp; &nbsp; &nbsp; fopen($filepath,rw);<br />
?&gt;<br />
<br />
Make sure you use&nbsp; "\ " ( \ space) for the Linux\unix path and just " " space for fopen. These are both very basic things that you wouldn't normally think to cause a problem, but when you try to pass slashes to fopen it either breaks or even better works incorrectly =D. And vise versa for any programs that use "\ " for spaces in file paths/names.<br />
<br />
I ran into this problem when using &lt;? exec(" cp $path "); ?&gt; and &lt;? fopen("$path"); ?&gt;. To fix it I used str_replace(" ","\ ",$path); and str_replace("\ ", " ",$path); <br />
<br />
*Note this is alot of sudo code, and there are faster more effecient ways of doing the same operations, but I thought this might help those who were going crazy over filepaths =D.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="70135""></a>
  <div class="note">
   <strong class="user">PHP at jyoppDot-com</strong>
   <a href="#70135" class="date">04-Oct-2006 10:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's a function to launch a low-priority background process very simply, returning control to the foreground.&nbsp; I found that a lot of the other approaches shown here allow the script to continue running, and the page is served up to the user, but the PHP thread that launched the process cannot be re-used until the process has completed.&nbsp; Stdout and stderr need to be redirected to /dev/null to prevent this.<br />
<br />
This is for BSD/*NIX servers only (tested on Fedora Core and OSX).&nbsp; Win32 approaches would be necessarily very different.&nbsp; Omit 'nice' if you don't want to run the process with lowered priority.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">fork</span><span class="keyword">(</span><span class="default">$shellCmd</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">exec</span><span class="keyword">(</span><span class="string">"nice </span><span class="default">$shellCmd</span><span class="string"> &gt; /dev/null 2&gt;&amp;1 &amp;"</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69789""></a>
  <div class="note">
   <strong class="user">t dot kramer at NOSPAM dot safetbus dot de</strong>
   <a href="#69789" class="date">21-Sep-2006 02:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Trying to us the following code failed badly with various results: like "unable to fork", "access denied", "empty results", depending on what settings I used, ... even though the same code worked from command line on the server itself.<br />
<br />
$retstr = exec('nslookup -type=mx myhost.com', $retarr);<br />
<br />
Instead of nslookup I believe this would apply to most programs from the \system32\ directory.<br />
<br />
I had to learn that the following finally worked:<br />
$retstr = exec('c:\php\safedir\nslookup -type=mx myhost.com', $retarr);<br />
<br />
... but only under the listed preconditions:<br />
1: nslookup.exe is placed (copied) in the directory \php\safedir\<br />
2: the directory \php\safedir\ is included in the system PATH environement variable<br />
3: the file cmd.exe is placed in \php\ as listed by other notes above<br />
4: the directory "c:\php\safedir\" is set in the php.ini setting <br />
safe_mode_exec_dir = "c:\php\safedir\"<br />
.. maybe set in php-activescript.ini as well, depending on your system setup.<br />
5: nslookup is referenced by the full path as otherwise the file from \windows\system32\ will be called. This happend to me with empty result due to missing rights!<br />
<br />
Hope this helps somebody saving some time and headaches.<br />
Thomas</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68090""></a>
  <div class="note">
   <strong class="user">Arjan van Bentem</strong>
   <a href="#68090" class="date">12-Jul-2006 12:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When using Red Hat Fedora, beware of Security Enhanced Linux, SELinux. <br />
<br />
Quoted from Red Hat: "The security goal is to make sure that Apache HTTP is only reading the static Web content, and not doing anything else such as writing to the content, connecting to database sockets, reading user home directories, etc."<br />
<br />
These limitations include, among many other things, using exec to run external applications that happen to use sockets (or maybe access some files) such as HylaFAX "faxstat" as invoked from nweb2fax recvq.php and sendq.php.<br />
<br />
For debugging, one could try running such commands using PHP Shell (see <a href="http://mgeisler.net/php-shell/" rel="nofollow" target="_blank">http://mgeisler.net/php-shell/</a>) which might fail while execution from the real command line (as Unix user apache or httpd) yields no problem whatsoever. <br />
<br />
See /var/log/messages for any denials due to the SELinux policy. To disable it:<br />
<br />
- System, Administration, Security Level and Firewall<br />
- open the SELinux tab<br />
- click the Transition tree<br />
- check Disable SELinux protection for Apache HTTP<br />
- execute /etc/init.d/httpd restart<br />
<br />
See also <a href="http://fedora.redhat.com/docs/selinux-faq/ and http://php.net/results.php?q=selinux&amp;p=wholesite" rel="nofollow" target="_blank">http://fedora.redhat.com/docs/selinux-faq/ and http://php.net/results.php?q=selinux&amp;p=wholesite</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="66971""></a>
  <div class="note">
   <strong class="user">judas dot iscariote at gmail dot com</strong>
   <a href="#66971" class="date">01-Jun-2006 12:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This functions are generally considered harmful,without proper input validation procedures are as worse as eval().<br />
<br />
If what you are trying to do is possible using other mechanism, ** do it that way, even if it takes more time **.<br />
<br />
Do not cry or blame PHP if your server gets "owned" due to a missing escapeshell*** in your code , you have been warned.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="64534""></a>
  <div class="note">
   <strong class="user">manokan at manokan dot net</strong>
   <a href="#64534" class="date">17-Apr-2006 10:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Lets make it even clearer, about the "unable to fork" error in exec().<br />
<br />
By default Windows XP sets all permissions for cmd.exe for the temporary internet user account (IUSER-[computername]) to DENY. That overrides everthing.<br />
<br />
You must modify the security on cmd.exe to give the IUSER-computername account at least read &amp; execute and remove the DENY.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="62249""></a>
  <div class="note">
   <strong class="user">not at any dot com</strong>
   <a href="#62249" class="date">23-Feb-2006 12:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
at LAST!&nbsp; tenacity pays off, days trying every little thing!<br />
<br />
I didn't want batch files.&nbsp; I'm trying to use PHP to get rid of batch files.<br />
<br />
I didn't want to call a file to parse the parameters to call a shell to call a file.&nbsp; I've got "systems" right now with batches tiered three and five deep.<br />
<br />
I just wanted to run stuff.<br />
<br />
CALL, tested on WinXP, will be testing on more OSes right away, in PHP4 and 5, with exec, system, works with popen, and passthru.<br />
<br />
here is my lame sample function.<br />
<br />
//&nbsp; CreateZip<br />
&nbsp;&nbsp;&nbsp; function createzip ($target, $archive)<br />
&nbsp;&nbsp;&nbsp; {&nbsp;&nbsp; $ziputil = "call \"c:\\Program Files\\7-zip\\7z.exe\"";<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $archived = escapeshellarg($archive);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $targeted = escapeshellarg($target);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $shellcommand= $ziputil." a -tzip ".$archived." ".$targeted."\n";<br />
<br />
&nbsp; // all of the below are working in Win XP Pro<br />
&nbsp;&nbsp;&nbsp; passthru ($shellcommand);<br />
&nbsp;&nbsp;&nbsp; exec ($shellcommand);<br />
&nbsp;&nbsp;&nbsp; system ($shellcommand);<br />
&nbsp;&nbsp;&nbsp; shell_exec ($shellcommand);<br />
&nbsp;&nbsp;&nbsp; $proc= popen ($shellcommand, "r"); //$proc contains output<br />
<br />
LONG PATH NAMES WITH SPACES IN THEM ON WINDOWS!<br />
<br />
all in a big long concatenated command line with multiple quoted-filename parameters<br />
<br />
shell scripting bliss!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="59049""></a>
  <div class="note">
   <strong class="user">valqk at lozenetz dot org</strong>
   <a href="#59049" class="date">24-Nov-2005 04:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are chrooting php into enviornment that doesn't have /bin/sh you can't execute any command! Even when you call <br />
mail() and it calls sendmail ... well actually sendmail NEVER gets called because /bin/sh is not in the chroot!<br />
SO in conclusion: YOU MUST HAVE /bin/sh TO EXECUTE SOMETHING!!!<br />
VERY IMPORTNAT!<br />
I've lost few days while find this, hope it helps someone!!!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="58218""></a>
  <div class="note">
   <strong class="user">manokan at manokan dot net</strong>
   <a href="#58218" class="date">27-Oct-2005 03:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Even more on the "unable to fork" error.<br />
<br />
It was driving me crazy! I did check that the permissions were set for the IUSR_[server] account to read &amp; exec cmd.exe. Yet still it failed. It wasn't until I got desperate that I happened to look in "special permissions." (Click the advanced tab underneath the regular list of permissions.) There I found that&nbsp; somehow the IUSR_[server] account had a special permission DENYING access! Of course deny overrides everything else.<br />
<br />
This was a newly set up install of XP pro. It must be the default of something (I'd guess IIS) to set this deny permission just to make our lives miserable.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="57295""></a>
  <div class="note">
   <strong class="user">abhilashp at clariontechnologies dot co dot in</strong>
   <a href="#57295" class="date">29-Sep-2005 09:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I faced the problem of putting a shell script as a backgroud process using both exec() and system() commands on a FreeBSD Server with PHP 4.4.0<br />
<br />
I tried all the above mentioned methods but couldnt succeded, then i coded this script and am sure will work on all Linux flavors... See if ot helps you all guys...<br />
<br />
I Put my Shell Script in the variable $ExecCommand<br />
<br />
and used the proc_close and proc_open functions the code is as follows :<br />
<br />
proc_close (proc_open ($ExecCommand,array(),$somefun));<br />
<br />
After the above line the rest of the usual&nbsp; php script continues....<br />
<br />
Hope it helps you guys..</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="49383""></a>
  <div class="note">
   <strong class="user">Shaun</strong>
   <a href="#49383" class="date">26-Jan-2005 01:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Trying to use 'exec' to run a helper executable on Win2K3 (and I'm told this also happens on Win2K) from a PHP script running on IIS, failed to invoke the executable.<br />
<br />
Running the same PHP script on Win2K using Apache to serve the page calling the same helper executable worked.<br />
<br />
Solution: On Win2K3 (and probably Win2K), give the IIS IUSR_xxxxx guest user Read &amp; Execute permissions to Cmd.exe found in the System32 folder under Windows root directory. <br />
<br />
This one had me confused longer than it should have! Hope this saves others from the same fate!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="49152""></a>
  <div class="note">
   <strong class="user">margus at kohv dot com</strong>
   <a href="#49152" class="date">18-Jan-2005 03:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Well, I had this issue when I wanted to start an indefinitely running PERL script from PHP. Somehow I could not make the PHP script to return after executing the PERL script. So finally I came to following solution:<br />
<br />
PHP file<br />
-------------------<br />
<span class="default">&lt;?php<br />
exec</span><span class="keyword">(</span><span class="string">"perl /home/chatserver.pl &gt; /dev/null"</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span>-------------------<br />
This script will be run over HTTP.<br />
<br />
PERL file<br />
-------------------<br />
#!/usr/bin/perl<br />
fork and exit 1;<br />
<br />
# normal code here...<br />
-------------------<br />
<br />
Hopefully it helps someone :)<br />
Margus</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="48859""></a>
  <div class="note">
   <strong class="user">sean @T keenio - dot - com</strong>
   <a href="#48859" class="date">09-Jan-2005 11:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just to clarify, background shell exec()ing is not the same as a fork() under Unix. It would be useful if PHP supported fork() like Perl and other scripting languages do. Simply exec()'ing a process and sending it to the background is not the same. <br />
<br />
A true fork() copies the current environment and duplicates the running script so that there are two instances, one child, one parent. The child and parent can determine which copy they are and then take separate courses of execution paths based on that. Often one copy will perform some "busy work" while the other returns to normal execution. But no matter what, both functions live within the same code rather than a separate, external program. exec()ing can not do this for you.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="46199""></a>
  <div class="note">
   <strong class="user">sam at freepeers dot com</strong>
   <a href="#46199" class="date">01-Oct-2004 05:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To clarify even more about what has been said in the last few posts:<br />
<br />
"exec", "backticks", "system" and so on will fail on Windows 2003 by default.&nbsp; <br />
<br />
You must modify the security on cmd.exe to give the user account IUSR-computername the necessary permissions which are at least read &amp; execute.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="43908""></a>
  <div class="note">
   <strong class="user">leaetherstrip at inbox dot ru</strong>
   <a href="#43908" class="date">08-Jul-2004 02:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note on XP users: XP-Home edition does not allow to set rights directly on files and folders. You should use cacls command-line utility to do this.<br />
<br />
For example:<br />
<br />
cacls c:\windows\system32\cmd.exe /E /G IUSR_ADMIN2003:F<br />
<br />
gives IIS user full access to cmd.exe (potential security hole!), so PHP can fork and execute external programs.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="42402""></a>
  <div class="note">
   <strong class="user">dotpointer</strong>
   <a href="#42402" class="date">14-May-2004 06:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Win32 / PHP 4.3.6...<br />
<br />
If you plan to start programs on the server that show message boxes (things that require OK from the server-side), or remain (like notepad.exe), and the exec-command seems to go into an deadly loop, then MAYBE your program has started, but you can't see it. Because the web server runs as an system process, and it isn't allowed to interact with the desktop.<br />
<br />
To solve a part of the problem (to see the programs you execute), in the control panel in Windows, goto Administration-&gt;Services, right-click the server-service, goto Properties and on the second tab (login?) and check the box about allowing the service to interact with the desktop. Click OK. Restart the webserver, and MAKE SURE it is restarted for real (i.e. look in the task manager so the service goes _down_), otherwise the desktop-option won't take.<br />
<br />
Next phase would be to stop PHP from waiting for the processes to complete (this is what makes PHP "loop"). I solved this by creating a small Delphi-application that took the path to the file I wanted to execute and executed it by the WinExec API, which just starts the childprogram but doesn't wait for it to complete = the program completes and the PHP.exe completes the script. Problem solved!<br />
<br />
Delphi-snippet:<br />
WinExec(PChar(&lt;CMD&gt;),SW_SHOW); // replace &lt;CMD&gt; with the program path.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="40997""></a>
  <div class="note">
   <strong class="user">vosechu at roman-fleuve dot com</strong>
   <a href="#40997" class="date">25-Mar-2004 06:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Quick chart that helped me immensely (Best (+) / worst (o) of each command) and when to use each (w).<br />
<br />
| exec(string cmd, [array cmd_output, [int cmd_exit_status]])<br />
+- Second (optional) argument holds an array containing the output line by line.<br />
+- Third (optional) argument holds the exit status of the executed program.<br />
w- When the output of a command is only important to the program.<br />
<br />
| system(string cmd, [int cmd_exit_status])<br />
+- Echos ascii output straight to browser (only stdout; stderr must be redirected by putting 2&gt;&amp;1 after the command to see errors).<br />
+- Second (optional) argument holds the exit status of the executed program.<br />
w- When the output of a command is important to the user.<br />
<br />
The more I go over my notes the less I care for the last two functions. <br />
Shell_exec() = exec() + implode() - exit codes. <br />
And while neccessary to be able to pipe binary through php, most people will never use passthru<br />
<br />
| passthru(string cmd, [int cmd_exit_status])<br />
+- Echos binary output directly to browser window.<br />
+- Second (optional) argument holds the exit status of the executed program.<br />
w- When the output of a command is binary. <br />
<br />
| shell_exec(string cmd) &lt;-- minimal features to maintain sync with normal use of backticks. <br />
+- Returns full output as a string instead of directly to the browser (only stdout; stderr must be redirected).<br />
o- No way to check exit status (Should use system() with both stderr and stdout redirected to /dev/null to get the exit code).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="39264""></a>
  <div class="note">
   <strong class="user">ferchland at computer-kontor dot de</strong>
   <a href="#39264" class="date">22-Jan-2004 08:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I tried to fork a GUI-process on WinNT, Apache 2, PHP4.<br />
I saw the new process (notepad.exe) in the Task-Managers process-list, but no Notepad-Window anywhere!<br />
After activating the checkbox "Interactive with Desktop allowed" in Services-&gt;Apache everthing works with a simple command<br />
exec("start c:\\winnt\\notepad.exe");</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="35910""></a>
  <div class="note">
   <strong class="user">dens at dodgeball dot com</strong>
   <a href="#35910" class="date">18-Sep-2003 03:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I was stuck for about an hour and a half last night trying to get Perl to pass back values to my PHP script after running an exec() command.<br />
<br />
Since my Perl script was using STDOUT (after being passed command lines variables), I expected the variables used in my .pl script to be accessible in PHP, no questions asked.<br />
<br />
Of course, this wasn't working and I finally figured it out with the help of a friend (Shawn = superstar):&nbsp; you need to echo the exec() command in order to get the values back into PHP.&nbsp; <br />
<br />
Since I was returning multiple values, I added pipe delimiters in my .pl script and then used PHP to parse the string to retreive my data into different variables.<br />
<br />
Check it out:<br />
<br />
#hit the .pl script with the data<br />
$mydata = exec("script.pl 'command line args' ");<br />
exec("exit(0)"); <br />
&nbsp;&nbsp;&nbsp; <br />
#parse the value that comes back from the .pl script<br />
list($strA, $strB) = split ('[|]', $mydata);<br />
echo "valueA: " . $strA."&lt;br&gt;";<br />
echo "valueB: " . $strB."&lt;br&gt;";<br />
<br />
Woo-hoo!<br />
/d</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="34515""></a>
  <div class="note">
   <strong class="user">software at yvanrodrigues dot com</strong>
   <a href="#34515" class="date">29-Jul-2003 02:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
MORE ON THE UNABLE TO FORK MESSAGES IN WINDOWS:<br />
<br />
I would like to confirm that this issue relates to permissions on %SYSTEMROOT%\SYSTEM32. The user (usually the anonymous login) must have execute permissions on cmd.exe<br />
<br />
This is unlike most other programming languages. For example, in C the spawn and exec functions do not try to open a shell, they create the new process directly. PHP creates the new process via cmd.exe (or command.com) much like the C system() function. This is good for those of you who are trying to run batch files but this is very ineffecient for running other .exe files.<br />
<br />
I feel uneasy about lifting permissions in my system32 directory but you can get around this by copying cmd.exe to your PHP directory. Windows will look there first and if it is not there it will check the path. Note: I mean the directory where php.exe is, not your script directory.<br />
<br />
I have confirmed this by running filemon.exe while trying to execute a script, and you can see it trying to start the cmd.exe process.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="33352""></a>
  <div class="note">
   <strong class="user">kristof_jebens at hotmail dot com</strong>
   <a href="#33352" class="date">23-Jun-2003 02:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For WIN2K Server users running Apache 1.3.22 who are unable to run an executable...<br />
<br />
exec('c:\\WINNT\\system32\\cmd.exe /c START c:\\file.exe');<br />
<br />
this is the only way it worked for me.<br />
Hope that helps</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="31396""></a>
  <div class="note">
   <strong class="user">mk at neon1 dot net</strong>
   <a href="#31396" class="date">20-Apr-2003 09:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to execute background processes from PHP that should run indefinitely, be aware of the following nasty behavior (confirmed with PHP 4.3.1 under FreeBSD, but probably under other flavors of UNIX, too):<br />
<br />
PHP internally calls setitimer(2) to set the profiling interval timer (ITIMER_PROF) to enforce execution time limits (max_execution_time and max_input_time). These timer values are passed down to all processes executed by PHP. This means that after such a process has consumed [max_execution_time] seconds of CPU time (not wallclock time!), the system will send it a SIGPROF (signal 27). Since most processes don't use this signal and as such don't call signal(3) to catch or ignore it, the default action is executed, which is to terminate the process.<br />
<br />
So if you see background processes that were executed from PHP dying at seemingly random times, you may be experiencing this issue. The solution is simply to call set_time_limit(0) just before executing the process.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="28851""></a>
  <div class="note">
   <strong class="user">jpgiot at ifrance.com</strong>
   <a href="#28851" class="date">25-Jan-2003 06:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
FOR WINDOWS USERS<br />
<br />
i had a look to start command. it's really usefull in fact.<br />
<br />
this is how i launch a specific Apache SSL server<br />
<br />
<span class="default">&lt;?php<br />
$cmd </span><span class="keyword">= </span><span class="string">"start /D C:\OpenSA\Apache /B Apache.exe -D SSL"</span><span class="keyword">;<br />
</span><span class="default">exec</span><span class="keyword">(</span><span class="default">$cmd</span><span class="keyword">,</span><span class="default">$output</span><span class="keyword">,</span><span class="default">$rv</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
/D specify the path where application will be launched (equivalent to cd to path)<br />
/B launch application without a console window<br />
<br />
so to know the exact parameters of start, you could use<br />
<br />
<span class="default">&lt;?php<br />
exec</span><span class="keyword">(</span><span class="string">"start /? &gt; start.txt"</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
and you will get the help of start in a file named 'start.txt' in the same place you run the script<br />
<br />
for WIN 98 you may need to modify a little your command<br />
<br />
exec("COMMAND.COM /C START program args &gt;NUL");<br />
<br />
(taken from another post)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="28363""></a>
  <div class="note">
   <strong class="user">jfl at eksperten dot dk</strong>
   <a href="#28363" class="date">10-Jan-2003 10:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I made my script work in the background like this:
<br />
function start_shell ($cmd) {
<br />
&nbsp;&nbsp;&nbsp; exec('nohup "'.$cmd.'" &gt; /dev/null &amp;');
<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="28253""></a>
  <div class="note">
   <strong class="user">qscripts at lycos dot nl</strong>
   <a href="#28253" class="date">07-Jan-2003 05:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Why not using the "start" utility, provided with every version of Windows to start processes in the background on Windows machines? For example :<br />
<br />
exec("start song.mp3");<br />
<br />
Which will cause the default handeling application for .MP3 file types to start playing the selected song..</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="25231""></a>
  <div class="note">
   <strong class="user">k dot mitz dot NO_SPAM at att dot NO_SPAM dot net</strong>
   <a href="#25231" class="date">15-Sep-2002 02:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Newbie note:<br />
<br />
The only syntax I found to work for the command portion of an an exec() call on a Win2K devel platform is:<br />
<br />
$cmd = "\"path-to-exe\" args file-name";<br />
<br />
where 'path-to-exe' has escaped double quotes, args are in the standard format, and 'file-name' has any backslashes escaped.<br />
<br />
Example:<br />
<br />
$cmd = "\"C:\program files\winzip\wzunzip.exe\" -c C:\\temp\\uploaded_file.zip";<br />
<br />
exec($cmd,$output,$rv);<br />
<br />
Note that the backslashes are escaped in the uploaded_file name, but not in the path to call the Winzip executable.&nbsp; Go figure!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="24302""></a>
  <div class="note">
   <strong class="user">kop at meme dot com</strong>
   <a href="#24302" class="date">12-Aug-2002 02:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
AFICT, the standard Unix Apache configuration causes an rare problem when running a job in the background. The MaxRequestsPerChild directive causes the child to terminate after 1000 requests, any background processes associated with the child will die with the child unless they are started with the "nohup" command.&nbsp; Thus, the proper way to start a job in the background is to use:<br />
<br />
exec('nohup my-command &gt; /dev/null 2&gt;&amp;1 &amp;')</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="23258""></a>
  <div class="note">
   <strong class="user">ramirosuarez at fibertel dot com dot ar</strong>
   <a href="#23258" class="date">12-Jul-2002 08:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For Windows Users:<br />
<br />
Keep in mind that a lot of UNABLE TO FORK Errors are the result of insufficient permissions. <br />
<br />
CMD.EXE, TEMP Directory (or whatever you specified in php.ini), and all the directories that you use to upload o manipulate your files need to have Write privileges? usually user USER.<br />
<br />
This will be useful for all the people who use GD Libraries or other programs that manipulate graphic images.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="22798""></a>
  <div class="note">
   <strong class="user">GCMXZPJPDJER at spammotel dot com</strong>
   <a href="#22798" class="date">30-Jun-2002 12:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
to execute a script in background from php you don't need to use mikehup or other tools. just do:<br />
<br />
`/usr/bin/php -q foobar.php &gt;/dev/null 2&gt;&amp;1 &amp;`;<br />
<br />
mat</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="22675""></a>
  <div class="note">
   <strong class="user">deschampsbest at noos dot fr</strong>
   <a href="#22675" class="date">26-Jun-2002 01:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I needed to know when a group of background tasks, which had been launched with a call to system, had terminated.<br />
I could not find a function to call, so I created a little function.<br />
<br />
It basically loops on the existance of a string in the results returned by the command ps.<br />
<br />
All my commands, which run in background have the pid returned by posix_getpid in them.<br />
<br />
I am able to launch many background task and effectively wait for them all to finish.<br />
<br />
Before this, I would basically would sleep for N seconds.<br />
<br />
I apologise if a well known or better method exist.<br />
<br />
Thanks,<br />
The New Bee<br />
===============<br />
===============<br />
<br />
function wait_until_termination ($id, $duration){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $i = 0;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; do {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $i += 1;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $cnt = `ps -auxww |<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; grep $id |<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; grep -v grep |<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; awk '{print $2}' |<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; grep -v $id|<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; wc -l` ;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($cnt &gt; 0) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; sleep ($duration);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } while ($cnt != 0);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo ("wait_until_termination (PID: $id, SEC: $duration) : LOOPS<br />
:$i&lt;BR&gt;");<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="20648""></a>
  <div class="note">
   <strong class="user">rolland dot dudemaine at msg-software dot com</strong>
   <a href="#20648" class="date">11-Apr-2002 05:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In case you ever had to chain from php to another program (e.g. with a cgi php that only gives part of the output, or with php-gtk), here is a little C program that kills his parent (php, for instance), then launches a program given in argument.<br />
<br />
chain.c :<br />
<br />
#include &lt;unistd.h&gt;<br />
<br />
int main(int argc, char**argv) {<br />
&nbsp; /* kill the parent */<br />
&nbsp; kill(getppid(), 15);<br />
&nbsp; argv++;<br />
&nbsp; /* then launch the new program */<br />
&nbsp; return execvp(argv[0], argv);<br />
}<br />
(compile with gcc -O3 -o chain chain.c)<br />
then in php, use<br />
&lt;?<br />
exec('chain sh -c echo test');<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="20487""></a>
  <div class="note">
   <strong class="user">vi_pa at hotmail dot com</strong>
   <a href="#20487" class="date">05-Apr-2002 04:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For those who want to execute a .php script to run in the background, from a<br />
.php web page...<br />
<br />
exec("php script.php parameters 2&gt;dev/null &gt;&amp;- &lt;&amp;- &gt;/dev/null &amp;");<br />
<br />
Where...<br />
- php is the path to your php script executer (php has to be specifically complied to be to do this)<br />
- script.php is the script<br />
- parameters are none or more parameters<br />
- 2&gt;dev/null redirects the stderr to a file<br />
- &lt;&amp;- switches off the stdin<br />
- &gt;&amp;- switches off the stdout<br />
- &gt;dev/null redirects all other output to the file dev/null<br />
- &amp; direct script to run in background<br />
<br />
This is the only way I managed to get it working (Linux &amp; Apache, php 4x enviroment) . What is also great is that the process is forked so even though a user may close the browser that initiated the exec(), the process will still run to completion. And the dev/null file can be turned into a log.<br />
<br />
What I found odd is that the script I was execing would run fine in the bg when executed from the command line, but not from the browser until I closed the stdin and stdout.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="18713""></a>
  <div class="note">
   <strong class="user">daniel dot hopp at godot dot de</strong>
   <a href="#18713" class="date">01-Feb-2002 11:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Re: session_write_close()<br />
<br />
To launch a background process within a session, I recommend<br />
to use a start-stop-daemon and ship parameters via ENV.<br />
<br />
Example:<br />
----------------------------------------<br />
<span class="default">&lt;?php<br />
&nbsp; </span><span class="comment">// Within a session..<br />
&nbsp; </span><span class="default">exec</span><span class="keyword">(</span><span class="string">"/some/where/launch.sh 300"</span><span class="keyword">);<br />
&nbsp; </span><span class="comment">// ..finished immediately.<br />
</span><span class="default">?&gt;<br />
</span><br />
----------------------------------------<br />
#!/bin/bash<br />
# /some/where/launch.sh<br />
T=$1<br />
export T<br />
DAEMON=/some/where/runme.pl<br />
start-stop-daemon --start --quiet --background --exec $DAEMON<br />
<br />
----------------------------------------<br />
#!/usr/bin/perl<br />
# /some/where/runme.pl<br />
my $t = $ENV{'T'};<br />
sleep($t);<br />
<br />
----------------------------------------</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
