<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>改变文件的所有者</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.chmod.html">? chmod</a></li>
      <li style="float: right;"><a href="function.clearstatcache.html">clearstatcache ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.filesystem.html">文件系统函数</a></li>
    <li>改变文件的所有者</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.chown" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">chown</h1>
  <p class="verinfo">(PHP 4, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">chown</span> &mdash; <span class="dc-title">改变文件的所有者</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.chown-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>chown</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$filename</code></span>
   , <span class="methodparam"><span class="type"><a href="language.types.declarations.html#language.types.declarations.mixed" class="type mixed">mixed</a></span> <code class="parameter">$user</code></span>
   ) : <span class="type">bool</span></div>

  <p class="para rdfs-comment">
   尝试将文件 <code class="parameter">filename</code> 的所有者改成用户
   <code class="parameter">user</code>（由用户名或用户 ID 指定）。
   只有超级用户可以改变文件的所有者。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.chown-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">filename</code></dt>

     <dd>

      <p class="para">
       文件路径。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">user</code></dt>

     <dd>

      <p class="para">
       用户名或数字。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.chown-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   成功时返回 <strong><code>true</code></strong>， 或者在失败时返回 <strong><code>false</code></strong>。
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.chown-examples">
  <h3 class="title">范例</h3>
  <p class="para">
   <div class="example" id="example-2525">
    <p><strong>Example #1 简单的 <span class="function"><strong>chown()</strong></span> 用法</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br /></span><span style="color: #FF8000">//&nbsp;File&nbsp;name&nbsp;and&nbsp;username&nbsp;to&nbsp;use<br /></span><span style="color: #0000BB">$file_name</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"foo.php"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$path&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"/home/sites/php.net/public_html/sandbox/"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$file_name&nbsp;</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$user_name&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"root"</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//&nbsp;Set&nbsp;the&nbsp;user<br /></span><span style="color: #0000BB">chown</span><span style="color: #007700">(</span><span style="color: #0000BB">$path</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$user_name</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;Check&nbsp;the&nbsp;result<br /></span><span style="color: #0000BB">$stat&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">stat</span><span style="color: #007700">(</span><span style="color: #0000BB">$path</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">print_r</span><span style="color: #007700">(</span><span style="color: #0000BB">posix_getpwuid</span><span style="color: #007700">(</span><span style="color: #0000BB">$stat</span><span style="color: #007700">[</span><span style="color: #DD0000">'uid'</span><span style="color: #007700">]));<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>以上例程的输出类似于：</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
Array
(
    [name] =&gt; root
    [passwd] =&gt; x
    [uid] =&gt; 0
    [gid] =&gt; 0
    [gecos] =&gt; root
    [dir] =&gt; /root
    [shell] =&gt; /bin/bash
)
</pre></div>
    </div>
   </div>
  </p>
 </div>


 <div class="refsect1 notes" id="refsect1-function.chown-notes">
  <h3 class="title">注释</h3>
  <blockquote class="note"><p><strong class="note">Note</strong>: <span class="simpara">此函数不能作用于<a href="features.remote-files.html" class="link">远程文件</a>，被检查的文件必须是可通过服务器的文件系统访问的。</span></p></blockquote>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <span class="simpara">
    在 Windows 上对普通文件使用此函数会静默失败。
   </span>
  </p></blockquote>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.chown-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.chmod.html" class="function" rel="rdfs-seeAlso">chmod()</a> - 改变文件模式</span></li>
    <li class="member"><span class="function"><a href="function.chgrp.html" class="function" rel="rdfs-seeAlso">chgrp()</a> - 改变文件所属的组</span></li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="91599""></a>
  <div class="note">
   <strong class="user">rickard at 0x539 dot se</strong>
   <a href="#91599" class="date">18-Jun-2009 02:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For most modern Linux systems your apache user should not be run as root, and in order to change the ownership of a file or directory, you need to be root. To get around this problem you can use sudo, but be careful with what permissions you give. Here is an example which is working for me:<br />
<br />
www-data&nbsp; &nbsp; &nbsp; &nbsp; ALL = NOPASSWD: /bin/chown 1[1-9][0-9][0-9]\:1[1-9][0-9][0-9] /home/www/[a-zA-Z0-9]*<br />
<br />
This allows the apache server to change ownership of files in /home/www with name containing a-z, A-Z or numbers (note: no subdirectories). The only valid input of userid is a four digit numeric id, between 1100 and 1999. <br />
<br />
Hope this helps.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="80818""></a>
  <div class="note">
   <strong class="user">Mikevac at yahoo dot com</strong>
   <a href="#80818" class="date">01-Feb-2008 11:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I've only tested this on Solaris 10 so your mileage may vary.<br />
<br />
To allow the apache daemon to change file ownership without being root, add the following line to /etc/system:<br />
<br />
set rstchown=0<br />
<br />
Reboot the server. <br />
<br />
There are security concerns doing this as this modification allows any user to change ownership of their files to anyone else.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="60580""></a>
  <div class="note">
   <strong class="user">Tayfun Bilsel</strong>
   <a href="#60580" class="date">11-Jan-2006 08:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Simple usage of the chown:<br />
<br />
<span class="default">&lt;?php<br />
<br />
$file_name</span><span class="keyword">= </span><span class="string">"test"</span><span class="keyword">;<br />
</span><span class="default">$path </span><span class="keyword">= </span><span class="string">"/var/www/html/test/" </span><span class="keyword">. </span><span class="default">$file_name </span><span class="keyword">;<br />
<br />
</span><span class="default">$user_name </span><span class="keyword">= </span><span class="string">"root"</span><span class="keyword">;<br />
<br />
</span><span class="default">chown</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">, </span><span class="default">$user_name</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="40159""></a>
  <div class="note">
   <strong class="user">greg _at_ rhythmicdesign d.o.t com</strong>
   <a href="#40159" class="date">23-Feb-2004 04:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">recurse_chown_chgrp</span><span class="keyword">(</span><span class="default">$mypath</span><span class="keyword">, </span><span class="default">$uid</span><span class="keyword">, </span><span class="default">$gid</span><span class="keyword">)
<br />
{
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$d </span><span class="keyword">= </span><span class="default">opendir </span><span class="keyword">(</span><span class="default">$mypath</span><span class="keyword">) ;
<br />
&nbsp;&nbsp;&nbsp; while((</span><span class="default">$file </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$d</span><span class="keyword">)) !== </span><span class="default">false</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$file </span><span class="keyword">!= </span><span class="string">"." </span><span class="keyword">&amp;&amp; </span><span class="default">$file </span><span class="keyword">!= </span><span class="string">".."</span><span class="keyword">) {
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$typepath </span><span class="keyword">= </span><span class="default">$mypath </span><span class="keyword">. </span><span class="string">"/" </span><span class="keyword">. </span><span class="default">$file </span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//print $typepath. " : " . filetype ($typepath). "&lt;BR&gt;" ;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">filetype </span><span class="keyword">(</span><span class="default">$typepath</span><span class="keyword">) == </span><span class="string">'dir'</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">recurse_chown_chgrp </span><span class="keyword">(</span><span class="default">$typepath</span><span class="keyword">, </span><span class="default">$uid</span><span class="keyword">, </span><span class="default">$gid</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">chown</span><span class="keyword">(</span><span class="default">$typepath</span><span class="keyword">, </span><span class="default">$uid</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">chgrp</span><span class="keyword">(</span><span class="default">$typepath</span><span class="keyword">, </span><span class="default">$gid</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
&nbsp;}
<br />

<br />
</span><span class="default">recurse_chown_chgrp </span><span class="keyword">(</span><span class="string">"uploads"</span><span class="keyword">, </span><span class="string">"unsider"</span><span class="keyword">, </span><span class="string">"unsider"</span><span class="keyword">) ;
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
for older versions.. unfortunately, it seems I do not have permission to perform these functions.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="33488""></a>
  <div class="note">
   <strong class="user">Klaus Zierer</strong>
   <a href="#33488" class="date">27-Jun-2003 08:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to chown a symlink, PHP will follow the symlink and change the target file.<br />
<br />
If you want to chown the symlink, you have to use shell_exec("/bin/chown user.group symlink");</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="33261""></a>
  <div class="note">
   <strong class="user">martijn at sigterm dot nl</strong>
   <a href="#33261" class="date">20-Jun-2003 07:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If chown is filled with a variable (&nbsp; chown ("myfile", $uid) the uid will be looked up through pwget_uid.<br />
<br />
So if you need to set a non existing uid use inval($uid).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="8646""></a>
  <div class="note">
   <strong class="user">njs+php at scifi dot squawk dot com</strong>
   <a href="#8646" class="date">21-Sep-2000 11:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you allow sudo execution for chmod by "nobody" (www, webdaemon, httpd, whatever user php is running under)in this manner, it had better be a system on which the owner is able to be root and no one else can run code, else your whole system is compromised.&nbsp; Someone could change the mode of /etc/passwd or the shadow password file.
<br />

<br />
Other system commands (sudo mount) and so forth are similar.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
