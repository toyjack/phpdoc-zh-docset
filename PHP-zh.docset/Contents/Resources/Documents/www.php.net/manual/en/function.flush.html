<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>刷新输出缓冲</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="ref.outcontrol.html">? Output Control 函数</a></li>
      <li style="float: right;"><a href="function.ob-clean.html">ob_clean ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.outcontrol.html">Output Control 函数</a></li>
    <li>刷新输出缓冲</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.flush" class="refentry">
   <div class="refnamediv">
    <h1 class="refname">flush</h1> 
    <p class="verinfo">(PHP 4, PHP 5, PHP 7)</p><p class="refpurpose"><span class="refname">flush</span> &mdash; <span class="dc-title">刷新输出缓冲</span></p>

   </div>
   <div class="refsect1 unknown-seealsp" id="refsect1-function.flush-unknown-seealsp">
    <h3 class="title">说明</h3>
     <div class="methodsynopsis dc-description">
      <span class="methodname"><strong>flush</strong></span>
       ( <span class="methodparam">void</span>
      ) : <span class="type"><span class="type void">void</span></span></div>

    <p class="simpara">
     刷新PHP程序的缓冲，而不论PHP执行在何种情况下（CGI ，web服务器等等）。该函数将当前为止程序的所有输出发送到用户的浏览器。
    </p>
    <p class="para">
     <span class="function"><strong>flush()</strong></span> 函数不会对服务器或客户端浏览器的缓存模式产生影响。因此，必须同时使用 <span class="function"><a href="function.ob-flush.html" class="function">ob_flush()</a></span> 和<span class="function"><strong>flush()</strong></span> 函数来刷新输出缓冲。
    </p>
    <p class="para">
     个别web服务器程序，特别是Win32下的web服务器程序，在发送结果到浏览器之前，仍然会缓存脚本的输出，直到程序结束为止。
    </p>
    <p class="para">
     有些Apache的模块，比如mod_gzip，可能自己进行输出缓存，这将导致<span class="function"><strong>flush()</strong></span>函数产生的结果不会立即被发送到客户端浏览器。
    </p>
    <p class="para">
     甚至浏览器也会在显示之前，缓存接收到的内容。例如 Netscape 浏览器会在接受到换行或 html 标记的开头之前缓存内容，并且在接受到 &lt;/table&gt; 标记之前，不会显示出整个表格。
    </p>
    <p class="para">
     一些版本的 Microsoft Internet Explorer 只有当接受到的256个字节以后才开始显示该页面，所以必须发送一些额外的空格来让这些浏览器显示页面内容。
    </p>
   </div>

  </div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="124861""></a>
  <div class="note">
   <strong class="user">glafarge</strong>
   <a href="#124861" class="date">27-Mar-2020 06:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When using PHP with mode CGI/FastCGI there is a new buffer (initiated by mod_fcgid with a default size of 65536 bytes). That causes `flush()` and `ob_flush()` not working as expected with implicit_flush(true).<br />
Setting "OutputBufferSize 0" in mod_fcgid config resolves the issue.<br />
Hope it helps !</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="124096""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#124096" class="date">07-Aug-2019 06:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Regarding buffering by browser you can use:<br />
<br />
$out=str_pad($yourMessage.'&lt;br/&gt;',1024);<br />
print($out);<br />
ob_flush();<br />
flush();<br />
<br />
Works for me in Firefox 60 ESR.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="118116""></a>
  <div class="note">
   <strong class="user">php nospace juju ta ggooggle mail</strong>
   <a href="#118116" class="date">06-Oct-2015 10:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
combining some ideas i was finally able to get a long running script to give me real time feedback on what it was doing.&nbsp; this was a wamp setup with php running as cgi.&nbsp; i'm pretty sure that apache just wasn't sending any of the buffered output because it was trying to be helpful. also trying to be helpful, i hope this example solution helps someone.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// thx mandor at mandor<br />
</span><span class="default">ini_set</span><span class="keyword">(</span><span class="string">'max_execution_time'</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
</span><span class="default">ini_set</span><span class="keyword">(</span><span class="string">'implicit_flush'</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
</span><span class="default">ob_implicit_flush</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">);<br />
<br />
echo </span><span class="string">'doing something'</span><span class="keyword">;&nbsp; </span><span class="default">my_flush</span><span class="keyword">();<br />
</span><span class="default">sleep</span><span class="keyword">(</span><span class="default">5</span><span class="keyword">);<br />
echo </span><span class="string">'doing something else'</span><span class="keyword">; </span><span class="default">my_flush</span><span class="keyword">();<br />
</span><span class="default">sleep</span><span class="keyword">(</span><span class="default">5</span><span class="keyword">);<br />
echo </span><span class="string">'finally done - hooray'</span><span class="keyword">;<br />
<br />
function </span><span class="default">my_flush</span><span class="keyword">() {<br />
&nbsp; </span><span class="comment">// following matt at hevanet's lead<br />
&nbsp; </span><span class="keyword">for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">10000</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">++) echo </span><span class="string">' '</span><span class="keyword">;<br />
&nbsp; </span><span class="default">ob_flush</span><span class="keyword">();<br />
&nbsp; </span><span class="default">flush</span><span class="keyword">();<br />
}</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="116485""></a>
  <div class="note">
   <strong class="user">ohcc at 163 dot com</strong>
   <a href="#116485" class="date">10-Jan-2015 07:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Try to add more white spaces if your ob_flush() and flush() don't work, especially under NGINX.<br />
However, too many white spaces can be a challenge to your web browser.<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; ob_clean</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; while(</span><span class="default">true</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">str_repeat</span><span class="keyword">(</span><span class="string">' '</span><span class="keyword">,</span><span class="default">1024</span><span class="keyword">*</span><span class="default">1024</span><span class="keyword">*</span><span class="default">4</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">'hello, world ...&lt;br /&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ob_flush</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">flush</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">usleep</span><span class="keyword">(</span><span class="default">1000</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="113360""></a>
  <div class="note">
   <strong class="user">php at stelio dot net</strong>
   <a href="#113360" class="date">01-Oct-2013 11:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For a Windows system using IIS, the ResponseBufferLimit takes precedence over PHP's output_buffering settings. So you must also set the ResponseBufferLimit to be something lower than its default value.<br />
<br />
For IIS versions older than 7, the setting can be found in the %windir%\System32\inetsrv\fcgiext.ini file (the FastCGI config file). You can set the appropriate line to:<br />
&nbsp; ResponseBufferLimit=0<br />
<br />
For IIS 7+, the settings are stored in %windir%\System32\inetsrv\config. Edit the applicationHost.config file and search for PHP_via_FastCGI (assuming that you have installed PHP as a FastCGI module, as per the installation instructions, with the name PHP_via_FastCGI). Within the add tag, place the following setting at the end:<br />
&nbsp; responseBufferLimit="0"<br />
So the entire line will look something like:<br />
&nbsp; &lt;add name="PHP_via_FastCGI" path="*.php" verb="*" modules="FastCgiModule" scriptProcessor="C:\PHP\php-cgi.exe" resourceType="Either" responseBufferLimit="0" /&gt;<br />
Alternatively you can insert the setting using the following command:<br />
&nbsp; %windir%\system32\inetsrv\appcmd.exe set config /section:handlers "/[name='PHP_via_FastCGI'].ResponseBufferLimit:0"</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="109239""></a>
  <div class="note">
   <strong class="user">Kris</strong>
   <a href="#109239" class="date">29-Jun-2012 01:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I had a bunch of problems trying to get flush working on my windows box, I finally found a solution after reading everyones here and it not working.<br />
<br />
1) Set output_buffering = 0<br />
2) Set zlib.output_compression = 0<br />
<br />
I then used Wireshark to monitor network packets, and indeed the server was pusing the data, but the browser was not displaying it.. So it was a browser buffer issue (I am on Firefox 13)<br />
<br />
For me I needed to send about 1k of data before it would display the data. To do this I added more header information.. <br />
&nbsp;In php.ini I set default_charset = "utf-8"<br />
And that was enough to give me enough for the buffer issue.<br />
<br />
You can also try doing <br />
echo str_repeat(" ", 1024), "\n";<br />
at the start of the script.<br />
<br />
hope this helps</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99988""></a>
  <div class="note">
   <strong class="user">seb dot field at gmail dot com</strong>
   <a href="#99988" class="date">18-Sep-2010 03:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If flush() function does not work. You must set next options in php.ini like:<br />
<br />
--[code]--<br />
&nbsp;output_buffering = Off&nbsp; <br />
&nbsp;;output_handler =&nbsp;&nbsp; <br />
&nbsp;zlib.output_compression = Off&nbsp; <br />
&nbsp;;zlib.output_handler =&nbsp;&nbsp; <br />
--[^code^]--<br />
<br />
If things does not work you must view headers from the server and check `Server` string.<br />
In my case, as the frontend was Nginx webserver and Apache work as backend.<br />
Accordingly, buffering must be disabled in Nginx config file.<br />
To stop buffering you must add next string to config file:<br />
<br />
--[code]--<br />
proxy_buffering off;<br />
--[^code^]--<br />
<br />
and restart Nginx daemon.&nbsp; More information about&nbsp; configuration you find in documentation on the nginx website.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91556""></a>
  <div class="note">
   <strong class="user">jason@jasonbaumgartner@info</strong>
   <a href="#91556" class="date">16-Jun-2009 05:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Many of the suggestions below are very helpful but I would just like to clarify something.&nbsp; <br />
<br />
If you are making calls to a .php script with AJAX (xmlHttpReq) and use flush, this will send data to your script HOWEVER it will not set the xmlHttpReq.readyState to 4 -- which is a requirement to use the information sent (Firefox does however allow you to use the responseText property with a readyState == 3 but IE will throw an error).<br />
<br />
To get around this, you will need to make sure of a couple things:<br />
<br />
In your Apache php.ini config file, check to make sure that output buffering is disabled:<br />
<br />
output_buffering = off<br />
<br />
Next, disable gzip compression for the .php script that is called from your AJAX script by using the excellent suggestion from Mandor by placing the following at the top of your script:<br />
<br />
@apache_setenv('no-gzip', 1);<br />
@ini_set('zlib.output_compression', 0);<br />
<br />
What causes this problem is that while the php child process is running under apache, apache is waiting for the script to complete before completely closing the connection.&nbsp; Scripts that send information directly to the browser with echos and prints will get away with using flush followed by a sleep command and then clean up procedures.&nbsp; However, if you notice in the status bar of your browser window, the connection is still held open by apache until the script completed ("Transferring" ... yadda yadda).<br />
<br />
By turning off the Apache compression, the connection is terminated directly after a flush while still giving the user the ability to run a sleep command followed by clean up code.<br />
<br />
This bit me because the AJAX was returning &lt;img&gt; tags to newly created images by php.&nbsp; The cleanup script would then remove those images after completion.&nbsp; <br />
<br />
Since Apache held the connection open, the readyState only changed to 4 AFTER my php cleanup fired -- thereby erasing the links referred to my the &lt;img&gt; tags.<br />
<br />
With this solution, the readyState will change to 4 BEFORE the sleep command begins.<br />
<br />
I hope this saves someone a lot of time and frustration.&nbsp; AJAX requests are an entirely different beast compared with simple outputting to a browser window.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="87807""></a>
  <div class="note">
   <strong class="user">mandor at mandor dot net</strong>
   <a href="#87807" class="date">22-Dec-2008 07:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is what I use to turn off pretty much anything that could cause unwanted output buffering and turn on implicit flush:<br />
<br />
<span class="default">&lt;?php<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">@</span><span class="default">apache_setenv</span><span class="keyword">(</span><span class="string">'no-gzip'</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; @</span><span class="default">ini_set</span><span class="keyword">(</span><span class="string">'zlib.output_compression'</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; @</span><span class="default">ini_set</span><span class="keyword">(</span><span class="string">'implicit_flush'</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">ob_get_level</span><span class="keyword">(); </span><span class="default">$i</span><span class="keyword">++) { </span><span class="default">ob_end_flush</span><span class="keyword">(); }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">ob_implicit_flush</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
If it still fails though, keep in mind that Internet Explorer and Safari have a 1k buffer before incremental rendering kicks in, so you'll want to output some padding as well.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="87040""></a>
  <div class="note">
   <strong class="user">Arerano</strong>
   <a href="#87040" class="date">16-Nov-2008 06:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This helped me getting flushing to work.<br />
Using apache with deflate.<br />
<br />
Turning compression off for this script: (add it somewhere at the top of the script)<br />
apache_setenv('no-gzip', '1');<br />
<br />
However, this only works if php is running as a module rather than a cgi-extension and safe mode must be disabled.<br />
<br />
You can also turn the compression off for a directory by making a .htaccess file and adding the following entry:<br />
mod_gzip_on Off<br />
<br />
However that affects the whole directory.<br />
Hope I could help.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86307""></a>
  <div class="note">
   <strong class="user">Mr.KTO</strong>
   <a href="#86307" class="date">12-Oct-2008 06:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
IE 7, Opera 9.6, any. All is quite simple. Today I just fogot what i do every night, :)<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// All you need is 256 spaces first<br />
</span><span class="keyword">echo </span><span class="default">str_repeat</span><span class="keyword">(</span><span class="string">" "</span><span class="keyword">, </span><span class="default">256</span><span class="keyword">).</span><span class="string">"&lt;pre&gt;"</span><span class="keyword">; </span><span class="default">flush</span><span class="keyword">();<br />
<br />
</span><span class="comment">// and ANY TAG before \r\n<br />
</span><span class="keyword">echo </span><span class="string">"working...&lt;br/&gt;\r\n"</span><span class="keyword">; </span><span class="default">flush</span><span class="keyword">(); </span><span class="default">sleep</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">); </span><span class="comment">// this in cycle<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85382""></a>
  <div class="note">
   <strong class="user">Lucas</strong>
   <a href="#85382" class="date">27-Aug-2008 03:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I just had some problems with flush() and ob_flush(). What I did to resolve this problem took me some time to figure out so I'd like to share what I came up with.<br />
<br />
The main problem is the php setting "output_buffering" which can be set too large and will prevent your text from outputting. To change this value you can either set it in php.ini or you can add the line <br />
<br />
php_value output_buffering "0"<br />
<br />
to your .htaccess file. It will not work with ini_set() since it is PHP_INI_PERDIR.<br />
<br />
Next thing is to begin with ob_start();<br />
Then you need<br />
ob_flush();<br />
flush();<br />
before any echo or print.<br />
<br />
Your code might look like this:<br />
<br />
<span class="default">&lt;?php<br />
ob_start</span><span class="keyword">();<br />
<br />
for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">70</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">++)<br />
{<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">'printing...&lt;br /&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">ob_flush</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">flush</span><span class="keyword">();<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">usleep</span><span class="keyword">(</span><span class="default">300000</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Hope this helps anyone with the same problems.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83037""></a>
  <div class="note">
   <strong class="user">David</strong>
   <a href="#83037" class="date">07-May-2008 02:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
mod_security 2.x core rules will also prevent flush() from working.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76039""></a>
  <div class="note">
   <strong class="user">chuck at artistan dot org</strong>
   <a href="#76039" class="date">27-Jun-2007 06:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
had problems flushing tables to screen.
<br />
this worked for me
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">if (</span><span class="default">ob_get_level</span><span class="keyword">() == </span><span class="default">0</span><span class="keyword">) </span><span class="default">ob_start</span><span class="keyword">();
<br />
</span><span class="default">loop</span><span class="keyword">{
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">tables </span><span class="keyword">and </span><span class="default">stuff
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">echo </span><span class="default">str_pad</span><span class="keyword">(</span><span class="string">"&lt;br&gt;\n"</span><span class="keyword">,</span><span class="default">8</span><span class="keyword">);
<br />
}
<br />
</span><span class="default">ob_flush</span><span class="keyword">();
<br />
</span><span class="default">flush</span><span class="keyword">();&nbsp; </span><span class="comment">// needed ob_flush
<br />
</span><span class="default">usleep</span><span class="keyword">(</span><span class="default">50000</span><span class="keyword">);</span><span class="comment">// delay minimum of .05 seconds to allow ie to flush to screen
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75115""></a>
  <div class="note">
   <strong class="user">mbilliet at gmail dot com</strong>
   <a href="#75115" class="date">13-May-2007 03:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hello,<br />
<br />
I had the same problems with sending a javascript after the &lt;body&gt;&lt;/body&gt; content has been sent to the browser (the script updates the content of an iframe).<br />
<br />
Two solutions work for me:<br />
&nbsp;&nbsp; - add enough data (i.e.: extra dummy text like spaces) or,<br />
&nbsp;&nbsp; - echo the '&lt;/body&gt;' tag at the end of the page<br />
<br />
Note, that for the latter to work one should:<br />
&nbsp;&nbsp; - turn of output_buffering in php.ini and either:<br />
&nbsp;&nbsp; &nbsp;&nbsp; * turn on implicit_flush in its php.ini or,<br />
&nbsp;&nbsp; &nbsp;&nbsp; * call ob_implicit_flush(); at the beginning of a script<br />
<br />
I preferr echoing the '&lt;/body&gt;' tag at the end as it doesn't require any extra data to be sent over the wire and its much a neater coding technique.<br />
<br />
Notes:<br />
&nbsp;&nbsp; - these worakarounds aren't needed when using perl and cgi,... .<br />
&nbsp;&nbsp; - you can leave the zlib.output_compression in your php.ini switched on<br />
<br />
Kind regards and hoped this is of any help.<br />
<br />
Maurits</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74698""></a>
  <div class="note">
   <strong class="user">macott[D0T]daiato[4T]gmail[D0T]com</strong>
   <a href="#74698" class="date">24-Apr-2007 12:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If flush() don't work remember to check if you have any antivirus caching the data sent to the browser.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74222""></a>
  <div class="note">
   <strong class="user">Leon</strong>
   <a href="#74222" class="date">30-Mar-2007 04:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I've spent days trying to figure out why flush didn't work all of a sudden, while it used to work perfectly. Apparently, it was McAfee Spamkiller that caused problems. Disabling it didn't work, I had to completely remove it. Hope this helps someone.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="72985""></a>
  <div class="note">
   <strong class="user">Kirk</strong>
   <a href="#72985" class="date">06-Feb-2007 12:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you're not explictly using the buffering functions, then ob_flush() is only necessary if output buffering is turned on in your php.ini file.<br />
<br />
flush() is only necessary if implicit_flush is turned off in your php.ini file. Setting implicit_flush to on will remove the need for all these flush() calls, but it's generally only good in an extremely controlled environment. Turning on implicit_flush in a production environment can be bad.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68620""></a>
  <div class="note">
   <strong class="user">no at spam dot com</strong>
   <a href="#68620" class="date">03-Aug-2006 11:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
ob_flush();flush();<br />
<br />
Not the other way around, because it wont work.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="64010""></a>
  <div class="note">
   <strong class="user">vlad at modomail dot com</strong>
   <a href="#64010" class="date">05-Apr-2006 06:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Sorry if this is off topic, but it's the closest place I could find :)&nbsp; I had an issue with essentially running a CPU intensive task while updating the browser with a progress bar via javascript and flushing the buffer a lot.<br />
<br />
When the script was running, it effectively blocked other pages from running.&nbsp; I had a few extra httpd_preforks processes just waiting to be used, but they just sat there.&nbsp; I wasn't reading a file, locking database tables or anything that I would suspect an exclusive lock on, just outputting a bunch of text to the browser.&nbsp; I even tried throttling my loops to see if it was processor related but still had problems.<br />
<br />
Finally, I found this in the php.ini file and changed the On to Off and it worked.<br />
<br />
[Sockets]<br />
; Use the system read() function instead of the php_read() wrapper.<br />
sockets.use_system_read = Off<br />
<br />
Posting in case someone else has the same issue (or if someone knows why this would make a difference :) ).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="59066""></a>
  <div class="note">
   <strong class="user">mega023 at gmail dot com</strong>
   <a href="#59066" class="date">25-Nov-2005 03:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If flush is not working probably mod_gzip is enabled.<br />
To disable it just add following lines to .htaccess<br />
<br />
&lt;IfModule mod_gzip.c&gt;<br />
mod_gzip_on no<br />
&lt;/IfModule&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="57398""></a>
  <div class="note">
   <strong class="user">mikael at oebb dot net</strong>
   <a href="#57398" class="date">03-Oct-2005 01:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hi all.<br />
Been scratching my head over data NOT flushed to IE (6) even though I tried strpad 4096 chars, all headers OK,&nbsp; TABLE and no TABLE, flush and ob_flush - still a blank page. Tried adding a sleep(1) before flushing - and everything worked as a charm.&nbsp; <br />
<br />
/Mikael</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="56951""></a>
  <div class="note">
   
   <a href="#56951" class="date">20-Sep-2005 12:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In my testing, Internet Explorer 6.0 wouldn't flush anything nested in &lt;table&gt; or &lt;td&gt; tags, regardless of padding. But at the &lt;body&gt; level everything flushed with no fuss -- no padding or tags required.<br />
<br />
Both Firefox 1.0 and Safari 2.0 could flush within tables, and both required a tag after the text (like &lt;br&gt;). Safari could flush only after the first 1024 characters where received. Firefox needed at least 8 characters per flush (but it could flush anything at the &lt;body&gt; level).<br />
<br />
So the only thing that worked on all those browsers was this:<br />
<br />
&lt;html&gt;<br />
&lt;body&gt;<br />
<span class="default">&lt;?php&nbsp; </span><span class="comment">// not in table tags for IE<br />
</span><span class="keyword">echo </span><span class="default">str_pad</span><span class="keyword">(</span><span class="string">''</span><span class="keyword">,</span><span class="default">1024</span><span class="keyword">);&nbsp; </span><span class="comment">// minimum start for Safari<br />
</span><span class="keyword">for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">10</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">&gt;</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">--) {<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">str_pad</span><span class="keyword">(</span><span class="string">"</span><span class="default">$i</span><span class="string">&lt;br&gt;\n"</span><span class="keyword">,</span><span class="default">8</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// tag after text for Safari &amp; Firefox<br />
&nbsp;&nbsp;&nbsp; // 8 char minimum for Firefox<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">flush</span><span class="keyword">();&nbsp; </span><span class="comment">// worked without ob_flush() for me<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">sleep</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;<br />
</span>&lt;/body&gt;<br />
&lt;/html&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="54841""></a>
  <div class="note">
   <strong class="user">js at jeansebastien dot com</strong>
   <a href="#54841" class="date">16-Jul-2005 11:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This will show each line at a time with a pause of 2 seconds.<br />
(Tested under IEx and Firefox)<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">if (</span><span class="default">ob_get_level</span><span class="keyword">() == </span><span class="default">0</span><span class="keyword">) </span><span class="default">ob_start</span><span class="keyword">();<br />
<br />
for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">10</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++){<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"&lt;br&gt; Line to show."</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">str_pad</span><span class="keyword">(</span><span class="string">''</span><span class="keyword">,</span><span class="default">4096</span><span class="keyword">).</span><span class="string">"\n"</span><span class="keyword">;&nbsp; &nbsp; <br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ob_flush</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">flush</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">sleep</span><span class="keyword">(</span><span class="default">2</span><span class="keyword">);<br />
}<br />
<br />
echo </span><span class="string">"Done."</span><span class="keyword">;<br />
<br />
</span><span class="default">ob_end_flush</span><span class="keyword">();<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="52863""></a>
  <div class="note">
   <strong class="user">MOELZE ?T GMX DOt DE   (Michael)</strong>
   <a href="#52863" class="date">15-May-2005 04:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It is a bit complicated to work with the funktion flush() and you have to experiment with it a bit.
<br />
So if you design a site which has a timeloop at the end that calls a other site via a form data input (Data Submit) you have
<br />
to give something out to the buffer to get that new site loaden quick.
<br />

<br />
For example:
<br />

<br />
<span class="default">&lt;?php
<br />
$instant</span><span class="keyword">=</span><span class="default">gettimeofday</span><span class="keyword">();
<br />
</span><span class="default">$timenow</span><span class="keyword">=</span><span class="default">$instant</span><span class="keyword">[</span><span class="string">"sec"</span><span class="keyword">];</span><span class="comment">//Start Time
<br />

<br />
//timeloop(e.g. for security_save after 30 min)
<br />
</span><span class="keyword">while (</span><span class="default">1</span><span class="keyword">) { echo </span><span class="string">"&lt;b&gt;&lt;/b&gt;"</span><span class="keyword">;</span><span class="comment">//Useless (only to quickload next
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //or same Site when do a switch)
<br />
</span><span class="default">flush</span><span class="keyword">();&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">//giveout buffer
<br />
</span><span class="default">$instant</span><span class="keyword">=</span><span class="default">gettimeofday</span><span class="keyword">();
<br />
</span><span class="default">$timeactual</span><span class="keyword">=</span><span class="default">$instant</span><span class="keyword">[</span><span class="string">"sec"</span><span class="keyword">]; </span><span class="comment">//get Actual Time in Secs
<br />
</span><span class="default">$flag</span><span class="keyword">=((</span><span class="default">$timeactual</span><span class="keyword">&gt;</span><span class="default">$timenow</span><span class="keyword">+</span><span class="default">$diff</span><span class="keyword">)? </span><span class="default">1</span><span class="keyword">:</span><span class="default">0</span><span class="keyword">);</span><span class="comment">//$diff=switchTime
<br />
</span><span class="keyword">if (</span><span class="default">$flag</span><span class="keyword">) { </span><span class="default">what_do_at_switch_Time</span><span class="keyword">();</span><span class="comment">//Sec.Save etc.etc.
<br />
</span><span class="default">$timenow</span><span class="keyword">=</span><span class="default">$timeactual</span><span class="keyword">; } </span><span class="comment">//Set new Start Time
<br />
</span><span class="default">sleep</span><span class="keyword">(</span><span class="default">5</span><span class="keyword">); </span><span class="comment">//Or so...(Important)
<br />
</span><span class="keyword">} </span><span class="comment">//End of while-Loop
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
So you can programm a security save or other function in your site and if you do a switch the upload of the new or same site (the called site) works...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="52147""></a>
  <div class="note">
   <strong class="user">Alex</strong>
   <a href="#52147" class="date">22-Apr-2005 02:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Modified progress bar.. Works in IE, Mozilla+FF.<br />
<br />
&lt;html&gt;<br />
&lt;head&gt;<br />
&lt;style type="text/css"&gt;&lt;!--<br />
<br />
div {<br />
&nbsp;margin: 1px;<br />
&nbsp;height: 20px;<br />
&nbsp;padding: 1px;<br />
&nbsp;border: 1px solid #000;<br />
&nbsp;width: 275px;<br />
&nbsp;background: #fff;<br />
&nbsp;color: #000;<br />
&nbsp;float: left;<br />
&nbsp;clear: right;<br />
&nbsp;top: 38px;<br />
&nbsp;z-index: 9<br />
}<br />
<br />
.percents {<br />
&nbsp;background: #FFF;<br />
&nbsp;border: 1px solid #CCC;<br />
&nbsp;margin: 1px;<br />
&nbsp;height: 20px;<br />
&nbsp;position:absolute;<br />
&nbsp;width:275px;<br />
&nbsp;z-index:10;<br />
&nbsp;left: 10px;<br />
&nbsp;top: 38px;<br />
&nbsp;text-align: center;<br />
}<br />
<br />
.blocks {<br />
&nbsp;background: #EEE;<br />
&nbsp;border: 1px solid #CCC;<br />
&nbsp;margin: 1px;<br />
&nbsp;height: 20px;<br />
&nbsp;width: 10px;<br />
&nbsp;position: absolute;<br />
&nbsp;z-index:11;<br />
&nbsp;left: 12px;<br />
&nbsp;top: 38px;<br />
&nbsp;filter: alpha(opacity=50);<br />
&nbsp;-moz-opacity: 0.5;<br />
&nbsp;opacity: 0.5;<br />
&nbsp;-khtml-opacity: .5<br />
}<br />
<br />
--&gt;<br />
&lt;/style&gt;<br />
&lt;/head&gt;<br />
&lt;body&gt;<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">if (</span><span class="default">ob_get_level</span><span class="keyword">() == </span><span class="default">0</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">ob_start</span><span class="keyword">();<br />
}<br />
echo </span><span class="default">str_pad</span><span class="keyword">(</span><span class="string">'Loading... '</span><span class="keyword">,</span><span class="default">4096</span><span class="keyword">).</span><span class="string">"&lt;br /&gt;\n"</span><span class="keyword">;<br />
for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">25</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$d </span><span class="keyword">= </span><span class="default">$d </span><span class="keyword">+ </span><span class="default">11</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$m</span><span class="keyword">=</span><span class="default">$d</span><span class="keyword">+</span><span class="default">10</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//This div will show loading percents<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">echo </span><span class="string">'&lt;div class="percents"&gt;' </span><span class="keyword">. </span><span class="default">$i</span><span class="keyword">*</span><span class="default">4 </span><span class="keyword">. </span><span class="string">'%&amp;nbsp;complete&lt;/div&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//This div will show progress bar<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">echo </span><span class="string">'&lt;div class="blocks" style="left: '</span><span class="keyword">.</span><span class="default">$d</span><span class="keyword">.</span><span class="string">'px"&gt;&amp;nbsp;&lt;/div&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">flush</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">ob_flush</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">sleep</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">);<br />
}<br />
</span><span class="default">ob_end_flush</span><span class="keyword">();<br />
</span><span class="default">?&gt;<br />
</span>&lt;div class="percents" style="z-index:12"&gt;Done.&lt;/div&gt;<br />
&lt;/body&gt;<br />
&lt;/html&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="51920""></a>
  <div class="note">
   <strong class="user">Marty</strong>
   <a href="#51920" class="date">14-Apr-2005 08:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is an extention of Rusty's comment below: <br />
<br />
After sitting here for hours trying to make IE6 flush data out in the middle of a page (with it working perfectly in Firefox), I finally figured out the problem. IE will not display flushed data (even if it has it) unless the table that contains it is complete.<br />
<br />
Every new element you want IE to display must not be in ANY kind of table at all. You must end all your tables.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="51679""></a>
  <div class="note">
   <strong class="user">Ghostshaw at spymac dot com</strong>
   <a href="#51679" class="date">07-Apr-2005 04:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I would like to point out that there is a function to replace ob_flush and flush. If you set ob_implicit_flush(true); at the top of the page it will automatically flush any echo or print you do in the rest of the script.<br />
<br />
Note that you still need a minimum amount of data to come through the browser filter. I would advice using str_pad($text,4096); since this automatically lenghtens the text with spaces to 4 KB which is the minimum limit when using FireFox and linux.<br />
<br />
I hope this helps you all out a bit.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="51143""></a>
  <div class="note">
   <strong class="user">matt at nospamplease dot hevanet dot com</strong>
   <a href="#51143" class="date">21-Mar-2005 10:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Like IE, Safari needs a fair amount of data before it'll display anything, actually more than explorer.&nbsp; The following code works for me in Firefox and Safari, and should work in IE as well.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">for(</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">40000</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++)<br />
{<br />
echo </span><span class="string">' '</span><span class="keyword">; </span><span class="comment">// extra spaces<br />
</span><span class="keyword">}<br />
</span><span class="comment">// keeps it flowing to the browser?<br />
</span><span class="default">flush</span><span class="keyword">();<br />
</span><span class="comment">// 50000 microseconds keeps things flowing in safari, IE, firefox, etc<br />
</span><span class="default">usleep</span><span class="keyword">(</span><span class="default">50000</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
This code came from a comment on a blog discussing browser functionality with flush();</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="50624""></a>
  <div class="note">
   <strong class="user">crmacd at yahoo dot com</strong>
   <a href="#50624" class="date">04-Mar-2005 03:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I figured out a way to create a simple progress bar that is for the most part cross platform. Seeing as I got my ideas from this site it's only share to give back to the community.<br />
<br />
Note: Something interesting about browser buffering... you have to have the &lt;html&gt;&lt;body&gt; for Firefox and some other browsers to recognize items by their id in Javascript. So I recommend using some sort of header function before calling this function.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">fn_progress_bar</span><span class="keyword">(</span><span class="default">$intCurrentCount </span><span class="keyword">= </span><span class="default">100</span><span class="keyword">, </span><span class="default">$intTotalCount </span><span class="keyword">= </span><span class="default">100</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; static </span><span class="default">$intNumberRuns </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; static </span><span class="default">$intDisplayedCurrentPercent </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$strProgressBar </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$dblPercentIncrease </span><span class="keyword">= (</span><span class="default">100 </span><span class="keyword">/ </span><span class="default">$intTotalCount</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$intCurrentPercent </span><span class="keyword">= </span><span class="default">intval</span><span class="keyword">(</span><span class="default">$intCurrentCount </span><span class="keyword">* </span><span class="default">$dblPercentIncrease</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$intNumberRuns</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">1 </span><span class="keyword">== </span><span class="default">$intNumberRuns</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$strProgressBar </span><span class="keyword">= &lt;&lt;&lt; BAR<br />
</span><span class="string">&lt;table width='50%' id='progress_bar' summary='progress_bar' align='center'&gt;&lt;tbody&gt;&lt;tr&gt;<br />
&lt;td id='progress_bar_complete' width='0%' align='center' style='background:#CCFFCC;'&gt;&amp;nbsp;&lt;/td&gt;<br />
&lt;td style='background:#FFCCCC;'&gt;&amp;nbsp;&lt;/td&gt;<br />
&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;<br />
&lt;script type='text/javascript' language='javascript'&gt;<br />
function dhd_fn_progress_bar_update(intCurrentPercent)<br />
{<br />
&nbsp;&nbsp;&nbsp; document.getElementById('progress_bar_complete').style.width = intCurrentPercent+'%';<br />
&nbsp;&nbsp;&nbsp; document.getElementById('progress_bar_complete').innerHTML = intCurrentPercent+'%';<br />
}<br />
&lt;/script&gt;<br />
</span><span class="keyword">BAR;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; else if(</span><span class="default">$intDisplayedCurrentPercent </span><span class="keyword">&lt;&gt; </span><span class="default">$intCurrentPercent</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$intDisplayedCurrentPercent </span><span class="keyword">= </span><span class="default">$intCurrentPercent</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$strProgressBar </span><span class="keyword">= &lt;&lt;&lt; BAR<br />
</span><span class="string">&lt;script type='text/javascript' language='javascript'&gt;<br />
dhd_fn_progress_bar_update(</span><span class="default">$intCurrentPercent</span><span class="string">);<br />
&lt;/script&gt;<br />
</span><span class="keyword">BAR;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">100 </span><span class="keyword">&lt;= </span><span class="default">$intCurrentPercent</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$intNumberRuns </span><span class="keyword">= </span><span class="default">$intDisplayedCurrentPercent </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$strProgressBar </span><span class="keyword">= &lt;&lt;&lt; BAR<br />
</span><span class="string">&lt;script type='text/javascript' language='javascript'&gt;<br />
document.getElementById('progress_bar').style.visibility='hidden';<br />
&lt;/script&gt;<br />
</span><span class="keyword">BAR;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">$strProgressBar</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">flush</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">ob_flush</span><span class="keyword">();<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="50610""></a>
  <div class="note">
   <strong class="user">siggi AT june systems DOT com</strong>
   <a href="#50610" class="date">04-Mar-2005 07:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
After searching through the PHP site, google and various forums, not finding a solution to my script not outputting anything while calling flush and ob_flush, I thought of trying to tell PHP to call:<br />
<br />
session_write_close();<br />
<br />
before starting echo'ing. It worked like a charm. I couldn't find any references to this, so I hope this note will help someone in the future.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="49569""></a>
  <div class="note">
   <strong class="user">Squ1sher</strong>
   <a href="#49569" class="date">01-Feb-2005 12:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
On Windows xampp 1.3 with php 4.3.4 is use this functions
<br />
to force a flush.
<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">dummyErrorHandler </span><span class="keyword">(</span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">$errfile</span><span class="keyword">, </span><span class="default">$errline</span><span class="keyword">) {
<br />
}
<br />

<br />
function </span><span class="default">forceFlush</span><span class="keyword">() {&nbsp; &nbsp; 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">ob_start</span><span class="keyword">();
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">ob_end_clean</span><span class="keyword">();
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">flush</span><span class="keyword">();
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">set_error_handler</span><span class="keyword">(</span><span class="string">"dummyErrorHandler"</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">ob_end_flush</span><span class="keyword">();
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">restore_error_handler</span><span class="keyword">();
<br />
}
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
ob_end_flush generates a warning, which is supressed, using the dummy-errorhander. You could also use @, but then nusphere will also print the warning.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="40180""></a>
  <div class="note">
   <strong class="user">Rusty</strong>
   <a href="#40180" class="date">24-Feb-2004 09:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Netscape will flush the output as expected at the point it is called from within your script. IE, however, needs a boost.<br />
<br />
IE seems to have a condition where it will flush data when it hits an end (&lt;/table&gt;) tag AND has at least 256 chars of data.<br />
<br />
So, pad your output with necessary spaces, wrap your progressing data around open (&lt;table&gt;) and end (&lt;/table&gt;) tags, and then call flush() so that one script will work for Netscape as well.<br />
<br />
TESTING ENVIRONMENT<br />
IE: Ver/6.0.2800<br />
Netscape: Ver/7.1<br />
PHP: Ver/4.3.4<br />
Apache: Ver/1.3.27</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="36973""></a>
  <div class="note">
   <strong class="user">m@rco</strong>
   <a href="#36973" class="date">29-Oct-2003 07:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
in order to display in HTML pages something like a "progress bar" or if you want to force the web server to flush output to the browser, or the browser to flush as well, you can print a long enough "dummy" string to make the output buffer grow, as you probably know, like:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">print </span><span class="string">"["</span><span class="keyword">;
<br />

<br />
for(</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">100</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++){
<br />
&nbsp; </span><span class="default">$spaces</span><span class="keyword">.=</span><span class="string">" "</span><span class="keyword">;
<br />
} </span><span class="comment">// for
<br />

<br />
//and then
<br />

<br />
</span><span class="keyword">for(</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">10</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++){
<br />
&nbsp; for(</span><span class="default">$ii </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$ii </span><span class="keyword">&lt; </span><span class="default">200000</span><span class="keyword">; </span><span class="default">$ii</span><span class="keyword">++){
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//do something slow here
<br />
&nbsp; </span><span class="keyword">} </span><span class="comment">// for
<br />
&nbsp; </span><span class="keyword">print </span><span class="string">"</span><span class="default">$spaces</span><span class="string">|"</span><span class="keyword">;
<br />
&nbsp; </span><span class="default">flush</span><span class="keyword">();
<br />
} </span><span class="comment">// for
<br />

<br />
</span><span class="keyword">print </span><span class="string">"]"</span><span class="keyword">;
<br />

<br />
</span><span class="comment">/*
<br />
but this somethin may be not really what you expect in
<br />
a progress bar, as it prints spaces (although rendered as single by the browser) between the bar units..
<br />
you can solve this using 
<br />
&nbsp; $spaces.="&lt;!-- bufferme --&gt;";
<br />

<br />
/*
<br />

<br />
print "[";
<br />

<br />
for($i = 0; $i &lt; 100; $i++){
<br />
&nbsp; $spaces.="&lt;!-- bufferme --&gt;";
<br />
} // for
<br />

<br />
//and then
<br />

<br />
for($i = 0; $i &lt; 10; $i++){
<br />
&nbsp; for($ii = 0; $ii &lt; 200000; $ii++){
<br />
&nbsp;&nbsp;&nbsp; //do something slow here
<br />
&nbsp; } // for
<br />
&nbsp; print "$spaces|";
<br />
&nbsp; flush();
<br />
} // for
<br />

<br />
print "]";
<br />

<br />
//which looks nice as a progress bar..
<br />
?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="36206""></a>
  <div class="note">
   <strong class="user">scottmacvicar at ntlworld dot com</strong>
   <a href="#36206" class="date">30-Sep-2003 07:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Regarding Apache2<br />
flush() will produce the same results as ob_flush() when output buffering is involved.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
