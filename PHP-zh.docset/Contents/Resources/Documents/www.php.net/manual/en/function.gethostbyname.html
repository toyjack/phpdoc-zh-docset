<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>返回主机名对应的 IPv4地址。</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.gethostbyaddr.html">? gethostbyaddr</a></li>
      <li style="float: right;"><a href="function.gethostbynamel.html">gethostbynamel ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.network.html">网络 函数</a></li>
    <li>返回主机名对应的 IPv4地址。</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.gethostbyname" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">gethostbyname</h1>
  <p class="verinfo">(PHP 4, PHP 5, PHP 7)</p><p class="refpurpose"><span class="refname">gethostbyname</span> &mdash; <span class="dc-title">
   返回主机名对应的 IPv4地址。
  </span></p>

 </div>

 <div class="refsect1 description" id="refsect1-function.gethostbyname-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>gethostbyname</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$hostname</code></span>
   ) : <span class="type">string</span></div>

  <p class="para rdfs-comment">
   返回主机名 <code class="parameter">hostname</code> 对应的 IPv4 互联网地址。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.gethostbyname-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">hostname</code></dt>

     <dd>

      <p class="para">
       主机名
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.gethostbyname-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   成功时返回 IPv4 地址，失败时原封不动返回 <code class="parameter">hostname</code> 字符串。
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.gethostbyname-examples">
  <h3 class="title">范例</h3>
  <p class="para">
   <div class="example" id="example-5530">
    <p><strong>Example #1 简单的 <span class="function"><strong>gethostbyname()</strong></span> 例子</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$ip&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">gethostbyname</span><span style="color: #007700">(</span><span style="color: #DD0000">'www.example.com'</span><span style="color: #007700">);<br /><br />echo&nbsp;</span><span style="color: #0000BB">$ip</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.gethostbyname-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.gethostbyaddr.html" class="function" rel="rdfs-seeAlso">gethostbyaddr()</a> - 获取指定的IP地址对应的主机名</span></li>
    <li class="member"><span class="function"><a href="function.gethostbynamel.html" class="function" rel="rdfs-seeAlso">gethostbynamel()</a> - 获取互联网主机名对应的 IPv4 地址列表</span></li>
    <li class="member"><span class="function"><a href="function.inet-pton.html" class="function" rel="rdfs-seeAlso">inet_pton()</a> - Converts a human readable IP address to its packed in_addr representation</span></li>
    <li class="member"><span class="function"><a href="function.inet-ntop.html" class="function" rel="rdfs-seeAlso">inet_ntop()</a> - Converts a packed internet address to a human readable representation</span></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="119721""></a>
  <div class="note">
   <strong class="user">gabriel at nexcore dot com dot br</strong>
   <a href="#119721" class="date">10-Aug-2016 09:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For the "dig" solution, here is a better one:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp; $IP </span><span class="keyword">= `</span><span class="string">/usr/bin/dig </span><span class="default">$host</span><span class="string">. A +short | /usr/bin/tail -n1</span><span class="keyword">`<br />
</span><span class="default">?&gt;<br />
</span><br />
Using tail because dig, even in the +short form, may return CNAME entries first, and also may return many, many entries (see "dig google.com").<br />
<br />
Usig the dot at the end of the host to not perform domain searches.<br />
<br />
This works also when $host = IP address already<br />
<br />
Will return empty string in case o resolve failure (invalid hostname)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="118841""></a>
  <div class="note">
   <strong class="user">Dennis B.</strong>
   <a href="#118841" class="date">15-Feb-2016 12:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Options for the underlying resolver functions can be supplied by using the RES_OPTIONS environmental variable. (at least under Linux, see man resolv.conf)<br />
<br />
Set timeout and retries to 1 to have a maximum execution time of 1 second for the DNS lookup:<br />
<span class="default">&lt;?php<br />
&nbsp; putenv</span><span class="keyword">(</span><span class="string">'RES_OPTIONS=retrans:1 retry:1 timeout:1 attempts:1'</span><span class="keyword">);<br />
&nbsp; </span><span class="default">gethostbyname</span><span class="keyword">(</span><span class="default">$something</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
You should also use fully qualified domain names ending in a dot. This prevents the resolver from walking though all search domains and retrying the domain with the search domain appended.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="117834""></a>
  <div class="note">
   <strong class="user">php at nemon dot be</strong>
   <a href="#117834" class="date">17-Aug-2015 04:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Always add the root . at the end or your server can add it's own suffix.<br />
example: abc.com could become abc.com.yourcompany.com if you don't use abc.com.<br />
<br />
I also find this function a litle bit limited because it doesn't tell you if the resolve failed.<br />
<br />
TO adress all those issues I use :<br />
<br />
function host2ip($host)<br />
{<br />
&nbsp;&nbsp;&nbsp; $host=trim($host.'.'); // clean and add root .<br />
&nbsp;&nbsp;&nbsp; $ip= gethostbyname($host);<br />
&nbsp;&nbsp;&nbsp; if($ip==$host) $ip='';// empty IP if there is no ip<br />
&nbsp;&nbsp;&nbsp; return $ip;<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="116319""></a>
  <div class="note">
   <strong class="user">devers</strong>
   <a href="#116319" class="date">11-Dec-2014 05:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This function says "Returns the IPv4 address or a string containing the unmodified hostname on failure.<br />
<br />
This isn't entirely true, any hostname with a null byte in it will only return the characters BEFORE the null byte.<br />
<br />
<span class="default">&lt;?php<br />
$hostname </span><span class="keyword">= </span><span class="string">"foo\0bar"</span><span class="keyword">;<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$hostname </span><span class="keyword">);<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">gethostbyname</span><span class="keyword">(</span><span class="default">$hostname </span><span class="keyword">));<br />
</span><span class="default">?&gt;<br />
</span><br />
Results:<br />
string 'foo?bar' (length=7)<br />
string 'foo' (length=3)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="111684""></a>
  <div class="note">
   <strong class="user">Ome Ko</strong>
   <a href="#111684" class="date">16-Mar-2013 08:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you do a gethostbyname() and there is no trailing dot after a domainname that does not resolve, this domainname will ultimately be appended to the server-FQDN by nslookup.<br />
<br />
So if you do a lookup for nonexistentdomainname.be your server may return the ip for nonexistentdomainname.be.yourhostname.com, which is the server-ip.<br />
<br />
To avoid this behaviour, just add a trailing dot to the domainname; i.e. gethostbyname('nonexistentdomainname.be.')</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="107346""></a>
  <div class="note">
   <strong class="user">Emmett Brosnan</strong>
   <a href="#107346" class="date">01-Feb-2012 11:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Grabbing IPs for multiple hosts:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">getAddrByHost</span><span class="keyword">(</span><span class="default">$hosts</span><span class="keyword">, </span><span class="default">$timeout </span><span class="keyword">= </span><span class="default">3</span><span class="keyword">) {<br />
&nbsp; </span><span class="default">$returnString </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp; foreach (</span><span class="default">$hosts </span><span class="keyword">as </span><span class="default">$host</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$query </span><span class="keyword">= `</span><span class="string">nslookup -timeout=</span><span class="default">$timeout</span><span class="string"> -retry=1 </span><span class="default">$host</span><span class="keyword">`;<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'/\nAddress: (.*)\n/'</span><span class="keyword">, </span><span class="default">$query</span><span class="keyword">, </span><span class="default">$matches</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$returnString </span><span class="keyword">.= </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]) . </span><span class="string">'&lt;br&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$returnString </span><span class="keyword">.= </span><span class="default">$host </span><span class="keyword">. </span><span class="string">'&lt;br&gt;'</span><span class="keyword">;<br />
&nbsp; }<br />
&nbsp; return </span><span class="default">$returnString</span><span class="keyword">;<br />
<br />
}<br />
<br />
</span><span class="default">$hostArray</span><span class="keyword">[] = </span><span class="string">'www.domain1.com'</span><span class="keyword">;<br />
</span><span class="default">$hostArray</span><span class="keyword">[] = </span><span class="string">'www.domain2.com'</span><span class="keyword">;<br />
</span><span class="comment">//$hostArray[] = 'www.domain3.com';<br />
//$hostArray[] = 'www.domain4.com';<br />
<br />
</span><span class="default">$returnString </span><span class="keyword">= </span><span class="default">getAddrByHost</span><span class="keyword">(</span><span class="default">$hostArray</span><span class="keyword">);<br />
echo </span><span class="default">$returnString</span><span class="keyword">;<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="104944""></a>
  <div class="note">
   <strong class="user">Alexandre (d)</strong>
   <a href="#104944" class="date">17-Jul-2011 09:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Important note: You should avoid its use in production.<br />
<br />
DNS Resolution may take from 0.5 to 4 seconds, and during this time your script is NOT being executed.<br />
<br />
Your customers may think that the server is slow, but actually it is just waiting for the DNS resolution response.<br />
<br />
You can use it, but if you want performance, you should avoid it, or schedule it to some CRON script...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92870""></a>
  <div class="note">
   <strong class="user">nirazuelos at gmail dot com</strong>
   <a href="#92870" class="date">12-Aug-2009 08:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is the best method I've come up with to resolve any host-name to ip-address, it's quick and reliable and has support for timeout! An invalid address, a unicode string for exmaple, returns after 4~ seconds, instead of 8~ with gethostbyname! It works only with unix though.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">getAddrByHost</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">, </span><span class="default">$timeout </span><span class="keyword">= </span><span class="default">3</span><span class="keyword">) {<br />
&nbsp;&nbsp; </span><span class="default">$query </span><span class="keyword">= `</span><span class="string">nslookup -timeout=</span><span class="default">$timeout</span><span class="string"> -retry=1 </span><span class="default">$host</span><span class="keyword">`;<br />
&nbsp;&nbsp; if(</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'/\nAddress: (.*)\n/'</span><span class="keyword">, </span><span class="default">$query</span><span class="keyword">, </span><span class="default">$matches</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp;&nbsp; return </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br />
&nbsp;&nbsp; return </span><span class="default">$host</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83417""></a>
  <div class="note">
   <strong class="user">manalejandro at gmail dot com</strong>
   <a href="#83417" class="date">24-May-2008 08:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This logic solution to problem checking dns reverse name resolution:<br />
<br />
<span class="default">&lt;?php<br />
$ip </span><span class="keyword">= </span><span class="default">gethostbyname</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">);<br />
if(</span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">) == -</span><span class="default">1 </span><span class="keyword">|| (</span><span class="default">$ip </span><span class="keyword">== </span><span class="default">gethostbyaddr</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">) &amp;&amp; </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/.*\.[a-zA-Z]{2,3}$/"</span><span class="keyword">,</span><span class="default">$host</span><span class="keyword">) == </span><span class="default">0</span><span class="keyword">) ) {<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">'Error, incorrect host or ip'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
else {<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">'Ok'</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="79629""></a>
  <div class="note">
   <strong class="user">geoff at spacevs dot com</strong>
   <a href="#79629" class="date">05-Dec-2007 07:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I put this in a prepend script for all my websites to cut down the amount of abuse by automated scripts.<br />
<span class="default">&lt;?PHP<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $blacklists </span><span class="keyword">= array(</span><span class="string">'web.sorbs.net'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$parts&nbsp; </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">'.'</span><span class="keyword">, </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'REMOTE_ADDR'</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ip&nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">implode</span><span class="keyword">(</span><span class="string">'.'</span><span class="keyword">, </span><span class="default">array_reverse</span><span class="keyword">(</span><span class="default">$parts</span><span class="keyword">)) . </span><span class="string">'.'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$blacklists </span><span class="keyword">as </span><span class="default">$bl</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$check </span><span class="keyword">= </span><span class="default">$ip </span><span class="keyword">. </span><span class="default">$bl</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$check </span><span class="keyword">!= </span><span class="default">gethostbyname</span><span class="keyword">(</span><span class="default">$check</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">error_log</span><span class="keyword">(</span><span class="string">'PHP Security: [DNSBL] - ' </span><span class="keyword">. </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'REMOTE_ADDR'</span><span class="keyword">] . </span><span class="string">' - ' </span><span class="keyword">. </span><span class="default">$bl</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; die(</span><span class="string">'Put a detailed error here so the client knows why they have been blocked'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77766""></a>
  <div class="note">
   <strong class="user">Florian Holzhauer</strong>
   <a href="#77766" class="date">12-Sep-2007 03:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If name resolution fails with apache2, mod_chroot and php5, add<br />
LoadFile /lib/libnss_dns.so.2<br />
to the mod_chroot config.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77668""></a>
  <div class="note">
   <strong class="user">guwapo at thedoghouse dot bz</strong>
   <a href="#77668" class="date">07-Sep-2007 08:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
referring to ralphbolton at mail2sexy dot com comment:<br />
<br />
(at least in 5.2.0 + djbdns-dnscache) gethostbyname does not really seem to cache entries. If somebody notices a speed-up after the second lookup of the same domain - that's most likely your dns-cache itself, not some php-internal dns-cache.<br />
<br />
It does cache the entries in your /etc/resolv.conf (e.g. what dns to use) so I agree with him, that stopping and starting apache, will reload the resolv.conf.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76554""></a>
  <div class="note">
   <strong class="user">von at student dot chalmers dot se</strong>
   <a href="#76554" class="date">20-Jul-2007 03:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When using PHP and Apache in a chroot environment on RedHat Linux, I have found that I need to bind-mount /var/run/nscd to get this to work. Apparently, the socket in that directory is needed for all the DNS things.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="70936""></a>
  <div class="note">
   <strong class="user">Josh Finlay josh at glamourcastle dot com</strong>
   <a href="#70936" class="date">04-Nov-2006 06:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
gethostbyname and gethostbynamel does not ask for AAAA records. I have written two functions to implement this. gethostbyname6 and gethostbynamel6. I don't believe this issue has been addressed yet.<br />
<br />
They are made to replace gethostbyname[l], in a way that if $try_a is true, if it fails to get AAAA records it will fall back on trying to get A records.<br />
<br />
Feel free to correct any errors, I realise that it is asking for *both* A and AAAA records, so this means two DNS calls.. probably would be more efficient if it checked $try_a before making the query, but this works for me so I'll leave that up to someone else to implement in their own work.. the tip is out there now anyway..<br />
<br />
Here is the code:<br />
<br />
&nbsp;&nbsp;&nbsp; function gethostbyname6($host, $try_a = false) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // get AAAA record for $host<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // if $try_a is true, if AAAA fails, it tries for A<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // the first match found is returned<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // otherwise returns false<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $dns = gethostbynamel6($host, $try_a);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ($dns == false) { return false; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else { return $dns[0]; }<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function gethostbynamel6($host, $try_a = false) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // get AAAA records for $host,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // if $try_a is true, if AAAA fails, it tries for A<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // results are returned in an array of ips found matching type<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // otherwise returns false<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $dns6 = dns_get_record($host, DNS_AAAA);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ($try_a == true) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $dns4 = dns_get_record($host, DNS_A);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $dns = array_merge($dns4, $dns6);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else { $dns = $dns6; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $ip6 = array();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $ip4 = array();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach ($dns as $record) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($record["type"] == "A") {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $ip4[] = $record["ip"];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($record["type"] == "AAAA") {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $ip6[] = $record["ipv6"];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (count($ip6) &lt; 1) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($try_a == true) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (count($ip4) &lt; 1) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return false;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return $ip4;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return false;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return $ip6;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="70408""></a>
  <div class="note">
   <strong class="user">chris at chollis dot net</strong>
   <a href="#70408" class="date">15-Oct-2006 10:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
mmucklo raises a valid point, however the function to use would be getmxrr() in the simplest case, or alternatively checkdnsrr() if you so wish; getdnsrr() does not exist.<br />
<br />
On another note, it can be a pain (when iterating with while loops for example) that on failure gethostbyname() returns the hostname, rather than FALSE. You could wrap it in a simple user function, to "correct" this:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">fixed_gethostbyname </span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Try the lookup as normal...<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ip </span><span class="keyword">= </span><span class="default">gethostbyname</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// ...but if it fails, FALSE is returned instead of the unresolved host<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$ip </span><span class="keyword">!= </span><span class="default">$host</span><span class="keyword">) { return </span><span class="default">$ip</span><span class="keyword">; } else return </span><span class="default">false</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69430""></a>
  <div class="note">
   <strong class="user">Peter &lt;toomuchphp-phpman at yahoo dot com&gt;</strong>
   <a href="#69430" class="date">05-Sep-2006 06:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
One way to discover your IP address automatically:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">// need to trim() because whitespace will confuse the name lookup<br />
</span><span class="default">$myIP </span><span class="keyword">= </span><span class="default">gethostbyname</span><span class="keyword">(</span><span class="default">trim</span><span class="keyword">(`</span><span class="string">hostname</span><span class="keyword">`));<br />
echo </span><span class="default">$myIP</span><span class="keyword">;<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68941""></a>
  <div class="note">
   <strong class="user">mmucklo at yahoo dot com</strong>
   <a href="#68941" class="date">16-Aug-2006 11:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
One note about using gethostbyname() for checking email address domains:<br />
<br />
If the name doesn't resolve, follow up with getdnsrr() and make sure they don't have an MX entry before returning an error.<br />
<br />
It is possible for a domain name not to have an A record, but still have an MX entry.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68744""></a>
  <div class="note">
   <strong class="user">Marc M</strong>
   <a href="#68744" class="date">08-Aug-2006 08:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just a heads up. I was using this function on my site to verify email host addresses. I thought all was good, until a potential client contacted me and said they couldn't sign up correctly. They have a valid email address and domain, but this function failed. <br />
<br />
Good luck.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="64070""></a>
  <div class="note">
   <strong class="user">ralphbolton at mail2sexy dot com</strong>
   <a href="#64070" class="date">06-Apr-2006 01:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
On a side-note, PHP (5.0.4, but probably other versions too) can cache gethostbyname information.<br />
<br />
In short, once PHP looks up an address, it may not actually perform another lookup as you may expect. In my particular case (I think) the problem was a change to resolv.conf didn't take effect inside PHP (although nslookup/ping etc worked fine). Stop/Starting Apache fixed it (although a simple 'restart' (kill -HUP) didn't).<br />
<br />
In short, if you change resolv.conf, stop and restart Apache.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="63141""></a>
  <div class="note">
   <strong class="user">ivan[DOT]pirog[AT]gmail[DOT]com</strong>
   <a href="#63141" class="date">14-Mar-2006 06:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Function returns boolean:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">isDomainResolves</span><span class="keyword">(</span><span class="default">$domain</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp; &nbsp; return </span><span class="default">gethostbyname</span><span class="keyword">(</span><span class="default">$domain</span><span class="keyword">) != </span><span class="default">$domain</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="58017""></a>
  <div class="note">
   <strong class="user">mcgrof at gmail dot com</strong>
   <a href="#58017" class="date">21-Oct-2005 09:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Better yet:<br />
<span class="default">&lt;?php<br />
$ip </span><span class="keyword">= </span><span class="default">rtrim</span><span class="keyword">(`</span><span class="string">/usr/bin/dig </span><span class="default">$host</span><span class="string"> A +short</span><span class="keyword">`);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="58015""></a>
  <div class="note">
   <strong class="user">mcgrof at gmail dot com</strong>
   <a href="#58015" class="date">21-Oct-2005 09:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In PHP4 you can use gethostbyname() but I have found this unreliable when doing lookups on entries that return A records on the private network. PHP5 has a much better routine -- dns_get_record(). If you are stuck with PHP4 or don't want to upgrade you can use dig:<br />
<br />
<span class="default">&lt;?php<br />
$ip </span><span class="keyword">= `</span><span class="string">/usr/bin/dig </span><span class="default">$host</span><span class="string"> A +short</span><span class="keyword">`;<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="55932""></a>
  <div class="note">
   <strong class="user">tabascopete78 at yahoo dot com</strong>
   <a href="#55932" class="date">18-Aug-2005 12:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I was using file_get_contents on a set of URLs. Some of them URLs were invalid (the structure of it was ok but the DNS hosts couldn't resolve them) and I kept getting an annoying warning. I wanted to check the DNS somehow but existing check dns function in php doesn't have one for windows and the one a person supplied there does not work 100% of the time.<br />
<br />
Instead use this function to try to resolve a host. This won't throw any warnings, you just need to check the output. You'll get the same warnings with fopen and fsockopen.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="48493""></a>
  <div class="note">
   <strong class="user">cox at idecnet dot com</strong>
   <a href="#48493" class="date">26-Dec-2004 12:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For doing basic RBL (Real Time Blacklist) lookups with this function do:<br />
<br />
<span class="default">&lt;?php<br />
$host </span><span class="keyword">= </span><span class="string">'64.53.200.156'</span><span class="keyword">;<br />
</span><span class="default">$rbl&nbsp; </span><span class="keyword">= </span><span class="string">'sbl-xbl.spamhaus.org'</span><span class="keyword">;<br />
</span><span class="comment">// valid query format is: 156.200.53.64.sbl-xbl.spamhaus.org<br />
</span><span class="default">$rev </span><span class="keyword">= </span><span class="default">array_reverse</span><span class="keyword">(</span><span class="default">explode</span><span class="keyword">(</span><span class="string">'.'</span><span class="keyword">, </span><span class="default">$host</span><span class="keyword">));<br />
</span><span class="default">$lookup </span><span class="keyword">= </span><span class="default">implode</span><span class="keyword">(</span><span class="string">'.'</span><span class="keyword">, </span><span class="default">$rev</span><span class="keyword">) . </span><span class="string">'.' </span><span class="keyword">. </span><span class="default">$rbl</span><span class="keyword">;<br />
if (</span><span class="default">$lookup </span><span class="keyword">!= </span><span class="default">gethostbyname</span><span class="keyword">(</span><span class="default">$lookup</span><span class="keyword">)) {<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"ip: </span><span class="default">$host</span><span class="string"> is listed in </span><span class="default">$rbl</span><span class="string">\n"</span><span class="keyword">;<br />
} else {<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"ip: </span><span class="default">$host</span><span class="string"> NOT listed in </span><span class="default">$rbl</span><span class="string">\n"</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Tomas V.V.Cox</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="44092""></a>
  <div class="note">
   <strong class="user">Vincent</strong>
   <a href="#44092" class="date">14-Jul-2004 09:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that if you pass an IP address to gethostbyname() it will return that IP address.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="41099""></a>
  <div class="note">
   
   <a href="#41099" class="date">30-Mar-2004 02:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The dns entries get cached, whether they exist or not.&nbsp; Expect really good response times after the first one.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="30852""></a>
  <div class="note">
   <strong class="user">christian at SPAM at IS at DEAD at MEAT at karg dot org</strong>
   <a href="#30852" class="date">01-Apr-2003 04:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I had difficulty getting gethostbyname to work under OpenBSD 3.2 and Apache, until I discovered that the default Apache chroot caused the problem.<br />
<br />
To get PHP's gethostbyname to work, you need resolv.conf (and possibly hosts) in /var/www/etc (assuming default install dirs).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="22927""></a>
  <div class="note">
   <strong class="user">tonyhana at sixzeros dot com</strong>
   <a href="#22927" class="date">04-Jul-2002 07:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
</span><span class="comment">//script to time DNS propagation<br />
//(Above script modified slightly to show micro time)<br />
//seems pretty damn quick to me.. I'm getting .0055 sec worstcase badhost times.<br />
<br />
//A known good dns name (my own)<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$nametotest </span><span class="keyword">= </span><span class="string">"fuzzygroup.com"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
</span><span class="comment">//Call address test function <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$time_start </span><span class="keyword">= </span><span class="default">getmicrotime</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">testipaddress</span><span class="keyword">(</span><span class="default">$nametotest</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$time_end </span><span class="keyword">= </span><span class="default">getmicrotime</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$time </span><span class="keyword">= </span><span class="default">$time_end </span><span class="keyword">- </span><span class="default">$time_start</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"Good Host Search took </span><span class="default">$time</span><span class="string"> seconds&lt;br&gt;&lt;br&gt;"</span><span class="keyword">;<br />
<br />
</span><span class="comment">//A known bad name (trust me)<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$nametotest </span><span class="keyword">= </span><span class="string">"providence.mascot.com"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$time_start </span><span class="keyword">= </span><span class="default">getmicrotime</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">testipaddress</span><span class="keyword">(</span><span class="default">$nametotest</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$time_end </span><span class="keyword">= </span><span class="default">getmicrotime</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$time </span><span class="keyword">= </span><span class="default">$time_end </span><span class="keyword">- </span><span class="default">$time_start</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"Bad Host Search took </span><span class="default">$time</span><span class="string"> seconds&lt;br&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; <br />
function </span><span class="default">getmicrotime</span><span class="keyword">(){ <br />
&nbsp;&nbsp;&nbsp; list(</span><span class="default">$usec</span><span class="keyword">, </span><span class="default">$sec</span><span class="keyword">) = </span><span class="default">explode</span><span class="keyword">(</span><span class="string">" "</span><span class="keyword">,</span><span class="default">microtime</span><span class="keyword">()); <br />
&nbsp;&nbsp;&nbsp; return ((float)</span><span class="default">$usec </span><span class="keyword">+ (float)</span><span class="default">$sec</span><span class="keyword">); <br />
&nbsp;&nbsp;&nbsp; } <br />
<br />
</span><span class="comment">//ip address checking function<br />
//for real use should have a return value but example code<br />
</span><span class="keyword">function </span><span class="default">testipaddress </span><span class="keyword">(</span><span class="default">$nametotest</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ipaddress </span><span class="keyword">= </span><span class="default">$nametotest</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ipaddress </span><span class="keyword">= </span><span class="default">gethostbyname</span><span class="keyword">(</span><span class="default">$nametotest</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$ipaddress </span><span class="keyword">== </span><span class="default">$nametotest</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"No ip address for host&lt;br&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"good hostname, </span><span class="default">$nametotest</span><span class="string"> ipaddress = </span><span class="default">$ipaddress</span><span class="string">&lt;br&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="comment">//Recommended fix for sql applications: <br />
// store url to temporary table <br />
// run second process periodically to <br />
// check urls and update main table<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="19953""></a>
  <div class="note">
   <strong class="user">sjohnson at fuzzygroup dot com</strong>
   <a href="#19953" class="date">16-Mar-2002 10:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">//script to see if host exists on Internet<br />
<br />
//following up on the above point about host name <br />
//checking and SQL timeouts, run this test script<br />
//and see how long it takes for 2nd call to <br />
//hostname check to fail<br />
//NOTE -- not PHP's fault -- nature of DNS <br />
<br />
//A known good dns name (my own)<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$nametotest </span><span class="keyword">= </span><span class="string">"fuzzygroup.com"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
</span><span class="comment">//Call address test function <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">testipaddress</span><span class="keyword">(</span><span class="default">$nametotest</span><span class="keyword">);<br />
<br />
</span><span class="comment">//A known bad name (trust me)<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$nametotest </span><span class="keyword">= </span><span class="string">"providence.mascot.com"</span><span class="keyword">;<br />
</span><span class="comment">//Call address test function<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">testipaddress</span><span class="keyword">(</span><span class="default">$nametotest</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
</span><span class="comment">//ip address checking function<br />
//for real use should have a return value but example code<br />
</span><span class="keyword">function </span><span class="default">testipaddress </span><span class="keyword">(</span><span class="default">$nametotest</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ipaddress </span><span class="keyword">= </span><span class="default">$nametotest</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ipaddress </span><span class="keyword">= </span><span class="default">gethostbyname</span><span class="keyword">(</span><span class="default">$nametotest</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$ipaddress </span><span class="keyword">== </span><span class="default">$nametotest</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"No ip address for host, so host "<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">. </span><span class="string">"not currently available in DNS and "<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">. </span><span class="string">"probably offline for some time&lt;BR&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"good hostname, ipaddress = </span><span class="default">$ipaddress</span><span class="string">&lt;BR&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="comment">//Recommended fix for sql applications: <br />
// store url to temporary table <br />
// run second process periodically to <br />
// check urls and update main table<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
