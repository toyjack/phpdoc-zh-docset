<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>Computes hash</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.mhash-keygen-s2k.html">? mhash_keygen_s2k</a></li>
      <li style="float: right;"><a href="book.openssl.html">OpenSSL ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.mhash.html">Mhash 函数</a></li>
    <li>Computes hash</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.mhash" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">mhash</h1>
  <p class="verinfo">(PHP 4, PHP 5, PHP 7)</p><p class="refpurpose"><span class="refname">mhash</span> &mdash; <span class="dc-title">Computes hash</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.mhash-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>mhash</strong></span>
    ( <span class="methodparam"><span class="type">int</span> <code class="parameter">$hash</code></span>
   , <span class="methodparam"><span class="type">string</span> <code class="parameter">$data</code></span>
   [, <span class="methodparam"><span class="type">string</span> <code class="parameter">$key</code></span>
  ] ) : <span class="type">string</span></div>

  <p class="para rdfs-comment">
   <span class="function"><strong>mhash()</strong></span> applies a hash function specified by
   <code class="parameter">hash</code> to the <code class="parameter">data</code>.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.mhash-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">hash</code></dt>

     <dd>

      <p class="para">
       The hash ID. One of the <strong><code>MHASH_hashname</code></strong> constants.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">data</code></dt>

     <dd>

      <p class="para">
       The user input, as a string.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">key</code></dt>

     <dd>

      <p class="para">
       If specified, the function will return the resulting HMAC instead.
       HMAC is keyed hashing for message authentication, or simply a message
       digest that depends on the specified key. Not all algorithms 
       supported in mhash can be used in HMAC mode.
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.mhash-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   Returns the resulting hash (also called digest) or HMAC as a string, or
   <strong><code>FALSE</code></strong> on error.
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="115236""></a>
  <div class="note">
   <strong class="user">jeremy s</strong>
   <a href="#115236" class="date">18-Jun-2014 04:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is how to compute a NTLM hash:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">ntlm_hash</span><span class="keyword">(</span><span class="default">$txt</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$txt </span><span class="keyword">= </span><span class="default">iconv</span><span class="keyword">(</span><span class="string">'UTF-8'</span><span class="keyword">, </span><span class="string">'UTF-16LE'</span><span class="keyword">, </span><span class="default">$txt</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$md4 </span><span class="keyword">= </span><span class="default">bin2hex</span><span class="keyword">(</span><span class="default">mhash</span><span class="keyword">(</span><span class="default">MHASH_MD4</span><span class="keyword">, </span><span class="default">$txt</span><span class="keyword">));<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">strtoupper</span><span class="keyword">(</span><span class="default">$md4</span><span class="keyword">);<br />
}<br />
<br />
echo </span><span class="default">ntlm_hash</span><span class="keyword">(</span><span class="string">'ClearTextPasswd'</span><span class="keyword">);<br />
echo </span><span class="string">"\n"</span><span class="keyword">;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="109249""></a>
  <div class="note">
   <strong class="user">holdoffhunger at gmail dot com</strong>
   <a href="#109249" class="date">29-Jun-2012 11:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The MHash function here lists one disclaimer at the top when providing a key to the mhash function : "Not all algorithms supported in mhash can be used in HMAC mode."&nbsp; So, what algorithms blow up and what do fine when it comes to doing keyed, HMAC hashing?&nbsp; The destructive ones are: Adler32, CRC32, CRC32B, and GOST.&nbsp; These are the first four, predefined constants listed with the MHash Application Package: <a href="http://www.php.net/manual/en/mhash.constants.php .&nbsp; Providing one of these algorithms with an HMAC key (of string-length greater than one" rel="nofollow" target="_blank">http://www.php.net/manual/en/mhash.constants.php .&nbsp; Providing one of these algorithms with an HMAC key (of string-length greater than one</a>) creates the following error message: "Warning: mhash() [function.mhash]: mhash initialization failed in [(folder-location)] on line 181".&nbsp; If you really want to use these algorithms in creating your HMAC hashes, the function Hash_hmac() from the HASH-Message Digest Framework package is capable of doing that perfectly.<br />
<br />
Again, that is if the string length is greater than one.&nbsp; Why string length greater than one?&nbsp; Well, if the key value is blank, it is ignored as a parameter altogether.&nbsp; So, if you feed the mhash function an algorithm that is not compatible with HMAC hashing and an HMAC key that's blank (""), it will work the same as if it had received no HMAC key at all.&nbsp; This is different from the way the Hash_hmac() function of the HASH-MDF works.&nbsp; In the case of the Hash_hmac() function, feeding a blank HMAC key will use that blank key in generating the HMAC hash.&nbsp; Even with functions that can do HMAC hashing, like MD5 or SHA1, if the MHash() is given a blank HMAC key, it will ignore the key and just return the results of standard, non-HMAC hashing.&nbsp; It's probably not wise to use a blank HMAC key anyway, but it's good to know that the hashing algorithm changes altogether if the provided HMAC key is blank.<br />
<br />
Some sample code to demonstrate :<br />
<br />
<span class="default">&lt;?php<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Author: holdoffhunger@gmail.com<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // Preset Data<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // ---------------------------------------------------<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$string_to_hash </span><span class="keyword">= </span><span class="string">"The hash_hmac() function better to use for these purposes."</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$blank_hmac_key </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// MHash - Hashing With and Without HMAC Parameter<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // ---------------------------------------------------<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$mhash_result_with_hmac_parameter </span><span class="keyword">= </span><span class="default">bin2hex</span><span class="keyword">(</span><span class="default">mhash</span><span class="keyword">(</span><span class="default">MHASH_CRC32</span><span class="keyword">, </span><span class="default">$string_to_hash</span><span class="keyword">, </span><span class="default">$blank_hmac_key</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$mhash_result_without_hmac_parameter </span><span class="keyword">= </span><span class="default">bin2hex</span><span class="keyword">(</span><span class="default">mhash</span><span class="keyword">(</span><span class="default">MHASH_CRC32</span><span class="keyword">, </span><span class="default">$string_to_hash</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// MHash - Hashing With and Without HMAC Parameter<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // ---------------------------------------------------<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$hash_result_with_hmac_parameter </span><span class="keyword">= </span><span class="default">hash_hmac</span><span class="keyword">(</span><span class="string">"crc32"</span><span class="keyword">, </span><span class="default">$string_to_hash</span><span class="keyword">, </span><span class="default">$blank_hmac_key</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$hash_result_without_hmac_parameter </span><span class="keyword">= </span><span class="default">hash</span><span class="keyword">(</span><span class="string">"crc32"</span><span class="keyword">, </span><span class="default">$string_to_hash</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Print Results<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // ---------------------------------------------------<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">print(</span><span class="string">"MHASH (CRC32 Algorithm) With Blank HMAC Key: </span><span class="default">$mhash_result_with_hmac_parameter</span><span class="string"> .&lt;br&gt;"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; print(</span><span class="string">"MHASH (CRC32 Algorithm) Without HMAC Processing: </span><span class="default">$mhash_result_without_hmac_parameter</span><span class="string"> .&lt;br&gt;&lt;br&gt;"</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; print(</span><span class="string">"HASH (CRC32 Algorithm) With Blank HMAC Key: </span><span class="default">$hash_result_with_hmac_parameter</span><span class="string"> .&lt;br&gt;"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; print(</span><span class="string">"HASH (CRC32 Algorithm) Without HMAC Processing: </span><span class="default">$hash_result_without_hmac_parameter</span><span class="string"> ."</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
&nbsp;&nbsp;&nbsp; Results :<br />
&nbsp;&nbsp;&nbsp; ...................................<br />
<br />
MHASH (CRC32 Algorithm) With Blank HMAC Key: f665c094 .<br />
MHASH (CRC32 Algorithm) Without HMAC Processing: f665c094 .<br />
<br />
HASH (CRC32 Algorithm) With Blank HMAC Key: 3041f4f8 .<br />
HASH (CRC32 Algorithm) Without HMAC Processing: f665c094 .</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="109227""></a>
  <div class="note">
   <strong class="user">holdoffhunger at gmail dot com</strong>
   <a href="#109227" class="date">27-Jun-2012 07:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Both cryptography packages, the MHash and the HASH Message Digest Framework, have the same algorithms, and yet, they both sometimes to produce wildly different results from each other when applying the same algorithm to the same piece of data.&nbsp; The SHA-x algorithms, as designed by the NSA, all seem to have concrete standards for producing their hash values, so they have similar results.&nbsp; Even the two MD5 implementations produce identical results, and the same goes for Gost, RipeMD, CRC32, Whirlpool, Snefru256 (known as 'Snefru256' in MHash and simply 'Snefru' in HASH-MDF), and Tiger (the three-round versions in HASH-MDF to simply 'Tigerx' in MHash).<br />
<br />
However, the algorithms CRC32B and Adler32 each produce different results when called from either MHash or HASH-MDF, possibly because they are hashing algorithms designed to be checksums rather than something that can produce a string as a unique identifier for a particular piece of information.&nbsp; For that reason, if you ever publish the hash results with the data you're putting out publicly, it's probably wise to indicate whether it's the MHash or HASH-MDF implementation of the algorithm.&nbsp; Otherwise, the hash value won't provide much use as a unique identifier for the particular piece of data or for the file.<br />
<br />
Some example code to better explain what I mean :<br />
<br />
<span class="default">&lt;?php<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Author: holdoffhunger@gmail.com<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // SHA-1 Hashing<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // ---------------------------------------------------<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$mhash_sha1_results </span><span class="keyword">= </span><span class="default">bin2hex</span><span class="keyword">(</span><span class="default">mhash</span><span class="keyword">(</span><span class="default">MHASH_SHA1</span><span class="keyword">, </span><span class="string">"secret"</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$hash_mdf_sha1_results </span><span class="keyword">= </span><span class="default">hash</span><span class="keyword">(</span><span class="string">"sha1"</span><span class="keyword">, </span><span class="string">"secret"</span><span class="keyword">, </span><span class="default">FALSE</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; print(</span><span class="string">"MHash SHA-1: </span><span class="default">$mhash_sha1_results</span><span class="string"> .&lt;br&gt;"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; print(</span><span class="string">"HASH-MDF SHA-1: </span><span class="default">$hash_mdf_sha1_results</span><span class="string"> .&lt;br&gt;&lt;br&gt;"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Whirlpool Hashing<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // ---------------------------------------------------<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$mhash_whirlpool_results </span><span class="keyword">= </span><span class="default">bin2hex</span><span class="keyword">(</span><span class="default">mhash</span><span class="keyword">(</span><span class="default">MHASH_WHIRLPOOL</span><span class="keyword">, </span><span class="string">"secret"</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$hash_mdf_whirlpool_results </span><span class="keyword">= </span><span class="default">hash</span><span class="keyword">(</span><span class="string">"whirlpool"</span><span class="keyword">, </span><span class="string">"secret"</span><span class="keyword">, </span><span class="default">FALSE</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; print(</span><span class="string">"MHash Whirlpool: </span><span class="default">$mhash_whirlpool_results</span><span class="string"> .&lt;br&gt;"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; print(</span><span class="string">"HASH-MDF Whirlpool: </span><span class="default">$hash_mdf_whirlpool_results</span><span class="string"> .&lt;br&gt;&lt;br&gt;"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// CRC32B Hashing<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // ---------------------------------------------------<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$mhash_crc32b_results </span><span class="keyword">= </span><span class="default">bin2hex</span><span class="keyword">(</span><span class="default">mhash</span><span class="keyword">(</span><span class="default">MHASH_CRC32B</span><span class="keyword">, </span><span class="string">"secret"</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$hash_mdf_crc32b_results </span><span class="keyword">= </span><span class="default">hash</span><span class="keyword">(</span><span class="string">"crc32b"</span><span class="keyword">, </span><span class="string">"secret"</span><span class="keyword">, </span><span class="default">FALSE</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; print(</span><span class="string">"MHash CRC32B: </span><span class="default">$mhash_crc32b_results</span><span class="string"> .&lt;br&gt;"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; print(</span><span class="string">"HASH-MDF CRC32B: </span><span class="default">$hash_mdf_crc32b_results</span><span class="string"> .&lt;br&gt;&lt;br&gt;"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Adler32 Hashing<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // ---------------------------------------------------<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$mhash_adler32_results </span><span class="keyword">= </span><span class="default">bin2hex</span><span class="keyword">(</span><span class="default">mhash</span><span class="keyword">(</span><span class="default">MHASH_ADLER32</span><span class="keyword">, </span><span class="string">"secret"</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$hash_mdf_adler32_results </span><span class="keyword">= </span><span class="default">hash</span><span class="keyword">(</span><span class="string">"adler32"</span><span class="keyword">, </span><span class="string">"secret"</span><span class="keyword">, </span><span class="default">FALSE</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; print(</span><span class="string">"MHash Adler32: </span><span class="default">$mhash_adler32_results</span><span class="string"> .&lt;br&gt;"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; print(</span><span class="string">"HASH-MDF Adler32: </span><span class="default">$hash_mdf_adler32_results</span><span class="string"> .&lt;br&gt;&lt;br&gt;"</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
&nbsp;&nbsp;&nbsp; Expected Results :<br />
&nbsp;&nbsp;&nbsp; ........................<br />
<br />
MHash SHA-1: e5e9fa1ba31ecd1ae84f75caaa474f3a663f05f4 .<br />
HASH-MDF SHA-1: e5e9fa1ba31ecd1ae84f75caaa474f3a663f05f4 .<br />
<br />
MHash Whirlpool: e061b87a674ae3880e159ab55ed35d<br />
6c5e8a6aefac6ab08304a50588018d<br />
377b28639bb15fdeedf006d57e45f7<br />
b4298e6dfefceaf7c92c826a708fe6d<br />
1156eb3 .<br />
<br />
HASH-MDF Whirlpool: e061b87a674ae3880e159ab55ed35d<br />
6c5e8a6aefac6ab08304a50588018d<br />
377b28639bb15fdeedf006d57e45f7<br />
b4298e6dfefceaf7c92c826a708fe6d<br />
1156eb3 .<br />
<br />
MHash CRC32B: e5e8a25c .<br />
HASH-MDF CRC32B: 5ca2e8e5 .<br />
<br />
MHash Adler32: 8702d108 .<br />
HASH-MDF Adler32: 08d10287 .</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="88335""></a>
  <div class="note">
   <strong class="user">hm2k at php dot net</strong>
   <a href="#88335" class="date">20-Jan-2009 07:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
mhash support now appears in the Pear PHP_Compat package, for support without building PHP with mhash.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="72746""></a>
  <div class="note">
   <strong class="user">numien(at)deathwyrm(dot)com</strong>
   <a href="#72746" class="date">31-Jan-2007 05:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
---Quote---<br />
pack("H*", md5($str)) == mhash(MHASH_MD5, $str)<br />
pack("H*", sha1($str)) == mhash(MHASH_SHA1, $str)<br />
---/Quote---<br />
<br />
That's an awfully inefficient way of doing things. You can just put ", true" after md5 or sha1 to get binary output instead of having it convert it to hex then back.<br />
<br />
Easier way:<br />
md5($str, true) == mhash(MHASH_MD5, $str)<br />
sha1($str, true) == mhash(MHASH_SHA1, $str)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="53571""></a>
  <div class="note">
   <strong class="user">marcel446 at yahoo dot com</strong>
   <a href="#53571" class="date">06-Jun-2005 04:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just in case you did not observe, the function of Lance is independent of hash fuction used to get HMAC , so if one use sha1() function from php instead md5() will get sha1 HMAC.<br />
Just try .<br />
Thanks again Lance</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="51086""></a>
  <div class="note">
   <strong class="user">robbie [at] averill [dot] co [dot] nz</strong>
   <a href="#51086" class="date">18-Mar-2005 05:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This confused me a bit when I first read the documetation for mhash. The functions that accept a hash accept them as an INTEGER not a STRING. In this case, MHASH_MD5 = 1. It is a constant, not a string.<br />
<br />
Just thought I'd point that out, so if anyone is confused they can read that. That's the use of mhash_get_hash_name(). You input the constant (which is an integer) and it returns the hash name.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="47076""></a>
  <div class="note">
   <strong class="user">fernan at ispwest dot com</strong>
   <a href="#47076" class="date">02-Nov-2004 12:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Thanks a lot to Lance for showing how to create mhash without installing the perl extension for mhash.<br />
<br />
I have been asking my webhosting administrator to recompile Perl with mhash extension, but do not want to do it. As a result, our company can't get credit card authorization because they require fingerprint which uses the function mhash. Now, it's working fine.<br />
<br />
Thanks a lot, Lance.....<br />
<br />
Fernan</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="43762""></a>
  <div class="note">
   <strong class="user">jerry d0t wilborn at fast d0t net</strong>
   <a href="#43762" class="date">02-Jul-2004 09:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
in responce to lance's post:<br />
<br />
the function comes back with a hex representation of the hmac, if you wish to convert to what mhash returns natively (binary) use:&nbsp; pack("H*", hmac(variables...));</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="33872""></a>
  <div class="note">
   <strong class="user">lance_rushing at hot* spamfree *mail dot com</strong>
   <a href="#33872" class="date">09-Jul-2003 05:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Don't forget php has two built in hashing algorithms:<br />
<br />
md5(), and sha1()<br />
<br />
So if you are using: mhash(MHASH_MD5, $str) or mhash(MHASH_SHA1, $str) you could use md5($str) or sha1($str).<br />
<br />
** But remember that md5() and sha1() produce HEX output while mhash() produces a BIN output.&nbsp; So:<br />
<br />
md5($str) == bin2hex(mhash(MHASH_MD5, $str))<br />
sha1($str) == bin2hex(mhash(MHASH_SHA1, $str))<br />
<br />
AND<br />
<br />
pack("H*", md5($str)) == mhash(MHASH_MD5, $str)<br />
pack("H*", sha1($str)) == mhash(MHASH_SHA1, $str)<br />
<br />
(Just remember to pack() or bin2hex() your output to get the output you need)<br />
<br />
-Lance</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="27225""></a>
  <div class="note">
   <strong class="user">lance_rushing at hot* spamfree *mail dot com</strong>
   <a href="#27225" class="date">27-Nov-2002 08:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Want to Create a md5 HMAC, but don't have hmash installed?<br />
<br />
Use this:<br />
<br />
function hmac ($key, $data)<br />
{<br />
&nbsp;&nbsp;&nbsp; // RFC 2104 HMAC implementation for php.<br />
&nbsp;&nbsp;&nbsp; // Creates an md5 HMAC.<br />
&nbsp;&nbsp;&nbsp; // Eliminates the need to install mhash to compute a HMAC<br />
&nbsp;&nbsp;&nbsp; // Hacked by Lance Rushing<br />
<br />
&nbsp;&nbsp;&nbsp; $b = 64; // byte length for md5<br />
&nbsp;&nbsp;&nbsp; if (strlen($key) &gt; $b) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $key = pack("H*",md5($key));<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; $key&nbsp; = str_pad($key, $b, chr(0x00));<br />
&nbsp;&nbsp;&nbsp; $ipad = str_pad('', $b, chr(0x36));<br />
&nbsp;&nbsp;&nbsp; $opad = str_pad('', $b, chr(0x5c));<br />
&nbsp;&nbsp;&nbsp; $k_ipad = $key ^ $ipad ;<br />
&nbsp;&nbsp;&nbsp; $k_opad = $key ^ $opad;<br />
<br />
&nbsp;&nbsp;&nbsp; return md5($k_opad&nbsp; . pack("H*",md5($k_ipad . $data)));<br />
}<br />
<br />
-----<br />
To test:<br />
Run this on a server _with_ mhash installed:<br />
<br />
$key = 'Jefe';<br />
$data = "what do ya want for nothing?";<br />
echo hmac($key, $data);<br />
echo "&amp;lt;br&amp;gt;\n";<br />
echo bin2hex (mhash(MHASH_MD5, $data, $key));<br />
<br />
should produce:<br />
<br />
750c783e6ab0b503eaa86e310a5db738<br />
750c783e6ab0b503eaa86e310a5db738<br />
<br />
Happy hashing.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="17843""></a>
  <div class="note">
   <strong class="user">luc at 2113 dot ch</strong>
   <a href="#17843" class="date">28-Dec-2001 05:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Netscape messaging / directory server 4+ uses SHA-1 
<br />
to store password in the ldap database (slapd).
<br />
The password is first SHA-1 hashed then base64 encoded:
<br />

<br />
$pwd = "secret";
<br />
$hash = "{SHA}".base64_encode( mHash(MHASH_SHA1, $pwd));
<br />
echo "Hash: ". $hash ;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="17385""></a>
  <div class="note">
   <strong class="user">paulj at 5emedia dot net</strong>
   <a href="#17385" class="date">06-Dec-2001 10:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Many digest algorithms (especially MD5) are less secure if you are hashing data that is smaller than the algorithm's output.&nbsp; I recommend either hashing a secret key/salt with the original data to increase it's security.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
