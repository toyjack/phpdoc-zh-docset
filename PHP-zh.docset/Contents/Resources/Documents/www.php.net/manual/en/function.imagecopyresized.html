<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>拷贝部分图像并调整大小</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.imagecopyresampled.html">? imagecopyresampled</a></li>
      <li style="float: right;"><a href="function.imagecreate.html">imagecreate ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.image.html">GD 和图像处理 函数</a></li>
    <li>拷贝部分图像并调整大小</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.imagecopyresized" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">imagecopyresized</h1>
  <p class="verinfo">(PHP 4, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">imagecopyresized</span> &mdash; <span class="dc-title">拷贝部分图像并调整大小</span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.imagecopyresized-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>imagecopyresized</strong></span>(<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">resource</span> <code class="parameter">$dst_image</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">resource</span> <code class="parameter">$src_image</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter">$dst_x</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter">$dst_y</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter">$src_x</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter">$src_y</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter">$dst_w</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter">$dst_h</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter">$src_w</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter">$src_h</code></span><br>): <span class="type">bool</span></div>

   <p class="para rdfs-comment">
   <span class="function"><strong>imagecopyresized()</strong></span>
   将一幅图像中的一块矩形区域拷贝到另一个图像中。<code class="parameter">dst_image</code>
   和 <code class="parameter">src_image</code>
   分别是目标图像和源图像的标识符。
  </p>
  <p class="para">
   In other words, <span class="function"><strong>imagecopyresized()</strong></span> will take an 
   rectangular area from <code class="parameter">src_image</code> of width 
   <code class="parameter">src_w</code> and height <code class="parameter">src_h</code> at 
   position (<code class="parameter">src_x</code>,<code class="parameter">src_y</code>) 
   and place it in a rectangular area of <code class="parameter">dst_image</code> 
   of width <code class="parameter">dst_w</code> and height <code class="parameter">dst_h</code>
   at position (<code class="parameter">dst_x</code>,<code class="parameter">dst_y</code>).
  </p>
   <p class="para">
     如果源和目标的宽度和高度不同，则会进行相应的图像收缩和拉伸。坐标指的是左上角。本函数可用来在同一幅图内部拷贝（如果
   <code class="parameter">dst_image</code> 和 <code class="parameter">src_image</code>
   相同的话）区域，但如果区域交迭的话则结果不可预知。
   </p>
 </div>

 <div class="refsect1 parameters" id="refsect1-function.imagecopyresized-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>
    
     <dt>
<code class="parameter">dst_image</code></dt>

     <dd>

      <p class="para">目标图象资源。</p>
     </dd>

    
    
     <dt>
<code class="parameter">src_image</code></dt>

     <dd>

      <p class="para">源图象资源。</p>
     </dd>

    
    
     <dt>
<code class="parameter">dst_x</code></dt>

     <dd>

      <p class="para">
       x-coordinate of destination point.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">dst_y</code></dt>

     <dd>

      <p class="para">
       y-coordinate of destination point.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">src_x</code></dt>

     <dd>

      <p class="para">
       x-coordinate of source point.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">src_y</code></dt>

     <dd>

      <p class="para">
       y-coordinate of source point.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">dst_w</code></dt>

     <dd>

      <p class="para">
       Destination width.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">dst_h</code></dt>

     <dd>

      <p class="para">
       Destination height.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">src_w</code></dt>

     <dd>

      <p class="para">源图象的宽度。</p>
     </dd>

    
    
     <dt>
<code class="parameter">src_h</code></dt>

     <dd>

      <p class="para">源图象的高度。</p>
     </dd>

    
   </dl>

  </p>
 </div>

 <div class="refsect1 returnvalues" id="refsect1-function.imagecopyresized-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   成功时返回 <strong><code>true</code></strong>， 或者在失败时返回 <strong><code>false</code></strong>。
  </p>
 </div>

 <div class="refsect1 examples" id="refsect1-function.imagecopyresized-examples">
  <h3 class="title">范例</h3>
  <p class="para">
   <div class="example" id="example-2578">
    <p><strong>Example #1 Resizing an image</strong></p>
    <div class="example-contents"><p>
     这个例子会以一半的尺寸显示图片
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;File&nbsp;and&nbsp;new&nbsp;size<br /></span><span style="color: #0000BB">$filename&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'test.jpg'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$percent&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">0.5</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//&nbsp;Content&nbsp;type<br /></span><span style="color: #0000BB">header</span><span style="color: #007700">(</span><span style="color: #DD0000">'Content-Type:&nbsp;image/jpeg'</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;Get&nbsp;new&nbsp;sizes<br /></span><span style="color: #007700">list(</span><span style="color: #0000BB">$width</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$height</span><span style="color: #007700">)&nbsp;=&nbsp;</span><span style="color: #0000BB">getimagesize</span><span style="color: #007700">(</span><span style="color: #0000BB">$filename</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$newwidth&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$width&nbsp;</span><span style="color: #007700">*&nbsp;</span><span style="color: #0000BB">$percent</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$newheight&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$height&nbsp;</span><span style="color: #007700">*&nbsp;</span><span style="color: #0000BB">$percent</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//&nbsp;Load<br /></span><span style="color: #0000BB">$thumb&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">imagecreatetruecolor</span><span style="color: #007700">(</span><span style="color: #0000BB">$newwidth</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$newheight</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$source&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">imagecreatefromjpeg</span><span style="color: #007700">(</span><span style="color: #0000BB">$filename</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;Resize<br /></span><span style="color: #0000BB">imagecopyresized</span><span style="color: #007700">(</span><span style="color: #0000BB">$thumb</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$source</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$newwidth</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$newheight</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$width</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$height</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;Output<br /></span><span style="color: #0000BB">imagejpeg</span><span style="color: #007700">(</span><span style="color: #0000BB">$thumb</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>以上例程的输出类似于：</p></div>
    <div class="mediaobject">
     
     <div class="imageobject">
      <img src="images/21009b70229598c6a80eef8b45bf282b-imagecopyresized.jpg" alt="Output of example : Resizing an image" width="47" height="25" />
     </div>
    </div>
    <div class="example-contents"><p>
     The image will be output at half size, though better
     quality could be obtained using <span class="function"><a href="function.imagecopyresampled.html" class="function">imagecopyresampled()</a></span>.
    </p></div>
   </div>
  </p>
 </div>

 <div class="refsect1 notes" id="refsect1-function.imagecopyresized-notes">
  <h3 class="title">注释</h3>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
     因为调色板图像限制（255+1 种颜色）有个问题。重采样或过滤图像通常需要多于 255
    种颜色，计算新的被重采样的像素及其颜色时采用了一种近似值。对调色板图像尝试分配一个新颜色时，如果失败我们选择了计算结果最接近（理论上）的颜色。这并不总是视觉上最接近的颜色。这可能会产生怪异的结果，例如空白（或者视觉上是空白）的图像。要跳过这个问题，请使用真彩色图像作为目标图像，例如用
    <span class="function"><a href="function.imagecreatetruecolor.html" class="function">imagecreatetruecolor()</a></span> 创建的。
   </p>
  </p></blockquote>
 </div>

 <div class="refsect1 seealso" id="refsect1-function.imagecopyresized-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <span class="function"><a href="function.imagecopyresampled.html" class="function" rel="rdfs-seeAlso">imagecopyresampled()</a> - 重采样拷贝部分图像并调整大小</span>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="121081""></a>
  <div class="note">
   <strong class="user">eslindsey at gmail dot com</strong>
   <a href="#121081" class="date">15-May-2017 08:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I'm not sure why nworld3d at yahoo dot com's <a href="http://php.net/manual/en/function.imagecopyresized.php#69123 was downvoted--it was exactly what I was looking for to composite several alpha channel images, just like Photoshop. I needed to start with transparency and stack a few alpha images one after another on top of it. After mucking about with the built in PHP functions, I was worried that I would need to cheat by removing all the alpha and then using a transparent color in the end, but that would have looked different depending on what background I put it on top of. nworld3d at yahoo dot" rel="nofollow" target="_blank">http://php.net/manual/en/function.imagecopyresized.php#69123 was downvoted--it was exactly what I was looking for to composite several alpha channel images, just like Photoshop. I needed to start with transparency and stack a few alpha images one after another on top of it. After mucking about with the built in PHP functions, I was worried that I would need to cheat by removing all the alpha and then using a transparent color in the end, but that would have looked different depending on what background I put it on top of. nworld3d at yahoo dot</a>'s comment saved me from having to go that route, and gets a +1 from me.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="111988""></a>
  <div class="note">
   <strong class="user">jack at computerrageprevention dot ca</strong>
   <a href="#111988" class="date">19-Apr-2013 06:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There are many user notes here that deal with creating a thumbnail, but I wrote a function that created a thumbnail of an image as it gets uploaded.&nbsp; It is simply a combination of a file uploader with a thumbnail maker, but it is very simple to use now.<br />
<br />
Following is an index.php file that contains the upload form, the function, and an example of how to use the function. The last two values in the 'thumb' function are for the width and height limits for the resulting thumbnail.&nbsp; No matter what size the original image, the thumbnail will always fit within the dimensions specified.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">if (</span><span class="default">$_POST</span><span class="keyword">[</span><span class="default">formname</span><span class="keyword">] ==</span><span class="string">"upload"</span><span class="keyword">)<br />
{<br />
&nbsp;if (</span><span class="default">$_FILES</span><span class="keyword">)<br />
&nbsp;{<br />
&nbsp; foreach (</span><span class="default">$_FILES </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">)<br />
&nbsp; {<br />
&nbsp;&nbsp; </span><span class="default">$m </span><span class="keyword">= </span><span class="default">thumb</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">, </span><span class="default">realpath</span><span class="keyword">(</span><span class="default">dirname</span><span class="keyword">(</span><span class="default">__FILE__</span><span class="keyword">)) . </span><span class="string">"/" </span><span class="keyword">. </span><span class="string">"image_1"</span><span class="keyword">, </span><span class="default">realpath</span><span class="keyword">(</span><span class="default">dirname</span><span class="keyword">(</span><span class="default">__FILE__</span><span class="keyword">)) . </span><span class="string">"/" </span><span class="keyword">. </span><span class="string">"thumb_1"</span><span class="keyword">, </span><span class="default">150</span><span class="keyword">, </span><span class="default">150</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; </span><span class="comment">// display any messages, whether success or failure<br />
&nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$m</span><span class="keyword">) { foreach(</span><span class="default">$m </span><span class="keyword">as </span><span class="default">$text</span><span class="keyword">) { print </span><span class="string">"</span><span class="default">$text</span><span class="string">&lt;br&gt;"</span><span class="keyword">; } }<br />
&nbsp; }<br />
&nbsp;}<br />
}<br />
<br />
function </span><span class="default">thumb</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="default">$bigname</span><span class="keyword">, </span><span class="default">$thumbname</span><span class="keyword">, </span><span class="default">$maxwidth</span><span class="keyword">, </span><span class="default">$maxheight</span><span class="keyword">)<br />
{<br />
&nbsp;if (</span><span class="default">is_uploaded_file</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">[</span><span class="default">tmp_name</span><span class="keyword">]))<br />
&nbsp;{<br />
&nbsp; </span><span class="comment">// determine the image type<br />
&nbsp; </span><span class="keyword">if (</span><span class="default">$file</span><span class="keyword">[</span><span class="default">type</span><span class="keyword">] == </span><span class="string">"image/jpeg"</span><span class="keyword">) { </span><span class="default">$ext </span><span class="keyword">= </span><span class="string">".jpg"</span><span class="keyword">; }<br />
&nbsp; if (</span><span class="default">$file</span><span class="keyword">[</span><span class="default">type</span><span class="keyword">] == </span><span class="string">"image/png"</span><span class="keyword">) { </span><span class="default">$ext </span><span class="keyword">= </span><span class="string">".png"</span><span class="keyword">; }<br />
&nbsp; if (</span><span class="default">$file</span><span class="keyword">[</span><span class="default">type</span><span class="keyword">] == </span><span class="string">"image/gif"</span><span class="keyword">) { </span><span class="default">$ext </span><span class="keyword">= </span><span class="string">".gif"</span><span class="keyword">; }<br />
<br />
&nbsp; </span><span class="default">$newfile </span><span class="keyword">= </span><span class="default">$bigname </span><span class="keyword">. </span><span class="default">$ext</span><span class="keyword">;<br />
<br />
&nbsp; if (</span><span class="default">move_uploaded_file</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">[</span><span class="default">tmp_name</span><span class="keyword">], </span><span class="default">$newfile</span><span class="keyword">))<br />
&nbsp; {<br />
&nbsp;&nbsp; </span><span class="default">$message</span><span class="keyword">[] = </span><span class="string">"Upload complete"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; </span><span class="comment">// get old image size and convert to a maximum width/height combo<br />
&nbsp;&nbsp; </span><span class="default">$size </span><span class="keyword">= </span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$newfile</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; </span><span class="comment">// only do the conversion if the width is greater than zero, otherwise there could be a division by zero error<br />
&nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$size</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] != </span><span class="default">0</span><span class="keyword">)<br />
&nbsp;&nbsp; {<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Calculate the thumbnail's width an height, based on the max sized allowed and the original's dimensions<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$size</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]/</span><span class="default">$size</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] &gt; </span><span class="default">$maxwidth</span><span class="keyword">/</span><span class="default">$maxheight</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; { </span><span class="default">$newwidth </span><span class="keyword">= </span><span class="default">$maxwidth</span><span class="keyword">; </span><span class="default">$newheight </span><span class="keyword">= </span><span class="default">floor</span><span class="keyword">((</span><span class="default">$size</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] * </span><span class="default">$maxwidth</span><span class="keyword">) / </span><span class="default">$size</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]); }<br />
&nbsp;&nbsp; &nbsp; else<br />
&nbsp;&nbsp;&nbsp; { </span><span class="default">$newheight </span><span class="keyword">= </span><span class="default">$maxheight</span><span class="keyword">; </span><span class="default">$newwidth </span><span class="keyword">= </span><span class="default">ceil</span><span class="keyword">((</span><span class="default">$size</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] * </span><span class="default">$maxheight</span><span class="keyword">) / </span><span class="default">$size</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]); }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Create the thumbnail<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$i </span><span class="keyword">= </span><span class="default">imagecreate</span><span class="keyword">(</span><span class="default">$newwidth</span><span class="keyword">, </span><span class="default">$newheight</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$ext </span><span class="keyword">== </span><span class="string">".jpg"</span><span class="keyword">) { </span><span class="default">$j </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$newfile</span><span class="keyword">); }<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$ext </span><span class="keyword">== </span><span class="string">".png"</span><span class="keyword">) { </span><span class="default">$j </span><span class="keyword">= </span><span class="default">imagecreatefrompng</span><span class="keyword">(</span><span class="default">$newfile</span><span class="keyword">); }<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$ext </span><span class="keyword">== </span><span class="string">".gif"</span><span class="keyword">) { </span><span class="default">$j </span><span class="keyword">= </span><span class="default">imagecreatefromgif</span><span class="keyword">(</span><span class="default">$newfile</span><span class="keyword">); }<br />
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$j</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; </span><span class="comment">// Copy the original image and paste into the new image, resized<br />
&nbsp;&nbsp; &nbsp; </span><span class="keyword">if (</span><span class="default">imagecopyresized</span><span class="keyword">(</span><span class="default">$i</span><span class="keyword">, </span><span class="default">$j</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$newwidth</span><span class="keyword">, </span><span class="default">$newheight</span><span class="keyword">, </span><span class="default">$size</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="default">$size</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]))<br />
&nbsp;&nbsp; &nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (</span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$i</span><span class="keyword">, </span><span class="default">$thumbname </span><span class="keyword">. </span><span class="default">$ext</span><span class="keyword">, </span><span class="default">100</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$message</span><span class="keyword">[] = </span><span class="string">"Image thumb created successfully"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$message</span><span class="keyword">[] = </span><span class="string">"Image thumb would not export"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; } else {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$message</span><span class="keyword">[] = </span><span class="string">"Image resize failure"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; }<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$message</span><span class="keyword">[] = </span><span class="string">"Image type not recognized"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp; } else { </span><span class="comment">// size[1] != 0<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$message</span><span class="keyword">[] = </span><span class="string">"Image size invalid"</span><span class="keyword">;<br />
&nbsp;&nbsp; }<br />
&nbsp; } </span><span class="comment">// move_uploaded_file<br />
&nbsp;</span><span class="keyword">} </span><span class="comment">// is_uploaded_file<br />
<br />
&nbsp;</span><span class="keyword">return </span><span class="default">$message</span><span class="keyword">;<br />
}<br />
<br />
print </span><span class="string">"<br />
&lt;html&gt;<br />
&lt;head&gt;<br />
&lt;title&gt;Image upload and create Thumbnail&lt;/title&gt;<br />
&lt;/head&gt;<br />
<br />
&lt;body&gt;<br />
<br />
&lt;form action='index.php' method='POST' enctype='multipart/form-data'&gt;<br />
&lt;input type='hidden' name='formname' value='upload'&gt;<br />
&lt;input type='file' name='fileupload'&gt;<br />
&lt;input type='submit' value='Upload'&gt;<br />
&lt;/form&gt;<br />
<br />
&lt;/body&gt;<br />
&lt;/html&gt;<br />
"</span><span class="keyword">;<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
NOTE: This does not deal with adjusting palettes or transparent colors, but that can be added if you need it.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="106539""></a>
  <div class="note">
   <strong class="user">licson0729 at gmail dot com</strong>
   <a href="#106539" class="date">17-Nov-2011 03:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I couldn't find any script that resize an image and give border to it. So I made one myself. Hope that can help you.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">imagecopyresizedwithborder</span><span class="keyword">(&amp;</span><span class="default">$src</span><span class="keyword">,</span><span class="default">$width</span><span class="keyword">,</span><span class="default">$height</span><span class="keyword">,</span><span class="default">$borderthickess</span><span class="keyword">,</span><span class="default">$bordercolor</span><span class="keyword">=</span><span class="default">NULL</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; list(</span><span class="default">$width_orig</span><span class="keyword">, </span><span class="default">$height_orig</span><span class="keyword">) = array(</span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">),</span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">));<br />
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$width </span><span class="keyword">&amp;&amp; (</span><span class="default">$width_orig </span><span class="keyword">&lt; </span><span class="default">$height_orig</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$width </span><span class="keyword">= (</span><span class="default">$height </span><span class="keyword">/ </span><span class="default">$height_orig</span><span class="keyword">) * </span><span class="default">$width_orig</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; else<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$height </span><span class="keyword">= (</span><span class="default">$width </span><span class="keyword">/ </span><span class="default">$width_orig</span><span class="keyword">) * </span><span class="default">$height_orig</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$dst </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$width</span><span class="keyword">+</span><span class="default">2</span><span class="keyword">*</span><span class="default">$borderthickess</span><span class="keyword">,</span><span class="default">$height</span><span class="keyword">+</span><span class="default">2</span><span class="keyword">*</span><span class="default">$borderthickess</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagecolortransparent</span><span class="keyword">(</span><span class="default">$dst</span><span class="keyword">,</span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$dst</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagealphablending</span><span class="keyword">(</span><span class="default">$dst</span><span class="keyword">,</span><span class="default">false</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagesavealpha</span><span class="keyword">(</span><span class="default">$dst</span><span class="keyword">,</span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagefill</span><span class="keyword">(</span><span class="default">$dst</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,(isset(</span><span class="default">$bordercolor</span><span class="keyword">) ? </span><span class="default">$bordercolor </span><span class="keyword">: </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$dst</span><span class="keyword">,</span><span class="default">255</span><span class="keyword">,</span><span class="default">255</span><span class="keyword">,</span><span class="default">255</span><span class="keyword">)));<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$dst</span><span class="keyword">,</span><span class="default">$src</span><span class="keyword">,</span><span class="default">$borderthickess</span><span class="keyword">,</span><span class="default">$borderthickess</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$width</span><span class="keyword">,</span><span class="default">$height</span><span class="keyword">,</span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">),</span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$dst</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="104556""></a>
  <div class="note">
   <strong class="user">email at vladislav dot net</strong>
   <a href="#104556" class="date">22-Jun-2011 03:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I didn't find here before any script giving both GIF and PNG transparent images correct, so I offer you mine.
<br />
Here is the code for 'image.php' script to generate a resized or original sized images of any type (JPEG, GIF, PNG) with respect to possible transparency of GIF and PNG.
<br />
The following script can be used in HTML tag IMG (to display an image marked in database with ID equal to 1 and resized to max 100px) like this:
<br />
&lt;img src="image.php?id=1&amp;size=100" /&gt;.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="comment">/* *************************
<br />
&nbsp;* Script by A. Vladislav I.
<br />
&nbsp;* ************************* */
<br />
</span><span class="default">$id </span><span class="keyword">= </span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'id'</span><span class="keyword">];
<br />
</span><span class="default">$size </span><span class="keyword">= </span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'size'</span><span class="keyword">];
<br />
if(!empty(</span><span class="default">$id</span><span class="keyword">))
<br />
{
<br />
</span><span class="comment">/* Here you may take the source image path from where you want: current direcory, databse etc.
<br />
&nbsp;I used the $_GET['id'] for giving the script an ID of the image in database, where its real name is stored.
<br />
&nbsp;I consider later the $f variable responsible to store file name and $type variable responsible to store mime type of the image. You may use function GetImageSize() to discover the mime type.
<br />
&nbsp;So don't forget to set the */
<br />
&nbsp; </span><span class="default">$f </span><span class="keyword">= </span><span class="comment">/*...*/ </span><span class="keyword">;
<br />
</span><span class="comment">/* and */
<br />
&nbsp; </span><span class="default">$type </span><span class="keyword">= </span><span class="comment">/*...*/ </span><span class="keyword">;
<br />
</span><span class="comment">/* ... */
<br />
</span><span class="keyword">}
<br />
</span><span class="default">$imgFunc </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;
<br />
switch(</span><span class="default">$type</span><span class="keyword">)
<br />
{
<br />
&nbsp;&nbsp;&nbsp; case </span><span class="string">'image/gif'</span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$img </span><span class="keyword">= </span><span class="default">ImageCreateFromGIF</span><span class="keyword">(</span><span class="default">$f</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$imgFunc </span><span class="keyword">= </span><span class="string">'ImageGIF'</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$transparent_index </span><span class="keyword">= </span><span class="default">ImageColorTransparent</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$transparent_index</span><span class="keyword">!=(-</span><span class="default">1</span><span class="keyword">)) </span><span class="default">$transparent_color </span><span class="keyword">= </span><span class="default">ImageColorsForIndex</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">,</span><span class="default">$transparent_index</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; break;
<br />
&nbsp;&nbsp;&nbsp; case </span><span class="string">'image/jpeg'</span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$img </span><span class="keyword">= </span><span class="default">ImageCreateFromJPEG</span><span class="keyword">(</span><span class="default">$f</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$imgFunc </span><span class="keyword">= </span><span class="string">'ImageJPEG'</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; break;
<br />
&nbsp;&nbsp;&nbsp; case </span><span class="string">'image/png'</span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$img </span><span class="keyword">= </span><span class="default">ImageCreateFromPNG</span><span class="keyword">(</span><span class="default">$f</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ImageAlphaBlending</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">,</span><span class="default">true</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ImageSaveAlpha</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">,</span><span class="default">true</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$imgFunc </span><span class="keyword">= </span><span class="string">'ImagePNG'</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; break;
<br />
&nbsp;&nbsp;&nbsp; default:
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; die(</span><span class="string">"ERROR - no image found"</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; break;
<br />
}
<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-Type: "</span><span class="keyword">.</span><span class="default">$type</span><span class="keyword">);
<br />
if(!empty(</span><span class="default">$size</span><span class="keyword">))
<br />
{
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; list(</span><span class="default">$w</span><span class="keyword">,</span><span class="default">$h</span><span class="keyword">) = </span><span class="default">GetImageSize</span><span class="keyword">(</span><span class="default">$f</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; if( </span><span class="default">$w</span><span class="keyword">==</span><span class="default">0 </span><span class="keyword">or </span><span class="default">$h</span><span class="keyword">==</span><span class="default">0 </span><span class="keyword">) die(</span><span class="string">"ERROR - zero image size"</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$percent </span><span class="keyword">= </span><span class="default">$size </span><span class="keyword">/ ((</span><span class="default">$w</span><span class="keyword">&gt;</span><span class="default">$h</span><span class="keyword">)?</span><span class="default">$w</span><span class="keyword">:</span><span class="default">$h</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$percent</span><span class="keyword">&gt;</span><span class="default">0 </span><span class="keyword">and </span><span class="default">$percent</span><span class="keyword">&lt;</span><span class="default">1</span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nw </span><span class="keyword">= </span><span class="default">intval</span><span class="keyword">(</span><span class="default">$w</span><span class="keyword">*</span><span class="default">$percent</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nh </span><span class="keyword">= </span><span class="default">intval</span><span class="keyword">(</span><span class="default">$h</span><span class="keyword">*</span><span class="default">$percent</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$img_resized </span><span class="keyword">= </span><span class="default">ImageCreateTrueColor</span><span class="keyword">(</span><span class="default">$nw</span><span class="keyword">,</span><span class="default">$nh</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$type</span><span class="keyword">==</span><span class="string">'image/png'</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ImageAlphaBlending</span><span class="keyword">(</span><span class="default">$img_resized</span><span class="keyword">,</span><span class="default">false</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ImageSaveAlpha</span><span class="keyword">(</span><span class="default">$img_resized</span><span class="keyword">,</span><span class="default">true</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(!empty(</span><span class="default">$transparent_color</span><span class="keyword">))
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$transparent_new </span><span class="keyword">= </span><span class="default">ImageColorAllocate</span><span class="keyword">(</span><span class="default">$img_resized</span><span class="keyword">,</span><span class="default">$transparent_color</span><span class="keyword">[</span><span class="string">'red'</span><span class="keyword">],</span><span class="default">$transparent_color</span><span class="keyword">[</span><span class="string">'green'</span><span class="keyword">],</span><span class="default">$transparent_color</span><span class="keyword">[</span><span class="string">'blue'</span><span class="keyword">]);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$transparent_new_index </span><span class="keyword">= </span><span class="default">ImageColorTransparent</span><span class="keyword">(</span><span class="default">$img_resized</span><span class="keyword">,</span><span class="default">$transparent_new</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ImageFill</span><span class="keyword">(</span><span class="default">$img_resized</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">, </span><span class="default">$transparent_new_index</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">ImageCopyResized</span><span class="keyword">(</span><span class="default">$img_resized</span><span class="keyword">,</span><span class="default">$img</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">, </span><span class="default">$nw</span><span class="keyword">,</span><span class="default">$nh</span><span class="keyword">, </span><span class="default">$w</span><span class="keyword">,</span><span class="default">$h </span><span class="keyword">))
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ImageDestroy</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$img </span><span class="keyword">= </span><span class="default">$img_resized</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />
}
<br />
</span><span class="default">$imgFunc</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">);
<br />
</span><span class="default">ImageDestroy</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">);
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
P.S.
<br />
The script can be written better (optimized etc.), but I hope you can do it by yourself.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="90651""></a>
  <div class="note">
   <strong class="user">kvslaap</strong>
   <a href="#90651" class="date">02-May-2009 07:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
this is a script which loops trough a directory that is currently set to "files" and resizes all images with respecting the image ratio
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="comment">//use this line if you get the error message of using too much memory (strip '//')
<br />
//ini_set ( "memory_limit", "48M");
<br />

<br />
</span><span class="default">$target_width </span><span class="keyword">= </span><span class="default">800</span><span class="keyword">;
<br />
</span><span class="default">$target_height </span><span class="keyword">= </span><span class="default">600</span><span class="keyword">;
<br />

<br />
if (</span><span class="default">ob_get_level</span><span class="keyword">() == </span><span class="default">0</span><span class="keyword">) </span><span class="default">ob_start</span><span class="keyword">();
<br />
if (</span><span class="default">$handle </span><span class="keyword">= </span><span class="default">opendir</span><span class="keyword">(</span><span class="string">'files/'</span><span class="keyword">)) {
<br />
&nbsp; while (</span><span class="default">false </span><span class="keyword">!== (</span><span class="default">$file </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">))) {
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$file </span><span class="keyword">!= </span><span class="string">"." </span><span class="keyword">&amp;&amp; </span><span class="default">$file </span><span class="keyword">!= </span><span class="string">".."</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$destination_path </span><span class="keyword">= </span><span class="string">'./files/'</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$target_path </span><span class="keyword">= </span><span class="default">$destination_path </span><span class="keyword">. </span><span class="default">basename</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$extension </span><span class="keyword">= </span><span class="default">pathinfo</span><span class="keyword">(</span><span class="default">$target_path</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$allowed_ext </span><span class="keyword">= </span><span class="string">"jpg, gif, png, bmp, jpeg, JPG"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$extension </span><span class="keyword">= </span><span class="default">$extension</span><span class="keyword">[</span><span class="default">extension</span><span class="keyword">];
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$allowed_paths </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">", "</span><span class="keyword">, </span><span class="default">$allowed_ext</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$ok </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp;&nbsp; for(</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">count</span><span class="keyword">(</span><span class="default">$allowed_paths</span><span class="keyword">); </span><span class="default">$i</span><span class="keyword">++) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$allowed_paths</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] == </span><span class="string">"</span><span class="default">$extension</span><span class="string">"</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ok </span><span class="keyword">= </span><span class="string">"1"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (</span><span class="default">$ok </span><span class="keyword">== </span><span class="string">"1"</span><span class="keyword">) {
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$extension </span><span class="keyword">== </span><span class="string">"jpg" </span><span class="keyword">|| </span><span class="default">$extension </span><span class="keyword">== </span><span class="string">"jpeg" </span><span class="keyword">|| </span><span class="default">$extension </span><span class="keyword">== </span><span class="string">"JPG"</span><span class="keyword">){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tmp_image</span><span class="keyword">=</span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$target_path</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$extension </span><span class="keyword">== </span><span class="string">"png"</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tmp_image</span><span class="keyword">=</span><span class="default">imagecreatefrompng</span><span class="keyword">(</span><span class="default">$target_path</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$extension </span><span class="keyword">== </span><span class="string">"gif"</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tmp_image</span><span class="keyword">=</span><span class="default">imagecreatefromgif</span><span class="keyword">(</span><span class="default">$target_path</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$width </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$tmp_image</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$height </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$tmp_image</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//calculate the image ratio
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$imgratio </span><span class="keyword">= (</span><span class="default">$width </span><span class="keyword">/ </span><span class="default">$height</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$imgratio</span><span class="keyword">&gt;</span><span class="default">1</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_width </span><span class="keyword">= </span><span class="default">$target_width</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_height </span><span class="keyword">= (</span><span class="default">$target_width </span><span class="keyword">/ </span><span class="default">$imgratio</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_height </span><span class="keyword">= </span><span class="default">$target_height</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_width </span><span class="keyword">= (</span><span class="default">$target_height </span><span class="keyword">* </span><span class="default">$imgratio</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_image </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$new_width</span><span class="keyword">,</span><span class="default">$new_height</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ImageCopyResized</span><span class="keyword">(</span><span class="default">$new_image</span><span class="keyword">, </span><span class="default">$tmp_image</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">, </span><span class="default">$new_width</span><span class="keyword">, </span><span class="default">$new_height</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//Grab new image
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$new_image</span><span class="keyword">, </span><span class="default">$target_path</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$image_buffer </span><span class="keyword">= </span><span class="default">ob_get_contents</span><span class="keyword">();
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ImageDestroy</span><span class="keyword">(</span><span class="default">$new_image</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ImageDestroy</span><span class="keyword">(</span><span class="default">$tmp_image</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">" </span><span class="default">$file</span><span class="string"> resized to </span><span class="default">$new_width</span><span class="string"> x </span><span class="default">$new_height</span><span class="string"> &lt;br&gt; \n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">str_pad</span><span class="keyword">(</span><span class="string">''</span><span class="keyword">,</span><span class="default">4096</span><span class="keyword">).</span><span class="string">"\n"</span><span class="keyword">;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ob_flush</span><span class="keyword">();
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">flush</span><span class="keyword">();
<br />
&nbsp;&nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp; }
<br />
&nbsp; </span><span class="default">closedir</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">);
<br />
&nbsp; echo </span><span class="string">"Done."</span><span class="keyword">;
<br />
&nbsp; </span><span class="default">ob_end_flush</span><span class="keyword">();
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="88533""></a>
  <div class="note">
   <strong class="user">david from quidware</strong>
   <a href="#88533" class="date">28-Jan-2009 12:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If the script should resize and save thumb I use this simple code, I made a couple corrections from last one and added the possibility to resize to a max HEIGHT:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/**<br />
&nbsp;* Make thumbs from JPEG, PNG, GIF source file<br />
&nbsp;*<br />
&nbsp;* $tmpname = $_FILES['source']['tmp_name'];&nbsp;&nbsp; <br />
&nbsp;* $size - max width size<br />
&nbsp;* $save_dir - destination folder<br />
&nbsp;* $save_name - tnumb new name<br />
&nbsp;* $maxisheight - is max for width (if not is for height)<br />
&nbsp;*<br />
&nbsp;* Author:&nbsp; David Taubmann <a href="http://www.quidware.com (edited from LEDok - http://www.citadelavto.ru/" rel="nofollow" target="_blank">http://www.quidware.com (edited from LEDok - http://www.citadelavto.ru/</a>)<br />
&nbsp;*/<br />
&nbsp;<br />
/*/&nbsp; &nbsp; // And now how using this function fast:<br />
if ($_POST[pic])<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; $tmpname&nbsp; = $_FILES['pic']['tmp_name'];<br />
&nbsp;&nbsp;&nbsp; @img_resize( $tmpname , 600 , "../album" , "album_".$id.".jpg");<br />
&nbsp;&nbsp;&nbsp; @img_resize( $tmpname , 120 , "../album" , "album_".$id."_small.jpg");<br />
&nbsp;&nbsp;&nbsp; @img_resize( $tmpname , 60 , "../album" , "album_".$id."_maxheight.jpg", 1);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; else<br />
&nbsp;&nbsp;&nbsp; echo "No Images uploaded via POST";<br />
/**/<br />
<br />
</span><span class="keyword">function </span><span class="default">img_resize</span><span class="keyword">( </span><span class="default">$tmpname</span><span class="keyword">, </span><span class="default">$size</span><span class="keyword">, </span><span class="default">$save_dir</span><span class="keyword">, </span><span class="default">$save_name</span><span class="keyword">, </span><span class="default">$maxisheight </span><span class="keyword">= </span><span class="default">0 </span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$save_dir&nbsp; &nbsp;&nbsp; </span><span class="keyword">.= ( </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$save_dir</span><span class="keyword">,-</span><span class="default">1</span><span class="keyword">) != </span><span class="string">"/"</span><span class="keyword">) ? </span><span class="string">"/" </span><span class="keyword">: </span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$gis&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$tmpname</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$type&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">$gis</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; switch(</span><span class="default">$type</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">"1"</span><span class="keyword">: </span><span class="default">$imorig </span><span class="keyword">= </span><span class="default">imagecreatefromgif</span><span class="keyword">(</span><span class="default">$tmpname</span><span class="keyword">); break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">"2"</span><span class="keyword">: </span><span class="default">$imorig </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$tmpname</span><span class="keyword">);break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">"3"</span><span class="keyword">: </span><span class="default">$imorig </span><span class="keyword">= </span><span class="default">imagecreatefrompng</span><span class="keyword">(</span><span class="default">$tmpname</span><span class="keyword">); break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; default:&nbsp; </span><span class="default">$imorig </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$tmpname</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$x </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$imorig</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$y </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$imorig</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$woh </span><span class="keyword">= (!</span><span class="default">$maxisheight</span><span class="keyword">)? </span><span class="default">$gis</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] : </span><span class="default">$gis</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] ;&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$woh </span><span class="keyword">&lt;= </span><span class="default">$size</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$aw </span><span class="keyword">= </span><span class="default">$x</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ah </span><span class="keyword">= </span><span class="default">$y</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(!</span><span class="default">$maxisheight</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$aw </span><span class="keyword">= </span><span class="default">$size</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ah </span><span class="keyword">= </span><span class="default">$size </span><span class="keyword">* </span><span class="default">$y </span><span class="keyword">/ </span><span class="default">$x</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$aw </span><span class="keyword">= </span><span class="default">$size </span><span class="keyword">* </span><span class="default">$x </span><span class="keyword">/ </span><span class="default">$y</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ah </span><span class="keyword">= </span><span class="default">$size</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$im </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$aw</span><span class="keyword">,</span><span class="default">$ah</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">$imorig </span><span class="keyword">, </span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$aw</span><span class="keyword">,</span><span class="default">$ah</span><span class="keyword">,</span><span class="default">$x</span><span class="keyword">,</span><span class="default">$y</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">$save_dir</span><span class="keyword">.</span><span class="default">$save_name</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85152""></a>
  <div class="note">
   <strong class="user">it at chmzap dot ru</strong>
   <a href="#85152" class="date">17-Aug-2008 10:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If the script should resize and save thumb I use this simple code:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="comment">/**
<br />
&nbsp;* Make thumbs from JPEG, PNG, GIF source file
<br />
&nbsp;*
<br />
&nbsp;* $tmpname = $_FILES['source']['tmp_name'];&nbsp; &nbsp; 
<br />
&nbsp;* $size - max width size
<br />
&nbsp;* $save_dir - destination folder
<br />
&nbsp;* $save_name - tnumb new name
<br />
&nbsp;* 
<br />
&nbsp;* Author:&nbsp; LEDok - <a href="http://www.citadelavto.ru/" rel="nofollow" target="_blank">http://www.citadelavto.ru/</a>
<br />
&nbsp;*/
<br />

<br />
</span><span class="keyword">function </span><span class="default">img_resize</span><span class="keyword">( </span><span class="default">$tmpname</span><span class="keyword">, </span><span class="default">$size</span><span class="keyword">, </span><span class="default">$save_dir</span><span class="keyword">, </span><span class="default">$save_name </span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$save_dir </span><span class="keyword">.= ( </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$save_dir</span><span class="keyword">,-</span><span class="default">1</span><span class="keyword">) != </span><span class="string">"/"</span><span class="keyword">) ? </span><span class="string">"/" </span><span class="keyword">: </span><span class="string">""</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$gis&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">GetImageSize</span><span class="keyword">(</span><span class="default">$tmpname</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$type&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">$gis</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">];
<br />
&nbsp;&nbsp;&nbsp; switch(</span><span class="default">$type</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">"1"</span><span class="keyword">: </span><span class="default">$imorig </span><span class="keyword">= </span><span class="default">imagecreatefromgif</span><span class="keyword">(</span><span class="default">$tmpname</span><span class="keyword">); break;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">"2"</span><span class="keyword">: </span><span class="default">$imorig </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$tmpname</span><span class="keyword">);break;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">"3"</span><span class="keyword">: </span><span class="default">$imorig </span><span class="keyword">= </span><span class="default">imagecreatefrompng</span><span class="keyword">(</span><span class="default">$tmpname</span><span class="keyword">); break;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; default:&nbsp; </span><span class="default">$imorig </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$tmpname</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } 
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$x </span><span class="keyword">= </span><span class="default">imageSX</span><span class="keyword">(</span><span class="default">$imorig</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$y </span><span class="keyword">= </span><span class="default">imageSY</span><span class="keyword">(</span><span class="default">$imorig</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$gis</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] &lt;= </span><span class="default">$size</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$av </span><span class="keyword">= </span><span class="default">$x</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ah </span><span class="keyword">= </span><span class="default">$y</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$yc </span><span class="keyword">= </span><span class="default">$y</span><span class="keyword">*</span><span class="default">1.3333333</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$d </span><span class="keyword">= </span><span class="default">$x</span><span class="keyword">&gt;</span><span class="default">$yc</span><span class="keyword">?</span><span class="default">$x</span><span class="keyword">:</span><span class="default">$yc</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$c </span><span class="keyword">= </span><span class="default">$d</span><span class="keyword">&gt;</span><span class="default">$size </span><span class="keyword">? </span><span class="default">$size</span><span class="keyword">/</span><span class="default">$d </span><span class="keyword">: </span><span class="default">$size</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$av </span><span class="keyword">= </span><span class="default">$x</span><span class="keyword">*</span><span class="default">$c</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">//высота исходной картинки
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ah </span><span class="keyword">= </span><span class="default">$y</span><span class="keyword">*</span><span class="default">$c</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">//длина исходной картинки
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">}&nbsp; &nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$im </span><span class="keyword">= </span><span class="default">imagecreate</span><span class="keyword">(</span><span class="default">$av</span><span class="keyword">, </span><span class="default">$ah</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$im </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$av</span><span class="keyword">,</span><span class="default">$ah</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">$imorig </span><span class="keyword">, </span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$av</span><span class="keyword">,</span><span class="default">$ah</span><span class="keyword">,</span><span class="default">$x</span><span class="keyword">,</span><span class="default">$y</span><span class="keyword">))
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">$save_dir</span><span class="keyword">.</span><span class="default">$save_name</span><span class="keyword">))
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">true</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
And now how using this function fast
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">if (</span><span class="default">$_POST</span><span class="keyword">[</span><span class="default">pic</span><span class="keyword">])
<br />
{
<br />
</span><span class="default">$tmpname&nbsp; </span><span class="keyword">= </span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'pic'</span><span class="keyword">][</span><span class="string">'tmp_name'</span><span class="keyword">];
<br />
@</span><span class="default">img_resize</span><span class="keyword">( </span><span class="default">$tmpname </span><span class="keyword">, </span><span class="default">600 </span><span class="keyword">, </span><span class="string">"../album" </span><span class="keyword">, </span><span class="string">"album_"</span><span class="keyword">.</span><span class="default">$id</span><span class="keyword">.</span><span class="string">".jpg"</span><span class="keyword">);
<br />
@</span><span class="default">img_resize</span><span class="keyword">( </span><span class="default">$tmpname </span><span class="keyword">, </span><span class="default">120 </span><span class="keyword">, </span><span class="string">"../album" </span><span class="keyword">, </span><span class="string">"album_"</span><span class="keyword">.</span><span class="default">$id</span><span class="keyword">.</span><span class="string">"_small.jpg"</span><span class="keyword">);
<br />
@</span><span class="default">img_resize</span><span class="keyword">( </span><span class="default">$tmpname </span><span class="keyword">, </span><span class="default">60 </span><span class="keyword">, </span><span class="string">"../album" </span><span class="keyword">, </span><span class="string">"album_"</span><span class="keyword">.</span><span class="default">$id</span><span class="keyword">.</span><span class="string">"verysmall.jpg"</span><span class="keyword">);
<br />
}
<br />
else
<br />
echo </span><span class="string">"No Images uploaded via POST"</span><span class="keyword">;
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="78482""></a>
  <div class="note">
   <strong class="user">andrvm at andrvm dot ru</strong>
   <a href="#78482" class="date">14-Oct-2007 04:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
One more version of setMemoryForImage (see below)
<br />

<br />
<span class="default">&lt;?php
<br />

<br />
</span><span class="keyword">function </span><span class="default">setMemoryForImage</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">)
<br />
{
<br />
&nbsp;&nbsp; </span><span class="default">$imageInfo&nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">);
<br />
&nbsp;&nbsp; </span><span class="default">$memoryNeeded </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">((</span><span class="default">$imageInfo</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] * </span><span class="default">$imageInfo</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] * </span><span class="default">$imageInfo</span><span class="keyword">[</span><span class="string">'bits'</span><span class="keyword">] * </span><span class="default">$imageInfo</span><span class="keyword">[</span><span class="string">'channels'</span><span class="keyword">] / </span><span class="default">8 </span><span class="keyword">+ </span><span class="default">Pow</span><span class="keyword">(</span><span class="default">2</span><span class="keyword">, </span><span class="default">16</span><span class="keyword">)) * </span><span class="default">1.65</span><span class="keyword">);
<br />
&nbsp;&nbsp; 
<br />
&nbsp;&nbsp; </span><span class="default">$memoryLimit </span><span class="keyword">= (int) </span><span class="default">ini_get</span><span class="keyword">(</span><span class="string">'memory_limit'</span><span class="keyword">)*</span><span class="default">1048576</span><span class="keyword">;
<br />

<br />
&nbsp; if ((</span><span class="default">memory_get_usage</span><span class="keyword">() + </span><span class="default">$memoryNeeded</span><span class="keyword">) &gt; </span><span class="default">$memoryLimit</span><span class="keyword">)
<br />
&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">ini_set</span><span class="keyword">(</span><span class="string">'memory_limit'</span><span class="keyword">, </span><span class="default">ceil</span><span class="keyword">((</span><span class="default">memory_get_usage</span><span class="keyword">() + </span><span class="default">$memoryNeeded </span><span class="keyword">+ </span><span class="default">$memoryLimit</span><span class="keyword">)/</span><span class="default">1048576</span><span class="keyword">).</span><span class="string">'M'</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; return (</span><span class="default">true</span><span class="keyword">);
<br />
&nbsp;&nbsp; }
<br />
&nbsp;&nbsp; else return(</span><span class="default">false</span><span class="keyword">);
<br />
}
<br />

<br />
</span><span class="default">?&gt;
<br />
</span>//work's it. no problem!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75624""></a>
  <div class="note">
   <strong class="user">nils dot clark-bernhard at human-aspects dot de</strong>
   <a href="#75624" class="date">08-Jun-2007 04:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Regarding ob at babcom dot biz's function Resize($Dir,$Image,$NewDir,$NewImage,$MaxWidth,$MaxHeight,$Quality) <br />
<br />
Make sure to not use a quality of 9 or higher for png resizing.<br />
<br />
PHP will output an error like:<br />
fatal libpng error: zlib failed to initialize compressor<br />
or<br />
gd-png error: setjmp returns error condition</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74084""></a>
  <div class="note">
   <strong class="user">Halit Yesil mail at halityesil dot com</strong>
   <a href="#74084" class="date">23-Mar-2007 08:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This Class image resize or crop,<br />
your copyright text write on the image and your logo marge on the image.<br />
<br />
Full Class code =&gt; <a href="http://www.phpbuilder.com/snippet/download.php?type=snippet&amp;id=2188" rel="nofollow" target="_blank">http://www.phpbuilder.com/snippet/download.php?type=snippet&amp;id=2188</a><br />
/**<br />
&nbsp;&nbsp; &nbsp; * Author&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; : Halit YESIL<br />
&nbsp;&nbsp; &nbsp; * www&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : www.halityesil.com, www.prografik.net, www.trteknik.net<br />
&nbsp;&nbsp; &nbsp; * email&nbsp; &nbsp; &nbsp; &nbsp; : mail@halityesil.com, halit.yesil@prografik.net, halit.yesil@trteknik.net<br />
&nbsp;&nbsp; &nbsp; * GSM&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : +90.535 648 3504<br />
&nbsp;&nbsp; &nbsp; * Create Date&nbsp; &nbsp; : 21 / 03 / 2007<br />
&nbsp;&nbsp; &nbsp; * <br />
&nbsp;&nbsp; &nbsp; * <br />
&nbsp;&nbsp; &nbsp; * Script&nbsp; &nbsp; &nbsp; &nbsp; : Image resize and croping class. <br />
&nbsp;&nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; You can Write copyright text and attach your logo write on image with this class<br />
&nbsp;&nbsp; &nbsp; * <br />
&nbsp;&nbsp; &nbsp; * <br />
&nbsp;&nbsp; &nbsp; * $obj = new pg_image($arg);<br />
&nbsp;&nbsp; &nbsp; *<br />
&nbsp;&nbsp; &nbsp; * <br />
&nbsp;&nbsp; &nbsp; * Varibles Information<br />
&nbsp;&nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [0] type =&gt; (POST | FILE) =&gt; Source File Send Type _FILES OR Dir<br />
&nbsp;&nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [1] file =&gt; ({if POST Array file = $_FILES['yourfile']}|{if FILE false}) =&gt; Source File filesource<br />
&nbsp;&nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [2] path =&gt; ({if FILE String [ dirname/filename.extension ]}) =&gt; Source File Root Path<br />
&nbsp;&nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [3] target =&gt; ({if FILE String [ dirname/filename.extension ]}) =&gt; Target File Root Path<br />
&nbsp;&nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [4] width =&gt; (integer) =&gt; Target File Width<br />
&nbsp;&nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [5] height =&gt; (integer) =&gt; Target File Height<br />
&nbsp;&nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [6] quality =&gt; (integer 1 - 100) =&gt; Target File Quality 0-100 %<br />
&nbsp;&nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [7] action =&gt; (crop | resize) =&gt; Target Action "resize" OR "crop"<br />
&nbsp;&nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [8] bordersize =&gt; (integer 0-5) =&gt; Target Border Size<br />
&nbsp;&nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [9] bordercolor =&gt; (color hex) =&gt; Target Border Color<br />
&nbsp;&nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [10] bgcolor =&gt; (color hex) =&gt; Target Background Color<br />
&nbsp;&nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [11] copytext =&gt; (String) =&gt; Copyright Content Text<br />
&nbsp;&nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [12] copycolor =&gt; (color hex) =&gt; Copyright Text Color<br />
&nbsp;&nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [13] copyshadow =&gt; (color hex) =&gt; Copyright Text Shadow color<br />
&nbsp;&nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [14] copybgcolor =&gt; (color hex) =&gt; Copyright Background Color<br />
&nbsp;&nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [15] copybgshadow =&gt; (color hex) =&gt; Copyright Background Shadow Color<br />
&nbsp;&nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [16] copybordersize =&gt; (integer 0-5) =&gt; Copyright Border Size 1-3<br />
&nbsp;&nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [17] copybordercolor =&gt; (color hex) =&gt; Copyright Border Color<br />
&nbsp;&nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; [18] copyposition =&gt; (top | topright | topleft | center | left | right | bottom | bottomright | bottomleft) =&gt; Copyright Position<br />
&nbsp;&nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [19] logoposition =&gt; (top | topright | topleft | center | left | right | bottom | bottomright | bottomleft) =&gt; Logo Image Position<br />
&nbsp;&nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [20] logoimage =&gt; (String [ dirname/filename.extension] Allow Extension (PNG | GIF | JPG)) =&gt; Logo Image Root Path "PNG" OR "GIF" OR "JPG"<br />
&nbsp;&nbsp; &nbsp; * <br />
&nbsp;&nbsp; &nbsp; * <br />
&nbsp;&nbsp; &nbsp; * <br />
&nbsp;&nbsp; &nbsp; * <br />
&nbsp;&nbsp; &nbsp; */<br />
<br />
<span class="default">&lt;?php<br />
<br />
$source </span><span class="keyword">= (</span><span class="default">$_REQUEST</span><span class="keyword">[</span><span class="string">'img'</span><span class="keyword">] != </span><span class="string">''</span><span class="keyword">)?</span><span class="default">$_REQUEST</span><span class="keyword">[</span><span class="string">'img'</span><span class="keyword">]:</span><span class="string">'braille3.jpg'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$arg </span><span class="keyword">=array(&nbsp; &nbsp;&nbsp; </span><span class="default">type </span><span class="keyword">=&gt;</span><span class="string">'FILE'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">file </span><span class="keyword">=&gt;</span><span class="default">false</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">path </span><span class="keyword">=&gt;</span><span class="default">$source</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">target </span><span class="keyword">=&gt;</span><span class="string">''</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">width </span><span class="keyword">=&gt;</span><span class="default">150</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">height </span><span class="keyword">=&gt;</span><span class="default">50</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">quality </span><span class="keyword">=&gt;</span><span class="default">80</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">action </span><span class="keyword">=&gt;</span><span class="string">'resize'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">bordersize </span><span class="keyword">=&gt;</span><span class="default">1</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">bordercolor </span><span class="keyword">=&gt;</span><span class="string">'#00CCFF'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">bgcolor </span><span class="keyword">=&gt;</span><span class="string">'#000000'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">copytext </span><span class="keyword">=&gt;</span><span class="string">'Bodrum 1998'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">copycolor </span><span class="keyword">=&gt;</span><span class="string">'#FFFFFF'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">//copyshadow =&gt;'#000000',<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //copybgcolor =&gt;'#D0FFCC',<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //copybgshadow =&gt;'#656565',<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">copybordersize </span><span class="keyword">=&gt;</span><span class="default">0</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">copybordercolor </span><span class="keyword">=&gt;</span><span class="string">'#FFFFFF'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">copyposition </span><span class="keyword">=&gt;</span><span class="string">'bottom'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">logoposition </span><span class="keyword">=&gt;</span><span class="string">'topleft'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">logoimage </span><span class="keyword">=&gt;</span><span class="string">'logo.png'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//$arg = "$source,,400,300,80,resize";<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">new </span><span class="default">pg_image</span><span class="keyword">(</span><span class="default">$arg</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71182""></a>
  <div class="note">
   <strong class="user">feip at feip dot net</strong>
   <a href="#71182" class="date">15-Nov-2006 04:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This code convert images to thumbs. <br />
How he work - <br />
Check source image - Width and Height, <br />
crop a maximum from original image,<br />
resize croped to user defined size<br />
<br />
// makeIcons_MergeCenter($src, $dst, $dstx, $dsty);<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">makeIcons_MergeCenter</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">, </span><span class="default">$dst</span><span class="keyword">, </span><span class="default">$dstx</span><span class="keyword">, </span><span class="default">$dsty</span><span class="keyword">){<br />
<br />
</span><span class="comment">//$src = original image location<br />
//$dst = destination image location<br />
//$dstx = user defined width of image<br />
//$dsty = user defined height of image<br />
<br />
</span><span class="default">$allowedExtensions </span><span class="keyword">= </span><span class="string">'jpg jpeg gif png'</span><span class="keyword">;<br />
<br />
</span><span class="default">$name </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">"."</span><span class="keyword">, </span><span class="default">$src</span><span class="keyword">);<br />
</span><span class="default">$currentExtensions </span><span class="keyword">= </span><span class="default">$name</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">)-</span><span class="default">1</span><span class="keyword">];<br />
</span><span class="default">$extensions </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">" "</span><span class="keyword">, </span><span class="default">$allowedExtensions</span><span class="keyword">);<br />
<br />
for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">count</span><span class="keyword">(</span><span class="default">$extensions</span><span class="keyword">)&gt;</span><span class="default">$i</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">=</span><span class="default">$i</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">){<br />
if(</span><span class="default">$extensions</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]==</span><span class="default">$currentExtensions</span><span class="keyword">)<br />
{ </span><span class="default">$extensionOK</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">; <br />
</span><span class="default">$fileExtension</span><span class="keyword">=</span><span class="default">$extensions</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]; <br />
break; }<br />
}<br />
<br />
if(</span><span class="default">$extensionOK</span><span class="keyword">){<br />
<br />
</span><span class="default">$size </span><span class="keyword">= </span><span class="default">getImageSize</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">);<br />
</span><span class="default">$width </span><span class="keyword">= </span><span class="default">$size</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];<br />
</span><span class="default">$height </span><span class="keyword">= </span><span class="default">$size</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
<br />
if(</span><span class="default">$width </span><span class="keyword">&gt;= </span><span class="default">$dstx </span><span class="keyword">AND </span><span class="default">$height </span><span class="keyword">&gt;= </span><span class="default">$dsty</span><span class="keyword">){<br />
<br />
</span><span class="default">$proportion_X </span><span class="keyword">= </span><span class="default">$width </span><span class="keyword">/ </span><span class="default">$dstx</span><span class="keyword">;<br />
</span><span class="default">$proportion_Y </span><span class="keyword">= </span><span class="default">$height </span><span class="keyword">/ </span><span class="default">$dsty</span><span class="keyword">;<br />
<br />
if(</span><span class="default">$proportion_X </span><span class="keyword">&gt; </span><span class="default">$proportion_Y </span><span class="keyword">){<br />
</span><span class="default">$proportion </span><span class="keyword">= </span><span class="default">$proportion_Y</span><span class="keyword">;<br />
}else{<br />
</span><span class="default">$proportion </span><span class="keyword">= </span><span class="default">$proportion_X </span><span class="keyword">;<br />
}<br />
</span><span class="default">$target</span><span class="keyword">[</span><span class="string">'width'</span><span class="keyword">] = </span><span class="default">$dstx </span><span class="keyword">* </span><span class="default">$proportion</span><span class="keyword">;<br />
</span><span class="default">$target</span><span class="keyword">[</span><span class="string">'height'</span><span class="keyword">] = </span><span class="default">$dsty </span><span class="keyword">* </span><span class="default">$proportion</span><span class="keyword">;<br />
<br />
</span><span class="default">$original</span><span class="keyword">[</span><span class="string">'diagonal_center'</span><span class="keyword">] = <br />
</span><span class="default">round</span><span class="keyword">(</span><span class="default">sqrt</span><span class="keyword">((</span><span class="default">$width</span><span class="keyword">*</span><span class="default">$width</span><span class="keyword">)+(</span><span class="default">$height</span><span class="keyword">*</span><span class="default">$height</span><span class="keyword">))/</span><span class="default">2</span><span class="keyword">);<br />
</span><span class="default">$target</span><span class="keyword">[</span><span class="string">'diagonal_center'</span><span class="keyword">] = <br />
</span><span class="default">round</span><span class="keyword">(</span><span class="default">sqrt</span><span class="keyword">((</span><span class="default">$target</span><span class="keyword">[</span><span class="string">'width'</span><span class="keyword">]*</span><span class="default">$target</span><span class="keyword">[</span><span class="string">'width'</span><span class="keyword">])+<br />
(</span><span class="default">$target</span><span class="keyword">[</span><span class="string">'height'</span><span class="keyword">]*</span><span class="default">$target</span><span class="keyword">[</span><span class="string">'height'</span><span class="keyword">]))/</span><span class="default">2</span><span class="keyword">);<br />
<br />
</span><span class="default">$crop </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">(</span><span class="default">$original</span><span class="keyword">[</span><span class="string">'diagonal_center'</span><span class="keyword">] - </span><span class="default">$target</span><span class="keyword">[</span><span class="string">'diagonal_center'</span><span class="keyword">]);<br />
<br />
if(</span><span class="default">$proportion_X </span><span class="keyword">&lt; </span><span class="default">$proportion_Y </span><span class="keyword">){<br />
</span><span class="default">$target</span><span class="keyword">[</span><span class="string">'x'</span><span class="keyword">] = </span><span class="default">0</span><span class="keyword">;<br />
</span><span class="default">$target</span><span class="keyword">[</span><span class="string">'y'</span><span class="keyword">] = </span><span class="default">round</span><span class="keyword">(((</span><span class="default">$height</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">)*</span><span class="default">$crop</span><span class="keyword">)/</span><span class="default">$target</span><span class="keyword">[</span><span class="string">'diagonal_center'</span><span class="keyword">]);<br />
}else{<br />
</span><span class="default">$target</span><span class="keyword">[</span><span class="string">'x'</span><span class="keyword">] =&nbsp; </span><span class="default">round</span><span class="keyword">(((</span><span class="default">$width</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">)*</span><span class="default">$crop</span><span class="keyword">)/</span><span class="default">$target</span><span class="keyword">[</span><span class="string">'diagonal_center'</span><span class="keyword">]);<br />
</span><span class="default">$target</span><span class="keyword">[</span><span class="string">'y'</span><span class="keyword">] = </span><span class="default">0</span><span class="keyword">;<br />
}<br />
<br />
if(</span><span class="default">$fileExtension </span><span class="keyword">== </span><span class="string">"jpg" </span><span class="keyword">OR </span><span class="default">$fileExtension</span><span class="keyword">==</span><span class="string">'jpeg'</span><span class="keyword">){ <br />
</span><span class="default">$from </span><span class="keyword">= </span><span class="default">ImageCreateFromJpeg</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">); <br />
}elseif (</span><span class="default">$fileExtension </span><span class="keyword">== </span><span class="string">"gif"</span><span class="keyword">){ <br />
</span><span class="default">$from </span><span class="keyword">= </span><span class="default">ImageCreateFromGIF</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">); <br />
}elseif (</span><span class="default">$fileExtension </span><span class="keyword">== </span><span class="string">'png'</span><span class="keyword">){<br />
&nbsp;</span><span class="default">$from </span><span class="keyword">= </span><span class="default">imageCreateFromPNG</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">$new </span><span class="keyword">= </span><span class="default">ImageCreateTrueColor </span><span class="keyword">(</span><span class="default">$dstx</span><span class="keyword">,</span><span class="default">$dsty</span><span class="keyword">);<br />
<br />
</span><span class="default">imagecopyresampled </span><span class="keyword">(</span><span class="default">$new</span><span class="keyword">,&nbsp; </span><span class="default">$from</span><span class="keyword">,&nbsp; </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$target</span><span class="keyword">[</span><span class="string">'x'</span><span class="keyword">], <br />
</span><span class="default">$target</span><span class="keyword">[</span><span class="string">'y'</span><span class="keyword">], </span><span class="default">$dstx</span><span class="keyword">, </span><span class="default">$dsty</span><span class="keyword">, </span><span class="default">$target</span><span class="keyword">[</span><span class="string">'width'</span><span class="keyword">], </span><span class="default">$target</span><span class="keyword">[</span><span class="string">'height'</span><span class="keyword">]);<br />
<br />
&nbsp;if(</span><span class="default">$fileExtension </span><span class="keyword">== </span><span class="string">"jpg" </span><span class="keyword">OR </span><span class="default">$fileExtension </span><span class="keyword">== </span><span class="string">'jpeg'</span><span class="keyword">){ <br />
</span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$new</span><span class="keyword">, </span><span class="default">$dst</span><span class="keyword">, </span><span class="default">70</span><span class="keyword">); <br />
}elseif (</span><span class="default">$fileExtension </span><span class="keyword">== </span><span class="string">"gif"</span><span class="keyword">){ <br />
</span><span class="default">imagegif</span><span class="keyword">(</span><span class="default">$new</span><span class="keyword">, </span><span class="default">$dst</span><span class="keyword">); <br />
}elseif (</span><span class="default">$fileExtension </span><span class="keyword">== </span><span class="string">'png'</span><span class="keyword">){<br />
</span><span class="default">imagepng</span><span class="keyword">(</span><span class="default">$new</span><span class="keyword">, </span><span class="default">$dst</span><span class="keyword">);<br />
}<br />
}<br />
}<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69699""></a>
  <div class="note">
   <strong class="user">kyle dot florence at gmail dot com</strong>
   <a href="#69699" class="date">15-Sep-2006 06:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The function below will resize an image based on max width and height, then it will create a thumbnail image from the center of the resized image of a width and height specified.&nbsp; This function will not resize the image to max_w pixels by max_h pixels, those are only the max width's and heights the image can be, it resizes the image to the first 1:1 ratio below max_w and max_h.<br />
<br />
For example, if you have an image that is 800x600 and you specify your new image to be 400x200, it will resize based on the smallest number (in this case 200) and maintain the images 1:1 ratio.&nbsp; So your final image would end up at something like 262x200.<br />
<br />
UPDATE:&nbsp; I have updated this function, I added the 'newdir' option in case you want the images saved in a different directory than the script.&nbsp; I also fixed the thumbnail slice so it is perfectly in the center now and fixed the bug that 'ob at babcom dot biz' mentioned so you can safely resize based on width or height now.<br />
<br />
&lt;?<br />
/**********************************************************<br />
&nbsp;* function resizejpeg:<br />
&nbsp;*<br />
&nbsp;*&nbsp; = creates a resized image based on the max width<br />
&nbsp;*&nbsp; &nbsp; specified as well as generates a thumbnail from<br />
&nbsp;*&nbsp; &nbsp; a rectangle cut from the middle of the image.<br />
&nbsp;*<br />
&nbsp;*&nbsp; &nbsp; @dir&nbsp; &nbsp; = directory image is stored in<br />
&nbsp;*&nbsp; &nbsp; @newdir = directory new image will be stored in<br />
&nbsp;*&nbsp; &nbsp; @img&nbsp; &nbsp; = the image name<br />
&nbsp;*&nbsp; &nbsp; @max_w&nbsp; = the max width of the resized image<br />
&nbsp;*&nbsp; &nbsp; @max_h&nbsp; = the max height of the resized image<br />
&nbsp;*&nbsp; &nbsp; @th_w&nbsp;&nbsp; = the width of the thumbnail<br />
&nbsp;*&nbsp; &nbsp; @th_h&nbsp;&nbsp; = the height of the thumbnail<br />
&nbsp;*<br />
&nbsp;**********************************************************/<br />
<br />
function resizejpeg($dir, $newdir, $img, $max_w, $max_h, $th_w, $th_h)<br />
{<br />
&nbsp;&nbsp;&nbsp; // set destination directory<br />
&nbsp;&nbsp;&nbsp; if (!$newdir) $newdir = $dir;<br />
<br />
&nbsp;&nbsp;&nbsp; // get original images width and height<br />
&nbsp;&nbsp;&nbsp; list($or_w, $or_h, $or_t) = getimagesize($dir.$img);<br />
<br />
&nbsp;&nbsp;&nbsp; // make sure image is a jpeg<br />
&nbsp;&nbsp;&nbsp; if ($or_t == 2) {<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // obtain the image's ratio<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $ratio = ($or_h / $or_w);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // original image<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $or_image = imagecreatefromjpeg($dir.$img);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // resize image?<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ($or_w &gt; $max_w || $or_h &gt; $max_h) {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // resize by height, then width (height dominant)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($max_h &lt; $max_w) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $rs_h = $max_h;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $rs_w = $rs_h / $ratio;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // resize by width, then height (width dominant)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $rs_w = $max_w;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $rs_h = $ratio * $rs_w;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // copy old image to new image<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $rs_image = imagecreatetruecolor($rs_w, $rs_h);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; imagecopyresampled($rs_image, $or_image, 0, 0, 0, 0, $rs_w, $rs_h, $or_w, $or_h);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // image requires no resizing<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $rs_w = $or_w;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $rs_h = $or_h;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $rs_image = $or_image;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // generate resized image<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; imagejpeg($rs_image, $newdir.$img, 100);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $th_image = imagecreatetruecolor($th_w, $th_h);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // cut out a rectangle from the resized image and store in thumbnail<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $new_w = (($rs_w / 2) - ($th_w / 2));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $new_h = (($rs_h / 2) - ($th_h / 2));<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; imagecopyresized($th_image, $rs_image, 0, 0, $new_w, $new_h, $rs_w, $rs_h, $rs_w, $rs_h);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // generate thumbnail<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; imagejpeg($th_image, $newdir.'thumb_'.$img, 100);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return true;<br />
&nbsp;&nbsp;&nbsp; } <br />
<br />
&nbsp;&nbsp;&nbsp; // Image type was not jpeg!<br />
&nbsp;&nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return false;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
?&gt;<br />
<br />
Example:<br />
<br />
<span class="default">&lt;?php<br />
$dir </span><span class="keyword">= </span><span class="string">'./'</span><span class="keyword">;<br />
</span><span class="default">$img </span><span class="keyword">= </span><span class="string">'test.jpg'</span><span class="keyword">;<br />
<br />
</span><span class="default">resizejpeg</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$img</span><span class="keyword">, </span><span class="default">600</span><span class="keyword">, </span><span class="default">400</span><span class="keyword">, </span><span class="default">300</span><span class="keyword">, </span><span class="default">150</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
The example would resize the image 'test.jpg' into something 600x400 or less (retains the 1:1 ratio of the image) and creates the file 'thumb_test.jpg' at 300x150.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69123""></a>
  <div class="note">
   <strong class="user">nworld3d at yahoo dot com</strong>
   <a href="#69123" class="date">23-Aug-2006 05:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Belows is the code snipet that allows you to resize a transparent PNG and composite it into another image.&nbsp; The code is tested to work with PHP5.1.2, GD2, but I think it can also work with other versions of PHP and GD.&nbsp; <br />
<br />
The code has been commented to help you read through it.&nbsp; The idea of resizing the transparent PNG image is to create a new destination image which is completely transparent then turn off the imageAlphaBlending of this new image so that when the PNG source file is copied, its alpha channel is still retained.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/**<br />
&nbsp;* Compose a PNG file over a src file.<br />
&nbsp;* If new width/ height are defined, then resize the PNG (and keep all the transparency info)<br />
&nbsp;* Author:&nbsp; Alex Le - <a href="http://www.alexle.net" rel="nofollow" target="_blank">http://www.alexle.net</a><br />
&nbsp;*/<br />
</span><span class="keyword">function </span><span class="default">imageComposeAlpha</span><span class="keyword">( &amp;</span><span class="default">$src</span><span class="keyword">, &amp;</span><span class="default">$ovr</span><span class="keyword">, </span><span class="default">$ovr_x</span><span class="keyword">, </span><span class="default">$ovr_y</span><span class="keyword">, </span><span class="default">$ovr_w </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">, </span><span class="default">$ovr_h </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; if( </span><span class="default">$ovr_w </span><span class="keyword">&amp;&amp; </span><span class="default">$ovr_h </span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ovr </span><span class="keyword">= </span><span class="default">imageResizeAlpha</span><span class="keyword">( </span><span class="default">$ovr</span><span class="keyword">, </span><span class="default">$ovr_w</span><span class="keyword">, </span><span class="default">$ovr_h </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/* Noew compose the 2 images */<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagecopy</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">, </span><span class="default">$ovr</span><span class="keyword">, </span><span class="default">$ovr_x</span><span class="keyword">, </span><span class="default">$ovr_y</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$ovr</span><span class="keyword">), </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$ovr</span><span class="keyword">) );&nbsp; &nbsp; <br />
}<br />
<br />
</span><span class="comment">/**<br />
&nbsp;* Resize a PNG file with transparency to given dimensions<br />
&nbsp;* and still retain the alpha channel information<br />
&nbsp;* Author:&nbsp; Alex Le - <a href="http://www.alexle.net" rel="nofollow" target="_blank">http://www.alexle.net</a><br />
&nbsp;*/<br />
</span><span class="keyword">function </span><span class="default">imageResizeAlpha</span><span class="keyword">(&amp;</span><span class="default">$src</span><span class="keyword">, </span><span class="default">$w</span><span class="keyword">, </span><span class="default">$h</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/* create a new image with the new width and height */<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$temp </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$w</span><span class="keyword">, </span><span class="default">$h</span><span class="keyword">); <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/* making the new image transparent */<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$background </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$temp</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ImageColorTransparent</span><span class="keyword">(</span><span class="default">$temp</span><span class="keyword">, </span><span class="default">$background</span><span class="keyword">); </span><span class="comment">// make the new temp image all transparent<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagealphablending</span><span class="keyword">(</span><span class="default">$temp</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">); </span><span class="comment">// turn off the alpha blending to keep the alpha channel<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; /* Resize the PNG file */<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; /* use imagecopyresized to gain some performance but loose some quality */<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagecopyresized</span><span class="keyword">(</span><span class="default">$temp</span><span class="keyword">, </span><span class="default">$src</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$w</span><span class="keyword">, </span><span class="default">$h</span><span class="keyword">, </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">), </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/* use imagecopyresampled if you concern more about the quality */<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; //imagecopyresampled($temp, $src, 0, 0, 0, 0, $w, $h, imagesx($src), imagesy($src));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">$temp</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span>Example usage:<br />
<br />
<span class="default">&lt;?php<br />
header</span><span class="keyword">(</span><span class="string">'Content-type: image/png'</span><span class="keyword">);<br />
<br />
</span><span class="comment">/* Open the photo and the overlay image */<br />
</span><span class="default">$photoImage </span><span class="keyword">= </span><span class="default">ImageCreateFromJPEG</span><span class="keyword">(</span><span class="string">'images/MiuMiu.jpg'</span><span class="keyword">);<br />
</span><span class="default">$overlay </span><span class="keyword">= </span><span class="default">ImageCreateFromPNG</span><span class="keyword">(</span><span class="string">'images/hair-trans.png'</span><span class="keyword">);<br />
<br />
</span><span class="default">$percent </span><span class="keyword">= </span><span class="default">0.8</span><span class="keyword">;<br />
</span><span class="default">$newW </span><span class="keyword">= </span><span class="default">ceil</span><span class="keyword">(</span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$overlay</span><span class="keyword">) * </span><span class="default">$percent</span><span class="keyword">);<br />
</span><span class="default">$newH </span><span class="keyword">= </span><span class="default">ceil</span><span class="keyword">(</span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$overlay</span><span class="keyword">) * </span><span class="default">$percent</span><span class="keyword">);<br />
<br />
</span><span class="comment">/* Compose the overlay photo over the target image */<br />
</span><span class="default">imageComposeAlpha</span><span class="keyword">( </span><span class="default">$photoImage</span><span class="keyword">, </span><span class="default">$overlay</span><span class="keyword">, </span><span class="default">86</span><span class="keyword">, </span><span class="default">15</span><span class="keyword">, </span><span class="default">$newW</span><span class="keyword">, </span><span class="default">$newH </span><span class="keyword">);<br />
<br />
</span><span class="comment">/* Open another PNG file, then resize and compose it */<br />
</span><span class="default">$watermark </span><span class="keyword">= </span><span class="default">imagecreatefrompng</span><span class="keyword">(</span><span class="string">'images/watermark.png'</span><span class="keyword">);<br />
</span><span class="default">imageComposeAlpha</span><span class="keyword">( </span><span class="default">$photoImage</span><span class="keyword">, </span><span class="default">$watermark</span><span class="keyword">, </span><span class="default">10</span><span class="keyword">, </span><span class="default">20</span><span class="keyword">, </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$watermark</span><span class="keyword">)/</span><span class="default">2</span><span class="keyword">, </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$watermark</span><span class="keyword">)/</span><span class="default">2 </span><span class="keyword">);<br />
<br />
</span><span class="comment">/**<br />
&nbsp;* Open the same PNG file then compose without resizing <br />
&nbsp;* As the original $watermark is passed by reference, it was resized already.<br />
&nbsp;* So we have to reopen it.<br />
&nbsp;*/<br />
</span><span class="default">$watermark </span><span class="keyword">= </span><span class="default">imagecreatefrompng</span><span class="keyword">(</span><span class="string">'images/watermark.png'</span><span class="keyword">);<br />
</span><span class="default">imageComposeAlpha</span><span class="keyword">( </span><span class="default">$photoImage</span><span class="keyword">, </span><span class="default">$watermark</span><span class="keyword">, </span><span class="default">80</span><span class="keyword">, </span><span class="default">350</span><span class="keyword">);<br />
</span><span class="default">Imagepng</span><span class="keyword">(</span><span class="default">$photoImage</span><span class="keyword">); </span><span class="comment">// output to browser<br />
<br />
</span><span class="default">ImageDestroy</span><span class="keyword">(</span><span class="default">$photoImage</span><span class="keyword">);<br />
</span><span class="default">ImageDestroy</span><span class="keyword">(</span><span class="default">$overlay</span><span class="keyword">); <br />
</span><span class="default">ImageDestroy</span><span class="keyword">(</span><span class="default">$watermark</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69042""></a>
  <div class="note">
   <strong class="user">ob at babcom dot biz</strong>
   <a href="#69042" class="date">21-Aug-2006 04:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Regarding the note and function of kyle.florence on August 3rd 2006:<br />
<br />
I tried to use his function resizejpeg() for resizing images in my gallery. As far as I can tell it contains a small bug.<br />
<br />
Resizing worked fine as long as I had the same maximum width and maximum height specified. Wanting all thumbnails to have the same height - so my images would appear in a straight line on my website both in portrait format and in landscape format - I soon encountered the problem that resizing with different values of maximum width and maximum height would not work proberly.<br />
<br />
If you are using the script change the following 2 lines where the resized width and the resized height are calculated:<br />
<br />
<span class="default">&lt;?php <br />
$rs_h </span><span class="keyword">= </span><span class="default">$ratio </span><span class="keyword">* </span><span class="default">$max_h</span><span class="keyword">; <br />
</span><span class="default">?&gt;<br />
</span>should be:<br />
<span class="default">&lt;?php <br />
$rs_h </span><span class="keyword">= </span><span class="default">$ratio </span><span class="keyword">* </span><span class="default">$rs_w</span><span class="keyword">; <br />
</span><span class="default">?&gt;<br />
</span><br />
and:<br />
<span class="default">&lt;?php <br />
$rs_w </span><span class="keyword">= </span><span class="default">$max_w </span><span class="keyword">/ </span><span class="default">$ratio</span><span class="keyword">; <br />
</span><span class="default">?&gt;<br />
</span>should be:<br />
<span class="default">&lt;?php <br />
$rs_w </span><span class="keyword">= </span><span class="default">$rs_h </span><span class="keyword">/ </span><span class="default">$ratio</span><span class="keyword">; <br />
</span><span class="default">?&gt;<br />
</span><br />
The following function is based on Kyle Florence's function. I left out the thumbnail-part and rather added the possibiliy of defining a new dir and new filename for the image. If you need to resize and then create a thumbnail just run the function twice. Here, the thumbnail will contain the full picture and not a cutout of the original image. <br />
<br />
The function supports JPG, GIF and PNG resizing. The quality in case of JPG is given to the function as the last parameter $Quality.<br />
<br />
The variable names should speak for their usage.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">Resize</span><span class="keyword">(</span><span class="default">$Dir</span><span class="keyword">,</span><span class="default">$Image</span><span class="keyword">,</span><span class="default">$NewDir</span><span class="keyword">,</span><span class="default">$NewImage</span><span class="keyword">,</span><span class="default">$MaxWidth</span><span class="keyword">,</span><span class="default">$MaxHeight</span><span class="keyword">,</span><span class="default">$Quality</span><span class="keyword">) {<br />
&nbsp; list(</span><span class="default">$ImageWidth</span><span class="keyword">,</span><span class="default">$ImageHeight</span><span class="keyword">,</span><span class="default">$TypeCode</span><span class="keyword">)=</span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$Dir</span><span class="keyword">.</span><span class="default">$Image</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$ImageType</span><span class="keyword">=(</span><span class="default">$TypeCode</span><span class="keyword">==</span><span class="default">1</span><span class="keyword">?</span><span class="string">"gif"</span><span class="keyword">:(</span><span class="default">$TypeCode</span><span class="keyword">==</span><span class="default">2</span><span class="keyword">?</span><span class="string">"jpeg"</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (</span><span class="default">$TypeCode</span><span class="keyword">==</span><span class="default">3</span><span class="keyword">?</span><span class="string">"png"</span><span class="keyword">:</span><span class="default">FALSE</span><span class="keyword">)));<br />
&nbsp; </span><span class="default">$CreateFunction</span><span class="keyword">=</span><span class="string">"imagecreatefrom"</span><span class="keyword">.</span><span class="default">$ImageType</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$OutputFunction</span><span class="keyword">=</span><span class="string">"image"</span><span class="keyword">.</span><span class="default">$ImageType</span><span class="keyword">;<br />
&nbsp; if (</span><span class="default">$ImageType</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$Ratio</span><span class="keyword">=(</span><span class="default">$ImageHeight</span><span class="keyword">/</span><span class="default">$ImageWidth</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ImageSource</span><span class="keyword">=</span><span class="default">$CreateFunction</span><span class="keyword">(</span><span class="default">$Dir</span><span class="keyword">.</span><span class="default">$Image</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$ImageWidth </span><span class="keyword">&gt; </span><span class="default">$MaxWidth </span><span class="keyword">|| </span><span class="default">$ImageHeight </span><span class="keyword">&gt; </span><span class="default">$MaxHeight</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (</span><span class="default">$ImageWidth </span><span class="keyword">&gt; </span><span class="default">$MaxWidth</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$ResizedWidth</span><span class="keyword">=</span><span class="default">$MaxWidth</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$ResizedHeight</span><span class="keyword">=</span><span class="default">$ResizedWidth</span><span class="keyword">*</span><span class="default">$Ratio</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ResizedWidth</span><span class="keyword">=</span><span class="default">$ImageWidth</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ResizedHeight</span><span class="keyword">=</span><span class="default">$ImageHeight</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; }&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp;&nbsp; if (</span><span class="default">$ResizedHeight </span><span class="keyword">&gt; </span><span class="default">$MaxHeight</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ResizedHeight</span><span class="keyword">=</span><span class="default">$MaxHeight</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ResizedWidth</span><span class="keyword">=</span><span class="default">$ResizedHeight</span><span class="keyword">/</span><span class="default">$Ratio</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; }&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$ResizedImage</span><span class="keyword">=</span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$ResizedWidth</span><span class="keyword">,</span><span class="default">$ResizedHeight</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$ResizedImage</span><span class="keyword">,</span><span class="default">$ImageSource</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$ResizedWidth</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$ResizedHeight</span><span class="keyword">,</span><span class="default">$ImageWidth</span><span class="keyword">,</span><span class="default">$ImageHeight</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; } <br />
&nbsp;&nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$ResizedWidth</span><span class="keyword">=</span><span class="default">$ImageWidth</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$ResizedHeight</span><span class="keyword">=</span><span class="default">$ImageHeight</span><span class="keyword">;&nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$ResizedImage</span><span class="keyword">=</span><span class="default">$ImageSource</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$OutputFunction</span><span class="keyword">(</span><span class="default">$ResizedImage</span><span class="keyword">,</span><span class="default">$NewDir</span><span class="keyword">.</span><span class="default">$NewImage</span><span class="keyword">,</span><span class="default">$Quality</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">true</span><span class="keyword">;<br />
&nbsp; }&nbsp; &nbsp; <br />
&nbsp; else<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Before calling the function support for JPG, PNG or GIF should be checked.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68737""></a>
  <div class="note">
   <strong class="user">hodgman at ali dot com dot au</strong>
   <a href="#68737" class="date">08-Aug-2006 04:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Users of this function should be aware that this function can return false in certain circumstances! I am assuming this is an indicator of failure.<br />
<br />
None of the example code displayed in these notes takes this into account, so all of these examples contain weaknesses that could crash a program if not used with care.<br />
<br />
However, it is not documented what kinds situations will cause it to fail, and what side effects (if it is not atomic) occur if the operation fails, so we will have to wait for the documentation to be updated before this function can be used in rock-solid (crash-proof) code.<br />
<br />
[[I posted this information earlier, but I phrased it as a question so it was removed by the editors]]</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68631""></a>
  <div class="note">
   <strong class="user">kyle(dot)florence(_[at]_)gmail(dot)com</strong>
   <a href="#68631" class="date">03-Aug-2006 06:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The function below will resize an image based on max width and height, then it will create a thumbnail image from the center of the resized image of a width and height specified.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/**********************************************************<br />
&nbsp;* function resizejpeg:<br />
&nbsp;*<br />
&nbsp;*&nbsp; = creates a resized image based on the max width<br />
&nbsp;*&nbsp; &nbsp; specified as well as generates a thumbnail from<br />
&nbsp;*&nbsp; &nbsp; a rectangle cut from the middle of the image.<br />
&nbsp;*<br />
&nbsp;*&nbsp; &nbsp; @dir&nbsp;&nbsp; = directory image is stored in<br />
&nbsp;*&nbsp; &nbsp; @img&nbsp;&nbsp; = the image name<br />
&nbsp;*&nbsp; &nbsp; @max_w = the max width of the resized image<br />
&nbsp;*&nbsp; &nbsp; @max_h = the max height of the resized image<br />
&nbsp;*&nbsp; &nbsp; @th_w&nbsp; = the width of the thumbnail<br />
&nbsp;*&nbsp; &nbsp; @th_h&nbsp; = the height of the thumbnail<br />
&nbsp;*<br />
&nbsp;**********************************************************/<br />
<br />
</span><span class="keyword">function </span><span class="default">resizejpeg</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">, </span><span class="default">$img</span><span class="keyword">, </span><span class="default">$max_w</span><span class="keyword">, </span><span class="default">$max_h</span><span class="keyword">, </span><span class="default">$th_w</span><span class="keyword">, </span><span class="default">$th_h</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// get original images width and height<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">list(</span><span class="default">$or_w</span><span class="keyword">, </span><span class="default">$or_h</span><span class="keyword">, </span><span class="default">$or_t</span><span class="keyword">) = </span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">.</span><span class="default">$img</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// make sure image is a jpeg<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$or_t </span><span class="keyword">== </span><span class="default">2</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// obtain the image's ratio<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ratio </span><span class="keyword">= (</span><span class="default">$or_h </span><span class="keyword">/ </span><span class="default">$or_w</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// original image<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$or_image </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">.</span><span class="default">$img</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// resize image<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$or_w </span><span class="keyword">&gt; </span><span class="default">$max_w </span><span class="keyword">|| </span><span class="default">$or_h </span><span class="keyword">&gt; </span><span class="default">$max_h</span><span class="keyword">) {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// first resize by width (less than $max_w)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$or_w </span><span class="keyword">&gt; </span><span class="default">$max_w</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$rs_w </span><span class="keyword">= </span><span class="default">$max_w</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$rs_h </span><span class="keyword">= </span><span class="default">$ratio </span><span class="keyword">* </span><span class="default">$max_h</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$rs_w </span><span class="keyword">= </span><span class="default">$or_w</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$rs_h </span><span class="keyword">= </span><span class="default">$or_h</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// then resize by height (less than $max_h)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$rs_h </span><span class="keyword">&gt; </span><span class="default">$max_h</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$rs_w </span><span class="keyword">= </span><span class="default">$max_w </span><span class="keyword">/ </span><span class="default">$ratio</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$rs_h </span><span class="keyword">= </span><span class="default">$max_h</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// copy old image to new image<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$rs_image </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$rs_w</span><span class="keyword">, </span><span class="default">$rs_h</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$rs_image</span><span class="keyword">, </span><span class="default">$or_image</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$rs_w</span><span class="keyword">, </span><span class="default">$rs_h</span><span class="keyword">, </span><span class="default">$or_w</span><span class="keyword">, </span><span class="default">$or_h</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$rs_w </span><span class="keyword">= </span><span class="default">$or_w</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$rs_h </span><span class="keyword">= </span><span class="default">$or_h</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$rs_image </span><span class="keyword">= </span><span class="default">$or_image</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// generate resized image<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$rs_image</span><span class="keyword">, </span><span class="default">$dir</span><span class="keyword">.</span><span class="default">$img</span><span class="keyword">, </span><span class="default">100</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$th_image </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$th_w</span><span class="keyword">, </span><span class="default">$th_h</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// cut out a rectangle from the resized image and store in thumbnail<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_w </span><span class="keyword">= ((</span><span class="default">$rs_w </span><span class="keyword">/ </span><span class="default">4</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_h </span><span class="keyword">= ((</span><span class="default">$rs_h </span><span class="keyword">/ </span><span class="default">4</span><span class="keyword">));<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagecopyresized</span><span class="keyword">(</span><span class="default">$th_image</span><span class="keyword">, </span><span class="default">$rs_image</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$new_w</span><span class="keyword">, </span><span class="default">$new_h</span><span class="keyword">, </span><span class="default">$rs_w</span><span class="keyword">, </span><span class="default">$rs_h</span><span class="keyword">, </span><span class="default">$rs_w</span><span class="keyword">, </span><span class="default">$rs_h</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// generate thumbnail<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$th_image</span><span class="keyword">, </span><span class="default">$dir</span><span class="keyword">.</span><span class="string">'thumb_'</span><span class="keyword">.</span><span class="default">$img</span><span class="keyword">, </span><span class="default">100</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; } <br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Image type was not jpeg!<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Example:<br />
<br />
<span class="default">&lt;?php<br />
$dir </span><span class="keyword">= </span><span class="string">'./'</span><span class="keyword">;<br />
</span><span class="default">$img </span><span class="keyword">= </span><span class="string">'test.jpg'</span><span class="keyword">;<br />
<br />
</span><span class="default">resizejpeg</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">, </span><span class="default">$img</span><span class="keyword">, </span><span class="default">600</span><span class="keyword">, </span><span class="default">600</span><span class="keyword">, </span><span class="default">300</span><span class="keyword">, </span><span class="default">150</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
The example would resize the image 'test.jpg' into something 600x600 or less (1:1 ratio) and create the file 'thumb_test.jpg' at 300x150.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="64830""></a>
  <div class="note">
   <strong class="user">06madsenl at westseneca dot wnyric dot org</strong>
   <a href="#64830" class="date">21-Apr-2006 06:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I was fiddling with this a few days trying to figure out how to resize the original images on my website, but this site:<br />
<br />
<a href="http://www.sitepoint.com/article/image-resizing-php" rel="nofollow" target="_blank">http://www.sitepoint.com/article/image-resizing-php</a><br />
<br />
Has a great tutorial on using PHP to resize images without creating thumbnails.&nbsp; It was exactly what I was looking to do.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="61962""></a>
  <div class="note">
   <strong class="user">konteineris at yahoo dot com</strong>
   <a href="#61962" class="date">15-Feb-2006 06:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Function creates a thumbnail from the source image, resizes it so that it fits the desired thumb width and height or fills it grabbing maximum image part and resizing it, and lastly writes it to destination<br />
<br />
&lt;?<br />
<br />
function thumb($filename, $destination, $th_width, $th_height, $forcefill)<br />
{&nbsp; &nbsp; <br />
&nbsp;&nbsp; list($width, $height) = getimagesize($filename);<br />
<br />
&nbsp;&nbsp; $source = imagecreatefromjpeg($filename);<br />
<br />
&nbsp;&nbsp; if($width &gt; $th_width || $height &gt; $th_height){<br />
&nbsp;&nbsp; &nbsp;&nbsp; $a = $th_width/$th_height;<br />
&nbsp;&nbsp; &nbsp;&nbsp; $b = $width/$height;<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; if(($a &gt; $b)^$forcefill)<br />
&nbsp;&nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; $src_rect_width&nbsp; = $a * $height;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; $src_rect_height = $height;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; if(!$forcefill)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $src_rect_width = $width;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $th_width = $th_height/$height*$width;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; $src_rect_height = $width/$a;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; $src_rect_width&nbsp; = $width;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; if(!$forcefill)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $src_rect_height = $height;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $th_height = $th_width/$width*$height;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; $src_rect_xoffset = ($width - $src_rect_width)/2*intval($forcefill);<br />
&nbsp;&nbsp; &nbsp;&nbsp; $src_rect_yoffset = ($height - $src_rect_height)/2*intval($forcefill);<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; $thumb&nbsp; = imagecreatetruecolor($th_width, $th_height);<br />
&nbsp;&nbsp; &nbsp;&nbsp; imagecopyresized($thumb, $source, 0, 0, $src_rect_xoffset, $src_rect_yoffset, $th_width, $th_height, $src_rect_width, $src_rect_height);<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; imagejpeg($thumb,$destination);<br />
&nbsp;&nbsp; }<br />
}<br />
<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="57453""></a>
  <div class="note">
   <strong class="user">jesse at method studios</strong>
   <a href="#57453" class="date">04-Oct-2005 12:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
imagecopyresized() does not do any resampling.&nbsp; This makes it extremely quick.&nbsp; If quality is an issue, use imagecopyresampled().</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="55743""></a>
  <div class="note">
   <strong class="user">MaLaZ</strong>
   <a href="#55743" class="date">11-Aug-2005 07:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
simple script for creating thumbnails with process information and saving original ratio thumbnail to new destination...good then useing with upload or uploaded images:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">//Upload------------------------------------<br />
</span><span class="keyword">if(isset( </span><span class="default">$submit </span><span class="keyword">))<br />
{<br />
if (</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'imagefile'</span><span class="keyword">][</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">"image/jpeg"</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">copy </span><span class="keyword">(</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'imagefile'</span><span class="keyword">][</span><span class="string">'tmp_name'</span><span class="keyword">], </span><span class="string">"../images/"</span><span class="keyword">.</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'imagefile'</span><span class="keyword">][</span><span class="string">'name'</span><span class="keyword">])<br />
&nbsp;&nbsp;&nbsp; or die (</span><span class="string">"Could not copy"</span><span class="keyword">); <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Image Name: "</span><span class="keyword">.</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'imagefile'</span><span class="keyword">][</span><span class="string">'name'</span><span class="keyword">].</span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"&lt;br&gt;Image Size: "</span><span class="keyword">.</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'imagefile'</span><span class="keyword">][</span><span class="string">'size'</span><span class="keyword">].</span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"&lt;br&gt;Image Type: "</span><span class="keyword">.</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'imagefile'</span><span class="keyword">][</span><span class="string">'type'</span><span class="keyword">].</span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"&lt;br&gt;Image Copy Done....&lt;br&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"&lt;br&gt;&lt;br&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"bad file type ("</span><span class="keyword">.</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'imagefile'</span><span class="keyword">][</span><span class="string">'name'</span><span class="keyword">].</span><span class="string">")&lt;br&gt;"</span><span class="keyword">;exit;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
</span><span class="comment">//-----upload end<br />
<br />
//------start thumbnailer<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$thumbsize</span><span class="keyword">=</span><span class="default">120</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"Thumbnail Info: &lt;br&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; 1.Thumb defined size: - OK: </span><span class="default">$thumbsize</span><span class="string">&lt;br&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$imgfile </span><span class="keyword">= </span><span class="string">"../images/</span><span class="default">$imagefile_name</span><span class="string">"</span><span class="keyword">;</span><span class="comment">//processed image<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">echo </span><span class="string">"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; 2.Image destination: - OK: </span><span class="default">$imgfile</span><span class="string">&lt;br&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-type: image/jpeg'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; list(</span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">) = </span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$imgfile</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"3.Image size - OK: W=</span><span class="default">$width</span><span class="string"> x H=</span><span class="default">$height</span><span class="string">&lt;br&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$imgratio</span><span class="keyword">=</span><span class="default">$width</span><span class="keyword">/</span><span class="default">$height</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"3.Image ratio - OK: </span><span class="default">$imgratio</span><span class="string">&lt;br&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$imgratio</span><span class="keyword">&gt;</span><span class="default">1</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$newwidth </span><span class="keyword">= </span><span class="default">$thumbsize</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$newheight </span><span class="keyword">= </span><span class="default">$thumbsize</span><span class="keyword">/</span><span class="default">$imgratio</span><span class="keyword">;}<br />
&nbsp;&nbsp;&nbsp; else{<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$newheight </span><span class="keyword">= </span><span class="default">$thumbsize</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$newwidth </span><span class="keyword">= </span><span class="default">$thumbsize</span><span class="keyword">*</span><span class="default">$imgratio</span><span class="keyword">;}<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"4.Thumb new size -OK: W=</span><span class="default">$newwidth</span><span class="string"> x H=</span><span class="default">$newheight</span><span class="string">&lt;br&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$thumb </span><span class="keyword">= </span><span class="default">ImageCreateTrueColor</span><span class="keyword">(</span><span class="default">$newwidth</span><span class="keyword">,</span><span class="default">$newheight</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"5.TrueColor - OK&lt;br&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$source </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$imgfile</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"6.From JPG - OK&lt;br&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagecopyresized</span><span class="keyword">(</span><span class="default">$thumb</span><span class="keyword">, </span><span class="default">$source</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$newwidth</span><span class="keyword">, </span><span class="default">$newheight</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$thumb</span><span class="keyword">,</span><span class="string">"../images/thumbs/thumb_</span><span class="default">$imagefile_name</span><span class="string">"</span><span class="keyword">,</span><span class="default">100</span><span class="keyword">);echo </span><span class="string">"7.Done... - OK&lt;br&gt;"</span><span class="keyword">;<br />
</span><span class="comment">//-----------end--------------&nbsp; &nbsp; <br />
</span><span class="default">?&gt;<br />
</span><br />
or without any info, just resizing:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">//------start thumbnailer<br />
&nbsp;&nbsp; </span><span class="default">$thumbsize</span><span class="keyword">=</span><span class="default">120</span><span class="keyword">;<br />
&nbsp;&nbsp; </span><span class="default">$imgfile </span><span class="keyword">= </span><span class="string">"../images/</span><span class="default">$imagefile_name</span><span class="string">"</span><span class="keyword">;<br />
&nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-type: image/jpeg'</span><span class="keyword">);<br />
&nbsp;&nbsp; list(</span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">) = </span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$imgfile</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">$imgratio</span><span class="keyword">=</span><span class="default">$width</span><span class="keyword">/</span><span class="default">$height</span><span class="keyword">;<br />
&nbsp;&nbsp; if (</span><span class="default">$imgratio</span><span class="keyword">&gt;</span><span class="default">1</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$newwidth </span><span class="keyword">= </span><span class="default">$thumbsize</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$newheight </span><span class="keyword">= </span><span class="default">$thumbsize</span><span class="keyword">/</span><span class="default">$imgratio</span><span class="keyword">;}<br />
&nbsp;&nbsp; else{<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$newheight </span><span class="keyword">= </span><span class="default">$thumbsize</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$newwidth </span><span class="keyword">= </span><span class="default">$thumbsize</span><span class="keyword">*</span><span class="default">$imgratio</span><span class="keyword">;}<br />
&nbsp;&nbsp; </span><span class="default">$thumb </span><span class="keyword">= </span><span class="default">ImageCreateTrueColor</span><span class="keyword">(</span><span class="default">$newwidth</span><span class="keyword">,</span><span class="default">$newheight</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">$source </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$imgfile</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">imagecopyresized</span><span class="keyword">(</span><span class="default">$thumb</span><span class="keyword">, </span><span class="default">$source</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$newwidth</span><span class="keyword">, </span><span class="default">$newheight</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">);<br />
</span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$thumb</span><span class="keyword">,</span><span class="string">"../images/thumbs/thumb_</span><span class="default">$imagefile_name</span><span class="string">"</span><span class="keyword">,</span><span class="default">100</span><span class="keyword">);<br />
</span><span class="comment">//-----------end--------------&nbsp;&nbsp; <br />
</span><span class="default">?&gt;<br />
</span><br />
i hope it helps.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="55692""></a>
  <div class="note">
   <strong class="user">FearINC at gmail dot com</strong>
   <a href="#55692" class="date">10-Aug-2005 10:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I wrote a function not long ago that creates a thumbnail out of a large picture. Unlike other notes on this page, the code is a function so it can be used many times on the same script. The function allows the programer to set max height and width and resizes the picture proportionally.<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">saveThumbnail</span><span class="keyword">(</span><span class="default">$saveToDir</span><span class="keyword">, </span><span class="default">$imagePath</span><span class="keyword">, </span><span class="default">$imageName</span><span class="keyword">, </span><span class="default">$max_x</span><span class="keyword">, </span><span class="default">$max_y</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"'^(.*)\.(gif|jpe?g|png)$'i"</span><span class="keyword">, </span><span class="default">$imageName</span><span class="keyword">, </span><span class="default">$ext</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; switch (</span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">$ext</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'jpg' </span><span class="keyword">: <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'jpeg'</span><span class="keyword">: </span><span class="default">$im&nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg </span><span class="keyword">(</span><span class="default">$imagePath</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'gif' </span><span class="keyword">: </span><span class="default">$im&nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">imagecreatefromgif&nbsp; </span><span class="keyword">(</span><span class="default">$imagePath</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'png' </span><span class="keyword">: </span><span class="default">$im&nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">imagecreatefrompng&nbsp; </span><span class="keyword">(</span><span class="default">$imagePath</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; default&nbsp; &nbsp; : </span><span class="default">$stop </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; if (!isset(</span><span class="default">$stop</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$x </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$y </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ((</span><span class="default">$max_x</span><span class="keyword">/</span><span class="default">$max_y</span><span class="keyword">) &lt; (</span><span class="default">$x</span><span class="keyword">/</span><span class="default">$y</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$save </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">/(</span><span class="default">$x</span><span class="keyword">/</span><span class="default">$max_x</span><span class="keyword">), </span><span class="default">$y</span><span class="keyword">/(</span><span class="default">$x</span><span class="keyword">/</span><span class="default">$max_x</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$save </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">/(</span><span class="default">$y</span><span class="keyword">/</span><span class="default">$max_y</span><span class="keyword">), </span><span class="default">$y</span><span class="keyword">/(</span><span class="default">$y</span><span class="keyword">/</span><span class="default">$max_y</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagecopyresized</span><span class="keyword">(</span><span class="default">$save</span><span class="keyword">, </span><span class="default">$im</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$save</span><span class="keyword">), </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$save</span><span class="keyword">), </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagegif</span><span class="keyword">(</span><span class="default">$save</span><span class="keyword">, </span><span class="string">"</span><span class="keyword">{</span><span class="default">$saveToDir</span><span class="keyword">}{</span><span class="default">$ext</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]}</span><span class="string">.gif"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$save</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
the function for now takes only jpg,gif and png files, but that can easily be changed.<br />
It's an easy to use easy to understand function and I hope it will come useful to someone.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="55570""></a>
  <div class="note">
   <strong class="user">mecdesign at hotmail dot com</strong>
   <a href="#55570" class="date">07-Aug-2005 02:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This code will resize your images if your image needs to fit (without stretching) into a max height / width destination image that is not a 1:1 ratio (mine was 4:3).<br />
<br />
&lt;?<br />
&nbsp;&nbsp; // Ratios<br />
&nbsp;&nbsp; $image_ratio = $width / $height; // Actual image's ratio<br />
&nbsp;&nbsp; $destination_ratio = $max_width / $max_height; // Ratio of dest. placeholder<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; // Taller<br />
&nbsp;&nbsp;&nbsp; if($image_ratio &lt; $destination_ratio)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; //Too tall:<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if($height &gt; $max_height)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $height = $max_height;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $width = ceil($height / $image_ratio);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; // Wider / balanced &amp; too wide:<br />
&nbsp;&nbsp;&nbsp; else if ($width &gt; $max_width)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $width = $max_width;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $height = ceil($width / $image_ratio);<br />
&nbsp;&nbsp;&nbsp; }<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="53760""></a>
  <div class="note">
   <strong class="user">brian &lt;dot&gt; tyler &lt;at&gt; gmail &lt;dot&gt; com</strong>
   <a href="#53760" class="date">12-Jun-2005 03:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I spent last night getting unsuccessful results from this function until I found this note of fluffle &lt;&lt;at&gt;&gt; gmail on the imagecopyresampled page, I have made a slight modification, so you can just cut and paste.<br />
<br />
Just to clarify that src_w and src_h do not necessarily need to be the source image width and height, as they specify the size of the rectangle cropped from the source picture, with its top left corner situated at (src_x, src_y).<br />
<br />
For example, the code below crops a jpeg image to be square, with the square situated in the centre of the original image, and then resizes it to a 100x100 thumbnail.<br />
<br />
function ($image_filename, $thumb_location, $image_thumb_size){<br />
//@$image_filename - the filename of the image you want<br />
//to get a thumbnail for (relative to location of this<br />
//function).<br />
//@$thumb_location - the url (relative to location of this<br />
//function) to save the thumbnail.<br />
//@$image_thumb_size - the x-y dimension of your thumb<br />
//in pixels.<br />
<br />
&nbsp;&nbsp; list($ow, $oh) = getimagesize($image_filename);<br />
&nbsp;&nbsp; $image_original = imagecreatefromjpeg($image_filename);<br />
&nbsp;&nbsp; $image_thumb = imagecreatetruecolor($image_thumb_size,$image_thumb_size);<br />
if ($ow &gt; $oh) {<br />
&nbsp;&nbsp; $off_w = ($ow-$oh)/2;<br />
&nbsp;&nbsp; $off_h = 0;<br />
&nbsp;&nbsp; $ow = $oh;<br />
} elseif ($oh &gt; $ow) {<br />
&nbsp;&nbsp; $off_w = 0;<br />
&nbsp;&nbsp; $off_h = ($oh-$ow)/2;<br />
&nbsp;&nbsp; $oh = $ow;<br />
} else {<br />
&nbsp;&nbsp; $off_w = 0;<br />
&nbsp;&nbsp; $off_h = 0;<br />
}<br />
imagecopyresampled($image_thumb, $image_original, 0, 0, $off_w, $off_h, 100, 100, $ow, $oh);<br />
<br />
imagejpeg($image_thumb, $thumb_location);<br />
}//end function</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="52939""></a>
  <div class="note">
   <strong class="user">no at name dot com</strong>
   <a href="#52939" class="date">18-May-2005 04:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I was searching for script, that do not resize on the fly, but copy resized file to other place, so after long searches, i've done this function. I hope it will be usefull for someone:<br />
(This is not original code, i'v taked it from somwhere and edited a ltl :)<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">resize</span><span class="keyword">(</span><span class="default">$cur_dir</span><span class="keyword">, </span><span class="default">$cur_file</span><span class="keyword">, </span><span class="default">$newwidth</span><span class="keyword">, </span><span class="default">$output_dir</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$dir_name </span><span class="keyword">= </span><span class="default">$cur_dir</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$olddir </span><span class="keyword">= </span><span class="default">getcwd</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$dir </span><span class="keyword">= </span><span class="default">opendir</span><span class="keyword">(</span><span class="default">$dir_name</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$filename </span><span class="keyword">= </span><span class="default">$cur_file</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$format</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/.jpg/i"</span><span class="keyword">, </span><span class="string">"</span><span class="default">$filename</span><span class="string">"</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$format </span><span class="keyword">= </span><span class="string">'image/jpeg'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/.gif/i"</span><span class="keyword">, </span><span class="string">"</span><span class="default">$filename</span><span class="string">"</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$format </span><span class="keyword">= </span><span class="string">'image/gif'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/.png/i"</span><span class="keyword">, </span><span class="string">"</span><span class="default">$filename</span><span class="string">"</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$format </span><span class="keyword">= </span><span class="string">'image/png'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$format</span><span class="keyword">!=</span><span class="string">''</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; list(</span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">) = </span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$newheight</span><span class="keyword">=</span><span class="default">$height</span><span class="keyword">*</span><span class="default">$newwidth</span><span class="keyword">/</span><span class="default">$width</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; switch(</span><span class="default">$format</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'image/jpeg'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$source </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'image/gif'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$source </span><span class="keyword">= </span><span class="default">imagecreatefromgif</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'image/png'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$source </span><span class="keyword">= </span><span class="default">imagecreatefrompng</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$thumb </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$newwidth</span><span class="keyword">,</span><span class="default">$newheight</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagealphablending</span><span class="keyword">(</span><span class="default">$thumb</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$source </span><span class="keyword">= @</span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="string">"</span><span class="default">$filename</span><span class="string">"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagecopyresized</span><span class="keyword">(</span><span class="default">$thumb</span><span class="keyword">, </span><span class="default">$source</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$newwidth</span><span class="keyword">, </span><span class="default">$newheight</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$filename</span><span class="keyword">=</span><span class="string">"</span><span class="default">$output_dir</span><span class="string">/</span><span class="default">$filename</span><span class="string">"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; @</span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$thumb</span><span class="keyword">, </span><span class="default">$filename</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;<br />
</span>call this function using <br />
&lt;?<br />
resize("./input folder", "picture_file_name", "width", "./output folder");<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="52541""></a>
  <div class="note">
   <strong class="user">del at kartoon dot net</strong>
   <a href="#52541" class="date">05-May-2005 01:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This snippet allows you to grab a thumbnail from the center of a large image.&nbsp; This was used for a client photo gallery for art to give a teaser of the image to come (only a small portion).&nbsp; You could get dynamic with this value.&nbsp; I also put in a scaling factor in case you want to scale down first before chopping.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// The file<br />
</span><span class="default">$filename </span><span class="keyword">= </span><span class="string">'moon.jpg'</span><span class="keyword">;<br />
</span><span class="default">$percent </span><span class="keyword">= </span><span class="default">1.0</span><span class="keyword">; </span><span class="comment">// if you want to scale down first<br />
</span><span class="default">$imagethumbsize </span><span class="keyword">= </span><span class="default">200</span><span class="keyword">; </span><span class="comment">// thumbnail size (area cropped in middle of image)<br />
// Content type<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-type: image/jpeg'</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Get new dimensions<br />
</span><span class="keyword">list(</span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">) = </span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">);<br />
</span><span class="default">$new_width </span><span class="keyword">= </span><span class="default">$width </span><span class="keyword">* </span><span class="default">$percent</span><span class="keyword">;<br />
</span><span class="default">$new_height </span><span class="keyword">= </span><span class="default">$height </span><span class="keyword">* </span><span class="default">$percent</span><span class="keyword">;<br />
<br />
</span><span class="comment">// Resample<br />
</span><span class="default">$image_p </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$imagethumbsize </span><span class="keyword">, </span><span class="default">$imagethumbsize</span><span class="keyword">);&nbsp; </span><span class="comment">// true color for best quality<br />
</span><span class="default">$image </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">);<br />
<br />
</span><span class="comment">// basically take this line and put in your versin the -($new_width/2) + ($imagethumbsize/2) &amp; -($new_height/2) + ($imagethumbsize/2) for<br />
// the 2/3 position in the 3 and 4 place for imagecopyresampled<br />
// -($new_width/2) + ($imagethumbsize/2)<br />
// AND<br />
// -($new_height/2) + ($imagethumbsize/2)<br />
// are the trick<br />
</span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$image_p</span><span class="keyword">, </span><span class="default">$image</span><span class="keyword">, -(</span><span class="default">$new_width</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">) + (</span><span class="default">$imagethumbsize</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">), -(</span><span class="default">$new_height</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">) + (</span><span class="default">$imagethumbsize</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">), </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$new_width </span><span class="keyword">, </span><span class="default">$new_width </span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Output<br />
<br />
</span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$image_p</span><span class="keyword">, </span><span class="default">null</span><span class="keyword">, </span><span class="default">100</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="52239""></a>
  <div class="note">
   <strong class="user">development at lab-9 dot com</strong>
   <a href="#52239" class="date">25-Apr-2005 03:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you read your Imagedata from a Database Blob and use the functions from above to resize the image to a thumbnail improving a lot of traffic, you will have to make temporary copies of the files in order that the functions can access them<br />
<br />
Here a example:<br />
<br />
// switch through imagetypes<br />
$extension = "jpg";<br />
if(mysql_result($query, 0, 'type') == "image/pjpeg")<br />
{ $extension = "jpg"; } // overwrite<br />
else if(mysql_result($query, 0, 'type') == "image/gif")<br />
{ $extension = "gif"; } // overwrite<br />
<br />
// get a temporary filename<br />
// use microtime() to get a unique filename<br />
// if you request more than one file f.e. by creating large numbers of thumbnails, the server could be not fast enough to save all these different files and you get duplicated copies and resizepics() will resize and output often the same content<br />
<br />
$filename = microtime()."_temp.".$extension;<br />
<br />
// open<br />
$tempfile = fopen($filename, "w+");<br />
<br />
// write<br />
fwrite($tempfile, mysql_result($query, 0, 'image'));<br />
<br />
// close<br />
fclose($tempfile);<br />
<br />
// resize and output the content<br />
echo resizepics($filename, '100', '70');<br />
<br />
// delete temporary file<br />
unlink($filename);<br />
<br />
NOTE: this script has to be put into a file which sends correct header informations to the browser, otherwise you won't get more to see than a big red cross :-)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="50432""></a>
  <div class="note">
   <strong class="user">robby at planetargon dot com</strong>
   <a href="#50432" class="date">28-Feb-2005 07:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Most of the examples below don't keep the proportions properly. They keep using if/else for the height/width..and forgetting that you might have a max height AND a max width, not one or the other.<br />
<br />
/**<br />
* Resize an image and keep the proportions<br />
* @author Allison Beckwith &lt;allison@planetargon.com&gt;<br />
* @param string $filename<br />
* @param integer $max_width<br />
* @param integer $max_height<br />
* @return image<br />
*/<br />
function resizeImage($filename, $max_width, $max_height)<br />
{<br />
&nbsp;&nbsp;&nbsp; list($orig_width, $orig_height) = getimagesize($filename);<br />
<br />
&nbsp;&nbsp;&nbsp; $width = $orig_width;<br />
&nbsp;&nbsp;&nbsp; $height = $orig_height;<br />
<br />
&nbsp;&nbsp;&nbsp; # taller<br />
&nbsp;&nbsp;&nbsp; if ($height &gt; $max_height) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $width = ($max_height / $height) * $width;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $height = $max_height;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; # wider<br />
&nbsp;&nbsp;&nbsp; if ($width &gt; $max_width) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $height = ($max_width / $width) * $height;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $width = $max_width;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; $image_p = imagecreatetruecolor($width, $height);<br />
<br />
&nbsp;&nbsp;&nbsp; $image = imagecreatefromjpeg($filename);<br />
<br />
&nbsp;&nbsp;&nbsp; imagecopyresampled($image_p, $image, 0, 0, 0, 0, <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $width, $height, $orig_width, $orig_height);<br />
<br />
&nbsp;&nbsp;&nbsp; return $image_p;<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="50399""></a>
  <div class="note">
   <strong class="user">haker4o at haker4o dot org</strong>
   <a href="#50399" class="date">26-Feb-2005 08:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
</span><span class="comment">//&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Resize image.<br />
//&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Writeen By: Smelban &amp; Haker4o <br />
// Mails smelban@smwebdesigns.com &amp; Haker4o@Haker4o.org <br />
// This code is written to only execute on&nbsp; jpg,gif,png&nbsp; &nbsp; &nbsp; <br />
// $picname = resizepics('pics', 'new widthmax', 'new heightmax');<br />
// Demo&nbsp; $picname = resizepics('stihche.jpg', '180', '140');<br />
</span><span class="default">$picname </span><span class="keyword">= </span><span class="default">resizepics</span><span class="keyword">(</span><span class="string">'picture-name.format'</span><span class="keyword">, </span><span class="string">'180'</span><span class="keyword">, </span><span class="string">'140'</span><span class="keyword">);<br />
echo </span><span class="default">$pickname</span><span class="keyword">;<br />
</span><span class="comment">//Error<br />
</span><span class="keyword">die( </span><span class="string">"&lt;font color=\"#FF0066\"&gt;&lt;center&gt;&lt;b&gt;File not exists :(&lt;b&gt;&lt;/center&gt;&lt;/FONT&gt;"</span><span class="keyword">);<br />
</span><span class="comment">//Funcion resizepics<br />
</span><span class="keyword">function </span><span class="default">resizepics</span><span class="keyword">(</span><span class="default">$pics</span><span class="keyword">, </span><span class="default">$newwidth</span><span class="keyword">, </span><span class="default">$newheight</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; if(</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/.jpg/i"</span><span class="keyword">, </span><span class="string">"</span><span class="default">$pics</span><span class="string">"</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-type: image/jpeg'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; if (</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/.gif/i"</span><span class="keyword">, </span><span class="string">"</span><span class="default">$pics</span><span class="string">"</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-type: image/gif'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; } <br />
&nbsp;&nbsp; &nbsp; list(</span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">) = </span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$pics</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; if(</span><span class="default">$width </span><span class="keyword">&gt; </span><span class="default">$height </span><span class="keyword">&amp;&amp; </span><span class="default">$newheight </span><span class="keyword">&lt; </span><span class="default">$height</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$newheight </span><span class="keyword">= </span><span class="default">$height </span><span class="keyword">/ (</span><span class="default">$width </span><span class="keyword">/ </span><span class="default">$newwidth</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; } else if (</span><span class="default">$width </span><span class="keyword">&lt; </span><span class="default">$height </span><span class="keyword">&amp;&amp; </span><span class="default">$newwidth </span><span class="keyword">&lt; </span><span class="default">$width</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$newwidth </span><span class="keyword">= </span><span class="default">$width </span><span class="keyword">/ (</span><span class="default">$height </span><span class="keyword">/ </span><span class="default">$newheight</span><span class="keyword">);&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$newwidth </span><span class="keyword">= </span><span class="default">$width</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$newheight </span><span class="keyword">= </span><span class="default">$height</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/.jpg/i"</span><span class="keyword">, </span><span class="string">"</span><span class="default">$pics</span><span class="string">"</span><span class="keyword">)){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$source </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$pics</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/.jpeg/i"</span><span class="keyword">, </span><span class="string">"</span><span class="default">$pics</span><span class="string">"</span><span class="keyword">)){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$source </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$pics</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/.jpeg/i"</span><span class="keyword">, </span><span class="string">"</span><span class="default">$pics</span><span class="string">"</span><span class="keyword">)){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$source </span><span class="keyword">= </span><span class="default">Imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$pics</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/.png/i"</span><span class="keyword">, </span><span class="string">"</span><span class="default">$pics</span><span class="string">"</span><span class="keyword">)){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$source </span><span class="keyword">= </span><span class="default">imagecreatefrompng</span><span class="keyword">(</span><span class="default">$pics</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/.gif/i"</span><span class="keyword">, </span><span class="string">"</span><span class="default">$pics</span><span class="string">"</span><span class="keyword">)){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$source </span><span class="keyword">= </span><span class="default">imagecreatefromgif</span><span class="keyword">(</span><span class="default">$pics</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$thumb </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$newwidth</span><span class="keyword">, </span><span class="default">$newheight</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagecopyresized</span><span class="keyword">(</span><span class="default">$thumb</span><span class="keyword">, </span><span class="default">$source</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$newwidth</span><span class="keyword">, </span><span class="default">$newheight</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$thumb</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/.jpg/i"</span><span class="keyword">, </span><span class="string">"</span><span class="default">$pics</span><span class="string">"</span><span class="keyword">)){<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$thumb</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/.jpeg/i"</span><span class="keyword">, </span><span class="string">"</span><span class="default">$pics</span><span class="string">"</span><span class="keyword">)){<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$thumb</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/.jpeg/i"</span><span class="keyword">, </span><span class="string">"</span><span class="default">$pics</span><span class="string">"</span><span class="keyword">)){<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$thumb</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/.png/i"</span><span class="keyword">, </span><span class="string">"</span><span class="default">$pics</span><span class="string">"</span><span class="keyword">)){<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">imagepng</span><span class="keyword">(</span><span class="default">$thumb</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/.gif/i"</span><span class="keyword">, </span><span class="string">"</span><span class="default">$pics</span><span class="string">"</span><span class="keyword">)){<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">imagegif</span><span class="keyword">(</span><span class="default">$thumb</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="50019""></a>
  <div class="note">
   <strong class="user">smelban at smwebdesigns dot com</strong>
   <a href="#50019" class="date">15-Feb-2005 08:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Resize image proportionaly where you give a max width or max height<br />
<br />
<span class="default">&lt;?php<br />
header</span><span class="keyword">(</span><span class="string">'Content-type: image/jpeg'</span><span class="keyword">);<br />
</span><span class="comment">//$myimage = resizeImage('filename', 'newwidthmax', 'newheightmax');<br />
</span><span class="default">$myimage </span><span class="keyword">= </span><span class="default">resizeImage</span><span class="keyword">(</span><span class="string">'test.jpg'</span><span class="keyword">, </span><span class="string">'150'</span><span class="keyword">, </span><span class="string">'120'</span><span class="keyword">);<br />
print </span><span class="default">$myimage</span><span class="keyword">;<br />
<br />
function </span><span class="default">resizeImage</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">, </span><span class="default">$newwidth</span><span class="keyword">, </span><span class="default">$newheight</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; list(</span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">) = </span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$width </span><span class="keyword">&gt; </span><span class="default">$height </span><span class="keyword">&amp;&amp; </span><span class="default">$newheight </span><span class="keyword">&lt; </span><span class="default">$height</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$newheight </span><span class="keyword">= </span><span class="default">$height </span><span class="keyword">/ (</span><span class="default">$width </span><span class="keyword">/ </span><span class="default">$newwidth</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; } else if (</span><span class="default">$width </span><span class="keyword">&lt; </span><span class="default">$height </span><span class="keyword">&amp;&amp; </span><span class="default">$newwidth </span><span class="keyword">&lt; </span><span class="default">$width</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$newwidth </span><span class="keyword">= </span><span class="default">$width </span><span class="keyword">/ (</span><span class="default">$height </span><span class="keyword">/ </span><span class="default">$newheight</span><span class="keyword">);&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$newwidth </span><span class="keyword">= </span><span class="default">$width</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$newheight </span><span class="keyword">= </span><span class="default">$height</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$thumb </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$newwidth</span><span class="keyword">, </span><span class="default">$newheight</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$source </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagecopyresized</span><span class="keyword">(</span><span class="default">$thumb</span><span class="keyword">, </span><span class="default">$source</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$newwidth</span><span class="keyword">, </span><span class="default">$newheight</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$thumb</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="49948""></a>
  <div class="note">
   <strong class="user">finnsi at centrum dot is</strong>
   <a href="#49948" class="date">13-Feb-2005 05:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you need to delete or resize images in the filesystem (not in DB) without loosing the image quality...<br />
I commented the code as much as possible so that newbies (like myself) will understand it.&nbsp; ;)<br />
<br />
<span class="default">&lt;?php <br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/* <br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; WRITTEN BY:<br />
&nbsp;&nbsp;&nbsp; Finnur Eiriksson, (<a href="http://www.centrum.is/finnsi" rel="nofollow" target="_blank">http://www.centrum.is/finnsi</a>)<br />
&nbsp;&nbsp;&nbsp; Based on snippets that have been posted on www.PHP.net<br />
&nbsp;&nbsp;&nbsp; Drop me an e-mail if you have any questions.<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; NOTE:<br />
&nbsp;&nbsp;&nbsp; This code is written to either delete or resize pictures in the file system, so if you have your pictures in a database<br />
&nbsp;&nbsp;&nbsp; you will have to make some changes. Also, if you are using other picture formats than .gif's or .jpg's you<br />
&nbsp;&nbsp;&nbsp; will have to add som code as well (Read the comments to find out where to do this).<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; IMPORTANT:&nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; The $_GET['resizepic'] variable only contains the NAME of the file that is going to be deleted/resized. <br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; The internet guest account (IUSR_SERVERNAME on WINDOWS) must have read and write permissions (execution permission not needed) <br />
&nbsp;&nbsp;&nbsp; in your image directory (i.e. $dir_name = "FooBar"). It is a good idea to have a separate directory for images that users <br />
&nbsp;&nbsp;&nbsp; can upload to and manipulate the contents. Ideally, you should have one directory for the pictures that are used for the website,<br />
&nbsp;&nbsp;&nbsp; and another upload directory <br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; */<br />
&nbsp;&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$dir_name </span><span class="keyword">= </span><span class="string">"FooBar"</span><span class="keyword">;&nbsp; </span><span class="comment">// Enter the name of the directory that contains the images<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$olddir </span><span class="keyword">= </span><span class="default">getcwd</span><span class="keyword">();&nbsp; </span><span class="comment">// Get the Current Windows Directory to be able to switch back in the end of the script<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$dir </span><span class="keyword">= </span><span class="default">opendir</span><span class="keyword">(</span><span class="default">$dir_name</span><span class="keyword">); </span><span class="comment">//make a directory handle<br />
&nbsp;&nbsp;&nbsp; //To delete a picture<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if(isset(</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'delpic'</span><span class="keyword">])){ <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">chdir</span><span class="keyword">(</span><span class="string">'images'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$delpic </span><span class="keyword">= </span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'delpic'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; @</span><span class="default">unlink</span><span class="keyword">(</span><span class="default">$delpic</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">chdir</span><span class="keyword">(</span><span class="default">$olddir</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//To resize a picture<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if(isset(</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'resize'</span><span class="keyword">])){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//$_GET['resize'] contains the resize-percentage (for example 80 and 40, for 80% and 40% respectively. To double the image in size the user enters 200 etc.)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // File and new size<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$percent </span><span class="keyword">= (</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'resize'</span><span class="keyword">]/</span><span class="default">100</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">chdir</span><span class="keyword">(</span><span class="string">'images'</span><span class="keyword">);</span><span class="comment">// change the windows directory to the image directory<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$filename </span><span class="keyword">= </span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'resizepic'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Decide the content type, NB:This code is written to only execute on .gif's and .jpg's<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // If you want other formats than .gif's and .jpg's add your code here, in the same manner:<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$format</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/.jpg/i"</span><span class="keyword">, </span><span class="string">"</span><span class="default">$filename</span><span class="string">"</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$format </span><span class="keyword">= </span><span class="string">'image/jpeg'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-type: image/jpeg'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/.gif/i"</span><span class="keyword">, </span><span class="string">"</span><span class="default">$filename</span><span class="string">"</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$format </span><span class="keyword">= </span><span class="string">'image/gif'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-type: image/gif'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$format</span><span class="keyword">!=</span><span class="string">''</span><span class="keyword">){&nbsp; </span><span class="comment">//This is where the actual resize process begins...<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // Get new sizes<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">list(</span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">) = </span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$newwidth </span><span class="keyword">= </span><span class="default">$width </span><span class="keyword">* </span><span class="default">$percent</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$newheight </span><span class="keyword">= </span><span class="default">$height </span><span class="keyword">* </span><span class="default">$percent</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Load the image<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">switch(</span><span class="default">$format</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'image/jpeg'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$source </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'image/gif'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$source </span><span class="keyword">= </span><span class="default">imagecreatefromgif</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//Get the Image<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$thumb </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$newwidth</span><span class="keyword">,</span><span class="default">$newheight</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//This must be set to false in order to be able to overwrite the black <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //pixels in the background with transparent pixels. Otherwise the new <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //pixels would just be applied on top of the black background.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagealphablending</span><span class="keyword">(</span><span class="default">$thumb</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//Make a temporary file handle<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$source </span><span class="keyword">= @</span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Resize<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagecopyresized</span><span class="keyword">(</span><span class="default">$thumb</span><span class="keyword">, </span><span class="default">$source</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$newwidth</span><span class="keyword">, </span><span class="default">$newheight</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//Write the image to the destination file<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">@</span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$thumb</span><span class="keyword">, </span><span class="default">$filename</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//Change back to the old directory... I'm not sure that this is neccessary<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">chdir</span><span class="keyword">(</span><span class="default">$olddir</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//Specify where you want the user to go after the operation:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Location: foobar.php'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="48632""></a>
  <div class="note">
   <strong class="user">marcy DOT xxx (AT) gmail.com</strong>
   <a href="#48632" class="date">02-Jan-2005 11:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This example allow to use every kind of image and to resize images with ImageCopyResized(), maintaining proportions..<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// switch to find the correct type of function<br />
<br />
</span><span class="default">$imgfile </span><span class="keyword">= </span><span class="string">'namefile.jpg'</span><span class="keyword">;<br />
</span><span class="default">Header</span><span class="keyword">(</span><span class="string">"Content-type: image/"</span><span class="keyword">.</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">"type"</span><span class="keyword">]);<br />
<br />
switch(</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">"type"</span><span class="keyword">]){<br />
default:<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$function_image_create </span><span class="keyword">= </span><span class="string">"ImageCreateFromJpeg"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$function_image_new </span><span class="keyword">= </span><span class="string">"ImageJpeg"</span><span class="keyword">;<br />
break;<br />
case </span><span class="string">"jpg"</span><span class="keyword">:<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$function_image_create </span><span class="keyword">= </span><span class="string">"ImageCreateFromJpeg"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$function_image_new </span><span class="keyword">= </span><span class="string">"ImageJpeg"</span><span class="keyword">;<br />
case </span><span class="string">"jpeg"</span><span class="keyword">:<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$function_image_create </span><span class="keyword">= </span><span class="string">"ImageCreateFromJpeg"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$function_image_new </span><span class="keyword">= </span><span class="string">"ImageJpeg"</span><span class="keyword">;<br />
break;<br />
case </span><span class="string">"png"</span><span class="keyword">:<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$function_image_create </span><span class="keyword">= </span><span class="string">"ImageCreateFromPng"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$function_image_new </span><span class="keyword">= </span><span class="string">"ImagePNG"</span><span class="keyword">;<br />
break;<br />
case </span><span class="string">"gif"</span><span class="keyword">:<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$function_image_create </span><span class="keyword">= </span><span class="string">"ImageCreateFromGif"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$function_image_new </span><span class="keyword">= </span><span class="string">"ImagePNG"</span><span class="keyword">;<br />
break;<br />
}<br />
<br />
list(</span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">) = </span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$imgfile</span><span class="keyword">);<br />
<br />
</span><span class="comment">// the new weight of the thumb<br />
<br />
</span><span class="default">$newheight </span><span class="keyword">= </span><span class="default">80</span><span class="keyword">;<br />
<br />
</span><span class="comment">// Proportion is maintained<br />
<br />
</span><span class="default">$newwidth </span><span class="keyword">= (int) ((</span><span class="default">$width</span><span class="keyword">*</span><span class="default">80</span><span class="keyword">)/</span><span class="default">$height</span><span class="keyword">);<br />
<br />
</span><span class="default">$thumb </span><span class="keyword">= </span><span class="default">ImageCreateTrueColor</span><span class="keyword">(</span><span class="default">$newwidth</span><span class="keyword">,</span><span class="default">$newheight</span><span class="keyword">);<br />
</span><span class="default">$source </span><span class="keyword">= @</span><span class="default">function_image_create</span><span class="keyword">(</span><span class="default">$imgfile</span><span class="keyword">);<br />
<br />
</span><span class="default">ImageCopyResized</span><span class="keyword">(</span><span class="default">$thumb</span><span class="keyword">, </span><span class="default">$source</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$newwidth</span><span class="keyword">, </span><span class="default">$newheight</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">);<br />
<br />
@</span><span class="default">$function_image_new</span><span class="keyword">(</span><span class="default">$thumb</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="48155""></a>
  <div class="note">
   <strong class="user">backglancer at hotmail</strong>
   <a href="#48155" class="date">13-Dec-2004 07:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Neat script to create a thumbnails no larger than 150 (or user-specific) height AND width.<br />
<br />
<span class="default">&lt;?PHP<br />
$picture </span><span class="keyword">=</span><span class="string">"" </span><span class="comment"># picture fileNAME here. not address<br />
</span><span class="default">$max</span><span class="keyword">=</span><span class="default">150</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment"># maximum size of 1 side of the picture.<br />
/*<br />
here you can insert any specific "if-else",<br />
or "switch" type of detector of what type of picture this is.<br />
in this example i'll use standard JPG<br />
*/<br />
<br />
</span><span class="default">$src_img</span><span class="keyword">=</span><span class="default">ImagecreateFromJpeg</span><span class="keyword">(</span><span class="default">$picture</span><span class="keyword">);<br />
<br />
</span><span class="default">$oh </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">);&nbsp; </span><span class="comment"># original height<br />
</span><span class="default">$ow </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">);&nbsp; </span><span class="comment"># original width<br />
<br />
</span><span class="default">$new_h </span><span class="keyword">= </span><span class="default">$oh</span><span class="keyword">;<br />
</span><span class="default">$new_w </span><span class="keyword">= </span><span class="default">$ow</span><span class="keyword">;<br />
<br />
if(</span><span class="default">$oh </span><span class="keyword">&gt; </span><span class="default">$max </span><span class="keyword">|| </span><span class="default">$ow </span><span class="keyword">&gt; </span><span class="default">$max</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$r </span><span class="keyword">= </span><span class="default">$oh</span><span class="keyword">/</span><span class="default">$ow</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_h </span><span class="keyword">= (</span><span class="default">$oh </span><span class="keyword">&gt; </span><span class="default">$ow</span><span class="keyword">) ? </span><span class="default">$max </span><span class="keyword">: </span><span class="default">$max</span><span class="keyword">*</span><span class="default">$r</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_w </span><span class="keyword">= </span><span class="default">$new_h</span><span class="keyword">/</span><span class="default">$r</span><span class="keyword">;<br />
}<br />
</span><span class="comment">// note TrueColor does 256 and not.. 8<br />
</span><span class="default">$dst_img </span><span class="keyword">= </span><span class="default">ImageCreateTrueColor</span><span class="keyword">(</span><span class="default">$new_w</span><span class="keyword">,</span><span class="default">$new_h</span><span class="keyword">);<br />
<br />
</span><span class="default">ImageCopyResized</span><span class="keyword">(</span><span class="default">$dst_img</span><span class="keyword">, </span><span class="default">$src_img</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">, </span><span class="default">$new_w</span><span class="keyword">, </span><span class="default">$new_h</span><span class="keyword">, </span><span class="default">ImageSX</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">), </span><span class="default">ImageSY</span><span class="keyword">(</span><span class="default">$src_img</span><span class="keyword">));<br />
<br />
</span><span class="default">ImageJpeg</span><span class="keyword">(</span><span class="default">$dst_img</span><span class="keyword">, </span><span class="string">"th_</span><span class="default">$picture</span><span class="string">"</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="9855""></a>
  <div class="note">
   <strong class="user">skurrilo at skurrilo dot de</strong>
   <a href="#9855" class="date">28-Nov-2000 07:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you aren't happy with the quality of the resized images, just give ImageMagick a try. (<a href="http://www.imagemagick.org" rel="nofollow" target="_blank">http://www.imagemagick.org</a>) This is a commandline tool for converting and viewing images.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
