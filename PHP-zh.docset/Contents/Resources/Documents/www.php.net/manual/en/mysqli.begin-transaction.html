<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>Starts a transaction</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="mysqli.autocommit.html">? mysqli::autocommit</a></li>
      <li style="float: right;"><a href="mysqli.change-user.html">mysqli::change_user ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="class.mysqli.html">MySQLi</a></li>
    <li>Starts a transaction</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="mysqli.begin-transaction" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">mysqli::begin_transaction</h1>
  <h1 class="refname">mysqli_begin_transaction</h1>
  <p class="verinfo">(PHP 5 &gt;= 5.5.0, PHP 7)</p><p class="refpurpose"><span class="refname">mysqli::begin_transaction</span> -- <span class="refname">mysqli_begin_transaction</span> &mdash; <span class="dc-title">Starts a transaction</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-mysqli.begin-transaction-description">
  <h3 class="title">说明</h3>
  <p class="para">面向对象风格 (method):</p>
   <div class="methodsynopsis dc-description">
   <span class="modifier">public</span> <span class="methodname"><strong>mysqli::begin_transaction</strong></span>
    ([ <span class="methodparam"><span class="type">int</span> <code class="parameter">$flags</code><span class="initializer"> = 0</span></span>
   [, <span class="methodparam"><span class="type">string</span> <code class="parameter">$name</code></span>
   ]] ) : <span class="type">bool</span></div>

  <p class="para rdfs-comment">过程化风格:</p>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>mysqli_begin_transaction</strong></span>
    ( <span class="methodparam"><span class="type"><a href="class.mysqli.html" class="type mysqli">mysqli</a></span> <code class="parameter">$link</code></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$flags</code><span class="initializer"> = 0</span></span>
   [, <span class="methodparam"><span class="type">string</span> <code class="parameter">$name</code></span>
  ]] ) : <span class="type">bool</span></div>

  <p class="para rdfs-comment">
   Begins a transaction. Requires the InnoDB 
   engine (it is enabled by default). For additional details about how MySQL transactions
   work, see <a href="http://dev.mysql.com/doc/mysql/en/commit.html" class="link external" title="Link : http://dev.mysql.com/doc/mysql/en/commit.html">&raquo;&nbsp;http://dev.mysql.com/doc/mysql/en/commit.html</a>.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-mysqli.begin-transaction-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>

    <dt>
<code class="parameter">
link</code></dt>
<dd>
<p class="para">仅以过程化样式：由<span class="function"><a href="function.mysqli-connect.html" class="function">mysqli_connect()</a></span> 或 <span class="function"><a href="mysqli.init.html" class="function">mysqli_init()</a></span>
返回的链接标识。</p></dd>

    
     <dt>
<code class="parameter">flags</code></dt>

     <dd>

      <p class="para">
       Valid flags are:
      </p>
      <ul class="itemizedlist">
       <li class="listitem">
        <p class="para">
         <strong><code>MYSQLI_TRANS_START_READ_ONLY</code></strong>: 
         Start the transaction as &quot;START TRANSACTION READ ONLY&quot;.
         Requires MySQL 5.6 and above.
        </p>
       </li>
       <li class="listitem">
        <p class="para">
         <strong><code>MYSQLI_TRANS_START_READ_WRITE</code></strong>: 
         Start the transaction as &quot;START TRANSACTION READ WRITE&quot;.
         Requires MySQL 5.6 and above.
        </p>
       </li>
       <li class="listitem">
         <p class="para">
         <strong><code>MYSQLI_TRANS_START_WITH_CONSISTENT_SNAPSHOT</code></strong>: 
         Start the transaction as &quot;START TRANSACTION WITH CONSISTENT SNAPSHOT&quot;.
        </p>
       </li>
      </ul>
     </dd>

    
    
     <dt>
<code class="parameter">name</code></dt>

     <dd>

      <p class="para">
       Savepoint name for the transaction.
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-mysqli.begin-transaction-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   成功时返回 <strong><code>TRUE</code></strong>， 或者在失败时返回 <strong><code>FALSE</code></strong>。
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-mysqli.begin-transaction-examples">
  <h3 class="title">范例</h3>
  <div class="example" id="example-1853">
   <p><strong>Example #1 <span class="methodname"><strong>$mysqli->begin_transaction()</strong></span> example</strong></p>
   <div class="example-contents"><p>面向对象风格</p></div>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$mysqli&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">mysqli</span><span style="color: #007700">(</span><span style="color: #DD0000">"127.0.0.1"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"my_user"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"my_password"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"sakila"</span><span style="color: #007700">);<br /><br />if&nbsp;(</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">connect_errno</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"Connect&nbsp;failed:&nbsp;%s\n"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">connect_error</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;exit();<br />}<br /><br /></span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">begin_transaction</span><span style="color: #007700">(</span><span style="color: #0000BB">MYSQLI_TRANS_START_READ_ONLY</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"SELECT&nbsp;first_name,&nbsp;last_name&nbsp;FROM&nbsp;actor"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">commit</span><span style="color: #007700">();<br /><br /></span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">close</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

   <div class="example-contents"><p>过程化风格</p></div>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$link&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mysqli_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">"127.0.0.1"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"my_user"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"my_password"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"sakila"</span><span style="color: #007700">);<br /><br />if&nbsp;(</span><span style="color: #0000BB">mysqli_connect_errno</span><span style="color: #007700">())&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"Connect&nbsp;failed:&nbsp;%s\n"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">mysqli_connect_error</span><span style="color: #007700">());<br />&nbsp;&nbsp;&nbsp;&nbsp;exit();<br />}<br /><br /></span><span style="color: #0000BB">mysqli_begin_transaction</span><span style="color: #007700">(</span><span style="color: #0000BB">$link</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">MYSQLI_TRANS_START_READ_ONLY</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">mysqli_query</span><span style="color: #007700">(</span><span style="color: #0000BB">$link</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"SELECT&nbsp;first_name,&nbsp;last_name&nbsp;FROM&nbsp;actor&nbsp;LIMIT&nbsp;1"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">mysqli_commit</span><span style="color: #007700">(</span><span style="color: #0000BB">$link</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">mysqli_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$link</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

  </div>
 </div>


 <div class="refsect1 seealso" id="refsect1-mysqli.begin-transaction-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="mysqli.autocommit.html" class="function" rel="rdfs-seeAlso">mysqli_autocommit()</a> - 打开或关闭本次数据库连接的自动命令提交事务模式</span></li>
    <li class="member"><span class="function"><a href="mysqli.commit.html" class="function" rel="rdfs-seeAlso">mysqli_commit()</a> - 提交一个事务</span></li>
    <li class="member"><span class="function"><a href="mysqli.rollback.html" class="function" rel="rdfs-seeAlso">mysqli_rollback()</a> - 回退当前事务</span></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="123439""></a>
  <div class="note">
   <strong class="user">VasK@hapir</strong>
   <a href="#123439" class="date">15-Dec-2018 03:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The above answer from Ral worked for us, Thanks a lot. This is how we implemented the proposed workaround for <br />
<br />
Warning: mysqli_begin_transaction(): This server version doesn't support 'READ WRITE' and 'READ ONLY'. Minimum 5.6.5 is required<br />
<br />
We appended the following line to /etc/my.cnf and restarted MySQL server<br />
<br />
version=10.2.19-MariaDB</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="122775""></a>
  <div class="note">
   <strong class="user">Ral</strong>
   <a href="#122775" class="date">29-May-2018 05:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you receive errors like: "This server version doesn't support 'READ WRITE' and 'READ ONLY'. Minimum 5.6.5 is required" with versions of MariaDB that DO support them, this is due to an internal check in mysqli conflicting with a hack in MariaDB to allow replication with oracle mysql.<br />
<br />
MariaDB prefixes its server version numbers with "5.5.5-" for example "5.5.5-10.3.7-MariaDB-1:10.3.7+maria~stretch". This is because oracle mysql would interpet the "10" as version 1. Mysql clients aware of MariaDB have been updated to detect and strip this prefix.<br />
<br />
However the check for mysqli.begin-transaction sees the 5.5.5 prefix and so fails.<br />
<br />
The workaround is to specify a custom version string without the prefix for MariaDB on the command line using the --version option. Then mysqli.begin-transaction functions as expected.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="119917""></a>
  <div class="note">
   <strong class="user">Luc</strong>
   <a href="#119917" class="date">20-Sep-2016 02:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For PHP&lt;5.5:<br />
<br />
&nbsp;&nbsp;&nbsp; mysqli_query($db, "START TRANSACTION");</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
