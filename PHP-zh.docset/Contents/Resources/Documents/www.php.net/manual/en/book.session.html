<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>Session Handling</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="refs.basic.session.html">? Session 扩展</a></li>
      <li style="float: right;"><a href="intro.session.html">简介 ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="refs.basic.session.html">Session 扩展</a></li>
    <li>Session Handling</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="book.session" class="book">
 
 <h1 class="title">Session Handling</h1>
 

 
 
 

 







 

 








 








 








 







 









 




 





<ul class="chunklist chunklist_book"><li><a href="intro.session.html">简介</a></li><li><a href="session.setup.html">安装／配置</a><ul class="chunklist chunklist_book chunklist_children"><li><a href="session.requirements.html">需求</a></li><li><a href="session.installation.html">安装</a></li><li><a href="session.configuration.html">运行时配置</a></li><li><a href="session.resources.html">资源类型</a></li></ul></li><li><a href="session.constants.html">预定义常量</a></li><li><a href="session.examples.html">范例</a><ul class="chunklist chunklist_book chunklist_children"><li><a href="session.examples.basic.html">基本用法</a></li><li><a href="session.idpassing.html">传送会话ID</a></li><li><a href="session.customhandler.html">自定义会话管理器</a></li></ul></li><li><a href="session.upload-progress.html">Session 上传进度</a></li><li><a href="session.security.html">会话和安全</a><ul class="chunklist chunklist_book chunklist_children"><li><a href="features.session.security.management.html">会话管理基础</a></li><li><a href="session.security.ini.html">和会话安全相关的配置项</a></li></ul></li><li><a href="ref.session.html">Session 函数</a><ul class="chunklist chunklist_book chunklist_children"><li><a href="function.session-abort.html">session_abort</a> &mdash; Discard session array changes and finish session</li><li><a href="function.session-cache-expire.html">session_cache_expire</a> &mdash; 返回当前缓存的到期时间</li><li><a href="function.session-cache-limiter.html">session_cache_limiter</a> &mdash; 读取/设置缓存限制器</li><li><a href="function.session-commit.html">session_commit</a> &mdash; session_write_close 的别名</li><li><a href="function.session-create-id.html">session_create_id</a> &mdash; Create new session id</li><li><a href="function.session-decode.html">session_decode</a> &mdash; 解码会话数据</li><li><a href="function.session-destroy.html">session_destroy</a> &mdash; 销毁一个会话中的全部数据</li><li><a href="function.session-encode.html">session_encode</a> &mdash; 将当前会话数据编码为一个字符串</li><li><a href="function.session-gc.html">session_gc</a> &mdash; Perform session data garbage collection</li><li><a href="function.session-get-cookie-params.html">session_get_cookie_params</a> &mdash; 获取会话 cookie 参数</li><li><a href="function.session-id.html">session_id</a> &mdash; 获取/设置当前会话 ID</li><li><a href="function.session-module-name.html">session_module_name</a> &mdash; 获取/设置会话模块名称</li><li><a href="function.session-name.html">session_name</a> &mdash; 读取/设置会话名称</li><li><a href="function.session-regenerate-id.html">session_regenerate_id</a> &mdash; 使用新生成的会话 ID 更新现有会话 ID</li><li><a href="function.session-register-shutdown.html">session_register_shutdown</a> &mdash; 关闭会话</li><li><a href="function.session-reset.html">session_reset</a> &mdash; Re-initialize session array with original values</li><li><a href="function.session-save-path.html">session_save_path</a> &mdash; 读取/设置当前会话的保存路径</li><li><a href="function.session-set-cookie-params.html">session_set_cookie_params</a> &mdash; 设置会话 cookie 参数</li><li><a href="function.session-set-save-handler.html">session_set_save_handler</a> &mdash; 设置用户自定义会话存储函数</li><li><a href="function.session-start.html">session_start</a> &mdash; 启动新会话或者重用现有会话</li><li><a href="function.session-status.html">session_status</a> &mdash; 返回当前会话状态</li><li><a href="function.session-unset.html">session_unset</a> &mdash; 释放所有的会话变量</li><li><a href="function.session-write-close.html">session_write_close</a> &mdash; Write session data and end session</li></ul></li><li><a href="class.sessionhandler.html">SessionHandler</a> &mdash; The SessionHandler class<ul class="chunklist chunklist_book chunklist_children"><li><a href="sessionhandler.close.html">SessionHandler::close</a> &mdash; Close the session</li><li><a href="sessionhandler.create-sid.html">SessionHandler::create_sid</a> &mdash; Return a new session ID</li><li><a href="sessionhandler.destroy.html">SessionHandler::destroy</a> &mdash; Destroy a session</li><li><a href="sessionhandler.gc.html">SessionHandler::gc</a> &mdash; Cleanup old sessions</li><li><a href="sessionhandler.open.html">SessionHandler::open</a> &mdash; Initialize session</li><li><a href="sessionhandler.read.html">SessionHandler::read</a> &mdash; Read session data</li><li><a href="sessionhandler.write.html">SessionHandler::write</a> &mdash; Write session data</li></ul></li><li><a href="class.sessionhandlerinterface.html">SessionHandlerInterface</a> &mdash; The SessionHandlerInterface class<ul class="chunklist chunklist_book chunklist_children"><li><a href="sessionhandlerinterface.close.html">SessionHandlerInterface::close</a> &mdash; Close the session</li><li><a href="sessionhandlerinterface.destroy.html">SessionHandlerInterface::destroy</a> &mdash; Destroy a session</li><li><a href="sessionhandlerinterface.gc.html">SessionHandlerInterface::gc</a> &mdash; Cleanup old sessions</li><li><a href="sessionhandlerinterface.open.html">SessionHandlerInterface::open</a> &mdash; Initialize session</li><li><a href="sessionhandlerinterface.read.html">SessionHandlerInterface::read</a> &mdash; Read session data</li><li><a href="sessionhandlerinterface.write.html">SessionHandlerInterface::write</a> &mdash; Write session data</li></ul></li></ul></div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="116217""></a>
  <div class="note">
   <strong class="user">bouvrette dot nicolas at gmail dot com</strong>
   <a href="#116217" class="date">23-Nov-2014 09:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Be careful if you are updating to PHP 5.6 since the the Sessions's Write behavior changed.&nbsp; It now only writes the session if you changed the data. So this means that if you rely on your session to update an activity time stamp on the server (to control session expiry) you will end up having issues. Here is a quick fix if you are implementing SessionHandlerInterface:<br />
<br />
&nbsp;&nbsp;&nbsp; public function close() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;write($this-&gt;id, serialize($_SESSION));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return true;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
Make sure you also use this:<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; ini_set('session.serialize_handler', 'php_serialize'); // Force standard PHP functions handler for flexibility<br />
<br />
More details here:<br />
<br />
Request #17860 (Session write short circuit)<br />
https://bugs.php.net/bug.php?id=17860</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="90351""></a>
  <div class="note">
   <strong class="user">e dot mortoray at ecircle dot com</strong>
   <a href="#90351" class="date">17-Apr-2009 05:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There is a nuance we found with session timing out although the user is still active in the session.&nbsp; The problem has to do with never modifying the session variable.
<br />

<br />
The GC will clear the session data files based on their last modification time.&nbsp; Thus if you never modify the session, you simply read from it, then the GC will eventually clean up.
<br />

<br />
To prevent this you need to ensure that your session is modified within the GC delete time.&nbsp; You can accomplish this like below.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">if( !isset(</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'last_access'</span><span class="keyword">]) || (</span><span class="default">time</span><span class="keyword">() - </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'last_access'</span><span class="keyword">]) &gt; </span><span class="default">60 </span><span class="keyword">)
<br />
&nbsp; </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'last_access'</span><span class="keyword">] = </span><span class="default">time</span><span class="keyword">();
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
This will update the session every 60s to ensure that the modification date is altered.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
