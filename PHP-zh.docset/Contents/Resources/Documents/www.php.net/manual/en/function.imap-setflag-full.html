<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>Sets flags on messages</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.imap-setacl.html">? imap_setacl</a></li>
      <li style="float: right;"><a href="function.imap-sort.html">imap_sort ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.imap.html">IMAP 函数</a></li>
    <li>Sets flags on messages</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.imap-setflag-full" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">imap_setflag_full</h1>
  <p class="verinfo">(PHP 4, PHP 5, PHP 7)</p><p class="refpurpose"><span class="refname">imap_setflag_full</span> &mdash; <span class="dc-title">Sets flags on messages</span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.imap-setflag-full-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>imap_setflag_full</strong></span>
    ( <span class="methodparam"><span class="type">resource</span> <code class="parameter">$imap_stream</code></span>
   , <span class="methodparam"><span class="type">string</span> <code class="parameter">$sequence</code></span>
   , <span class="methodparam"><span class="type">string</span> <code class="parameter">$flag</code></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$options</code><span class="initializer"> = NIL</span></span>
  ] ) : <span class="type">bool</span></div>

  <p class="para rdfs-comment">
   Causes a store to add the specified <code class="parameter">flag</code> to the
   flags set for the messages in the specified 
   <code class="parameter">sequence</code>.
  </p>
 </div>

 <div class="refsect1 parameters" id="refsect1-function.imap-setflag-full-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>

    <dt>
<code class="parameter">
imap_stream</code></dt>
<dd>
<p class="para">由 <span class="function"><a href="function.imap-open.html" class="function">imap_open()</a></span> 返回的 IMAP 流。</p></dd>

    
     <dt>
<code class="parameter">sequence</code></dt>

     <dd>

      <p class="para">
       A sequence of message numbers. You can enumerate desired messages
       with the <em>X,Y</em> syntax, or retrieve all messages 
       within an interval with the <em>X:Y</em> syntax
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">flag</code></dt>

     <dd>

      <p class="para">
       The flags which you can set are <em>\Seen</em>, 
       <em>\Answered</em>, <em>\Flagged</em>,
       <em>\Deleted</em>, and <em>\Draft</em> as
       defined by <a href="http://www.faqs.org/rfcs/rfc2060" class="link external" title="Link : http://www.faqs.org/rfcs/rfc2060">&raquo;&nbsp;RFC2060</a>.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">options</code></dt>

     <dd>

      <p class="para">
       A bit mask that may contain the single option:
       <ul class="itemizedlist">
        <li class="listitem">
         <span class="simpara">
          <strong><code>ST_UID</code></strong> - The sequence argument contains UIDs
          instead of sequence numbers
         </span>
        </li>
       </ul>
      </p>
     </dd>

    
   </dl>

  </p>
 </div>

 <div class="refsect1 returnvalues" id="refsect1-function.imap-setflag-full-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   成功时返回 <strong><code>TRUE</code></strong>， 或者在失败时返回 <strong><code>FALSE</code></strong>。
  </p>
 </div>

 <div class="refsect1 examples" id="refsect1-function.imap-setflag-full-examples">
  <h3 class="title">范例</h3>
  <p class="para">
   <div class="example" id="example-4071">
    <p><strong>Example #1 <span class="function"><strong>imap_setflag_full()</strong></span> example</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$mbox&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">imap_open</span><span style="color: #007700">(</span><span style="color: #DD0000">"{imap.example.org:143}"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"username"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"password"</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;die(</span><span style="color: #DD0000">"can't&nbsp;connect:&nbsp;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">imap_last_error</span><span style="color: #007700">());<br /><br /></span><span style="color: #0000BB">$status&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">imap_setflag_full</span><span style="color: #007700">(</span><span style="color: #0000BB">$mbox</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"2,5"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"\\Seen&nbsp;\\Flagged"</span><span style="color: #007700">);<br /><br />echo&nbsp;</span><span style="color: #0000BB">gettype</span><span style="color: #007700">(</span><span style="color: #0000BB">$status</span><span style="color: #007700">)&nbsp;.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br />echo&nbsp;</span><span style="color: #0000BB">$status&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">imap_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$mbox</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>

 <div class="refsect1 seealso" id="refsect1-function.imap-setflag-full-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.imap-clearflag-full.html" class="function" rel="rdfs-seeAlso">imap_clearflag_full()</a> - Clears flags on messages</span></li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="99815""></a>
  <div class="note">
   <strong class="user">ming0 at mailinator dot com</strong>
   <a href="#99815" class="date">08-Sep-2010 10:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To correct phpidiot at avanca-a dot de<br />
<br />
<span class="default">&lt;?php<br />
<br />
imap_setflag_full</span><span class="keyword">(</span><span class="default">$mbox</span><span class="keyword">, </span><span class="string">'1'</span><span class="keyword">, </span><span class="string">'label1'</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99500""></a>
  <div class="note">
   <strong class="user">daniel dot blackburn at galorwebservices dot com</strong>
   <a href="#99500" class="date">20-Aug-2010 02:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Where possible I would avoid using POP3 accounts. My host allowed me to upgrade to IMAP and it is so much easier. I think the only way to accurately create any form of mail client with POP3 is to download the messages into an SQL database which is a big task to start with, considering the IMAP standards have the functionality we need built in.<br />
I experimented with flag setting in POP3 and it seems they do not stick at all, and it is almost impossible to retrieve the number of unread messages (ie. the Seen / Unseen thing does not work)<br />
Converted to IMAP and it's working - the majority of the functions in this section seem to be IMAP focussed and WILL NOT generally work with POP3</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="94249""></a>
  <div class="note">
   <strong class="user">phpidiot at avanca-a dot de</strong>
   <a href="#94249" class="date">25-Oct-2009 04:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
"Keywords" aka "tags" aka "PERMANENTFLAGS" can be added if your server supports IMAP 4rev1 by using $label{label-nr}:<br />
<br />
<span class="default">&lt;?php<br />
<br />
$mbox </span><span class="keyword">= </span><span class="default">imap_open</span><span class="keyword">(</span><span class="string">"{imap.example.org:143}"</span><span class="keyword">, </span><span class="string">"username"</span><span class="keyword">, </span><span class="string">"password"</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; or die(</span><span class="string">"can't connect: " </span><span class="keyword">. </span><span class="default">imap_last_error</span><span class="keyword">());<br />
<br />
</span><span class="default">$status </span><span class="keyword">= </span><span class="default">imap_setflag_full</span><span class="keyword">(</span><span class="default">$mbox</span><span class="keyword">, </span><span class="string">"2,5"</span><span class="keyword">, </span><span class="string">"\$label1"</span><span class="keyword">);<br />
<br />
echo </span><span class="default">gettype</span><span class="keyword">(</span><span class="default">$status</span><span class="keyword">) . </span><span class="string">"\n"</span><span class="keyword">;<br />
echo </span><span class="default">$status </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">;<br />
<br />
</span><span class="default">imap_close</span><span class="keyword">(</span><span class="default">$mbox</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="28560""></a>
  <div class="note">
   <strong class="user">calmdown at abendstille dot at</strong>
   <a href="#28560" class="date">16-Jan-2003 01:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The imap_setflag_full-function works with pop3 as long as the connection is NOT closed. if you make<br />
<br />
imap_setflag_full($mbox, imap_uid($mbox, 0), "\\Seen \\Flagged", ST_UID);<br />
&nbsp;&nbsp;&nbsp; <br />
print_r( imap_headerinfo($mbox, 0) );<br />
<br />
you see the flags set, but if you call the box again with another script, the flags are empty again.<br />
I tried this on a WinNT (*ugly*) with IIS 4.0 and a running POP3-server with PHP 4.3.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="21017""></a>
  <div class="note">
   <strong class="user">msh at onliners dot dk</strong>
   <a href="#21017" class="date">25-Apr-2002 08:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In reply to:<br />
todsah@arise.nl<br />
13-Oct-2000 06:51<br />
<br />
The pop3 does indeed support the deleted flag - I have been working with the IMAP functions connection to a POP3 server this past week and lucky me it works.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="18684""></a>
  <div class="note">
   <strong class="user">AJCartmell at ricardo dot com</strong>
   <a href="#18684" class="date">31-Jan-2002 06:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Spent ages trying to get this to work, then eventually remembered I had opened the mailbox READONLY - obviously you need write permission for setting flags!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="18199""></a>
  <div class="note">
   <strong class="user">php AT holtsmark DOT no</strong>
   <a href="#18199" class="date">14-Jan-2002 06:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Use the imap_clearflag_full function if you want to unset the \Seen flag.<br />
<br />
<a href="http://www.php.net/manual/en/function.imap-clearflag-full.php" rel="nofollow" target="_blank">http://www.php.net/manual/en/function.imap-clearflag-full.php</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="10255""></a>
  <div class="note">
   <strong class="user">death at metalfield dot com</strong>
   <a href="#10255" class="date">21-Dec-2000 05:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Indeed POP3 does not support flags that indicate the "newness" of a message. There are other ways to work around this problem, though. For one, I have seen mail delivery systems that will add a header field Status: to indicate its status (see RFC2076). Another way most email clients and mail fetching programs seem to use is to keep a local list of UID's of messages that are downloaded. Upon fetching mail, the UID's of the messages can be checked against this list to see if it was already downloaded. POP3 supports a command UIDL to get a list of all UID's, but I doubt the IMAP lib uses this command. The only thing I know of that will thrash this work-around is the use of multiple mail clients. If another mail client fetches mail from the server, the first client has no way of knowing it has been downloaded.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="9065""></a>
  <div class="note">
   <strong class="user">todsah at arise dot nl</strong>
   <a href="#9065" class="date">13-Oct-2000 12:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
According to the rfc, pop3 does not have support for these flags, except perhaps for the deleted flag. I haven't tried if the delete flag works on pop3 or not.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="3202""></a>
  <div class="note">
   <strong class="user">simoned at eisa dot net dot au</strong>
   <a href="#3202" class="date">13-Jan-2000 10:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I've finally managed to get some action out of this function. Here is some code that might work help some people out:
<br />

<br />
$headers = imap_headers($link); 
<br />
for($x=0; $x &lt; count($headers); $x++) { 
<br />
&nbsp;&nbsp;&nbsp; $id = substr($headers[$x],5,4);
<br />
&nbsp;&nbsp;&nbsp; imap_setflag_full($link,imap_uid($link,$id),'\\SEEN',SE_UID);
<br />
}
<br />

<br />
Good luck.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
