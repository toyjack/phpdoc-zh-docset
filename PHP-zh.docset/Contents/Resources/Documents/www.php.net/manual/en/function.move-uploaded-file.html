<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>将上传的文件移动到新位置</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.mkdir.html">? mkdir</a></li>
      <li style="float: right;"><a href="function.parse-ini-file.html">parse_ini_file ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.filesystem.html">文件系统函数</a></li>
    <li>将上传的文件移动到新位置</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.move-uploaded-file" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">move_uploaded_file</h1>
  <p class="verinfo">(PHP 4 &gt;= 4.0.3, PHP 5, PHP 7)</p><p class="refpurpose"><span class="refname">move_uploaded_file</span> &mdash; <span class="dc-title">将上传的文件移动到新位置</span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.move-uploaded-file-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>move_uploaded_file</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$filename</code></span>
   , <span class="methodparam"><span class="type">string</span> <code class="parameter">$destination</code></span>
   ) : <span class="type">bool</span></div>

  <p class="para rdfs-comment">
   本函数检查并确保由 <code class="parameter">filename</code>
   指定的文件是合法的上传文件（即通过 PHP 的 HTTP POST
   上传机制所上传的）。如果文件合法，则将其移动为由
   <code class="parameter">destination</code> 指定的文件。
  </p>
  <p class="para">
   这种检查显得格外重要，如果上传的文件有可能会造成对用户或本系统的其他用户显示其内容的话。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.move-uploaded-file-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">filename</code></dt>

     <dd>

      <p class="para">
       上传的文件的文件名。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">destination</code></dt>

     <dd>

      <p class="para">
       移动文件到这个位置。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>

 
 <div class="refsect1 returnvalues" id="refsect1-function.move-uploaded-file-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   成功时返回 <strong><code>TRUE</code></strong>。
  </p>
  <p class="para">
   如果 <code class="parameter">filename</code>
   不是合法的上传文件，不会出现任何操作，<span class="function"><strong>move_uploaded_file()</strong></span>
   将返回 <strong><code>FALSE</code></strong>。
  </p>
  <p class="para">
   如果 <code class="parameter">filename</code>
   是合法的上传文件，但出于某些原因无法移动，不会出现任何操作，<span class="function"><strong>move_uploaded_file()</strong></span>
   将返回 <strong><code>FALSE</code></strong>。此外还会发出一条警告。
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.move-uploaded-file-examples">
  <h3 class="title">范例</h3>
  <p class="para">
   <div class="example" id="example-2859">
    <p><strong>Example #1 Uploading multiple files</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$uploads_dir&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'/uploads'</span><span style="color: #007700">;<br />foreach&nbsp;(</span><span style="color: #0000BB">$_FILES</span><span style="color: #007700">[</span><span style="color: #DD0000">"pictures"</span><span style="color: #007700">][</span><span style="color: #DD0000">"error"</span><span style="color: #007700">]&nbsp;as&nbsp;</span><span style="color: #0000BB">$key&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$error</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$error&nbsp;</span><span style="color: #007700">==&nbsp;</span><span style="color: #0000BB">UPLOAD_ERR_OK</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$tmp_name&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$_FILES</span><span style="color: #007700">[</span><span style="color: #DD0000">"pictures"</span><span style="color: #007700">][</span><span style="color: #DD0000">"tmp_name"</span><span style="color: #007700">][</span><span style="color: #0000BB">$key</span><span style="color: #007700">];<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$name&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$_FILES</span><span style="color: #007700">[</span><span style="color: #DD0000">"pictures"</span><span style="color: #007700">][</span><span style="color: #DD0000">"name"</span><span style="color: #007700">][</span><span style="color: #0000BB">$key</span><span style="color: #007700">];<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">move_uploaded_file</span><span style="color: #007700">(</span><span style="color: #0000BB">$tmp_name</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"</span><span style="color: #0000BB">$uploads_dir</span><span style="color: #DD0000">/</span><span style="color: #0000BB">$name</span><span style="color: #DD0000">"</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 notes" id="refsect1-function.move-uploaded-file-notes">
  <h3 class="title">注释</h3>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    <span class="function"><strong>move_uploaded_file()</strong></span> 对<a href="ini.sect.safe-mode.html#ini.safe-mode" class="link">安全模式</a>和
    <a href="ini.core.html#ini.open-basedir" class="link">open_basedir</a> 都是敏感的。不过，限制只针对
    <code class="parameter">destination</code> 路径，因为允许移动上传的文件名
    <code class="parameter">filename</code>
    可能会与这些限制产生冲突。<span class="function"><strong>move_uploaded_file()</strong></span>
    仅作用于通过 PHP 上传的文件以确保这个操作的安全性。
   </p>
  </p></blockquote>
  <div class="warning"><strong class="warning">Warning</strong>
   <p class="para">
    如果目标文件已经存在，将会被覆盖。
   </p>
  </div>
 </div>

 
 <div class="refsect1 seealso" id="refsect1-function.move-uploaded-file-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.is-uploaded-file.html" class="function" rel="rdfs-seeAlso">is_uploaded_file()</a> - 判断文件是否是通过 HTTP POST 上传的</span></li>
    <li class="member"><span class="function"><a href="function.rename.html" class="function" rel="rdfs-seeAlso">rename()</a> - 重命名一个文件或目录</span></li>
    <li class="member">参见<a href="features.file-upload.html" class="link">文件上传处理</a>一章中的简单使用例子。</li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="123705""></a>
  <div class="note">
   <strong class="user">Juliano P. Santos</strong>
   <a href="#123705" class="date">19-Mar-2019 10:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For those which will use inotify-tools to start an event when move_uploaded_file put the file in a specific directory, be aware that move_uploaded_file will trigger the create event, and not the move event of inotify-tools.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="122834""></a>
  <div class="note">
   <strong class="user">ccbsschucko at gmail dot com</strong>
   <a href="#122834" class="date">15-Jun-2018 12:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php <br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">class </span><span class="default">UploadTool </span><span class="keyword">{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; * @var arr =&gt; $upload_info = infos sobre os arquivos enviados<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; */<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">private </span><span class="default">$upload_info </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; * @param str =&gt; $input_name = nome do input<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; * @param str =&gt; $folder_to_move = nome da pasta em que o arquivo será salvo<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; * @param arr =&gt; $mime_allowed = mime types permitidos no processo de upload<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; * @param bol =&gt; $return_json = se true retorna um objeto json<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; */<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">public function </span><span class="default">manage_single_file</span><span class="keyword">(</span><span class="default">string $input_name</span><span class="keyword">, </span><span class="default">string $folder_to_move</span><span class="keyword">, array </span><span class="default">$mime_allowed </span><span class="keyword">= [], </span><span class="default">bool $return_json </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$resultado </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$count_mime_allowed </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$mime_allowed</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">is_uploaded_file</span><span class="keyword">(</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="default">$input_name</span><span class="keyword">][</span><span class="string">'tmp_name'</span><span class="keyword">])){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_name_file </span><span class="keyword">= </span><span class="default">bin2hex</span><span class="keyword">(</span><span class="default">random_bytes</span><span class="keyword">(</span><span class="default">64</span><span class="keyword">)).</span><span class="string">'.'</span><span class="keyword">.</span><span class="default">pathinfo</span><span class="keyword">(</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="default">$input_name</span><span class="keyword">][</span><span class="string">'name'</span><span class="keyword">], </span><span class="default">PATHINFO_EXTENSION</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">upload_info </span><span class="keyword">= array(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'name' </span><span class="keyword">=&gt; </span><span class="default">$new_name_file</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'size' </span><span class="keyword">=&gt; </span><span class="default">$_FILES</span><span class="keyword">[</span><span class="default">$input_name</span><span class="keyword">][</span><span class="string">'size'</span><span class="keyword">],<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'mime' </span><span class="keyword">=&gt; </span><span class="default">finfo_file</span><span class="keyword">(</span><span class="default">finfo_open</span><span class="keyword">(</span><span class="default">FILEINFO_MIME_TYPE</span><span class="keyword">), </span><span class="default">$_FILES</span><span class="keyword">[</span><span class="default">$input_name</span><span class="keyword">][</span><span class="string">'tmp_name'</span><span class="keyword">]),<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'extension' </span><span class="keyword">=&gt; </span><span class="default">pathinfo</span><span class="keyword">(</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="default">$input_name</span><span class="keyword">][</span><span class="string">'name'</span><span class="keyword">], </span><span class="default">PATHINFO_EXTENSION</span><span class="keyword">),<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'check_mime' </span><span class="keyword">=&gt; </span><span class="default">true</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'folder_to_move' </span><span class="keyword">=&gt; </span><span class="default">$folder_to_move</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'error_code' </span><span class="keyword">=&gt; </span><span class="default">$_FILES</span><span class="keyword">[</span><span class="default">$input_name</span><span class="keyword">][</span><span class="string">'error'</span><span class="keyword">],<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; );<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$count_mime_allowed </span><span class="keyword">&gt; </span><span class="default">0 </span><span class="keyword">&amp;&amp; !</span><span class="default">in_array</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">upload_info</span><span class="keyword">[</span><span class="string">'mime'</span><span class="keyword">], </span><span class="default">$mime_allowed</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">)){</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">upload_info</span><span class="keyword">[</span><span class="string">'check_mime'</span><span class="keyword">] = </span><span class="default">false</span><span class="keyword">;}<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">upload_info</span><span class="keyword">[</span><span class="string">'error_code'</span><span class="keyword">] === </span><span class="default">0 </span><span class="keyword">&amp;&amp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">upload_info</span><span class="keyword">[</span><span class="string">'check_mime'</span><span class="keyword">] === </span><span class="default">true</span><span class="keyword">){</span><span class="default">move_uploaded_file</span><span class="keyword">(</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="default">$input_name</span><span class="keyword">][</span><span class="string">'tmp_name'</span><span class="keyword">], </span><span class="default">$folder_to_move</span><span class="keyword">.</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">upload_info</span><span class="keyword">[</span><span class="string">'name'</span><span class="keyword">]);}<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$resultado</span><span class="keyword">[</span><span class="string">'upload_info'</span><span class="keyword">] = </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">upload_info</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$return_json</span><span class="keyword">){echo </span><span class="default">json_encode</span><span class="keyword">(</span><span class="default">$resultado</span><span class="keyword">);}<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(!</span><span class="default">$return_json</span><span class="keyword">){return </span><span class="default">$resultado</span><span class="keyword">;}<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; * @param str =&gt; $input_name = nome do input<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; * @param str =&gt; $folder_to_move = nome da pasta em que o arquivo será salvo<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; * @param arr =&gt; $mime_allowed = mime types permitidos no processo de upload<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; * @param bol =&gt; $return_json = se true retorna um objeto json<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; */<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">public function </span><span class="default">manage_multiple_file</span><span class="keyword">(</span><span class="default">string $input_name</span><span class="keyword">, </span><span class="default">string $folder_to_move</span><span class="keyword">, array </span><span class="default">$mime_allowed </span><span class="keyword">= [], </span><span class="default">bool $return_json </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$resultado </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$count_mime_allowed </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$mime_allowed</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$qtd_arquivos_enviados </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="default">$input_name</span><span class="keyword">][</span><span class="string">'tmp_name'</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for(</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$qtd_arquivos_enviados</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">is_uploaded_file</span><span class="keyword">(</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="default">$input_name</span><span class="keyword">][</span><span class="string">'tmp_name'</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">])){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_name_file </span><span class="keyword">= </span><span class="default">bin2hex</span><span class="keyword">(</span><span class="default">random_bytes</span><span class="keyword">(</span><span class="default">64</span><span class="keyword">)).</span><span class="string">'.'</span><span class="keyword">.</span><span class="default">pathinfo</span><span class="keyword">(</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="default">$input_name</span><span class="keyword">][</span><span class="string">'name'</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">], </span><span class="default">PATHINFO_EXTENSION</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">upload_info</span><span class="keyword">[] = array(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'name' </span><span class="keyword">=&gt; </span><span class="default">$new_name_file</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'size' </span><span class="keyword">=&gt; </span><span class="default">$_FILES</span><span class="keyword">[</span><span class="default">$input_name</span><span class="keyword">][</span><span class="string">'size'</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">],<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'mime' </span><span class="keyword">=&gt; </span><span class="default">finfo_file</span><span class="keyword">(</span><span class="default">finfo_open</span><span class="keyword">(</span><span class="default">FILEINFO_MIME_TYPE</span><span class="keyword">), </span><span class="default">$_FILES</span><span class="keyword">[</span><span class="default">$input_name</span><span class="keyword">][</span><span class="string">'tmp_name'</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">]),<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'extension' </span><span class="keyword">=&gt; </span><span class="default">pathinfo</span><span class="keyword">(</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="default">$input_name</span><span class="keyword">][</span><span class="string">'name'</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">], </span><span class="default">PATHINFO_EXTENSION</span><span class="keyword">),<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'check_mime' </span><span class="keyword">=&gt; </span><span class="default">true</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'folder_to_move' </span><span class="keyword">=&gt; </span><span class="default">$folder_to_move</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'error_code' </span><span class="keyword">=&gt; </span><span class="default">$_FILES</span><span class="keyword">[</span><span class="default">$input_name</span><span class="keyword">][</span><span class="string">'error'</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">],<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; );<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$count_mime_allowed </span><span class="keyword">&gt; </span><span class="default">0 </span><span class="keyword">&amp;&amp; !</span><span class="default">in_array</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">upload_info</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][</span><span class="string">'mime'</span><span class="keyword">], </span><span class="default">$mime_allowed</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">)){</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">upload_info</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][</span><span class="string">'check_mime'</span><span class="keyword">] = </span><span class="default">false</span><span class="keyword">;}<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">upload_info</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][</span><span class="string">'error_code'</span><span class="keyword">] === </span><span class="default">0 </span><span class="keyword">&amp;&amp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">upload_info</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][</span><span class="string">'check_mime'</span><span class="keyword">] === </span><span class="default">true</span><span class="keyword">){</span><span class="default">move_uploaded_file</span><span class="keyword">(</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="default">$input_name</span><span class="keyword">][</span><span class="string">'tmp_name'</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">], </span><span class="default">$folder_to_move</span><span class="keyword">.</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">upload_info</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][</span><span class="string">'name'</span><span class="keyword">]);}<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$resultado</span><span class="keyword">[</span><span class="string">'upload_info'</span><span class="keyword">] = </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">upload_info</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$return_json</span><span class="keyword">){echo </span><span class="default">json_encode</span><span class="keyword">(</span><span class="default">$resultado</span><span class="keyword">);}<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(!</span><span class="default">$return_json</span><span class="keyword">){return </span><span class="default">$resultado</span><span class="keyword">;}<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$_FILES</span><span class="keyword">){(new </span><span class="default">UploadTool</span><span class="keyword">)-&gt;</span><span class="default">manage_multiple_file</span><span class="keyword">(</span><span class="string">'input_arquivos'</span><span class="keyword">, </span><span class="default">__DIR__</span><span class="keyword">.</span><span class="string">'/pasta/'</span><span class="keyword">);}<br />
</span><span class="default">?&gt;<br />
</span>&lt;form method="POST" action="<span class="default">&lt;?php </span><span class="keyword">echo </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_SELF'</span><span class="keyword">] </span><span class="default">?&gt;</span>" enctype="multipart/form-data"&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;input type="file" name="input_arquivos[]" multiple="true"&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;button type="submit"&gt;enviar&lt;/button&gt;<br />
&lt;/form&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="116451""></a>
  <div class="note">
   <strong class="user">Tom</strong>
   <a href="#116451" class="date">05-Jan-2015 03:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Nowhere does it say how to get the error/warning message when this fails.<br />
<br />
The only way I know of doing it is something like this:<br />
<br />
&nbsp;&nbsp; if (move_uploaded_file($_FILES["file1"]["tmp_name"], $target_file)) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; echo "&lt;P&gt;FILE UPLOADED TO: $target_file&lt;/P&gt;";<br />
&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp;&nbsp; echo "&lt;P&gt;MOVE UPLOADED FILE FAILED!&lt;/P&gt;";<br />
&nbsp;&nbsp; &nbsp;&nbsp; print_r(error_get_last());<br />
&nbsp;&nbsp; }</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="114982""></a>
  <div class="note">
   <strong class="user">Chris Hecker</strong>
   <a href="#114982" class="date">09-May-2014 06:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Re: Florian S. in H. an der E. [.de]'s point about directory stick bits, I got hit by this a bunch since I use groups and dir sticky bits to secure my site, so I wrote this replacement, which others might find useful:<br />
<br />
/**<br />
&nbsp;* obey sticky bit with move_uploaded_file<br />
&nbsp;*<br />
&nbsp;*/<br />
function wp_move_uploaded_file( $filename, $destination ) {<br />
&nbsp; define("STICKYGRPDIR",042010);<br />
&nbsp; $stat = stat(dirname($destination));<br />
&nbsp; if(move_uploaded_file($filename,$destination)) {<br />
&nbsp;&nbsp;&nbsp; if($stat['mode'] &amp; STICKYGRPDIR) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; return chgrp($destination,$stat['gid']);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; } else {<br />
&nbsp;&nbsp;&nbsp; return false;<br />
&nbsp; }<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="111412""></a>
  <div class="note">
   <strong class="user">Yousef Ismaeil Cliprz</strong>
   <a href="#111412" class="date">17-Feb-2013 10:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Security tips you must know before use this function :<br />
<br />
First : make sure that the file is not empty.<br />
<br />
Second : make sure the file name in English characters, numbers and (_-.) symbols, For more protection.<br />
<br />
You can use below function as in example<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">/**<br />
&nbsp;* Check $_FILES[][name]<br />
&nbsp;*<br />
&nbsp;* @param (string) $filename - Uploaded file name.<br />
&nbsp;* @author Yousef Ismaeil Cliprz<br />
&nbsp;*/<br />
</span><span class="keyword">function </span><span class="default">check_file_uploaded_name </span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; (bool) ((</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"`^[-0-9A-Z_\.]+$`i"</span><span class="keyword">,</span><span class="default">$filename</span><span class="keyword">)) ? </span><span class="default">true </span><span class="keyword">: </span><span class="default">false</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Third : make sure that the file name not bigger than 250 characters.<br />
<br />
as in example :<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">/**<br />
&nbsp;* Check $_FILES[][name] length.<br />
&nbsp;*<br />
&nbsp;* @param (string) $filename - Uploaded file name.<br />
&nbsp;* @author Yousef Ismaeil Cliprz.<br />
&nbsp;*/<br />
</span><span class="keyword">function </span><span class="default">check_file_uploaded_length </span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; return (bool) ((</span><span class="default">mb_strlen</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">,</span><span class="string">"UTF-8"</span><span class="keyword">) &gt; </span><span class="default">225</span><span class="keyword">) ? </span><span class="default">true </span><span class="keyword">: </span><span class="default">false</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Fourth: Check File extensions and Mime Types that you want to allow in your project. You can use : pathinfo() <a href="http://php.net/pathinfo" rel="nofollow" target="_blank">http://php.net/pathinfo</a><br />
<br />
or you can use regular expression for check File extensions as in example<br />
<br />
#^(gif|jpg|jpeg|jpe|png)$#i<br />
<br />
or use in_array checking as<br />
<br />
<span class="default">&lt;?php<br />
<br />
$ext_type </span><span class="keyword">= array(</span><span class="string">'gif'</span><span class="keyword">,</span><span class="string">'jpg'</span><span class="keyword">,</span><span class="string">'jpe'</span><span class="keyword">,</span><span class="string">'jpeg'</span><span class="keyword">,</span><span class="string">'png'</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
You have multi choices to checking extensions and Mime types.<br />
<br />
Fifth: Check file size and make sure the limit of php.ini to upload files is what you want, You can start from <a href="http://www.php.net/manual/en/ini.core.php#ini.file-uploads" rel="nofollow" target="_blank">http://www.php.net/manual/en/ini.core.php#ini.file-uploads</a><br />
<br />
And last but not least : Check the file content if have a bad codes or something like this function <a href="http://php.net/manual/en/function.file-get-contents.php." rel="nofollow" target="_blank">http://php.net/manual/en/function.file-get-contents.php.</a><br />
<br />
You can use .htaccess to stop working some scripts as in example php file in your upload path.<br />
<br />
use :<br />
<br />
AddHandler cgi-script .php .pl .jsp .asp .sh .cgi<br />
Options -ExecCGI&nbsp; <br />
<br />
Do not forget this steps for your project protection.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="108133""></a>
  <div class="note">
   <strong class="user">marcelwoo</strong>
   <a href="#108133" class="date">31-Mar-2012 04:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
One more thing I want to mention about the post_max_size setting in php.ini that nobody else has mentioned.<br />
If you try to upload a file larger than the post_max_size value (or multi files), the page will only refresh itself and no errors are thrown. It took me a while to figure the reason out.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="105026""></a>
  <div class="note">
   <strong class="user">matthias dot dailey at gmail dot com</strong>
   <a href="#105026" class="date">22-Jul-2011 01:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The destination directory must exist; move_uploaded_file() will not automatically create it for you.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="103791""></a>
  <div class="note">
   <strong class="user">labsy at seznam dot org</strong>
   <a href="#103791" class="date">03-May-2011 04:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A note for PHP on Windows IIS platform:<br />
PHP does obviously not like directory traversing among partitions, so if you set upload_tmp_dir to be on different partition as php-cgi.exe or php.exe is, upload_tmp_dir will NOT be accessible for file uploads! You will get ERROR 6 on any attempt to upload file, and file size will be 0.<br />
Resolution is to have upload_tmp_dir set to a path under PHP install folder.<br />
...and make sure this folder (and also session_save_path folder) has at least read/write permissions granted to AppPool owner (usually NETWORK SERVICE) and IIS web user (by default IUSR_).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="103190""></a>
  <div class="note">
   <strong class="user">wilcobeekhuizen at gmail dot com</strong>
   <a href="#103190" class="date">30-Mar-2011 12:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When uploading a file with a very long filename, for example 255 characters, move_uploaded_file fails. The longest file I've succesfully uploaded has a 247 character filename. So, although you can create a 250 character filename locally the server may not be able to move it.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99456""></a>
  <div class="note">
   <strong class="user">Ray.Paseur sometimes uses Gmail</strong>
   <a href="#99456" class="date">18-Aug-2010 08:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You can only move the uploaded file once.&nbsp; You can use copy() if you need the file in more than one place.<br />
<span class="default">&lt;?php </span><span class="comment">// RAY_temp_upload_example.php<br />
</span><span class="default">error_reporting</span><span class="keyword">(</span><span class="default">E_ALL</span><span class="keyword">);<br />
echo </span><span class="string">"&lt;pre&gt;" </span><span class="keyword">. </span><span class="default">PHP_EOL</span><span class="keyword">;<br />
<br />
</span><span class="comment">// IF A FILE HAS BEEN UPLOADED<br />
</span><span class="keyword">if (!empty(</span><span class="default">$_FILES</span><span class="keyword">))<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// SHOW THE UPLOADED FILES<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$_FILES</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// TRY TO MOVE THE FILE TWICE - SECOND MOVE RETURNS FALSE<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (!</span><span class="default">move_uploaded_file</span><span class="keyword">(</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">"userfile"</span><span class="keyword">][</span><span class="string">"tmp_name"</span><span class="keyword">], </span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">"userfile"</span><span class="keyword">][</span><span class="string">"name"</span><span class="keyword">])) echo </span><span class="string">"CANNOT MOVE </span><span class="keyword">{</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">"userfile"</span><span class="keyword">][</span><span class="string">"name"</span><span class="keyword">]}</span><span class="string">" </span><span class="keyword">. </span><span class="default">PHP_EOL</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if (!</span><span class="default">move_uploaded_file</span><span class="keyword">(</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">"userfile"</span><span class="keyword">][</span><span class="string">"tmp_name"</span><span class="keyword">], </span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">"userfile"</span><span class="keyword">][</span><span class="string">"name"</span><span class="keyword">])) echo </span><span class="string">"CANNOT MOVE </span><span class="keyword">{</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">"userfile"</span><span class="keyword">][</span><span class="string">"name"</span><span class="keyword">]}</span><span class="string">" </span><span class="keyword">. </span><span class="default">PHP_EOL</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// SHOW THE UPLOADED FILES AFTER THE MOVE - NO VISIBLE CHANGE<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$_FILES</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="comment">// END OF PHP, PUT UP THE HTML FORM TO GET THE FILE<br />
</span><span class="default">?&gt;<br />
</span>&lt;!-- The data encoding type, enctype, MUST be specified as below --&gt;<br />
&lt;form enctype="multipart/form-data" method="POST"&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;!-- MAX_FILE_SIZE must precede the file input field --&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;input type="hidden" name="MAX_FILE_SIZE" value="300000" /&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;!-- Name of input element determines name in $_FILES array --&gt;<br />
&nbsp;&nbsp;&nbsp; Send this file: &lt;input name="userfile" type="file" /&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;input type="submit" value="Send File" /&gt;<br />
&lt;/form&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="96216""></a>
  <div class="note">
   <strong class="user">brentwientjes at NOSPAM dot comcast dot net</strong>
   <a href="#96216" class="date">15-Feb-2010 11:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I have for a couple of years been stymed to understand how to effectively load images (of more than 2MB) and then create thumbnails.&nbsp; My note below on general file uploading was an early hint of some of the system default limitations and I have recently discovered the final limit&nbsp; I offer this as an example of the various missing pieces of information to successfully load images of more than 2MB and then create thumbnails.&nbsp; This particular example assumes a picture of a user is being uploaded and because of browser caching needs a unique number at the end to make the browser load a new picture for review at the time of upload.&nbsp; The overall calling program I am using is a Flex based application which calls this php file to upload user thumbnails.<br />
<br />
The secret sauce is:<br />
<br />
1.&nbsp; adjust server memory size, file upload size, and post size<br />
2.&nbsp; convert image to standard formate (in this case jpg) and scale<br />
<br />
The server may be adjusted with the .htaccess file or inline code.&nbsp; This example has an .htaccess file with file upload size and post size and then inline code for dynamic system memory.<br />
<br />
htaccess file:<br />
php_value post_max_size 16M<br />
php_value upload_max_filesize 6M<br />
<br />
<span class="default">&lt;?php <br />
</span><span class="comment">//&nbsp; $img_base = base directory structure for thumbnail images<br />
//&nbsp; $w_dst = maximum width of thumbnail<br />
//&nbsp; $h_dst = maximum height of thumbnail<br />
//&nbsp; $n_img = new thumbnail name<br />
//&nbsp; $o_img = old thumbnail name<br />
</span><span class="keyword">function </span><span class="default">convertPic</span><span class="keyword">(</span><span class="default">$img_base</span><span class="keyword">, </span><span class="default">$w_dst</span><span class="keyword">, </span><span class="default">$h_dst</span><span class="keyword">, </span><span class="default">$n_img</span><span class="keyword">, </span><span class="default">$o_img</span><span class="keyword">)<br />
&nbsp; {</span><span class="default">ini_set</span><span class="keyword">(</span><span class="string">'memory_limit'</span><span class="keyword">, </span><span class="string">'100M'</span><span class="keyword">);&nbsp;&nbsp; </span><span class="comment">//&nbsp; handle large images<br />
&nbsp;&nbsp; </span><span class="default">unlink</span><span class="keyword">(</span><span class="default">$img_base</span><span class="keyword">.</span><span class="default">$n_img</span><span class="keyword">);&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//&nbsp; remove old images if present<br />
&nbsp;&nbsp; </span><span class="default">unlink</span><span class="keyword">(</span><span class="default">$img_base</span><span class="keyword">.</span><span class="default">$o_img</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">$new_img </span><span class="keyword">= </span><span class="default">$img_base</span><span class="keyword">.</span><span class="default">$n_img</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; <br />
&nbsp;&nbsp; </span><span class="default">$file_src </span><span class="keyword">= </span><span class="default">$img_base</span><span class="keyword">.</span><span class="string">"img.jpg"</span><span class="keyword">;&nbsp; </span><span class="comment">//&nbsp; temporary safe image storage<br />
&nbsp;&nbsp; </span><span class="default">unlink</span><span class="keyword">(</span><span class="default">$file_src</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">move_uploaded_file</span><span class="keyword">(</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'Filedata'</span><span class="keyword">][</span><span class="string">'tmp_name'</span><span class="keyword">], </span><span class="default">$file_src</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; list(</span><span class="default">$w_src</span><span class="keyword">, </span><span class="default">$h_src</span><span class="keyword">, </span><span class="default">$type</span><span class="keyword">) = </span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$file_src</span><span class="keyword">);&nbsp; &nbsp;&nbsp; </span><span class="comment">// create new dimensions, keeping aspect ratio<br />
&nbsp;&nbsp; </span><span class="default">$ratio </span><span class="keyword">= </span><span class="default">$w_src</span><span class="keyword">/</span><span class="default">$h_src</span><span class="keyword">;<br />
&nbsp;&nbsp; if (</span><span class="default">$w_dst</span><span class="keyword">/</span><span class="default">$h_dst </span><span class="keyword">&gt; </span><span class="default">$ratio</span><span class="keyword">) {</span><span class="default">$w_dst </span><span class="keyword">= </span><span class="default">floor</span><span class="keyword">(</span><span class="default">$h_dst</span><span class="keyword">*</span><span class="default">$ratio</span><span class="keyword">);} else {</span><span class="default">$h_dst </span><span class="keyword">= </span><span class="default">floor</span><span class="keyword">(</span><span class="default">$w_dst</span><span class="keyword">/</span><span class="default">$ratio</span><span class="keyword">);}<br />
<br />
&nbsp;&nbsp; switch (</span><span class="default">$type</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; {case </span><span class="default">1</span><span class="keyword">:&nbsp;&nbsp; </span><span class="comment">//&nbsp;&nbsp; gif -&gt; jpg<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$img_src </span><span class="keyword">= </span><span class="default">imagecreatefromgif</span><span class="keyword">(</span><span class="default">$file_src</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp;&nbsp; case </span><span class="default">2</span><span class="keyword">:&nbsp;&nbsp; </span><span class="comment">//&nbsp;&nbsp; jpeg -&gt; jpg<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$img_src </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$file_src</span><span class="keyword">); <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp;&nbsp; case </span><span class="default">3</span><span class="keyword">:&nbsp; </span><span class="comment">//&nbsp;&nbsp; png -&gt; jpg<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$img_src </span><span class="keyword">= </span><span class="default">imagecreatefrompng</span><span class="keyword">(</span><span class="default">$file_src</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; }<br />
&nbsp;&nbsp; </span><span class="default">$img_dst </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$w_dst</span><span class="keyword">, </span><span class="default">$h_dst</span><span class="keyword">);&nbsp; </span><span class="comment">//&nbsp; resample<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp; </span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$img_dst</span><span class="keyword">, </span><span class="default">$img_src</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$w_dst</span><span class="keyword">, </span><span class="default">$h_dst</span><span class="keyword">, </span><span class="default">$w_src</span><span class="keyword">, </span><span class="default">$h_src</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$img_dst</span><span class="keyword">, </span><span class="default">$new_img</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//&nbsp; save new image<br />
<br />
&nbsp;&nbsp; </span><span class="default">unlink</span><span class="keyword">(</span><span class="default">$file_src</span><span class="keyword">);&nbsp; </span><span class="comment">//&nbsp; clean up image storage<br />
&nbsp;&nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$img_src</span><span class="keyword">);&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$img_dst</span><span class="keyword">);<br />
&nbsp; }<br />
<br />
</span><span class="default">$p_id </span><span class="keyword">= (Integer) </span><span class="default">$_POST</span><span class="keyword">[</span><span class="default">uid</span><span class="keyword">];<br />
</span><span class="default">$ver </span><span class="keyword">= (Integer) </span><span class="default">$_POST</span><span class="keyword">[</span><span class="default">ver</span><span class="keyword">];<br />
</span><span class="default">$delver </span><span class="keyword">= (Integer) </span><span class="default">$_POST</span><span class="keyword">[</span><span class="default">delver</span><span class="keyword">];<br />
</span><span class="default">convertPic</span><span class="keyword">(</span><span class="string">"your/file/structure/"</span><span class="keyword">, </span><span class="default">150</span><span class="keyword">, </span><span class="default">150</span><span class="keyword">, </span><span class="string">"u"</span><span class="keyword">.</span><span class="default">$p_id</span><span class="keyword">.</span><span class="string">"v"</span><span class="keyword">.</span><span class="default">$ver</span><span class="keyword">.</span><span class="string">".jpg"</span><span class="keyword">, </span><span class="string">"u"</span><span class="keyword">.</span><span class="default">$p_id</span><span class="keyword">.</span><span class="string">"v"</span><span class="keyword">.</span><span class="default">$delver</span><span class="keyword">.</span><span class="string">".jpg"</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="94597""></a>
  <div class="note">
   <strong class="user">gotrunko at hotmail dot com</strong>
   <a href="#94597" class="date">13-Nov-2009 04:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This function can upload many files whitout parameters in the declaration.<br />
If one of them can not be uploaded, the function returns false and deletes all files that have been sent<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">uploadFiles</span><span class="keyword">() {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$num_args </span><span class="keyword">= </span><span class="default">func_num_args</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$arg_list </span><span class="keyword">= </span><span class="default">func_get_args</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$valReturn </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$unlinkElement </span><span class="keyword">= array();<br />
&nbsp;&nbsp;&nbsp; foreach(</span><span class="default">$arg_list </span><span class="keyword">as </span><span class="default">$key</span><span class="keyword">=&gt;</span><span class="default">$value</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">) AND </span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$value</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">][</span><span class="string">'error'</span><span class="keyword">] == </span><span class="default">0 </span><span class="keyword">AND isset(</span><span class="default">$value</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$value</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">][</span><span class="string">'size'</span><span class="keyword">] &gt; </span><span class="default">0 </span><span class="keyword">AND </span><span class="default">$value</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">][</span><span class="string">'size'</span><span class="keyword">] &lt; </span><span class="default">500000</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$typeAccepted </span><span class="keyword">= array(</span><span class="string">"image/jpeg"</span><span class="keyword">, </span><span class="string">"image/gif"</span><span class="keyword">, </span><span class="string">"image/png"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">in_array</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">][</span><span class="string">'type'</span><span class="keyword">],</span><span class="default">$typeAccepted</span><span class="keyword">)) {&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$destination </span><span class="keyword">= </span><span class="default">$value</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(isset(</span><span class="default">$value</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$extension </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">][</span><span class="string">'name'</span><span class="keyword">] , </span><span class="default">strrpos</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">][</span><span class="string">'name'</span><span class="keyword">] , </span><span class="string">'.'</span><span class="keyword">) +</span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$destination </span><span class="keyword">.= (</span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">" "</span><span class="keyword">,</span><span class="string">"-"</span><span class="keyword">,</span><span class="default">$value</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">])).</span><span class="string">"."</span><span class="keyword">.</span><span class="default">$extension</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$destination </span><span class="keyword">.= </span><span class="default">$value</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">][</span><span class="string">'name'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">move_uploaded_file</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">][</span><span class="string">'tmp_name'</span><span class="keyword">],</span><span class="default">$destination</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$i</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$unlinkElement</span><span class="keyword">[] = </span><span class="default">$destination</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$i </span><span class="keyword">== </span><span class="default">$num_args</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$valReturn </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$unlinkElement </span><span class="keyword">as </span><span class="default">$value</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">unlink</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$valReturn</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
To use this function you must specify an array with min two parameters like that. <br />
NAME is an optional parameter !<br />
uploadFiles(array("FILES","DESTINATION","NAME"));<br />
<br />
<span class="default">&lt;?php<br />
<br />
$file_one </span><span class="keyword">= array(</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'file_one'</span><span class="keyword">],</span><span class="default">$destination</span><span class="keyword">,</span><span class="default">$name_one</span><span class="keyword">);<br />
</span><span class="default">$file_two </span><span class="keyword">= array(</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'file_two'</span><span class="keyword">],</span><span class="default">$destination</span><span class="keyword">); </span><span class="comment">//The name will be the same that $_FILES[]['name']<br />
<br />
</span><span class="keyword">if(</span><span class="default">uploadFiles</span><span class="keyword">(</span><span class="default">$file_one</span><span class="keyword">,</span><span class="default">$file_two</span><span class="keyword">)) {<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"true"</span><span class="keyword">;<br />
} else {<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"false"</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="94141""></a>
  <div class="note">
   <strong class="user">chatchaw at tot dot co dot th</strong>
   <a href="#94141" class="date">19-Oct-2009 12:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When you use move_uploaded_file function to upload a file with utf-8&nbsp; filename to linux system, you probably check your result by browsing to see the file in the target directory so please make sure that your terminal emulator or your samba configuration is set the character encoding to utf-8 otherwise&nbsp; your file will be shown as ?????? (unreadable character).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="94126""></a>
  <div class="note">
   <strong class="user">brentwientjes at NOSPAM dot comast dot net</strong>
   <a href="#94126" class="date">18-Oct-2009 12:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I have looked at a lot of the file upload code listed below and other php documentation and have developed hopefully a robust single file upload routine.&nbsp; I will later update with a multi file upload.&nbsp; I have modestly tested the code.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="comment">//&nbsp; 5MB maximum file size
<br />
</span><span class="default">$MAXIMUM_FILESIZE </span><span class="keyword">= </span><span class="default">5 </span><span class="keyword">* </span><span class="default">1024 </span><span class="keyword">* </span><span class="default">1024</span><span class="keyword">;
<br />
</span><span class="comment">//&nbsp; Valid file extensions (images, word, excel, powerpoint)
<br />
</span><span class="default">$rEFileTypes </span><span class="keyword">= 
<br />
&nbsp; </span><span class="string">"/^\.(jpg|jpeg|gif|png|doc|docx|txt|rtf|pdf|xls|xlsx|
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; ppt|pptx){1}$/i"</span><span class="keyword">;
<br />
</span><span class="default">$dir_base </span><span class="keyword">= </span><span class="string">"/your/file/location/"</span><span class="keyword">;
<br />

<br />
</span><span class="default">$isFile </span><span class="keyword">= </span><span class="default">is_uploaded_file</span><span class="keyword">(</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'Filedata'</span><span class="keyword">][</span><span class="string">'tmp_name'</span><span class="keyword">]);
<br />
if (</span><span class="default">$isFile</span><span class="keyword">)&nbsp; &nbsp; </span><span class="comment">//&nbsp; do we have a file?
<br />
&nbsp;&nbsp; </span><span class="keyword">{</span><span class="comment">//&nbsp; sanatize file name
<br />
&nbsp;&nbsp;&nbsp; //&nbsp; &nbsp;&nbsp; - remove extra spaces/convert to _, 
<br />
&nbsp;&nbsp;&nbsp; //&nbsp; &nbsp;&nbsp; - remove non 0-9a-Z._- characters,
<br />
&nbsp;&nbsp;&nbsp; //&nbsp; &nbsp;&nbsp; - remove leading/trailing spaces
<br />
&nbsp;&nbsp;&nbsp; //&nbsp; check if under 5MB, 
<br />
&nbsp;&nbsp;&nbsp; //&nbsp; check file extension for legal file types
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$safe_filename </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; array(</span><span class="string">"/\s+/"</span><span class="keyword">, </span><span class="string">"/[^-\.\w]+/"</span><span class="keyword">), 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; array(</span><span class="string">"_"</span><span class="keyword">, </span><span class="string">""</span><span class="keyword">), 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'Filedata'</span><span class="keyword">][</span><span class="string">'name'</span><span class="keyword">]));
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'Filedata'</span><span class="keyword">][</span><span class="string">'size'</span><span class="keyword">] &lt;= </span><span class="default">$MAXIMUM_FILESIZE </span><span class="keyword">&amp;&amp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">preg_match</span><span class="keyword">(</span><span class="default">$rEFileTypes</span><span class="keyword">, </span><span class="default">strrchr</span><span class="keyword">(</span><span class="default">$safe_filename</span><span class="keyword">, </span><span class="string">'.'</span><span class="keyword">)))
<br />
&nbsp;&nbsp; &nbsp;&nbsp; {</span><span class="default">$isMove </span><span class="keyword">= </span><span class="default">move_uploaded_file </span><span class="keyword">(
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'Filedata'</span><span class="keyword">][</span><span class="string">'tmp_name'</span><span class="keyword">], 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$dir_base</span><span class="keyword">.</span><span class="default">$safe_filename</span><span class="keyword">);}
<br />
&nbsp;&nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; } 
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
I use $isFile and $isMove later in the code for error recording.
<br />

<br />
Make sure your system has the appropriate file loading limits. This caused a lot of headeaches trying to figure out why some files loaded and some did not.&nbsp;&nbsp; In my case I have an .htaccess file in the root of the web site with:
<br />

<br />
php_value post_max_size 16M
<br />
php_value upload_max_filesize 6M
<br />

<br />
You may also need to extend the execution time depending upon the amount of data being transferred.
<br />

<br />
(sorry if spacing of code is a little off.&nbsp; it was hard to make the note editor like the code style.)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86332""></a>
  <div class="note">
   <strong class="user">Dan Delaney</strong>
   <a href="#86332" class="date">13-Oct-2008 01:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For those using PHP on Windows and IIS, you SHOULD set the "upload_tmp_dir" value in php.ini to some directory around where your websites directory is, create that directory, and then set the same permissions on it that you have set for your websites directory. Otherwise, when you upload a file and it goes into C:\WINDOWS\Temp, then you move it to your website directory, its permissions will NOT be set correctly. This will cause you problems if you then want to manipulate that file with something like ImageMagick's convert utility.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85371""></a>
  <div class="note">
   <strong class="user">Mark Kazemier</strong>
   <a href="#85371" class="date">27-Aug-2008 09:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I have the same problem as the person two comments below me. When I use the move_uploaded_file function the permissions for the file are set to 0600. No matter what configurations you set.<br />
<br />
I searched the internet and I found more people with the same problems, but no solutions. I set the umask of apache to 013 and still the files were set to 0600. <br />
<br />
The copy function solves the problem. Another way to solve this problem is using the chmod function after uploading.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85286""></a>
  <div class="note">
   <strong class="user">agan0052 at hotmail dot com</strong>
   <a href="#85286" class="date">23-Aug-2008 12:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php <br />
<br />
</span><span class="keyword">if(isset(</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'uploaded'</span><span class="keyword">])){<br />
</span><span class="default">$target </span><span class="keyword">= </span><span class="string">"galleries/"</span><span class="keyword">.</span><span class="default">basename</span><span class="keyword">(</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'uploaded'</span><span class="keyword">][</span><span class="string">'name'</span><span class="keyword">]) ;<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$_FILES</span><span class="keyword">);<br />
<br />
if(</span><span class="default">move_uploaded_file</span><span class="keyword">(</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'uploaded'</span><span class="keyword">][</span><span class="string">'tmp_name'</span><span class="keyword">],</span><span class="default">$target</span><span class="keyword">)) echo </span><span class="string">"OK!"</span><span class="keyword">;</span><span class="comment">//$chmod o+rw galleries<br />
<br />
</span><span class="keyword">}<br />
else{<br />
&nbsp;echo </span><span class="string">"&lt;form enctype='multipart/form-data' action='CodeTool.php' method='POST'&gt;"</span><span class="keyword">;<br />
&nbsp;echo </span><span class="string">"File:&lt;input name='uploaded' type='file'/&gt;&lt;input type='submit' value='Upload'/&gt;"</span><span class="keyword">;<br />
&nbsp;echo </span><span class="string">"&lt;/form&gt;"</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85149""></a>
  <div class="note">
   <strong class="user">Florian S. in H. an der E. [.de]</strong>
   <a href="#85149" class="date">17-Aug-2008 02:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
move_uploaded_file (on my setup) always makes files 0600 ("rw- --- ---") and owned by the user running the webserver (owner AND group).<br />
Even though the directory has a sticky bit set to the group permissions!<br />
I couldn't find any settings to change this via php.ini or even using "umask()".<br />
<br />
I want my regular user on the server to be able to "tar cjf" the directory .. which would fail on files totally owned by the webserver-process-user;<br />
the "copy(from, to)" function obeys the sticky-bit though!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82065""></a>
  <div class="note">
   <strong class="user">jphansen at uga dot edu</strong>
   <a href="#82065" class="date">26-Mar-2008 07:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I was getting error code 1 (<a href="http://www.php.net/manual/en/features.file-upload.errors.php" rel="nofollow" target="_blank">http://www.php.net/manual/en/features.file-upload.errors.php</a>), indicating that the file exceeded upload_max_filesize. To fix this, run <span class="default">&lt;?php ini_set</span><span class="keyword">(</span><span class="string">"upload_max_filesize"</span><span class="keyword">, </span><span class="string">"100M"</span><span class="keyword">); </span><span class="default">?&gt;</span> (then restart apache) changing the second argument to your limit.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77661""></a>
  <div class="note">
   <strong class="user">iim dot vxk at gmail dot com</strong>
   <a href="#77661" class="date">07-Sep-2007 02:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
when you get this 2 Warnings - paths are a real sample - ::<br />
<br />
-<br />
move_uploaded_file(/uploads/images/sample.png) [function.move-uploaded-file]: failed to open stream: No such file or directory in /scripts/php/system/upload-file.php on line X<br />
-<br />
<br />
and<br />
<br />
-<br />
move_uploaded_file() [function.move-uploaded-file]: Unable to move '/tmp/somefilename' to '/uploads/images/sample.png' in /scripts/php/system/upload-file.php on line X<br />
-<br />
<br />
probably the path '/uploads/images/sample.png' is incomplete, in my case the complet path is "/home/x-user/public_html/uploads/images/sample.png"<br />
<br />
you can use getcwd() to know the current working directory.<br />
<br />
:)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76452""></a>
  <div class="note">
   <strong class="user">nlgordon at iastate dot edu</strong>
   <a href="#76452" class="date">16-Jul-2007 11:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just a helpful comment.&nbsp; If you have open_basedir set then you must set upload_tmp_dir to somewhere within the open_basedir.&nbsp; Otherwise the file upload will be denied.&nbsp; move_uploaded_file might be open_basedir aware, but the rest of the upload process isn't.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75654""></a>
  <div class="note">
   <strong class="user">bogusred</strong>
   <a href="#75654" class="date">10-Jun-2007 01:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you have a directory in a *nix environment where you store all of your file uploads and your php script only seems to work when permissions for that directory are set to 777, here's how to fix it so that you can have the security benefits of 755 while still allowing your php scripts to work, including the move_uploaded_file().<br />
<br />
through shell access, navigate to the directory that contains your uploads folder and run the following 2 commands:<br />
chown -R nobody uploaddir<br />
chmod -R 755 uploaddir<br />
<br />
Replace 'uploaddir' with the name of your uploads directory. The first command changes the owner of the directory and files to 'nobody' which is what php operates under. The second changes the folder and files to only allow user access to writing. This is much more secure.<br />
<br />
Hopefully this will help someone out there who had the same problem as me.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75451""></a>
  <div class="note">
   <strong class="user">masahigo at gmail dot com</strong>
   <a href="#75451" class="date">30-May-2007 08:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I found a great resource concerning uploads with PHP:<br />
<br />
<a href="http://www.radinks.com/upload/config.php" rel="nofollow" target="_blank">http://www.radinks.com/upload/config.php</a><br />
<br />
They explain and tell how to optimize PHP installation to handle large file uploads. Helped me a lot!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74933""></a>
  <div class="note">
   <strong class="user">info at arpadh dot hu</strong>
   <a href="#74933" class="date">04-May-2007 11:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Values upload_max_filesize and post_max_size (ie. php.ini values) cannot be modified in runtime with ini_set() function.<br />
If you are using Apache web server, use .htaccess files with an IfModule replacing values corresponding to your file size and PHP version:<br />
<br />
&lt;IfModule mod_php4.c&gt;<br />
php_value upload_max_filesize 50M<br />
php_value post_max_size 50M<br />
&lt;/IfModule&gt;<br />
<br />
- means 50MB upload limit.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74602""></a>
  <div class="note">
   <strong class="user">booc0mtaco at gmail dot com</strong>
   <a href="#74602" class="date">19-Apr-2007 08:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Also, make sure that the setting for the post_max_size allows for a proper file size range.<br />
<br />
post_max_size = 128M ; Expands the size of POST data for file uploads</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74067""></a>
  <div class="note">
   <strong class="user">guy at neonxero dot net</strong>
   <a href="#74067" class="date">22-Mar-2007 07:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I could be wrong, but I usualy use <br />
<br />
$uploadext = strtolower(strrchr($imagename,"."));<br />
<br />
to find the file extension when uploading, as opposed to explode().</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73698""></a>
  <div class="note">
   <strong class="user">Harmor</strong>
   <a href="#73698" class="date">06-Mar-2007 09:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
the dot only dot storm at gmail dot com wrote:<br />
&gt;<br />
&gt; In addition to the file extension checking. A simply way<br />
&gt; of getting the extension (regardless of size):<br />
&gt; <br />
&gt; $efilename = explode('.', $filename);<br />
&gt; $ext = $efilename[count($efilename) - 1];<br />
&gt;<br />
<br />
How about:<br />
<br />
$ext = end(explode('.',$filename));</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="72861""></a>
  <div class="note">
   
   <a href="#72861" class="date">03-Feb-2007 07:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you find that large files do not upload in PHP even though you've changed the max_upload_size , this is because you need to change the max memory size varible too. The entire file is loaded into memory before it is saved to disk.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69555""></a>
  <div class="note">
   <strong class="user">shacker at birdhouse dot org</strong>
   <a href="#69555" class="date">10-Sep-2006 12:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you're dealing with files uploaded through some external FTP source and need to move them to a final destination, searching php.net for "mv" or "move" won't get you what you want. You want the rename() function. <br />
<br />
<a href="http://www.php.net/manual/en/function.rename.php" rel="nofollow" target="_blank">http://www.php.net/manual/en/function.rename.php</a><br />
<br />
(move_uploaded_file() won't work, since the POST vars won't be present.)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69096""></a>
  <div class="note">
   <strong class="user">Rob Szarka</strong>
   <a href="#69096" class="date">22-Aug-2006 06:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Apparently the warning above might better be written "If the destination file already exists, it will be overwritten ... regardless of the destination file's permissions."<br />
<br />
In other words, move_uploaded_file() executes as if it's root, not the user under which the web server is operating or the owner of the script that's executing.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="64799""></a>
  <div class="note">
   <strong class="user">sergeygrinev at mail dot ru</strong>
   <a href="#64799" class="date">20-Apr-2006 02:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
small typo:<br />
<br />
$fulldest = $dest.$newfilename;<br />
<br />
show be<br />
<br />
$fulldest = $dest.$filename;<br />
<br />
or you would have infinite loop.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="64418""></a>
  <div class="note">
   <strong class="user">Zarel</strong>
   <a href="#64418" class="date">13-Apr-2006 06:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
nouncad at mayetlite dot com posted a function that uploaded a file, and would rename it if it already existed, to filename[n].ext<br />
<br />
It only worked for files with extensions exactly three letters long, so I fixed that (and made a few other improvements while I was at it).<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// Usage: uploadfile($_FILE['file']['name'],'temp/',$_FILE['file']['tmp_name'])<br />
</span><span class="keyword">function </span><span class="default">uploadfile</span><span class="keyword">(</span><span class="default">$origin</span><span class="keyword">, </span><span class="default">$dest</span><span class="keyword">, </span><span class="default">$tmp_name</span><span class="keyword">)<br />
{<br />
&nbsp; </span><span class="default">$origin </span><span class="keyword">= </span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">basename</span><span class="keyword">(</span><span class="default">$origin</span><span class="keyword">));<br />
&nbsp; </span><span class="default">$fulldest </span><span class="keyword">= </span><span class="default">$dest</span><span class="keyword">.</span><span class="default">$origin</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$filename </span><span class="keyword">= </span><span class="default">$origin</span><span class="keyword">;<br />
&nbsp; for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">; </span><span class="default">file_exists</span><span class="keyword">(</span><span class="default">$fulldest</span><span class="keyword">); </span><span class="default">$i</span><span class="keyword">++)<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fileext </span><span class="keyword">= (</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$origin</span><span class="keyword">,</span><span class="string">'.'</span><span class="keyword">)===</span><span class="default">false</span><span class="keyword">?</span><span class="string">''</span><span class="keyword">:</span><span class="string">'.'</span><span class="keyword">.</span><span class="default">substr</span><span class="keyword">(</span><span class="default">strrchr</span><span class="keyword">(</span><span class="default">$origin</span><span class="keyword">, </span><span class="string">"."</span><span class="keyword">), </span><span class="default">1</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$filename </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$origin</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$origin</span><span class="keyword">)-</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$fileext</span><span class="keyword">)).</span><span class="string">'['</span><span class="keyword">.</span><span class="default">$i</span><span class="keyword">.</span><span class="string">']'</span><span class="keyword">.</span><span class="default">$fileext</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fulldest </span><span class="keyword">= </span><span class="default">$dest</span><span class="keyword">.</span><span class="default">$newfilename</span><span class="keyword">;<br />
&nbsp; }<br />
&nbsp; <br />
&nbsp; if (</span><span class="default">move_uploaded_file</span><span class="keyword">(</span><span class="default">$tmp_name</span><span class="keyword">, </span><span class="default">$fulldest</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$filename</span><span class="keyword">;<br />
&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="61968""></a>
  <div class="note">
   <strong class="user">j dot m dot thomas at NOSPAM dot blueyonder dot co dot uk</strong>
   <a href="#61968" class="date">16-Feb-2006 12:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To retrieve the file extension, and various other information about the path, it is easiest to use the pathinfo function.<br />
<br />
<span class="default">&lt;?php<br />
$path_parts </span><span class="keyword">= </span><span class="default">pathinfo</span><span class="keyword">(</span><span class="string">'/www/htdocs/index.html'</span><span class="keyword">);<br />
<br />
echo </span><span class="default">$path_parts</span><span class="keyword">[</span><span class="string">'dirname'</span><span class="keyword">], </span><span class="string">"\n"</span><span class="keyword">;<br />
echo </span><span class="default">$path_parts</span><span class="keyword">[</span><span class="string">'basename'</span><span class="keyword">], </span><span class="string">"\n"</span><span class="keyword">;<br />
echo </span><span class="default">$path_parts</span><span class="keyword">[</span><span class="string">'extension'</span><span class="keyword">], </span><span class="string">"\n"</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
Would produce:<br />
<br />
/www/htdocs<br />
index.html<br />
html<br />
<br />
<a href="http://uk.php.net/manual/en/function.pathinfo.php" rel="nofollow" target="_blank">http://uk.php.net/manual/en/function.pathinfo.php</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="60521""></a>
  <div class="note">
   <strong class="user">mancow at macfilez dot net</strong>
   <a href="#60521" class="date">09-Jan-2006 09:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To nouncad at mayetlite dot com,<br />
<br />
That function will work fine for files with a 3-character file extension.&nbsp; However, it is worth noting that there are valid, registered file extensions that are longer than 3 characters.&nbsp; For example, a JPEG file can be denoted by *.jpg (and others), but it can also have *.jpeg as a valid extension.&nbsp; Check out <a href="http://www.filext.com/ for a good reference of file extensions." rel="nofollow" target="_blank">http://www.filext.com/ for a good reference of file extensions.</a><br />
<br />
The best bet to me would be parsing the uploaded file's name ($_FILES['uploadedfile']['name']) based on the presence of dots.&nbsp; Another wrench in the gears:&nbsp; a file can have dots in the filename.&nbsp; That's easy enough to handle -- just explode() the file name and hope that the last element in the array it gives you is the file extension (you can always validate it if you're so inclined).&nbsp; Then just piece it together in a string accordingly by stepping through the array (don't forget to add those dots back to where they were!), appending a guaranteed unique string of characters (or enumerate it like you were doing, keeping track via a loop), and finally tacking on the file extension.<br />
<br />
You may have other mechanisms for verifying a file's extension, such as a preg_match on the whole name, using something like "/\\.(gif|jpg|jpeg|png|bmp)$/i" (more can, of course, be added if you so desire) for the most common types of images found on the web.<br />
<br />
For blindly guaranteeing an uploaded file will be uniquely named, this seems like a fantastic way to go.&nbsp; Enjoy!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="58541""></a>
  <div class="note">
   <strong class="user">ineedmynetwork.com</strong>
   <a href="#58541" class="date">07-Nov-2005 01:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Microsoft returns image/pjpeg not image/jpg when using $_FILES['imageName']['type'];</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="57959""></a>
  <div class="note">
   <strong class="user">jest3r at mtonic dot net</strong>
   <a href="#57959" class="date">19-Oct-2005 09:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It seems that move_uploaded_file use the GROUP permissions of the parent directory of the tmp file location, whereas a simple "copy" uses the group of the apache process. This could create a security nighmare if your tmp file location is owned by root:wheel</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="56533""></a>
  <div class="note">
   <strong class="user">mikelone</strong>
   <a href="#56533" class="date">06-Sep-2005 08:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If the user try to upload a too bigger file then the upload procedure will fail even if u have established an error message.<br />
How to avoid this problem? there's my solution:<br />
<br />
(max_file_size = 2,50 MB)<br />
<br />
$fsize = $_FILES["userfile"]["size"];<br />
<br />
if($fsize == 0 || $fsize &gt; 2621000) exit("keep the filesize under 2,50MB!!");<br />
<br />
When the size is bigger than the MAX_FILE_SIZE field, the value of $fsize is equal to 0 (zero) ......</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="55200""></a>
  <div class="note">
   <strong class="user">espiao at gmail dot com</strong>
   <a href="#55200" class="date">27-Jul-2005 07:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
/**<br />
&nbsp;* This function moves the archives and directoryes of a directory of<br />
&nbsp;* origin for a directory destination being able replace them or not.<br />
&nbsp;**/<br />
<br />
function mvdir($oldDir, $newDir, $replaceFiles = true) {<br />
<br />
&nbsp;&nbsp;&nbsp; if ($oldDir == $newDir) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; trigger_error("Destination directory is equal of origin.");<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return false;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; if (!($tmpDir = opendir($oldDir))) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; trigger_error("It was not possible to open origin directory.");<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return false;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; if (!is_dir($newDir)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; trigger_error("It was not possible to open destination directory.");<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return false;&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; while (($file = readdir($tmpDir)) !== false) {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (($file != ".") &amp;&amp; ($file !== "..")) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $oldFileWithDir = $oldDir . $file;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $newFileWithDir = $newDir . $file;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (is_dir($oldFileWithDir)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; @mkdir($newFileWithDir."/", 0777);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; @mvdir($oldFileWithDir."/", $newFileWithDir."/", $replaceFiles);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; @rmdir($oldFileWithDir);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (file_exists($newFileWithDir)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!$replaceFiles) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; @unlink($oldFileWithDir);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; continue;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; @unlink($newFileWithDir);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; @copy($oldFileWithDir, $newFileWithDir);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; @chmod($newFileWithDir, 0777);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; @unlink($oldFileWithDir);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; return true;<br />
&nbsp;&nbsp;&nbsp; <br />
}<br />
<br />
/**<br />
&nbsp;* This is an example of move with replace files on destination folder if <br />
&nbsp;* exists files with the same names on destionatio folder<br />
&nbsp;**/<br />
mvdir("/var/www/example/", "/var/www/other_folder/");<br />
<br />
/**<br />
&nbsp;* This is an example of move without replace files on destination<br />
&nbsp;* folder if&nbsp; exists files with the same names on destionatio folder<br />
&nbsp;**/<br />
mvdir("/var/www/example/", "/var/www/other_folder/", false);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="50055""></a>
  <div class="note">
   <strong class="user">Michel S</strong>
   <a href="#50055" class="date">16-Feb-2005 09:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I once had a problem with this function. File was uploaded correctly, but I still had to chmod the file afterwards. It could not be used otherwise.<br />
<br />
Michel S</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="40569""></a>
  <div class="note">
   <strong class="user">sauron at nospam on morannon dot org</strong>
   <a href="#40569" class="date">08-Mar-2004 05:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
An extension only does not really tell you what type of file it really is. I can easily rename a .jpg file to a .zip file and make the server think it is a ZIP file with webmaster kobrasrealm's code.<br />
<br />
A better way is to use the Linux utility "file" to determine the file type. Although I'm aware that some users might use Windows on their webservers, I thought it's worth&nbsp; mentioning the utility here. Using the backtick operators and preg_matches on the output, you can easily determine the file type safely, and fix the extension when necessary.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
