<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>设定用于一个脚本中所有日期时间函数的默认时区</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.date-default-timezone-get.html">? date_default_timezone_get</a></li>
      <li style="float: right;"><a href="function.date-diff.html">date_diff ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.datetime.html">Date/Time 函数</a></li>
    <li>设定用于一个脚本中所有日期时间函数的默认时区</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.date-default-timezone-set" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">date_default_timezone_set</h1>
  <p class="verinfo">(PHP 5 &gt;= 5.1.0, PHP 7)</p><p class="refpurpose"><span class="refname">date_default_timezone_set</span> &mdash; <span class="dc-title">设定用于一个脚本中所有日期时间函数的默认时区</span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.date-default-timezone-set-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>date_default_timezone_set</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$timezone_identifier</code></span>
   ) : <span class="type">bool</span></div>

  <p class="para rdfs-comment">
   <span class="function"><strong>date_default_timezone_set()</strong></span> 设定用于所有日期时间函数的默认时区。
  </p>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    自 PHP 5.1.0 起（此版本日期时间函数被重写了），如果时区不合法则每个对日期时间函数的调用都会产生一条
    <strong><code>E_NOTICE</code></strong> 级别的错误信息，如果使用系统设定或
    <var class="varname"><var class="varname">TZ</var></var> 环境变量则还会产生 <strong><code>E_STRICT</code></strong> 级别的信息。
   </p>
  </p></blockquote>
 <p class="para">
  除了用此函数，你还可以通过 INI 设置 <a href="datetime.configuration.html#ini.date.timezone" class="link">date.timezone</a>  来设置默认时区。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.date-default-timezone-set-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">timezone_identifier</code></dt>

     <dd>

      <p class="para">
       时区标识符，例如 <em>UTC</em> 或
       <em>Europe/Lisbon</em>。合法标识符列表见<a href="timezones.html" class="xref">所支持的时区列表</a>。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.date-default-timezone-set-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   如果 <code class="parameter">timezone_identifier</code> 参数无效则返回 <strong><code>FALSE</code></strong>，否则返回 <strong><code>TRUE</code></strong>。
  </p>
 </div>



 <div class="refsect1 examples" id="refsect1-function.date-default-timezone-set-examples">
  <h3 class="title">范例</h3>
  <p class="para">
   <div class="example" id="example-2736">
    <p><strong>Example #1 获取默认时区</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />date_default_timezone_set</span><span style="color: #007700">(</span><span style="color: #DD0000">'America/Los_Angeles'</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$script_tz&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">date_default_timezone_get</span><span style="color: #007700">();<br /><br />if&nbsp;(</span><span style="color: #0000BB">strcmp</span><span style="color: #007700">(</span><span style="color: #0000BB">$script_tz</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">ini_get</span><span style="color: #007700">(</span><span style="color: #DD0000">'date.timezone'</span><span style="color: #007700">))){<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">'Script&nbsp;timezone&nbsp;differs&nbsp;from&nbsp;ini-set&nbsp;timezone.'</span><span style="color: #007700">;<br />}&nbsp;else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">'Script&nbsp;timezone&nbsp;and&nbsp;ini-set&nbsp;timezone&nbsp;match.'</span><span style="color: #007700">;<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.date-default-timezone-set-changelog">
  <h3 class="title">更新日志</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead>
      <tr>
       <th>版本</th>
       <th>说明</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
       <td>5.3.0</td>
       <td>
        现在会抛出 <strong><code>E_WARNING</code></strong> 而不是
        <strong><code>E_STRICT</code></strong>。
       </td>
      </tr>

      <tr>
       <td>5.1.2</td>
       <td>本版本开始验证 <code class="parameter">timezone_identifier</code> 参数。
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.date-default-timezone-set-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.date-default-timezone-get.html" class="function" rel="rdfs-seeAlso">date_default_timezone_get()</a> - 取得一个脚本中所有日期时间函数所使用的默认时区</span></li>
    <li class="member"><a href="timezones.html" class="xref">所支持的时区列表</a></li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="124441""></a>
  <div class="note">
   <strong class="user">Pierre-Olivier Vares</strong>
   <a href="#124441" class="date">27-Nov-2019 07:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As Christopher Kramer said 9 years ago, not setting default timezone has performance impacts on PHP 5.6, and on PHP 7.1<br />
<br />
It hasn't on php 7.2 anymore.<br />
<br />
As I set error_reporting to 0 in my script, it doesn't seem linked to the fact it is logging the error.<br />
<br />
I ran its benchmark script (modified) on Linux multiple times, alternating 'on' and 'off' setting :<br />
<br />
<span class="default">&lt;?php<br />
error_reporting</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">);<br />
<br />
</span><span class="default">$tz </span><span class="keyword">= (</span><span class="default">$argc </span><span class="keyword">&gt; </span><span class="default">1 </span><span class="keyword">&amp;&amp; (</span><span class="default">$argv</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] == </span><span class="string">'on'</span><span class="keyword">)) ? </span><span class="string">'on'</span><span class="keyword">: </span><span class="string">'off'</span><span class="keyword">;<br />
if (</span><span class="default">$tz </span><span class="keyword">== </span><span class="string">'on'</span><span class="keyword">) </span><span class="default">date_default_timezone_set</span><span class="keyword">(@</span><span class="default">date_default_timezone_get</span><span class="keyword">());<br />
<br />
</span><span class="default">$start</span><span class="keyword">=</span><span class="default">mktime</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">2005</span><span class="keyword">);<br />
</span><span class="default">$end</span><span class="keyword">=</span><span class="default">mktime</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">2020</span><span class="keyword">);<br />
<br />
</span><span class="default">$t0</span><span class="keyword">=</span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br />
for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">50000</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) </span><span class="default">date</span><span class="keyword">(</span><span class="string">"H:i:s d.m.Y"</span><span class="keyword">,</span><span class="default">rand</span><span class="keyword">(</span><span class="default">$start</span><span class="keyword">,</span><span class="default">$end</span><span class="keyword">));<br />
<br />
echo </span><span class="string">"Time (</span><span class="default">$tz</span><span class="string">): "</span><span class="keyword">.((</span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">) - </span><span class="default">$t0</span><span class="keyword">)*</span><span class="default">100</span><span class="keyword">).</span><span class="string">"\n"</span><span class="keyword">;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="123771""></a>
  <div class="note">
   <strong class="user">Joey</strong>
   <a href="#123771" class="date">11-Apr-2019 07:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
&gt; I'm sure I'm not the only one who is distressed by the recent default behavior change to E_NOTICE when the timezone isn't explicitly set in the program or in .ini.<br />
<br />
You should always turn on notices and have a customer error handler that converts notices or indeed any PHP message to exceptions.<br />
<br />
I've been doing this for years and it looks like expanding the use of exceptions in PHP itself is an ongoing process. It's almost certainly stuck with notices from legacy patterns prior to PHP possessing exception capability with the reason it's not been thoroughly applied being BC breakage.<br />
<br />
Even in my extensions I redirect notices and warnings to exceptions. I'm certain the whole pressure for the ?? operator was to facilitate errors to exceptions as the only real drawback of that is needing to use isset a fair bit more.<br />
<br />
Similar for asserts, json, etc, etc it all to use exceptions.<br />
<br />
Another note. I profiled my PHP script and it reported that calling this function took half the time. Anyone else got this? Is it really that expensive? Am I doubling init time not having it in php.ini and possibly setting to the timezone it's already on? Or is it messing with time and breaking the time measurement? One day I'll bother to wrap it in microtime to try to see.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="122453""></a>
  <div class="note">
   <strong class="user">orynider at gmail dot com</strong>
   <a href="#122453" class="date">27-Feb-2018 10:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
//Temp fix for timezone submited @ phpbb.com in 2014<br />
if (@function_exists('date_default_timezone_set') &amp;&amp; @function_exists('date_default_timezone_get'))<br />
{<br />
&nbsp;&nbsp;&nbsp; @date_default_timezone_set(@date_default_timezone_get());<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="121800""></a>
  <div class="note">
   <strong class="user">Lance E Sloan</strong>
   <a href="#121800" class="date">27-Oct-2017 02:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I avoid using strings as arguments when a constant or other kind of reference should be used.&nbsp; For example, to set the default timezone to UTC, the recommended code is:<br />
<br />
<span class="default">&lt;?php<br />
date_default_timezone_set</span><span class="keyword">(</span><span class="string">'UTC'</span><span class="keyword">); </span><span class="comment">// Potential for mistakes<br />
</span><span class="default">?&gt;<br />
</span><br />
However, using the string "UTC" here opens up the possibility for mistakes.&nbsp; For example, if the string "UTX" were entered accidentally,<br />
most PHP editors PHP won't flag that as an error.&nbsp; When run, the interpreter will show the common warning about a misspelled timezone and using "UTC" by default.&nbsp; <br />
<br />
PHP should define constants to represent the major timezones.&nbsp; Actually it does, but "DateTimeZone::UTC" inconveniently contains the integer value 1024, not a string.&nbsp; However, "DateTimeZone::listIdentifiers()" can turn a timezone integer into an array of timezone identifier strings.&nbsp; So, I use this code:<br />
<br />
<span class="default">&lt;?php<br />
date_default_timezone_set</span><span class="keyword">(</span><span class="default">DateTimeZone</span><span class="keyword">::</span><span class="default">listIdentifiers</span><span class="keyword">(</span><span class="default">DateTimeZone</span><span class="keyword">::</span><span class="default">UTC</span><span class="keyword">)[</span><span class="default">0</span><span class="keyword">]);&nbsp; </span><span class="comment">// Foolproof<br />
</span><span class="default">?&gt;<br />
</span><br />
It's longer, but if I make a mistake specifying the timezone (which I won't because I use code completion), my editor would highlight the problem. If I ran the program with an invalid timezone reference anyway, PHP would give the more helpful error, "Fatal error: Undefined class constant 'UTX' in /tmp/tarfu.php on line 24".</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="117130""></a>
  <div class="note">
   <strong class="user">Jesse dot Chisholm at gmail dot com</strong>
   <a href="#117130" class="date">19-Apr-2015 12:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I found a need to change the timezone based on a DB record, so it would display properly for each record.&nbsp; So I wrapped some of the other posts into this small class:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">TZStack<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$stack </span><span class="keyword">= array();<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__construct</span><span class="keyword">(){}<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">push</span><span class="keyword">(</span><span class="default">$newTZ</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">array_push</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">stack</span><span class="keyword">, </span><span class="default">date_default_timezone_get</span><span class="keyword">());<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (isset(</span><span class="default">$newTZ</span><span class="keyword">) &amp;&amp; (</span><span class="string">"" </span><span class="keyword">!= </span><span class="default">$newTZ</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">date_default_timezone_set</span><span class="keyword">(</span><span class="default">$newTZ</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">pop</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">count</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">stack</span><span class="keyword">) &gt; </span><span class="default">0</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">date_default_timezone_set</span><span class="keyword">(</span><span class="default">array_pop</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">stack</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="comment">// the global TZ stack for the rest of the code&nbsp; to use.<br />
</span><span class="default">$tzStack </span><span class="keyword">= new </span><span class="default">TZStack</span><span class="keyword">();<br />
</span><span class="comment">// In case I need to know the TZ at the web server. :)<br />
</span><span class="default">$script_tz </span><span class="keyword">= </span><span class="default">date_default_timezone_get</span><span class="keyword">();<br />
</span><span class="default">?&gt;<br />
</span><br />
Then in my per-record code:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">foreach(</span><span class="default">$records </span><span class="keyword">as </span><span class="default">$item</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tzStack</span><span class="keyword">-&gt;</span><span class="default">push</span><span class="keyword">(</span><span class="default">$item</span><span class="keyword">[</span><span class="string">'TZ'</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$TZ </span><span class="keyword">= </span><span class="default">date</span><span class="keyword">(</span><span class="string">"T"</span><span class="keyword">, </span><span class="default">time</span><span class="keyword">());<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// code that displays this record, using $TZ.<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tzStack</span><span class="keyword">-&gt;</span><span class="default">pop</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="116430""></a>
  <div class="note">
   <strong class="user">Anteaus</strong>
   <a href="#116430" class="date">02-Jan-2015 12:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This creates a huge problem for downloadable programs, which obviously cannot be hardcoded as this suggests, since the coder has no idea where they will be run.<br />
<br />
Seems to me that if the server's timezone cannot be relied on, then THAT is the the problem which needs fixed. Not, cause the coder's syntactically-correct work to generate bogus error messages.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="115128""></a>
  <div class="note">
   <strong class="user">Taylor</strong>
   <a href="#115128" class="date">30-May-2014 09:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I was having major issues with the date.timezone setting after I updated from 5.3.3 to 5.4.29. I still need to update further, and perhaps it's a bug in this version that will be fixed when I update..<br />
<br />
But to fix the issue of php not being about to find my time zone, I added a .htaccess file to the root of my web directory. All I have in it is this one line (without quotes)<br />
<br />
"php_value date.timezone America/Denver"<br />
<br />
And now the timezone is set in any directory I browse in. Very strange, and I still haven't figured out why It wont work from the php.ini file. But here's how to overcome the frustration.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="113864""></a>
  <div class="note">
   <strong class="user">chris at clwill dot com</strong>
   <a href="#113864" class="date">10-Dec-2013 11:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I'm sure I'm not the only one who is distressed by the recent default behavior change to E_NOTICE when the timezone isn't explicitly set in the program or in .ini.&nbsp; I insure that the clock on the server IS correct, and I don't want to have to set it in two places (the system AND PHP).&nbsp; So I want to read it from the system.&nbsp; But PHP won't accept that answer, and insists on a call to this function.&nbsp; So, here's my answer:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;</span><span class="keyword">function </span><span class="default">setTimezone</span><span class="keyword">(</span><span class="default">$default</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$timezone </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// On many systems (Mac, for instance) "/etc/localtime" is a symlink<br />
&nbsp;&nbsp;&nbsp; // to the file with the timezone info<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">is_link</span><span class="keyword">(</span><span class="string">"/etc/localtime"</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// If it is, that file's name is actually the "Olsen" format timezone<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$filename </span><span class="keyword">= </span><span class="default">readlink</span><span class="keyword">(</span><span class="string">"/etc/localtime"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pos </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">, </span><span class="string">"zoneinfo"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$pos</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// When it is, it's in the "/usr/share/zoneinfo/" folder<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$timezone </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">, </span><span class="default">$pos </span><span class="keyword">+ </span><span class="default">strlen</span><span class="keyword">(</span><span class="string">"zoneinfo/"</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// If not, bail<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$timezone </span><span class="keyword">= </span><span class="default">$default</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// On other systems, like Ubuntu, there's file with the Olsen time<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // right inside it.<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$timezone </span><span class="keyword">= </span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="string">"/etc/timezone"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$timezone</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$timezone </span><span class="keyword">= </span><span class="default">$default</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">date_default_timezone_set</span><span class="keyword">(</span><span class="default">$timezone</span><span class="keyword">);<br />
&nbsp;}<br />
</span><span class="default">?&gt;<br />
</span><br />
Use it by calling it with a fallback default answer.<br />
<br />
Yes, I know it doesn't work on Windows.&nbsp; Neither do I :)&nbsp; Perhaps someone wants to add that functionality.<br />
<br />
Hope this helps someone.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="111624""></a>
  <div class="note">
   <strong class="user">Christopher Kramer</strong>
   <a href="#111624" class="date">09-Mar-2013 09:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Regarding my post 3 years before:<br />
The performance impact seems to be caused by the fact that a log message is written if you do not set a timezone. And writing a log message to disk can take significantly longer than actually calculating date() or getdate() - esp. on systems with slow IO like the Windows machine I used 3 years ago.<br />
<br />
PHP 4 did not produce any log messages, and therefore was as fast as PHP5 with a timezone set.<br />
<br />
So if you run date() or getdate() a lot of times, this will cause a lot of log messages to be written to disk (if you did not disable them in your php.ini settings), which will take its time.<br />
<br />
So either use this function or set the ini-setting "date.timezone" to make things faster.<br />
(And have a look into your logfiles! Solving all those warnings will not only save you disk space but will also speed up your web application.)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="109321""></a>
  <div class="note">
   <strong class="user">Pierre Gourlaouen</strong>
   <a href="#109321" class="date">06-Jul-2012 08:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A simple method for conversation between two time zone.
<br />

<br />
<span class="default">&lt;?php
<br />
$date </span><span class="keyword">= new </span><span class="default">DateTime</span><span class="keyword">(</span><span class="string">"2012-07-05 16:43:21"</span><span class="keyword">, new </span><span class="default">DateTimeZone</span><span class="keyword">(</span><span class="string">'Europe/Paris'</span><span class="keyword">));
<br />

<br />
</span><span class="default">date_default_timezone_set</span><span class="keyword">(</span><span class="string">'America/New_York'</span><span class="keyword">);
<br />

<br />
echo </span><span class="default">date</span><span class="keyword">(</span><span class="string">"Y-m-d h:iA"</span><span class="keyword">, </span><span class="default">$date</span><span class="keyword">-&gt;</span><span class="default">format</span><span class="keyword">(</span><span class="string">'U'</span><span class="keyword">));
<br />

<br />
</span><span class="comment">// 2012-07-05 10:43AM
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="107297""></a>
  <div class="note">
   <strong class="user">daneiracleous at gmail dot com</strong>
   <a href="#107297" class="date">28-Jan-2012 08:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to set the default timezone to the user's local timezone, you have to combine PHP and JavaScript. Here's how to do it:<br />
<br />
<span class="default">&lt;?php<br />
session_start</span><span class="keyword">();<br />
if(!isset(</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'timezone'</span><span class="keyword">]))<br />
{<br />
&nbsp;&nbsp;&nbsp; if(!isset(</span><span class="default">$_REQUEST</span><span class="keyword">[</span><span class="string">'offset'</span><span class="keyword">]))<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">?&gt;<br />
</span>&nbsp; &nbsp; &lt;script&gt;<br />
&nbsp;&nbsp;&nbsp; var d = new Date()<br />
&nbsp;&nbsp;&nbsp; var offset= -d.getTimezoneOffset()/60;<br />
&nbsp;&nbsp;&nbsp; location.href = "<span class="default">&lt;?php </span><span class="keyword">echo </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_SELF'</span><span class="keyword">]; </span><span class="default">?&gt;</span>?offset="+offset;<br />
&nbsp;&nbsp;&nbsp; &lt;/script&gt;<br />
&nbsp;&nbsp;&nbsp; <span class="default">&lt;?php&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">}<br />
&nbsp;&nbsp;&nbsp; else<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$zonelist </span><span class="keyword">= array(</span><span class="string">'Kwajalein' </span><span class="keyword">=&gt; -</span><span class="default">12.00</span><span class="keyword">, </span><span class="string">'Pacific/Midway' </span><span class="keyword">=&gt; -</span><span class="default">11.00</span><span class="keyword">, </span><span class="string">'Pacific/Honolulu' </span><span class="keyword">=&gt; -</span><span class="default">10.00</span><span class="keyword">, </span><span class="string">'America/Anchorage' </span><span class="keyword">=&gt; -</span><span class="default">9.00</span><span class="keyword">, </span><span class="string">'America/Los_Angeles' </span><span class="keyword">=&gt; -</span><span class="default">8.00</span><span class="keyword">, </span><span class="string">'America/Denver' </span><span class="keyword">=&gt; -</span><span class="default">7.00</span><span class="keyword">, </span><span class="string">'America/Tegucigalpa' </span><span class="keyword">=&gt; -</span><span class="default">6.00</span><span class="keyword">, </span><span class="string">'America/New_York' </span><span class="keyword">=&gt; -</span><span class="default">5.00</span><span class="keyword">, </span><span class="string">'America/Caracas' </span><span class="keyword">=&gt; -</span><span class="default">4.30</span><span class="keyword">, </span><span class="string">'America/Halifax' </span><span class="keyword">=&gt; -</span><span class="default">4.00</span><span class="keyword">, </span><span class="string">'America/St_Johns' </span><span class="keyword">=&gt; -</span><span class="default">3.30</span><span class="keyword">, </span><span class="string">'America/Argentina/Buenos_Aires' </span><span class="keyword">=&gt; -</span><span class="default">3.00</span><span class="keyword">, </span><span class="string">'America/Sao_Paulo' </span><span class="keyword">=&gt; -</span><span class="default">3.00</span><span class="keyword">, </span><span class="string">'Atlantic/South_Georgia' </span><span class="keyword">=&gt; -</span><span class="default">2.00</span><span class="keyword">, </span><span class="string">'Atlantic/Azores' </span><span class="keyword">=&gt; -</span><span class="default">1.00</span><span class="keyword">, </span><span class="string">'Europe/Dublin' </span><span class="keyword">=&gt; </span><span class="default">0</span><span class="keyword">, </span><span class="string">'Europe/Belgrade' </span><span class="keyword">=&gt; </span><span class="default">1.00</span><span class="keyword">, </span><span class="string">'Europe/Minsk' </span><span class="keyword">=&gt; </span><span class="default">2.00</span><span class="keyword">, </span><span class="string">'Asia/Kuwait' </span><span class="keyword">=&gt; </span><span class="default">3.00</span><span class="keyword">, </span><span class="string">'Asia/Tehran' </span><span class="keyword">=&gt; </span><span class="default">3.30</span><span class="keyword">, </span><span class="string">'Asia/Muscat' </span><span class="keyword">=&gt; </span><span class="default">4.00</span><span class="keyword">, </span><span class="string">'Asia/Yekaterinburg' </span><span class="keyword">=&gt; </span><span class="default">5.00</span><span class="keyword">, </span><span class="string">'Asia/Kolkata' </span><span class="keyword">=&gt; </span><span class="default">5.30</span><span class="keyword">, </span><span class="string">'Asia/Katmandu' </span><span class="keyword">=&gt; </span><span class="default">5.45</span><span class="keyword">, </span><span class="string">'Asia/Dhaka' </span><span class="keyword">=&gt; </span><span class="default">6.00</span><span class="keyword">, </span><span class="string">'Asia/Rangoon' </span><span class="keyword">=&gt; </span><span class="default">6.30</span><span class="keyword">, </span><span class="string">'Asia/Krasnoyarsk' </span><span class="keyword">=&gt; </span><span class="default">7.00</span><span class="keyword">, </span><span class="string">'Asia/Brunei' </span><span class="keyword">=&gt; </span><span class="default">8.00</span><span class="keyword">, </span><span class="string">'Asia/Seoul' </span><span class="keyword">=&gt; </span><span class="default">9.00</span><span class="keyword">, </span><span class="string">'Australia/Darwin' </span><span class="keyword">=&gt; </span><span class="default">9.30</span><span class="keyword">, </span><span class="string">'Australia/Canberra' </span><span class="keyword">=&gt; </span><span class="default">10.00</span><span class="keyword">, </span><span class="string">'Asia/Magadan' </span><span class="keyword">=&gt; </span><span class="default">11.00</span><span class="keyword">, </span><span class="string">'Pacific/Fiji' </span><span class="keyword">=&gt; </span><span class="default">12.00</span><span class="keyword">, </span><span class="string">'Pacific/Tongatapu' </span><span class="keyword">=&gt; </span><span class="default">13.00</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$index </span><span class="keyword">= </span><span class="default">array_keys</span><span class="keyword">(</span><span class="default">$zonelist</span><span class="keyword">, </span><span class="default">$_REQUEST</span><span class="keyword">[</span><span class="string">'offset'</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'timezone'</span><span class="keyword">] = </span><span class="default">$index</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">date_default_timezone_set</span><span class="keyword">(</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'timezone'</span><span class="keyword">]);<br />
<br />
</span><span class="comment">//rest of your code goes here<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102187""></a>
  <div class="note">
   <strong class="user">power2all at gmail dot com</strong>
   <a href="#102187" class="date">01-Feb-2011 08:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
After poundering and knocking my head on the table, I finally got a proper fix for Windows and PHP timezone handling.<br />
<br />
Since Windows applies the DST to ActiveTimeBias in the registry, you only need this to apply.<br />
The only problem is, that it cant use the timezone_set command.<br />
<br />
You can request a response back in any date-format you wish, or use the default one given in the function itself.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">// Return proper time<br />
</span><span class="keyword">function </span><span class="default">time_zone_fix</span><span class="keyword">(</span><span class="default">$timeGiven </span><span class="keyword">= </span><span class="string">"H:i:s"</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$shell </span><span class="keyword">= new </span><span class="default">COM</span><span class="keyword">(</span><span class="string">"WScript.Shell"</span><span class="keyword">) or die(</span><span class="string">"Requires Windows Scripting Host"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$time_bias </span><span class="keyword">= -(</span><span class="default">$shell</span><span class="keyword">-&gt;</span><span class="default">RegRead</span><span class="keyword">(</span><span class="string">"HKEY_LOCAL_MACHINE\\SYSTEM\\<br />
CurrentControlSet\\Control\\TimeZoneInformation\\<br />
ActiveTimeBias"</span><span class="keyword">)) / </span><span class="default">60</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$timestamp_bias </span><span class="keyword">= </span><span class="default">60 </span><span class="keyword">* </span><span class="default">60 </span><span class="keyword">* </span><span class="default">$time_bias</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">$time_bias </span><span class="keyword">. </span><span class="string">"&lt;br /&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">gmdate</span><span class="keyword">(</span><span class="default">$timeGiven</span><span class="keyword">, </span><span class="default">strtotime</span><span class="keyword">(</span><span class="default">$timestamp_bias </span><span class="keyword">. </span><span class="string">" seconds"</span><span class="keyword">));<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="101020""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#101020" class="date">20-Nov-2010 01:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
People complaining that there's no way to set the offset - you are wrong. You can easily set the offset from GMT (see "Other" in available zones). And since all zones are offset from GMT it's just easy math with + or - to get that. So if you i.e. want the offset not from GMT but your timezone, then compute offset of your zone from GMT (say if you in Berlin its +1 now (mind summer time!)) and then offset for your target zone (i.e NYC is -5) then sum abs! of these values and set the sign of bigger (abs) value -&gt; total offset from your european zone to NYC is then abs(-5)+abs(1) = 6 and set "-" as NYC zone absolute value is bigger. So whatever time is in Berlin, in NYC it's 6hrs earlier. But it's better to do two step calculation and calculate always from GMT</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100357""></a>
  <div class="note">
   <strong class="user">steve at pozzie dot net</strong>
   <a href="#100357" class="date">11-Oct-2010 01:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Most of the scripts here depend on PHP identifying the correct zone when one is not set, but that does not always happen. 
<br />

<br />
For example PHP 5.3.3 gives a 'UTC' result for a detected '8.0/no DST'. Not much help.
<br />

<br />
So for those of us who for very good reasons really cannot set time zones in scripts of in .ini files, here is a function 
<br />
for use in a Windows environment that sets the default time zone to the OS time zone and returns the detected and set texts.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">date_system_timezone_set</span><span class="keyword">(){
<br />
&nbsp; </span><span class="default">$shell </span><span class="keyword">= new </span><span class="default">COM</span><span class="keyword">(</span><span class="string">"WScript.Shell"</span><span class="keyword">) or die(</span><span class="string">"Requires Windows Scripting Host"</span><span class="keyword">);
<br />
&nbsp; </span><span class="default">$time_bias </span><span class="keyword">= -(</span><span class="default">$shell</span><span class="keyword">-&gt;</span><span class="default">RegRead</span><span class="keyword">(
<br />
</span><span class="string">"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control
<br />
\\TimeZoneInformation\\Bias"</span><span class="keyword">))/</span><span class="default">60</span><span class="keyword">;
<br />
&nbsp; </span><span class="default">$ab </span><span class="keyword">= -(</span><span class="default">$shell</span><span class="keyword">-&gt;</span><span class="default">RegRead</span><span class="keyword">(
<br />
</span><span class="string">"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control
<br />
\\TimeZoneInformation\\ActiveTimeBias"</span><span class="keyword">))/</span><span class="default">60</span><span class="keyword">;
<br />
&nbsp; </span><span class="default">$sc </span><span class="keyword">= </span><span class="default">$shell</span><span class="keyword">-&gt;</span><span class="default">RegRead</span><span class="keyword">(
<br />
</span><span class="string">"HKEY_USERS\\.DEFAULT\\Control Panel\\International\\sCountry"</span><span class="keyword">);
<br />
&nbsp; foreach(</span><span class="default">timezone_abbreviations_list</span><span class="keyword">() as </span><span class="default">$tza</span><span class="keyword">) foreach(</span><span class="default">$tza </span><span class="keyword">as </span><span class="default">$entry</span><span class="keyword">){
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$country </span><span class="keyword">= </span><span class="default">strtok</span><span class="keyword">(</span><span class="default">$entry</span><span class="keyword">[</span><span class="string">'timezone_id'</span><span class="keyword">],</span><span class="string">'/'</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$locale </span><span class="keyword">= </span><span class="default">strtok</span><span class="keyword">(</span><span class="string">'|'</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$country</span><span class="keyword">==</span><span class="default">$sc </span><span class="keyword">&amp;&amp; </span><span class="default">$ab</span><span class="keyword">==(</span><span class="default">$entry</span><span class="keyword">[</span><span class="string">'offset'</span><span class="keyword">]/</span><span class="default">60</span><span class="keyword">/</span><span class="default">60</span><span class="keyword">) &amp;&amp; (</span><span class="default">$ds </span><span class="keyword">= </span><span class="default">$time_bias</span><span class="keyword">!=</span><span class="default">$ab</span><span class="keyword">)==</span><span class="default">$entry</span><span class="keyword">[</span><span class="string">'dst'</span><span class="keyword">]){
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">date_default_timezone_set</span><span class="keyword">(</span><span class="default">$timezone_identifier </span><span class="keyword">= </span><span class="default">$country</span><span class="keyword">.</span><span class="string">"/"</span><span class="keyword">.</span><span class="default">$locale</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp;&nbsp; return </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">'%.1f'</span><span class="keyword">,</span><span class="default">$ab</span><span class="keyword">).</span><span class="string">"/"</span><span class="keyword">.(</span><span class="default">$ds</span><span class="keyword">?</span><span class="string">''</span><span class="keyword">:</span><span class="string">'no '</span><span class="keyword">).</span><span class="string">'DST'</span><span class="keyword">.</span><span class="string">" "</span><span class="keyword">.</span><span class="default">$timezone_identifier</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; }
<br />
&nbsp;&nbsp; }
<br />
&nbsp; return </span><span class="default">false</span><span class="keyword">; 
<br />
&nbsp;}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99865""></a>
  <div class="note">
   <strong class="user">Tom S</strong>
   <a href="#99865" class="date">11-Sep-2010 06:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is a good script if you know or control your system so that you know that the local TZ in your OS is correct. Unfortunately, this script still creates an warning message under BSD UNIX.<br />
<br />
To fix this, just add an "@" in front of "localtime" as:<br />
<br />
$arr = @localtime($iTime);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="96551""></a>
  <div class="note">
   <strong class="user">Frederick Hathaway</strong>
   <a href="#96551" class="date">04-Mar-2010 08:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It's really a hassle that there is no way to set the timezone offset. I attempted to use the code that searched for the correct timezone name by offset from below. I found it didn't work reliably since various cities may have different rules about time DST etc. My solution is to actually search the array and do a test to insure the offset is what I expect it to be. It seems very kludgey (if thats a word) but it works. 
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">setTimezoneByOffset</span><span class="keyword">(</span><span class="default">$offset</span><span class="keyword">) 
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$testTimestamp </span><span class="keyword">= </span><span class="default">time</span><span class="keyword">();
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">date_default_timezone_set</span><span class="keyword">(</span><span class="string">'UTC'</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$testLocaltime </span><span class="keyword">= </span><span class="default">localtime</span><span class="keyword">(</span><span class="default">$testTimestamp</span><span class="keyword">,</span><span class="default">true</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$testHour </span><span class="keyword">= </span><span class="default">$testLocaltime</span><span class="keyword">[</span><span class="string">'tm_hour'</span><span class="keyword">];&nbsp; &nbsp; &nbsp; &nbsp; 
<br />

<br />
&nbsp;&nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$abbrarray </span><span class="keyword">= </span><span class="default">timezone_abbreviations_list</span><span class="keyword">();
<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$abbrarray </span><span class="keyword">as </span><span class="default">$abbr</span><span class="keyword">) 
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//echo $abbr."&lt;br&gt;";
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="keyword">foreach (</span><span class="default">$abbr </span><span class="keyword">as </span><span class="default">$city</span><span class="keyword">) 
<br />
&nbsp;&nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">date_default_timezone_set</span><span class="keyword">(</span><span class="default">$city</span><span class="keyword">[</span><span class="string">'timezone_id'</span><span class="keyword">]);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$testLocaltime&nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">localtime</span><span class="keyword">(</span><span class="default">$testTimestamp</span><span class="keyword">,</span><span class="default">true</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$hour&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">$testLocaltime</span><span class="keyword">[</span><span class="string">'tm_hour'</span><span class="keyword">];&nbsp; &nbsp; &nbsp; &nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$testOffset </span><span class="keyword">=&nbsp; </span><span class="default">$hour </span><span class="keyword">- </span><span class="default">$testHour</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$testOffset </span><span class="keyword">== </span><span class="default">$offset</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">true</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="95564""></a>
  <div class="note">
   <strong class="user">Christopher Kramer</strong>
   <a href="#95564" class="date">09-Jan-2010 07:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I experienced that using this function highly increases performance of functions like getdate() or date() using PHP 5.2.6 on Windows.<br />
I experienced similar results on Linux servers with PHP 5.2.6 and 5.2.10, although the difference was not that significant on these servers: The PHP 5.2.10 server did run with date_default_timezone_set ("only") twice as fast as without. The 5.2.6 server did 5 times faster with date_default_timezone_set. As you can see below, the 5.2.6-Windows machine did a LOT faster.<br />
Of course these machines have completely different hardware and can not really be compared, but all show improved performance.<br />
<br />
I checked PHP 4.4.9 on Windows (without date_default_timezone_set of course) and noticed that its as fast as PHP 5.2.6 with date_default_timezone_set.<br />
<br />
The following script shows this:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment"># uncomment to see difference<br />
# date_default_timezone_set(date_default_timezone_get());<br />
<br />
</span><span class="keyword">function </span><span class="default">getmicrotime</span><span class="keyword">()<br />
&nbsp;{<br />
&nbsp;list(</span><span class="default">$usec</span><span class="keyword">, </span><span class="default">$sec</span><span class="keyword">) = </span><span class="default">explode</span><span class="keyword">(</span><span class="string">' '</span><span class="keyword">,</span><span class="default">microtime</span><span class="keyword">());<br />
&nbsp;return (</span><span class="default">$sec</span><span class="keyword">.</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$usec</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">7</span><span class="keyword">));<br />
&nbsp;}<br />
&nbsp;<br />
</span><span class="default">$start</span><span class="keyword">=</span><span class="default">mktime</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">2005</span><span class="keyword">);<br />
</span><span class="default">$end</span><span class="keyword">=</span><span class="default">mktime</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">2020</span><span class="keyword">);<br />
</span><span class="default">$nr</span><span class="keyword">=</span><span class="default">50000</span><span class="keyword">;<br />
&nbsp;<br />
</span><span class="default">$start_time</span><span class="keyword">=</span><span class="default">getmicrotime</span><span class="keyword">();<br />
for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">$nr</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">++) {<br />
</span><span class="comment"># $value=getdate(rand($start,$end));<br />
&nbsp; </span><span class="default">date</span><span class="keyword">(</span><span class="string">"H:i:s d.m.Y"</span><span class="keyword">,</span><span class="default">rand</span><span class="keyword">(</span><span class="default">$start</span><span class="keyword">,</span><span class="default">$end</span><span class="keyword">));<br />
}<br />
</span><span class="default">$end_time</span><span class="keyword">=</span><span class="default">getmicrotime</span><span class="keyword">();<br />
<br />
echo </span><span class="string">"Time: "</span><span class="keyword">.(</span><span class="default">$end_time</span><span class="keyword">-</span><span class="default">$start_time</span><span class="keyword">);<br />
<br />
</span><span class="comment">// With date_default_timezone_set(): "Time: 0.379343986511"<br />
// Without date_default_timezone_set(): "Time: 7.4971370697"<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Note that the timezone is not changed, it is only set again. I really wonder why this makes such a big performance difference, but its good to know.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="87389""></a>
  <div class="note">
   <strong class="user">ted dot chou12 at gmail dot com</strong>
   <a href="#87389" class="date">02-Dec-2008 11:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Timezone using other approaches:<br />
<span class="default">&lt;?php $datetime </span><span class="keyword">= </span><span class="default">strtotime</span><span class="keyword">(</span><span class="default">$originaldatetime</span><span class="keyword">) + </span><span class="default">$time</span><span class="keyword">;<br />
</span><span class="default">$datetime </span><span class="keyword">= </span><span class="default">date</span><span class="keyword">(</span><span class="string">'M d, Y h:i A'</span><span class="keyword">, </span><span class="default">$datetime</span><span class="keyword">);</span><span class="default">?&gt;<br />
</span><br />
$time obtained from table below:<br />
-25200|International Date Line (West) GMT-12|<br />
-21600|Midway Island, Samoa GMT-11|<br />
-18000|Hawaii, Honolulu GMT-10|<br />
-14400|Alaska GMT-9|<br />
-10800|Pacific Standard Time, US, Canada GMT-8|<br />
-7200|British Columbia N.E., Santa Fe, Mountain Time GMT-7|<br />
-3600|Central America, Chicago, Guatamala, Mexico City GMT-6|<br />
0|US, Canada, Bogota, Boston, New York GMT-5|<br />
+3600|Canada, Santiago, Atlantic Standard Time GMT-4|<br />
+7200|Brazilia, Buenos Aires, Georgetown, Greenland GMT-3|<br />
+10800|Mid-Atlantic GMT-2|<br />
+14400|Azores, Cape Verde Is., Western Africa Time GMT-1|<br />
+18000|London, Iceland, Ireland, Morocco, Portugal GMT|<br />
+21600|Amsterdam, Berlin, Bern, Madrid, Paris, Rome, GMT+1|<br />
+25200|Athens, Cairo, Cape Town, Finland, Greece, Israel GMT+2|<br />
+28800|Ankara, Aden, Baghdad, Beruit, Kuwait, Moscow GMT+3|<br />
+32400|Abu Dhabi, Baku, Kabul, Tehran, Tbilisi, Volgograd GMT+4|<br />
+36000|Calcutta, Colombo, Islamabad, Madras, New Dehli GMT+5|<br />
+39600|Almaty, Dhakar, Kathmandu, Colombo, Sri Lanka GMT+6|<br />
+43200|Bangkok, Hanoi, Jakarta, Phnom Penh, Australia GMT+7|<br />
+46800|Taipei, Beijing, Hong Kong, Singapore, GMT+8|<br />
+50400|Seoul, Tokyo, Central Australia GMT+9|<br />
+54000|Brisbane, Canberra, Guam, Melbourne, Sydney, GMT+10|<br />
+57600|Magadan, New Caledonia, Solomon Is. GMT+11|<br />
+61200|Auckland, Fiji, Kamchatka, Marshall, Wellington, GMT+12|</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86950""></a>
  <div class="note">
   <strong class="user">jason at jasonpriem dot com</strong>
   <a href="#86950" class="date">11-Nov-2008 08:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
While it's easy to change timezones based on names or abbreviations, I haven't found any straightforward way of doing so using an offset integer.&nbsp; This situation comes up if you're using AJAX to get information about a user's timezone; javascript's getTimezoneOffset() method just sends you an offset number. So, here's my clunky solution: an adaptation of chris' function at <a href="http://us.php.net/manual/en/function.timezone-name-from-abbr.php." rel="nofollow" target="_blank">http://us.php.net/manual/en/function.timezone-name-from-abbr.php.</a>
<br />

<br />
<span class="default">&lt;?php
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">set_tz_by_offset</span><span class="keyword">(</span><span class="default">$offset</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$offset </span><span class="keyword">= </span><span class="default">$offset</span><span class="keyword">*</span><span class="default">60</span><span class="keyword">*</span><span class="default">60</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$abbrarray </span><span class="keyword">= </span><span class="default">timezone_abbreviations_list</span><span class="keyword">();
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$abbrarray </span><span class="keyword">as </span><span class="default">$abbr</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//echo $abbr."&lt;br&gt;";
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">foreach (</span><span class="default">$abbr </span><span class="keyword">as </span><span class="default">$city</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//echo $city['offset']." $offset&lt;br&gt;";
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$city</span><span class="keyword">[</span><span class="string">'offset'</span><span class="keyword">] == </span><span class="default">$offset</span><span class="keyword">) { </span><span class="comment">// remember to multiply $offset by -1 if you're getting it from js
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">date_default_timezone_set</span><span class="keyword">(</span><span class="default">$city</span><span class="keyword">[</span><span class="string">'timezone_id'</span><span class="keyword">]);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">true</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">date_default_timezone_set</span><span class="keyword">(</span><span class="string">"ust"</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; return </span><span class="default">false</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; }
<br />

<br />
</span><span class="default">set_tz_by_offset</span><span class="keyword">(-</span><span class="default">1</span><span class="keyword">);
<br />

<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
[EDIT BY thiago AT php DOT net: This code has contributions from iateadonut at gmail dot com]</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84459""></a>
  <div class="note">
   <strong class="user">Rob Kaper</strong>
   <a href="#84459" class="date">15-Jul-2008 01:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want users to choose their own timezones, here's some code that gets all available timezones but only uses one city for each possible value:<br />
<br />
<span class="default">&lt;?php<br />
<br />
$timezones </span><span class="keyword">= </span><span class="default">DateTimeZone</span><span class="keyword">::</span><span class="default">listAbbreviations</span><span class="keyword">();<br />
<br />
</span><span class="default">$cities </span><span class="keyword">= array();<br />
foreach( </span><span class="default">$timezones </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$zones </span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; foreach( </span><span class="default">$zones </span><span class="keyword">as </span><span class="default">$id </span><span class="keyword">=&gt; </span><span class="default">$zone </span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; * Only get timezones explicitely not part of "Others".<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; * @see <a href="http://www.php.net/manual/en/timezones.others.php" rel="nofollow" target="_blank">http://www.php.net/manual/en/timezones.others.php</a><br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; */<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if ( </span><span class="default">preg_match</span><span class="keyword">( </span><span class="string">'/^(America|Antartica|Arctic|Asia|Atlantic|Europe|Indian|Pacific)\//'</span><span class="keyword">, </span><span class="default">$zone</span><span class="keyword">[</span><span class="string">'timezone_id'</span><span class="keyword">] ) )<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$cities</span><span class="keyword">[</span><span class="default">$zone</span><span class="keyword">[</span><span class="string">'timezone_id'</span><span class="keyword">]][] = </span><span class="default">$key</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="comment">// For each city, have a comma separated list of all possible timezones for that city.<br />
</span><span class="keyword">foreach( </span><span class="default">$cities </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value </span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$cities</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">] = </span><span class="default">join</span><span class="keyword">( </span><span class="string">', '</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Only keep one city (the first and also most important) for each set of possibilities. <br />
</span><span class="default">$cities </span><span class="keyword">= </span><span class="default">array_unique</span><span class="keyword">( </span><span class="default">$cities </span><span class="keyword">);<br />
<br />
</span><span class="comment">// Sort by area/city name.<br />
</span><span class="default">ksort</span><span class="keyword">( </span><span class="default">$cities </span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73174""></a>
  <div class="note">
   <strong class="user">PeerGoal.com</strong>
   <a href="#73174" class="date">12-Feb-2007 04:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The problem:<br />
<br />
date() [function.date]: It is not safe to rely on the system's timezone settings. Please use the date.timezone setting, the TZ environment variable or the date_default_timezone_set() function. In case you used any of those methods and you are still getting this warning, you most likely misspelled the timezone identifier. We selected 'America/Los_Angeles' for 'PST/-8.0/no DST' instead<br />
<br />
Of course this is a problem that recently surfaced since PHP5. Quick fix is to set your time zone, add this line to your php code:<br />
<br />
date_default_timezone_set("America/Los_Angeles");</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71909""></a>
  <div class="note">
   <strong class="user">davidn at datalinktech dot com dot au</strong>
   <a href="#71909" class="date">21-Dec-2006 05:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that there may be some unexpected side-effects that result from using either set_default_timezone() or the putenv("TZ=...") workalike for earlier PHP versions.&nbsp; ANY date formatted and output either by PHP or its apache host process will be unconditionally expressed in that timezone.
<br />

<br />
[red. That is only true for the putenv() hack - Derick]
<br />

<br />
This does indeed include the web server's logs and other output files and reports which by default usually do not include any indication of timezone. This has a further side-effect on log processing and analysis, obviously.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
