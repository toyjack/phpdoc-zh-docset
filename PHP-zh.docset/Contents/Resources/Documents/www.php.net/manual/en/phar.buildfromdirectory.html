<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>Construct a phar archive from the files within a directory</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="phar.apiversion.html">? Phar::apiVersion</a></li>
      <li style="float: right;"><a href="phar.buildfromiterator.html">Phar::buildFromIterator ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="class.phar.html">Phar</a></li>
    <li>Construct a phar archive from the files within a directory</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="phar.buildfromdirectory" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">Phar::buildFromDirectory</h1>
  <p class="verinfo">(PHP 5 &gt;= 5.3.0, PHP 7, PHP 8, PECL phar &gt;= 2.0.0)</p><p class="refpurpose"><span class="refname">Phar::buildFromDirectory</span> &mdash; <span class="dc-title">Construct a phar archive from the files within a directory</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-phar.buildfromdirectory-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="modifier">public</span> <span class="methodname"><strong>Phar::buildFromDirectory</strong></span>(<span class="methodparam"><span class="type">string</span> <code class="parameter">$directory</code></span>, <span class="methodparam"><span class="type">string</span> <code class="parameter">$pattern</code><span class="initializer"> = &quot;&quot;</span></span>): <span class="type">array</span></div>

  <blockquote class="note"><p><strong class="note">Note</strong>: <p class="para">此方法需要
将 <var class="filename">php.ini</var> 中的 <code class="literal">phar.readonly</code> 设为
<code class="literal">0</code> 以适合 <span class="classname"><a href="class.phar.html" class="classname">Phar</a></span>
对象.  否则, 将抛出<span class="classname"><a href="class.pharexception.html" class="classname">PharException</a></span>.</p></p></blockquote>
  <p class="para">
   Populate a phar archive from directory contents.  The optional second
   parameter is a regular expression (pcre) that is used to exclude files.
   Any filename that matches the regular expression will be included, all others will be
   excluded.  For more fine-grained control, use <span class="function"><a href="phar.buildfromiterator.html" class="function">Phar::buildFromIterator()</a></span>.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-phar.buildfromdirectory-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>
    
     <dt>
<code class="parameter">directory</code></dt>

     <dd>

      <p class="para">
       The full or relative path to the directory that contains all files
       to add to the archive.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">pattern</code></dt>

     <dd>

      <p class="para">
       An optional pcre regular expression that is used to filter the
       list of files.  Only file paths matching the regular expression
       will be included in the archive.
      </p>
     </dd>

    
   </dl>

  </p>

 </div>

 <div class="refsect1 returnvalues" id="refsect1-phar.buildfromdirectory-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   <span class="function"><strong>Phar::buildFromDirectory()</strong></span> returns an associative array
   mapping internal path of file to the full path of the file on the
   filesystem.
  </p>
 </div>


 <div class="refsect1 errors" id="refsect1-phar.buildfromdirectory-errors">
  <h3 class="title">错误／异常</h3>
  <p class="para">
   This method throws <span class="classname"><a href="class.badmethodcallexception.html" class="classname">BadMethodCallException</a></span> when unable
   to instantiate the internal directory iterators,
   or a <span class="classname"><a href="class.pharexception.html" class="classname">PharException</a></span> if there were errors
   saving the phar archive.
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-phar.buildfromdirectory-changelog">
  <h3 class="title">更新日志</h3>
  <table class="doctable informaltable">
   
    <thead>
     <tr>
      <th>版本</th>
      <th>说明</th>
     </tr>

    </thead>

    <tbody class="tbody">
     <tr>
      <td>8.1.0</td>
      <td>
       <span class="methodname"><strong>Phar::buildFromDirectory()</strong></span> no longer returns <strong><code>false</code></strong>.
      </td>
     </tr>

    </tbody>
   
  </table>

 </div>


 <div class="refsect1 examples" id="refsect1-phar.buildfromdirectory-examples">
  <h3 class="title">范例</h3>
  <div class="example" id="example-700">
    <p><strong>Example #1 A <span class="function"><strong>Phar::buildFromDirectory()</strong></span> example</strong></p>
  <div class="example-contents"><p>
   
  </p></div>
  <div class="example-contents"><p>
   <div class="example-contents">
    <div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;create&nbsp;with&nbsp;alias&nbsp;"project.phar"<br /></span><span style="color: #0000BB">$phar&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">Phar</span><span style="color: #007700">(</span><span style="color: #DD0000">'project.phar'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'project.phar'</span><span style="color: #007700">);<br /></span><span style="color: #FF8000">//&nbsp;add&nbsp;all&nbsp;files&nbsp;in&nbsp;the&nbsp;project<br /></span><span style="color: #0000BB">$phar</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">buildFromDirectory</span><span style="color: #007700">(</span><span style="color: #0000BB">dirname</span><span style="color: #007700">(</span><span style="color: #0000BB">__FILE__</span><span style="color: #007700">)&nbsp;.&nbsp;</span><span style="color: #DD0000">'/project'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$phar</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setStub</span><span style="color: #007700">(</span><span style="color: #0000BB">$phar</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">createDefaultStub</span><span style="color: #007700">(</span><span style="color: #DD0000">'cli/index.php'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'www/index.php'</span><span style="color: #007700">));<br /><br /></span><span style="color: #0000BB">$phar2&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">Phar</span><span style="color: #007700">(</span><span style="color: #DD0000">'project2.phar'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'project2.phar'</span><span style="color: #007700">);<br /></span><span style="color: #FF8000">//&nbsp;add&nbsp;all&nbsp;files&nbsp;in&nbsp;the&nbsp;project,&nbsp;only&nbsp;include&nbsp;php&nbsp;files<br /></span><span style="color: #0000BB">$phar2</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">buildFromDirectory</span><span style="color: #007700">(</span><span style="color: #0000BB">dirname</span><span style="color: #007700">(</span><span style="color: #0000BB">__FILE__</span><span style="color: #007700">)&nbsp;.&nbsp;</span><span style="color: #DD0000">'/project'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'/\.php$/'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$phar2</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setStub</span><span style="color: #007700">(</span><span style="color: #0000BB">$phar</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">createDefaultStub</span><span style="color: #007700">(</span><span style="color: #DD0000">'cli/index.php'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'www/index.php'</span><span style="color: #007700">));<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

  </p></div>
  </div>
 </div>


 <div class="refsect1 seealso" id="refsect1-phar.buildfromdirectory-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="phar.buildfromiterator.html" class="function" rel="rdfs-seeAlso">Phar::buildFromIterator()</a> - Construct a phar archive from an iterator</span></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="121091""></a>
  <div class="note">
   <strong class="user">dalfarra at codref dot com</strong>
   <a href="#121091" class="date">16-May-2017 03:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to exclude a directory from the archive (but include all the other content), the regular expression must take into consideration the whole path of the file, not just the file or directory name relative to the source folder.<br />
<br />
As an example, if we want to exclude "nbproject" directory from the archive (and any occurrence of it):<br />
<br />
/tmp/myfolder<br />
&nbsp; /nbproject<br />
&nbsp; /something<br />
&nbsp; /something-else<br />
&nbsp;&nbsp;&nbsp; /nbproject<br />
&nbsp; /file1.php<br />
&nbsp; /file2.php<br />
<br />
the regex should be:<br />
<span class="default">&lt;?php<br />
&nbsp; $exclude </span><span class="keyword">= </span><span class="string">'/^(?!(.*nbproject))(.*)$/i'</span><span class="keyword">;&nbsp; </span><span class="comment">//ignoring the case<br />
</span><span class="default">?&gt;<br />
</span><br />
A more complete example:<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; $archive_file </span><span class="keyword">= </span><span class="string">'myarchive.tar'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$folder_to_compress </span><span class="keyword">= </span><span class="string">'/tmp/myfolder'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$archive </span><span class="keyword">= new </span><span class="default">PharData</span><span class="keyword">(</span><span class="default">$archive_file</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$exclude </span><span class="keyword">= </span><span class="string">'/^(?!(.*nbproject))(.*)$/i'</span><span class="keyword">;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$archive</span><span class="keyword">-&gt;</span><span class="default">buildFromDirectory</span><span class="keyword">(</span><span class="default">$folder_to_compress</span><span class="keyword">,</span><span class="default">$exclude</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$archive</span><span class="keyword">-&gt;</span><span class="default">compress</span><span class="keyword">(</span><span class="default">Phar</span><span class="keyword">::</span><span class="default">GZ</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">unlink</span><span class="keyword">(</span><span class="default">$archive_file</span><span class="keyword">); </span><span class="comment">// as we already obtained a tar.gz<br />
</span><span class="default">?&gt;<br />
</span><br />
the archive will contain:<br />
/<br />
&nbsp; /something<br />
&nbsp; /something-else<br />
&nbsp; /file1.php<br />
&nbsp; /file2.php</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
