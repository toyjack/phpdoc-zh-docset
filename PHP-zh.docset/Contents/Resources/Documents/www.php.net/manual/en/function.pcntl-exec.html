<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>在当前进程空间执行指定程序</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.pcntl-errno.html">? pcntl_errno</a></li>
      <li style="float: right;"><a href="function.pcntl-fork.html">pcntl_fork ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.pcntl.html">PCNTL 函数</a></li>
    <li>在当前进程空间执行指定程序</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.pcntl-exec" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">pcntl_exec</h1>
  <p class="verinfo">(PHP 4 &gt;= 4.2.0, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">pcntl_exec</span> &mdash; <span class="dc-title">在当前进程空间执行指定程序</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.pcntl-exec-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>pcntl_exec</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$path</code></span>
   , <span class="methodparam"><span class="type">array</span> <code class="parameter">$args</code> = ?</span>
   , <span class="methodparam"><span class="type">array</span> <code class="parameter">$envs</code> = ?</span>
   ) : <span class="type"><span class="type void">void</span></span></div>

  <p class="para rdfs-comment">
   以给定参数执行程序。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.pcntl-exec-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">path</code></dt>

     <dd>

      <p class="para">
       <code class="parameter">path</code>必须时可执行二进制文件路径或一个在文件第一行指定了
       一个可执行文件路径标头的脚本（比如文件第一行是#!/usr/local/bin/perl的perl脚本）。
       更多的信息请查看您系统的execve（2）手册。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">args</code></dt>

     <dd>

      <p class="para">
       <code class="parameter">args</code>是一个要传递给程序的参数的字符串数组。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">envs</code></dt>

     <dd>

      <p class="para">
       <code class="parameter">envs</code>是一个要传递给程序作为环境变量的字符串数组。这个数组是
       key =&gt; value格式的，key代表要传递的环境变量的名称，value代表该环境变量值。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.pcntl-exec-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   当发生错误时返回 <strong><code>false</code></strong> ，没有错误时没有返回。
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="112092""></a>
  <div class="note">
   <strong class="user">maxime at diametrick dot com</strong>
   <a href="#112092" class="date">02-May-2013 06:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
An alternative for Windows environment is to use the COM object. With this, you can start child process with Apache, or php.exe as parent process. Very useful for CLI or console PHC-Win applications.<br />
<br />
if(!function_exists('pcntl_exec')){<br />
&nbsp; function pcntl_exec($path,$args=array()){<br />
&nbsp;&nbsp;&nbsp; if(is_string($args)) $args = array($args);<br />
&nbsp;&nbsp;&nbsp; if(count($args)) $path = '"'.$path.'"';<br />
&nbsp;&nbsp;&nbsp; $shell = new COM('WScript.Shell');<br />
&nbsp;&nbsp;&nbsp; $shell-&gt;run($path.(count($args) ? ' '.implode(' ',$args) : ''),0,true);<br />
&nbsp; }<br />
}<br />
<br />
Very useful too when you want to use ansicon. Instead of make a .bat file with ansicon -p and php .... (somefile).php, in your .php file you can put this on top of your code:<br />
<br />
pcntl_exec('ansicon -p');<br />
<br />
BINGO!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84113""></a>
  <div class="note">
   <strong class="user">fahadsadah at gmail dot com dot please dot remove dot this</strong>
   <a href="#84113" class="date">28-Jun-2008 07:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just a note regarding what rbemrose at vgmusic dot com said:<br />
Once the executed process ends, control returns to the webserver process.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="80917""></a>
  <div class="note">
   <strong class="user">rbemrose at vgmusic dot com</strong>
   <a href="#80917" class="date">06-Feb-2008 02:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As a side note, if I'm reading the comments below correctly, you should not run this if you're using a PHP webserver module, as it will replace the webserver's process with whatever process you're telling it to run.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71612""></a>
  <div class="note">
   <strong class="user">agodong at verizon dot net</strong>
   <a href="#71612" class="date">07-Dec-2006 10:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Some people might find it useful to run other program using the same process as a different user. This is very usefull if the script is running under root. Here is a simple code to achieve that under *nix PHP CLI:<br />
<br />
#!/usr/bin/php -q<br />
<span class="default">&lt;?php<br />
</span><span class="comment">//Enter run-as user below (argument needed to be passed when the script is called), otherwise it will run as the caller user process.<br />
<br />
</span><span class="default">$username </span><span class="keyword">= </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'argv'</span><span class="keyword">][</span><span class="default">1</span><span class="keyword">];<br />
<br />
</span><span class="default">$user </span><span class="keyword">= </span><span class="default">posix_getpwnam</span><span class="keyword">(</span><span class="default">$username</span><span class="keyword">);<br />
</span><span class="default">posix_setuid</span><span class="keyword">(</span><span class="default">$user</span><span class="keyword">[</span><span class="string">'uid'</span><span class="keyword">]);<br />
</span><span class="default">posix_setgid</span><span class="keyword">(</span><span class="default">$user</span><span class="keyword">[</span><span class="string">'gid'</span><span class="keyword">]);<br />
</span><span class="default">pcntl_exec</span><span class="keyword">(</span><span class="string">'/path/to/cmd'</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
I use this as a part of socket program so that a program can be run under different user from remote location.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="70708""></a>
  <div class="note">
   <strong class="user">eric kilfoil</strong>
   <a href="#70708" class="date">24-Oct-2006 10:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The pcntl_exec() function works exactly like the standard (unix-style) exec() function.&nbsp; It differs from the regular PHP exec() function in that the process calling the pcntl_exec() is replaced with the process that gets called.&nbsp; This is the ideal method for creating children.&nbsp; In a simple example (that does no error checking):<br />
<br />
switch (pcntl_fork()) {<br />
&nbsp; case 0:<br />
&nbsp;&nbsp;&nbsp; $cmd = "/path/to/command";<br />
&nbsp;&nbsp;&nbsp; $args = array("arg1", "arg2");<br />
&nbsp;&nbsp;&nbsp; pcntl_exec($cmd, $args);<br />
&nbsp;&nbsp;&nbsp; // the child will only reach this point on exec failure,<br />
&nbsp;&nbsp;&nbsp; // because execution shifts to the pcntl_exec()ed command<br />
&nbsp;&nbsp;&nbsp; exit(0);<br />
&nbsp; default:<br />
&nbsp;&nbsp;&nbsp; break;<br />
}<br />
<br />
// parent continues<br />
echo "I am the parent";<br />
<br />
--<br />
<br />
since this is not being executed through a shell, you must provide the exact path from the filesystem root.&nbsp; Look at the execve() man page for more information.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="27007""></a>
  <div class="note">
   <strong class="user">michael dot ferre at mobileway dot com</strong>
   <a href="#27007" class="date">20-Nov-2002 03:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
//To complete my last note<br />
//If you use some object in your php code <br />
//You will have some problem if you do a exit after include the<br />
//child scripts<br />
//You must use posix_kill() like that :<br />
<br />
$CHILD_PID = pcntl_fork();<br />
if($CHILD_PID == 0)<br />
{&nbsp; &nbsp; <br />
&nbsp; include ($script_path);<br />
&nbsp; posix_kill(getmypid(),9);<br />
}<br />
<br />
//This code is very simple it can be ameliorate ;)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
