<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>返回指定目录下文件的详细列表</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.ftp-raw.html">? ftp_raw</a></li>
      <li style="float: right;"><a href="function.ftp-rename.html">ftp_rename ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.ftp.html">FTP 函数</a></li>
    <li>返回指定目录下文件的详细列表</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.ftp-rawlist" class="refentry">
   <div class="refnamediv">
    <h1 class="refname">ftp_rawlist</h1>
    <p class="verinfo">(PHP 4, PHP 5, PHP 7)</p><p class="refpurpose"><span class="refname">ftp_rawlist</span> &mdash; <span class="dc-title">返回指定目录下文件的详细列表</span></p>

   </div>
   <div class="refsect1 description" id="refsect1-function.ftp-rawlist-description">
    <h3 class="title">说明</h3>
    <div class="methodsynopsis dc-description">
     <span class="methodname"><strong>ftp_rawlist</strong></span>
      ( <span class="methodparam"><span class="type">resource</span> <code class="parameter">$ftp_stream</code></span>
     , <span class="methodparam"><span class="type">string</span> <code class="parameter">$directory</code></span>
     ) : <span class="type">array</span></div>

    <p class="para rdfs-comment">
     <span class="function"><strong>ftp_rawlist()</strong></span> 函数将执行 FTP
     <strong class="command">LIST</strong> 命令，并把结果做为一个数组返回。
    </p>
   </div>

   <div class="refsect1 parameters" id="refsect1-function.ftp-rawlist-parameters">
   <h3 class="title">参数</h3>
   <p class="para">
    <dl>

     
      <dt>
<code class="parameter">ftp_stream</code></dt>

      <dd>

       <p class="para">
        FTP 连接资源。
       </p>
      </dd>

     
     
      <dt>
<code class="parameter">directory</code></dt>

      <dd>

       <p class="para">
        目录路径。
       </p>
      </dd>

     
     
      <dt>
<code class="parameter">recursive</code></dt>

      <dd>

       <p class="para">
        如果此参数为 <strong><code>TRUE</code></strong>，实际执行的命令将会为 <strong class="command">LIST -R</strong>。
       </p>
      </dd>

     
    </dl>

   </p>
   </div>

   <div class="refsect1 returnvalues" id="refsect1-function.ftp-rawlist-returnvalues">
   <h3 class="title">返回值</h3>
   <p class="para">
    返回一个数组，数组的每个元素为返回文本的每一行，输出结构不会被解析。使用函数
    <span class="function"><a href="function.ftp-systype.html" class="function">ftp_systype()</a></span> 可以用来判断 FTP 服务器的类型，从而可以用来判断返回列表的类型。
   </p>
   </div>

 <div class="refsect1 examples" id="refsect1-function.ftp-rawlist-examples">
  <h3 class="title">范例</h3>
  <p class="para">
   <div class="example" id="example-5375">
    <p><strong>Example #1 <span class="function"><strong>ftp_rawlist()</strong></span> 例子</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br /></span><span style="color: #FF8000">//&nbsp;set&nbsp;up&nbsp;basic&nbsp;connection<br /></span><span style="color: #0000BB">$conn_id&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">ftp_connect</span><span style="color: #007700">(</span><span style="color: #0000BB">$ftp_server</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;login&nbsp;with&nbsp;username&nbsp;and&nbsp;password<br /></span><span style="color: #0000BB">$login_result&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">ftp_login</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn_id</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$ftp_user_name</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$ftp_user_pass</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;get&nbsp;the&nbsp;file&nbsp;list&nbsp;for&nbsp;/<br /></span><span style="color: #0000BB">$buff&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">ftp_rawlist</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn_id</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'/'</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;close&nbsp;the&nbsp;connection<br /></span><span style="color: #0000BB">ftp_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn_id</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;output&nbsp;the&nbsp;buffer<br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$buff</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>以上例程的输出类似于：</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
array(3) {
  [0]=&gt;
  string(65) &quot;drwxr-x---   3 vincent  vincent      4096 Jul 12 12:16 public_ftp&quot;
  [1]=&gt;
  string(66) &quot;drwxr-x---  15 vincent  vincent      4096 Nov  3 21:31 public_html&quot;
  [2]=&gt;
  string(73) &quot;lrwxrwxrwx   1 vincent  vincent        11 Jul 12 12:16 www -&gt; public_html&quot;
}
</pre></div>
    </div>
   </div>
  </p>
 </div>

 <div class="refsect1 changelog" id="refsect1-function.ftp-rawlist-changelog">
  <h3 class="title">更新日志</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead>
      <tr>
       <th>版本</th>
       <th>说明</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
       <td>4.3.0</td>
       <td>
        增加 <code class="parameter">recursive</code> 参数。
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>

 <div class="refsect1 seealso" id="refsect1-function.ftp-rawlist-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.ftp-nlist.html" class="function" rel="rdfs-seeAlso">ftp_nlist()</a> - 返回给定目录的文件列表</span></li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="122642""></a>
  <div class="note">
   <strong class="user">Roline88 at hotmail dot com</strong>
   <a href="#122642" class="date">19-Apr-2018 05:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that this function also will return false if the content of the provided directory is empty.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="114935""></a>
  <div class="note">
   <strong class="user">admin at proxy-list dot org</strong>
   <a href="#114935" class="date">29-Apr-2014 05:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Please pay attention that ftp_rawlist() function returns empty result if there is a folder with space. You must backslash it with addcslashes() function.<br />
<br />
IMPORTANT: at the same time any other function like ftp_delete() or ftp_rmdir() in opposite, will not be able to delete file/folder if folder name with space will be backslashes <a href="http://proxy-list.org/" rel="nofollow" target="_blank">http://proxy-list.org/</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="114910""></a>
  <div class="note">
   <strong class="user">nickman at freemail dot hu</strong>
   <a href="#114910" class="date">24-Apr-2014 07:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The solution of fredvanetten at tinqle dot com is nice but needs further evaluation as because of the preg_split and static listing of the variables will produce different values: comparing a file of today or an older, from a previous year:<br />
<br />
Array<br />
(<br />
&nbsp;&nbsp;&nbsp; [time] =&gt; 2012<br />
&nbsp;&nbsp;&nbsp; [day] =&gt; 11<br />
&nbsp;&nbsp;&nbsp; [month] =&gt; Sep<br />
&nbsp;&nbsp;&nbsp; [size] =&gt; 37262<br />
&nbsp;&nbsp;&nbsp; [group] =&gt; group<br />
&nbsp;&nbsp;&nbsp; [user] =&gt; owner<br />
&nbsp;&nbsp;&nbsp; [number] =&gt; 1<br />
&nbsp;&nbsp;&nbsp; [rights] =&gt; -rw-rw-rw-<br />
)<br />
<br />
Array<br />
(<br />
&nbsp;&nbsp;&nbsp; [time] =&gt; 14:01<br />
&nbsp;&nbsp;&nbsp; [day] =&gt; 23<br />
&nbsp;&nbsp;&nbsp; [month] =&gt; Apr<br />
&nbsp;&nbsp;&nbsp; [size] =&gt; 37262<br />
&nbsp;&nbsp;&nbsp; [group] =&gt; group<br />
&nbsp;&nbsp;&nbsp; [user] =&gt; owner<br />
&nbsp;&nbsp;&nbsp; [number] =&gt; 1<br />
&nbsp;&nbsp;&nbsp; [rights] =&gt; -rw-rw-rw-<br />
)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="114633""></a>
  <div class="note">
   <strong class="user">mediaboat at gmail dot com</strong>
   <a href="#114633" class="date">14-Mar-2014 10:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
All&nbsp; parse_rawlist Functions here have one Problem.<br />
<br />
when a file starts with a space character like " robots.txt ", it will be ignored.<br />
<br />
Rename, delete will fail...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="110803""></a>
  <div class="note">
   <strong class="user">fredvanetten at tinqle dot com</strong>
   <a href="#110803" class="date">10-Dec-2012 07:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's a simple function that'll parse the data returned by ftp_rawlist() into an associative array. I wrote it because some of the functions listed below are way to long, complex or won't work with file names that contain spaces.
<br />

<br />
<span class="default">&lt;?php
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">listDetailed</span><span class="keyword">(</span><span class="default">$resource</span><span class="keyword">, </span><span class="default">$directory </span><span class="keyword">= </span><span class="string">'.'</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$children </span><span class="keyword">= @</span><span class="default">ftp_rawlist</span><span class="keyword">(</span><span class="default">$resource</span><span class="keyword">, </span><span class="default">$directory</span><span class="keyword">))) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$items </span><span class="keyword">= array();
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$children </span><span class="keyword">as </span><span class="default">$child</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$chunks </span><span class="keyword">= </span><span class="default">preg_split</span><span class="keyword">(</span><span class="string">"/\s+/"</span><span class="keyword">, </span><span class="default">$child</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; list(</span><span class="default">$item</span><span class="keyword">[</span><span class="string">'rights'</span><span class="keyword">], </span><span class="default">$item</span><span class="keyword">[</span><span class="string">'number'</span><span class="keyword">], </span><span class="default">$item</span><span class="keyword">[</span><span class="string">'user'</span><span class="keyword">], </span><span class="default">$item</span><span class="keyword">[</span><span class="string">'group'</span><span class="keyword">], </span><span class="default">$item</span><span class="keyword">[</span><span class="string">'size'</span><span class="keyword">], </span><span class="default">$item</span><span class="keyword">[</span><span class="string">'month'</span><span class="keyword">], </span><span class="default">$item</span><span class="keyword">[</span><span class="string">'day'</span><span class="keyword">], </span><span class="default">$item</span><span class="keyword">[</span><span class="string">'time'</span><span class="keyword">]) = </span><span class="default">$chunks</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$item</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] = </span><span class="default">$chunks</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]{</span><span class="default">0</span><span class="keyword">} === </span><span class="string">'d' </span><span class="keyword">? </span><span class="string">'directory' </span><span class="keyword">: </span><span class="string">'file'</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">array_splice</span><span class="keyword">(</span><span class="default">$chunks</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">8</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$items</span><span class="keyword">[</span><span class="default">implode</span><span class="keyword">(</span><span class="string">" "</span><span class="keyword">, </span><span class="default">$chunks</span><span class="keyword">)] = </span><span class="default">$item</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$items</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Throw exception or return false &lt; up to you
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="101071""></a>
  <div class="note">
   <strong class="user">Johnny Doe</strong>
   <a href="#101071" class="date">24-Nov-2010 06:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In case anybody wants to get a detailed listing using the MLSD command over a passive connection, the following function might be helpful as a starting point for your own implementation:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">ftp_mlsd</span><span class="keyword">(</span><span class="default">$ftp</span><span class="keyword">, </span><span class="default">$directory</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ok </span><span class="keyword">= @</span><span class="default">ftp_chdir</span><span class="keyword">(</span><span class="default">$ftp</span><span class="keyword">, </span><span class="default">$directory</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; if (!</span><span class="default">$ok</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ret </span><span class="keyword">= </span><span class="default">ftp_raw</span><span class="keyword">(</span><span class="default">$ftp</span><span class="keyword">, </span><span class="string">'PASV'</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">preg_match</span><span class="keyword">(
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'/^227.*\(([0-9]+,[0-9]+,[0-9]+,[0-9]+),([0-9]+),([0-9]+)\)$/'</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ret</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="default">$matches</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$controlIP </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">','</span><span class="keyword">, </span><span class="string">'.'</span><span class="keyword">, </span><span class="default">$matches</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$controlPort </span><span class="keyword">= </span><span class="default">intval</span><span class="keyword">(</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">])*</span><span class="default">256</span><span class="keyword">+</span><span class="default">intval</span><span class="keyword">(</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">]);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$socket </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$controlIP</span><span class="keyword">, </span><span class="default">$controlPort</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ftp_raw</span><span class="keyword">(</span><span class="default">$ftp</span><span class="keyword">, </span><span class="string">'MLSD'</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$s </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$s </span><span class="keyword">.= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">, </span><span class="default">4096</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$files </span><span class="keyword">= array();
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">explode</span><span class="keyword">(</span><span class="string">"\n"</span><span class="keyword">, </span><span class="default">$s</span><span class="keyword">) as </span><span class="default">$line</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">$line</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; continue;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$file </span><span class="keyword">= array();
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">explode</span><span class="keyword">(</span><span class="string">';'</span><span class="keyword">, </span><span class="default">$line</span><span class="keyword">) as </span><span class="default">$property</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; list(</span><span class="default">$key</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">) = </span><span class="default">explode</span><span class="keyword">(</span><span class="string">'='</span><span class="keyword">, </span><span class="default">$property</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$value</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$file</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">] = </span><span class="default">$value</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$filename </span><span class="keyword">= </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$files</span><span class="keyword">[</span><span class="default">$filename</span><span class="keyword">] = </span><span class="default">$file</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$files</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;
<br />
}
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Please note that this function ignores the setting of ftp_pasv(). Making the function to work universally for both active and passive connections is left as an exercise to the reader ;-)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="97876""></a>
  <div class="note">
   <strong class="user">shaun at shaunfreeman dot co dot uk</strong>
   <a href="#97876" class="date">13-May-2010 04:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Get a listing of all files including hidden files except '.' or '..' use:
<br />

<br />
<span class="default">&lt;?php
<br />
ftp_chdir</span><span class="keyword">(</span><span class="default">$connid</span><span class="keyword">, </span><span class="default">$dir</span><span class="keyword">);
<br />
</span><span class="default">ftp_rawlist</span><span class="keyword">(</span><span class="default">$connid</span><span class="keyword">, </span><span class="string">"-A"</span><span class="keyword">);
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
This had me dancing in circles for some time!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="97683""></a>
  <div class="note">
   <strong class="user">John</strong>
   <a href="#97683" class="date">02-May-2010 04:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There are a couple of php-related reasons given here for ftp_rawlist returning an empty result. However be aware that ZoneAlarm (and possibly other) firewalls can block responses without giving any visible clue so be sure to check that first.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="94412""></a>
  <div class="note">
   <strong class="user">nospam at advancedonsite dot com</strong>
   <a href="#94412" class="date">03-Nov-2009 08:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
ftp_rawlist kept returning empty file listing, it would work on some machines but not others, it turned out to be ftp_pasv command was needed.<br />
Very frustrating</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91722""></a>
  <div class="note">
   <strong class="user">ahmadmarafa at gmail dot com</strong>
   <a href="#91722" class="date">23-Jun-2009 07:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
this is function to check for dirs 
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">ftp_isdir</span><span class="keyword">(</span><span class="default">$connect_id</span><span class="keyword">,</span><span class="default">$dir</span><span class="keyword">)
<br />
{
<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">ftp_chdir</span><span class="keyword">(</span><span class="default">$connect_id</span><span class="keyword">,</span><span class="default">$dir</span><span class="keyword">))
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ftp_cdup</span><span class="keyword">(</span><span class="default">$connect_id</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">true</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; else
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91120""></a>
  <div class="note">
   <strong class="user">tmp at gmx dot de</strong>
   <a href="#91120" class="date">26-May-2009 04:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To format the _recrusive_ result of this function I use this:<br />
<br />
<span class="default">&lt;?php<br />
$conn_id </span><span class="keyword">= </span><span class="default">ftp_connect</span><span class="keyword">(</span><span class="default">FTP_SERVER</span><span class="keyword">);<br />
<br />
</span><span class="default">$login_result </span><span class="keyword">= </span><span class="default">ftp_login</span><span class="keyword">(</span><span class="default">$conn_id</span><span class="keyword">, </span><span class="default">FTP_USR</span><span class="keyword">, </span><span class="default">FTP_PASS</span><span class="keyword">);<br />
<br />
</span><span class="default">$rawfiles </span><span class="keyword">= </span><span class="default">ftp_rawlist</span><span class="keyword">(</span><span class="default">$conn_id</span><span class="keyword">, </span><span class="string">'/'</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
<br />
</span><span class="default">ftp_close</span><span class="keyword">(</span><span class="default">$conn_id</span><span class="keyword">);<br />
<br />
</span><span class="comment">// here the magic begins!<br />
</span><span class="default">$structure </span><span class="keyword">= array();<br />
</span><span class="default">$arraypointer </span><span class="keyword">= &amp;</span><span class="default">$structure</span><span class="keyword">;<br />
foreach (</span><span class="default">$rawfiles </span><span class="keyword">as </span><span class="default">$rawfile</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$rawfile</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] == </span><span class="string">'/'</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$paths </span><span class="keyword">= </span><span class="default">array_slice</span><span class="keyword">(</span><span class="default">explode</span><span class="keyword">(</span><span class="string">'/'</span><span class="keyword">, </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">':'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$rawfile</span><span class="keyword">)), </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$arraypointer </span><span class="keyword">= &amp;</span><span class="default">$structure</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$paths </span><span class="keyword">as </span><span class="default">$path</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$arraypointer </span><span class="keyword">as </span><span class="default">$i </span><span class="keyword">=&gt; </span><span class="default">$file</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$file</span><span class="keyword">[</span><span class="string">'text'</span><span class="keyword">] == </span><span class="default">$path</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$arraypointer </span><span class="keyword">= &amp;</span><span class="default">$arraypointer</span><span class="keyword">[ </span><span class="default">$i </span><span class="keyword">][</span><span class="string">'children'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; } elseif(!empty(</span><span class="default">$rawfile</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$info </span><span class="keyword">= </span><span class="default">preg_split</span><span class="keyword">(</span><span class="string">"/[\s]+/"</span><span class="keyword">, </span><span class="default">$rawfile</span><span class="keyword">, </span><span class="default">9</span><span class="keyword">);&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$arraypointer</span><span class="keyword">[] = array(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'text'&nbsp;&nbsp; </span><span class="keyword">=&gt; </span><span class="default">$info</span><span class="keyword">[</span><span class="default">8</span><span class="keyword">],<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'isDir'&nbsp; </span><span class="keyword">=&gt; </span><span class="default">$info</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]{</span><span class="default">0</span><span class="keyword">} == </span><span class="string">'d'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'size'&nbsp;&nbsp; </span><span class="keyword">=&gt; </span><span class="default">byteconvert</span><span class="keyword">(</span><span class="default">$info</span><span class="keyword">[</span><span class="default">4</span><span class="keyword">]),<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'chmod'&nbsp; </span><span class="keyword">=&gt; </span><span class="default">chmodnum</span><span class="keyword">(</span><span class="default">$info</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]),<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'date'&nbsp;&nbsp; </span><span class="keyword">=&gt; </span><span class="default">strtotime</span><span class="keyword">(</span><span class="default">$info</span><span class="keyword">[</span><span class="default">6</span><span class="keyword">] . </span><span class="string">' ' </span><span class="keyword">. </span><span class="default">$info</span><span class="keyword">[</span><span class="default">5</span><span class="keyword">] . </span><span class="string">' ' </span><span class="keyword">. </span><span class="default">$info</span><span class="keyword">[</span><span class="default">7</span><span class="keyword">]),<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'raw'&nbsp; &nbsp; </span><span class="keyword">=&gt; </span><span class="default">$info<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// the 'children' attribut is automatically added if the folder contains at least one file<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="comment">// in $structure is all the data<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$structure</span><span class="keyword">);<br />
<br />
</span><span class="comment">// little helper functions<br />
</span><span class="keyword">function </span><span class="default">byteconvert</span><span class="keyword">(</span><span class="default">$bytes</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$symbol </span><span class="keyword">= array(</span><span class="string">'B'</span><span class="keyword">, </span><span class="string">'KB'</span><span class="keyword">, </span><span class="string">'MB'</span><span class="keyword">, </span><span class="string">'GB'</span><span class="keyword">, </span><span class="string">'TB'</span><span class="keyword">, </span><span class="string">'PB'</span><span class="keyword">, </span><span class="string">'EB'</span><span class="keyword">, </span><span class="string">'ZB'</span><span class="keyword">, </span><span class="string">'YB'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$exp </span><span class="keyword">= </span><span class="default">floor</span><span class="keyword">( </span><span class="default">log</span><span class="keyword">(</span><span class="default">$bytes</span><span class="keyword">) / </span><span class="default">log</span><span class="keyword">(</span><span class="default">1024</span><span class="keyword">) );<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">sprintf</span><span class="keyword">( </span><span class="string">'%.2f ' </span><span class="keyword">. </span><span class="default">$symbol</span><span class="keyword">[ </span><span class="default">$exp </span><span class="keyword">], (</span><span class="default">$bytes </span><span class="keyword">/ </span><span class="default">pow</span><span class="keyword">(</span><span class="default">1024</span><span class="keyword">, </span><span class="default">floor</span><span class="keyword">(</span><span class="default">$exp</span><span class="keyword">))) );<br />
}<br />
<br />
function </span><span class="default">chmodnum</span><span class="keyword">(</span><span class="default">$chmod</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$trans </span><span class="keyword">= array(</span><span class="string">'-' </span><span class="keyword">=&gt; </span><span class="string">'0'</span><span class="keyword">, </span><span class="string">'r' </span><span class="keyword">=&gt; </span><span class="string">'4'</span><span class="keyword">, </span><span class="string">'w' </span><span class="keyword">=&gt; </span><span class="string">'2'</span><span class="keyword">, </span><span class="string">'x' </span><span class="keyword">=&gt; </span><span class="string">'1'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$chmod </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">strtr</span><span class="keyword">(</span><span class="default">$chmod</span><span class="keyword">, </span><span class="default">$trans</span><span class="keyword">), </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$array </span><span class="keyword">= </span><span class="default">str_split</span><span class="keyword">(</span><span class="default">$chmod</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">array_sum</span><span class="keyword">(</span><span class="default">str_split</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">])) . </span><span class="default">array_sum</span><span class="keyword">(</span><span class="default">str_split</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">])) . </span><span class="default">array_sum</span><span class="keyword">(</span><span class="default">str_split</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]));<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="89540""></a>
  <div class="note">
   <strong class="user">francois frao_o</strong>
   <a href="#89540" class="date">12-Mar-2009 10:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Why not using POSIX regex to do the job here ? A preg_replace returns the information in an associative array with the following keys:<br />
<br />
&lt;rights&gt;<br />
&lt;number&gt;<br />
&lt;owner&gt;<br />
&lt;group&gt;<br />
&lt;file_size&gt;<br />
&lt;mod_time&gt;<br />
&lt;file&gt;<br />
&lt;type&gt; * that's a bonus: it will tell you if the item is either a file or a directory<br />
<br />
Code is shown below:<br />
<br />
$list=@ftp_rawlist($con,$directory) ;<br />
<br />
$items=array() ;<br />
<br />
foreach($list as $_)<br />
preg_replace(<br />
<br />
'`^(.{10}+)(\s*)(\d{1})(\s*)(\d*|\w*)'.<br />
'(\s*)(\d*|\w*)(\s*)(\d*)\s'.<br />
'([a-zA-Z]{3}+)(\s*)([0-9]{1,2}+)'.<br />
'(\s*)([0-9]{2}+):([0-9]{2}+)(\s*)(.*)$`Ue',<br />
<br />
'$items[]=array(<br />
"rights"=&gt;"$1", <br />
"number"=&gt;"$3", <br />
"owner"=&gt;"$5", "group"=&gt;"$7",<br />
"file_size"=&gt;"$9",<br />
"mod_time"=&gt;"$10 $12 $14:$15",<br />
"file"=&gt;"$17",<br />
"type"=&gt;print_r((preg_match("/^d/","$1"))?"dir":"file",1));',<br />
<br />
$_) ; # :p</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86869""></a>
  <div class="note">
   <strong class="user">www.bosssftp.com</strong>
   <a href="#86869" class="date">07-Nov-2008 02:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Some FTP servers only allow you to get list of files under current working directory. So if you always get result as empty array (array(0){ }), try changing the cwd befor get the list:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">ftprawlist</span><span class="keyword">(</span><span class="default">$connid</span><span class="keyword">, </span><span class="default">$dir</span><span class="keyword">) {
<br />
&nbsp; </span><span class="default">ftp_chdir</span><span class="keyword">(</span><span class="default">$connid</span><span class="keyword">, </span><span class="default">$dir</span><span class="keyword">);
<br />
&nbsp; return </span><span class="default">ftp_rawlist</span><span class="keyword">(</span><span class="default">$connid</span><span class="keyword">, </span><span class="string">"-a"</span><span class="keyword">);
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86780""></a>
  <div class="note">
   <strong class="user">phpnet uschlaepfer ch</strong>
   <a href="#86780" class="date">03-Nov-2008 08:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
On my PC (XP and Apache installed) - ftp_rawlist (with Parameter true) does only print a folder list - no subfolders, no files.
<br />
So i created this recursive function that writes all filenames (incl. paths) to a array. I tested it on Mac, Linux and Windows - it works (as long as you don't use folders with spaces...).
<br />
If you need more information: feel free to set more split[x]-Options and write them to the $files-array.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="comment"># the directory where ftp_rawlist starts
<br />
</span><span class="default">$startdir </span><span class="keyword">= </span><span class="string">"example"</span><span class="keyword">;
<br />

<br />
</span><span class="comment"># optional Datatypefilter (leave blank if not needed)
<br />
</span><span class="default">$suffix&nbsp;&nbsp; </span><span class="keyword">= </span><span class="string">"gif,png,jpeg,pdf,php"</span><span class="keyword">;
<br />
</span><span class="comment"># ftp-login
<br />
</span><span class="default">$ftp_server </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;
<br />
</span><span class="default">$ftp_user&nbsp;&nbsp; </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;
<br />
</span><span class="default">$ftp_pw&nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;
<br />
</span><span class="default">$ftp_mode&nbsp;&nbsp; </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;
<br />
</span><span class="default">$conn_id&nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">ftp_connect</span><span class="keyword">(</span><span class="default">$ftp_server</span><span class="keyword">);
<br />
</span><span class="default">ftp_login</span><span class="keyword">(</span><span class="default">$conn_id</span><span class="keyword">, </span><span class="default">$ftp_user</span><span class="keyword">, </span><span class="default">$ftp_pw</span><span class="keyword">) OR die(</span><span class="string">"&lt;br&gt;ftp-login failed"</span><span class="keyword">);
<br />
</span><span class="default">ftp_pasv</span><span class="keyword">(</span><span class="default">$conn_id</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);
<br />

<br />
</span><span class="comment">#*********************************************************************
<br />
# create filelist (recursiv)
<br />
#*********************************************************************
<br />
</span><span class="default">$files&nbsp; &nbsp; </span><span class="keyword">= array(); </span><span class="comment"># must be defined here
<br />
</span><span class="default">$files&nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">raw_list</span><span class="keyword">(</span><span class="string">"</span><span class="default">$startdir</span><span class="string">"</span><span class="keyword">); 
<br />

<br />
</span><span class="comment">#*********************************************************************
<br />
# print result
<br />
#*********************************************************************
<br />
</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$count </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$files</span><span class="keyword">);
<br />
while (</span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$count</span><span class="keyword">):
<br />
&nbsp; echo </span><span class="string">"</span><span class="default">$files</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]</span><span class="string">&lt;br&gt;"</span><span class="keyword">;
<br />
&nbsp; </span><span class="default">$i</span><span class="keyword">++;
<br />
endwhile;
<br />
</span><span class="default">ftp_close</span><span class="keyword">(</span><span class="default">$conn_id</span><span class="keyword">);
<br />

<br />
</span><span class="comment">#*********************************************************************
<br />
# rawlist in recursive form (without parameter true!!!)
<br />
#*********************************************************************
<br />
</span><span class="keyword">function </span><span class="default">raw_list</span><span class="keyword">(</span><span class="default">$folder</span><span class="keyword">)
<br />
{
<br />
Global </span><span class="default">$conn_id</span><span class="keyword">;
<br />
Global </span><span class="default">$suffix</span><span class="keyword">;
<br />
Global </span><span class="default">$files</span><span class="keyword">;
<br />
</span><span class="default">$suffixes </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">","</span><span class="keyword">, </span><span class="default">$suffix</span><span class="keyword">); 
<br />
</span><span class="default">$list&nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">ftp_rawlist</span><span class="keyword">(</span><span class="default">$conn_id</span><span class="keyword">, </span><span class="default">$folder</span><span class="keyword">);
<br />
</span><span class="default">$anzlist&nbsp; </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$list</span><span class="keyword">); 
<br />
</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br />
while (</span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$anzlist</span><span class="keyword">):
<br />
&nbsp; </span><span class="default">$split&nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">preg_split</span><span class="keyword">(</span><span class="string">"/[\s]+/"</span><span class="keyword">, </span><span class="default">$list</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">], </span><span class="default">9</span><span class="keyword">, </span><span class="default">PREG_SPLIT_NO_EMPTY</span><span class="keyword">);
<br />
&nbsp; </span><span class="default">$ItemName </span><span class="keyword">= </span><span class="default">$split</span><span class="keyword">[</span><span class="default">8</span><span class="keyword">];
<br />
&nbsp; </span><span class="default">$endung&nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">strrchr</span><span class="keyword">(</span><span class="default">$ItemName</span><span class="keyword">,</span><span class="string">"."</span><span class="keyword">),</span><span class="default">1</span><span class="keyword">));
<br />
&nbsp; </span><span class="default">$path&nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="string">"</span><span class="default">$folder</span><span class="string">/</span><span class="default">$ItemName</span><span class="string">"</span><span class="keyword">;
<br />
&nbsp; if (</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$list</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">],</span><span class="default">0</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">) === </span><span class="string">"d" </span><span class="keyword">AND </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$ItemName</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">) != </span><span class="string">"."</span><span class="keyword">):
<br />
</span><span class="comment">#&nbsp; &nbsp; &nbsp; array_push($files, $path); # write directory in array if desired
<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">raw_list</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">);
<br />
&nbsp; elseif (</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$ItemName</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">) != </span><span class="string">"._" </span><span class="keyword">AND </span><span class="default">in_array</span><span class="keyword">(</span><span class="default">$endung</span><span class="keyword">,</span><span class="default">$suffixes</span><span class="keyword">)):
<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">array_push</span><span class="keyword">(</span><span class="default">$files</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">);
<br />
&nbsp; endif;
<br />
&nbsp; </span><span class="default">$i</span><span class="keyword">++;
<br />
endwhile;
<br />
return </span><span class="default">$files</span><span class="keyword">;
<br />
}
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Ueli, Zurich</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82752""></a>
  <div class="note">
   <strong class="user">paul maybe at squirrel mail org</strong>
   <a href="#82752" class="date">24-Apr-2008 05:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Regarding converting permissions from symbolic notation to octal, note that Hazem dot Khaled at gmail dot com's chmodnum function produces INCORRECT results.&nbsp; The resutls are base-10 numbers that only LOOK like they are octal numbers.&nbsp; The function also ignores setuid, setgid and sticky bits, and will produce incorrect numbers if such a file is encountered.&nbsp; Instead, this brute-force code works.&nbsp; Maybe there is something more slick, but this isn't too CPU-intensive (note that it assumes you've error-checked that you indeed have a 10-character string!):<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; $permissions = 'drwxr-xr-x';&nbsp; // or whatever<br />
&nbsp;&nbsp; &nbsp;&nbsp; $mode = 0;<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; if ($permissions[1] == 'r') $mode += 0400;<br />
&nbsp;&nbsp; &nbsp;&nbsp; if ($permissions[2] == 'w') $mode += 0200;<br />
&nbsp;&nbsp; &nbsp;&nbsp; if ($permissions[3] == 'x') $mode += 0100;<br />
&nbsp;&nbsp; &nbsp;&nbsp; else if ($permissions[3] == 's') $mode += 04100;<br />
&nbsp;&nbsp; &nbsp;&nbsp; else if ($permissions[3] == 'S') $mode += 04000;<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; if ($permissions[4] == 'r') $mode += 040;<br />
&nbsp;&nbsp; &nbsp;&nbsp; if ($permissions[5] == 'w') $mode += 020;<br />
&nbsp;&nbsp; &nbsp;&nbsp; if ($permissions[6] == 'x') $mode += 010;<br />
&nbsp;&nbsp; &nbsp;&nbsp; else if ($permissions[6] == 's') $mode += 02010;<br />
&nbsp;&nbsp; &nbsp;&nbsp; else if ($permissions[6] == 'S') $mode += 02000;<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; if ($permissions[7] == 'r') $mode += 04;<br />
&nbsp;&nbsp; &nbsp;&nbsp; if ($permissions[8] == 'w') $mode += 02;<br />
&nbsp;&nbsp; &nbsp;&nbsp; if ($permissions[9] == 'x') $mode += 01;<br />
&nbsp;&nbsp; &nbsp;&nbsp; else if ($permissions[9] == 't') $mode += 01001;<br />
&nbsp;&nbsp; &nbsp;&nbsp; else if ($permissions[9] == 'T') $mode += 01000;<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; printf('Mode is %d decimal and %o octal', $mode, $mode);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="80218""></a>
  <div class="note">
   <strong class="user">weltvolk</strong>
   <a href="#80218" class="date">04-Jan-2008 06:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
With this handy function based on functions presented here you get the file list in alphabetical order with all directories on top:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">rawlist_dump</span><span class="keyword">() {<br />
&nbsp; global </span><span class="default">$ftp_connect</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$ftp_rawlist </span><span class="keyword">= </span><span class="default">ftp_rawlist</span><span class="keyword">(</span><span class="default">$ftp_connect</span><span class="keyword">, </span><span class="string">"."</span><span class="keyword">);<br />
&nbsp; foreach (</span><span class="default">$ftp_rawlist </span><span class="keyword">as </span><span class="default">$v</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$info </span><span class="keyword">= array();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$vinfo </span><span class="keyword">= </span><span class="default">preg_split</span><span class="keyword">(</span><span class="string">"/[\s]+/"</span><span class="keyword">, </span><span class="default">$v</span><span class="keyword">, </span><span class="default">9</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$vinfo</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] !== </span><span class="string">"total"</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$info</span><span class="keyword">[</span><span class="string">'chmod'</span><span class="keyword">] = </span><span class="default">$vinfo</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$info</span><span class="keyword">[</span><span class="string">'num'</span><span class="keyword">] = </span><span class="default">$vinfo</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$info</span><span class="keyword">[</span><span class="string">'owner'</span><span class="keyword">] = </span><span class="default">$vinfo</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$info</span><span class="keyword">[</span><span class="string">'group'</span><span class="keyword">] = </span><span class="default">$vinfo</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$info</span><span class="keyword">[</span><span class="string">'size'</span><span class="keyword">] = </span><span class="default">$vinfo</span><span class="keyword">[</span><span class="default">4</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$info</span><span class="keyword">[</span><span class="string">'month'</span><span class="keyword">] = </span><span class="default">$vinfo</span><span class="keyword">[</span><span class="default">5</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$info</span><span class="keyword">[</span><span class="string">'day'</span><span class="keyword">] = </span><span class="default">$vinfo</span><span class="keyword">[</span><span class="default">6</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$info</span><span class="keyword">[</span><span class="string">'time'</span><span class="keyword">] = </span><span class="default">$vinfo</span><span class="keyword">[</span><span class="default">7</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$info</span><span class="keyword">[</span><span class="string">'name'</span><span class="keyword">] = </span><span class="default">$vinfo</span><span class="keyword">[</span><span class="default">8</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$rawlist</span><span class="keyword">[</span><span class="default">$info</span><span class="keyword">[</span><span class="string">'name'</span><span class="keyword">]] = </span><span class="default">$info</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
&nbsp; </span><span class="default">$dir </span><span class="keyword">= array();<br />
&nbsp; </span><span class="default">$file </span><span class="keyword">= array();<br />
&nbsp; foreach (</span><span class="default">$rawlist </span><span class="keyword">as </span><span class="default">$k </span><span class="keyword">=&gt; </span><span class="default">$v</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$v</span><span class="keyword">[</span><span class="string">'chmod'</span><span class="keyword">]{</span><span class="default">0</span><span class="keyword">} == </span><span class="string">"d"</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$dir</span><span class="keyword">[</span><span class="default">$k</span><span class="keyword">] = </span><span class="default">$v</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; } elseif (</span><span class="default">$v</span><span class="keyword">[</span><span class="string">'chmod'</span><span class="keyword">]{</span><span class="default">0</span><span class="keyword">} == </span><span class="string">"-"</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$file</span><span class="keyword">[</span><span class="default">$k</span><span class="keyword">] = </span><span class="default">$v</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
&nbsp; foreach (</span><span class="default">$dir </span><span class="keyword">as </span><span class="default">$dirname </span><span class="keyword">=&gt; </span><span class="default">$dirinfo</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; echo </span><span class="string">"[ </span><span class="default">$dirname</span><span class="string"> ] " </span><span class="keyword">. </span><span class="default">$dirinfo</span><span class="keyword">[</span><span class="string">'chmod'</span><span class="keyword">] . </span><span class="string">" | " </span><span class="keyword">. </span><span class="default">$dirinfo</span><span class="keyword">[</span><span class="string">'owner'</span><span class="keyword">] . </span><span class="string">" | " </span><span class="keyword">. </span><span class="default">$dirinfo</span><span class="keyword">[</span><span class="string">'group'</span><span class="keyword">] . </span><span class="string">" | " </span><span class="keyword">. </span><span class="default">$dirinfo</span><span class="keyword">[</span><span class="string">'month'</span><span class="keyword">] . </span><span class="string">" " </span><span class="keyword">. </span><span class="default">$dirinfo</span><span class="keyword">[</span><span class="string">'day'</span><span class="keyword">] . </span><span class="string">" " </span><span class="keyword">. </span><span class="default">$dirinfo</span><span class="keyword">[</span><span class="string">'time'</span><span class="keyword">] . </span><span class="string">"&lt;br&gt;"</span><span class="keyword">;<br />
&nbsp; }<br />
&nbsp; foreach (</span><span class="default">$file </span><span class="keyword">as </span><span class="default">$filename </span><span class="keyword">=&gt; </span><span class="default">$fileinfo</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; echo </span><span class="string">"</span><span class="default">$filename</span><span class="string"> " </span><span class="keyword">. </span><span class="default">$fileinfo</span><span class="keyword">[</span><span class="string">'chmod'</span><span class="keyword">] . </span><span class="string">" | " </span><span class="keyword">. </span><span class="default">$fileinfo</span><span class="keyword">[</span><span class="string">'owner'</span><span class="keyword">] . </span><span class="string">" | " </span><span class="keyword">. </span><span class="default">$fileinfo</span><span class="keyword">[</span><span class="string">'group'</span><span class="keyword">] . </span><span class="string">" | " </span><span class="keyword">. </span><span class="default">$fileinfo</span><span class="keyword">[</span><span class="string">'size'</span><span class="keyword">] . </span><span class="string">" Byte | " </span><span class="keyword">. </span><span class="default">$fileinfo</span><span class="keyword">[</span><span class="string">'month'</span><span class="keyword">] . </span><span class="string">" " </span><span class="keyword">. </span><span class="default">$fileinfo</span><span class="keyword">[</span><span class="string">'day'</span><span class="keyword">] . </span><span class="string">" " </span><span class="keyword">. </span><span class="default">$fileinfo</span><span class="keyword">[</span><span class="string">'time'</span><span class="keyword">] . </span><span class="string">"&lt;br&gt;"</span><span class="keyword">;<br />
&nbsp; }<br />
}<br />
</span><span class="default">rawlist_dump</span><span class="keyword">();<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="70447""></a>
  <div class="note">
   <strong class="user">ari at bs-inc dot com</strong>
   <a href="#70447" class="date">17-Oct-2006 01:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is a little cleaner:<br />
<br />
function parse_rawlist( $array )<br />
{<br />
&nbsp;&nbsp;&nbsp; foreach($array as $curraw)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $struc = array();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $current = preg_split("/[\s]+/",$curraw,9);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $struc['perms']&nbsp; = $current[0];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $struc['number'] = $current[1];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $struc['owner']&nbsp; = $current[2];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $struc['group']&nbsp; = $current[3];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $struc['size']&nbsp; = $current[4];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $struc['month']&nbsp; = $current[5];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $struc['day']&nbsp; &nbsp; = $current[6];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $struc['time']&nbsp; = $current[7];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $struc['year']&nbsp; = $current[8];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $struc['raw']&nbsp; = $curraw;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $structure[$struc['name']] = $struc;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp; return $structure;<br />
<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69688""></a>
  <div class="note">
   <strong class="user">kerbpm</strong>
   <a href="#69688" class="date">15-Sep-2006 02:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Your code is ok, just replace $i = 0 instead of 1<br />
Thank you<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">parse_rawlist</span><span class="keyword">( </span><span class="default">$array </span><span class="keyword">) {<br />
<br />
&nbsp;&nbsp; for ( </span><span class="default">$i </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">count</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">); </span><span class="default">$i</span><span class="keyword">++ ) {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$current </span><span class="keyword">= </span><span class="default">$array</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">];<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$structure</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][</span><span class="string">'perms'</span><span class="keyword">]&nbsp; = </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$current</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">10</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$structure</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][</span><span class="string">'number'</span><span class="keyword">] = </span><span class="default">trim</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$current</span><span class="keyword">, </span><span class="default">11</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$structure</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][</span><span class="string">'owner'</span><span class="keyword">]&nbsp; = </span><span class="default">trim</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$current</span><span class="keyword">, </span><span class="default">15</span><span class="keyword">, </span><span class="default">8</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$structure</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][</span><span class="string">'group'</span><span class="keyword">]&nbsp; = </span><span class="default">trim</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$current</span><span class="keyword">, </span><span class="default">24</span><span class="keyword">, </span><span class="default">8</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$structure</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][</span><span class="string">'size'</span><span class="keyword">]&nbsp; = </span><span class="default">trim</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$current</span><span class="keyword">, </span><span class="default">33</span><span class="keyword">, </span><span class="default">8</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$structure</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][</span><span class="string">'month'</span><span class="keyword">]&nbsp; = </span><span class="default">trim</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$current</span><span class="keyword">, </span><span class="default">42</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$structure</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][</span><span class="string">'day'</span><span class="keyword">]&nbsp; &nbsp; = </span><span class="default">trim</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$current</span><span class="keyword">, </span><span class="default">46</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$structure</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][</span><span class="string">'time'</span><span class="keyword">]&nbsp; = </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$current</span><span class="keyword">, </span><span class="default">49</span><span class="keyword">, </span><span class="default">5</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$structure</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][</span><span class="string">'name'</span><span class="keyword">]&nbsp; = </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$current</span><span class="keyword">, </span><span class="default">55</span><span class="keyword">, </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$current</span><span class="keyword">) - </span><span class="default">55</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; return </span><span class="default">$structure</span><span class="keyword">;<br />
<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69551""></a>
  <div class="note">
   <strong class="user">MSpreij at GMail</strong>
   <a href="#69551" class="date">09-Sep-2006 05:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The following was inspired by a few others here, ofcourse ;-)<br />
Works for filenames with spaces (leading, trailing, consecutive and what not), formats the date a little taking year/time into account, leaves out items not in the $filetypes array below, and returns a nice nested assoc array:<br />
<br />
<span class="default">&lt;?php<br />
<br />
$filetypes </span><span class="keyword">= array(</span><span class="string">'-'</span><span class="keyword">=&gt;</span><span class="string">'file'</span><span class="keyword">, </span><span class="string">'d'</span><span class="keyword">=&gt;</span><span class="string">'directory'</span><span class="keyword">, </span><span class="string">'l'</span><span class="keyword">=&gt;</span><span class="string">'link'</span><span class="keyword">);<br />
<br />
</span><span class="default">$c </span><span class="keyword">= </span><span class="default">ftp_connect</span><span class="keyword">(</span><span class="string">'localhost'</span><span class="keyword">);<br />
</span><span class="default">ftp_login</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">, </span><span class="string">'jackcrow'</span><span class="keyword">, </span><span class="string">'banshee'</span><span class="keyword">);<br />
</span><span class="default">$data </span><span class="keyword">= </span><span class="default">ftp_rawlist</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">, </span><span class="string">'/users/jackcrow'</span><span class="keyword">);<br />
<br />
foreach(</span><span class="default">$data </span><span class="keyword">as </span><span class="default">$line</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">substr</span><span class="keyword">(</span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">$line</span><span class="keyword">), </span><span class="default">0</span><span class="keyword">, </span><span class="default">5</span><span class="keyword">) == </span><span class="string">'total'</span><span class="keyword">) continue; </span><span class="comment"># first line, skip it<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'/'</span><span class="keyword">. </span><span class="default">str_repeat</span><span class="keyword">(</span><span class="string">'([^\s]+)\s+'</span><span class="keyword">, </span><span class="default">7</span><span class="keyword">) .</span><span class="string">'([^\s]+) (.*)/'</span><span class="keyword">, </span><span class="default">$line</span><span class="keyword">, </span><span class="default">$matches</span><span class="keyword">); </span><span class="comment"># Here be Dragons<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">list(</span><span class="default">$permissions</span><span class="keyword">, </span><span class="default">$children</span><span class="keyword">, </span><span class="default">$owner</span><span class="keyword">, </span><span class="default">$group</span><span class="keyword">, </span><span class="default">$size</span><span class="keyword">, </span><span class="default">$month</span><span class="keyword">, </span><span class="default">$day</span><span class="keyword">, </span><span class="default">$time</span><span class="keyword">, </span><span class="default">$name</span><span class="keyword">) = </span><span class="default">array_slice</span><span class="keyword">(</span><span class="default">$matches</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment"># if it's not a file, directory or link, I don't really care to know about it :-) comment out the next line if you do<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (! </span><span class="default">in_array</span><span class="keyword">(</span><span class="default">$permissions</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="default">array_keys</span><span class="keyword">(</span><span class="default">$filetypes</span><span class="keyword">))) continue;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$type </span><span class="keyword">= </span><span class="default">$filetypes</span><span class="keyword">[</span><span class="default">$permissions</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]];<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$date </span><span class="keyword">= </span><span class="default">date</span><span class="keyword">(</span><span class="string">'d/m/y H:i'</span><span class="keyword">, (</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$time</span><span class="keyword">, </span><span class="string">':'</span><span class="keyword">) ? </span><span class="default">mktime</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$time</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">), </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$time</span><span class="keyword">, -</span><span class="default">2</span><span class="keyword">), </span><span class="default">0</span><span class="keyword">, </span><span class="default">$month</span><span class="keyword">, </span><span class="default">$day</span><span class="keyword">) : </span><span class="default">mktime</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$month</span><span class="keyword">, </span><span class="default">$day</span><span class="keyword">, </span><span class="default">$time</span><span class="keyword">) ) );<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$files</span><span class="keyword">[</span><span class="default">$name</span><span class="keyword">] = array(</span><span class="string">'type'</span><span class="keyword">=&gt;</span><span class="default">$type</span><span class="keyword">, </span><span class="string">'permissions'</span><span class="keyword">=&gt;</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$permissions</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">), </span><span class="string">'children'</span><span class="keyword">=&gt;</span><span class="default">$children</span><span class="keyword">, </span><span class="string">'owner'</span><span class="keyword">=&gt;</span><span class="default">$owner</span><span class="keyword">, </span><span class="string">'group'</span><span class="keyword">=&gt;</span><span class="default">$group</span><span class="keyword">, </span><span class="string">'size'</span><span class="keyword">=&gt;</span><span class="default">$size</span><span class="keyword">, </span><span class="string">'date'</span><span class="keyword">=&gt;</span><span class="default">$date</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$files</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
(I'm using a pretty simple regex pattern (non-space-stuff, whitespace, non-space-stuff etc), but amazingly /it still works!/ K.I.S.S.! The time part in the pattern is done separately to make sure only 1 space is taken out before the filename, which might start with spaces for all you know)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="59346""></a>
  <div class="note">
   <strong class="user">admin at mikeholloway dot co dot uk</strong>
   <a href="#59346" class="date">03-Dec-2005 02:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I was having problems picking up the directories on a mac using cjacobsen at pge dot cl's (11-Jan-05) solution. Slight ammendment to the regexp works for me:<br />
<br />
ereg("([-dl][rwxstST-]+).* ?([0-9 ]* )?([a-zA-Z0-9]+).* ([a-zA-Z0-9]+).* ([0-9]*) ([a-zA-Z]+[0-9: ]*[0-9])[ ]+(([0-9]{2}:[0-9]{2})|[0-9]{4}) (.+)", $file, $regs)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="57217""></a>
  <div class="note">
   <strong class="user">d dot lloyd at tnw dot tudelft dot nl</strong>
   <a href="#57217" class="date">27-Sep-2005 06:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
One comment regaring the method tig3r uses to determine the listing type.<br />
<br />
Windows servers can return a listing in unix format if the ftp server has been told to use unix formatting. The only robust solution I have is to try both ereg commands once and see which one successfully returns an array.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="55936""></a>
  <div class="note">
   <strong class="user">tig3r at poczta dot onet dot pl</strong>
   <a href="#55936" class="date">18-Aug-2005 03:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Previous example (by davidknoll at o2 dot co dot uk) works well if ftp_systype() returned "UNIX", but sometimes I am experiencing "Windows_NT". Here is some improvement:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">parsed_listing</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp; </span><span class="default">$conn </span><span class="keyword">= </span><span class="default">ftp_connect</span><span class="keyword">(</span><span class="default">FTP_HOST</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">ftp_login</span><span class="keyword">(</span><span class="default">$conn</span><span class="keyword">, </span><span class="default">FTP_USER</span><span class="keyword">, </span><span class="default">FTP_PASS</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">$systype </span><span class="keyword">= </span><span class="default">ftp_systype</span><span class="keyword">(</span><span class="default">$conn_id</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">$list </span><span class="keyword">= </span><span class="default">ftp_rawlist</span><span class="keyword">(</span><span class="default">$conn</span><span class="keyword">, </span><span class="string">"-a "</span><span class="keyword">.</span><span class="default">FTP_BASE</span><span class="keyword">.</span><span class="default">$path</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">ftp_close</span><span class="keyword">(</span><span class="default">$conn</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; foreach (</span><span class="default">$list </span><span class="keyword">as </span><span class="default">$current</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; switch (</span><span class="default">$systype</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="string">"Windows_NT"</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">ereg</span><span class="keyword">(</span><span class="string">"([0-9]{2})-([0-9]{2})-([0-9]{2}) +([0-9]{2}):([0-9]{2})(AM|PM) +([0-9]+|&lt;DIR&gt;) +(.+)"</span><span class="keyword">,</span><span class="default">$current</span><span class="keyword">,</span><span class="default">$split</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$split</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$split</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">]&lt;</span><span class="default">70</span><span class="keyword">) { </span><span class="default">$split</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">]+=</span><span class="default">2000</span><span class="keyword">; } else { </span><span class="default">$split</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">]+=</span><span class="default">1900</span><span class="keyword">; } </span><span class="comment">// 4digit year fix<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$parsed</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][</span><span class="string">'isdir'</span><span class="keyword">] = (</span><span class="default">$split</span><span class="keyword">[</span><span class="default">7</span><span class="keyword">]==</span><span class="string">"&lt;DIR&gt;"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$parsed</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][</span><span class="string">'size'</span><span class="keyword">] = </span><span class="default">$split</span><span class="keyword">[</span><span class="default">7</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$parsed</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][</span><span class="string">'month'</span><span class="keyword">] = </span><span class="default">$split</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$parsed</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][</span><span class="string">'day'</span><span class="keyword">] = </span><span class="default">$split</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$parsed</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][</span><span class="string">'time/year'</span><span class="keyword">] = </span><span class="default">$split</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$parsed</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][</span><span class="string">'name'</span><span class="keyword">] = </span><span class="default">$split</span><span class="keyword">[</span><span class="default">8</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$i</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; break;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="string">"UNIX"</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; default:<br />
<br />
</span><span class="comment">// etc.<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">break;<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; }<br />
&nbsp;&nbsp; return </span><span class="default">$parsed</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="54750""></a>
  <div class="note">
   <strong class="user">davidknoll at o2 dot co dot uk</strong>
   <a href="#54750" class="date">14-Jul-2005 04:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Well, this works for me:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">parsed_listing</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$conn </span><span class="keyword">= </span><span class="default">ftp_connect</span><span class="keyword">(</span><span class="default">FTP_HOST</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">ftp_login</span><span class="keyword">(</span><span class="default">$conn</span><span class="keyword">, </span><span class="default">FTP_USER</span><span class="keyword">, </span><span class="default">FTP_PASS</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$list </span><span class="keyword">= </span><span class="default">ftp_rawlist</span><span class="keyword">(</span><span class="default">$conn</span><span class="keyword">, </span><span class="string">"-a "</span><span class="keyword">.</span><span class="default">FTP_BASE</span><span class="keyword">.</span><span class="default">$path</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">ftp_close</span><span class="keyword">(</span><span class="default">$conn</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$list </span><span class="keyword">as </span><span class="default">$current</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$split </span><span class="keyword">= </span><span class="default">preg_split</span><span class="keyword">(</span><span class="string">"[ ]"</span><span class="keyword">, </span><span class="default">$current</span><span class="keyword">, </span><span class="default">9</span><span class="keyword">, </span><span class="default">PREG_SPLIT_NO_EMPTY</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$split</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] != </span><span class="string">"total"</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$parsed</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][</span><span class="string">'isdir'</span><span class="keyword">]&nbsp; &nbsp; &nbsp; &nbsp; = </span><span class="default">$split</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]{</span><span class="default">0</span><span class="keyword">} === </span><span class="string">"d"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$parsed</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][</span><span class="string">'perms'</span><span class="keyword">]&nbsp; &nbsp; &nbsp; &nbsp; = </span><span class="default">$split</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$parsed</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][</span><span class="string">'number'</span><span class="keyword">]&nbsp; &nbsp; = </span><span class="default">$split</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$parsed</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][</span><span class="string">'owner'</span><span class="keyword">]&nbsp; &nbsp; &nbsp; &nbsp; = </span><span class="default">$split</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$parsed</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][</span><span class="string">'group'</span><span class="keyword">]&nbsp; &nbsp; &nbsp; &nbsp; = </span><span class="default">$split</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$parsed</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][</span><span class="string">'size'</span><span class="keyword">]&nbsp; &nbsp; &nbsp; &nbsp; = </span><span class="default">$split</span><span class="keyword">[</span><span class="default">4</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$parsed</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][</span><span class="string">'month'</span><span class="keyword">]&nbsp; &nbsp; &nbsp; &nbsp; = </span><span class="default">$split</span><span class="keyword">[</span><span class="default">5</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$parsed</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][</span><span class="string">'day'</span><span class="keyword">]&nbsp; &nbsp; &nbsp; &nbsp; = </span><span class="default">$split</span><span class="keyword">[</span><span class="default">6</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$parsed</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][</span><span class="string">'time/year'</span><span class="keyword">]&nbsp; &nbsp; = </span><span class="default">$split</span><span class="keyword">[</span><span class="default">7</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$parsed</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][</span><span class="string">'name'</span><span class="keyword">]&nbsp; &nbsp; &nbsp; &nbsp; = </span><span class="default">$split</span><span class="keyword">[</span><span class="default">8</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$i</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$parsed</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="52635""></a>
  <div class="note">
   <strong class="user">nate at 8networks dot com</strong>
   <a href="#52635" class="date">07-May-2005 12:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
this snip fixes the date problem with the listing and sorts out the variables:<br />
<br />
$filedata['access_permissions']<br />
$filedata['link_count']<br />
$filedata['uid']<br />
$filedata['gid']<br />
$filedata['size']<br />
$filedata['mod_date_month']<br />
$filedata['mod_date_day']<br />
$filedata['mod_time']<br />
$filedata['name']<br />
<br />
list($filedata['access_permissions'], $filedata['link_count'], $filedata['uid'], $filedata['gid'], $filedata['size'], $filedata['mod_date_month'], $filedata['mod_date_day'], $filedata['mod_time'], $filedata['name']) = preg_split("/[\s,]+/", $value);<br />
<br />
$filedata['type'] = $filedata['access_permissions']{0};<br />
<br />
$filedata['access_permissions'] = substr($filedata['access_permissions'],1);<br />
<br />
// now check the date to see if the last modifcation was this year or last.<br />
<br />
if ( strrpos($filedata['mod_time'], ':') != 2 ) { $filedata['mod_date'] = $filedata['mod_date_month'] ." " . $filedata['mod_date_day'] . " " . $filedata['mod_time']; $filedata['mod_time'] = "00:00"; } else { $filedata['mod_date'] = $filedata['mod_date_month'] ." " . $filedata['mod_date_day'] . " " . date("Y"); }</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="52406""></a>
  <div class="note">
   <strong class="user">john at nm-design dot com</strong>
   <a href="#52406" class="date">29-Apr-2005 10:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I'm not a traditional programmer, so I often take a different approach then most programmers. Here's how I get file information from an FTP file list. It's very simple (which I like). Comments are welcome:<br />
<br />
&nbsp;&nbsp;&nbsp; // make your FTP connection calls here, then ...&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; $contents = ftp_rawlist($ftp_id, ".");<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; echo '&lt;TABLE&gt;';<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; foreach ($contents as $key =&gt; $value) {<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $info = explode(" ", $value);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $clean = array();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach ($info as $key =&gt; $value) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!empty($value)) { $clean[] = $value; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } // end foreach loop 2<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( ($clean[8] != ".") AND ($clean[8] != "..") AND ($clean[8] != "html") AND ($clean[8] != "logs") AND ($clean[8] != "protected") AND ($clean[8] != "sys") ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo '&lt;TR&gt;';<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; print "&lt;TD WIDTH=\"40%\"&gt;$clean[8]&lt;/TD&gt;"; // name of file<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; print "&lt;TD WIDTH=\"20%\" ALIGN=\"CENTER\"&gt;$clean[5] $clean[6] $clean[7]&lt;/TD&gt;"; // date info<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // prep size<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $size = $clean[4]; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $size = $size / 1000; $size = ceil($size); if ($size &lt;= 0) { $size = 1; } <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($size &gt;= 1000) { $measure = "MB"; $size = $size /&nbsp; 1000; } else { $measure = "K"; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; print "&lt;TD WIDTH=\"20%\" ALIGN=\"CENTER\"&gt;$size $measure&lt;/TD&gt;"; // size<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo '&lt;TD WIDTH="20%" ALIGN="CENTER" BGCOLOR="#FFFFE6" CLASS="bodyBold"&gt;'; print "&lt;A HREF=\"$PHP_SELF?Submit=DELETE&amp;file=$clean[8]\"&gt;"; echo 'DELETE&lt;/A&gt;&lt;/TD&gt;'; // link to delete file<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo '&lt;/TR&gt;';<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } // end if<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; } // end foreach loop 1<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; echo '&lt;/TABLE&gt;';</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="49628""></a>
  <div class="note">
   <strong class="user">marc dot peterlongo at francetelecom dot com</strong>
   <a href="#49628" class="date">03-Feb-2005 02:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When you try:<br />
<br />
$path = "directory pathname with spaces";<br />
$list = ftp_rawlist($conn_id,$path);<br />
<br />
It doesn't work<br />
<br />
but when you try:<br />
<br />
$path = "directory pathname with spaces";<br />
ftp_chdir($conn_id,$path);<br />
$list = ftp_rawlist($conn_id,".");<br />
<br />
It works</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="48899""></a>
  <div class="note">
   <strong class="user">cjacobsen at pge dot cl</strong>
   <a href="#48899" class="date">11-Jan-2005 05:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Excelent expresion, but don't match SUID, SGUI and Sticky flags when 'x' is disabled. Fix it with [rwxstST-].<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">itemize_dir</span><span class="keyword">(</span><span class="default">$contents</span><span class="keyword">) {<br />
&nbsp;&nbsp; foreach (</span><span class="default">$contents </span><span class="keyword">as </span><span class="default">$file</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; if(</span><span class="default">ereg</span><span class="keyword">(</span><span class="string">"([-dl][rwxstST-]+).* ([0-9]*) ([a-zA-Z0-9]+).* ([a-zA-Z0-9]+).* ([0-9]*) ([a-zA-Z]+[0-9: ]*[0-9])[ ]+(([0-9]{2}:[0-9]{2})|[0-9]{4}) (.+)"</span><span class="keyword">, </span><span class="default">$file</span><span class="keyword">, </span><span class="default">$regs</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$type </span><span class="keyword">= (int) </span><span class="default">strpos</span><span class="keyword">(</span><span class="string">"-dl"</span><span class="keyword">, </span><span class="default">$regs</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]{</span><span class="default">0</span><span class="keyword">});<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$tmp_array</span><span class="keyword">[</span><span class="string">'line'</span><span class="keyword">] = </span><span class="default">$regs</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$tmp_array</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] = </span><span class="default">$type</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$tmp_array</span><span class="keyword">[</span><span class="string">'rights'</span><span class="keyword">] = </span><span class="default">$regs</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$tmp_array</span><span class="keyword">[</span><span class="string">'number'</span><span class="keyword">] = </span><span class="default">$regs</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$tmp_array</span><span class="keyword">[</span><span class="string">'user'</span><span class="keyword">] = </span><span class="default">$regs</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$tmp_array</span><span class="keyword">[</span><span class="string">'group'</span><span class="keyword">] = </span><span class="default">$regs</span><span class="keyword">[</span><span class="default">4</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$tmp_array</span><span class="keyword">[</span><span class="string">'size'</span><span class="keyword">] = </span><span class="default">$regs</span><span class="keyword">[</span><span class="default">5</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$tmp_array</span><span class="keyword">[</span><span class="string">'date'</span><span class="keyword">] = </span><span class="default">date</span><span class="keyword">(</span><span class="string">"m-d"</span><span class="keyword">,</span><span class="default">strtotime</span><span class="keyword">(</span><span class="default">$regs</span><span class="keyword">[</span><span class="default">6</span><span class="keyword">]));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$tmp_array</span><span class="keyword">[</span><span class="string">'time'</span><span class="keyword">] = </span><span class="default">$regs</span><span class="keyword">[</span><span class="default">7</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$tmp_array</span><span class="keyword">[</span><span class="string">'name'</span><span class="keyword">] = </span><span class="default">$regs</span><span class="keyword">[</span><span class="default">9</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$dir_list</span><span class="keyword">[] = </span><span class="default">$tmp_array</span><span class="keyword">;<br />
&nbsp;&nbsp; }<br />
&nbsp;&nbsp; return </span><span class="default">$dir_list</span><span class="keyword">;<br />
}<br />
</span><span class="default">$buff </span><span class="keyword">= </span><span class="default">ftp_rawlist</span><span class="keyword">(</span><span class="default">$cid</span><span class="keyword">, </span><span class="string">"/"</span><span class="keyword">);<br />
</span><span class="default">$items </span><span class="keyword">= </span><span class="default">itemize_dir</span><span class="keyword">(</span><span class="default">$buff</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="48339""></a>
  <div class="note">
   <strong class="user">greg at upsdn dot net</strong>
   <a href="#48339" class="date">19-Dec-2004 11:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
list all (including hidden files and dirs):<br />
<span class="default">&lt;?php<br />
&nbsp; $contents </span><span class="keyword">= </span><span class="default">ftp_rawlist</span><span class="keyword">(</span><span class="default">$conn_id</span><span class="keyword">, </span><span class="string">"-al "</span><span class="keyword">.</span><span class="default">$dir_name</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
just as ftp command:<br />
LIST al <br />
<br />
"-aF " is equal to '-al', please refer to "ls --help"</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="47713""></a>
  <div class="note">
   <strong class="user">greg at upsdn dot net</strong>
   <a href="#47713" class="date">25-Nov-2004 10:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The previous regular expression(by Jonathan Almarez,ergye at yahoo dot com and guru at virusas dot lt) is very good.But i found it does not&nbsp; take into account for directories(number&gt;9)<br />
<br />
Change [0-9] to [0-9]*<br />
<br />
The code below not only parses:<br />
drwxrwxr-x&nbsp; &nbsp;&nbsp; 9 msik&nbsp; &nbsp;&nbsp; ia&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 4096 Nov&nbsp; 5 14:19 Group3<br />
<br />
It also parses:<br />
drwxrwxr-x&nbsp;&nbsp; 19 msik&nbsp; &nbsp;&nbsp; ia&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 4096 Nov&nbsp; 5 14:19 Group3<br />
3 <br />
drwxrwxr-x&nbsp;&nbsp; 119 msik&nbsp; &nbsp;&nbsp; ia&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 4096 Nov&nbsp; 5 14:19 Group3<br />
3 <br />
<br />
0 = file<br />
1 = directory<br />
2 = simlink<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">itemize_dir</span><span class="keyword">(</span><span class="default">$contents</span><span class="keyword">) {<br />
&nbsp;&nbsp; foreach (</span><span class="default">$contents </span><span class="keyword">as </span><span class="default">$file</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; if(</span><span class="default">ereg</span><span class="keyword">(</span><span class="string">"([-dl][rwxst-]+).* ([0-9]*) ([a-zA-Z0-9]+).* ([a-zA-Z0-9]+).* ([0-9]*) ([a-zA-Z]+[0-9: ]*[0-9])[ ]+(([0-9]{2}:[0-9]{2})|[0-9]{4}) (.+)"</span><span class="keyword">, </span><span class="default">$file</span><span class="keyword">, </span><span class="default">$regs</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$type </span><span class="keyword">= (int) </span><span class="default">strpos</span><span class="keyword">(</span><span class="string">"-dl"</span><span class="keyword">, </span><span class="default">$regs</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]{</span><span class="default">0</span><span class="keyword">});<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$tmp_array</span><span class="keyword">[</span><span class="string">'line'</span><span class="keyword">] = </span><span class="default">$regs</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$tmp_array</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] = </span><span class="default">$type</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$tmp_array</span><span class="keyword">[</span><span class="string">'rights'</span><span class="keyword">] = </span><span class="default">$regs</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$tmp_array</span><span class="keyword">[</span><span class="string">'number'</span><span class="keyword">] = </span><span class="default">$regs</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$tmp_array</span><span class="keyword">[</span><span class="string">'user'</span><span class="keyword">] = </span><span class="default">$regs</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$tmp_array</span><span class="keyword">[</span><span class="string">'group'</span><span class="keyword">] = </span><span class="default">$regs</span><span class="keyword">[</span><span class="default">4</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$tmp_array</span><span class="keyword">[</span><span class="string">'size'</span><span class="keyword">] = </span><span class="default">$regs</span><span class="keyword">[</span><span class="default">5</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$tmp_array</span><span class="keyword">[</span><span class="string">'date'</span><span class="keyword">] = </span><span class="default">date</span><span class="keyword">(</span><span class="string">"m-d"</span><span class="keyword">,</span><span class="default">strtotime</span><span class="keyword">(</span><span class="default">$regs</span><span class="keyword">[</span><span class="default">6</span><span class="keyword">]));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$tmp_array</span><span class="keyword">[</span><span class="string">'time'</span><span class="keyword">] = </span><span class="default">$regs</span><span class="keyword">[</span><span class="default">7</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$tmp_array</span><span class="keyword">[</span><span class="string">'name'</span><span class="keyword">] = </span><span class="default">$regs</span><span class="keyword">[</span><span class="default">9</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$dir_list</span><span class="keyword">[] = </span><span class="default">$tmp_array</span><span class="keyword">;<br />
&nbsp;&nbsp; }<br />
&nbsp;&nbsp; return </span><span class="default">$dir_list</span><span class="keyword">;<br />
}<br />
</span><span class="default">$buff </span><span class="keyword">= </span><span class="default">ftp_rawlist</span><span class="keyword">(</span><span class="default">$cid</span><span class="keyword">, </span><span class="string">"/"</span><span class="keyword">);<br />
</span><span class="default">$items </span><span class="keyword">= </span><span class="default">itemize_dir</span><span class="keyword">(</span><span class="default">$buff</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="47677""></a>
  <div class="note">
   <strong class="user">Jonathan Almarez</strong>
   <a href="#47677" class="date">24-Nov-2004 03:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To make the latest correction to the parsing code:<br />
<br />
"ergye at yahoo dot com" dosen't take into account for files or directories that are older than a year where instead of showing the time, it shows the year.<br />
<br />
The code below not only parses:<br />
drwxrwxr-x&nbsp;&nbsp; 2 503&nbsp; &nbsp; &nbsp; 503&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 4096 Dec&nbsp; 3 12:12 CVAR<br />
<br />
It also parses:<br />
drwxrwxr-x&nbsp;&nbsp; 2 503&nbsp; &nbsp; &nbsp; 503&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 4096 Dec&nbsp; 3&nbsp; 2003 CVAR<br />
<br />
0 = file<br />
1 = directory<br />
2 = simlink<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">itemize_dir</span><span class="keyword">(</span><span class="default">$contents</span><span class="keyword">) {<br />
&nbsp;&nbsp; foreach (</span><span class="default">$contents </span><span class="keyword">as </span><span class="default">$file</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; if(</span><span class="default">ereg</span><span class="keyword">(</span><span class="string">"([-dl][rwxst-]+).* ([0-9]) ([a-zA-Z0-9]+).* ([a-zA-Z0-9]+).* ([0-9]*) ([a-zA-Z]+[0-9: ]*[0-9])[ ]+(([0-9]{2}:[0-9]{2})|[0-9]{4}) (.+)"</span><span class="keyword">, </span><span class="default">$file</span><span class="keyword">, </span><span class="default">$regs</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$type </span><span class="keyword">= (int) </span><span class="default">strpos</span><span class="keyword">(</span><span class="string">"-dl"</span><span class="keyword">, </span><span class="default">$regs</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]{</span><span class="default">0</span><span class="keyword">});<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$tmp_array</span><span class="keyword">[</span><span class="string">'line'</span><span class="keyword">] = </span><span class="default">$regs</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$tmp_array</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] = </span><span class="default">$type</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$tmp_array</span><span class="keyword">[</span><span class="string">'rights'</span><span class="keyword">] = </span><span class="default">$regs</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$tmp_array</span><span class="keyword">[</span><span class="string">'number'</span><span class="keyword">] = </span><span class="default">$regs</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$tmp_array</span><span class="keyword">[</span><span class="string">'user'</span><span class="keyword">] = </span><span class="default">$regs</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$tmp_array</span><span class="keyword">[</span><span class="string">'group'</span><span class="keyword">] = </span><span class="default">$regs</span><span class="keyword">[</span><span class="default">4</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$tmp_array</span><span class="keyword">[</span><span class="string">'size'</span><span class="keyword">] = </span><span class="default">$regs</span><span class="keyword">[</span><span class="default">5</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$tmp_array</span><span class="keyword">[</span><span class="string">'date'</span><span class="keyword">] = </span><span class="default">date</span><span class="keyword">(</span><span class="string">"m-d"</span><span class="keyword">,</span><span class="default">strtotime</span><span class="keyword">(</span><span class="default">$regs</span><span class="keyword">[</span><span class="default">6</span><span class="keyword">]));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$tmp_array</span><span class="keyword">[</span><span class="string">'time'</span><span class="keyword">] = </span><span class="default">$regs</span><span class="keyword">[</span><span class="default">7</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$tmp_array</span><span class="keyword">[</span><span class="string">'name'</span><span class="keyword">] = </span><span class="default">$regs</span><span class="keyword">[</span><span class="default">9</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$dir_list</span><span class="keyword">[] = </span><span class="default">$tmp_array</span><span class="keyword">;<br />
&nbsp;&nbsp; }<br />
&nbsp;&nbsp; return </span><span class="default">$dir_list</span><span class="keyword">;<br />
}<br />
</span><span class="default">$buff </span><span class="keyword">= </span><span class="default">ftp_rawlist</span><span class="keyword">(</span><span class="default">$cid</span><span class="keyword">, </span><span class="string">"/"</span><span class="keyword">);<br />
</span><span class="default">$items </span><span class="keyword">= </span><span class="default">itemize_dir</span><span class="keyword">(</span><span class="default">$buff</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="46784""></a>
  <div class="note">
   
   <a href="#46784" class="date">22-Oct-2004 07:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that there is no standard for the format, therefore don't be suprised when parsing routines for this work perfectly on some servers, and fail horribly on some.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="46127""></a>
  <div class="note">
   <strong class="user">ergye at yahoo dot com</strong>
   <a href="#46127" class="date">29-Sep-2004 09:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The previous regular expression is super, but does not take simlinks into account. Change [-d] to [-dl] and instead of indicating directories we should indicate the type of the items:<br />
<br />
0 = file<br />
1 = directory<br />
2 = simlink<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">itemize_dir</span><span class="keyword">(</span><span class="default">$contents</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$contents </span><span class="keyword">as </span><span class="default">$file</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">ereg</span><span class="keyword">(</span><span class="string">"([-dl][rwxst-]+).* ([0-9]) ([a-zA-Z0-9]+).* ([a-zA-Z0-9]+).* ([0-9]*) ([a-zA-Z]+[0-9: ]*[0-9]) ([0-9]{2}:[0-9]{2}) (.+)"</span><span class="keyword">, </span><span class="default">$file</span><span class="keyword">, </span><span class="default">$regs</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$type </span><span class="keyword">= (int) </span><span class="default">strpos</span><span class="keyword">(</span><span class="string">"-dl"</span><span class="keyword">, </span><span class="default">$regs</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]{</span><span class="default">0</span><span class="keyword">});<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tmp_array</span><span class="keyword">[</span><span class="string">'line'</span><span class="keyword">] = </span><span class="default">$regs</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tmp_array</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] = </span><span class="default">$type</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tmp_array</span><span class="keyword">[</span><span class="string">'rights'</span><span class="keyword">] = </span><span class="default">$regs</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tmp_array</span><span class="keyword">[</span><span class="string">'number'</span><span class="keyword">] = </span><span class="default">$regs</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tmp_array</span><span class="keyword">[</span><span class="string">'user'</span><span class="keyword">] = </span><span class="default">$regs</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tmp_array</span><span class="keyword">[</span><span class="string">'group'</span><span class="keyword">] = </span><span class="default">$regs</span><span class="keyword">[</span><span class="default">4</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tmp_array</span><span class="keyword">[</span><span class="string">'size'</span><span class="keyword">] = </span><span class="default">$regs</span><span class="keyword">[</span><span class="default">5</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tmp_array</span><span class="keyword">[</span><span class="string">'date'</span><span class="keyword">] = </span><span class="default">date</span><span class="keyword">(</span><span class="string">"m-d"</span><span class="keyword">,</span><span class="default">strtotime</span><span class="keyword">(</span><span class="default">$regs</span><span class="keyword">[</span><span class="default">6</span><span class="keyword">]));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tmp_array</span><span class="keyword">[</span><span class="string">'time'</span><span class="keyword">] = </span><span class="default">$regs</span><span class="keyword">[</span><span class="default">7</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tmp_array</span><span class="keyword">[</span><span class="string">'name'</span><span class="keyword">] = </span><span class="default">$regs</span><span class="keyword">[</span><span class="default">8</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dir_list</span><span class="keyword">[] = </span><span class="default">$tmp_array</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$dir_list</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">$buff </span><span class="keyword">= </span><span class="default">ftp_rawlist</span><span class="keyword">(</span><span class="default">$cid</span><span class="keyword">, </span><span class="string">"/"</span><span class="keyword">);<br />
</span><span class="default">$items </span><span class="keyword">= </span><span class="default">itemize_dir</span><span class="keyword">(</span><span class="default">$buff</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="45359""></a>
  <div class="note">
   <strong class="user">guru at virusas dot lt</strong>
   <a href="#45359" class="date">03-Sep-2004 03:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Lets say only one of these scripts can accept filenames with spaces, but that script doesn't return all info that we may need, so i have modified a little bit one of my script and added some more regexp from here:<br />
<br />
&lt;?<br />
<br />
$buff = ftp_rawlist($cid,"/");<br />
foreach ($buff as $file)<br />
{<br />
&nbsp;&nbsp; &nbsp;&nbsp; if(ereg("([-d][rwxst-]+).* ([0-9]) ([a-zA-Z0-9]+).* ([a-zA-Z0-9]+).* ([0-9]*) ([a-zA-Z]+[0-9: ]*[0-9]) ([0-9]{2}:[0-9]{2}) (.+)",$file,$regs))<br />
&nbsp;&nbsp;&nbsp; {&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(substr($regs[1],0,1)=="d") $isdir=1; else $isdir=0;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $tmp_array['line']=$regs[0];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $tmp_array['isdir']=$isdir;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $tmp_array['rights']=$regs[1];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $tmp_array['number']=$regs[2];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $tmp_array['user']=$regs[3];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $tmp_array['group']=$regs[4];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $tmp_array['size']=$regs[5];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $tmp_array['date']=date("m-d",strtotime($regs[6]));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $tmp_array['time']=$regs[7];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $tmp_array['name']=$regs[8];<br />
&nbsp;&nbsp; &nbsp; }<br />
&nbsp;&nbsp;&nbsp; $dir_list[]=$tmp_array;<br />
}<br />
<br />
?&gt;<br />
<br />
The result is smth like that:<br />
<br />
&nbsp; 8 =&gt; <br />
&nbsp;&nbsp;&nbsp; array<br />
&nbsp;&nbsp; &nbsp;&nbsp; 'line' =&gt; '-rw-r--r--&nbsp;&nbsp; 1 guru&nbsp; &nbsp;&nbsp; users&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 4 Sep&nbsp; 3 09:41 testas testas testas.txt'<br />
&nbsp;&nbsp; &nbsp;&nbsp; 'isdir' =&gt; 0<br />
&nbsp;&nbsp; &nbsp;&nbsp; 'rights' =&gt; '-rw-r--r--'<br />
&nbsp;&nbsp; &nbsp;&nbsp; 'number' =&gt; '1'<br />
&nbsp;&nbsp; &nbsp;&nbsp; 'user' =&gt; 'guru'<br />
&nbsp;&nbsp; &nbsp;&nbsp; 'group' =&gt; 'users'<br />
&nbsp;&nbsp; &nbsp;&nbsp; 'size' =&gt; '4'<br />
&nbsp;&nbsp; &nbsp;&nbsp; 'date' =&gt; '09-03'<br />
&nbsp;&nbsp; &nbsp;&nbsp; 'time' =&gt; '09:41'<br />
&nbsp;&nbsp; &nbsp;&nbsp; 'name' =&gt; 'testas testas testas.txt'<br />
&nbsp; 9 =&gt; <br />
&nbsp;&nbsp;&nbsp; array<br />
&nbsp;&nbsp; &nbsp;&nbsp; 'line' =&gt; 'drwxr-xr-x&nbsp;&nbsp; 3 guru&nbsp; &nbsp;&nbsp; users&nbsp; &nbsp; &nbsp; &nbsp; 4096 Aug 20 08:54 upload'<br />
&nbsp;&nbsp; &nbsp;&nbsp; 'isdir' =&gt; 1<br />
&nbsp;&nbsp; &nbsp;&nbsp; 'rights' =&gt; 'drwxr-xr-x'<br />
&nbsp;&nbsp; &nbsp;&nbsp; 'number' =&gt; '3'<br />
&nbsp;&nbsp; &nbsp;&nbsp; 'user' =&gt; 'guru'<br />
&nbsp;&nbsp; &nbsp;&nbsp; 'group' =&gt; 'users'<br />
&nbsp;&nbsp; &nbsp;&nbsp; 'size' =&gt; '4096'<br />
&nbsp;&nbsp; &nbsp;&nbsp; 'date' =&gt; '08-20'<br />
&nbsp;&nbsp; &nbsp;&nbsp; 'time' =&gt; '08:54'<br />
&nbsp;&nbsp; &nbsp;&nbsp; 'name' =&gt; 'upload'<br />
<br />
Home this will help someone</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="45309""></a>
  <div class="note">
   <strong class="user">eros at speedy dot com dot ar</strong>
   <a href="#45309" class="date">01-Sep-2004 02:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
NO, NO, NO.<br />
<br />
The above examples are all wrong, the spaces given in array are not there "just because", its just a tabbed structure. In php we don't have structures like in c/cpp, but the following function will do the job.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">parse_rawlist</span><span class="keyword">( </span><span class="default">$array </span><span class="keyword">) {<br />
<br />
&nbsp;&nbsp;&nbsp; for ( </span><span class="default">$i </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">count</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">); </span><span class="default">$i</span><span class="keyword">++ ) {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$current </span><span class="keyword">= </span><span class="default">$array</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$structure</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][</span><span class="string">'perms'</span><span class="keyword">]&nbsp; = </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$current</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">10</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$structure</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][</span><span class="string">'number'</span><span class="keyword">] = </span><span class="default">trim</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$current</span><span class="keyword">, </span><span class="default">11</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$structure</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][</span><span class="string">'owner'</span><span class="keyword">]&nbsp; = </span><span class="default">trim</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$current</span><span class="keyword">, </span><span class="default">15</span><span class="keyword">, </span><span class="default">8</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$structure</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][</span><span class="string">'group'</span><span class="keyword">]&nbsp; = </span><span class="default">trim</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$current</span><span class="keyword">, </span><span class="default">24</span><span class="keyword">, </span><span class="default">8</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$structure</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][</span><span class="string">'size'</span><span class="keyword">]&nbsp;&nbsp; = </span><span class="default">trim</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$current</span><span class="keyword">, </span><span class="default">33</span><span class="keyword">, </span><span class="default">8</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$structure</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][</span><span class="string">'month'</span><span class="keyword">]&nbsp; = </span><span class="default">trim</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$current</span><span class="keyword">, </span><span class="default">42</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$structure</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][</span><span class="string">'day'</span><span class="keyword">]&nbsp; &nbsp; = </span><span class="default">trim</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$current</span><span class="keyword">, </span><span class="default">46</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$structure</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][</span><span class="string">'time'</span><span class="keyword">]&nbsp;&nbsp; = </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$current</span><span class="keyword">, </span><span class="default">49</span><span class="keyword">, </span><span class="default">5</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$structure</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][</span><span class="string">'name'</span><span class="keyword">]&nbsp;&nbsp; = </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$current</span><span class="keyword">, </span><span class="default">55</span><span class="keyword">, </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$current</span><span class="keyword">) - </span><span class="default">55</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$structure</span><span class="keyword">;<br />
<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="44079""></a>
  <div class="note">
   <strong class="user">soon7 at wanadoo dot fr</strong>
   <a href="#44079" class="date">14-Jul-2004 02:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hi all !<br />
ther is a litlle mistake in the naivesong 's message .<br />
Indeed , you stop to parse too early ...<br />
I tried and fix it like this :<br />
&lt;?<br />
// getting the list<br />
&nbsp; $list = ftp_rawlist ($ftp_stream, $ftp_directory);<br />
&nbsp;&nbsp; $folders = array();<br />
&nbsp;&nbsp; $files = array();<br />
&nbsp;&nbsp; $links = array();<br />
&nbsp;&nbsp; for ($i=0; $i&lt;count($list); $i++)<br />
&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; //----convert tabs to blanks<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; //----delete multiple blanks<br />
// Here begin my modifications<br />
list ($permissions, $list[$i]) = parsenext ($list[$i]);<br />
&nbsp;&nbsp; &nbsp; list ($number, $list[$i]) = parsenext ($list[$i]);<br />
&nbsp;&nbsp; &nbsp; list ($owner, $list[$i]) = parsenext ($list[$i]);<br />
&nbsp;&nbsp; &nbsp; list ($group, $list[$i]) = parsenext ($list[$i]);<br />
&nbsp;&nbsp; &nbsp; list ($size, $list[$i]) = parsenext ($list[$i]);<br />
&nbsp;&nbsp; &nbsp; list ($timeMonth,$list[$i]) = parsenext ($list[$i]);<br />
&nbsp;&nbsp; &nbsp; list ($timeDay,$list[$i]) = parsenext ($list[$i]);<br />
&nbsp;&nbsp; &nbsp; list ($timeTime,$list[$i]) = parsenext ($list[$i]);<br />
&nbsp;&nbsp; &nbsp; $filename=$list[$i];<br />
// by taking $filename in last position , it works even if there is some space in its name<br />
//then we put it in the m array with the new things<br />
//----ok, put all this into the related array<br />
if ($filename != "." &amp;&amp; $filename != "..")<br />
&nbsp;&nbsp; &nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; $m = array();<br />
&nbsp;&nbsp; &nbsp; &nbsp; $m["name"] = $filename;<br />
&nbsp;&nbsp; &nbsp; &nbsp; $m["link"] = $filelink;<br />
&nbsp;&nbsp; &nbsp; &nbsp; $m["size"] = afficherPoidsFichier($size);<br />
&nbsp;&nbsp; &nbsp; &nbsp; $m["month"] = $timeMonth;<br />
&nbsp;&nbsp; &nbsp; &nbsp; $m["day"] = $timeDay;<br />
&nbsp;&nbsp; &nbsp; &nbsp; $m["time"] = $timeTime;<br />
&nbsp;&nbsp; &nbsp; &nbsp; $m["owner"] = $owner;<br />
&nbsp;&nbsp; &nbsp; &nbsp; $m["group"] = $group;<br />
&nbsp;&nbsp; &nbsp; &nbsp; $m["permissions"] = $permissions;<br />
&nbsp;&nbsp; &nbsp; &nbsp; if (substr($permissions, 0, 1) == "d")<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; $folders[count($folders)] = $m;<br />
&nbsp;&nbsp; &nbsp; &nbsp; else if (substr($permissions, 0, 1) == "l")<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; $links[count($files)] = $m;<br />
&nbsp;&nbsp; &nbsp; &nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; $files[count($files)] = $m;<br />
&nbsp;&nbsp; &nbsp; }<br />
&nbsp;&nbsp; }<br />
// you can sort $folders , $files , $links after if u want<br />
// afficherPoidsFichier($size) is a little function i found in this site at filesize() , works good !<br />
// Just give the good size<br />
function afficherPoidsFichier($size) {<br />
&nbsp; $sizes = Array('o', 'Ko', 'Mo', 'Go');<br />
&nbsp; $ext = $sizes[0];<br />
&nbsp; for ($i=1; (($i &lt; count($sizes)) &amp;&amp; ($size &gt;= 1024)); $i++) {<br />
&nbsp;&nbsp; $size = $size / 1024;<br />
&nbsp;&nbsp; $ext&nbsp; = $sizes[$i];<br />
&nbsp; }<br />
&nbsp; return round($size, 2).' '.$ext;<br />
}<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="40984""></a>
  <div class="note">
   <strong class="user">naivesong at matiasmoreno dot com dot ar</strong>
   <a href="#40984" class="date">25-Mar-2004 08:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I'm afraid I forgot the "parsenext" function in my previous note. Here it is:<br />
<br />
<span class="default">&lt;?php<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">parsenext </span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$k </span><span class="keyword">= </span><span class="default">strpos </span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">, </span><span class="string">" "</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$m </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$m</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] = </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$k</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$m</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] = </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">, </span><span class="default">$k</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; return </span><span class="default">$m</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="40976""></a>
  <div class="note">
   <strong class="user">naivesong at matiasmoreno dot com dot ar</strong>
   <a href="#40976" class="date">24-Mar-2004 10:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This script will properly handle FTP servers where the returned date/time differs from the generic mm-dd-YYYY hh:mm:ss format:<br />
<br />
<span class="default">&lt;?php<br />
<br />
&nbsp;&nbsp;&nbsp; $list </span><span class="keyword">= </span><span class="default">ftp_rawlist </span><span class="keyword">(</span><span class="default">$ftp_stream</span><span class="keyword">, </span><span class="default">$ftp_directory</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$folders </span><span class="keyword">= array();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$files </span><span class="keyword">= array();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$links </span><span class="keyword">= array();<br />
&nbsp;&nbsp;&nbsp; for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">count</span><span class="keyword">(</span><span class="default">$list</span><span class="keyword">); </span><span class="default">$i</span><span class="keyword">++)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="comment">//----convert tabs to blanks<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$list</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] = </span><span class="default">str_replace </span><span class="keyword">(</span><span class="string">"\t"</span><span class="keyword">, </span><span class="string">" "</span><span class="keyword">, </span><span class="default">$list</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="comment">//----delete multiple blanks<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="keyword">while ((</span><span class="default">$k </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$list</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">], </span><span class="string">"&nbsp; "</span><span class="keyword">)) !== </span><span class="default">FALSE</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$list</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] = </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$list</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">],</span><span class="default">0</span><span class="keyword">,</span><span class="default">$k</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">).</span><span class="default">trim</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$list</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">],</span><span class="default">$k</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="comment">//----split link reference from filename where available<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="keyword">if ((</span><span class="default">$k </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$list</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">], </span><span class="string">" -&gt; "</span><span class="keyword">)) !== </span><span class="default">FALSE</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$filelink </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$list</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">], </span><span class="default">$k</span><span class="keyword">+</span><span class="default">4</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$list</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] = </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$list</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">], </span><span class="default">0</span><span class="keyword">, </span><span class="default">$k</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$filelink </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="comment">//----parse filename<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$k </span><span class="keyword">= </span><span class="default">strrpos</span><span class="keyword">(</span><span class="default">$list</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">], </span><span class="string">" "</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$filename </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$list</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">], </span><span class="default">$k</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$list</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] = </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$list</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">], </span><span class="default">0</span><span class="keyword">, </span><span class="default">$k</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="comment">//----parse the rest of info<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="keyword">list (</span><span class="default">$permissions</span><span class="keyword">, </span><span class="default">$list</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]) = </span><span class="default">parsenext </span><span class="keyword">(</span><span class="default">$list</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp;&nbsp; list (</span><span class="default">$number</span><span class="keyword">, </span><span class="default">$list</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]) = </span><span class="default">parsenext </span><span class="keyword">(</span><span class="default">$list</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp;&nbsp; list (</span><span class="default">$owner</span><span class="keyword">, </span><span class="default">$list</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]) = </span><span class="default">parsenext </span><span class="keyword">(</span><span class="default">$list</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp;&nbsp; list (</span><span class="default">$group</span><span class="keyword">, </span><span class="default">$list</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]) = </span><span class="default">parsenext </span><span class="keyword">(</span><span class="default">$list</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp;&nbsp; list (</span><span class="default">$size</span><span class="keyword">, </span><span class="default">$time</span><span class="keyword">) = </span><span class="default">parsenext </span><span class="keyword">(</span><span class="default">$list</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="comment">//----ok, put all this into the related array<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$filename </span><span class="keyword">!= </span><span class="string">"." </span><span class="keyword">&amp;&amp; </span><span class="default">$filename </span><span class="keyword">!= </span><span class="string">".."</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$m </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$m</span><span class="keyword">[</span><span class="string">"name"</span><span class="keyword">] = </span><span class="default">$filename</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$m</span><span class="keyword">[</span><span class="string">"link"</span><span class="keyword">] = </span><span class="default">$filelink</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$m</span><span class="keyword">[</span><span class="string">"size"</span><span class="keyword">] = </span><span class="default">$size</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$m</span><span class="keyword">[</span><span class="string">"time"</span><span class="keyword">] = </span><span class="default">$time</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$m</span><span class="keyword">[</span><span class="string">"owner"</span><span class="keyword">] = </span><span class="default">$owner</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$m</span><span class="keyword">[</span><span class="string">"group"</span><span class="keyword">] = </span><span class="default">$group</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$m</span><span class="keyword">[</span><span class="string">"permissions"</span><span class="keyword">] = </span><span class="default">$permissions</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$permissions</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">) == </span><span class="string">"d"</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$folders</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$folders</span><span class="keyword">)] = </span><span class="default">$m</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else if (</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$permissions</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">) == </span><span class="string">"l"</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$links</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$files</span><span class="keyword">)] = </span><span class="default">$m</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$files</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$files</span><span class="keyword">)] = </span><span class="default">$m</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">sort </span><span class="keyword">(</span><span class="default">$folders</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">sort </span><span class="keyword">(</span><span class="default">$files</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">sort </span><span class="keyword">(</span><span class="default">$links</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
This script works fine on any raw list that complies with the following format:<br />
<br />
permissions number owner group size time name [" -&gt; " link_to]<br />
<br />
where time may have whatever format the FTP server wants. ;-)<br />
<br />
It also returns folders, files and links in separated sorted lists (got this idea from the note of "postmaster at alishomepage dot com" in this help page).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="39478""></a>
  <div class="note">
   <strong class="user">josh at snaphat dot com</strong>
   <a href="#39478" class="date">29-Jan-2004 07:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I fixed jmv AT jmvware DOT com's script:
<br />
<span class="default">&lt;?php
<br />

<br />
$dirline</span><span class="keyword">=</span><span class="default">ereg_replace</span><span class="keyword">(</span><span class="string">" +"</span><span class="keyword">,</span><span class="string">' '</span><span class="keyword">,</span><span class="default">$dirline</span><span class="keyword">);
<br />
</span><span class="default">$isdir</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;
<br />
if (</span><span class="default">ereg</span><span class="keyword">(</span><span class="string">'^d'</span><span class="keyword">,</span><span class="default">$dirline</span><span class="keyword">)) </span><span class="default">$isdir</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">;
<br />
list(</span><span class="default">$permissions</span><span class="keyword">,</span><span class="default">$num</span><span class="keyword">,</span><span class="default">$owner</span><span class="keyword">,</span><span class="default">$group
<br />
</span><span class="keyword">,</span><span class="default">$size</span><span class="keyword">,</span><span class="default">$month</span><span class="keyword">,</span><span class="default">$day</span><span class="keyword">,</span><span class="default">$year_time</span><span class="keyword">,</span><span class="default">$name</span><span class="keyword">)=</span><span class="default">split</span><span class="keyword">(</span><span class="string">' '</span><span class="keyword">,</span><span class="default">$dirline</span><span class="keyword">); 
<br />

<br />
</span><span class="comment">//added the next lines:
<br />
</span><span class="default">$fix</span><span class="keyword">=</span><span class="default">explode</span><span class="keyword">(</span><span class="string">' '</span><span class="keyword">,</span><span class="default">$dirline</span><span class="keyword">);
<br />
</span><span class="default">$fixsize</span><span class="keyword">=</span><span class="default">count</span><span class="keyword">(</span><span class="default">$fix</span><span class="keyword">);
<br />
&nbsp;if(</span><span class="default">$fixsize </span><span class="keyword">&gt; </span><span class="default">8</span><span class="keyword">)
<br />
&nbsp;{
<br />
&nbsp; for(</span><span class="default">$start</span><span class="keyword">=</span><span class="default">9</span><span class="keyword">;</span><span class="default">$start</span><span class="keyword">&lt;</span><span class="default">$fixsize</span><span class="keyword">;</span><span class="default">$start</span><span class="keyword">++)
<br />
&nbsp; {
<br />
&nbsp;&nbsp; </span><span class="default">$name</span><span class="keyword">.=</span><span class="string">" " </span><span class="keyword">. </span><span class="default">$fix</span><span class="keyword">[</span><span class="default">$start</span><span class="keyword">];
<br />
&nbsp; }
<br />
&nbsp;}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="38759""></a>
  <div class="note">
   
   <a href="#38759" class="date">06-Jan-2004 03:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you write<br />
<span class="default">&lt;?php<br />
rawlist </span><span class="keyword">(</span><span class="default">$ftp</span><span class="keyword">, </span><span class="string">"-a"</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span>The command will be "LIST -a", so the retuned list will also contain hidden files like ".htaccess".<br />
<br />
In this case all files and folders of the current directory are contained.<br />
To list another folder, you must change to it with "ftp_chdir".</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="37075""></a>
  <div class="note">
   <strong class="user">moonglobe3739  [  A  t  ]  hotmail .com</strong>
   <a href="#37075" class="date">01-Nov-2003 04:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
hope this helps someone:<br />
<span class="default">&lt;?php<br />
$list </span><span class="keyword">= </span><span class="default">ftp_rawlist</span><span class="keyword">(</span><span class="default">$ftp_stream</span><span class="keyword">,</span><span class="default">$dir</span><span class="keyword">);<br />
</span><span class="default">$dirc </span><span class="keyword">= array();<br />
foreach (</span><span class="default">$list </span><span class="keyword">as </span><span class="default">$file</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; list(</span><span class="default">$perms</span><span class="keyword">,</span><span class="default">$owner</span><span class="keyword">,</span><span class="default">$group</span><span class="keyword">,</span><span class="default">$size</span><span class="keyword">,</span><span class="default">$mtime</span><span class="keyword">,</span><span class="default">$fname</span><span class="keyword">) = <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'#^([bcdlsp-][rwxtTsS-]{9})\s+(?:[0-9]+)\s+'</span><span class="keyword">.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">'([a-zA-Z]+)\s+([a-zA-Z]+)\s+([0-9]+)\s+'</span><span class="keyword">.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">'([A-Z][a-z]+ [0-9]{1,2} [0-9]{4} [0-9]{2}:[0-9]{2}) (.*)$#'</span><span class="keyword">,</span><span class="default">$file</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$dirc</span><span class="keyword">[</span><span class="default">$fname</span><span class="keyword">][</span><span class="string">'permissions'</span><span class="keyword">] = </span><span class="default">$perms</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$dirc</span><span class="keyword">[</span><span class="default">$fname</span><span class="keyword">][</span><span class="string">'owner'</span><span class="keyword">]&nbsp; &nbsp; &nbsp;&nbsp; = </span><span class="default">$owner</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$dirc</span><span class="keyword">[</span><span class="default">$fname</span><span class="keyword">][</span><span class="string">'group'</span><span class="keyword">]&nbsp; &nbsp; &nbsp;&nbsp; = </span><span class="default">$group</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$dirc</span><span class="keyword">[</span><span class="default">$fname</span><span class="keyword">][</span><span class="string">'size'</span><span class="keyword">]&nbsp; &nbsp; &nbsp; &nbsp; = </span><span class="default">$size</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$dirc</span><span class="keyword">[</span><span class="default">$fname</span><span class="keyword">][</span><span class="string">'modtime'</span><span class="keyword">]&nbsp; &nbsp;&nbsp; = </span><span class="default">$mtime</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="36701""></a>
  <div class="note">
   <strong class="user">postmaster at alishomepage dot com</strong>
   <a href="#36701" class="date">19-Oct-2003 05:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here we go for a 100% working code... :D<br />
<br />
&lt;?<br />
<br />
[code]<br />
<br />
function cutspaces($str){<br />
&nbsp;&nbsp;&nbsp; while(substr($str,0,1)==" "){$str=substr($str,1);}<br />
&nbsp;&nbsp;&nbsp; return $str;}<br />
<br />
[code]<br />
<br />
$folders=array();<br />
$files=array();<br />
for($i=0;$i&lt;sizeof($list);$i++){<br />
&nbsp;&nbsp;&nbsp; list($permissions,$next)=split(" ",$list[$i],2);<br />
&nbsp;&nbsp;&nbsp; list($num,$next)=split(" ",cutspaces($next),2);<br />
&nbsp;&nbsp;&nbsp; list($owner,$next)=split(" ",cutspaces($next),2);<br />
&nbsp;&nbsp;&nbsp; list($group,$next)=split(" ",cutspaces($next),2);<br />
&nbsp;&nbsp;&nbsp; list($size,$next)=split(" ",cutspaces($next),2);<br />
&nbsp;&nbsp;&nbsp; list($month,$next)=split(" ",cutspaces($next),2);<br />
&nbsp;&nbsp;&nbsp; list($day,$next)=split(" ",cutspaces($next),2);<br />
&nbsp;&nbsp;&nbsp; list($year_time,$filename)=split(" ",cutspaces($next),2);<br />
&nbsp;&nbsp;&nbsp; if($filename!="." &amp;&amp; $filename!=".."){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(substr($permissions,0,1)=="d"){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $folders[]=$filename;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $files[]=$filename;}}}<br />
sort($folders);<br />
sort($files);<br />
<br />
[code]<br />
<br />
?&gt;<br />
<br />
so this will simply "get" all the information WITHOUT being in any case interfered with some spaces, ... etc etc... It will even put files in a $files array and folders in a $folders array, and sort them, so you will be able of using all this later<br />
<br />
and: the "folders" will NOT contain "." and ".." ;)<br />
<br />
so you can use all this to make a beautiful FTP interface... later on you could for example put permissions and etc etc in other arrays to use them in your result... cute....</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="36700""></a>
  <div class="note">
   <strong class="user">postmaster at alishomepage dot com</strong>
   <a href="#36700" class="date">19-Oct-2003 05:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Another "formula" for decoding the rawlist: the ide is that normaly a "ls" contains info like below:<br />
<br />
&lt;file rights&gt; &lt;number&gt; &lt;owner&gt; &lt;group&gt; &lt;date&gt; &lt;time&gt; &lt;filename&gt;<br />
<br />
and: the "time" contains a ":" (which is NOT contained in any of the other infos -if we reversely read the array)<br />
<br />
and, in the case the "time" would not exist, i have done a "protection script" that would try to find out using the year... Yet that may NOT always work since a user name or group name MAY contain an item like "1999" etc... (and i did not check the date format reversely -on the filename first- since a probability of presence is higher of a date is MUCH higher in a filename)<br />
<br />
So here we go:<br />
<br />
&lt;?<br />
<br />
[... code ...]<br />
<br />
$fnTest=array("198","199","200","201","202");<br />
<br />
[... code ...]<br />
<br />
$j=0;<br />
$strrpos=strrpos($list[$i],":");<br />
while($strrpos==0){<br />
&nbsp;&nbsp;&nbsp; $strrpos=strpos($list[$i],$fnTest[$j]);<br />
&nbsp;&nbsp;&nbsp; $j++;}<br />
if($j){<br />
&nbsp;&nbsp;&nbsp; $strrpos+=2+strlen($fnTest[$j]);<br />
}else{<br />
&nbsp;&nbsp;&nbsp; $strrpos+=4;}<br />
$elmt=substr($list[$i],$strrpos);<br />
<br />
[... code ...]<br />
<br />
?&gt;<br />
<br />
and $elmt would *normally* contain the info we want... but i'm still working on it!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
