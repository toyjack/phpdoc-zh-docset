<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>执行一个正则表达式的搜索和替换</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.preg-replace-callback.html">? preg_replace_callback</a></li>
      <li style="float: right;"><a href="function.preg-split.html">preg_split ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.pcre.html">PCRE 函数</a></li>
    <li>执行一个正则表达式的搜索和替换</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.preg-replace" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">preg_replace</h1>
  <p class="verinfo">(PHP 4, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">preg_replace</span> &mdash; <span class="dc-title">执行一个正则表达式的搜索和替换</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-function.preg-replace-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>preg_replace</strong></span>
    ( <span class="methodparam"><span class="type"><a href="language.types.declarations.html#language.types.declarations.mixed" class="type mixed">mixed</a></span> <code class="parameter">$pattern</code></span>
   , <span class="methodparam"><span class="type"><a href="language.types.declarations.html#language.types.declarations.mixed" class="type mixed">mixed</a></span> <code class="parameter">$replacement</code></span>
   , <span class="methodparam"><span class="type"><a href="language.types.declarations.html#language.types.declarations.mixed" class="type mixed">mixed</a></span> <code class="parameter">$subject</code></span>
   , <span class="methodparam"><span class="type">int</span> <code class="parameter">$limit</code><span class="initializer"> = -1</span></span>
   , <span class="methodparam"><span class="type">int</span> <code class="parameter reference">&$count</code> = ?</span>
   ) : <span class="type"><a href="language.types.declarations.html#language.types.declarations.mixed" class="type mixed">mixed</a></span></div>

  <p class="para rdfs-comment">
    搜索 <code class="parameter">subject</code> 中匹配 <code class="parameter">pattern</code> 的部分，以
    <code class="parameter">replacement</code> 进行替换。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.preg-replace-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">pattern</code></dt>

     <dd>

      <p class="para">
      要搜索的模式。可以使一个字符串或字符串数组。
      </p>
      <p class="para">
       可以使用一些 <a href="reference.pcre.pattern.modifiers.html" class="link">PCRE 修饰符</a>。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">replacement</code></dt>

     <dd>

      <p class="para">
        用于替换的字符串或字符串数组。如果这个参数是一个字符串，并且 <code class="parameter">pattern</code>
        是一个数组，那么所有的模式都使用这个字符串进行替换。如果 <code class="parameter">pattern</code> 和 <code class="parameter">replacement</code>
        都是数组，每个 <code class="parameter">pattern</code> 使用 <code class="parameter">replacement</code> 中对应的元素进行替换。如果
        <code class="parameter">replacement</code> 中的元素比 <code class="parameter">pattern</code> 中的少，多出来的
        <code class="parameter">pattern</code> 使用空字符串进行替换。
      </p>
      <p class="para">
        <code class="parameter">replacement</code> 中可以包含后向引用 <code class="literal">\\<span class="replaceable">n</span></code>
        或 <code class="literal">$<span class="replaceable">n</span></code>，语法上首选后者。 每个这样的引用将被匹配到的第
        <span class="replaceable">n</span> 个捕获子组捕获到的文本替换。 <span class="replaceable">n</span> 可以是0-99，<code class="literal">\\0</code> 和 <code class="literal">$0</code>
        代表完整的模式匹配文本。捕获子组的序号计数方式为：代表捕获子组的左括号从左到右， 从1开始数。如果要在
        <code class="parameter">replacement</code> 中使用反斜线，必须使用 4 个(<code class="literal">&quot;\\\\&quot;</code>，译注：因为这首先是 PHP
        的字符串，经过转义后，是两个，再经过正则表达式引擎后才被认为是一个原文反斜线)。
      </p>
      <p class="para">
        当在替换模式下工作并且后向引用后面紧跟着需要是另外一个数字 (比如：在一个匹配模式后紧接着增加一个原文数字)，不能使用
        <code class="literal">\\1</code> 这样的语法来描述后向引用。比如，<code class="literal">\\11</code>将会使<span class="function"><strong>preg_replace()</strong></span>
        不能理解你希望的是一个 <code class="literal">\\1</code> 后向引用紧跟一个原文 <code class="literal">1</code>，还是一个
        <code class="literal">\\11</code> 后向引用后面不跟任何东西。 这种情况下解决方案是使用 <code class="literal">${1}1</code>。这创建了一个独立的
        <code class="literal">$1</code> 后向引用, 一个独立的原文 <code class="literal">1</code>。
      </p>
      <p class="para">
        当使用被弃用的 <code class="literal">e</code> 修饰符时, 这个函数会转义一些字符 (即：<code class="literal">&#039;</code>、<code class="literal">&quot;</code>、
        <code class="literal">\</code> 和 NULL) 然后进行后向引用替换。当这些完成后请确保后向引用解析完后没有单引号或双引号引起的语法错误 (比如：
        <code class="literal">&#039;strlen(\&#039;$1\&#039;)+strlen(&quot;$2&quot;)&#039;</code>)。确保符合 PHP 的
        <a href="language.types.string.html" class="link">字符串语法</a>，并且符合 eval 语法。因为在完成替换后，引擎会将结果字符串作为 PHP 代码使用
        eval 方式进行评估并将返回值作为最终参与替换的字符串。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">subject</code></dt>

     <dd>

      <p class="para">
        要进行搜索和替换的字符串或字符串数组。
      </p>
      <p class="para">
        如果 <code class="parameter">subject</code> 是一个数组，搜索和替换回在
        <code class="parameter">subject</code> 的每一个元素上进行, 并且返回值也会是一个数组。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">limit</code></dt>

     <dd>

      <p class="para">
        每个模式在每个 <code class="parameter">subject</code> 上进行替换的最大次数。默认是
        <code class="literal">-1</code>(无限)。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">count</code></dt>

     <dd>

      <p class="para">
        如果指定，将会被填充为完成的替换次数。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.preg-replace-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
    如果 <code class="parameter">subject</code> 是一个数组，<span class="function"><strong>preg_replace()</strong></span>
    返回一个数组，其他情况下返回一个字符串。
  </p>
  <p class="para">
  如果匹配被查找到，替换后的 <code class="parameter">subject</code> 被返回，其他情况下返回没有改变的
  <code class="parameter">subject</code>。如果发生错误，返回 <strong><code>null</code></strong> 。
  </p>
 </div>


  <div class="refsect1 errors" id="refsect1-function.preg-replace-errors">
  <h3 class="title">错误／异常</h3>
  <p class="para">
   PHP 5.5.0 起， 传入 &quot;\e&quot; 修饰符的时候，会产生一个
   <strong><code>E_DEPRECATED</code></strong> 错误； PHP 7.0.0 起，会产生
   <strong><code>E_WARNING</code></strong> 错误，同时  &quot;\e&quot; 也无法起效。
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.preg-replace-examples">
  <h3 class="title">范例</h3>
  <p class="para">
   <div class="example" id="example-5096">
    <p><strong>Example #1 使用后向引用紧跟数值原文</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$string&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'April&nbsp;15,&nbsp;2003'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$pattern&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'/(\w+)&nbsp;(\d+),&nbsp;(\d+)/i'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$replacement&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'${1}1,$3'</span><span style="color: #007700">;<br />echo&nbsp;</span><span style="color: #0000BB">preg_replace</span><span style="color: #007700">(</span><span style="color: #0000BB">$pattern</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$replacement</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$string</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>以上例程会输出：</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
April1,2003
</pre></div>
    </div>
   </div>
  </p>
  <p class="para">
   <div class="example" id="example-5097">
    <p><strong>Example #2 <span class="function"><strong>preg_replace()</strong></span> 中使用基于索引的数组</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$string&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'The&nbsp;quick&nbsp;brown&nbsp;fox&nbsp;jumps&nbsp;over&nbsp;the&nbsp;lazy&nbsp;dog.'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$patterns&nbsp;</span><span style="color: #007700">=&nbsp;array();<br /></span><span style="color: #0000BB">$patterns</span><span style="color: #007700">[</span><span style="color: #0000BB">0</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #DD0000">'/quick/'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$patterns</span><span style="color: #007700">[</span><span style="color: #0000BB">1</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #DD0000">'/brown/'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$patterns</span><span style="color: #007700">[</span><span style="color: #0000BB">2</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #DD0000">'/fox/'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$replacements&nbsp;</span><span style="color: #007700">=&nbsp;array();<br /></span><span style="color: #0000BB">$replacements</span><span style="color: #007700">[</span><span style="color: #0000BB">2</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #DD0000">'bear'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$replacements</span><span style="color: #007700">[</span><span style="color: #0000BB">1</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #DD0000">'black'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$replacements</span><span style="color: #007700">[</span><span style="color: #0000BB">0</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #DD0000">'slow'</span><span style="color: #007700">;<br />echo&nbsp;</span><span style="color: #0000BB">preg_replace</span><span style="color: #007700">(</span><span style="color: #0000BB">$patterns</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$replacements</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$string</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>以上例程会输出：</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
The bear black slow jumps over the lazy dog.
</pre></div>
    </div>
    <div class="example-contents"><p>
    对模式和替换内容按 key 进行排序我们可以得到期望的结果。
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />ksort</span><span style="color: #007700">(</span><span style="color: #0000BB">$patterns</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">ksort</span><span style="color: #007700">(</span><span style="color: #0000BB">$replacements</span><span style="color: #007700">);<br />echo&nbsp;</span><span style="color: #0000BB">preg_replace</span><span style="color: #007700">(</span><span style="color: #0000BB">$patterns</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$replacements</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$string</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>以上例程会输出：</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
The slow black bear jumps over the lazy dog.
</pre></div>
    </div>
   </div>
  </p>
  <p class="para">
   <div class="example" id="example-5098">
    <p><strong>Example #3 替换一些值</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$patterns&nbsp;</span><span style="color: #007700">=&nbsp;array&nbsp;(</span><span style="color: #DD0000">'/(19|20)(\d{2})-(\d{1,2})-(\d{1,2})/'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'/^\s*{(\w+)}\s*=/'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$replace&nbsp;</span><span style="color: #007700">=&nbsp;array&nbsp;(</span><span style="color: #DD0000">'\3/\4/\1\2'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'$\1&nbsp;='</span><span style="color: #007700">);<br />echo&nbsp;</span><span style="color: #0000BB">preg_replace</span><span style="color: #007700">(</span><span style="color: #0000BB">$patterns</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$replace</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'{startDate}&nbsp;=&nbsp;1999-5-27'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>以上例程会输出：</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
$startDate = 5/27/1999
</pre></div>
    </div>
   </div>
  </p>
  <p class="para">
   <div class="example" id="example-5099">
    <p><strong>Example #4 剥离空白字符</strong></p>
    <div class="example-contents"><p>
     这个例子剥离多余的空白字符
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$str&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'foo&nbsp;&nbsp;&nbsp;o'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$str&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">preg_replace</span><span style="color: #007700">(</span><span style="color: #DD0000">'/\s\s+/'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'&nbsp;'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$str</span><span style="color: #007700">);<br /></span><span style="color: #FF8000">//&nbsp;将会改变为'foo&nbsp;o'<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">$str</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
  <p class="para">
   <div class="example" id="example-5100">
    <p><strong>Example #5 使用参数 <code class="parameter">count</code></strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$count&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">;<br /><br />echo&nbsp;</span><span style="color: #0000BB">preg_replace</span><span style="color: #007700">(array(</span><span style="color: #DD0000">'/\d/'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'/\s/'</span><span style="color: #007700">),&nbsp;</span><span style="color: #DD0000">'*'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'xp&nbsp;4&nbsp;to'</span><span style="color: #007700">,&nbsp;-</span><span style="color: #0000BB">1&nbsp;</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$count</span><span style="color: #007700">);<br />echo&nbsp;</span><span style="color: #0000BB">$count</span><span style="color: #007700">;&nbsp;</span><span style="color: #FF8000">//3<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>以上例程会输出：</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
xp***to
3
</pre></div>     
    </div>
   </div>
  </p>
 </div>


 <div class="refsect1 notes" id="refsect1-function.preg-replace-notes">
  <h3 class="title">注释</h3>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
   当使用数组形式的<code class="parameter">pattern</code>和<code class="parameter">replacement</code>时, 
   将会按照key在数组中出现的顺序进行处理. 这<em class="emphasis">不一定</em>和数组的索引顺序一致.
   如果你期望使用索引对等方式用<code class="parameter">replacement</code>对<code class="parameter">pattern</code>
   进行替换, 你可以在调用<span class="function"><strong>preg_replace()</strong></span>之前对两个数组各进行一次<span class="function"><a href="function.ksort.html" class="function">ksort()</a></span>排序.
   </p>
  </p></blockquote>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.preg-replace-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><a href="pcre.pattern.html" class="link">PCRE 模式</a></li>
    <li class="member"><span class="function"><a href="function.preg-quote.html" class="function" rel="rdfs-seeAlso">preg_quote()</a> - 转义正则表达式字符</span></li>
    <li class="member"><span class="function"><a href="function.preg-filter.html" class="function" rel="rdfs-seeAlso">preg_filter()</a> - 执行一个正则表达式搜索和替换</span></li>
    <li class="member"><span class="function"><a href="function.preg-match.html" class="function" rel="rdfs-seeAlso">preg_match()</a> - 执行匹配正则表达式</span></li>
    <li class="member"><span class="function"><a href="function.preg-replace-callback.html" class="function" rel="rdfs-seeAlso">preg_replace_callback()</a> - 执行一个正则表达式搜索并且使用一个回调进行替换</span></li>
    <li class="member"><span class="function"><a href="function.preg-split.html" class="function" rel="rdfs-seeAlso">preg_split()</a> - 通过一个正则表达式分隔字符串</span></li>
    <li class="member"><span class="function"><a href="function.preg-last-error.html" class="function" rel="rdfs-seeAlso">preg_last_error()</a> - 返回最后一个PCRE正则执行产生的错误代码</span></li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="125026""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#125026" class="date">19-May-2020 06:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that the replacement string using the ${n} notation for a group identifier (rather than the $n notation) must be in a SINGLE quoted string: <br />
<br />
&nbsp;$replacement = '${1}1,$3'; // Correct - Single Quoted<br />
&nbsp;$replacement = "${1}1,$3"; // Incorrect - Double Quoted<br />
&nbsp;$replacement = "$1 one , $3"; // Correct - Double Quoted but with $n notation.<br />
<br />
This might sneak up on you, because it is not an error to use "${1}".&nbsp; The double quotes allow a string that contains variable interpolation, and the braces make the variable a PHP "Variable-Variable". In the above example the undefined ${1} will evaluate to NULL rather than the replaced string. Valid PHP, but not what you wanted.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="124934""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#124934" class="date">22-Apr-2020 02:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Warning: craiga's function escape_backreference() is incomplete (doesn't escape '\0' nor '${0}').<br />
<br />
To escape any potential backreferences in a replacement variable, use addcslashes() for backslash and dollar characters:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// $replacement may contain sequences like \0, $0 or ${0}<br />
</span><span class="keyword">echo </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="default">$pattern</span><span class="keyword">, </span><span class="default">addcslashes</span><span class="keyword">(</span><span class="default">$replacement</span><span class="keyword">, </span><span class="string">'\\$'</span><span class="keyword">), </span><span class="default">$subject</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="124771""></a>
  <div class="note">
   <strong class="user">Ducktales</strong>
   <a href="#124771" class="date">27-Feb-2020 05:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To replace double whitespace by a single space character in a sentence you need to use the \h modifier. It stands for horizontal whitespace. The more common \s modifier includes vertical whitespace such as line breaks, which is not good for saving paragraphs.<br />
<br />
Additionally, since most of todays code works with unicode strings you need to add the /u unicode modifier. I tried to replace four sequential normal spaces by one hyphen character resulting in '- - ' instead of '-'. I don't know why it works this way.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// Replace one or more horizontal white spaces<br />
// of any kind by one normal space character<br />
</span><span class="default">$str </span><span class="keyword">= </span><span class="default">preg_replace </span><span class="keyword">(</span><span class="string">'/\h+/u'</span><span class="keyword">, </span><span class="string">' '</span><span class="keyword">, </span><span class="default">$str</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="124391""></a>
  <div class="note">
   <strong class="user">mail at johanvandemerwe dot nl</strong>
   <a href="#124391" class="date">13-Nov-2019 12:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Sample for replacing bracketed short-codes<br />
<br />
The used short-codes are purely used for educational purposes for they could be shorter as in 'italic' to 'i' or 'bold' to 'b'.<br />
<br />
Sample text<br />
----<br />
This sample shows how to have [italic]italic[/italic], [bold]bold[/bold] and [underline]underlined[/underline] and [strikethrough]striked[/striketrhough] text. <br />
<br />
with this function:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">textDecoration</span><span class="keyword">(</span><span class="default">$html</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$patterns </span><span class="keyword">= [<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'/\[(italic)\].*?\[\/\1\] ?/'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'/\[(bold)\].*?\[\/\1\] ?/'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'/\[(underline)\].*?\[\/\1\] ?/'<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">];<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$replacements </span><span class="keyword">= [<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'&lt;i&gt;$1&lt;/i&gt;'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'&lt;strong&gt;$1&lt;/strong&gt;'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'&lt;u&gt;$1&lt;/u&gt;'<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">];<br />
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="default">$patterns</span><span class="keyword">, </span><span class="default">$replacements</span><span class="keyword">, </span><span class="default">$html</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">$html </span><span class="keyword">= </span><span class="default">textDecoration</span><span class="keyword">(</span><span class="default">$html</span><span class="keyword">);<br />
<br />
echo </span><span class="default">$html</span><span class="keyword">; </span><span class="comment">// or return<br />
</span><span class="default">?&gt;<br />
</span><br />
results in:<br />
----<br />
This sample shows how to have &lt;i&gt;italic&lt;/i&gt;, &lt;b&gt;bold&lt;/b&gt; and &lt;u&gt;underlined&lt;/u&gt; and [strikethrough]striked[/striketrhough] text.<br />
<br />
Notice!<br />
There is no [strikethrough]striked[/striketrhough] fallback in the patterns and replacements array</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="123144""></a>
  <div class="note">
   <strong class="user">willbrownsberger at gmail dot com</strong>
   <a href="#123144" class="date">20-Sep-2018 06:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Worth knowing:&nbsp; When arrays of patterns and replacements are provided, they are executed in the order they appear in the array -- so later array elements can act on the results of earlier array elements.<br />
<br />
For example:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">echo </span><span class="default">preg_replace</span><span class="keyword">(<br />
&nbsp;&nbsp;&nbsp; array( </span><span class="string">'#cat#'</span><span class="keyword">, </span><span class="string">'#dog#'</span><span class="keyword">, </span><span class="string">'#eel#'</span><span class="keyword">, </span><span class="string">'#snowman#' </span><span class="keyword">),<br />
&nbsp;&nbsp;&nbsp; array(&nbsp; </span><span class="string">'dog1'</span><span class="keyword">, </span><span class="string">'eel2'</span><span class="keyword">, </span><span class="string">'snowman3'</span><span class="keyword">, </span><span class="string">'monster4' </span><span class="keyword">),<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'the good cat and the bad dog wandered on the beach'<br />
<br />
</span><span class="keyword">);<br />
<br />
</span><span class="comment">/* result: the good monster4321 and the bad monster432 wandered on the beach<br />
*/</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="123044""></a>
  <div class="note">
   <strong class="user">chrisbloom7 at gmail dot com</strong>
   <a href="#123044" class="date">16-Aug-2018 08:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that when given array arguments the replacement happens in sequence:<br />
<br />
<span class="default">&lt;?php<br />
$p </span><span class="keyword">= array(</span><span class="string">'/a/'</span><span class="keyword">, </span><span class="string">'/b/'</span><span class="keyword">, </span><span class="string">'/c/'</span><span class="keyword">);<br />
</span><span class="default">$r </span><span class="keyword">= array(</span><span class="string">'b'</span><span class="keyword">, </span><span class="string">'c'</span><span class="keyword">, </span><span class="string">'d'</span><span class="keyword">);<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">preg_replace</span><span class="keyword">(</span><span class="default">$p</span><span class="keyword">, </span><span class="default">$r</span><span class="keyword">, </span><span class="string">'a'</span><span class="keyword">));<br />
</span><span class="comment">// =&gt; d<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="122778""></a>
  <div class="note">
   <strong class="user">bublifuk at mailinator dot com</strong>
   <a href="#122778" class="date">30-May-2018 03:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A delimiter can be any ASCII non-alphanumeric, non-backslash, non-whitespace character:&nbsp; !"#$%&amp;'*+,./:;=?@^_`|~-&nbsp; and&nbsp; ({[&lt;&gt;]})</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="122458""></a>
  <div class="note">
   <strong class="user">alves dot david at outlook dot com</strong>
   <a href="#122458" class="date">28-Feb-2018 12:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
// Function to format Brazilian taxvat using preg_replace<br />
// Fun??o para formatar o CPF ou CPF utilizando preg_replace<br />
if (!function_exists('cpf_cnpj')) {<br />
&nbsp;&nbsp;&nbsp; function cpf_cnpj($cpf_cnpj)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!in_array(strlen($cpf_cnpj), [11, 14])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return $cpf_cnpj;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (strlen($cpf_cnpj) == 11) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return preg_replace("/(\d{3})(\d{3})(\d{3})(\d{2})/", "$1.$2.$3-$4", $cpf_cnpj);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return preg_replace("/(\d{2})(\d{3})(\d{3})(\d{4})(\d{2})/", "$1.$2.$3/$4-$5", $cpf_cnpj);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
echo cpf_cnpj(12345678901), ' - ', cpf_cnpj(12345678000190);<br />
<br />
// 123.456.789-01 - 12.345.678/0001-90</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="122374""></a>
  <div class="note">
   <strong class="user">creating SEO friendly Strings</strong>
   <a href="#122374" class="date">09-Feb-2018 01:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">/**<br />
&nbsp; * prepares a string optimized for SEO<br />
&nbsp; * @see https://blog.ueffing.net/post/2016/03/14/string-seo-optimieren-creating-seo-friendly-url/<br />
&nbsp; * @param String $string <br />
&nbsp; * @return String $string SEO optimized String<br />
&nbsp; */<br />
</span><span class="keyword">function </span><span class="default">seofy </span><span class="keyword">(</span><span class="default">$sString </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$sString </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/[^\\pL\d_]+/u'</span><span class="keyword">, </span><span class="string">'-'</span><span class="keyword">, </span><span class="default">$sString</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$sString </span><span class="keyword">= </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$sString</span><span class="keyword">, </span><span class="string">"-"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$sString </span><span class="keyword">= </span><span class="default">iconv</span><span class="keyword">(</span><span class="string">'utf-8'</span><span class="keyword">, </span><span class="string">"us-ascii//TRANSLIT"</span><span class="keyword">, </span><span class="default">$sString</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$sString </span><span class="keyword">= </span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">$sString</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$sString </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/[^-a-z0-9_]+/'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$sString</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$sString</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="comment">// Example<br />
</span><span class="default">seofy</span><span class="keyword">(</span><span class="string">'Stra?enfest in München'</span><span class="keyword">); </span><span class="comment">// =&gt; strassenfest-in-muenchen<br />
</span><span class="default">seofy</span><span class="keyword">(</span><span class="string">'José Ignacio López de Arriortúa'</span><span class="keyword">); </span><span class="comment">// =&gt; jose-ignacio-lopez-de-arriortua<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
The function seofy () creates a SEO friendly version from a string. Umlauts and other letters not contained in the ASCII character set are either reduced to the basic form equivalent (e. g.: é becomes e and ú wid u) or completely converted (e. g. ? becomes ss and ü becomes ue).<br />
<br />
On the one hand this succeeds because the php function preg_replace performs the replacement by means of unicode - Unicode Regular Expressions - and on the other hand because an approximate translation is attempted by means of the php function iconv with the TRANSLIT option.<br />
<br />
Quote php. net about iconv and TRANSLIT:<br />
"If you append the character string //TRANSLIT to out_charset, transliteration is activated. This means that a character that cannot be displayed in the target character set can be approximated with one or more similar-looking characters.[...]"<br />
<br />
Source:<br />
https://blog.ueffing.net/post/2016/03/14/string-seo-optimieren-creating-seo-friendly-url/</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="121749""></a>
  <div class="note">
   <strong class="user">natan dot jesussouza at gmail dot com</strong>
   <a href="#121749" class="date">11-Oct-2017 09:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
$firstname = htmlspecialchars($_POST['campo']);<br />
$firstname = preg_replace("/[^a-zA-Z0-9]/", "", $firstname, -1, $count_fn);<br />
<br />
// $count_fn conta quantos caracteres foram mudados.<br />
// $firstname variavel que captura o input</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="118285""></a>
  <div class="note">
   <strong class="user">helia at gmail dot com</strong>
   <a href="#118285" class="date">08-Nov-2015 11:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
$pattern='/(09(1|2|3)\d{8})/';<br />
$string ="n:09138660959 nu: 09371313317 nu:09211313317 n: 09393026988nu:09193472840nnu:09211313317nu:09211313317nu:09121772890";<br />
$replacements='($1 code $2)';<br />
echo&nbsp; preg_replace($pattern, $replacements, $string);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="117122""></a>
  <div class="note">
   <strong class="user">logofero at gmail dot com</strong>
   <a href="#117122" class="date">17-Apr-2015 04:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Why not offset parameter to replace the string? It would be helpful<br />
<br />
example:<br />
<br />
mixed preg_replace (mixed $pattern, mixed $replacement, mixed $subject [, int $limit = -1 [, int &amp; $count [, int $offset = 0]]]) <br />
<br />
1 $pattern<br />
2 $replacement <br />
3 $subject<br />
4 $limit<br />
5 $count <br />
6 $offset &lt;- it is planned?</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="116986""></a>
  <div class="note">
   <strong class="user">Garrett Albright</strong>
   <a href="#116986" class="date">30-Mar-2015 08:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It may be useful to note that if you pass an associative array as the $replacement parameter, the keys are preserved.<br />
<br />
<span class="default">&lt;?php<br />
$replaced </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/foo/'</span><span class="keyword">, </span><span class="string">'bar'</span><span class="keyword">, [</span><span class="string">'first' </span><span class="keyword">=&gt; </span><span class="string">'foobar'</span><span class="keyword">, </span><span class="string">'second' </span><span class="keyword">=&gt; </span><span class="string">'barfoo'</span><span class="keyword">]);<br />
</span><span class="comment">// $replaced is now ['first' =&gt; 'barbar', 'second' =&gt; 'barbar'].<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="116884""></a>
  <div class="note">
   <strong class="user">Nibbels</strong>
   <a href="#116884" class="date">15-Mar-2015 02:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I have been filtering every userinput with preg_replace since 6 Years now and nothing happened. I am running PHP 5.6.6 and because of historical reasons I still do not use mysqli.<br />
Now i noticed that this filter [^0-9a-zA-Z_ -|:\.] won't filter anything from a Sleeping-Hack-String like `%' AnD sLeep(3) ANd '1%`:<br />
<br />
preg_replace ( '/[^0-9a-zA-Z_ -|:\.]/', '', "%' AnD sLeep(3) ANd '1%" );<br />
<br />
The reason is, that the fourth Minus has to be escaped!<br />
Fix: [^0-9a-zA-Z_ \-|:\.]<br />
<br />
I tell you because I did not know this and I am pretty sure btw. maybe in older versions of PHP some did not have to escape this minus. Those hacks did not work in the old days, because formerly I have been testing against this.<br />
<br />
Greetings</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="116631""></a>
  <div class="note">
   <strong class="user">Jeroen</strong>
   <a href="#116631" class="date">01-Feb-2015 01:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hello there, <br />
I would like to share a regex (PHP) sniplet of code <br />
I wrote (2012) for myself it is also being used in the <br />
Yerico sriptmerge plugin for joomla marked as simple code.. <br />
To&nbsp; compress javascript code and remove all comments from it. <br />
It also works with mootools It is fast... <br />
(in compairison to other PHP solutions) and does not damage the <br />
Javascript it self and it resolves lots of comment removal isseus.<br />
<br />
//START Remove comments.<br />
<br />
&nbsp;&nbsp; $buffer = str_replace('/// ', '///', $buffer);&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; $buffer = str_replace(',//', ', //', $buffer);<br />
&nbsp;&nbsp; $buffer = str_replace('{//', '{ //', $buffer);<br />
&nbsp;&nbsp; $buffer = str_replace('}//', '} //', $buffer);<br />
&nbsp;&nbsp; $buffer = str_replace('*//*', '*/&nbsp; /*', $buffer);<br />
&nbsp;&nbsp; $buffer = str_replace('/**/', '/*&nbsp; */', $buffer);<br />
&nbsp;&nbsp; $buffer = str_replace('*///', '*/ //', $buffer);<br />
&nbsp;&nbsp; $buffer = preg_replace("/\/\/.*\n\/\/.*\n/", "", $buffer);<br />
&nbsp;&nbsp; $buffer = preg_replace("/\s\/\/\".*/", "", $buffer);<br />
&nbsp;&nbsp; $buffer = preg_replace("/\/\/\n/", "\n", $buffer);<br />
&nbsp;&nbsp; $buffer = preg_replace("/\/\/\s.*.\n/", "\n&nbsp; \n", $buffer);<br />
&nbsp;&nbsp; $buffer = preg_replace('/\/\/w[^w].*/', '', $buffer);<br />
&nbsp;&nbsp; $buffer = preg_replace('/\/\/s[^s].*/', '', $buffer);<br />
&nbsp;&nbsp; $buffer = preg_replace('/\/\/\*\*\*.*/', '', $buffer);<br />
&nbsp;&nbsp; $buffer = preg_replace('/\/\/\*\s\*\s\*.*/', '', $buffer);<br />
&nbsp;&nbsp; $buffer = preg_replace('/[^\*]\/\/[*].*/', '', $buffer);<br />
&nbsp;&nbsp; $buffer = preg_replace('/([;])\/\/.*/', '$1', $buffer);<br />
&nbsp;&nbsp; $buffer = preg_replace('/((\r)|(\n)|(\R)|([^0]1)|([^\"]\s*\-))(\/\/)(.*)/', '$1', $buffer);<br />
&nbsp;&nbsp; $buffer = preg_replace("/([^\*])[\/]+\/\*.*[^a-zA-Z0-9\s\-=+\|!@#$%^&amp;()`~\[\]{};:\'\",&lt;.&gt;?]/", "$1", $buffer);<br />
&nbsp; $buffer = preg_replace("/\/\*/", "\n/*dddpp", $buffer);<br />
&nbsp; $buffer = preg_replace('/((\{\s*|:\s*)[\"\']\s*)(([^\{\};\"\']*)dddpp)/','$1$4', $buffer);<br />
&nbsp; $buffer = preg_replace("/\*\//", "xxxpp*/\n", $buffer);<br />
&nbsp; $buffer = preg_replace('/((\{\s*|:\s*|\[\s*)[\"\']\s*)(([^\};\"\']*)xxxpp)/','$1$4', $buffer);<br />
&nbsp; $buffer = preg_replace('/([\"\'])\s*\/\*/', '$1/*', $buffer);<br />
&nbsp; $buffer = preg_replace('/(\n)[^\'"]?\/\*dddpp.*?xxxpp\*\//s', '', $buffer);<br />
&nbsp; $buffer = preg_replace('/\n\/\*dddpp([^\s]*)/', '$1', $buffer);<br />
&nbsp; $buffer = preg_replace('/xxxpp\*\/\n([^\s]*)/', '*/$1', $buffer);<br />
&nbsp; $buffer = preg_replace('/xxxpp\*\/\n([\"])/', '$1', $buffer);<br />
&nbsp; $buffer = preg_replace('/(\*)\n*\s*(\/\*)\s*/', '$1$2$3', $buffer);<br />
&nbsp; $buffer = preg_replace('/(\*\/)\s*(\")/', '$1$2', $buffer);<br />
&nbsp; $buffer = preg_replace('/\/\*dddpp(\s*)/', '/*', $buffer);<br />
&nbsp; $buffer = preg_replace('/\n\s*\n/', "\n", $buffer);<br />
&nbsp; $buffer = preg_replace("/([^\'\"]\s*)&lt;!--.*--&gt;(?!(&lt;\/div&gt;)).*/","$1", $buffer);<br />
&nbsp; $buffer = preg_replace('/([^\n\w\-=+\|!@#$%^&amp;*()`~\[\]{};:\'",&lt;.&gt;\/?\\\\])(\/\/)(.*)/', '$1', $buffer);<br />
<br />
//END Remove comments.&nbsp; &nbsp; <br />
<br />
//START Remove all whitespaces<br />
<br />
&nbsp; $buffer = preg_replace('/\s+/', ' ', $buffer);<br />
&nbsp; $buffer = preg_replace('/\s*(?:(?=[=\-\+\|%&amp;\*\)\[\]\{\};:\,\.\&lt;\&gt;\!\@\#\^`~]))/', '', $buffer);<br />
&nbsp; $buffer = preg_replace('/(?:(?&lt;=[=\-\+\|%&amp;\*\)\[\]\{\};:\,\.\&lt;\&gt;\?\!\@\#\^`~]))\s*/', '', $buffer);<br />
&nbsp; $buffer = preg_replace('/([^a-zA-Z0-9\s\-=+\|!@#$%^&amp;*()`~\[\]<br />
{};:\'",&lt;.&gt;\/?])\s+([^a-zA-Z0-9\s\-=+\|!@#$%^&amp;*()`~\[\]<br />
{};:\'",&lt;.&gt;\/?])/', '$1$2', $buffer);<br />
<br />
//END Remove all whitespaces<br />
<br />
I am off coarse not a programmer just wanted to <br />
make the plugin work like i wanted it to.... <br />
(NOTE: <br />
For the webmaster sorry I posted this in the wrong topic before...)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="115176""></a>
  <div class="note">
   <strong class="user">elliot dot greene at att dot net</strong>
   <a href="#115176" class="date">09-Jun-2014 04:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
preg_replace to only show alpha numeric characters<br />
<br />
$info = "The Development of code . <a href="http://www." rel="nofollow" target="_blank">http://www.</a>";<br />
<br />
$info = preg_replace("/[^a-zA-Z0-9]+/", "", $info);<br />
<br />
echo $info;<br />
<br />
OUTPUTS: TheDevelopmentofcodehttpwww<br />
<br />
This is a good workable code<br />
<a href="http://www.sioure.com" rel="nofollow" target="_blank">http://www.sioure.com</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="112400""></a>
  <div class="note">
   <strong class="user">spamthishard at wtriple dot com</strong>
   <a href="#112400" class="date">12-Jun-2013 08:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to replace only the n-th occurrence of $pattern, you can use this function:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">preg_replace_nth</span><span class="keyword">(</span><span class="default">$pattern</span><span class="keyword">, </span><span class="default">$replacement</span><span class="keyword">, </span><span class="default">$subject</span><span class="keyword">, </span><span class="default">$nth</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">preg_replace_callback</span><span class="keyword">(</span><span class="default">$pattern</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; function(</span><span class="default">$found</span><span class="keyword">) use (&amp;</span><span class="default">$pattern</span><span class="keyword">, &amp;</span><span class="default">$replacement</span><span class="keyword">, &amp;</span><span class="default">$nth</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nth</span><span class="keyword">--;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$nth</span><span class="keyword">==</span><span class="default">0</span><span class="keyword">) return </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="default">$pattern</span><span class="keyword">, </span><span class="default">$replacement</span><span class="keyword">, </span><span class="default">reset</span><span class="keyword">(</span><span class="default">$found</span><span class="keyword">) );<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">reset</span><span class="keyword">(</span><span class="default">$found</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }, </span><span class="default">$subject</span><span class="keyword">,</span><span class="default">$nth&nbsp; </span><span class="keyword">);<br />
}<br />
<br />
echo </span><span class="default">preg_replace_nth</span><span class="keyword">(</span><span class="string">"/(\w+)\|/"</span><span class="keyword">, </span><span class="string">'${1} is the 4th|'</span><span class="keyword">, </span><span class="string">"|aa|b|cc|dd|e|ff|gg|kkk|"</span><span class="keyword">, </span><span class="default">4</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
this outputs |aa|b|cc|dd is the 4th|e|ff|gg|kkk| <br />
backreferences are accepted in $replacement</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="112203""></a>
  <div class="note">
   <strong class="user">Dustin</strong>
   <a href="#112203" class="date">16-May-2013 11:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Matching substrings where the match can exist at the end of the string was non-intuitive to me.<br />
<br />
I found this because:<br />
strtotime() interprets 'mon' as 'Monday', but Postgres uses interval types that return short names by default, e.g. interval '1 month' returns as '1 mon'.<br />
<br />
I used something like this:<br />
<br />
$str = "mon month monday Mon Monday Month MONTH MON";<br />
$strMonth = preg_replace('~(mon)([^\w]|$)~i', '$1th$2', $str);<br />
echo "$str\n$strMonth\n";<br />
<br />
//to output:<br />
mon month monday Mon Monday Month MONTH MON<br />
month month monday Month Monday Month MONTH MONth</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="111695""></a>
  <div class="note">
   <strong class="user">nik at rolls dot cc</strong>
   <a href="#111695" class="date">17-Mar-2013 10:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To split Pascal/CamelCase into Title Case (for example, converting descriptive class names for use in human-readable frontends), you can use the below function:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">expandCamelCase</span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">) {<br />
&nbsp; return </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/(?&lt;!^)([A-Z][a-z]|(?&lt;=[a-z])[^a-z]|(?&lt;=[A-Z])[0-9_])/'</span><span class="keyword">, </span><span class="string">' $1'</span><span class="keyword">, </span><span class="default">$source</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Before:<br />
&nbsp; ExpandCamelCaseAPIDescriptorPHP5_3_4Version3_21Beta<br />
After:<br />
&nbsp; Expand Camel Case API Descriptor PHP 5_3_4 Version 3_21 Beta</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="110511""></a>
  <div class="note">
   <strong class="user">cincodenada at gmail dot dot dot com</strong>
   <a href="#110511" class="date">30-Oct-2012 10:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There seems to be some confusion over how greediness works.&nbsp; For those familiar with Regular Expressions in other languages, particularly Perl: it works like you would expect, and as documented.&nbsp; Greedy by default, un-greedy if you follow a quantifier with a question mark.<br />
<br />
There is a PHP/PCRE-specific U pattern modifier that flips the greediness, so that quantifiers are by default un-greedy, and become greedy if you follow the quantifier with a question mark: <a href="http://www.php.net/manual/en/reference.pcre.pattern.modifiers.php" rel="nofollow" target="_blank">http://www.php.net/manual/en/reference.pcre.pattern.modifiers.php</a><br />
<br />
To make things clear, a series of examples:<br />
<br />
<span class="default">&lt;?php<br />
<br />
$preview </span><span class="keyword">= </span><span class="string">"a bunch of stuff &lt;code&gt;this that&lt;/code&gt; and more stuff &lt;code&gt;with a second code block&lt;/code&gt; then extra at the end"</span><span class="keyword">; <br />
<br />
</span><span class="default">$preview_default </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/&lt;code&gt;(.*)&lt;\/code&gt;/is'</span><span class="keyword">, </span><span class="string">"&lt;code class=\"prettyprint\"&gt;$1&lt;/code&gt;"</span><span class="keyword">, </span><span class="default">$preview</span><span class="keyword">);<br />
</span><span class="default">$preview_manually_ungreedy </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/&lt;code&gt;(.*?)&lt;\/code&gt;/is'</span><span class="keyword">, </span><span class="string">"&lt;code class=\"prettyprint\"&gt;$1&lt;/code&gt;"</span><span class="keyword">, </span><span class="default">$preview</span><span class="keyword">);<br />
<br />
</span><span class="default">$preview_U_default </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/&lt;code&gt;(.*)&lt;\/code&gt;/isU'</span><span class="keyword">, </span><span class="string">"&lt;code class=\"prettyprint\"&gt;$1&lt;/code&gt;"</span><span class="keyword">, </span><span class="default">$preview</span><span class="keyword">);<br />
</span><span class="default">$preview_U_manually_greedy </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/&lt;code&gt;(.*?)&lt;\/code&gt;/isU'</span><span class="keyword">, </span><span class="string">"&lt;code class=\"prettyprint\"&gt;$1&lt;/code&gt;"</span><span class="keyword">, </span><span class="default">$preview</span><span class="keyword">);<br />
<br />
echo </span><span class="string">"Default, no ?: </span><span class="default">$preview_default</span><span class="string">\n"</span><span class="keyword">;<br />
echo </span><span class="string">"Default, with ?: </span><span class="default">$preview_manually_ungreedy</span><span class="string">\n"</span><span class="keyword">;<br />
echo </span><span class="string">"U flag, no ?: </span><span class="default">$preview_U_default</span><span class="string">\n"</span><span class="keyword">;<br />
echo </span><span class="string">"U flag, with ?: </span><span class="default">$preview_U_manually_greedy</span><span class="string">\n"</span><span class="keyword">;<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Results in this:<br />
<br />
Default, no ?: a bunch of stuff &lt;code class="prettyprint"&gt;this that&lt;/code&gt; and more stuff &lt;code&gt;with a second code block&lt;/code&gt; then extra at the end<br />
Default, with ?: a bunch of stuff &lt;code class="prettyprint"&gt;this that&lt;/code&gt; and more stuff &lt;code class="prettyprint"&gt;with a second code block&lt;/code&gt; then extra at the end<br />
U flag, no ?: a bunch of stuff &lt;code class="prettyprint"&gt;this that&lt;/code&gt; and more stuff &lt;code class="prettyprint"&gt;with a second code block&lt;/code&gt; then extra at the end<br />
U flag, with ?: a bunch of stuff &lt;code class="prettyprint"&gt;this that&lt;/code&gt; and more stuff &lt;code&gt;with a second code block&lt;/code&gt; then extra at the end<br />
<br />
As expected: greedy by default, ? inverts it to ungreedy.&nbsp; With the U flag, un-greedy by default, ? makes it greedy.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="107112""></a>
  <div class="note">
   <strong class="user">hvishnu999 at gmail dot com</strong>
   <a href="#107112" class="date">08-Jan-2012 06:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To covert a string to SEO friendly, do this:
<br />

<br />
<span class="default">&lt;?php
<br />
$realname </span><span class="keyword">= </span><span class="string">"This is the string to be made SEO friendly!"
<br />

<br />
</span><span class="default">$seoname </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/\%/'</span><span class="keyword">,</span><span class="string">' percentage'</span><span class="keyword">,</span><span class="default">$realname</span><span class="keyword">);
<br />
</span><span class="default">$seoname </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/\@/'</span><span class="keyword">,</span><span class="string">' at '</span><span class="keyword">,</span><span class="default">$seoname</span><span class="keyword">);
<br />
</span><span class="default">$seoname </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/\&amp;/'</span><span class="keyword">,</span><span class="string">' and '</span><span class="keyword">,</span><span class="default">$seoname</span><span class="keyword">);
<br />
</span><span class="default">$seoname </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/\s[\s]+/'</span><span class="keyword">,</span><span class="string">'-'</span><span class="keyword">,</span><span class="default">$seoname</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">// Strip off multiple spaces
<br />
</span><span class="default">$seoname </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/[\s\W]+/'</span><span class="keyword">,</span><span class="string">'-'</span><span class="keyword">,</span><span class="default">$seoname</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">// Strip off spaces and non-alpha-numeric
<br />
</span><span class="default">$seoname </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/^[\-]+/'</span><span class="keyword">,</span><span class="string">''</span><span class="keyword">,</span><span class="default">$seoname</span><span class="keyword">); </span><span class="comment">// Strip off the starting hyphens
<br />
</span><span class="default">$seoname </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/[\-]+$/'</span><span class="keyword">,</span><span class="string">''</span><span class="keyword">,</span><span class="default">$seoname</span><span class="keyword">); </span><span class="comment">// // Strip off the ending hyphens
<br />
</span><span class="default">$seoname </span><span class="keyword">= </span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">$seoname</span><span class="keyword">);
<br />

<br />
echo </span><span class="default">$seoname</span><span class="keyword">;
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
This will print: this-is-the-string-to-be-made-seo-friendly</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="106981""></a>
  <div class="note">
   <strong class="user">denis_truffaut a t hotmail d o t com</strong>
   <a href="#106981" class="date">23-Dec-2011 05:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to catch characters, as well european, russian, chinese, japanese, korean of whatever, just :<br />
- use mb_internal_encoding('UTF-8');<br />
- use preg_replace('`...`u', '...', $string) with the u (unicode) modifier<br />
<br />
For further information, the complete list of preg_* modifiers could be found at :<br />
<a href="http://php.net/manual/en/reference.pcre.pattern.modifiers.php" rel="nofollow" target="_blank">http://php.net/manual/en/reference.pcre.pattern.modifiers.php</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="106263""></a>
  <div class="note">
   <strong class="user">akarmenia at gmail dot com</strong>
   <a href="#106263" class="date">22-Oct-2011 11:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
[Editor's note: in this case it would be wise to rely on the preg_quote() function instead which was added for this specific purpose]
<br />

<br />
If your replacement string has a dollar sign or a backslash. it may turn into a backreference accidentally! This will fix it.
<br />

<br />
I want to replace 'text' with '$12345' but this becomes a backreference to $12 (which doesn't exist) and then it prints the remaining '34'. The function down below will return a string that escapes the backreferences.
<br />

<br />
OUTPUT:
<br />
string(8) "some 345"
<br />
string(11) "some \12345"
<br />
string(8) "some 345"
<br />
string(11) "some $12345"
<br />

<br />
<span class="default">&lt;?php
<br />

<br />
$a </span><span class="keyword">= </span><span class="string">'some text'</span><span class="keyword">;
<br />

<br />
</span><span class="comment">// Either of these will backreference and fail
<br />
</span><span class="default">$b1 </span><span class="keyword">= </span><span class="string">'\12345'</span><span class="keyword">; </span><span class="comment">// Should be '\\12345' to avoid backreference
<br />
</span><span class="default">$b2 </span><span class="keyword">= </span><span class="string">'$12345'</span><span class="keyword">; </span><span class="comment">// Should be '\$12345' to avoid backreference
<br />

<br />
</span><span class="default">$d </span><span class="keyword">= array(</span><span class="default">$b1</span><span class="keyword">, </span><span class="default">$b2</span><span class="keyword">);
<br />

<br />
foreach (</span><span class="default">$d </span><span class="keyword">as </span><span class="default">$b</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$result1 </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'#(text)#'</span><span class="keyword">, </span><span class="default">$b</span><span class="keyword">, </span><span class="default">$a</span><span class="keyword">); </span><span class="comment">// Fails
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$result1</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$result2 </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'#(text)#'</span><span class="keyword">, </span><span class="default">preg_escape_back</span><span class="keyword">(</span><span class="default">$b</span><span class="keyword">), </span><span class="default">$a</span><span class="keyword">); </span><span class="comment">// Succeeds
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$result2</span><span class="keyword">);
<br />
}
<br />

<br />
</span><span class="comment">// Escape backreferences from string for use with regex
<br />
</span><span class="keyword">function </span><span class="default">preg_escape_back</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Replace $ with \$ and \ with \\
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$string </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'#(?&lt;!\\\\)(\\$|\\\\)#'</span><span class="keyword">, </span><span class="string">'\\\\$1'</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$string</span><span class="keyword">;
<br />
}
<br />

<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="105122""></a>
  <div class="note">
   <strong class="user">timitheenchanter</strong>
   <a href="#105122" class="date">28-Jul-2011 01:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you have issues where preg_replace returns an empty string, please take a look at these two ini parameters:<br />
<br />
pcre.backtrack_limit<br />
pcre.recursion_limit<br />
<br />
The default is set to 100K.&nbsp; If your buffer is larger than this, look to increase these two values.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="104965""></a>
  <div class="note">
   <strong class="user">sreekanth at outsource-online dot net</strong>
   <a href="#104965" class="date">19-Jul-2011 01:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
if your intention to code and decode mod_rewrite urls and handle it with php and mysql ,this should work<br />
<br />
to convert to url<br />
$url = preg_replace('/[^A-Za-z0-9_-]+/', '-', $string);<br />
<br />
And to check in mysql with the url value,use the same expression discounting '-'.<br />
first replace the url value&nbsp; with php using preg_replace&nbsp; and use with mysql REGEXP<br />
<br />
$sql = "select * from table where fieldname_to_check REGEXP '".preg_replace("/-+/",'[^A-Za-z0-9_]+',$url)."'"</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="104482""></a>
  <div class="note">
   <strong class="user">anyvie at devlibre dot fr</strong>
   <a href="#104482" class="date">17-Jun-2011 02:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A variable can handle a huge quantity of data but preg_replace can't.<br />
<br />
Example :<br />
<span class="default">&lt;?php<br />
$url </span><span class="keyword">= </span><span class="string">"ANY URL WITH LOTS OF DATA"</span><span class="keyword">;<br />
<br />
</span><span class="comment">// We get all the data into $data<br />
</span><span class="default">$data </span><span class="keyword">= </span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">);<br />
<br />
</span><span class="comment">// We just want to keep the content of &lt;head&gt;<br />
</span><span class="default">$head </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"#(.*)&lt;head&gt;(.*?)&lt;/head&gt;(.*)#is"</span><span class="keyword">, </span><span class="string">'$2'</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
$head can have the desired content, or be empty, depends on the length of $data.<br />
<br />
For this application, just add :<br />
$data = substr($data, 0, 4096);<br />
before using preg_replace, and it will work fine.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="104318""></a>
  <div class="note">
   <strong class="user">someuser at dot dot com</strong>
   <a href="#104318" class="date">08-Jun-2011 04:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Replacement of line numbers, with replacement limit per line.<br />
<br />
Solution that worked for me.<br />
I have a file with tasks listed each starting from number, and only starting number should be removed because forth going text has piles of numbers to be omitted.<br />
<br />
56 Patient A of 46 years suffering ... ...<br />
57 Newborn of 26 weeks was ...<br />
58 Jane, having age 18 years recollects onsets of ...<br />
...<br />
587 Patient of 70 years ...<br />
<br />
etc.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// Array obtained from file&nbsp; &nbsp; <br />
</span><span class="default">$array </span><span class="keyword">= </span><span class="default">file</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Decompile array with foreach loop<br />
</span><span class="keyword">foreach(</span><span class="default">$array </span><span class="keyword">as </span><span class="default">$value</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//&nbsp; &nbsp; Take away numbers 100-999<br />
&nbsp;&nbsp;&nbsp; //&nbsp; &nbsp; Starting from biggest <br />
&nbsp;&nbsp;&nbsp; //<br />
&nbsp;&nbsp;&nbsp; //&nbsp; &nbsp; %&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Delimiter<br />
&nbsp;&nbsp;&nbsp; //&nbsp; &nbsp; ^&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Make match from beginning of line<br />
&nbsp;&nbsp;&nbsp; //&nbsp; &nbsp; [0-9]&nbsp; &nbsp; &nbsp; &nbsp; Range of numbers<br />
&nbsp;&nbsp;&nbsp; //&nbsp; &nbsp; {3}&nbsp; &nbsp; &nbsp; &nbsp; Multiplication of digit range (For tree digit numbers)<br />
&nbsp;&nbsp;&nbsp; //<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'%^[0-9]{3}%'</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">)) <br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Re-assing to value its modified copy<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$value </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'%^[0-9]{3}%'</span><span class="keyword">, </span><span class="string">'-HERE WAS XXX NUMBER-'</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Take away numbers 10-99<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">elseif(</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'%^[0-9]{2}%'</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$value </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'%^[0-9]{2}%'</span><span class="keyword">, </span><span class="string">'-HERE WAS XX NUMBER-'</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Take away numbers 0-9<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">elseif(</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'%^[0-9]%'</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$value </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'%^[0-9]%'</span><span class="keyword">, </span><span class="string">'-HERE WAS X NUMBER-'</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Build array back<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$arr</span><span class="keyword">[] = array(</span><span class="default">$value</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="103985""></a>
  <div class="note">
   <strong class="user">craiga at craiga dot id dot au</strong>
   <a href="#103985" class="date">15-May-2011 07:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If there's a chance your replacement text contains any strings such as "$0.95", you'll need to escape those $n backreferences:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">escape_backreference</span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/\$(\d)/'</span><span class="keyword">, </span><span class="string">'\\\$$1'</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102589""></a>
  <div class="note">
   <strong class="user">me at perochak dot com</strong>
   <a href="#102589" class="date">22-Feb-2011 09:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you would like to remove a tag along with the text inside it then use the following code.
<br />

<br />
<span class="default">&lt;?php
<br />
preg_replace</span><span class="keyword">(</span><span class="string">'/(&lt;tag&gt;.+?)+(&lt;\/tag&gt;)/i'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">);
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
example
<br />
<span class="default">&lt;?php $string</span><span class="keyword">=</span><span class="string">'&lt;span class="normalprice"&gt;55 PKR&lt;/span&gt;'</span><span class="keyword">; </span><span class="default">?&gt;
<br />
</span>
<br />
<span class="default">&lt;?php
<br />
$string </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/(&lt;span class="normalprice"&gt;.+?)+(&lt;\/span&gt;)/i'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">);
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
This will results a null or empty string.
<br />

<br />
<span class="default">&lt;?php
<br />
$string</span><span class="keyword">=</span><span class="string">'My String &lt;span class="normalprice"&gt;55 PKR&lt;/span&gt;'</span><span class="keyword">;
<br />

<br />
</span><span class="default">$string </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/(&lt;span class="normalprice"&gt;.+?)+(&lt;\/span&gt;)/i'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">);
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
This will results a " My String"</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="101938""></a>
  <div class="note">
   <strong class="user">nospam at probackup dot nl</strong>
   <a href="#101938" class="date">19-Jan-2011 05:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Warning: a common made mistake in trying to remove all characters except numbers and letters from a string, is to use code with a regex similar to preg_replace('[^A-Za-z0-9_]', '', ...). The output goes in an unexpected direction in case your input contains two double quotes.<br />
<br />
echo preg_replace('[^A-Za-z0-9_]', '', 'D"usseldorfer H"auptstrasse')<br />
<br />
D"usseldorfer H"auptstrasse<br />
<br />
It is important to not forget a leading an trailing forward slash in the regex: <br />
<br />
echo preg_replace('/[^A-Za-z0-9_]/', '', 'D"usseldorfer H"auptstrasse')<br />
<br />
Dusseldorfer Hauptstrasse<br />
<br />
PS An alternative is to use preg_replace('/\W/', '', $t) for keeping all alpha numeric characters including underscores.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="101236""></a>
  <div class="note">
   <strong class="user">Terminux (dot) anonymous at gmail</strong>
   <a href="#101236" class="date">03-Dec-2010 09:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This function will strip all the HTML-like content in a string.<br />
I know you can find a lot of similar content on the web, but this one is simple, fast and robust. Don't simply use the built-in functions like strip_tags(), they dont work so good.<br />
<br />
Careful however, this is not a correct validation of a string ; you should use additional functions like mysql_real_escape_string and filter_var, as well as custom tests before putting a submission into your database.<br />
<br />
<span class="default">&lt;?php <br />
<br />
$html </span><span class="keyword">= &lt;&lt;&lt;END<br />
</span><span class="string">&lt;div id="function.preg-split" class="refentry"&gt; Bonjour1 \t<br />
&lt;div class="refnamediv"&gt; Bonjour2 \t<br />
&lt;h1 class="refname"&gt;Bonjour3 \t&lt;/h1&gt;<br />
&lt;h1 class="""&gt;Bonjour4 \t&lt;/h1&gt;<br />
&lt;h1 class="*%1"&gt;Bonjour5 \t&lt;/h1&gt;<br />
&lt;body&gt;Bonjour6 \t&lt;//body&gt;&gt;<br />
&lt;/ body&gt;Bonjour7 \t&lt;////&nbsp; &nbsp; &nbsp; &nbsp; body&gt;&gt;<br />
&lt;<br />
a href="image.php" alt="trans" /&nbsp; &nbsp; &nbsp; &nbsp; &gt;<br />
some leftover text...<br />
&nbsp;&nbsp; &nbsp; &lt; DIV class=noCompliant style = "text-align:left;" &gt;<br />
... and some other ...<br />
&lt; dIv &gt; &lt; empty&gt;&nbsp; &lt;/ empty&gt;<br />
&nbsp; &lt;p&gt; This is yet another text &lt;br&nbsp; &gt;<br />
&nbsp;&nbsp; &nbsp; that wasn't &lt;b&gt;compliant&lt;/b&gt; too... &lt;br&nbsp;&nbsp; /&gt;<br />
&nbsp;&nbsp; &nbsp; &lt;/p&gt;<br />
&nbsp;&lt;div class="noClass" &gt; this one is better but we don't care anyway &lt;/div &gt;&lt;P&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;input&nbsp;&nbsp; type= "text"&nbsp; name ='my "name' value&nbsp; = "nothin really." readonly&gt;<br />
end of paragraph &lt;/p&gt; &lt;/Div&gt;&nbsp;&nbsp; &lt;/div&gt;&nbsp;&nbsp; some trailing text <br />
</span><span class="keyword">END;<br />
<br />
</span><span class="comment">// This echoes correctly all the text that is not inside HTML tags<br />
</span><span class="default">$html_reg </span><span class="keyword">= </span><span class="string">'/&lt;+\s*\/*\s*([A-Z][A-Z0-9]*)\b[^&gt;]*\/*\s*&gt;+/i'</span><span class="keyword">;<br />
echo </span><span class="default">htmlentities</span><span class="keyword">( </span><span class="default">preg_replace</span><span class="keyword">( </span><span class="default">$html_reg</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$html </span><span class="keyword">) );<br />
<br />
</span><span class="comment">// This extracts only a small portion of the text<br />
</span><span class="keyword">echo </span><span class="default">htmlentities</span><span class="keyword">(</span><span class="default">strip_tags</span><span class="keyword">(</span><span class="default">$html</span><span class="keyword">));<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="96586""></a>
  <div class="note">
   <strong class="user">hello at weblap dot ro</strong>
   <a href="#96586" class="date">06-Mar-2010 04:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Post slug generator, for creating clean urls from titles.
<br />
It works with many languages.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">remove_accent</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">)
<br />
{
<br />
&nbsp; </span><span class="default">$a </span><span class="keyword">= array(</span><span class="string">'à'</span><span class="keyword">, </span><span class="string">'á'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'è'</span><span class="keyword">, </span><span class="string">'é'</span><span class="keyword">, </span><span class="string">'ê'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'ì'</span><span class="keyword">, </span><span class="string">'í'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'D'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'ò'</span><span class="keyword">, </span><span class="string">'ó'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'ù'</span><span class="keyword">, </span><span class="string">'ú'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'ü'</span><span class="keyword">, </span><span class="string">'Y'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'à'</span><span class="keyword">, </span><span class="string">'á'</span><span class="keyword">, </span><span class="string">'a'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'è'</span><span class="keyword">, </span><span class="string">'é'</span><span class="keyword">, </span><span class="string">'ê'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'ì'</span><span class="keyword">, </span><span class="string">'í'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'ò'</span><span class="keyword">, </span><span class="string">'ó'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'ù'</span><span class="keyword">, </span><span class="string">'ú'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'ü'</span><span class="keyword">, </span><span class="string">'y'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'ā'</span><span class="keyword">, </span><span class="string">'ā'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'ē'</span><span class="keyword">, </span><span class="string">'ē'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'ě'</span><span class="keyword">, </span><span class="string">'ě'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'ī'</span><span class="keyword">, </span><span class="string">'ī'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'ō'</span><span class="keyword">, </span><span class="string">'ō'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'ū'</span><span class="keyword">, </span><span class="string">'ū'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'ǎ'</span><span class="keyword">, </span><span class="string">'ǎ'</span><span class="keyword">, </span><span class="string">'ǐ'</span><span class="keyword">, </span><span class="string">'ǐ'</span><span class="keyword">, </span><span class="string">'ǒ'</span><span class="keyword">, </span><span class="string">'ǒ'</span><span class="keyword">, </span><span class="string">'ǔ'</span><span class="keyword">, </span><span class="string">'ǔ'</span><span class="keyword">, </span><span class="string">'ǖ'</span><span class="keyword">, </span><span class="string">'ǖ'</span><span class="keyword">, </span><span class="string">'ǘ'</span><span class="keyword">, </span><span class="string">'ǘ'</span><span class="keyword">, </span><span class="string">'ǚ'</span><span class="keyword">, </span><span class="string">'ǚ'</span><span class="keyword">, </span><span class="string">'ǜ'</span><span class="keyword">, </span><span class="string">'ǜ'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">);
<br />
&nbsp; </span><span class="default">$b </span><span class="keyword">= array(</span><span class="string">'A'</span><span class="keyword">, </span><span class="string">'A'</span><span class="keyword">, </span><span class="string">'A'</span><span class="keyword">, </span><span class="string">'A'</span><span class="keyword">, </span><span class="string">'A'</span><span class="keyword">, </span><span class="string">'A'</span><span class="keyword">, </span><span class="string">'AE'</span><span class="keyword">, </span><span class="string">'C'</span><span class="keyword">, </span><span class="string">'E'</span><span class="keyword">, </span><span class="string">'E'</span><span class="keyword">, </span><span class="string">'E'</span><span class="keyword">, </span><span class="string">'E'</span><span class="keyword">, </span><span class="string">'I'</span><span class="keyword">, </span><span class="string">'I'</span><span class="keyword">, </span><span class="string">'I'</span><span class="keyword">, </span><span class="string">'I'</span><span class="keyword">, </span><span class="string">'D'</span><span class="keyword">, </span><span class="string">'N'</span><span class="keyword">, </span><span class="string">'O'</span><span class="keyword">, </span><span class="string">'O'</span><span class="keyword">, </span><span class="string">'O'</span><span class="keyword">, </span><span class="string">'O'</span><span class="keyword">, </span><span class="string">'O'</span><span class="keyword">, </span><span class="string">'O'</span><span class="keyword">, </span><span class="string">'U'</span><span class="keyword">, </span><span class="string">'U'</span><span class="keyword">, </span><span class="string">'U'</span><span class="keyword">, </span><span class="string">'U'</span><span class="keyword">, </span><span class="string">'Y'</span><span class="keyword">, </span><span class="string">'s'</span><span class="keyword">, </span><span class="string">'a'</span><span class="keyword">, </span><span class="string">'a'</span><span class="keyword">, </span><span class="string">'a'</span><span class="keyword">, </span><span class="string">'a'</span><span class="keyword">, </span><span class="string">'a'</span><span class="keyword">, </span><span class="string">'a'</span><span class="keyword">, </span><span class="string">'ae'</span><span class="keyword">, </span><span class="string">'c'</span><span class="keyword">, </span><span class="string">'e'</span><span class="keyword">, </span><span class="string">'e'</span><span class="keyword">, </span><span class="string">'e'</span><span class="keyword">, </span><span class="string">'e'</span><span class="keyword">, </span><span class="string">'i'</span><span class="keyword">, </span><span class="string">'i'</span><span class="keyword">, </span><span class="string">'i'</span><span class="keyword">, </span><span class="string">'i'</span><span class="keyword">, </span><span class="string">'n'</span><span class="keyword">, </span><span class="string">'o'</span><span class="keyword">, </span><span class="string">'o'</span><span class="keyword">, </span><span class="string">'o'</span><span class="keyword">, </span><span class="string">'o'</span><span class="keyword">, </span><span class="string">'o'</span><span class="keyword">, </span><span class="string">'o'</span><span class="keyword">, </span><span class="string">'u'</span><span class="keyword">, </span><span class="string">'u'</span><span class="keyword">, </span><span class="string">'u'</span><span class="keyword">, </span><span class="string">'u'</span><span class="keyword">, </span><span class="string">'y'</span><span class="keyword">, </span><span class="string">'y'</span><span class="keyword">, </span><span class="string">'A'</span><span class="keyword">, </span><span class="string">'a'</span><span class="keyword">, </span><span class="string">'A'</span><span class="keyword">, </span><span class="string">'a'</span><span class="keyword">, </span><span class="string">'A'</span><span class="keyword">, </span><span class="string">'a'</span><span class="keyword">, </span><span class="string">'C'</span><span class="keyword">, </span><span class="string">'c'</span><span class="keyword">, </span><span class="string">'C'</span><span class="keyword">, </span><span class="string">'c'</span><span class="keyword">, </span><span class="string">'C'</span><span class="keyword">, </span><span class="string">'c'</span><span class="keyword">, </span><span class="string">'C'</span><span class="keyword">, </span><span class="string">'c'</span><span class="keyword">, </span><span class="string">'D'</span><span class="keyword">, </span><span class="string">'d'</span><span class="keyword">, </span><span class="string">'D'</span><span class="keyword">, </span><span class="string">'d'</span><span class="keyword">, </span><span class="string">'E'</span><span class="keyword">, </span><span class="string">'e'</span><span class="keyword">, </span><span class="string">'E'</span><span class="keyword">, </span><span class="string">'e'</span><span class="keyword">, </span><span class="string">'E'</span><span class="keyword">, </span><span class="string">'e'</span><span class="keyword">, </span><span class="string">'E'</span><span class="keyword">, </span><span class="string">'e'</span><span class="keyword">, </span><span class="string">'E'</span><span class="keyword">, </span><span class="string">'e'</span><span class="keyword">, </span><span class="string">'G'</span><span class="keyword">, </span><span class="string">'g'</span><span class="keyword">, </span><span class="string">'G'</span><span class="keyword">, </span><span class="string">'g'</span><span class="keyword">, </span><span class="string">'G'</span><span class="keyword">, </span><span class="string">'g'</span><span class="keyword">, </span><span class="string">'G'</span><span class="keyword">, </span><span class="string">'g'</span><span class="keyword">, </span><span class="string">'H'</span><span class="keyword">, </span><span class="string">'h'</span><span class="keyword">, </span><span class="string">'H'</span><span class="keyword">, </span><span class="string">'h'</span><span class="keyword">, </span><span class="string">'I'</span><span class="keyword">, </span><span class="string">'i'</span><span class="keyword">, </span><span class="string">'I'</span><span class="keyword">, </span><span class="string">'i'</span><span class="keyword">, </span><span class="string">'I'</span><span class="keyword">, </span><span class="string">'i'</span><span class="keyword">, </span><span class="string">'I'</span><span class="keyword">, </span><span class="string">'i'</span><span class="keyword">, </span><span class="string">'I'</span><span class="keyword">, </span><span class="string">'i'</span><span class="keyword">, </span><span class="string">'IJ'</span><span class="keyword">, </span><span class="string">'ij'</span><span class="keyword">, </span><span class="string">'J'</span><span class="keyword">, </span><span class="string">'j'</span><span class="keyword">, </span><span class="string">'K'</span><span class="keyword">, </span><span class="string">'k'</span><span class="keyword">, </span><span class="string">'L'</span><span class="keyword">, </span><span class="string">'l'</span><span class="keyword">, </span><span class="string">'L'</span><span class="keyword">, </span><span class="string">'l'</span><span class="keyword">, </span><span class="string">'L'</span><span class="keyword">, </span><span class="string">'l'</span><span class="keyword">, </span><span class="string">'L'</span><span class="keyword">, </span><span class="string">'l'</span><span class="keyword">, </span><span class="string">'l'</span><span class="keyword">, </span><span class="string">'l'</span><span class="keyword">, </span><span class="string">'N'</span><span class="keyword">, </span><span class="string">'n'</span><span class="keyword">, </span><span class="string">'N'</span><span class="keyword">, </span><span class="string">'n'</span><span class="keyword">, </span><span class="string">'N'</span><span class="keyword">, </span><span class="string">'n'</span><span class="keyword">, </span><span class="string">'n'</span><span class="keyword">, </span><span class="string">'O'</span><span class="keyword">, </span><span class="string">'o'</span><span class="keyword">, </span><span class="string">'O'</span><span class="keyword">, </span><span class="string">'o'</span><span class="keyword">, </span><span class="string">'O'</span><span class="keyword">, </span><span class="string">'o'</span><span class="keyword">, </span><span class="string">'OE'</span><span class="keyword">, </span><span class="string">'oe'</span><span class="keyword">, </span><span class="string">'R'</span><span class="keyword">, </span><span class="string">'r'</span><span class="keyword">, </span><span class="string">'R'</span><span class="keyword">, </span><span class="string">'r'</span><span class="keyword">, </span><span class="string">'R'</span><span class="keyword">, </span><span class="string">'r'</span><span class="keyword">, </span><span class="string">'S'</span><span class="keyword">, </span><span class="string">'s'</span><span class="keyword">, </span><span class="string">'S'</span><span class="keyword">, </span><span class="string">'s'</span><span class="keyword">, </span><span class="string">'S'</span><span class="keyword">, </span><span class="string">'s'</span><span class="keyword">, </span><span class="string">'S'</span><span class="keyword">, </span><span class="string">'s'</span><span class="keyword">, </span><span class="string">'T'</span><span class="keyword">, </span><span class="string">'t'</span><span class="keyword">, </span><span class="string">'T'</span><span class="keyword">, </span><span class="string">'t'</span><span class="keyword">, </span><span class="string">'T'</span><span class="keyword">, </span><span class="string">'t'</span><span class="keyword">, </span><span class="string">'U'</span><span class="keyword">, </span><span class="string">'u'</span><span class="keyword">, </span><span class="string">'U'</span><span class="keyword">, </span><span class="string">'u'</span><span class="keyword">, </span><span class="string">'U'</span><span class="keyword">, </span><span class="string">'u'</span><span class="keyword">, </span><span class="string">'U'</span><span class="keyword">, </span><span class="string">'u'</span><span class="keyword">, </span><span class="string">'U'</span><span class="keyword">, </span><span class="string">'u'</span><span class="keyword">, </span><span class="string">'U'</span><span class="keyword">, </span><span class="string">'u'</span><span class="keyword">, </span><span class="string">'W'</span><span class="keyword">, </span><span class="string">'w'</span><span class="keyword">, </span><span class="string">'Y'</span><span class="keyword">, </span><span class="string">'y'</span><span class="keyword">, </span><span class="string">'Y'</span><span class="keyword">, </span><span class="string">'Z'</span><span class="keyword">, </span><span class="string">'z'</span><span class="keyword">, </span><span class="string">'Z'</span><span class="keyword">, </span><span class="string">'z'</span><span class="keyword">, </span><span class="string">'Z'</span><span class="keyword">, </span><span class="string">'z'</span><span class="keyword">, </span><span class="string">'s'</span><span class="keyword">, </span><span class="string">'f'</span><span class="keyword">, </span><span class="string">'O'</span><span class="keyword">, </span><span class="string">'o'</span><span class="keyword">, </span><span class="string">'U'</span><span class="keyword">, </span><span class="string">'u'</span><span class="keyword">, </span><span class="string">'A'</span><span class="keyword">, </span><span class="string">'a'</span><span class="keyword">, </span><span class="string">'I'</span><span class="keyword">, </span><span class="string">'i'</span><span class="keyword">, </span><span class="string">'O'</span><span class="keyword">, </span><span class="string">'o'</span><span class="keyword">, </span><span class="string">'U'</span><span class="keyword">, </span><span class="string">'u'</span><span class="keyword">, </span><span class="string">'U'</span><span class="keyword">, </span><span class="string">'u'</span><span class="keyword">, </span><span class="string">'U'</span><span class="keyword">, </span><span class="string">'u'</span><span class="keyword">, </span><span class="string">'U'</span><span class="keyword">, </span><span class="string">'u'</span><span class="keyword">, </span><span class="string">'U'</span><span class="keyword">, </span><span class="string">'u'</span><span class="keyword">, </span><span class="string">'A'</span><span class="keyword">, </span><span class="string">'a'</span><span class="keyword">, </span><span class="string">'AE'</span><span class="keyword">, </span><span class="string">'ae'</span><span class="keyword">, </span><span class="string">'O'</span><span class="keyword">, </span><span class="string">'o'</span><span class="keyword">);
<br />
&nbsp; return </span><span class="default">str_replace</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">, </span><span class="default">$b</span><span class="keyword">, </span><span class="default">$str</span><span class="keyword">);
<br />
}
<br />

<br />
function </span><span class="default">post_slug</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">)
<br />
{
<br />
&nbsp; return </span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">preg_replace</span><span class="keyword">(array(</span><span class="string">'/[^a-zA-Z0-9 -]/'</span><span class="keyword">, </span><span class="string">'/[ -]+/'</span><span class="keyword">, </span><span class="string">'/^-|-$/'</span><span class="keyword">), 
<br />
&nbsp; array(</span><span class="string">''</span><span class="keyword">, </span><span class="string">'-'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">), </span><span class="default">remove_accent</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">)));
<br />
}
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Example: post_slug(' -Lo#&amp;@rem&nbsp; IPSUM //dolor-/sit - amet-/-consectetur! 12 -- ')
<br />
will output: lorem-ipsum-dolor-sit-amet-consectetur-12</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="89364""></a>
  <div class="note">
   <strong class="user">arkani at iol dot pt</strong>
   <a href="#89364" class="date">04-Mar-2009 11:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Because i search a lot 4 this:<br />
<br />
The following should be escaped if you are trying to match that character<br />
<br />
\ ^ . $ | ( ) [ ]<br />
* + ? { } ,<br />
<br />
Special Character Definitions<br />
\ Quote the next metacharacter<br />
^ Match the beginning of the line<br />
. Match any character (except newline)<br />
$ Match the end of the line (or before newline at the end)<br />
| Alternation<br />
() Grouping<br />
[] Character class<br />
* Match 0 or more times<br />
+ Match 1 or more times<br />
? Match 1 or 0 times<br />
{n} Match exactly n times<br />
{n,} Match at least n times<br />
{n,m} Match at least n but not more than m times<br />
More Special Character Stuff<br />
\t tab (HT, TAB)<br />
\n newline (LF, NL)<br />
\r return (CR)<br />
\f form feed (FF)<br />
\a alarm (bell) (BEL)<br />
\e escape (think troff) (ESC)<br />
\033 octal char (think of a PDP-11)<br />
\x1B hex char<br />
\c[ control char<br />
\l lowercase next char (think vi)<br />
\u uppercase next char (think vi)<br />
\L lowercase till \E (think vi)<br />
\U uppercase till \E (think vi)<br />
\E end case modification (think vi)<br />
\Q quote (disable) pattern metacharacters till \E<br />
Even More Special Characters<br />
\w Match a "word" character (alphanumeric plus "_")<br />
\W Match a non-word character<br />
\s Match a whitespace character<br />
\S Match a non-whitespace character<br />
\d Match a digit character<br />
\D Match a non-digit character<br />
\b Match a word boundary<br />
\B Match a non-(word boundary)<br />
\A Match only at beginning of string<br />
\Z Match only at end of string, or before newline at the end<br />
\z Match only at end of string<br />
\G Match only where previous m//g left off (works only with /g)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="87300""></a>
  <div class="note">
   <strong class="user">mdrisser at gmail dot com</strong>
   <a href="#87300" class="date">28-Nov-2008 10:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
An alternative to the method suggested by sheri is to remember that the regex modifier '$' only looks at the end of the STRING, the example given is a single string consisting of multiple lines.<br />
<br />
Try:<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// Following is 1 string containing 3 lines<br />
</span><span class="default">$s </span><span class="keyword">= </span><span class="string">"Testing, testing.\r\n"<br />
&nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"Another testing line.\r\n"<br />
&nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"Testing almost done."</span><span class="keyword">;<br />
<br />
echo </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/\.\\r\\n/m'</span><span class="keyword">, </span><span class="string">'@\r\n'</span><span class="keyword">, </span><span class="default">$s</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
This results in the string:<br />
Testing, testing@\r\nAnother testing line@\r\nTesting almost done.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="87102""></a>
  <div class="note">
   <strong class="user">jette at nerdgirl dot dk</strong>
   <a href="#87102" class="date">19-Nov-2008 04:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I use this to prevent users from overdoing repeated text. The following function only allows 3 identical characters at a time and also takes care of repetitions with whitespace added.<br />
<br />
This means that 'haaaaaaleluuuujaaaaa' becomes 'haaaleluuujaaa' and 'I am c o o o o o o l' becomes 'I am c o o o l'<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">//Example of user input<br />
</span><span class="default">$str </span><span class="keyword">= </span><span class="string">"aaaaaaaaaaabbccccccccaaaaad d d d&nbsp;&nbsp; d&nbsp; &nbsp; &nbsp; d d ddde''''''''''''"</span><span class="keyword">;<br />
<br />
function </span><span class="default">stripRepeat</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">) {<br />
&nbsp; </span><span class="comment">//Do not allow repeated whitespace<br />
&nbsp; </span><span class="default">$str </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"/(\s){2,}/"</span><span class="keyword">,</span><span class="string">'$1'</span><span class="keyword">,</span><span class="default">$str</span><span class="keyword">);<br />
&nbsp; </span><span class="comment">//Result: aaaaaaaaaaabbccccccccaaaaad d d d d d d ddde''''''''''''<br />
<br />
&nbsp; //Do not allow more than 3 identical characters separated by any whitespace <br />
&nbsp; </span><span class="default">$str </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'{( ?.)\1{4,}}'</span><span class="keyword">,</span><span class="string">'$1$1$1'</span><span class="keyword">,</span><span class="default">$str</span><span class="keyword">);<br />
&nbsp; </span><span class="comment">//Final result: aaabbcccaaad d d ddde'''<br />
<br />
&nbsp; </span><span class="keyword">return </span><span class="default">$str</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
To prevent any repetitions of characters, you only need this:<br />
<br />
<span class="default">&lt;?php<br />
$str </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'{(.)\1+}'</span><span class="keyword">,</span><span class="string">'$1'</span><span class="keyword">,</span><span class="default">$str</span><span class="keyword">);<br />
</span><span class="comment">//Result: abcad d d d d d d de'<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="87058""></a>
  <div class="note">
   <strong class="user">7r6ivyeo at mail dot com</strong>
   <a href="#87058" class="date">17-Nov-2008 09:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
String to filename:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">string_to_filename</span><span class="keyword">(</span><span class="default">$word</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$tmp </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/^\W+|\W+$/'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$word</span><span class="keyword">); </span><span class="comment">// remove all non-alphanumeric chars at begin &amp; end of string<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$tmp </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/\s+/'</span><span class="keyword">, </span><span class="string">'_'</span><span class="keyword">, </span><span class="default">$tmp</span><span class="keyword">); </span><span class="comment">// compress internal whitespace and replace with _<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/\W-/'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$tmp</span><span class="keyword">)); </span><span class="comment">// remove all non-alphanumeric chars except _ and -<br />
</span><span class="keyword">}<br />
</span><span class="default">?&gt;<br />
</span><br />
Returns a usable &amp; readable filename.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85416""></a>
  <div class="note">
   <strong class="user">dyer85 at gmail dot com</strong>
   <a href="#85416" class="date">28-Aug-2008 07:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There seems to be some unexpected behavior when using the /m modifier when the line terminators are win32 or mac format.<br />
<br />
If you have a string like below, and try to replace dots, the regex won't replace correctly:<br />
<br />
<span class="default">&lt;?php<br />
$s </span><span class="keyword">= </span><span class="string">"Testing, testing.\r\n"<br />
&nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"Another testing line.\r\n"<br />
&nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"Testing almost done."</span><span class="keyword">;<br />
<br />
echo </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/\.$/m'</span><span class="keyword">, </span><span class="string">'.@'</span><span class="keyword">, </span><span class="default">$s</span><span class="keyword">); </span><span class="comment">// only last . replaced<br />
</span><span class="default">?&gt;<br />
</span><br />
The /m modifier doesn't seem to work properly when CRLFs or CRs are used. Make sure to convert line endings to LFs (*nix format) in your input string.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84703""></a>
  <div class="note">
   <strong class="user">marcin at pixaltic dot com</strong>
   <a href="#84703" class="date">25-Jul-2008 03:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//:::replace with anything that you can do with searched string:::
<br />
&nbsp;&nbsp;&nbsp; //Marcin Majchrzak
<br />
&nbsp;&nbsp;&nbsp; //pixaltic.com
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$c </span><span class="keyword">= </span><span class="string">"2 4 8"</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; echo (</span><span class="default">$c</span><span class="keyword">); </span><span class="comment">//display:2 4 8
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$cp </span><span class="keyword">= </span><span class="string">"/(\d)\s(\d)\s(\d)/e"</span><span class="keyword">; </span><span class="comment">//pattern
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$cr </span><span class="keyword">= </span><span class="string">"'\\3*\\2+\\1='.(('\\3')*('\\2')+('\\1'))"</span><span class="keyword">; </span><span class="comment">//replece
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$c </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="default">$cp</span><span class="keyword">, </span><span class="default">$cr</span><span class="keyword">, </span><span class="default">$c</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; echo (</span><span class="default">$c</span><span class="keyword">); </span><span class="comment">//display:8*4+2=34
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84385""></a>
  <div class="note">
   <strong class="user">David</strong>
   <a href="#84385" class="date">11-Jul-2008 04:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Take care when you try to strip whitespaces out of an UTF-8 text. Using something like:<br />
<br />
<span class="default">&lt;?php<br />
$text </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">( </span><span class="string">"{\s+}"</span><span class="keyword">, </span><span class="string">' '</span><span class="keyword">, </span><span class="default">$text </span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
brokes in my case the letter à which is hex c3a0. But a0 is a whitespace. So use <br />
<br />
<span class="default">&lt;?php<br />
$text </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">( </span><span class="string">"{[ \t]+}"</span><span class="keyword">, </span><span class="string">' '</span><span class="keyword">, </span><span class="default">$text </span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
to strip all spaces and tabs, or better, use a multibyte function like mb_ereg_replace.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84285""></a>
  <div class="note">
   <strong class="user">akniep at rayo dot info</strong>
   <a href="#84285" class="date">07-Jul-2008 03:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
preg_replace (and other preg-functions) return null instead of a string when encountering problems you probably did not think about!<br />
-------------------------<br />
<br />
It may not be obvious to everybody that the function returns NULL if an error of any kind occurres. An error I happen to stumple about quite often was the back-tracking-limit:<br />
<a href="http://de.php.net/manual/de/pcre.configuration.php" rel="nofollow" target="_blank">http://de.php.net/manual/de/pcre.configuration.php</a><br />
#ini.pcre.backtrack-limit<br />
<br />
When working with HTML-documents and their parsing it happens that you encounter documents that have a length of over 100.000 characters and that may lead to certain regular-expressions to fail due the back-tracking-limit of above.<br />
<br />
A regular-expression that is ungreedy ("U", <a href="http://de.php.net/manual/de/reference.pcre.pattern.modifiers.php" rel="nofollow" target="_blank">http://de.php.net/manual/de/reference.pcre.pattern.modifiers.php</a>) often does the job, but still: sometimes you just need a greedy regular expression working on long strings ...<br />
<br />
Since, an unhandled return-value of NULL usually creates a consecutive error in the application with unwanted and unforeseen consequences, I found the following solution to be quite helpful and at least save the application from crashing:<br />
<br />
<span class="default">&lt;?php<br />
<br />
$string_after </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">( </span><span class="string">'/some_regexp/'</span><span class="keyword">, </span><span class="string">"replacement"</span><span class="keyword">, </span><span class="default">$string_before </span><span class="keyword">);<br />
<br />
</span><span class="comment">// if some error occurred we go on working with the unchanged original string<br />
</span><span class="keyword">if (</span><span class="default">PREG_NO_ERROR </span><span class="keyword">!== </span><span class="default">preg_last_error</span><span class="keyword">())<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$string_after </span><span class="keyword">= </span><span class="default">$string_before</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// put email-sending or a log-message here<br />
</span><span class="keyword">} </span><span class="comment">//if<br />
<br />
// free memory<br />
</span><span class="keyword">unset( </span><span class="default">$string_before </span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
You may or should also put a log-message or the sending of an email into the if-condition in order to get informed, once, one of your regular-expressions does not have the effect you desired it to have.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83974""></a>
  <div class="note">
   <strong class="user">da_pimp2004_966 at hotmail dot com</strong>
   <a href="#83974" class="date">20-Jun-2008 11:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A simple BB like thing..
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">AddBB</span><span class="keyword">(</span><span class="default">$var</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$search </span><span class="keyword">= array(
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'/\[b\](.*?)\[\/b\]/is'</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'/\[i\](.*?)\[\/i\]/is'</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'/\[u\](.*?)\[\/u\]/is'</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'/\[img\](.*?)\[\/img\]/is'</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'/\[url\](.*?)\[\/url\]/is'</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'/\[url\=(.*?)\](.*?)\[\/url\]/is'
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$replace </span><span class="keyword">= array(
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'&lt;strong&gt;$1&lt;/strong&gt;'</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'&lt;em&gt;$1&lt;/em&gt;'</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'&lt;u&gt;$1&lt;/u&gt;'</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'&lt;img src="$1" /&gt;'</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'&lt;a href="$1"&gt;$1&lt;/a&gt;'</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'&lt;a href="$1"&gt;$2&lt;/a&gt;'
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$var </span><span class="keyword">= </span><span class="default">preg_replace </span><span class="keyword">(</span><span class="default">$search</span><span class="keyword">, </span><span class="default">$replace</span><span class="keyword">, </span><span class="default">$var</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$var</span><span class="keyword">;
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82574""></a>
  <div class="note">
   <strong class="user">Michael W</strong>
   <a href="#82574" class="date">16-Apr-2008 03:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For filename tidying I prefer to only ALLOW certain characters rather than converting particular ones that we want to exclude. To this end I use ...<br />
<br />
<span class="default">&lt;?php<br />
&nbsp; $allowed </span><span class="keyword">= </span><span class="string">"/[^a-z0-9\\040\\.\\-\\_\\\\]/i"</span><span class="keyword">;<br />
&nbsp; </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="default">$allowed</span><span class="keyword">,</span><span class="string">""</span><span class="keyword">,</span><span class="default">$str</span><span class="keyword">));<br />
</span><span class="default">?&gt;<br />
</span><br />
Allows letters a-z, digits, space (\\040), hyphen (\\-), underscore (\\_) and backslash (\\\\), everything else is removed from the string.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81486""></a>
  <div class="note">
   <strong class="user">php-comments-REMOVE dot ME at dotancohen dot com</strong>
   <a href="#81486" class="date">29-Feb-2008 12:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Below is a function for converting Hebrew final characters to their<br />
normal equivelants should they appear in the middle of a word.<br />
The /b argument does not treat Hebrew letters as part of a word,<br />
so I had to work around that limitation.<br />
<br />
<span class="default">&lt;?php<br />
<br />
$text</span><span class="keyword">=</span><span class="string">"????? ???????"</span><span class="keyword">;<br />
<br />
function </span><span class="default">hebrewNotWordEndSwitch </span><span class="keyword">(</span><span class="default">$from</span><span class="keyword">, </span><span class="default">$to</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">) {<br />
&nbsp;&nbsp; </span><span class="default">$text</span><span class="keyword">=<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/'</span><span class="keyword">.</span><span class="default">$from</span><span class="keyword">.</span><span class="string">'([?-?])/u'</span><span class="keyword">,</span><span class="string">'$2'</span><span class="keyword">.</span><span class="default">$to</span><span class="keyword">.</span><span class="string">'$1'</span><span class="keyword">,</span><span class="default">$text</span><span class="keyword">);<br />
&nbsp;&nbsp; return </span><span class="default">$text</span><span class="keyword">;<br />
}<br />
<br />
do {<br />
&nbsp;&nbsp; </span><span class="default">$text_before</span><span class="keyword">=</span><span class="default">$text</span><span class="keyword">;<br />
&nbsp;&nbsp; </span><span class="default">$text</span><span class="keyword">=</span><span class="default">hebrewNotWordEndSwitch</span><span class="keyword">(</span><span class="string">"?"</span><span class="keyword">,</span><span class="string">"?"</span><span class="keyword">,</span><span class="default">$text</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">$text</span><span class="keyword">=</span><span class="default">hebrewNotWordEndSwitch</span><span class="keyword">(</span><span class="string">"?"</span><span class="keyword">,</span><span class="string">"?"</span><span class="keyword">,</span><span class="default">$text</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">$text</span><span class="keyword">=</span><span class="default">hebrewNotWordEndSwitch</span><span class="keyword">(</span><span class="string">"?"</span><span class="keyword">,</span><span class="string">"?"</span><span class="keyword">,</span><span class="default">$text</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">$text</span><span class="keyword">=</span><span class="default">hebrewNotWordEndSwitch</span><span class="keyword">(</span><span class="string">"?"</span><span class="keyword">,</span><span class="string">"?"</span><span class="keyword">,</span><span class="default">$text</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">$text</span><span class="keyword">=</span><span class="default">hebrewNotWordEndSwitch</span><span class="keyword">(</span><span class="string">"?"</span><span class="keyword">,</span><span class="string">"?"</span><span class="keyword">,</span><span class="default">$text</span><span class="keyword">);<br />
}&nbsp;&nbsp; while ( </span><span class="default">$text_before</span><span class="keyword">!=</span><span class="default">$text </span><span class="keyword">);<br />
<br />
print </span><span class="default">$text</span><span class="keyword">; </span><span class="comment">// ????? ??????!<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
The do-while is necessary for multiple instances of letters, such<br />
as "????" which would start off as "????". Note that there's still the<br />
problem of acronyms with gershiim but that's not a difficult one<br />
to solve. The code is in use at <a href="http://gibberish.co.il which you can" rel="nofollow" target="_blank">http://gibberish.co.il which you can</a><br />
use to translate wrongly-encoded Hebrew, transliterize, and some<br />
other Hebrew-related functions.<br />
<br />
To ensure that there will be no regular characters at the end of a<br />
word, just convert all regular characters to their final forms, then<br />
run this function. Enjoy!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="79678""></a>
  <div class="note">
   <strong class="user">ulf dot reimers at tesa dot com</strong>
   <a href="#79678" class="date">07-Dec-2007 10:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hi,<br />
<br />
as I wasn't able to find another way to do this, I wrote a function converting any UTF-8 string into a correct NTFS filename (see <a href="http://en.wikipedia.org/wiki/Filename" rel="nofollow" target="_blank">http://en.wikipedia.org/wiki/Filename</a>).<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">strToNTFSFilename</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">)<br />
{<br />
&nbsp; </span><span class="default">$reserved </span><span class="keyword">= </span><span class="default">preg_quote</span><span class="keyword">(</span><span class="string">'\/:*?"&lt;&gt;'</span><span class="keyword">, </span><span class="string">'/'</span><span class="keyword">);<br />
&nbsp; return </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"/([\\x00-\\x1f</span><span class="keyword">{</span><span class="default">$forbidden</span><span class="keyword">}</span><span class="string">])/e"</span><span class="keyword">, </span><span class="string">"_"</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
It converts all control characters and filename characters which are reserved by Windows ('\/:*?"&lt;&gt;') into an underscore.<br />
This way you can safely create an NTFS filename out of any UTF-8 string.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="78597""></a>
  <div class="note">
   <strong class="user">mike dot hayward at mikeyskona dot co dot uk</strong>
   <a href="#78597" class="date">18-Oct-2007 08:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hi.
<br />
Not sure if this will be a great help to anyone out there, but thought i'd post just in case.
<br />
I was having an Issue with a project that relied on $_SERVER['REQUEST_URI']. Obviously this wasn't working on IIS.
<br />
(i am using mod_rewrite in apache to call up pages from a database and IIS doesn't set REQUEST_URI). So i knocked up this simple little preg_replace to use the query string set by IIS when redirecting to a PHP error page.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="comment">//My little IIS hack :)
<br />
</span><span class="keyword">if(!isset(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'REQUEST_URI'</span><span class="keyword">])){ 
<br />
&nbsp; </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'REQUEST_URI'</span><span class="keyword">] = </span><span class="default">preg_replace</span><span class="keyword">( </span><span class="string">'/404;([a-zA-Z]+:\/\/)(.*?)\//i'</span><span class="keyword">, </span><span class="string">"/" </span><span class="keyword">, </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'QUERY_STRING'</span><span class="keyword">] );
<br />
}
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Hope this helps someone else out there trying to do the same thing :)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77317""></a>
  <div class="note">
   <strong class="user">sternkinder at gmail dot com</strong>
   <a href="#77317" class="date">24-Aug-2007 03:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
From what I can see, the problem is, that if you go straight and substitute all 'A's wit 'T's you can't tell for sure which 'T's to substitute with 'A's afterwards. This can be for instance solved by simply replacing all 'A's by another character (for instance '_' or whatever you like), then replacing all 'T's by 'A's, and then replacing all '_'s (or whatever character you chose) by 'A's:
<br />

<br />
<span class="default">&lt;?php
<br />
$dna </span><span class="keyword">= </span><span class="string">"AGTCTGCCCTAG"</span><span class="keyword">;
<br />
echo </span><span class="default">str_replace</span><span class="keyword">(array(</span><span class="string">"A"</span><span class="keyword">,</span><span class="string">"G"</span><span class="keyword">,</span><span class="string">"C"</span><span class="keyword">,</span><span class="string">"T"</span><span class="keyword">,</span><span class="string">"_"</span><span class="keyword">,</span><span class="string">"-"</span><span class="keyword">), array(</span><span class="string">"_"</span><span class="keyword">,</span><span class="string">"-"</span><span class="keyword">,</span><span class="string">"G"</span><span class="keyword">,</span><span class="string">"A"</span><span class="keyword">,</span><span class="string">"T"</span><span class="keyword">,</span><span class="string">"C"</span><span class="keyword">), </span><span class="default">$dna</span><span class="keyword">); </span><span class="comment">//output will be TCAGACGGGATC
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Although I don't know how transliteration in perl works (though I remember that is kind of similar to the UNIX command "tr") I would suggest following function for "switching" single chars:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">switch_chars</span><span class="keyword">(</span><span class="default">$subject</span><span class="keyword">,</span><span class="default">$switch_table</span><span class="keyword">,</span><span class="default">$unused_char</span><span class="keyword">=</span><span class="string">"_"</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; foreach ( </span><span class="default">$switch_table </span><span class="keyword">as </span><span class="default">$_1 </span><span class="keyword">=&gt; </span><span class="default">$_2 </span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$subject </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="default">$_1</span><span class="keyword">,</span><span class="default">$unused_char</span><span class="keyword">,</span><span class="default">$subject</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$subject </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="default">$_2</span><span class="keyword">,</span><span class="default">$_1</span><span class="keyword">,</span><span class="default">$subject</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$subject </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="default">$unused_char</span><span class="keyword">,</span><span class="default">$_2</span><span class="keyword">,</span><span class="default">$subject</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$subject</span><span class="keyword">;
<br />
}
<br />

<br />
echo </span><span class="default">switch_chars</span><span class="keyword">(</span><span class="string">"AGTCTGCCCTAG"</span><span class="keyword">, array(</span><span class="string">"A"</span><span class="keyword">=&gt;</span><span class="string">"T"</span><span class="keyword">,</span><span class="string">"G"</span><span class="keyword">=&gt;</span><span class="string">"C"</span><span class="keyword">)); </span><span class="comment">//output will be TCAGACGGGATC
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77255""></a>
  <div class="note">
   <strong class="user">rob at ubrio dot us</strong>
   <a href="#77255" class="date">21-Aug-2007 01:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Also worth noting is that you can use array_keys()/array_values() with preg_replace like:
<br />

<br />
<span class="default">&lt;?php
<br />
$subs </span><span class="keyword">= array(
<br />
&nbsp; </span><span class="string">'/\[b\](.+)\[\/b\]/Ui' </span><span class="keyword">=&gt; </span><span class="string">'&lt;strong&gt;$1&lt;/strong&gt;'</span><span class="keyword">,
<br />
&nbsp; </span><span class="string">'/_(.+)_/Ui' </span><span class="keyword">=&gt; </span><span class="string">'&lt;em&gt;$1&lt;/em&gt;'
<br />
&nbsp; </span><span class="keyword">...
<br />
&nbsp; ...
<br />
);
<br />

<br />
</span><span class="default">$raw_text </span><span class="keyword">= </span><span class="string">'[b]this is bold[/b] and this is _italic!_'</span><span class="keyword">;
<br />

<br />
</span><span class="default">$bb_text </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="default">array_keys</span><span class="keyword">(</span><span class="default">$subs</span><span class="keyword">), </span><span class="default">array_values</span><span class="keyword">(</span><span class="default">$subs</span><span class="keyword">), </span><span class="default">$raw_text</span><span class="keyword">);
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74037""></a>
  <div class="note">
   <strong class="user">ismith at nojunk dot motorola dot com</strong>
   <a href="#74037" class="date">21-Mar-2007 09:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Be aware that when using the "/u" modifier, if your input text contains any bad UTF-8 code sequences, then preg_replace will return an empty string, regardless of whether there were any matches.<br />
<br />
This is due to the PCRE library returning an error code if the string contains bad UTF-8.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73063""></a>
  <div class="note">
   <strong class="user">dani dot church at gmail dot youshouldknowthisone</strong>
   <a href="#73063" class="date">07-Feb-2007 11:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that it is in most cases much more efficient to use preg_replace_callback(), with a named function or an anonymous function created with create_function(), instead of the /e modifier.&nbsp; When preg_replace() is called with the /e modifier, the interpreter must parse the replacement string into PHP code once for every replacement made, while preg_replace_callback() uses a function that only needs to be parsed once.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69478""></a>
  <div class="note">
   <strong class="user">Alexey Lebedev</strong>
   <a href="#69478" class="date">07-Sep-2006 02:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Wasted several hours because of this:
<br />

<br />
<span class="default">&lt;?php
<br />
$str</span><span class="keyword">=</span><span class="string">'It&amp;#039;s a string with HTML entities'</span><span class="keyword">;
<br />
</span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'~&amp;#(\d+);~e'</span><span class="keyword">, </span><span class="string">'code2utf($1)'</span><span class="keyword">, </span><span class="default">$str</span><span class="keyword">);
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
This code must convert numeric html entities to utf8. And it does with a little exception. It treats wrong codes starting with &amp;#0
<br />

<br />
The reason is that code2utf will be called with leading zero, exactly what the pattern matches - code2utf(039).
<br />
And it does matter! PHP treats 039 as octal number.
<br />
Try <span class="default">&lt;?php </span><span class="keyword">print(</span><span class="default">011</span><span class="keyword">); </span><span class="default">?&gt;
<br />
</span>
<br />
Solution:
<br />
<span class="default">&lt;?php preg_replace</span><span class="keyword">(</span><span class="string">'~&amp;#0*(\d+);~e'</span><span class="keyword">, </span><span class="string">'code2utf($1)'</span><span class="keyword">, </span><span class="default">$str</span><span class="keyword">); </span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="39713""></a>
  <div class="note">
   <strong class="user">steven -a-t- acko dot net</strong>
   <a href="#39713" class="date">08-Feb-2004 09:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
People using the /e modifier with preg_replace should be aware of the following weird behaviour. It is not a bug per se, but can cause bugs if you don't know it's there.<br />
<br />
The example in the docs for /e suffers from this mistake in fact.<br />
<br />
With /e, the replacement string is a PHP expression. So when you use a backreference in the replacement expression, you need to put the backreference inside quotes, or otherwise it would be interpreted as PHP code. Like the example from the manual for preg_replace:<br />
<br />
preg_replace("/(&lt;\/?)(\w+)([^&gt;]*&gt;)/e",<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "'\\1'.strtoupper('\\2').'\\3'",<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $html_body);<br />
<br />
To make this easier, the data in a backreference with /e is run through addslashes() before being inserted in your replacement expression. So if you have the string<br />
<br />
&nbsp;He said: "You're here"<br />
<br />
It would become:<br />
<br />
&nbsp;He said: \"You\'re here\"<br />
<br />
...and be inserted into the expression.<br />
However, if you put this inside a set of single quotes, PHP will not strip away all the slashes correctly! Try this:<br />
<br />
&nbsp;print ' He said: \"You\'re here\" ';<br />
&nbsp;Output: He said: \"You're here\"<br />
<br />
This is because the sequence \" inside single quotes is not recognized as anything special, and it is output literally.<br />
<br />
Using double-quotes to surround the string/backreference will not help either, because inside double-quotes, the sequence \' is not recognized and also output literally. And in fact, if you have any dollar signs in your data, they would be interpreted as PHP variables. So double-quotes are not an option.<br />
<br />
The 'solution' is to manually fix it in your expression. It is easiest to use a separate processing function, and do the replacing there (i.e. use "my_processing_function('\\1')" or something similar as replacement expression, and do the fixing in that function).<br />
<br />
If you surrounded your backreference by single-quotes, the double-quotes are corrupt:<br />
$text = str_replace('\"', '"', $text);<br />
<br />
People using preg_replace with /e should at least be aware of this.<br />
<br />
I'm not sure how it would be best fixed in preg_replace. Because double-quotes are a really bad idea anyway (due to the variable expansion), I would suggest that preg_replace's auto-escaping is modified to suit the placement of backreferences inside single-quotes (which seemed to be the intention from the start, but was incorrectly applied).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
