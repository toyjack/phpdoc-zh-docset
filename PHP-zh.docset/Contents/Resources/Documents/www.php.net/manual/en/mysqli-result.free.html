<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>Frees the memory associated with a result</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="mysqli-result.field-seek.html">? mysqli_result::field_seek</a></li>
      <li style="float: right;"><a href="mysqli-result.getiterator.html">mysqli_result::getIterator ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="class.mysqli-result.html">mysqli_result</a></li>
    <li>Frees the memory associated with a result</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="mysqli-result.free" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">mysqli_result::free</h1>
  <h1 class="refname">mysqli_result::close</h1>
  <h1 class="refname">mysqli_result::free_result</h1>
  <h1 class="refname">mysqli_free_result</h1>
  <p class="verinfo">(PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">mysqli_result::free</span> -- <span class="refname">mysqli_result::close</span> -- <span class="refname">mysqli_result::free_result</span> -- <span class="refname">mysqli_free_result</span> &mdash; <span class="dc-title">Frees the memory associated with a result</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-mysqli-result.free-description">
  <h3 class="title">说明</h3>
  <p class="para">面向对象风格</p>
  <div class="methodsynopsis dc-description">
   <span class="modifier">public</span> <span class="methodname"><strong>mysqli_result::free</strong></span>(): <span class="type"><span class="type void">void</span></span></div>

  <div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname"><strong>mysqli_result::close</strong></span>(): <span class="type"><span class="type void">void</span></span></div>

  <div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname"><strong>mysqli_result::free_result</strong></span>(): <span class="type"><span class="type void">void</span></span></div>

  <p class="para rdfs-comment">过程化风格</p>
  <div class="methodsynopsis dc-description"><span class="methodname"><strong>mysqli_free_result</strong></span>(<span class="methodparam"><span class="type"><a href="class.mysqli-result.html" class="type mysqli_result">mysqli_result</a></span> <code class="parameter">$result</code></span>): <span class="type"><span class="type void">void</span></span></div>

  <p class="para rdfs-comment">
   Frees the memory associated with the result.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-mysqli-result.free-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>
    <dt>

<code class="parameter">result</code></dt>
<dd>
<p class="para">仅以过程化样式：由
<span class="function"><a href="mysqli.query.html" class="function">mysqli_query()</a></span>、<span class="function"><a href="mysqli.store-result.html" class="function">mysqli_store_result()</a></span>、
<span class="function"><a href="mysqli.use-result.html" class="function">mysqli_use_result()</a></span>、<span class="function"><a href="mysqli-stmt.get-result.html" class="function">mysqli_stmt_get_result()</a></span> 返回的 <span class="classname"><a href="class.mysqli-result.html" class="classname">mysqli_result</a></span> 对象。</p></dd>

   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-mysqli-result.free-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   没有返回值。
  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-mysqli-result.free-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="mysqli.query.html" class="function" rel="rdfs-seeAlso">mysqli_query()</a> - 对数据库执行一次查询</span></li>
    <li class="member"><span class="function"><a href="mysqli-stmt.get-result.html" class="function" rel="rdfs-seeAlso">mysqli_stmt_get_result()</a> - Gets a result set from a prepared statement as a mysqli_result object</span></li>
    <li class="member"><span class="function"><a href="mysqli.store-result.html" class="function" rel="rdfs-seeAlso">mysqli_store_result()</a> - 转移上一次查询返回的结果集</span></li>
    <li class="member"><span class="function"><a href="mysqli.use-result.html" class="function" rel="rdfs-seeAlso">mysqli_use_result()</a> - Initiate a result set retrieval</span></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="126623""></a>
  <div class="note">
   <strong class="user">polygon dot co dot in at gmail dot com</strong>
   <a href="#126623" class="date">19-Nov-2021 10:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
We should free the mysql results using mysqli_free_result respectively or else this will consume your server RAM resource.<br />
<br />
This is demonstrated as below<br />
<br />
<span class="default">&lt;?php<br />
<br />
$link </span><span class="keyword">= </span><span class="default">mysqli_connect</span><span class="keyword">(</span><span class="string">'Hostname'</span><span class="keyword">,</span><span class="string">'Username'</span><span class="keyword">,</span><span class="string">'Password'</span><span class="keyword">,</span><span class="string">'Database'</span><span class="keyword">);<br />
<br />
echo </span><span class="string">'&lt;br/&gt;Memory Usage Before Query = '</span><span class="keyword">.</span><span class="default">memory_get_usage</span><span class="keyword">(</span><span class="default">false</span><span class="keyword">); </span><span class="comment">// 449464 bytes<br />
<br />
</span><span class="default">$resultResource </span><span class="keyword">= </span><span class="default">mysqli_query</span><span class="keyword">(</span><span class="default">$link</span><span class="keyword">, </span><span class="string">'SELECT * FROM test'</span><span class="keyword">);<br />
<br />
echo </span><span class="string">'&lt;br/&gt;Memory Usage after Query = '</span><span class="keyword">.</span><span class="default">memory_get_usage</span><span class="keyword">(</span><span class="default">false</span><span class="keyword">); </span><span class="comment">// 466528 bytes<br />
<br />
</span><span class="default">$result </span><span class="keyword">= array();<br />
while (</span><span class="default">$result</span><span class="keyword">[] = </span><span class="default">mysqli_fetch_assoc</span><span class="keyword">(</span><span class="default">$resultResource</span><span class="keyword">)) {}<br />
<br />
echo </span><span class="string">'&lt;br/&gt;&lt;br/&gt;Memory Usage Before Free Result = '</span><span class="keyword">.</span><span class="default">memory_get_usage</span><span class="keyword">(</span><span class="default">false</span><span class="keyword">); </span><span class="comment">// 474208 bytes<br />
<br />
</span><span class="default">mysqli_free_result</span><span class="keyword">(</span><span class="default">$resultResource</span><span class="keyword">);<br />
<br />
echo </span><span class="string">'&lt;br/&gt;Memory Usage After Free Result = '</span><span class="keyword">.</span><span class="default">memory_get_usage</span><span class="keyword">(</span><span class="default">false</span><span class="keyword">); </span><span class="comment">// 457336 bytes<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Output below.<br />
<br />
Memory Usage Before Query = 449464<br />
Memory Usage after Query = 466528<br />
<br />
Memory Usage Before Free Result = 474208<br />
Memory Usage After Free Result = 457336<br />
<br />
So, One can observer there is memory usage after the query is executed. The results are returned by DB server to the web server instantaniously once the query execution is over. The results present on web server are then processed for fetching from the resource link on web server.<br />
<br />
Also this is observed that there is lesser memory usage after using mysqli_free_result because the resources stored on web server for respective query are freed by providing respective resource link.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="123708""></a>
  <div class="note">
   <strong class="user">jack_action100 at hotmail dot example dot com</strong>
   <a href="#123708" class="date">20-Mar-2019 12:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are STILL getting this error, even after freeing your results:<br />
Internal SQL Bug: 2014, Commands out of sync; you can't run this command now<br />
<br />
You may have a stored procedure in your query.&nbsp;&nbsp; A procedure can return more than one result set, and it will always return one extra empty result set that carries some meta information on the procedure call itself, especially error information. ( source:&nbsp; https://bugs.mysql.com/bug.php?id=71044 )<br />
<br />
While calling single procedures, with one SELECT in them, using mysqli-&gt;query("CALL `stored_procedure`();"), I had to do the following to make it work between two calls:<br />
<br />
<span class="default">&lt;?php<br />
$result</span><span class="keyword">-&gt;</span><span class="default">free</span><span class="keyword">();<br />
</span><span class="default">$mysqli</span><span class="keyword">-&gt;</span><span class="default">next_result</span><span class="keyword">();<br />
</span><span class="default">?&gt;<br />
</span><br />
It has no negative impact if you are not calling a stored procedure.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="95357""></a>
  <div class="note">
   <strong class="user">Vector at ionisis dot com</strong>
   <a href="#95357" class="date">28-Dec-2009 05:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are getting this error:
<br />
Internal SQL Bug: 2014, Commands out of sync; you can't run this command now
<br />

<br />
Then you never called mysqli_result::free(), mysqli_result::free_result(), mysqli_result::close(), or mysqli_free_result() in your script, and must call it before executing another stored procedure.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="94137""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#94137" class="date">18-Oct-2009 03:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Freeing the memory associated with a result means that the references returned by mysqli_fetch_object (or equivalent) are cleared. Thus if you should pass an object pointing to a database row _by reference_, every call of mysqli_free_result will discard the referenced data.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
