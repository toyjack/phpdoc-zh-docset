<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>发送邮件</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.ezmlm-hash.html">? ezmlm_hash</a></li>
      <li style="float: right;"><a href="book.mailparse.html">Mailparse ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.mail.html">Mail 函数</a></li>
    <li>发送邮件</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.mail" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">mail</h1>
  <p class="verinfo">(PHP 4, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">mail</span> &mdash; <span class="dc-title">发送邮件</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-function.mail-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>mail</strong></span>(<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">string</span> <code class="parameter">$to</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">string</span> <code class="parameter">$subject</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">string</span> <code class="parameter">$message</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">string</span> <code class="parameter">$additional_headers</code><span class="initializer"> = ?</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">string</span> <code class="parameter">$additional_parameters</code><span class="initializer"> = ?</span></span><br>): <span class="type">bool</span></div>

  <p class="para rdfs-comment">
   发送一封电子邮件。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.mail-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>
    
     <dt>
<code class="parameter">to</code></dt>

     <dd>

      <p class="para">
       电子邮件收件人，或收件人列表。
      </p>
      <p class="para">
       本字符串的格式必须符合
       <a href="http://www.faqs.org/rfcs/rfc2822" class="link external" title="Link : http://www.faqs.org/rfcs/rfc2822">&raquo;&nbsp;RFC 2822</a>。例如：
       <ul class="simplelist">
        <li class="member">user@example.com</li>
        <li class="member">user@example.com, anotheruser@example.com</li>
        <li class="member">User &lt;user@example.com&gt;</li>
        <li class="member">User &lt;user@example.com&gt;, Another User &lt;anotheruser@example.com&gt;</li>
       </ul>
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">subject</code></dt>

     <dd>

      <p class="para">
       电子邮件的主题。
      </p>
      <div class="caution"><strong class="caution">Caution</strong>
       <p class="para">
        本项不能包含任何换行符，否则邮件可能无法正确发送。
       </p>
      </div>
     </dd>

    
    
     <dt>
<code class="parameter">message</code></dt>

     <dd>

      <p class="para">
       所要发送的消息。
      </p>
      <p class="para">
       行之间必须以一个 LF（\n）分隔。每行不能超过 70 个字符。
      </p>
      <div class="caution"><strong class="caution">Caution</strong>
       <p class="para">
        （Windows 下）当 PHP 直接连接到 SMTP 服务器时，如果在一行开头发现一个句号，则会被删掉。要避免此问题，将单个句号替换成两个句号。
        <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$text&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">str_replace</span><span style="color: #007700">(</span><span style="color: #DD0000">"\n."</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"\n.."</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$text</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
        </div>

       </p>
      </div>
     </dd>

    
    
     <dt>
<code class="parameter">additional_headers</code>（可选项）</dt>

     <dd>

      <p class="para">
       String to be inserted at the end of the email header.
      </p>
      <p class="para">
       This is typically used to add extra headers (From, Cc, and Bcc).
       Multiple extra headers should be separated with a CRLF (\r\n).
      </p>
      <blockquote class="note"><p><strong class="note">Note</strong>: 
       <p class="para">
        When sending mail, the mail <em class="emphasis">must</em> contain
        a <code class="literal">From</code> header. This can be set with the 
        <code class="parameter">additional_headers</code> parameter, or a default
        can be set in <var class="filename">php.ini</var>.
       </p>
       <p class="para">
        Failing to do this will result in an error
        message similar to <code class="literal">Warning: mail(): &quot;sendmail_from&quot; not
        set in php.ini or custom &quot;From:&quot; header missing</code>.
       </p>
      </p></blockquote>
      <blockquote class="note"><p><strong class="note">Note</strong>: 
       <p class="para">
        If messages are not received, try using a LF (\n) only.
        Some poor quality Unix mail transfer agents replace LF by CRLF
        automatically (which leads to doubling CR if CRLF is used).
        This should be a last resort, as it does not comply with
        <a href="http://www.faqs.org/rfcs/rfc2822" class="link external" title="Link : http://www.faqs.org/rfcs/rfc2822">&raquo;&nbsp;RFC 2822</a>.
       </p>
      </p></blockquote>
     </dd>

    
    
     <dt>
<code class="parameter">additional_parameters</code> (optional)</dt>

     <dd>

      <p class="para">
       The <code class="parameter">additional_parameters</code> parameter
       can be used to pass an additional parameter to the program configured
       to use when sending mail using the <code class="literal">sendmail_path</code>
       configuration setting. For example, this can be used to set the
       envelope sender address when using sendmail with the
       <code class="literal">-f</code> sendmail option.
      </p>
      <p class="para">
       The user that the webserver runs as should be added as a trusted user to the
       sendmail configuration to prevent a &#039;X-Warning&#039; header from being added
       to the message when the envelope sender (-f) is set using this method.
       For sendmail users, this file is <var class="filename">/etc/mail/trusted-users</var>.
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.mail-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   Returns <strong><code>true</code></strong> if the mail was successfully accepted for delivery, <strong><code>false</code></strong> otherwise.
  </p>
  <p class="para">
   It is important to note that just because the mail was accepted for delivery,
   it does NOT mean the mail will actually reach the intended destination.
  </p>
 </div>


 

 <div class="refsect1 changelog" id="refsect1-function.mail-changelog">
  <h3 class="title">更新日志</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead>
      <tr>
       <th>版本</th>
       <th>说明</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
       <td>7.2.0</td>
       <td>
        现在 <code class="parameter">additional_headers</code> 参数开始支持 <span class="type">array</span>。
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.mail-examples">
  <h3 class="title">范例</h3>
  <p class="para">
   <div class="example" id="example-2940">
    <p><strong>Example #1 Sending mail.</strong></p>
    <div class="example-contents"><p>
     Using <span class="function"><strong>mail()</strong></span> to send a simple email:
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;The&nbsp;message<br /></span><span style="color: #0000BB">$message&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"Line&nbsp;1\nLine&nbsp;2\nLine&nbsp;3"</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//&nbsp;In&nbsp;case&nbsp;any&nbsp;of&nbsp;our&nbsp;lines&nbsp;are&nbsp;larger&nbsp;than&nbsp;70&nbsp;characters,&nbsp;we&nbsp;should&nbsp;use&nbsp;wordwrap()<br /></span><span style="color: #0000BB">$message&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">wordwrap</span><span style="color: #007700">(</span><span style="color: #0000BB">$message</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">70</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;Send<br /></span><span style="color: #0000BB">mail</span><span style="color: #007700">(</span><span style="color: #DD0000">'caffinated@example.com'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'My&nbsp;Subject'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$message</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
   <div class="example" id="example-2941">
    <p><strong>Example #2 Sending mail with extra headers.</strong></p>
    <div class="example-contents"><p>
     The addition of basic headers, telling the MUA
     the From and Reply-To addresses:
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$to&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'nobody@example.com'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$subject&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'the&nbsp;subject'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$message&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'hello'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$headers&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'From:&nbsp;webmaster@example.com'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"\r\n"&nbsp;</span><span style="color: #007700">.<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'Reply-To:&nbsp;webmaster@example.com'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"\r\n"&nbsp;</span><span style="color: #007700">.<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'X-Mailer:&nbsp;PHP/'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">phpversion</span><span style="color: #007700">();<br /><br /></span><span style="color: #0000BB">mail</span><span style="color: #007700">(</span><span style="color: #0000BB">$to</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$subject</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$message</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$headers</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
   <div class="example" id="example-2942">
    <p><strong>Example #3 Sending mail with an additional command line parameter.</strong></p>
    <div class="example-contents"><p>
     The <code class="parameter">additional_parameters</code> parameter
     can be used to pass an additional parameter to the program configured
     to use when sending mail using the <code class="literal">sendmail_path</code>.
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />mail</span><span style="color: #007700">(</span><span style="color: #DD0000">'nobody@example.com'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'the&nbsp;subject'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'the&nbsp;message'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'-fwebmaster@example.com'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
   <div class="example" id="example-2943">
    <p><strong>Example #4 Sending HTML email</strong></p>
    <div class="example-contents"><p>
     It is also possible to send HTML email with <span class="function"><strong>mail()</strong></span>.
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;multiple&nbsp;recipients<br /></span><span style="color: #0000BB">$to&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'aidan@example.com'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">',&nbsp;'</span><span style="color: #007700">;&nbsp;</span><span style="color: #FF8000">//&nbsp;note&nbsp;the&nbsp;comma<br /></span><span style="color: #0000BB">$to&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #DD0000">'wez@example.com'</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//&nbsp;subject<br /></span><span style="color: #0000BB">$subject&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'Birthday&nbsp;Reminders&nbsp;for&nbsp;August'</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//&nbsp;message<br /></span><span style="color: #0000BB">$message&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'<br />&lt;html&gt;<br />&lt;head&gt;<br />&nbsp;&nbsp;&lt;title&gt;Birthday&nbsp;Reminders&nbsp;for&nbsp;August&lt;/title&gt;<br />&lt;/head&gt;<br />&lt;body&gt;<br />&nbsp;&nbsp;&lt;p&gt;Here&nbsp;are&nbsp;the&nbsp;birthdays&nbsp;upcoming&nbsp;in&nbsp;August!&lt;/p&gt;<br />&nbsp;&nbsp;&lt;table&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;th&gt;Person&lt;/th&gt;&lt;th&gt;Day&lt;/th&gt;&lt;th&gt;Month&lt;/th&gt;&lt;th&gt;Year&lt;/th&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;Joe&lt;/td&gt;&lt;td&gt;3rd&lt;/td&gt;&lt;td&gt;August&lt;/td&gt;&lt;td&gt;1970&lt;/td&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;Sally&lt;/td&gt;&lt;td&gt;17th&lt;/td&gt;&lt;td&gt;August&lt;/td&gt;&lt;td&gt;1973&lt;/td&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;<br />&nbsp;&nbsp;&lt;/table&gt;<br />&lt;/body&gt;<br />&lt;/html&gt;<br />'</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//&nbsp;To&nbsp;send&nbsp;HTML&nbsp;mail,&nbsp;the&nbsp;Content-type&nbsp;header&nbsp;must&nbsp;be&nbsp;set<br /></span><span style="color: #0000BB">$headers&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'MIME-Version:&nbsp;1.0'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"\r\n"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$headers&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #DD0000">'Content-type:&nbsp;text/html;&nbsp;charset=iso-8859-1'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"\r\n"</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//&nbsp;Additional&nbsp;headers<br /></span><span style="color: #0000BB">$headers&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #DD0000">'To:&nbsp;Mary&nbsp;&lt;mary@example.com&gt;,&nbsp;Kelly&nbsp;&lt;kelly@example.com&gt;'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"\r\n"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$headers&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #DD0000">'From:&nbsp;Birthday&nbsp;Reminder&nbsp;&lt;birthday@example.com&gt;'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"\r\n"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$headers&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #DD0000">'Cc:&nbsp;birthdayarchive@example.com'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"\r\n"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$headers&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #DD0000">'Bcc:&nbsp;birthdaycheck@example.com'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"\r\n"</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//&nbsp;Mail&nbsp;it<br /></span><span style="color: #0000BB">mail</span><span style="color: #007700">(</span><span style="color: #0000BB">$to</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$subject</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$message</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$headers</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>
     <blockquote class="note"><p><strong class="note">Note</strong>: 
      <p class="para">
       If intending to send HTML or otherwise Complex mails, it is recommended
       to use the PEAR package <a href="https://pear.php.net/package/Mail" class="link external" title="Link : https://pear.php.net/package/Mail">&raquo;&nbsp;PEAR::Mail</a>.
      </p>
     </p></blockquote>
    </p></div>
   </div>
  </p>
 </div>


 <div class="refsect1 notes" id="refsect1-function.mail-notes">    
  <h3 class="title">注释</h3>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    The Windows implementation of <span class="function"><strong>mail()</strong></span> differs in many
    ways from the Unix implementation. First, it doesn&#039;t use a local binary
    for composing messages but only operates on direct sockets which means a
    <code class="literal">MTA</code> is needed listening on a network socket (which
    can either on the localhost or a remote machine).
   </p>
   <p class="para">
    Second, the custom headers like
    <code class="literal">From:</code>,
    <code class="literal">Cc:</code>,
    <code class="literal">Bcc:</code> and
    <code class="literal">Date:</code> are
    <em class="emphasis">not</em> interpreted by the
    <code class="literal">MTA</code> in the first place, but are parsed by PHP.
   </p>
   <p class="para">
    As such, the <code class="parameter">to</code> parameter should not be an address
    in the form of &quot;Something &lt;someone@example.com&gt;&quot;. The
    mail command may not parse this properly while talking with 
    the MTA.
   </p>
  </p></blockquote>
  
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    It is worth noting that the <span class="function"><strong>mail()</strong></span> function is not
    suitable for larger volumes of email in a loop. This function opens
    and closes an SMTP socket for each email, which is not very efficient.
   </p>
   <p class="para">
    For the sending of large amounts of email, see the
    <a href="https://pear.php.net/package/Mail" class="link external" title="Link : https://pear.php.net/package/Mail">&raquo;&nbsp;PEAR::Mail</a>, and
    <a href="https://pear.php.net/package/Mail_Queue" class="link external" title="Link : https://pear.php.net/package/Mail_Queue">&raquo;&nbsp;PEAR::Mail_Queue</a> packages.
   </p>
  </p></blockquote>

  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    The following RFCs may be useful:
    <a href="http://www.faqs.org/rfcs/rfc1896" class="link external" title="Link : http://www.faqs.org/rfcs/rfc1896">&raquo;&nbsp;RFC 1896</a>,
    <a href="http://www.faqs.org/rfcs/rfc2045" class="link external" title="Link : http://www.faqs.org/rfcs/rfc2045">&raquo;&nbsp;RFC 2045</a>,
    <a href="http://www.faqs.org/rfcs/rfc2046" class="link external" title="Link : http://www.faqs.org/rfcs/rfc2046">&raquo;&nbsp;RFC 2046</a>,
    <a href="http://www.faqs.org/rfcs/rfc2047" class="link external" title="Link : http://www.faqs.org/rfcs/rfc2047">&raquo;&nbsp;RFC 2047</a>,
    <a href="http://www.faqs.org/rfcs/rfc2048" class="link external" title="Link : http://www.faqs.org/rfcs/rfc2048">&raquo;&nbsp;RFC 2048</a>,
    <a href="http://www.faqs.org/rfcs/rfc2049" class="link external" title="Link : http://www.faqs.org/rfcs/rfc2049">&raquo;&nbsp;RFC 2049</a>, and
    <a href="http://www.faqs.org/rfcs/rfc2822" class="link external" title="Link : http://www.faqs.org/rfcs/rfc2822">&raquo;&nbsp;RFC 2822</a>.
   </p>
  </p></blockquote>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.mail-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.imap-mail.html" class="function" rel="rdfs-seeAlso">imap_mail()</a> - Send an email message</span></li>
    <li class="member"><a href="https://pear.php.net/package/Mail" class="link external" title="Link : https://pear.php.net/package/Mail">&raquo;&nbsp;PEAR::Mail</a></li>
    <li class="member"><a href="https://pear.php.net/package/Mail_Mime" class="link external" title="Link : https://pear.php.net/package/Mail_Mime">&raquo;&nbsp;PEAR::Mail_Mime</a></li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="126740""></a>
  <div class="note">
   <strong class="user">mycplus at NOSPAM dot gmail dot com</strong>
   <a href="#126740" class="date">02-Jan-2022 08:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Throw the exception if the message was not delivered. It allows you to distinguish and route the error messages to a specific class for handling.<br />
<br />
<span class="default">&lt;?php <br />
</span><span class="keyword">function </span><span class="default">SendEmail</span><span class="keyword">(</span><span class="default">$to</span><span class="keyword">, </span><span class="default">$subject</span><span class="keyword">, </span><span class="default">$message</span><span class="keyword">, </span><span class="default">$headers</span><span class="keyword">, </span><span class="default">$params </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if (!@</span><span class="default">mail</span><span class="keyword">(</span><span class="default">$to</span><span class="keyword">, </span><span class="default">$subject</span><span class="keyword">, </span><span class="default">$message</span><span class="keyword">, </span><span class="default">$headers</span><span class="keyword">, </span><span class="default">$params</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$error </span><span class="keyword">= </span><span class="default">error_get_last</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$msg </span><span class="keyword">= </span><span class="string">'Could not send email: ' </span><span class="keyword">. (isset(</span><span class="default">$error</span><span class="keyword">[</span><span class="string">'message'</span><span class="keyword">]) ? </span><span class="default">$error</span><span class="keyword">[</span><span class="string">'message'</span><span class="keyword">] : </span><span class="string">'unknown'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; throw new </span><span class="default">SocketException</span><span class="keyword">(</span><span class="default">$msg</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="126334""></a>
  <div class="note">
   <strong class="user">atesin () gmial ! com</strong>
   <a href="#126334" class="date">12-Aug-2021 08:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
HOW PHP MAIL() WORKS INTERNALLY, more or less, according some tests i did<br />
<br />
imagine php is running with uid 33 when reaches a mail() function like this<br />
<br />
---- /my/htdocs/mailer-script.php line 69 ----<br />
$was_sent = mail(<br />
&nbsp; 'Alice &lt;alice@wonder.land&gt;, white-rabbit@endless.cave',<br />
&nbsp; 'Invitation',<br />
&nbsp; "Hi, you are cordially invited to drink a cup of tea at my house\ntomorrow at sunset",<br />
&nbsp; "Some-Header: foo\r\nOther-Header: bar", // can also be an associative array of 'Header' =&gt; 'Value'<br />
&nbsp; 'param1 param2');<br />
----<br />
<br />
then look for ini options like this (all optional, on any operating system)<br />
<br />
---- ini options ----<br />
; path to mail sender command + arguments, if omitted will defaults to NULL<br />
sendmail_path = '/bin/sendmail-esque arg1 arg2'<br />
; the From header, can be also set in sendmail but make sure it SENDS ONE<br />
sendmail_from = 'Mad Hatter &lt;hatter@house.forest&gt;'<br />
; recommended to not being blind, look at file permissions<br />
mail.log = '/var/log/php/mail.log'<br />
; adds an originating script header to send php mail internals (security sensitive)<br />
mail.add_x_header = on<br />
; outgoing mail server address, if omitted will defaults to "localhost"<br />
;SMTP = 'localhost'<br />
; server tcp port, if omitted will defaults to port 25<br />
;smtp_port = 25<br />
----<br />
<br />
then craft a message like this (please avoid duplicated headers)<br />
<br />
---- mail message ----<br />
From: Mad Hatter &lt;hatter@house.forest&gt;<br />
To: Alice &lt;alice@wonder.land&gt;, white-rabbit@endless.cave<br />
Subject: Invitation<br />
Some-Header: foo<br />
Other-Header: bar<br />
X-PHP-Originating-Script: 33:mailer-script.php<br />
<br />
Hi, you are cordially invited to drink a cup of tea at my house<br />
tomorrow at sunset<br />
----<br />
<br />
then APPEND this log line<br />
<br />
---- /var/log/php/mail.log ----<br />
[&lt;date&gt; &lt;time&gt; &lt;zone&gt;] mail() on [/my/htdocs/mailer-script.php:69]: &lt;all headers joined...&gt;<br />
----<br />
<br />
THEN IF (sendmail_path is not empty, AND file is found, AND has +rx permissions):<br />
<br />
- craft and run this shell command<br />
<br />
---- shell ----<br />
/bin/sendmail-esque arg1 arg2 param1 param2<br />
----<br />
<br />
- send the crafted message to its standard input<br />
- wait the program to exit<br />
- pass last exit code to mail() return<br />
<br />
OR ELSE (i.e. sendmail bin not run) (not sure about these):<br />
<br />
- try to internally open an smtp connection (with fsockopen()?)<br />
- send the message directly and wait for connection to close<br />
- pass last socket status to mail() return</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="125559""></a>
  <div class="note">
   <strong class="user">marcrbarker at NOSPAMgmail dot com</strong>
   <a href="#125559" class="date">02-Dec-2020 12:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
DKIM signature can break by trying to add &lt;HTML tag&gt; text effects where plain text is expected:<br />
<br />
.<br />
.<br />
.<br />
$headers[] = 'MIME-Version: 1.0';<br />
$headers[] = 'Content-Type: text/html; utf-8';<br />
$headers[] = 'Content-Transfer-Encoding: quoted-printable';<br />
<br />
// *** This will break DKIM ***<br />
$message = '&lt;span style="color:green;font-size:24px;"&gt;ThisIsColored&lt;/span&gt;'<br />
// *** This had broke DKIM ***<br />
<br />
mail($email, $subject, $message, implode("\r\n", $headers));<br />
.<br />
.<br />
.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="125498""></a>
  <div class="note">
   <strong class="user">John dot php at yaph dot org dot uk</strong>
   <a href="#125498" class="date">07-Nov-2020 07:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I found I needed to use the additional parameter -f$envelope_sender to send subscribe messages to my email list manager (Enemies of Carlotta, YMMV). Simply setting From: email@address.tld in additional headers wasn't sufficient.<br />
<br />
So to subscribe to mylist@example.com via a PHP script I call<br />
mail("mylist-subscribe@example.com", $emailSubject, $body, '', "-f$email_to_subscribe");</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="125168""></a>
  <div class="note">
   <strong class="user">pangz dot lab at gmail dot com</strong>
   <a href="#125168" class="date">06-Jul-2020 08:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
* Sending email with attachment<br />
<br />
function sendMail(<br />
&nbsp;&nbsp;&nbsp; string $fileAttachment,<br />
&nbsp;&nbsp;&nbsp; string $mailMessage = MAIL_CONF["mailMessage"],<br />
&nbsp;&nbsp;&nbsp; string $subject&nbsp; &nbsp;&nbsp; = MAIL_CONF["subject"],<br />
&nbsp;&nbsp;&nbsp; string $toAddress&nbsp;&nbsp; = MAIL_CONF["toAddress"],<br />
&nbsp;&nbsp;&nbsp; string $fromMail&nbsp; &nbsp; = MAIL_CONF["fromMail"]<br />
): bool {<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; $fileAttachment = trim($fileAttachment);<br />
&nbsp;&nbsp;&nbsp; $from&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; = $fromMail;<br />
&nbsp;&nbsp;&nbsp; $pathInfo&nbsp; &nbsp; &nbsp;&nbsp; = pathinfo($fileAttachment);<br />
&nbsp;&nbsp;&nbsp; $attchmentName&nbsp; = "attachment_".date("YmdHms").(<br />
&nbsp;&nbsp;&nbsp; (isset($pathInfo['extension']))? ".".$pathInfo['extension'] : ""<br />
&nbsp;&nbsp;&nbsp; );<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; $attachment&nbsp; &nbsp; = chunk_split(base64_encode(file_get_contents($fileAttachment)));<br />
&nbsp;&nbsp;&nbsp; $boundary&nbsp; &nbsp; &nbsp; = "PHP-mixed-".md5(time());<br />
&nbsp;&nbsp;&nbsp; $boundWithPre&nbsp; = "\n--".$boundary;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; $headers&nbsp;&nbsp; = "From: $from";<br />
&nbsp;&nbsp;&nbsp; $headers&nbsp; .= "\nReply-To: $from";<br />
&nbsp;&nbsp;&nbsp; $headers&nbsp; .= "\nContent-Type: multipart/mixed; boundary=\"".$boundary."\"";<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; $message&nbsp;&nbsp; = $boundWithPre;<br />
&nbsp;&nbsp;&nbsp; $message&nbsp; .= "\n Content-Type: text/plain; CHARSET=gb2312\n";<br />
&nbsp;&nbsp;&nbsp; $message&nbsp; .= "\n $mailMessage";<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; $message .= $boundWithPre;<br />
&nbsp;&nbsp;&nbsp; $message .= "\nContent-Type: application/octet-stream; name=\"".$attchmentName."\"";<br />
&nbsp;&nbsp;&nbsp; $message .= "\nContent-Transfer-Encoding: base64\n";<br />
&nbsp;&nbsp;&nbsp; $message .= "\nContent-Disposition: attachment\n";<br />
&nbsp;&nbsp;&nbsp; $message .= $attachment;<br />
&nbsp;&nbsp;&nbsp; $message .= $boundWithPre."--";<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; return mail($toAddress, $subject, $message, $headers);<br />
}<br />
<br />
* Sending email in html<br />
<br />
function sendHtmlMail(<br />
&nbsp;&nbsp;&nbsp; string $mailMessage = MAIL_CONF["mailMessage"],<br />
&nbsp;&nbsp;&nbsp; string $subject&nbsp; &nbsp;&nbsp; = MAIL_CONF["subject"],<br />
&nbsp;&nbsp;&nbsp; array $toAddress&nbsp; &nbsp; = MAIL_CONF["toAddress"],<br />
&nbsp;&nbsp;&nbsp; string $fromMail&nbsp; &nbsp; = MAIL_CONF["fromMail"]<br />
): bool {<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; $to&nbsp; &nbsp; &nbsp; &nbsp; = implode(",", $toAddress);<br />
&nbsp;&nbsp;&nbsp; $headers[] = 'MIME-Version: 1.0';<br />
&nbsp;&nbsp;&nbsp; $headers[] = 'Content-type: text/html; charset=iso-8859-1';&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; $headers[] = 'To: '.$to;<br />
&nbsp;&nbsp;&nbsp; $headers[] = 'From: '.$fromMail;&nbsp; &nbsp; <br />
<br />
&nbsp;&nbsp;&nbsp; return mail($to, $subject, $mailMessage, implode("\r\n", $headers));<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="124702""></a>
  <div class="note">
   <strong class="user">jerold at pangzlab dot com</strong>
   <a href="#124702" class="date">10-Feb-2020 05:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Sending mail with attachments<br />
<br />
function sendMail(<br />
&nbsp;&nbsp;&nbsp; $mailTo,<br />
&nbsp;&nbsp;&nbsp; $message,<br />
&nbsp;&nbsp;&nbsp; $subject&nbsp; &nbsp; = "Your Subject",<br />
&nbsp;&nbsp;&nbsp; $fromMail&nbsp;&nbsp; = "your@emialaddress.com",<br />
&nbsp;&nbsp;&nbsp; $fromName&nbsp;&nbsp; = "from sender",<br />
&nbsp;&nbsp;&nbsp; $replyTo&nbsp; &nbsp; = "no-reply",<br />
&nbsp;&nbsp;&nbsp; $filePath&nbsp;&nbsp; = "path"<br />
)<br />
{<br />
&nbsp;&nbsp;&nbsp; $LE&nbsp; = "\r\n";<br />
&nbsp;&nbsp;&nbsp; $uid = md5(uniqid(time()));<br />
&nbsp;&nbsp;&nbsp; $withAttachment = ($filePath !== NULL &amp;&amp; file_exists($filePath));<br />
<br />
&nbsp;&nbsp;&nbsp; if($withAttachment){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $fileName&nbsp;&nbsp; = basename($filePath);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $fileSize&nbsp;&nbsp; = filesize($filePath);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $handle&nbsp; &nbsp;&nbsp; = fopen($filePath, "r");<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $content&nbsp; &nbsp; = fread($handle, $fileSize);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; fclose($handle);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $content = chunk_split(base64_encode($content));<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; $header = "From: ".$fromName." &lt;".$fromMail."&gt;$LE";<br />
&nbsp;&nbsp;&nbsp; $header .= "Reply-To: ".$replyTo."$LE";<br />
&nbsp;&nbsp;&nbsp; $header .= "MIME-Version: 1.0$LE";<br />
&nbsp;&nbsp;&nbsp; $header .= "Content-Type: multipart/mixed; boundary=\"".$uid."\"$LE$LE";<br />
&nbsp;&nbsp;&nbsp; $header .= "This is a multi-part message in MIME format.$LE";<br />
&nbsp;&nbsp;&nbsp; $header .= "--".$uid."$LE";<br />
&nbsp;&nbsp;&nbsp; $header .= "Content-type:text/html; CHARSET=gb2312$LE";<br />
&nbsp;&nbsp;&nbsp; $header .= "Content-Transfer-Encoding: 7bit$LE$LE";<br />
&nbsp;&nbsp;&nbsp; $header .= $message."$LE$LE";<br />
<br />
&nbsp;&nbsp;&nbsp; if($withAttachment){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $header .= "--".$uid."$LE";<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $header .= "Content-Type: application/octet-stream; name=\"".$fileName."\"$LE";<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $header .= "Content-Transfer-Encoding: base64$LE";<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $header .= "Content-Disposition: attachment; filename=\"".$fileName."\"$LE$LE";<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $header .= $content."$LE$LE";<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $header .= "--".$uid."--";<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return mail($mailTo, $subject, "", $header);<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="124291""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#124291" class="date">12-Oct-2019 07:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you notice wrong displayed characters in the email it's because you need to properly set the Content-Type and the Charset in the headers of the email:<br />
<br />
<span class="default">&lt;?php<br />
$headers </span><span class="keyword">= </span><span class="string">'Content-Type: text/plain; CHARSET=gb2312' </span><span class="keyword">. </span><span class="string">"\r\n"</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
Mostly, UTF-8 is your best choice.<br />
<br />
You can set custom headers with the fourth parameter of the mail() function.<br />
<br />
To make the whole thing waterproof, add the following header too:<br />
<br />
<span class="default">&lt;?php<br />
$headers </span><span class="keyword">.= </span><span class="string">'Content-Transfer-Encoding: base64' </span><span class="keyword">. </span><span class="string">"\r\n"</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
Now you can use the combination of UTF-8 and Base64 to properly encode the subject line and the recipient name like this:<br />
<br />
<span class="default">&lt;?php<br />
$subject </span><span class="keyword">= </span><span class="string">'=?UTF-8?B?' </span><span class="keyword">. </span><span class="default">base64_encode</span><span class="keyword">(</span><span class="string">'Test email with German Umlauts ??ü?'</span><span class="keyword">) . </span><span class="string">'?='</span><span class="keyword">;<br />
</span><span class="default">$recipient </span><span class="keyword">= </span><span class="string">'=?UTF-8?B?' </span><span class="keyword">. </span><span class="default">base64_encode</span><span class="keyword">(</span><span class="string">'Margret Müller'</span><span class="keyword">) . </span><span class="string">'?= &lt;recipient@domain.com&gt;'</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
And don't forget to Base64 encode the email message too:<br />
<br />
<span class="default">&lt;?php<br />
$message </span><span class="keyword">= </span><span class="default">base64_encode</span><span class="keyword">(</span><span class="string">'This email contains German Umlauts ??ü?.'</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
All references are taken from:<br />
https://dev.to/lutvit/how-to-make-the-php-mail-function-awesome-3cii</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="124015""></a>
  <div class="note">
   <strong class="user">Mark Simon</strong>
   <a href="#124015" class="date">05-Jul-2019 07:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It is worth noting that you can set up a fake sendmail program using the sendmail_path directive in php.ini.<br />
<br />
Despite the comment in that file, sendmail_path also works for Window. From https://www.php.net/manual/en/mail.configuration.php#ini.sendmail-path:<br />
<br />
This directive works also under Windows. If set, smtp, smtp_port and sendmail_from are ignored and the specified command is executed.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="121858""></a>
  <div class="note">
   <strong class="user">charles dot fisher at arconic dot com</strong>
   <a href="#121858" class="date">10-Nov-2017 07:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I migrated an application to a platform without a local transport agent (MTA). I did not want to configure an MTA, so I wrote this xxmail function to replace mail() with calls to a remote SMTP server. Hopefully it is of some use.<br />
<br />
function xxmail($to, $subject, $body, $headers)<br />
{<br />
&nbsp;$smtp = stream_socket_client('tcp://smtp.yourmail.com:25', $eno, $estr, 30);<br />
<br />
&nbsp;$B = 8192;<br />
&nbsp;$c = "\r\n";<br />
&nbsp;$s = 'myapp@someserver.com';<br />
<br />
&nbsp;fwrite($smtp, 'helo ' . $_ENV['HOSTNAME'] . $c);<br />
&nbsp; $junk = fgets($smtp, $B);<br />
<br />
&nbsp;// Envelope<br />
&nbsp;fwrite($smtp, 'mail from: ' . $s . $c);<br />
&nbsp; $junk = fgets($smtp, $B);<br />
&nbsp;fwrite($smtp, 'rcpt to: ' . $to . $c);<br />
&nbsp; $junk = fgets($smtp, $B);<br />
&nbsp;fwrite($smtp, 'data' . $c);<br />
&nbsp; $junk = fgets($smtp, $B);<br />
<br />
&nbsp;// Header <br />
&nbsp;fwrite($smtp, 'To: ' . $to . $c); <br />
&nbsp;if(strlen($subject)) fwrite($smtp, 'Subject: ' . $subject . $c); <br />
&nbsp;if(strlen($headers)) fwrite($smtp, $headers); // Must be \r\n (delimited)<br />
&nbsp;fwrite($smtp, $headers . $c); <br />
<br />
&nbsp;// Body<br />
&nbsp;if(strlen($body)) fwrite($smtp, $body . $c); <br />
&nbsp;fwrite($smtp, $c . '.' . $c);<br />
&nbsp; $junk = fgets($smtp, $B);<br />
<br />
&nbsp;// Close<br />
&nbsp;fwrite($smtp, 'quit' . $c);<br />
&nbsp; $junk = fgets($smtp, $B);<br />
&nbsp;fclose($smtp);<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="121411""></a>
  <div class="note">
   <strong class="user">eeeugeneee</strong>
   <a href="#121411" class="date">21-Jul-2017 01:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Send mail with minimal requirements from email services.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; $encoding </span><span class="keyword">= </span><span class="string">"utf-8"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Preferences for Subject field<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$subject_preferences </span><span class="keyword">= array(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"input-charset" </span><span class="keyword">=&gt; </span><span class="default">$encoding</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"output-charset" </span><span class="keyword">=&gt; </span><span class="default">$encoding</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"line-length" </span><span class="keyword">=&gt; </span><span class="default">76</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"line-break-chars" </span><span class="keyword">=&gt; </span><span class="string">"\r\n"<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Mail header<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$header </span><span class="keyword">= </span><span class="string">"Content-type: text/html; charset="</span><span class="keyword">.</span><span class="default">$encoding</span><span class="keyword">.</span><span class="string">" \r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$header </span><span class="keyword">.= </span><span class="string">"From: "</span><span class="keyword">.</span><span class="default">$from_name</span><span class="keyword">.</span><span class="string">" &lt;"</span><span class="keyword">.</span><span class="default">$from_mail</span><span class="keyword">.</span><span class="string">"&gt; \r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$header </span><span class="keyword">.= </span><span class="string">"MIME-Version: 1.0 \r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$header </span><span class="keyword">.= </span><span class="string">"Content-Transfer-Encoding: 8bit \r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$header </span><span class="keyword">.= </span><span class="string">"Date: "</span><span class="keyword">.</span><span class="default">date</span><span class="keyword">(</span><span class="string">"r (T)"</span><span class="keyword">).</span><span class="string">" \r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$header </span><span class="keyword">.= </span><span class="default">iconv_mime_encode</span><span class="keyword">(</span><span class="string">"Subject"</span><span class="keyword">, </span><span class="default">$mail_subject</span><span class="keyword">, </span><span class="default">$subject_preferences</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Send mail<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">mail</span><span class="keyword">(</span><span class="default">$mail_to</span><span class="keyword">, </span><span class="default">$mail_subject</span><span class="keyword">, </span><span class="default">$mail_message</span><span class="keyword">, </span><span class="default">$header</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="121163""></a>
  <div class="note">
   <strong class="user">php at simoneast dot net</strong>
   <a href="#121163" class="date">31-May-2017 05:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Often it's helpful to find the exact error message that is triggered by the mail() function. While the function doesn't provide an error directly, you can use error_get_last() when mail() returns false.<br />
<br />
<span class="default">&lt;?php<br />
$success </span><span class="keyword">= </span><span class="default">mail</span><span class="keyword">(</span><span class="string">'example@example.com'</span><span class="keyword">, </span><span class="string">'My Subject'</span><span class="keyword">, </span><span class="default">$message</span><span class="keyword">);<br />
if (!</span><span class="default">$success</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$errorMessage </span><span class="keyword">= </span><span class="default">error_get_last</span><span class="keyword">()[</span><span class="string">'message'</span><span class="keyword">];<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
(Tested successfully on Windows which uses SMTP by default, but sendmail on Linux/OSX may not provide the same level of detail.)<br />
<br />
Thanks to https://stackoverflow.com/a/20203870/195835</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="121028""></a>
  <div class="note">
   <strong class="user">chris at ocproducts dot com</strong>
   <a href="#121028" class="date">26-Apr-2017 10:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Correction to my earlier note:<br />
<br />
'"\n" is confirmed required for qmail and postfix, probably also for sendmail and exim but I have not tested.'<br />
<br />
It only affects qmail.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="121027""></a>
  <div class="note">
   <strong class="user">chris at ocproducts dot com</strong>
   <a href="#121027" class="date">26-Apr-2017 10:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The 'sendmail' executable which PHP uses on Linux/Mac (not Windows) expects "\n" as a line separator.<br />
<br />
This executable is a standard, and emulated by other MTAs.<br />
<br />
"\n" is confirmed required for qmail and postfix, probably also for sendmail and exim but I have not tested.<br />
<br />
If you pass through using "\r\n" as a separator it may appear to work, but your email will be subtly corrupted and some middleware may break. It only works because some systems will clean up your mistake.<br />
<br />
If you are implementing DKIM be very careful, as DKIM checks will fail (at least on popular validation tools) if you screw this up. DKIM must be calculated using "\r\n" but then you must switch it all to "\n" when using the PHP mail function.<br />
<br />
On Windows, however, you should use "\r\n" because PHP is using SMTP in this situation, and hence the normal rules of the SMTP protocol (not the normal rules of Unix piping) apply.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="120328""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#120328" class="date">14-Dec-2016 10:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Security advice: Although it is not documented, for the parameters $to and $subject the mail() function changes at least \r and \n to space. So these parameters are safe against injection of additional headers. But you might want to check $to for commas as these separate multiple addresses and you might not want to send to more than one recipient.<br />
<br />
The crucial part is the $additional_headers parameter. This parameter can't be cleaned by the mail() function. So it is up to you to prevent unwanted \r or \n to be inserted into the values you put in there. Otherwise you just created a potential spam distributor.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="118602""></a>
  <div class="note">
   <strong class="user">jim at jimbrooking dot net</strong>
   <a href="#118602" class="date">06-Jan-2016 04:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I recently changed hosting companies and spent a day trying to see why an email script that had been working for years failed on the new server.<br />
<br />
The answer was that the old hosting company's email server accepted multiple "CC:" lines in the additional headers string, and the new did not. Thus on the new server<br />
<br />
...<br />
$add_hdr .= "CC: " . $email1 . PHP_EOL;<br />
$add_hdr .= "CC: " . $email2 . PHP_EOL;<br />
...<br />
<br />
did not work, but<br />
<br />
...<br />
$add_hdr .= "CC: " . $email1 . ", " . $email2 . PHP_EOL;<br />
...<br />
<br />
did work.<br />
<br />
In both cases, PHP's mail() function returned no error, but until I placed both emails, comma-separated, in the same line I was getting the following error:<br />
<br />
550 Messages should have one or no Cc headers, not 2.<br />
<br />
Hope this helps someone.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="118210""></a>
  <div class="note">
   <strong class="user">jimmytrojan009 at gmail dot com</strong>
   <a href="#118210" class="date">26-Oct-2015 06:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I have tried many online tutorials to get mail() function working in windows, until i stumbled upon this website<br />
<a href="http://php.codeindepth.com/php-sending-mail/" rel="nofollow" target="_blank">http://php.codeindepth.com/php-sending-mail/</a><br />
<br />
It really boils down to changing few directives in php.ini and sendmail.ini<br />
<br />
Changes required in sendmail.ini<br />
<br />
smtp_server=smtp.gmail.com<br />
smtp_port=587<br />
error_logfile=error.log<br />
debug_logfile=debug.log<br />
auth_username=your-gmail-id@gmail.com<br />
auth_password=your-gmail-password<br />
force_sender=your-gmail-id@gmail.com<br />
<br />
Changes required in php.ini<br />
<br />
SMTP=smtp.gmail.com<br />
smtp_port=587<br />
sendmail_from = your-gmail-id@gmail.com<br />
sendmail_path = "\"C:\xampp\sendmail\sendmail.exe\" -t"<br />
;sendmail_path = "C:\xampp\mailtodisk\mailtodisk.exe"</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="111797""></a>
  <div class="note">
   <strong class="user">ittasks at gmail dot com</strong>
   <a href="#111797" class="date">28-Mar-2013 08:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When dealing with mail headers "\n" and "\r\n" *sometimes* makes a big difference.<br />
<br />
Once our CentOs servers got re-installed, all headers like:<br />
<br />
&nbsp; $headers = "MIME-Version: 1.0\r\n";<br />
&nbsp; $headers.= "Content-type: text/html; charset=iso-8859-1\r\n";<br />
&nbsp;...<br />
<br />
became part of message body instead of headers<br />
<br />
I was able to fixed this by replacing "\r\n" with just "\n"</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="110606""></a>
  <div class="note">
   <strong class="user">shenyqwilliam</strong>
   <a href="#110606" class="date">12-Nov-2012 02:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you're sending a large attachment, you may encounter overflow problem.<br />
AFAIK, two common limits could be responsible.<br />
<br />
1. Postfix message size limit.<br />
Edit /etc/postfix/main.cf . Change the value of "message_size_limit".<br />
<br />
2. Apache memory size limit for scripts.<br />
Edit /etc/php.ini . Change the value of "memory_limit".<br />
<br />
//Then reload (or restart) Postfix and Apache.<br />
//Empirically, sending 200MB attachment requires 500MB memory.<br />
<br />
Be careful! Raising memory limits may cause unexpected consequences, and is hence deprecated.<br />
Recommended alternatives include:<br />
* Pack and split attachment into several emails.<br />
* Only include a link to the file. The receiver can download it later.<br />
* Use IMAP/POP3 server (e.g. Dovecot).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="110329""></a>
  <div class="note">
   <strong class="user">bburch at bouncingpixel dot com</strong>
   <a href="#110329" class="date">11-Oct-2012 12:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When using the PHP mail() function with IIS 6 on Windows Server 2003, check your "Relay" settings on the SMTP Virtual Server in IIS.&nbsp; If you grant access to 127.0.0.1 and set then set your php.ini SMTP to the same IP address (along with setting the same port 25), you should have success in sending mail.&nbsp; <br />
<br />
I'm using PHP 5.3 and have had success with this configuration and did not have to define the "sendmail_from" setting in our php.ini file.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="109655""></a>
  <div class="note">
   <strong class="user">martin dot farrow at versacloud dot com</strong>
   <a href="#109655" class="date">06-Aug-2012 09:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I've noticed that on some versions of PHP occasionally mail() returns the empty string for success, rather than true or false. The empty string evaluates to false.<br />
<br />
if you use constructs like<br />
<br />
if ( mail( ... ) ){<br />
&nbsp; # do something here on success<br />
}<br />
<br />
this wont work consistently.<br />
<br />
so you need code like<br />
<br />
$ret=mail(....)<br />
<br />
if ( $ret == '' || $ret ){<br />
&nbsp; # do something here<br />
}<br />
<br />
to get consistent results.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="108669""></a>
  <div class="note">
   <strong class="user">pavel.lint at vk.com</strong>
   <a href="#108669" class="date">16-May-2012 11:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's a small handy function I use to send email in UTF-8.<br />
<br />
&nbsp;<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">mail_utf8</span><span class="keyword">(</span><span class="default">$to</span><span class="keyword">, </span><span class="default">$from_user</span><span class="keyword">, </span><span class="default">$from_email</span><span class="keyword">, <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$subject </span><span class="keyword">= </span><span class="string">'(No subject)'</span><span class="keyword">, </span><span class="default">$message </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">)<br />
&nbsp;&nbsp; { <br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$from_user </span><span class="keyword">= </span><span class="string">"=?UTF-8?B?"</span><span class="keyword">.</span><span class="default">base64_encode</span><span class="keyword">(</span><span class="default">$from_user</span><span class="keyword">).</span><span class="string">"?="</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$subject </span><span class="keyword">= </span><span class="string">"=?UTF-8?B?"</span><span class="keyword">.</span><span class="default">base64_encode</span><span class="keyword">(</span><span class="default">$subject</span><span class="keyword">).</span><span class="string">"?="</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$headers </span><span class="keyword">= </span><span class="string">"From: </span><span class="default">$from_user</span><span class="string"> &lt;</span><span class="default">$from_email</span><span class="string">&gt;\r\n"</span><span class="keyword">. <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"MIME-Version: 1.0" </span><span class="keyword">. </span><span class="string">"\r\n" </span><span class="keyword">. <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"Content-type: text/html; CHARSET=gb2312" </span><span class="keyword">. </span><span class="string">"\r\n"</span><span class="keyword">; <br />
<br />
&nbsp;&nbsp; &nbsp; return </span><span class="default">mail</span><span class="keyword">(</span><span class="default">$to</span><span class="keyword">, </span><span class="default">$subject</span><span class="keyword">, </span><span class="default">$message</span><span class="keyword">, </span><span class="default">$headers</span><span class="keyword">); <br />
&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="108498""></a>
  <div class="note">
   <strong class="user">rexlorenzo at gmail dot com</strong>
   <a href="#108498" class="date">02-May-2012 01:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Be careful to not put extra spaces for the $headers variable.<br />
<br />
For example, this didn't work on our servers:<br />
<br />
$headers = "From: $from \r\n Bcc: $bcc \r\n";<br />
<br />
But this did:<br />
<br />
$headers = "From: $from\r\nBcc: $bcc\r\n";<br />
<br />
Notice the removal of the spaces around the first \r\n.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="108328""></a>
  <div class="note">
   <strong class="user">yarik dot bohatsky at gmail dot com</strong>
   <a href="#108328" class="date">17-Apr-2012 03:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to send UTF-8 HTML letter you need to mention charset twice:<br />
<br />
1) In message header:<br />
<span class="default">&lt;?php<br />
$headers </span><span class="keyword">.= </span><span class="string">'Content-type: text/html; CHARSET=gb2312' </span><span class="keyword">. </span><span class="string">"\r\n"</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
2) In HTML header:<br />
<span class="default">&lt;?php<br />
$message </span><span class="keyword">= </span><span class="string">'<br />
&lt;html&gt;<br />
&lt;head&gt;<br />
&nbsp;&nbsp; &lt;meta http-equiv="Content-Type" content="text/html; CHARSET=gb2312" /&gt;<br />
&nbsp;&nbsp; &lt;title&gt;Fillon soutient à fond le retour d\'un Grand Prix de France&lt;/title&gt;<br />
&lt;/head&gt;<br />
&lt;body&gt;<br />
&nbsp;&nbsp; &lt;p&gt;Le Premier ministre Fran?ois Fillon, passionné d\'automobile et pilote à ses heures, a apporté un soutien appuyé au retour d\'un Grand Prix de France au calendrier 2013 de la Formule 1, en faisant un passage-éclair vendredi sur le circuit Paul Ricard dans le Var.&lt;/p&gt;<br />
&lt;/body&gt;<br />
&lt;/html&gt;<br />
'</span><span class="keyword">;<br />
<br />
</span><span class="default">In this </span><span class="keyword">case </span><span class="default">Outlook will also </span><span class="string">"understand" </span><span class="default">that message is encoded using UTF</span><span class="keyword">-</span><span class="default">8.</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="107524""></a>
  <div class="note">
   <strong class="user">Max AT</strong>
   <a href="#107524" class="date">15-Feb-2012 09:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To define a mail sensitivity you have to put this line in the headers:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $headers </span><span class="keyword">= </span><span class="string">"MIME-Version: 1.0\n" </span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$headers </span><span class="keyword">.= </span><span class="string">"Content-Type: text/html; charset=\"iso-8859-1\"\n"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$headers </span><span class="keyword">.= </span><span class="string">"Sensitivity: Personal\n"</span><span class="keyword">;<br />
<br />
&nbsp;</span><span class="default">$status&nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">mail</span><span class="keyword">(</span><span class="default">$to</span><span class="keyword">, </span><span class="default">$subject</span><span class="keyword">, </span><span class="default">$message</span><span class="keyword">,</span><span class="default">$headers</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span> <br />
<br />
Possible Options:<br />
Sensitivity: Normal, Personal, Private and Company-Confidential<br />
<br />
These will be recognised and handled in Outlook, Thunderbird and others.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="107321""></a>
  <div class="note">
   <strong class="user">ABOMB</strong>
   <a href="#107321" class="date">30-Jan-2012 10:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I was having delivery issues from this function to Gmail, Yahoo, AOL, etc.&nbsp; I used the notes here to figure that you need to be setting your Return-Path to a valid email to catch bounces.&nbsp; There are two extra delivery gotchas on top of that:<br />
<br />
1) The domain in the email used in the -f option in the php.ini sendmail parameter or in the mail() extra parameters field, needs to have a valid SPF record for the domain (in DNS as a "TXT" record type for sure and add an additional&nbsp; "SPF" type record if possible).&nbsp; Why? That's header field being used for spam checks.<br />
<br />
2) You should also use a domain key or DKIM.&nbsp; The trick here is that the domain key/DKIM is case sensitive!&nbsp; I used Cpanel to create my domain key which automatically used all lowercase domain names in the key creation.&nbsp; I found when&nbsp; sending email and using a camel case "-f account@MyDomainHere.Com" option, my key was not accepted.&nbsp; However it was accepted when I used "-f account@mydomainhere.com".<br />
<br />
There are many other factors that can contribute to mail not getting to inboxes, including your own multiple failed testing attempts, so I suggest you consult each site's guidelines and don't ask me for help.&nbsp; These are just the couple technical issues that helped my case.<br />
<br />
I hope this saves someone some time and headaches...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="106877""></a>
  <div class="note">
   <strong class="user">debis at woh dot rr dot com</strong>
   <a href="#106877" class="date">14-Dec-2011 03:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is for Windows Server 2003, IIS 6.0 with SMTP virtual server. <br />
<br />
The problem I had was not including init_set for the SMTP server, I thought the SMTP definition in the IIS SMTP virtual server configuration would work.&nbsp; When I sent mail manually this was not an issue.&nbsp; <br />
<br />
Also, $mail_sent = @mail( $to, $subject, $message, $headers ); wouldn't work but $mail_sent = mail($to, $subject, $message, $headers); did.<br />
Lack of date_default_timezone_set() only caused a warning because php guessed what it should be.<br />
<br />
This worked:<br />
<span class="default">&lt;?php<br />
$to&nbsp; &nbsp; &nbsp; </span><span class="keyword">= </span><span class="string">'nobody@example.com'</span><span class="keyword">;<br />
</span><span class="default">$subject </span><span class="keyword">= </span><span class="string">'the subject'</span><span class="keyword">;<br />
</span><span class="default">$message </span><span class="keyword">= </span><span class="string">'hello'</span><span class="keyword">;<br />
</span><span class="default">$headers </span><span class="keyword">= </span><span class="string">'From: webmaster@example.com' </span><span class="keyword">. </span><span class="string">"\r\n" </span><span class="keyword">.<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'Reply-To: webmaster@example.com' </span><span class="keyword">. </span><span class="string">"\r\n" </span><span class="keyword">.<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'X-Mailer: PHP/' </span><span class="keyword">. </span><span class="default">phpversion</span><span class="keyword">();<br />
</span><span class="default">ini_set </span><span class="keyword">( </span><span class="string">"SMTP"</span><span class="keyword">, </span><span class="string">"smtp-server.example.com" </span><span class="keyword">); <br />
</span><span class="default">date_default_timezone_set</span><span class="keyword">(</span><span class="string">'America/New_York'</span><span class="keyword">);<br />
<br />
</span><span class="default">mail</span><span class="keyword">(</span><span class="default">$to</span><span class="keyword">, </span><span class="default">$subject</span><span class="keyword">, </span><span class="default">$message</span><span class="keyword">, </span><span class="default">$headers</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span> <br />
<br />
And just so you can troubleshoot, this worked when sending mail from the command line/manually. CLI worked even though the php code without the init_set function wouldn't work. <br />
<br />
You will notice that the "rcpt to" and "to" fields appear redundant, but if both are not used, the delivered mail's "to" field will be blank/empty.<br />
<br />
-------------------------------<br />
telnet www.example.com 25<br />
helo<br />
mail from: webmaster@example.com<br />
rcpt to: someone@example.com<br />
data<br />
to: someone@example.com<br />
subject: test again to make sure<br />
<br />
this is my message <br />
.<br />
quit<br />
-----------------------------------</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100727""></a>
  <div class="note">
   <strong class="user">shuitest at gmail dot com</strong>
   <a href="#100727" class="date">02-Nov-2010 09:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you use mutt, do as below, <br />
<br />
/usr/bin/mutt -s '$subject' -f /dev/null -e 'set copy=no' -e 'set from = "{$GLOBALS[cfg][email_from]}"' -a '$attach_file_full_path' '{$GLOBALS[cfg][email_to]}' &lt;/dev/null 2&gt;&amp;1;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="98775""></a>
  <div class="note">
   <strong class="user">Porjo</strong>
   <a href="#98775" class="date">06-Jul-2010 11:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Make sure you enclose \r\n in double quotes (not single quotes!) so that PHP can translate that into the correct linefeed code</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="97680""></a>
  <div class="note">
   <strong class="user">umangberi at gmail dot com</strong>
   <a href="#97680" class="date">02-May-2010 01:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Outlook 2007 seemed to be a little finicky with me to have carriage returns in the headers. So any \r\n resulted in messages that had default apache messages sent over to me.<br />
<br />
As soon as I removed \r from all of the headers, the script started working fine. Hope that helped.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="94428""></a>
  <div class="note">
   <strong class="user">Systemx</strong>
   <a href="#94428" class="date">04-Nov-2009 02:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Bare LFs in SMTP
<br />

<br />
Use This
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="comment">// Fix any bare linefeeds in the message to make it RFC821 Compliant.
<br />
</span><span class="default">$message </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"#(?&lt;!\r)\n#si"</span><span class="keyword">, </span><span class="string">"\r\n"</span><span class="keyword">, </span><span class="default">$message</span><span class="keyword">); 
<br />
&nbsp;&nbsp;&nbsp; 
<br />
</span><span class="comment">// Make sure there are no bare linefeeds in the headers
<br />
</span><span class="default">$headers </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'#(?&lt;!\r)\n#si'</span><span class="keyword">, </span><span class="string">"\r\n"</span><span class="keyword">, </span><span class="default">$headers</span><span class="keyword">);
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92639""></a>
  <div class="note">
   <strong class="user">Edward</strong>
   <a href="#92639" class="date">01-Aug-2009 02:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Currently my hosting service is on Godaddy. When attempting to use the mail function without the fifth parameter containing "-f", my message headers would not work.
<br />

<br />
Whenever your message headers do not work, simply try using the fifth parameter:
<br />

<br />
<span class="default">&lt;?php
<br />
mail</span><span class="keyword">(</span><span class="default">$to</span><span class="keyword">, </span><span class="default">$subject</span><span class="keyword">, </span><span class="default">$message</span><span class="keyword">, </span><span class="default">$headers</span><span class="keyword">, </span><span class="string">"-femail.address@example.com"</span><span class="keyword">);
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="89043""></a>
  <div class="note">
   <strong class="user">Erich at gasboysnospam dot net</strong>
   <a href="#89043" class="date">18-Feb-2009 07:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
if your mail is failing (returns false) be aware that many servers are configured to kill mail going out with a bcc or cc header.<br />
<br />
The ideal workaround is to use the smtp functions which servers allow because of its better audit trail. Alternatively call the mail function several times.<br />
<br />
I've just spent about four hours trying to work out what I was doing wrong!!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86321""></a>
  <div class="note">
   <strong class="user">molotster on google mail com</strong>
   <a href="#86321" class="date">13-Oct-2008 01:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note, that single line should not contain more than 78 character, but is not allowed to contain more than 998 characters.<br />
<br />
The possible consequences are:<br />
Over 78 - clients are allowed to display the message in a "harder to read" way.<br />
Over 998 - clients and servers are allowed to drop the message or cause any buffer-limit error.<br />
<br />
See:<br />
<a href="http://www.faqs.org/rfcs/rfc2822 part 2.1.1." rel="nofollow" target="_blank">http://www.faqs.org/rfcs/rfc2822 part 2.1.1.</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81979""></a>
  <div class="note">
   <strong class="user">richard at richard-sumilang dot com</strong>
   <a href="#81979" class="date">22-Mar-2008 12:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are using the sendmail app from an exim package or something you don't really need to change the normal parameters PHP gives it (-t -i) as other posts described.
<br />

<br />
I just added "-f myemail@example.com" and it worked.
<br />

<br />
One thing that got me stuck for a few hours was trying to figure out why the return-path was set as the user (user running php) and not what I was setting it with the -f option then I later found at that in order to forcefully set the return-path the user account running the command must be in exim's trusted users configuration! It helps to add trusted_groups as well then everything works fine :)
<br />
- Richard Sumilang</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75460""></a>
  <div class="note">
   <strong class="user">Alex Jaspersen</strong>
   <a href="#75460" class="date">30-May-2007 11:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For qmail users, I have written a function that talks directly to qmail-queue, rather than going through the sendmail wrapper used by mail(). Thus it allows more direct control over the message (for example, you can adapt the function to display "undisclosed recipients" in to the To: header). It also performs careful validation of the e-mail addresses passed to it, making it more difficult for spammers to exploit your scripts.<br />
<br />
Please note that this function differs from the mail() function in that the from address must be passed as a _separate_ argument. It is automatically put into the message headers and _does not_ need to be included in $additional_headers.<br />
<br />
$to can either be an array or a single address contained in a string.<br />
$message should not contain any carriage return characters - only linefeeds.<br />
<br />
No validation is performed on $additional_headers. This is mostly unnecessary because qmail will ignore any additional To: headers injected by a malicious user. However if you have some strange mail setup it might be a problem.<br />
<br />
The function returns false if the message fails validation or is rejected by qmail-queue, and returns true on success.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">qmail_queue</span><span class="keyword">(</span><span class="default">$to</span><span class="keyword">, </span><span class="default">$from</span><span class="keyword">, </span><span class="default">$subject</span><span class="keyword">, </span><span class="default">$message</span><span class="keyword">, </span><span class="default">$additional_headers </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// qmail-queue location and hostname used for Message-Id<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$cmd </span><span class="keyword">= </span><span class="string">"/var/qmail/bin/qmail-queue"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$hostname </span><span class="keyword">= </span><span class="default">trim</span><span class="keyword">(</span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="string">"/var/qmail/control/me"</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// convert $to into an array<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">is_scalar</span><span class="keyword">(</span><span class="default">$to</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$to </span><span class="keyword">= array(</span><span class="default">$to</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// BEGIN VALIDATION<br />
&nbsp;&nbsp;&nbsp; // e-mail address validation<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$e </span><span class="keyword">= </span><span class="string">"/^[-+\\.0-9=a-z_]+@([-0-9a-z]+\\.)+([0-9a-z]){2,4}$/i"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// from address<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if(!</span><span class="default">preg_match</span><span class="keyword">(</span><span class="default">$e</span><span class="keyword">, </span><span class="default">$from</span><span class="keyword">)) return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// to address(es)<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">foreach(</span><span class="default">$to </span><span class="keyword">as </span><span class="default">$rcpt</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(!</span><span class="default">preg_match</span><span class="keyword">(</span><span class="default">$e</span><span class="keyword">, </span><span class="default">$rcpt</span><span class="keyword">)) return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// subject validation (only printable 7-bit ascii characters allowed)<br />
&nbsp;&nbsp;&nbsp; // needs to be adapted to allow for foreign languages with 8-bit characters<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if(!</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/^[\\040-\\176]+$/"</span><span class="keyword">, </span><span class="default">$subject</span><span class="keyword">)) return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// END VALIDATION<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; // open qmail-queue process<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$dspec </span><span class="keyword">= array<br />
&nbsp;&nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; array(</span><span class="string">"pipe"</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">), </span><span class="comment">// message descriptor<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">array(</span><span class="string">"pipe"</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">) </span><span class="comment">// envelope descriptor<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$pipes </span><span class="keyword">= array();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$proc </span><span class="keyword">= </span><span class="default">proc_open</span><span class="keyword">(</span><span class="default">$cmd</span><span class="keyword">, </span><span class="default">$dspec</span><span class="keyword">, </span><span class="default">$pipes</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if(!</span><span class="default">is_resource</span><span class="keyword">(</span><span class="default">$proc</span><span class="keyword">)) return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// write additional headers<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if(!empty(</span><span class="default">$additional_headers</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="default">$additional_headers </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// write to/from/subject/date/message-ID headers<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="string">"To: " </span><span class="keyword">. </span><span class="default">$to</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]); </span><span class="comment">// first recipient<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">for(</span><span class="default">$i </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">sizeof</span><span class="keyword">(</span><span class="default">$to</span><span class="keyword">); </span><span class="default">$i</span><span class="keyword">++) </span><span class="comment">// additional recipients<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="string">", " </span><span class="keyword">. </span><span class="default">$to</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="string">"\nSubject: " </span><span class="keyword">. </span><span class="default">$subject </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="string">"From: " </span><span class="keyword">. </span><span class="default">$from </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="string">"Message-Id: &lt;" </span><span class="keyword">. </span><span class="default">md5</span><span class="keyword">(</span><span class="default">uniqid</span><span class="keyword">(</span><span class="default">microtime</span><span class="keyword">())) . </span><span class="string">"@" </span><span class="keyword">. </span><span class="default">$hostname </span><span class="keyword">. </span><span class="string">"&gt;\n"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="string">"Date: " </span><span class="keyword">. </span><span class="default">date</span><span class="keyword">(</span><span class="string">"r"</span><span class="keyword">) . </span><span class="string">"\n\n"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="default">$message</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="string">"\n"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// write from address and recipients<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">], </span><span class="string">"F" </span><span class="keyword">. </span><span class="default">$from </span><span class="keyword">. </span><span class="string">"\0"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; foreach(</span><span class="default">$to </span><span class="keyword">as </span><span class="default">$rcpt</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">], </span><span class="string">"T" </span><span class="keyword">. </span><span class="default">$rcpt </span><span class="keyword">. </span><span class="string">"\0"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">], </span><span class="string">"\0"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// return true on success.<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">proc_close</span><span class="keyword">(</span><span class="default">$proc</span><span class="keyword">) == </span><span class="default">0</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="59773""></a>
  <div class="note">
   <strong class="user">Ben Cooke</strong>
   <a href="#59773" class="date">15-Dec-2005 05:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that there is a big difference between the behavior of this function on Windows systems vs. UNIX systems. On Windows it delivers directly to an SMTP server, while on a UNIX system it uses a local command to hand off to the system's own MTA.
<br />

<br />
The upshot of all this is that on a Windows system your&nbsp; message and headers must use the standard line endings \r\n as prescribed by the email specs. On a UNIX system the MTA's "sendmail" interface assumes that recieved data will use UNIX line endings and will turn any \n to \r\n, so you must supply only \n to mail() on a UNIX system to avoid the MTA hypercorrecting to \r\r\n.
<br />

<br />
If you use plain old \n on a Windows system, some MTAs will get a little upset. qmail in particular will refuse outright to accept any message that has a lonely \n without an accompanying \r.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="52856""></a>
  <div class="note">
   <strong class="user">msheldon at desertraven dot com</strong>
   <a href="#52856" class="date">15-May-2005 12:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just a comment on some of the examples, and as a note for those who may be unaware. The SMTP RFC 822 is VERY explicit in stating that \r\n is the ONLY acceptable line break format in the headers, though is a little vague about the message body. While many MTAs will deal with just \n, I've run accross plenty of them that will exhibit "interesting" behaviours when this happens. Those MTAs that are strict in compliance will definitely break when header lines are terminated with only \n. They will also most likely break if the body of the message contains more than 1000 consecutive characters without a \r\n.*<br />
<br />
Note that RFC 821 is a little more clear in defining:<br />
"line<br />
&nbsp;&nbsp; &nbsp;&nbsp; A a sequence of ASCII characters ending with a &lt;CRLF&gt;."<br />
<br />
RFC 821 makes no distinction between header lines and message body lines, since both are actually transmitted during the DATA phase.<br />
<br />
Bottom line, best practice is to be sure to convert any bare \n characters in the message to \r\n.<br />
<br />
* "The maximum total length of a text line including the &lt;CRLF&gt; is 1000 characters" (RFC 821)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="50544""></a>
  <div class="note">
   <strong class="user">php dot net at schrecktech dot com</strong>
   <a href="#50544" class="date">02-Mar-2005 04:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When sending MIME email make sure you follow the documentation with the "70" characters per line...you may end up with missing characters...and that is really hard to track down...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="40204""></a>
  <div class="note">
   <strong class="user">Paul</strong>
   <a href="#40204" class="date">25-Feb-2004 02:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
My mime multipart/alternative messages were going ok, until I switched to qmail with php .. after years of painfull searching, I came across this on the Life With Qmail 'Gotchas' section:<br />
<br />
G.11. Carriage Return/Linefeed (CRLF) line breaks don't work<br />
<br />
qmail-inject and other local injection mechanisms like sendmail don't work right when messages are injected with DOS-style carriage return/linefeed (CRLF) line breaks. Unlike Sendmail, qmail requires locally-injected messages to use Unix newlines (LF only). This is a common problem with PHP scripts.<br />
<br />
So now, I can go back to sending emails with text AND html components :)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="29038""></a>
  <div class="note">
   <strong class="user">f dot touchard at laposte dot net</strong>
   <a href="#29038" class="date">30-Jan-2003 07:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
***Encoding plain text as quoted-printable in MIME email***
<br />

<br />
If you don't want to install IMAP and use imap_8bit() to encode plain text or html message as quoted-printable
<br />
(friendly french special characters encoding :-) in MIME email, try this function.
<br />
I haven't fully tested it ( like with microtime with long mails). I send html message as 7-bit, so I didn't try yet with html.
<br />
If you have good html practise, you don't really need to encode html as quote-printable as it only uses 7-bit chars.
<br />
F.Touchard
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">qp_encoding</span><span class="keyword">(</span><span class="default">$Message</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/* Build (most polpular) Extended ASCII Char/Hex MAP (characters &gt;127 &amp; &lt;255) */
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">127</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$CharList</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] = </span><span class="string">"/"</span><span class="keyword">.</span><span class="default">chr</span><span class="keyword">(</span><span class="default">$i</span><span class="keyword">+</span><span class="default">128</span><span class="keyword">).</span><span class="string">"/"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$HexList</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] = </span><span class="string">"="</span><span class="keyword">.</span><span class="default">strtoupper</span><span class="keyword">(</span><span class="default">bin2hex</span><span class="keyword">(</span><span class="default">chr</span><span class="keyword">(</span><span class="default">$i</span><span class="keyword">+</span><span class="default">128</span><span class="keyword">)));
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/* Encode equal sign &amp; 8-bit characters as equal signs followed by their hexadecimal values */
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$Message </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"="</span><span class="keyword">, </span><span class="string">"=3D"</span><span class="keyword">, </span><span class="default">$Message</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$Message </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="default">$CharList</span><span class="keyword">, </span><span class="default">$HexList</span><span class="keyword">, </span><span class="default">$Message</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/* Lines longer than 76 characters (size limit for quoted-printable Content-Transfer-Encoding)
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; will be cut after character 75 and an equals sign is appended to these lines. */ 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$MessageLines </span><span class="keyword">= </span><span class="default">split</span><span class="keyword">(</span><span class="string">"\n"</span><span class="keyword">, </span><span class="default">$Message</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$Message_qp </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; while(list(, </span><span class="default">$Line</span><span class="keyword">) = </span><span class="default">each</span><span class="keyword">(</span><span class="default">$MessageLines</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$Line</span><span class="keyword">) &gt; </span><span class="default">75</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$Pointer </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; while (</span><span class="default">$Pointer </span><span class="keyword">&lt;= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$Line</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$Offset </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/^=(3D|([8-9A-F]{1}[0-9A-F]{1}))$/"</span><span class="keyword">, </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$Line</span><span class="keyword">, (</span><span class="default">$Pointer</span><span class="keyword">+</span><span class="default">73</span><span class="keyword">), </span><span class="default">3</span><span class="keyword">))) </span><span class="default">$Offset</span><span class="keyword">=-</span><span class="default">2</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/^=(3D|([8-9A-F]{1}[0-9A-F]{1}))$/"</span><span class="keyword">, </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$Line</span><span class="keyword">, (</span><span class="default">$Pointer</span><span class="keyword">+</span><span class="default">74</span><span class="keyword">), </span><span class="default">3</span><span class="keyword">))) </span><span class="default">$Offset</span><span class="keyword">=-</span><span class="default">1</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$Message_qp</span><span class="keyword">.= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$Line</span><span class="keyword">, </span><span class="default">$Pointer</span><span class="keyword">, (</span><span class="default">75</span><span class="keyword">+</span><span class="default">$Offset</span><span class="keyword">)).</span><span class="string">"=\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ((</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$Line</span><span class="keyword">) - (</span><span class="default">$Pointer</span><span class="keyword">+</span><span class="default">75</span><span class="keyword">)) &lt;= </span><span class="default">75</span><span class="keyword">) {&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$Message_qp</span><span class="keyword">.= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$Line</span><span class="keyword">, (</span><span class="default">$Pointer</span><span class="keyword">+</span><span class="default">75</span><span class="keyword">+</span><span class="default">$Offset</span><span class="keyword">)).</span><span class="string">"\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break </span><span class="default">1</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$Pointer</span><span class="keyword">+= </span><span class="default">75</span><span class="keyword">+</span><span class="default">$Offset</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$Message_qp</span><span class="keyword">.= </span><span class="default">$Line</span><span class="keyword">.</span><span class="string">"\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }&nbsp; &nbsp; &nbsp; &nbsp; 
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$Message_qp</span><span class="keyword">;
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
