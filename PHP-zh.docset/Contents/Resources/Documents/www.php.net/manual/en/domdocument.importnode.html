<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>Import node into current document</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="domdocument.getelementsbytagnamens.html">? DOMDocument::getElementsByTagNameNS</a></li>
      <li style="float: right;"><a href="domdocument.load.html">DOMDocument::load ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="class.domdocument.html">DOMDocument</a></li>
    <li>Import node into current document</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="domdocument.importnode" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">DOMDocument::importNode</h1>
  <p class="verinfo">(PHP 5, PHP 7)</p><p class="refpurpose"><span class="refname">DOMDocument::importNode</span> &mdash; <span class="dc-title">Import node into current document</span></p>

 </div>
 <div class="refsect1 description" id="refsect1-domdocument.importnode-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="modifier">public</span> <span class="methodname"><strong>DOMDocument::importNode</strong></span>
    ( <span class="methodparam"><span class="type"><a href="class.domnode.html" class="type DOMNode">DOMNode</a></span> <code class="parameter">$importedNode</code></span>
   [, <span class="methodparam"><span class="type">bool</span> <code class="parameter">$deep</code><span class="initializer"> = <strong><code>FALSE</code></strong></span></span>
  ] ) : <span class="type"><a href="class.domnode.html" class="type DOMNode">DOMNode</a></span></div>

  <p class="para rdfs-comment">
   This function returns a copy of the node to import and associates it with 
   the current document.
  </p>
 </div>

 <div class="refsect1 parameters" id="refsect1-domdocument.importnode-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">importedNode</code></dt>

     <dd>

      <p class="para">
       The node to import.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">deep</code></dt>

     <dd>

      <p class="para">
       If set to <strong><code>TRUE</code></strong>, this method will recursively import the subtree under
       the <code class="parameter">importedNode</code>.
      </p>
      <blockquote class="note"><p><strong class="note">Note</strong>: 
       <p class="para">
        To copy the nodes attributes <code class="parameter">deep</code> needs to be set to <strong><code>TRUE</code></strong>
       </p>
      </p></blockquote>
     </dd>

    
   </dl>

  </p>
 </div>

 <div class="refsect1 returnvalues" id="refsect1-domdocument.importnode-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   The copied node or <strong><code>FALSE</code></strong>, if it cannot be copied.
  </p>
 </div>

 <div class="refsect1 errors" id="refsect1-domdocument.importnode-errors">
  <h3 class="title">错误／异常</h3>
  <p class="para">
   <a href="class.domexception.html" class="classname">DOMException</a> is thrown if node cannot be imported.
  </p>
 </div>

 <div class="refsect1 examples" id="refsect1-domdocument.importnode-examples">
  <h3 class="title">范例</h3>
  <p class="para">
   <div class="example" id="example-6521">
    <p><strong>Example #1 <span class="function"><strong>DOMDocument::importNode()</strong></span> example</strong></p>
    <div class="example-contents"><p>
      Copying nodes between documents.
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br />$orgdoc&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">DOMDocument</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$orgdoc</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">loadXML</span><span style="color: #007700">(</span><span style="color: #DD0000">"&lt;root&gt;&lt;element&gt;&lt;child&gt;text&nbsp;in&nbsp;child&lt;/child&gt;&lt;/element&gt;&lt;/root&gt;"</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;The&nbsp;node&nbsp;we&nbsp;want&nbsp;to&nbsp;import&nbsp;to&nbsp;a&nbsp;new&nbsp;document<br /></span><span style="color: #0000BB">$node&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$orgdoc</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getElementsByTagName</span><span style="color: #007700">(</span><span style="color: #DD0000">"element"</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">item</span><span style="color: #007700">(</span><span style="color: #0000BB">0</span><span style="color: #007700">);<br /><br /><br /></span><span style="color: #FF8000">//&nbsp;Create&nbsp;a&nbsp;new&nbsp;document<br /></span><span style="color: #0000BB">$newdoc&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">DOMDocument</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$newdoc</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">formatOutput&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//&nbsp;Add&nbsp;some&nbsp;markup<br /></span><span style="color: #0000BB">$newdoc</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">loadXML</span><span style="color: #007700">(</span><span style="color: #DD0000">"&lt;root&gt;&lt;someelement&gt;text&nbsp;in&nbsp;some&nbsp;element&lt;/someelement&gt;&lt;/root&gt;"</span><span style="color: #007700">);<br /><br />echo&nbsp;</span><span style="color: #DD0000">"The&nbsp;'new&nbsp;document'&nbsp;before&nbsp;copying&nbsp;nodes&nbsp;into&nbsp;it:\n"</span><span style="color: #007700">;<br />echo&nbsp;</span><span style="color: #0000BB">$newdoc</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">saveXML</span><span style="color: #007700">();<br /><br /></span><span style="color: #FF8000">//&nbsp;Import&nbsp;the&nbsp;node,&nbsp;and&nbsp;all&nbsp;its&nbsp;children,&nbsp;to&nbsp;the&nbsp;document<br /></span><span style="color: #0000BB">$node&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$newdoc</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">importNode</span><span style="color: #007700">(</span><span style="color: #0000BB">$node</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">);<br /></span><span style="color: #FF8000">//&nbsp;And&nbsp;then&nbsp;append&nbsp;it&nbsp;to&nbsp;the&nbsp;"&lt;root&gt;"&nbsp;node<br /></span><span style="color: #0000BB">$newdoc</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">documentElement</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">appendChild</span><span style="color: #007700">(</span><span style="color: #0000BB">$node</span><span style="color: #007700">);<br /><br />echo&nbsp;</span><span style="color: #DD0000">"\nThe&nbsp;'new&nbsp;document'&nbsp;after&nbsp;copying&nbsp;the&nbsp;nodes&nbsp;into&nbsp;it:\n"</span><span style="color: #007700">;<br />echo&nbsp;</span><span style="color: #0000BB">$newdoc</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">saveXML</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>以上例程会输出：</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
The &#039;new document&#039; before copying nodes into it:
&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;root&gt;
  &lt;someelement&gt;text in some element&lt;/someelement&gt;
&lt;/root&gt;

The &#039;new document&#039; after copying the nodes into it:
&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;root&gt;
  &lt;someelement&gt;text in some element&lt;/someelement&gt;
  &lt;element&gt;
    &lt;child&gt;text in child&lt;/child&gt;
  &lt;/element&gt;
&lt;/root&gt;
</pre></div>
    </div>
   </div>
  </p>
 </div>

 

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="113191""></a>
  <div class="note">
   <strong class="user">rikdnua at mail dot ru</strong>
   <a href="#113191" class="date">11-Sep-2013 01:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The behavior of importNode($node, false) is different in PHP 5.2.9-2 and PHP 5.2.17.
<br />
The second option is explicitly set to false. In PHP 5.2.9-2 importNode() imports the elements WITHOUT attributes. In PHP 5.2.17 the elements imported ALONG with their attributes. 
<br />
<span class="default">&lt;?php
<br />
$xml</span><span class="keyword">=</span><span class="string">"
<br />
&lt;html&gt;
<br />
&lt;a href='yandex.com'&gt;Yandex.com&lt;/a&gt;
<br />
&lt;a href='rik.dn.ua'&gt;RiK.dn.ua&lt;/a&gt;
<br />
&lt;/html&gt;
<br />
"</span><span class="keyword">;
<br />
</span><span class="default">$doc</span><span class="keyword">=new </span><span class="default">domDocument</span><span class="keyword">(</span><span class="string">'1.0'</span><span class="keyword">);
<br />
</span><span class="default">$doc</span><span class="keyword">-&gt;</span><span class="default">loadXML</span><span class="keyword">(</span><span class="default">$xml</span><span class="keyword">);
<br />
</span><span class="default">$list</span><span class="keyword">=</span><span class="default">$doc</span><span class="keyword">-&gt;</span><span class="default">getElementsByTagName</span><span class="keyword">(</span><span class="string">'a'</span><span class="keyword">);
<br />
</span><span class="default">$doc1</span><span class="keyword">=new </span><span class="default">domDocument</span><span class="keyword">(</span><span class="string">'1.0'</span><span class="keyword">);
<br />
</span><span class="default">$doc1</span><span class="keyword">-&gt;</span><span class="default">formatOutput</span><span class="keyword">=</span><span class="default">true</span><span class="keyword">;
<br />
for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">$list</span><span class="keyword">-&gt;</span><span class="default">length</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) </span><span class="default">$doc1</span><span class="keyword">-&gt;</span><span class="default">appendChild</span><span class="keyword">(</span><span class="default">$doc1</span><span class="keyword">-&gt;</span><span class="default">importNode</span><span class="keyword">(</span><span class="default">$list</span><span class="keyword">-&gt;</span><span class="default">item</span><span class="keyword">(</span><span class="default">$i</span><span class="keyword">), </span><span class="default">false</span><span class="keyword">));
<br />
</span><span class="default">$doc1</span><span class="keyword">-&gt;</span><span class="default">save</span><span class="keyword">(</span><span class="string">'file.xml'</span><span class="keyword">);
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
file.xml PHP 5.2.9-2
<br />
&lt;?xml version="1.0"?&gt;
<br />
&lt;a/&gt;
<br />
&lt;a/&gt;
<br />

<br />
file.xml PHP 5.2.17
<br />
&lt;?xml version="1.0"?&gt;
<br />
&lt;a href="yandex.com"/&gt;
<br />
&lt;a href="rik.dn.ua"/&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="94153""></a>
  <div class="note">
   <strong class="user">c dot 1 at smithies dot org</strong>
   <a href="#94153" class="date">19-Oct-2009 06:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Assume that $source and $dest are instances of DOMDocument. Assume that $sourcedoc contains an element with ID 'sourceID' and that $destdoc contains an element with ID 'destID'. Assume that we have already set up source and destination element variables thus:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;$src </span><span class="keyword">= </span><span class="default">$sourcedoc</span><span class="keyword">-&gt;</span><span class="default">getElementById</span><span class="keyword">(</span><span class="string">'sourceID'</span><span class="keyword">);<br />
&nbsp;</span><span class="default">$dst </span><span class="keyword">= </span><span class="default">$destdoc</span><span class="keyword">-&gt;</span><span class="default">getElementById</span><span class="keyword">(</span><span class="string">'destID'</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Finally, assume that $sel has more than one child node.<br />
<br />
In order to import the child elements of $src as children of $dst, you might do something like this:<br />
<br />
<span class="default">&lt;?php<br />
$src </span><span class="keyword">= </span><span class="default">$dest</span><span class="keyword">-&gt;</span><span class="default">importNode</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">, </span><span class="default">TRUE</span><span class="keyword">);<br />
<br />
foreach (</span><span class="default">$src</span><span class="keyword">-&gt;</span><span class="default">childNodes </span><span class="keyword">as </span><span class="default">$el</span><span class="keyword">) </span><span class="default">$dst</span><span class="keyword">-&gt;</span><span class="default">appendChild</span><span class="keyword">(</span><span class="default">$el</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
But this does not work. foreach gets confused, because (as noted below) appending an imported element to another existing element in the same document causes it to be removed from its current parent element.<br />
<br />
Therefore, the following technique should be used:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">foreach (</span><span class="default">$src</span><span class="keyword">-&gt;</span><span class="default">childNodes </span><span class="keyword">as </span><span class="default">$el</span><span class="keyword">) </span><span class="default">$dst</span><span class="keyword">-&gt;</span><span class="default">appendChild</span><span class="keyword">(</span><span class="default">$destdoc</span><span class="keyword">-&gt;</span><span class="default">importNode</span><span class="keyword">(</span><span class="default">$el</span><span class="keyword">, </span><span class="default">TRUE</span><span class="keyword">));<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="87893""></a>
  <div class="note">
   <strong class="user">p dot reisinger at gmail dot com</strong>
   <a href="#87893" class="date">29-Dec-2008 03:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When you use function/method below, php automaticaly inserts namespaces (if you have some). If you want to join xml files exactly, then you can just use placeholders and treat xml as a string.<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">joinXMLStrings</span><span class="keyword">(</span><span class="default">$file1</span><span class="keyword">, </span><span class="default">$file2</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//remove xml declaration<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$file2 </span><span class="keyword">= </span><span class="default">trim</span><span class="keyword">(</span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/&lt;\?xml.*\?&gt;/'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$file2</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">));<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//insert file2 in the place of placeholder in the first file<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$file1 </span><span class="keyword">= </span><span class="default">trim</span><span class="keyword">(</span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/&lt;\?file2\s\?&gt;/'</span><span class="keyword">, </span><span class="default">$file2</span><span class="keyword">, </span><span class="default">$file1</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">));<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
so function looks like this and you insert two xml files. First file has to have placeholder (where you insert file2). Placeholder in this case will be &lt;?file2 ?&gt;<br />
<br />
!!!this is only for ilustration - test before you use it</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="87812""></a>
  <div class="note">
   <strong class="user">p dot reisinger at gmail dot com</strong>
   <a href="#87812" class="date">23-Dec-2008 07:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
method (can be used as a function as well) that joins two xml files. first argument is parent xml (the one to be inserted into), second child (the one to be inserted) and third is optional argument that specifies the parent's tag where to insert children xml. If not specified then children is inserted as the last element, just before end of the root<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">protected function </span><span class="default">joinXML</span><span class="keyword">(</span><span class="default">$parent</span><span class="keyword">, </span><span class="default">$child</span><span class="keyword">, </span><span class="default">$tag </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$DOMChild </span><span class="keyword">= new </span><span class="default">DOMDocument</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$DOMChild</span><span class="keyword">-&gt;</span><span class="default">loadXML</span><span class="keyword">(</span><span class="default">$child</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$node </span><span class="keyword">= </span><span class="default">$DOMChild</span><span class="keyword">-&gt;</span><span class="default">documentElement</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$DOMParent </span><span class="keyword">= new </span><span class="default">DOMDocument</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$DOMParent</span><span class="keyword">-&gt;</span><span class="default">formatOutput </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$DOMParent</span><span class="keyword">-&gt;</span><span class="default">loadXML</span><span class="keyword">(</span><span class="default">$parent</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$node </span><span class="keyword">= </span><span class="default">$DOMParent</span><span class="keyword">-&gt;</span><span class="default">importNode</span><span class="keyword">(</span><span class="default">$node</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$tag </span><span class="keyword">!== </span><span class="default">null</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tag </span><span class="keyword">= </span><span class="default">$DOMParent</span><span class="keyword">-&gt;</span><span class="default">getElementsByTagName</span><span class="keyword">(</span><span class="default">$tag</span><span class="keyword">)-&gt;</span><span class="default">item</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tag</span><span class="keyword">-&gt;</span><span class="default">appendChild</span><span class="keyword">(</span><span class="default">$node</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$DOMParent</span><span class="keyword">-&gt;</span><span class="default">documentElement</span><span class="keyword">-&gt;</span><span class="default">appendChild</span><span class="keyword">(</span><span class="default">$node</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$DOMParent</span><span class="keyword">-&gt;</span><span class="default">saveXML</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83778""></a>
  <div class="note">
   <strong class="user">mailme at sove dot nl</strong>
   <a href="#83778" class="date">11-Jun-2008 05:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
DOMDocument-&gt;importNode with seconds argument false will leave attributes behind. To fix this:<br />
<br />
$__DOM-&gt;importNode<br />
&nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp;&nbsp; $__INPUT-&gt;cloneNode(false), true<br />
&nbsp;&nbsp; );<br />
<br />
$__DOM (DOMDocument) will import the $__INPUT node (DOMElement) INCLUDING attributes.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74332""></a>
  <div class="note">
   <strong class="user">mark at 4inloop dot de</strong>
   <a href="#74332" class="date">05-Apr-2007 05:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When you left out the second argument or enter false, not only the child nodes are ommited. The attributes of the node are also cut off.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="70177""></a>
  <div class="note">
   <strong class="user">adjwilli</strong>
   <a href="#70177" class="date">05-Oct-2006 01:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Editing XML with PHP can be a pain in the Secretary of State Powell, so here's a script to replace an XML node with a user-provided one through the POST. It's usually a good idea to run the $_POST['xml'] through a validation check and clean it for other thing before running this.<br />
<br />
Pretty much this script expects a user-provided node called $_POST['xml'] and the XPath of the node in the original document that you want to replace called $_POST['XPath']. It also loads the original XML document from $xml. The function nodeRunner begins with the root node of the document you're editting and the XPath for the root element (these are more to make recursion easy than anything else).<br />
<br />
$doc = new DOMDocument();<br />
$doc-&gt;loadXML($xml); // $xml expects an XML string<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
function nodeRunner ($node,$xpath) {<br />
&nbsp;&nbsp;&nbsp; global $doc;<br />
&nbsp;&nbsp;&nbsp; if ($xpath == $_POST['XPath']) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $xmlPost = new DOMDocument();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $xmlPost-&gt;loadXML($_POST['xml']);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $newNode = $doc-&gt;importNode($xmlPost-&gt;firstChild,true);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $node-&gt;parentNode-&gt;replaceChild($newNode,$node);<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $page = 1;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $section = 1;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ($node-&gt;hasChildNodes()) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach ($node-&gt;childNodes as $nodling) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $nodeName = $nodling-&gt;nodeName;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($nodeName == 'page' || $nodeName == 'section') {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; nodeRunner ($nodling,$xpath."/".$nodeName."[".$$nodeName."]");<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $$nodeName++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
&nbsp;&nbsp;&nbsp; <br />
nodeRunner ($doc-&gt;documentElement,"/root[1]"); // /root should be explicit name of the root&nbsp; element of the XPath<br />
&nbsp;&nbsp;&nbsp; <br />
$doc-&gt;saveXML();</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69746""></a>
  <div class="note">
   <strong class="user">stomas</strong>
   <a href="#69746" class="date">19-Sep-2006 06:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I think this should do the same:<br />
<br />
&lt;?<br />
&nbsp;// Import $b into $a's document<br />
&nbsp;function myimport($a, $b)<br />
&nbsp;{<br />
&nbsp;&nbsp; if ($a-&gt;ownerDocument-&gt;isSameNode($b-&gt;ownerDocument))<br />
&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; return $b-&gt;cloneNode(TRUE);<br />
&nbsp;&nbsp; }<br />
&nbsp;&nbsp; else<br />
&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; return $a-&gt;ownerDocument-&gt;importNode($b, TRUE);<br />
&nbsp;&nbsp; }<br />
&nbsp;}<br />
&nbsp;?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69607""></a>
  <div class="note">
   <strong class="user">Colin</strong>
   <a href="#69607" class="date">12-Sep-2006 09:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As of PHP 5.1.6 with libxml 2.6.26 and DOM/XML API version 20031129, importNode() does nothing if attempting to import from the same document.&nbsp; Meaning, if you do an $ret = importNode and then appendChild($ret) or insertBefore($ret, ...) then you will end up *moving* the node instead of ending up with a copy.<br />
<br />
If you expect importNode to give you a copy of the source (in this case, a deep copy) then you must account for them being from the same document.&nbsp; This function addresses this:<br />
<br />
&lt;?<br />
// Import $b into $a's document<br />
function myimport($a, $b)<br />
{<br />
&nbsp; if ($a-&gt;ownerDocument-&gt;isSameNode($b-&gt;ownerDocument))<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; $temp = new DOMDocument();<br />
&nbsp;&nbsp;&nbsp; $ret = $temp-&gt;importNode($b, TRUE);<br />
&nbsp;&nbsp;&nbsp; return $a-&gt;ownerDocument-&gt;importNode($ret, TRUE);<br />
&nbsp; }<br />
&nbsp; else<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; return $a-&gt;ownerDocument-&gt;importNode($b, TRUE);<br />
&nbsp; }<br />
}<br />
?&gt;<br />
<br />
(Function was freshly coded for this note but I based it off another, working function of mine.)<br />
<br />
This function checks if the documents are the same and uses a new document (guaranteed to be different this way) to force a copy into $temp and then force a copy back into $a-&gt;ownerDocument.<br />
<br />
Obviously, no error checking has been done.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68909""></a>
  <div class="note">
   <strong class="user">andy dot clark at dial dot pipex dot com</strong>
   <a href="#68909" class="date">15-Aug-2006 08:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
One useful use of importNode is to copy one node onto another.<br />
<br />
function CopyXMLNode($SourceNode,$DestNode)<br />
&nbsp;{<br />
&nbsp; if ($SourceNode-&gt;nodeName != '#text')<br />
&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; //Copy this node<br />
&nbsp;&nbsp;&nbsp; $node = $DestNode-&gt;ownerDocument-&gt;importNode($SourceNode, true);<br />
&nbsp;&nbsp;&nbsp; $node = $DestNode-&gt;appendChild($node);<br />
&nbsp;&nbsp;&nbsp; //Now copy the child nodes<br />
&nbsp;&nbsp;&nbsp; foreach ($SourceNode-&gt;childNodes AS $item)<br />
&nbsp;&nbsp; &nbsp; {<br />
&nbsp;&nbsp; &nbsp; $this-&gt;CopyXMLNode($item,$node);<br />
&nbsp;&nbsp; &nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="55453""></a>
  <div class="note">
   <strong class="user">Fitopaldi</strong>
   <a href="#55453" class="date">03-Aug-2005 11:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
importNode returns a copy of the node to import and associates it with the current document, but not import the node to the current DOMDocument. Use appendChild for import the copy of the node to current DOMDocument.<br />
<br />
&lt;?<br />
&nbsp;$domNode = $dom-&gt;importNode($aDomNode, true);<br />
&nbsp;$currentDomDocument-&gt;appendChild($domNode);<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
