<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>对变量进行 JSON 编码</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.json-decode.html">? json_decode</a></li>
      <li style="float: right;"><a href="function.json-last-error-msg.html">json_last_error_msg ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.json.html">JSON 函数</a></li>
    <li>对变量进行 JSON 编码</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.json-encode" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">json_encode</h1>
  <p class="verinfo">(PHP 5 &gt;= 5.2.0, PHP 7, PECL json &gt;= 1.2.0)</p><p class="refpurpose"><span class="refname">json_encode</span> &mdash; <span class="dc-title">对变量进行 JSON 编码</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-function.json-encode-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>json_encode</strong></span>
    ( <span class="methodparam"><span class="type"><a href="language.pseudo-types.html#language.types.mixed" class="type mixed">mixed</a></span> <code class="parameter">$value</code></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$options</code><span class="initializer"> = 0</span></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$depth</code><span class="initializer"> = 512</span></span>
  ]] ) : <span class="type">string</span></div>

  <p class="para rdfs-comment">
   返回字符串，包含了 <code class="parameter">value</code> 值 JSON 形式的表示。
  </p>
  <p class="para">
   编码受传入的 <code class="parameter">options</code> 参数影响，此外浮点值的编码依赖于  <a href="ini.core.html#ini.serialize-precision" class="link">serialize_precision</a>。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.json-encode-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">value</code></dt>

     <dd>

      <p class="para">
       待编码的 <code class="parameter">value</code> ，除了<span class="type"><a href="language.types.resource.html" class="type resource">resource</a></span>
       类型之外，可以为任何数据类型。
      </p>
      <p class="para">
       所有字符串数据的编码必须是 UTF-8。
      </p>
      
 <blockquote class="note"><p><strong class="note">Note</strong>: 
  <p class="para">
   PHP implements a superset of JSON as specified in the original
   <a href="http://www.faqs.org/rfcs/rfc7159" class="link external" title="Link : http://www.faqs.org/rfcs/rfc7159">&raquo;&nbsp;RFC 7159</a>.
  </p>
 </p></blockquote>

     </dd>

    
    
     <dt>
<code class="parameter">options</code></dt>

     <dd>

      <p class="para">
       由以下常量组成的二进制掩码： <strong><code>JSON_HEX_QUOT</code></strong>,
       <strong><code>JSON_HEX_TAG</code></strong>,
       <strong><code>JSON_HEX_AMP</code></strong>,
       <strong><code>JSON_HEX_APOS</code></strong>,
       <strong><code>JSON_NUMERIC_CHECK</code></strong>,
       <strong><code>JSON_PRETTY_PRINT</code></strong>,
       <strong><code>JSON_UNESCAPED_SLASHES</code></strong>,
       <strong><code>JSON_FORCE_OBJECT</code></strong>,
       <strong><code>JSON_PRESERVE_ZERO_FRACTION</code></strong>,
       <strong><code>JSON_UNESCAPED_UNICODE</code></strong>,
       <strong><code>JSON_PARTIAL_OUTPUT_ON_ERROR</code></strong>。
       关于 JSON 常量详情参考<a href="json.constants.html" class="link">JSON 常量</a>页面。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">depth</code></dt>

     <dd>

      <p class="para">
       设置最大深度。 必须大于0。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.json-encode-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   成功则返回 JSON 编码的 <span class="type"><a href="language.types.string.html" class="type string">string</a></span>  或者在失败时返回 <strong><code>FALSE</code></strong> 。
  </p>
 </div>



 <div class="refsect1 changelog" id="refsect1-function.json-encode-changelog">
  <h3 class="title">更新日志</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead>
      <tr>
       <th>版本</th>
       <th>说明</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
       <td>7.1.0</td>
       <td>
        对 Double 的值进行编码时，使用 <a href="ini.core.html#ini.serialize-precision" class="link">serialize_precision</a> 代替 <a href="ini.core.html#ini.precision" class="link">precision</a>。
       </td>
      </tr>

      <tr>
       <td>5.6.6</td>
       <td>
        <code class="parameter">options</code> 参数增加常量：
        <strong><code>JSON_PRESERVE_ZERO_FRACTION</code></strong>
       </td>
      </tr>

      <tr>
       <td>5.5.0</td>
       <td>
        增加 <code class="parameter">depth</code> 参数。
       </td>
      </tr>

      
      <tr>
       <td>5.5.0</td>
       <td>
       增加了  <strong><code>JSON_PARTIAL_OUTPUT_ON_ERROR</code></strong> 选项。
       </td>
      </tr>

      <tr>
       <td>5.5.0</td>
       <td>
        失败时返回的值从 <em>null</em> 字符串改成 <strong><code>FALSE</code></strong>。
       </td>
      </tr>

      <tr>
       <td>5.4.0</td>
       <td>
        <code class="parameter">options</code> 参数增加常量：
        <strong><code>JSON_PRETTY_PRINT</code></strong>, <strong><code>JSON_UNESCAPED_SLASHES</code></strong>, 和 <strong><code>JSON_UNESCAPED_UNICODE</code></strong>。
       </td>
      </tr>

      <tr>
       <td>5.3.3</td>
       <td>
        <code class="parameter">options</code> 参数增加常量：<strong><code>JSON_NUMERIC_CHECK</code></strong>。
       </td>
      </tr>

      <tr>
       <td>5.3.0</td>
       <td>
        增加 <code class="parameter">options</code> 参数.
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>

 <div class="refsect1 examples" id="refsect1-function.json-encode-examples">
  <h3 class="title">范例</h3>
  <p class="para">
   <div class="example" id="example-4553">
    <p><strong>Example #1 <span class="function"><strong>json_encode()</strong></span> 例子</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$arr&nbsp;</span><span style="color: #007700">=&nbsp;array&nbsp;(</span><span style="color: #DD0000">'a'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">1</span><span style="color: #007700">,</span><span style="color: #DD0000">'b'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">2</span><span style="color: #007700">,</span><span style="color: #DD0000">'c'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">3</span><span style="color: #007700">,</span><span style="color: #DD0000">'d'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">4</span><span style="color: #007700">,</span><span style="color: #DD0000">'e'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">5</span><span style="color: #007700">);<br /><br />echo&nbsp;</span><span style="color: #0000BB">json_encode</span><span style="color: #007700">(</span><span style="color: #0000BB">$arr</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>以上例程会输出：</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
{&quot;a&quot;:1,&quot;b&quot;:2,&quot;c&quot;:3,&quot;d&quot;:4,&quot;e&quot;:5}
</pre></div>
    </div>
   </div>
   
   <div class="example" id="example-4554">
    <p><strong>Example #2  <span class="function"><strong>json_encode()</strong></span> 函数中 <code class="parameter">options</code> 参数的用法</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$a&nbsp;</span><span style="color: #007700">=&nbsp;array(</span><span style="color: #DD0000">'&lt;foo&gt;'</span><span style="color: #007700">,</span><span style="color: #DD0000">"'bar'"</span><span style="color: #007700">,</span><span style="color: #DD0000">'"baz"'</span><span style="color: #007700">,</span><span style="color: #DD0000">'&amp;blong&amp;'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"\xc3\xa9"</span><span style="color: #007700">);<br /><br />echo&nbsp;</span><span style="color: #DD0000">"Normal:&nbsp;"</span><span style="color: #007700">,&nbsp;&nbsp;</span><span style="color: #0000BB">json_encode</span><span style="color: #007700">(</span><span style="color: #0000BB">$a</span><span style="color: #007700">),&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br />echo&nbsp;</span><span style="color: #DD0000">"Tags:&nbsp;"</span><span style="color: #007700">,&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">json_encode</span><span style="color: #007700">(</span><span style="color: #0000BB">$a</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">JSON_HEX_TAG</span><span style="color: #007700">),&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br />echo&nbsp;</span><span style="color: #DD0000">"Apos:&nbsp;"</span><span style="color: #007700">,&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">json_encode</span><span style="color: #007700">(</span><span style="color: #0000BB">$a</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">JSON_HEX_APOS</span><span style="color: #007700">),&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br />echo&nbsp;</span><span style="color: #DD0000">"Quot:&nbsp;"</span><span style="color: #007700">,&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">json_encode</span><span style="color: #007700">(</span><span style="color: #0000BB">$a</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">JSON_HEX_QUOT</span><span style="color: #007700">),&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br />echo&nbsp;</span><span style="color: #DD0000">"Amp:&nbsp;"</span><span style="color: #007700">,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">json_encode</span><span style="color: #007700">(</span><span style="color: #0000BB">$a</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">JSON_HEX_AMP</span><span style="color: #007700">),&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br />echo&nbsp;</span><span style="color: #DD0000">"Unicode:&nbsp;"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">json_encode</span><span style="color: #007700">(</span><span style="color: #0000BB">$a</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">JSON_UNESCAPED_UNICODE</span><span style="color: #007700">),&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br />echo&nbsp;</span><span style="color: #DD0000">"All:&nbsp;"</span><span style="color: #007700">,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">json_encode</span><span style="color: #007700">(</span><span style="color: #0000BB">$a</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">JSON_HEX_TAG&nbsp;</span><span style="color: #007700">|&nbsp;</span><span style="color: #0000BB">JSON_HEX_APOS&nbsp;</span><span style="color: #007700">|&nbsp;</span><span style="color: #0000BB">JSON_HEX_QUOT&nbsp;</span><span style="color: #007700">|&nbsp;</span><span style="color: #0000BB">JSON_HEX_AMP&nbsp;</span><span style="color: #007700">|&nbsp;</span><span style="color: #0000BB">JSON_UNESCAPED_UNICODE</span><span style="color: #007700">),&nbsp;</span><span style="color: #DD0000">"\n\n"</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$b&nbsp;</span><span style="color: #007700">=&nbsp;array();<br /><br />echo&nbsp;</span><span style="color: #DD0000">"Empty&nbsp;array&nbsp;output&nbsp;as&nbsp;array:&nbsp;"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">json_encode</span><span style="color: #007700">(</span><span style="color: #0000BB">$b</span><span style="color: #007700">),&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br />echo&nbsp;</span><span style="color: #DD0000">"Empty&nbsp;array&nbsp;output&nbsp;as&nbsp;object:&nbsp;"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">json_encode</span><span style="color: #007700">(</span><span style="color: #0000BB">$b</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">JSON_FORCE_OBJECT</span><span style="color: #007700">),&nbsp;</span><span style="color: #DD0000">"\n\n"</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$c&nbsp;</span><span style="color: #007700">=&nbsp;array(array(</span><span style="color: #0000BB">1</span><span style="color: #007700">,</span><span style="color: #0000BB">2</span><span style="color: #007700">,</span><span style="color: #0000BB">3</span><span style="color: #007700">));<br /><br />echo&nbsp;</span><span style="color: #DD0000">"Non-associative&nbsp;array&nbsp;output&nbsp;as&nbsp;array:&nbsp;"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">json_encode</span><span style="color: #007700">(</span><span style="color: #0000BB">$c</span><span style="color: #007700">),&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br />echo&nbsp;</span><span style="color: #DD0000">"Non-associative&nbsp;array&nbsp;output&nbsp;as&nbsp;object:&nbsp;"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">json_encode</span><span style="color: #007700">(</span><span style="color: #0000BB">$c</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">JSON_FORCE_OBJECT</span><span style="color: #007700">),&nbsp;</span><span style="color: #DD0000">"\n\n"</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$d&nbsp;</span><span style="color: #007700">=&nbsp;array(</span><span style="color: #DD0000">'foo'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'bar'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'baz'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'long'</span><span style="color: #007700">);<br /><br />echo&nbsp;</span><span style="color: #DD0000">"Associative&nbsp;array&nbsp;always&nbsp;output&nbsp;as&nbsp;object:&nbsp;"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">json_encode</span><span style="color: #007700">(</span><span style="color: #0000BB">$d</span><span style="color: #007700">),&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br />echo&nbsp;</span><span style="color: #DD0000">"Associative&nbsp;array&nbsp;always&nbsp;output&nbsp;as&nbsp;object:&nbsp;"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">json_encode</span><span style="color: #007700">(</span><span style="color: #0000BB">$d</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">JSON_FORCE_OBJECT</span><span style="color: #007700">),&nbsp;</span><span style="color: #DD0000">"\n\n"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>以上例程会输出：</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
Normal: [&quot;&lt;foo&gt;&quot;,&quot;&#039;bar&#039;&quot;,&quot;\&quot;baz\&quot;&quot;,&quot;&amp;blong&amp;&quot;,&quot;\u00e9&quot;]
Tags: [&quot;\u003Cfoo\u003E&quot;,&quot;&#039;bar&#039;&quot;,&quot;\&quot;baz\&quot;&quot;,&quot;&amp;blong&amp;&quot;,&quot;\u00e9&quot;]
Apos: [&quot;&lt;foo&gt;&quot;,&quot;\u0027bar\u0027&quot;,&quot;\&quot;baz\&quot;&quot;,&quot;&amp;blong&amp;&quot;,&quot;\u00e9&quot;]
Quot: [&quot;&lt;foo&gt;&quot;,&quot;&#039;bar&#039;&quot;,&quot;\u0022baz\u0022&quot;,&quot;&amp;blong&amp;&quot;,&quot;\u00e9&quot;]
Amp: [&quot;&lt;foo&gt;&quot;,&quot;&#039;bar&#039;&quot;,&quot;\&quot;baz\&quot;&quot;,&quot;\u0026blong\u0026&quot;,&quot;\u00e9&quot;]
Unicode: [&quot;&lt;foo&gt;&quot;,&quot;&#039;bar&#039;&quot;,&quot;\&quot;baz\&quot;&quot;,&quot;&amp;blong&amp;&quot;,&quot;é&quot;]
All: [&quot;\u003Cfoo\u003E&quot;,&quot;\u0027bar\u0027&quot;,&quot;\u0022baz\u0022&quot;,&quot;\u0026blong\u0026&quot;,&quot;é&quot;]

Empty array output as array: []
Empty array output as object: {}

Non-associative array output as array: [[1,2,3]]
Non-associative array output as object: {&quot;0&quot;:{&quot;0&quot;:1,&quot;1&quot;:2,&quot;2&quot;:3}}

Associative array always output as object: {&quot;foo&quot;:&quot;bar&quot;,&quot;baz&quot;:&quot;long&quot;}
Associative array always output as object: {&quot;foo&quot;:&quot;bar&quot;,&quot;baz&quot;:&quot;long&quot;}
</pre></div>
    </div>
   </div>
   <div class="example" id="example-4555">
    <p><strong>Example #3 选项 JSON_NUMERIC_CHECK 例子</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #DD0000">"Strings&nbsp;representing&nbsp;numbers&nbsp;automatically&nbsp;turned&nbsp;into&nbsp;numbers"</span><span style="color: #007700">.</span><span style="color: #0000BB">PHP_EOL</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$numbers&nbsp;</span><span style="color: #007700">=&nbsp;array(</span><span style="color: #DD0000">'+123123'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'-123123'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'1.2e3'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'0.00001'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(<br />&nbsp;</span><span style="color: #0000BB">$numbers</span><span style="color: #007700">,<br />&nbsp;</span><span style="color: #0000BB">json_encode</span><span style="color: #007700">(</span><span style="color: #0000BB">$numbers</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">JSON_NUMERIC_CHECK</span><span style="color: #007700">)<br />);<br />echo&nbsp;</span><span style="color: #DD0000">"Strings&nbsp;containing&nbsp;improperly&nbsp;formatted&nbsp;numbers"</span><span style="color: #007700">.</span><span style="color: #0000BB">PHP_EOL</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$strings&nbsp;</span><span style="color: #007700">=&nbsp;array(</span><span style="color: #DD0000">'+a33123456789'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'a123'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(<br />&nbsp;</span><span style="color: #0000BB">$strings</span><span style="color: #007700">,<br />&nbsp;</span><span style="color: #0000BB">json_encode</span><span style="color: #007700">(</span><span style="color: #0000BB">$strings</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">JSON_NUMERIC_CHECK</span><span style="color: #007700">)<br />);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>以上例程的输出类似于：</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
Strings representing numbers automatically turned into numbers
array(4) {
  [0]=&gt;
  string(7) &quot;+123123&quot;
  [1]=&gt;
  string(7) &quot;-123123&quot;
  [2]=&gt;
  string(5) &quot;1.2e3&quot;
  [3]=&gt;
  string(7) &quot;0.00001&quot;
}
string(28) &quot;[123123,-123123,1200,1.0e-5]&quot;
Strings containing improperly formatted numbers
array(2) {
  [0]=&gt;
  string(13) &quot;+a33123456789&quot;
  [1]=&gt;
  string(4) &quot;a123&quot;
}
string(24) &quot;[&quot;+a33123456789&quot;,&quot;a123&quot;]&quot;
</pre></div>
    </div>
   </div>
   <div class="example" id="example-4556">
    <p><strong>Example #4 连续与非连续数组示例</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #DD0000">"连续数组"</span><span style="color: #007700">.</span><span style="color: #0000BB">PHP_EOL</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$sequential&nbsp;</span><span style="color: #007700">=&nbsp;array(</span><span style="color: #DD0000">"foo"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"bar"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"baz"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"blong"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(<br />&nbsp;</span><span style="color: #0000BB">$sequential</span><span style="color: #007700">,<br />&nbsp;</span><span style="color: #0000BB">json_encode</span><span style="color: #007700">(</span><span style="color: #0000BB">$sequential</span><span style="color: #007700">)<br />);<br /><br />echo&nbsp;</span><span style="color: #0000BB">PHP_EOL</span><span style="color: #007700">.</span><span style="color: #DD0000">"非连续数组"</span><span style="color: #007700">.</span><span style="color: #0000BB">PHP_EOL</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$nonsequential&nbsp;</span><span style="color: #007700">=&nbsp;array(</span><span style="color: #0000BB">1</span><span style="color: #007700">=&gt;</span><span style="color: #DD0000">"foo"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">2</span><span style="color: #007700">=&gt;</span><span style="color: #DD0000">"bar"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">3</span><span style="color: #007700">=&gt;</span><span style="color: #DD0000">"baz"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">4</span><span style="color: #007700">=&gt;</span><span style="color: #DD0000">"blong"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(<br />&nbsp;</span><span style="color: #0000BB">$nonsequential</span><span style="color: #007700">,<br />&nbsp;</span><span style="color: #0000BB">json_encode</span><span style="color: #007700">(</span><span style="color: #0000BB">$nonsequential</span><span style="color: #007700">)<br />);<br /><br />echo&nbsp;</span><span style="color: #0000BB">PHP_EOL</span><span style="color: #007700">.</span><span style="color: #DD0000">"删除一个连续数组值的方式产生的非连续数组"</span><span style="color: #007700">.</span><span style="color: #0000BB">PHP_EOL</span><span style="color: #007700">;<br />unset(</span><span style="color: #0000BB">$sequential</span><span style="color: #007700">[</span><span style="color: #0000BB">1</span><span style="color: #007700">]);<br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(<br />&nbsp;</span><span style="color: #0000BB">$sequential</span><span style="color: #007700">,<br />&nbsp;</span><span style="color: #0000BB">json_encode</span><span style="color: #007700">(</span><span style="color: #0000BB">$sequential</span><span style="color: #007700">)<br />);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>以上例程会输出：</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
连续数组
array(4) {
  [0]=&gt;
  string(3) &quot;foo&quot;
  [1]=&gt;
  string(3) &quot;bar&quot;
  [2]=&gt;
  string(3) &quot;baz&quot;
  [3]=&gt;
  string(5) &quot;blong&quot;
}
string(27) &quot;[&quot;foo&quot;,&quot;bar&quot;,&quot;baz&quot;,&quot;blong&quot;]&quot;

非连续数组
array(4) {
  [1]=&gt;
  string(3) &quot;foo&quot;
  [2]=&gt;
  string(3) &quot;bar&quot;
  [3]=&gt;
  string(3) &quot;baz&quot;
  [4]=&gt;
  string(5) &quot;blong&quot;
}
string(43) &quot;{&quot;1&quot;:&quot;foo&quot;,&quot;2&quot;:&quot;bar&quot;,&quot;3&quot;:&quot;baz&quot;,&quot;4&quot;:&quot;blong&quot;}&quot;

删除一个连续数组值的方式产生的非连续数组
array(3) {
  [0]=&gt;
  string(3) &quot;foo&quot;
  [2]=&gt;
  string(3) &quot;baz&quot;
  [3]=&gt;
  string(5) &quot;blong&quot;
}
string(33) &quot;{&quot;0&quot;:&quot;foo&quot;,&quot;2&quot;:&quot;baz&quot;,&quot;3&quot;:&quot;blong&quot;}&quot;
</pre></div>
    </div>
   </div>
   <div class="example" id="example-4557">
    <p><strong>Example #5 <strong><code>选项 JSON_PRESERVE_ZERO_FRACTION</code></strong> 的例子</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">json_encode</span><span style="color: #007700">(</span><span style="color: #0000BB">12.0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">JSON_PRESERVE_ZERO_FRACTION</span><span style="color: #007700">));<br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">json_encode</span><span style="color: #007700">(</span><span style="color: #0000BB">12.0</span><span style="color: #007700">));<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>以上例程会输出：</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
string(4) &quot;12.0&quot;
string(2) &quot;12&quot;
</pre></div>
    </div>
   </div>
  </p>
 </div>



 <div class="refsect1 notes" id="refsect1-function.json-encode-notes">
  <h3 class="title">注释</h3>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    如果执行失败，可以通过 <span class="function"><a href="function.json-last-error.html" class="function">json_last_error()</a></span> 函数来获取详细错误信息。
   </p>
  </p></blockquote>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    如果要编码的数组的键不是从0开始的数字，所有的键将会被当作字符串，并明确声明为 key-value 对。
   </p>
  </p></blockquote>
  
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    Like the reference JSON encoder, <span class="function"><strong>json_encode()</strong></span> will
    generate JSON that is a simple value (that is, neither an object nor an
    array) if given a <span class="type"><a href="language.types.string.html" class="type string">string</a></span>, <span class="type"><a href="language.types.integer.html" class="type integer">integer</a></span>,
    <span class="type"><a href="language.types.float.html" class="type float">float</a></span> or <span class="type"><a href="language.types.boolean.html" class="type boolean">boolean</a></span> as an input
    <code class="parameter">value</code>. While most decoders will accept these values
    as valid JSON, some may not, as the specification is ambiguous on this
    point.
   </p>
   <p class="para">
    总而言之，应该测试下 JSON decoder 能否处理 <span class="function"><strong>json_encode()</strong></span> 生成的数据。
   </p>
  </p></blockquote>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.json-encode-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="interfacename"><a href="class.jsonserializable.html" class="interfacename">JsonSerializable</a></span></li>
    <li class="member"><span class="function"><a href="function.json-decode.html" class="function" rel="rdfs-seeAlso">json_decode()</a> - 对 JSON 格式的字符串进行解码</span></li>
    <li class="member"><span class="function"><a href="function.json-last-error.html" class="function" rel="rdfs-seeAlso">json_last_error()</a> - 返回最后发生的错误</span></li>
    <li class="member"><span class="function"><a href="function.serialize.html" class="function" rel="rdfs-seeAlso">serialize()</a> - 产生一个可存储的值的表示</span></li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="124723""></a>
  <div class="note">
   <strong class="user">msegit post pl</strong>
   <a href="#124723" class="date">16-Feb-2020 05:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note, string keys have to be UTF-8 also! (So array_walk_recursive() isn't good way)<br />
<br />
Consider this solution for fixing invalid UTF-8:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">//$a=array('za?ó?? g??l? ja? ZA?ó?? G??L? JA??', 'Pai?ao'=&gt;3, 4=&gt;array('=&gt;5, '', 6));<br />
</span><span class="default">$a</span><span class="keyword">=array(</span><span class="default">urldecode</span><span class="keyword">(</span><span class="string">'za%BF%F3%B3%E6+g%EA%9Cl%B9+ja%9F%F1+ZA%AF%D3%A3%C6+G%CA%8CL%A5+JA%8F%D1'</span><span class="keyword">), </span><span class="default">urldecode</span><span class="keyword">(</span><span class="string">'Pai%E7ao'</span><span class="keyword">)=&gt;</span><span class="default">3</span><span class="keyword">, </span><span class="default">4</span><span class="keyword">=&gt;array(</span><span class="string">''</span><span class="keyword">=&gt;</span><span class="default">5</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">6</span><span class="keyword">)); </span><span class="comment">// (for better example, independent of .php file charset)<br />
<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Normal test<br />
</span><span class="keyword">echo </span><span class="default">json_encode</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">, </span><span class="default">JSON_UNESCAPED_UNICODE </span><span class="keyword">| </span><span class="default">JSON_UNESCAPED_SLASHES </span><span class="keyword">| </span><span class="default">JSON_FORCE_OBJECT </span><span class="keyword">| </span><span class="default">JSON_UNESCAPED_SLASHES</span><span class="keyword">);<br />
</span><span class="comment">// Kind of error depends on PHP version...:<br />
// false or '{"0":null,null:3,"4":{null:5,"0":null,"1":6}}'<br />
<br />
</span><span class="keyword">if (!</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">'urlencode_recurs'</span><span class="keyword">)) {<br />
function </span><span class="default">urlencode_recurs</span><span class="keyword">(&amp;</span><span class="default">$arr</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$arr </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; &amp;</span><span class="default">$val</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">urlencode_recurs</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$newarr</span><span class="keyword">[(</span><span class="default">is_string</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">) ? </span><span class="default">urlencode</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">) : </span><span class="default">$key</span><span class="keyword">)] = </span><span class="default">$val</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">// Not $arr[...] = ..., to preserve keys/elements order<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">} else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$newarr</span><span class="keyword">[(</span><span class="default">is_string</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">) ? </span><span class="default">urlencode</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">) : </span><span class="default">$key</span><span class="keyword">)] = (</span><span class="default">is_string</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">) ? </span><span class="default">urlencode</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">) : </span><span class="default">$val</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">// Not $arr[...] = ..., to preserve keys/elements order<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //if (is_string($key)) unset($arr[$key]);&nbsp; &nbsp; // Not this, to preserve keys/elements order, as above<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">}<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$arr </span><span class="keyword">= </span><span class="default">$newarr</span><span class="keyword">;<br />
} }<br />
<br />
if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">)) </span><span class="default">urlencode_recurs</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Fixed test<br />
</span><span class="keyword">echo </span><span class="default">urldecode</span><span class="keyword">(</span><span class="default">json_encode</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">, </span><span class="default">JSON_UNESCAPED_UNICODE </span><span class="keyword">| </span><span class="default">JSON_UNESCAPED_SLASHES </span><span class="keyword">| </span><span class="default">JSON_FORCE_OBJECT </span><span class="keyword">| </span><span class="default">JSON_UNESCAPED_SLASHES</span><span class="keyword">));<br />
</span><span class="comment">// '{"0":"za?ó?? g??l? ja? ZA?ó?? G??L? JA??","Pai?ao":3,"4":{"":5,"0":"","1":6}}'<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="124380""></a>
  <div class="note">
   <strong class="user">avner at klido dot net</strong>
   <a href="#124380" class="date">11-Nov-2019 06:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
json_encode will encode array as object if the array;s keys are not sequential starting with zero<br />
<br />
$a = [0=&gt;'a', 1=&gt;'b', 2=&gt;[0 =&gt; 'aa', 1 =&gt; 'c', 2 =&gt; 'dd']]; <br />
var_dump(json_encode($a));&nbsp; &nbsp;&nbsp; //["a","b",["aa","c","dd"]]<br />
<br />
$b = [1=&gt;'a', 2=&gt;'b', 3=&gt;[0 =&gt; 'aa', 1 =&gt; 'c', 2 =&gt; 'dd']]; <br />
var_dump(jsoon_encode($b));&nbsp; // {"1":"a","2":"b","3":["aa","c","dd"]}<br />
<br />
i would expect PHP to follow the original structure or at least add a parameter to do so</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="124372""></a>
  <div class="note">
   <strong class="user">jugcosta at ymail dot com</strong>
   <a href="#124372" class="date">06-Nov-2019 09:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
error_reporting</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">);<br />
</span><span class="default">ini_set</span><span class="keyword">(</span><span class="string">'display_errors'</span><span class="keyword">, </span><span class="default">FALSE</span><span class="keyword">);<br />
<br />
</span><span class="default">$file</span><span class="keyword">= </span><span class="default">__DIR__ </span><span class="keyword">. </span><span class="string">'/utf8.csv'</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">csvtojson</span><span class="keyword">(</span><span class="default">$inputFile</span><span class="keyword">,</span><span class="default">$delimiter</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ((</span><span class="default">$handleFile </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$inputFile</span><span class="keyword">, </span><span class="string">'r'</span><span class="keyword">)) == </span><span class="default">false</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="string">"N?o foi possível abrir o arquivo para importar: '</span><span class="default">$file</span><span class="string">'"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dados </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; while ((</span><span class="default">$data </span><span class="keyword">= </span><span class="default">fgetcsv</span><span class="keyword">(</span><span class="default">$handleFile</span><span class="keyword">, </span><span class="default">4000</span><span class="keyword">, </span><span class="default">$delimiter</span><span class="keyword">)) !== </span><span class="default">false</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">array_map</span><span class="keyword">(</span><span class="string">'trim'</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (! isset(</span><span class="default">$keys</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$keys </span><span class="keyword">= </span><span class="default">array_map</span><span class="keyword">(</span><span class="string">'trim'</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; continue;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dados</span><span class="keyword">[] =&nbsp; </span><span class="default">array_combine</span><span class="keyword">(</span><span class="default">$keys</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="default">json_encode</span><span class="keyword">(</span><span class="default">$dados</span><span class="keyword">, </span><span class="default">JSON_UNESCAPED_SLASHES </span><span class="keyword">| </span><span class="default">JSON_UNESCAPED_UNICODE </span><span class="keyword">|</span><span class="default">JSON_NUMERIC_CHECK </span><span class="keyword">| </span><span class="default">JSON_PRETTY_PRINT</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">$result</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$arquivo </span><span class="keyword">= </span><span class="string">"data_"</span><span class="keyword">.</span><span class="default">date</span><span class="keyword">(</span><span class="string">'ymdhis'</span><span class="keyword">).</span><span class="string">".json"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$arquivo</span><span class="keyword">, </span><span class="string">"a+"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$result</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$handleFile</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$jsonresult </span><span class="keyword">= </span><span class="default">csvtojson</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="string">";"</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="124256""></a>
  <div class="note">
   <strong class="user">karsten at dambekalns dot de</strong>
   <a href="#124256" class="date">01-Oct-2019 09:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Be aware that when an error occurs, the return value might be NULL unexpectedly. Example: When running this on PHP &lt; 7.3, you do not get back a string:<br />
<br />
json_encode('ok', JSON_THROW_ON_ERROR, 512);<br />
<br />
The constant not being available produces a warning and results in NULL being returned (see https://3v4l.org/ku5AH) - I'd expect false, since that's a failure, or "ok" as the encoded result. YMMV.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="123703""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#123703" class="date">19-Mar-2019 08:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
json_encode(), besides its obvious primary use case of sending data to the client, makes for an excellent alternative to var_dump() in combination with the JSONView browser extension. This is especially true if you're unable to install XDebug on your development machine for whatever reason and can't get their pretty-printed var_dump() function to work.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="119698""></a>
  <div class="note">
   <strong class="user">Nick</strong>
   <a href="#119698" class="date">04-Aug-2016 01:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Please note that there was an (as of yet) undocumented change to the json_encode() function between 2 versions of PHP with respect to JSON_PRETTY_PRINT:<br />
<br />
In version 5.4.21 and earlier, an empty array [] using JSON_PRETTY_PRINT would be rendered as 3 lines, with the 2nd one an empty (indented) line, i.e.:<br />
&nbsp;&nbsp;&nbsp; "data": [<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; ],<br />
<br />
In version 5.4.34 and above, an empty array [] using JSON_PRETTY_PRINT would be rendered as exactly [] at the spot where it occurs, i.e.<br />
&nbsp;&nbsp;&nbsp; "data: [],<br />
<br />
This is not mentioned anywhere in the PHP changelist and migration documentations; neither on the json_encode documentation page.<br />
<br />
This is very useful to know when you are parsing the JSON using regular expressions to manually insert portions of data, as is the case with my current use-case (working with JSON exports of over several gigabytes requires sub-operations and insertion of data).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="118902""></a>
  <div class="note">
   <strong class="user">ravenswd at gmail dot com</strong>
   <a href="#118902" class="date">25-Feb-2016 01:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This isn't mentioned in the documentation for either PHP or jQuery, but if you're passing JSON data to a javascript program, make sure your program begins with:<br />
<br />
<span class="default">&lt;?php<br />
header</span><span class="keyword">(</span><span class="string">'Content-Type: application/json'</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="118334""></a>
  <div class="note">
   <strong class="user">Walter Tross</strong>
   <a href="#118334" class="date">18-Nov-2015 10:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you need pretty-printed output, but want it indented by 2 spaces instead of 4:<br />
<br />
$json_indented_by_4 = json_encode($output, JSON_UNESCAPED_SLASHES|JSON_PRETTY_PRINT);<br />
$json_indented_by_2 = preg_replace('/^(&nbsp; +?)\\1(?=[^ ])/m', '$1', $json_indented_by_4);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="117023""></a>
  <div class="note">
   <strong class="user">Goran</strong>
   <a href="#117023" class="date">03-Apr-2015 07:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This function has weird behavior regarding error reporting in PHP version 5.4 or lower. This kind of warning is raised only if you configure PHP with "display_errors=Off" (!?): "PHP Warning:&nbsp; json_encode(): Invalid UTF-8 sequence in argument ..."<br />
<br />
You can reproduce this behavior:<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// Warning not displayed, not logged<br />
</span><span class="default">ini_set</span><span class="keyword">(</span><span class="string">'display_errors'</span><span class="keyword">, </span><span class="string">'1'</span><span class="keyword">);<br />
</span><span class="default">json_encode</span><span class="keyword">(</span><span class="default">urldecode</span><span class="keyword">(</span><span class="string">'bad utf string %C4_'</span><span class="keyword">));<br />
<br />
</span><span class="comment">// Warning not displayed but logged<br />
</span><span class="default">ini_set</span><span class="keyword">(</span><span class="string">'display_errors'</span><span class="keyword">, </span><span class="string">'0'</span><span class="keyword">);<br />
</span><span class="default">json_encode</span><span class="keyword">(</span><span class="default">urldecode</span><span class="keyword">(</span><span class="string">'bad utf string %C4_'</span><span class="keyword">));<br />
</span><span class="default">?&gt;<br />
</span><br />
This is considered feature - not-a-bug - by PHP devs:<br />
https://bugs.php.net/bug.php?id=52397<br />
https://bugs.php.net/bug.php?id=63004</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="115733""></a>
  <div class="note">
   <strong class="user">ninjSPAM at informanceSPAM dot info</strong>
   <a href="#115733" class="date">15-Sep-2014 09:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Although this is not documented on the version log here, non-UTF8 handling behaviour has changed in 5.5, in a way that can make debugging difficult.<br />
<br />
Passing a non UTF-8 string to json_encode() will make the function return false in PHP 5.5, while it will only nullify this string (and only this one) in previous versions.<br />
<br />
In a Latin-1 encoded file, write this:<br />
<span class="default">&lt;?php<br />
$a </span><span class="keyword">= array(</span><span class="string">'é'</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">json_encode</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">));<br />
</span><span class="default">?&gt;<br />
</span><br />
PHP &lt; 5.4:<br />
string(8) "[null,1]"<br />
<br />
PHP &gt;= 5.5:<br />
bool(false)<br />
<br />
PHP 5.5 has it right of course (if encoding fails, return false) but its likely to introduce errors when updating to 5.5 because previously you could get the rest of the JSON even when one string was not in UTF8 (if this string wasn't used, you'd never notify it's nulled)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="115655""></a>
  <div class="note">
   <strong class="user">Ray.Paseur often uses Gmail</strong>
   <a href="#115655" class="date">02-Sep-2014 06:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you're wondering whether a JSON string can be an analog of an XML document, the answer is probably "nope."&nbsp; XML supports attributes, but JSON does not.&nbsp; A JSON string generated by json_encode(), when called on a SimpleXML object, will not have the attributes and no error or exception will issue - the original data will simply be lost.&nbsp; To see this in action:<br />
<span class="default">&lt;?php <br />
error_reporting</span><span class="keyword">(</span><span class="default">E_ALL</span><span class="keyword">);<br />
echo </span><span class="string">'&lt;pre&gt;'</span><span class="keyword">;<br />
<br />
</span><span class="comment">// STARTING FROM XML<br />
</span><span class="default">$xml </span><span class="keyword">= &lt;&lt;&lt;EOD<br />
</span><span class="string">&lt;?xml version="1.0" ?&gt;<br />
&lt;ingredients&gt;<br />
&nbsp; &lt;ingredient&gt;<br />
&nbsp;&nbsp; &nbsp; &lt;name&gt;tomatoes&lt;/name&gt;<br />
&nbsp;&nbsp; &nbsp; &lt;quantity type="cup"&gt;4&lt;/quantity&gt;<br />
&nbsp; &lt;/ingredient&gt;<br />
&nbsp; &lt;ingredient&gt;<br />
&nbsp;&nbsp; &nbsp; &lt;name&gt;salt&lt;/name&gt;<br />
&nbsp;&nbsp; &nbsp; &lt;quantity type="tablespoon"&gt;2&lt;/quantity&gt;<br />
&nbsp; &lt;/ingredient&gt;<br />
&lt;/ingredients&gt;<br />
</span><span class="keyword">EOD;<br />
<br />
</span><span class="comment">// CREATES AN ARRAY OF SimpleXMLElement OBJECTS<br />
</span><span class="default">$obj </span><span class="keyword">= </span><span class="default">SimpleXML_Load_String</span><span class="keyword">(</span><span class="default">$xml</span><span class="keyword">);<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$obj</span><span class="keyword">);<br />
echo </span><span class="default">PHP_EOL</span><span class="keyword">;<br />
<br />
</span><span class="comment">// SHOW THE ATTRIBUTES HIDDEN IN THE SimpleXMLElement OBJECTS<br />
</span><span class="keyword">foreach (</span><span class="default">$obj </span><span class="keyword">as </span><span class="default">$sub</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">PHP_EOL </span><span class="keyword">. (string)</span><span class="default">$sub</span><span class="keyword">-&gt;</span><span class="default">quantity </span><span class="keyword">. </span><span class="string">' ' </span><span class="keyword">. (string)</span><span class="default">$sub</span><span class="keyword">-&gt;</span><span class="default">quantity</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">];<br />
}<br />
echo </span><span class="default">PHP_EOL</span><span class="keyword">;<br />
<br />
</span><span class="comment">// USING THE OBJECT, CREATE A JSON STRING<br />
</span><span class="default">$jso </span><span class="keyword">= </span><span class="default">json_encode</span><span class="keyword">(</span><span class="default">$obj</span><span class="keyword">);<br />
echo </span><span class="default">htmlentities</span><span class="keyword">(</span><span class="default">$jso</span><span class="keyword">); </span><span class="comment">// 'type' IS LOST<br />
</span><span class="keyword">echo </span><span class="default">PHP_EOL</span><span class="keyword">;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="113618""></a>
  <div class="note">
   <strong class="user">info at pkrules dot in</strong>
   <a href="#113618" class="date">06-Nov-2013 01:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Notice the last json_decode does not working :) ,you need to use a variable to use the encoded data in json_decode():- <br />
<span class="default">&lt;?php<br />
$arr</span><span class="keyword">=array(</span><span class="string">'a'</span><span class="keyword">=&gt;</span><span class="default">1</span><span class="keyword">,</span><span class="string">'b'</span><span class="keyword">=&gt;</span><span class="default">2</span><span class="keyword">,</span><span class="string">'c'</span><span class="keyword">=&gt;</span><span class="default">3</span><span class="keyword">,</span><span class="string">'d'</span><span class="keyword">=&gt;</span><span class="default">4</span><span class="keyword">,</span><span class="string">'e'</span><span class="keyword">=&gt;</span><span class="default">5</span><span class="keyword">);<br />
<br />
echo </span><span class="default">json_encode</span><span class="keyword">(</span><span class="default">$arr</span><span class="keyword">).</span><span class="string">"&lt;br /&gt;"</span><span class="keyword">;<br />
</span><span class="comment">//{"a":1,"b":2,"c":3,"d":4,"e":5}<br />
<br />
</span><span class="default">print_r </span><span class="keyword">(</span><span class="default">json_decode</span><span class="keyword">(</span><span class="default">json_encode</span><span class="keyword">(</span><span class="default">$arr</span><span class="keyword">)));<br />
</span><span class="comment">//stdClass Object ( [a] =&gt; 1 [b] =&gt; 2 [c] =&gt; 3 [d] =&gt; 4 [e] =&gt; 5 )<br />
</span><span class="keyword">echo </span><span class="string">"&lt;br /&gt;"</span><span class="keyword">;<br />
</span><span class="default">$var</span><span class="keyword">=</span><span class="default">json_encode</span><span class="keyword">(</span><span class="default">$arr</span><span class="keyword">);<br />
</span><span class="default">print_r </span><span class="keyword">(</span><span class="default">json_decode</span><span class="keyword">(</span><span class="default">$var</span><span class="keyword">,</span><span class="default">true</span><span class="keyword">));<br />
</span><span class="comment">//Array ( [a] =&gt; 1 [b] =&gt; 2 [c] =&gt; 3 [d] =&gt; 4 [e] =&gt; 5 ) <br />
</span><span class="keyword">echo </span><span class="string">"&lt;br /&gt;"</span><span class="keyword">;<br />
</span><span class="default">print_r </span><span class="keyword">(</span><span class="default">json_decode</span><span class="keyword">(</span><span class="default">json_encode</span><span class="keyword">(</span><span class="default">$arr</span><span class="keyword">)),</span><span class="default">true</span><span class="keyword">);</span><span class="comment">//no output<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="113219""></a>
  <div class="note">
   <strong class="user">eep2004 at ukr dot net</strong>
   <a href="#113219" class="date">13-Sep-2013 05:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">// alternative json_encode<br />
</span><span class="keyword">function </span><span class="default">_json_encode</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">is_string</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">)) return </span><span class="string">'"'</span><span class="keyword">.</span><span class="default">addslashes</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">).</span><span class="string">'"'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">is_numeric</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">)) return </span><span class="default">$val</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$val </span><span class="keyword">=== </span><span class="default">null</span><span class="keyword">) return </span><span class="string">'null'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$val </span><span class="keyword">=== </span><span class="default">true</span><span class="keyword">) return </span><span class="string">'true'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$val </span><span class="keyword">=== </span><span class="default">false</span><span class="keyword">) return </span><span class="string">'false'</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$assoc </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$val </span><span class="keyword">as </span><span class="default">$k</span><span class="keyword">=&gt;</span><span class="default">$v</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$k </span><span class="keyword">!== </span><span class="default">$i</span><span class="keyword">++){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$assoc </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$res </span><span class="keyword">= array();<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$val </span><span class="keyword">as </span><span class="default">$k</span><span class="keyword">=&gt;</span><span class="default">$v</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$v </span><span class="keyword">= </span><span class="default">_json_encode</span><span class="keyword">(</span><span class="default">$v</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$assoc</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$k </span><span class="keyword">= </span><span class="string">'"'</span><span class="keyword">.</span><span class="default">addslashes</span><span class="keyword">(</span><span class="default">$k</span><span class="keyword">).</span><span class="string">'"'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$v </span><span class="keyword">= </span><span class="default">$k</span><span class="keyword">.</span><span class="string">':'</span><span class="keyword">.</span><span class="default">$v</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$res</span><span class="keyword">[] = </span><span class="default">$v</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$res </span><span class="keyword">= </span><span class="default">implode</span><span class="keyword">(</span><span class="string">','</span><span class="keyword">, </span><span class="default">$res</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return (</span><span class="default">$assoc</span><span class="keyword">)? </span><span class="string">'{'</span><span class="keyword">.</span><span class="default">$res</span><span class="keyword">.</span><span class="string">'}' </span><span class="keyword">: </span><span class="string">'['</span><span class="keyword">.</span><span class="default">$res</span><span class="keyword">.</span><span class="string">']'</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Example:<br />
Array<br />
(<br />
&nbsp;&nbsp;&nbsp; [0] =&gt; 7<br />
&nbsp;&nbsp;&nbsp; [1] =&gt; false<br />
&nbsp;&nbsp;&nbsp; [2] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ['a'] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [0] =&gt; 1<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [1] =&gt; 2<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [3] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [1] =&gt; true<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [2] =&gt; 6<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [0] =&gt; 4<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [4] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [0] =&gt; 'b'<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [1] =&gt; null<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
)<br />
Result: [7,false,{"a":{"0":1,"1":2,"3":{"1":true,"2":6,"0":4},"4":["b",null]}}]<br />
<br />
This function is more accurate and faster than, for example, that one:<br />
<a href="http://www.php.net/manual/ru/function.json-encode.php#89908" rel="nofollow" target="_blank">http://www.php.net/manual/ru/function.json-encode.php#89908</a><br />
(RU: эта функция работает более точно и быстрее, чем указанная выше).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="112644""></a>
  <div class="note">
   <strong class="user">CertaiN</strong>
   <a href="#112644" class="date">08-Jul-2013 03:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
<br />
$fp </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="string">'php://stdin'</span><span class="keyword">, </span><span class="string">'r'</span><span class="keyword">);<br />
</span><span class="default">$json </span><span class="keyword">= @</span><span class="default">json_encode</span><span class="keyword">(array(</span><span class="string">'a' </span><span class="keyword">=&gt; </span><span class="string">'foo'</span><span class="keyword">, </span><span class="string">'b' </span><span class="keyword">=&gt; </span><span class="default">$fp</span><span class="keyword">));<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$json</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
[PHP5.5 or after]<br />
bool(false)<br />
<br />
[PHP 5.4 or before]<br />
string(20) "{"a":"foo","b":null}"</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="112020""></a>
  <div class="note">
   <strong class="user">guilhenfsu at gmail dot com</strong>
   <a href="#112020" class="date">22-Apr-2013 08:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Solution for UTF-8 Special Chars.<br />
<br />
&lt;?<br />
<br />
$array = array('nome'=&gt;'Pai??o','cidade'=&gt;'S?o Paulo');<br />
<br />
$array = array_map('htmlentities',$array);<br />
<br />
//encode<br />
$json = html_entity_decode(json_encode($array));<br />
<br />
//Output: {"nome":"Pai??o","cidade":"S?o Paulo"}<br />
echo $json;<br />
<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="111788""></a>
  <div class="note">
   <strong class="user">ck at ergovia dot de</strong>
   <a href="#111788" class="date">28-Mar-2013 11:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Attention when passing a plain array to json_encode and using JSON_FORCE_OBJECT. It figured out that the index-order of the resulting JSON-string depends on the system PHP is running on.<br />
<br />
$a = array("a" , "b", "c");<br />
echo json_encode($a, JSON_FORCE_OBJECT);<br />
<br />
On Xampp (Windows) you get:<br />
<br />
{"0":"a","1":"b","2":"c"}';<br />
<br />
On a machine running debian I get:<br />
<br />
{"2":"a","1":"b","0":"c"}';<br />
<br />
Note that the key:value pairs are different!<br />
<br />
Solution here was to use array_combine to create a ssociative array and then pass it to json_encode:<br />
<br />
json_encode(array_combine(range(0, count($a) - 1), $a), JSON_FORCE_OBJECT);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="107616""></a>
  <div class="note">
   <strong class="user">webmaster_php at colnect dot com</strong>
   <a href="#107616" class="date">22-Feb-2012 03:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
WARNING! Do not pass associative arrays if the order is important to you. It seems that while FireFox does keep the same order, both Chrome and IE sort it. Here's a little workaround:
<br />

<br />
<span class="default">&lt;?php
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $arWrapper </span><span class="keyword">= array();&nbsp; &nbsp; &nbsp; &nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$arWrapper</span><span class="keyword">[</span><span class="string">'k'</span><span class="keyword">] = </span><span class="default">array_keys</span><span class="keyword">(</span><span class="default">$arChoices</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$arWrapper</span><span class="keyword">[</span><span class="string">'v'</span><span class="keyword">] = </span><span class="default">array_values</span><span class="keyword">(</span><span class="default">$arChoices</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$json </span><span class="keyword">= </span><span class="default">json_encode</span><span class="keyword">(</span><span class="default">$arWrapper</span><span class="keyword">);
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="106641""></a>
  <div class="note">
   <strong class="user">bohwaz</strong>
   <a href="#106641" class="date">23-Nov-2011 05:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Are you sure you want to use JSON_NUMERIC_CHECK, really really sure?<br />
<br />
Just watch this usecase:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// International phone number<br />
</span><span class="default">json_encode</span><span class="keyword">(array(</span><span class="string">'phone_number' </span><span class="keyword">=&gt; </span><span class="string">'+33123456789'</span><span class="keyword">), </span><span class="default">JSON_NUMERIC_CHECK</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
And then you get this JSON:<br />
<br />
{"phone_number":33123456789}<br />
<br />
Maybe it makes sense for PHP (as is_numeric('+33123456789') returns true), but really, casting it as an int?!<br />
<br />
So be careful when using JSON_NUMERIC_CHECK, it may mess up with your data!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="105789""></a>
  <div class="note">
   <strong class="user">devilan (REMOVEIT) (at) o2 (dot) pl</strong>
   <a href="#105789" class="date">15-Sep-2011 12:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For PHP5.3 users who want to emulate JSON_UNESCAPED_UNICODE, there is simple way to do it:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">my_json_encode</span><span class="keyword">(</span><span class="default">$arr</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//convmap since 0x80 char codes so it takes all multibyte codes (above ASCII 127). So such characters are being "hidden" from normal json_encoding<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">array_walk_recursive</span><span class="keyword">(</span><span class="default">$arr</span><span class="keyword">, function (&amp;</span><span class="default">$item</span><span class="keyword">, </span><span class="default">$key</span><span class="keyword">) { if (</span><span class="default">is_string</span><span class="keyword">(</span><span class="default">$item</span><span class="keyword">)) </span><span class="default">$item </span><span class="keyword">= </span><span class="default">mb_encode_numericentity</span><span class="keyword">(</span><span class="default">$item</span><span class="keyword">, array (</span><span class="default">0x80</span><span class="keyword">, </span><span class="default">0xffff</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0xffff</span><span class="keyword">), </span><span class="string">'UTF-8'</span><span class="keyword">); });<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">mb_decode_numericentity</span><span class="keyword">(</span><span class="default">json_encode</span><span class="keyword">(</span><span class="default">$arr</span><span class="keyword">), array (</span><span class="default">0x80</span><span class="keyword">, </span><span class="default">0xffff</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0xffff</span><span class="keyword">), </span><span class="string">'UTF-8'</span><span class="keyword">);<br />
<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="103137""></a>
  <div class="note">
   <strong class="user">pvl dot kolensikov at gmail dot com</strong>
   <a href="#103137" class="date">28-Mar-2011 08:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As json_encode() is recursive, you can use it to serialize whole structure of objects.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">class </span><span class="default">A </span><span class="keyword">{
<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$a </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$b </span><span class="keyword">= </span><span class="default">2</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$collection </span><span class="keyword">= array();
<br />

<br />
&nbsp;&nbsp;&nbsp; function&nbsp; </span><span class="default">__construct</span><span class="keyword">(){
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for ( </span><span class="default">$i</span><span class="keyword">=</span><span class="default">3</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">--&gt;</span><span class="default">0</span><span class="keyword">;){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">array_push</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">collection</span><span class="keyword">, new </span><span class="default">B</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />
}
<br />

<br />
class </span><span class="default">B </span><span class="keyword">{
<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$a </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$b </span><span class="keyword">= </span><span class="default">2</span><span class="keyword">;
<br />
}
<br />

<br />
echo </span><span class="default">json_encode</span><span class="keyword">(new </span><span class="default">A</span><span class="keyword">);
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Will give:
<br />

<br />
{
<br />
&nbsp;&nbsp;&nbsp; "a":1,
<br />
&nbsp;&nbsp;&nbsp; "b":2,
<br />
&nbsp;&nbsp;&nbsp; "collection":[{
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; "a":1,
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; "b":2
<br />
&nbsp;&nbsp;&nbsp; },{
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; "a":1,
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; "b":2
<br />
&nbsp;&nbsp;&nbsp; },{
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; "a":1,
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; "b":2
<br />
&nbsp;&nbsp;&nbsp; }]
<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102628""></a>
  <div class="note">
   <strong class="user">Mathias Leppich</strong>
   <a href="#102628" class="date">24-Feb-2011 10:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you need a json_encode / json_decode which is array/object/assoc-array you might want to use: <a href="http://gist.github.com/820694" rel="nofollow" target="_blank">http://gist.github.com/820694</a><br />
<br />
<span class="default">&lt;?php<br />
$dataIn </span><span class="keyword">= (object)array(<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"assoc" </span><span class="keyword">=&gt; array(</span><span class="string">"cow"</span><span class="keyword">=&gt;</span><span class="string">"moo"</span><span class="keyword">),<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"object" </span><span class="keyword">=&gt; (object)array(</span><span class="string">"cat"</span><span class="keyword">=&gt;</span><span class="string">"miao"</span><span class="keyword">),<br />
);<br />
</span><span class="comment">/*<br />
== IN<br />
object(stdClass)#2 (2) {<br />
&nbsp; ["assoc"]=&gt;<br />
&nbsp; array(1) {<br />
&nbsp;&nbsp;&nbsp; ["cow"]=&gt;<br />
&nbsp;&nbsp;&nbsp; string(3) "moo"<br />
&nbsp; }<br />
&nbsp; ["object"]=&gt;<br />
&nbsp; object(stdClass)#1 (1) {<br />
&nbsp;&nbsp;&nbsp; ["cat"]=&gt;<br />
&nbsp;&nbsp;&nbsp; string(4) "miao"<br />
&nbsp; }<br />
}<br />
<br />
== JSON<br />
{"assoc":{"_PHP_ASSOC":{"cow":"moo"}},"object":{"cat":"miao"}}<br />
<br />
== OUT<br />
object(stdClass)#4 (2) {<br />
&nbsp; ["assoc"]=&gt;<br />
&nbsp; array(1) {<br />
&nbsp;&nbsp;&nbsp; ["cow"]=&gt;<br />
&nbsp;&nbsp;&nbsp; string(3) "moo"<br />
&nbsp; }<br />
&nbsp; ["object"]=&gt;<br />
&nbsp; object(stdClass)#7 (1) {<br />
&nbsp;&nbsp;&nbsp; ["cat"]=&gt;<br />
&nbsp;&nbsp;&nbsp; string(4) "miao"<br />
&nbsp; }<br />
}<br />
*/<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102091""></a>
  <div class="note">
   <strong class="user">bohwaz</strong>
   <a href="#102091" class="date">26-Jan-2011 02:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is intended to be a simple readable json encode function for PHP 5.3+ (and licensed under GNU/AGPLv3 or GPLv3 like you prefer):<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">json_readable_encode</span><span class="keyword">(</span><span class="default">$in</span><span class="keyword">, </span><span class="default">$indent </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">, </span><span class="default">$from_array </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$_myself </span><span class="keyword">= </span><span class="default">__FUNCTION__</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$_escape </span><span class="keyword">= function (</span><span class="default">$str</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"!([\b\t\n\r\f\"\\'])!"</span><span class="keyword">, </span><span class="string">"\\\\\\1"</span><span class="keyword">, </span><span class="default">$str</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; };<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$in </span><span class="keyword">as </span><span class="default">$key</span><span class="keyword">=&gt;</span><span class="default">$value</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">.= </span><span class="default">str_repeat</span><span class="keyword">(</span><span class="string">"\t"</span><span class="keyword">, </span><span class="default">$indent </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">.= </span><span class="string">"\""</span><span class="keyword">.</span><span class="default">$_escape</span><span class="keyword">((string)</span><span class="default">$key</span><span class="keyword">).</span><span class="string">"\": "</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_object</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">) || </span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">.= </span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">.= </span><span class="default">$_myself</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">, </span><span class="default">$indent </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; elseif (</span><span class="default">is_bool</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">.= </span><span class="default">$value </span><span class="keyword">? </span><span class="string">'true' </span><span class="keyword">: </span><span class="string">'false'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; elseif (</span><span class="default">is_null</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">.= </span><span class="string">'null'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; elseif (</span><span class="default">is_string</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">.= </span><span class="string">"\"" </span><span class="keyword">. </span><span class="default">$_escape</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">) .</span><span class="string">"\""</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">.= </span><span class="default">$value</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">.= </span><span class="string">",\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; if (!empty(</span><span class="default">$out</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$out</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, -</span><span class="default">2</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">= </span><span class="default">str_repeat</span><span class="keyword">(</span><span class="string">"\t"</span><span class="keyword">, </span><span class="default">$indent</span><span class="keyword">) . </span><span class="string">"{\n" </span><span class="keyword">. </span><span class="default">$out</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">.= </span><span class="string">"\n" </span><span class="keyword">. </span><span class="default">str_repeat</span><span class="keyword">(</span><span class="string">"\t"</span><span class="keyword">, </span><span class="default">$indent</span><span class="keyword">) . </span><span class="string">"}"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$out</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="101843""></a>
  <div class="note">
   <strong class="user">dan at elearnapp dot com</strong>
   <a href="#101843" class="date">13-Jan-2011 12:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you need to force an object (ex: empty array) you can also do:
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; <span class="default">&lt;?php json_encode</span><span class="keyword">( (object)</span><span class="default">$arr </span><span class="keyword">); </span><span class="default">?&gt;
<br />
</span>
<br />
which acts the same as 
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; <span class="default">&lt;?php json_encode</span><span class="keyword">(</span><span class="default">$arr</span><span class="keyword">, </span><span class="default">JSON_FORCE_OBJECT</span><span class="keyword">); </span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99457""></a>
  <div class="note">
   <strong class="user">nicolas dot baptiste at gmail dot com</strong>
   <a href="#99457" class="date">18-Aug-2010 08:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Beware of index arrays :<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">echo </span><span class="default">json_encode</span><span class="keyword">(array(</span><span class="string">"test"</span><span class="keyword">,</span><span class="string">"test"</span><span class="keyword">,</span><span class="string">"test"</span><span class="keyword">));<br />
echo </span><span class="default">json_encode</span><span class="keyword">(array(</span><span class="default">0</span><span class="keyword">=&gt;</span><span class="string">"test"</span><span class="keyword">,</span><span class="default">3</span><span class="keyword">=&gt;</span><span class="string">"test"</span><span class="keyword">,</span><span class="default">7</span><span class="keyword">=&gt;</span><span class="string">"test"</span><span class="keyword">));<br />
</span><span class="default">?&gt;<br />
</span><br />
Will give :<br />
<br />
["test","test","test"]<br />
{"0":"test","3":"test","7":"test"}<br />
<br />
arrays are returned only if you don't define index.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="98718""></a>
  <div class="note">
   <strong class="user">mic dot sumner at gmail dot com</strong>
   <a href="#98718" class="date">02-Jul-2010 06:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hey everyone,<br />
<br />
In my application, I had objects that modeled database rows with a few one to many relationships, so one object may have an array of other objects.<br />
<br />
I wanted to make the object properties private and use getters and setters, but I needed them to be serializable to json without losing the private variables. (I wanted to promote good coding practices but I needed the properties on the client side.) Because of this, I needed to encode not only the normal private properties but also properties that were arrays of other model objects. I looked for awhile with no luck, so I coded my own:<br />
<br />
You can place these methods in each of your classes, or put them in a base class, as I've done. (But note that for this to work, the children classes must declare their properties as protected so the parent class has access)<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">abstract class </span><span class="default">Model </span><span class="keyword">{<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp; public function </span><span class="default">toArray</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">processArray</span><span class="keyword">(</span><span class="default">get_object_vars</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; private function </span><span class="default">processArray</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$array </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_object</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$array</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">] = </span><span class="default">$value</span><span class="keyword">-&gt;</span><span class="default">toArray</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$array</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">] = </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">processArray</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// If the property isn't an object or array, leave it untouched<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">$array</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__toString</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">json_encode</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">toArray</span><span class="keyword">());<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp; <br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Externally, you can just call<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">echo </span><span class="default">$theObject</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//or<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">echo </span><span class="default">json_encode</span><span class="keyword">(</span><span class="default">$theObject</span><span class="keyword">-&gt;</span><span class="default">toArray</span><span class="keyword">());<br />
</span><span class="default">?&gt;<br />
</span><br />
And you'll get the json for that object. Hope this helps someone!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="97008""></a>
  <div class="note">
   <strong class="user">ryan at ryanparman dot com</strong>
   <a href="#97008" class="date">27-Mar-2010 01:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I came across the "bug" where running json_encode() over a SimpleXML object was ignoring the CDATA. I ran across <a href="http://bugs.php.net/42001 and http://bugs.php.net/41976, and while I agree with the poster that the documentation should clarify gotchas like this, I was able to figure out how to workaround it." rel="nofollow" target="_blank">http://bugs.php.net/42001 and http://bugs.php.net/41976, and while I agree with the poster that the documentation should clarify gotchas like this, I was able to figure out how to workaround it.</a><br />
<br />
You need to convert the SimpleXML object back into an XML string, then re-import it back into SimpleXML using the LIBXML_NOCDATA option. Once you do this, then you can use json_encode() and still get back the CDATA.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// Pretend we already have a complex SimpleXML object stored in $xml<br />
</span><span class="default">$json </span><span class="keyword">= </span><span class="default">json_encode</span><span class="keyword">(new </span><span class="default">SimpleXMLElement</span><span class="keyword">(</span><span class="default">$xml</span><span class="keyword">-&gt;</span><span class="default">asXML</span><span class="keyword">(), </span><span class="default">LIBXML_NOCDATA</span><span class="keyword">));<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="96248""></a>
  <div class="note">
   <strong class="user">5hunter5 at mail dot ru</strong>
   <a href="#96248" class="date">17-Feb-2010 03:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If I want to encode object whith all it's private and protected properties, then I implements that methods in my object:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">public function </span><span class="default">encodeJSON</span><span class="keyword">()
<br />
{
<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$this </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$json</span><span class="keyword">-&gt;</span><span class="default">$key </span><span class="keyword">= </span><span class="default">$value</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">json_encode</span><span class="keyword">(</span><span class="default">$json</span><span class="keyword">);
<br />
}
<br />
public function </span><span class="default">decodeJSON</span><span class="keyword">(</span><span class="default">$json_str</span><span class="keyword">)
<br />
{
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$json </span><span class="keyword">= </span><span class="default">json_decode</span><span class="keyword">(</span><span class="default">$json_str</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$json </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">$key </span><span class="keyword">= </span><span class="default">$value</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
}
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Or you may extend your class from base class, wich is implements that methods.
<br />

<br />
Found that much more simple than regular expressions with PHP serialized objects...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="95667""></a>
  <div class="note">
   <strong class="user">garydavis at gmail dot com</strong>
   <a href="#95667" class="date">14-Jan-2010 07:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are planning on using this function to serve a json file, it's important to note that the json generated by this function is not ready to be consumed by javascript until you wrap it in parens and add ";" to the end. <br />
<br />
It took me a while to figure this out so I thought I'd save others the aggravation.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; header</span><span class="keyword">(</span><span class="string">'Content-Type: text/javascript; charset=utf8'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Access-Control-Allow-Origin: <a href="http://www.example.com/" rel="nofollow" target="_blank">http://www.example.com/</a>'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Access-Control-Max-Age: 3628800'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Access-Control-Allow-Methods: GET, POST, PUT, DELETE'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$file</span><span class="keyword">=</span><span class="string">'rss.xml'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$arr </span><span class="keyword">= </span><span class="default">simplexml_load_file</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);</span><span class="comment">//this creates an object from the xml file<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$json</span><span class="keyword">= </span><span class="string">'('</span><span class="keyword">.</span><span class="default">json_encode</span><span class="keyword">(</span><span class="default">$arr</span><span class="keyword">).</span><span class="string">');'</span><span class="keyword">; </span><span class="comment">//must wrap in parens and end with semicolon<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'callback'</span><span class="keyword">].</span><span class="default">$json</span><span class="keyword">); </span><span class="comment">//callback is prepended for json-p<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="94157""></a>
  <div class="note">
   <strong class="user">simoncpu was here</strong>
   <a href="#94157" class="date">20-Oct-2009 02:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A note of caution: If you are wondering why json_encode() encodes your PHP array as a JSON object instead of a JSON array, you might want to double check your array keys because json_encode() assumes that you array is an object if your keys are not sequential.<br />
<br />
e.g.:<br />
<br />
<span class="default">&lt;?php<br />
$myarray </span><span class="keyword">= Array(</span><span class="string">'isa'</span><span class="keyword">, </span><span class="string">'dalawa'</span><span class="keyword">, </span><span class="string">'tatlo'</span><span class="keyword">);<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$myarray</span><span class="keyword">);<br />
</span><span class="comment">/* output<br />
array(3) {<br />
&nbsp; [0]=&gt;<br />
&nbsp; string(3) "isa"<br />
&nbsp; [1]=&gt;<br />
&nbsp; string(6) "dalawa"<br />
&nbsp; [2]=&gt;<br />
&nbsp; string(5) "tatlo"<br />
}<br />
*/<br />
</span><span class="default">?&gt;<br />
</span><br />
As you can see, the keys are sequential; $myarray will be correctly encoded as a JSON array.<br />
<br />
<span class="default">&lt;?php<br />
$myarray </span><span class="keyword">= Array(</span><span class="string">'isa'</span><span class="keyword">, </span><span class="string">'dalawa'</span><span class="keyword">, </span><span class="string">'tatlo'</span><span class="keyword">);<br />
<br />
unset(</span><span class="default">$myarray</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$myarray</span><span class="keyword">);<br />
</span><span class="comment">/* output<br />
array(2) {<br />
&nbsp; [0]=&gt;<br />
&nbsp; string(3) "isa"<br />
&nbsp; [2]=&gt;<br />
&nbsp; string(5) "tatlo"<br />
}<br />
*/<br />
</span><span class="default">?&gt;<br />
</span><br />
Unsetting an element will also remove the keys. json_encode() will now assume that this is an object, and will encode it as such.<br />
<br />
SOLUTION: Use array_values() to re-index the array.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91434""></a>
  <div class="note">
   <strong class="user">Istratov Vadim</strong>
   <a href="#91434" class="date">09-Jun-2009 11:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Be careful with floating values in some locales (e.g. russian) with comma (",") as decimal point. Code:
<br />

<br />
<span class="default">&lt;?php
<br />
setlocale</span><span class="keyword">(</span><span class="default">LC_ALL</span><span class="keyword">, </span><span class="string">'ru_RU.utf8'</span><span class="keyword">);
<br />

<br />
</span><span class="default">$arr </span><span class="keyword">= array(</span><span class="string">'element' </span><span class="keyword">=&gt; </span><span class="default">12.34</span><span class="keyword">);
<br />
echo </span><span class="default">json_encode</span><span class="keyword">( </span><span class="default">$arr </span><span class="keyword">);
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Output will be:
<br />
--------------
<br />
{"element":12,34}
<br />
--------------
<br />

<br />
Which is NOT a valid JSON markup. You should convert floating point variable to strings or set locale to something like "LC_NUMERIC, 'en_US.utf8'" before using json_encode.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="90407""></a>
  <div class="note">
   <strong class="user">Sam Barnum</strong>
   <a href="#90407" class="date">20-Apr-2009 11:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that if you try to encode an array containing non-utf values, you'll get null values in the resulting JSON string.&nbsp; You can batch-encode all the elements of an array with the array_map function:<br />
<span class="default">&lt;?php<br />
$encodedArray </span><span class="keyword">= </span><span class="default">array_map</span><span class="keyword">(</span><span class="default">utf8_encode</span><span class="keyword">, </span><span class="default">$rawArray</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="89908""></a>
  <div class="note">
   <strong class="user">andyrusterholz at g-m-a-i-l dot c-o-m</strong>
   <a href="#89908" class="date">27-Mar-2009 11:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For anyone who would like to encode arrays into JSON, but is using PHP 4, and doesn't want to wrangle PECL around, here is a function I wrote in PHP4 to convert nested arrays into JSON.
<br />

<br />
Note that, because javascript converts JSON data into either nested named objects OR vector arrays, it's quite difficult to represent mixed PHP arrays (arrays with both numerical and associative indexes) well in JSON. This function does something funky if you pass it a mixed array -- see the comments for details.
<br />

<br />
I don't make a claim that this function is by any means complete (for example, it doesn't handle objects) so if you have any improvements, go for it.
<br />

<br />
<span class="default">&lt;?php
<br />

<br />
</span><span class="comment">/**
<br />
&nbsp;* Converts an associative array of arbitrary depth and dimension into JSON representation.
<br />
&nbsp;*
<br />
&nbsp;* NOTE: If you pass in a mixed associative and vector array, it will prefix each numerical
<br />
&nbsp;* key with "key_". For example array("foo", "bar" =&gt; "baz") will be translated into
<br />
&nbsp;* {"key_0": "foo", "bar": "baz"} but array("foo", "bar") would be translated into [ "foo", "bar" ].
<br />
&nbsp;*
<br />
&nbsp;* @param $array The array to convert.
<br />
&nbsp;* @return mixed The resulting JSON string, or false if the argument was not an array.
<br />
&nbsp;* @author Andy Rusterholz
<br />
&nbsp;*/
<br />
</span><span class="keyword">function </span><span class="default">array_to_json</span><span class="keyword">( </span><span class="default">$array </span><span class="keyword">){
<br />

<br />
&nbsp;&nbsp;&nbsp; if( !</span><span class="default">is_array</span><span class="keyword">( </span><span class="default">$array </span><span class="keyword">) ){
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$associative </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">( </span><span class="default">array_diff</span><span class="keyword">( </span><span class="default">array_keys</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">), </span><span class="default">array_keys</span><span class="keyword">( </span><span class="default">array_keys</span><span class="keyword">( </span><span class="default">$array </span><span class="keyword">)) ));
<br />
&nbsp;&nbsp;&nbsp; if( </span><span class="default">$associative </span><span class="keyword">){
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$construct </span><span class="keyword">= array();
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach( </span><span class="default">$array </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value </span><span class="keyword">){
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// We first copy each key/value pair into a staging array,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // formatting each key and value properly as we go.
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // Format the key:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if( </span><span class="default">is_numeric</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">) ){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$key </span><span class="keyword">= </span><span class="string">"key_</span><span class="default">$key</span><span class="string">"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$key </span><span class="keyword">= </span><span class="string">'"'</span><span class="keyword">.</span><span class="default">addslashes</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">).</span><span class="string">'"'</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Format the value:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if( </span><span class="default">is_array</span><span class="keyword">( </span><span class="default">$value </span><span class="keyword">)){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$value </span><span class="keyword">= </span><span class="default">array_to_json</span><span class="keyword">( </span><span class="default">$value </span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else if( !</span><span class="default">is_numeric</span><span class="keyword">( </span><span class="default">$value </span><span class="keyword">) || </span><span class="default">is_string</span><span class="keyword">( </span><span class="default">$value </span><span class="keyword">) ){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$value </span><span class="keyword">= </span><span class="string">'"'</span><span class="keyword">.</span><span class="default">addslashes</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">).</span><span class="string">'"'</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Add to staging array:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$construct</span><span class="keyword">[] = </span><span class="string">"</span><span class="default">$key</span><span class="string">: </span><span class="default">$value</span><span class="string">"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Then we collapse the staging array into the JSON form:
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="string">"{ " </span><span class="keyword">. </span><span class="default">implode</span><span class="keyword">( </span><span class="string">", "</span><span class="keyword">, </span><span class="default">$construct </span><span class="keyword">) . </span><span class="string">" }"</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp;&nbsp; } else { </span><span class="comment">// If the array is a vector (not associative):
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$construct </span><span class="keyword">= array();
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach( </span><span class="default">$array </span><span class="keyword">as </span><span class="default">$value </span><span class="keyword">){
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Format the value:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if( </span><span class="default">is_array</span><span class="keyword">( </span><span class="default">$value </span><span class="keyword">)){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$value </span><span class="keyword">= </span><span class="default">array_to_json</span><span class="keyword">( </span><span class="default">$value </span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else if( !</span><span class="default">is_numeric</span><span class="keyword">( </span><span class="default">$value </span><span class="keyword">) || </span><span class="default">is_string</span><span class="keyword">( </span><span class="default">$value </span><span class="keyword">) ){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$value </span><span class="keyword">= </span><span class="string">'"'</span><span class="keyword">.</span><span class="default">addslashes</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">).</span><span class="string">'"'</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Add to staging array:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$construct</span><span class="keyword">[] = </span><span class="default">$value</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Then we collapse the staging array into the JSON form:
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="string">"[ " </span><span class="keyword">. </span><span class="default">implode</span><span class="keyword">( </span><span class="string">", "</span><span class="keyword">, </span><span class="default">$construct </span><span class="keyword">) . </span><span class="string">" ]"</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$result</span><span class="keyword">;
<br />
}
<br />

<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="88790""></a>
  <div class="note">
   <strong class="user">aangel at spam dot com</strong>
   <a href="#88790" class="date">07-Feb-2009 05:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is a bit more on creating an iterator to get at those pesky private/protected variables:<br />
<br />
<span class="default">&lt;?php <br />
&nbsp;&nbsp; </span><span class="keyword">class </span><span class="default">Kit </span><span class="keyword">implements </span><span class="default">IteratorAggregate </span><span class="keyword">{<br />
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$var</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_object</span><span class="keyword">(</span><span class="default">$var</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// if passed an object, we are cloning<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">kitID </span><span class="keyword">= </span><span class="default">$var</span><span class="keyword">-&gt;</span><span class="default">kitID</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">kitName </span><span class="keyword">= </span><span class="default">$var</span><span class="keyword">-&gt;</span><span class="default">kitName</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach (</span><span class="default">$var</span><span class="keyword">-&gt;</span><span class="default">productArray </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">productArray</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">] = (array)</span><span class="default">$value</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp; ...<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Create an iterator because private/protected vars can't<br />
&nbsp;&nbsp;&nbsp; // be seen by json_encode().<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public function </span><span class="default">getIterator</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$iArray</span><span class="keyword">[</span><span class="string">'kitID'</span><span class="keyword">] = </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">kitID</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$iArray</span><span class="keyword">[</span><span class="string">'kitName'</span><span class="keyword">] = </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">kitName</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$iArray</span><span class="keyword">[</span><span class="string">'productArray'</span><span class="keyword">] = (array)</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">productArray</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return new </span><span class="default">ArrayIterator</span><span class="keyword">(</span><span class="default">$iArray</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;</span> <br />
<br />
Calling something like&nbsp; $t = json_encode($this-&gt;getIterator());&nbsp; will give you almost what you want:<br />
<span class="default">&lt;?php <br />
</span><span class="keyword">{</span><span class="string">"kitID"</span><span class="keyword">:</span><span class="string">"Kit_Essentials-Books.txt"</span><span class="keyword">,<br />
</span><span class="string">"kitName"</span><span class="keyword">:</span><span class="string">"Essential Books"</span><span class="keyword">,<br />
</span><span class="string">"productArray"</span><span class="keyword">:{</span><span class="string">"0470043601"</span><span class="keyword">:{</span><span class="string">"Category"</span><span class="keyword">:</span><span class="string">"Food"</span><span class="keyword">,</span><span class="string">"ASIN"</span><span class="keyword">:</span><span class="string">"0470043601"</span><span class="keyword">} } } <br />
</span><span class="default">?&gt;<br />
</span><br />
Notice that the productArray is converted to an object ignoring the cast I put in front, which is not what I wanted. I haven't figured out how to make sure that encodes as an array.<br />
<br />
Regardless, bringing that JSON back into an object using json_decode() will give you just a std object, and the only way I've found to get it into the proper object type is to use a constructor that instantiates the object the way it's supposed to be (see __construct($var) above). Like this:<br />
<span class="default">&lt;?php <br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $newKit </span><span class="keyword">= new </span><span class="default">Kit</span><span class="keyword">(</span><span class="default">json_decode</span><span class="keyword">(</span><span class="default">$t</span><span class="keyword">));<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86513""></a>
  <div class="note">
   <strong class="user">Garrett</strong>
   <a href="#86513" class="date">22-Oct-2008 11:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A note about json_encode automatically quoting numbers:<br />
<br />
It appears that the json_encode function pays attention to the data type of the value. Let me explain what we came across:<br />
<br />
We have found that when retrieving data from our database, there are occasions when numbers appear as strings to json_encode which results in double quotes around the values.<br />
<br />
This can lead to problems within javascript functions expecting the values to be numeric.<br />
<br />
This was discovered when were were retrieving fields from the database which contained serialized arrays. After unserializing them and sending them through the json_encode function the numeric values in the original array were now being treated as strings and showing up with double quotes around them.<br />
<br />
The fix: Prior to encoding the array, send it to a function which checks for numeric types and casts accordingly. Encoding from then on worked as expected.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84997""></a>
  <div class="note">
   <strong class="user">spam.goes.in.here AT gmail.com</strong>
   <a href="#84997" class="date">08-Aug-2008 11:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For anyone who has run into the problem of private properties not being added, you can simply implement the IteratorAggregate interface with the getIterator() method. Add the properties you want to be included in the output into an array in the getIterator() method and return it.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="80339""></a>
  <div class="note">
   <strong class="user">umbrae at gmail dot com</strong>
   <a href="#80339" class="date">10-Jan-2008 10:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's a quick function to pretty-print some JSON. Optimizations welcome, as this was a 10-minute dealie without efficiency in mind:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="comment">// Pretty print some JSON
<br />
</span><span class="keyword">function </span><span class="default">json_format</span><span class="keyword">(</span><span class="default">$json</span><span class="keyword">)
<br />
{
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$tab </span><span class="keyword">= </span><span class="string">"&nbsp; "</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$new_json </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$indent_level </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$in_string </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$json_obj </span><span class="keyword">= </span><span class="default">json_decode</span><span class="keyword">(</span><span class="default">$json</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$json_obj </span><span class="keyword">=== </span><span class="default">false</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$json </span><span class="keyword">= </span><span class="default">json_encode</span><span class="keyword">(</span><span class="default">$json_obj</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$len </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$json</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp;&nbsp; for(</span><span class="default">$c </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$c </span><span class="keyword">&lt; </span><span class="default">$len</span><span class="keyword">; </span><span class="default">$c</span><span class="keyword">++)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$char </span><span class="keyword">= </span><span class="default">$json</span><span class="keyword">[</span><span class="default">$c</span><span class="keyword">];
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; switch(</span><span class="default">$char</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'{'</span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'['</span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(!</span><span class="default">$in_string</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_json </span><span class="keyword">.= </span><span class="default">$char </span><span class="keyword">. </span><span class="string">"\n" </span><span class="keyword">. </span><span class="default">str_repeat</span><span class="keyword">(</span><span class="default">$tab</span><span class="keyword">, </span><span class="default">$indent_level</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$indent_level</span><span class="keyword">++;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_json </span><span class="keyword">.= </span><span class="default">$char</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'}'</span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">']'</span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(!</span><span class="default">$in_string</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$indent_level</span><span class="keyword">--;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_json </span><span class="keyword">.= </span><span class="string">"\n" </span><span class="keyword">. </span><span class="default">str_repeat</span><span class="keyword">(</span><span class="default">$tab</span><span class="keyword">, </span><span class="default">$indent_level</span><span class="keyword">) . </span><span class="default">$char</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_json </span><span class="keyword">.= </span><span class="default">$char</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">','</span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(!</span><span class="default">$in_string</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_json </span><span class="keyword">.= </span><span class="string">",\n" </span><span class="keyword">. </span><span class="default">str_repeat</span><span class="keyword">(</span><span class="default">$tab</span><span class="keyword">, </span><span class="default">$indent_level</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_json </span><span class="keyword">.= </span><span class="default">$char</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">':'</span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(!</span><span class="default">$in_string</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_json </span><span class="keyword">.= </span><span class="string">": "</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_json </span><span class="keyword">.= </span><span class="default">$char</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'"'</span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$c </span><span class="keyword">&gt; </span><span class="default">0 </span><span class="keyword">&amp;&amp; </span><span class="default">$json</span><span class="keyword">[</span><span class="default">$c</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">] != </span><span class="string">'\\'</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$in_string </span><span class="keyword">= !</span><span class="default">$in_string</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; default:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_json </span><span class="keyword">.= </span><span class="default">$char</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$new_json</span><span class="keyword">;
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77367""></a>
  <div class="note">
   <strong class="user">dennispopel(at)gmail.com</strong>
   <a href="#77367" class="date">26-Aug-2007 10:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Obviously, this function has trouble encoding arrays with empty string keys (''). I have just noticed that (because I was using a function in PHP under PHP4). When I switched to PHP5's json_encode, I noticed that browsers could not correctly parse the encoded data. More investigation maybe needed for a bug report, but this quick note may save somebody several hours.<br />
<br />
Also, it manifests on Linux in 5.2.1 (tested on two boxes), on my XP with PHP5.2.3 json_encode() works just great! However, both 5.2.1 and 5.2.3 phpinfo()s show that the json version is 1.2.1 so might be Linux issue</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
