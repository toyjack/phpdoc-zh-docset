<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>在对象中使用 XML 解析器</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.xml-set-notation-decl-handler.html">? xml_set_notation_decl_handler</a></li>
      <li style="float: right;"><a href="function.xml-set-processing-instruction-handler.html">xml_set_processing_instruction_handler ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.xml.html">XML 解析器函数</a></li>
    <li>在对象中使用 XML 解析器</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.xml-set-object" class="refentry">
   <div class="refnamediv">
    <h1 class="refname">xml_set_object</h1>
    <p class="verinfo">(PHP 4, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">xml_set_object</span> &mdash; <span class="dc-title">在对象中使用 XML 解析器</span></p>

   </div>
   <div class="refsect1 unknown-returnvaluet" id="refsect1-function.xml-set-object-unknown-returnvaluet">
    <h3 class="title">描述</h3>
     <div class="methodsynopsis dc-description">
      <span class="methodname"><strong>xml_set_object</strong></span>(<span class="methodparam"><span class="type">resource</span> <code class="parameter">$parser</code></span>, <span class="methodparam"><span class="type">object</span> <code class="parameter reference">&$object</code></span>): <span class="type"><a href="class.pool.html" class="type pool">pool</a></span></div>

    <p class="para rdfs-comment">
     该函数使得 <code class="parameter">parser</code> 指定的解析器可以被用在 <code class="parameter">object</code> 对象中。所有的回叫函数（callback function）都可以由 <span class="function"><a href="function.xml-set-element-handler.html" class="function">xml_set_element_handler()</a></span> 等函数来设置，它们被假定为 <code class="parameter">object</code> 对象的方法。
    </p>
    <p class="para">
     <div class="example" id="example-5297">
      <p><strong>Example #1 <span class="function"><strong>xml_set_object()</strong></span> 示例</strong></p>
      <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">xml&nbsp;&nbsp;</span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;</span><span style="color: #0000BB">$parser</span><span style="color: #007700">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;</span><span style="color: #0000BB">xml</span><span style="color: #007700">()&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">parser&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">xml_parser_create</span><span style="color: #007700">();<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">xml_set_object</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">xml_set_element_handler</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"tag_open"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"tag_close"</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">xml_set_character_data_handler</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"cdata"</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;</span><span style="color: #0000BB">parse</span><span style="color: #007700">(</span><span style="color: #0000BB">$data</span><span style="color: #007700">)&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">xml_parse</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$data</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;</span><span style="color: #0000BB">tag_open</span><span style="color: #007700">(</span><span style="color: #0000BB">$parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$tag</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$attributes</span><span style="color: #007700">)&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$tag</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$attributes</span><span style="color: #007700">);&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;</span><span style="color: #0000BB">cdata</span><span style="color: #007700">(</span><span style="color: #0000BB">$parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$cdata</span><span style="color: #007700">)&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$cdata</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;</span><span style="color: #0000BB">tag_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$tag</span><span style="color: #007700">)&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$tag</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />}&nbsp;</span><span style="color: #FF8000">//&nbsp;end&nbsp;of&nbsp;class&nbsp;xml<br /><br /></span><span style="color: #0000BB">$xml_parser&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">xml</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">$xml_parser</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">parse</span><span style="color: #007700">(</span><span style="color: #DD0000">"&lt;A&nbsp;ID='hallo'&gt;PHP&lt;/A&gt;"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
      </div>

     </div>
    </p>
   </div>

  </div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="119722""></a>
  <div class="note">
   <strong class="user">joey at gimo dot co dot uk</strong>
   <a href="#119722" class="date">10-Aug-2016 10:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This function seems to be of very limited use when [$object_instance, "method_name"] is a callable.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="58999""></a>
  <div class="note">
   <strong class="user">wake dot shinigami at gmail dot com</strong>
   <a href="#58999" class="date">23-Nov-2005 08:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I finally managed to get xml_set_object() to work, after much documentation searching.&nbsp; As the solution I found has been hinted at, the focus has been wrong.<br />
<br />
There have been many problems getting class contained XML parsers to make changes to the members of an instance.&nbsp; This is because, from what I'm guessing, the functions are using a either a new annonymous instance of the class or an uninstanced version of the class.<br />
<br />
What we want to make sure it does it that the parser is accessing its handlers as member methods of a particular instance of a class.&nbsp; This can be done using the array method for passing a callback, setting the object as a reference to this instance.&nbsp; This way, you know that the parser is going to call the function properly.<br />
<br />
Ex:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">Parser </span><span class="keyword">{<br />
<br />
&nbsp;private </span><span class="default">$parser</span><span class="keyword">;<br />
&nbsp;private </span><span class="default">$data</span><span class="keyword">;<br />
<br />
&nbsp;public function </span><span class="default">__construct</span><span class="keyword">() {<br />
&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">data </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;}<br />
<br />
&nbsp;private function </span><span class="default">ParseElementStart</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$name</span><span class="keyword">, </span><span class="default">$attrs</span><span class="keyword">) {<br />
&nbsp; </span><span class="comment">// Code<br />
&nbsp;</span><span class="keyword">}<br />
&nbsp;private function </span><span class="default">ParseElementEnd</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$name</span><span class="keyword">) {<br />
&nbsp; </span><span class="comment">// Code<br />
&nbsp;</span><span class="keyword">}<br />
<br />
&nbsp;public function </span><span class="default">Parse</span><span class="keyword">(</span><span class="default">$XMLdata</span><span class="keyword">) {<br />
&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">();<br />
&nbsp; </span><span class="default">xml_set_object</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">);<br />
&nbsp; </span><span class="default">xml_set_element_handler</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; array(&amp;</span><span class="default">$this</span><span class="keyword">, </span><span class="string">'ParseElementStart'</span><span class="keyword">),<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; array(&amp;</span><span class="default">$this</span><span class="keyword">, </span><span class="string">'ParseElementEnd'</span><span class="keyword">));<br />
&nbsp; </span><span class="default">xml_parse</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">, </span><span class="default">$XMLdata</span><span class="keyword">);<br />
&nbsp; </span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parser</span><span class="keyword">);<br />
&nbsp;}<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
With this, when you call the Parse method, the data in that instance can be modified.&nbsp; I'm not sure if xml_set_object becomes unneccissary when using the array callbacks, but I leave it in just to make sure that the xml_parse function knows it's in the object.<br />
<br />
As above, I'd recommend for memory sake, that the XML parser be created, used, and freed all in the same function, to ensure that everything is cleaned up correctly.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="46601""></a>
  <div class="note">
   <strong class="user">bettmenn at gmx dot de</strong>
   <a href="#46601" class="date">16-Oct-2004 02:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Adding to 'lmfe at mega dot ist dot utl dot pt' contribution below, I have to say that this behaviour is very usual for PHP if MemberVars of an Object arent initialized from the constructor.<br />
What worked best for me so far was something like this:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">foo </span><span class="keyword">{<br />
&nbsp; var </span><span class="default">$bar<br />
&nbsp; </span><span class="comment">// the constructor<br />
&nbsp; </span><span class="keyword">function </span><span class="default">foo</span><span class="keyword">() {<br />
&nbsp;&nbsp;&nbsp; unset(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">bar</span><span class="keyword">);&nbsp; </span><span class="comment">// with every instanciation, the variable is cleared for the object<br />
&nbsp; </span><span class="keyword">}<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="46107""></a>
  <div class="note">
   <strong class="user">lmfe at mega dot ist dot utl dot pt</strong>
   <a href="#46107" class="date">29-Sep-2004 10:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Using PHP 4.3.0, I got this strange behaviour:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">xml&nbsp; </span><span class="keyword">{<br />
<br />
&nbsp;&nbsp; &nbsp; </span><span class="comment">/* (as specified in the documentation above) */<br />
<br />
</span><span class="keyword">} </span><span class="comment">// end of class xml<br />
<br />
/* This code works */<br />
</span><span class="default">$xml_parser </span><span class="keyword">= new </span><span class="default">xml</span><span class="keyword">();<br />
</span><span class="default">$xml_parser</span><span class="keyword">-&gt;</span><span class="default">parse</span><span class="keyword">(</span><span class="string">"&lt;A ID='hallo'&gt;PHP&lt;/A&gt;"</span><span class="keyword">);<br />
<br />
</span><span class="comment">/* This code works */<br />
</span><span class="default">$xml_parser2 </span><span class="keyword">= new </span><span class="default">xml</span><span class="keyword">();<br />
</span><span class="default">$xml_parser2</span><span class="keyword">-&gt;</span><span class="default">parse</span><span class="keyword">(</span><span class="string">"&lt;A ID='hallo2'&gt;PHP2&lt;/A&gt;"</span><span class="keyword">);<br />
<br />
</span><span class="comment">/* This code DON'T work */<br />
</span><span class="default">$xml_parser </span><span class="keyword">= new </span><span class="default">xml</span><span class="keyword">();<br />
</span><span class="default">$xml_parser</span><span class="keyword">-&gt;</span><span class="default">parse</span><span class="keyword">(</span><span class="string">"&lt;A ID='hallo3'&gt;PHP3&lt;/A&gt;"</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
In the third block of code, php complains it can't find the handlers it needs.<br />
It seems this problem only happens if the variable is used more than once.<br />
Calling xml_parser_free doesn't help</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="44737""></a>
  <div class="note">
   <strong class="user">hwheinzen at t-online dot de</strong>
   <a href="#44737" class="date">14-Aug-2004 03:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
(Adding to zitan's note)<br />
It seems easy enough to provide output functions for callback handler classes too.<br />
<br />
Example:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">CallBack </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$name </span><span class="keyword">= </span><span class="string">'Callback'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$info </span><span class="keyword">= </span><span class="string">'Information!'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">toString</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">name</span><span class="keyword">.</span><span class="string">': '</span><span class="keyword">.</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">info</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
class </span><span class="default">Main </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$name </span><span class="keyword">= </span><span class="string">'Main'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$callBackObject</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">setCallBack</span><span class="keyword">(&amp;</span><span class="default">$cBIn</span><span class="keyword">) { </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">callBackObject </span><span class="keyword">= </span><span class="default">$cBIn</span><span class="keyword">; }<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">toString</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">name</span><span class="keyword">.</span><span class="string">': '</span><span class="keyword">.</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">callBackObject</span><span class="keyword">-&gt;</span><span class="default">toString</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">$cb </span><span class="keyword">= &amp; new </span><span class="default">CallBack</span><span class="keyword">;<br />
</span><span class="default">$m </span><span class="keyword">= &amp; new </span><span class="default">Main</span><span class="keyword">;<br />
</span><span class="default">$m</span><span class="keyword">-&gt;</span><span class="default">setCallBack</span><span class="keyword">(&amp;</span><span class="default">$cb</span><span class="keyword">);<br />
echo </span><span class="default">$cb</span><span class="keyword">-&gt;</span><span class="default">toString</span><span class="keyword">();<br />
echo </span><span class="default">$m</span><span class="keyword">-&gt;</span><span class="default">toString</span><span class="keyword">();<br />
</span><span class="default">?&gt;<br />
</span><br />
So, after collecting information during the parse operation within the callback handler class, e.g. in tag_close(), retrieving them is possible.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="35465""></a>
  <div class="note">
   <strong class="user">zitan at mediasculpt dot net</strong>
   <a href="#35465" class="date">01-Sep-2003 09:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just a note about creating abstract "call back handlers" as mentioned in some of the other notes.&nbsp; In this case I recommend extending the base XML class and overwritting the handler methods.&nbsp; The reason I wanted to do this, is that if you have a separate callback method class it causes problems, for example if you want to collect information out of the XML file and store it in an array.&nbsp; You can get around it with global variables, but I prefer to use them only when required ;)<br />
<br />
Example:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">xml_output </span><span class="keyword">extends </span><span class="default">xml</span><span class="keyword">{<br />
<br />
&nbsp; var </span><span class="default">$output </span><span class="keyword">= array();<br />
<br />
&nbsp;&nbsp; function </span><span class="default">xml_output</span><span class="keyword">(){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xml</span><span class="keyword">();<br />
&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//overwrite base methods<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">tag_open</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$tag</span><span class="keyword">, </span><span class="default">$attributes</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; { <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">array_push</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">output</span><span class="keyword">, </span><span class="string">"&lt;</span><span class="default">$tag</span><span class="string">, attributes&gt;"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">cdata</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$cdata</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">array_push</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">output</span><span class="keyword">, </span><span class="string">"</span><span class="default">$cdata</span><span class="string">"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">tag_close</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$tag</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">array_push</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">output</span><span class="keyword">, </span><span class="string">"&lt;/</span><span class="default">$tag</span><span class="string">&gt;"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
}<br />
<br />
</span><span class="default">$xml_parser </span><span class="keyword">= &amp; new </span><span class="default">xml_output</span><span class="keyword">();<br />
</span><span class="default">$xml_parser</span><span class="keyword">-&gt;</span><span class="default">parse</span><span class="keyword">(</span><span class="string">"&lt;A ID='hallo'&gt;PHP&lt;/A&gt;"</span><span class="keyword">);<br />
echo(</span><span class="string">"</span><span class="default">$xml_parser</span><span class="keyword">-&gt;</span><span class="default">output</span><span class="string">"</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="26776""></a>
  <div class="note">
   <strong class="user">sbeam at syxyz dot net</strong>
   <a href="#26776" class="date">12-Nov-2002 09:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
passing the object as a call-time ref (&amp;$this) as in the example will create a warning in php 4.1+. Pass xml_set_object($xp,$this); instead. This does not seem to break anything - but I dont know for sure.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="24037""></a>
  <div class="note">
   <strong class="user">chiefgeek at ecodedesign.com</strong>
   <a href="#24037" class="date">04-Aug-2002 10:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just adding a little note about my above written example.&nbsp; It needs some improvements.<br />
<br />
Because PHP passes by VALUE by default, when you pass an array like this:<br />
array($callback_handler, 'handler_method')<br />
PHP makes a copy of the callback_handler object and uses the handler_method in the copy.<br />
<br />
This is not an ideal situation for many reasons...which I will not get into here...but you should have an idea by now.<br />
<br />
The best way to fix this is to change a few things. In the function declaration change the parameter from $callback_handler to &amp;$callback_handler. So now your declaration should look like this<br />
<br />
function set_callback_handler(&amp;$callback_handler)<br />
{<br />
&nbsp; ...<br />
}<br />
<br />
Now each time you reference $callback_handler change it to &amp;$callback_handler.&nbsp; For example:<br />
<br />
xml_set_element_handler(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;xml_parser,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; array(&amp;$callback_handler, 'start_element'),<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; array(&amp;$callback_handler, 'close_Element' ));<br />
<br />
This ensures that PHP will always use the same object.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="24011""></a>
  <div class="note">
   <strong class="user">chiefgeek at ecodedesign.com</strong>
   <a href="#24011" class="date">03-Aug-2002 08:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
xml_set_object is great, if you want to hard code your start_element, end_element, etc functions within your xml class.<br />
<br />
But what if you want to increase the modularity of your application?<br />
<br />
Solution, create one generic XMLParser class that handles everything *except* the callback funtions.&nbsp; Then create an abstract XMLCallbackHandler class which you can extend to provide any customization you want.<br />
<br />
So how do you tell the php's xml_parser that you want to use this other class to handle the callback functions.<br />
<br />
xml_set_object?&nbsp; This only works if the functions are *within* the object you called this method from.<br />
<br />
The solution lies in the xml_set_element_handler() function.<br />
Take a look at this sample source...<br />
<br />
class XMLParser<br />
{<br />
<br />
&nbsp; ...<br />
<br />
&nbsp; function set_callback_handler($callback_handler)<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; // Assign the startElement endElement functions<br />
&nbsp;&nbsp;&nbsp; xml_set_element_handler(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;xml_parser,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; array($callback_handler, 'start_element'),<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; array($callback_handler, 'close_Element' ));<br />
<br />
&nbsp;&nbsp;&nbsp; /* By passing an array with this ($object, 'function_name') structure<br />
&nbsp;&nbsp; &nbsp; &nbsp; to the 2nd and 3rd parameters.&nbsp; We are able to tell the parser to<br />
&nbsp;&nbsp; &nbsp; &nbsp; look in another object for these callback functions.<br />
&nbsp;&nbsp;&nbsp; */<br />
<br />
&nbsp;&nbsp;&nbsp; // Assign the character data function<br />
&nbsp;&nbsp;&nbsp; xml_set_character_data_handler(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;xml_parser,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; array($callback_handler, 'character_data'));<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
class myCallBackHandler<br />
{<br />
&nbsp; function start_element(...)<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; //code goes here<br />
&nbsp; }<br />
<br />
&nbsp; function end_element(...)<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; //code goes here<br />
&nbsp; }<br />
<br />
&nbsp; function character_data(...)<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; //code goes here<br />
&nbsp; }<br />
}<br />
<br />
Now all thats left to do is use these classes..<br />
<br />
$parser = new XMLParser();<br />
$parser-&gt;set_callback_handler(new myCallbackHandler());</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="20683""></a>
  <div class="note">
   <strong class="user">dfoesch at cs dot nmsu dot edu</strong>
   <a href="#20683" class="date">12-Apr-2002 05:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
English explaination of why you do: $xml = &amp; new xml();<br />
<br />
Ok, when PHP executes "new xml()" it creates an anonymous variable (one that you can't reference with any name) which it then runs the constructor function on.&nbsp; Ok, now once that's done, it then assigns by VALUE in the example above.&nbsp; This means that that lovely pointer to your parser is pointing to the anonymous instance of your class, and not the used instance of your class... thus making a "shadow" of all your variables, where assignments inside the parser access different variables than outside the parser.&nbsp; What PHP _SHOULD_ be doing (similar to C++) is have this statement execute such that the assignment is done by REFERENCE, so that you assign the new name to the class that actually got constructed, and not just a copy of the class that you constructed.<br />
<br />
If they did it right, this code wouldn't be broken.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="19064""></a>
  <div class="note">
   
   <a href="#19064" class="date">14-Feb-2002 11:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Call-time pass-by-reference has been deprecated, so the example is buggy as was already mentionned. However since 4.04 (I think) "new" can return objects by reference. So the clean way to have both the parser initialised in the constructor, and to save the result in your object is to do <br />
<br />
$xml_parser = &amp; new xml();<br />
<br />
see <a href="http://www.php.net/manual/en/language.oop.newref.php" rel="nofollow" target="_blank">http://www.php.net/manual/en/language.oop.newref.php</a><br />
<br />
Ivan</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="15075""></a>
  <div class="note">
   <strong class="user">pete dot nelson at serverSXPYAZMsolved dot com</strong>
   <a href="#15075" class="date">27-Aug-2001 10:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
&lt;p&gt;in reply to jon9mm's question, I have found the same problem (function 'startElement' does not exist).&nbsp; I finally found the way around this, by re-reading this doc for xml_set_object.&nbsp; You HAVE to use the xml_set_object($this-&gt;parser, &amp;$this) within your parser function.&lt;/p&gt; &lt;p&gt;When that function is called, your object temporarily becomes the parser object and shares scope (so it can see 'startElement', etc).&nbsp;&nbsp; Once that function is done, the xml_set_object(...) call goes out of scope, and your object is no longer bound to the parser.&nbsp; So the simplist solution is to call xml_set_object(...), do any parsing, and then call xml_parser_free(...) all within the same function.&lt;/p&gt;
<br />
&lt;p&gt;And remember, don't call xml_set_object(...) in your object's constructor - your object will be forever bound to the parser object and you'll loose all access to your object's member functions.&lt;/p&gt;
<br />
&lt;p&gt;This is all explained in the examples above, but it took me reading it a couple of times to grok how it all works.&lt;/p&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="12893""></a>
  <div class="note">
   <strong class="user">nick at category4 dot com</strong>
   <a href="#12893" class="date">14-May-2001 01:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you're using the XML parser within an object, be careful not to accidentally call any methods that don't exist within the object. Instead of complaining that the missing method doesn't exist, PHP will say it's not able to find the handler routines, even if you've indicated them correctly. (PHP version 4.0.5 on FreeBSD).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="10006""></a>
  <div class="note">
   <strong class="user">williams at cse dot unl dot edu</strong>
   <a href="#10006" class="date">06-Dec-2000 12:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If xml_set_object is not called in the constructor of an object, the values that the parser modifies will be saved. Else, the values do not seem to be saved as stated by "i_sofer" above.
<br />
--- Start Example Code ---
<br />
class foo {
<br />
var xmlparser;
<br />
function foo() { \\the constructor
<br />
$this-&gt;xmlparser=xmlparser_create();
<br />
}
<br />
function parse() {
<br />
xml_set_object($this-&gt;xmlparser,&amp;$this);
<br />
\\also include data handler
<br />
\\and element handlers here
<br />
}
<br />
}
<br />
--- End Example Code ---</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="9678""></a>
  <div class="note">
   <strong class="user">i_sofer at yahoo dot com</strong>
   <a href="#9678" class="date">18-Nov-2000 04:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Using xml parser in objects seem to have a problem that values modified(even of the object itself) get lost as soon as parsing ends...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="7916""></a>
  <div class="note">
   <strong class="user">malcontent at msgto dot com</strong>
   <a href="#7916" class="date">20-Aug-2000 12:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The example will generate a warning unless allow_call_time_pass_reference is set to true in your INI file. It also will not accept a call by value.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="5162""></a>
  <div class="note">
   <strong class="user">robert at webmotion dot com</strong>
   <a href="#5162" class="date">18-Apr-2000 10:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
While true that there is no automatic destructor for PHP class objects, it is quite simple to create a method called destroy and perform the destruction manually. In the example above it may not be necessary to free the xml parser immediately... it would appear from the example that the object is re-useable.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
