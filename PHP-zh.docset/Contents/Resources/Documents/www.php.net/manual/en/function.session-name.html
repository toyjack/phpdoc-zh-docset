<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>读取/设置会话名称</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.session-module-name.html">? session_module_name</a></li>
      <li style="float: right;"><a href="function.session-regenerate-id.html">session_regenerate_id ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.session.html">Session 函数</a></li>
    <li>读取/设置会话名称</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.session-name" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">session_name</h1>
  <p class="verinfo">(PHP 4, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">session_name</span> &mdash; <span class="dc-title">读取/设置会话名称</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.session-name-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>session_name</strong></span>(<span class="methodparam"><span class="type">string</span> <code class="parameter">$name</code><span class="initializer"> = ?</span></span>): <span class="type">string</span></div>

  <p class="para rdfs-comment">
   <span class="function"><strong>session_name()</strong></span> 函数返回当前会话名称。
   如果指定 <code class="parameter">name</code> 参数，
   <span class="function"><strong>session_name()</strong></span> 函数会更新会话名称，
   并返回 <em class="emphasis">原来的</em> 会话名称。
  </p>
  <p class="para">
   如果使用 <code class="parameter">name</code> 指定了新字符串作为会话 cookie 的名字，
   <span class="function"><strong>session_name()</strong></span> 函数会修改 HTTP 响应中的 cookie
   （如果启用了 <code class="literal">session.transid</code>，还会输出会话 cookie 的内容）。
   一旦在 HTTP 响应中发送了 cookie 的内容之后，
   调用 <span class="function"><strong>session_name()</strong></span> 函数会产生错误。
   所以，一定要在调用 <span class="function"><a href="function.session-start.html" class="function">session_start()</a></span> 函数之前
   调用此函数。
  </p>
  <p class="para">
   请求开始的时候，会话名称会被重置并且存储到
   <code class="literal">session.name</code> 配置项。
   因此，要想设置会话名称，那么对于每个请求，都需要在
   调用 <span class="function"><a href="function.session-start.html" class="function">session_start()</a></span> 函数
   之前调用 <span class="function"><strong>session_name()</strong></span> 函数。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.session-name-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>
    
     <dt>
<code class="parameter">name</code></dt>

     <dd>

      <p class="para">
       用在 cookie 或者 URL 中的会话名称，
       例如：<code class="literal">PHPSESSID</code>。
       只能使用字母和数字作为会话名称，建议尽可能的短一些，
       并且是望文知意的名字（对于启用了 cookie 警告的用户来说，方便其判断是否要允许此 cookie）。
       如果指定了 <code class="parameter">name</code> 参数，
       那么当前会话也会使用指定值作为名称。
      </p>
      <p class="para">
       <div class="warning"><strong class="warning">Warning</strong>
        <p class="para">
         会话名称至少需要一个字母，不能全部都使用数字，
         否则，每次都会生成一个新的会话 ID。
        </p>
       </div>
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.session-name-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   返回当前会话名称。如果指定 <code class="parameter">name</code> 参数，那么此函数会更新会话名称，并且
   返回 <em class="emphasis">原来的</em> 会话名称。
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.session-name-examples">
  <h3 class="title">范例</h3>
  <p class="para">
   <div class="example" id="example-4616">
    <p><strong>Example #1 <span class="function"><strong>session_name()</strong></span> 示例</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br /></span><span style="color: #FF8000">/*&nbsp;设置会话名称为&nbsp;WebsiteID&nbsp;*/<br /><br /></span><span style="color: #0000BB">$previous_name&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">session_name</span><span style="color: #007700">(</span><span style="color: #DD0000">"WebsiteID"</span><span style="color: #007700">);<br /><br />echo&nbsp;</span><span style="color: #DD0000">"The&nbsp;previous&nbsp;session&nbsp;name&nbsp;was&nbsp;</span><span style="color: #0000BB">$previous_name</span><span style="color: #DD0000">&lt;br&nbsp;/&gt;"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>

 
 <div class="refsect1 changelog" id="refsect1-function.session-name-changelog">
  <h3 class="title">更新日志</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead>
      <tr>
       <th>版本</th>
       <th>说明</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
       <td>7.2.0</td>
       <td>
        <span class="function"><strong>session_name()</strong></span> 函数会检查会话状态，
        之前的版本仅仅检查 cookie 状态。
        所以，旧版本的 PHP 允许你在调用 <span class="function"><a href="function.session-start.html" class="function">session_start()</a></span>
        函数之后再调用 <span class="function"><strong>session_name()</strong></span> 函数，
        新版本的 PHP 不再允许这样做了。
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.session-name-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member">
     <a href="session.configuration.html#ini.session.name" class="link">session.name</a> 
     配置指示
    </li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="125829""></a>
  <div class="note">
   <strong class="user">mmulej at gmail dot com</strong>
   <a href="#125829" class="date">16-Feb-2021 09:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hope this is not out of php.net noting scope.<br />
<br />
session_name('name') must be set before session_start() because the former changes ini settings and the latter reads them. For the same reason session_set_cookie_params($options) must be set before session_start() as well.<br />
<br />
I find it best to do the following.<br />
<br />
function is_session_started()<br />
{<br />
&nbsp;&nbsp;&nbsp; if (php_sapi_name() === 'cli')<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return false;<br />
<br />
&nbsp;&nbsp;&nbsp; if (version_compare(phpversion(), '5.4.0', '&gt;='))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return session_status() === PHP_SESSION_ACTIVE;<br />
<br />
&nbsp;&nbsp;&nbsp; return session_id() !== '';<br />
}<br />
if (!is_session_started()) {<br />
&nbsp;&nbsp;&nbsp; session_name($session_name);<br />
&nbsp;&nbsp;&nbsp; session_set_cookie_params($cookie_options);<br />
&nbsp;&nbsp;&nbsp; session_start();<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="122818""></a>
  <div class="note">
   <strong class="user">tony at marston-home dot demon dot co dot uk</strong>
   <a href="#122818" class="date">10-Jun-2018 03:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The description has recently been modified to contain the statement "When new session name is supplied, session_name() modifies HTTP cookie". This is not correct as session_name() has never modified any cookie data. A change in session.name does not become effective until session_start() is called, and it is session_start() that creates the cookie if it does not already exist.<br />
<br />
See the following bug report for details: https://bugs.php.net/bug.php?id=76413</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="122796""></a>
  <div class="note">
   <strong class="user">tony at marston-home dot demon dot co dot uk</strong>
   <a href="#122796" class="date">04-Jun-2018 01:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The description that session_name() gets and/or sets the name of the current session is technically wrong. It does nothing but deal with the value originally supplied by the session.name value within the php.ini file.<br />
<br />
Thus:-<br />
$name = session_name();<br />
is functionally equivalent to<br />
$name = ini_get('session.name');<br />
and <br />
session_name('newname);<br />
is functionally equivalent to<br />
ini_set('session.name','newname');<br />
<br />
This also means that:<br />
$old_name = session_name('newname');<br />
is functionally equivalent to<br />
$old_name = ini_set('session.name','newname');<br />
<br />
The current value of session.name is not attached to a session until session_start() is called. Once session_start() has used session.name to lookup the session_id() in the cookie data the name becomes irrelevant as all further operations on the session data are keyed by the session_id().<br />
<br />
Note that changing session.name while a session is currently active will not update the name in any session cookie. The new name does not take effect until the next call to session_start(), and this requires that the current session, which was created with the previous value for session.name, be closed.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="118059""></a>
  <div class="note">
   <strong class="user">Victor H</strong>
   <a href="#118059" class="date">27-Sep-2015 06:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As&nbsp; Joseph Dalrymple said, adding session_name do slow down a little bit the execution time.<br />
But, what i've observed is that it decreased the fluctuation between requests.<br />
Requests on my script fluctuated between 0,045 and 0,022 seconds. With session_name("myapp"), it goes to 0,050 and 0,045. Not a big deal, but that's a point to note.<br />
<br />
For those with problems setting the name, when session.auto_start is set to 1, you need to set the session.name on php.ini!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="103472""></a>
  <div class="note">
   <strong class="user">Joseph Dalrymple</strong>
   <a href="#103472" class="date">14-Apr-2011 11:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For those wondering, this function is expensive!<br />
<br />
On a script that was executing in a consistent 0.0025 seconds, just the use of session_name("foo") shot my execution time up to ~0.09s. By simply sacrificing session_name("foo"), I sped my script up by roughly 0.09 seconds.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="89090""></a>
  <div class="note">
   <strong class="user">relsqui at chiliahedron dot com</strong>
   <a href="#89090" class="date">20-Feb-2009 11:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Remember, kids--you MUST use session_name() first if you want to use session_set_cookie_params() to, say, change the session timeout. Otherwise it won't work, won't give any error, and nothing in the documentation (that I've seen, anyway) will explain why.<br />
<br />
Thanks to brandan of bildungsroman.com who left a note under session_set_cookie_params() explaining this or I'd probably still be throwing my hands up about it.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86000""></a>
  <div class="note">
   <strong class="user">php at wiz dot cx</strong>
   <a href="#86000" class="date">27-Sep-2008 08:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
if you try to name a php session "example.com" it gets converted to "example_com" and everything breaks.<br />
<br />
don't use a period in your session name.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="48415""></a>
  <div class="note">
   <strong class="user">slave at codegrunt dot com</strong>
   <a href="#48415" class="date">22-Dec-2004 02:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
One gotcha I have noticed with session_name is that it will trigger a WARNING level error if the cookie or GET/POST variable value has something other than alphanumeric characters in it.&nbsp; If your site displays warnings and uses PHP sessions this may be a way to enumerate at least some of your scripts:&nbsp; <br />
<br />
<a href="http://example.com/foo.php?session_name_here=(bad" rel="nofollow" target="_blank">http://example.com/foo.php?session_name_here=(bad</a>)<br />
<br />
Warning: session_start(): The session id contains invalid characters, valid characters are only a-z, A-Z and 0-9 in /some/path/foo.php on line 666<br />
<br />
I did not see anything in the docs suggesting that one had to sanitize the PHP session ID values before opening the session but that appears to be the case.<br />
<br />
Unfortunately session_name() always returns true so you have to actually get to the point of assigning variables values before you know whether you have been passed bad session data (as far as I can see).&nbsp; After the error has been generated in other words.<br />
<br />
Cheers</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="42747""></a>
  <div class="note">
   <strong class="user">Hongliang Qiang</strong>
   <a href="#42747" class="date">27-May-2004 01:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This may sound no-brainer: the session_name() function will have no essential effect if you set session.auto_start to "true" in php.ini . And the obvious explanation is the session already started thus cannot be altered before the session_name() function--wherever it is in the script--is executed, same reason session_name needs to be called before session_start() as documented.<br />
<br />
I know it is really not a big deal. But I had a quite hard time before figuring this out, and hope it might be helpful to someone like me.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
