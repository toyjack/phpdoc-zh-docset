<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>返回一个 Directory 类实例</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.closedir.html">? closedir</a></li>
      <li style="float: right;"><a href="function.getcwd.html">getcwd ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.dir.html">目录函数函数</a></li>
    <li>返回一个 Directory 类实例</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.dir" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">dir</h1>
  <p class="verinfo">(PHP 4, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">dir</span> &mdash; <span class="dc-title">返回一个 Directory 类实例</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-function.dir-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>dir</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$directory</code></span>
   , <span class="methodparam"><span class="type">resource</span> <code class="parameter">$context</code> = ?</span>
   ) : <span class="type"><a href="class.directory.html" class="type Directory">Directory</a></span></div>

  
  <p class="para rdfs-comment">
   以面向对象的方式访问目录。打开 
   <code class="parameter">directory</code> 参数指定的目录。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.dir-parameters">
  <h3 class="title">参数</h3>
  <dl>

   
    <dt>
<code class="parameter">directory</code></dt>

    <dd>

     <p class="para">
      被打开的目录
     </p>
    </dd>

   
   
    <dt>
<code class="parameter">context</code></dt>

    <dd>

     <p class="para">
      <blockquote class="note"><p><strong class="note">Note</strong>: <span class="simpara">在 PHP 5.0.0
中增加了对上下文（Context）的支持。有关<code class="literal">上下文（Context）</code>的说明参见
<a href="book.stream.html" class="xref">Streams</a>。</span></p></blockquote>
     </p>
    </dd>

   
  </dl>

 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.dir-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   成功的话，返回一个 <a href="class.directory.html" class="classname">Directory</a> 类实例, 参数错误的情况下返回 <strong><code>null</code></strong> ，
   其它错误情况返回 <strong><code>false</code></strong> 。
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.dir-examples">
  <h3 class="title">范例</h3>
  <p class="para">
   <div class="example" id="example-2511">
    <p><strong>Example #1 <span class="function"><strong>dir()</strong></span> 示例</strong></p>
    <div class="example-contents"><p>
     请特别注意下面示例中 <span class="function"><a href="directory.read.html" class="function">Directory::read()</a></span> 函数返回值的判断方式。
     我们严格测试（值相等，并且类型相同，请参考 <a href="language.operators.comparison.html" class="link">
     比较运算符</a> ）返回值等于 <strong><code>false</code></strong> ，因为有些情况下，目录名可能&quot;等于&quot; <strong><code>false</code></strong> ，导致
     跳出循环。
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$d&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">dir</span><span style="color: #007700">(</span><span style="color: #DD0000">"/etc/php5"</span><span style="color: #007700">);<br />echo&nbsp;</span><span style="color: #DD0000">"Handle:&nbsp;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$d</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">handle&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br />echo&nbsp;</span><span style="color: #DD0000">"Path:&nbsp;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$d</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">path&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br />while&nbsp;(</span><span style="color: #0000BB">false&nbsp;</span><span style="color: #007700">!==&nbsp;(</span><span style="color: #0000BB">$entry&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$d</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">read</span><span style="color: #007700">()))&nbsp;{<br />&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">$entry</span><span style="color: #007700">.</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br />}<br /></span><span style="color: #0000BB">$d</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">close</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>以上例程的输出类似于：</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
Handle: Resource id #2
Path: /etc/php5
.
..
apache
cgi
cli
</pre></div>
    </div>
   </div>
  </p>
 </div>


 <div class="refsect1 notes" id="refsect1-function.dir-notes">
  <h3 class="title">注释</h3>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    目录条目返回的顺序依赖于系统。
   </p>
  </p></blockquote>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="122812""></a>
  <div class="note">
   <strong class="user">synnus at gmail dot com</strong>
   <a href="#122812" class="date">08-Jun-2018 01:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php <br />
<br />
</span><span class="comment">// use $entry[0] != '.'&nbsp; to detect if it's '..' or '.' <br />
<br />
</span><span class="default">$d </span><span class="keyword">= </span><span class="default">dir</span><span class="keyword">(</span><span class="string">'.'</span><span class="keyword">);<br />
echo </span><span class="string">"Pointeur : " </span><span class="keyword">. </span><span class="default">$d</span><span class="keyword">-&gt;</span><span class="default">handle </span><span class="keyword">. </span><span class="string">"&lt;br/&gt;\n"</span><span class="keyword">;<br />
echo </span><span class="string">"Chemin : " </span><span class="keyword">. </span><span class="default">$d</span><span class="keyword">-&gt;</span><span class="default">path </span><span class="keyword">. </span><span class="string">"&lt;br/&gt;\n"</span><span class="keyword">;<br />
while (</span><span class="default">false </span><span class="keyword">!== (</span><span class="default">$entry </span><span class="keyword">= </span><span class="default">$d</span><span class="keyword">-&gt;</span><span class="default">read</span><span class="keyword">())) {<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp; if( </span><span class="default">$entry</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] != </span><span class="string">'.' </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo&nbsp; . </span><span class="string">"&lt;br/&gt;\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; }<br />
&nbsp;&nbsp; <br />
}<br />
</span><span class="default">$d</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">()<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="119209""></a>
  <div class="note">
   <strong class="user">synnus at gmail dot com</strong>
   <a href="#119209" class="date">19-Apr-2016 01:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
&nbsp;</span><span class="comment">// best small recurcive dir() <br />
&nbsp;// $entry[0]!='.'&nbsp; &lt;=== specifically to protect FTP files with a&nbsp; dot '.' as first&nbsp; carractère<br />
&nbsp;// return : <br />
&nbsp;// download\file\text\test.txt;<br />
&nbsp;// download\video\anime\test.mp4;<br />
&nbsp;// download\video\film\test2.mkv;<br />
<br />
&nbsp;</span><span class="keyword">echo </span><span class="default">rdir</span><span class="keyword">(</span><span class="string">'download'</span><span class="keyword">); </span><span class="comment">// start dir in \\download <br />
<br />
&nbsp;</span><span class="keyword">function </span><span class="default">rdir</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">,</span><span class="default">$k</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">) {&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$d </span><span class="keyword">= </span><span class="default">dir</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while (</span><span class="default">false </span><span class="keyword">!== (</span><span class="default">$entry </span><span class="keyword">= </span><span class="default">$d</span><span class="keyword">-&gt;</span><span class="default">read</span><span class="keyword">())) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$entry</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]!=</span><span class="string">'.'</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$path </span><span class="keyword">. </span><span class="string">'\\' </span><span class="keyword">. </span><span class="default">$entry</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$k </span><span class="keyword">= </span><span class="default">rdir</span><span class="keyword">(</span><span class="default">$k</span><span class="keyword">,</span><span class="default">$path </span><span class="keyword">. </span><span class="string">'\\' </span><span class="keyword">. </span><span class="default">$entry</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$k </span><span class="keyword">.= </span><span class="default">$path </span><span class="keyword">. </span><span class="string">'\\' </span><span class="keyword">. </span><span class="default">$entry </span><span class="keyword">. </span><span class="string">"; \n" </span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$d</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$k</span><span class="keyword">;&nbsp; &nbsp; <br />
&nbsp;}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="105192""></a>
  <div class="note">
   <strong class="user">Alex A.</strong>
   <a href="#105192" class="date">02-Aug-2011 05:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?PHP&nbsp; &nbsp; &nbsp; <br />
</span><span class="comment">/*Simple, good looking recursive function for printing directories.<br />
Just copy/paste and it is ready to go!*/<br />
<br />
</span><span class="keyword">function </span><span class="default">printCurrentDirRecursively</span><span class="keyword">(</span><span class="default">$originDirectory</span><span class="keyword">, </span><span class="default">$printDistance</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// just a little html-styling<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">$printDistance</span><span class="keyword">==</span><span class="default">0</span><span class="keyword">)echo </span><span class="string">'&lt;div style="color:#35a; font-family:Verdana; font-size:11px;"&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$leftWhiteSpace </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$printDistance</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++)&nbsp; </span><span class="default">$leftWhiteSpace </span><span class="keyword">= </span><span class="default">$leftWhiteSpace</span><span class="keyword">.</span><span class="string">"&amp;nbsp;"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$CurrentWorkingDirectory </span><span class="keyword">= </span><span class="default">dir</span><span class="keyword">(</span><span class="default">$originDirectory</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; while(</span><span class="default">$entry</span><span class="keyword">=</span><span class="default">$CurrentWorkingDirectory</span><span class="keyword">-&gt;</span><span class="default">read</span><span class="keyword">()){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$entry </span><span class="keyword">!= </span><span class="string">"." </span><span class="keyword">&amp;&amp; </span><span class="default">$entry </span><span class="keyword">!= </span><span class="string">".."</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$originDirectory</span><span class="keyword">.</span><span class="string">"\\"</span><span class="keyword">.</span><span class="default">$entry</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">$leftWhiteSpace</span><span class="keyword">.</span><span class="string">"&lt;b&gt;"</span><span class="keyword">.</span><span class="default">$entry</span><span class="keyword">.</span><span class="string">"&lt;/b&gt;&lt;br&gt;\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">printCurrentDirRecursively</span><span class="keyword">(</span><span class="default">$originDirectory</span><span class="keyword">.</span><span class="string">"\\"</span><span class="keyword">.</span><span class="default">$entry</span><span class="keyword">, </span><span class="default">$printDistance</span><span class="keyword">+</span><span class="default">2</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">$leftWhiteSpace</span><span class="keyword">.</span><span class="default">$entry</span><span class="keyword">.</span><span class="string">"&lt;br&gt;\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$CurrentWorkingDirectory</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$printDistance</span><span class="keyword">==</span><span class="default">0</span><span class="keyword">)echo </span><span class="string">"&lt;/div&gt;"</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="comment">//TEST IT!<br />
</span><span class="default">printCurrentDirRecursively</span><span class="keyword">(</span><span class="default">getcwd</span><span class="keyword">());<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="101924""></a>
  <div class="note">
   <strong class="user">GUILLE@GARGANO</strong>
   <a href="#101924" class="date">18-Jan-2011 09:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
to get a dir of <a href="http://www.example.com/directory" rel="nofollow" target="_blank">http://www.example.com/directory</a>
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">remotedir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">)
<br />
{
<br />
&nbsp; </span><span class="default">$dir </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">" "</span><span class="keyword">, </span><span class="string">"%20"</span><span class="keyword">, </span><span class="default">html_entity_decode</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">));
<br />
&nbsp; if ((</span><span class="default">$rh </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">, </span><span class="string">'rb'</span><span class="keyword">)) === </span><span class="default">FALSE</span><span class="keyword">) { return </span><span class="default">false</span><span class="keyword">; }
<br />
&nbsp; </span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br />
&nbsp; while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$rh</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$archivos </span><span class="keyword">= </span><span class="default">fgetss</span><span class="keyword">(</span><span class="default">$rh</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$directorio</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">++] = </span><span class="default">trim</span><span class="keyword">( </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$archivos</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$archivos</span><span class="keyword">,</span><span class="string">" "</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">)) );
<br />
&nbsp; }
<br />
&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$rh</span><span class="keyword">);
<br />
&nbsp; return </span><span class="default">$directorio</span><span class="keyword">;
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93825""></a>
  <div class="note">
   <strong class="user">emanueledelgrande at email dot it</strong>
   <a href="#93825" class="date">01-Oct-2009 06:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When creating custom solutions, use predefined PHP constants to shorten your code and improve performances:<br />
<a href="http://www.php.net/manual/en/reserved.constants.php" rel="nofollow" target="_blank">http://www.php.net/manual/en/reserved.constants.php</a><br />
<br />
For example, DIRECTORY_SEPARATOR may replace a function in which you check PHP_OS to set if the directory separator is "/" or "\\".<br />
<br />
Cheers.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86457""></a>
  <div class="note">
   <strong class="user">sojka at online-forum dot net</strong>
   <a href="#86457" class="date">20-Oct-2008 03:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
That's the way, I'm storing recursive dirs to an array.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">public static function </span><span class="default">getTreeFolders</span><span class="keyword">(</span><span class="default">$sRootPath </span><span class="keyword">= </span><span class="default">UPLOAD_PATH_PROJECT</span><span class="keyword">, </span><span class="default">$iDepth </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$iDepth</span><span class="keyword">++;
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$aDirs </span><span class="keyword">= array();
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$oDir </span><span class="keyword">= </span><span class="default">dir</span><span class="keyword">(</span><span class="default">$sRootPath</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp;&nbsp; while((</span><span class="default">$sDir </span><span class="keyword">= </span><span class="default">$oDir</span><span class="keyword">-&gt;</span><span class="default">read</span><span class="keyword">()) !== </span><span class="default">false</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$sDir </span><span class="keyword">!= </span><span class="string">'.' </span><span class="keyword">&amp;&amp; </span><span class="default">$sDir </span><span class="keyword">!= </span><span class="string">'..' </span><span class="keyword">&amp;&amp; </span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$sRootPath</span><span class="keyword">.</span><span class="default">$sDir</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$aDirs</span><span class="keyword">[</span><span class="default">$iDepth</span><span class="keyword">][</span><span class="string">'sName'</span><span class="keyword">][] = </span><span class="default">$sDir</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$aDirs</span><span class="keyword">[</span><span class="default">$iDepth</span><span class="keyword">][</span><span class="string">'aSub'</span><span class="keyword">][]&nbsp; = </span><span class="default">self</span><span class="keyword">::</span><span class="default">getTreeFolders</span><span class="keyword">(</span><span class="default">$sRootPath</span><span class="keyword">.</span><span class="default">$sDir</span><span class="keyword">.</span><span class="string">'/'</span><span class="keyword">,</span><span class="default">$iDepth</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$oDir</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();
<br />
&nbsp;&nbsp; &nbsp;&nbsp; return empty(</span><span class="default">$aDirs</span><span class="keyword">) ? </span><span class="default">false </span><span class="keyword">: </span><span class="default">$aDirs</span><span class="keyword">;
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="80945""></a>
  <div class="note">
   <strong class="user">manuel at buschmanuel dot de</strong>
   <a href="#80945" class="date">07-Feb-2008 02:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here my solution how to do effective recursiv directory listing.<br />
<br />
Have fun.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">/**<br />
&nbsp;* example of use: <br />
&nbsp;*/<br />
</span><span class="default">$d </span><span class="keyword">= new </span><span class="default">RecDir</span><span class="keyword">(</span><span class="string">"/etc/"</span><span class="keyword">,</span><span class="default">false</span><span class="keyword">);<br />
echo </span><span class="string">"Path: " </span><span class="keyword">. </span><span class="default">$d</span><span class="keyword">-&gt;</span><span class="default">getRootPath</span><span class="keyword">() . </span><span class="string">"\n"</span><span class="keyword">;<br />
while (</span><span class="default">false </span><span class="keyword">!== (</span><span class="default">$entry </span><span class="keyword">= </span><span class="default">$d</span><span class="keyword">-&gt;</span><span class="default">read</span><span class="keyword">())) {<br />
&nbsp;&nbsp; echo </span><span class="default">$entry</span><span class="keyword">.</span><span class="string">"\n"</span><span class="keyword">;<br />
}<br />
</span><span class="default">$d</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();<br />
<br />
class </span><span class="default">RecDir<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp; protected </span><span class="default">$currentPath</span><span class="keyword">;<br />
&nbsp;&nbsp; protected </span><span class="default">$slash</span><span class="keyword">;<br />
&nbsp;&nbsp; protected </span><span class="default">$rootPath</span><span class="keyword">;<br />
&nbsp;&nbsp; protected </span><span class="default">$recursiveTree</span><span class="keyword">;&nbsp;&nbsp; <br />
<br />
&nbsp;&nbsp; function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$rootPath</span><span class="keyword">,</span><span class="default">$win</span><span class="keyword">=</span><span class="default">false</span><span class="keyword">)<br />
&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; switch(</span><span class="default">$win</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; case </span><span class="default">true</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">slash </span><span class="keyword">= </span><span class="string">'\\'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; default:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">slash </span><span class="keyword">= </span><span class="string">'/'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">rootPath </span><span class="keyword">= </span><span class="default">$rootPath</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">currentPath </span><span class="keyword">= </span><span class="default">$rootPath</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">recursiveTree </span><span class="keyword">= array(</span><span class="default">dir</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">rootPath</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">rewind</span><span class="keyword">();<br />
&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; function </span><span class="default">__destruct</span><span class="keyword">()<br />
&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();<br />
&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; public function </span><span class="default">close</span><span class="keyword">()<br />
&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; while(</span><span class="default">true </span><span class="keyword">=== (</span><span class="default">$d </span><span class="keyword">= </span><span class="default">array_pop</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">recursiveTree</span><span class="keyword">)))<br />
&nbsp;&nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$d</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; public function </span><span class="default">closeChildren</span><span class="keyword">()<br />
&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; while(</span><span class="default">count</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">recursiveTree</span><span class="keyword">)&gt;</span><span class="default">1 </span><span class="keyword">&amp;&amp; </span><span class="default">false </span><span class="keyword">!== (</span><span class="default">$d </span><span class="keyword">= </span><span class="default">array_pop</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">recursiveTree</span><span class="keyword">)))<br />
&nbsp;&nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$d</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; public function </span><span class="default">getRootPath</span><span class="keyword">()<br />
&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; if(isset(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">rootPath</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">rootPath</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; public function </span><span class="default">getCurrentPath</span><span class="keyword">()<br />
&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; if(isset(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">currentPath</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">currentPath</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; }<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp; public function </span><span class="default">read</span><span class="keyword">()<br />
&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; while(</span><span class="default">count</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">recursiveTree</span><span class="keyword">)&gt;</span><span class="default">0</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$d </span><span class="keyword">= </span><span class="default">end</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">recursiveTree</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; if((</span><span class="default">false </span><span class="keyword">!== (</span><span class="default">$entry </span><span class="keyword">= </span><span class="default">$d</span><span class="keyword">-&gt;</span><span class="default">read</span><span class="keyword">())))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$entry</span><span class="keyword">!=</span><span class="string">'.' </span><span class="keyword">&amp;&amp; </span><span class="default">$entry</span><span class="keyword">!=</span><span class="string">'..'</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$path </span><span class="keyword">= </span><span class="default">$d</span><span class="keyword">-&gt;</span><span class="default">path</span><span class="keyword">.</span><span class="default">$entry</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">is_file</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$path</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elseif(</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">.</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">slash</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">currentPath </span><span class="keyword">= </span><span class="default">$path</span><span class="keyword">.</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">slash</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$child </span><span class="keyword">= @</span><span class="default">dir</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">.</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">slash</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">recursiveTree</span><span class="keyword">[] = </span><span class="default">$child</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">array_pop</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">recursiveTree</span><span class="keyword">)-&gt;</span><span class="default">close</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; public function </span><span class="default">rewind</span><span class="keyword">()<br />
&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">closeChildren</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">rewindCurrent</span><span class="keyword">();<br />
&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; public function </span><span class="default">rewindCurrent</span><span class="keyword">()<br />
&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; return </span><span class="default">end</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">recursiveTree</span><span class="keyword">)-&gt;</span><span class="default">rewind</span><span class="keyword">();<br />
&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75988""></a>
  <div class="note">
   <strong class="user">cf at chronofish dot com</strong>
   <a href="#75988" class="date">25-Jun-2007 03:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The dir Class, from what I can tell, on a Windows box is not a&nbsp; live image of the directory.&nbsp; When the class is instantiated it takes a snapshot of the directory and then the iterator works off that.<br />
<br />
I may be wrong, but when I run two processes that look to see if a directory exists, and then deletes the dir when some processing takes place.&nbsp; Deletes from one process do not effect the iteration of the second.<br />
<br />
To get around this I check that the file exists before doing my processing:<br />
<br />
$d = dir($dataDir);<br />
while (false !== ($entry = $d-&gt;read()))<br />
if ($entry != '..' &amp;&amp; $entry != '.' &amp;&amp; file_exists("$dataDir\\$entry"))<br />
{<br />
&nbsp;&nbsp;&nbsp; // do stuff<br />
}<br />
$d-&gt;close();<br />
<br />
I run this as a batch process and can activate it multiple times to process the directory listing in parallel.<br />
<br />
-CF</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="72773""></a>
  <div class="note">
   <strong class="user">thomas at hawkes dot ca</strong>
   <a href="#72773" class="date">31-Jan-2007 06:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
With SPL, you could recursively list all of the folders inside the current directory like this:<br />
<br />
<span class="default">&lt;?php<br />
$it </span><span class="keyword">= new </span><span class="default">RecursiveDirectoryIterator</span><span class="keyword">(</span><span class="string">'./'</span><span class="keyword">);<br />
<br />
</span><span class="comment">// RecursiveIteratorIterator accepts the following modes:<br />
//&nbsp; &nbsp;&nbsp; LEAVES_ONLY = 0&nbsp; (default)<br />
//&nbsp; &nbsp;&nbsp; SELF_FIRST&nbsp; = 1<br />
//&nbsp; &nbsp;&nbsp; CHILD_FIRST = 2<br />
</span><span class="keyword">foreach (new </span><span class="default">RecursiveIteratorIterator</span><span class="keyword">(</span><span class="default">$it</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">) as </span><span class="default">$path</span><span class="keyword">) {<br />
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$path</span><span class="keyword">-&gt;</span><span class="default">isDir</span><span class="keyword">()) {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"</span><span class="default">$path</span><span class="string">\n"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="72434""></a>
  <div class="note">
   <strong class="user">http://www.rooftopsolutions.nl</strong>
   <a href="#72434" class="date">18-Jan-2007 09:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
&nbsp;<br />
&nbsp; $i </span><span class="keyword">= new </span><span class="default">RecursiveIteratorIterator</span><span class="keyword">(new </span><span class="default">RecursiveDirectoryIterator</span><span class="keyword">(</span><span class="string">'.'</span><span class="keyword">));<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
works for me..</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="70053""></a>
  <div class="note">
   <strong class="user">alex at snet-group dot org</strong>
   <a href="#70053" class="date">01-Oct-2006 11:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
IMHO, thats take most effect with smaller number of errors;)<br />
&nbsp;<br />
&nbsp;&nbsp; &nbsp; function get_leaf_dirs($dir) <br />
&nbsp;&nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; $array = array();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; $d = @dir($dir);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; if($d)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; while (false !== ($entry = $d-&gt;read())) <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if($entry!='.' &amp;&amp; $entry!='..') <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $entry = $dir.'/'.$entry;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(is_dir($entry)) <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $subdirs = get_leaf_dirs($entry);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ($subdirs)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $array = array_merge($array, $subdirs);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $array[] = $entry;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $d-&gt;close();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; return $array;<br />
&nbsp;&nbsp; &nbsp;&nbsp; }</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69124""></a>
  <div class="note">
   <strong class="user">done_to_death at example dot com</strong>
   <a href="#69124" class="date">23-Aug-2006 05:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
function directoryList($start,$win32=false){<br />
&nbsp;&nbsp;&nbsp; if($win32){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $slash="\\";<br />
&nbsp;&nbsp;&nbsp; }else{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $slash="/";<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; $basename = pathinfo($start);<br />
&nbsp;&nbsp;&nbsp; $basename = $basename['basename'];<br />
&nbsp;&nbsp;&nbsp; $ls=array();<br />
&nbsp;&nbsp;&nbsp; $dir = dir($start);<br />
&nbsp;&nbsp;&nbsp; while($item = $dir-&gt;read()){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(is_dir($start.$slash.$item)&amp;&amp; $item!="." &amp;&amp; $item!=".."){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $ls[$basename][]=directoryList($start.$slash.$item,$win32);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }else{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if($item!="."&amp;&amp;$item!=".."){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $ls[$basename][]=$item;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return $ls;<br />
}<br />
<br />
$path = pathinfo(__FILE__);<br />
$ls = directoryList($path['dirname'], true);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="62224""></a>
  <div class="note">
   
   <a href="#62224" class="date">22-Feb-2006 01:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Regarding samuel's comment about the dir() function not supporting Unicode properly, it's all in the encoding. The function does NOT internally change Unicode characters into question marks (?), as I was first led to believe. If you simply try to output them in UTF-8, they'll show up just right.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="61064""></a>
  <div class="note">
   <strong class="user">samuel dot l at mushicrew dot com</strong>
   <a href="#61064" class="date">24-Jan-2006 10:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that the dir object will use the default encoding for non-unicode programs on Windows with PHP 5.x.<br />
<br />
So, if you have a file named with characters unsupported by the current default encoding, the dir-&gt;read() method will return a wrong entry.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/*<br />
** This script is on the same directory than a file named with<br />
** unsupported characters for the current default encoding.<br />
*/<br />
</span><span class="default">$d </span><span class="keyword">= </span><span class="default">dir</span><span class="keyword">(</span><span class="string">"./"</span><span class="keyword">);<br />
while(</span><span class="default">false </span><span class="keyword">!== (</span><span class="default">$e </span><span class="keyword">= </span><span class="default">$d</span><span class="keyword">-&gt;</span><span class="default">read</span><span class="keyword">()))<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">$e </span><span class="keyword">. </span><span class="string">'&lt;br/&gt;'</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
This will print a "?" for every unsupported characters, and not the right file name. So take care if you check with is_file/is_dir right after enumerating.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="60661""></a>
  <div class="note">
   <strong class="user">radar at frozenplague dot net</strong>
   <a href="#60661" class="date">13-Jan-2006 12:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Regarding jaqb's post about a correction to the read_dir function, I have one small fix too if people wish to also list the directories inside this directory and read them into the same array.<br />
<br />
&lt;?<br />
function read_dir($dir) {<br />
&nbsp;&nbsp; $array = array();<br />
&nbsp;&nbsp; $d = dir($dir);<br />
&nbsp;&nbsp; while (false !== ($entry = $d-&gt;read())) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; if($entry!='.' &amp;&amp; $entry!='..') {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $entry = $dir.'/'.$entry;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(is_dir($entry)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $array[] = $entry;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $array = array_merge($array, read_dir($entry));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $array[] = $entry;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; }<br />
&nbsp;&nbsp; $d-&gt;close();<br />
&nbsp;&nbsp; return $array;<br />
}<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="60563""></a>
  <div class="note">
   <strong class="user">fordiman at gmail dot com</strong>
   <a href="#60563" class="date">10-Jan-2006 10:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Saw the leaf dirs bit...&nbsp; quick mod:<br />
<br />
function preg_ls ($path=".", $rec=false, $pat="/.*/") {<br />
&nbsp;&nbsp;&nbsp; $pat=preg_replace ("|(/.*/[^S]*)|s", "\\1S", $pat);<br />
&nbsp;&nbsp;&nbsp; while (substr ($path,-1,1) =="/") $path=substr ($path,0,-1);<br />
&nbsp;&nbsp;&nbsp; if (!is_dir ($path) ) $path=dirname ($path);<br />
&nbsp;&nbsp;&nbsp; if ($rec!==true) $rec=false;<br />
&nbsp;&nbsp;&nbsp; $d=dir ($path);<br />
&nbsp;&nbsp;&nbsp; $ret=Array ();<br />
&nbsp;&nbsp;&nbsp; while (false!== ($e=$d-&gt;read () ) ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( ($e==".") || ($e=="..") ) continue;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ($rec &amp;&amp; is_dir ($path."/".$e) ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $ret=array_merge ($ret,preg_ls($path."/".$e,$rec,$pat));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; continue;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!preg_match ($pat,$e) ) continue;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $ret[]=$path."/".$e;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return (empty ($ret) &amp;&amp; preg_match ($pat,basename($path))) ? Array ($path."/") : $ret;<br />
}<br />
<br />
example:<br />
<br />
foreach (preg_ls ("/usr/share/fluxbox", true, "/[LT]e[sa]/i") as $file) echo $file."\n";<br />
<br />
output:<br />
<br />
/usr/share/fluxbox/styles/Leaf/<br />
/usr/share/fluxbox/styles/Clean<br />
/usr/share/fluxbox/styles/Testing/</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="60562""></a>
  <div class="note">
   <strong class="user">fordiman at gmail dot com</strong>
   <a href="#60562" class="date">10-Jan-2006 10:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This one's pretty nice.&nbsp; After getting frustrated for hunting down .jpg files in my massive music collection (PHP would run out of memory), I thought there should be a preg_ls function.<br />
<br />
function preg_ls ($path=".", $rec=false, $pat="/.*/") {<br />
&nbsp;&nbsp;&nbsp; // it's going to be used repeatedly, ensure we compile it for speed.<br />
&nbsp;&nbsp;&nbsp; $pat=preg_replace("|(/.*/[^S]*)|s", "\\1S", $pat);<br />
&nbsp;&nbsp;&nbsp; //Remove trailing slashes from path<br />
&nbsp;&nbsp;&nbsp; while (substr($path,-1,1)=="/") $path=substr($path,0,-1);<br />
&nbsp;&nbsp;&nbsp; //also, make sure that $path is a directory and repair any screwups<br />
&nbsp;&nbsp;&nbsp; if (!is_dir($path)) $path=dirname($path);<br />
&nbsp;&nbsp;&nbsp; //assert either truth or falsehoold of $rec, allow no scalars to mean truth<br />
&nbsp;&nbsp;&nbsp; if ($rec!==true) $rec=false;<br />
&nbsp;&nbsp;&nbsp; //get a directory handle<br />
&nbsp;&nbsp;&nbsp; $d=dir($path);<br />
&nbsp;&nbsp;&nbsp; //initialise the output array<br />
&nbsp;&nbsp;&nbsp; $ret=Array();<br />
&nbsp;&nbsp;&nbsp; //loop, reading until there's no more to read<br />
&nbsp;&nbsp;&nbsp; while (false!==($e=$d-&gt;read())) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; //Ignore parent- and self-links<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (($e==".")||($e=="..")) continue;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; //If we're working recursively and it's a directory, grab and merge<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ($rec &amp;&amp; is_dir($path."/".$e)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $ret=array_merge($ret,preg_ls($path."/".$e,$rec,$pat));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; continue;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; //If it don't match, exclude it<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!preg_match($pat,$e)) continue;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; //In all other cases, add it to the output array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $ret[]=$path."/".$e;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; //finally, return the array<br />
&nbsp;&nbsp;&nbsp; return $ret;<br />
}<br />
<br />
Not bad for a mere 18 lines, don't you think?<br />
<br />
Example use:<br />
<br />
foreach (preg_ls("/etc/X11", true, "/.*\.conf/i") as $file) echo $file."\n";<br />
<br />
Output: <br />
<br />
/etc/X11/xkb/README.config<br />
/etc/X11/xorg.conf-vesa<br />
/etc/X11/xorg.conf~<br />
/etc/X11/gui.conf<br />
/etc/X11/xorg.conf<br />
/etc/X11/xorg.conf-fbdev</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="60374""></a>
  <div class="note">
   <strong class="user">Anton Backer</strong>
   <a href="#60374" class="date">04-Jan-2006 07:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
i've modified the script below to get the leaf folders of any directory (folders with no subfolders).<br />
<br />
note: this does not return the folder passed in as a parameter, even if it has no subfolders.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">get_leaf_dirs</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">) {<br />
&nbsp;&nbsp; </span><span class="default">$array </span><span class="keyword">= array();<br />
&nbsp;&nbsp; </span><span class="default">$d </span><span class="keyword">= </span><span class="default">dir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">);<br />
&nbsp;&nbsp; while (</span><span class="default">false </span><span class="keyword">!== (</span><span class="default">$entry </span><span class="keyword">= </span><span class="default">$d</span><span class="keyword">-&gt;</span><span class="default">read</span><span class="keyword">())) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; if(</span><span class="default">$entry</span><span class="keyword">!=</span><span class="string">'.' </span><span class="keyword">&amp;&amp; </span><span class="default">$entry</span><span class="keyword">!=</span><span class="string">'..'</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$entry </span><span class="keyword">= </span><span class="default">$dir</span><span class="keyword">.</span><span class="string">'/'</span><span class="keyword">.</span><span class="default">$entry</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$entry</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$subdirs </span><span class="keyword">= </span><span class="default">get_leaf_dirs</span><span class="keyword">(</span><span class="default">$entry</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$subdirs</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$array </span><span class="keyword">= </span><span class="default">array_merge</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">, </span><span class="default">$subdirs</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$array</span><span class="keyword">[] = </span><span class="default">$entry</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; }<br />
&nbsp;&nbsp; </span><span class="default">$d</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();<br />
&nbsp;&nbsp; return </span><span class="default">$array</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
