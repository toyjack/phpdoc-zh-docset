<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>Shared Memory</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="class.sysvsharedmemory.html">? SysvSharedMemory</a></li>
      <li style="float: right;"><a href="intro.shmop.html">简介 ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="refs.fileprocess.process.html">进程控制扩展</a></li>
    <li>Shared Memory</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="book.shmop" class="book">
 
 <h1 class="title">Shared Memory</h1>
 
 
 
 
 
 







 







 





 

 





 





<ul class="chunklist chunklist_book"><li><a href="intro.shmop.html">简介</a></li><li><a href="shmop.setup.html">安装／配置</a><ul class="chunklist chunklist_book chunklist_children"><li><a href="shmop.requirements.html">需求</a></li><li><a href="shmop.installation.html">安装</a></li><li><a href="shmop.configuration.html">运行时配置</a></li><li><a href="shmop.resources.html">资源类型</a></li></ul></li><li><a href="shmop.constants.html">预定义常量</a></li><li><a href="shmop.examples.html">范例</a><ul class="chunklist chunklist_book chunklist_children"><li><a href="shmop.examples-basic.html">Basic usage</a></li></ul></li><li><a href="ref.shmop.html">Shared Memory 函数</a><ul class="chunklist chunklist_book chunklist_children"><li><a href="function.shmop-close.html">shmop_close</a> &mdash; Close shared memory block</li><li><a href="function.shmop-delete.html">shmop_delete</a> &mdash; Delete shared memory block</li><li><a href="function.shmop-open.html">shmop_open</a> &mdash; Create or open shared memory block</li><li><a href="function.shmop-read.html">shmop_read</a> &mdash; Read data from shared memory block</li><li><a href="function.shmop-size.html">shmop_size</a> &mdash; Get size of shared memory block</li><li><a href="function.shmop-write.html">shmop_write</a> &mdash; Write data into shared memory block</li></ul></li><li><a href="class.shmop.html">Shmop</a> &mdash; The Shmop class</li></ul></div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="113535""></a>
  <div class="note">
   <strong class="user">mattcsl at gmail dot com</strong>
   <a href="#113535" class="date">26-Oct-2013 11:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
thankyou,<br />
<br />
this function had a missing comma between test1 and test2 and is fixed below<br />
<br />
function get_cache_id($name) {<br />
&nbsp;&nbsp;&nbsp; // maintain list of caches here<br />
&nbsp;&nbsp;&nbsp; $id=array(&nbsp; 'test1' =&gt; 1,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 'test2' =&gt; 2<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; );<br />
<br />
&nbsp;&nbsp;&nbsp; return $id[$name];<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="111626""></a>
  <div class="note">
   <strong class="user">makr at makrit dot net</strong>
   <a href="#111626" class="date">09-Mar-2013 11:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
shmop made simple:<br />
$test=get_cache('test');<br />
save_cache($test, 'test1', 600);<br />
<br />
To save/get cache that easily just save this as cache.php or whatever you see fit:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">save_cache</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">, </span><span class="default">$name</span><span class="keyword">, </span><span class="default">$timeout</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// delete cache<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$id</span><span class="keyword">=</span><span class="default">shmop_open</span><span class="keyword">(</span><span class="default">get_cache_id</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">), </span><span class="string">"a"</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">shmop_delete</span><span class="keyword">(</span><span class="default">$id</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">shmop_close</span><span class="keyword">(</span><span class="default">$id</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// get id for name of cache<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$id</span><span class="keyword">=</span><span class="default">shmop_open</span><span class="keyword">(</span><span class="default">get_cache_id</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">), </span><span class="string">"c"</span><span class="keyword">, </span><span class="default">0644</span><span class="keyword">, </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">serialize</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">)));<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// return int for data size or boolean false for fail<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$id</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">set_timeout</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">, </span><span class="default">$timeout</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">shmop_write</span><span class="keyword">(</span><span class="default">$id</span><span class="keyword">, </span><span class="default">serialize</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">), </span><span class="default">0</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; else return </span><span class="default">false</span><span class="keyword">;<br />
}<br />
<br />
function </span><span class="default">get_cache</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if (!</span><span class="default">check_timeout</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$id</span><span class="keyword">=</span><span class="default">shmop_open</span><span class="keyword">(</span><span class="default">get_cache_id</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">), </span><span class="string">"a"</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$id</span><span class="keyword">) </span><span class="default">$data</span><span class="keyword">=</span><span class="default">unserialize</span><span class="keyword">(</span><span class="default">shmop_read</span><span class="keyword">(</span><span class="default">$id</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">shmop_size</span><span class="keyword">(</span><span class="default">$id</span><span class="keyword">)));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else return </span><span class="default">false</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// failed to load data<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$data</span><span class="keyword">) {&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// array retrieved<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">shmop_close</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$data</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else return </span><span class="default">false</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// failed to load data<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">}<br />
&nbsp;&nbsp;&nbsp; else return </span><span class="default">false</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// data was expired<br />
</span><span class="keyword">}<br />
<br />
function </span><span class="default">get_cache_id</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// maintain list of caches here<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$id</span><span class="keyword">=array(&nbsp; </span><span class="string">'test1' </span><span class="keyword">=&gt; </span><span class="default">1<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'test2' </span><span class="keyword">=&gt; </span><span class="default">2<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$id</span><span class="keyword">[</span><span class="default">$name</span><span class="keyword">];<br />
}<br />
<br />
function </span><span class="default">set_timeout</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">, </span><span class="default">$int</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$timeout</span><span class="keyword">=new </span><span class="default">DateTime</span><span class="keyword">(</span><span class="default">date</span><span class="keyword">(</span><span class="string">'Y-m-d H:i:s'</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">date_add</span><span class="keyword">(</span><span class="default">$timeout</span><span class="keyword">, </span><span class="default">date_interval_create_from_date_string</span><span class="keyword">(</span><span class="string">"</span><span class="default">$int</span><span class="string"> seconds"</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$timeout</span><span class="keyword">=</span><span class="default">date_format</span><span class="keyword">(</span><span class="default">$timeout</span><span class="keyword">, </span><span class="string">'YmdHis'</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$id</span><span class="keyword">=</span><span class="default">shmop_open</span><span class="keyword">(</span><span class="default">100</span><span class="keyword">, </span><span class="string">"a"</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$id</span><span class="keyword">) </span><span class="default">$tl</span><span class="keyword">=</span><span class="default">unserialize</span><span class="keyword">(</span><span class="default">shmop_read</span><span class="keyword">(</span><span class="default">$id</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">shmop_size</span><span class="keyword">(</span><span class="default">$id</span><span class="keyword">)));<br />
&nbsp;&nbsp;&nbsp; else </span><span class="default">$tl</span><span class="keyword">=array();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">shmop_delete</span><span class="keyword">(</span><span class="default">$id</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">shmop_close</span><span class="keyword">(</span><span class="default">$id</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$tl</span><span class="keyword">[</span><span class="default">$name</span><span class="keyword">]=</span><span class="default">$timeout</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$id</span><span class="keyword">=</span><span class="default">shmop_open</span><span class="keyword">(</span><span class="default">100</span><span class="keyword">, </span><span class="string">"c"</span><span class="keyword">, </span><span class="default">0644</span><span class="keyword">, </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">serialize</span><span class="keyword">(</span><span class="default">$tl</span><span class="keyword">)));<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">shmop_write</span><span class="keyword">(</span><span class="default">$id</span><span class="keyword">, </span><span class="default">serialize</span><span class="keyword">(</span><span class="default">$tl</span><span class="keyword">), </span><span class="default">0</span><span class="keyword">);<br />
}<br />
<br />
function </span><span class="default">check_timeout</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$now</span><span class="keyword">=new </span><span class="default">DateTime</span><span class="keyword">(</span><span class="default">date</span><span class="keyword">(</span><span class="string">'Y-m-d H:i:s'</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$now</span><span class="keyword">=</span><span class="default">date_format</span><span class="keyword">(</span><span class="default">$now</span><span class="keyword">, </span><span class="string">'YmdHis'</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$id</span><span class="keyword">=</span><span class="default">shmop_open</span><span class="keyword">(</span><span class="default">100</span><span class="keyword">, </span><span class="string">"a"</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$id</span><span class="keyword">) </span><span class="default">$tl</span><span class="keyword">=</span><span class="default">unserialize</span><span class="keyword">(</span><span class="default">shmop_read</span><span class="keyword">(</span><span class="default">$id</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">shmop_size</span><span class="keyword">(</span><span class="default">$id</span><span class="keyword">)));<br />
&nbsp;&nbsp;&nbsp; else return </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">shmop_close</span><span class="keyword">(</span><span class="default">$id</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$timeout</span><span class="keyword">=</span><span class="default">$tl</span><span class="keyword">[</span><span class="default">$name</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; return (</span><span class="default">intval</span><span class="keyword">(</span><span class="default">$now</span><span class="keyword">)&gt;</span><span class="default">intval</span><span class="keyword">(</span><span class="default">$timeout</span><span class="keyword">));<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
