<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>Msession 函数</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="msession.constants.html">? 预定义常量</a></li>
      <li style="float: right;"><a href="function.msession-connect.html">msession_connect ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="book.msession.html">Msession</a></li>
    <li>Msession 函数</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="ref.msession" class="reference">
 <h1 class="title">Msession 函数</h1>

 































































































































<h2>Table of Contents</h2><ul class="chunklist chunklist_reference"><li><a href="function.msession-connect.html">msession_connect</a> &mdash; Connect to msession server</li><li><a href="function.msession-count.html">msession_count</a> &mdash; Get session count</li><li><a href="function.msession-create.html">msession_create</a> &mdash; Create a session</li><li><a href="function.msession-destroy.html">msession_destroy</a> &mdash; Destroy a session</li><li><a href="function.msession-disconnect.html">msession_disconnect</a> &mdash; Close connection to msession server</li><li><a href="function.msession-find.html">msession_find</a> &mdash; Find all sessions with name and value</li><li><a href="function.msession-get-array.html">msession_get_array</a> &mdash; Get array of msession variables</li><li><a href="function.msession-get-data.html">msession_get_data</a> &mdash; Get data session unstructured data</li><li><a href="function.msession-get.html">msession_get</a> &mdash; Get value from session</li><li><a href="function.msession-inc.html">msession_inc</a> &mdash; Increment value in session</li><li><a href="function.msession-list.html">msession_list</a> &mdash; List all sessions</li><li><a href="function.msession-listvar.html">msession_listvar</a> &mdash; List sessions with variable</li><li><a href="function.msession-lock.html">msession_lock</a> &mdash; Lock a session</li><li><a href="function.msession-plugin.html">msession_plugin</a> &mdash; Call an escape function within the msession personality plugin</li><li><a href="function.msession-randstr.html">msession_randstr</a> &mdash; Get random string</li><li><a href="function.msession-set-array.html">msession_set_array</a> &mdash; Set msession variables from an array</li><li><a href="function.msession-set-data.html">msession_set_data</a> &mdash; Set data session unstructured data</li><li><a href="function.msession-set.html">msession_set</a> &mdash; Set value in session</li><li><a href="function.msession-timeout.html">msession_timeout</a> &mdash; Set/get session timeout</li><li><a href="function.msession-uniq.html">msession_uniq</a> &mdash; Get unique id</li><li><a href="function.msession-unlock.html">msession_unlock</a> &mdash; Unlock a session</li></ul>
</div>
<div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="75328""></a>
  <div class="note">
   <strong class="user">sunny at crazytoon dot com</strong>
   <a href="#75328" class="date">23-May-2007 06:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I went through and installed mcache and took notes about problems I ran in to.&nbsp; I couldn't get it to work in 64 bit CentOS but it works in 32 bit CentOS.&nbsp; If anybody got it working in 64 bit or wants to see what I have done, please feel free to visit my blog (i didn't want to spam post all the things here).&nbsp;&nbsp; Here is the blog:&nbsp; <a href="http://crazytoon.com/mcache" rel="nofollow" target="_blank">http://crazytoon.com/mcache</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="55874""></a>
  <div class="note">
   <strong class="user">martijn at pocos dot nl</strong>
   <a href="#55874" class="date">16-Aug-2005 04:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Trying to build PHP 5.0.4. with msession support (shared), I found that the build process still fails to link the proper libraries. I think the proper way to fix this, is to change ext/msession/config.m4 and rebuild configure.<br />
<br />
Find the line that reads:<br />
<br />
PHP_ADD_LIBRARY_WITH_PATH(phoenix, "$PHOENIX_DIR/lib", PHOENIX_LIB)<br />
<br />
And replace it with these two lines:<br />
<br />
PHP_ADD_LIBRARY_WITH_PATH(phoenix, "$PHOENIX_DIR/lib", MSESSION_SHARED_LIBADD)<br />
PHP_ADD_LIBRARY_WITH_PATH(stdc++, "", MSESSION_SHARED_LIBADD)<br />
<br />
Next find the line that reads:<br />
<br />
PHP_SUBST(PHOENIX_LIB)<br />
<br />
and replace it with:<br />
<br />
PHP_SUBST(MSESSION_SHARED_LIBADD)<br />
<br />
Now rebuild "configure":<br />
<br />
$ rm configure<br />
$ ./buildconf --force<br />
<br />
Now ./configure &amp;&amp; make &amp;&amp; make install as usual.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="55795""></a>
  <div class="note">
   <strong class="user">markw at mohawksoft dot com</strong>
   <a href="#55795" class="date">13-Aug-2005 05:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hi all, I'm the author of the msession daemon. I haven't done any actual work on it in a couple years. Suddenly, I find myself needing it again. It's current state is almost certainly VERY different than you are used too, and it as been renamed to mcache (internally to Mohawk Software). I may ramp up work on it again.<br />
<br />
In the course of the 5 years that msession being made available, I've gotten a lot of calls for support, and one bug fix. (And not a single donation BTW)<br />
<br />
A decisions needs to be made if "mcache" will continue to be available.&nbsp; I don't mind people using it, I don't mind that I've made no money on it (that's not why I wrote it), but the desperate "my server farm is down" calls because a working system died when the admin deployed changes with out adaquite testing are a huge distraction. In good conscience, I can't let the poor guy twist in the wind, but sometimes it takes hours to fix. Hours away from work that pays my bills or my family. Apache 2.0 with multiple threads really caused a lot of problems.<br />
<br />
So, I guess what I'm saying is this: msession will become mcache (publically) some time in the future. On modern hardware it can handle about 5,000 ~10,000 session transactions a second (depending on the amount of data in the session, and the conectivity to the nodes, etc.) I may keep it on my server, but I can't support it for you without being paid up front. If you use it: learn it, know it, live it, and contribute if you can.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="55588""></a>
  <div class="note">
   
   <a href="#55588" class="date">08-Aug-2005 05:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I could not compile it on FreeBSD. On a 4.x msession complained about missing pthread library. On a 5.x, it was not happy with malloc.h. Ok, I could dig into that problem and find the problem. But I was not motivated...<br />
<br />
I found that there is 1 100% PHP Solution for distributed session handling:<br />
<a href="http://pear.php.net/package/HTTP_SessionServer/" rel="nofollow" target="_blank">http://pear.php.net/package/HTTP_SessionServer/</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="54743""></a>
  <div class="note">
   <strong class="user">sgaffga at electronicpartner dot de</strong>
   <a href="#54743" class="date">14-Jul-2005 02:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
We wanted to use the default-PHP4-RPMs delivered with RedHat and SuSE, and use msession, too. But there is no package containing the precompiled msession-support for PHP. So I did this on my own and I found it very hard, so I'd like to provide the solution here.<br />
<br />
The files php-msession-030117.tar.gz, phoenix-R1_2_030117E.tar.gz and msession-030130.tar.gz are<br />
available at www.mohawksoft.com.<br />
<br />
## Compiling the phoenix lib<br />
tar xzf phoenix-R1_2_030117E.tar.gz <br />
tar xzf msession-030130.tar.gz<br />
cd phoenix/src/<br />
cp Linux.mak config.mak<br />
vi unixgcc.mak<br />
(Now change "-I$(POSTGRES_HOME)/include" to "-I /usr/include/pgsql" which is needed to compile using SuSE 9.3)<br />
make<br />
mkdir ../lib<br />
make install<br />
<br />
## Compiling msession server<br />
cd ..<br />
cd msession<br />
make<br />
mkdir ../bin<br />
make install<br />
<br />
## Now untar PHP-Source and replace the files in ext/msession/ with the ones supplied by php-msession-030117.tar.gz<br />
## Configure PHP and include --with-msession=shared,/path/to/phoenix-src-used-above<br />
## Please note: Compile will fail if you use --disable-session or --disable-all<br />
## For example use:<br />
./configure --prefix=/usr/local --with-config-file-path=/etc --disable-all --enable-session --with-msession=shared,/home/sga/compile/phoenix<br />
<br />
make<br />
<br />
## Now there is a msession.so in modules/, but this one does NOT work yet. <br />
## I had to repeat the libtool-command with "--mode=link gcc" and add some libs:<br />
## before the last parameter I added:<br />
## -lstdc++ -lodbc -L/home/sga/compile/phoenix/lib/ -lphoenix <br />
## This was the command I used (you will have to use other paths of course)<br />
/bin/sh /home/sga/compile/php-4.3.10/libtool --silent --preserve-dup-deps --mode=link gcc -DPHP_ATOM_INC -I/home/sga/compile/php-4.3.10/include -I/home/sga/compile/php-4.3.10/main -I/home/sga/compile/php-4.3.10 -I/home/sga/compile/php-4.3.10/Zend -I/home/sga/compile/php-4.3.10/ext/xml/expat&nbsp; -I/home/sga/compile/php-4.3.10/TSRM&nbsp; -g -O2&nbsp;&nbsp; -o ext/msession/msession.la -export-dynamic -avoid-version -prefer-pic -module -rpath /home/sga/compile/php-4.3.10/modules&nbsp; -lstdc++ -lodbc -L/home/sga/compile/phoenix/lib/ -lphoenix ext/msession/msession.lo<br />
<br />
## Now I could do:<br />
<br />
cp ext/msession/.libs/msession.so /usr/local/lib/php/extensions/no-debug-non-zts-20020429<br />
<br />
## (Please note the different location I copy the module from)<br />
## Adjust your php.ini to contain "extension=msession.so" and<br />
## "extension_path =/usr/local/lib/php/extensions/no-debug-non-zts-20020429"<br />
<br />
rcapache2 restart<br />
<br />
## Now it worked fine! I hope this helps someone.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="51874""></a>
  <div class="note">
   <strong class="user">r_linux at yahoo dot com</strong>
   <a href="#51874" class="date">13-Apr-2005 08:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To compile with --with-msession, you have to make a change in Makefile to add -lstdc++. For me the LDFLAGS=-lstdc++ before ./configure don't work.<br />
<br />
That modification works for me:<br />
sed -e 's/^\(EXTRA_LIBS\)\(.*\)$/\1\2 -lstdc++/g' Makefile -i<br />
<br />
I think that have some better way to do it.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="50824""></a>
  <div class="note">
   <strong class="user">temp6453 at hotmail dot com</strong>
   <a href="#50824" class="date">10-Mar-2005 01:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A company I work for uses msession for a large cluster of servers.&nbsp; I've set it up rather regularly and never had an issue at all with it not working.<br />
<br />
Msession is stable.&nbsp; It does something simple- it maintains an efficient database of key-&gt;value (session-&gt;data) pairs and searches them well in a nice threaded manner.&nbsp; There is no need for constant revision.&nbsp; It is _NOT_ a large application.&nbsp; It's security is simply IP-block-based, so such concerns are also minimal.<br />
<br />
To the user that says it should be removed- if you are having problems installing it, seek assistance doing so.&nbsp; The product itself is just right.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="49551""></a>
  <div class="note">
   <strong class="user">Weird Silence</strong>
   <a href="#49551" class="date">01-Feb-2005 05:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
We've created a distributed session handler that uses memcached - Check it out at <a href="http://weirdsilence.net/software/memsession/ - It" rel="nofollow" target="_blank">http://weirdsilence.net/software/memsession/ - It</a>'s free and open source!<br />
It uses Danga.com's memcached: <a href="http://danga.com/memcached/ - Very cool stuff!" rel="nofollow" target="_blank">http://danga.com/memcached/ - Very cool stuff!</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="47217""></a>
  <div class="note">
   <strong class="user">aderyngmailcom</strong>
   <a href="#47217" class="date">06-Nov-2004 03:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Compiling msession can be quite a pain. Believe me. <br />
<br />
Here's how I did it on a gentoo-box with gcc version 3.3.4 (20040623 (Gentoo Linux 3.3.4-r1, ssp-3.3.2-2, pie-8.7.6)):<br />
<br />
1. Download <a href="http://www.mohawksoft.com/devel/phoenix-R1_2_030117E.tar.gz and http://www.mohawksoft.com/devel/msession-030130.tar.gz" rel="nofollow" target="_blank">http://www.mohawksoft.com/devel/phoenix-R1_2_030117E.tar.gz and http://www.mohawksoft.com/devel/msession-030130.tar.gz</a><br />
2. Extract them in /usr/local (That path is hardcoded, so you don't really have a choice since there isn't a configure script)<br />
3. You should now the directory /usr/local/phoenix containing msession and src.<br />
4. Enter the src-directory and rename Linux.mak to config.mak (or the corresponding file, if you're using another system. Don't use unixgcc.mak directly - it won't work.).<br />
5. Type make<br />
6. Type make install. You might have to create /usr/local/phoenix/lib yourself and then type make install again.<br />
7. Change into the msession-directory and type make.<br />
<br />
For both msession and phoenix you may have to edit the makefiles manually and comment out the postgreesql and odbc-code (if you don't have postgree installed).<br />
<br />
8. Recompile php with --with-msession.<br />
<br />
Voil?!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="25186""></a>
  <div class="note">
   <strong class="user">mathijs at experimental dot net</strong>
   <a href="#25186" class="date">13-Sep-2002 09:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
msession 1.0 (020603) is using /dev/urandom.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="21345""></a>
  <div class="note">
   <strong class="user">a dot whyte at cqu dot edu dot au</strong>
   <a href="#21345" class="date">09-May-2002 05:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You can fix the no random data in FreeBSD's /dev/random by using rndcontrol (as root) and setting the interupts which it looks at for entropy.<br />
<br />
Something like&nbsp; rndcontrol -s 14 -s 15&nbsp; should help it out.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="21285""></a>
  <div class="note">
   <strong class="user">carsten at sarum dot dk</strong>
   <a href="#21285" class="date">06-May-2002 03:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you have trouble connecting to the msessiond from a php-script, this might be the solution for you.<br />
<br />
msessiond (and your php-extension) both use the libphoenix.a which, among other files, is built from a file called "mutils.cpp".<br />
<br />
Open this file, and find a line saying:<br />
<br />
FILE *f = fopen("/dev/random", "rb");<br />
<br />
(I believe it is line 506. There's only this one.)<br />
<br />
On my FreeBSD 4.5 Tiny, /dev/random seldom spits out data, so the program hangs on the next line (an fread() call). Use /dev/urandom instead, it always sends data.<br />
<br />
Change the line above to:<br />
<br />
FILE *f = fopen("/dev/urandom", "rb");<br />
<br />
Then rebuild phoenix-lib, msessiond, and PHP. You might want to do a "make clean" to be sure the change is noted.<br />
<br />
- Carsten</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
