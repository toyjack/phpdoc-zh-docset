<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>设置客户端的字符集</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.mysql-select-db.html">? mysql_select_db</a></li>
      <li style="float: right;"><a href="function.mysql-stat.html">mysql_stat ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.mysql.html">MySQL 函数</a></li>
    <li>设置客户端的字符集</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.mysql-set-charset" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">mysql_set_charset</h1>
  <p class="verinfo">(PHP 5 &gt;= 5.2.3)</p><p class="refpurpose"><span class="refname">mysql_set_charset</span> &mdash; <span class="dc-title">设置客户端的字符集</span></p>

 </div>

 <div id="function.mysql-set-charset-soft-deprecation-notice" class="soft-deprecation-notice">
  <blockquote class="sidebar">
   <p class="para">本扩展自 PHP 5.5.0
起已废弃，并在自 PHP 7.0.0 开始被移除。应使用 <a href="book.mysqli.html" class="link">MySQLi</a>
或 <a href="ref.pdo-mysql.html" class="link">PDO_MySQL</a> 扩展来替换之。参见 <a href="mysqlinfo.api.choosing.html" class="link">MySQL：选择 API</a> 
指南来获取更多信息。用以替代本函数的有：</p>
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="mysqli.character-set-name.html" class="function">mysqli_character_set_name()</a></span></li>
    <li class="member">PDO: 添加 <code class="literal">charset</code> 到连接字符串，比如 <code class="literal">charset=utf8</code></li>
   </ul>
  </blockquote>
 </div>

 <div class="refsect1 description" id="refsect1-function.mysql-set-charset-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>mysql_set_charset</strong></span>(<span class="methodparam"><span class="type">string</span> <code class="parameter">$charset</code></span>, <span class="methodparam"><span class="type">resource</span> <code class="parameter">$link_identifier</code><span class="initializer"> = NULL</span></span>): <span class="type">bool</span></div>

  <p class="para rdfs-comment">
   设置当前连接的默认字符集。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.mysql-set-charset-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>
    
     <dt>
<code class="parameter">charset</code></dt>

     <dd>

      <p class="para">
       一个有效的字符集名称。
      </p>
     </dd>

    
    <dt>

<code class="parameter">link_identifier</code></dt>
<dd>
<p class="para">MySQL
连接。如不指定连接标识，则使用由 <span class="function"><a href="function.mysql-connect.html" class="function">mysql_connect()</a></span>
最近打开的连接。如果没有找到该连接，会尝试不带参数调用
<span class="function"><a href="function.mysql-connect.html" class="function">mysql_connect()</a></span>
来创建。如没有找到连接或无法建立连接，则会生成
<strong><code>E_WARNING</code></strong> 级别的错误。</p></dd>


   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.mysql-set-charset-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   成功时返回 <strong><code>true</code></strong>， 或者在失败时返回 <strong><code>false</code></strong>。
  </p>
 </div>


 <div class="refsect1 notes" id="refsect1-function.mysql-set-charset-notes">
  <h3 class="title">注释</h3>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    本函数需要 MySQL 5.0.7 或更高版本。
   </p>
  </p></blockquote>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    这是改变字符集的最佳方式。不推荐您使用
    <span class="function"><a href="function.mysql-query.html" class="function">mysql_query()</a></span> 来设置 (比如 <code class="literal">SET NAMES utf8</code>)。
    更多信息参见 <a href="mysqlinfo.concepts.charset.html" class="link">MySQL character set concepts</a>
    一节。
   </p>
  </p></blockquote>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.mysql-set-charset-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.mysql-client-encoding.html" class="function" rel="rdfs-seeAlso">mysql_client_encoding()</a> - 返回字符集的名称</span></li>
    <li class="member"><a href="mysqlinfo.concepts.charset.html" class="link">Setting character sets in MySQL</a></li>
    <li class="member"><a href="http://dev.mysql.com/doc/mysql/en/charset-charsets.html" class="link external" title="Link : http://dev.mysql.com/doc/mysql/en/charset-charsets.html">&raquo;&nbsp;List of character sets that MySQL supports</a></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="114282""></a>
  <div class="note">
   <strong class="user">emeszenes at gmail dot com</strong>
   <a href="#114282" class="date">02-Feb-2014 01:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Massage for nabeelmoidu at gmail dot com:<br />
<br />
For me works following code:<br />
<br />
$mysqli = mysqli_connect( ... );<br />
mysqli_query( $mysqli, 'SET NAMES "utf8" COLLATE "utf8_general_ci"' );<br />
<br />
or just:<br />
<br />
mysqli_set_charset( $mysqli, 'utf8' );<br />
<br />
Regards, good luck!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86455""></a>
  <div class="note">
   <strong class="user">Ashus</strong>
   <a href="#86455" class="date">20-Oct-2008 02:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I needed to access the database from within one particular webhosting service. Pages are UTF-8 encoded and data received by forms should be inserted into database without changing the encoding. The database is also in UTF-8.<br />
<br />
Neither SET character set 'utf8' or SET names 'utf8' worked properly here, so this workaround made sure all variables are set to utf-8.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">// ... (creating a connection to mysql) ...<br />
<br />
</span><span class="default">mysql_query</span><span class="keyword">(</span><span class="string">"SET character_set_results = 'utf8', character_set_client = 'utf8', character_set_connection = 'utf8', character_set_database = 'utf8', character_set_server = 'utf8'"</span><span class="keyword">, </span><span class="default">$conn</span><span class="keyword">);<br />
<br />
</span><span class="default">$re </span><span class="keyword">= </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="string">'SHOW VARIABLES LIKE "%character_set%";'</span><span class="keyword">)or die(</span><span class="default">mysql_error</span><span class="keyword">());<br />
while (</span><span class="default">$r </span><span class="keyword">= </span><span class="default">mysql_fetch_assoc</span><span class="keyword">(</span><span class="default">$re</span><span class="keyword">)) {</span><span class="default">var_dump </span><span class="keyword">(</span><span class="default">$r</span><span class="keyword">); echo </span><span class="string">"&lt;br /&gt;"</span><span class="keyword">;} exit;<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
All important variables are now utf-8 and we can safely use INSERTs or SELECTs with mysql_escape_string($var) without any encoding functions.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86151""></a>
  <div class="note">
   <strong class="user">Ronald</strong>
   <a href="#86151" class="date">06-Oct-2008 01:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I need to revoke most of my post below. What I found out afterwards is this:<br />
<br />
1. if you do not use mysql_set_char mysql will NOT do any translations and thus store a utf8-character-byte as is. If you then retrieve this byte from the db and output it in a utf8 page it will show just fine BUT if other apps query this byte (expecting to find a latin1 byte) they will go wrong.<br />
<br />
2. the 'bug' mentioned before only occurs if you use a ucase or lcase function in your statement (like: latin1_col = ucase('utf8 string')<br />
<br />
Hope this helps, Ronald</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85932""></a>
  <div class="note">
   <strong class="user">Ronald</strong>
   <a href="#85932" class="date">25-Sep-2008 12:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I just hope that the text below will help someone who is struggling with charset encoding, specially when php-charset is different from the mysql-charset. Let me add that I really think that the php man-pages on the mysql-functions are lacking a lot of details on this important issues. Could someone add some useful text here?<br />
<br />
Here is my situation. PHP5.2.4, MySql 4.1.15. A php web-application fully utf-8 encoded and a mysql database in latin1 charset.<br />
<br />
To make this work I had to:<br />
<br />
1. create and store all code files (php, html, inc, js, etc) in the utf-8 charset. Your editor should have an option for this, if not dump it.<br />
<br />
2. check that your editor does not add a BOM (<a href="http://en.wikipedia.org/wiki/Byte-order_mark" rel="nofollow" target="_blank">http://en.wikipedia.org/wiki/Byte-order_mark</a>) at the beginning of the file. Use a hex-editor to detect them if needed.<br />
<br />
3. Set your apache environment to utf-8 by adding 'AddDefaultCharset utf-8' to your .htaccess. If you do not use apache add 'default_charset utf-8' to your php.ini. You have to do either of them (not both), php will use the apache setting where needed.<br />
<br />
4. Additionally add this meta-tag to your html-header: '&lt;meta http-equiv="Content-type" content="text/html; CHARSET=gb2312" /&gt;'. This will help silly browsers (Oeps, IE again?) that ignore the utf-response-header send to them.<br />
<br />
5. Check that the above line are listened to by check the 'page info' of your pages in firefox. It should show 2 (!!) utf-8 entries.<br />
<br />
======== all of the above sofar has nothing to do with mysql ;-) ====== <br />
<br />
6. Do *NOT* (repeat NOT!) set the 'names' (set names *) or _ANY_ 'character set' (set character set *) (opposed to what they tell you on these pages).<br />
<br />
7. Check the previous item by listing the results of the mysql query 'SHOW session VARIABLES'. All char_sets here should say 'latin1', except for the system one which is always 'utf8'. All collations should say 'latin1_*'. Furthermore the php function mysql_client_encoding() should also return latin1 (though I don't understand why; what does this value mean, I would think if php (being the client) is utf8 encoded this would be utf8?)<br />
<br />
8 Finally test the above by storing this string in your db and output it in your webpage: 'I?t?rnati?nàliz?ti?n and '.<br />
<br />
Now what was interesting during testing and debugging of the above findings was:<br />
1. If I would run 'mysql_set_charset('utf8')' _OR_ 'mysql_query("SET NAMES 'utf8'");' and then run a query in which I would have 'where char_column = 'abc''it would die with 'Illegal mix of collations'<br />
<br />
2. If I would run 'mysql_query("SET character_set_client = 'utf8';"); mysql_query("SET character_set_result = 'utf8';")' the query would work BUT the non-ascii-characters would show scrambled in the browser.<br />
<br />
3. BUT these 2 points above work just fine on my local dev-machine (php 5.2.3 &amp; mysql 5.0.45)!!!!!!!!<br />
<br />
This draws me to these 3 conclusions:<br />
<br />
1. The Php-mysql-function library (5.2.+) does a fine job translating utf-8 queries &amp; results to/from latin1! It's better to let php handle this for you then to have mysql do this.<br />
<br />
2. Mysql (4.0.+) has 1 or more bugs (well, let's say unfinished features) that involve the charset-translations that are solved in 5.0.+.<br />
<br />
3. It is not well enough documented! (Otherwise I would have to write this)<br />
<br />
One last remark: clearly characters that exist in utf8 and not in latin1 (and vv.) will get lost during utf8-latin1-utf8 translation.<br />
<br />
If any of the above is not correct or not complete feel free to correct this! (Or better yet, add a chapter to the php manual :-)<br />
<br />
Cheers, Ronald</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83717""></a>
  <div class="note">
   <strong class="user">nabeelmoidu at gmail dot com</strong>
   <a href="#83717" class="date">08-Jun-2008 10:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's an example of how to use this feature :<br />
<br />
I'm using&nbsp; PHP 5.2.5 from <a href="http://oss.oracle.com/projects/php/" rel="nofollow" target="_blank">http://oss.oracle.com/projects/php/</a><br />
<br />
I wanted to store arabic characters as UTF8 in the database and as suggested in many of the google results, I tried using<br />
<br />
mysql_query("SET NAMES 'utf8'");<br />
<br />
and <br />
<br />
mysql_query("SET CHARACTER SET utf8 ");<br />
<br />
but it did not work.<br />
<br />
Using the following, it worked flawlessly<br />
<br />
$link = mysql_connect('localhost', 'user', 'password');<br />
mysql_set_charset('utf8',$link);<br />
<br />
Once this is set we need not manually encode the text into utf using utf8_encode() or other functions. The arabic ( or any UTF8 supported ) text can be passed directly to the database and it is automatically converted by PHP.<br />
For eg.<br />
<span class="default">&lt;?php<br />
$link </span><span class="keyword">= </span><span class="default">mysql_connect</span><span class="keyword">(</span><span class="string">'localhost'</span><span class="keyword">, </span><span class="string">'user'</span><span class="keyword">, </span><span class="string">'password'</span><span class="keyword">);<br />
</span><span class="default">mysql_set_charset</span><span class="keyword">(</span><span class="string">'utf8'</span><span class="keyword">,</span><span class="default">$link</span><span class="keyword">);<br />
</span><span class="default">$db_selected </span><span class="keyword">= </span><span class="default">mysql_select_db</span><span class="keyword">(</span><span class="string">'emp_feedback'</span><span class="keyword">, </span><span class="default">$link</span><span class="keyword">);<br />
if (!</span><span class="default">$db_selected</span><span class="keyword">) { die (</span><span class="string">'Database access error : ' </span><span class="keyword">. </span><span class="default">mysql_error</span><span class="keyword">());}<br />
</span><span class="default">$query </span><span class="keyword">= </span><span class="string">"INSERT INTO feedback ( EmpName, Message ) VALUES ('</span><span class="default">$_empName</span><span class="string">','</span><span class="default">$_message</span><span class="string">')"</span><span class="keyword">;<br />
</span><span class="default">mysql_query</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">) or die(</span><span class="string">'Error, Feedback insert into database failed'</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span>Note that here $_empName is stored in English while $_message is in Arabic.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="80997""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#80997" class="date">10-Feb-2008 09:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Actually, this function is available in client libraries in MySQL 4.1.13 and newer, too.&nbsp; So the real version requirement is MySQL &gt;= 5.0.7 OR, if you're using MySQL 4, then &gt;= 4.1.13.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="79874""></a>
  <div class="note">
   <strong class="user">nag QWE svgfr RTY org</strong>
   <a href="#79874" class="date">17-Dec-2007 07:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's an improved version of Janez R.'s function:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">if (</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">'mysql_set_charset'</span><span class="keyword">) === </span><span class="default">false</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; * Sets the client character set.<br />
&nbsp;&nbsp; &nbsp; *<br />
&nbsp;&nbsp; &nbsp; * Note: This function requires MySQL 5.0.7 or later.<br />
&nbsp;&nbsp; &nbsp; *<br />
&nbsp;&nbsp; &nbsp; * @see <a href="http://www.php.net/mysql-set-charset" rel="nofollow" target="_blank">http://www.php.net/mysql-set-charset</a><br />
&nbsp;&nbsp; &nbsp; * @param string $charset A valid character set name<br />
&nbsp;&nbsp; &nbsp; * @param resource $link_identifier The MySQL connection<br />
&nbsp;&nbsp; &nbsp; * @return TRUE on success or FALSE on failure<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">mysql_set_charset</span><span class="keyword">(</span><span class="default">$charset</span><span class="keyword">, </span><span class="default">$link_identifier </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$link_identifier </span><span class="keyword">== </span><span class="default">null</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="string">'SET CHARACTER SET "'</span><span class="keyword">.</span><span class="default">$charset</span><span class="keyword">.</span><span class="string">'"'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="string">'SET CHARACTER SET "'</span><span class="keyword">.</span><span class="default">$charset</span><span class="keyword">.</span><span class="string">'"'</span><span class="keyword">, </span><span class="default">$link_identifier</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77565""></a>
  <div class="note">
   <strong class="user">Janez R.</strong>
   <a href="#77565" class="date">04-Sep-2007 01:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I assume that this is an equivalent in previous versions of php (add some parameter validation and default values though!):<br />
&lt;?<br />
if (!function_exists('mysql_set_charset')) {<br />
&nbsp; function mysql_set_charset($charset,$dbh)<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; return mysql_query("set names $charset",$dbh);<br />
&nbsp; }<br />
}<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
