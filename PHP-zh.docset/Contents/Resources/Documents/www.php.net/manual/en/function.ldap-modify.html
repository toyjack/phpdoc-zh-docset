<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>别名 ldap_mod_replace</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.ldap-modify-batch.html">? ldap_modify_batch</a></li>
      <li style="float: right;"><a href="function.ldap-next-attribute.html">ldap_next_attribute ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.ldap.html">LDAP 函数</a></li>
    <li>别名 ldap_mod_replace</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.ldap-modify" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">ldap_modify</h1>
  <p class="verinfo">(PHP 4, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">ldap_modify</span> &mdash; <span class="dc-title">别名 <span class="function"><a href="function.ldap-mod-replace.html" class="function">ldap_mod_replace()</a></span></span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.ldap-modify-description">
  <h3 class="title">说明</h3>
  <p class="simpara">
   此函数是该函数的别名： <span class="function"><a href="function.ldap-mod-replace.html" class="function">ldap_mod_replace()</a></span>.    
  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.ldap-modify-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.ldap-rename.html" class="function" rel="rdfs-seeAlso">ldap_rename()</a> - Modify the name of an entry</span></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="116790""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#116790" class="date">01-Mar-2015 06:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I ran into a rather annoying issue when trying to add a user to a usergroup in Active Directory.<br />
<br />
Active Directory tends to not be particularly happy when you try modifying the "memberOf" attribute (through ldap_mod_add/ldap_mod_replace), and will output a warning/error somewhere along the lines of:<br />
<br />
Warning: ldap_mod_add(): Modify: Server is unwilling to perform in ...<br />
<br />
If you want to add a user to a usergroup, you need to add the user as a member of the group, rather than adding to the memberOf attribute of the group:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">ldap_addToGroup</span><span class="keyword">(</span><span class="default">$username</span><span class="keyword">, </span><span class="default">$group</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dn </span><span class="keyword">= </span><span class="string">"CN=</span><span class="default">$group</span><span class="string">,OU=Accounts,DC=DC1,DC=DC2"</span><span class="keyword">; </span><span class="comment">// distinguished name/DN of the group you want to add to<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$info</span><span class="keyword">[</span><span class="string">"member"</span><span class="keyword">] = </span><span class="string">"CN=</span><span class="default">$username</span><span class="string">,OU=Accounts,DC=DC1,DC=DC2"</span><span class="keyword">; </span><span class="comment">// DN of the user you want to add<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">ldap_modify</span><span class="keyword">(</span><span class="default">$ldapconn</span><span class="keyword">, </span><span class="default">$dn</span><span class="keyword">, </span><span class="default">$info</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;<br />
</span><br />
Hope this helps someone.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="116789""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#116789" class="date">01-Mar-2015 06:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I ran into a rather annoying issue when trying to add a user to a usergroup in Active Directory.<br />
<br />
Active Directory tends to not be particularly happy when you try modifying the "memberOf" attribute (through ldap_mod_add/ldap_mod_replace), and will output a warning/error somewhere along the lines of:<br />
<br />
Warning: ldap_mod_add(): Modify: Server is unwilling to perform in ...<br />
<br />
If you want to add a user to a usergroup, you need to add the user as a member of the group, rather than adding to the memberOf attribute of the group:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">ldap_addToGroup</span><span class="keyword">(</span><span class="default">$username</span><span class="keyword">, </span><span class="default">$group</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dn </span><span class="keyword">= </span><span class="string">"CN=</span><span class="default">$group</span><span class="string">,OU=Accounts,DC=DC1,DC=DC2"</span><span class="keyword">; </span><span class="comment">// distinguished name/DN of the group you want to add to<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$info</span><span class="keyword">[</span><span class="string">"member"</span><span class="keyword">] = </span><span class="string">"CN=</span><span class="default">$username</span><span class="string">,OU=Accounts,DC=DC1,DC=DC2"</span><span class="keyword">; </span><span class="comment">// DN of the user you want to add<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">ldap_modify</span><span class="keyword">(</span><span class="default">$ldapconn</span><span class="keyword">, </span><span class="default">$dn</span><span class="keyword">, </span><span class="default">$info</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Hope this helps someone.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="112887""></a>
  <div class="note">
   <strong class="user">spam at bilgoraj dot info</strong>
   <a href="#112887" class="date">02-Aug-2013 10:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If You can`t add attribute objectclass to existing object&nbsp; using ldap_modify - use ldap_mod_add - it works.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74581""></a>
  <div class="note">
   <strong class="user">php_notes at grumz dot net</strong>
   <a href="#74581" class="date">18-Apr-2007 06:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Following goetz at rvs dot uni-hannover dot de's comment, it is not exactly true that ldap_modify can't change objectclass. <br />
<br />
In fact, it's impossible to add an objectclass which is set as STRUCTURAL in the schema description. But you can add an objectclass set as AUXILIARY. See OpenLDAP FAQ below for explanation why :<br />
<br />
<a href="http://www.openldap.org/faq/data/cache/1341.html" rel="nofollow" target="_blank">http://www.openldap.org/faq/data/cache/1341.html</a><br />
<br />
For example, if you have an ldap entry of type "device", which is a structural objectclass, named "cn=myNetCard,ou=Networks,dc=example,dc=com", you can do this :<br />
<br />
<span class="default">&lt;?php<br />
<br />
$entry</span><span class="keyword">[</span><span class="string">"objectclass"</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">] = </span><span class="string">"device"</span><span class="keyword">;<br />
</span><span class="default">$entry</span><span class="keyword">[</span><span class="string">"objectclass"</span><span class="keyword">][</span><span class="default">1</span><span class="keyword">] = </span><span class="string">"ieee802Device"</span><span class="keyword">; </span><span class="comment">// add an auxiliary objectclass<br />
</span><span class="default">$entry</span><span class="keyword">[</span><span class="string">"macAddress"</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">] = </span><span class="string">"aa:bb:cc:dd:ee:ff"</span><span class="keyword">;<br />
<br />
</span><span class="default">ldap_modify </span><span class="keyword">(</span><span class="default">$cnx</span><span class="keyword">, </span><span class="string">"cn=myNetCard,ou=Networks,dc=example,dc=com"</span><span class="keyword">, </span><span class="default">$entry</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
But this will not work :<br />
<br />
<span class="default">&lt;?php<br />
<br />
$entry</span><span class="keyword">[</span><span class="string">"objectclass"</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">] = </span><span class="string">"device"</span><span class="keyword">;<br />
</span><span class="default">$entry</span><span class="keyword">[</span><span class="string">"objectclass"</span><span class="keyword">][</span><span class="default">1</span><span class="keyword">] = </span><span class="string">"ipNetwork"</span><span class="keyword">; </span><span class="comment">// add a structural objectclass<br />
</span><span class="default">$entry</span><span class="keyword">[</span><span class="string">"ipNetworkNumber"</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">] = </span><span class="string">"1.2.3.4"</span><span class="keyword">;<br />
<br />
</span><span class="default">ldap_modify </span><span class="keyword">(</span><span class="default">$cnx</span><span class="keyword">, </span><span class="string">"cn=myNetCard,ou=Networks,dc=example,dc=com"</span><span class="keyword">, </span><span class="default">$entry</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
You will get the following error : "Cannot modify object class"</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74268""></a>
  <div class="note">
   <strong class="user">kevin at guarana dot org</strong>
   <a href="#74268" class="date">02-Apr-2007 06:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you're seeing confusing "Type or value exists" errors from ldap_modify, the reason could be that you're attempting to add two identical values for a multi-valued attribute.&nbsp; ie, something like:<br />
<br />
<span class="default">&lt;?php<br />
$le </span><span class="keyword">= array(</span><span class="string">"mail" </span><span class="keyword">=&gt; array(</span><span class="string">"foo@bar.com"</span><span class="keyword">, </span><span class="string">"foo@bar.com"</span><span class="keyword">));<br />
</span><span class="default">$result </span><span class="keyword">= </span><span class="default">ldap_modify</span><span class="keyword">(</span><span class="default">$ldap_link</span><span class="keyword">, </span><span class="default">$dn</span><span class="keyword">, </span><span class="default">$le</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="64294""></a>
  <div class="note">
   <strong class="user">docwoelle at ipwatch dot de</strong>
   <a href="#64294" class="date">11-Apr-2006 01:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to disable an account in an Active Directory of Windows, <br />
you may try this (it works for me in a Win2k environment):<br />
<br />
(foo.bar should be replaced in "$ldapBase" to the correct<br />
&nbsp;domain, e.g. "DC=phpfreackx,DC=com" if your domain is phpfreackx.com)<br />
<br />
domctrl = domain controller<br />
domadlogin = domain admin login<br />
domadpw = domain admin password<br />
username = loginname of useraccount (e.g. "john.doe")<br />
enable =1 (if you want to enable it, 0 if it should be disabled)<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">userchange</span><span class="keyword">(</span><span class="default">$username</span><span class="keyword">,</span><span class="default">$enable</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">,</span><span class="default">$domadlogin</span><span class="keyword">,</span><span class="default">$domadpw</span><span class="keyword">,</span><span class="default">$domctrl</span><span class="keyword">)<br />
{<br />
</span><span class="default">$ldapServer </span><span class="keyword">= </span><span class="default">$domctrl</span><span class="keyword">;<br />
</span><span class="default">$ldapBase </span><span class="keyword">= </span><span class="string">'DC=foo,DC=bar'</span><span class="keyword">;<br />
</span><span class="default">$ds </span><span class="keyword">= </span><span class="default">ldap_connect</span><span class="keyword">(</span><span class="default">$ldapServer</span><span class="keyword">);<br />
if (!</span><span class="default">$ds</span><span class="keyword">) {die(</span><span class="string">'Cannot Connect to LDAP server'</span><span class="keyword">);}<br />
</span><span class="default">$ldapBind </span><span class="keyword">= </span><span class="default">ldap_bind</span><span class="keyword">(</span><span class="default">$ds</span><span class="keyword">,</span><span class="default">$domadlogin</span><span class="keyword">,</span><span class="default">$domadpw</span><span class="keyword">);<br />
if (!</span><span class="default">$ldapBind</span><span class="keyword">) {die(</span><span class="string">'Cannot Bind to LDAP server'</span><span class="keyword">);}<br />
</span><span class="default">ldap_set_option</span><span class="keyword">(</span><span class="default">$ds</span><span class="keyword">, </span><span class="default">LDAP_OPT_PROTOCOL_VERSION</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">);<br />
</span><span class="default">$sr </span><span class="keyword">= </span><span class="default">ldap_search</span><span class="keyword">(</span><span class="default">$ds</span><span class="keyword">, </span><span class="default">$ldapBase</span><span class="keyword">, </span><span class="string">"(samaccountname=</span><span class="default">$username</span><span class="string">)"</span><span class="keyword">);<br />
</span><span class="default">$ent</span><span class="keyword">= </span><span class="default">ldap_get_entries</span><span class="keyword">(</span><span class="default">$ds</span><span class="keyword">,</span><span class="default">$sr</span><span class="keyword">);<br />
</span><span class="default">$dn</span><span class="keyword">=</span><span class="default">$ent</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">][</span><span class="string">"dn"</span><span class="keyword">];<br />
</span><span class="comment">// Deactivate<br />
</span><span class="default">$ac </span><span class="keyword">= </span><span class="default">$ent</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">][</span><span class="string">"useraccountcontrol"</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">];<br />
</span><span class="default">$disable</span><span class="keyword">=(</span><span class="default">$ac </span><span class="keyword">|&nbsp; </span><span class="default">2</span><span class="keyword">); </span><span class="comment">// set all bits plus bit 1 (=dec2)<br />
</span><span class="default">$enable </span><span class="keyword">=(</span><span class="default">$ac </span><span class="keyword">&amp; ~</span><span class="default">2</span><span class="keyword">); </span><span class="comment">// set all bits minus bit 1 (=dec2)<br />
</span><span class="default">$userdata</span><span class="keyword">=array();<br />
if (</span><span class="default">$enable</span><span class="keyword">==</span><span class="default">1</span><span class="keyword">) </span><span class="default">$new</span><span class="keyword">=</span><span class="default">$enable</span><span class="keyword">; else </span><span class="default">$new</span><span class="keyword">=</span><span class="default">$disable</span><span class="keyword">; </span><span class="comment">//enable or disable?<br />
</span><span class="default">$userdata</span><span class="keyword">[</span><span class="string">"useraccountcontrol"</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">]=</span><span class="default">$new</span><span class="keyword">;<br />
</span><span class="default">ldap_modify</span><span class="keyword">(</span><span class="default">$ds</span><span class="keyword">, </span><span class="default">$dn</span><span class="keyword">, </span><span class="default">$userdata</span><span class="keyword">); </span><span class="comment">//change state<br />
</span><span class="default">$sr </span><span class="keyword">= </span><span class="default">ldap_search</span><span class="keyword">(</span><span class="default">$ds</span><span class="keyword">, </span><span class="default">$ldapBase</span><span class="keyword">, </span><span class="string">"(samaccountname=</span><span class="default">$username</span><span class="string">)"</span><span class="keyword">);<br />
</span><span class="default">$ent</span><span class="keyword">= </span><span class="default">ldap_get_entries</span><span class="keyword">(</span><span class="default">$ds</span><span class="keyword">,</span><span class="default">$sr</span><span class="keyword">);<br />
</span><span class="default">$ac </span><span class="keyword">= </span><span class="default">$ent</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">][</span><span class="string">"useraccountcontrol"</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">];<br />
if ((</span><span class="default">$ac </span><span class="keyword">&amp; </span><span class="default">2</span><span class="keyword">)==</span><span class="default">2</span><span class="keyword">) </span><span class="default">$status</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; else </span><span class="default">$status</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">;<br />
</span><span class="default">ldap_close</span><span class="keyword">(</span><span class="default">$ds</span><span class="keyword">);<br />
return </span><span class="default">$status</span><span class="keyword">; </span><span class="comment">//return current status (1=enabled, 0=disabled)<br />
</span><span class="keyword">}&nbsp;&nbsp; <br />
<br />
</span><span class="comment">// use this to disable an account:<br />
// userchange('john.doe@foo.bar',0,'admin@foo.bar', 'secret','domctrl.foo.bar'); <br />
// ..but this to enable it:<br />
// userchange('john.doe@foo.bar',1,'admin@foo.bar', 'secret','domctrl.foo.bar'); <br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="59185""></a>
  <div class="note">
   <strong class="user">jmw1982 at gmail dot com</strong>
   <a href="#59185" class="date">28-Nov-2005 02:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you're writing a multiple values for an attribute with ldap_modify (), the function will attempt to write all entries in the value array even if those entries are blank.&nbsp; Setting blank entries to a blank array in the manner used for attribute deletion, ie:<br />
<br />
$attributes[$attr_name][3] = array ();<br />
<br />
results in the string "Array" being written to the directory for that value.&nbsp; The only way I was able to find to do what I wanted - only write the values for the attribute that were submitted on the form - was to check if each attribute had multiple values and unset () blank values, eg:<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach ($attributes as $key =&gt; $cur_val) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($cur_val== '') {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $attributes[$key] = array ();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (is_array ($cur_val)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach ($cur_val as $mv_key =&gt; $mv_cur_val) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($mv_cur_val == '') {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; unset ($attributes[$key][$mv_key]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $attributes[$key][$mv_key] = $mv_cur_val;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="43216""></a>
  <div class="note">
   <strong class="user">chris at uffbasse dot de</strong>
   <a href="#43216" class="date">14-Jun-2004 09:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To pinpoint the delete issue:<br />
<br />
with newer OpenLdap versions this will fail:<br />
<br />
$values["mail"] = "";<br />
ldap_modify($conn_id, $dn, $values);<br />
<br />
or <br />
$values["mail"][0] = "";<br />
ldap_modify($conn_id, $dn, $values);<br />
<br />
BUT this works:<br />
<br />
$values["mail"] = array();<br />
ldap_modify($conn_id, $dn, $values);<br />
<br />
or <br />
$values["mail"][0] = array();<br />
ldap_modify($conn_id, $dn, $values);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="38092""></a>
  <div class="note">
   <strong class="user">ace at suares dot nl</strong>
   <a href="#38092" class="date">08-Dec-2003 07:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Some comments on ldap_modify, and especially the user comment from tengel at fluid dot com<br />
<br />
OpenLDAP 2.1.22<br />
If an attribute is tagged as MUST in the schema, the attribute must be there. Wheter it may contain and empty value depends on the SYNTAX for that attribute.<br />
<br />
DirectoryString MAY NOT be empty; OctetString MAY be empty. As far as I can see, IA5String MAY NOT be empty.<br />
<br />
If an attribute is defined as MAY in the schema, the attribute may or may not be there. If it is there, it MAY or MAY NOT be empty, depending on its SYNTAX.<br />
<br />
PHP 4.3.1<br />
<br />
It seems that ldap_modify() will take an array of attributes to modify.<br />
<br />
For multivalued attributes, passing an empty array, wil DELETE the attribute, regardless of it's previous value(s), and regardless if the attribute was there before the modify.<br />
<br />
If the multivalued attribute is defined as MAY, this will work. If the attribute is defined as MUST, OpenLDAP will generate the error: 'LDAP error 65: Object class violation'<br />
<br />
If an attribute's SYNTAX defines that it MAY NOT be empty, trying to add or modify the attribute with an empty value will genereate the error: 'LDAP error 21: Invalid syntax'.<br />
Also, in the logfile, if set with sufficient debuglevel, the string<br />
<br />
&nbsp;&nbsp;&nbsp; value #0 invalid per syntax<br />
<br />
will be present.<br />
<br />
Trying to pass an empty array to ldap_add() for a any attribute (multi or single valued) will result in the error 'LDAP error 2: Protocol error', regardless if the attribute is defined as MUST or MAY.<br />
<br />
Note that this differs form passing an array with elements that have no value. In the latter case, it depends on the SYNTAX for that attribute if that is allowed.<br />
<br />
If the attribute is single-valued, passing an array with one element, WILL change the value of the attribute. In the user comments on php.net it is suggested that if you want to modify a single valued attribute, you must pass a string, not an array with one element. My experience is that an array with a single element will work just as well.<br />
<br />
_Ace<br />
<br />
website: <a href="http://www.suares.nl * http://www.qwikzite.nl" rel="nofollow" target="_blank">http://www.suares.nl * http://www.qwikzite.nl</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="36792""></a>
  <div class="note">
   <strong class="user">fechner at ponton dot de</strong>
   <a href="#36792" class="date">22-Oct-2003 12:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are trying to change the userPassword attribute when using md5 hashes, try the following lines:<br />
<br />
$new["userPassword"] = '{md5}' . base64_encode(pack('H*', md5($newpass_in_plaintext)));<br />
ldap_modify($ds, $dn, $new);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="33989""></a>
  <div class="note">
   <strong class="user">davidsmith at byuNOSPAM dot edu</strong>
   <a href="#33989" class="date">12-Jul-2003 05:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The $entry parameter can be an array of values for an attribute. Just be careful that your array's indices are numerically contiguous. For example, when using this $entry array, ldap_modify will fail with little explanation:<br />
<br />
&nbsp;&nbsp; $entry = array( 0 =&gt; 'foo', 2 =&gt; 'bar' );<br />
<br />
While this one will work just fine:<br />
<br />
&nbsp;&nbsp; $entry = array( 0 =&gt; 'foo', 1 =&gt; 'bar' );<br />
<br />
Hope this helps someone out.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="33017""></a>
  <div class="note">
   <strong class="user">jpdalbec at ysu dot edu</strong>
   <a href="#33017" class="date">13-Jun-2003 03:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Nick T.'s comment above is out of date.<br />
The PHP LDAP interface currently supports direct modification of the DN using the ldap_rename() function.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="30747""></a>
  <div class="note">
   <strong class="user">goetz at rvs dot uni-hannover dot de</strong>
   <a href="#30747" class="date">27-Mar-2003 07:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Remember that you can NOT modify the attribute 'objectclass' with ldap_modify! <br />
<br />
If you use a search result as basis for your changes, be sure to 'unset()' all numbered indices, 'count' indicies AND index 'objectclass' !</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="24311""></a>
  <div class="note">
   <strong class="user">NOSPAMjjhuff at mspin dot net</strong>
   <a href="#24311" class="date">12-Aug-2002 08:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To delete entries:<br />
<br />
$data["description"] = array();<br />
ldap_modify($conn, $dn,$data);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="12095""></a>
  <div class="note">
   <strong class="user">tengel at fluid dot com</strong>
   <a href="#12095" class="date">21-Mar-2001 06:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The behaviour of OpenLDAP from 1.x to 2.x changed; in 1.x, when you passed ldap_modify the array, if the value was empty that attribute would be deleted.&nbsp; In 2.x, you get an "Invalid Syntax" error and the modify fails.
<br />

<br />
This requires the ldap_mod_del function; unfortunately, that operation requires the attribute to be deleted have it's *old* value specified -- as you can imagine, if you're taking input from a CGI form, the attribute to be deleted's value is now missing (i.e., the user blanked out that textbox in the form and clicked Submit).
<br />

<br />
So, you're in a bit of a conundrum -- you want to delete "empty" form values, but you need their old value to delete them.&nbsp; There are many ways to handle this, but I chose this approach:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="comment">// The first is what to add, the second to remove
<br />
</span><span class="default">$entry</span><span class="keyword">=array();
<br />
</span><span class="default">$delval</span><span class="keyword">=array();
<br />

<br />
</span><span class="comment">// Imagine if you will, $o and $title are
<br />
// form fields with text boxes for data
<br />
</span><span class="keyword">if(</span><span class="default">$o</span><span class="keyword">!=</span><span class="string">""</span><span class="keyword">) { </span><span class="default">$entry</span><span class="keyword">[</span><span class="string">"o"</span><span class="keyword">]=</span><span class="string">"</span><span class="default">$o</span><span class="string">"</span><span class="keyword">; } else { </span><span class="default">$delval</span><span class="keyword">[]=</span><span class="string">"o"</span><span class="keyword">; }
<br />
if(</span><span class="default">$title</span><span class="keyword">!=</span><span class="string">""</span><span class="keyword">) { </span><span class="default">$entry</span><span class="keyword">[</span><span class="string">"title"</span><span class="keyword">]=</span><span class="string">"</span><span class="default">$title</span><span class="string">"</span><span class="keyword">; } else { </span><span class="default">$delval</span><span class="keyword">[]=</span><span class="string">"title"</span><span class="keyword">; }
<br />

<br />
</span><span class="comment">// First try the normal modify with $entry
<br />
// $ldap, $dn, $BASEDN are all set up earlier
<br />
</span><span class="keyword">if (@</span><span class="default">ldap_modify</span><span class="keyword">(</span><span class="default">$ldap</span><span class="keyword">, </span><span class="default">$dn</span><span class="keyword">, </span><span class="default">$entry</span><span class="keyword">)) {
<br />
&nbsp; </span><span class="comment">// then do the dirty work
<br />
&nbsp; </span><span class="default">$filter </span><span class="keyword">= </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">"(&amp;(uid=%s)(sn=%s))"</span><span class="keyword">,</span><span class="default">$uid</span><span class="keyword">,</span><span class="default">$sn</span><span class="keyword">);
<br />
&nbsp; </span><span class="default">$sres </span><span class="keyword">= </span><span class="default">ldap_search</span><span class="keyword">(</span><span class="default">$ldap</span><span class="keyword">, </span><span class="default">$BASEDN</span><span class="keyword">, </span><span class="default">$filter</span><span class="keyword">, </span><span class="default">$delval</span><span class="keyword">);
<br />
&nbsp; </span><span class="default">$delent </span><span class="keyword">= </span><span class="default">ldap_first_entry</span><span class="keyword">(</span><span class="default">$ldap</span><span class="keyword">, </span><span class="default">$sres</span><span class="keyword">);
<br />
&nbsp; </span><span class="default">$delarr </span><span class="keyword">= </span><span class="default">ldap_get_attributes</span><span class="keyword">(</span><span class="default">$ldap</span><span class="keyword">, </span><span class="default">$delent</span><span class="keyword">);
<br />
&nbsp; </span><span class="default">$findel</span><span class="keyword">=array();
<br />
&nbsp; for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">$delarr</span><span class="keyword">[</span><span class="string">"count"</span><span class="keyword">]; </span><span class="default">$i</span><span class="keyword">++) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$attr </span><span class="keyword">= </span><span class="default">$delarr</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">];
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$totl </span><span class="keyword">= </span><span class="default">$delarr</span><span class="keyword">[</span><span class="default">$attr</span><span class="keyword">][</span><span class="string">"count"</span><span class="keyword">];
<br />
&nbsp;&nbsp;&nbsp; for(</span><span class="default">$z</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$z</span><span class="keyword">&lt;</span><span class="default">$totl</span><span class="keyword">; </span><span class="default">$z</span><span class="keyword">++) {
<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (</span><span class="default">$totl </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$findel</span><span class="keyword">[</span><span class="default">$attr</span><span class="keyword">]=</span><span class="default">$delarr</span><span class="keyword">[</span><span class="default">$attr</span><span class="keyword">][</span><span class="default">$z</span><span class="keyword">];
<br />
&nbsp;&nbsp; &nbsp;&nbsp; } else {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$findel</span><span class="keyword">[</span><span class="default">$attr</span><span class="keyword">][</span><span class="default">$z</span><span class="keyword">]=</span><span class="default">$delarr</span><span class="keyword">[</span><span class="default">$attr</span><span class="keyword">][</span><span class="default">$z</span><span class="keyword">];
<br />
&nbsp;&nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp; }
<br />
&nbsp; if(@</span><span class="default">ldap_mod_del</span><span class="keyword">(</span><span class="default">$ldap</span><span class="keyword">, </span><span class="default">$dn</span><span class="keyword">, </span><span class="default">$findel</span><span class="keyword">)) {
<br />
&nbsp;&nbsp;&nbsp; print(</span><span class="string">"&lt;H3&gt;Modified Entry!&lt;/H3&gt;\n"</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; print(</span><span class="string">"&lt;BR&gt;\n"</span><span class="keyword">);
<br />
&nbsp; } else {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$error</span><span class="keyword">=</span><span class="default">ldap_error</span><span class="keyword">(</span><span class="default">$ldap</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; print(</span><span class="string">"&lt;H3&gt;Attribute Delete Failed!&lt;/H3&gt;\n"</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; print(</span><span class="string">"&lt;BR&gt;\n(</span><span class="default">$error</span><span class="string">)\n"</span><span class="keyword">);
<br />
&nbsp; }
<br />
} else {
<br />
&nbsp; </span><span class="default">$error</span><span class="keyword">=</span><span class="default">ldap_error</span><span class="keyword">(</span><span class="default">$ldap</span><span class="keyword">);
<br />
&nbsp; print(</span><span class="string">"&lt;H3&gt;Modify Failed!&lt;/H3&gt;\n"</span><span class="keyword">);
<br />
&nbsp; print(</span><span class="string">"&lt;BR&gt;\n(</span><span class="default">$error</span><span class="string">)\n"</span><span class="keyword">);
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="748""></a>
  <div class="note">
   <strong class="user">nickt at powys dot gov dot uk</strong>
   <a href="#748" class="date">23-Apr-1999 05:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Modifying existing LDAP information using ldap_modify()
<br />

<br />
The link_identifier must result from a call to connect to the server with authority to update entries, usually requiring an authenticated bind - ie you provide a suitable dn and password in the ldap_bind() call.
<br />

<br />
The&nbsp; dn&nbsp; must be a single specific dn that exists on the LDAP server.&nbsp;&nbsp; There is no wildcard mechanism in LDAP to globally change multiple dn entries.&nbsp;&nbsp; 
<br />

<br />
The entry array must be in one of two different forms, according to whether just one entry is to be stored in the directory for a particular attribute, or whether multiple entries are to be stored for the attribute.
<br />

<br />
Where a single entry is to be stored for an attribute - say just a single email address - then you use the general form
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="default">&lt;?php $newinfo</span><span class="keyword">[ &lt;</span><span class="default">attribute_name</span><span class="keyword">&gt; ]=</span><span class="string">"whatever" </span><span class="keyword">; </span><span class="default">?&gt;
<br />
</span>
<br />
for example ...
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="default">&lt;?php $newinfo</span><span class="keyword">[</span><span class="string">"mail"</span><span class="keyword">]=</span><span class="string">"john@myorg.com" </span><span class="keyword">; </span><span class="default">?&gt;
<br />
</span>
<br />
Where multiple entries are to be stored for an attribute&nbsp; -&nbsp; say a number of email addresses for one person&nbsp; -&nbsp; then you use the general form
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="default">&lt;?php
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $newinfo</span><span class="keyword">[ &lt;</span><span class="default">attribute_name</span><span class="keyword">&gt; ][</span><span class="default">0</span><span class="keyword">] = </span><span class="string">"whatever" </span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$newinfo</span><span class="keyword">[ &lt;</span><span class="default">attribute_name</span><span class="keyword">&gt; ][</span><span class="default">1</span><span class="keyword">] = </span><span class="string">"another" </span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">?&gt;
<br />
</span>
<br />
for example ...
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="default">&lt;?php
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $newinfo</span><span class="keyword">[</span><span class="string">"mail"</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">]=</span><span class="string">"johnw@myorg.com" </span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$newinfo</span><span class="keyword">[</span><span class="string">"mail"</span><span class="keyword">][</span><span class="default">1</span><span class="keyword">]=</span><span class="string">"jwaterson@somewhere.org" </span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">?&gt;
<br />
</span>
<br />
Further notes on ldap_modify()
<br />

<br />
The modify call leaves entries for all other attributes unaltered.&nbsp;&nbsp; So if you just want to update the entry for the "mail" attribute, then all that is required is:
<br />

<br />
&nbsp;&nbsp; &nbsp; <span class="default">&lt;?php
<br />
&nbsp;&nbsp; &nbsp; $newinfo</span><span class="keyword">[</span><span class="default">mail</span><span class="keyword">]=</span><span class="string">"nick@county.gov.uk"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">ldap_modify</span><span class="keyword">(</span><span class="default">$valid_ldaplink</span><span class="keyword">, </span><span class="default">$valid_dn</span><span class="keyword">, </span><span class="default">$newinfo</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">?&gt;
<br />
</span>
<br />
However, if there were multiple entries for the mail attribute present on the LDAP database when you run the above code, then all the existing mail entries would be deleted and be replaced by the single "mail" entry.
<br />

<br />
If you have reason to expect multiple values for a particular attribute (more that one email entry, for example) you should make sure you read all the entries from the ldap server first, and then save a modified array.
<br />

<br />
The PHP LDAP interface does not currently support direct modification of the dn.&nbsp; If the dn needs changing, the only option is to read all entries for the dn and save these to a new, modified, dn before deleting the complete entry for the original dn.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
