<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>安装／配置</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="intro.geoip.html">? 简介</a></li>
      <li style="float: right;"><a href="geoip.requirements.html">需求 ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="book.geoip.html">GeoIP</a></li>
    <li>安装／配置</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="geoip.setup" class="chapter">
 <h1>安装／配置</h1>
<h2>Table of Contents</h2><ul class="chunklist chunklist_chapter"><li><a href="geoip.requirements.html">需求</a></li><li><a href="geoip.installation.html">安装</a></li><li><a href="geoip.configuration.html">运行时配置</a></li><li><a href="geoip.resources.html">资源类型</a></li></ul>


 

 

 








 

</div>
<div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="123712""></a>
  <div class="note">
   <strong class="user">Michelangelo van Dam</strong>
   <a href="#123712" class="date">21-Mar-2019 10:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As of January 2, 2019 Maxmind discontinued the original GeoLite databases that we have been using in all these examples. You can read the full announcement here: https://support.maxmind.com/geolite-legacy-discontinuation-notice/<br />
<br />
This means that if you require to have an updated version of the GeoIP information, there are a few steps you need to do:<br />
1. Install the GeoIP2 client libraries (Composer, Phar)<br />
2. Download the new GeoIP2 datasets<br />
3. Update your application to make use of this new API and dataset<br />
<br />
You can find detailed instructions on <a href="http://maxmind.github.io/GeoIP2-php/" rel="nofollow" target="_blank">http://maxmind.github.io/GeoIP2-php/</a><br />
<br />
C extension<br />
Yes, there is a C extension available! Check out https://github.com/maxmind/MaxMind-DB-Reader-php for more details on how to install and use this extension.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="111772""></a>
  <div class="note">
   <strong class="user">ewwink at yahoo dot com</strong>
   <a href="#111772" class="date">27-Mar-2013 04:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
compiled .dll or php_geoip.dll is availbale at:<br />
<br />
<a href="http://windows.php.net/downloads/pecl/releases/geoip/1.0.8/" rel="nofollow" target="_blank">http://windows.php.net/downloads/pecl/releases/geoip/1.0.8/</a><br />
<br />
tested and worked with PHP Version 5.3.9 in windows 7 Home Premium</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="103742""></a>
  <div class="note">
   <strong class="user">sballeste at gmail dot com</strong>
   <a href="#103742" class="date">30-Apr-2011 02:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If the data files under /usr/share/GeoIP/ are not readable by apache, apache's process will crash with a segfault on calls to geoip functions.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="103708""></a>
  <div class="note">
   <strong class="user">ben at SPAMLESS dot ism dot net dot nz</strong>
   <a href="#103708" class="date">28-Apr-2011 09:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
SUSE (as root):<br />
<br />
# zypper install php5-devel<br />
# SuSEconfig<br />
# mkdir -p /usr/share/GeoIP<br />
# wget <a href="http://pecl.php.net/get/geoip-1.0.7.tgz" rel="nofollow" target="_blank">http://pecl.php.net/get/geoip-1.0.7.tgz</a><br />
(whatever the latest version is from <a href="http://pecl.php.net/package/geoip " rel="nofollow" target="_blank">http://pecl.php.net/package/geoip </a>)<br />
# tar -xzf geoip-1.0.7.tgz<br />
# cd geoip-1.0.7/<br />
# phpize<br />
# ./configure<br />
# make<br />
# make install<br />
# cp /etc/php5/conf.d/gd.ini /etc/php5/conf.d/geoip.ini<br />
# vi /etc/php5/conf.d/geoip.ini<br />
Change gd.so to geoip.so<br />
:wq!<br />
# vi /etc/php5/apache2/php.ini<br />
Find the [gd] section and add a new section afterwards:<br />
[geoip]<br />
geoip.custom_directory = /usr/share/GeoIP/<br />
:wq!<br />
# /etc/init.d/apache2 restart<br />
<br />
Check phpinfo() that geoip is loaded and the default location for the DB's is set.<br />
<br />
If you want the free DBs that are update roughly monthly, follow the "Lite" links from <a href="http://www.maxmind.com/app/country and download the tar.gz to /usr/share/GeoIP/ and extract." rel="nofollow" target="_blank">http://www.maxmind.com/app/country and download the tar.gz to /usr/share/GeoIP/ and extract.</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93000""></a>
  <div class="note">
   <strong class="user">bob at qww dot cz</strong>
   <a href="#93000" class="date">19-Aug-2009 12:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To install geoip on debian lenny:<br />
<br />
wget <a href="http://geolite.maxmind.com/download/geoip/database/GeoLiteCity.dat.gz" rel="nofollow" target="_blank">http://geolite.maxmind.com/download/geoip/database/GeoLiteCity.dat.gz</a><br />
gunzip GeoLiteCity.dat.gz<br />
sudo mkdir -v /usr/share/GeoIP<br />
sudo mv -v GeoLiteCity.dat /usr/share/GeoIP/GeoIPCity.dat<br />
<br />
sudo apt-get install php5-geoip<br />
<br />
and then try it in PHP:<br />
print_r(geoip_record_by_name('php.net'));<br />
<br />
returns:<br />
Array<br />
(<br />
&nbsp;&nbsp;&nbsp; [country_code] =&gt; US<br />
&nbsp;&nbsp;&nbsp; [country_code3] =&gt; USA<br />
&nbsp;&nbsp;&nbsp; [country_name] =&gt; United States<br />
&nbsp;&nbsp;&nbsp; [region] =&gt; CA<br />
&nbsp;&nbsp;&nbsp; [city] =&gt; Sunnyvale<br />
&nbsp;&nbsp;&nbsp; [postal_code] =&gt; 94089<br />
&nbsp;&nbsp;&nbsp; [latitude] =&gt; 37.4249000549<br />
&nbsp;&nbsp;&nbsp; [longitude] =&gt; -122.007400513<br />
&nbsp;&nbsp;&nbsp; [dma_code] =&gt; 807<br />
&nbsp;&nbsp;&nbsp; [area_code] =&gt; 408<br />
)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92221""></a>
  <div class="note">
   <strong class="user">munitoris at inetspec dot com</strong>
   <a href="#92221" class="date">14-Jul-2009 03:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
At the time of this writing, the PECL binaries at <a href="http://pecl4win.php.net/ are NOT AVAILABLE." rel="nofollow" target="_blank">http://pecl4win.php.net/ are NOT AVAILABLE.</a><br />
<br />
Specifically, the php_geoip.dll extension is not available in a pre-compiled form for Windoze PHP developers.<br />
<br />
There are only two alternative solutions to self-compiling for Windoze (AFAIK):<br />
<br />
1) Use the "Pure" PHP version of the GeoIP API from MaxMind available here (<a href="http://www.maxmind.com/download/geoip/api/php/" rel="nofollow" target="_blank">http://www.maxmind.com/download/geoip/api/php/</a>).&nbsp; This solution is not really acceptable for production machines because of its slower speed.&nbsp; However, it does work for development.<br />
<br />
2) Use the older version of this pre-compiled extension (<a href="http://www.gknw.de/php/ext_win32/php-5.2.1_geoip-w32.zip" rel="nofollow" target="_blank">http://www.gknw.de/php/ext_win32/php-5.2.1_geoip-w32.zip</a>).&nbsp; It worked on my development system using Windoze XP sp2, Apache 2.2.3 and PHP 5.2.10.&nbsp; There are also older versions for PHP 5.1.2 and PHP 5.1.4 in the same directory.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="87647""></a>
  <div class="note">
   <strong class="user">matt at kynx dot org</strong>
   <a href="#87647" class="date">14-Dec-2008 10:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Installation on OSX (Leopard) running MAMP<br />
<br />
First you need MacPorts installed and operational:<br />
<a href="http://www.macports.org" rel="nofollow" target="_blank">http://www.macports.org</a><br />
<br />
Use that to install libgeoip. From a terminal window, do:<br />
<br />
&nbsp;&nbsp;&nbsp; $ sudo port install libgeoip<br />
<br />
This installs the library in /opt/local. Unfortunately the current version of the PECL extension doesn't know to look there, so you'll need to download and compile manually from <a href="http://pecl.php.net/package/geoip" rel="nofollow" target="_blank">http://pecl.php.net/package/geoip</a><br />
<br />
Assuming it's in your download directory, extract it:<br />
<br />
&nbsp;&nbsp;&nbsp; $ cd ~/Downloads<br />
&nbsp;&nbsp;&nbsp; $ tar -xzf geoip-1.0.3.tgz<br />
&nbsp;&nbsp;&nbsp; $ cd geoip-1.0.3<br />
<br />
Now edit the config.m4 file and change the SEARCH_PATH variable, as described in the following bug report:<br />
<a href="http://pecl.php.net/bugs/bug.php?id=14795" rel="nofollow" target="_blank">http://pecl.php.net/bugs/bug.php?id=14795</a><br />
<br />
Now you should be able to compile and install the extension as usual. Make sure you use the phpize from the MAMP package, not the one that ships with OSX:<br />
<br />
&nbsp;&nbsp;&nbsp; $ /App*/MAMP/bin/php5/bin/phpize<br />
&nbsp;&nbsp;&nbsp; $ ./configure<br />
&nbsp;&nbsp;&nbsp; $ make<br />
&nbsp;&nbsp;&nbsp; $ sudo make install<br />
<br />
If phpize complains that it cannot find files under /Applications/MAMP/bin/php5/include, make sure you have the development version of MAMP installed (link towards the bottom of the MAMP download page).<br />
<br />
You're nearly there! The extension will have installed in /usr/lib/php. You need to copy it into your MAMP extension directory:<br />
<br />
&nbsp;&nbsp;&nbsp; $ cd /App*/MAMP/bin/php5/lib/php/ext*/no-debug*/<br />
&nbsp;&nbsp;&nbsp; $ mv /usr/lib/php/ext*/no-debug*/geoip.so .<br />
<br />
Now edit the php.ini file in /Applications/MAMP/conf/php5/ and add the following line:<br />
<br />
&nbsp;&nbsp; &nbsp; extension=geoip.so<br />
<br />
Restart your web server and check phpinfo() - the geoip extension should now be listed.<br />
<br />
Good luck!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="87522""></a>
  <div class="note">
   <strong class="user">code at edoceo dot com</strong>
   <a href="#87522" class="date">08-Dec-2008 01:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Installation on Gentoo (2008.0) as follows:<br />
<br />
emerge dev-libs/geoip<br />
pecl install geoip<br />
<br />
Then fetch the databases to /usr/share/GeoIP (wrapped!)<br />
cd /usr/share/GeoIP<br />
wget <a href="http://geolite.maxmind.com/download/geoip/ " rel="nofollow" target="_blank">http://geolite.maxmind.com/download/geoip/ </a>\<br />
&nbsp; database/GeoLiteCity.dat.gz<br />
wget <a href="http://geolite.maxmind.com/download/geoip/ " rel="nofollow" target="_blank">http://geolite.maxmind.com/download/geoip/ </a>\<br />
&nbsp; database/GeoLiteCountry/GeoIP.dat.gz</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
