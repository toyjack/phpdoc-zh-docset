<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>Enables the ability to use PHP functions as XSLT functions</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="xsltprocessor.importstylesheet.html">? XSLTProcessor::importStylesheet</a></li>
      <li style="float: right;"><a href="xsltprocessor.removeparameter.html">XSLTProcessor::removeParameter ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="class.xsltprocessor.html">XSLTProcessor</a></li>
    <li>Enables the ability to use PHP functions as XSLT functions</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="xsltprocessor.registerphpfunctions" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">XSLTProcessor::registerPHPFunctions</h1>
  <p class="verinfo">(PHP 5 &gt;= 5.0.4, PHP 7)</p><p class="refpurpose"><span class="refname">XSLTProcessor::registerPHPFunctions</span> &mdash; <span class="dc-title">Enables the ability to use PHP functions as XSLT functions</span></p>

 </div>
 <div class="refsect1 description" id="refsect1-xsltprocessor.registerphpfunctions-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   
   <span class="methodname"><strong>XSLTProcessor::registerPHPFunctions</strong></span>
    ([ <span class="methodparam"><span class="type"><a href="language.pseudo-types.html#language.types.mixed" class="type mixed">mixed</a></span> <code class="parameter">$restrict</code></span>
  ] ) : <span class="type"><span class="type void">void</span></span></div>

  <p class="para rdfs-comment">
   This method enables the ability to use PHP functions as XSLT functions
   within XSL stylesheets.
  </p>
 </div>

 <div class="refsect1 parameters" id="refsect1-xsltprocessor.registerphpfunctions-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">restrict</code></dt>

     <dd>

      <p class="para">
       Use this parameter to only allow certain functions to be called from 
       XSLT.
      </p>
      <p class="para">
       This parameter can be either a string (a function name) or an array of
       functions.
      </p>
     </dd>

    
   </dl>

  </p>
 </div>

 <div class="refsect1 returnvalues" id="refsect1-xsltprocessor.registerphpfunctions-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   没有返回值。
  </p>
 </div>

 <div class="refsect1 examples" id="refsect1-xsltprocessor.registerphpfunctions-examples">
  <h3 class="title">范例</h3>
  <p class="para">
   <div class="example" id="example-6663">
    <p><strong>Example #1 Simple PHP Function call from a stylesheet</strong></p>
    <div class="example-contents"><div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$xml&nbsp;</span><span style="color: #007700">=&nbsp;&lt;&lt;&lt;EOB<br /></span><span style="color: #DD0000">&lt;allusers&gt;<br />&nbsp;&lt;user&gt;<br />&nbsp;&nbsp;&lt;uid&gt;bob&lt;/uid&gt;<br />&nbsp;&lt;/user&gt;<br />&nbsp;&lt;user&gt;<br />&nbsp;&nbsp;&lt;uid&gt;joe&lt;/uid&gt;<br />&nbsp;&lt;/user&gt;<br />&lt;/allusers&gt;<br /></span><span style="color: #007700">EOB;<br /></span><span style="color: #0000BB">$xsl&nbsp;</span><span style="color: #007700">=&nbsp;&lt;&lt;&lt;EOB<br /></span><span style="color: #DD0000">&lt;?xml&nbsp;version="1.0"&nbsp;encoding="UTF-8"?&gt;<br />&lt;xsl:stylesheet&nbsp;version="1.0"&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xmlns:xsl="http://www.w3.org/1999/XSL/Transform"<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xmlns:php="http://php.net/xsl"&gt;<br />&lt;xsl:output&nbsp;method="html"&nbsp;encoding="utf-8"&nbsp;indent="yes"/&gt;<br />&nbsp;&lt;xsl:template&nbsp;match="allusers"&gt;<br />&nbsp;&nbsp;&lt;html&gt;&lt;body&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;h2&gt;Users&lt;/h2&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;table&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;xsl:for-each&nbsp;select="user"&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&gt;&lt;td&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;xsl:value-of<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;select="php:function('ucfirst',string(uid))"/&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/td&gt;&lt;/tr&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;/xsl:for-each&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;/table&gt;<br />&nbsp;&nbsp;&lt;/body&gt;&lt;/html&gt;<br />&nbsp;&lt;/xsl:template&gt;<br />&lt;/xsl:stylesheet&gt;<br /></span><span style="color: #007700">EOB;<br /></span><span style="color: #0000BB">$xmldoc&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">DOMDocument</span><span style="color: #007700">::</span><span style="color: #0000BB">loadXML</span><span style="color: #007700">(</span><span style="color: #0000BB">$xml</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$xsldoc&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">DOMDocument</span><span style="color: #007700">::</span><span style="color: #0000BB">loadXML</span><span style="color: #007700">(</span><span style="color: #0000BB">$xsl</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$proc&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">XSLTProcessor</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">$proc</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">registerPHPFunctions</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">$proc</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">importStyleSheet</span><span style="color: #007700">(</span><span style="color: #0000BB">$xsldoc</span><span style="color: #007700">);<br />echo&nbsp;</span><span style="color: #0000BB">$proc</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">transformToXML</span><span style="color: #007700">(</span><span style="color: #0000BB">$xmldoc</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div></div>

    </div>
  </p>
 </div>

 <div class="refsect1 changelog" id="refsect1-xsltprocessor.registerphpfunctions-changelog">
  <h3 class="title">更新日志</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead>
      <tr>
       <th>版本</th>
       <th>说明</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
       <td>5.1.0</td>
       <td>
        The <code class="parameter">restrict</code> parameter was added.
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="101092""></a>
  <div class="note">
   <strong class="user">Matthew, info at mathias-schaefer dot de</strong>
   <a href="#101092" class="date">25-Nov-2010 08:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
=&gt; there is no instance of your class needed, you have to take care about the namespace (using 5.3).<br />
<br />
&lt;!-- xsl:<br />
&lt;xsl:value-of select="php:function ('My\Name\Space\MyClassName::methodName',1+2)"/&gt;<br />
---&gt;<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">namespace </span><span class="default">My</span><span class="keyword">\</span><span class="default">Name</span><span class="keyword">\</span><span class="default">Space</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; class </span><span class="default">MyClassName<br />
&nbsp;&nbsp; </span><span class="keyword">{<br />
&nbsp;&nbsp; &nbsp;&nbsp; static public function </span><span class="default">methodName</span><span class="keyword">(</span><span class="default">$someArgument</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="string">"resultis:"</span><span class="keyword">.</span><span class="default">$someArgument</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;<br />
</span><br />
&lt;!-- result:<br />
resultis:3<br />
--&gt;<br />
<br />
=&gt; no to-string conversion of the argument needed<br />
=&gt; returning numbers is also possible (maybe DOM nodes too)<br />
<br />
Keep on hackin'</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99315""></a>
  <div class="note">
   <strong class="user">Demerit</strong>
   <a href="#99315" class="date">10-Aug-2010 07:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Let's get the terminology correct here, folks.
<br />

<br />
If you are calling a function that is residing within a class, reference it by its INSTANCE name, NOT its class name.
<br />

<br />
class.my_class.php:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">class </span><span class="default">class_name </span><span class="keyword">{
<br />
static function </span><span class="default">function_name</span><span class="keyword">(</span><span class="default">$in</span><span class="keyword">){
<br />
return (</span><span class="default">$out</span><span class="keyword">);
<br />
}
<br />
}
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
calling_document.php:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">require_once(</span><span class="string">'class.my_class.php'</span><span class="keyword">);
<br />
</span><span class="default">$instance_name</span><span class="keyword">=new </span><span class="default">class_name</span><span class="keyword">();
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
my_xslt.xsl:
<br />

<br />
&lt;xsl:value-of select="php:function ('instance_name::function_name','garbage')" /&gt;
<br />

<br />
BTW, in 5.1.6 double-colon (::) is the only thing that works when calling a function that resides within a class. However, you must declare your function as static. Using -&gt; as some have suggested (e.g., php:function ('instance_name-&gt;function_name','garbage')) doesn't work at all, no matter how you declare your function.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92386""></a>
  <div class="note">
   <strong class="user">Nic Luciano</strong>
   <a href="#92386" class="date">22-Jul-2009 11:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Ritch said "If you wish to use a function from inside a class use the double colon (::) notation..."<br />
<br />
Also note that the class function must be declared as static.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84309""></a>
  <div class="note">
   <strong class="user">Ariz Jacinto</strong>
   <a href="#84309" class="date">08-Jul-2008 02:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to use replace() function similar to XPath 2.0[1]&nbsp; and you want to avoid a long XSLT function similar to this one[2], you can use PHP's str_replace() instead:<br />
<br />
&nbsp;&nbsp; &lt;xsl:value-of select="php:functionString('str_replace','pattern', 'replacement' , . )"&gt;<br />
<br />
Links:<br />
&nbsp; [1] <a href="http://www.w3.org/TR/2004/WD-xpath-functions-20041029/#func-replace" rel="nofollow" target="_blank">http://www.w3.org/TR/2004/WD-xpath-functions-20041029/#func-replace</a><br />
&nbsp; [2] <a href="http://aspn.activestate.com/ASPN/Cookbook/XSLT/Recipe/65426" rel="nofollow" target="_blank">http://aspn.activestate.com/ASPN/Cookbook/XSLT/Recipe/65426</a><br />
<br />
_</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="80073""></a>
  <div class="note">
   <strong class="user">thsoft at vipmail dot hu</strong>
   <a href="#80073" class="date">27-Dec-2007 02:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Unfortunately, you can't pass arrays to PHP from XLST.<br />
But you can pass an arbitrary number of arguments to a PHP function and then get them with func_get_args() as an array.<br />
[There's no sense writing a function that is identical to the array() construct, because a function's return value is converted to a string when passed as an argument to another function. This means deep arrays cannot be handled this way.]</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="72771""></a>
  <div class="note">
   <strong class="user">thsoft at vipmail dot hu</strong>
   <a href="#72771" class="date">31-Jan-2007 03:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The correct way to receive DOM nodes (let it be element, document, document fragment etc.) returned from PHP is to use &lt;xsl:copy-of select="php:function...<br />
<br />
I found the idea and an example here: <a href="http://bugs.php.net/bug.php?id=29409" rel="nofollow" target="_blank">http://bugs.php.net/bug.php?id=29409</a><br />
<br />
For the technical details about the reason, see <a href="http://www.w3.org/TR/xslt#copy-of" rel="nofollow" target="_blank">http://www.w3.org/TR/xslt#copy-of</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71489""></a>
  <div class="note">
   <strong class="user">phil at worldpoolfederation dot com</strong>
   <a href="#71489" class="date">01-Dec-2006 03:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Not true<br />
<br />
Use :: to call static functions<br />
Use -&gt; to call non static functions<br />
<br />
You must define a function as static in php 5.1 to be able to call it statically.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="70301""></a>
  <div class="note">
   <strong class="user">mark at thirst dot org</strong>
   <a href="#70301" class="date">10-Oct-2006 07:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Ritch said "If you wish to use a function from inside a class use the double colon (::) notation..."&nbsp;&nbsp; This worked in 5.0.4 but no longer works in 5.1.6.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69376""></a>
  <div class="note">
   <strong class="user">franp at free dot fr</strong>
   <a href="#69376" class="date">02-Sep-2006 01:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that if you want your output to validate against some xhtml dtd, you must add the following attribute to the xsl:stylesheet element of the xslt stylesheet :<br />
exclude-result-prefixes="php".<br />
<br />
Otherwise, you get an "invalid attribute xmlns:php" error.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="66699""></a>
  <div class="note">
   <strong class="user">taylorbarstow at that google mail thingy</strong>
   <a href="#66699" class="date">26-May-2006 05:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Add-on to my previous note (below) about returning nodesets to XSLT from PHP functions:<br />
<br />
You don't have to return a DOMDocument, DOMElement works just as well.&nbsp; Plus, retuning a DOMElement gets around the problem of discarding the root node which I discuss below and which is also touched on by "Ingram".</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="62751""></a>
  <div class="note">
   <strong class="user">heinemann dot juergen at hjcms dot de</strong>
   <a href="#62751" class="date">08-Mar-2006 02:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You can find mor Examples at PHP Sources php-5.*/ext/xsl/tests<br />
<span class="default">&lt;?php<br />
<br />
$xform </span><span class="keyword">= &lt;&lt;&lt;EOT<br />
</span><span class="string">&lt;?xml version = '1.0' encoding = 'utf-8' ?&gt;<br />
&lt;xsl:stylesheet version="1.0"<br />
&nbsp;&nbsp;&nbsp; xmlns:xsl="<a href="http://www.w3.org/1999/XSL/Transform" rel="nofollow" target="_blank">http://www.w3.org/1999/XSL/Transform</a>"<br />
&nbsp;&nbsp;&nbsp; xmlns:php="<a href="http://php.net/xsl" rel="nofollow" target="_blank">http://php.net/xsl</a>"<br />
&nbsp;&nbsp;&nbsp; xsl:extension-element-prefixes="php"<br />
&gt;<br />
&lt;xsl:output method="xml" indent="yes" encoding="utf-8" /&gt;<br />
&lt;xsl:namespace-alias stylesheet-prefix="php" result-prefix="xsl" /&gt;<br />
&lt;xsl:template match="root"&gt;<br />
&lt;html&gt;<br />
&lt;head&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;title&gt;Dateformat&lt;/title&gt;<br />
&lt;/head&gt;<br />
&lt;body&gt;<br />
&lt;xsl:for-each select="datenode"&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;li&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;xsl:value-of select="php:functionString('convertDate', . )" /&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;/li&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;/xsl:for-each&gt;<br />
&lt;/body&gt;<br />
&lt;/html&gt;<br />
&lt;/xsl:template&gt;<br />
&lt;/xsl:stylesheet&gt;<br />
</span><span class="keyword">EOT;<br />
<br />
function </span><span class="default">convertDate</span><span class="keyword">( </span><span class="default">$i </span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">setlocale</span><span class="keyword">( </span><span class="default">LC_TIME</span><span class="keyword">, </span><span class="string">'de_DE' </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">utf8_encode</span><span class="keyword">( </span><span class="default">strftime</span><span class="keyword">( </span><span class="string">'%B %d %A %Y %H:%M:%S CET'</span><span class="keyword">, </span><span class="default">$i </span><span class="keyword">) );<br />
}<br />
<br />
</span><span class="default">$xsl </span><span class="keyword">= new </span><span class="default">XSLTProcessor</span><span class="keyword">;<br />
</span><span class="default">$xsl</span><span class="keyword">-&gt;</span><span class="default">registerPHPFunctions</span><span class="keyword">();<br />
</span><span class="default">$xsl</span><span class="keyword">-&gt;</span><span class="default">setParameter</span><span class="keyword">( </span><span class="string">'DOCTYPE'</span><span class="keyword">, </span><span class="string">'PUBLIC'</span><span class="keyword">, </span><span class="string">'<a href="http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd" rel="nofollow" target="_blank">http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd</a>' </span><span class="keyword">);<br />
</span><span class="default">$xsl</span><span class="keyword">-&gt;</span><span class="default">setParameter</span><span class="keyword">( </span><span class="string">'html'</span><span class="keyword">, </span><span class="string">'xmlns'</span><span class="keyword">, </span><span class="string">'<a href="http://www.w3.org/1999/xhtml" rel="nofollow" target="_blank">http://www.w3.org/1999/xhtml</a>' </span><span class="keyword">);<br />
<br />
</span><span class="default">$xdom </span><span class="keyword">= new </span><span class="default">DomDocument</span><span class="keyword">( </span><span class="string">'1.0'</span><span class="keyword">, </span><span class="string">'utf-8' </span><span class="keyword">);<br />
</span><span class="default">$xdom</span><span class="keyword">-&gt;</span><span class="default">loadXML</span><span class="keyword">( </span><span class="default">$xform </span><span class="keyword">);<br />
<br />
</span><span class="default">$xsl</span><span class="keyword">-&gt;</span><span class="default">importStyleSheet</span><span class="keyword">( </span><span class="default">$xdom </span><span class="keyword">);<br />
unset( </span><span class="default">$xdom </span><span class="keyword">);<br />
<br />
</span><span class="default">$dom </span><span class="keyword">= new </span><span class="default">DomDocument</span><span class="keyword">( </span><span class="string">'1.0'</span><span class="keyword">, </span><span class="string">'utf-8' </span><span class="keyword">);<br />
</span><span class="default">$r </span><span class="keyword">= </span><span class="default">$dom</span><span class="keyword">-&gt;</span><span class="default">appendChild</span><span class="keyword">( </span><span class="default">$dom</span><span class="keyword">-&gt;</span><span class="default">createElement</span><span class="keyword">( </span><span class="string">'root' </span><span class="keyword">) );<br />
foreach ( </span><span class="default">range</span><span class="keyword">( </span><span class="default">1</span><span class="keyword">, </span><span class="default">12 </span><span class="keyword">) AS </span><span class="default">$i </span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$r</span><span class="keyword">-&gt;</span><span class="default">appendChild</span><span class="keyword">( </span><span class="default">$dom</span><span class="keyword">-&gt;</span><span class="default">createElement</span><span class="keyword">( </span><span class="string">'datenode'</span><span class="keyword">, </span><span class="default">mktime</span><span class="keyword">( </span><span class="default">date</span><span class="keyword">(</span><span class="string">'G'</span><span class="keyword">), </span><span class="default">date</span><span class="keyword">(</span><span class="string">'i'</span><span class="keyword">), </span><span class="default">date</span><span class="keyword">(</span><span class="string">'s'</span><span class="keyword">), </span><span class="default">$i</span><span class="keyword">, </span><span class="default">date</span><span class="keyword">(</span><span class="string">'d'</span><span class="keyword">), </span><span class="default">date</span><span class="keyword">(</span><span class="string">'Y'</span><span class="keyword">) ) ) );<br />
}<br />
<br />
</span><span class="default">header</span><span class="keyword">( </span><span class="string">"Content-Type: text/html; CHARSET=gb2312;" </span><span class="keyword">);<br />
</span><span class="default">header</span><span class="keyword">( </span><span class="string">"Content-Encoding: utf-8" </span><span class="keyword">);<br />
echo </span><span class="default">$xsl</span><span class="keyword">-&gt;</span><span class="default">transformToXML</span><span class="keyword">( </span><span class="default">$dom </span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="62444""></a>
  <div class="note">
   <strong class="user">Ingram</strong>
   <a href="#62444" class="date">28-Feb-2006 12:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Upon testing returning of a nodeset contributed by<br />
<br />
taylorbarstow at that google mail thingy<br />
<br />
(which works excellently, TY!)<br />
<br />
I found that with using:<br />
<br />
===<br />
"Presumably, it's worth creating a template to do the discard:<br />
<br />
&lt;xsl:template select="*" mode="discardRoot"&gt;<br />
&nbsp;&nbsp; &lt;xsl:apply-templates select="./*" /&gt;<br />
&lt;/xsl:template&gt;<br />
<br />
Which you can call like so:<br />
<br />
&lt;xsl:apply-templates select="php:function('getNodeSet')" mode="discardRoot" /&gt; "<br />
===<br />
<br />
I could only output the text and not any of the tags after applying templates - i.e. it stripped all elements around text.<br />
<br />
Instead using:<br />
<br />
===<br />
&lt;xsl:template match="/"&gt;<br />
&nbsp;&nbsp; &lt;xsl:for-each select="php:function('getNodeSet')" /&gt;<br />
&nbsp;&nbsp; &nbsp; &lt;xsl:apply-templates /&gt;<br />
&nbsp;&nbsp; &lt;/xsl:for-each&gt;<br />
&lt;/xsl:template&gt;<br />
<br />
which effectively discards the root node. <br />
===<br />
<br />
Worked fine and allowed me to apply-templates without problem on the returned nodeset.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="61373""></a>
  <div class="note">
   <strong class="user">hopeseekr at gmail dot com</strong>
   <a href="#61373" class="date">01-Feb-2006 12:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
One of the peskiest things I had problems with was encoding URL parameters.&nbsp; I mean, pretend you want to populate a link with "search+terms" instead of just "search terms".&nbsp; I was including two seperate URLs in the XML and that was ludicrous. <br />
<br />
Below is a far more elegant PHP+XSLT solution.&nbsp; You will also see it uses two *undocumented* features of registerPHPFunctions(), namely php:functionString() and the passing of parameters to the function.&nbsp; I figured this out by trial and error; I really hope this note helps you as it *greatly* expands the power of php functions in XSLT!<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/* --- XML input --- */<br />
</span><span class="keyword">&lt;</span><span class="default">search_results</span><span class="keyword">&gt;<br />
&nbsp;&nbsp; &lt;</span><span class="default">query</span><span class="keyword">&gt;</span><span class="default">concert tickets</span><span class="keyword">&lt;/</span><span class="default">query</span><span class="keyword">&gt;<br />
&lt;/</span><span class="default">search_results</span><span class="keyword">&gt;<br />
<br />
</span><span class="comment">/* --- XSL code --- */<br />
</span><span class="keyword">&lt;!-- </span><span class="default">Display query </span><span class="keyword">--&gt;<br />
&lt;</span><span class="default">xsl</span><span class="keyword">:</span><span class="default">template match</span><span class="keyword">=</span><span class="string">"search_results"</span><span class="keyword">&gt;<br />
&nbsp;&nbsp; &lt;!-- </span><span class="default">Get URL</span><span class="keyword">-</span><span class="default">encoded string via PHP </span><span class="keyword">--&gt;<br />
&nbsp;&nbsp; &lt;</span><span class="default">xsl</span><span class="keyword">:</span><span class="default">variable name</span><span class="keyword">=</span><span class="string">"safeurl" </span><span class="keyword">as=</span><span class="string">"xs:string" </span><span class="default">select</span><span class="keyword">=</span><span class="string">"php:functionString('urlencode', query)" </span><span class="keyword">/&gt;<br />
&nbsp;&nbsp; &lt;</span><span class="default">p</span><span class="keyword">&gt;</span><span class="default">Your search </span><span class="keyword">for &lt;</span><span class="default">em</span><span class="keyword">&gt;&lt;</span><span class="default">xsl</span><span class="keyword">:</span><span class="default">value</span><span class="keyword">-</span><span class="default">of select</span><span class="keyword">=</span><span class="string">"query"</span><span class="keyword">/&gt;&lt;/</span><span class="default">em</span><span class="keyword">&gt; </span><span class="default">can be continued at </span><span class="keyword">&lt;</span><span class="default">a href</span><span class="keyword">=</span><span class="string">"<a href="http://www.tixtix.com/search.php?q=" rel="nofollow" target="_blank">http://www.tixtix.com/search.php?q=</a></span><span class="keyword">{</span><span class="default">$safeurl</span><span class="keyword">}</span><span class="string">"</span><span class="keyword">&gt;</span><span class="default">our search engine</span><span class="keyword">&lt;/</span><span class="default">a</span><span class="keyword">&gt;&lt;/</span><span class="default">p</span><span class="keyword">&gt;<br />
&lt;/</span><span class="default">xsl</span><span class="keyword">:</span><span class="default">template</span><span class="keyword">&gt;<br />
<br />
</span><span class="comment">/* --- XHTML output --- */<br />
</span><span class="keyword">&lt;</span><span class="default">p</span><span class="keyword">&gt;</span><span class="default">Your search </span><span class="keyword">for &lt;</span><span class="default">em</span><span class="keyword">&gt;</span><span class="default">concert tickets</span><span class="keyword">&lt;/</span><span class="default">em</span><span class="keyword">&gt; </span><span class="default">can be continued at </span><span class="keyword">&lt;</span><span class="default">a href</span><span class="keyword">=</span><span class="string">"<a href="http://www.tixtix.com/search.php?q=space+cowboy" rel="nofollow" target="_blank">http://www.tixtix.com/search.php?q=space+cowboy</a>"</span><span class="keyword">&gt;</span><span class="default">our search engine</span><span class="keyword">&lt;/</span><span class="default">a</span><span class="keyword">&gt;&lt;/</span><span class="default">p</span><span class="keyword">&gt;<br />
</span><span class="default">?&gt;<br />
</span><br />
Cool, huh?</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="59280""></a>
  <div class="note">
   <strong class="user">taylorbarstow at that google mail thingy</strong>
   <a href="#59280" class="date">01-Dec-2005 07:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
From a PHP function, you can pass a nodeset back to XSL using a DOMDocument.&nbsp; For example:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">getNodeSet</span><span class="keyword">() {<br />
&nbsp;&nbsp; </span><span class="default">$xml </span><span class="keyword">= <br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="string">"&lt;test&gt;" </span><span class="keyword">.<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="string">"&lt;a-node&gt;This is a node&lt;/a-node&gt;" </span><span class="keyword">.<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="string">"&lt;a-node&gt;This is another node&lt;/a-node&gt;" </span><span class="keyword">.<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="string">"&lt;/test&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp; </span><span class="default">$doc </span><span class="keyword">= new </span><span class="default">DOMDocument</span><span class="keyword">;<br />
&nbsp;&nbsp; </span><span class="default">$doc</span><span class="keyword">-&gt;</span><span class="default">loadXml</span><span class="keyword">(</span><span class="default">$xml</span><span class="keyword">);<br />
&nbsp;&nbsp; return </span><span class="default">$doc</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
The only problem I've found is that the root level node in your returned DOM document acts like the root level node of your original.&nbsp;&nbsp; SO, it's easy to introduce an infinite loop like so:<br />
<br />
&lt;xsl:template match="/"&gt;<br />
&nbsp;&nbsp; &lt;xsl:apply-templates select="php:function('getNodeSet')" /&gt;<br />
&lt;/xsl:template&gt;<br />
<br />
To avoid this, I've been using a construct like:<br />
<br />
&lt;xsl:template match="/"&gt;<br />
&nbsp;&nbsp; &lt;xsl:for-each select="php:function('getNodeSet')" /&gt;<br />
&nbsp;&nbsp; &nbsp;&nbsp; &lt;xsl:apply-templates /&gt;<br />
&nbsp;&nbsp; &lt;/xsl:for-each&gt;<br />
&lt;/xsl:template&gt;<br />
<br />
which effectively discards the root node.&nbsp; Presumably, it's worth creating a template to do the discard:<br />
<br />
&lt;xsl:template select="*" mode="discardRoot"&gt;<br />
&nbsp;&nbsp; &lt;xsl:apply-templates select="./*" /&gt;<br />
&lt;/xsl:template&gt;<br />
<br />
Which you can call like so:<br />
<br />
&lt;xsl:apply-templates select="php:function('getNodeSet')" mode="discardRoot" /&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="54054""></a>
  <div class="note">
   <strong class="user">Ritch at Bugsoftware dot co dot uk</strong>
   <a href="#54054" class="date">22-Jun-2005 03:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you wish to use a function from inside a class use the double colon (::) notation, for example;<br />
<br />
php:functionString('classname::function')<br />
<br />
The funtion is fired off as a static and as such acts like a function in the global namespace.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="50598""></a>
  <div class="note">
   <strong class="user">benbarnett</strong>
   <a href="#50598" class="date">04-Mar-2005 04:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You can use the php:functionString() in the XSL, which will automatically convert output to a string!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="46893""></a>
  <div class="note">
   <strong class="user">zac at zacbowling dot com</strong>
   <a href="#46893" class="date">27-Oct-2004 01:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
One thing I have told a lot of people to do if they are having <br />
issues with this function is to check for any 'xmlns' attributes <br />
that get generated and added to your xml pages by some <br />
types of popular software. <br />
<br />
<span class="default">&lt;?php <br />
$file </span><span class="keyword">= </span><span class="string">"<a href="http://data.map***.net/m***ck.asmx/GetMessages?IMEI=" rel="nofollow" target="_blank">http://data.map***.net/m***ck.asmx/GetMessages?IMEI=</a></span><span class="default">$id</span><span class="string">"</span><span class="keyword">;<br />
<br />
</span><span class="default">$docxml </span><span class="keyword">= </span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);<br />
<br />
</span><span class="comment">//You may have to do something like this where <br />
//I remove any instance of xmlns tags that get<br />
//returned by my ASP.NET SOAP responses.<br />
<br />
</span><span class="default">$docxml </span><span class="keyword">= <br />
&nbsp;</span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"xmlns=\"<a href="http://data.map***.net/m***ck.asmx?WSDL" rel="nofollow" target="_blank">http://data.map***.net/m***ck.asmx?WSDL</a>\""</span><span class="keyword">,<br />
&nbsp; </span><span class="string">""</span><span class="keyword">,</span><span class="default">$docxml</span><span class="keyword">);<br />
<br />
</span><span class="default">$xslt </span><span class="keyword">= new </span><span class="default">xsltProcessor</span><span class="keyword">;<br />
<br />
</span><span class="comment">//You don't remove them then this function will blow up. <br />
</span><span class="default">$xslt</span><span class="keyword">-&gt;</span><span class="default">registerPHPFunctions</span><span class="keyword">();<br />
</span><span class="default">$xslt</span><span class="keyword">-&gt;</span><span class="default">importStyleSheet</span><span class="keyword">(</span><span class="default">DomDocument</span><span class="keyword">::</span><span class="default">load</span><span class="keyword">(</span><span class="string">'../xsl/message.xsl'</span><span class="keyword">));<br />
print </span><span class="default">$xslt</span><span class="keyword">-&gt;</span><span class="default">transformToXML</span><span class="keyword">(</span><span class="default">DomDocument</span><span class="keyword">::</span><span class="default">loadXML</span><span class="keyword">(</span><span class="default">$docxml</span><span class="keyword">));<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Also a few cool tricks with this function is that you can call <br />
built in PHP functions. For example:<br />
<br />
&lt;xsl:value-of <br />
&nbsp; select="php:function('nl2br',string(MessageContent/Message))" <br />
&nbsp; disable-output-escaping="yes"/&gt;<br />
<br />
That XSL value will now return your normal string but replace<br />
all your new line charactors in your xml with '&lt;br /&gt;'s.<br />
<br />
Also note the 'disable-output-escaping="yes"' statement. If <br />
you don't call this, then the output of that bind will be ran <br />
thru basicly a "htmlencode()" type function. <br />
<br />
Last but not least, take a look at the 'string()' function I <br />
called in XSL before passing it back. That is because without <br />
calling that, when it runs it will try and pass the node object, <br />
and not its value (which is what you most likely only want).<br />
<br />
This function is very awsome and could lead to some very <br />
interesting code development. Skins could be loaded <br />
remotely. You could write an RSS viewer in PHP without much <br />
code. You could parse XHTML pages into another view (either <br />
localy or remotely). Then you can take that same XML <br />
content and throw it against ASP.NET, Java, or even a <br />
command line processing tool using that same exact XSL <br />
style sheet and generate the front ends for you page without <br />
much change. I'm very excited. <br />
<br />
Happy codding.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="46378""></a>
  <div class="note">
   <strong class="user">junkmail at eighteyes dot com</strong>
   <a href="#46378" class="date">08-Oct-2004 02:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When writing a stylesheet that uses a callback function be sure to include a namespace declaration for php, as follows: <br />
<br />
&lt;xsl:stylesheet xmlns:xsl="<a href="http://www.w3.org/1999/XSL/Transform" rel="nofollow" target="_blank">http://www.w3.org/1999/XSL/Transform</a>"<br />
xmlns:php="<a href="http://php.net/xsl" rel="nofollow" target="_blank">http://php.net/xsl</a>" version='1.0'&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="46063""></a>
  <div class="note">
   <strong class="user">begemot at php dot com dot ua</strong>
   <a href="#46063" class="date">28-Sep-2004 06:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I think it help&nbsp; your.<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">dateLang </span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">strftime</span><span class="keyword">(</span><span class="string">"%A"</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">$xsl </span><span class="keyword">= new </span><span class="default">DomDocument</span><span class="keyword">();<br />
</span><span class="default">$xsl</span><span class="keyword">-&gt;</span><span class="default">load</span><span class="keyword">(</span><span class="string">"datetime.xsl"</span><span class="keyword">);<br />
</span><span class="default">$inputdom </span><span class="keyword">= new </span><span class="default">DomDocument</span><span class="keyword">();<br />
</span><span class="default">$inputdom</span><span class="keyword">-&gt;</span><span class="default">load</span><span class="keyword">(</span><span class="string">"today.xml"</span><span class="keyword">);<br />
<br />
</span><span class="default">$proc </span><span class="keyword">= new </span><span class="default">XsltProcessor</span><span class="keyword">();<br />
</span><span class="default">$proc</span><span class="keyword">-&gt;</span><span class="default">registerPhpFunctions</span><span class="keyword">();<br />
<br />
</span><span class="comment">// Load the documents and process using $xslt<br />
</span><span class="default">$xsl </span><span class="keyword">= </span><span class="default">$proc</span><span class="keyword">-&gt;</span><span class="default">importStylesheet</span><span class="keyword">(</span><span class="default">$xsl</span><span class="keyword">);<br />
<br />
</span><span class="comment">/* transform and output the xml document */<br />
</span><span class="default">$newdom </span><span class="keyword">= </span><span class="default">$proc</span><span class="keyword">-&gt;</span><span class="default">transformToDoc</span><span class="keyword">(</span><span class="default">$inputdom</span><span class="keyword">);<br />
<br />
print </span><span class="default">$newdom</span><span class="keyword">-&gt;</span><span class="default">saveXML</span><span class="keyword">();<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Here's the XSLT stylesheet, datetime.xsl, that will call that function:<br />
<br />
&lt;?xml version="1.0" encoding="iso-8859-1" ?&gt;<br />
&lt;xsl:stylesheet version="1.0" xmlns:xsl="<a href="http://www.w3.org/1999/XSL/Transform" rel="nofollow" target="_blank">http://www.w3.org/1999/XSL/Transform</a>" xmlns:php="<a href="http://php.net/xsl" rel="nofollow" target="_blank">http://php.net/xsl</a>"&gt;<br />
&lt;xsl:template match="/"&gt;<br />
&nbsp; &lt;xsl:value-of select="php:function('dateLang')" /&gt;<br />
&lt;/xsl:template&gt;<br />
&lt;/xsl:stylesheet&gt;<br />
<br />
And here's an absolute minimal XML file, today.xml, to pass through the stylesheet (although articles.xml would achieve the same result):<br />
<br />
&lt;?xml version="1.0" encoding="iso-8859-1" ?&gt;<br />
&lt;today&gt;&lt;/today&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="45136""></a>
  <div class="note">
   <strong class="user">zac at zacbowling dot com</strong>
   <a href="#45136" class="date">26-Aug-2004 09:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
One thing to note about this function. A lot of values need to be converted to a XSLT string using the "string()" function in XLS before you pass them to your functions, and when you return them make sure that if they are strings that you call the "strval()" in php before doing so. This saved me hours. <br />
<br />
Hope that helps.<br />
<br />
Zac Bowling</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
