<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>Set timeout period on a stream</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.stream-set-read-buffer.html">? stream_set_read_buffer</a></li>
      <li style="float: right;"><a href="function.stream-set-write-buffer.html">stream_set_write_buffer ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.stream.html">Stream 函数</a></li>
    <li>Set timeout period on a stream</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.stream-set-timeout" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">stream_set_timeout</h1>
  <p class="verinfo">(PHP 4 &gt;= 4.3.0, PHP 5)</p><p class="refpurpose"><span class="refname">stream_set_timeout</span> &mdash; <span class="dc-title">Set timeout period on a stream</span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.stream-set-timeout-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">bool</span> <span class="methodname"><strong>stream_set_timeout</strong></span>
    ( <span class="methodparam"><span class="type">resource</span> <code class="parameter">$stream</code></span>
   , <span class="methodparam"><span class="type">int</span> <code class="parameter">$seconds</code></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$microseconds</code><span class="initializer"> = 0</span></span>
  ] )</div>

  <p class="para rdfs-comment">
   Sets the timeout value on <code class="parameter">stream</code>,
   expressed in the sum of <code class="parameter">seconds</code> and
   <code class="parameter">microseconds</code>. 
  </p>
  <p class="para">
   When the stream times out, the &#039;timed_out&#039; key of the array returned by
   <span class="function"><a href="function.stream-get-meta-data.html" class="function">stream_get_meta_data()</a></span> is set to <strong><code>TRUE</code></strong>, although no
   error/warning is generated.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.stream-set-timeout-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">stream</code></dt>

     <dd>

      <p class="para">
       The target stream.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">seconds</code></dt>

     <dd>

      <p class="para">
       The seconds part of the timeout to be set.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">microseconds</code></dt>

     <dd>

      <p class="para">
       The microseconds part of the timeout to be set.
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.stream-set-timeout-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   成功时返回 <strong><code>TRUE</code></strong>， 或者在失败时返回 <strong><code>FALSE</code></strong>。
  </p>
 </div>

 
 <div class="refsect1 changelog" id="refsect1-function.stream-set-timeout-changelog">
  <h3 class="title">更新日志</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead>
      <tr>
       <th>版本</th>
       <th>说明</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
       <td>4.3.0</td>
       <td>
        As of PHP 4.3, this function can (potentially) work on any kind of
        stream.  In PHP 4.3, socket based streams are still the only kind
        supported in the PHP core, although streams from other extensions
        may support this function.
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.stream-set-timeout-examples">
  <h3 class="title">范例</h3>
  <p class="para">
   <div class="example" id="example-4052">
    <p><strong>Example #1 <span class="function"><strong>stream_set_timeout()</strong></span> example</strong></p>
     <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$fp&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">fsockopen</span><span style="color: #007700">(</span><span style="color: #DD0000">"www.example.com"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">80</span><span style="color: #007700">);<br />if&nbsp;(!</span><span style="color: #0000BB">$fp</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"Unable&nbsp;to&nbsp;open\n"</span><span style="color: #007700">;<br />}&nbsp;else&nbsp;{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">fwrite</span><span style="color: #007700">(</span><span style="color: #0000BB">$fp</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"GET&nbsp;/&nbsp;HTTP/1.0\r\n\r\n"</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">stream_set_timeout</span><span style="color: #007700">(</span><span style="color: #0000BB">$fp</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">2</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$res&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">fread</span><span style="color: #007700">(</span><span style="color: #0000BB">$fp</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">2000</span><span style="color: #007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$info&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">stream_get_meta_data</span><span style="color: #007700">(</span><span style="color: #0000BB">$fp</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">fclose</span><span style="color: #007700">(</span><span style="color: #0000BB">$fp</span><span style="color: #007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$info</span><span style="color: #007700">[</span><span style="color: #DD0000">'timed_out'</span><span style="color: #007700">])&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">'Connection&nbsp;timed&nbsp;out!'</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">$res</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>

 
 <div class="refsect1 notes" id="refsect1-function.stream-set-timeout-notes">
  <h3 class="title">注释</h3>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    This function doesn&#039;t work with advanced operations like
    <span class="function"><a href="function.stream-socket-recvfrom.html" class="function">stream_socket_recvfrom()</a></span>, use
    <span class="function"><a href="function.stream-select.html" class="function">stream_select()</a></span> with timeout parameter instead.
   </p>
  </p></blockquote>
  <p class="para">
   This function was previously called as
   <span class="function"><strong>set_socket_timeout()</strong></span> and later
   <span class="function"><a href="function.socket-set-timeout.html" class="function">socket_set_timeout()</a></span> but this usage is deprecated.
  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.stream-set-timeout-seealso">
  <h3 class="title">参见</h3>
  <ul class="simplelist">
   <li class="member"><span class="function"><a href="function.fsockopen.html" class="function" rel="rdfs-seeAlso">fsockopen()</a> - 打开一个网络连接或者一个Unix套接字连接</span></li>
   <li class="member"><span class="function"><a href="function.fopen.html" class="function" rel="rdfs-seeAlso">fopen()</a> - 打开文件或者 URL</span></li>
  </ul>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="115113""></a>
  <div class="note">
   <strong class="user">jack.whoami</strong>
   <a href="#115113" class="date">28-May-2014 05:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just in case someone stumbles into my situation... I was trying to get the microseconds part to work and it just wasn't working as expected.<br />
<br />
Assuming blocking mode is true and I use <br />
<br />
<span class="default">&lt;?php stream_set_timeout</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);</span><span class="default">?&gt;<br />
</span><br />
I get a 1s delay as expected. However when I do <br />
<br />
<span class="default">&lt;?php stream_set_timeout</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">500</span><span class="keyword">);</span><span class="default">?&gt;<br />
</span><br />
I expect a 500microsecond delay but I get no delays at all. However when i do this<br />
<br />
<span class="default">&lt;?php stream_set_timeout</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">500000</span><span class="keyword">);</span><span class="default">?&gt;<br />
</span><br />
I get a 500 microsecond delay which is what I was expecting</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="104024""></a>
  <div class="note">
   <strong class="user">emailfire at gmail dot com</strong>
   <a href="#104024" class="date">18-May-2011 10:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This function seems to have no effect when running as a CLI script, see <a href="http://bugs.php.net/bug.php?id=36030" rel="nofollow" target="_blank">http://bugs.php.net/bug.php?id=36030</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100676""></a>
  <div class="note">
   <strong class="user">hamishcool3 at yahoo dot co dot uk</strong>
   <a href="#100676" class="date">29-Oct-2010 06:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In case anyone is puzzled, stream_set_timeout DOES NOT work for sockets created with socket_create or socket_accept. Use socket_set_option instead.<br />
<br />
Instead of:<br />
<span class="default">&lt;?php<br />
stream_set_timeout</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">,</span><span class="default">$sec</span><span class="keyword">,</span><span class="default">$usec</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Use:<br />
<span class="default">&lt;?php<br />
socket_set_option</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">, </span><span class="default">SOL_SOCKET</span><span class="keyword">, </span><span class="default">SO_RCVTIMEO</span><span class="keyword">, array(</span><span class="string">'sec'</span><span class="keyword">=&gt;</span><span class="default">$sec</span><span class="keyword">, </span><span class="string">'usec'</span><span class="keyword">=&gt;</span><span class="default">$usec</span><span class="keyword">));<br />
</span><span class="default">socket_set_option</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">, </span><span class="default">SOL_SOCKET</span><span class="keyword">, </span><span class="default">SO_SNDTIMEO</span><span class="keyword">, array(</span><span class="string">'sec'</span><span class="keyword">=&gt;</span><span class="default">$sec</span><span class="keyword">, </span><span class="string">'usec'</span><span class="keyword">=&gt;</span><span class="default">$usec</span><span class="keyword">));<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="94865""></a>
  <div class="note">
   <strong class="user">mildly dull at terriblyclever dot com</strong>
   <a href="#94865" class="date">30-Nov-2009 02:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I didn't have much luck with the suggestions below (although I likely applied them wrong). 
<br />
Instead, I used stream_context_create() and set an http option for timeout. I fed that context into file_get_contents() and voila!
<br />

<br />
To my desperate friend below: the https transport can also use the http stream context options. I haven't verified this works as I don't have a slow responding ssl to test on. But if you are still stressing, give the below a shot (you may need to modify a bit...) 
<br />

<br />
<span class="default">&lt;?php
<br />
&nbsp;&nbsp;&nbsp; $timeout </span><span class="keyword">= </span><span class="default">5</span><span class="keyword">*</span><span class="default">60</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$options </span><span class="keyword">= array(
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'http'</span><span class="keyword">=&gt;array(
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'method'</span><span class="keyword">=&gt;</span><span class="string">"GET"</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'header'</span><span class="keyword">=&gt;</span><span class="string">"Accept-language: en\r\n"</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'timeout' </span><span class="keyword">=&gt; </span><span class="default">$timeout 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; );
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$context </span><span class="keyword">= </span><span class="default">stream_context_create</span><span class="keyword">(</span><span class="default">$options</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$contents </span><span class="keyword">= </span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">, </span><span class="default">$context</span><span class="keyword">);
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Yes...that is a 5 minute timeout.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73838""></a>
  <div class="note">
   <strong class="user">Martin Butt - martin at anti_spambutt.cx</strong>
   <a href="#73838" class="date">12-Mar-2007 06:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is a working example for loops:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="comment">// Timeout in seconds
<br />
</span><span class="default">$timeout </span><span class="keyword">= </span><span class="default">5</span><span class="keyword">;
<br />

<br />
</span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="string">"www.server.com"</span><span class="keyword">, </span><span class="default">80</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">$timeout</span><span class="keyword">);
<br />

<br />
if (</span><span class="default">$fp</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="string">"GET /file.php HTTP/1.0\r\n"</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="string">"Host: www.server.com\r\n"</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="string">"Connection: Close\r\n\r\n"</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">stream_set_blocking</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">TRUE</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">stream_set_timeout</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">,</span><span class="default">$timeout</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$info </span><span class="keyword">= </span><span class="default">stream_get_meta_data</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while ((!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">)) &amp;&amp; (!</span><span class="default">$info</span><span class="keyword">[</span><span class="string">'timed_out'</span><span class="keyword">])) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">.= </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">4096</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$info </span><span class="keyword">= </span><span class="default">stream_get_meta_data</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ob_flush</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">flush</span><span class="keyword">();
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$info</span><span class="keyword">[</span><span class="string">'timed_out'</span><span class="keyword">]) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Connection Timed Out!"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">$data</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71274""></a>
  <div class="note">
   <strong class="user">Dianoga (dianoga7 [at] 3dgo.net)</strong>
   <a href="#71274" class="date">20-Nov-2006 03:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I have found that in order to actually stop the socket from timing out the script, you must call stream_get_meta_data and check for a timeout within the loop reading from the socket.<br />
<br />
Example:<br />
<br />
<span class="default">&lt;?php<br />
$sock </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">, </span><span class="default">80</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">30</span><span class="keyword">);<br />
if(!</span><span class="default">$sock</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"Unable to get server status"</span><span class="keyword">;<br />
}else{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">= </span><span class="string">"GET /server.php HTTP/1.1\r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">.= </span><span class="string">"Host: </span><span class="default">$host</span><span class="string">\r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">.= </span><span class="string">"Connection: Close\r\n\r\n"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$sock</span><span class="keyword">, </span><span class="default">$out</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">stream_set_blocking</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">FALSE </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">stream_set_timeout</span><span class="keyword">(</span><span class="default">$sock</span><span class="keyword">, </span><span class="default">$timeout</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$info </span><span class="keyword">= </span><span class="default">stream_get_meta_data</span><span class="keyword">(</span><span class="default">$sock</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$sock</span><span class="keyword">) &amp;&amp; !</span><span class="default">$info</span><span class="keyword">[</span><span class="string">'timed_out'</span><span class="keyword">]) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$file </span><span class="keyword">.= </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$sock</span><span class="keyword">, </span><span class="default">4096</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$info </span><span class="keyword">= </span><span class="default">stream_get_meta_data</span><span class="keyword">(</span><span class="default">$sock</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$sock</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68543""></a>
  <div class="note">
   <strong class="user">alfi_ at yahoo dot com</strong>
   <a href="#68543" class="date">01-Aug-2006 05:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are using fsockopen() to create a connection, first going to write into the stream and then waiting for the reply (e.g. simulating HTTP request with some extra headers), then stream_set_timeout() must be set only after the write - if it is before write, it has no effect on the read timeout :-( <br />
Noticed at least on PHP/4.3.10</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="62334""></a>
  <div class="note">
   <strong class="user">rtfm61 at yandex dot ru</strong>
   <a href="#62334" class="date">25-Feb-2006 11:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
stream_set_timeout() is not suitable for such files as UNIX-devices (/dev/...), i suggest to use select() instead with desirable timeout value - that works well.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="50083""></a>
  <div class="note">
   <strong class="user">ridera</strong>
   <a href="#50083" class="date">17-Feb-2005 02:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I have found it required to add <br />
<br />
"stream_set_blocking($fp, FALSE )" <br />
<br />
prior to any fgets(), fread(), etc. to prevent the code from hanging up when remote files are called and the response is slow.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
