<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>对变量进行 JSON 编码</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.json-decode.html">? json_decode</a></li>
      <li style="float: right;"><a href="function.json-last-error-msg.html">json_last_error_msg ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.json.html">JSON 函数</a></li>
    <li>对变量进行 JSON 编码</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.json-encode" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">json_encode</h1>
  <p class="verinfo">(PHP 5 &gt;= 5.2.0, PECL json &gt;= 1.2.0, PHP 7)</p><p class="refpurpose"><span class="refname">json_encode</span> &mdash; <span class="dc-title">对变量进行 JSON 编码</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-function.json-encode-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">string</span> <span class="methodname"><strong>json_encode</strong></span>
    ( <span class="methodparam"><span class="type"><a href="language.pseudo-types.html#language.types.mixed" class="type mixed">mixed</a></span> <code class="parameter">$value</code></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$options</code><span class="initializer"> = 0</span></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$depth</code><span class="initializer"> = 512</span></span>
  ]] )</div>

  <p class="para rdfs-comment">
   返回 <code class="parameter">value</code> 值的 JSON 形式
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.json-encode-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">value</code></dt>

     <dd>

      <p class="para">
       待编码的 <code class="parameter">value</code> ，除了<span class="type"><a href="language.types.resource.html" class="type resource">resource</a></span>
       类型之外，可以为任何数据类型
      </p>
      <p class="para">
       该函数只能接受 UTF-8 编码的数据
      </p>
      
 <blockquote class="note"><p><strong class="note">Note</strong>: 
  <p class="para">
   PHP implements a superset of JSON as specified in the original
   <a href="http://www.faqs.org/rfcs/rfc4627" class="link external" title="Link : http://www.faqs.org/rfcs/rfc4627">&raquo;&nbsp;RFC 4627</a> - it will also encode and
   decode scalar types and <strong><code>NULL</code></strong>. RFC 4627 only supports these values when
   they are nested inside an array or an object.
  </p>
  <p class="para">
   Although this superset is consistent with the expanded definition of &quot;JSON
   text&quot; in the newer <a href="http://www.faqs.org/rfcs/rfc7159" class="link external" title="Link : http://www.faqs.org/rfcs/rfc7159">&raquo;&nbsp;RFC 7159</a> (which
   aims to supersede RFC 4627) and
   <a href="http://www.ecma-international.org/publications/files/ECMA-ST/ECMA-404.pdf" class="link external" title="Link : http://www.ecma-international.org/publications/files/ECMA-ST/ECMA-404.pdf">&raquo;&nbsp;ECMA-404</a>, this may cause
   interoperability issues with older JSON parsers that adhere strictly to RFC
   4627 when encoding a single scalar value.
  </p>
 </p></blockquote>

     </dd>

    
    
     <dt>
<code class="parameter">options</code></dt>

     <dd>

      <p class="para">
       由以下常量组成的二进制掩码： <strong><code>JSON_HEX_QUOT</code></strong>,
       <strong><code>JSON_HEX_TAG</code></strong>,
       <strong><code>JSON_HEX_AMP</code></strong>,
       <strong><code>JSON_HEX_APOS</code></strong>,
       <strong><code>JSON_NUMERIC_CHECK</code></strong>,
       <strong><code>JSON_PRETTY_PRINT</code></strong>,
       <strong><code>JSON_UNESCAPED_SLASHES</code></strong>,
       <strong><code>JSON_FORCE_OBJECT</code></strong>,
       <strong><code>JSON_PRESERVE_ZERO_FRACTION</code></strong>,
       <strong><code>JSON_UNESCAPED_UNICODE</code></strong>,
       <strong><code>JSON_PARTIAL_OUTPUT_ON_ERROR</code></strong>。
       关于 JSON 常量详情参考<a href="json.constants.html" class="link">JSON 常量</a>页面。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">depth</code></dt>

     <dd>

      <p class="para">
       设置最大深度。 必须大于0。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.json-encode-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   成功则返回 JSON 编码的 <span class="type"><a href="language.types.string.html" class="type string">string</a></span>  或者在失败时返回 <strong><code>FALSE</code></strong> 。
  </p>
 </div>



 <div class="refsect1 changelog" id="refsect1-function.json-encode-changelog">
  <h3 class="title">更新日志</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead>
      <tr>
       <th>版本</th>
       <th>说明</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
       <td>5.6.6</td>
       <td>
        <code class="parameter">options</code> 参数增加常量：
        <strong><code>JSON_PRESERVE_ZERO_FRACTION</code></strong>
       </td>
      </tr>

      <tr>
       <td>5.5.0</td>
       <td>
        增加 <code class="parameter">depth</code> 参数。
       </td>
      </tr>

      <tr>
       <td>5.4.0</td>
       <td>
        <code class="parameter">options</code> 参数增加常量：
        <strong><code>JSON_PRETTY_PRINT</code></strong>, <strong><code>JSON_UNESCAPED_SLASHES</code></strong>, 和 <strong><code>JSON_UNESCAPED_UNICODE</code></strong>。
       </td>
      </tr>

      <tr>
       <td>5.3.3</td>
       <td>
        <code class="parameter">options</code> 参数增加常量：<strong><code>JSON_NUMERIC_CHECK</code></strong>。
       </td>
      </tr>

      <tr>
       <td>5.3.0</td>
       <td>
        增加 <code class="parameter">options</code> 参数.
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>

 <div class="refsect1 examples" id="refsect1-function.json-encode-examples">
  <h3 class="title">范例</h3>
  <p class="para">
   <div class="example" id="example-4169">
    <p><strong>Example #1 <span class="function"><strong>json_encode()</strong></span> 例子</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$arr&nbsp;</span><span style="color: #007700">=&nbsp;array&nbsp;(</span><span style="color: #DD0000">'a'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">1</span><span style="color: #007700">,</span><span style="color: #DD0000">'b'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">2</span><span style="color: #007700">,</span><span style="color: #DD0000">'c'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">3</span><span style="color: #007700">,</span><span style="color: #DD0000">'d'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">4</span><span style="color: #007700">,</span><span style="color: #DD0000">'e'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">5</span><span style="color: #007700">);<br /><br />echo&nbsp;</span><span style="color: #0000BB">json_encode</span><span style="color: #007700">(</span><span style="color: #0000BB">$arr</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>以上例程会输出：</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
{&quot;a&quot;:1,&quot;b&quot;:2,&quot;c&quot;:3,&quot;d&quot;:4,&quot;e&quot;:5}
</pre></div>
    </div>
   </div>
   
   <div class="example" id="example-4170">
    <p><strong>Example #2  <span class="function"><strong>json_encode()</strong></span> 函数中 <code class="parameter">options</code> 参数的用法</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$a&nbsp;</span><span style="color: #007700">=&nbsp;array(</span><span style="color: #DD0000">'&lt;foo&gt;'</span><span style="color: #007700">,</span><span style="color: #DD0000">"'bar'"</span><span style="color: #007700">,</span><span style="color: #DD0000">'"baz"'</span><span style="color: #007700">,</span><span style="color: #DD0000">'&amp;blong&amp;'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"\xc3\xa9"</span><span style="color: #007700">);<br /><br />echo&nbsp;</span><span style="color: #DD0000">"Normal:&nbsp;"</span><span style="color: #007700">,&nbsp;&nbsp;</span><span style="color: #0000BB">json_encode</span><span style="color: #007700">(</span><span style="color: #0000BB">$a</span><span style="color: #007700">),&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br />echo&nbsp;</span><span style="color: #DD0000">"Tags:&nbsp;"</span><span style="color: #007700">,&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">json_encode</span><span style="color: #007700">(</span><span style="color: #0000BB">$a</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">JSON_HEX_TAG</span><span style="color: #007700">),&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br />echo&nbsp;</span><span style="color: #DD0000">"Apos:&nbsp;"</span><span style="color: #007700">,&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">json_encode</span><span style="color: #007700">(</span><span style="color: #0000BB">$a</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">JSON_HEX_APOS</span><span style="color: #007700">),&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br />echo&nbsp;</span><span style="color: #DD0000">"Quot:&nbsp;"</span><span style="color: #007700">,&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">json_encode</span><span style="color: #007700">(</span><span style="color: #0000BB">$a</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">JSON_HEX_QUOT</span><span style="color: #007700">),&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br />echo&nbsp;</span><span style="color: #DD0000">"Amp:&nbsp;"</span><span style="color: #007700">,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">json_encode</span><span style="color: #007700">(</span><span style="color: #0000BB">$a</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">JSON_HEX_AMP</span><span style="color: #007700">),&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br />echo&nbsp;</span><span style="color: #DD0000">"Unicode:&nbsp;"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">json_encode</span><span style="color: #007700">(</span><span style="color: #0000BB">$a</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">JSON_UNESCAPED_UNICODE</span><span style="color: #007700">),&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br />echo&nbsp;</span><span style="color: #DD0000">"All:&nbsp;"</span><span style="color: #007700">,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">json_encode</span><span style="color: #007700">(</span><span style="color: #0000BB">$a</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">JSON_HEX_TAG&nbsp;</span><span style="color: #007700">|&nbsp;</span><span style="color: #0000BB">JSON_HEX_APOS&nbsp;</span><span style="color: #007700">|&nbsp;</span><span style="color: #0000BB">JSON_HEX_QUOT&nbsp;</span><span style="color: #007700">|&nbsp;</span><span style="color: #0000BB">JSON_HEX_AMP&nbsp;</span><span style="color: #007700">|&nbsp;</span><span style="color: #0000BB">JSON_UNESCAPED_UNICODE</span><span style="color: #007700">),&nbsp;</span><span style="color: #DD0000">"\n\n"</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$b&nbsp;</span><span style="color: #007700">=&nbsp;array();<br /><br />echo&nbsp;</span><span style="color: #DD0000">"Empty&nbsp;array&nbsp;output&nbsp;as&nbsp;array:&nbsp;"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">json_encode</span><span style="color: #007700">(</span><span style="color: #0000BB">$b</span><span style="color: #007700">),&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br />echo&nbsp;</span><span style="color: #DD0000">"Empty&nbsp;array&nbsp;output&nbsp;as&nbsp;object:&nbsp;"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">json_encode</span><span style="color: #007700">(</span><span style="color: #0000BB">$b</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">JSON_FORCE_OBJECT</span><span style="color: #007700">),&nbsp;</span><span style="color: #DD0000">"\n\n"</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$c&nbsp;</span><span style="color: #007700">=&nbsp;array(array(</span><span style="color: #0000BB">1</span><span style="color: #007700">,</span><span style="color: #0000BB">2</span><span style="color: #007700">,</span><span style="color: #0000BB">3</span><span style="color: #007700">));<br /><br />echo&nbsp;</span><span style="color: #DD0000">"Non-associative&nbsp;array&nbsp;output&nbsp;as&nbsp;array:&nbsp;"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">json_encode</span><span style="color: #007700">(</span><span style="color: #0000BB">$c</span><span style="color: #007700">),&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br />echo&nbsp;</span><span style="color: #DD0000">"Non-associative&nbsp;array&nbsp;output&nbsp;as&nbsp;object:&nbsp;"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">json_encode</span><span style="color: #007700">(</span><span style="color: #0000BB">$c</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">JSON_FORCE_OBJECT</span><span style="color: #007700">),&nbsp;</span><span style="color: #DD0000">"\n\n"</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$d&nbsp;</span><span style="color: #007700">=&nbsp;array(</span><span style="color: #DD0000">'foo'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'bar'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'baz'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'long'</span><span style="color: #007700">);<br /><br />echo&nbsp;</span><span style="color: #DD0000">"Associative&nbsp;array&nbsp;always&nbsp;output&nbsp;as&nbsp;object:&nbsp;"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">json_encode</span><span style="color: #007700">(</span><span style="color: #0000BB">$d</span><span style="color: #007700">),&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br />echo&nbsp;</span><span style="color: #DD0000">"Associative&nbsp;array&nbsp;always&nbsp;output&nbsp;as&nbsp;object:&nbsp;"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">json_encode</span><span style="color: #007700">(</span><span style="color: #0000BB">$d</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">JSON_FORCE_OBJECT</span><span style="color: #007700">),&nbsp;</span><span style="color: #DD0000">"\n\n"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>以上例程会输出：</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
Normal: [&quot;&lt;foo&gt;&quot;,&quot;&#039;bar&#039;&quot;,&quot;\&quot;baz\&quot;&quot;,&quot;&amp;blong&amp;&quot;,&quot;\u00e9&quot;]
Tags: [&quot;\u003Cfoo\u003E&quot;,&quot;&#039;bar&#039;&quot;,&quot;\&quot;baz\&quot;&quot;,&quot;&amp;blong&amp;&quot;,&quot;\u00e9&quot;]
Apos: [&quot;&lt;foo&gt;&quot;,&quot;\u0027bar\u0027&quot;,&quot;\&quot;baz\&quot;&quot;,&quot;&amp;blong&amp;&quot;,&quot;\u00e9&quot;]
Quot: [&quot;&lt;foo&gt;&quot;,&quot;&#039;bar&#039;&quot;,&quot;\u0022baz\u0022&quot;,&quot;&amp;blong&amp;&quot;,&quot;\u00e9&quot;]
Amp: [&quot;&lt;foo&gt;&quot;,&quot;&#039;bar&#039;&quot;,&quot;\&quot;baz\&quot;&quot;,&quot;\u0026blong\u0026&quot;,&quot;\u00e9&quot;]
Unicode: [&quot;&lt;foo&gt;&quot;,&quot;&#039;bar&#039;&quot;,&quot;\&quot;baz\&quot;&quot;,&quot;&amp;blong&amp;&quot;,&quot;é&quot;]
All: [&quot;\u003Cfoo\u003E&quot;,&quot;\u0027bar\u0027&quot;,&quot;\u0022baz\u0022&quot;,&quot;\u0026blong\u0026&quot;,&quot;é&quot;]

Empty array output as array: []
Empty array output as object: {}

Non-associative array output as array: [[1,2,3]]
Non-associative array output as object: {&quot;0&quot;:{&quot;0&quot;:1,&quot;1&quot;:2,&quot;2&quot;:3}}

Associative array always output as object: {&quot;foo&quot;:&quot;bar&quot;,&quot;baz&quot;:&quot;long&quot;}
Associative array always output as object: {&quot;foo&quot;:&quot;bar&quot;,&quot;baz&quot;:&quot;long&quot;}
</pre></div>
    </div>
   </div>
   <div class="example" id="example-4171">
    <p><strong>Example #3 选项 JSON_NUMERIC_CHECK 例子</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #DD0000">"Strings&nbsp;representing&nbsp;numbers&nbsp;automatically&nbsp;turned&nbsp;into&nbsp;numbers"</span><span style="color: #007700">.</span><span style="color: #0000BB">PHP_EOL</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$numbers&nbsp;</span><span style="color: #007700">=&nbsp;array(</span><span style="color: #DD0000">'+123123'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'-123123'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'1.2e3'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'0.00001'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(<br />&nbsp;</span><span style="color: #0000BB">$numbers</span><span style="color: #007700">,<br />&nbsp;</span><span style="color: #0000BB">json_encode</span><span style="color: #007700">(</span><span style="color: #0000BB">$numbers</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">JSON_NUMERIC_CHECK</span><span style="color: #007700">)<br />);<br />echo&nbsp;</span><span style="color: #DD0000">"Strings&nbsp;containing&nbsp;improperly&nbsp;formatted&nbsp;numbers"</span><span style="color: #007700">.</span><span style="color: #0000BB">PHP_EOL</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$strings&nbsp;</span><span style="color: #007700">=&nbsp;array(</span><span style="color: #DD0000">'+a33123456789'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'a123'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(<br />&nbsp;</span><span style="color: #0000BB">$strings</span><span style="color: #007700">,<br />&nbsp;</span><span style="color: #0000BB">json_encode</span><span style="color: #007700">(</span><span style="color: #0000BB">$strings</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">JSON_NUMERIC_CHECK</span><span style="color: #007700">)<br />);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>以上例程会输出：</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
Strings representing numbers automatically turned into numbers
array(4) {
  [0]=&gt;
  string(7) &quot;+123123&quot;
  [1]=&gt;
  string(7) &quot;-123123&quot;
  [2]=&gt;
  string(5) &quot;1.2e3&quot;
  [3]=&gt;
  string(7) &quot;0.00001&quot;
}
string(28) &quot;[123123,-123123,1200,1.0e-5]&quot;
Strings containing improperly formatted numbers
array(2) {
  [0]=&gt;
  string(13) &quot;+a33123456789&quot;
  [1]=&gt;
  string(4) &quot;a123&quot;
}
string(24) &quot;[&quot;+a33123456789&quot;,&quot;a123&quot;]&quot;
</pre></div>
    </div>
   </div>
   <div class="example" id="example-4172">
    <p><strong>Example #4 连续与非连续数组示例</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #DD0000">"连续数组"</span><span style="color: #007700">.</span><span style="color: #0000BB">PHP_EOL</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$sequential&nbsp;</span><span style="color: #007700">=&nbsp;array(</span><span style="color: #DD0000">"foo"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"bar"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"baz"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"blong"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(<br />&nbsp;</span><span style="color: #0000BB">$sequential</span><span style="color: #007700">,<br />&nbsp;</span><span style="color: #0000BB">json_encode</span><span style="color: #007700">(</span><span style="color: #0000BB">$sequential</span><span style="color: #007700">)<br />);<br /><br />echo&nbsp;</span><span style="color: #0000BB">PHP_EOL</span><span style="color: #007700">.</span><span style="color: #DD0000">"非连续数组"</span><span style="color: #007700">.</span><span style="color: #0000BB">PHP_EOL</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$nonsequential&nbsp;</span><span style="color: #007700">=&nbsp;array(</span><span style="color: #0000BB">1</span><span style="color: #007700">=&gt;</span><span style="color: #DD0000">"foo"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">2</span><span style="color: #007700">=&gt;</span><span style="color: #DD0000">"bar"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">3</span><span style="color: #007700">=&gt;</span><span style="color: #DD0000">"baz"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">4</span><span style="color: #007700">=&gt;</span><span style="color: #DD0000">"blong"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(<br />&nbsp;</span><span style="color: #0000BB">$nonsequential</span><span style="color: #007700">,<br />&nbsp;</span><span style="color: #0000BB">json_encode</span><span style="color: #007700">(</span><span style="color: #0000BB">$nonsequential</span><span style="color: #007700">)<br />);<br /><br />echo&nbsp;</span><span style="color: #0000BB">PHP_EOL</span><span style="color: #007700">.</span><span style="color: #DD0000">"删除一个连续数组值的方式产生的非连续数组"</span><span style="color: #007700">.</span><span style="color: #0000BB">PHP_EOL</span><span style="color: #007700">;<br />unset(</span><span style="color: #0000BB">$sequential</span><span style="color: #007700">[</span><span style="color: #0000BB">1</span><span style="color: #007700">]);<br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(<br />&nbsp;</span><span style="color: #0000BB">$sequential</span><span style="color: #007700">,<br />&nbsp;</span><span style="color: #0000BB">json_encode</span><span style="color: #007700">(</span><span style="color: #0000BB">$sequential</span><span style="color: #007700">)<br />);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>以上例程会输出：</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
连续数组
array(4) {
  [0]=&gt;
  string(3) &quot;foo&quot;
  [1]=&gt;
  string(3) &quot;bar&quot;
  [2]=&gt;
  string(3) &quot;baz&quot;
  [3]=&gt;
  string(5) &quot;blong&quot;
}
string(27) &quot;[&quot;foo&quot;,&quot;bar&quot;,&quot;baz&quot;,&quot;blong&quot;]&quot;

非连续数组
array(4) {
  [1]=&gt;
  string(3) &quot;foo&quot;
  [2]=&gt;
  string(3) &quot;bar&quot;
  [3]=&gt;
  string(3) &quot;baz&quot;
  [4]=&gt;
  string(5) &quot;blong&quot;
}
string(43) &quot;{&quot;1&quot;:&quot;foo&quot;,&quot;2&quot;:&quot;bar&quot;,&quot;3&quot;:&quot;baz&quot;,&quot;4&quot;:&quot;blong&quot;}&quot;

删除一个连续数组值的方式产生的非连续数组
array(3) {
  [0]=&gt;
  string(3) &quot;foo&quot;
  [2]=&gt;
  string(3) &quot;baz&quot;
  [3]=&gt;
  string(5) &quot;blong&quot;
}
string(33) &quot;{&quot;0&quot;:&quot;foo&quot;,&quot;2&quot;:&quot;baz&quot;,&quot;3&quot;:&quot;blong&quot;}&quot;
</pre></div>
    </div>
   </div>
   <div class="example" id="example-4173">
    <p><strong>Example #5 <strong><code>选项 JSON_PRESERVE_ZERO_FRACTION</code></strong> 的例子</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">json_encode</span><span style="color: #007700">(</span><span style="color: #0000BB">12.0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">JSON_PRESERVE_ZERO_FRACTION</span><span style="color: #007700">));<br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">json_encode</span><span style="color: #007700">(</span><span style="color: #0000BB">12.0</span><span style="color: #007700">));<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>以上例程会输出：</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
string(4) &quot;12.0&quot;
string(2) &quot;12&quot;
</pre></div>
    </div>
   </div>
  </p>
 </div>



 <div class="refsect1 notes" id="refsect1-function.json-encode-notes">
  <h3 class="title">注释</h3>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    如果执行失败，可以通过 <span class="function"><a href="function.json-last-error.html" class="function">json_last_error()</a></span> 函数来获取详细错误信息。
   </p>
  </p></blockquote>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    如果要编码的数组的键不是从0开始的数字，所有的键将会被当作字符串，并明确声明为 key-value 对。
   </p>
  </p></blockquote>
  
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    Like the reference JSON encoder, <span class="function"><strong>json_encode()</strong></span> will
    generate JSON that is a simple value (that is, neither an object nor an
    array) if given a <span class="type"><a href="language.types.string.html" class="type string">string</a></span>, <span class="type"><a href="language.types.integer.html" class="type integer">integer</a></span>,
    <span class="type"><a href="language.types.float.html" class="type float">float</a></span> or <span class="type"><a href="language.types.boolean.html" class="type boolean">boolean</a></span> as an input
    <code class="parameter">value</code>. While most decoders will accept these values
    as valid JSON, some may not, as the specification is ambiguous on this
    point.
   </p>
   <p class="para">
    To summarise, always test that your JSON decoder can handle the output you
    generate from <span class="function"><strong>json_encode()</strong></span>.
   </p>
  </p></blockquote>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.json-encode-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="interfacename"><a href="class.jsonserializable.html" class="interfacename">JsonSerializable</a></span></li>
    <li class="member"><span class="function"><a href="function.json-decode.html" class="function" rel="rdfs-seeAlso">json_decode()</a> - 对 JSON 格式的字符串进行解码</span></li>
    <li class="member"><span class="function"><a href="function.json-last-error.html" class="function" rel="rdfs-seeAlso">json_last_error()</a> - 返回最后发生的错误</span></li>
    <li class="member"><span class="function"><a href="function.serialize.html" class="function" rel="rdfs-seeAlso">serialize()</a> - 产生一个可存储的值的表示</span></li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="118902""></a>
  <div class="note">
   <strong class="user">ravenswd at gmail dot com</strong>
   <a href="#118902" class="date">25-Feb-2016 10:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This isn't mentioned in the documentation for either PHP or jQuery, but if you're passing JSON data to a javascript program, make sure your program begins with:<br />
<br />
<span class="default">&lt;?php<br />
header</span><span class="keyword">(</span><span class="string">'Content-Type: application/json'</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="118569""></a>
  <div class="note">
   <strong class="user">rdeeceria</strong>
   <a href="#118569" class="date">30-Dec-2015 12:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
reading json pretty of my code. i have simple code for easy read array, object, path, etc<br />
json pretty print with str_replace ( \r \n \t ) and preg_replace ( \ ).<br />
<br />
function jsonDump ($a,$die = true) <br />
{<br />
$json = str_replace(array("\\r","\\n","\\t"), "",json_encode($a,JSON_PRETTY_PRINT));<br />
<br />
$json = preg_replace('#(?&lt;!\\\\)(\\$|\\\\)#', "", $json);<br />
<br />
echo'&lt;pre&gt;';<br />
print_r($json);<br />
echo'&lt;/pre&gt;&lt;hr&gt;';<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
if($die) die();<br />
}<br />
<br />
//input<br />
<br />
$infoPath = array (<br />
'method' =&gt; $_SERVER['REQUEST_METHOD'],<br />
'status' =&gt; $status,<br />
'dirbatch' =&gt; $dirbatch,<br />
'pathData' =&gt; $path_data //array<br />
);&nbsp; &nbsp; <br />
<br />
//output<br />
{<br />
&nbsp;&nbsp;&nbsp; "method": "GET",<br />
&nbsp;&nbsp;&nbsp; "status": "ins_tarif",<br />
&nbsp;&nbsp;&nbsp; "dirbatch": "C:\xampp\htdocs\simrs\services",<br />
&nbsp;&nbsp;&nbsp; "pathData": [<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; "E:\Brankas\Project\RSIA\SIMRS\dump\DOKTER.csv",<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; "E:\Brankas\Project\RSIA\SIMRS\dump\GOLPAS.csv",<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; "E:\Brankas\Project\RSIA\SIMRS\dump\PANGKAT.csv",<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; "E:\Brankas\Project\RSIA\SIMRS\dump\PEMAKAI.csv"<br />
&nbsp;&nbsp;&nbsp; ]<br />
}<br />
<br />
Hope it works well for you&nbsp; :)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="118334""></a>
  <div class="note">
   <strong class="user">Walter Tross</strong>
   <a href="#118334" class="date">19-Nov-2015 07:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you need pretty-printed output, but want it indented by 2 spaces instead of 4:<br />
<br />
$json_indented_by_4 = json_encode($output, JSON_UNESCAPED_SLASHES|JSON_PRETTY_PRINT);<br />
$json_indented_by_2 = preg_replace('/^(&nbsp; +?)\\1(?=[^ ])/m', '$1', $json_indented_by_4);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="117615""></a>
  <div class="note">
   <strong class="user">Dormilich</strong>
   <a href="#117615" class="date">09-Jul-2015 02:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When using the JsonSerializable interface be aware that throwing any exception from within the jsonSerialize() method will be suppressed and an exception saying "Failed calling YourClass::jsonSerialize()" will be thrown instead.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="117023""></a>
  <div class="note">
   <strong class="user">Goran</strong>
   <a href="#117023" class="date">03-Apr-2015 04:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This function has weird behavior regarding error reporting in PHP version 5.4 or lower. This kind of warning is raised only if you configure PHP with "display_errors=Off" (!?): "PHP Warning:&nbsp; json_encode(): Invalid UTF-8 sequence in argument ..."<br />
<br />
You can reproduce this behavior:<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// Warning not displayed, not logged<br />
</span><span class="default">ini_set</span><span class="keyword">(</span><span class="string">'display_errors'</span><span class="keyword">, </span><span class="string">'1'</span><span class="keyword">);<br />
</span><span class="default">json_encode</span><span class="keyword">(</span><span class="default">urldecode</span><span class="keyword">(</span><span class="string">'bad utf string %C4_'</span><span class="keyword">));<br />
<br />
</span><span class="comment">// Warning not displayed but logged<br />
</span><span class="default">ini_set</span><span class="keyword">(</span><span class="string">'display_errors'</span><span class="keyword">, </span><span class="string">'0'</span><span class="keyword">);<br />
</span><span class="default">json_encode</span><span class="keyword">(</span><span class="default">urldecode</span><span class="keyword">(</span><span class="string">'bad utf string %C4_'</span><span class="keyword">));<br />
</span><span class="default">?&gt;<br />
</span><br />
This is considered feature - not-a-bug - by PHP devs:<br />
https://bugs.php.net/bug.php?id=52397<br />
https://bugs.php.net/bug.php?id=63004</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="116775""></a>
  <div class="note">
   <strong class="user">bibilkattathara15 at gmail dot com</strong>
   <a href="#116775" class="date">26-Feb-2015 06:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The json_encode() does'nt gave you correct json I have written a&nbsp; code that can give a valid json<br />
//DatabaseConnectionClass.php<br />
abstract class DatabaseConnectionClass {<br />
&nbsp;&nbsp;&nbsp; protected&nbsp; $link;<br />
<br />
&nbsp;&nbsp;&nbsp; protected&nbsp; function&nbsp; __construct()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; $this-&gt;link=mysqli_connect('localhost','root','','realestate')&nbsp; or die('Unable to connect to database');<br />
<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
}<br />
//JSON.php<br />
include 'DatabaseConnectionClass.php';<br />
<br />
class JSON extends DatabaseConnectionClass<br />
{<br />
&nbsp;&nbsp;&nbsp; private $recordCount;<br />
&nbsp;&nbsp;&nbsp; function __construct()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // Used for&nbsp; Connecting to Database<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; parent::__construct();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;recordCount=0;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; private function jsonFileWriter($buffer_string,$mode)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // This function is to write data onto a file.<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $jsonFile=fopen("data.json",$mode);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; fwrite($jsonFile, $buffer_string);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; fclose($jsonFile);<br />
<br />
&nbsp;&nbsp;&nbsp; }&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; public function generateJSON()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; /* Used to generate data for Angular JS JSON File*/<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; /*Refer ExportJson.class in phpMyAdmin*/<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $res=$this-&gt;link-&gt;query('SELECT `id`,`district`,`taluk`,`category`,`type`,`description`,`amount` FROM `tbl_info` WHERE 1');<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while ($row=$res-&gt;fetch_assoc()) <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;recordCount=$this-&gt;recordCount+1;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if($this-&gt;recordCount==1)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $buffer='[';<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;jsonFileWriter($buffer,'w');<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $buffer = ', ';<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;jsonFileWriter($buffer,'a');<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $json=json_encode($row, JSON_PRETTY_PRINT, 512);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;jsonFileWriter($json,'a');<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $buffer = '] ';<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;jsonFileWriter($buffer,'a'); <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="115733""></a>
  <div class="note">
   <strong class="user">ninjSPAM at informanceSPAM dot info</strong>
   <a href="#115733" class="date">15-Sep-2014 06:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Although this is not documented on the version log here, non-UTF8 handling behaviour has changed in 5.5, in a way that can make debugging difficult.<br />
<br />
Passing a non UTF-8 string to json_encode() will make the function return false in PHP 5.5, while it will only nullify this string (and only this one) in previous versions.<br />
<br />
In a Latin-1 encoded file, write this:<br />
<span class="default">&lt;?php<br />
$a </span><span class="keyword">= array(</span><span class="string">'é'</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">json_encode</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">));<br />
</span><span class="default">?&gt;<br />
</span><br />
PHP &lt; 5.4:<br />
string(8) "[null,1]"<br />
<br />
PHP &gt;= 5.5:<br />
bool(false)<br />
<br />
PHP 5.5 has it right of course (if encoding fails, return false) but its likely to introduce errors when updating to 5.5 because previously you could get the rest of the JSON even when one string was not in UTF8 (if this string wasn't used, you'd never notify it's nulled)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="115655""></a>
  <div class="note">
   <strong class="user">Ray.Paseur often uses Gmail</strong>
   <a href="#115655" class="date">03-Sep-2014 03:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you're wondering whether a JSON string can be an analog of an XML document, the answer is probably "nope."&nbsp; XML supports attributes, but JSON does not.&nbsp; A JSON string generated by json_encode(), when called on a SimpleXML object, will not have the attributes and no error or exception will issue - the original data will simply be lost.&nbsp; To see this in action:<br />
<span class="default">&lt;?php <br />
error_reporting</span><span class="keyword">(</span><span class="default">E_ALL</span><span class="keyword">);<br />
echo </span><span class="string">'&lt;pre&gt;'</span><span class="keyword">;<br />
<br />
</span><span class="comment">// STARTING FROM XML<br />
</span><span class="default">$xml </span><span class="keyword">= &lt;&lt;&lt;EOD<br />
</span><span class="string">&lt;?xml version="1.0" ?&gt;<br />
&lt;ingredients&gt;<br />
&nbsp; &lt;ingredient&gt;<br />
&nbsp;&nbsp; &nbsp; &lt;name&gt;tomatoes&lt;/name&gt;<br />
&nbsp;&nbsp; &nbsp; &lt;quantity type="cup"&gt;4&lt;/quantity&gt;<br />
&nbsp; &lt;/ingredient&gt;<br />
&nbsp; &lt;ingredient&gt;<br />
&nbsp;&nbsp; &nbsp; &lt;name&gt;salt&lt;/name&gt;<br />
&nbsp;&nbsp; &nbsp; &lt;quantity type="tablespoon"&gt;2&lt;/quantity&gt;<br />
&nbsp; &lt;/ingredient&gt;<br />
&lt;/ingredients&gt;<br />
</span><span class="keyword">EOD;<br />
<br />
</span><span class="comment">// CREATES AN ARRAY OF SimpleXMLElement OBJECTS<br />
</span><span class="default">$obj </span><span class="keyword">= </span><span class="default">SimpleXML_Load_String</span><span class="keyword">(</span><span class="default">$xml</span><span class="keyword">);<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$obj</span><span class="keyword">);<br />
echo </span><span class="default">PHP_EOL</span><span class="keyword">;<br />
<br />
</span><span class="comment">// SHOW THE ATTRIBUTES HIDDEN IN THE SimpleXMLElement OBJECTS<br />
</span><span class="keyword">foreach (</span><span class="default">$obj </span><span class="keyword">as </span><span class="default">$sub</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">PHP_EOL </span><span class="keyword">. (string)</span><span class="default">$sub</span><span class="keyword">-&gt;</span><span class="default">quantity </span><span class="keyword">. </span><span class="string">' ' </span><span class="keyword">. (string)</span><span class="default">$sub</span><span class="keyword">-&gt;</span><span class="default">quantity</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">];<br />
}<br />
echo </span><span class="default">PHP_EOL</span><span class="keyword">;<br />
<br />
</span><span class="comment">// USING THE OBJECT, CREATE A JSON STRING<br />
</span><span class="default">$jso </span><span class="keyword">= </span><span class="default">json_encode</span><span class="keyword">(</span><span class="default">$obj</span><span class="keyword">);<br />
echo </span><span class="default">htmlentities</span><span class="keyword">(</span><span class="default">$jso</span><span class="keyword">); </span><span class="comment">// 'type' IS LOST<br />
</span><span class="keyword">echo </span><span class="default">PHP_EOL</span><span class="keyword">;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="114468""></a>
  <div class="note">
   <strong class="user">guillaume dot jonville at gmail dot com</strong>
   <a href="#114468" class="date">24-Feb-2014 04:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It's my __json_encode function to encode in JSON format array or string with javascript function <br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">__json_encode</span><span class="keyword">(</span><span class="default">$mVar</span><span class="keyword">,</span><span class="default">$fnCallback</span><span class="keyword">=</span><span class="string">"stripcslashes"</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">preg_replace_callback</span><span class="keyword">(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'#"[ ]{0,}function[ ]{0,}\([^)$]{0,}\)[ ]{0,}\{[ ]{0,}(?(?![ ]{0,}}[ ]{0,}").){0,}[ ]{0,}\}[ ]{0,}"([(?,")|(?\}{0,}$)]{0,})#si'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; function (</span><span class="default">$aRes</span><span class="keyword">) use (</span><span class="default">$fnCallback</span><span class="keyword">) { <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for(</span><span class="default">$aRes</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]=</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$aRes</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">],</span><span class="default">1</span><span class="keyword">),</span><span class="default">$sOut</span><span class="keyword">=</span><span class="string">""</span><span class="keyword">,</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">,</span><span class="default">$iOpen</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">,</span><span class="default">$iClose</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$aRes</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]) &amp;&amp; </span><span class="default">$sOut</span><span class="keyword">.= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$aRes</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">],</span><span class="default">$i</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">);</span><span class="default">$i</span><span class="keyword">++) <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$aRes</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">],</span><span class="default">$i</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">) == </span><span class="string">"{"</span><span class="keyword">) </span><span class="default">$iOpen</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else if (</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$aRes</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">],</span><span class="default">$i</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">) == </span><span class="string">"}" </span><span class="keyword">AND </span><span class="default">$iOpen </span><span class="keyword">== ++</span><span class="default">$iClose</span><span class="keyword">) break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">is_callable</span><span class="keyword">(</span><span class="default">$fnCallback</span><span class="keyword">) ? </span><span class="default">$fnCallback</span><span class="keyword">(</span><span class="default">$sOut</span><span class="keyword">).</span><span class="default">$aRes</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] : </span><span class="default">$fnCallback</span><span class="keyword">(</span><span class="default">$sOut</span><span class="keyword">).</span><span class="default">$aRes</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; },<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">json_encode</span><span class="keyword">(</span><span class="default">$mVar</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; );<br />
}<br />
&nbsp;&nbsp;&nbsp; <br />
<br />
</span><span class="default">$aData </span><span class="keyword">= array( <br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'key1' </span><span class="keyword">=&gt; </span><span class="string">'value1'</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'key2' </span><span class="keyword">=&gt; </span><span class="string">'function(){ return $("&lt;INPUT /&gt;").attr("type","text"); }'</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'key3' </span><span class="keyword">=&gt; array(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'key3.1'</span><span class="keyword">=&gt;</span><span class="string">'val3.1'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'key3.2'</span><span class="keyword">=&gt;</span><span class="string">'function(someArg) { if (someArg == "someValue") return true; else { document.write("error"); return false; } }'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; ),<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'key4' </span><span class="keyword">=&gt; </span><span class="string">'function(){ return true; }'<br />
</span><span class="keyword">);<br />
<br />
</span><span class="default">$sData </span><span class="keyword">= </span><span class="string">'function(someArg) { if (someArg == "someValue") return true; else { document.write("error"); return false; } }'</span><span class="keyword">;<br />
<br />
echo&nbsp; </span><span class="string">'Output for json_encode() : '</span><span class="keyword">.</span><span class="default">json_encode</span><span class="keyword">(</span><span class="default">$aData</span><span class="keyword">).</span><span class="string">"\n\n"</span><span class="keyword">;<br />
echo&nbsp; </span><span class="string">'Output for __json_encode() : '</span><span class="keyword">.</span><span class="default">__json_encode</span><span class="keyword">(</span><span class="default">$aData</span><span class="keyword">).</span><span class="string">"\n\n"</span><span class="keyword">;<br />
<br />
echo&nbsp; </span><span class="string">'Output for json_encode($sData) : '</span><span class="keyword">.</span><span class="default">json_encode</span><span class="keyword">(</span><span class="default">$sData</span><span class="keyword">).</span><span class="string">"\n\n"</span><span class="keyword">;<br />
echo&nbsp; </span><span class="string">'Output for __json_encode($sData) : '</span><span class="keyword">.</span><span class="default">__json_encode</span><span class="keyword">(</span><span class="default">$sData</span><span class="keyword">).</span><span class="string">"\n\n"</span><span class="keyword">;<br />
<br />
</span><span class="comment">/*<br />
&nbsp;* <br />
&nbsp;* Output for json_encode() : {"key1":"value1","key2":"function(){ return $(\"&lt;INPUT \/&gt;\").attr(\"type\",\"text\"); }","key3":{"key3.1":"val3.1","key3.2":"function(someArg) { if (someArg == \"someValue\") return true; else { document.write(\"error\"); return false; } }"},"key4":"function(){ return true; }"}<br />
&nbsp;* <br />
&nbsp;* Output for __json_encode() : {"key1":"value1","key2":function(){ return $("&lt;INPUT /&gt;").attr("type","text"); },"key3":{"key3.1":"val3.1","key3.2":function(someArg) { if (someArg == "someValue") return true; else { document.write("error"); return false; } }},"key4":function(){ return true; }}<br />
&nbsp;* <br />
&nbsp;* <br />
&nbsp;* Output for json_encode($sData) : "function(someArg) { if (someArg == \"someValue\") return true; else { document.write(\"error\"); return false; } }"<br />
&nbsp;* <br />
&nbsp;* Output for __json_encode($sData) : function(someArg) { if (someArg == "someValue") return true; else { document.write("error"); return false; } }<br />
&nbsp;* <br />
&nbsp;*/</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="113618""></a>
  <div class="note">
   <strong class="user">info at pkrules dot in</strong>
   <a href="#113618" class="date">06-Nov-2013 10:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Notice the last json_decode does not working :) ,you need to use a variable to use the encoded data in json_decode():- <br />
<span class="default">&lt;?php<br />
$arr</span><span class="keyword">=array(</span><span class="string">'a'</span><span class="keyword">=&gt;</span><span class="default">1</span><span class="keyword">,</span><span class="string">'b'</span><span class="keyword">=&gt;</span><span class="default">2</span><span class="keyword">,</span><span class="string">'c'</span><span class="keyword">=&gt;</span><span class="default">3</span><span class="keyword">,</span><span class="string">'d'</span><span class="keyword">=&gt;</span><span class="default">4</span><span class="keyword">,</span><span class="string">'e'</span><span class="keyword">=&gt;</span><span class="default">5</span><span class="keyword">);<br />
<br />
echo </span><span class="default">json_encode</span><span class="keyword">(</span><span class="default">$arr</span><span class="keyword">).</span><span class="string">"&lt;br /&gt;"</span><span class="keyword">;<br />
</span><span class="comment">//{"a":1,"b":2,"c":3,"d":4,"e":5}<br />
<br />
</span><span class="default">print_r </span><span class="keyword">(</span><span class="default">json_decode</span><span class="keyword">(</span><span class="default">json_encode</span><span class="keyword">(</span><span class="default">$arr</span><span class="keyword">)));<br />
</span><span class="comment">//stdClass Object ( [a] =&gt; 1 [b] =&gt; 2 [c] =&gt; 3 [d] =&gt; 4 [e] =&gt; 5 )<br />
</span><span class="keyword">echo </span><span class="string">"&lt;br /&gt;"</span><span class="keyword">;<br />
</span><span class="default">$var</span><span class="keyword">=</span><span class="default">json_encode</span><span class="keyword">(</span><span class="default">$arr</span><span class="keyword">);<br />
</span><span class="default">print_r </span><span class="keyword">(</span><span class="default">json_decode</span><span class="keyword">(</span><span class="default">$var</span><span class="keyword">,</span><span class="default">true</span><span class="keyword">));<br />
</span><span class="comment">//Array ( [a] =&gt; 1 [b] =&gt; 2 [c] =&gt; 3 [d] =&gt; 4 [e] =&gt; 5 ) <br />
</span><span class="keyword">echo </span><span class="string">"&lt;br /&gt;"</span><span class="keyword">;<br />
</span><span class="default">print_r </span><span class="keyword">(</span><span class="default">json_decode</span><span class="keyword">(</span><span class="default">json_encode</span><span class="keyword">(</span><span class="default">$arr</span><span class="keyword">)),</span><span class="default">true</span><span class="keyword">);</span><span class="comment">//no output<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="113495""></a>
  <div class="note">
   <strong class="user">drdamour</strong>
   <a href="#113495" class="date">19-Oct-2013 08:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
note that although PHP bundles JSON, some linux distributions do not do to a licensing conflict.&nbsp; As such you may need to install json support yourself.<br />
<br />
IE: on Ubuntu 13.10 Saucy Salamander apt-get install php5-json re-enables json support (json_encode and json_decode)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="113416""></a>
  <div class="note">
   <strong class="user">zac at javazac dot com</strong>
   <a href="#113416" class="date">09-Oct-2013 01:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There is a gotcha that keeps getting me with JSON_NUMERIC_CHECK. At first it seems like the greatest thing in the world if you are encoding data pulled from a db because it turns numeric strings into seemingly appropriate ints or floats. Use with caution. I've been surprised a number of times by "numbers" that really are strings ie really precise lat/long coords.&nbsp; json_encode with the JSON_NUMERIC_CHECK will encode these as floats but the precision of the data is so large that php actually rounds the number off. In this case I had to rework my code so that it didn't use JSON_NUMERIC_CHECK and I manually cast fields as ints or floats as appropriate and skipped my lat/long fields so that they stayed numeric strings.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="113219""></a>
  <div class="note">
   <strong class="user">eep2004 at ukr dot net</strong>
   <a href="#113219" class="date">14-Sep-2013 02:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">// alternative json_encode<br />
</span><span class="keyword">function </span><span class="default">_json_encode</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">is_string</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">)) return </span><span class="string">'"'</span><span class="keyword">.</span><span class="default">addslashes</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">).</span><span class="string">'"'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">is_numeric</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">)) return </span><span class="default">$val</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$val </span><span class="keyword">=== </span><span class="default">null</span><span class="keyword">) return </span><span class="string">'null'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$val </span><span class="keyword">=== </span><span class="default">true</span><span class="keyword">) return </span><span class="string">'true'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$val </span><span class="keyword">=== </span><span class="default">false</span><span class="keyword">) return </span><span class="string">'false'</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$assoc </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$val </span><span class="keyword">as </span><span class="default">$k</span><span class="keyword">=&gt;</span><span class="default">$v</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$k </span><span class="keyword">!== </span><span class="default">$i</span><span class="keyword">++){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$assoc </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$res </span><span class="keyword">= array();<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$val </span><span class="keyword">as </span><span class="default">$k</span><span class="keyword">=&gt;</span><span class="default">$v</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$v </span><span class="keyword">= </span><span class="default">_json_encode</span><span class="keyword">(</span><span class="default">$v</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$assoc</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$k </span><span class="keyword">= </span><span class="string">'"'</span><span class="keyword">.</span><span class="default">addslashes</span><span class="keyword">(</span><span class="default">$k</span><span class="keyword">).</span><span class="string">'"'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$v </span><span class="keyword">= </span><span class="default">$k</span><span class="keyword">.</span><span class="string">':'</span><span class="keyword">.</span><span class="default">$v</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$res</span><span class="keyword">[] = </span><span class="default">$v</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$res </span><span class="keyword">= </span><span class="default">implode</span><span class="keyword">(</span><span class="string">','</span><span class="keyword">, </span><span class="default">$res</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return (</span><span class="default">$assoc</span><span class="keyword">)? </span><span class="string">'{'</span><span class="keyword">.</span><span class="default">$res</span><span class="keyword">.</span><span class="string">'}' </span><span class="keyword">: </span><span class="string">'['</span><span class="keyword">.</span><span class="default">$res</span><span class="keyword">.</span><span class="string">']'</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Example:<br />
Array<br />
(<br />
&nbsp;&nbsp;&nbsp; [0] =&gt; 7<br />
&nbsp;&nbsp;&nbsp; [1] =&gt; false<br />
&nbsp;&nbsp;&nbsp; [2] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ['a'] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [0] =&gt; 1<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [1] =&gt; 2<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [3] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [1] =&gt; true<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [2] =&gt; 6<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [0] =&gt; 4<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [4] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [0] =&gt; 'b'<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [1] =&gt; null<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
)<br />
Result: [7,false,{"a":{"0":1,"1":2,"3":{"1":true,"2":6,"0":4},"4":["b",null]}}]<br />
<br />
This function is more accurate and faster than, for example, that one:<br />
<a href="http://www.php.net/manual/ru/function.json-encode.php#89908" rel="nofollow" target="_blank">http://www.php.net/manual/ru/function.json-encode.php#89908</a><br />
(RU: эта функция работает более точно и быстрее, чем указанная выше).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="113037""></a>
  <div class="note">
   <strong class="user">kvz at php dot net</strong>
   <a href="#113037" class="date">21-Aug-2013 06:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
json_encode "only works with UTF-8 encoded data." so if there is any chance that users influence the variable you're about to encode to json, you should first recursively encode to UTF-8.<br />
<br />
There are several comments doing that, but some only traverse the input array 1 level deep. Others write full fledged recursive functions themselves. Whereas as of PHP5 you could also utilize array_walk_recursive<br />
<br />
<span class="default">&lt;?php<br />
array_walk_recursive</span><span class="keyword">(</span><span class="default">$inputArray</span><span class="keyword">, function(&amp;</span><span class="default">$val</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$val </span><span class="keyword">= </span><span class="default">utf8_encode</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">);<br />
});<br />
</span><span class="default">json_encode</span><span class="keyword">(</span><span class="default">$inputArray</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Hope this helps</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="112644""></a>
  <div class="note">
   <strong class="user">CertaiN</strong>
   <a href="#112644" class="date">09-Jul-2013 12:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
<br />
$fp </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="string">'php://stdin'</span><span class="keyword">, </span><span class="string">'r'</span><span class="keyword">);<br />
</span><span class="default">$json </span><span class="keyword">= @</span><span class="default">json_encode</span><span class="keyword">(array(</span><span class="string">'a' </span><span class="keyword">=&gt; </span><span class="string">'foo'</span><span class="keyword">, </span><span class="string">'b' </span><span class="keyword">=&gt; </span><span class="default">$fp</span><span class="keyword">));<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$json</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
[PHP5.5 or after]<br />
bool(false)<br />
<br />
[PHP 5.4 or before]<br />
string(20) "{"a":"foo","b":null}"</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="112020""></a>
  <div class="note">
   <strong class="user">guilhenfsu at gmail dot com</strong>
   <a href="#112020" class="date">23-Apr-2013 05:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Solution for UTF-8 Special Chars.<br />
<br />
&lt;?<br />
<br />
$array = array('nome'=&gt;'Pai??o','cidade'=&gt;'S?o Paulo');<br />
<br />
$array = array_map('htmlentities',$array);<br />
<br />
//encode<br />
$json = html_entity_decode(json_encode($array));<br />
<br />
//Output: {"nome":"Pai??o","cidade":"S?o Paulo"}<br />
echo $json;<br />
<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="111788""></a>
  <div class="note">
   <strong class="user">ck at ergovia dot de</strong>
   <a href="#111788" class="date">28-Mar-2013 08:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Attention when passing a plain array to json_encode and using JSON_FORCE_OBJECT. It figured out that the index-order of the resulting JSON-string depends on the system PHP is running on.<br />
<br />
$a = array("a" , "b", "c");<br />
echo json_encode($a, JSON_FORCE_OBJECT);<br />
<br />
On Xampp (Windows) you get:<br />
<br />
{"0":"a","1":"b","2":"c"}';<br />
<br />
On a machine running debian I get:<br />
<br />
{"2":"a","1":"b","0":"c"}';<br />
<br />
Note that the key:value pairs are different!<br />
<br />
Solution here was to use array_combine to create a ssociative array and then pass it to json_encode:<br />
<br />
json_encode(array_combine(range(0, count($a) - 1), $a), JSON_FORCE_OBJECT);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="107968""></a>
  <div class="note">
   <strong class="user">craig at craigfrancis dot co dot uk</strong>
   <a href="#107968" class="date">19-Mar-2012 12:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If your on a version of PHP before 5.2, this might help:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">if (!</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">'json_encode'</span><span class="keyword">)) {<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">json_encode</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; switch (</span><span class="default">$type </span><span class="keyword">= </span><span class="default">gettype</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'NULL'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">'null'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'boolean'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return (</span><span class="default">$data </span><span class="keyword">? </span><span class="string">'true' </span><span class="keyword">: </span><span class="string">'false'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'integer'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'double'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'float'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$data</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'string'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">'"' </span><span class="keyword">. </span><span class="default">addslashes</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">) . </span><span class="string">'"'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'object'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">get_object_vars</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'array'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$output_index_count </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$output_indexed </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$output_associative </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$data </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$output_indexed</span><span class="keyword">[] = </span><span class="default">json_encode</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$output_associative</span><span class="keyword">[] = </span><span class="default">json_encode</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">) . </span><span class="string">':' </span><span class="keyword">. </span><span class="default">json_encode</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$output_index_count </span><span class="keyword">!== </span><span class="default">NULL </span><span class="keyword">&amp;&amp; </span><span class="default">$output_index_count</span><span class="keyword">++ !== </span><span class="default">$key</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$output_index_count </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$output_index_count </span><span class="keyword">!== </span><span class="default">NULL</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">'[' </span><span class="keyword">. </span><span class="default">implode</span><span class="keyword">(</span><span class="string">','</span><span class="keyword">, </span><span class="default">$output_indexed</span><span class="keyword">) . </span><span class="string">']'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">'{' </span><span class="keyword">. </span><span class="default">implode</span><span class="keyword">(</span><span class="string">','</span><span class="keyword">, </span><span class="default">$output_associative</span><span class="keyword">) . </span><span class="string">'}'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; default:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">''</span><span class="keyword">; </span><span class="comment">// Not supported<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">}<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="107616""></a>
  <div class="note">
   <strong class="user">webmaster_php at colnect dot com</strong>
   <a href="#107616" class="date">22-Feb-2012 12:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
WARNING! Do not pass associative arrays if the order is important to you. It seems that while FireFox does keep the same order, both Chrome and IE sort it. Here's a little workaround:
<br />

<br />
<span class="default">&lt;?php
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $arWrapper </span><span class="keyword">= array();&nbsp; &nbsp; &nbsp; &nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$arWrapper</span><span class="keyword">[</span><span class="string">'k'</span><span class="keyword">] = </span><span class="default">array_keys</span><span class="keyword">(</span><span class="default">$arChoices</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$arWrapper</span><span class="keyword">[</span><span class="string">'v'</span><span class="keyword">] = </span><span class="default">array_values</span><span class="keyword">(</span><span class="default">$arChoices</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$json </span><span class="keyword">= </span><span class="default">json_encode</span><span class="keyword">(</span><span class="default">$arWrapper</span><span class="keyword">);
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="107369""></a>
  <div class="note">
   <strong class="user">pahreg at inbox dot ru</strong>
   <a href="#107369" class="date">04-Feb-2012 07:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Simple replacement for JSON_UNESCAPED_UNICODE (PHP &lt; 5.4 for example)<br />
&nbsp;<br />
Can be buggy, but works for simple UTF-8 strings.<br />
<br />
<span class="default">&lt;?php<br />
$json </span><span class="keyword">= </span><span class="default">preg_replace_callback</span><span class="keyword">(</span><span class="string">'/\\\u(\w\w\w\w)/'</span><span class="keyword">, <br />
&nbsp;&nbsp;&nbsp; function(</span><span class="default">$matches</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">'&amp;#'</span><span class="keyword">.</span><span class="default">hexdec</span><span class="keyword">(</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]).</span><span class="string">';'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; , </span><span class="default">json_encode</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">));<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="107250""></a>
  <div class="note">
   <strong class="user">julien dot dev at gmail dot com</strong>
   <a href="#107250" class="date">25-Jan-2012 03:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Guys, (and girls)
<br />

<br />
A trick to unescape UTF8 for ppl with php &lt; 5.4.0
<br />

<br />
json_encode(...) gives you \\u..... right ?
<br />

<br />
json_decode DOES unescape though !
<br />

<br />
so:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="comment">/* Imagine you have an object like this :
<br />
[{"name":"php help héhéhahéhé","url":"<a href="http://payAttention.example.com" rel="nofollow" target="_blank">http://payAttention.example.com</a>"},{"name":"took me brainack j'étais mal mec","url":"<a href="http://slashesEscapingSux" rel="nofollow" target="_blank">http://slashesEscapingSux</a>"}]
<br />
*/
<br />

<br />
//first encode your object
<br />
</span><span class="default">$myDirtyString </span><span class="keyword">= </span><span class="default">$json_encode</span><span class="keyword">(</span><span class="default">$myObject</span><span class="keyword">);
<br />

<br />
</span><span class="comment">/*the JSON_UNESCAPED_SLASHES, and JSON_UNESCAPED_UNICODE being unavailable, you'll have some ugly escaping happening :
<br />

<br />
[{"name":"php help h\\u00e9h\\u00e9hah\\u00e9h\\u00e9","url":"http:\\/\\/payAttention.example.com"},{"name":"took me brainack j'\\u00e9tais mal mec","url":"http:\\/\\/slashesEscapingSux\\/"}]
<br />
*/
<br />

<br />
//So, you'll have to unescape slashes:
<br />
</span><span class="default">$myDirtyString </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"\\/"</span><span class="keyword">,</span><span class="string">"/"</span><span class="keyword">,</span><span class="default">$myDirtyString</span><span class="keyword">);
<br />

<br />
</span><span class="comment">//Then, for the trick, escape doule quotes
<br />
</span><span class="default">$myDirtyString </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'"'</span><span class="keyword">,</span><span class="string">'\\\\"'</span><span class="keyword">,</span><span class="default">$myDirtyString</span><span class="keyword">);
<br />

<br />
</span><span class="comment">//in oder to json_decode this trciked string (and get your utf8 unescaped)
<br />

<br />
</span><span class="default">$myCleanedString </span><span class="keyword">= </span><span class="default">json_decode</span><span class="keyword">(</span><span class="string">'"'</span><span class="keyword">.</span><span class="default">$myDirtyString</span><span class="keyword">.</span><span class="string">'"'</span><span class="keyword">);
<br />

<br />
</span><span class="comment">// Je tour est joué !
<br />
// There might be better ways to do it but i found so much useless nonsense on forums that i decided to go with it for tonight
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="106641""></a>
  <div class="note">
   <strong class="user">bohwaz</strong>
   <a href="#106641" class="date">24-Nov-2011 02:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Are you sure you want to use JSON_NUMERIC_CHECK, really really sure?<br />
<br />
Just watch this usecase:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// International phone number<br />
</span><span class="default">json_encode</span><span class="keyword">(array(</span><span class="string">'phone_number' </span><span class="keyword">=&gt; </span><span class="string">'+33123456789'</span><span class="keyword">), </span><span class="default">JSON_NUMERIC_CHECK</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
And then you get this JSON:<br />
<br />
{"phone_number":33123456789}<br />
<br />
Maybe it makes sense for PHP (as is_numeric('+33123456789') returns true), but really, casting it as an int?!<br />
<br />
So be careful when using JSON_NUMERIC_CHECK, it may mess up with your data!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="106547""></a>
  <div class="note">
   <strong class="user">me</strong>
   <a href="#106547" class="date">17-Nov-2011 08:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
::fast utf8-encoding of strings::<br />
<br />
json_encode( array_map( function($t){ return is_string($t) ? utf8_encode($t) : $t; }, $array ) )</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="106445""></a>
  <div class="note">
   <strong class="user">spm at bf-team dot com</strong>
   <a href="#106445" class="date">09-Nov-2011 08:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
json and utf8?<br />
<br />
Fast Easy Method:)<br />
<br />
Encode: json_encode(array_map('base64_encode', $array));<br />
<br />
Decode: array_map('base64_decode', json_decode($array);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="106417""></a>
  <div class="note">
   <strong class="user">mmi at uhb-consulting dot de</strong>
   <a href="#106417" class="date">08-Nov-2011 04:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When you have trouble with json_encode and German umlauts. json_encode converts Strings to NULL when detecting umlauts not being UTF8encoded.
<br />

<br />
Here's another recursive UTF8 conversion function and vice-versa. The object handling might be buggy but works for me.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">array_utf8_encode_recursive</span><span class="keyword">(</span><span class="default">$dat</span><span class="keyword">) 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; { if (</span><span class="default">is_string</span><span class="keyword">(</span><span class="default">$dat</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">utf8_encode</span><span class="keyword">(</span><span class="default">$dat</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_object</span><span class="keyword">(</span><span class="default">$dat</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ovs</span><span class="keyword">= </span><span class="default">get_object_vars</span><span class="keyword">(</span><span class="default">$dat</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new</span><span class="keyword">=</span><span class="default">$dat</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$ovs </span><span class="keyword">as </span><span class="default">$k </span><span class="keyword">=&gt;</span><span class="default">$v</span><span class="keyword">)&nbsp; &nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new</span><span class="keyword">-&gt;</span><span class="default">$k</span><span class="keyword">=</span><span class="default">array_utf8_encode_recursive</span><span class="keyword">(</span><span class="default">$new</span><span class="keyword">-&gt;</span><span class="default">$k</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$new</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$dat</span><span class="keyword">)) return </span><span class="default">$dat</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ret </span><span class="keyword">= array();
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$dat </span><span class="keyword">as </span><span class="default">$i</span><span class="keyword">=&gt;</span><span class="default">$d</span><span class="keyword">) </span><span class="default">$ret</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] = </span><span class="default">array_utf8_encode_recursive</span><span class="keyword">(</span><span class="default">$d</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$ret</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
function </span><span class="default">array_utf8_decode_recursive</span><span class="keyword">(</span><span class="default">$dat</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; { if (</span><span class="default">is_string</span><span class="keyword">(</span><span class="default">$dat</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">utf8_decode</span><span class="keyword">(</span><span class="default">$dat</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_object</span><span class="keyword">(</span><span class="default">$dat</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ovs</span><span class="keyword">= </span><span class="default">get_object_vars</span><span class="keyword">(</span><span class="default">$dat</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new</span><span class="keyword">=</span><span class="default">$dat</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$ovs </span><span class="keyword">as </span><span class="default">$k </span><span class="keyword">=&gt;</span><span class="default">$v</span><span class="keyword">)&nbsp; &nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new</span><span class="keyword">-&gt;</span><span class="default">$k</span><span class="keyword">=</span><span class="default">array_utf8_decode_recursive</span><span class="keyword">(</span><span class="default">$new</span><span class="keyword">-&gt;</span><span class="default">$k</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$new</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$dat</span><span class="keyword">)) return </span><span class="default">$dat</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ret </span><span class="keyword">= array();
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$dat </span><span class="keyword">as </span><span class="default">$i</span><span class="keyword">=&gt;</span><span class="default">$d</span><span class="keyword">) </span><span class="default">$ret</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] = </span><span class="default">array_utf8_decode_recursive</span><span class="keyword">(</span><span class="default">$d</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$ret</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="105923""></a>
  <div class="note">
   <strong class="user">rob at weeverapps dot com</strong>
   <a href="#105923" class="date">26-Sep-2011 06:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If, for some reason you need to force a single object to be an array, you can use array_values() -- this can be necessary if you have an array with only one entry, as json_encode will assign it as an object otherwise :
<br />

<br />
<span class="default">&lt;?php
<br />
$object</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] = array(</span><span class="string">"foo" </span><span class="keyword">=&gt; </span><span class="string">"bar"</span><span class="keyword">, </span><span class="default">12 </span><span class="keyword">=&gt; </span><span class="default">true</span><span class="keyword">);
<br />

<br />
</span><span class="default">$encoded_object </span><span class="keyword">= </span><span class="default">json_encode</span><span class="keyword">(</span><span class="default">$object</span><span class="keyword">);
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
output:
<br />

<br />
{"1": {"foo": "bar", "12": "true"}}
<br />

<br />
<span class="default">&lt;?php $encoded </span><span class="keyword">= </span><span class="default">json_encode</span><span class="keyword">(</span><span class="default">array_values</span><span class="keyword">(</span><span class="default">$object</span><span class="keyword">)); </span><span class="default">?&gt;
<br />
</span>
<br />
output:
<br />

<br />
[{"foo": "bar", "12": "true"}]</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="105789""></a>
  <div class="note">
   <strong class="user">devilan (REMOVEIT) (at) o2 (dot) pl</strong>
   <a href="#105789" class="date">15-Sep-2011 09:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For PHP5.3 users who want to emulate JSON_UNESCAPED_UNICODE, there is simple way to do it:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">my_json_encode</span><span class="keyword">(</span><span class="default">$arr</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//convmap since 0x80 char codes so it takes all multibyte codes (above ASCII 127). So such characters are being "hidden" from normal json_encoding<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">array_walk_recursive</span><span class="keyword">(</span><span class="default">$arr</span><span class="keyword">, function (&amp;</span><span class="default">$item</span><span class="keyword">, </span><span class="default">$key</span><span class="keyword">) { if (</span><span class="default">is_string</span><span class="keyword">(</span><span class="default">$item</span><span class="keyword">)) </span><span class="default">$item </span><span class="keyword">= </span><span class="default">mb_encode_numericentity</span><span class="keyword">(</span><span class="default">$item</span><span class="keyword">, array (</span><span class="default">0x80</span><span class="keyword">, </span><span class="default">0xffff</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0xffff</span><span class="keyword">), </span><span class="string">'UTF-8'</span><span class="keyword">); });<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">mb_decode_numericentity</span><span class="keyword">(</span><span class="default">json_encode</span><span class="keyword">(</span><span class="default">$arr</span><span class="keyword">), array (</span><span class="default">0x80</span><span class="keyword">, </span><span class="default">0xffff</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0xffff</span><span class="keyword">), </span><span class="string">'UTF-8'</span><span class="keyword">);<br />
<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="105683""></a>
  <div class="note">
   <strong class="user">grkworld1 at yahoo dot co dot in</strong>
   <a href="#105683" class="date">07-Sep-2011 11:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
copy the php tagged code in a page <br />
this is use full for multy dimention array<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">arr_2_str</span><span class="keyword">(</span><span class="default">$arr</span><span class="keyword">,</span><span class="default">$counter</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">,</span><span class="default">$str</span><span class="keyword">=</span><span class="string">""</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; foreach( </span><span class="default">$arr </span><span class="keyword">as </span><span class="default">$key</span><span class="keyword">=&gt;</span><span class="default">$value</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$str</span><span class="keyword">.= </span><span class="default">$key</span><span class="keyword">.</span><span class="string">"=</span><span class="default">$counter</span><span class="string">&gt;"</span><span class="keyword">.</span><span class="default">arr_2_str</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">,(</span><span class="default">$counter</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">)).</span><span class="string">"="</span><span class="keyword">.</span><span class="default">$counter</span><span class="keyword">.</span><span class="string">"&gt;~Y~|"</span><span class="keyword">.</span><span class="default">$counter</span><span class="keyword">.</span><span class="string">"|"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$str</span><span class="keyword">.=</span><span class="default">$key</span><span class="keyword">.</span><span class="string">"=</span><span class="default">$counter</span><span class="string">&gt;"</span><span class="keyword">.</span><span class="default">$value</span><span class="keyword">.</span><span class="string">"|</span><span class="default">$counter</span><span class="string">|"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">rtrim</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">,</span><span class="string">"|</span><span class="default">$counter</span><span class="string">|"</span><span class="keyword">);<br />
}<br />
<br />
function </span><span class="default">str_2_arr</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">,</span><span class="default">$counter</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">,</span><span class="default">$arr</span><span class="keyword">=array(),</span><span class="default">$temparr</span><span class="keyword">=array())<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$temparr</span><span class="keyword">=</span><span class="default">explode</span><span class="keyword">(</span><span class="string">"|</span><span class="default">$counter</span><span class="string">|"</span><span class="keyword">,</span><span class="default">$str</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; foreach( </span><span class="default">$temparr </span><span class="keyword">as </span><span class="default">$key</span><span class="keyword">=&gt;</span><span class="default">$value</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$t1</span><span class="keyword">=</span><span class="default">explode</span><span class="keyword">(</span><span class="string">"=</span><span class="default">$counter</span><span class="string">&gt;"</span><span class="keyword">,</span><span class="default">$value</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$kk</span><span class="keyword">=</span><span class="default">$t1</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$vv</span><span class="keyword">=</span><span class="default">$t1</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$t1</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]==</span><span class="string">"~Y~"</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$arr</span><span class="keyword">[</span><span class="default">$kk</span><span class="keyword">]=</span><span class="default">str_2_arr</span><span class="keyword">(</span><span class="default">$vv</span><span class="keyword">,(</span><span class="default">$counter</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$arr</span><span class="keyword">[</span><span class="default">$kk</span><span class="keyword">]=</span><span class="default">$vv</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$arr</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">$arr</span><span class="keyword">=array();<br />
<br />
</span><span class="default">$arr</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]=</span><span class="string">"a"</span><span class="keyword">;<br />
</span><span class="default">$arr</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">][</span><span class="default">1</span><span class="keyword">]=</span><span class="string">"b"</span><span class="keyword">;<br />
</span><span class="default">$arr</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">][</span><span class="default">2</span><span class="keyword">]=</span><span class="string">"c"</span><span class="keyword">;<br />
</span><span class="default">$arr</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">][</span><span class="default">3</span><span class="keyword">][</span><span class="default">1</span><span class="keyword">]=</span><span class="string">"d"</span><span class="keyword">;<br />
</span><span class="default">$arr</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">][</span><span class="default">3</span><span class="keyword">][</span><span class="default">2</span><span class="keyword">][</span><span class="default">1</span><span class="keyword">]=</span><span class="string">"e1"</span><span class="keyword">;<br />
</span><span class="default">$arr</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">][</span><span class="default">3</span><span class="keyword">][</span><span class="default">2</span><span class="keyword">][</span><span class="default">2</span><span class="keyword">]=</span><span class="string">"e2"</span><span class="keyword">;<br />
</span><span class="default">$arr</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">][</span><span class="default">3</span><span class="keyword">][</span><span class="default">3</span><span class="keyword">]=</span><span class="string">"f"</span><span class="keyword">;<br />
print </span><span class="string">"&lt;pre&gt;"</span><span class="keyword">;<br />
<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$arr</span><span class="keyword">);<br />
<br />
print </span><span class="string">"&lt;br&gt;&lt;br&gt;&lt;br&gt;"</span><span class="keyword">;<br />
<br />
print </span><span class="default">$ssttrr</span><span class="keyword">=</span><span class="default">arr_2_str</span><span class="keyword">(</span><span class="default">$arr</span><span class="keyword">);<br />
<br />
print </span><span class="string">"&lt;br&gt;&lt;br&gt;&lt;br&gt;"</span><span class="keyword">;<br />
<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">str_2_arr</span><span class="keyword">(</span><span class="default">$ssttrr</span><span class="keyword">));<br />
<br />
</span><span class="comment">/*print "&lt;br&gt;&lt;br&gt;&lt;br&gt;";<br />
print "use of json";<br />
print "&lt;br&gt;&lt;br&gt;&lt;br&gt;";<br />
print $sstr=json_encode($arr);<br />
print "&lt;br&gt;&lt;br&gt;&lt;br&gt;";<br />
print_r(json_decode($sstr));*/<br />
<br />
</span><span class="keyword">print </span><span class="string">"&lt;/pre&gt;"</span><span class="keyword">;<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="105386""></a>
  <div class="note">
   <strong class="user">Tibor Halter</strong>
   <a href="#105386" class="date">14-Aug-2011 02:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
json_encode($binary) problem: it results in an empty string "" without error.<br />
<br />
You will see this happening when encoding binary images, for example.<br />
<br />
Use utf8_encode first.<br />
<br />
<span class="default">&lt;?php<br />
<br />
&nbsp;&nbsp;&nbsp; $data </span><span class="keyword">= </span><span class="string">'éáíú?óü??íó'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$json </span><span class="keyword">= </span><span class="default">json_encode</span><span class="keyword">( </span><span class="default">utf8_encode</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">) );<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// [..]<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">utf8_decode</span><span class="keyword">( </span><span class="default">json_decode</span><span class="keyword">(</span><span class="default">$json</span><span class="keyword">) );<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="104784""></a>
  <div class="note">
   <strong class="user">Rijk van Wel</strong>
   <a href="#104784" class="date">07-Jul-2011 11:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The JSON_NUMERIC_CHECK flag introduced in 5.3.0 comes in very handy when handling numbers encapsulated in a string (database results and post requests are always encoded as string types, for example). Sending over variables from a database result directly (as string) would cause the json_encode() function to quote them, which in turn would make the Javascript store them as strings. As Javascript isn't loosely typed, some libraries could break on this, when attempting to use one of those variables as row id in a data store for instance. Using the aforementioned flag can prevent this from happening.<br />
<br />
<span class="default">&lt;?php<br />
$arr </span><span class="keyword">= array( </span><span class="string">'row_id' </span><span class="keyword">=&gt; </span><span class="string">'1'</span><span class="keyword">, </span><span class="string">'name' </span><span class="keyword">=&gt; </span><span class="string">'George' </span><span class="keyword">); </span><span class="comment">// fictional db result<br />
</span><span class="keyword">echo </span><span class="default">json_encode</span><span class="keyword">( </span><span class="default">$arr</span><span class="keyword">, </span><span class="default">JSON_NUMERIC_CHECK </span><span class="keyword">); </span><span class="comment">// {"row_id":1,"name":"George"}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="104278""></a>
  <div class="note">
   <strong class="user">Mr Swordsteel</strong>
   <a href="#104278" class="date">05-Jun-2011 04:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
So i like to use ISO-8859-1 and a lot of ?????? and not that much for UTF-8 but i need some json stuff so this is what I'm trying to use this lite thing i made...
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">my_json_encode</span><span class="keyword">(</span><span class="default">$in</span><span class="keyword">) {
<br />
&nbsp; </span><span class="default">$_escape </span><span class="keyword">= function (</span><span class="default">$str</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">addcslashes</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">, </span><span class="string">"\v\t\n\r\f\"\\/"</span><span class="keyword">);
<br />
&nbsp; };
<br />
&nbsp; </span><span class="default">$out </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;
<br />
&nbsp; if (</span><span class="default">is_object</span><span class="keyword">(</span><span class="default">$in</span><span class="keyword">)) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$class_vars </span><span class="keyword">= </span><span class="default">get_object_vars</span><span class="keyword">((</span><span class="default">$in</span><span class="keyword">));
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$arr </span><span class="keyword">= array();
<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$class_vars </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$val</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$arr</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">] = </span><span class="string">"\"</span><span class="keyword">{</span><span class="default">$_escape</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">)}</span><span class="string">\":\"</span><span class="keyword">{</span><span class="default">$val</span><span class="keyword">}</span><span class="string">\""</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$val </span><span class="keyword">= </span><span class="default">implode</span><span class="keyword">(</span><span class="string">','</span><span class="keyword">, </span><span class="default">$arr</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">.= </span><span class="string">"{</span><span class="keyword">{</span><span class="default">$val</span><span class="keyword">}</span><span class="string">}"</span><span class="keyword">;
<br />
&nbsp; }elseif (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$in</span><span class="keyword">)) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$obj </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$arr </span><span class="keyword">= array();
<br />
&nbsp;&nbsp;&nbsp; foreach(</span><span class="default">$in </span><span class="keyword">AS </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$val</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp;&nbsp; if(!</span><span class="default">is_numeric</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$obj </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$arr</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">] = </span><span class="default">my_json_encode</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$obj</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$arr </span><span class="keyword">AS </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$val</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$arr</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">] = </span><span class="string">"\"</span><span class="keyword">{</span><span class="default">$_escape</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">)}</span><span class="string">\":</span><span class="keyword">{</span><span class="default">$val</span><span class="keyword">}</span><span class="string">"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$val </span><span class="keyword">= </span><span class="default">implode</span><span class="keyword">(</span><span class="string">','</span><span class="keyword">, </span><span class="default">$arr</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">.= </span><span class="string">"{</span><span class="keyword">{</span><span class="default">$val</span><span class="keyword">}</span><span class="string">}"</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }else {
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$val </span><span class="keyword">= </span><span class="default">implode</span><span class="keyword">(</span><span class="string">','</span><span class="keyword">, </span><span class="default">$arr</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">.= </span><span class="string">"[</span><span class="keyword">{</span><span class="default">$val</span><span class="keyword">}</span><span class="string">]"</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp; }elseif (</span><span class="default">is_bool</span><span class="keyword">(</span><span class="default">$in</span><span class="keyword">)) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">.= </span><span class="default">$in </span><span class="keyword">? </span><span class="string">'true' </span><span class="keyword">: </span><span class="string">'false'</span><span class="keyword">;
<br />
&nbsp; }elseif (</span><span class="default">is_null</span><span class="keyword">(</span><span class="default">$in</span><span class="keyword">)) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">.= </span><span class="string">'null'</span><span class="keyword">;
<br />
&nbsp; }elseif (</span><span class="default">is_string</span><span class="keyword">(</span><span class="default">$in</span><span class="keyword">)) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">.= </span><span class="string">"\"</span><span class="keyword">{</span><span class="default">$_escape</span><span class="keyword">(</span><span class="default">$in</span><span class="keyword">)}</span><span class="string">\""</span><span class="keyword">;
<br />
&nbsp; }else {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">.= </span><span class="default">$in</span><span class="keyword">;
<br />
&nbsp; }
<br />
&nbsp; return </span><span class="string">"</span><span class="keyword">{</span><span class="default">$out</span><span class="keyword">}</span><span class="string">"</span><span class="keyword">;
<br />
}
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
have fun make money off it or what you like with you code... this is for everyone...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="103137""></a>
  <div class="note">
   <strong class="user">pvl dot kolensikov at gmail dot com</strong>
   <a href="#103137" class="date">28-Mar-2011 05:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As json_encode() is recursive, you can use it to serialize whole structure of objects.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">class </span><span class="default">A </span><span class="keyword">{
<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$a </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$b </span><span class="keyword">= </span><span class="default">2</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$collection </span><span class="keyword">= array();
<br />

<br />
&nbsp;&nbsp;&nbsp; function&nbsp; </span><span class="default">__construct</span><span class="keyword">(){
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for ( </span><span class="default">$i</span><span class="keyword">=</span><span class="default">3</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">--&gt;</span><span class="default">0</span><span class="keyword">;){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">array_push</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">collection</span><span class="keyword">, new </span><span class="default">B</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />
}
<br />

<br />
class </span><span class="default">B </span><span class="keyword">{
<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$a </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$b </span><span class="keyword">= </span><span class="default">2</span><span class="keyword">;
<br />
}
<br />

<br />
echo </span><span class="default">json_encode</span><span class="keyword">(new </span><span class="default">A</span><span class="keyword">);
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Will give:
<br />

<br />
{
<br />
&nbsp;&nbsp;&nbsp; "a":1,
<br />
&nbsp;&nbsp;&nbsp; "b":2,
<br />
&nbsp;&nbsp;&nbsp; "collection":[{
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; "a":1,
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; "b":2
<br />
&nbsp;&nbsp;&nbsp; },{
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; "a":1,
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; "b":2
<br />
&nbsp;&nbsp;&nbsp; },{
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; "a":1,
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; "b":2
<br />
&nbsp;&nbsp;&nbsp; }]
<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102628""></a>
  <div class="note">
   <strong class="user">Mathias Leppich</strong>
   <a href="#102628" class="date">25-Feb-2011 07:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you need a json_encode / json_decode which is array/object/assoc-array you might want to use: <a href="http://gist.github.com/820694" rel="nofollow" target="_blank">http://gist.github.com/820694</a><br />
<br />
<span class="default">&lt;?php<br />
$dataIn </span><span class="keyword">= (object)array(<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"assoc" </span><span class="keyword">=&gt; array(</span><span class="string">"cow"</span><span class="keyword">=&gt;</span><span class="string">"moo"</span><span class="keyword">),<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"object" </span><span class="keyword">=&gt; (object)array(</span><span class="string">"cat"</span><span class="keyword">=&gt;</span><span class="string">"miao"</span><span class="keyword">),<br />
);<br />
</span><span class="comment">/*<br />
== IN<br />
object(stdClass)#2 (2) {<br />
&nbsp; ["assoc"]=&gt;<br />
&nbsp; array(1) {<br />
&nbsp;&nbsp;&nbsp; ["cow"]=&gt;<br />
&nbsp;&nbsp;&nbsp; string(3) "moo"<br />
&nbsp; }<br />
&nbsp; ["object"]=&gt;<br />
&nbsp; object(stdClass)#1 (1) {<br />
&nbsp;&nbsp;&nbsp; ["cat"]=&gt;<br />
&nbsp;&nbsp;&nbsp; string(4) "miao"<br />
&nbsp; }<br />
}<br />
<br />
== JSON<br />
{"assoc":{"_PHP_ASSOC":{"cow":"moo"}},"object":{"cat":"miao"}}<br />
<br />
== OUT<br />
object(stdClass)#4 (2) {<br />
&nbsp; ["assoc"]=&gt;<br />
&nbsp; array(1) {<br />
&nbsp;&nbsp;&nbsp; ["cow"]=&gt;<br />
&nbsp;&nbsp;&nbsp; string(3) "moo"<br />
&nbsp; }<br />
&nbsp; ["object"]=&gt;<br />
&nbsp; object(stdClass)#7 (1) {<br />
&nbsp;&nbsp;&nbsp; ["cat"]=&gt;<br />
&nbsp;&nbsp;&nbsp; string(4) "miao"<br />
&nbsp; }<br />
}<br />
*/<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102091""></a>
  <div class="note">
   <strong class="user">bohwaz</strong>
   <a href="#102091" class="date">26-Jan-2011 11:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is intended to be a simple readable json encode function for PHP 5.3+ (and licensed under GNU/AGPLv3 or GPLv3 like you prefer):<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">json_readable_encode</span><span class="keyword">(</span><span class="default">$in</span><span class="keyword">, </span><span class="default">$indent </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">, </span><span class="default">$from_array </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$_myself </span><span class="keyword">= </span><span class="default">__FUNCTION__</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$_escape </span><span class="keyword">= function (</span><span class="default">$str</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"!([\b\t\n\r\f\"\\'])!"</span><span class="keyword">, </span><span class="string">"\\\\\\1"</span><span class="keyword">, </span><span class="default">$str</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; };<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$in </span><span class="keyword">as </span><span class="default">$key</span><span class="keyword">=&gt;</span><span class="default">$value</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">.= </span><span class="default">str_repeat</span><span class="keyword">(</span><span class="string">"\t"</span><span class="keyword">, </span><span class="default">$indent </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">.= </span><span class="string">"\""</span><span class="keyword">.</span><span class="default">$_escape</span><span class="keyword">((string)</span><span class="default">$key</span><span class="keyword">).</span><span class="string">"\": "</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_object</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">) || </span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">.= </span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">.= </span><span class="default">$_myself</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">, </span><span class="default">$indent </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; elseif (</span><span class="default">is_bool</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">.= </span><span class="default">$value </span><span class="keyword">? </span><span class="string">'true' </span><span class="keyword">: </span><span class="string">'false'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; elseif (</span><span class="default">is_null</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">.= </span><span class="string">'null'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; elseif (</span><span class="default">is_string</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">.= </span><span class="string">"\"" </span><span class="keyword">. </span><span class="default">$_escape</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">) .</span><span class="string">"\""</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">.= </span><span class="default">$value</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">.= </span><span class="string">",\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; if (!empty(</span><span class="default">$out</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$out</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, -</span><span class="default">2</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">= </span><span class="default">str_repeat</span><span class="keyword">(</span><span class="string">"\t"</span><span class="keyword">, </span><span class="default">$indent</span><span class="keyword">) . </span><span class="string">"{\n" </span><span class="keyword">. </span><span class="default">$out</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">.= </span><span class="string">"\n" </span><span class="keyword">. </span><span class="default">str_repeat</span><span class="keyword">(</span><span class="string">"\t"</span><span class="keyword">, </span><span class="default">$indent</span><span class="keyword">) . </span><span class="string">"}"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$out</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="101843""></a>
  <div class="note">
   <strong class="user">dan at elearnapp dot com</strong>
   <a href="#101843" class="date">13-Jan-2011 09:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you need to force an object (ex: empty array) you can also do:
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; <span class="default">&lt;?php json_encode</span><span class="keyword">( (object)</span><span class="default">$arr </span><span class="keyword">); </span><span class="default">?&gt;
<br />
</span>
<br />
which acts the same as 
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; <span class="default">&lt;?php json_encode</span><span class="keyword">(</span><span class="default">$arr</span><span class="keyword">, </span><span class="default">JSON_FORCE_OBJECT</span><span class="keyword">); </span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="101546""></a>
  <div class="note">
   <strong class="user">marc at leftek dot com</strong>
   <a href="#101546" class="date">23-Dec-2010 07:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Anybody having empty arrays and needing the JSON_FORCE_OBJECT option but not using 5.3 yet, you can substitute assigning an empty object:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (empty(</span><span class="default">$array</span><span class="keyword">)) </span><span class="default">$array </span><span class="keyword">= (object) </span><span class="default">null</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$return </span><span class="keyword">= </span><span class="default">json_encode</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="101267""></a>
  <div class="note">
   <strong class="user">Andre M</strong>
   <a href="#101267" class="date">06-Dec-2010 01:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Regarding encoding issues, if you make sure the PHP files containing your strings are encoded in UTF-8, you shouldn't need to call utf8_encode.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100968""></a>
  <div class="note">
   <strong class="user">spam dot here dot pls at hotmail dot com</strong>
   <a href="#100968" class="date">17-Nov-2010 09:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Another way for pre-5.2.0 PHP users is using rawurlencode() in PHP to encode a string and decodeURIComponent() in javascript to decode it. I have written following class to handle PHP arrays and convert them to javascript format. It uses object notation for associative arrays and arrays for the other. Nesting is supported. True, false, integers, floats and null values are presented in respective javascript syntax.<br />
<br />
Use: convert an array in PHP using this class, load it into the browser using ajax and then decode the strings in the resulting object using javascript function decodeData (below).<br />
<br />
All of the example results have passed json validator so it shoud be allright. Feel free to use this.<br />
<br />
PHP CLASS - encoding arrays<br />
=======<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">class </span><span class="default">custom_json </span><span class="keyword">{<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; * Convert array to javascript object/array<br />
&nbsp;&nbsp; &nbsp; * @param array $array the array<br />
&nbsp;&nbsp; &nbsp; * @return string<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public static function </span><span class="default">encode</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// determine type<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">is_numeric</span><span class="keyword">(</span><span class="default">key</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">))) {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// indexed (list)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$output </span><span class="keyword">= </span><span class="string">'['</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for(</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">, </span><span class="default">$last </span><span class="keyword">= (</span><span class="default">sizeof</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">) - </span><span class="default">1</span><span class="keyword">); isset(</span><span class="default">$array</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]); ++</span><span class="default">$i</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">])) </span><span class="default">$output </span><span class="keyword">.= </span><span class="default">self</span><span class="keyword">::</span><span class="default">encode</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else&nbsp; </span><span class="default">$output </span><span class="keyword">.= </span><span class="default">self</span><span class="keyword">::</span><span class="default">_val</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$i </span><span class="keyword">!== </span><span class="default">$last</span><span class="keyword">) </span><span class="default">$output </span><span class="keyword">.= </span><span class="string">','</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$output </span><span class="keyword">.= </span><span class="string">']'</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// associative (object)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$output </span><span class="keyword">= </span><span class="string">'{'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$last </span><span class="keyword">= </span><span class="default">sizeof</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">) - </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$array </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$output </span><span class="keyword">.= </span><span class="string">'"'</span><span class="keyword">.</span><span class="default">$key</span><span class="keyword">.</span><span class="string">'":'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">)) </span><span class="default">$output </span><span class="keyword">.= </span><span class="default">self</span><span class="keyword">::</span><span class="default">encode</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else&nbsp; </span><span class="default">$output </span><span class="keyword">.= </span><span class="default">self</span><span class="keyword">::</span><span class="default">_val</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$i </span><span class="keyword">!== </span><span class="default">$last</span><span class="keyword">) </span><span class="default">$output </span><span class="keyword">.= </span><span class="string">','</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ++</span><span class="default">$i</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$output </span><span class="keyword">.= </span><span class="string">'}'</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// return<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">$output</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; * [INTERNAL] Format value<br />
&nbsp;&nbsp; &nbsp; * @param mixed $val the value<br />
&nbsp;&nbsp; &nbsp; * @return string<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">private static function </span><span class="default">_val</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">is_string</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">)) return </span><span class="string">'"'</span><span class="keyword">.</span><span class="default">rawurlencode</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">).</span><span class="string">'"'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; elseif(</span><span class="default">is_int</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">)) return </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">'%d'</span><span class="keyword">, </span><span class="default">$val</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; elseif(</span><span class="default">is_float</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">)) return </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">'%F'</span><span class="keyword">, </span><span class="default">$val</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; elseif(</span><span class="default">is_bool</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">)) return (</span><span class="default">$val </span><span class="keyword">? </span><span class="string">'true' </span><span class="keyword">: </span><span class="string">'false'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else&nbsp; return </span><span class="string">'null'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
}<br />
<br />
</span><span class="comment">// prints ["apple","banana","blueberry"]<br />
</span><span class="keyword">echo </span><span class="default">custom_json</span><span class="keyword">::</span><span class="default">encode</span><span class="keyword">(array(</span><span class="string">'apple'</span><span class="keyword">, </span><span class="string">'banana'</span><span class="keyword">, </span><span class="string">'blueberry'</span><span class="keyword">));<br />
<br />
</span><span class="comment">// prints {"name":"orange","type":"fruit"}<br />
</span><span class="keyword">echo </span><span class="default">custom_json</span><span class="keyword">::</span><span class="default">encode</span><span class="keyword">(array(</span><span class="string">'name' </span><span class="keyword">=&gt; </span><span class="string">'orange'</span><span class="keyword">, </span><span class="string">'type' </span><span class="keyword">=&gt; </span><span class="string">'fruit'</span><span class="keyword">));<br />
<br />
</span><span class="comment">// prints: ** try it yourself, cannot post long lines here **<br />
</span><span class="default">$big_test </span><span class="keyword">= array(<br />
&nbsp;&nbsp;&nbsp; array(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'name' </span><span class="keyword">=&gt; array(</span><span class="string">'John'</span><span class="keyword">, </span><span class="string">'Smith'</span><span class="keyword">),<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'age' </span><span class="keyword">=&gt; </span><span class="default">27</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'sex' </span><span class="keyword">=&gt; </span><span class="default">0</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'height' </span><span class="keyword">=&gt; </span><span class="default">180.53</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'is_human' </span><span class="keyword">=&gt; </span><span class="default">true</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'string' </span><span class="keyword">=&gt; </span><span class="string">'Hello'</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; ),<br />
&nbsp;&nbsp;&nbsp; array(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'name' </span><span class="keyword">=&gt; array(</span><span class="string">'Green'</span><span class="keyword">, </span><span class="string">'Alien'</span><span class="keyword">),<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'age' </span><span class="keyword">=&gt; </span><span class="default">642</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'sex' </span><span class="keyword">=&gt; </span><span class="default">null</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'height' </span><span class="keyword">=&gt; </span><span class="default">92.21</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'is_human' </span><span class="keyword">=&gt; </span><span class="default">false</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'string' </span><span class="keyword">=&gt; </span><span class="string">'こんにちは！'</span><span class="keyword">, </span><span class="comment">// test utf8 here<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">)<br />
);<br />
<br />
echo </span><span class="default">custom_json</span><span class="keyword">::</span><span class="default">encode</span><span class="keyword">(</span><span class="default">$big_test</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
JAVASCRIPT FUNCTION - decode rawurlencoded() strings<br />
==================<br />
function decodeData(data) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for(var item in data) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; var type = typeof data[item];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(type === 'object') decodeData(data[item]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else if(type === 'string') data[item] = decodeURIComponent(data[item]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100835""></a>
  <div class="note">
   <strong class="user">boukeversteegh at gmail dot com</strong>
   <a href="#100835" class="date">10-Nov-2010 03:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For users of php 5.1.6 or lower, a native json_encode function. This version handles objects, and makes proper distinction between [lists] and {associative arrays}, mixed arrays work as well. It can handle newlines and quotes in both keys and data. 
<br />

<br />
This function will convert non-ascii symbols to "\uXXXX" format as does json_encode. 
<br />

<br />
Besides that, it outputs exactly the same string as json_encode. Including UTF-8 encoded 2-, 3- and 4-byte characters. It is a bit faster than PEAR/JSON::encode, but still slow compared to php 5.3's json_encode. It encodes any variable type exactly as the original.
<br />

<br />
Relative speeds:
<br />
PHP json_encode: 1x
<br />
__json_encode: 31x
<br />
PEAR/JSON: 46x
<br />

<br />
NOTE: I assume the input will be valid UTF-8. I don't know what happens if your data contains illegal Unicode sequences. I tried to make the code fast and compact.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">__json_encode</span><span class="keyword">( </span><span class="default">$data </span><span class="keyword">) {&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br />
&nbsp;&nbsp;&nbsp; if( </span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">) || </span><span class="default">is_object</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">) ) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$islist </span><span class="keyword">= </span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">) &amp;&amp; ( empty(</span><span class="default">$data</span><span class="keyword">) || </span><span class="default">array_keys</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">) === </span><span class="default">range</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,</span><span class="default">count</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">)-</span><span class="default">1</span><span class="keyword">) );
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="default">$islist </span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$json </span><span class="keyword">= </span><span class="string">'[' </span><span class="keyword">. </span><span class="default">implode</span><span class="keyword">(</span><span class="string">','</span><span class="keyword">, </span><span class="default">array_map</span><span class="keyword">(</span><span class="string">'__json_encode'</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">) ) . </span><span class="string">']'</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$items </span><span class="keyword">= Array();
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach( </span><span class="default">$data </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value </span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$items</span><span class="keyword">[] = </span><span class="default">__json_encode</span><span class="keyword">(</span><span class="string">"</span><span class="default">$key</span><span class="string">"</span><span class="keyword">) . </span><span class="string">':' </span><span class="keyword">. </span><span class="default">__json_encode</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$json </span><span class="keyword">= </span><span class="string">'{' </span><span class="keyword">. </span><span class="default">implode</span><span class="keyword">(</span><span class="string">','</span><span class="keyword">, </span><span class="default">$items</span><span class="keyword">) . </span><span class="string">'}'</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; } elseif( </span><span class="default">is_string</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">) ) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment"># Escape non-printable or Non-ASCII characters.
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; # I also put the \\ character first, as suggested in comments on the 'addclashes' page.
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$string </span><span class="keyword">= </span><span class="string">'"' </span><span class="keyword">. </span><span class="default">addcslashes</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">, </span><span class="string">"\\\"\n\r\t/" </span><span class="keyword">. </span><span class="default">chr</span><span class="keyword">(</span><span class="default">8</span><span class="keyword">) . </span><span class="default">chr</span><span class="keyword">(</span><span class="default">12</span><span class="keyword">)) . </span><span class="string">'"'</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$json&nbsp; &nbsp; </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$len&nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment"># Convert UTF-8 to Hexadecimal Codepoints.
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">for( </span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$len</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++ ) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$char </span><span class="keyword">= </span><span class="default">$string</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">];
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$c1 </span><span class="keyword">= </span><span class="default">ord</span><span class="keyword">(</span><span class="default">$char</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment"># Single byte;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if( </span><span class="default">$c1 </span><span class="keyword">&lt;</span><span class="default">128 </span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$json </span><span class="keyword">.= (</span><span class="default">$c1 </span><span class="keyword">&gt; </span><span class="default">31</span><span class="keyword">) ? </span><span class="default">$char </span><span class="keyword">: </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">"\\u%04x"</span><span class="keyword">, </span><span class="default">$c1</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; continue;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment"># Double byte
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$c2 </span><span class="keyword">= </span><span class="default">ord</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">[++</span><span class="default">$i</span><span class="keyword">]);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ( (</span><span class="default">$c1 </span><span class="keyword">&amp; </span><span class="default">32</span><span class="keyword">) === </span><span class="default">0 </span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$json </span><span class="keyword">.= </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">"\\u%04x"</span><span class="keyword">, (</span><span class="default">$c1 </span><span class="keyword">- </span><span class="default">192</span><span class="keyword">) * </span><span class="default">64 </span><span class="keyword">+ </span><span class="default">$c2 </span><span class="keyword">- </span><span class="default">128</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; continue;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment"># Triple
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$c3 </span><span class="keyword">= </span><span class="default">ord</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">[++</span><span class="default">$i</span><span class="keyword">]);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if( (</span><span class="default">$c1 </span><span class="keyword">&amp; </span><span class="default">16</span><span class="keyword">) === </span><span class="default">0 </span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$json </span><span class="keyword">.= </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">"\\u%04x"</span><span class="keyword">, ((</span><span class="default">$c1 </span><span class="keyword">- </span><span class="default">224</span><span class="keyword">) &lt;&lt;</span><span class="default">12</span><span class="keyword">) + ((</span><span class="default">$c2 </span><span class="keyword">- </span><span class="default">128</span><span class="keyword">) &lt;&lt; </span><span class="default">6</span><span class="keyword">) + (</span><span class="default">$c3 </span><span class="keyword">- </span><span class="default">128</span><span class="keyword">));
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; continue;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment"># Quadruple
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$c4 </span><span class="keyword">= </span><span class="default">ord</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">[++</span><span class="default">$i</span><span class="keyword">]);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if( (</span><span class="default">$c1 </span><span class="keyword">&amp; </span><span class="default">8 </span><span class="keyword">) === </span><span class="default">0 </span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$u </span><span class="keyword">= ((</span><span class="default">$c1 </span><span class="keyword">&amp; </span><span class="default">15</span><span class="keyword">) &lt;&lt; </span><span class="default">2</span><span class="keyword">) + ((</span><span class="default">$c2</span><span class="keyword">&gt;&gt;</span><span class="default">4</span><span class="keyword">) &amp; </span><span class="default">3</span><span class="keyword">) - </span><span class="default">1</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$w1 </span><span class="keyword">= (</span><span class="default">54</span><span class="keyword">&lt;&lt;</span><span class="default">10</span><span class="keyword">) + (</span><span class="default">$u</span><span class="keyword">&lt;&lt;</span><span class="default">6</span><span class="keyword">) + ((</span><span class="default">$c2 </span><span class="keyword">&amp; </span><span class="default">15</span><span class="keyword">) &lt;&lt; </span><span class="default">2</span><span class="keyword">) + ((</span><span class="default">$c3</span><span class="keyword">&gt;&gt;</span><span class="default">4</span><span class="keyword">) &amp; </span><span class="default">3</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$w2 </span><span class="keyword">= (</span><span class="default">55</span><span class="keyword">&lt;&lt;</span><span class="default">10</span><span class="keyword">) + ((</span><span class="default">$c3 </span><span class="keyword">&amp; </span><span class="default">15</span><span class="keyword">)&lt;&lt;</span><span class="default">6</span><span class="keyword">) + (</span><span class="default">$c4</span><span class="keyword">-</span><span class="default">128</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$json </span><span class="keyword">.= </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">"\\u%04x\\u%04x"</span><span class="keyword">, </span><span class="default">$w1</span><span class="keyword">, </span><span class="default">$w2</span><span class="keyword">); 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; } else {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment"># int, floats, bools, null
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$json </span><span class="keyword">= </span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">var_export</span><span class="keyword">( </span><span class="default">$data</span><span class="keyword">, </span><span class="default">true </span><span class="keyword">));
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$json</span><span class="keyword">;
<br />
}
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
[EDIT BY danbrown AT php DOT net: Contains a bugfix by the original poster on 08-DEC-2010 with the following message: "I discovered a rather bad bug in my __json_encode function below. On versions prior to php 5.2.5, all 'f' characters are escaped to '\f'. This is because addcslashes in php &lt; 5.2 doesn't understand \f as 'formfeed'."]</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100679""></a>
  <div class="note">
   <strong class="user">php at ianco dot co dot uk</strong>
   <a href="#100679" class="date">30-Oct-2010 01:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that json_encode always escapes a solidus (forward slash, %x2F).<br />
This may be a problem if you are encoding a URL.<br />
It's been recognised and fixed in September 2010:<br />
<a href="http://bugs.php.net/bug.php?id=49366" rel="nofollow" target="_blank">http://bugs.php.net/bug.php?id=49366</a><br />
But escaping will still be the default behaviour.<br />
A crude repair can be done with<br />
str_replace('\\/', '/', $jsonEncoded)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100492""></a>
  <div class="note">
   <strong class="user">migprj at gmail dot com</strong>
   <a href="#100492" class="date">19-Oct-2010 04:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Because json_encode() only deals with utf8, it is often necessary to convert all the string values inside an array to utf8. I've created these two functions:&nbsp; &nbsp; 
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">utf8_encode_all</span><span class="keyword">(</span><span class="default">$dat</span><span class="keyword">) </span><span class="comment">// -- It returns $dat encoded to UTF8
<br />
</span><span class="keyword">{
<br />
&nbsp; if (</span><span class="default">is_string</span><span class="keyword">(</span><span class="default">$dat</span><span class="keyword">)) return </span><span class="default">utf8_encode</span><span class="keyword">(</span><span class="default">$dat</span><span class="keyword">);
<br />
&nbsp; if (!</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$dat</span><span class="keyword">)) return </span><span class="default">$dat</span><span class="keyword">;
<br />
&nbsp; </span><span class="default">$ret </span><span class="keyword">= array();
<br />
&nbsp; foreach(</span><span class="default">$dat </span><span class="keyword">as </span><span class="default">$i</span><span class="keyword">=&gt;</span><span class="default">$d</span><span class="keyword">) </span><span class="default">$ret</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] = </span><span class="default">utf8_encode_all</span><span class="keyword">(</span><span class="default">$d</span><span class="keyword">);
<br />
&nbsp; return </span><span class="default">$ret</span><span class="keyword">;
<br />
}
<br />
</span><span class="comment">/* ....... */
<br />

<br />
</span><span class="keyword">function </span><span class="default">utf8_decode_all</span><span class="keyword">(</span><span class="default">$dat</span><span class="keyword">) </span><span class="comment">// -- It returns $dat decoded from UTF8
<br />
</span><span class="keyword">{
<br />
&nbsp; if (</span><span class="default">is_string</span><span class="keyword">(</span><span class="default">$dat</span><span class="keyword">)) return </span><span class="default">utf8_decode</span><span class="keyword">(</span><span class="default">$dat</span><span class="keyword">);
<br />
&nbsp; if (!</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$dat</span><span class="keyword">)) return </span><span class="default">$dat</span><span class="keyword">;
<br />
&nbsp; </span><span class="default">$ret </span><span class="keyword">= array();
<br />
&nbsp; foreach(</span><span class="default">$dat </span><span class="keyword">as </span><span class="default">$i</span><span class="keyword">=&gt;</span><span class="default">$d</span><span class="keyword">) </span><span class="default">$ret</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] = </span><span class="default">utf8_decode_all</span><span class="keyword">(</span><span class="default">$d</span><span class="keyword">);
<br />
&nbsp; return </span><span class="default">$ret</span><span class="keyword">;
<br />
}
<br />
</span><span class="comment">/* ....... */
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100272""></a>
  <div class="note">
   <strong class="user">tomas at matfyz dot cz</strong>
   <a href="#100272" class="date">05-Oct-2010 04:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As json_encode() won't work with character sets other than UTF-8, this expression allows to encode strings for JSON regardless of the character set:
<br />

<br />
<span class="default">&lt;?php
<br />
str_replace</span><span class="keyword">(</span><span class="string">"\0"</span><span class="keyword">, </span><span class="string">"\\u0000"</span><span class="keyword">, </span><span class="default">addcslashes</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">, </span><span class="string">"\t\r\n\"\\"</span><span class="keyword">));
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
You need to replace the nul character manually as addcslashes() won't do it right way. But BEWARE, this is only solution for common strings, other "unusual wild characters" like ESC, \b, \a etc. are not handled.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100265""></a>
  <div class="note">
   <strong class="user">matt dot parlane at gmail dot com</strong>
   <a href="#100265" class="date">05-Oct-2010 09:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To save some space, at the risk of it being illegal JSON, strictly speaking:<br />
<br />
<span class="default">&lt;?php<br />
$json </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/"([a-zA-Z]+[a-zA-Z0-9]*)":/'</span><span class="keyword">, </span><span class="string">'$1:'</span><span class="keyword">, </span><span class="default">json_encode</span><span class="keyword">(</span><span class="default">$whatever</span><span class="keyword">));<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99837""></a>
  <div class="note">
   <strong class="user">Dave - s10sys.com</strong>
   <a href="#99837" class="date">09-Sep-2010 05:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This may help others who are seeing null strings returned by json_encode().
<br />

<br />
This function will encode all array values to utf8 so they are safe for json_encode();
<br />

<br />
usage: 
<br />

<br />
<span class="default">&lt;?php
<br />
json_encode</span><span class="keyword">(</span><span class="default">utf8json</span><span class="keyword">(</span><span class="default">$dataArray</span><span class="keyword">));
<br />

<br />
function </span><span class="default">utf8json</span><span class="keyword">(</span><span class="default">$inArray</span><span class="keyword">) {
<br />

<br />
&nbsp;&nbsp;&nbsp; static </span><span class="default">$depth </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/* our return object */
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$newArray </span><span class="keyword">= array();
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/* safety recursion limit */
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$depth </span><span class="keyword">++;
<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$depth </span><span class="keyword">&gt;= </span><span class="string">'30'</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/* step through inArray */
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">foreach(</span><span class="default">$inArray </span><span class="keyword">as </span><span class="default">$key</span><span class="keyword">=&gt;</span><span class="default">$val</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/* recurse on array elements */
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$newArray</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">] = </span><span class="default">utf8json</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/* encode string values */
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$newArray</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">] = </span><span class="default">utf8_encode</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/* return utf8 encoded array */
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">$newArray</span><span class="keyword">;
<br />
}
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
[NOTE BY danbrown AT php DOT net: Includes a bugfix by (robbiz233 AT hotmail DOT com) on 18-SEP-2010, to replace:
<br />
&nbsp;&nbsp;&nbsp; $newArray[$key] = utf8json($inArray);
<br />
with:
<br />
&nbsp;&nbsp;&nbsp; $newArray[$key] = utf8json($val);"
<br />
in the given function.]</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99457""></a>
  <div class="note">
   <strong class="user">nicolas dot baptiste at gmail dot com</strong>
   <a href="#99457" class="date">18-Aug-2010 05:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Beware of index arrays :<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">echo </span><span class="default">json_encode</span><span class="keyword">(array(</span><span class="string">"test"</span><span class="keyword">,</span><span class="string">"test"</span><span class="keyword">,</span><span class="string">"test"</span><span class="keyword">));<br />
echo </span><span class="default">json_encode</span><span class="keyword">(array(</span><span class="default">0</span><span class="keyword">=&gt;</span><span class="string">"test"</span><span class="keyword">,</span><span class="default">3</span><span class="keyword">=&gt;</span><span class="string">"test"</span><span class="keyword">,</span><span class="default">7</span><span class="keyword">=&gt;</span><span class="string">"test"</span><span class="keyword">));<br />
</span><span class="default">?&gt;<br />
</span><br />
Will give :<br />
<br />
["test","test","test"]<br />
{"0":"test","3":"test","7":"test"}<br />
<br />
arrays are returned only if you don't define index.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99264""></a>
  <div class="note">
   <strong class="user">gansbrest</strong>
   <a href="#99264" class="date">06-Aug-2010 09:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you have problems with quotes when encoding numeric data retrieved from the database, you can just cast that value to integer and there will be no quotes:
<br />

<br />
<span class="default">&lt;?php
<br />
$testArr</span><span class="keyword">[</span><span class="string">'key'</span><span class="keyword">] = </span><span class="string">'1'</span><span class="keyword">;
<br />
print </span><span class="default">json_encode</span><span class="keyword">(</span><span class="default">$testArr</span><span class="keyword">);
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
===&gt; {"key":"1"}
<br />

<br />
<span class="default">&lt;?php
<br />
$testArr</span><span class="keyword">[</span><span class="string">'key'</span><span class="keyword">] = (int)</span><span class="string">'1'</span><span class="keyword">;
<br />
print </span><span class="default">json_encode</span><span class="keyword">(</span><span class="default">$testArr</span><span class="keyword">);
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
===&gt; {"key":1}
<br />

<br />
Don't forget that you have to deal with numbers, otherwise your string will be converted to 0.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="98718""></a>
  <div class="note">
   <strong class="user">mic dot sumner at gmail dot com</strong>
   <a href="#98718" class="date">02-Jul-2010 03:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hey everyone,<br />
<br />
In my application, I had objects that modeled database rows with a few one to many relationships, so one object may have an array of other objects.<br />
<br />
I wanted to make the object properties private and use getters and setters, but I needed them to be serializable to json without losing the private variables. (I wanted to promote good coding practices but I needed the properties on the client side.) Because of this, I needed to encode not only the normal private properties but also properties that were arrays of other model objects. I looked for awhile with no luck, so I coded my own:<br />
<br />
You can place these methods in each of your classes, or put them in a base class, as I've done. (But note that for this to work, the children classes must declare their properties as protected so the parent class has access)<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">abstract class </span><span class="default">Model </span><span class="keyword">{<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp; public function </span><span class="default">toArray</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">processArray</span><span class="keyword">(</span><span class="default">get_object_vars</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; private function </span><span class="default">processArray</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$array </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_object</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$array</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">] = </span><span class="default">$value</span><span class="keyword">-&gt;</span><span class="default">toArray</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$array</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">] = </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">processArray</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// If the property isn't an object or array, leave it untouched<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">$array</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__toString</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">json_encode</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">toArray</span><span class="keyword">());<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp; <br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Externally, you can just call<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">echo </span><span class="default">$theObject</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//or<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">echo </span><span class="default">json_encode</span><span class="keyword">(</span><span class="default">$theObject</span><span class="keyword">-&gt;</span><span class="default">toArray</span><span class="keyword">());<br />
</span><span class="default">?&gt;<br />
</span><br />
And you'll get the json for that object. Hope this helps someone!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="97008""></a>
  <div class="note">
   <strong class="user">ryan at ryanparman dot com</strong>
   <a href="#97008" class="date">27-Mar-2010 10:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I came across the "bug" where running json_encode() over a SimpleXML object was ignoring the CDATA. I ran across <a href="http://bugs.php.net/42001 and http://bugs.php.net/41976, and while I agree with the poster that the documentation should clarify gotchas like this, I was able to figure out how to workaround it." rel="nofollow" target="_blank">http://bugs.php.net/42001 and http://bugs.php.net/41976, and while I agree with the poster that the documentation should clarify gotchas like this, I was able to figure out how to workaround it.</a><br />
<br />
You need to convert the SimpleXML object back into an XML string, then re-import it back into SimpleXML using the LIBXML_NOCDATA option. Once you do this, then you can use json_encode() and still get back the CDATA.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// Pretend we already have a complex SimpleXML object stored in $xml<br />
</span><span class="default">$json </span><span class="keyword">= </span><span class="default">json_encode</span><span class="keyword">(new </span><span class="default">SimpleXMLElement</span><span class="keyword">(</span><span class="default">$xml</span><span class="keyword">-&gt;</span><span class="default">asXML</span><span class="keyword">(), </span><span class="default">LIBXML_NOCDATA</span><span class="keyword">));<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="96248""></a>
  <div class="note">
   <strong class="user">5hunter5 at mail dot ru</strong>
   <a href="#96248" class="date">17-Feb-2010 12:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If I want to encode object whith all it's private and protected properties, then I implements that methods in my object:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">public function </span><span class="default">encodeJSON</span><span class="keyword">()
<br />
{
<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$this </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$json</span><span class="keyword">-&gt;</span><span class="default">$key </span><span class="keyword">= </span><span class="default">$value</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">json_encode</span><span class="keyword">(</span><span class="default">$json</span><span class="keyword">);
<br />
}
<br />
public function </span><span class="default">decodeJSON</span><span class="keyword">(</span><span class="default">$json_str</span><span class="keyword">)
<br />
{
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$json </span><span class="keyword">= </span><span class="default">json_decode</span><span class="keyword">(</span><span class="default">$json_str</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$json </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">$key </span><span class="keyword">= </span><span class="default">$value</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
}
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Or you may extend your class from base class, wich is implements that methods.
<br />

<br />
Found that much more simple than regular expressions with PHP serialized objects...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="95805""></a>
  <div class="note">
   <strong class="user">olivier dot pons dot no dot spam at gmail dot com</strong>
   <a href="#95805" class="date">22-Jan-2010 04:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Be careful about one thing:
<br />
With a string key Php will consider it's an object:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">echo </span><span class="default">json_encode</span><span class="keyword">(array(</span><span class="string">'id'</span><span class="keyword">=&gt;</span><span class="string">'testtext'</span><span class="keyword">));
<br />
echo </span><span class="default">json_encode</span><span class="keyword">(array(</span><span class="string">'testtext'</span><span class="keyword">));
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Will give:
<br />

<br />
{"id":"testtext"}
<br />
["testtext"]
<br />

<br />
Beware of the string keys!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="95667""></a>
  <div class="note">
   <strong class="user">garydavis at gmail dot com</strong>
   <a href="#95667" class="date">14-Jan-2010 04:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are planning on using this function to serve a json file, it's important to note that the json generated by this function is not ready to be consumed by javascript until you wrap it in parens and add ";" to the end. <br />
<br />
It took me a while to figure this out so I thought I'd save others the aggravation.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; header</span><span class="keyword">(</span><span class="string">'Content-Type: text/javascript; charset=utf8'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Access-Control-Allow-Origin: <a href="http://www.example.com/" rel="nofollow" target="_blank">http://www.example.com/</a>'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Access-Control-Max-Age: 3628800'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Access-Control-Allow-Methods: GET, POST, PUT, DELETE'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$file</span><span class="keyword">=</span><span class="string">'rss.xml'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$arr </span><span class="keyword">= </span><span class="default">simplexml_load_file</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);</span><span class="comment">//this creates an object from the xml file<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$json</span><span class="keyword">= </span><span class="string">'('</span><span class="keyword">.</span><span class="default">json_encode</span><span class="keyword">(</span><span class="default">$arr</span><span class="keyword">).</span><span class="string">');'</span><span class="keyword">; </span><span class="comment">//must wrap in parens and end with semicolon<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'callback'</span><span class="keyword">].</span><span class="default">$json</span><span class="keyword">); </span><span class="comment">//callback is prepended for json-p<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="94629""></a>
  <div class="note">
   <strong class="user">me at daniel dot ie</strong>
   <a href="#94629" class="date">15-Nov-2009 05:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I had trouble putting the results of mysql_fetch_assoc() through json_encode: numbers being returned from the query were being quoted in the JSON output (i.e., they were being treated as strings). In order to fix this, it is necessary to explicitly cast each element of the array before json_encode() is called.<br />
<br />
The following code uses metadata from a MySQL query result to do this casting.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; $mysql </span><span class="keyword">= </span><span class="default">mysql_connect</span><span class="keyword">(</span><span class="string">'localhost'</span><span class="keyword">, </span><span class="string">'user'</span><span class="keyword">, </span><span class="string">'password'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">mysql_select_db</span><span class="keyword">(</span><span class="string">'my_db'</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$query </span><span class="keyword">= </span><span class="string">'select * from my_table'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$res </span><span class="keyword">= </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// iterate over every row<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">while (</span><span class="default">$row </span><span class="keyword">= </span><span class="default">mysql_fetch_assoc</span><span class="keyword">(</span><span class="default">$res</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// for every field in the result..<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">mysql_num_fields</span><span class="keyword">(</span><span class="default">$res</span><span class="keyword">); </span><span class="default">$i</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$info </span><span class="keyword">= </span><span class="default">mysql_fetch_field</span><span class="keyword">(</span><span class="default">$res</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$type </span><span class="keyword">= </span><span class="default">$info</span><span class="keyword">-&gt;</span><span class="default">type</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// cast for real<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$type </span><span class="keyword">== </span><span class="string">'real'</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$row</span><span class="keyword">[</span><span class="default">$info</span><span class="keyword">-&gt;</span><span class="default">name</span><span class="keyword">] = </span><span class="default">doubleval</span><span class="keyword">(</span><span class="default">$row</span><span class="keyword">[</span><span class="default">$info</span><span class="keyword">-&gt;</span><span class="default">name</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// cast for int<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$type </span><span class="keyword">== </span><span class="string">'int'</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$row</span><span class="keyword">[</span><span class="default">$info</span><span class="keyword">-&gt;</span><span class="default">name</span><span class="keyword">] = </span><span class="default">intval</span><span class="keyword">(</span><span class="default">$row</span><span class="keyword">[</span><span class="default">$info</span><span class="keyword">-&gt;</span><span class="default">name</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$rows</span><span class="keyword">[] = </span><span class="default">$row</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// JSON-ify all rows together as one big array<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">echo </span><span class="default">json_encode</span><span class="keyword">(</span><span class="default">$rows</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">mysql_close</span><span class="keyword">(</span><span class="default">$mysql</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="94359""></a>
  <div class="note">
   <strong class="user">rlz_ar at yahoo dot com</strong>
   <a href="#94359" class="date">30-Oct-2009 05:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you have problems with json_encode() on arrays, you can force json_encode() to encode as object, and then use json_decode() casting the result as array:<br />
<br />
<span class="default">&lt;?php<br />
<br />
$myarray </span><span class="keyword">= Array(</span><span class="string">'isa'</span><span class="keyword">, </span><span class="string">'dalawa'</span><span class="keyword">, </span><span class="string">'tatlo'</span><span class="keyword">);<br />
<br />
unset(</span><span class="default">$myarray</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br />
<br />
</span><span class="default">$json_encoded_array </span><span class="keyword">= </span><span class="default">json_encode </span><span class="keyword">( </span><span class="default">$myarray</span><span class="keyword">, </span><span class="default">JSON_FORCE_OBJECT </span><span class="keyword">);<br />
<br />
</span><span class="comment">// do whatever you want with your data<br />
// then you can retrive the data doing:<br />
<br />
</span><span class="default">$myarray </span><span class="keyword">= (array) </span><span class="default">json_decode </span><span class="keyword">( </span><span class="default">$json_encoded_array </span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="94157""></a>
  <div class="note">
   <strong class="user">simoncpu was here</strong>
   <a href="#94157" class="date">20-Oct-2009 11:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A note of caution: If you are wondering why json_encode() encodes your PHP array as a JSON object instead of a JSON array, you might want to double check your array keys because json_encode() assumes that you array is an object if your keys are not sequential.<br />
<br />
e.g.:<br />
<br />
<span class="default">&lt;?php<br />
$myarray </span><span class="keyword">= Array(</span><span class="string">'isa'</span><span class="keyword">, </span><span class="string">'dalawa'</span><span class="keyword">, </span><span class="string">'tatlo'</span><span class="keyword">);<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$myarray</span><span class="keyword">);<br />
</span><span class="comment">/* output<br />
array(3) {<br />
&nbsp; [0]=&gt;<br />
&nbsp; string(3) "isa"<br />
&nbsp; [1]=&gt;<br />
&nbsp; string(6) "dalawa"<br />
&nbsp; [2]=&gt;<br />
&nbsp; string(5) "tatlo"<br />
}<br />
*/<br />
</span><span class="default">?&gt;<br />
</span><br />
As you can see, the keys are sequential; $myarray will be correctly encoded as a JSON array.<br />
<br />
<span class="default">&lt;?php<br />
$myarray </span><span class="keyword">= Array(</span><span class="string">'isa'</span><span class="keyword">, </span><span class="string">'dalawa'</span><span class="keyword">, </span><span class="string">'tatlo'</span><span class="keyword">);<br />
<br />
unset(</span><span class="default">$myarray</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$myarray</span><span class="keyword">);<br />
</span><span class="comment">/* output<br />
array(2) {<br />
&nbsp; [0]=&gt;<br />
&nbsp; string(3) "isa"<br />
&nbsp; [2]=&gt;<br />
&nbsp; string(5) "tatlo"<br />
}<br />
*/<br />
</span><span class="default">?&gt;<br />
</span><br />
Unsetting an element will also remove the keys. json_encode() will now assume that this is an object, and will encode it as such.<br />
<br />
SOLUTION: Use array_values() to re-index the array.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92817""></a>
  <div class="note">
   <strong class="user">http://mike.eire.ca/</strong>
   <a href="#92817" class="date">10-Aug-2009 10:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that this function does not always produce legal JSON.<br />
<br />
<span class="default">&lt;?php<br />
$json </span><span class="keyword">= </span><span class="default">json_encode</span><span class="keyword">(</span><span class="string">'foo'</span><span class="keyword">);<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$json</span><span class="keyword">);<br />
</span><span class="comment">//string(5) ""foo""<br />
<br />
</span><span class="default">$json </span><span class="keyword">= </span><span class="default">json_encode</span><span class="keyword">(</span><span class="default">23</span><span class="keyword">);<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$json</span><span class="keyword">);<br />
</span><span class="comment">//string(2) "23"<br />
</span><span class="default">?&gt;<br />
</span><br />
According to the JSON spec, only objects and arrays can be represented; the JSON_FORCE_OBJECT flag available since PHP 5.3 does not change this behaviour. If you're using this to produce JSON that will be exchanged with other systems, adjust your output accordingly.<br />
<br />
<span class="default">&lt;?php<br />
$json </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/^([^[{].*)$/'</span><span class="keyword">, </span><span class="string">'[$1]'</span><span class="keyword">, </span><span class="default">$json</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
The json_decode function accepts these JSON fragments without complaint.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91434""></a>
  <div class="note">
   <strong class="user">Istratov Vadim</strong>
   <a href="#91434" class="date">10-Jun-2009 08:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Be careful with floating values in some locales (e.g. russian) with comma (",") as decimal point. Code:
<br />

<br />
<span class="default">&lt;?php
<br />
setlocale</span><span class="keyword">(</span><span class="default">LC_ALL</span><span class="keyword">, </span><span class="string">'ru_RU.utf8'</span><span class="keyword">);
<br />

<br />
</span><span class="default">$arr </span><span class="keyword">= array(</span><span class="string">'element' </span><span class="keyword">=&gt; </span><span class="default">12.34</span><span class="keyword">);
<br />
echo </span><span class="default">json_encode</span><span class="keyword">( </span><span class="default">$arr </span><span class="keyword">);
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Output will be:
<br />
--------------
<br />
{"element":12,34}
<br />
--------------
<br />

<br />
Which is NOT a valid JSON markup. You should convert floating point variable to strings or set locale to something like "LC_NUMERIC, 'en_US.utf8'" before using json_encode.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="90407""></a>
  <div class="note">
   <strong class="user">Sam Barnum</strong>
   <a href="#90407" class="date">21-Apr-2009 08:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that if you try to encode an array containing non-utf values, you'll get null values in the resulting JSON string.&nbsp; You can batch-encode all the elements of an array with the array_map function:<br />
<span class="default">&lt;?php<br />
$encodedArray </span><span class="keyword">= </span><span class="default">array_map</span><span class="keyword">(</span><span class="default">utf8_encode</span><span class="keyword">, </span><span class="default">$rawArray</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="89908""></a>
  <div class="note">
   <strong class="user">andyrusterholz at g-m-a-i-l dot c-o-m</strong>
   <a href="#89908" class="date">27-Mar-2009 08:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For anyone who would like to encode arrays into JSON, but is using PHP 4, and doesn't want to wrangle PECL around, here is a function I wrote in PHP4 to convert nested arrays into JSON.
<br />

<br />
Note that, because javascript converts JSON data into either nested named objects OR vector arrays, it's quite difficult to represent mixed PHP arrays (arrays with both numerical and associative indexes) well in JSON. This function does something funky if you pass it a mixed array -- see the comments for details.
<br />

<br />
I don't make a claim that this function is by any means complete (for example, it doesn't handle objects) so if you have any improvements, go for it.
<br />

<br />
<span class="default">&lt;?php
<br />

<br />
</span><span class="comment">/**
<br />
&nbsp;* Converts an associative array of arbitrary depth and dimension into JSON representation.
<br />
&nbsp;*
<br />
&nbsp;* NOTE: If you pass in a mixed associative and vector array, it will prefix each numerical
<br />
&nbsp;* key with "key_". For example array("foo", "bar" =&gt; "baz") will be translated into
<br />
&nbsp;* {"key_0": "foo", "bar": "baz"} but array("foo", "bar") would be translated into [ "foo", "bar" ].
<br />
&nbsp;*
<br />
&nbsp;* @param $array The array to convert.
<br />
&nbsp;* @return mixed The resulting JSON string, or false if the argument was not an array.
<br />
&nbsp;* @author Andy Rusterholz
<br />
&nbsp;*/
<br />
</span><span class="keyword">function </span><span class="default">array_to_json</span><span class="keyword">( </span><span class="default">$array </span><span class="keyword">){
<br />

<br />
&nbsp;&nbsp;&nbsp; if( !</span><span class="default">is_array</span><span class="keyword">( </span><span class="default">$array </span><span class="keyword">) ){
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$associative </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">( </span><span class="default">array_diff</span><span class="keyword">( </span><span class="default">array_keys</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">), </span><span class="default">array_keys</span><span class="keyword">( </span><span class="default">array_keys</span><span class="keyword">( </span><span class="default">$array </span><span class="keyword">)) ));
<br />
&nbsp;&nbsp;&nbsp; if( </span><span class="default">$associative </span><span class="keyword">){
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$construct </span><span class="keyword">= array();
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach( </span><span class="default">$array </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value </span><span class="keyword">){
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// We first copy each key/value pair into a staging array,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // formatting each key and value properly as we go.
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // Format the key:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if( </span><span class="default">is_numeric</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">) ){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$key </span><span class="keyword">= </span><span class="string">"key_</span><span class="default">$key</span><span class="string">"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$key </span><span class="keyword">= </span><span class="string">'"'</span><span class="keyword">.</span><span class="default">addslashes</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">).</span><span class="string">'"'</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Format the value:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if( </span><span class="default">is_array</span><span class="keyword">( </span><span class="default">$value </span><span class="keyword">)){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$value </span><span class="keyword">= </span><span class="default">array_to_json</span><span class="keyword">( </span><span class="default">$value </span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else if( !</span><span class="default">is_numeric</span><span class="keyword">( </span><span class="default">$value </span><span class="keyword">) || </span><span class="default">is_string</span><span class="keyword">( </span><span class="default">$value </span><span class="keyword">) ){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$value </span><span class="keyword">= </span><span class="string">'"'</span><span class="keyword">.</span><span class="default">addslashes</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">).</span><span class="string">'"'</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Add to staging array:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$construct</span><span class="keyword">[] = </span><span class="string">"</span><span class="default">$key</span><span class="string">: </span><span class="default">$value</span><span class="string">"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Then we collapse the staging array into the JSON form:
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="string">"{ " </span><span class="keyword">. </span><span class="default">implode</span><span class="keyword">( </span><span class="string">", "</span><span class="keyword">, </span><span class="default">$construct </span><span class="keyword">) . </span><span class="string">" }"</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp;&nbsp; } else { </span><span class="comment">// If the array is a vector (not associative):
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$construct </span><span class="keyword">= array();
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach( </span><span class="default">$array </span><span class="keyword">as </span><span class="default">$value </span><span class="keyword">){
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Format the value:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if( </span><span class="default">is_array</span><span class="keyword">( </span><span class="default">$value </span><span class="keyword">)){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$value </span><span class="keyword">= </span><span class="default">array_to_json</span><span class="keyword">( </span><span class="default">$value </span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else if( !</span><span class="default">is_numeric</span><span class="keyword">( </span><span class="default">$value </span><span class="keyword">) || </span><span class="default">is_string</span><span class="keyword">( </span><span class="default">$value </span><span class="keyword">) ){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$value </span><span class="keyword">= </span><span class="string">'"'</span><span class="keyword">.</span><span class="default">addslashes</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">).</span><span class="string">'"'</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Add to staging array:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$construct</span><span class="keyword">[] = </span><span class="default">$value</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Then we collapse the staging array into the JSON form:
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="string">"[ " </span><span class="keyword">. </span><span class="default">implode</span><span class="keyword">( </span><span class="string">", "</span><span class="keyword">, </span><span class="default">$construct </span><span class="keyword">) . </span><span class="string">" ]"</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$result</span><span class="keyword">;
<br />
}
<br />

<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="88790""></a>
  <div class="note">
   <strong class="user">aangel at spam dot com</strong>
   <a href="#88790" class="date">08-Feb-2009 02:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is a bit more on creating an iterator to get at those pesky private/protected variables:<br />
<br />
<span class="default">&lt;?php <br />
&nbsp;&nbsp; </span><span class="keyword">class </span><span class="default">Kit </span><span class="keyword">implements </span><span class="default">IteratorAggregate </span><span class="keyword">{<br />
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$var</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_object</span><span class="keyword">(</span><span class="default">$var</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// if passed an object, we are cloning<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">kitID </span><span class="keyword">= </span><span class="default">$var</span><span class="keyword">-&gt;</span><span class="default">kitID</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">kitName </span><span class="keyword">= </span><span class="default">$var</span><span class="keyword">-&gt;</span><span class="default">kitName</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach (</span><span class="default">$var</span><span class="keyword">-&gt;</span><span class="default">productArray </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">productArray</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">] = (array)</span><span class="default">$value</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp; ...<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Create an iterator because private/protected vars can't<br />
&nbsp;&nbsp;&nbsp; // be seen by json_encode().<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public function </span><span class="default">getIterator</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$iArray</span><span class="keyword">[</span><span class="string">'kitID'</span><span class="keyword">] = </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">kitID</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$iArray</span><span class="keyword">[</span><span class="string">'kitName'</span><span class="keyword">] = </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">kitName</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$iArray</span><span class="keyword">[</span><span class="string">'productArray'</span><span class="keyword">] = (array)</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">productArray</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return new </span><span class="default">ArrayIterator</span><span class="keyword">(</span><span class="default">$iArray</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;</span> <br />
<br />
Calling something like&nbsp; $t = json_encode($this-&gt;getIterator());&nbsp; will give you almost what you want:<br />
<span class="default">&lt;?php <br />
</span><span class="keyword">{</span><span class="string">"kitID"</span><span class="keyword">:</span><span class="string">"Kit_Essentials-Books.txt"</span><span class="keyword">,<br />
</span><span class="string">"kitName"</span><span class="keyword">:</span><span class="string">"Essential Books"</span><span class="keyword">,<br />
</span><span class="string">"productArray"</span><span class="keyword">:{</span><span class="string">"0470043601"</span><span class="keyword">:{</span><span class="string">"Category"</span><span class="keyword">:</span><span class="string">"Food"</span><span class="keyword">,</span><span class="string">"ASIN"</span><span class="keyword">:</span><span class="string">"0470043601"</span><span class="keyword">} } } <br />
</span><span class="default">?&gt;<br />
</span><br />
Notice that the productArray is converted to an object ignoring the cast I put in front, which is not what I wanted. I haven't figured out how to make sure that encodes as an array.<br />
<br />
Regardless, bringing that JSON back into an object using json_decode() will give you just a std object, and the only way I've found to get it into the proper object type is to use a constructor that instantiates the object the way it's supposed to be (see __construct($var) above). Like this:<br />
<span class="default">&lt;?php <br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $newKit </span><span class="keyword">= new </span><span class="default">Kit</span><span class="keyword">(</span><span class="default">json_decode</span><span class="keyword">(</span><span class="default">$t</span><span class="keyword">));<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86513""></a>
  <div class="note">
   <strong class="user">Garrett</strong>
   <a href="#86513" class="date">22-Oct-2008 08:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A note about json_encode automatically quoting numbers:<br />
<br />
It appears that the json_encode function pays attention to the data type of the value. Let me explain what we came across:<br />
<br />
We have found that when retrieving data from our database, there are occasions when numbers appear as strings to json_encode which results in double quotes around the values.<br />
<br />
This can lead to problems within javascript functions expecting the values to be numeric.<br />
<br />
This was discovered when were were retrieving fields from the database which contained serialized arrays. After unserializing them and sending them through the json_encode function the numeric values in the original array were now being treated as strings and showing up with double quotes around them.<br />
<br />
The fix: Prior to encoding the array, send it to a function which checks for numeric types and casts accordingly. Encoding from then on worked as expected.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86358""></a>
  <div class="note">
   <strong class="user">stboisvert at nowantspam dot gmail dot com</strong>
   <a href="#86358" class="date">14-Oct-2008 09:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When Using Libraries such as Prototype you may find that once in a while when you return what you believe to be a empty array it will have a different behavior (vis a vis enumerables) than when you give it an associative array. To "fix" this, on your JS you may want to look for extended object properties to verify if it is an empty array or an ocject. 
<br />

<br />
example:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">if (</span><span class="default">transport</span><span class="keyword">.</span><span class="default">responseJSON</span><span class="keyword">[</span><span class="string">'User'</span><span class="keyword">].</span><span class="default">length </span><span class="keyword">== </span><span class="default">undefined</span><span class="keyword">){
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; var </span><span class="default">user </span><span class="keyword">= </span><span class="default">$H</span><span class="keyword">(</span><span class="default">transport</span><span class="keyword">.</span><span class="default">responseJSON</span><span class="keyword">[</span><span class="string">'User'</span><span class="keyword">]);
<br />
}else{
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; var </span><span class="default">user </span><span class="keyword">= </span><span class="default">transport</span><span class="keyword">.</span><span class="default">responseJSON</span><span class="keyword">[</span><span class="string">'User'</span><span class="keyword">];&nbsp; &nbsp; &nbsp; 
<br />
}
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Thanks goes out to :
<br />
jani@php.net
<br />

<br />
This is totally expected behaviour. Please read this:
<br />
<a href="http://www.json.org/" rel="nofollow" target="_blank">http://www.json.org/</a>
<br />

<br />
Note: array and assoc-array are different things. Latter being "object"
<br />
in json.
<br />

<br />
<a href="http://bugs.php.net/bug.php?id=45162" rel="nofollow" target="_blank">http://bugs.php.net/bug.php?id=45162</a>
<br />

<br />
[RQuadling] See <a href="http://bugs.php.net/bug.php?id=47493. Fixed by using json_encode(array(" rel="nofollow" target="_blank">http://bugs.php.net/bug.php?id=47493. Fixed by using json_encode(array(</a>), JSON_FORCE_OBJECT);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84997""></a>
  <div class="note">
   <strong class="user">spam.goes.in.here AT gmail.com</strong>
   <a href="#84997" class="date">09-Aug-2008 08:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For anyone who has run into the problem of private properties not being added, you can simply implement the IteratorAggregate interface with the getIterator() method. Add the properties you want to be included in the output into an array in the getIterator() method and return it.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="80339""></a>
  <div class="note">
   <strong class="user">umbrae at gmail dot com</strong>
   <a href="#80339" class="date">10-Jan-2008 07:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's a quick function to pretty-print some JSON. Optimizations welcome, as this was a 10-minute dealie without efficiency in mind:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="comment">// Pretty print some JSON
<br />
</span><span class="keyword">function </span><span class="default">json_format</span><span class="keyword">(</span><span class="default">$json</span><span class="keyword">)
<br />
{
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$tab </span><span class="keyword">= </span><span class="string">"&nbsp; "</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$new_json </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$indent_level </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$in_string </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$json_obj </span><span class="keyword">= </span><span class="default">json_decode</span><span class="keyword">(</span><span class="default">$json</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$json_obj </span><span class="keyword">=== </span><span class="default">false</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$json </span><span class="keyword">= </span><span class="default">json_encode</span><span class="keyword">(</span><span class="default">$json_obj</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$len </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$json</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp;&nbsp; for(</span><span class="default">$c </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$c </span><span class="keyword">&lt; </span><span class="default">$len</span><span class="keyword">; </span><span class="default">$c</span><span class="keyword">++)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$char </span><span class="keyword">= </span><span class="default">$json</span><span class="keyword">[</span><span class="default">$c</span><span class="keyword">];
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; switch(</span><span class="default">$char</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'{'</span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'['</span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(!</span><span class="default">$in_string</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_json </span><span class="keyword">.= </span><span class="default">$char </span><span class="keyword">. </span><span class="string">"\n" </span><span class="keyword">. </span><span class="default">str_repeat</span><span class="keyword">(</span><span class="default">$tab</span><span class="keyword">, </span><span class="default">$indent_level</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$indent_level</span><span class="keyword">++;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_json </span><span class="keyword">.= </span><span class="default">$char</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'}'</span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">']'</span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(!</span><span class="default">$in_string</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$indent_level</span><span class="keyword">--;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_json </span><span class="keyword">.= </span><span class="string">"\n" </span><span class="keyword">. </span><span class="default">str_repeat</span><span class="keyword">(</span><span class="default">$tab</span><span class="keyword">, </span><span class="default">$indent_level</span><span class="keyword">) . </span><span class="default">$char</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_json </span><span class="keyword">.= </span><span class="default">$char</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">','</span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(!</span><span class="default">$in_string</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_json </span><span class="keyword">.= </span><span class="string">",\n" </span><span class="keyword">. </span><span class="default">str_repeat</span><span class="keyword">(</span><span class="default">$tab</span><span class="keyword">, </span><span class="default">$indent_level</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_json </span><span class="keyword">.= </span><span class="default">$char</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">':'</span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(!</span><span class="default">$in_string</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_json </span><span class="keyword">.= </span><span class="string">": "</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_json </span><span class="keyword">.= </span><span class="default">$char</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'"'</span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$c </span><span class="keyword">&gt; </span><span class="default">0 </span><span class="keyword">&amp;&amp; </span><span class="default">$json</span><span class="keyword">[</span><span class="default">$c</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">] != </span><span class="string">'\\'</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$in_string </span><span class="keyword">= !</span><span class="default">$in_string</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; default:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_json </span><span class="keyword">.= </span><span class="default">$char</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$new_json</span><span class="keyword">;
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="78719""></a>
  <div class="note">
   <strong class="user">jjoss</strong>
   <a href="#78719" class="date">24-Oct-2007 09:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Another way to work with Russian characters. This procedure just handles Cyrillic characters without UTF conversion. Thanks to JsHttpRequest developers.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">php2js</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">=</span><span class="default">false</span><span class="keyword">)<br />
{<br />
&nbsp; if (</span><span class="default">is_null</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">)) return </span><span class="string">'null'</span><span class="keyword">;<br />
&nbsp; if (</span><span class="default">$a </span><span class="keyword">=== </span><span class="default">false</span><span class="keyword">) return </span><span class="string">'false'</span><span class="keyword">;<br />
&nbsp; if (</span><span class="default">$a </span><span class="keyword">=== </span><span class="default">true</span><span class="keyword">) return </span><span class="string">'true'</span><span class="keyword">;<br />
&nbsp; if (</span><span class="default">is_scalar</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">))<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">is_float</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="comment">// Always use "." for floats.<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$a </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">","</span><span class="keyword">, </span><span class="string">"."</span><span class="keyword">, </span><span class="default">strval</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// All scalars are converted to strings to avoid indeterminism.<br />
&nbsp;&nbsp;&nbsp; // PHP's "1" and 1 are equal for all PHP operators, but<br />
&nbsp;&nbsp;&nbsp; // JS's "1" and 1 are not. So if we pass "1" or 1 from the PHP backend,<br />
&nbsp;&nbsp;&nbsp; // we should get the same result in the JS frontend (string).<br />
&nbsp;&nbsp;&nbsp; // Character replacements for JSON.<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">static </span><span class="default">$jsonReplaces </span><span class="keyword">= array(array(</span><span class="string">"\\"</span><span class="keyword">, </span><span class="string">"/"</span><span class="keyword">, </span><span class="string">"\n"</span><span class="keyword">, </span><span class="string">"\t"</span><span class="keyword">, </span><span class="string">"\r"</span><span class="keyword">, </span><span class="string">"\b"</span><span class="keyword">, </span><span class="string">"\f"</span><span class="keyword">, </span><span class="string">'"'</span><span class="keyword">),<br />
&nbsp;&nbsp;&nbsp; array(</span><span class="string">'\\\\'</span><span class="keyword">, </span><span class="string">'\\/'</span><span class="keyword">, </span><span class="string">'\\n'</span><span class="keyword">, </span><span class="string">'\\t'</span><span class="keyword">, </span><span class="string">'\\r'</span><span class="keyword">, </span><span class="string">'\\b'</span><span class="keyword">, </span><span class="string">'\\f'</span><span class="keyword">, </span><span class="string">'\"'</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; return </span><span class="string">'"' </span><span class="keyword">. </span><span class="default">str_replace</span><span class="keyword">(</span><span class="default">$jsonReplaces</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="default">$jsonReplaces</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">], </span><span class="default">$a</span><span class="keyword">) . </span><span class="string">'"'</span><span class="keyword">;<br />
&nbsp; }<br />
&nbsp; </span><span class="default">$isList </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />
&nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">, </span><span class="default">reset</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">); </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">count</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">); </span><span class="default">$i</span><span class="keyword">++, </span><span class="default">next</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">))<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">key</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">) !== </span><span class="default">$i</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$isList </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
&nbsp; </span><span class="default">$result </span><span class="keyword">= array();<br />
&nbsp; if (</span><span class="default">$isList</span><span class="keyword">)<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$a </span><span class="keyword">as </span><span class="default">$v</span><span class="keyword">) </span><span class="default">$result</span><span class="keyword">[] = </span><span class="default">php2js</span><span class="keyword">(</span><span class="default">$v</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="string">'[ ' </span><span class="keyword">. </span><span class="default">join</span><span class="keyword">(</span><span class="string">', '</span><span class="keyword">, </span><span class="default">$result</span><span class="keyword">) . </span><span class="string">' ]'</span><span class="keyword">;<br />
&nbsp; }<br />
&nbsp; else<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$a </span><span class="keyword">as </span><span class="default">$k </span><span class="keyword">=&gt; </span><span class="default">$v</span><span class="keyword">) </span><span class="default">$result</span><span class="keyword">[] = </span><span class="default">php2js</span><span class="keyword">(</span><span class="default">$k</span><span class="keyword">).</span><span class="string">': '</span><span class="keyword">.</span><span class="default">php2js</span><span class="keyword">(</span><span class="default">$v</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="string">'{ ' </span><span class="keyword">. </span><span class="default">join</span><span class="keyword">(</span><span class="string">', '</span><span class="keyword">, </span><span class="default">$result</span><span class="keyword">) . </span><span class="string">' }'</span><span class="keyword">;<br />
&nbsp; }<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="78688""></a>
  <div class="note">
   <strong class="user">jfdsmit at gmail dot com</strong>
   <a href="#78688" class="date">23-Oct-2007 04:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
json_encode also won't handle objects that do not directly expose their internals but through the Iterator interface. These two function will take care of that:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">/**<br />
&nbsp;* Convert an object into an associative array<br />
&nbsp;*<br />
&nbsp;* This function converts an object into an associative array by iterating<br />
&nbsp;* over its public properties. Because this function uses the foreach<br />
&nbsp;* construct, Iterators are respected. It also works on arrays of objects.<br />
&nbsp;*<br />
&nbsp;* @return array<br />
&nbsp;*/<br />
</span><span class="keyword">function </span><span class="default">object_to_array</span><span class="keyword">(</span><span class="default">$var</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">= array();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$references </span><span class="keyword">= array();<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// loop over elements/properties<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">foreach (</span><span class="default">$var </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// recursively convert objects<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">is_object</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">) || </span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// but prevent cycles<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (!</span><span class="default">in_array</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">, </span><span class="default">$references</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">] = </span><span class="default">object_to_array</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$references</span><span class="keyword">[] = </span><span class="default">$value</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// simple values are untouched<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">] = </span><span class="default">$value</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$result</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="comment">/**<br />
&nbsp;* Convert a value to JSON<br />
&nbsp;*<br />
&nbsp;* This function returns a JSON representation of $param. It uses json_encode<br />
&nbsp;* to accomplish this, but converts objects and arrays containing objects to<br />
&nbsp;* associative arrays first. This way, objects that do not expose (all) their<br />
&nbsp;* properties directly but only through an Iterator interface are also encoded<br />
&nbsp;* correctly.<br />
&nbsp;*/<br />
</span><span class="keyword">function </span><span class="default">json_encode2</span><span class="keyword">(</span><span class="default">$param</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">is_object</span><span class="keyword">(</span><span class="default">$param</span><span class="keyword">) || </span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$param</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$param </span><span class="keyword">= </span><span class="default">object_to_array</span><span class="keyword">(</span><span class="default">$param</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">json_encode</span><span class="keyword">(</span><span class="default">$param</span><span class="keyword">);<br />
}</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77367""></a>
  <div class="note">
   <strong class="user">dennispopel(at)gmail.com</strong>
   <a href="#77367" class="date">26-Aug-2007 07:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Obviously, this function has trouble encoding arrays with empty string keys (''). I have just noticed that (because I was using a function in PHP under PHP4). When I switched to PHP5's json_encode, I noticed that browsers could not correctly parse the encoded data. More investigation maybe needed for a bug report, but this quick note may save somebody several hours.<br />
<br />
Also, it manifests on Linux in 5.2.1 (tested on two boxes), on my XP with PHP5.2.3 json_encode() works just great! However, both 5.2.1 and 5.2.3 phpinfo()s show that the json version is 1.2.1 so might be Linux issue</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74878""></a>
  <div class="note">
   <strong class="user">Yi-Ren Chen at NCTU CSIE</strong>
   <a href="#74878" class="date">02-May-2007 06:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I write a function "php_json_encode" <br />
for early version of php which support "multibyte" but doesn't support "json_encode".<br />
<span class="default">&lt;?php<br />
&nbsp; </span><span class="keyword">function </span><span class="default">json_encode_string</span><span class="keyword">(</span><span class="default">$in_str</span><span class="keyword">)<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">mb_internal_encoding</span><span class="keyword">(</span><span class="string">"UTF-8"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$convmap </span><span class="keyword">= array(</span><span class="default">0x80</span><span class="keyword">, </span><span class="default">0xFFFF</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0xFFFF</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$str </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">mb_strlen</span><span class="keyword">(</span><span class="default">$in_str</span><span class="keyword">)-</span><span class="default">1</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">&gt;=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">--)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$mb_char </span><span class="keyword">= </span><span class="default">mb_substr</span><span class="keyword">(</span><span class="default">$in_str</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; if(</span><span class="default">mb_ereg</span><span class="keyword">(</span><span class="string">"&amp;#(\\d+);"</span><span class="keyword">, </span><span class="default">mb_encode_numericentity</span><span class="keyword">(</span><span class="default">$mb_char</span><span class="keyword">, </span><span class="default">$convmap</span><span class="keyword">, </span><span class="string">"UTF-8"</span><span class="keyword">), </span><span class="default">$match</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$str </span><span class="keyword">= </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">"\\u%04x"</span><span class="keyword">, </span><span class="default">$match</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]) . </span><span class="default">$str</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$str </span><span class="keyword">= </span><span class="default">$mb_char </span><span class="keyword">. </span><span class="default">$str</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$str</span><span class="keyword">;<br />
&nbsp; }<br />
&nbsp; function </span><span class="default">php_json_encode</span><span class="keyword">(</span><span class="default">$arr</span><span class="keyword">)<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$json_str </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$arr</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$pure_array </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$array_length </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$arr</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">$array_length</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">++)<br />
&nbsp;&nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(! isset(</span><span class="default">$arr</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pure_array </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; if(</span><span class="default">$pure_array</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$json_str </span><span class="keyword">=</span><span class="string">"["</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$temp </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">$array_length</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">++)&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$temp</span><span class="keyword">[] = </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">"%s"</span><span class="keyword">, </span><span class="default">php_json_encode</span><span class="keyword">(</span><span class="default">$arr</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$json_str </span><span class="keyword">.= </span><span class="default">implode</span><span class="keyword">(</span><span class="string">","</span><span class="keyword">,</span><span class="default">$temp</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$json_str </span><span class="keyword">.=</span><span class="string">"]"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$json_str </span><span class="keyword">=</span><span class="string">"{"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$temp </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$arr </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$temp</span><span class="keyword">[] = </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">"\"%s\":%s"</span><span class="keyword">, </span><span class="default">$key</span><span class="keyword">, </span><span class="default">php_json_encode</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$json_str </span><span class="keyword">.= </span><span class="default">implode</span><span class="keyword">(</span><span class="string">","</span><span class="keyword">,</span><span class="default">$temp</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$json_str </span><span class="keyword">.=</span><span class="string">"}"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; else<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; if(</span><span class="default">is_string</span><span class="keyword">(</span><span class="default">$arr</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$json_str </span><span class="keyword">= </span><span class="string">"\""</span><span class="keyword">. </span><span class="default">json_encode_string</span><span class="keyword">(</span><span class="default">$arr</span><span class="keyword">) . </span><span class="string">"\""</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; else if(</span><span class="default">is_numeric</span><span class="keyword">(</span><span class="default">$arr</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$json_str </span><span class="keyword">= </span><span class="default">$arr</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$json_str </span><span class="keyword">= </span><span class="string">"\""</span><span class="keyword">. </span><span class="default">json_encode_string</span><span class="keyword">(</span><span class="default">$arr</span><span class="keyword">) . </span><span class="string">"\""</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$json_str</span><span class="keyword">;<br />
&nbsp; }</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69393""></a>
  <div class="note">
   <strong class="user">giunta dot gaetano at sea-aeroportimilano dot it</strong>
   <a href="#69393" class="date">04-Sep-2006 05:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Take care that json_encode() expects strings to be encoded to be in UTF8 format, while by default PHP strings are ISO-8859-1 encoded.<br />
This means that <br />
<br />
json_encode(array('àü'));<br />
<br />
will produce a json representation of an empty string, while<br />
<br />
json_encode(array(utf8_encode('àü')));<br />
<br />
will work.<br />
The same applies to decoding, too, of course...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
