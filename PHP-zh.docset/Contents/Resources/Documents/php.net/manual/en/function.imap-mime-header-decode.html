<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>Decode MIME header elements</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.imap-mailboxmsginfo.html">? imap_mailboxmsginfo</a></li>
      <li style="float: right;"><a href="function.imap-msgno.html">imap_msgno ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.imap.html">IMAP 函数</a></li>
    <li>Decode MIME header elements</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.imap-mime-header-decode" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">imap_mime_header_decode</h1>
  <p class="verinfo">(PHP 4, PHP 5, PHP 7)</p><p class="refpurpose"><span class="refname">imap_mime_header_decode</span> &mdash; <span class="dc-title">Decode MIME header elements</span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.imap-mime-header-decode-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">array</span> <span class="methodname"><strong>imap_mime_header_decode</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$text</code></span>
   )</div>

  <p class="para rdfs-comment">
   Decodes MIME message header extensions that are non ASCII text (see <a href="http://www.faqs.org/rfcs/rfc2047" class="link external" title="Link : http://www.faqs.org/rfcs/rfc2047">&raquo;&nbsp;RFC2047</a>).
  </p>
 </div>

 <div class="refsect1 parameters" id="refsect1-function.imap-mime-header-decode-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">text</code></dt>

     <dd>

      <p class="para">
       The MIME text
      </p>
     </dd>

    
   </dl>

  </p>
 </div>

 <div class="refsect1 returnvalues" id="refsect1-function.imap-mime-header-decode-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   The decoded elements are returned in an array of objects, where each
   object has two properties, <em>charset</em> and 
   <em>text</em>.
  </p>
  <p class="para">
   If the element hasn&#039;t been encoded, and in other words is in
   plain US-ASCII, the <em>charset</em> property of that element is
   set to <em>default</em>.
  </p>
 </div>

 <div class="refsect1 examples" id="refsect1-function.imap-mime-header-decode-examples">
  <h3 class="title">范例</h3>
  <p class="para">
   <div class="example" id="example-3747">
    <p><strong>Example #1 <span class="function"><strong>imap_mime_header_decode()</strong></span> example</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$text&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"=?ISO-8859-1?Q?Keld_J=F8rn_Simonsen?=&nbsp;&lt;keld@example.com&gt;"</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$elements&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">imap_mime_header_decode</span><span style="color: #007700">(</span><span style="color: #0000BB">$text</span><span style="color: #007700">);<br />for&nbsp;(</span><span style="color: #0000BB">$i</span><span style="color: #007700">=</span><span style="color: #0000BB">0</span><span style="color: #007700">;&nbsp;</span><span style="color: #0000BB">$i</span><span style="color: #007700">&lt;</span><span style="color: #0000BB">count</span><span style="color: #007700">(</span><span style="color: #0000BB">$elements</span><span style="color: #007700">);&nbsp;</span><span style="color: #0000BB">$i</span><span style="color: #007700">++)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"Charset:&nbsp;</span><span style="color: #007700">{</span><span style="color: #0000BB">$elements</span><span style="color: #007700">[</span><span style="color: #0000BB">$i</span><span style="color: #007700">]-&gt;</span><span style="color: #0000BB">charset</span><span style="color: #007700">}</span><span style="color: #DD0000">\n"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"Text:&nbsp;</span><span style="color: #007700">{</span><span style="color: #0000BB">$elements</span><span style="color: #007700">[</span><span style="color: #0000BB">$i</span><span style="color: #007700">]-&gt;</span><span style="color: #0000BB">text</span><span style="color: #007700">}</span><span style="color: #DD0000">\n\n"</span><span style="color: #007700">;<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>以上例程会输出：</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
Charset: ISO-8859-1
Text: Keld J?rn Simonsen

Charset: default
Text:  &lt;keld@example.com&gt;
</pre></div>
    </div>
   </div>
  </p>
  <p class="para">
   In the above example we would have two elements, whereas the first
   element had previously been encoded with ISO-8859-1, and the second
   element would be plain US-ASCII.
  </p>
 </div>

 <div class="refsect1 seealso" id="refsect1-function.imap-mime-header-decode-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.imap-utf8.html" class="function" rel="rdfs-seeAlso">imap_utf8()</a> - Converts MIME-encoded text to UTF-8</span></li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="115791""></a>
  <div class="note">
   <strong class="user">paolo dot ceccacci at gmail dot com</strong>
   <a href="#115791" class="date">24-Sep-2014 05:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's a "flatMimeDecode" version converting UTF-8 to iso-8859-1:<br />
<br />
function flatMimeDecode($string) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $array = imap_mime_header_decode ($string);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $str = "";<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach ($array as $key =&gt; $part) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if($part-&gt;charset == "UTF-8"){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $str .= utf8_decode ($part-&gt;text);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }else{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $str .= $part-&gt;text;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return $str;<br />
&nbsp;&nbsp;&nbsp; }</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="111564""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#111564" class="date">05-Mar-2013 06:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A nice way to decode strings is to use the mb_list_encodings(), but I had two problems with it: <br />
sometimes, the charset is uppercase in the header an lowercase in mb_list_encodings() and sometimes, the charset is not in the mb_list_encodings() list.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">upperListEncode</span><span class="keyword">() { </span><span class="comment">//convert mb_list_encodings() to uppercase<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$encodes</span><span class="keyword">=</span><span class="default">mb_list_encodings</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$encodes </span><span class="keyword">as </span><span class="default">$encode</span><span class="keyword">) </span><span class="default">$tencode</span><span class="keyword">[]=</span><span class="default">strtoupper</span><span class="keyword">(</span><span class="default">$encode</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$tencode</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
function </span><span class="default">decode</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$tabChaine</span><span class="keyword">=</span><span class="default">imap_mime_header_decode</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$texte</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">count</span><span class="keyword">(</span><span class="default">$tabChaine</span><span class="keyword">); </span><span class="default">$i</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; switch (</span><span class="default">strtoupper</span><span class="keyword">(</span><span class="default">$tabChaine</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]-&gt;</span><span class="default">charset</span><span class="keyword">)) { </span><span class="comment">//convert charset to uppercase<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">case </span><span class="string">'UTF-8'</span><span class="keyword">: </span><span class="default">$texte</span><span class="keyword">.= </span><span class="default">$tabChaine</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]-&gt;</span><span class="default">text</span><span class="keyword">; </span><span class="comment">//utf8 is ok<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'DEFAULT'</span><span class="keyword">: </span><span class="default">$texte</span><span class="keyword">.= </span><span class="default">$tabChaine</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]-&gt;</span><span class="default">text</span><span class="keyword">; </span><span class="comment">//no convert<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; default: if (</span><span class="default">in_array</span><span class="keyword">(</span><span class="default">strtoupper</span><span class="keyword">(</span><span class="default">$tabChaine</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]-&gt;</span><span class="default">charset</span><span class="keyword">),</span><span class="default">upperListEncode</span><span class="keyword">())) </span><span class="comment">//found in mb_list_encodings()<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">{</span><span class="default">$texte</span><span class="keyword">.= </span><span class="default">mb_convert_encoding</span><span class="keyword">(</span><span class="default">$tabChaine</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]-&gt;</span><span class="default">text</span><span class="keyword">,</span><span class="string">'UTF-8'</span><span class="keyword">,</span><span class="default">$tabChaine</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]-&gt;</span><span class="default">charset</span><span class="keyword">);}<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else { </span><span class="comment">//try to convert with iconv()<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ret </span><span class="keyword">= </span><span class="default">iconv</span><span class="keyword">(</span><span class="default">$tabChaine</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]-&gt;</span><span class="default">charset</span><span class="keyword">, </span><span class="string">"UTF-8"</span><span class="keyword">, </span><span class="default">$tabChaine</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]-&gt;</span><span class="default">text</span><span class="keyword">);&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">$ret</span><span class="keyword">) </span><span class="default">$texte</span><span class="keyword">.=</span><span class="default">$tabChaine</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]-&gt;</span><span class="default">text</span><span class="keyword">;&nbsp; </span><span class="comment">//an error occurs (unknown charset) <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">else </span><span class="default">$texte</span><span class="keyword">.=</span><span class="default">$ret</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$texte</span><span class="keyword">;&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84894""></a>
  <div class="note">
   <strong class="user">kai at froghh dot de</strong>
   <a href="#84894" class="date">04-Aug-2008 06:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Beware of multilined subjects containing whitespaces which are not part of the subject itself, but needed as functional characters for the clients.<br />
<br />
i.e. you can have a mail header containing content like<br />
Subject: =?iso-8859-1?Q?WG=3A_Mobilit=E4t_verschlechtert_--=3E_174?=<br />
&nbsp;&nbsp;&nbsp; =?iso-8859-1?Q?6?=<br />
<br />
(carriage return and tabspace).<br />
imap_mime_header_decode returns 5 parts (and not expected 2)<br />
for this example.<br />
- The first containing the space between "subject:" and the subject itself.<br />
- The second is the first encoded text<br />
- The third will be the line-break within the head lines.<br />
The were inserted to keep rfc compliant line length and are NOT part of the original subject entered by the sender.<br />
- The fourth will be the second part of the subject.<br />
- The fifth is a line break - the last character will be a line break any time other head lines or mailbody will follow, so it's needed in the head - but not part of the original subject.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="79901""></a>
  <div class="note">
   <strong class="user">s dot wiese at trabia dot md</strong>
   <a href="#79901" class="date">18-Dec-2007 10:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The example of diego is working well, he has a (very) little<br />
mistake in his code. Here is the corrected version:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">//return supported encodings in lowercase.<br />
</span><span class="keyword">function </span><span class="default">mb_list_lowerencodings</span><span class="keyword">() { </span><span class="default">$r</span><span class="keyword">=</span><span class="default">mb_list_encodings</span><span class="keyword">();<br />
&nbsp; for (</span><span class="default">$n</span><span class="keyword">=</span><span class="default">sizeOf</span><span class="keyword">(</span><span class="default">$r</span><span class="keyword">); </span><span class="default">$n</span><span class="keyword">--; ) { </span><span class="default">$r</span><span class="keyword">[</span><span class="default">$n</span><span class="keyword">]=</span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">$r</span><span class="keyword">[</span><span class="default">$n</span><span class="keyword">]); } return </span><span class="default">$r</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="comment">//&nbsp; Receive a string with a mail header and returns it<br />
// decoded to a specified charset.<br />
// If the charset specified into a piece of text from header<br />
// isn't supported by "mb", the "fallbackCharset" will be<br />
// used to try to decode it.<br />
</span><span class="keyword">function </span><span class="default">decodeMimeString</span><span class="keyword">(</span><span class="default">$mimeStr</span><span class="keyword">, </span><span class="default">$inputCharset</span><span class="keyword">=</span><span class="string">'utf-8'</span><span class="keyword">, </span><span class="default">$targetCharset</span><span class="keyword">=</span><span class="string">'utf-8'</span><span class="keyword">, </span><span class="default">$fallbackCharset</span><span class="keyword">=</span><span class="string">'iso-8859-1'</span><span class="keyword">) {<br />
&nbsp; </span><span class="default">$encodings</span><span class="keyword">=</span><span class="default">mb_list_lowerencodings</span><span class="keyword">();<br />
&nbsp; </span><span class="default">$inputCharset</span><span class="keyword">=</span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">$inputCharset</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$targetCharset</span><span class="keyword">=</span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">$targetCharset</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$fallbackCharset</span><span class="keyword">=</span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">$fallbackCharset</span><span class="keyword">);<br />
<br />
&nbsp; </span><span class="default">$decodedStr</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$mimeStrs</span><span class="keyword">=</span><span class="default">imap_mime_header_decode</span><span class="keyword">(</span><span class="default">$mimeStr</span><span class="keyword">);<br />
&nbsp; for (</span><span class="default">$n</span><span class="keyword">=</span><span class="default">sizeOf</span><span class="keyword">(</span><span class="default">$mimeStrs</span><span class="keyword">), </span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">$n</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$mimeStr</span><span class="keyword">=</span><span class="default">$mimeStrs</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$mimeStr</span><span class="keyword">-&gt;</span><span class="default">charset</span><span class="keyword">=</span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">$mimeStr</span><span class="keyword">-&gt;</span><span class="default">charset</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if ((</span><span class="default">$mimeStr </span><span class="keyword">== </span><span class="string">'default' </span><span class="keyword">&amp;&amp; </span><span class="default">$inputCharset </span><span class="keyword">== </span><span class="default">$targetCharset</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp;&nbsp; || </span><span class="default">$mimStr</span><span class="keyword">-&gt;</span><span class="default">charset </span><span class="keyword">== </span><span class="default">$targetCharset</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$decodedStr</span><span class="keyword">.=</span><span class="default">$mimStr</span><span class="keyword">-&gt;</span><span class="default">text</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$decodedStr</span><span class="keyword">.=</span><span class="default">mb_convert_encoding</span><span class="keyword">(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$mimeStr</span><span class="keyword">-&gt;</span><span class="default">text</span><span class="keyword">, </span><span class="default">$targetCharset</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (</span><span class="default">in_array</span><span class="keyword">(</span><span class="default">$mimeStr</span><span class="keyword">-&gt;</span><span class="default">charset</span><span class="keyword">, </span><span class="default">$encodings</span><span class="keyword">) ?<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$mimeStr</span><span class="keyword">-&gt;</span><span class="default">charset </span><span class="keyword">: </span><span class="default">$fallbackCharset</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
&nbsp;&nbsp; &nbsp;&nbsp; );<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; } return </span><span class="default">$decodedStr</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71762""></a>
  <div class="note">
   <strong class="user">diego nunes &lt;dn at nospam dot dnunes dot com&gt;</strong>
   <a href="#71762" class="date">14-Dec-2006 07:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The previous comment (from hans) seems to make no sense at all, since it will not change the encoding and possibly result in a "multiencoding" string (that the browser and anything else will be unable to render, of course).<br />
<br />
&nbsp;&nbsp;&nbsp; I use a little function to decode the whole header to a specified encoding. It is as follow:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">//return supported encodings in lowercase.<br />
</span><span class="keyword">function </span><span class="default">mb_list_lowerencodings</span><span class="keyword">() { </span><span class="default">$r</span><span class="keyword">=</span><span class="default">mb_list_encodings</span><span class="keyword">();<br />
&nbsp; for (</span><span class="default">$n</span><span class="keyword">=</span><span class="default">sizeOf</span><span class="keyword">(</span><span class="default">$r</span><span class="keyword">); </span><span class="default">$n</span><span class="keyword">--; ) { </span><span class="default">$r</span><span class="keyword">[</span><span class="default">$n</span><span class="keyword">]=</span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">$r</span><span class="keyword">[</span><span class="default">$n</span><span class="keyword">]); } return </span><span class="default">$r</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="comment">//&nbsp; Receive a string with a mail header and returns it<br />
// decoded to a specified charset.<br />
// If the charset specified into a piece of text from header<br />
// isn't supported by "mb", the "fallbackCharset" will be<br />
// used to try to decode it.<br />
</span><span class="keyword">function </span><span class="default">decodeMimeString</span><span class="keyword">(</span><span class="default">$mimeStr</span><span class="keyword">, </span><span class="default">$inputCharset</span><span class="keyword">=</span><span class="string">'utf-8'</span><span class="keyword">, </span><span class="default">$targetCharset</span><span class="keyword">=</span><span class="string">'utf-8'</span><span class="keyword">, </span><span class="default">$fallbackCharset</span><span class="keyword">=</span><span class="string">'iso-8859-1'</span><span class="keyword">) {<br />
&nbsp; </span><span class="default">$encodings</span><span class="keyword">=</span><span class="default">mb_list_lowerencodings</span><span class="keyword">();<br />
&nbsp; </span><span class="default">$inputCharset</span><span class="keyword">=</span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">$inputCharset</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$targetCharset</span><span class="keyword">=</span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">$targetCharset</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$fallbackCharset</span><span class="keyword">=</span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">$fallbackCharset</span><span class="keyword">);<br />
<br />
&nbsp; </span><span class="default">$decodedStr</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$mimeStrs</span><span class="keyword">=</span><span class="default">imap_mime_header_decode</span><span class="keyword">(</span><span class="default">$mimeStr</span><span class="keyword">);<br />
&nbsp; for (</span><span class="default">$n</span><span class="keyword">=</span><span class="default">sizeOf</span><span class="keyword">(</span><span class="default">$mimeStrs</span><span class="keyword">), </span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">$n</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$mimeStr</span><span class="keyword">=</span><span class="default">$mimeStrs</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$mimeStr</span><span class="keyword">-&gt;</span><span class="default">charset</span><span class="keyword">=</span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">$mimeStr</span><span class="keyword">-&gt;</span><span class="default">charset</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if ((</span><span class="default">$mimeStr </span><span class="keyword">== </span><span class="string">'default' </span><span class="keyword">&amp;&amp; </span><span class="default">$inputCharset </span><span class="keyword">== </span><span class="default">$targetCharset</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp;&nbsp; || </span><span class="default">$mimStr</span><span class="keyword">-&gt;</span><span class="default">charset </span><span class="keyword">== </span><span class="default">$targetCharset</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$decodedStr</span><span class="keyword">.=</span><span class="default">$mimStr</span><span class="keyword">-&gt;</span><span class="default">text</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$decodedStr</span><span class="keyword">.=</span><span class="default">mb_convert_encoding</span><span class="keyword">(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$mimeStr</span><span class="keyword">-&gt;</span><span class="default">text</span><span class="keyword">, </span><span class="default">$targetCharset</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (</span><span class="default">in_array</span><span class="keyword">(</span><span class="default">$mimeStr</span><span class="keyword">-&gt;</span><span class="default">charset</span><span class="keyword">, </span><span class="default">$encodings</span><span class="keyword">) ?<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$mimeStr</span><span class="keyword">-&gt;</span><span class="default">charset </span><span class="keyword">: </span><span class="default">$fallbackCharset</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
&nbsp;&nbsp; &nbsp;&nbsp; );<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; } return </span><span class="default">$decodedStr</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
&nbsp;&nbsp;&nbsp; Hope it helps.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="60003""></a>
  <div class="note">
   <strong class="user">hans at lintoo dot dk</strong>
   <a href="#60003" class="date">22-Dec-2005 03:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is obvious, but nevertheless here is a "flat" version:<br />
<span class="default">&lt;?php&nbsp; &nbsp; <br />
</span><span class="keyword">private function </span><span class="default">flatMimeDecode</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$array </span><span class="keyword">= </span><span class="default">imap_mime_header_decode</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$str </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$array </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$part</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$str </span><span class="keyword">.= </span><span class="default">$part</span><span class="keyword">-&gt;</span><span class="default">text</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$str</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="50230""></a>
  <div class="note">
   <strong class="user">cracker at bigcracker dot ca</strong>
   <a href="#50230" class="date">22-Feb-2005 01:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In response to Sven dot Dickert at planb dot de: if you encounter problems with "=?utf-8?Q?" appearing in your headers, I found that simply using "imap_utf8($string)" decoded the "$string" properly and solved my problem perfectly.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="41803""></a>
  <div class="note">
   <strong class="user">Pawel Tomicki &lt;pafka at klub dot chip dot pl&gt;</strong>
   <a href="#41803" class="date">22-Apr-2004 08:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php
<br />

<br />
</span><span class="keyword">function </span><span class="default">decode_iso88591</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">){
<br />
&nbsp; if (</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">), </span><span class="string">'=?iso-8859-1'</span><span class="keyword">) === </span><span class="default">false</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$string</span><span class="keyword">;
<br />
&nbsp; }
<br />
&nbsp; </span><span class="default">$string </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">'?'</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">);
<br />
&nbsp; return </span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]) == </span><span class="string">'q' </span><span class="keyword">? </span><span class="default">quoted_printable_decode</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">]) : </span><span class="default">base64_decode</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">]);
<br />
}
<br />

<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="37781""></a>
  <div class="note">
   <strong class="user">mattias at forss dot se</strong>
   <a href="#37781" class="date">27-Nov-2003 04:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This function does not code a-z 0-9 like the function posted by bandpay at hotmail dot com<br />
<br />
function encode_iso88591($string) {<br />
&nbsp;&nbsp;&nbsp; if( ereg("[^A-Za-z0-9\ ]", $string) ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $text = "=?iso-8859-1?q?";<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for( $i = 0 ; $i &lt; strlen($string) ; $i++ ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if( ereg("[^A-Za-z0-9]", $string[$i]) ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $text .= "=".dechex(ord($string[$i]));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $text .= $string[$i];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return $text."?=";<br />
&nbsp;&nbsp;&nbsp; } else&nbsp; &nbsp;&nbsp; return $string;<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="28084""></a>
  <div class="note">
   <strong class="user">hdlim at kis21 dot com</strong>
   <a href="#28084" class="date">01-Jan-2003 07:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
imap_mime_header_decode, utf-7 and utf-8 problem, i solved the problem using below function. note that iconv function for code converting.
<br />
you must replace "EUC-KR" as iconv parameter with charset you want such as "iso-8859-1".
<br />

<br />
function mime_decode($s) {
<br />
&nbsp; $elements = imap_mime_header_decode($s);
<br />
&nbsp; for($i = 0;$i &lt; count($elements);$i++) {
<br />
&nbsp;&nbsp;&nbsp; $charset = $elements[$i]-&gt;charset;
<br />
&nbsp;&nbsp;&nbsp; $text =$elements[$i]-&gt;text;
<br />
&nbsp;&nbsp;&nbsp; if(!strcasecmp($charset, "utf-8") ||
<br />
&nbsp;&nbsp; &nbsp; &nbsp; !strcasecmp($charset, "utf-7"))
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp;&nbsp; $text = iconv($charset, "EUC-KR", $text);
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; $decoded = $decoded . $text;
<br />
&nbsp; }
<br />
&nbsp; return $decoded;
<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="21535""></a>
  <div class="note">
   <strong class="user">Sven dot Dickert at planb dot de</strong>
   <a href="#21535" class="date">16-May-2002 03:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Beware! imap_mime_header_decode in 4.0.6 is _not_ RFC2047 conform. The string =?utf-7?Q?Petra_M+APw-ller?= will not converted into Petra M?ller cause the charset utf7 is unknown.&nbsp; Same goes to =?utf-8?Q?Petra_M=C3=BCller?= for charset utf8.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="14745""></a>
  <div class="note">
   <strong class="user">charsyam at liso dot cs dot pusan dot ac dot kr</strong>
   <a href="#14745" class="date">13-Aug-2001 05:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I wrote a simple ks_c_5601-1987(2byte)
<br />
encode
<br />

<br />
function encode_ksc5601( $string )
<br />
{
<br />
&nbsp;$encode = base64_encode( $string );
<br />
&nbsp;$text = "=?ks_c_5601-1987?B?";
<br />
&nbsp;$text = $text.$encode."?=";
<br />
&nbsp;return $text;
<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
