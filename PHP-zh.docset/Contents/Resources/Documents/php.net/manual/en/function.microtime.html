<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>返回当前 Unix 时间戳和微秒数</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.localtime.html">? localtime</a></li>
      <li style="float: right;"><a href="function.mktime.html">mktime ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.datetime.html">Date/Time 函数</a></li>
    <li>返回当前 Unix 时间戳和微秒数</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.microtime" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">microtime</h1>
  <p class="verinfo">(PHP 4, PHP 5)</p><p class="refpurpose"><span class="refname">microtime</span> &mdash; <span class="dc-title">返回当前 Unix 时间戳和微秒数</span></p>

 </div>
 <div class="refsect1 unknown-seealsp" id="refsect1-function.microtime-unknown-seealsp">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type"><a href="language.pseudo-types.html#language.types.mixed" class="type mixed">mixed</a></span> <span class="methodname"><strong>microtime</strong></span>
    ([ <span class="methodparam"><span class="type">bool</span> <code class="parameter">$get_as_float</code></span>
  ] )</div>

  <p class="para rdfs-comment">
   <span class="function"><strong>microtime()</strong></span> 当前 Unix
   时间戳以及微秒数。本函数仅在支持 gettimeofday()
   系统调用的操作系统下可用。
  </p>
  <p class="para">
   如果调用时不带可选参数，本函数以 &quot;msec sec&quot;
   的格式返回一个字符串，其中 sec 是自 Unix 纪元（0:00:00 January 1,
   1970 GMT）起到现在的秒数，msec 是微秒部分。字符串的两部分都是以秒为单位返回的。
  </p>
  <p class="para">
   如果给出了 <code class="parameter">get_as_float</code> 参数并且其值等价于
   <strong><code>TRUE</code></strong>，<span class="function"><strong>microtime()</strong></span> 将返回一个浮点数。
  </p>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <span class="simpara">
    <code class="parameter">get_as_float</code> 参数是 PHP 5.0.0 新加的。
   </span>
  </p></blockquote>
  <p class="para">
   <div class="example" id="example-2327">
    <p><strong>Example #1 用 <span class="function"><strong>microtime()</strong></span> 对脚本的运行计时</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">/**<br />&nbsp;*&nbsp;Simple&nbsp;function&nbsp;to&nbsp;replicate&nbsp;PHP&nbsp;5&nbsp;behaviour<br />&nbsp;*/<br /></span><span style="color: #007700">function&nbsp;</span><span style="color: #0000BB">microtime_float</span><span style="color: #007700">()<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;list(</span><span style="color: #0000BB">$usec</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$sec</span><span style="color: #007700">)&nbsp;=&nbsp;</span><span style="color: #0000BB">explode</span><span style="color: #007700">(</span><span style="color: #DD0000">"&nbsp;"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">microtime</span><span style="color: #007700">());<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;((float)</span><span style="color: #0000BB">$usec&nbsp;</span><span style="color: #007700">+&nbsp;(float)</span><span style="color: #0000BB">$sec</span><span style="color: #007700">);<br />}<br /><br /></span><span style="color: #0000BB">$time_start&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">microtime_float</span><span style="color: #007700">();<br /><br /></span><span style="color: #FF8000">//&nbsp;Sleep&nbsp;for&nbsp;a&nbsp;while<br /></span><span style="color: #0000BB">usleep</span><span style="color: #007700">(</span><span style="color: #0000BB">100</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$time_end&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">microtime_float</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">$time&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$time_end&nbsp;</span><span style="color: #007700">-&nbsp;</span><span style="color: #0000BB">$time_start</span><span style="color: #007700">;<br /><br />echo&nbsp;</span><span style="color: #DD0000">"Did&nbsp;nothing&nbsp;in&nbsp;</span><span style="color: #0000BB">$time</span><span style="color: #DD0000">&nbsp;seconds\n"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
  <p class="para">
   参见 <span class="function"><a href="function.time.html" class="function">time()</a></span>。
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="116336""></a>
  <div class="note">
   <strong class="user">Endy from 281591 at qq dot com</strong>
   <a href="#116336" class="date">15-Dec-2014 02:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Following are tested under PHP 5.6.2:<br />
microtime() returns a string in the form "msec.sec" not "msec sec".<br />
<br />
So in Example #1, this line should be<br />
list ($usec, $sec) = explode(".", $e);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="113078""></a>
  <div class="note">
   <strong class="user">Daniel Rhodes</strong>
   <a href="#113078" class="date">27-Aug-2013 09:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
But note that the default 'precision' setting of PHP* - which is used when a float is converted to a stringy format by echo()ing, casting or json_encode()ing etc - is not enough to hold the six digit accuracy of microtime(true).<br />
<br />
Out of the box, microtime(true) will echo something like:<br />
<br />
1377611450.1234<br />
<br />
Which is obviously less than microsecond accuracy. You'll probably want to bump the 'precision' setting up to 16 which will echo something like:<br />
<br />
1377611450.123456<br />
<br />
*Internally* it will be accurate to the six digits even with the default 'precision', but a lot of things (ie. NoSQL databases) are moving to all-text representations these days so it becomes a bit more important.<br />
<br />
* 14 at the time of writing</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="112725""></a>
  <div class="note">
   <strong class="user">Nads</strong>
   <a href="#112725" class="date">17-Jul-2013 05:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Get date time with milliseconds<br />
<br />
$micro_date = microtime();<br />
$date_array = explode(" ",$micro_date);<br />
$date = date("Y-m-d H:i:s",$date_array[1]);<br />
echo "Date: $date:" . $date_array[0];<br />
<br />
Test accuracy by running it in a loop.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="112104""></a>
  <div class="note">
   <strong class="user">Russell G.</strong>
   <a href="#112104" class="date">04-May-2013 05:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that the timestamp returned is "with microseconds", not "in microseconds". This is especially good to know if you pass 'true' as the parameter and then calculate the difference between two float values -- the result is already in seconds; it doesn't need to be divided by a million.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="111107""></a>
  <div class="note">
   <strong class="user">player27</strong>
   <a href="#111107" class="date">16-Jan-2013 01:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You can use one variable to check execution $time as follow:
<br />

<br />
<span class="default">&lt;?php
<br />
$time </span><span class="keyword">= -</span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);
<br />
</span><span class="default">$hash </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br />
for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">rand</span><span class="keyword">(</span><span class="default">1000</span><span class="keyword">,</span><span class="default">4000</span><span class="keyword">); ++</span><span class="default">$i</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$hash </span><span class="keyword">^= </span><span class="default">md5</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">str_shuffle</span><span class="keyword">(</span><span class="string">"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"</span><span class="keyword">), </span><span class="default">0</span><span class="keyword">, </span><span class="default">rand</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">,</span><span class="default">10</span><span class="keyword">)));
<br />
}
<br />
</span><span class="default">$time </span><span class="keyword">+= </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);
<br />
echo </span><span class="string">"Hash: </span><span class="default">$hash</span><span class="string"> iterations:</span><span class="default">$i</span><span class="string"> time: "</span><span class="keyword">,</span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">'%f'</span><span class="keyword">, </span><span class="default">$time</span><span class="keyword">),</span><span class="default">PHP_EOL</span><span class="keyword">;
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="109826""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#109826" class="date">25-Aug-2012 12:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Observed in php 5.3.3 on CentOS 6 and php 5.3.14 on Amazon Linux 2012.03:<br />
<br />
microtime()'s string value is in the format "0.dddddd00 ddddd...".&nbsp; That is, there's room for 10-ns precision that isn't being used, and the "msec" value is in decimal, not a literal number of microseconds (and *especially* not milliseconds, which is what msec usually stands for) as the documentation might imply.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="108255""></a>
  <div class="note">
   <strong class="user">thomas</strong>
   <a href="#108255" class="date">12-Apr-2012 11:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I have been getting negative values substracting a later microtime(true) call from an earlier microtime(true) call on Windows with PHP 5.3.8<br />
<br />
Produces negative values<br />
------------------------------<br />
for($i = 0; $i&lt;100; $i++) {<br />
&nbsp;&nbsp;&nbsp; $x =&nbsp; microtime(true);<br />
&nbsp;&nbsp;&nbsp; //short calculation<br />
&nbsp;&nbsp;&nbsp; $y = microtime(true);<br />
&nbsp;&nbsp;&nbsp; echo ($y-$x) . "\n"; // &lt;--- mostly negatives<br />
}<br />
<br />
Calling usleep(1) seems to work<br />
---------------------------------------<br />
for($i = 0; $i&lt;100; $i++) {<br />
&nbsp;&nbsp;&nbsp; $x =&nbsp; microtime(true);<br />
&nbsp;&nbsp;&nbsp; //short calculation<br />
&nbsp;&nbsp;&nbsp; usleep(1);<br />
&nbsp;&nbsp;&nbsp; $y = microtime(true);<br />
&nbsp;&nbsp;&nbsp; echo ($y-$x) . "\n"; // &lt;--- fixed now<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="104053""></a>
  <div class="note">
   <strong class="user">langpavel at phpskelet dot org</strong>
   <a href="#104053" class="date">19-May-2011 10:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I use this for measure duration of script execution. This function should be defined (and of couse first call made) as soon as possible.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/**<br />
&nbsp;* get execution time in seconds at current point of call in seconds<br />
&nbsp;* @return float Execution time at this point of call<br />
&nbsp;*/<br />
</span><span class="keyword">function </span><span class="default">get_execution_time</span><span class="keyword">()<br />
{<br />
&nbsp;&nbsp;&nbsp; static </span><span class="default">$microtime_start </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$microtime_start </span><span class="keyword">=== </span><span class="default">null</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$microtime_start </span><span class="keyword">= </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">0.0</span><span class="keyword">; <br />
&nbsp;&nbsp;&nbsp; }&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">) - </span><span class="default">$microtime_start</span><span class="keyword">; <br />
}<br />
</span><span class="default">get_execution_time</span><span class="keyword">();<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
However it is true that result depends of gettimeofday() call. ([jamie at bishopston dot net] wrote this &amp; I can confirm)<br />
If system time change, result of this function can be unpredictable (much greater or less than zero).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="101628""></a>
  <div class="note">
   <strong class="user">jamie at bishopston dot net</strong>
   <a href="#101628" class="date">30-Dec-2010 09:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
All these timing scripts rely on microtime which relies on gettimebyday(2)<br />
<br />
This can be inaccurate on servers that run ntp to syncronise the servers<br />
time.<br />
<br />
For timing, you should really use clock_gettime(2) with the<br />
CLOCK_MONOTONIC flag set.<br />
<br />
This returns REAL WORLD time, not affected by intentional clock drift.<br />
<br />
This may seem a bit picky, but I recently saw a server that's clock was an<br />
hour out, and they'd set it to 'drift' to the correct time (clock is speeded<br />
up until it reaches the correct time)<br />
<br />
Those sorts of things can make a real impact.<br />
<br />
Any solutions, seeing as php doesn't have a hook into clock_gettime?<br />
<br />
More info here: <a href="http://tinyurl.com/28vxja9" rel="nofollow" target="_blank">http://tinyurl.com/28vxja9</a><br />
<br />
<a href="http://blog.habets.pp.se/2010/09/" rel="nofollow" target="_blank">http://blog.habets.pp.se/2010/09/</a><br />
gettimeofday-should-never-be-used-to-measure-time</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="101561""></a>
  <div class="note">
   <strong class="user">Robin Leffmann</strong>
   <a href="#101561" class="date">24-Dec-2010 09:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
While doing some experiments on using microtime()'s output for an entropy generator I found that its microsecond value was always quantified to the nearest hundreds (i.e. the number ends with 00), which affected the randomness of the entropy generator. This output pattern was consistent on three separate machines, running OpenBSD, Mac OS X and Windows.<br />
&nbsp;<br />
The solution was to instead use gettimeofday()'s output, as its usec value followed no quantifiable pattern on any of the three test platforms.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100084""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#100084" class="date">24-Sep-2010 06:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
that related to the prescedence of the . operator<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment"># normal prescedence<br />
</span><span class="default">$a </span><span class="keyword">= </span><span class="string">"te" </span><span class="keyword">.&nbsp;&nbsp; </span><span class="default">1 </span><span class="keyword">- </span><span class="default">2&nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"st"</span><span class="keyword">; </span><span class="comment"># ((te . 1) - 2 ) . st ==&gt; -2st<br />
</span><span class="default">$b </span><span class="keyword">= </span><span class="string">"te" </span><span class="keyword">.&nbsp;&nbsp; </span><span class="default">1 </span><span class="keyword">+ </span><span class="default">2&nbsp;&nbsp; </span><span class="keyword">. </span><span class="string">"st"</span><span class="keyword">; </span><span class="comment"># ((te . 1) + 2 ) . st ==&gt;&nbsp; 2st<br />
<br />
# modified prescedence<br />
</span><span class="default">$c </span><span class="keyword">= </span><span class="string">"te" </span><span class="keyword">. ( </span><span class="default">1 </span><span class="keyword">- </span><span class="default">2 </span><span class="keyword">) . </span><span class="string">"st"</span><span class="keyword">; </span><span class="comment"># te . ( 1 - 2 ) . st ==&gt; te-1st<br />
</span><span class="default">$d </span><span class="keyword">= </span><span class="string">"te" </span><span class="keyword">. ( </span><span class="default">1 </span><span class="keyword">+ </span><span class="default">2 </span><span class="keyword">) . </span><span class="string">"st"</span><span class="keyword">; </span><span class="comment"># te . ( 1 + 2 ) . st ==&gt; te3st<br />
<br />
</span><span class="default">var_dump</span><span class="keyword">( </span><span class="default">$a</span><span class="keyword">, </span><span class="default">$b </span><span class="keyword">);<br />
</span><span class="default">var_dump</span><span class="keyword">( </span><span class="default">$c</span><span class="keyword">, </span><span class="default">$d </span><span class="keyword">);</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99307""></a>
  <div class="note">
   <strong class="user">Andris</strong>
   <a href="#99307" class="date">10-Aug-2010 11:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I wrote a class which allows to time execution of php scripts very easily. You can even time multiple separate blocks and then get the total time at the end. 
<br />

<br />
The class is pretty long so I won't post it here, but here's the link:
<br />
<a href="http://codeaid.net/php/calculate-script-execution-time-(php-class" rel="nofollow" target="_blank">http://codeaid.net/php/calculate-script-execution-time-(php-class</a>)
<br />

<br />
An quick usage example:
<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">100</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {
<br />
&nbsp;&nbsp; &nbsp; </span><span class="comment">// calculate the time it takes to run fx()
<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">Timer</span><span class="keyword">::</span><span class="default">start</span><span class="keyword">(); 
<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">fx</span><span class="keyword">();
<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">Timer</span><span class="keyword">::</span><span class="default">stop</span><span class="keyword">(); 
<br />
&nbsp;
<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">fy</span><span class="keyword">();
<br />
&nbsp;
<br />
&nbsp;&nbsp; &nbsp; </span><span class="comment">// calculate the time it takes to run fz()
<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">Timer</span><span class="keyword">::</span><span class="default">start</span><span class="keyword">();
<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">fz</span><span class="keyword">();
<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">Timer</span><span class="keyword">::</span><span class="default">stop</span><span class="keyword">();
<br />
}
<br />
&nbsp;
<br />
print </span><span class="default">Timer</span><span class="keyword">::</span><span class="default">get</span><span class="keyword">();
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93568""></a>
  <div class="note">
   <strong class="user">bleakwind at gmail dot com</strong>
   <a href="#93568" class="date">16-Sep-2009 07:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Check Program runtime:
<br />
<span class="default">&lt;?php
<br />

<br />
</span><span class="keyword">class </span><span class="default">bwruntime
<br />
</span><span class="keyword">{
<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$timestart</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$digits</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">bwruntime</span><span class="keyword">(</span><span class="default">$digits </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">timestart&nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">explode </span><span class="keyword">(</span><span class="string">' '</span><span class="keyword">, </span><span class="default">microtime</span><span class="keyword">());
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">digits&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">$digits</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">totaltime</span><span class="keyword">()
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$timefinish&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">explode </span><span class="keyword">(</span><span class="string">' '</span><span class="keyword">, </span><span class="default">microtime</span><span class="keyword">());
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">digits </span><span class="keyword">== </span><span class="string">""</span><span class="keyword">){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$runtime_float&nbsp; </span><span class="keyword">= </span><span class="default">$timefinish</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] - </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">timestart</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }else{
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$runtime_float&nbsp; </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">((</span><span class="default">$timefinish</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] - </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">timestart</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]), </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">digits</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$runtime </span><span class="keyword">= (</span><span class="default">$timefinish</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] - </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">timestart</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]) + </span><span class="default">$runtime_float</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$runtime</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92659""></a>
  <div class="note">
   <strong class="user">thawootah</strong>
   <a href="#92659" class="date">03-Aug-2009 01:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Want to make sure your script doesn't time out on large updates? Say you're doing a poor mans cron job or working with large amounts of data in loop and the user begins to hang too long. Instead of them giving up and leaving you can break the loop when it reaches a set time and still display data. <br />
<br />
Here's a simple handy dandy loop timer rounded to second.<br />
<span class="default">&lt;?php<br />
$starttime </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">(</span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">));<br />
</span><span class="default">$totaltime&nbsp; </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
</span><span class="default">$maxtime </span><span class="keyword">= </span><span class="default">5</span><span class="keyword">; </span><span class="comment">//seconds<br />
</span><span class="keyword">for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt;= </span><span class="default">20</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {&nbsp; </span><span class="comment">/// 20 loops 1 sec each<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">usleep</span><span class="keyword">(</span><span class="default">1000000</span><span class="keyword">); <br />
<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$totaltime </span><span class="keyword">&lt; </span><span class="default">$maxtime</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$currenttime </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">(</span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$totaltime </span><span class="keyword">= </span><span class="default">$totaltime </span><span class="keyword">+ (</span><span class="default">$currenttime </span><span class="keyword">-</span><span class="default">$starttime</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//update and continue<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">echo&nbsp; </span><span class="default">$i</span><span class="keyword">.</span><span class="string">'&lt;br&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; }else{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// stop updating or display not updated data.<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">break;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91566""></a>
  <div class="note">
   <strong class="user">gomodo at free dot fr</strong>
   <a href="#91566" class="date">17-Jun-2009 12:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Need a mini benchmark ?<br />
Use microtime with this (very smart) benchmark function :<br />
<br />
mixed mini_bench_to(array timelist[, return_array=false])<br />
return a mini bench result<br />
<br />
-the timelist first key must be 'start'<br />
-default return a resume string, or array if return_array= true :<br />
'total_time' (ms) in first row<br />
details (purcent) in next row<br />
<br />
example :<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">unset(</span><span class="default">$t</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">// if previous used<br />
<br />
//-- zone to bench<br />
</span><span class="default">$t</span><span class="keyword">[</span><span class="string">'start'</span><span class="keyword">] = </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br />
</span><span class="default">$tab_test</span><span class="keyword">=array(</span><span class="default">1</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">,</span><span class="default">3</span><span class="keyword">,</span><span class="default">4</span><span class="keyword">,</span><span class="default">5</span><span class="keyword">,</span><span class="default">6</span><span class="keyword">,</span><span class="default">7</span><span class="keyword">,</span><span class="default">8</span><span class="keyword">);<br />
</span><span class="default">$fact</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">;<br />
</span><span class="default">$t</span><span class="keyword">[</span><span class="string">'init_values'</span><span class="keyword">] = </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br />
foreach (</span><span class="default">$tab_test </span><span class="keyword">as </span><span class="default">$key</span><span class="keyword">=&gt;</span><span class="default">$value</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fact</span><span class="keyword">=</span><span class="default">$fact</span><span class="keyword">*</span><span class="default">$value</span><span class="keyword">;<br />
}<br />
</span><span class="default">$t</span><span class="keyword">[</span><span class="string">'loop_fact'</span><span class="keyword">] = </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br />
echo </span><span class="string">"fact = "</span><span class="keyword">.</span><span class="default">$fact</span><span class="keyword">.</span><span class="string">"\n"</span><span class="keyword">;<br />
</span><span class="comment">//-- END zone to bench<br />
<br />
</span><span class="keyword">echo </span><span class="string">"---- string result----\n"</span><span class="keyword">;<br />
</span><span class="default">$str_result_bench</span><span class="keyword">=</span><span class="default">mini_bench_to</span><span class="keyword">(</span><span class="default">$t</span><span class="keyword">);<br />
echo </span><span class="default">$str_result_bench</span><span class="keyword">; </span><span class="comment">// string return<br />
</span><span class="keyword">echo </span><span class="string">"---- tab result----\n"</span><span class="keyword">;<br />
</span><span class="default">$tab_result_bench</span><span class="keyword">=</span><span class="default">mini_bench_to</span><span class="keyword">(</span><span class="default">$t</span><span class="keyword">,</span><span class="default">true</span><span class="keyword">);<br />
echo </span><span class="default">var_export</span><span class="keyword">(</span><span class="default">$tab_result_bench</span><span class="keyword">,</span><span class="default">true</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span>this example return:<br />
<br />
---- string result----<br />
total time : 0.0141 ms<br />
start -&gt; init_values : 51.1 %<br />
init_values -&gt; loop_fact : 48.9 %<br />
---- tab result----<br />
array (<br />
&nbsp; 'total_time' =&gt; 0.0141,<br />
&nbsp; 'start -&gt; init_values' =&gt; 51.1,<br />
&nbsp; 'init_values -&gt; loop_fact' =&gt; 48.9,<br />
)<br />
<br />
The function to include :<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">mini_bench_to</span><span class="keyword">(</span><span class="default">$arg_t</span><span class="keyword">, </span><span class="default">$arg_ra</span><span class="keyword">=</span><span class="default">false</span><span class="keyword">) <br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$tttime</span><span class="keyword">=</span><span class="default">round</span><span class="keyword">((</span><span class="default">end</span><span class="keyword">(</span><span class="default">$arg_t</span><span class="keyword">)-</span><span class="default">$arg_t</span><span class="keyword">[</span><span class="string">'start'</span><span class="keyword">])*</span><span class="default">1000</span><span class="keyword">,</span><span class="default">4</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$arg_ra</span><span class="keyword">) </span><span class="default">$ar_aff</span><span class="keyword">[</span><span class="string">'total_time'</span><span class="keyword">]=</span><span class="default">$tttime</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; else </span><span class="default">$aff</span><span class="keyword">=</span><span class="string">"total time : "</span><span class="keyword">.</span><span class="default">$tttime</span><span class="keyword">.</span><span class="string">"ms\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$prv_cle</span><span class="keyword">=</span><span class="string">'start'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$prv_val</span><span class="keyword">=</span><span class="default">$arg_t</span><span class="keyword">[</span><span class="string">'start'</span><span class="keyword">];<br />
<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$arg_t </span><span class="keyword">as </span><span class="default">$cle</span><span class="keyword">=&gt;</span><span class="default">$val</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$cle</span><span class="keyword">!=</span><span class="string">'start'</span><span class="keyword">)&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$prcnt_t</span><span class="keyword">=</span><span class="default">round</span><span class="keyword">(((</span><span class="default">round</span><span class="keyword">((</span><span class="default">$val</span><span class="keyword">-</span><span class="default">$prv_val</span><span class="keyword">)*</span><span class="default">1000</span><span class="keyword">,</span><span class="default">4</span><span class="keyword">)/</span><span class="default">$tttime</span><span class="keyword">)*</span><span class="default">100</span><span class="keyword">),</span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$arg_ra</span><span class="keyword">) </span><span class="default">$ar_aff</span><span class="keyword">[</span><span class="default">$prv_cle</span><span class="keyword">.</span><span class="string">' -&gt; '</span><span class="keyword">.</span><span class="default">$cle</span><span class="keyword">]=</span><span class="default">$prcnt_t</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$aff</span><span class="keyword">.=</span><span class="default">$prv_cle</span><span class="keyword">.</span><span class="string">' -&gt; '</span><span class="keyword">.</span><span class="default">$cle</span><span class="keyword">.</span><span class="string">' : '</span><span class="keyword">.</span><span class="default">$prcnt_t</span><span class="keyword">.</span><span class="string">" %\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$prv_val</span><span class="keyword">=</span><span class="default">$val</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$prv_cle</span><span class="keyword">=</span><span class="default">$cle</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$arg_ra</span><span class="keyword">) return </span><span class="default">$ar_aff</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$aff</span><span class="keyword">;<br />
&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="90216""></a>
  <div class="note">
   <strong class="user">singh206 at gmail dot com</strong>
   <a href="#90216" class="date">10-Apr-2009 08:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php
<br />
</span><span class="keyword">class </span><span class="default">StopWatch </span><span class="keyword">{
<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$total</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$time</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__construct</span><span class="keyword">() {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">total </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">time </span><span class="keyword">= </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">clock</span><span class="keyword">() {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return -</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">time </span><span class="keyword">+ (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">time </span><span class="keyword">= </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">));
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">elapsed</span><span class="keyword">() {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">) - </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">total</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">reset</span><span class="keyword">() {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">total</span><span class="keyword">=</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">time</span><span class="keyword">=</span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />
}
<br />

<br />
</span><span class="default">$stopwatch </span><span class="keyword">= new </span><span class="default">StopWatch</span><span class="keyword">();
<br />
</span><span class="default">usleep</span><span class="keyword">(</span><span class="default">1000000</span><span class="keyword">);
<br />
echo </span><span class="string">"Checkpoint 1: "</span><span class="keyword">.</span><span class="default">$stopwatch</span><span class="keyword">-&gt;</span><span class="default">clock</span><span class="keyword">().</span><span class="string">" seconds&lt;br /&gt;"</span><span class="keyword">;
<br />

<br />
</span><span class="default">usleep</span><span class="keyword">(</span><span class="default">1000000</span><span class="keyword">);
<br />
echo </span><span class="string">"Checkpoint 2: "</span><span class="keyword">.</span><span class="default">$stopwatch</span><span class="keyword">-&gt;</span><span class="default">clock</span><span class="keyword">().</span><span class="string">" seconds&lt;br /&gt;"</span><span class="keyword">;
<br />

<br />
echo </span><span class="string">"Total Elapsed: "</span><span class="keyword">.</span><span class="default">$stopwatch</span><span class="keyword">-&gt;</span><span class="default">elapsed</span><span class="keyword">().</span><span class="string">" seconds&lt;br /&gt;"</span><span class="keyword">;
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85719""></a>
  <div class="note">
   <strong class="user">christ dot boris at nospam gmail dot com</strong>
   <a href="#85719" class="date">13-Sep-2008 09:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hi, I made a function to get the generation page time :<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">gentime</span><span class="keyword">() {<br />
&nbsp;&nbsp;&nbsp; static </span><span class="default">$a</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$a </span><span class="keyword">== </span><span class="default">0</span><span class="keyword">) </span><span class="default">$a </span><span class="keyword">= </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; else return (string)(</span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">)-</span><span class="default">$a</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
(You can add a round() to the return value if you want)<br />
<br />
Use :<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment"># you should include your libraries/conf files here (including the gentime function)<br />
</span><span class="default">gentime</span><span class="keyword">();<br />
<br />
</span><span class="comment"># your source code here<br />
<br />
</span><span class="keyword">echo </span><span class="string">'Generated in '</span><span class="keyword">.</span><span class="default">gentime</span><span class="keyword">().</span><span class="string">' seconds.'<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84395""></a>
  <div class="note">
   <strong class="user">pascalxusPLEASENOSPAM at yahoo dot com</strong>
   <a href="#84395" class="date">12-Jul-2008 10:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I wanted to find out whether echo would be quicker in small chunks or one large chunk to test the theory mentioned in the previous post.&nbsp; The following experiment shows that there is no significant performance difference, in terms of execution time elapsed, between the two methods of using echo.&nbsp; I ran two test cases, one with a string that is 100000 bytes long and another with a string length of 1000000.&nbsp; The source code follows below.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">echobig</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">, </span><span class="default">$bufferSize </span><span class="keyword">= </span><span class="default">8192</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$splitString </span><span class="keyword">= </span><span class="default">str_split</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">, </span><span class="default">$bufferSize</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; foreach(</span><span class="default">$splitString </span><span class="keyword">as </span><span class="default">$chunk</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">$chunk</span><span class="keyword">;<br />
}<br />
<br />
global </span><span class="default">$dat</span><span class="keyword">;<br />
</span><span class="default">$dat </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
<br />
function </span><span class="default">testit</span><span class="keyword">()<br />
{<br />
global </span><span class="default">$dat</span><span class="keyword">;<br />
</span><span class="default">$data </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
<br />
for( </span><span class="default">$a </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$a </span><span class="keyword">&lt;= </span><span class="default">1000000</span><span class="keyword">; </span><span class="default">$a </span><span class="keyword">+= </span><span class="default">1 </span><span class="keyword">) </span><span class="default">$data </span><span class="keyword">.= </span><span class="string">"a"</span><span class="keyword">;<br />
<br />
</span><span class="default">$u1</span><span class="keyword">= </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br />
</span><span class="default">echobig</span><span class="keyword">( </span><span class="default">$data </span><span class="keyword">);<br />
</span><span class="default">$u2</span><span class="keyword">= </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br />
echo </span><span class="default">$data</span><span class="keyword">;<br />
</span><span class="default">$u3</span><span class="keyword">= </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br />
<br />
</span><span class="default">$diff </span><span class="keyword">= </span><span class="default">$u2 </span><span class="keyword">- </span><span class="default">$u1</span><span class="keyword">;<br />
</span><span class="default">$diff2</span><span class="keyword">= </span><span class="default">$u3 </span><span class="keyword">- </span><span class="default">$u2</span><span class="keyword">;<br />
</span><span class="default">$dat </span><span class="keyword">.= </span><span class="string">"</span><span class="default">$diff2</span><span class="string"> </span><span class="default">$diff</span><span class="string">&nbsp; &nbsp; </span><span class="default">$u2</span><span class="string">&nbsp; </span><span class="default">$u1</span><span class="string">\r\n"</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
while( </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">5 </span><span class="keyword">)<br />
{<br />
&nbsp; </span><span class="default">testit</span><span class="keyword">(); </span><span class="default">$i </span><span class="keyword">+= </span><span class="default">1</span><span class="keyword">;<br />
}<br />
<br />
global </span><span class="default">$dat</span><span class="keyword">;<br />
</span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">( </span><span class="string">"../Data/results.txt"</span><span class="keyword">, </span><span class="string">"w" </span><span class="keyword">);<br />
</span><span class="default">fwrite</span><span class="keyword">( </span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$dat </span><span class="keyword">);<br />
</span><span class="default">fclose</span><span class="keyword">( </span><span class="default">$fp </span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
You can run the above experiment yourself or you can look at my test data.&nbsp; I got some test data here:&nbsp; <a href="http://www.codesplunk.com/examples/echo.html" rel="nofollow" target="_blank">http://www.codesplunk.com/examples/echo.html</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83642""></a>
  <div class="note">
   <strong class="user">kpsimoulis [at] genatec</strong>
   <a href="#83642" class="date">05-Jun-2008 09:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This function is very useful for putting a start and end point in your page to find out where is the delay.<br />
<br />
<span class="default">&lt;?php<br />
<br />
$start </span><span class="keyword">= </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br />
</span><span class="comment">// My source code here<br />
</span><span class="default">$end </span><span class="keyword">= </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br />
<br />
echo </span><span class="default">$end</span><span class="keyword">.</span><span class="string">"-"</span><span class="keyword">.</span><span class="default">$start</span><span class="keyword">.</span><span class="string">"="</span><span class="keyword">.(</span><span class="default">$end </span><span class="keyword">- </span><span class="default">$start</span><span class="keyword">). </span><span class="string">" seconds"</span><span class="keyword">;<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
If you try this example above (without any source code between the start and the end point). You will get an ugly value, something like:<br />
1212690530.4132-1212690530.4132=8.1062316894531E-6 seconds<br />
<br />
You will wonder why you get this because both numbers seem to be equal. Well this is because there is a hidden precision that we are not able to see.<br />
<br />
To solve this problem I made a new function:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">my_microtime</span><span class="keyword">(</span><span class="default">$precision </span><span class="keyword">= </span><span class="default">4</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">round</span><span class="keyword">(</span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">),</span><span class="default">4</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">$start </span><span class="keyword">= </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br />
</span><span class="comment">// My source code here<br />
</span><span class="default">$end </span><span class="keyword">= </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br />
<br />
echo </span><span class="default">$end</span><span class="keyword">.</span><span class="string">"-"</span><span class="keyword">.</span><span class="default">$start</span><span class="keyword">.</span><span class="string">"="</span><span class="keyword">.</span><span class="default">substr</span><span class="keyword">((</span><span class="default">$end </span><span class="keyword">- </span><span class="default">$start</span><span class="keyword">),</span><span class="default">0</span><span class="keyword">,</span><span class="default">5</span><span class="keyword">). </span><span class="string">" seconds"</span><span class="keyword">;<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
It would be useful if they add another parameter for precision in this function or at least another boolean that will not include the hidden precision.<br />
You can read more about the hidden precision in <a href="http://php.net/float" rel="nofollow" target="_blank">http://php.net/float</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83527""></a>
  <div class="note">
   <strong class="user">Peter Kehl</strong>
   <a href="#83527" class="date">30-May-2008 12:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This function allows you to easily calculate time difference between two points in time without losing the precision.
<br />

<br />
<span class="default">&lt;?php
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**&nbsp; &nbsp; Calculate a precise time difference.
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; @param string $start result of microtime()
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; @param string $end result of microtime(); if NULL/FALSE/0/'' then it's now
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; @return flat difference in seconds, calculated with minimum precision loss
<br />
&nbsp;&nbsp;&nbsp; */
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">microtime_diff</span><span class="keyword">( </span><span class="default">$start</span><span class="keyword">, </span><span class="default">$end</span><span class="keyword">=</span><span class="default">NULL </span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( !</span><span class="default">$end </span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$end</span><span class="keyword">= </span><span class="default">microtime</span><span class="keyword">();
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; list(</span><span class="default">$start_usec</span><span class="keyword">, </span><span class="default">$start_sec</span><span class="keyword">) = </span><span class="default">explode</span><span class="keyword">(</span><span class="string">" "</span><span class="keyword">, </span><span class="default">$start</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; list(</span><span class="default">$end_usec</span><span class="keyword">, </span><span class="default">$end_sec</span><span class="keyword">) = </span><span class="default">explode</span><span class="keyword">(</span><span class="string">" "</span><span class="keyword">, </span><span class="default">$end</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$diff_sec</span><span class="keyword">= </span><span class="default">intval</span><span class="keyword">(</span><span class="default">$end_sec</span><span class="keyword">) - </span><span class="default">intval</span><span class="keyword">(</span><span class="default">$start_sec</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$diff_usec</span><span class="keyword">= </span><span class="default">floatval</span><span class="keyword">(</span><span class="default">$end_usec</span><span class="keyword">) - </span><span class="default">floatval</span><span class="keyword">(</span><span class="default">$start_usec</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">floatval</span><span class="keyword">( </span><span class="default">$diff_sec </span><span class="keyword">) + </span><span class="default">$diff_usec</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83504""></a>
  <div class="note">
   <strong class="user">luke at lucanos dot com</strong>
   <a href="#83504" class="date">29-May-2008 01:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Rather than using the list() function, etc. I have found the following code to be a bit cleaner and simpler:<br />
<span class="default">&lt;?php<br />
$theTime </span><span class="keyword">= </span><span class="default">array_sum</span><span class="keyword">( </span><span class="default">explode</span><span class="keyword">( </span><span class="string">' ' </span><span class="keyword">, </span><span class="default">microtime</span><span class="keyword">() ) );<br />
echo </span><span class="default">$theTime</span><span class="keyword">;<br />
</span><span class="comment"># Displays "1212018372.3366"<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69035""></a>
  <div class="note">
   <strong class="user">admin at emuxperts dot net</strong>
   <a href="#69035" class="date">21-Aug-2006 04:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This little function comes in handy if you want a single integer when your server doesn't have php &gt;= 5.0<br />
<br />
It returns seconds passed unix epoch to the microsecond. Or microseconds since unix epoch.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">//A hack for PHP &lt; 5.0<br />
</span><span class="keyword">function </span><span class="default">utime</span><span class="keyword">(</span><span class="default">$inms</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$utime </span><span class="keyword">= </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/^(.*?) (.*?)$/"</span><span class="keyword">, </span><span class="default">microtime</span><span class="keyword">(), </span><span class="default">$match</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$utime </span><span class="keyword">= </span><span class="default">$match</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">] + </span><span class="default">$match</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$inms</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$utime </span><span class="keyword">*=&nbsp; </span><span class="default">1000000</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$utime</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="comment">//Example:<br />
</span><span class="keyword">print </span><span class="default">utime</span><span class="keyword">();<br />
</span><span class="comment">//Returns:<br />
//1156127104.746352 Seconds<br />
<br />
//Example two:<br />
</span><span class="keyword">print </span><span class="default">utime</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">);<br />
</span><span class="comment">//Returns:<br />
//1156127104746352 Microseconds<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="66187""></a>
  <div class="note">
   <strong class="user">EdorFaus</strong>
   <a href="#66187" class="date">16-May-2006 09:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Of the methods I've seen here, and thought up myself, to convert microtime() output into a numerical value, the microtime_float() one shown in the documentation proper(using explode,list,float,+) is the slowest in terms of runtime.<br />
<br />
I implemented the various methods, ran each in a tight loop 1,000,000 times, and compared runtimes (and output). I did this 10 times to make sure there wasn't a problem of other things putting a load spike on the server. I'll admit I didn't take into account martijn at vanderlee dot com's comments on testing accuracy, but as I figured the looping code etc would be the same, and this was only meant as a relative comparison, it should not be necessary.<br />
<br />
The above method took on average 5.7151877 seconds, while a method using substr and simply adding strings with . took on average 3.0144226 seconds. rsalazar at innox dot com dot mx's method using preg_replace used on average 4.1819633 seconds. This shows that there are indeed differences, but for normal use noone is going to notice it.<br />
<br />
Note that the substr method mentioned isn't quite the one given anonymously below, but one I made based on it:<br />
<span class="default">&lt;?php<br />
$time</span><span class="keyword">=</span><span class="default">microtime</span><span class="keyword">();<br />
</span><span class="default">$timeval</span><span class="keyword">=</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$time</span><span class="keyword">,</span><span class="default">11</span><span class="keyword">).</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$time</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">9</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Also worth noting is that the microtime_float() method gets faster, and no less accurate, if the (float) conversions are taken out and the variables are simply added together.<br />
<br />
Any of the methods that used + or array_sum ended up rounding the result to 2 digits after the decimal point, while (most of) the ones using preg_replace or substr and . kept all the digits.<br />
<br />
For accurate timing, since floating-point arithmetic would lose precision, I stored microtime results as-is and calculated time difference with this function:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">microtime_used</span><span class="keyword">(</span><span class="default">$before</span><span class="keyword">,</span><span class="default">$after</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; return (</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$after</span><span class="keyword">,</span><span class="default">11</span><span class="keyword">)-</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$before</span><span class="keyword">,</span><span class="default">11</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; +(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$after</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">9</span><span class="keyword">)-</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$before</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">9</span><span class="keyword">));<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
For further information, the script itself, etc, see <a href="http://edorfaus.xepher.net/div/convert-method-test.php" rel="nofollow" target="_blank">http://edorfaus.xepher.net/div/convert-method-test.php</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="59052""></a>
  <div class="note">
   <strong class="user">radek at pinkbike com</strong>
   <a href="#59052" class="date">25-Nov-2005 05:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A lot of the comments here suggest adding in the following way:&nbsp; (float)$usec + (float)$sec<br />
Make sure you have the float precision high enough as with the default precision of 12, you are only precise to the 0.01 seconds.&nbsp; <br />
Set this in you php.ini file.<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; precision&nbsp; &nbsp; =&nbsp; 16</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="53969""></a>
  <div class="note">
   <strong class="user">vladson at pc-labs dot info</strong>
   <a href="#53969" class="date">19-Jun-2005 12:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I like to use bcmath for it<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">micro_time</span><span class="keyword">() {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$temp </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">" "</span><span class="keyword">, </span><span class="default">microtime</span><span class="keyword">());<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">bcadd</span><span class="keyword">(</span><span class="default">$temp</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="default">$temp</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">], </span><span class="default">6</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">$time_start </span><span class="keyword">= </span><span class="default">micro_time</span><span class="keyword">();<br />
</span><span class="default">sleep</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">);<br />
</span><span class="default">$time_stop </span><span class="keyword">= </span><span class="default">micro_time</span><span class="keyword">();<br />
<br />
</span><span class="default">$time_overall </span><span class="keyword">= </span><span class="default">bcsub</span><span class="keyword">(</span><span class="default">$time_stop</span><span class="keyword">, </span><span class="default">$time_start</span><span class="keyword">, </span><span class="default">6</span><span class="keyword">);<br />
echo </span><span class="string">"Execution time - </span><span class="default">$time_overall</span><span class="string"> Seconds"</span><span class="keyword">;<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="50300""></a>
  <div class="note">
   <strong class="user">php at washboardabs dot net</strong>
   <a href="#50300" class="date">24-Feb-2005 09:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Interesting quirk (tested in PHP 5.0.3): You can get very wacky results from microtime when it is called in the destructor of an object at the end of a script. These times vary enormously and can be in the *past*, when compared to microtime calls in the body of the script.<br />
<br />
As a case example, I played with a timer object that measured microtime when it was created at the start of the script, and measured microtime again at the end of the script using __destruct(); and then printed the total execution time (end time - start time) at the bottom of the page. On short scripts, this would often give a negative time!<br />
<br />
This quirk does not appear if microtime is measured with an automatic shutdown function (using <span class="default">&lt;?PHP register_shutdown_function</span><span class="keyword">(</span><span class="string">'myfunc'</span><span class="keyword">) </span><span class="default">?&gt;</span>. Incidentally, the automatic shutdown functions are called after output buffers are flushed but before object destructors are called.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
