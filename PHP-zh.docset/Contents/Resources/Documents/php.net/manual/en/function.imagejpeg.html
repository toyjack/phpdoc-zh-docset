<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>输出图象到浏览器或文件。</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.imageistruecolor.html">? imageistruecolor</a></li>
      <li style="float: right;"><a href="function.imagelayereffect.html">imagelayereffect ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.image.html">GD 和图像处理 函数</a></li>
    <li>输出图象到浏览器或文件。</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.imagejpeg" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">imagejpeg</h1>
  <p class="verinfo">(PHP 4, PHP 5, PHP 7)</p><p class="refpurpose"><span class="refname">imagejpeg</span> &mdash; <span class="dc-title">输出图象到浏览器或文件。</span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.imagejpeg-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">bool</span> <span class="methodname"><strong>imagejpeg</strong></span>
    ( <span class="methodparam"><span class="type">resource</span> <code class="parameter">$image</code></span>
   [, <span class="methodparam"><span class="type">string</span> <code class="parameter">$filename</code></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$quality</code></span>
  ]] )</div>

  <p class="para rdfs-comment">
   <span class="function"><strong>imagejpeg()</strong></span> 从 <code class="parameter">image</code>
   图像以 <code class="parameter">filename</code> 为文件名创建一个
   <acronym title="Joint Photographic Experts Group">JPEG</acronym> 图像。
  </p>
 </div>

 <div class="refsect1 parameters" id="refsect1-function.imagejpeg-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>

    <dt>
<code class="parameter">image</code></dt>

<dd>
<p class="para">由图象创建函数(例如<span class="function"><a href="function.imagecreatetruecolor.html" class="function">imagecreatetruecolor()</a></span>)返回的图象资源。</p></dd>

    
     <dt>
<code class="parameter">filename</code></dt>

     <dd>

      <p class="para">文件保存的路径，如果未设置或为 <strong><code>NULL</code></strong>，将会直接输出原始图象流。</p>
      <p class="para">
       如果要省略这个参数而提供
       <code class="parameter">quality</code> 参数，使用NULL。 
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">quality</code></dt>

     <dd>

      <p class="para">
       <code class="parameter">quality</code> 为可选项，范围从
       0（最差质量，文件更小）到 100（最佳质量，文件最大）。默认为
       IJG 默认的质量值（大约 75）。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>

 <div class="refsect1 returnvalues" id="refsect1-function.imagejpeg-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   成功时返回 <strong><code>TRUE</code></strong>， 或者在失败时返回 <strong><code>FALSE</code></strong>。
  </p>
 </div>

 <div class="refsect1 examples" id="refsect1-function.imagejpeg-examples">
  <h3 class="title">范例</h3>
  <p class="para">
   <div class="example" id="example-3439">
    <p><strong>Example #1 输出 JPEG 图像</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;创键空白图像并添加一些文本<br /></span><span style="color: #0000BB">$im&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">imagecreatetruecolor</span><span style="color: #007700">(</span><span style="color: #0000BB">120</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">20</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$text_color&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">imagecolorallocate</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">233</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">14</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">91</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">imagestring</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">5</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">5</span><span style="color: #007700">,&nbsp;&nbsp;</span><span style="color: #DD0000">'A&nbsp;Simple&nbsp;Text&nbsp;String'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$text_color</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;设置内容类型标头&nbsp;&mdash;&mdash;&nbsp;这个例子里是&nbsp;image/jpeg<br /></span><span style="color: #0000BB">header</span><span style="color: #007700">(</span><span style="color: #DD0000">'Content-Type:&nbsp;image/jpeg'</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;输出图像<br /></span><span style="color: #0000BB">imagejpeg</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;释放内存<br /></span><span style="color: #0000BB">imagedestroy</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>以上例程的输出类似于：</p></div>
    <div class="mediaobject">
     
     <div class="imageobject">
      <img src="images/21009b70229598c6a80eef8b45bf282b-imagejpeg.jpg" alt="例子的输出：输出 JPEG 图像" width="120" height="20" />
     </div>
    </div>
   </div>
  </p>
  <p class="para">
   <div class="example" id="example-3440">
    <p><strong>Example #2 保存一副 JPEG 图像</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;创键空白图像并添加一些文本<br /></span><span style="color: #0000BB">$im&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">imagecreatetruecolor</span><span style="color: #007700">(</span><span style="color: #0000BB">120</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">20</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$text_color&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">imagecolorallocate</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">233</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">14</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">91</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">imagestring</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">5</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">5</span><span style="color: #007700">,&nbsp;&nbsp;</span><span style="color: #DD0000">'A&nbsp;Simple&nbsp;Text&nbsp;String'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$text_color</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;保存图像为&nbsp;'simpletext.jpg'<br /></span><span style="color: #0000BB">imagejpeg</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'simpletext.jpg'</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;释放内存<br /></span><span style="color: #0000BB">imagedestroy</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
  <p class="para">
   <div class="example" id="example-3441">
    <p><strong>Example #3 以 75% 的图像质量输出图像</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;创键空白图像并添加一些文本<br /></span><span style="color: #0000BB">$im&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">imagecreatetruecolor</span><span style="color: #007700">(</span><span style="color: #0000BB">120</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">20</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$text_color&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">imagecolorallocate</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">233</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">14</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">91</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">imagestring</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">5</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">5</span><span style="color: #007700">,&nbsp;&nbsp;</span><span style="color: #DD0000">'A&nbsp;Simple&nbsp;Text&nbsp;String'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$text_color</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;设置内容类型标头&nbsp;&mdash;&mdash;&nbsp;这个例子里是&nbsp;image/jpeg<br /></span><span style="color: #0000BB">header</span><span style="color: #007700">(</span><span style="color: #DD0000">'Content-Type:&nbsp;image/jpeg'</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;使用&nbsp;NULL&nbsp;跳过&nbsp;filename&nbsp;参数，并设置图像质量为&nbsp;75%<br /></span><span style="color: #0000BB">imagejpeg</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">NULL</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">75</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;释放内存<br /></span><span style="color: #0000BB">imagedestroy</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>

 <div class="refsect1 notes" id="refsect1-function.imagejpeg-notes">
  <h3 class="title">注释</h3>
  <blockquote class="note"><p><strong class="note">Note</strong>: <span class="simpara">JPEG 支持仅在 PHP 与 GD-1.8 或更高版本一起编译时可用。</span></p></blockquote>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    如果想输出渐进式 JPEG，需要用
    <span class="function"><a href="function.imageinterlace.html" class="function">imageinterlace()</a></span> 函数将隔行扫描比特置位。
   </p>
  </p></blockquote>
 </div>

 <div class="refsect1 seealso" id="refsect1-function.imagejpeg-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.imagepng.html" class="function" rel="rdfs-seeAlso">imagepng()</a> - 以 PNG 格式将图像输出到浏览器或文件</span></li>
    <li class="member"><span class="function"><a href="function.imagegif.html" class="function" rel="rdfs-seeAlso">imagegif()</a> - 输出图象到浏览器或文件。</span></li>
    <li class="member"><span class="function"><a href="function.imagewbmp.html" class="function" rel="rdfs-seeAlso">imagewbmp()</a> - 以 WBMP 格式将图像输出到浏览器或文件</span></li>
    <li class="member"><span class="function"><a href="function.imageinterlace.html" class="function" rel="rdfs-seeAlso">imageinterlace()</a> - 激活或禁止隔行扫描</span></li>
    <li class="member"><span class="function"><a href="function.imagetypes.html" class="function" rel="rdfs-seeAlso">imagetypes()</a> - 返回当前 PHP 版本所支持的图像类型</span></li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="119133""></a>
  <div class="note">
   <strong class="user">roberto at ilpiola.it</strong>
   <a href="#119133" class="date">08-Apr-2016 03:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I really appreciated Michaelsoft's method for setting the DPI, but it is perfect only for low DPI values.<br />
<br />
When I tried to set the DPI to 300 (for a printer-ready image), I really got a 301 DPI image. the correct code should have 256 instead of 256 as the divisor:<br />
<br />
&lt;?<br />
// Change DPI, from <a href="http://php.net/manual/it/function.imagejpeg.php#78523" rel="nofollow" target="_blank">http://php.net/manual/it/function.imagejpeg.php#78523</a><br />
$dpi_x&nbsp;&nbsp; = 300;<br />
$dpi_y&nbsp;&nbsp; = 300;<br />
// Read the file<br />
$size&nbsp; &nbsp; = filesize($argv[11]);<br />
$image&nbsp;&nbsp; = file_get_contents($argv[11]);<br />
// Update DPI information in the JPG header<br />
$image[13] = chr(1);<br />
$image[14] = chr(floor($dpi_x/256));<br />
$image[15] = chr(&nbsp; &nbsp; &nbsp; $dpi_x%256);<br />
$image[16] = chr(floor($dpi_y/256));<br />
$image[17] = chr(&nbsp; &nbsp; &nbsp; $dpi_y%256);<br />
// Write the new JPG<br />
$f = fopen($argv[11], 'w');<br />
fwrite($f, $image, $size);<br />
fclose($f);<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="115859""></a>
  <div class="note">
   <strong class="user">liquid2026</strong>
   <a href="#115859" class="date">04-Oct-2014 09:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There is a "bug" in PHP 5.4.32<br />
If you use<br />
<span class="default">&lt;?php<br />
ImageJPEG</span><span class="keyword">(</span><span class="default">$newIMG</span><span class="keyword">,</span><span class="string">""</span><span class="keyword">,</span><span class="default">$q</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span>it wont work enymore. Use still NULL<br />
<span class="default">&lt;?php<br />
ImageJPEG</span><span class="keyword">(</span><span class="default">$newIMG</span><span class="keyword">,</span><span class="default">NULL</span><span class="keyword">,</span><span class="default">$q</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="114073""></a>
  <div class="note">
   <strong class="user">Brian Moreau</strong>
   <a href="#114073" class="date">09-Jan-2014 07:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If like me you like to rename uploaded images and add the time to the file name so you never end up with two images with the same name.<br />
<br />
Watch out because you can save a file on your server using illegal characters such as a colon ":"<br />
<br />
e.g<br />
030363 6-01-2014 18:05:29 image.jpg<br />
<br />
I spent ages trying to work out why my FTP program would not download the images created with PHP<br />
<br />
I guess this might be dependent on what file system your using but it wouldn't let me download the images to a windows file system.<br />
<br />
But I can obviously create files on my Linux server with a colon in the file name.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="112796""></a>
  <div class="note">
   <strong class="user">Bruno de Lima - bruno at tthedreamstone dot net</strong>
   <a href="#112796" class="date">24-Jul-2013 04:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
[[Editor's note: removed the header()-call since it is not required when outputting inline image-data]]
<br />
One single code line, solve-me after 3 hours of blind search!
<br />

<br />
here is:
<br />

<br />
... ob_start();
<br />
&nbsp; imagejpeg( $img, NULL, 100 );
<br />
&nbsp; imagedestroy( $img );
<br />
&nbsp; $i = ob_get_clean();
<br />

<br />
echo "&lt;img src='data:image/jpeg;base64," . base64_encode( $i )."'&gt;"; //saviour line!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="112372""></a>
  <div class="note">
   <strong class="user">php-stuff at corz dot org</strong>
   <a href="#112372" class="date">08-Jun-2013 06:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are trying to get some of these examples working with a recent version of php and getting the error, "Filename cannot be empty in...", check your second parameter. You can no longer use "", but MUST use "null" (no quotes).<br />
<br />
This breaking-change-with-no-note-or-warning may be true of other image functions.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="105479""></a>
  <div class="note">
   <strong class="user">dodgeit2 at yahoo dot com</strong>
   <a href="#105479" class="date">21-Aug-2011 08:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Problem: The URL of the current page is displaying in the browser window as an image file. At the same time your manipulated image saves to a file.
<br />

<br />
Solution: Start with removal of the header() function if you plan to output to a file. The browser is expecting image information; therefore, if you are outputting to a file, you don't need a header() function at all. 
<br />

<br />
If you are outputting to the browser check your imagejpeg() for parameter 2. Set it to 'null' if it has a file name.
<br />

<br />
Many of the examples programmers illustrate on the web output to the browser and do not save anything to the file system, therefore, the header() function seems essential to image manipulation for the first-time user of the GD library.
<br />

<br />
This page actually clearly shows the difference between "outputting" to a browser and "saving" to a file, but the code comments don't clearly state what the difference is.
<br />

<br />
Search for the page on the "header()" function on this website for more details.
<br />

<br />
Example: Let's say that you are outputting to a jpeg using imagejpeg(). Note the use of the header() function when outputting to the browser.
<br />

<br />
<span class="default">&lt;?php
<br />

<br />
</span><span class="comment">/*
<br />
more 
<br />
code
<br />
to 
<br />
make
<br />
it 
<br />
work
<br />
*/
<br />

<br />
// These just illustrate the different outputs.
<br />

<br />
// outputting to the browser
<br />
// header() needed for browser
<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-Type: image/jpeg'</span><span class="keyword">)
<br />
</span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);
<br />

<br />
</span><span class="comment">// saving to a file
<br />
// you do not need a header() function to save to a file
<br />
</span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="string">"../images/image001.jpg"</span><span class="keyword">);
<br />

<br />
</span><span class="comment">// outputting to the browser including quality parameter.
<br />
// skipping parameter2 to output to browser
<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-Type: image/jpeg'</span><span class="keyword">);
<br />
</span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">null</span><span class="keyword">, </span><span class="default">90</span><span class="keyword">);
<br />

<br />
</span><span class="comment">// saving to a file including quality parameter.
<br />
// all parameters used for saving to a file with quality adjustment
<br />
</span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="string">"../images/image001.jpg"</span><span class="keyword">, </span><span class="default">90</span><span class="keyword">);
<br />

<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="103826""></a>
  <div class="note">
   <strong class="user">bernytech at gmail dot com</strong>
   <a href="#103826" class="date">05-May-2011 12:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Don't be like me racking my brain for hours trying to figure out why my xxx.php file outputs <a href="http://localhost/xxx.php as a one line response." rel="nofollow" target="_blank">http://localhost/xxx.php as a one line response.</a><br />
<br />
Why?<br />
<br />
Most likely, you have either:<br />
<br />
1. whitespaces before or after the php tags<br />
2. need to set header('Content-type: image/jpeg');<br />
3. if you have required files...be sure nothing is outputted...no test print statements because page expects image information<br />
4.&nbsp; there is an error in your code<br />
<br />
in my case, it was 4.&nbsp; there is a reason why the function call base64decode does not work... <br />
<br />
it's actually: base64_decode()<br />
<br />
by the way, other ways to validate your image encoded in base64 is to use the following tag:<br />
<br />
echo '&lt;img src="data:image/jpeg;base64,'.$row['IMAGE'].'" alt="photo"&gt;';<br />
<br />
I was pulling a blob encoded base 64 data from mysql database and trying to render it on a page<br />
<br />
hope this helps someone.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100059""></a>
  <div class="note">
   <strong class="user">Ray.Paseur sometimes uses Gmail</strong>
   <a href="#100059" class="date">23-Sep-2010 12:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If string $filename is given and it exists, it will be overwritten.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="96796""></a>
  <div class="note">
   <strong class="user">hikmet1023 at hotmail dot com</strong>
   <a href="#96796" class="date">16-Mar-2010 05:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
WARNING for those who use utf-8 scripts:<br />
Before going crazy like me for a whole day and digging around configuration files etc.<br />
<br />
DIRECT BROWSER OUTPUT using imagejepeg worked only after i have saved my script in ANSI instead of utf-8</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92597""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#92597" class="date">31-Jul-2009 12:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I wanted a function that could resize an image and store the resulting thumbnail in a variable so I could manually save it. Here is the function. I basically strung together two snippets, one from this website (I think) and one by MrCoder here: <a href="http://www.webdeveloper.com/forum/showthread.php?t=188298." rel="nofollow" target="_blank">http://www.webdeveloper.com/forum/showthread.php?t=188298.</a><br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">resizeToVariable</span><span class="keyword">(</span><span class="default">$sourceImage</span><span class="keyword">,</span><span class="default">$newHeight</span><span class="keyword">,</span><span class="default">$newWidth</span><span class="keyword">,</span><span class="default">$destImage</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; list(</span><span class="default">$width</span><span class="keyword">,</span><span class="default">$height</span><span class="keyword">) = </span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$img </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$sourceImage</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// create a new temporary image<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$tmp_img </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$newHeight</span><span class="keyword">,</span><span class="default">$newWidth</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// copy and resize old image into new image<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagecopyresized</span><span class="keyword">( </span><span class="default">$tmp_img</span><span class="keyword">, </span><span class="default">$img</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">,</span><span class="default">$newHeight</span><span class="keyword">,</span><span class="default">$newWidth</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// use output buffering to capture outputted image stream<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">ob_start</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$tmp_img</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$i </span><span class="keyword">= </span><span class="default">ob_get_clean</span><span class="keyword">(); <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Save file<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fopen </span><span class="keyword">(</span><span class="default">$destImage</span><span class="keyword">,</span><span class="string">'w'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fwrite </span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fclose </span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
You can use this for all your image resizing tasks. I for some reason had a problem using imagejpeg to save the image directly.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91368""></a>
  <div class="note">
   <strong class="user">tomas at dundacek dot cz</strong>
   <a href="#91368" class="date">08-Jun-2009 10:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I had a problem with denied permissions when trying to upload AND resize an image having safe_mode on. This caused that I couldn't create the new file in which I wanted to resampled the image with nor with imagejpeg() nor with touch() and imagejpeg() after it. <br />
<br />
Here is my solution, I didn't test, but it's possible, it is biting some memory:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">resize</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">$target_file</span><span class="keyword">) {<br />
&nbsp; </span><span class="comment">// $image is the uploaded image<br />
&nbsp; </span><span class="keyword">list(</span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">) = </span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">[</span><span class="string">'tmp_name'</span><span class="keyword">]);<br />
<br />
&nbsp; </span><span class="comment">//setup the new size of the image<br />
&nbsp; </span><span class="default">$ratio </span><span class="keyword">= </span><span class="default">$width</span><span class="keyword">/</span><span class="default">$height</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$new_height </span><span class="keyword">= </span><span class="default">500</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$new_width </span><span class="keyword">= </span><span class="default">$new_height </span><span class="keyword">* </span><span class="default">$ratio</span><span class="keyword">;<br />
<br />
&nbsp; </span><span class="comment">//move the file in the new location<br />
&nbsp; </span><span class="default">move_uploaded_file</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">[</span><span class="string">'tmp_name'</span><span class="keyword">], </span><span class="default">$target_file</span><span class="keyword">);<br />
&nbsp; <br />
&nbsp; </span><span class="comment">// resample the image&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; </span><span class="default">$new_image </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$new_width</span><span class="keyword">, </span><span class="default">$new_height</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$old_image </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$target_file</span><span class="keyword">);<br />
&nbsp; </span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$new_image</span><span class="keyword">,</span><span class="default">$old_image</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$new_width</span><span class="keyword">, </span><span class="default">$new_height</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">);&nbsp; &nbsp; &nbsp; &nbsp; <br />
<br />
&nbsp; </span><span class="comment">//output<br />
&nbsp; </span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$new_image</span><span class="keyword">, </span><span class="default">$target_file</span><span class="keyword">, </span><span class="default">100</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
As you can see, the function moves the uploaded file where you want to save the resampled image (move_uploaded_file is not restricted by safe_mode) and then you can resample the image, because it was created by moving it already. <br />
<br />
Note: the directory where you want to save the file must have permissions set to 0777.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="90102""></a>
  <div class="note">
   <strong class="user">viciousVelo</strong>
   <a href="#90102" class="date">06-Apr-2009 04:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
for those who get the message "permission denied" or "unable to access": it looks like a problem with your writepermissions to this folder. no matter if you use windows- or linuxserver, be sure the correct user has the permission to write to the correct folder.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="89866""></a>
  <div class="note">
   <strong class="user">francesco@essensys</strong>
   <a href="#89866" class="date">26-Mar-2009 02:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I didn't find any example like this on the Web, so I mixed pieces together.. hope this will save time to other people!<br />
<br />
Here's a complete solution to READ any image (gif jpg png) from the FILESYSTEM, SCALE it to a max width/height, SAVE the scaled image to a BLOB field keeping the original image type. Quite tricky.. <br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">scaleImageFileToBlob</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">) {<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$source_pic </span><span class="keyword">= </span><span class="default">$file</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$max_width </span><span class="keyword">= </span><span class="default">200</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$max_height </span><span class="keyword">= </span><span class="default">200</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; list(</span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">, </span><span class="default">$image_type</span><span class="keyword">) = </span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; switch (</span><span class="default">$image_type</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">1</span><span class="keyword">: </span><span class="default">$src </span><span class="keyword">= </span><span class="default">imagecreatefromgif</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">); break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">2</span><span class="keyword">: </span><span class="default">$src </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">3</span><span class="keyword">: </span><span class="default">$src </span><span class="keyword">= </span><span class="default">imagecreatefrompng</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">); break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; default: return </span><span class="string">''</span><span class="keyword">;&nbsp; break;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$x_ratio </span><span class="keyword">= </span><span class="default">$max_width </span><span class="keyword">/ </span><span class="default">$width</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$y_ratio </span><span class="keyword">= </span><span class="default">$max_height </span><span class="keyword">/ </span><span class="default">$height</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; if( (</span><span class="default">$width </span><span class="keyword">&lt;= </span><span class="default">$max_width</span><span class="keyword">) &amp;&amp; (</span><span class="default">$height </span><span class="keyword">&lt;= </span><span class="default">$max_height</span><span class="keyword">) ){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tn_width </span><span class="keyword">= </span><span class="default">$width</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tn_height </span><span class="keyword">= </span><span class="default">$height</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }elseif ((</span><span class="default">$x_ratio </span><span class="keyword">* </span><span class="default">$height</span><span class="keyword">) &lt; </span><span class="default">$max_height</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tn_height </span><span class="keyword">= </span><span class="default">ceil</span><span class="keyword">(</span><span class="default">$x_ratio </span><span class="keyword">* </span><span class="default">$height</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tn_width </span><span class="keyword">= </span><span class="default">$max_width</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }else{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tn_width </span><span class="keyword">= </span><span class="default">ceil</span><span class="keyword">(</span><span class="default">$y_ratio </span><span class="keyword">* </span><span class="default">$width</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tn_height </span><span class="keyword">= </span><span class="default">$max_height</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$tmp </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$tn_width</span><span class="keyword">,</span><span class="default">$tn_height</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/* Check if this image is PNG or GIF, then set if Transparent*/<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if((</span><span class="default">$image_type </span><span class="keyword">== </span><span class="default">1</span><span class="keyword">) OR (</span><span class="default">$image_type</span><span class="keyword">==</span><span class="default">3</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagealphablending</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagesavealpha</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">,</span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$transparent </span><span class="keyword">= </span><span class="default">imagecolorallocatealpha</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">127</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagefilledrectangle</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$tn_width</span><span class="keyword">, </span><span class="default">$tn_height</span><span class="keyword">, </span><span class="default">$transparent</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">,</span><span class="default">$src</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$tn_width</span><span class="keyword">, </span><span class="default">$tn_height</span><span class="keyword">,</span><span class="default">$width</span><span class="keyword">,</span><span class="default">$height</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/*<br />
&nbsp;&nbsp; &nbsp; * imageXXX() only has two options, save as a file, or send to the browser.<br />
&nbsp;&nbsp; &nbsp; * It does not provide you the oppurtunity to manipulate the final GIF/JPG/PNG file stream<br />
&nbsp;&nbsp; &nbsp; * So I start the output buffering, use imageXXX() to output the data stream to the browser, <br />
&nbsp;&nbsp; &nbsp; * get the contents of the stream, and use clean to silently discard the buffered contents.<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">ob_start</span><span class="keyword">();<br />
<br />
&nbsp;&nbsp;&nbsp; switch (</span><span class="default">$image_type</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">1</span><span class="keyword">: </span><span class="default">imagegif</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">); break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">2</span><span class="keyword">: </span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">, </span><span class="default">NULL</span><span class="keyword">, </span><span class="default">100</span><span class="keyword">);&nbsp; break; </span><span class="comment">// best quality<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">case </span><span class="default">3</span><span class="keyword">: </span><span class="default">imagepng</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">, </span><span class="default">NULL</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">); break; </span><span class="comment">// no compression<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">default: echo </span><span class="string">''</span><span class="keyword">; break;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$final_image </span><span class="keyword">= </span><span class="default">ob_get_contents</span><span class="keyword">();<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">ob_end_clean</span><span class="keyword">();<br />
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$final_image</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
So, let's suppose you have a form where a user can upload an image, and you have to scale it and save it into your database.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">[..] </span><span class="comment">// the user has clicked the Submit button..<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; // Check if the user entered an image<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'imagefile'</span><span class="keyword">][</span><span class="string">'name'</span><span class="keyword">] != </span><span class="string">''</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$image </span><span class="keyword">= </span><span class="default">scaleImageFileToBlob</span><span class="keyword">(</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'imagefile'</span><span class="keyword">][</span><span class="string">'tmp_name'</span><span class="keyword">]);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$image </span><span class="keyword">== </span><span class="string">''</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">'Image type not supported'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$image_type </span><span class="keyword">= </span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'imagefile'</span><span class="keyword">][</span><span class="string">'type'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$image </span><span class="keyword">= </span><span class="default">addslashes</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$query&nbsp; </span><span class="keyword">= </span><span class="string">"UPDATE yourtable SET image_type='</span><span class="default">$image_type</span><span class="string">', image='</span><span class="default">$image</span><span class="string">' WHERE ..."</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$result</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">'Image scaled and uploaded'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">'Error running the query'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86858""></a>
  <div class="note">
   <strong class="user">soapergem at gmail dot com</strong>
   <a href="#86858" class="date">06-Nov-2008 10:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I came here looking for something similar to the getJPEGresolution function, but noticed the drawbacks that were pointed out in the last post. So, after drawing on some other code examples on the web, I put together the following function which should always properly return the correct values. (But remember that you still need to have the EXIF extension installed with your instance of PHP for this to work!)<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">jpeg_dpi</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; if ( </span><span class="default">exif_imagetype</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">) != </span><span class="default">IMAGETYPE_JPEG </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$exif </span><span class="keyword">= </span><span class="default">exif_read_data</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">, </span><span class="string">'IFD0'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$x </span><span class="keyword">= </span><span class="default">$y </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if ( isset(</span><span class="default">$exif</span><span class="keyword">[</span><span class="string">'XResolution'</span><span class="keyword">]) &amp;&amp; isset(</span><span class="default">$exif</span><span class="keyword">[</span><span class="string">'YResolution'</span><span class="keyword">]) ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$x </span><span class="keyword">= </span><span class="default">intval</span><span class="keyword">(</span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'@^(\\d+)/(\\d+)$@e'</span><span class="keyword">, </span><span class="string">'$1/$2'</span><span class="keyword">, </span><span class="default">$exif</span><span class="keyword">[</span><span class="string">'XResolution'</span><span class="keyword">]));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$y </span><span class="keyword">= </span><span class="default">intval</span><span class="keyword">(</span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'@^(\\d+)/(\\d+)$@e'</span><span class="keyword">, </span><span class="string">'$1/$2'</span><span class="keyword">, </span><span class="default">$exif</span><span class="keyword">[</span><span class="string">'YResolution'</span><span class="keyword">]));<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; if ( !</span><span class="default">$x </span><span class="keyword">&amp;&amp; !</span><span class="default">$y </span><span class="keyword">&amp;&amp; </span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">, </span><span class="string">'r'</span><span class="keyword">) ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$string </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">20</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">bin2hex</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">, </span><span class="default">14</span><span class="keyword">, </span><span class="default">4</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$x </span><span class="keyword">= </span><span class="default">hexdec</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">4</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$y </span><span class="keyword">= </span><span class="default">hexdec</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">, </span><span class="default">4</span><span class="keyword">, </span><span class="default">4</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; if ( </span><span class="default">$x </span><span class="keyword">|| </span><span class="default">$y </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return array(</span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
This function returns an array with the x-resolution, y-resolution when they can be determined, otherwise FALSE.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86493""></a>
  <div class="note">
   <strong class="user">ahows at noggin dot com dot au</strong>
   <a href="#86493" class="date">22-Oct-2008 07:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Regarding the code below, it only grabs the last byte of the DPI information in JFIF-mode. I was wondering why my 300-DPI file was being reported as 44. 300 - 256 = 44 of course.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85712""></a>
  <div class="note">
   <strong class="user">lorezyra (at) lorezyra (dot) com</strong>
   <a href="#85712" class="date">13-Sep-2008 04:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I noticed through testing that my previous function would not always return the data requested... this is due to the fact that some cameras and software dont correctly write the DPI info in the JFIF header... So, my 2nd solution is to read the exif info (if available) and output the first non-zero value as the DPI...<br />
<br />
<span class="default">&lt;?PHP<br />
</span><span class="keyword">function </span><span class="default">getJPEGresolution</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">exif_imagetype</span><span class="keyword">( </span><span class="default">$filename</span><span class="keyword">)!= </span><span class="default">IMAGETYPE_JPEG</span><span class="keyword">) return(</span><span class="default">false</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$outRez</span><span class="keyword">=array();<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Read the file<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$exif </span><span class="keyword">= </span><span class="default">exif_read_data</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">, </span><span class="string">'IFD0'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">ob_start</span><span class="keyword">(); </span><span class="comment">// start a new output buffer<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$image&nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// grab DPI information from the JPG header<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$outRez</span><span class="keyword">[</span><span class="string">"xDPI"</span><span class="keyword">] = (int)(</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">[</span><span class="default">15</span><span class="keyword">])&gt;</span><span class="default">0</span><span class="keyword">? </span><span class="default">ord</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">[</span><span class="default">15</span><span class="keyword">]) : </span><span class="default">$exif</span><span class="keyword">[</span><span class="string">'XResolution'</span><span class="keyword">] );<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$outRez</span><span class="keyword">[</span><span class="string">"yDPI"</span><span class="keyword">] = (int)(</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">[</span><span class="default">17</span><span class="keyword">])&gt;</span><span class="default">0</span><span class="keyword">? </span><span class="default">ord</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">[</span><span class="default">17</span><span class="keyword">]) : </span><span class="default">$exif</span><span class="keyword">[</span><span class="string">'YResolution'</span><span class="keyword">] );<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">ob_end_clean</span><span class="keyword">(); </span><span class="comment">// stop this output buffer<br />
<br />
&nbsp;&nbsp;&nbsp; //correct output if header doesn't contain dpi info:: use exif info instead<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$outRez</span><span class="keyword">[</span><span class="string">"xDPI"</span><span class="keyword">] = (</span><span class="default">$outRez</span><span class="keyword">[</span><span class="string">"xDPI"</span><span class="keyword">]&gt;</span><span class="default">0</span><span class="keyword">? </span><span class="default">$outRez</span><span class="keyword">[</span><span class="string">"xDPI"</span><span class="keyword">] : </span><span class="default">$exif</span><span class="keyword">[</span><span class="string">'THUMBNAIL'</span><span class="keyword">][</span><span class="string">'XResolution'</span><span class="keyword">] );<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$outRez</span><span class="keyword">[</span><span class="string">"yDPI"</span><span class="keyword">] = (</span><span class="default">$outRez</span><span class="keyword">[</span><span class="string">"yDPI"</span><span class="keyword">]&gt;</span><span class="default">0</span><span class="keyword">? </span><span class="default">$outRez</span><span class="keyword">[</span><span class="string">"yDPI"</span><span class="keyword">] : </span><span class="default">$exif</span><span class="keyword">[</span><span class="string">'THUMBNAIL'</span><span class="keyword">][</span><span class="string">'YResolution'</span><span class="keyword">] );<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//double check values; make sure it's just a number and not "72/1" ...<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if(!</span><span class="default">is_numeric</span><span class="keyword">(</span><span class="default">$outRez</span><span class="keyword">[</span><span class="string">"xDPI"</span><span class="keyword">])) </span><span class="default">$outRez</span><span class="keyword">[</span><span class="string">"xDPI"</span><span class="keyword">] = (int)</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$outRez</span><span class="keyword">[</span><span class="string">"xDPI"</span><span class="keyword">], </span><span class="default">0</span><span class="keyword">, </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$outRez</span><span class="keyword">[</span><span class="string">"xDPI"</span><span class="keyword">],</span><span class="string">"/"</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; if(!</span><span class="default">is_numeric</span><span class="keyword">(</span><span class="default">$outRez</span><span class="keyword">[</span><span class="string">"yDPI"</span><span class="keyword">])) </span><span class="default">$outRez</span><span class="keyword">[</span><span class="string">"yDPI"</span><span class="keyword">] = (int)</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$outRez</span><span class="keyword">[</span><span class="string">"yDPI"</span><span class="keyword">], </span><span class="default">0</span><span class="keyword">, </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$outRez</span><span class="keyword">[</span><span class="string">"yDPI"</span><span class="keyword">],</span><span class="string">"/"</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">));<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//xDPI and yDPI should equal in value... but we output both anyway...<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">return(</span><span class="default">$outRez</span><span class="keyword">);<br />
}</span><span class="comment">//end function getJPEGresolution<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85711""></a>
  <div class="note">
   <strong class="user">lorezyra (at) lorezyra (dot) com</strong>
   <a href="#85711" class="date">13-Sep-2008 03:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For those looking to grab the resolution of a JPEG image without using GD nor ImageMagic... I wrote this simple function.<br />
<br />
Too bad GD doesn't have this very simple function for us to use...<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">getJPEGresolution</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$outRez</span><span class="keyword">=array();<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Read the file<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">ob_start</span><span class="keyword">(); </span><span class="comment">// start a new output buffer<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$image&nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// grab DPI information from the JPG header<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$outRez</span><span class="keyword">[</span><span class="string">"xDPI"</span><span class="keyword">] = </span><span class="default">ord</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">[</span><span class="default">15</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$outRez</span><span class="keyword">[</span><span class="string">"yDPI"</span><span class="keyword">] = </span><span class="default">ord</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">[</span><span class="default">17</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">ob_end_clean</span><span class="keyword">(); </span><span class="comment">// stop this output buffer<br />
<br />
&nbsp;&nbsp;&nbsp; //xDPI and yDPI should equal in value... but we output both anyway...<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">return(</span><span class="default">$outRez</span><span class="keyword">);<br />
}</span><span class="comment">//end function getJPEGresolution<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83537""></a>
  <div class="note">
   <strong class="user">stefan at colulus dot com</strong>
   <a href="#83537" class="date">30-May-2008 08:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I worked out a script that allows the transfer of alphanumeric data to be placed on an image. The HTML feature is img src and the php feature is imagettftext. This simple code will increment from 1 to 3 on images.<br />
<br />
code:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">//ImageCall.php -- This script will call a script to produce the image.<br />
</span><span class="keyword">for(</span><span class="default">$next </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;</span><span class="default">$next </span><span class="keyword">&lt; </span><span class="default">4</span><span class="keyword">; </span><span class="default">$next</span><span class="keyword">++){<br />
print </span><span class="string">"Image </span><span class="default">$next</span><span class="string">:&lt;br&gt;"</span><span class="keyword">;<br />
print </span><span class="string">"&lt;img src = 'Image.php?\$text=</span><span class="default">$next</span><span class="string">'&gt;"</span><span class="keyword">;<br />
print </span><span class="string">"&lt;br&gt;&lt;br&gt;"</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
<span class="default">&lt;?php<br />
</span><span class="comment">//Image.php -- This script creates a square image and places the text on it.<br />
<br />
// image size and color<br />
</span><span class="default">$im </span><span class="keyword">= </span><span class="default">ImageCreate</span><span class="keyword">(</span><span class="default">77</span><span class="keyword">,</span><span class="default">77</span><span class="keyword">);<br />
</span><span class="default">$color1 </span><span class="keyword">= </span><span class="default">ImageColorAllocate</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">0x66</span><span class="keyword">,</span><span class="default">0xCC</span><span class="keyword">,</span><span class="default">0x00</span><span class="keyword">);<br />
</span><span class="default">$color2 </span><span class="keyword">= </span><span class="default">ImageColorAllocate</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">0x33</span><span class="keyword">,</span><span class="default">0x66</span><span class="keyword">,</span><span class="default">0x00</span><span class="keyword">);<br />
</span><span class="default">$color3 </span><span class="keyword">= </span><span class="default">ImageColorAllocate</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">0x00</span><span class="keyword">,</span><span class="default">0x99</span><span class="keyword">,</span><span class="default">0x00</span><span class="keyword">);<br />
</span><span class="default">$color4 </span><span class="keyword">= </span><span class="default">ImageColorAllocate</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">0x3D</span><span class="keyword">,</span><span class="default">0x3D</span><span class="keyword">,</span><span class="default">0x3D</span><span class="keyword">);<br />
<br />
</span><span class="comment">// image creation<br />
</span><span class="default">ImageFilledRectangle</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">76</span><span class="keyword">,</span><span class="default">76</span><span class="keyword">,</span><span class="default">$color1</span><span class="keyword">);<br />
</span><span class="default">ImageFilledpolygon</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, array (</span><span class="default">76</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">76</span><span class="keyword">,</span><span class="default">76</span><span class="keyword">,</span><span class="default">76</span><span class="keyword">),</span><span class="default">3</span><span class="keyword">,</span><span class="default">$color2</span><span class="keyword">);<br />
</span><span class="default">ImageFilledRectangle</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">5</span><span class="keyword">,</span><span class="default">5</span><span class="keyword">,</span><span class="default">72</span><span class="keyword">,</span><span class="default">72</span><span class="keyword">,</span><span class="default">$color3</span><span class="keyword">);<br />
<br />
</span><span class="comment">// determine numeric center of image<br />
</span><span class="default">$size </span><span class="keyword">= </span><span class="default">ImageTTFBBox</span><span class="keyword">(</span><span class="default">45</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="string">'impact'</span><span class="keyword">,</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'$text'</span><span class="keyword">]);<br />
</span><span class="default">$X </span><span class="keyword">= (</span><span class="default">77 </span><span class="keyword">- (</span><span class="default">abs</span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]- </span><span class="default">$size</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">])))/</span><span class="default">2</span><span class="keyword">;<br />
</span><span class="default">$Y </span><span class="keyword">= ((</span><span class="default">77 </span><span class="keyword">- (</span><span class="default">abs</span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">[</span><span class="default">5</span><span class="keyword">] - </span><span class="default">$size</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">])))/</span><span class="default">2 </span><span class="keyword">+ (</span><span class="default">abs</span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">[</span><span class="default">5</span><span class="keyword">] - </span><span class="default">$size</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">])));<br />
<br />
</span><span class="comment">//places numeric information on image<br />
</span><span class="default">ImageTTFText</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">,</span><span class="default">45</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,(</span><span class="default">$X</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">),</span><span class="default">$Y</span><span class="keyword">,</span><span class="default">$color4</span><span class="keyword">,</span><span class="string">'impact'</span><span class="keyword">,</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'$text'</span><span class="keyword">]);<br />
<br />
</span><span class="comment">//returns completed image to calling script<br />
</span><span class="default">Header</span><span class="keyword">(</span><span class="string">'Content-Type: image/png'</span><span class="keyword">);<br />
</span><span class="default">Imagejpeg</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83347""></a>
  <div class="note">
   <strong class="user">xavi at lapalomera dot com</strong>
   <a href="#83347" class="date">21-May-2008 08:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For those whom needs other dpi image than the GD library, just do the following:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">//Get jpeg image contents<br />
</span><span class="default">ob_start</span><span class="keyword">();<br />
</span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="string">""</span><span class="keyword">, </span><span class="default">100</span><span class="keyword">);<br />
</span><span class="default">$image </span><span class="keyword">= </span><span class="default">ob_get_contents</span><span class="keyword">();<br />
</span><span class="default">ob_end_clean</span><span class="keyword">();<br />
<br />
</span><span class="comment">//Or read jpeg image<br />
</span><span class="default">$image </span><span class="keyword">= </span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);<br />
<br />
</span><span class="comment">//Replace header image info to set DPI as units and the density for X and Y <br />
//First parameter are units for X and Y densities (0x00 No units, 0x01 DPI, 0x02 DPC)<br />
//Second parameter is the X density<br />
//Third parameter is the Y density<br />
</span><span class="default">$image </span><span class="keyword">= </span><span class="default">substr_replace</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">pack</span><span class="keyword">(</span><span class="string">"Cnn"</span><span class="keyword">, </span><span class="default">0x01</span><span class="keyword">, </span><span class="default">300</span><span class="keyword">, </span><span class="default">300</span><span class="keyword">), </span><span class="default">13</span><span class="keyword">, </span><span class="default">5</span><span class="keyword">);<br />
<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-type: image/jpeg"</span><span class="keyword">);<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-Disposition: attachment; filename="'</span><span class="keyword">.</span><span class="default">basename</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">).</span><span class="string">'"'</span><span class="keyword">);&nbsp; &nbsp; <br />
<br />
echo </span><span class="default">$image</span><span class="keyword">;<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82118""></a>
  <div class="note">
   <strong class="user">gcc dot programmer at gmail dot com</strong>
   <a href="#82118" class="date">28-Mar-2008 06:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The following was developed using Mac OSX ( Linux ).&nbsp; The ghostscript call would have to be changed on a Windows box...<br />
<br />
In an application I was developing, I needed to create .jpg thumbnails from .pdf uploaded files.&nbsp; After some research, I found one easy way to accomplish this was ( SIMPLIFIED ):<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp; &nbsp; exec</span><span class="keyword">(</span><span class="string">"sw/bin/gs -q -dNOPAUSE -dBATCH -sDEVICE=jpeg <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; -sOutputFile=test.jpg theFile.pdf"</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
This of course assumes that ghostscript is installed on the server, you have permissions, yada...<br />
<br />
Essentially this calls on ghostscript to do the conversion.<br />
<br />
So, then, once the new .jpg is created, it needed to be resized to accomodate the UI.&nbsp; Though I could easily do it from the command line with "convert", I was having issues using this command from PHP ( it's not my first language ).&nbsp; I found this thread while groping for a different method, and found an unworkable solution that stimulated me to write the following:<br />
<br />
( commented out lines were for debug, but might prove instructional for your own purposes, so I left them in )<br />
<br />
[This function takes in a .jpg file to be converted to a thumbnail, the new width you want the thumbnail to be, and the name to which you want the thumbnail saved.&nbsp; It then creates the thumbnail]<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp; &nbsp; </span><span class="keyword">function </span><span class="default">createImage</span><span class="keyword">( </span><span class="default">$upload</span><span class="keyword">, </span><span class="default">$newWidth</span><span class="keyword">, </span><span class="default">$name </span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">$info </span><span class="keyword">= </span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$upload</span><span class="keyword">) )<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//echo "width: "&nbsp; . $info[0] . "&lt;br/&gt;";<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //echo "height: " . $info[1] . "&lt;br/&gt;";<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //create crude aspect ratio:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$aspect </span><span class="keyword">= </span><span class="default">$info</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] / </span><span class="default">$info</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$newHeight </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">( </span><span class="default">$newWidth</span><span class="keyword">/</span><span class="default">$aspect </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//echo "$newHeight &lt;br/&gt;";<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$src </span><span class="keyword">= @</span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="string">"</span><span class="default">$upload</span><span class="string">"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ( !</span><span class="default">$src </span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tmp </span><span class="keyword">= @</span><span class="default">imagecreatetruecolor</span><span class="keyword">( </span><span class="default">$newWidth</span><span class="keyword">, </span><span class="default">$newHeight </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagecopyresampled</span><span class="keyword">( </span><span class="default">$tmp</span><span class="keyword">, </span><span class="default">$src</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$newWidth</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$newHeight</span><span class="keyword">, </span><span class="default">$info</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="default">$info</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] );<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagejpeg</span><span class="keyword">( </span><span class="default">$tmp</span><span class="keyword">, </span><span class="default">$name</span><span class="keyword">, </span><span class="default">100 </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagedestroy</span><span class="keyword">( </span><span class="default">$src </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagedestroy</span><span class="keyword">( </span><span class="default">$tmp </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; }<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
$upload = the path to the file you want to make a thumbnail from.<br />
<br />
$newWidth = the width of your thumbnails.<br />
<br />
$name = the path ( including name ) of the thumbnail you're creating.<br />
<br />
If I have test.jpg in my servers root directory, and I want a thumbnail<br />
with a width of 120 pixels, with the name thumb.jpg also to be saved<br />
in the servers root directory, I'd call this function thus:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp; &nbsp; createImage</span><span class="keyword">(</span><span class="string">"test.jpg"</span><span class="keyword">, </span><span class="default">120</span><span class="keyword">, </span><span class="string">"thumb.jpg"</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
I hope this makes life easier for somebody.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81854""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#81854" class="date">16-Mar-2008 07:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is a function to resize an image and maintain aspect ratio. It will resize jpeg, gif or png and could easily be modified to add bmp. The name field is the destination of the file minus the file extension:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">//name= filename minus type<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">createImage</span><span class="keyword">(</span><span class="default">$uploadedfile</span><span class="keyword">,</span><span class="default">$newWidth</span><span class="keyword">,</span><span class="default">$name</span><span class="keyword">) <br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Capture the original size of the uploaded image<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(!</span><span class="default">$info</span><span class="keyword">=</span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$uploadedfile</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; switch (</span><span class="default">$info</span><span class="keyword">[</span><span class="string">'mime'</span><span class="keyword">]) <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'image/jpeg'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$src </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$uploadedfile</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'image/gif'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$src </span><span class="keyword">= </span><span class="default">imagecreatefromgif</span><span class="keyword">(</span><span class="default">$uploadedfile</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'image/png'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$src </span><span class="keyword">= </span><span class="default">imagecreatefrompng</span><span class="keyword">(</span><span class="default">$uploadedfile</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; default:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//Change the filename to add the filetype<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$mime</span><span class="keyword">=</span><span class="default">split</span><span class="keyword">(</span><span class="string">"image/"</span><span class="keyword">,</span><span class="default">$info</span><span class="keyword">[</span><span class="string">'mime'</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$filename</span><span class="keyword">=</span><span class="default">$name</span><span class="keyword">.</span><span class="string">"."</span><span class="keyword">.</span><span class="default">$mime</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$size </span><span class="keyword">= </span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$uploadedfile</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$newHeight</span><span class="keyword">=</span><span class="default">aspect_ratio</span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">],</span><span class="default">$newWidth</span><span class="keyword">,</span><span class="default">$size</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tmp</span><span class="keyword">=</span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$newWidth</span><span class="keyword">,</span><span class="default">$newHeight</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// this line actually does the image resizing, copying from the original<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // image into the $tmp image<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">,</span><span class="default">$src</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$newWidth</span><span class="keyword">,</span><span class="default">$newHeight</span><span class="keyword">,</span><span class="default">$info</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="default">$info</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; switch (</span><span class="default">$info</span><span class="keyword">[</span><span class="string">'mime'</span><span class="keyword">])<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'image/jpeg'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">,</span><span class="default">$filename</span><span class="keyword">,</span><span class="default">100</span><span class="keyword">); </span><span class="comment">//100 is the quality settings, values range from 0-100.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'image/gif'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagegif</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">,</span><span class="default">$filename</span><span class="keyword">,</span><span class="default">100</span><span class="keyword">); </span><span class="comment">//100 is the quality settings, values range from 0-100.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'image/png'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagepng</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">,</span><span class="default">$filename</span><span class="keyword">); </span><span class="comment">//100 is the quality settings, values range from 0-100.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">); </span><span class="comment">// NOTE: PHP will clean up the temp file it created when the request<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // has completed.<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; if(!</span><span class="default">createImage</span><span class="keyword">(</span><span class="default">$uploadedfile</span><span class="keyword">,</span><span class="default">100</span><span class="keyword">, </span><span class="string">"uploaded_images/imgname"</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; echo </span><span class="string">"error"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="80533""></a>
  <div class="note">
   <strong class="user">james [at] bellisinasce.it</strong>
   <a href="#80533" class="date">21-Jan-2008 06:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When using <br />
<br />
ImageJpeg ($img, "", $qlty) or any other Image*() command, with direct output to browser, BE ABSOLUTELY CERTAIN that your php file does not contain any \r, \n, or white spaces before the &lt;? and after the ?&gt; signs.<br />
<br />
This should always kept in mind, not only for the file you are executing BUT ALSO FOR ALL THE INCLUDES called during the file execution!<br />
<br />
I got totally crazy about this, for a whole weekend :(<br />
My php editor did not correctly display a \n sign, as I was locally using a different charset/OS.<br />
<br />
example<br />
<br />
&lt;?<br />
include ("/usr/www.example.com/inc/function.inc.php");<br />
include ("/usr/www.example.com/inc/function.common.php");<br />
connect_db0 ();<br />
$admin_cookie = ckadmin_cookie ();<br />
...<br />
$img = file_get_contents ($path.$_GET['src']);<br />
$im = imagecreatefromstring ($img);<br />
header ("Content-Type: image/jpeg");&nbsp; &nbsp; &nbsp; &nbsp; <br />
imageJPEG ($im);<br />
imageDestroy ($im);&nbsp; &nbsp; <br />
...<br />
<br />
?&gt;<br />
<br />
If any of the included files, for any reason, prints an error message (or simply a warning) or has any white spaces/return/new line chars before "&lt;?" or&nbsp; after the "&gt;?" signs, the result will be a broken image! <br />
<br />
Even looking inside the defective image, it will be quite difficult to notice the unwanted characters, especially if you are using something like the windows' notepad... X(<br />
<br />
If nothing is found, with the file/php editors, and you are not sure about your charset compatibility, I suggest to try to edit directly the files on the server, if possible, and search for all unwanted chars. ;)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="79938""></a>
  <div class="note">
   <strong class="user">pbijl</strong>
   <a href="#79938" class="date">20-Dec-2007 12:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
note that using a different quality besides the default can result in strange cropping when resizing for example.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="78523""></a>
  <div class="note">
   <strong class="user">Michaelsoft</strong>
   <a href="#78523" class="date">16-Oct-2007 11:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I could not find any information on changing the DPI information on a JPG file using the GD lib. Since changing this does not resize or scale the actual image, it is only a header-setting.<br />
The following snipplet will save your $image to $file and set the DPI to 150.<br />
<br />
<span class="default">&lt;?php<br />
<br />
&nbsp; imagejpeg</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">$file</span><span class="keyword">, </span><span class="default">75</span><span class="keyword">);<br />
<br />
&nbsp; </span><span class="comment">// Change DPI<br />
&nbsp; </span><span class="default">$dpi_x&nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">150</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$dpi_y&nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">150</span><span class="keyword">;<br />
&nbsp; <br />
&nbsp; </span><span class="comment">// Read the file<br />
&nbsp; </span><span class="default">$size&nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">filesize</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$image&nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);<br />
<br />
&nbsp; </span><span class="comment">// Update DPI information in the JPG header<br />
&nbsp; </span><span class="default">$image</span><span class="keyword">[</span><span class="default">13</span><span class="keyword">] = </span><span class="default">chr</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$image</span><span class="keyword">[</span><span class="default">14</span><span class="keyword">] = </span><span class="default">chr</span><span class="keyword">(</span><span class="default">floor</span><span class="keyword">(</span><span class="default">$dpi_x</span><span class="keyword">/</span><span class="default">255</span><span class="keyword">));<br />
&nbsp; </span><span class="default">$image</span><span class="keyword">[</span><span class="default">15</span><span class="keyword">] = </span><span class="default">chr</span><span class="keyword">(&nbsp; &nbsp; &nbsp; </span><span class="default">$dpi_x</span><span class="keyword">%</span><span class="default">255</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$image</span><span class="keyword">[</span><span class="default">16</span><span class="keyword">] = </span><span class="default">chr</span><span class="keyword">(</span><span class="default">floor</span><span class="keyword">(</span><span class="default">$dpi_y</span><span class="keyword">/</span><span class="default">255</span><span class="keyword">));<br />
&nbsp; </span><span class="default">$image</span><span class="keyword">[</span><span class="default">17</span><span class="keyword">] = </span><span class="default">chr</span><span class="keyword">(&nbsp; &nbsp; &nbsp; </span><span class="default">$dpi_y</span><span class="keyword">%</span><span class="default">255</span><span class="keyword">);<br />
<br />
&nbsp; </span><span class="comment">// Write the new JPG<br />
&nbsp; </span><span class="default">$f </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="string">'w'</span><span class="keyword">);<br />
&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$f</span><span class="keyword">, </span><span class="default">$msg</span><span class="keyword">, </span><span class="default">$size</span><span class="keyword">);<br />
&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$f</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
P.s. not fully tested (yet) but it works for my images ...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76780""></a>
  <div class="note">
   <strong class="user">Elliott Brueggeman</strong>
   <a href="#76780" class="date">30-Jul-2007 06:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I did an experiment with the image quality parameter of the imagejpeg() function when creating jpegs. I found the optimal image quality with file size is taken into account to be 80 - very close to the default value of 75.<br />
<br />
Anything over 80 results in an unnecessary increase in file size without much increase in image quality.<br />
<br />
Results and sample pictures: <a href="http://www.ebrueggeman.com/article_php_image_optimization.php" rel="nofollow" target="_blank">http://www.ebrueggeman.com/article_php_image_optimization.php</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76773""></a>
  <div class="note">
   <strong class="user">write2shadi [at] gmail [dot] com</strong>
   <a href="#76773" class="date">30-Jul-2007 03:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
after seeking for 2 days why ImageJpeg() was writing an empty file to the server, it was due to insufficient disk space on my hosting plan.... hope this helps,</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76698""></a>
  <div class="note">
   <strong class="user">Pedja (pedja at supurovic dot net)</strong>
   <a href="#76698" class="date">26-Jul-2007 07:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is sample function that creates thumbnail of source JPEG file. Thumbnail wil be in square form (with and height are the same), and original image cropped to fit in.<br />
<br />
Parameters:<br />
<br />
$p_thumb_file - name of the file (including path) where thumb should be saved to<br />
<br />
$p_photo_file - nam of the source JPEG file (including path) thatthumbnail should be created of<br />
<br />
$p_max_size - with and height (they will be the same) in pixels for thumbnail image<br />
<br />
$p_quality - quality of jpeg thumbnail<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">photoCreateCropThumb </span><span class="keyword">(</span><span class="default">$p_thumb_file</span><span class="keyword">, </span><span class="default">$p_photo_file</span><span class="keyword">, </span><span class="default">$p_max_size</span><span class="keyword">, </span><span class="default">$p_quality </span><span class="keyword">= </span><span class="default">75</span><span class="keyword">) {<br />
&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$pic </span><span class="keyword">= @</span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$p_photo_file</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$pic</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$thumb </span><span class="keyword">= @</span><span class="default">imagecreatetruecolor </span><span class="keyword">(</span><span class="default">$p_max_size</span><span class="keyword">, </span><span class="default">$p_max_size</span><span class="keyword">) or die (</span><span class="string">"Can't create Image!"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$width </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$pic</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$height </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$pic</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$width </span><span class="keyword">&lt; </span><span class="default">$height</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$twidth </span><span class="keyword">= </span><span class="default">$p_max_size</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$theight </span><span class="keyword">= </span><span class="default">$twidth </span><span class="keyword">* </span><span class="default">$height </span><span class="keyword">/ </span><span class="default">$width</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagecopyresized</span><span class="keyword">(</span><span class="default">$thumb</span><span class="keyword">, </span><span class="default">$pic</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, (</span><span class="default">$height</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">)-(</span><span class="default">$width</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">), </span><span class="default">$twidth</span><span class="keyword">, </span><span class="default">$theight</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">); <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$theight </span><span class="keyword">= </span><span class="default">$p_max_size</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$twidth </span><span class="keyword">= </span><span class="default">$theight </span><span class="keyword">* </span><span class="default">$width </span><span class="keyword">/ </span><span class="default">$height</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagecopyresized</span><span class="keyword">(</span><span class="default">$thumb</span><span class="keyword">, </span><span class="default">$pic</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, (</span><span class="default">$width</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">)-(</span><span class="default">$height</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">), </span><span class="default">0</span><span class="keyword">, </span><span class="default">$twidth</span><span class="keyword">, </span><span class="default">$theight</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">); <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ImageJPEG </span><span class="keyword">(</span><span class="default">$thumb</span><span class="keyword">, </span><span class="default">$p_thumb_file</span><span class="keyword">, </span><span class="default">$p_quality</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74789""></a>
  <div class="note">
   <strong class="user">Ross</strong>
   <a href="#74789" class="date">27-Apr-2007 04:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is a function that I had developed for a CMS.&nbsp; The idea is that it runs from an upload form. The user uploads a hi-res image, which is copied to the server, a low res one is created (half the width/height of hi res) and a thumbnail is created.<br />
<br />
The image is resized matching the smallest side of the image to the thumbnail size (in this example it is 70px).&nbsp; The other side is then resized proportionally (which will end up being more than 70px) and cropped and centered so that it too is 70px.<br />
<br />
There is a mixture of imagecopyresized and imagecopyresampled, i have chosen the ones that work best in this situation but imagecopyresampled gives a much nicer image.<br />
<br />
Hope this helps someone.<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $dest_hires = "../images/artistsphotos/".$imageName."h.jpg";<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $dest_lowres = "../images/artistsphotos/".$imageName."l.jpg";<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $dest_thumbnail = "../images/artistsphotos/".$imageName."i.jpg";<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; /*upload full size image to site - if it is hi res we do not want to manipulate it<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; want to leave all qualit in tact.*/<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; move_uploaded_file($_FILES["fileartimg"]["tmp_name"],"$dest_hires");<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $ims = getimagesize($dest_hires); //now we have dimensions of original image...<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; /******creating lower res image******/<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $newwidth=ceil($ims[0]/2);//half the width of original file - use ceil() to avoid decimals.<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $newheight=ceil($ims[1]/2);//half the height<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $img = imagecreatetruecolor($newwidth,$newheight); //low res img - always use truecolor to prevent any 'wierd' colour effects.<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $org_img = imagecreatefromjpeg($dest_hires); //load in hi res<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; imagecopyresized($img, $org_img, 0, 0, 0, 0, $newwidth, $newheight, $ims[0], $ims[1]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; imagejpeg($img,$dest_lowres,80);//save to file low res img.<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; imagedestroy($img);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; /******creating thumbnail******/<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; //see which is bigger, x or y axis, then resize smaller side to 70.<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; //$resizewidth is the temporary width of the thumbnail, it is in fact the width when it has been resized<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; //using the apect ration and before cropping, at this stage the thumb will not be 70px X 70px<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; //unless it is a square. Same applies to height ($resizeheight).<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; //$thumbx and $thumby are the positions of the cropping are for thumbnail, these are calculated<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; //so that the cropped image is centered.<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ($ims[0]&gt;$ims[1])<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {//then the width is bigger<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $aspectRatio = $ims[1]/70;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $resizewidth=ceil($ims[0]/$aspectRatio);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $resizeheight=70;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $thumbx=ceil(($resizewidth - $thumbwidth)/2);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $thumby=0;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else if ($ims[0]&lt;$ims[1])<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {//then the height is bigger<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $aspectRatio = $ims[0]/70;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $resizewidth=70;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $resizeheight=ceil($ims[1]/$aspectRatio);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $thumbx=0;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $thumby=ceil(($resizeheight - $thumbheight)/2);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else if ($ims[0]==$ims[1])<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {//then we have a perfect square.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $resizewidth=70;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $resizeheight=70;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $thumbx=0;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $thumby=0;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $img = imagecreatetruecolor($resizewidth,$resizeheight);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $org_img = imagecreatefromjpeg($dest_lowres);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; //this is the almost thumbnail sized image with everything resized to ratio<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; imagecopyresampled($img, $org_img, 0, 0, 0, 0, $resizewidth, $resizeheight, $newwidth, $newheight);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $img2 = imagecreatetruecolor($thumbwidth,$thumbheight);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; //this is the thumbnail image, where the above is cropped.<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; imagecopyresized($img2, $img, 0, 0, $thumbx, $thumby, $resizewidth, $resizeheight, $resizewidth, $resizeheight);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; imagejpeg($img2,$dest_thumbnail,100);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; imagedestroy($img);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; imagedestroy($img2);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="72153""></a>
  <div class="note">
   <strong class="user">john at mtslink dot com</strong>
   <a href="#72153" class="date">05-Jan-2007 05:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just wanted to mention that the create_thumbnail script below fails on uppercase filenames. Many cameras default to IMG_XX.JPG and since strpos is case sensitive it fails.<br />
<br />
I changed all the strpos to stripos and it worked wonderfully.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69168""></a>
  <div class="note">
   <strong class="user">webmaster at jongliertreff dot de</strong>
   <a href="#69168" class="date">25-Aug-2006 01:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's another on-the-fly thumbnail creation script.
<br />
When I scripted the pictuerviewer on my page, I had all the pictures only in full size and qualit, because I wanted the posibility für visitors to download the pictures.
<br />
But as Imagesizes of more than 4 MP are to large for websites, I created thumbnails and the smaller pictures on the fly. But I found out, that the Script needed too much RAM, especially in the thumbnail overview, when I had more then 50 thumbnails to create on the fly at the same time.
<br />

<br />
So I modified my image creator and my viewer to let them store images, that are created. So only the first visitor has to wait (which is usually me for controlling the uploads und updates), all other visitors get the stored images, which is much faster.
<br />

<br />
Create different folders. I have a main folder called 'imagesdb' and the tree subfolders full (Full quality images), show (images for the picture viewer) and thumb (for thumbnails in overview).
<br />

<br />
Store the script for example as image.php and link it like that:
<br />

<br />
<span class="default">&lt;?PHP
<br />
$image_name </span><span class="keyword">= </span><span class="string">"foo.jpg"</span><span class="keyword">;
<br />
</span><span class="default">$style </span><span class="keyword">= </span><span class="string">"show"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; </span><span class="comment">// I've taken the foldernames. It's easier. For the 
<br />
&nbsp;&nbsp; &nbsp; //thumbnails replace "show" with "thumb".
<br />
</span><span class="default">$image_name </span><span class="keyword">= </span><span class="string">"imagesdb/</span><span class="default">$style</span><span class="string">/</span><span class="default">$image_name</span><span class="string">"</span><span class="keyword">;
<br />
if(!</span><span class="default">file_exists</span><span class="keyword">(</span><span class="default">$image_name</span><span class="keyword">))
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$image_name </span><span class="keyword">= </span><span class="string">"image.php?image_name=</span><span class="default">$image_name</span><span class="string">&amp;style=</span><span class="default">$style</span><span class="string">"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; </span><span class="comment">// only if file doesn't exist call the on-the-fly creating file
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Now the main script, stored in the file image.php:
<br />

<br />
<span class="default">&lt;?PHP
<br />

<br />
$image_name </span><span class="keyword">= </span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'image_name'</span><span class="keyword">];
<br />
</span><span class="default">$style </span><span class="keyword">= </span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'style'</span><span class="keyword">];
<br />

<br />
&nbsp;&nbsp; &nbsp; </span><span class="comment">// Now set the maximum sizes to the different styles.
<br />
&nbsp;&nbsp; &nbsp; // You may set additional styles, but remember to
<br />
&nbsp;&nbsp; &nbsp; // create the according subfolders.
<br />

<br />
</span><span class="keyword">switch(</span><span class="default">$style</span><span class="keyword">) {
<br />
&nbsp; case </span><span class="string">"show"</span><span class="keyword">:
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$max_size </span><span class="keyword">= </span><span class="default">800</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; break;
<br />
&nbsp; case </span><span class="string">"thumb"</span><span class="keyword">:
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$max_size </span><span class="keyword">= </span><span class="default">125</span><span class="keyword">;
<br />
}
<br />

<br />
</span><span class="default">$dest_file </span><span class="keyword">= </span><span class="string">"imagesdb/</span><span class="default">$style</span><span class="string">/</span><span class="default">$image_name</span><span class="string">"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; </span><span class="comment">// set output file
<br />
</span><span class="default">$image_file </span><span class="keyword">= </span><span class="string">"imagesdb/full/</span><span class="default">$image_name</span><span class="string">"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; </span><span class="comment">// set source file
<br />
</span><span class="default">$size </span><span class="keyword">= </span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$image_file</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; </span><span class="comment">// get original size
<br />

<br />
</span><span class="keyword">if(</span><span class="default">$size</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] &gt; </span><span class="default">$size</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]) {
<br />
&nbsp; </span><span class="default">$divisor </span><span class="keyword">= </span><span class="default">$size</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] / </span><span class="default">$max_size</span><span class="keyword">;
<br />
}
<br />
else {
<br />
&nbsp; </span><span class="default">$divisor </span><span class="keyword">= </span><span class="default">$size</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] / </span><span class="default">$max_size</span><span class="keyword">;
<br />
}
<br />
&nbsp;&nbsp; &nbsp; </span><span class="comment">// to get allways pictures of the same size, which ist
<br />
&nbsp;&nbsp; &nbsp; // mostly wanted in imageviewers, look what ist larger:
<br />
&nbsp;&nbsp; &nbsp; // width or height
<br />

<br />
</span><span class="default">$new_width </span><span class="keyword">= </span><span class="default">$size</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] / </span><span class="default">$divisor</span><span class="keyword">;
<br />
</span><span class="default">$new_height </span><span class="keyword">= </span><span class="default">$size</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] / </span><span class="default">$divisor</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; </span><span class="comment">// set new sizes
<br />

<br />
</span><span class="default">settype</span><span class="keyword">(</span><span class="default">$new_width</span><span class="keyword">, </span><span class="string">'integer'</span><span class="keyword">);
<br />
</span><span class="default">settype</span><span class="keyword">(</span><span class="default">$new_height</span><span class="keyword">, </span><span class="string">'integer'</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; </span><span class="comment">// sizes should be integers
<br />

<br />
</span><span class="default">$image_big </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$image_file</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; </span><span class="comment">// load original image
<br />
</span><span class="default">$image_small </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$new_width</span><span class="keyword">, </span><span class="default">$new_height</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; </span><span class="comment">// create new image
<br />
</span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$image_small</span><span class="keyword">, </span><span class="default">$image_big</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">, </span><span class="default">$new_width</span><span class="keyword">,</span><span class="default">$new_height</span><span class="keyword">, </span><span class="default">$size</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">],</span><span class="default">$size</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);
<br />
&nbsp;&nbsp; &nbsp; </span><span class="comment">// imageresampled whill result in a much higher quality
<br />
&nbsp;&nbsp; &nbsp; // than imageresized
<br />
</span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$image_big</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; </span><span class="comment">// the original data are no longer used
<br />

<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-type: image/jpeg"</span><span class="keyword">);
<br />

<br />
if(</span><span class="default">$style</span><span class="keyword">==</span><span class="string">"show" </span><span class="keyword">|| </span><span class="default">$style</span><span class="keyword">==</span><span class="string">"thumb"</span><span class="keyword">) {
<br />
&nbsp; if(!</span><span class="default">file_exists</span><span class="keyword">(</span><span class="default">$dest_file</span><span class="keyword">))
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$image_small</span><span class="keyword">, </span><span class="default">$dest_file</span><span class="keyword">, </span><span class="default">100</span><span class="keyword">);
<br />
}
<br />
&nbsp;&nbsp; &nbsp; </span><span class="comment">// if you have set additional sizese put them in the
<br />
&nbsp;&nbsp; &nbsp; // if-arguments, too.
<br />
&nbsp;&nbsp; &nbsp; // if someone calls the image.php directly in the
<br />
&nbsp;&nbsp; &nbsp; // browser with imagenames allready existing, they
<br />
&nbsp;&nbsp; &nbsp; // won't be overwritten
<br />

<br />
</span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$image_small</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">100</span><span class="keyword">);
<br />
</span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$image_small</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; </span><span class="comment">// finally send image to browser and destroy no longer
<br />
&nbsp;&nbsp; &nbsp; // needed data.
<br />

<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
As this website helped me for several times in the past and for creating this script, I hope I can help others with this script saving the time for developing a much more performant solution than an allways-on-the-fly-creating script.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68356""></a>
  <div class="note">
   <strong class="user">chris dot calo at gmail dot com</strong>
   <a href="#68356" class="date">24-Jul-2006 04:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Thanks to Stuart and Darren for the corrections to the create_thumbnail function.&nbsp; Another note on that function: imagecreatefromwbmp was incorrectly used.&nbsp; WBMPs are wireless bitmaps, not windows bitmaps (thanks to clambert at whitecrown), so the thumbnail routine as is will not be able to handle windows bitmaps.&nbsp; See the notes at <a href="http://us2.php.net/manual/en/function.imagecreatefromwbmp.php for tips on working with windows bitmaps." rel="nofollow" target="_blank">http://us2.php.net/manual/en/function.imagecreatefromwbmp.php for tips on working with windows bitmaps.</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68333""></a>
  <div class="note">
   <strong class="user">stuart at purpletoucan dot com</strong>
   <a href="#68333" class="date">23-Jul-2006 07:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Thanks to Chris dot Calo for the thumbnail snippet.&nbsp; The file type issue is easily resolved by getting the type from the file with getimagesize, and you can handle unsupported types at that stage too.&nbsp; Thus:<br />
<br />
&nbsp;&nbsp; list($img_width,$img_height, $type) = getimagesize($source_file); // Get the original dimentions<br />
&nbsp;&nbsp; if ($type != 1 &amp;&amp; $type != 2 &amp;&amp; $type != 3 &amp;&amp; $type != 15) { die("Your file is not a supported format"); }<br />
<br />
...and then later check the type again to open the image correctly:<br />
<br />
&nbsp;&nbsp; if ( $type == 1 ) { $img_source = imagecreatefromgif($source_file); }<br />
&nbsp;&nbsp; else if ( $type == 2 ) { $img_source = imagecreatefromjpeg($source_file); }<br />
&nbsp;&nbsp; else if ( $type == 3 ) { $img_source = imagecreatefrompng($source_file); }<br />
&nbsp;&nbsp; else if ( $type == 15 ) { $img_source = imagecreatefromwbmp($source_file); }</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68231""></a>
  <div class="note">
   <strong class="user">Darren Kulp ( kulp at thekulp dot com )</strong>
   <a href="#68231" class="date">19-Jul-2006 05:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
With regard to chris.calo's code:<br />
<br />
// The following block retrieves the source file.&nbsp; It assumes the filename extensions match the file's format.<br />
&nbsp;&nbsp; if ( strpos($source_file,".gif") ) { $img_source = imagecreatefromgif($source_file); }<br />
&nbsp;&nbsp; if ( (strpos($source_file,".jpg")) || (strpos($source_file,".jpeg")) )<br />
&nbsp;... etc.<br />
<br />
It assumes more than that, namely that the filename does not contain the strings '.gif', '.jpg', '.jpeg', '.bmp', or '.png' *anywhere* in the string. Some valid files with special filenames could break this; for example, a file named "used.to.be.a.png.file.gif" would cause this script to attempt to load the file as a PNG. Obviously this is a rare case, but the issue could be easily avoided by using "else ifs" (uses less CPU time) or checking that the extension abuts the end of the string or both.<br />
<br />
That said, the whole business could be avoided if PHP didn't clutter the namespace with different functions to do the same thing with different image formats. Ick.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68194""></a>
  <div class="note">
   <strong class="user">chris dot calo at gmail dot com</strong>
   <a href="#68194" class="date">17-Jul-2006 11:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
function create_thumbnail( $source_file, $destination_file, $max_dimension)<br />
{<br />
&nbsp;&nbsp;&nbsp; list($img_width,$img_height) = getimagesize($source_file); // Get the original dimentions<br />
&nbsp;&nbsp;&nbsp; $aspect_ratio = $img_width / $img_height;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; if ( ($img_width &gt; $max_dimension) || ($img_height &gt; $max_dimension) ) // If either dimension is too big...<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( $img_width &gt; $img_height ) // For wide images...<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $new_width = $max_dimension;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $new_height = $new_width / $aspect_ratio;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; elseif ( $img_width &lt; $img_height ) // For tall images...<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $new_height = $max_dimension;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $new_width = $new_height * $aspect_ratio;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; elseif ( $img_width == $img_height ) // For square images...<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $new_width = $max_dimension;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $new_height = $max_dimension;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else { echo "Error reading image size."; return FALSE; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; else { $new_width = $img_width; $new_height = $img_height; } // If it's already smaller, don't change the size.<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; // Make sure these are integers.<br />
&nbsp;&nbsp;&nbsp; $new_width = intval($new_width);<br />
&nbsp;&nbsp;&nbsp; $new_height = intval($new_height);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; $thumbnail = imagecreatetruecolor($new_width,$new_height); // Creates a new image in memory.<br />
<br />
&nbsp;&nbsp;&nbsp; // The following block retrieves the source file.&nbsp; It assumes the filename extensions match the file's format.<br />
&nbsp;&nbsp;&nbsp; if ( strpos($source_file,".gif") ) { $img_source = imagecreatefromgif($source_file); }<br />
&nbsp;&nbsp;&nbsp; if ( (strpos($source_file,".jpg")) || (strpos($source_file,".jpeg")) )<br />
&nbsp;&nbsp;&nbsp; { $img_source = imagecreatefromjpeg($source_file); }<br />
&nbsp;&nbsp;&nbsp; if ( strpos($source_file,".bmp") ) { $img_source = imagecreatefromwbmp($source_file); }<br />
&nbsp;&nbsp;&nbsp; if ( strpos($source_file,".png") ) { $img_source = imagecreatefrompng($source_file); }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; // Here we resample and create the new jpeg.<br />
&nbsp;&nbsp;&nbsp; imagecopyresampled($thumbnail, $img_source, 0, 0, 0, 0, $new_width, $new_height, $img_width, $img_height);<br />
&nbsp;&nbsp;&nbsp; imagejpeg( $thumbnail, $destination_file, 100 );<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; // Finally, we destroy the two images in memory.<br />
&nbsp;&nbsp;&nbsp; imagedestroy($img_source);<br />
&nbsp;&nbsp;&nbsp; imagedestroy($thumbnail);<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="63887""></a>
  <div class="note">
   <strong class="user">your [dot] sheepy [at] gmail [dot] com</strong>
   <a href="#63887" class="date">03-Apr-2006 10:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Regarding Carl Gieringer's comment, it is possible to have PHP files in utf-8.&nbsp; Just make sure the editor does not output BOM, which is unnecessary in utf-8 anyway.<br />
<br />
Except for any editors from Microsoft, most programmer's editors that supports utf allows you to surpress BOM.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="61942""></a>
  <div class="note">
   <strong class="user">doobd at doobd dot com</strong>
   <a href="#61942" class="date">15-Feb-2006 06:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
in addition to my THUMBNAIL GENERATOR script:<br />
<br />
i forgot to say, src path must not be <a href="http:// but server path (e.g. for some linux server: src=/home/users/user1/public_html/images/image1.jpg" rel="nofollow" target="_blank">http:// but server path (e.g. for some linux server: src=/home/users/user1/public_html/images/image1.jpg</a>) or relative path, as in example in script (src=test.jpg, src=../test.jpg, src=pictures/test.jpg...)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="61938""></a>
  <div class="note">
   
   <a href="#61938" class="date">15-Feb-2006 04:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
THUMBNAIL GENERATOR<br />
<br />
Hope someone will find this usefull... save it to thumb.php and use it for on-the-fly thumbnails generating <br />
<br />
e.g. <br />
&lt;img src= "thumb.php?src=pic.jpg&amp;wmax=150&amp;hmax=100&amp;quality=90&amp;bgcol=FF0000"&gt; &lt;/img&gt;<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// by dooobd@NOSPAM.doobd.com<br />
&nbsp;&nbsp;&nbsp; //<br />
&nbsp;&nbsp;&nbsp; // proportional on-the-fly thumb generator from JPG images<br />
&nbsp;&nbsp;&nbsp; //<br />
&nbsp;&nbsp;&nbsp; // usage example: <br />
&nbsp;&nbsp;&nbsp; // &lt;img src= "thumb.php?src=pic.jpg&amp;wmax=150&amp;hmax=100&amp;quality=90&amp;bgcol=FF0000"&gt; &lt;/img&gt;<br />
&nbsp;&nbsp;&nbsp; //<br />
&nbsp;&nbsp;&nbsp; // parameters:&nbsp; src = source image<br />
&nbsp;&nbsp;&nbsp; //&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wmax = max width<br />
&nbsp;&nbsp;&nbsp; //&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; hmax = max height<br />
&nbsp;&nbsp;&nbsp; //&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; quality = JPG quality of generated thumb - optional. <br />
&nbsp;&nbsp;&nbsp; //&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if not specified, quality=90<br />
&nbsp;&nbsp;&nbsp; //&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bgcol = if specified, allways generates exact wmax x hmax sized thumb, <br />
&nbsp;&nbsp;&nbsp; //&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; with bacground color bgcol and centered source image <br />
&nbsp;&nbsp;&nbsp; //<br />
&nbsp;&nbsp;&nbsp; // note: if source image is smaller than desired thumbnail, it will not be resized!<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-type: image/jpeg"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$source </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$orig_w</span><span class="keyword">=</span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$orig_h</span><span class="keyword">=</span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$orig_w</span><span class="keyword">&gt;</span><span class="default">$wmax </span><span class="keyword">|| </span><span class="default">$orig_h</span><span class="keyword">&gt;</span><span class="default">$hmax</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$thumb_w</span><span class="keyword">=</span><span class="default">$wmax</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$thumb_h</span><span class="keyword">=</span><span class="default">$hmax</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$thumb_w</span><span class="keyword">/</span><span class="default">$orig_w</span><span class="keyword">*</span><span class="default">$orig_h</span><span class="keyword">&gt;</span><span class="default">$thumb_h</span><span class="keyword">) <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$thumb_w</span><span class="keyword">=</span><span class="default">round</span><span class="keyword">(</span><span class="default">$thumb_h</span><span class="keyword">*</span><span class="default">$orig_w</span><span class="keyword">/</span><span class="default">$orig_h</span><span class="keyword">); <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$thumb_h</span><span class="keyword">=</span><span class="default">round</span><span class="keyword">(</span><span class="default">$thumb_w</span><span class="keyword">*</span><span class="default">$orig_h</span><span class="keyword">/</span><span class="default">$orig_w</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; } else<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$thumb_w</span><span class="keyword">=</span><span class="default">$orig_w</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$thumb_h</span><span class="keyword">=</span><span class="default">$orig_h</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if (!@</span><span class="default">$bgcol</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$thumb</span><span class="keyword">=</span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$thumb_w</span><span class="keyword">,</span><span class="default">$thumb_h</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$thumb</span><span class="keyword">,</span><span class="default">$source</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$thumb_w</span><span class="keyword">,</span><span class="default">$thumb_h</span><span class="keyword">,</span><span class="default">$orig_w</span><span class="keyword">,</span><span class="default">$orig_h</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; else<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$thumb</span><span class="keyword">=</span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$wmax</span><span class="keyword">,</span><span class="default">$hmax</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagefilledrectangle</span><span class="keyword">(</span><span class="default">$thumb</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$wmax</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">,</span><span class="default">$hmax</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">,</span><span class="default">intval</span><span class="keyword">(</span><span class="default">$bgcol</span><span class="keyword">,</span><span class="default">16</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$thumb</span><span class="keyword">,</span><span class="default">$source</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">round</span><span class="keyword">((</span><span class="default">$wmax</span><span class="keyword">-</span><span class="default">$thumb_w</span><span class="keyword">)/</span><span class="default">2</span><span class="keyword">),</span><span class="default">round</span><span class="keyword">((</span><span class="default">$hmax</span><span class="keyword">-</span><span class="default">$thumb_h</span><span class="keyword">)/</span><span class="default">2</span><span class="keyword">),<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$thumb_w</span><span class="keyword">,</span><span class="default">$thumb_h</span><span class="keyword">,</span><span class="default">$orig_w</span><span class="keyword">,</span><span class="default">$orig_h</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if (!@</span><span class="default">$quality</span><span class="keyword">) </span><span class="default">$quality</span><span class="keyword">=</span><span class="default">90</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$thumb</span><span class="keyword">,</span><span class="string">""</span><span class="keyword">,</span><span class="default">$quality</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$thumb</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="60315""></a>
  <div class="note">
   
   <a href="#60315" class="date">03-Jan-2006 02:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hi<br />
<br />
I had similar problem with safe mode. My solution is:<br />
<br />
before imagejpeg(), touch() etc.<br />
write:<br />
ini_set(safe_mode,Off);<br />
and after everything:<br />
ini_set(safe_mode,On);<br />
<br />
strange, but it works <br />
Chears2All</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="59999""></a>
  <div class="note">
   <strong class="user">aerowinx at hotmail dot de</strong>
   <a href="#59999" class="date">22-Dec-2005 12:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If imagejpeg brings up this warning:<br />
<br />
Warning: imagejpeg(): Unable to access data ...<br />
<br />
it could be a problem with "Safe Mode". A solution could be to touch the new file before, like:<br />
<br />
touch($newfile);<br />
imagejpeg($image_p, $newfile, 100);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="59848""></a>
  <div class="note">
   <strong class="user">Kenneth Keiter</strong>
   <a href="#59848" class="date">18-Dec-2005 05:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
So.. after messing around with this beast of a function for hours, I discovered that it DOES NOT preserve the resource it is using the create the image, nor do imagepng() or imagegif(). By this I mean that you can not run two imagejpeg(), imagepng() or imagegif() calls on the same resource. Another possibly undocumented quirk... :-(</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="58392""></a>
  <div class="note">
   <strong class="user">I_have at no_email_for_spam dot com</strong>
   <a href="#58392" class="date">02-Nov-2005 06:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The behaviour of not being allowed to write the file is based on a change in latest release, see <a href="http://www.php.net/ChangeLog-4.php#4.4.1" rel="nofollow" target="_blank">http://www.php.net/ChangeLog-4.php#4.4.1</a><br />
<br />
- Added missing safe_mode checks for image* functions and cURL.<br />
- ...<br />
<br />
Some people (including me) consider this new behaviour as broken, see also <a href="http://bugs.php.net/bug.php?id=35060 - please vote for/against the bug if you feel same/different." rel="nofollow" target="_blank">http://bugs.php.net/bug.php?id=35060 - please vote for/against the bug if you feel same/different.</a><br />
<br />
Workaround is e.g. a touch($filename); before the imagejpeg($im,$filename);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="58391""></a>
  <div class="note">
   <strong class="user">moron at industrial dot org</strong>
   <a href="#58391" class="date">02-Nov-2005 05:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Please note that there is a bug report open for the currently broken safe_mode behaviour on this function:<br />
<br />
<a href="http://bugs.php.net/?id=35060" rel="nofollow" target="_blank">http://bugs.php.net/?id=35060</a><br />
<br />
According to the PHP staffer who has responded the docs are wrong (I don't agree but I'm also not their employee).&nbsp; <br />
<br />
The work around is to use touch() (or any other file system function that can do this) to create the file first before using imagejpeg().</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="58375""></a>
  <div class="note">
   <strong class="user">mitnick at cc dot lv</strong>
   <a href="#58375" class="date">02-Nov-2005 11:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
i had the same problem as tobylewis had<br />
<br />
when i tried to call imagejpeg(), width porperly parameters given it displayed <br />
imagejpeg(): Unable to access usr/home/public_html/pic1.jpg<br />
<br />
imho if not correctly configured server this function is not allowed to create the file on disk.<br />
<br />
the workaround however is if you create the file using some other function, before call imagejpeg(). something like this<br />
<br />
&lt;?<br />
$fh=fopen($file_name_dest,'w');<br />
fclose($fh);<br />
imagejpeg($dest,$file_name_dest, $quality);&nbsp; <br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="56893""></a>
  <div class="note">
   <strong class="user">mbailey [at] aethon [dt] co [dt] uk</strong>
   <a href="#56893" class="date">18-Sep-2005 10:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
&gt;&gt;Bram Van Dam's<br />
<br />
note below is missing "()" from the ob_end_clean call:<br />
<br />
ob_end_clean; // stop this output buffer<br />
<br />
should read<br />
<br />
ob_end_clean(); // stop this output buffer<br />
<br />
You can then use this for adding content-length headers (for example flash requires a content length in advance to create loaders)<br />
<br />
e.g.<br />
<br />
...<br />
<br />
ob_start(); // start a new output buffer<br />
&nbsp;&nbsp; imagejpeg( $newimage, "", 90 );<br />
&nbsp;&nbsp; $ImageData = ob_get_contents();<br />
&nbsp;&nbsp; $ImageDataLength = ob_get_length();<br />
ob_end_clean(); // stop this output buffer<br />
<br />
header("Content-type: image/jpeg") ;<br />
header("Content-Length: ".$ImageDataLength);<br />
echo $ImageData;<br />
<br />
...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="56240""></a>
  <div class="note">
   <strong class="user">(enVide neFelibata) envide at tugamail dot com</strong>
   <a href="#56240" class="date">28-Aug-2005 04:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Every script I was writing was giving me an error.<br />
When writing the following code I was able, as a client, to browse the website and save the images (Save image as...) with IE. Yet with Firefox and family the browser tried to save them as 'script_name.php' instead of 'image_name.jpg'.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; header</span><span class="keyword">(</span><span class="string">"Content-Type: image/jpeg"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">,</span><span class="string">''</span><span class="keyword">,</span><span class="default">100</span><span class="keyword">); </span><span class="comment">// Output to Browser <br />
</span><span class="default">?&gt;<br />
</span><br />
After trying to save all the watermarked images or saving the image as 'temp.jpg' before outputing it to user, I've read this topic on BugZilla that advised to add the following header:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; header</span><span class="keyword">(</span><span class="string">"Content-Type: image/jpeg"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-Disposition: attachment; filename=image_name.jpg"</span><span class="keyword">); </span><span class="comment">// THIS ONE<br />
</span><span class="default">?&gt;<br />
</span><br />
Sorry about the English.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="55987""></a>
  <div class="note">
   <strong class="user">Bram Van Dam</strong>
   <a href="#55987" class="date">19-Aug-2005 09:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you wish to capture the jpg data into a variable, rather than outputting it or saving it into a file (perhaps so you can put it in a database), you might want to consider output buffering. Something along these lines should work:<br />
<br />
<span class="default">&lt;?php<br />
ob_start</span><span class="keyword">(); </span><span class="comment">// start a new output buffer<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagejpeg</span><span class="keyword">( </span><span class="default">$newimage</span><span class="keyword">, </span><span class="default">NULL</span><span class="keyword">, </span><span class="default">100 </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ImageData </span><span class="keyword">= </span><span class="default">ob_get_contents</span><span class="keyword">();<br />
</span><span class="default">ob_end_clean</span><span class="keyword">; </span><span class="comment">// stop this output buffer<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="55530""></a>
  <div class="note">
   <strong class="user">John Luetke &lt;johnl1479 gmail com&gt;</strong>
   <a href="#55530" class="date">06-Aug-2005 02:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Rewrote the manual example into this function for creating a thumbnail image:<br />
<br />
function thumbnail_jpeg ($original, $thumbnail, $width, $height, $quality) {<br />
&nbsp; list($width_orig, $height_orig) = getimagesize($original);<br />
&nbsp; if ($width &amp;&amp; ($width_orig &lt; $height_orig)) {<br />
&nbsp;&nbsp;&nbsp; $width = ($height / $height_orig) * $width_orig;<br />
&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else {<br />
&nbsp;&nbsp;&nbsp; $height = ($width / $width_orig) * $height_orig;<br />
&nbsp; }<br />
&nbsp; $image_p = imagecreatetruecolor($width, $height);<br />
&nbsp; $image = imagecreatefromjpeg($originial);<br />
&nbsp; imagecopyresampled($image_p, $image, 0, 0, 0, 0, $width, $height, $width_orig, $height_orig);<br />
&nbsp; imagejpeg($image_p, $thumbnail, $quality);<br />
&nbsp; return;<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="54131""></a>
  <div class="note">
   <strong class="user">tobylewis at mac dot com</strong>
   <a href="#54131" class="date">24-Jun-2005 04:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
After trying to get imagejpeg (and imagegif and imagepng) to save an image to a file for some time, it finally dawned on me that perhaps the function would not automatically create the file named in the second parameter.<br />
<br />
I then used fopen to create a file prior to the call to imagejpeg and the image was successfully written to the file.&nbsp; It did not seem to matter if fclose was called before or after the call to imagejpeg.<br />
<br />
I also tried to create a file outside of php and use it as the target for output, but this initially failled because of permissions.&nbsp; Once I set all write permissions on this also accepted output from imagejpeg.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="53666""></a>
  <div class="note">
   <strong class="user">ghokanso at cs dot ndsu dot edu</strong>
   <a href="#53666" class="date">08-Jun-2005 06:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When displaying an image using imagepng or imagejpeg, you may want/need to call "header("Content-type: image/jpeg")" before the imagepng and imagejpeg functions.<br />
It appears that some servers/browers are striping out the default header so the image is not rendered and appears as raw data.<br />
(Firefox 1.02+ and OSX Safari for example)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="51553""></a>
  <div class="note">
   <strong class="user">wojteksw at go2 dot pl</strong>
   <a href="#51553" class="date">04-Apr-2005 12:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I have changed one line in the script of Kokesh<br />
25-Jun-2004 06:42 listed above, and now it generates better quality thumbnails. <br />
You have to change function imagecopyresized() to imagecopyresampled()</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="50415""></a>
  <div class="note">
   <strong class="user">nerdgirl at HATE_SPAMnerdgirl dot dk</strong>
   <a href="#50415" class="date">27-Feb-2005 09:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is an example of uploading an image, changing its size (width/height) and saving it to a new file. It uses ftp to upload both the original and the resized image. This is usefull in situations where ftp is your only option.<br />
<br />
It took me a while to figure it out, so I hope this will save someone else a lot of time :-)<br />
<br />
The following assumes that the image is uploaded from a form with a filefield called 'gfx'. I have left out all error checking to keep it simple, so remember to modify the code, to suit your needs.<br />
<br />
<span class="default">&lt;?php<br />
$new_width </span><span class="keyword">= </span><span class="default">100</span><span class="keyword">;<br />
</span><span class="default">$new_height </span><span class="keyword">= </span><span class="default">200</span><span class="keyword">;<br />
</span><span class="default">$tmp_image</span><span class="keyword">=</span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'gfx'</span><span class="keyword">][</span><span class="string">'tmp_name'</span><span class="keyword">]);<br />
</span><span class="default">$width </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$tmp_image</span><span class="keyword">);<br />
</span><span class="default">$height </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$tmp_image</span><span class="keyword">);<br />
</span><span class="default">$new_image </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$new_width</span><span class="keyword">,</span><span class="default">$new_height</span><span class="keyword">);<br />
</span><span class="default">ImageCopyResized</span><span class="keyword">(</span><span class="default">$new_image</span><span class="keyword">, </span><span class="default">$tmp_image</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">, </span><span class="default">$new_width</span><span class="keyword">, </span><span class="default">$new_height</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">);<br />
</span><span class="comment">//Grab new image<br />
</span><span class="default">ob_start</span><span class="keyword">();<br />
</span><span class="default">ImageJPEG</span><span class="keyword">(</span><span class="default">$new_image</span><span class="keyword">);<br />
</span><span class="default">$image_buffer </span><span class="keyword">= </span><span class="default">ob_get_contents</span><span class="keyword">();<br />
</span><span class="default">ob_end_clean</span><span class="keyword">();<br />
</span><span class="default">ImageDestroy</span><span class="keyword">(</span><span class="default">$new_image</span><span class="keyword">);<br />
</span><span class="comment">//Create temporary file and write to it<br />
</span><span class="default">$fp </span><span class="keyword">= </span><span class="default">tmpfile</span><span class="keyword">();<br />
</span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$image_buffer</span><span class="keyword">)) {<br />
</span><span class="default">rewind</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br />
</span><span class="comment">//Upload new image<br />
</span><span class="default">$conn_id </span><span class="keyword">= </span><span class="default">ftp_connect</span><span class="keyword">(</span><span class="string">'ftp.example.tld'</span><span class="keyword">);<br />
</span><span class="default">ftp_login</span><span class="keyword">(</span><span class="default">$conn_id</span><span class="keyword">,</span><span class="string">'user'</span><span class="keyword">,</span><span class="string">'pass'</span><span class="keyword">);<br />
</span><span class="default">ftp_fput</span><span class="keyword">(</span><span class="default">$conn_id</span><span class="keyword">,</span><span class="string">'path/to/new/file.jpg'</span><span class="keyword">, </span><span class="default">$fp</span><span class="keyword">, </span><span class="default">FTP_BINARY</span><span class="keyword">);<br />
</span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="49902""></a>
  <div class="note">
   <strong class="user">r dot duclos at chello dot fr</strong>
   <a href="#49902" class="date">11-Feb-2005 03:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hy, here is a little code for generate a thumbnail, very good quality. Enjoy it !<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">miniature</span><span class="keyword">(</span><span class="default">$pict</span><span class="keyword">, </span><span class="default">$dest_pict</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$handle </span><span class="keyword">= @</span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$pict</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$x</span><span class="keyword">=</span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$y</span><span class="keyword">=</span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$x </span><span class="keyword">&gt; </span><span class="default">$y</span><span class="keyword">){&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$max </span><span class="keyword">= </span><span class="default">$x</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$min </span><span class="keyword">= </span><span class="default">$y</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$x </span><span class="keyword">&lt;= </span><span class="default">$y</span><span class="keyword">){&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$max </span><span class="keyword">= </span><span class="default">$y</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$min </span><span class="keyword">= </span><span class="default">$x</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
<br />
</span><span class="comment">//$size_in_pixel : Size max of the label in pixel.&nbsp; The size of the picture being <br />
//proportional to the original, this value define maximum size <br />
//of largest side with dimensions of the picture. Sorry for my english !<br />
<br />
//Here $size_in_pixel = 100 for a thumbnail.<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$size_in_pixel </span><span class="keyword">= </span><span class="string">'100'</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$rate </span><span class="keyword">= </span><span class="default">$max</span><span class="keyword">/</span><span class="default">$size_in_pixel</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$final_x </span><span class="keyword">= </span><span class="default">$x</span><span class="keyword">/</span><span class="default">$rate</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$final_y </span><span class="keyword">= </span><span class="default">$y</span><span class="keyword">/</span><span class="default">$rate</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$final_x </span><span class="keyword">&gt; </span><span class="default">$x</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$final_x </span><span class="keyword">= </span><span class="default">$x</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$final_y </span><span class="keyword">= </span><span class="default">$y</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$final_x </span><span class="keyword">= </span><span class="default">ceil</span><span class="keyword">(</span><span class="default">$final_x</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$final_y </span><span class="keyword">= </span><span class="default">ceil</span><span class="keyword">(</span><span class="default">$final_y</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$black_picture </span><span class="keyword">= </span><span class="default">imageCreatetruecolor</span><span class="keyword">(</span><span class="default">$final_x</span><span class="keyword">,</span><span class="default">$final_y</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagefill</span><span class="keyword">(</span><span class="default">$black_picture</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$black_picture</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$black_picture</span><span class="keyword">, </span><span class="default">$handle</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">,</span><span class="default">$final_x</span><span class="keyword">, </span><span class="default">$final_y</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(!@</span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$black_picture</span><span class="keyword">,</span><span class="default">$dest_pict</span><span class="keyword">.</span><span class="string">'/mini_'</span><span class="keyword">.</span><span class="default">$pict</span><span class="keyword">, </span><span class="default">$size_in_pixel</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagestring</span><span class="keyword">(</span><span class="default">$black_picture</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">, </span><span class="default">$final_x</span><span class="keyword">-</span><span class="default">4</span><span class="keyword">, </span><span class="default">$final_y</span><span class="keyword">-</span><span class="default">8</span><span class="keyword">, </span><span class="string">"."</span><span class="keyword">, </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$black_picture</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//The number is the quality of the result picture<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$black_picture</span><span class="keyword">,</span><span class="string">''</span><span class="keyword">, </span><span class="string">'100'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$black_picture</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
</span><span class="default">$pict </span><span class="keyword">= </span><span class="string">"PICT7024.jpg"</span><span class="keyword">;<br />
</span><span class="default">$dest_pict </span><span class="keyword">= </span><span class="string">"D:/Program Files/EasyPHP1-7/www/test"</span><span class="keyword">;<br />
</span><span class="default">miniature</span><span class="keyword">(</span><span class="default">$pict</span><span class="keyword">, </span><span class="default">$dest_pict</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="45609""></a>
  <div class="note">
   <strong class="user">arjini at gmail dot com</strong>
   <a href="#45609" class="date">13-Sep-2004 01:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Scenario:<br />
&nbsp;&nbsp;&nbsp; When pointing your browser directly at a script outputting an image, it displays without problem, but when using it in another page via html (i.e. : img src="x.php?yada=yada" ), you get a broken image.<br />
<br />
Reason:<br />
&nbsp;&nbsp;&nbsp; *Any* extra data sent along with the image will cause it to not display on other pages. Extra data may include, whitespace characters (check the begginings and ends of your files), or a call to session_start(), which is what got me.<br />
<br />
Summary:<br />
&nbsp;&nbsp;&nbsp; If you're going to send an image DONT START A SESSION in the script that is outputting the image, and make sure that the PHP delimiters are the first and last things in your file.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="45555""></a>
  <div class="note">
   
   <a href="#45555" class="date">10-Sep-2004 05:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For best results, use only loss-less file formats (such as PNG) for storing images or image parts that you later intend to output with this function.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="45457""></a>
  <div class="note">
   <strong class="user">arjini at gmail dot com</strong>
   <a href="#45457" class="date">08-Sep-2004 03:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Converting a directory of PNG images into jpegs is as easy as:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; $d </span><span class="keyword">= </span><span class="default">dir</span><span class="keyword">(</span><span class="string">'./'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; while(</span><span class="default">false </span><span class="keyword">!== (</span><span class="default">$e </span><span class="keyword">= </span><span class="default">$d</span><span class="keyword">-&gt;</span><span class="default">read</span><span class="keyword">())){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$e</span><span class="keyword">,</span><span class="string">'.png'</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$r </span><span class="keyword">= </span><span class="default">imagecreatefrompng</span><span class="keyword">(</span><span class="string">'./'</span><span class="keyword">.</span><span class="default">$e</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$r</span><span class="keyword">,</span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'.png'</span><span class="keyword">,</span><span class="string">'.jpg'</span><span class="keyword">,</span><span class="default">$e</span><span class="keyword">),</span><span class="default">75</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;<br />
</span><br />
Don't let anybody convince you otherwise. Put that in the folder that the images are in and run it. I tried for 2 hours to get photoshop to do it, to no avail. PHP to the rescue!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="43883""></a>
  <div class="note">
   <strong class="user">Olav Alexander Mjelde</strong>
   <a href="#43883" class="date">07-Jul-2004 02:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note to steve:<br />
yes, this is true.. I simply forgot to think about that issue with the clear text to the script..<br />
<br />
I think the easiest way to "fix" it, would be to replace the @ in the string with something which cant be used in an email adress..<br />
<br />
Then the script would do a replace of excisting of that character..<br />
<br />
abc@123.com would then be abc*123.com, which the script would parse back into abc@123.com</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="43590""></a>
  <div class="note">
   <strong class="user">Steve</strong>
   <a href="#43590" class="date">27-Jun-2004 03:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Regarding Olav's attempt at avoiding spambots, the code will produce a string of code like requests.php?string=&lt;email_address&gt;, and most spambots will parse that email address right out.&nbsp; You should either create static php scripts to output specific addresses, or do something like save a temporary file on the server with the address you want, and either pass the filename to the makeimage script or have the script open a specific file to check.&nbsp; If you put the address anywhere on the page the spambot will parse it out, including a tag like href="<a href="mailto:xxx" rel="nofollow" target="_blank">mailto:xxx</a>".&nbsp; That's why people use forms to send email now.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="43560""></a>
  <div class="note">
   <strong class="user">Kokesh</strong>
   <a href="#43560" class="date">25-Jun-2004 06:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is the simple, but powerful script for creating thumbnails on the fly. <br />
You can include the script <br />
directly to www page - just put it in &lt;img src= tag. <br />
with width 150pix. <br />
This resizer respects the ASPECT RATIO.<br />
Here is the script:<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// Use it this way: resize.php?pic=imageurl&amp;width=width_in_pixels<br />
// kokesh@kokeshnet.com 2004<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-type: image/jpeg"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$im&nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$pic</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$orange </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">220</span><span class="keyword">, </span><span class="default">210</span><span class="keyword">, </span><span class="default">60</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$px&nbsp; &nbsp;&nbsp; </span><span class="keyword">= (</span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">) - </span><span class="default">7.5 </span><span class="keyword">* </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">)) / </span><span class="default">2</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$old_x</span><span class="keyword">=</span><span class="default">imageSX</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$old_y</span><span class="keyword">=</span><span class="default">imageSY</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$new_w</span><span class="keyword">=(int)(</span><span class="default">$width</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if ((</span><span class="default">$new_w</span><span class="keyword">&lt;=</span><span class="default">0</span><span class="keyword">) or (</span><span class="default">$new_w</span><span class="keyword">&gt;</span><span class="default">$old_x</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$new_w</span><span class="keyword">=</span><span class="default">$old_x</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$new_h</span><span class="keyword">=(</span><span class="default">$old_x</span><span class="keyword">*(</span><span class="default">$new_w</span><span class="keyword">/</span><span class="default">$old_x</span><span class="keyword">));<br />
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$old_x </span><span class="keyword">&gt; </span><span class="default">$old_y</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$thumb_w</span><span class="keyword">=</span><span class="default">$new_w</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$thumb_h</span><span class="keyword">=</span><span class="default">$old_y</span><span class="keyword">*(</span><span class="default">$new_h</span><span class="keyword">/</span><span class="default">$old_x</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$old_x </span><span class="keyword">&lt; </span><span class="default">$old_y</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$thumb_w</span><span class="keyword">=</span><span class="default">$old_x</span><span class="keyword">*(</span><span class="default">$new_w</span><span class="keyword">/</span><span class="default">$old_y</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$thumb_h</span><span class="keyword">=</span><span class="default">$new_h</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$old_x </span><span class="keyword">== </span><span class="default">$old_y</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$thumb_w</span><span class="keyword">=</span><span class="default">$new_w</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$thumb_h</span><span class="keyword">=</span><span class="default">$new_h</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$thumb</span><span class="keyword">=</span><span class="default">ImageCreateTrueColor</span><span class="keyword">(</span><span class="default">$thumb_w</span><span class="keyword">,</span><span class="default">$thumb_h</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">imagecopyresized</span><span class="keyword">(</span><span class="default">$thumb</span><span class="keyword">,</span><span class="default">$im</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$thumb_w</span><span class="keyword">,</span><span class="default">$thumb_h</span><span class="keyword">,</span><span class="default">$old_x</span><span class="keyword">,</span><span class="default">$old_y</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$thumb</span><span class="keyword">,</span><span class="string">""</span><span class="keyword">,</span><span class="default">90</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$thumb</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="43536""></a>
  <div class="note">
   <strong class="user">rich @ richud dot com</strong>
   <a href="#43536" class="date">24-Jun-2004 10:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
'quality' must be a whole number however if a mixed number is given it only uses whole part, e.g. a given value of 90.987 results in 90 being used.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="43050""></a>
  <div class="note">
   <strong class="user">Tom Davis</strong>
   <a href="#43050" class="date">08-Jun-2004 12:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I came across a problem where Internet Explorer refused to cache some dynamically created images. To get round this, send out a Last-Modified header.
<br />

<br />
Eg:
<br />

<br />
<span class="default">&lt;?php
<br />

<br />
header</span><span class="keyword">(</span><span class="string">'Last-Modified: '</span><span class="keyword">.</span><span class="default">gmdate</span><span class="keyword">(</span><span class="string">'D, d M Y H:i:s'</span><span class="keyword">, </span><span class="default">$timestamp</span><span class="keyword">).</span><span class="string">' GMT'</span><span class="keyword">);
<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-Type: image/jpeg'</span><span class="keyword">);
<br />
</span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$photo</span><span class="keyword">);
<br />

<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="42654""></a>
  <div class="note">
   
   <a href="#42654" class="date">25-May-2004 08:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A word of warning when outputting images to the browser...<br />
<br />
Make sure there is no extra spaces around the <span class="default">&lt;?php ?&gt;</span> tags, in the file you are editing, and also any included files.<br />
<br />
I began to think there was a bug in GD or something, and I checked the file I was working on, but forgot about the includes...<br />
<br />
Hours gone..</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="42610""></a>
  <div class="note">
   <strong class="user">stick [at] geek [dot] hu</strong>
   <a href="#42610" class="date">24-May-2004 01:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just a note to Olav Alexander Mjelde's code: don't forget to put an<br />
imagedestroy($im);<br />
at the end of it or you can run into memory problems.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="42139""></a>
  <div class="note">
   <strong class="user">jannehonkonen at hotmail dot com</strong>
   <a href="#42139" class="date">05-May-2004 07:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I had problem wanting to insert stealth - copyrights into images. I could have done this easily with fopen and such, but I still wanted to use imagejpeg(); and it's quality feature. Well this is one kind of solution what I discovered, and seems to work fine.<br />
<br />
--code--<br />
$filename = "<a href="http://www.domain.com/something.jpg" rel="nofollow" target="_blank">http://www.domain.com/something.jpg</a>";<br />
$im = imagecreatefromjpeg($filename);<br />
imagejpeg($im,$ModImg,65);<br />
$ModImg .= "This is the text added after EOF of the jpeg";<br />
echo $ModImg;<br />
--code--<br />
<br />
As imagejpeg(); inserts imagedata into $ModImg, it does not show the image, but it seems to send headers in that point, so header(); is not needed before echoing variable. Text is viewable with Hex-editors etc.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="41352""></a>
  <div class="note">
   <strong class="user">Olav Alexander Mjelde</strong>
   <a href="#41352" class="date">07-Apr-2004 03:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Some people have never heard of spambots, searching the net for email adresses. <br />
How do you avoid this? <br />
Some people write emails like: olav-x AT volvo-power.net (mine btw), <br />
but this will confuse "stupid" users. <br />
The optimal sollution is to have an image with your email adress on.<br />
<br />
* When using this function, <br />
you have to put it in a non-html php file.. <br />
eg. I put it in a makeimage.php file.<br />
so, how do you display it?<br />
<br />
In your users.php, put this:<br />
<br />
echo "&lt;b&gt;Email:&lt;/b&gt;&amp;nbsp;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;img src=\"/sql/phpPictures/makeimage.php<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; ?string={$row['email']}\"&gt;";<br />
<br />
Below is the makeimage.php (working example)<br />
<br />
<span class="default">&lt;?php<br />
header</span><span class="keyword">(</span><span class="string">"Content-type: image/jpg"</span><span class="keyword">);<br />
if (!isset(</span><span class="default">$string</span><span class="keyword">))<br />
&nbsp; {&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$string </span><span class="keyword">= </span><span class="string">"Missing data"</span><span class="keyword">;<br />
&nbsp; }<br />
<br />
</span><span class="default">$font&nbsp; </span><span class="keyword">= </span><span class="default">4</span><span class="keyword">;<br />
</span><span class="default">$width&nbsp; </span><span class="keyword">= </span><span class="default">ImageFontWidth</span><span class="keyword">(</span><span class="default">$font</span><span class="keyword">) * </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">);<br />
</span><span class="default">$height </span><span class="keyword">= </span><span class="default">ImageFontHeight</span><span class="keyword">(</span><span class="default">$font</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
</span><span class="default">$im </span><span class="keyword">= @</span><span class="default">imagecreate </span><span class="keyword">(</span><span class="default">$width</span><span class="keyword">,</span><span class="default">$height</span><span class="keyword">);<br />
</span><span class="comment">//white background<br />
</span><span class="default">$background_color </span><span class="keyword">= </span><span class="default">imagecolorallocate <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">); <br />
</span><span class="comment">//black text<br />
</span><span class="default">$text_color </span><span class="keyword">= </span><span class="default">imagecolorallocate </span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">);<br />
</span><span class="default">imagestring </span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">$font</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">,&nbsp; </span><span class="default">$string</span><span class="keyword">, </span><span class="default">$text_color</span><span class="keyword">);<br />
<br />
</span><span class="default">imagejpeg </span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Enjoy..</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="40040""></a>
  <div class="note">
   <strong class="user">php at andy-pearce dot com</strong>
   <a href="#40040" class="date">19-Feb-2004 09:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This might be too obvious, but perhaps worth pointing out. If you want to simply serve images without altering them, it's presumably more efficient to use something like the following:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Normally $filename would depend on $_GET, etc.<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$filename </span><span class="keyword">= </span><span class="string">'/photoalbum/images/test.jpg'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-type: image/jpeg'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-transfer-encoding: binary'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-length: '</span><span class="keyword">.</span><span class="default">filesize</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">readfile</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
That way you avoid the overhead of reading and parsing the image, you simply send it directly to the browser.<br />
<br />
This is particularly useful if you're using PHP to implement access controls, because it allows you to redirect files from areas of the filesystem browsers can't normally access (although the filename should always come from your script if possible, and not from a URL field, to prevent subverting it with URLs such as image.php?../../../etc/passwd).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="38652""></a>
  <div class="note">
   <strong class="user">gzink at zinkconsulting dot com</strong>
   <a href="#38652" class="date">01-Jan-2004 12:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Don't forget that JPEG compression has artifacts! And they're not all really obvious. The PHP JPEG compression is pretty decent, but it seems to generally:<br />
<br />
-Lighten the image overall, by a reasonable amount (never seen this before, but it will drive graphic designers crazy, you might want to darken the image before compressing it)<br />
-Reduce saturation, especially with images with lots of points of different color within a few pixels of each other (this is a documented feature of JPEG)<br />
-Seriously mess with blue colors, which is common to all JPEG but really annoying in some situations with blue and black or other detailed blue parts<br />
<br />
You might want to consider using imagepng() and outputting a PNG image instead of a JPEG if any of the above affect you, or your image is not very photo-like. Sometimes I have an algorithm compare JPEG to PNG for an image and send the smaller version to the user. <br />
<br />
Also, when using imagepng(), you should use imageinterlace() before it 95% of the time. Interlaced JPEGs load progressively, improving in quality as the image loads, so users on slower connections see the whole image at low quality. All this happens without affecting the file size (actually, sometimes the file size is smaller!) or final quality.<br />
<br />
Hope this helps a few people out. It's not all that obvious without lots of playing around.<br />
<br />
-Galen<br />
<a href="http://zinkconsulting.com/" rel="nofollow" target="_blank">http://zinkconsulting.com/</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="36070""></a>
  <div class="note">
   <strong class="user">chris AT NOSPAM sketchdiary DOT com</strong>
   <a href="#36070" class="date">25-Sep-2003 01:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just a reminder, if you're passing a string of text via GET, you should rawurlencode() or urlencode() them.&nbsp; Some older browsers (such as Netscape 4.x) have issues regarding spaces in the URL.<br />
<br />
NS 4 shows a broken image:<br />
&lt;image src="newimage.php?text=Show me the text!"&gt;<br />
<br />
Makes all browsers happy:<br />
&lt;image src="newimage.php?text=&lt;? echo urlencode('Show me the text!'); ?&gt;"&gt;<br />
<br />
Better to be safe than sorry...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="32503""></a>
  <div class="note">
   <strong class="user">irishcybernerd at email dot com</strong>
   <a href="#32503" class="date">29-May-2003 07:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Rather than using the temporary file, as described above, you can buffer the output stream. Someone else showed me this, and it seems to work very nicely.<br />
<br />
&nbsp;&nbsp;&nbsp; //Start buffering the output stream<br />
&nbsp;&nbsp;&nbsp; ob_start();<br />
<br />
&nbsp;&nbsp;&nbsp; // output the image as a file to the output stream<br />
&nbsp;&nbsp;&nbsp; Imagejpeg($im);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; //Read the output buffer<br />
&nbsp;&nbsp;&nbsp; $buffer = ob_get_contents();<br />
<br />
&nbsp;&nbsp;&nbsp; //clear the buffer<br />
&nbsp;&nbsp;&nbsp; ob_end_clean();<br />
<br />
&nbsp;&nbsp;&nbsp; //use $buffer as you wish...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="29778""></a>
  <div class="note">
   <strong class="user">jt at tsw dot org dot uk</strong>
   <a href="#29778" class="date">25-Feb-2003 04:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I've just read all this AFTER solving the problem in my own little way. (this is re dumping the image into a string)<br />
<br />
Im not actually saving the file to a database, but I'm passing it over XML:RPC so I have the constraint that I cant just dump it to browser, and also its not binary safe.. my solution does not involve ob_start(); which might arguably be the more elgant solution. I didnt see my solution listed, so I thought I aught to post it to add to the wealth of knowledge:<br />
<br />
[apologies if this is incorrect, im snipping from a large bit of irrelevent XML:RPC catching stuff]<br />
<br />
$tmpfname = tempnam ("/tmp", "FOO");&nbsp; &nbsp; &nbsp; // Generate the temp file<br />
<br />
Imagejpeg($im,$tmpfname);&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // save me image to the file<br />
<br />
$temp = fopen($tmpfname,"rb");&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // &lt;- Open the file for reading binary<br />
&nbsp;&nbsp;&nbsp; <br />
$buffer = fread($temp,filesize($tmpfname));&nbsp; // get that data into the buffer<br />
fclose($temp);&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // close the file<br />
unlink($tmpfname);&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // finished with the file, discard<br />
<br />
$out = base64_encode($buffer);&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // encode it (not nessicary if you are using some kind of binary safe function with the info)<br />
<br />
and of course on the other end of whatever your doing,<br />
<br />
[ some function to get $in ]<br />
<br />
header("Content-type: image/jpeg");<br />
$in = base64_decode($buffer);&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // get the binary data back<br />
echo $in;<br />
<br />
This should work with things like Imagepng<br />
<br />
Hope that helps anyone out.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="29648""></a>
  <div class="note">
   <strong class="user">crazyted at crazyted dot com</strong>
   <a href="#29648" class="date">20-Feb-2003 06:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In regards to adding images (or any other binary file) to a database, unless you absolutely *have* to, a MUCH better solution is to simply save the file you create to a directory and update your database with a URL to this file.<br />
<br />
When I first started DB development I was hung up with BLOBs and how to make them effectively work with PHP but realized that they can severely impact performance and you also limit what you can do with those files once they're inside the DB.<br />
<br />
If you can avoid using BLOBs, and most people can, then by all means just create a look-up table for your file urls and save them to a directory to store the files. File access and scalability will be greatly increased in most cases.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="17491""></a>
  <div class="note">
   <strong class="user">dklein at gmx dot de</strong>
   <a href="#17491" class="date">11-Dec-2001 05:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Looks like any specified resolution settings in a JPEG file get lost when using imageJPEG() function in a script.
<br />
I had a high resolution JPEG which i added text to with imagestringup() so my customer can print the emailed JPEG as a filled form, but printing both Graphics from Photoshop revealed that any JPEG created is downsampled to 72 dpi, while width and height is kept.
<br />
(72 dpi is the standard web resolution)
<br />
Nothing to wonder about, but maybe if you read this you dont need to scratch your head :)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="16268""></a>
  <div class="note">
   <strong class="user">pingling at idea dot net dot pl</strong>
   <a href="#16268" class="date">23-Oct-2001 01:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As the GD 1.8.4 manual says, the quality should be a value in the range 0-95. And this seems to be true - setting it to 100 doesn't change the default quality.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
