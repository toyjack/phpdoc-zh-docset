<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>取得服务器响应一个 HTTP 请求所发送的所有标头</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.base64-encode.html">? base64_encode</a></li>
      <li style="float: right;"><a href="function.get-meta-tags.html">get_meta_tags ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.url.html">URL 函数</a></li>
    <li>取得服务器响应一个 HTTP 请求所发送的所有标头</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.get-headers" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">get_headers</h1>
  <p class="verinfo">(PHP 5, PHP 7)</p><p class="refpurpose"><span class="refname">get_headers</span> &mdash; <span class="dc-title">取得服务器响应一个 HTTP 请求所发送的所有标头</span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.get-headers-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">array</span> <span class="methodname"><strong>get_headers</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$url</code></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$format</code><span class="initializer"> = 0</span></span>
  ] )</div>

  <p class="para rdfs-comment">
   <span class="function"><strong>get_headers()</strong></span> 返回一个数组，包含有服务器响应一个
   HTTP 请求所发送的标头。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.get-headers-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">url</code></dt>

     <dd>

      <p class="para">
       目标 URL。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">format</code></dt>

     <dd>

      <p class="para">
        如果将可选的 <code class="parameter">format</code> 参数设为 1，则
   <span class="function"><strong>get_headers()</strong></span> 会解析相应的信息并设定数组的键名。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.get-headers-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   返回包含有服务器响应一个
   HTTP 请求所发送标头的索引或关联数组，如果失败则返回 <strong><code>FALSE</code></strong>。
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.get-headers-changelog">
  <h3 class="title">更新日志</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead>
      <tr>
       <th>版本</th>
       <th>说明</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
       <td>5.1.3</td>
       <td>
        自 PHP 5.1.3 起本函数使用默认的流上下文，其可以用 <span class="function"><a href="function.stream-context-get-default.html" class="function">stream_context_get_default()</a></span>
    函数设定和修改。
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.get-headers-examples">
 <h3 class="title">范例</h3>
  <p class="para">
   <div class="example" id="example-4520">
    <p><strong>Example #1 <span class="function"><strong>get_headers()</strong></span> 例子</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$url&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'http://www.example.com'</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">print_r</span><span style="color: #007700">(</span><span style="color: #0000BB">get_headers</span><span style="color: #007700">(</span><span style="color: #0000BB">$url</span><span style="color: #007700">));<br /><br /></span><span style="color: #0000BB">print_r</span><span style="color: #007700">(</span><span style="color: #0000BB">get_headers</span><span style="color: #007700">(</span><span style="color: #0000BB">$url</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">));<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>以上例程的输出类似于：</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
Array
(
    [0] =&gt; HTTP/1.1 200 OK
    [1] =&gt; Date: Sat, 29 May 2004 12:28:13 GMT
    [2] =&gt; Server: Apache/1.3.27 (Unix)  (Red-Hat/Linux)
    [3] =&gt; Last-Modified: Wed, 08 Jan 2003 23:11:55 GMT
    [4] =&gt; ETag: &quot;3f80f-1b6-3e1cb03b&quot;
    [5] =&gt; Accept-Ranges: bytes
    [6] =&gt; Content-Length: 438
    [7] =&gt; Connection: close
    [8] =&gt; Content-Type: text/html
)

Array
(
    [0] =&gt; HTTP/1.1 200 OK
    [Date] =&gt; Sat, 29 May 2004 12:28:14 GMT
    [Server] =&gt; Apache/1.3.27 (Unix)  (Red-Hat/Linux)
    [Last-Modified] =&gt; Wed, 08 Jan 2003 23:11:55 GMT
    [ETag] =&gt; &quot;3f80f-1b6-3e1cb03b&quot;
    [Accept-Ranges] =&gt; bytes
    [Content-Length] =&gt; 438
    [Connection] =&gt; close
    [Content-Type] =&gt; text/html
)
</pre></div>
    </div>
   </div>
   <div class="example" id="example-4521">
    <p><strong>Example #2 <span class="function"><strong>get_headers()</strong></span> using HEAD example</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;By&nbsp;default&nbsp;get_headers&nbsp;uses&nbsp;a&nbsp;GET&nbsp;request&nbsp;to&nbsp;fetch&nbsp;the&nbsp;headers.&nbsp;If&nbsp;you<br />//&nbsp;want&nbsp;to&nbsp;send&nbsp;a&nbsp;HEAD&nbsp;request&nbsp;instead,&nbsp;you&nbsp;can&nbsp;do&nbsp;so&nbsp;using&nbsp;a&nbsp;stream&nbsp;context:<br /></span><span style="color: #0000BB">stream_context_set_default</span><span style="color: #007700">(<br />&nbsp;&nbsp;&nbsp;&nbsp;array(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'http'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;array(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'method'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'HEAD'<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;)<br />);<br /></span><span style="color: #0000BB">$headers&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">get_headers</span><span style="color: #007700">(</span><span style="color: #DD0000">'http://example.com'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.get-headers-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.apache-request-headers.html" class="function" rel="rdfs-seeAlso">apache_request_headers()</a> - 获取全部 HTTP 请求头信息</span></li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="120075""></a>
  <div class="note">
   <strong class="user">bunny at bunny dot hu</strong>
   <a href="#120075" class="date">22-Oct-2016 11:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If the URL redirected and the new target is also redirected, we got the Locations in array. Also we got the HTTP codes in a number indexed values. <br />
<br />
Here a PART of the header (not all), how it is look like with this redirection chain ( the id=4 is the landing page):<br />
/test.php?id=1 -&gt; /test.php?id=2 -&gt; /test.php?id=3 -&gt; /test.php?id=4<br />
<br />
array <br />
(<br />
&nbsp;&nbsp;&nbsp; [0] =&gt; HTTP/1.1 302 Moved Temporarily<br />
<br />
&nbsp;&nbsp;&nbsp; [Location] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [0] =&gt; /test.php?id=2<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [1] =&gt; /test.php?id=3<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [2] =&gt; /test.php?id=4<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp;&nbsp; [1] =&gt; HTTP/1.1 302 Moved Temporarily<br />
&nbsp;&nbsp;&nbsp; [2] =&gt; HTTP/1.1 302 Moved Temporarily<br />
&nbsp;&nbsp;&nbsp; [3] =&gt; HTTP/1.1 200 OK<br />
)<br />
<br />
In a typical situation we need only the landing page information, so here is a small code to get it:<br />
<br />
$result = array();<br />
$header = get_headers($url, 1);<br />
foreach ($header as $key=&gt;$value) {<br />
&nbsp;&nbsp;&nbsp; if (is_array($value)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $value = end($value);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; $result[$key] = $value;<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="119497""></a>
  <div class="note">
   <strong class="user">sidnash56 at gmail dot com</strong>
   <a href="#119497" class="date">22-Jun-2016 08:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To check URL validity, this has been working nicely for me:<br />
<br />
function url_valid(&amp;$url) {<br />
&nbsp; $file_headers = @get_headers($url);<br />
&nbsp; if ($file_headers === false) return false; // when server not found<br />
&nbsp; foreach($file_headers as $header) { // parse all headers:<br />
&nbsp;&nbsp;&nbsp; // corrects $url when 301/302 redirect(s) lead(s) to 200:<br />
&nbsp;&nbsp;&nbsp; if(preg_match("/^Location: (http.+)$/",$header,$m)) $url=$m[1]; <br />
&nbsp;&nbsp;&nbsp; // grabs the last $header $code, in case of redirect(s):<br />
&nbsp;&nbsp;&nbsp; if(preg_match("/^HTTP.+\s(\d\d\d)\s/",$header,$m)) $code=$m[1]; <br />
&nbsp; } // End foreach...<br />
&nbsp; if($code==200) return true; // $code 200 == all OK<br />
&nbsp; else return false; // All else has failed, so this must be a bad link<br />
} // End function url_exists</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="117256""></a>
  <div class="note">
   <strong class="user">bobray at softville dot com</strong>
   <a href="#117256" class="date">11-May-2015 02:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Testing the validity of a URL that is preceded by one or more server redirects is tricky. There will be more than one status code returned and all but the first will be redirect codes.
<br />

<br />
This function will return an integer containing the three digit status code of the last code returned, which is what you want.
<br />

<br />
&nbsp;&nbsp;&nbsp; function getStatus($url) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $headers = @get_headers($url, true);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $value = NULL;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ($headers === false) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return $headers;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach ($headers as $k =&gt; $v) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!is_int($k)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; continue;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $value = $v;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return (int) substr($value, strpos($value, ' ', 8) + 1, 3);
<br />
&nbsp;&nbsp; &nbsp; }
<br />

<br />
If getHeaders() fails, PHP will throw an error. Test the return value for === false.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="117189""></a>
  <div class="note">
   <strong class="user">pegasus at vaultwiki dot org</strong>
   <a href="#117189" class="date">29-Apr-2015 11:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that get_headers should not be used against a URL that was gathered via user input. The timeout option in the stream context only affects the idle time between data in the stream. It does not affect connection time or the overall time of the request. <br />
<br />
(Unfortunately, this is not mentioned in the docs for the timeout option, but has been discussed in a number of code discussions elsewhere, and I have done my own tests to confirm the conclusions of those discussions.)<br />
<br />
Thus it is very easy for a user to give you a URL that acts like a Slowloris attack - feeding your get_headers function 1 header only often enough to avoid the stream timeout.<br />
<br />
If you are publishing your code, even default_socket_timeout cannot be relied on to remedy this, because it is broken for the HTTPS protocol on many but the more recent versions of PHP: https://bugs.php.net/bug.php?id=41631<br />
<br />
With get_headers accepting user input, it can be very easy for an attacker to make all of your PHP child processes become busy.<br />
<br />
Instead, use cURL functions to get headers for a URL provided by the user and parse those headers manually, as CURLOPT_TIMEOUT applies to the entire request.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="116753""></a>
  <div class="note">
   <strong class="user">cees at cornelisdigitaal dot nl</strong>
   <a href="#116753" class="date">23-Feb-2015 06:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
@Jim Greene:<br />
<br />
if the URL does not exist, it returns incomplete headers, making the substring default to rubbish.<br />
<br />
The integer value of rubbish is always 0. So your lower than 400 does not always means it exists!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="113741""></a>
  <div class="note">
   <strong class="user">Kubo2</strong>
   <a href="#113741" class="date">24-Nov-2013 06:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you don't want to display Warning when get_headers() function fails, you can simply add at-sign (@) before it.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">// in failure, Warning will be hidden and false returned<br />
</span><span class="default">$withoutWarning </span><span class="keyword">= @</span><span class="default">get_headers</span><span class="keyword">(</span><span class="string">"<a href="http://www.some-domain.com" rel="nofollow" target="_blank">http://www.some-domain.com</a>"</span><span class="keyword">);<br />
<br />
</span><span class="comment">// in&nbsp; failure, Warning displays and false will be returned, too<br />
</span><span class="default">$withWarning </span><span class="keyword">= </span><span class="default">get_headers</span><span class="keyword">(</span><span class="string">"<a href="http://www.some-domain.com" rel="nofollow" target="_blank">http://www.some-domain.com</a>"</span><span class="keyword">);<br />
<br />
</span><span class="comment">// bool(false)<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$withoutWarning</span><span class="keyword">);<br />
</span><span class="comment">// bool(false)<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$withWarning</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="112652""></a>
  <div class="note">
   <strong class="user">Jim Greene</strong>
   <a href="#112652" class="date">09-Jul-2013 11:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I know you're not supposed to reference other notes, but sincere props to Nick at Innovaweb's comment, for which I base this addition to his idea:<br />
<br />
If you use that function, it will return a string, which is great if you are checking for only files that return 404, or 200, or whatnot.&nbsp; If you cast the string value to an integer, you can perform mathematical comparison on it.&nbsp; <br />
<br />
For example:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">get_http_response_code</span><span class="keyword">(</span><span class="default">$theURL</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$headers </span><span class="keyword">= </span><span class="default">get_headers</span><span class="keyword">(</span><span class="default">$theURL</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$headers</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="default">9</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">);<br />
}<br />
<br />
if(</span><span class="default">intval</span><span class="keyword">(</span><span class="default">get_http_response_code</span><span class="keyword">(</span><span class="string">'filename.jpg'</span><span class="keyword">)) &lt; </span><span class="default">400</span><span class="keyword">){<br />
</span><span class="comment">// File exists, huzzah!<br />
</span><span class="keyword">}<br />
</span><span class="default">?&gt;<br />
</span><br />
Rule of thumb is if the response is less than 400, then the file's there, even if it doesn't return 200.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="107531""></a>
  <div class="note">
   <strong class="user">Backslider</strong>
   <a href="#107531" class="date">16-Feb-2012 04:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It should be noted that rather than returning "false" on failure, this function (and others) return a big phat WARNING that will halt your script in its tracks if you do not have error reporting /warning turned off.<br />
<br />
Thats just insane!&nbsp; Any function that does something like fetch a URL should simply return false, without a warning, if the URL fails for whatever reason other than it is badly formatted.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="104723""></a>
  <div class="note">
   <strong class="user">damolp at hotmail dot com</strong>
   <a href="#104723" class="date">04-Jul-2011 02:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I found that this function is the slowest in obtaining the headers of a page probably because it uses a GET request rather then a HEAD request. Over 10,000,000 trials of obtaining the headers of a page from a server i found the following (results in seconds).<br />
<br />
cURL: Mean: 0.584127946. Sigma: 0.050581736.<br />
fsocketopen: Mean: 0.622114251. Sigma: 0.263170424.<br />
get_headers: Mean: 0.90375551. Sigma: 0.273823419.<br />
<br />
cURL was the fastest with fsocketopens being the second fastest. I noticed as well that fsocketopen had some outliers where as cURL did not.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="101786""></a>
  <div class="note">
   <strong class="user">Lukas Najduk</strong>
   <a href="#101786" class="date">11-Jan-2011 12:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Unfortunately there is still no useful output format to handle redirects.
<br />

<br />
This function will bring all non-broken headers into a usable format. Too bad it has to call the get_headers() funtion 2 times, but i dont see any other possibility right now.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">page_get_headers</span><span class="keyword">(</span><span class="default">$crawl_uri</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// get the array values where to split the second get headers return
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$headers </span><span class="keyword">= </span><span class="default">get_headers</span><span class="keyword">(</span><span class="default">$crawl_uri</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; if (empty(</span><span class="default">$headers</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return array();
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$splitmarks </span><span class="keyword">= array();
<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$headers </span><span class="keyword">as </span><span class="default">$key</span><span class="keyword">=&gt;</span><span class="default">$h</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_numeric</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">array_push</span><span class="keyword">(</span><span class="default">$splitmarks</span><span class="keyword">, </span><span class="default">$h</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// get the "real" headers
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$headers_final </span><span class="keyword">= array();
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$headers </span><span class="keyword">= </span><span class="default">get_headers</span><span class="keyword">(</span><span class="default">$crawl_uri</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$headers </span><span class="keyword">as </span><span class="default">$head</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// if the value is one of the splitmarks, start the next header
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">array_key_exists</span><span class="keyword">(</span><span class="default">$i</span><span class="keyword">, </span><span class="default">$splitmarks</span><span class="keyword">) &amp;&amp; </span><span class="default">$head </span><span class="keyword">=== </span><span class="default">$splitmarks</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$i</span><span class="keyword">++;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }&nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// get the headers name
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tmp </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">": "</span><span class="keyword">, </span><span class="default">$head</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// check if the header is already existing, if yes, parse the similar header to an array
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (!empty(</span><span class="default">$headers_final</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">][</span><span class="default">$tmp</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]])) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$headers_final</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">][</span><span class="default">$tmp</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]])) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">array_push</span><span class="keyword">(</span><span class="default">$headers_final</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">][</span><span class="default">$tmp</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]], </span><span class="default">$tmp</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$headers_final</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">][</span><span class="default">$tmp</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]] = array(</span><span class="default">$headers_final</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">][</span><span class="default">$tmp</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]], </span><span class="default">$tmp</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$headers_final</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">][</span><span class="default">$tmp</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]] = </span><span class="default">$tmp</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];&nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }&nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$headers_final</span><span class="keyword">;
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100113""></a>
  <div class="note">
   <strong class="user">Weboide</strong>
   <a href="#100113" class="date">26-Sep-2010 03:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that get_headers **WILL follow redirections** (HTTP redirections). New headers will be appended to the array if $format=0. If $format=1 each redundant header will be an array of multiple values, one for each redirection.
<br />

<br />
For example:
<br />

<br />
<span class="default">&lt;?php
<br />
$url </span><span class="keyword">= </span><span class="string">'<a href="http://google.com" rel="nofollow" target="_blank">http://google.com</a>'</span><span class="keyword">;
<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">get_headers</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">));
<br />
</span><span class="comment">/*array(18) {
<br />
&nbsp; [0]=&gt;&nbsp; string(30) "HTTP/1.0 301 Moved Permanently"
<br />
&nbsp; [1]=&gt;&nbsp; string(32) "Location: <a href="http://www.google.com/" rel="nofollow" target="_blank">http://www.google.com/</a>"
<br />
&nbsp; [2]=&gt;&nbsp; string(38) "Content-Type: text/html; CHARSET=gb2312"
<br />
&nbsp; [3]=&gt;&nbsp; string(35) "Date: Sun, 26 Sep 2010 00:59:50 GMT"
<br />
&nbsp; [4]=&gt;&nbsp; string(38) "Expires: Tue, 26 Oct 2010 00:59:50 GMT"
<br />
&nbsp; [5]=&gt;&nbsp; string(38) "Cache-Control: public, max-age=2592000"
<br />
....
<br />
&nbsp; string(15) "HTTP/1.0 200 OK"
<br />
&nbsp; [10]=&gt;&nbsp; string(35) "Date: Sun, 26 Sep 2010 00:59:51 GMT"
<br />
&nbsp; [11]=&gt;&nbsp; string(11) "Expires: -1"
<br />
&nbsp; [12]=&gt;&nbsp; string(33) "Cache-Control: private, max-age=0"
<br />
.....
<br />
}*/
<br />

<br />
/*===========================*/
<br />

<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">get_headers</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">));
<br />
</span><span class="comment">/*array(11) {
<br />
&nbsp; [0]=&gt;
<br />
&nbsp; string(30) "HTTP/1.0 301 Moved Permanently"
<br />
&nbsp; ["Location"]=&gt;&nbsp; string(22) "<a href="http://www.google.com/" rel="nofollow" target="_blank">http://www.google.com/</a>"
<br />
&nbsp; ["Content-Type"]=&gt;&nbsp; array(2) {
<br />
&nbsp;&nbsp;&nbsp; [0]=&gt;&nbsp; &nbsp; string(24) "text/html; CHARSET=gb2312"
<br />
&nbsp;&nbsp;&nbsp; [1]=&gt;&nbsp; &nbsp; string(29) "text/html; charset=ISO-8859-1"
<br />
&nbsp; }
<br />
&nbsp; ["Date"]=&gt;&nbsp; array(2) {
<br />
&nbsp;&nbsp;&nbsp; [0]=&gt;&nbsp; &nbsp; string(29) "Sun, 26 Sep 2010 01:03:39 GMT"
<br />
&nbsp;&nbsp;&nbsp; [1]=&gt;&nbsp; &nbsp; string(29) "Sun, 26 Sep 2010 01:03:39 GMT"
<br />
&nbsp; }
<br />
&nbsp; ["Expires"]=&gt;&nbsp; array(2) {
<br />
&nbsp;&nbsp;&nbsp; [0]=&gt;&nbsp; &nbsp; string(29) "Tue, 26 Oct 2010 01:03:39 GMT"
<br />
&nbsp;&nbsp;&nbsp; [1]=&gt;&nbsp; &nbsp; string(2) "-1"
<br />
&nbsp; }
<br />
&nbsp; ["Cache-Control"]=&gt;&nbsp; array(2) {
<br />
&nbsp;&nbsp;&nbsp; [0]=&gt;&nbsp; &nbsp; string(23) "public, max-age=2592000"
<br />
&nbsp;&nbsp;&nbsp; [1]=&gt;&nbsp; &nbsp; string(18) "private, max-age=0"
<br />
&nbsp; }
<br />
.....
<br />
}*/
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="97684""></a>
  <div class="note">
   <strong class="user">nick at innovaweb dot co dot uk</strong>
   <a href="#97684" class="date">03-May-2010 02:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Seems like there are some people who are looking for only the 3-digit HTTP response code&nbsp; - here is a quick and nasty solution:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">get_http_response_code</span><span class="keyword">(</span><span class="default">$theURL</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$headers </span><span class="keyword">= </span><span class="default">get_headers</span><span class="keyword">(</span><span class="default">$theURL</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$headers</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="default">9</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
How easy is that? Echo the function containing the URL you want to check the response code for, and voilà. Custom redirects, alternative for blocked is_file() or flie_exists() functions (like I seem to have on my servers) hence the cheap workaround. But hey - it works!<br />
<br />
Pudding</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="95917""></a>
  <div class="note">
   <strong class="user">php at hm2k dot org</strong>
   <a href="#95917" class="date">28-Jan-2010 07:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
</span><span class="comment">/**<br />
&nbsp;* Fetches all the real headers sent by the server in response to a HTTP request without redirects<br />
&nbsp;*<br />
&nbsp;* @link&nbsp; &nbsp; &nbsp; <a href="http://php.net/function.get_headers" rel="nofollow" target="_blank">http://php.net/function.get_headers</a><br />
&nbsp;* @link&nbsp; &nbsp; &nbsp; <a href="http://bugs.php.net/bug.php?id=50719 " rel="nofollow" target="_blank">http://bugs.php.net/bug.php?id=50719 </a><br />
&nbsp;*/<br />
<br />
</span><span class="keyword">function </span><span class="default">get_real_headers</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">,</span><span class="default">$format</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">,</span><span class="default">$follow_redirect</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">) {<br />
&nbsp; if (!</span><span class="default">$follow_redirect</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//set new default options<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$opts </span><span class="keyword">= array(</span><span class="string">'http' </span><span class="keyword">=&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; array(</span><span class="string">'max_redirects'</span><span class="keyword">=&gt;</span><span class="default">1</span><span class="keyword">,</span><span class="string">'ignore_errors'</span><span class="keyword">=&gt;</span><span class="default">1</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; );<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">stream_context_get_default</span><span class="keyword">(</span><span class="default">$opts</span><span class="keyword">);<br />
&nbsp; }<br />
&nbsp; </span><span class="comment">//get headers<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$headers</span><span class="keyword">=</span><span class="default">get_headers</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">,</span><span class="default">$format</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//restore default options<br />
&nbsp; </span><span class="keyword">if (isset(</span><span class="default">$opts</span><span class="keyword">)) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$opts </span><span class="keyword">= array(</span><span class="string">'http' </span><span class="keyword">=&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; array(</span><span class="string">'max_redirects'</span><span class="keyword">=&gt;</span><span class="default">20</span><span class="keyword">,</span><span class="string">'ignore_errors'</span><span class="keyword">=&gt;</span><span class="default">0</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; );<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">stream_context_get_default</span><span class="keyword">(</span><span class="default">$opts</span><span class="keyword">);<br />
&nbsp; }<br />
&nbsp; </span><span class="comment">//return<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">$headers</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="90434""></a>
  <div class="note">
   <strong class="user">gabe at vtunnel dot com</strong>
   <a href="#90434" class="date">22-Apr-2009 10:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In some cases, you don't want get_headers to follow redirects. For example, some of my servers can access a particular website, which sends a redirect header. The site it is redirected to, however, has me firewalled. I need to take the 302 redirected url, and do something to it to give me a new url that I *can* connect to.
<br />

<br />
The following will give you output similar to get_headers, except it has a timeout, and it doesn't follow redirects:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">get_headers_curl</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">)
<br />
{
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">();
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$url</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_HEADER</span><span class="keyword">,&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">true</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_NOBODY</span><span class="keyword">,&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">true</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_TIMEOUT</span><span class="keyword">,&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">15</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$r </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$r </span><span class="keyword">= </span><span class="default">split</span><span class="keyword">(</span><span class="string">"\n"</span><span class="keyword">, </span><span class="default">$r</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$r</span><span class="keyword">;
<br />
}
<br />

<br />
If </span><span class="default">you </span><span class="keyword">do </span><span class="default">want to follow redirects</span><span class="keyword">, </span><span class="default">you can </span><span class="keyword">do </span><span class="default">something like this</span><span class="keyword">:
<br />

<br />
</span><span class="default">$go </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;
<br />
</span><span class="default">$i </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;
<br />

<br />
while (</span><span class="default">$go </span><span class="keyword">&amp;&amp; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">6</span><span class="keyword">)
<br />
{
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$headers </span><span class="keyword">= </span><span class="default">get_headers_curl</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$go </span><span class="keyword">= </span><span class="default">getNextLocation</span><span class="keyword">(</span><span class="default">$headers</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$go</span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$url </span><span class="keyword">= </span><span class="default">modifyUrl</span><span class="keyword">(</span><span class="default">$go</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$i</span><span class="keyword">++;
<br />
}
<br />

<br />
function </span><span class="default">getNextLocation</span><span class="keyword">(</span><span class="default">$headers</span><span class="keyword">)
<br />
{
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$array </span><span class="keyword">= </span><span class="default">$headers</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$count </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp;&nbsp; for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$count</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">], </span><span class="string">"ocation:"</span><span class="keyword">))
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$url </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">], </span><span class="default">10</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$url</span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$url</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; else
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83976""></a>
  <div class="note">
   <strong class="user">info at marc-gutt dot de</strong>
   <a href="#83976" class="date">21-Jun-2008 02:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Should be the same than the original get_headers():
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">if (!</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">'get_headers'</span><span class="keyword">)) {
<br />
function </span><span class="default">get_headers</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">, </span><span class="default">$format</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$headers </span><span class="keyword">= array();
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$url </span><span class="keyword">= </span><span class="default">parse_url</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$host </span><span class="keyword">= isset(</span><span class="default">$url</span><span class="keyword">[</span><span class="string">'host'</span><span class="keyword">]) ? </span><span class="default">$url</span><span class="keyword">[</span><span class="string">'host'</span><span class="keyword">] : </span><span class="string">''</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$port </span><span class="keyword">= isset(</span><span class="default">$url</span><span class="keyword">[</span><span class="string">'port'</span><span class="keyword">]) ? </span><span class="default">$url</span><span class="keyword">[</span><span class="string">'port'</span><span class="keyword">] : </span><span class="default">80</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$path </span><span class="keyword">= (isset(</span><span class="default">$url</span><span class="keyword">[</span><span class="string">'path'</span><span class="keyword">]) ? </span><span class="default">$url</span><span class="keyword">[</span><span class="string">'path'</span><span class="keyword">] : </span><span class="string">'/'</span><span class="keyword">) . (isset(</span><span class="default">$url</span><span class="keyword">[</span><span class="string">'query'</span><span class="keyword">]) ? </span><span class="string">'?' </span><span class="keyword">. </span><span class="default">$url</span><span class="keyword">[</span><span class="string">'query'</span><span class="keyword">] : </span><span class="string">''</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$fp</span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$hdr </span><span class="keyword">= </span><span class="string">"GET </span><span class="default">$path</span><span class="string"> HTTP/1.1\r\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$hdr </span><span class="keyword">.= </span><span class="string">"Host: </span><span class="default">$host</span><span class="string"> \r\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$hdr </span><span class="keyword">.= </span><span class="string">"Connection: Close\r\n\r\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$hdr</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">) &amp;&amp; </span><span class="default">$line </span><span class="keyword">= </span><span class="default">trim</span><span class="keyword">(</span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">1024</span><span class="keyword">)))
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$line </span><span class="keyword">== </span><span class="string">"\r\n"</span><span class="keyword">) break;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; list(</span><span class="default">$key</span><span class="keyword">, </span><span class="default">$val</span><span class="keyword">) = </span><span class="default">explode</span><span class="keyword">(</span><span class="string">': '</span><span class="keyword">, </span><span class="default">$line</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$format</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$val</span><span class="keyword">) </span><span class="default">$headers</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">] = </span><span class="default">$val</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else </span><span class="default">$headers</span><span class="keyword">[] = </span><span class="default">$key</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else </span><span class="default">$headers</span><span class="keyword">[] = </span><span class="default">$line</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$headers</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;
<br />
}
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83648""></a>
  <div class="note">
   <strong class="user">php dot sirlancelot at spamgourmet dot com</strong>
   <a href="#83648" class="date">05-Jun-2008 10:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I tried to replicate the native behavior as much as possible for systems that don't have the get_headers() function. Here it is:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">if (!</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">'get_headers'</span><span class="keyword">)) {<br />
function </span><span class="default">get_headers</span><span class="keyword">(</span><span class="default">$Url</span><span class="keyword">, </span><span class="default">$Format</span><span class="keyword">= </span><span class="default">0</span><span class="keyword">, </span><span class="default">$Depth</span><span class="keyword">= </span><span class="default">0</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$Depth </span><span class="keyword">&gt; </span><span class="default">5</span><span class="keyword">) return;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$Parts </span><span class="keyword">= </span><span class="default">parse_url</span><span class="keyword">(</span><span class="default">$Url</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if (!</span><span class="default">array_key_exists</span><span class="keyword">(</span><span class="string">'path'</span><span class="keyword">, </span><span class="default">$Parts</span><span class="keyword">))&nbsp;&nbsp; </span><span class="default">$Parts</span><span class="keyword">[</span><span class="string">'path'</span><span class="keyword">] = </span><span class="string">'/'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if (!</span><span class="default">array_key_exists</span><span class="keyword">(</span><span class="string">'port'</span><span class="keyword">, </span><span class="default">$Parts</span><span class="keyword">))&nbsp;&nbsp; </span><span class="default">$Parts</span><span class="keyword">[</span><span class="string">'port'</span><span class="keyword">] = </span><span class="default">80</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if (!</span><span class="default">array_key_exists</span><span class="keyword">(</span><span class="string">'scheme'</span><span class="keyword">, </span><span class="default">$Parts</span><span class="keyword">)) </span><span class="default">$Parts</span><span class="keyword">[</span><span class="string">'scheme'</span><span class="keyword">] = </span><span class="string">'http'</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$Return </span><span class="keyword">= array();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$Parts</span><span class="keyword">[</span><span class="string">'host'</span><span class="keyword">], </span><span class="default">$Parts</span><span class="keyword">[</span><span class="string">'port'</span><span class="keyword">], </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">30</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$fp</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$Out </span><span class="keyword">= </span><span class="string">'GET '</span><span class="keyword">.</span><span class="default">$Parts</span><span class="keyword">[</span><span class="string">'path'</span><span class="keyword">].(isset(</span><span class="default">$Parts</span><span class="keyword">[</span><span class="string">'query'</span><span class="keyword">]) ? </span><span class="string">'?'</span><span class="keyword">.@</span><span class="default">$Parts</span><span class="keyword">[</span><span class="string">'query'</span><span class="keyword">] : </span><span class="string">''</span><span class="keyword">).</span><span class="string">" HTTP/1.1\r\n"</span><span class="keyword">.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">'Host: '</span><span class="keyword">.</span><span class="default">$Parts</span><span class="keyword">[</span><span class="string">'host'</span><span class="keyword">].(</span><span class="default">$Parts</span><span class="keyword">[</span><span class="string">'port'</span><span class="keyword">] != </span><span class="default">80 </span><span class="keyword">? </span><span class="string">':'</span><span class="keyword">.</span><span class="default">$Parts</span><span class="keyword">[</span><span class="string">'port'</span><span class="keyword">] : </span><span class="string">''</span><span class="keyword">).</span><span class="string">"\r\n"</span><span class="keyword">.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">'Connection: Close'</span><span class="keyword">.</span><span class="string">"\r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$Out</span><span class="keyword">.</span><span class="string">"\r\n"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$Redirect </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">; </span><span class="default">$RedirectUrl </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">) &amp;&amp; </span><span class="default">$InLine </span><span class="keyword">= </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">1280</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$InLine </span><span class="keyword">== </span><span class="string">"\r\n"</span><span class="keyword">) break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$InLine </span><span class="keyword">= </span><span class="default">rtrim</span><span class="keyword">(</span><span class="default">$InLine</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; list(</span><span class="default">$Key</span><span class="keyword">, </span><span class="default">$Value</span><span class="keyword">) = </span><span class="default">explode</span><span class="keyword">(</span><span class="string">': '</span><span class="keyword">, </span><span class="default">$InLine</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$Key </span><span class="keyword">== </span><span class="default">$InLine</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$Format </span><span class="keyword">== </span><span class="default">1</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$Return</span><span class="keyword">[</span><span class="default">$Depth</span><span class="keyword">] = </span><span class="default">$InLine</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else&nbsp; &nbsp; </span><span class="default">$Return</span><span class="keyword">[] = </span><span class="default">$InLine</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$InLine</span><span class="keyword">, </span><span class="string">'Moved'</span><span class="keyword">) &gt; </span><span class="default">0</span><span class="keyword">) </span><span class="default">$Redirect </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$Key </span><span class="keyword">== </span><span class="string">'Location'</span><span class="keyword">) </span><span class="default">$RedirectUrl </span><span class="keyword">= </span><span class="default">$Value</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$Format </span><span class="keyword">== </span><span class="default">1</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$Return</span><span class="keyword">[</span><span class="default">$Key</span><span class="keyword">] = </span><span class="default">$Value</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else&nbsp; &nbsp; </span><span class="default">$Return</span><span class="keyword">[] = </span><span class="default">$Key</span><span class="keyword">.</span><span class="string">': '</span><span class="keyword">.</span><span class="default">$Value</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$Redirect </span><span class="keyword">&amp;&amp; !empty(</span><span class="default">$RedirectUrl</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$NewParts </span><span class="keyword">= </span><span class="default">parse_url</span><span class="keyword">(</span><span class="default">$RedirectUrl</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">array_key_exists</span><span class="keyword">(</span><span class="string">'host'</span><span class="keyword">, </span><span class="default">$NewParts</span><span class="keyword">))&nbsp;&nbsp; </span><span class="default">$RedirectUrl </span><span class="keyword">= </span><span class="default">$Parts</span><span class="keyword">[</span><span class="string">'host'</span><span class="keyword">].</span><span class="default">$RedirectUrl</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">array_key_exists</span><span class="keyword">(</span><span class="string">'scheme'</span><span class="keyword">, </span><span class="default">$NewParts</span><span class="keyword">)) </span><span class="default">$RedirectUrl </span><span class="keyword">= </span><span class="default">$Parts</span><span class="keyword">[</span><span class="string">'scheme'</span><span class="keyword">].</span><span class="string">'://'</span><span class="keyword">.</span><span class="default">$RedirectUrl</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$RedirectHeaders </span><span class="keyword">= </span><span class="default">get_headers</span><span class="keyword">(</span><span class="default">$RedirectUrl</span><span class="keyword">, </span><span class="default">$Format</span><span class="keyword">, </span><span class="default">$Depth</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$RedirectHeaders</span><span class="keyword">) </span><span class="default">$Return </span><span class="keyword">= </span><span class="default">array_merge_recursive</span><span class="keyword">(</span><span class="default">$Return</span><span class="keyword">, </span><span class="default">$RedirectHeaders</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$Return</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
}}<br />
</span><span class="default">?&gt;<br />
</span>The function will handle up to five redirects.<br />
Enjoy!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="80460""></a>
  <div class="note">
   <strong class="user">dxtrim at yahoo dot com</strong>
   <a href="#80460" class="date">17-Jan-2008 10:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Content-Type returns a value depending only on the extension and not the real MIME TYPE. <br />
<br />
So, bad_file.exe renamed to good_file.doc will return application/msword<br />
<br />
A file without extension returns a 404.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71114""></a>
  <div class="note">
   
   <a href="#71114" class="date">13-Nov-2006 09:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I've noticed it.<br />
Some Server will simply return the false reply header if you sent 'HEAD' request instead of 'GET'. The 'GET' request header always receiving the most actual HTTP header instead of 'HEAD' request header. But If you don't mind for a fast but risky method then 'HEAD' request is better for you.<br />
<br />
btw ... this is get header with additional information such as User, Pass &amp; Refferer. ... <br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">get_headers_x</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">,</span><span class="default">$format</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">, </span><span class="default">$user</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">, </span><span class="default">$pass</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">, </span><span class="default">$referer</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!empty(</span><span class="default">$user</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$authentification </span><span class="keyword">= </span><span class="default">base64_encode</span><span class="keyword">(</span><span class="default">$user</span><span class="keyword">.</span><span class="string">':'</span><span class="keyword">.</span><span class="default">$pass</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$authline </span><span class="keyword">= </span><span class="string">"Authorization: Basic </span><span class="default">$authentification</span><span class="string">\r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!empty(</span><span class="default">$referer</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$refererline </span><span class="keyword">= </span><span class="string">"Referer: </span><span class="default">$referer</span><span class="string">\r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$url_info</span><span class="keyword">=</span><span class="default">parse_url</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$port </span><span class="keyword">= isset(</span><span class="default">$url_info</span><span class="keyword">[</span><span class="string">'port'</span><span class="keyword">]) ? </span><span class="default">$url_info</span><span class="keyword">[</span><span class="string">'port'</span><span class="keyword">] : </span><span class="default">80</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fp</span><span class="keyword">=</span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$url_info</span><span class="keyword">[</span><span class="string">'host'</span><span class="keyword">], </span><span class="default">$port</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">30</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$fp</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$head </span><span class="keyword">= </span><span class="string">"GET "</span><span class="keyword">.@</span><span class="default">$url_info</span><span class="keyword">[</span><span class="string">'path'</span><span class="keyword">].</span><span class="string">"?"</span><span class="keyword">.@</span><span class="default">$url_info</span><span class="keyword">[</span><span class="string">'query'</span><span class="keyword">].</span><span class="string">" HTTP/1.0\r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!empty(</span><span class="default">$url_info</span><span class="keyword">[</span><span class="string">'port'</span><span class="keyword">])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$head </span><span class="keyword">.= </span><span class="string">"Host: "</span><span class="keyword">.@</span><span class="default">$url_info</span><span class="keyword">[</span><span class="string">'host'</span><span class="keyword">].</span><span class="string">":"</span><span class="keyword">.</span><span class="default">$url_info</span><span class="keyword">[</span><span class="string">'port'</span><span class="keyword">].</span><span class="string">"\r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$head </span><span class="keyword">.= </span><span class="string">"Host: "</span><span class="keyword">.@</span><span class="default">$url_info</span><span class="keyword">[</span><span class="string">'host'</span><span class="keyword">].</span><span class="string">"\r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$head </span><span class="keyword">.= </span><span class="string">"Connection: Close\r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$head </span><span class="keyword">.= </span><span class="string">"Accept: */*\r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$head </span><span class="keyword">.= </span><span class="default">$refererline</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$head </span><span class="keyword">.= </span><span class="default">$authline</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$head </span><span class="keyword">.= </span><span class="string">"\r\n"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$head</span><span class="keyword">);&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; while(!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">) or (</span><span class="default">$eoheader</span><span class="keyword">==</span><span class="default">true</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$header</span><span class="keyword">=</span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">1024</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$header </span><span class="keyword">== </span><span class="string">"\r\n"</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$eoheader </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$header </span><span class="keyword">= </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$header</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$format </span><span class="keyword">== </span><span class="default">1</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$key </span><span class="keyword">= </span><span class="default">array_shift</span><span class="keyword">(</span><span class="default">explode</span><span class="keyword">(</span><span class="string">':'</span><span class="keyword">,</span><span class="default">$header</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$key </span><span class="keyword">== </span><span class="default">$header</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$headers</span><span class="keyword">[] = </span><span class="default">$header</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$headers</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">]=</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$header</span><span class="keyword">,</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">)+</span><span class="default">2</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; unset(</span><span class="default">$key</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$headers</span><span class="keyword">[] = </span><span class="default">$header</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$headers</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;<br />
</span><br />
Regards.<br />
Donovan</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="65942""></a>
  <div class="note">
   
   <a href="#65942" class="date">10-May-2006 01:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to get headers that current PHP process is going to send back to browser, see headers_list()</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="56770""></a>
  <div class="note">
   <strong class="user">stuart at sixletterwords dot com</strong>
   <a href="#56770" class="date">14-Sep-2005 09:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
hey, i came across this afew weeks ago and used the function in an app for recording info about domains that my company owns, and found that the status this returns was wrong most of the time (400 bad request or void for sites that were clearly online). then looking into it i noticed the problem was that it wasn't able to get the correct info about sites with redirections. but thats not the full problem because everything on my server was returning the wrong status too. i searched around on php.net for other info and found that fsockopen's example worked better and only needed some tweeking.
<br />

<br />
heres the function i put together from it and a small change.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">if(!</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">'get_headers'</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; function </span><span class="default">get_headers</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">,</span><span class="default">$format</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">,</span><span class="default">$httpn</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">){
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">, </span><span class="default">80</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">30</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$fp</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$out </span><span class="keyword">= </span><span class="string">"GET / HTTP/1.1\r\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$out </span><span class="keyword">.= </span><span class="string">"Host: </span><span class="default">$url</span><span class="string">\r\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$out </span><span class="keyword">.= </span><span class="string">"Connection: Close\r\n\r\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$out</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$var</span><span class="keyword">.=</span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">1280</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$var</span><span class="keyword">=</span><span class="default">explode</span><span class="keyword">(</span><span class="string">"&lt;"</span><span class="keyword">,</span><span class="default">$var</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$var</span><span class="keyword">=</span><span class="default">$var</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$var</span><span class="keyword">=</span><span class="default">explode</span><span class="keyword">(</span><span class="string">"\n"</span><span class="keyword">,</span><span class="default">$var</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$var</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />
}
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
this returns an array of the header (only problem being that if the site doesn't have correct html it'll pull in some content too).
<br />

<br />
hope this'll help someone else.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="55216""></a>
  <div class="note">
   <strong class="user">sey at sey dot prometheus-designs dot net</strong>
   <a href="#55216" class="date">28-Jul-2005 01:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The replacement updated get_headers function by aeontech at gmail dot com improperly formats dates when $format = 1.<br />
<br />
Replace:<br />
&lt;?<br />
else {<br />
$headers[strtolower($h2[0])] = trim($h2[1]);<br />
}<br />
?&gt;<br />
<br />
With:<br />
&lt;?<br />
else {&nbsp; &nbsp; <br />
$foo = implode( ':', $h2 );<br />
$foo = preg_replace( '/[a-zA-Z- ]*: /', '', $foo );<br />
$headers[strtolower($h2[0])] = trim( $foo );<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="55190""></a>
  <div class="note">
   <strong class="user">drfickle2 at yahoo dot com</strong>
   <a href="#55190" class="date">27-Jul-2005 02:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
aeontech, this the below change adds support for SSL connections. Thanks for the code!<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (isset($url_info['scheme']) &amp;&amp; $url_info['scheme'] == 'https') {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $port = 443;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $fp=fsockopen('ssl://'.$url_info['host'], $port, $errno, $errstr, 30);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $port = isset($url_info['port']) ? $url_info['port'] : 80;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $fp=fsockopen($url_info['host'], $port, $errno, $errstr, 30);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="54820""></a>
  <div class="note">
   
   <a href="#54820" class="date">15-Jul-2005 10:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For anyone reading the previous comments, here is code that takes into account all the previous suggestions and includes a bugfix, too.<br />
<br />
This code basically provides the "get_headers" function even on systems that are not running PHP 5.0.&nbsp; It uses strtolower() on the keys, as suggested.&nbsp; It uses the $h2 array instead of the $key, as suggested.&nbsp; It removes a line about unsetting the $key -- no reason to unset something which is no longer used.&nbsp; And I've changed the status header to be named "status" (instead of "0") in the array.&nbsp; Note that if more than one header is returned without a label, they'll be stuck in "status" -- but I think status is the only header that comes back without a label, so it works for me.&nbsp; So, first the code, then a sample of the usage:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">if(!</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">'get_headers'</span><span class="keyword">)) {<br />
&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; * @return array<br />
&nbsp;&nbsp;&nbsp; * @param string $url<br />
&nbsp;&nbsp;&nbsp; * @param int $format<br />
&nbsp;&nbsp;&nbsp; * @desc Fetches all the headers<br />
&nbsp;&nbsp;&nbsp; * @author cpurruc fh-landshut de<br />
&nbsp;&nbsp;&nbsp; * @modified by dotpointer<br />
&nbsp;&nbsp;&nbsp; * @modified by aeontech<br />
&nbsp;&nbsp;&nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">get_headers</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">,</span><span class="default">$format</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$url_info</span><span class="keyword">=</span><span class="default">parse_url</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$port </span><span class="keyword">= isset(</span><span class="default">$url_info</span><span class="keyword">[</span><span class="string">'port'</span><span class="keyword">]) ? </span><span class="default">$url_info</span><span class="keyword">[</span><span class="string">'port'</span><span class="keyword">] : </span><span class="default">80</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fp</span><span class="keyword">=</span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$url_info</span><span class="keyword">[</span><span class="string">'host'</span><span class="keyword">], </span><span class="default">$port</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">30</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$fp</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$head </span><span class="keyword">= </span><span class="string">"HEAD "</span><span class="keyword">.@</span><span class="default">$url_info</span><span class="keyword">[</span><span class="string">'path'</span><span class="keyword">].</span><span class="string">"?"</span><span class="keyword">.@</span><span class="default">$url_info</span><span class="keyword">[</span><span class="string">'query'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$head </span><span class="keyword">.= </span><span class="string">" HTTP/1.0\r\nHost: "</span><span class="keyword">.@</span><span class="default">$url_info</span><span class="keyword">[</span><span class="string">'host'</span><span class="keyword">].</span><span class="string">"\r\n\r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$head</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; while(!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$header</span><span class="keyword">=</span><span class="default">trim</span><span class="keyword">(</span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">1024</span><span class="keyword">))) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$format </span><span class="keyword">== </span><span class="default">1</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$h2 </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">':'</span><span class="keyword">,</span><span class="default">$header</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// the first element is the http header type, such as HTTP/1.1 200 OK,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // it doesn't have a separate name, so we have to check for it.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">$h2</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] == </span><span class="default">$header</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$headers</span><span class="keyword">[</span><span class="string">'status'</span><span class="keyword">] = </span><span class="default">$header</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$headers</span><span class="keyword">[</span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">$h2</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">])] = </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$h2</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$headers</span><span class="keyword">[] = </span><span class="default">$header</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$headers</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
OK?&nbsp; Here's the usage:<br />
<br />
<span class="default">&lt;?php<br />
$response </span><span class="keyword">= </span><span class="default">get_headers</span><span class="keyword">(</span><span class="string">'<a href="http://www.example.com/" rel="nofollow" target="_blank">http://www.example.com/</a>'</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
if (!</span><span class="default">$response</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">'Unable to initiate connection.'</span><span class="keyword">;<br />
}<br />
else {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$response</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="48445""></a>
  <div class="note">
   <strong class="user">aeontech at gmail dot com</strong>
   <a href="#48445" class="date">24-Dec-2004 02:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In response to dotpointer's modification of Jamaz' solution...<br />
<br />
Here is a small modification of your function, this adds the emulation of the optional $format parameter.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">if(!</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">'get_headers'</span><span class="keyword">)) {<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp;&nbsp; * @return array<br />
&nbsp;&nbsp;&nbsp; * @param string $url<br />
&nbsp;&nbsp;&nbsp; * @param int $format<br />
&nbsp;&nbsp;&nbsp; * @desc Fetches all the headers<br />
&nbsp;&nbsp;&nbsp; * @author cpurruc fh-landshut de<br />
&nbsp;&nbsp;&nbsp; * @modified by dotpointer<br />
&nbsp;&nbsp;&nbsp; * @modified by aeontech<br />
&nbsp;&nbsp;&nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">get_headers</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">,</span><span class="default">$format</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$url_info</span><span class="keyword">=</span><span class="default">parse_url</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$port </span><span class="keyword">= isset(</span><span class="default">$url_info</span><span class="keyword">[</span><span class="string">'port'</span><span class="keyword">]) ? </span><span class="default">$url_info</span><span class="keyword">[</span><span class="string">'port'</span><span class="keyword">] : </span><span class="default">80</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fp</span><span class="keyword">=</span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$url_info</span><span class="keyword">[</span><span class="string">'host'</span><span class="keyword">], </span><span class="default">$port</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">30</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$fp</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$head </span><span class="keyword">= </span><span class="string">"HEAD "</span><span class="keyword">.@</span><span class="default">$url_info</span><span class="keyword">[</span><span class="string">'path'</span><span class="keyword">].</span><span class="string">"?"</span><span class="keyword">.@</span><span class="default">$url_info</span><span class="keyword">[</span><span class="string">'query'</span><span class="keyword">].</span><span class="string">" HTTP/1.0\r\nHost: "</span><span class="keyword">.@</span><span class="default">$url_info</span><span class="keyword">[</span><span class="string">'host'</span><span class="keyword">].</span><span class="string">"\r\n\r\n"</span><span class="keyword">;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$head</span><span class="keyword">);&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; while(!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$header</span><span class="keyword">=</span><span class="default">trim</span><span class="keyword">(</span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">1024</span><span class="keyword">)))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$format </span><span class="keyword">== </span><span class="default">1</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$key </span><span class="keyword">= </span><span class="default">array_shift</span><span class="keyword">(</span><span class="default">explode</span><span class="keyword">(</span><span class="string">':'</span><span class="keyword">,</span><span class="default">$header</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// the first element is the http header type, such as HTTP 200 OK,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // it doesn't have a separate name, so we have to check for it.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">$key </span><span class="keyword">== </span><span class="default">$header</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$headers</span><span class="keyword">[] = </span><span class="default">$header</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$headers</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">]=</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$header</span><span class="keyword">,</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">)+</span><span class="default">2</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; unset(</span><span class="default">$key</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$headers</span><span class="keyword">[] = </span><span class="default">$header</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$headers</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
