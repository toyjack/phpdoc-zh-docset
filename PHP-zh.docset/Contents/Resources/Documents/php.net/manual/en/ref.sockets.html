<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>Socket 函数</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="sockets.errors.html">? Socket Errors</a></li>
      <li style="float: right;"><a href="function.socket-accept.html">socket_accept ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="book.sockets.html">Sockets</a></li>
    <li>Socket 函数</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="ref.sockets" class="reference">
 <h1 class="title">Socket 函数</h1>

 














































































 







































































































<h2>Table of Contents</h2><ul class="chunklist chunklist_reference"><li><a href="function.socket-accept.html">socket_accept</a> &mdash; Accepts a connection on a socket</li><li><a href="function.socket-bind.html">socket_bind</a> &mdash; 给套接字绑定名字</li><li><a href="function.socket-clear-error.html">socket_clear_error</a> &mdash; Clears the error on the socket or the last error code</li><li><a href="function.socket-close.html">socket_close</a> &mdash; 关闭套接字资源</li><li><a href="function.socket-cmsg-space.html">socket_cmsg_space</a> &mdash; Calculate message buffer size</li><li><a href="function.socket-connect.html">socket_connect</a> &mdash; 开启一个套接字连接</li><li><a href="function.socket-create-listen.html">socket_create_listen</a> &mdash; Opens a socket on port to accept connections</li><li><a href="function.socket-create-pair.html">socket_create_pair</a> &mdash; Creates a pair of indistinguishable sockets and stores them in an array</li><li><a href="function.socket-create.html">socket_create</a> &mdash; 创建一个套接字（通讯节点）</li><li><a href="function.socket-get-option.html">socket_get_option</a> &mdash; Gets socket options for the socket</li><li><a href="function.socket-getpeername.html">socket_getpeername</a> &mdash; Queries the remote side of the given socket which may either result in host/port or in a Unix filesystem path, dependent on its type</li><li><a href="function.socket-getsockname.html">socket_getsockname</a> &mdash; Queries the local side of the given socket which may either result in host/port or in a Unix filesystem path, dependent on its type</li><li><a href="function.socket-import-stream.html">socket_import_stream</a> &mdash; Import a stream</li><li><a href="function.socket-last-error.html">socket_last_error</a> &mdash; Returns the last error on the socket</li><li><a href="function.socket-listen.html">socket_listen</a> &mdash; Listens for a connection on a socket</li><li><a href="function.socket-read.html">socket_read</a> &mdash; Reads a maximum of length bytes from a socket</li><li><a href="function.socket-recv.html">socket_recv</a> &mdash; Receives data from a connected socket</li><li><a href="function.socket-recvfrom.html">socket_recvfrom</a> &mdash; Receives data from a socket whether or not it is connection-oriented</li><li><a href="function.socket-recvmsg.html">socket_recvmsg</a> &mdash; Read a message</li><li><a href="function.socket-select.html">socket_select</a> &mdash; Runs the select() system call on the given arrays of sockets with a specified timeout</li><li><a href="function.socket-send.html">socket_send</a> &mdash; Sends data to a connected socket</li><li><a href="function.socket-sendmsg.html">socket_sendmsg</a> &mdash; Send a message</li><li><a href="function.socket-sendto.html">socket_sendto</a> &mdash; Sends a message to a socket, whether it is connected or not</li><li><a href="function.socket-set-block.html">socket_set_block</a> &mdash; Sets blocking mode on a socket resource</li><li><a href="function.socket-set-nonblock.html">socket_set_nonblock</a> &mdash; Sets nonblocking mode for file descriptor fd</li><li><a href="function.socket-set-option.html">socket_set_option</a> &mdash; Sets socket options for the socket</li><li><a href="function.socket-shutdown.html">socket_shutdown</a> &mdash; Shuts down a socket for receiving, sending, or both</li><li><a href="function.socket-strerror.html">socket_strerror</a> &mdash; Return a string describing a socket error</li><li><a href="function.socket-write.html">socket_write</a> &mdash; Write to a socket</li></ul>
</div>
<div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="105735""></a>
  <div class="note">
   <strong class="user">paul dot hodel at gmail dot com</strong>
   <a href="#105735" class="date">11-Sep-2011 01:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
After many non-sleep nights I got the most simple multi-client server written in PHP that really works. Ctrl+C and Ctrl+V... use as command line to test it. Enjoy it.
<br />

<br />
<span class="default">&lt;?php
<br />

<br />
ini_set</span><span class="keyword">(</span><span class="string">'error_reporting'</span><span class="keyword">, </span><span class="default">E_ALL </span><span class="keyword">^ </span><span class="default">E_NOTICE</span><span class="keyword">);
<br />
</span><span class="default">ini_set</span><span class="keyword">(</span><span class="string">'display_errors'</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);
<br />

<br />
</span><span class="comment">// Set time limit to indefinite execution
<br />
</span><span class="default">set_time_limit </span><span class="keyword">(</span><span class="default">0</span><span class="keyword">);
<br />

<br />
</span><span class="comment">// Set the ip and port we will listen on
<br />
</span><span class="default">$address </span><span class="keyword">= </span><span class="string">'10.203.9.67'</span><span class="keyword">;
<br />
</span><span class="default">$port </span><span class="keyword">= </span><span class="default">6901</span><span class="keyword">;
<br />

<br />
</span><span class="comment">// Create a TCP Stream socket
<br />
</span><span class="default">$sock </span><span class="keyword">= </span><span class="default">socket_create</span><span class="keyword">(</span><span class="default">AF_INET</span><span class="keyword">, </span><span class="default">SOCK_STREAM</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);
<br />

<br />
</span><span class="comment">// Bind the socket to an address/port
<br />
</span><span class="default">socket_bind</span><span class="keyword">(</span><span class="default">$sock</span><span class="keyword">, </span><span class="default">$address</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">) or die(</span><span class="string">'Could not bind to address'</span><span class="keyword">);
<br />

<br />
</span><span class="comment">// Start listening for connections
<br />
</span><span class="default">socket_listen</span><span class="keyword">(</span><span class="default">$sock</span><span class="keyword">);
<br />

<br />
</span><span class="comment">// Non block socket type
<br />
</span><span class="default">socket_set_nonblock</span><span class="keyword">(</span><span class="default">$sock</span><span class="keyword">);
<br />

<br />
</span><span class="comment">// Loop continuously
<br />
</span><span class="keyword">while (</span><span class="default">true</span><span class="keyword">)
<br />
{
<br />
&nbsp;&nbsp;&nbsp; unset(</span><span class="default">$read</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$j </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">count</span><span class="keyword">(</span><span class="default">$client</span><span class="keyword">))
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$client </span><span class="keyword">AS </span><span class="default">$k </span><span class="keyword">=&gt; </span><span class="default">$v</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$read</span><span class="keyword">[</span><span class="default">$j</span><span class="keyword">] = </span><span class="default">$v</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$j</span><span class="keyword">++;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$client </span><span class="keyword">= </span><span class="default">$read</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$newsock </span><span class="keyword">= @</span><span class="default">socket_accept</span><span class="keyword">(</span><span class="default">$sock</span><span class="keyword">))
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_resource</span><span class="keyword">(</span><span class="default">$newsock</span><span class="keyword">))
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">socket_write</span><span class="keyword">(</span><span class="default">$newsock</span><span class="keyword">, </span><span class="string">"</span><span class="default">$j</span><span class="string">&gt;"</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">).</span><span class="default">chr</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"New client connected </span><span class="default">$j</span><span class="string">"</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$client</span><span class="keyword">[</span><span class="default">$j</span><span class="keyword">] = </span><span class="default">$newsock</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$j</span><span class="keyword">++;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">count</span><span class="keyword">(</span><span class="default">$client</span><span class="keyword">))
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$client </span><span class="keyword">AS </span><span class="default">$k </span><span class="keyword">=&gt; </span><span class="default">$v</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (@</span><span class="default">socket_recv</span><span class="keyword">(</span><span class="default">$v</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">, </span><span class="default">1024</span><span class="keyword">, </span><span class="default">MSG_DONTWAIT</span><span class="keyword">) === </span><span class="default">0</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; unset(</span><span class="default">$client</span><span class="keyword">[</span><span class="default">$k</span><span class="keyword">]);
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">socket_close</span><span class="keyword">(</span><span class="default">$v</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$string</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"</span><span class="default">$k</span><span class="string">: </span><span class="default">$string</span><span class="string">\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//echo ".";
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">sleep</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">);
<br />
}
<br />

<br />
</span><span class="comment">// Close the master sockets
<br />
</span><span class="default">socket_close</span><span class="keyword">(</span><span class="default">$sock</span><span class="keyword">);
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84897""></a>
  <div class="note">
   <strong class="user">davidccook+php at gmail dot com</strong>
   <a href="#84897" class="date">05-Aug-2008 06:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Planning on sending integer values through as socket, I was surprised to find PHP only supports sending strings. <br />
I came to the conclusion the only way to do it would be to create a string that would evaluate to the same byte values as the integer I wanted to send. So (after much messing about) I created a couple of functions: one to create this 'string' and one to convert a received value back to an integer.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">//Converts an integer to 'byte array' (string), default to 4 'bytes' (chars)<br />
</span><span class="keyword">function </span><span class="default">int2string</span><span class="keyword">(</span><span class="default">$int</span><span class="keyword">, </span><span class="default">$numbytes</span><span class="keyword">=</span><span class="default">4</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp; </span><span class="default">$str </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp; for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$numbytes</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$str </span><span class="keyword">.= </span><span class="default">chr</span><span class="keyword">(</span><span class="default">$int </span><span class="keyword">% </span><span class="default">256</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$int </span><span class="keyword">= </span><span class="default">$int </span><span class="keyword">/ </span><span class="default">256</span><span class="keyword">;<br />
&nbsp;&nbsp; }<br />
&nbsp;&nbsp; return </span><span class="default">$str</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="comment">//Converts a 'byte array' (string) to integer<br />
</span><span class="keyword">function </span><span class="default">string2int</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp; </span><span class="default">$numbytes </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">$int </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$numbytes</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$int </span><span class="keyword">+= </span><span class="default">ord</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]) * </span><span class="default">pow</span><span class="keyword">(</span><span class="default">2</span><span class="keyword">, </span><span class="default">$i </span><span class="keyword">* </span><span class="default">8</span><span class="keyword">);<br />
&nbsp;&nbsp; }<br />
&nbsp;&nbsp; return </span><span class="default">$int</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="comment">//Example<br />
</span><span class="keyword">echo </span><span class="default">int2string</span><span class="keyword">(</span><span class="default">16705</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">); </span><span class="comment">// 16-bit integer converts to two bytes: 65, 65; which in turn is 'AA'<br />
</span><span class="keyword">echo </span><span class="default">string2int</span><span class="keyword">(</span><span class="string">'AA'</span><span class="keyword">); </span><span class="comment">//back the other way<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82163""></a>
  <div class="note">
   <strong class="user">firefly2442 at hotmail dot com</strong>
   <a href="#82163" class="date">29-Mar-2008 09:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's a simple script for sending messages back and forth between a server and client.&nbsp; At this point, the code is fairly rough because once it enters the while loop, it doesn't stop but it can be modified and fixed.&nbsp; Enjoy.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">//The Server<br />
</span><span class="default">error_reporting</span><span class="keyword">(</span><span class="default">E_ALL</span><span class="keyword">);<br />
</span><span class="default">$address </span><span class="keyword">= </span><span class="string">"127.0.0.1"</span><span class="keyword">;<br />
</span><span class="default">$port </span><span class="keyword">= </span><span class="string">"10000"</span><span class="keyword">;<br />
&nbsp;<br />
<br />
</span><span class="comment">/* create a socket in the AF_INET family, using SOCK_STREAM for TCP connection */<br />
</span><span class="default">$mysock </span><span class="keyword">= </span><span class="default">socket_create</span><span class="keyword">(</span><span class="default">AF_INET</span><span class="keyword">, </span><span class="default">SOCK_STREAM</span><span class="keyword">, </span><span class="default">SOL_TCP</span><span class="keyword">);<br />
<br />
</span><span class="default">socket_bind</span><span class="keyword">(</span><span class="default">$mysock</span><span class="keyword">, </span><span class="default">$address</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">);<br />
<br />
</span><span class="default">socket_listen</span><span class="keyword">(</span><span class="default">$mysock</span><span class="keyword">, </span><span class="default">5</span><span class="keyword">);<br />
<br />
</span><span class="default">$client </span><span class="keyword">= </span><span class="default">socket_accept</span><span class="keyword">(</span><span class="default">$mysock</span><span class="keyword">);<br />
<br />
echo </span><span class="string">"Server started, accepting connections...\n"</span><span class="keyword">;<br />
&nbsp;<br />
<br />
</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
while (</span><span class="default">true </span><span class="keyword">== </span><span class="default">true</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$i</span><span class="keyword">++;<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"Sending </span><span class="default">$i</span><span class="string"> to client.\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">socket_write</span><span class="keyword">(</span><span class="default">$client</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">, </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$i</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$input </span><span class="keyword">= </span><span class="default">socket_read</span><span class="keyword">(</span><span class="default">$client</span><span class="keyword">, </span><span class="default">2048</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"Response from client is: </span><span class="default">$input</span><span class="string">\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">sleep</span><span class="keyword">(</span><span class="default">5</span><span class="keyword">);<br />
}<br />
<br />
echo </span><span class="string">"Closing sockets..."</span><span class="keyword">;<br />
</span><span class="default">socket_close</span><span class="keyword">(</span><span class="default">$client</span><span class="keyword">);<br />
<br />
</span><span class="default">socket_close</span><span class="keyword">(</span><span class="default">$mysock</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span> <br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">//The Client<br />
</span><span class="default">error_reporting</span><span class="keyword">(</span><span class="default">E_ALL</span><span class="keyword">);<br />
<br />
</span><span class="default">$address </span><span class="keyword">= </span><span class="string">"127.0.0.1"</span><span class="keyword">;<br />
</span><span class="default">$port </span><span class="keyword">= </span><span class="default">10000</span><span class="keyword">;<br />
<br />
</span><span class="comment">/* Create a TCP/IP socket. */<br />
</span><span class="default">$socket </span><span class="keyword">= </span><span class="default">socket_create</span><span class="keyword">(</span><span class="default">AF_INET</span><span class="keyword">, </span><span class="default">SOCK_STREAM</span><span class="keyword">, </span><span class="default">SOL_TCP</span><span class="keyword">);<br />
if (</span><span class="default">$socket </span><span class="keyword">=== </span><span class="default">false</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"socket_create() failed: reason: " </span><span class="keyword">. </span><span class="default">socket_strerror</span><span class="keyword">(</span><span class="default">socket_last_error</span><span class="keyword">()) . </span><span class="string">"\n"</span><span class="keyword">;<br />
} else {<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"socket successfully created.\n"</span><span class="keyword">;<br />
}<br />
<br />
echo </span><span class="string">"Attempting to connect to '</span><span class="default">$address</span><span class="string">' on port '</span><span class="default">$port</span><span class="string">'..."</span><span class="keyword">;<br />
</span><span class="default">$result </span><span class="keyword">= </span><span class="default">socket_connect</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">, </span><span class="default">$address</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">);<br />
if (</span><span class="default">$result </span><span class="keyword">=== </span><span class="default">false</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"socket_connect() failed.\nReason: (</span><span class="default">$result</span><span class="string">) " </span><span class="keyword">. </span><span class="default">socket_strerror</span><span class="keyword">(</span><span class="default">socket_last_error</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">)) . </span><span class="string">"\n"</span><span class="keyword">;<br />
} else {<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"successfully connected to </span><span class="default">$address</span><span class="string">.\n"</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
while (</span><span class="default">true </span><span class="keyword">== </span><span class="default">true</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$i</span><span class="keyword">++;<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"Sending </span><span class="default">$i</span><span class="string"> to server.\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">socket_write</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">, </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$i</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$input </span><span class="keyword">= </span><span class="default">socket_read</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">, </span><span class="default">2048</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"Response from server is: </span><span class="default">$input</span><span class="string">\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">sleep</span><span class="keyword">(</span><span class="default">5</span><span class="keyword">);<br />
}<br />
<br />
echo </span><span class="string">"Closing socket..."</span><span class="keyword">;<br />
</span><span class="default">socket_close</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="80397""></a>
  <div class="note">
   <strong class="user">david dot schueler at tel-bilig dot de</strong>
   <a href="#80397" class="date">14-Jan-2008 12:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
NOTE! If you are trying to send a broadcast-message using this code you _may_ get a "Permission denied"-Error at socket_connect, even if you are running this as root on a linux box.<br />
<span class="default">&lt;?php<br />
$sock </span><span class="keyword">= </span><span class="default">socket_create</span><span class="keyword">(</span><span class="default">AF_INET</span><span class="keyword">, </span><span class="default">SOCK_DGRAM</span><span class="keyword">, </span><span class="default">SOL_UDP</span><span class="keyword">);<br />
</span><span class="default">socket_connect</span><span class="keyword">(</span><span class="default">$sock</span><span class="keyword">,</span><span class="string">"255.255.255.255"</span><span class="keyword">, </span><span class="default">10000</span><span class="keyword">);<br />
</span><span class="default">socket_set_option</span><span class="keyword">(</span><span class="default">$sock</span><span class="keyword">, </span><span class="default">SOL_SOCKET</span><span class="keyword">, </span><span class="default">SO_BROADCAST</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
</span><span class="default">$buf </span><span class="keyword">= </span><span class="string">"Hello World!"</span><span class="keyword">;<br />
</span><span class="default">socket_write</span><span class="keyword">(</span><span class="default">$sock</span><span class="keyword">,</span><span class="default">$buf</span><span class="keyword">,</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$buf</span><span class="keyword">));<br />
</span><span class="default">socket_close</span><span class="keyword">(</span><span class="default">$sock</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span>The only workaround for this is to get the broadcast address of the interface and walk through all IPs with a for-loop.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77531""></a>
  <div class="note">
   <strong class="user">White-Gandalf</strong>
   <a href="#77531" class="date">02-Sep-2007 09:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
At the moment (2007-09), i don't find this extension in the PECL, but instead in the usual php extension directory. It needs to be included in the php-ini:<br />
<br />
extension = php_sockets.dll<br />
<br />
(or ".so" - whatever for your system).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73162""></a>
  <div class="note">
   <strong class="user">roberto at spadim dot com dot br</strong>
   <a href="#73162" class="date">11-Feb-2007 07:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Wake on Lan , working ok without configurations, and some features<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">wake_on_lan</span><span class="keyword">(</span><span class="default">$mac</span><span class="keyword">,</span><span class="default">$addr</span><span class="keyword">=</span><span class="default">false</span><span class="keyword">,</span><span class="default">$port</span><span class="keyword">=</span><span class="default">7</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//Usage<br />
&nbsp;&nbsp;&nbsp; //&nbsp; &nbsp; $addr:<br />
&nbsp;&nbsp;&nbsp; //&nbsp; &nbsp; You will send and broadcast tho this addres.<br />
&nbsp;&nbsp;&nbsp; //&nbsp; &nbsp; Normaly you need to use the 255.255.255.255 adres, so i made it as default. So you don't need<br />
&nbsp;&nbsp;&nbsp; //&nbsp; &nbsp; to do anything with this.<br />
&nbsp;&nbsp;&nbsp; //&nbsp; &nbsp; Since 255.255.255.255 have permission denied problems you can use addr=false to get all broadcast address from ifconfig command<br />
&nbsp;&nbsp;&nbsp; //&nbsp; &nbsp; addr can be array with broadcast IP values<br />
&nbsp;&nbsp;&nbsp; //&nbsp; &nbsp; $mac:<br />
&nbsp;&nbsp;&nbsp; //&nbsp; &nbsp; You will WAKE-UP this WOL-enabled computer, you need to add the MAC-addres here.<br />
&nbsp;&nbsp;&nbsp; //&nbsp; &nbsp; Mac can be array too&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; //<br />
&nbsp;&nbsp;&nbsp; //Return<br />
&nbsp;&nbsp;&nbsp; //&nbsp; &nbsp; TRUE:&nbsp; &nbsp; When socked was created succesvolly and the message has been send.<br />
&nbsp;&nbsp;&nbsp; //&nbsp; &nbsp; FALSE:&nbsp; &nbsp; Something went wrong<br />
&nbsp;&nbsp;&nbsp; //<br />
&nbsp;&nbsp;&nbsp; //Example 1<br />
&nbsp;&nbsp;&nbsp; //&nbsp; &nbsp; When the message has been send you will see the message "Done...."<br />
&nbsp;&nbsp;&nbsp; //&nbsp; &nbsp; if ( wake_on_lan('00:00:00:00:00:00'))<br />
&nbsp;&nbsp;&nbsp; //&nbsp; &nbsp; &nbsp; &nbsp; echo 'Done...';<br />
&nbsp;&nbsp;&nbsp; //&nbsp; &nbsp; else<br />
&nbsp;&nbsp;&nbsp; //&nbsp; &nbsp; &nbsp; &nbsp; echo 'Error while sending';<br />
&nbsp;&nbsp;&nbsp; //<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$addr</span><span class="keyword">===</span><span class="default">false</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">exec</span><span class="keyword">(</span><span class="string">"ifconfig | grep Bcast | cut -d \":\" -f 3 | cut -d \" \" -f 1"</span><span class="keyword">,</span><span class="default">$addr</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$addr</span><span class="keyword">=</span><span class="default">array_flip</span><span class="keyword">(</span><span class="default">array_flip</span><span class="keyword">(</span><span class="default">$addr</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$addr</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$last_ret</span><span class="keyword">=</span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">count</span><span class="keyword">(</span><span class="default">$ret</span><span class="keyword">);</span><span class="default">$i</span><span class="keyword">++)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$ret</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]!==</span><span class="default">false</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$last_ret</span><span class="keyword">=</span><span class="default">wake_on_lan</span><span class="keyword">(</span><span class="default">$mac</span><span class="keyword">,</span><span class="default">$ret</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">],</span><span class="default">$port</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return(</span><span class="default">$last_ret</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$mac</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ret</span><span class="keyword">=array();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$mac </span><span class="keyword">as </span><span class="default">$k</span><span class="keyword">=&gt;</span><span class="default">v</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ret</span><span class="keyword">[</span><span class="default">$k</span><span class="keyword">]=</span><span class="default">wake_on_lan</span><span class="keyword">(</span><span class="default">$v</span><span class="keyword">,</span><span class="default">$addr</span><span class="keyword">,</span><span class="default">$port</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return(</span><span class="default">$ret</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//Check if it's an real MAC-addres and split it into an array<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$mac</span><span class="keyword">=</span><span class="default">strtoupper</span><span class="keyword">(</span><span class="default">$mac</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if (!</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/([A-F0-9]{1,2}[-:]){5}[A-F0-9]{1,2}/"</span><span class="keyword">,</span><span class="default">$mac</span><span class="keyword">,</span><span class="default">$maccheck</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$addr_byte </span><span class="keyword">= </span><span class="default">preg_split</span><span class="keyword">(</span><span class="string">"/[-:]/"</span><span class="keyword">,</span><span class="default">$maccheck</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]);<br />
&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//Creating hardware adress<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$hw_addr </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; for (</span><span class="default">$a</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$a </span><span class="keyword">&lt; </span><span class="default">6</span><span class="keyword">; </span><span class="default">$a</span><span class="keyword">++)</span><span class="comment">//Changing mac adres from HEXEDECIMAL to DECIMAL<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$hw_addr </span><span class="keyword">.= </span><span class="default">chr</span><span class="keyword">(</span><span class="default">hexdec</span><span class="keyword">(</span><span class="default">$addr_byte</span><span class="keyword">[</span><span class="default">$a</span><span class="keyword">]));<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//Create package data<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$msg </span><span class="keyword">= </span><span class="default">str_repeat</span><span class="keyword">(</span><span class="default">chr</span><span class="keyword">(</span><span class="default">255</span><span class="keyword">),</span><span class="default">6</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; for (</span><span class="default">$a </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">; </span><span class="default">$a </span><span class="keyword">&lt;= </span><span class="default">16</span><span class="keyword">; </span><span class="default">$a</span><span class="keyword">++)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$msg </span><span class="keyword">.= </span><span class="default">$hw_addr</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//Sending data<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">'socket_create'</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//socket_create exists<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$sock </span><span class="keyword">= </span><span class="default">socket_create</span><span class="keyword">(</span><span class="default">AF_INET</span><span class="keyword">, </span><span class="default">SOCK_DGRAM</span><span class="keyword">, </span><span class="default">SOL_UDP</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//Can create the socket<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$sock</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$sock_data </span><span class="keyword">= </span><span class="default">socket_set_option</span><span class="keyword">(</span><span class="default">$sock</span><span class="keyword">, </span><span class="default">SOL_SOCKET</span><span class="keyword">, </span><span class="default">SO_BROADCAST</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">); </span><span class="comment">//Set<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$sock_data</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$sock_data </span><span class="keyword">= </span><span class="default">socket_sendto</span><span class="keyword">(</span><span class="default">$sock</span><span class="keyword">, </span><span class="default">$msg</span><span class="keyword">, </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$msg</span><span class="keyword">), </span><span class="default">0</span><span class="keyword">, </span><span class="default">$addr</span><span class="keyword">,</span><span class="default">$port</span><span class="keyword">); </span><span class="comment">//Send data<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$sock_data</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">socket_close</span><span class="keyword">(</span><span class="default">$sock</span><span class="keyword">); </span><span class="comment">//Close socket<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">unset(</span><span class="default">$sock</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return(</span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; @</span><span class="default">socket_close</span><span class="keyword">(</span><span class="default">$sock</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; unset(</span><span class="default">$sock</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$sock</span><span class="keyword">=</span><span class="default">fsockopen</span><span class="keyword">(</span><span class="string">"udp://" </span><span class="keyword">. </span><span class="default">$addr</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$sock</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ret</span><span class="keyword">=</span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$sock</span><span class="keyword">,</span><span class="default">$msg</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$sock</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$ret</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return(</span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return(</span><span class="default">false</span><span class="keyword">);&nbsp; &nbsp; <br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="66813""></a>
  <div class="note">
   <strong class="user">aeolianmeson at NOSPAM dot blitzeclipse dot com</strong>
   <a href="#66813" class="date">30-May-2006 09:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There is a fantastic book on this library called 'TCP/IP Sockets in C' (ISBN 1558608265), that covers all of the ins and outs, quirks, and everything else that goes on. It's written for C, of course, but it could have easily been written for PHP with almost no serious code differences.<br />
<br />
Dustin</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="66284""></a>
  <div class="note">
   <strong class="user">f.moisant</strong>
   <a href="#66284" class="date">18-May-2006 02:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This function to send Magic Packet works really !!!<br />
<br />
/********/<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">wake</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">, </span><span class="default">$mac</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">) <br />
{<br />
&nbsp; </span><span class="default">$nic </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="string">"udp://" </span><span class="keyword">. </span><span class="default">$ip</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">); <br />
&nbsp; if(</span><span class="default">$nic</span><span class="keyword">) <br />
&nbsp; { <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$packet </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">; <br />
&nbsp;&nbsp;&nbsp; for(</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">6</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) <br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$packet </span><span class="keyword">.= </span><span class="default">chr</span><span class="keyword">(</span><span class="default">0xFF</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; for(</span><span class="default">$j </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$j </span><span class="keyword">&lt; </span><span class="default">16</span><span class="keyword">; </span><span class="default">$j</span><span class="keyword">++)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; for(</span><span class="default">$k </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$k </span><span class="keyword">&lt; </span><span class="default">6</span><span class="keyword">; </span><span class="default">$k</span><span class="keyword">++) <br />
&nbsp;&nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$str </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$mac</span><span class="keyword">, </span><span class="default">$k </span><span class="keyword">* </span><span class="default">2</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dec </span><span class="keyword">= </span><span class="default">hexdec</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$packet </span><span class="keyword">.= </span><span class="default">chr</span><span class="keyword">(</span><span class="default">$dec</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ret </span><span class="keyword">= </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$nic</span><span class="keyword">, </span><span class="default">$packet</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$nic</span><span class="keyword">); <br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$ret</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp;&nbsp; return </span><span class="default">true</span><span class="keyword">; <br />
&nbsp; } <br />
&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
} <br />
</span><span class="default">?&gt;<br />
</span><br />
/********/<br />
<br />
Executed with:<br />
wake('123.123.123.123', '112233445566', 9);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="65052""></a>
  <div class="note">
   <strong class="user">goldemish at tiscali dot it</strong>
   <a href="#65052" class="date">24-Apr-2006 03:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Function to send Magic Packets for Wake on Wan (WOW) or Wake on Lan(WOL), without sockets library.<br />
<br />
&lt;?<br />
function WakeOnLan($ip, $mac, $port)<br />
{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $packet = "";<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for($i = 0; $i &lt; 6; $i++) $packet .= chr(0xFF);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for($i = 0; $i &lt; 6; $i++) $packet .= chr((int)substr($mac, $i, $i + 2));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $nic = fsockopen("udp://" . $ip, $port));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if($nic==false){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return false;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; fclose($nic);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; fwrite($nic, $packet);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; fclose($nic);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return true;<br />
}<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="56856""></a>
  <div class="note">
   <strong class="user">bmatheny at mobocracy dot net</strong>
   <a href="#56856" class="date">17-Sep-2005 03:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A multicast server can be written badly as follows:<br />
<br />
$bc_string = "Hello World!";<br />
$sock = socket_create(AF_INET, SOCK_DGRAM, 0); <br />
$opt_ret = socket_set_option($sock, 1, 6, TRUE);<br />
$send_ret = socket_sendto($sock, $bc_string, strlen($bc_string), 0, '230.0.0.1', 4446);<br />
<br />
Checking the return types is needed, but this does allow for you to multicast from php code.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="56061""></a>
  <div class="note">
   <strong class="user">philip at birk-jensen dot dk</strong>
   <a href="#56061" class="date">22-Aug-2005 03:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I've been using the ICMP Checksum calculation function written by Khaless [at] bigpond [dot] com. But when having an odd length of data, it failed, so I made my own instead, which adds a 0 if the data length is odd:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">icmpChecksum</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Add a 0 to the end of the data, if it's an "odd length"<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">)%</span><span class="default">2</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">.= </span><span class="string">"\x00"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Let PHP do all the dirty work<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$bit </span><span class="keyword">= </span><span class="default">unpack</span><span class="keyword">(</span><span class="string">'n*'</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$sum </span><span class="keyword">= </span><span class="default">array_sum</span><span class="keyword">(</span><span class="default">$bit</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Stolen from: Khaless [at] bigpond [dot] com<br />
&nbsp;&nbsp;&nbsp; // The code from the original ping program:<br />
&nbsp;&nbsp;&nbsp; //&nbsp; &nbsp; sum = (sum &gt;&gt; 16) + (sum &amp; 0xffff);&nbsp; &nbsp; /* add hi 16 to low 16 */<br />
&nbsp;&nbsp;&nbsp; //&nbsp; &nbsp; sum += (sum &gt;&gt; 16);&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* add carry */<br />
&nbsp;&nbsp;&nbsp; // which also works fine, but it seems to me that<br />
&nbsp;&nbsp;&nbsp; // Khaless will work on large data.<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">while (</span><span class="default">$sum</span><span class="keyword">&gt;&gt;</span><span class="default">16</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$sum </span><span class="keyword">= (</span><span class="default">$sum </span><span class="keyword">&gt;&gt; </span><span class="default">16</span><span class="keyword">) + (</span><span class="default">$sum </span><span class="keyword">&amp; </span><span class="default">0xffff</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">pack</span><span class="keyword">(</span><span class="string">'n*'</span><span class="keyword">, ~</span><span class="default">$sum</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="44860""></a>
  <div class="note">
   <strong class="user">aidan at php dot net</strong>
   <a href="#44860" class="date">18-Aug-2004 02:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
hexdump() is a fantastic function for "dumping" packets or binary output from servers. See the below link for more information.
<br />

<br />
<a href="http://aidanlister.com/repos/v/function.hexdump.php" rel="nofollow" target="_blank">http://aidanlister.com/repos/v/function.hexdump.php</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="42466""></a>
  <div class="note">
   <strong class="user">noSanity</strong>
   <a href="#42466" class="date">18-May-2004 04:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I have searched long and hard for a ping script that does NOT use EXEC() or SYSTEM(). So far, I have found nothing, so I decided to write my own, which was a task to say the least.<br />
<br />
First off, I would like to thank Khaless for their checksum function, converting it from C looked like a task in itself.<br />
<br />
Here is the class I wrote<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">class </span><span class="default">Net_Ping<br />
</span><span class="keyword">{<br />
&nbsp; var </span><span class="default">$icmp_socket</span><span class="keyword">;<br />
&nbsp; var </span><span class="default">$request</span><span class="keyword">;<br />
&nbsp; var </span><span class="default">$request_len</span><span class="keyword">;<br />
&nbsp; var </span><span class="default">$reply</span><span class="keyword">;<br />
&nbsp; var </span><span class="default">$errstr</span><span class="keyword">;<br />
&nbsp; var </span><span class="default">$time</span><span class="keyword">;<br />
&nbsp; var </span><span class="default">$timer_start_time</span><span class="keyword">;<br />
&nbsp; function </span><span class="default">Net_Ping</span><span class="keyword">()<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">icmp_socket </span><span class="keyword">= </span><span class="default">socket_create</span><span class="keyword">(</span><span class="default">AF_INET</span><span class="keyword">, </span><span class="default">SOCK_RAW</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">socket_set_block</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">icmp_socket</span><span class="keyword">);<br />
&nbsp; }<br />
&nbsp; <br />
&nbsp; function </span><span class="default">ip_checksum</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">)<br />
&nbsp; {<br />
&nbsp;&nbsp; &nbsp; for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">);</span><span class="default">$i </span><span class="keyword">+= </span><span class="default">2</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$data</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">]) </span><span class="default">$bits </span><span class="keyword">= </span><span class="default">unpack</span><span class="keyword">(</span><span class="string">'n*'</span><span class="keyword">,</span><span class="default">$data</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">].</span><span class="default">$data</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; else </span><span class="default">$bits </span><span class="keyword">= </span><span class="default">unpack</span><span class="keyword">(</span><span class="string">'C*'</span><span class="keyword">,</span><span class="default">$data</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$sum </span><span class="keyword">+= </span><span class="default">$bits</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; while (</span><span class="default">$sum</span><span class="keyword">&gt;&gt;</span><span class="default">16</span><span class="keyword">) </span><span class="default">$sum </span><span class="keyword">= (</span><span class="default">$sum </span><span class="keyword">&amp; </span><span class="default">0xffff</span><span class="keyword">) + (</span><span class="default">$sum </span><span class="keyword">&gt;&gt; </span><span class="default">16</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$checksum </span><span class="keyword">= </span><span class="default">pack</span><span class="keyword">(</span><span class="string">'n1'</span><span class="keyword">,~</span><span class="default">$sum</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; return </span><span class="default">$checksum</span><span class="keyword">;<br />
&nbsp; }<br />
<br />
&nbsp; function </span><span class="default">start_time</span><span class="keyword">()<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">timer_start_time </span><span class="keyword">= </span><span class="default">microtime</span><span class="keyword">();<br />
&nbsp; }<br />
&nbsp; <br />
&nbsp; function </span><span class="default">get_time</span><span class="keyword">(</span><span class="default">$acc</span><span class="keyword">=</span><span class="default">2</span><span class="keyword">)<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// format start time<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$start_time </span><span class="keyword">= </span><span class="default">explode </span><span class="keyword">(</span><span class="string">" "</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">timer_start_time</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$start_time </span><span class="keyword">= </span><span class="default">$start_time</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] + </span><span class="default">$start_time</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// get and format end time<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$end_time </span><span class="keyword">= </span><span class="default">explode </span><span class="keyword">(</span><span class="string">" "</span><span class="keyword">, </span><span class="default">microtime</span><span class="keyword">());<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$end_time </span><span class="keyword">= </span><span class="default">$end_time</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] + </span><span class="default">$end_time</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">number_format </span><span class="keyword">(</span><span class="default">$end_time </span><span class="keyword">- </span><span class="default">$start_time</span><span class="keyword">, </span><span class="default">$acc</span><span class="keyword">);<br />
&nbsp; }<br />
<br />
&nbsp; function </span><span class="default">Build_Packet</span><span class="keyword">()<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="string">"abcdefghijklmnopqrstuvwabcdefghi"</span><span class="keyword">; </span><span class="comment">// the actual test data<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$type </span><span class="keyword">= </span><span class="string">"\x08"</span><span class="keyword">; </span><span class="comment">// 8 echo message; 0 echo reply message<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$code </span><span class="keyword">= </span><span class="string">"\x00"</span><span class="keyword">; </span><span class="comment">// always 0 for this program<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$chksm </span><span class="keyword">= </span><span class="string">"\x00\x00"</span><span class="keyword">; </span><span class="comment">// generate checksum for icmp request<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$id </span><span class="keyword">= </span><span class="string">"\x00\x00"</span><span class="keyword">; </span><span class="comment">// we will have to work with this later<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$sqn </span><span class="keyword">= </span><span class="string">"\x00\x00"</span><span class="keyword">; </span><span class="comment">// we will have to work with this later<br />
<br />
&nbsp;&nbsp;&nbsp; // now we need to change the checksum to the real checksum<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$chksm </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">ip_checksum</span><span class="keyword">(</span><span class="default">$type</span><span class="keyword">.</span><span class="default">$code</span><span class="keyword">.</span><span class="default">$chksm</span><span class="keyword">.</span><span class="default">$id</span><span class="keyword">.</span><span class="default">$sqn</span><span class="keyword">.</span><span class="default">$data</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// now lets build the actual icmp packet<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">request </span><span class="keyword">= </span><span class="default">$type</span><span class="keyword">.</span><span class="default">$code</span><span class="keyword">.</span><span class="default">$chksm</span><span class="keyword">.</span><span class="default">$id</span><span class="keyword">.</span><span class="default">$sqn</span><span class="keyword">.</span><span class="default">$data</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">request_len </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">request</span><span class="keyword">);<br />
&nbsp; }<br />
&nbsp; <br />
&nbsp; function </span><span class="default">Ping</span><span class="keyword">(</span><span class="default">$dst_addr</span><span class="keyword">,</span><span class="default">$timeout</span><span class="keyword">=</span><span class="default">5</span><span class="keyword">,</span><span class="default">$percision</span><span class="keyword">=</span><span class="default">3</span><span class="keyword">)<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// lets catch dumb people<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if ((int)</span><span class="default">$timeout </span><span class="keyword">&lt;= </span><span class="default">0</span><span class="keyword">) </span><span class="default">$timeout</span><span class="keyword">=</span><span class="default">5</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if ((int)</span><span class="default">$percision </span><span class="keyword">&lt;= </span><span class="default">0</span><span class="keyword">) </span><span class="default">$percision</span><span class="keyword">=</span><span class="default">3</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// set the timeout<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">socket_set_option</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">icmp_socket</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">SOL_SOCKET</span><span class="keyword">,&nbsp; </span><span class="comment">// socket level<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">SO_RCVTIMEO</span><span class="keyword">, </span><span class="comment">// timeout option<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="keyword">array(<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="string">"sec"</span><span class="keyword">=&gt;</span><span class="default">$timeout</span><span class="keyword">, </span><span class="comment">// Timeout in seconds<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="string">"usec"</span><span class="keyword">=&gt;</span><span class="default">0&nbsp; </span><span class="comment">// I assume timeout in microseconds<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp;&nbsp; );<br />
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$dst_addr</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (@</span><span class="default">socket_connect</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">icmp_socket</span><span class="keyword">, </span><span class="default">$dst_addr</span><span class="keyword">, </span><span class="default">NULL</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">errstr </span><span class="keyword">= </span><span class="string">"Cannot connect to </span><span class="default">$dst_addr</span><span class="string">"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">FALSE</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">Build_Packet</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">start_time</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">socket_write</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">icmp_socket</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">request</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">request_len</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (@</span><span class="default">socket_recv</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">icmp_socket</span><span class="keyword">, &amp;</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">reply</span><span class="keyword">, </span><span class="default">256</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">time </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">get_time</span><span class="keyword">(</span><span class="default">$percision</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">time</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">errstr </span><span class="keyword">= </span><span class="string">"Timed out"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">FALSE</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">errstr </span><span class="keyword">= </span><span class="string">"Destination address not specified"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; return </span><span class="default">FALSE</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
}<br />
<br />
</span><span class="default">$ping </span><span class="keyword">= new </span><span class="default">Net_Ping</span><span class="keyword">;<br />
</span><span class="default">$ping</span><span class="keyword">-&gt;</span><span class="default">ping</span><span class="keyword">(</span><span class="string">"www.google.ca"</span><span class="keyword">);<br />
<br />
if (</span><span class="default">$ping</span><span class="keyword">-&gt;</span><span class="default">time</span><span class="keyword">)<br />
&nbsp; echo </span><span class="string">"Time: "</span><span class="keyword">.</span><span class="default">$ping</span><span class="keyword">-&gt;</span><span class="default">time</span><span class="keyword">;<br />
else<br />
&nbsp; echo </span><span class="default">$ping</span><span class="keyword">-&gt;</span><span class="default">errstr</span><span class="keyword">;<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Hope this saves some troubles.<br />
<br />
noSanity</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="39151""></a>
  <div class="note">
   <strong class="user">Khaless [at] bigpond [dot] com</strong>
   <a href="#39151" class="date">19-Jan-2004 06:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I spent a while trying to use SOCK_RAW to send ICMP request packets so i could ping. This however lead me to need the internet checksum written as a php function, which was a little hard because of the way PHP handles variable types. Anyway, to save others the effort heres what i came up with, this returns Checksum for $data<br />
<br />
<span class="default">&lt;?PHP<br />
</span><span class="comment">// Computes Internet Checksum for $data<br />
// will return a 16-bit internet checksum for $data<br />
</span><span class="keyword">function </span><span class="default">inetChecksum</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// 32-bit accumilator, 16 bits at a time, adds odd bit on at end<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">);</span><span class="default">$i </span><span class="keyword">+= </span><span class="default">2</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$data</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">]) </span><span class="default">$bits </span><span class="keyword">= </span><span class="default">unpack</span><span class="keyword">(</span><span class="string">'n*'</span><span class="keyword">,</span><span class="default">$data</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">].</span><span class="default">$data</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else </span><span class="default">$bits </span><span class="keyword">= </span><span class="default">unpack</span><span class="keyword">(</span><span class="string">'C*'</span><span class="keyword">,</span><span class="default">$data</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$sum </span><span class="keyword">+= </span><span class="default">$bits</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Fold 32-bit sum to 16 bits <br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">while (</span><span class="default">$sum</span><span class="keyword">&gt;&gt;</span><span class="default">16</span><span class="keyword">) </span><span class="default">$sum </span><span class="keyword">= (</span><span class="default">$sum </span><span class="keyword">&amp; </span><span class="default">0xffff</span><span class="keyword">) + (</span><span class="default">$sum </span><span class="keyword">&gt;&gt; </span><span class="default">16</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$checksum </span><span class="keyword">= </span><span class="default">pack</span><span class="keyword">(</span><span class="string">'n1'</span><span class="keyword">,~</span><span class="default">$sum</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$checksum</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
And with this i was able to construct a correct PING Request.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="36335""></a>
  <div class="note">
   <strong class="user">murzik [at] pisem dot net</strong>
   <a href="#36335" class="date">06-Oct-2003 01:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
&gt;The function, that send the WakeOnLan (WOL, Magic packet) signal:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="comment"># Wake on LAN - (c) HotKey (at SPR dot AT), upgraded by Murzik &lt;tomurzik@inbox.ru&gt;
<br />

<br />
</span><span class="default">flush</span><span class="keyword">();
<br />

<br />
function </span><span class="default">WakeOnLan</span><span class="keyword">(</span><span class="default">$addr</span><span class="keyword">, </span><span class="default">$mac</span><span class="keyword">)
<br />
{
<br />
&nbsp;</span><span class="default">$addr_byte </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">':'</span><span class="keyword">, </span><span class="default">$mac</span><span class="keyword">);
<br />
&nbsp;</span><span class="default">$hw_addr </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;
<br />

<br />
&nbsp;for (</span><span class="default">$a</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$a </span><span class="keyword">&lt; </span><span class="default">6</span><span class="keyword">; </span><span class="default">$a</span><span class="keyword">++) </span><span class="default">$hw_addr </span><span class="keyword">.= </span><span class="default">chr</span><span class="keyword">(</span><span class="default">hexdec</span><span class="keyword">(</span><span class="default">$addr_byte</span><span class="keyword">[</span><span class="default">$a</span><span class="keyword">]));
<br />

<br />
&nbsp;</span><span class="default">$msg </span><span class="keyword">= </span><span class="default">chr</span><span class="keyword">(</span><span class="default">255</span><span class="keyword">).</span><span class="default">chr</span><span class="keyword">(</span><span class="default">255</span><span class="keyword">).</span><span class="default">chr</span><span class="keyword">(</span><span class="default">255</span><span class="keyword">).</span><span class="default">chr</span><span class="keyword">(</span><span class="default">255</span><span class="keyword">).</span><span class="default">chr</span><span class="keyword">(</span><span class="default">255</span><span class="keyword">).</span><span class="default">chr</span><span class="keyword">(</span><span class="default">255</span><span class="keyword">);
<br />

<br />
&nbsp;for (</span><span class="default">$a </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">; </span><span class="default">$a </span><span class="keyword">&lt;= </span><span class="default">16</span><span class="keyword">; </span><span class="default">$a</span><span class="keyword">++)&nbsp; &nbsp; </span><span class="default">$msg </span><span class="keyword">.= </span><span class="default">$hw_addr</span><span class="keyword">;
<br />

<br />
&nbsp;</span><span class="comment">// send it to the broadcast address using UDP
<br />
&nbsp;// SQL_BROADCAST option isn't help!!
<br />
&nbsp;</span><span class="default">$s </span><span class="keyword">= </span><span class="default">socket_create</span><span class="keyword">(</span><span class="default">AF_INET</span><span class="keyword">, </span><span class="default">SOCK_DGRAM</span><span class="keyword">, </span><span class="default">SOL_UDP</span><span class="keyword">);
<br />
&nbsp;if (</span><span class="default">$s </span><span class="keyword">== </span><span class="default">false</span><span class="keyword">)
<br />
&nbsp;{
<br />
&nbsp; echo </span><span class="string">"Error creating socket!\n"</span><span class="keyword">;
<br />
&nbsp; echo </span><span class="string">"Error code is '"</span><span class="keyword">.</span><span class="default">socket_last_error</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">).</span><span class="string">"' - " </span><span class="keyword">. </span><span class="default">socket_strerror</span><span class="keyword">(</span><span class="default">socket_last_error</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">));
<br />
&nbsp;}
<br />
&nbsp;else
<br />
&nbsp;{
<br />
&nbsp;</span><span class="comment">// setting a broadcast option to socket:
<br />
&nbsp; </span><span class="default">$opt_ret </span><span class="keyword">=&nbsp; </span><span class="default">socket_set_option</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">, </span><span class="default">6</span><span class="keyword">, </span><span class="default">TRUE</span><span class="keyword">);
<br />
&nbsp; if(</span><span class="default">$opt_ret </span><span class="keyword">&lt; </span><span class="default">0</span><span class="keyword">)
<br />
&nbsp; {
<br />
&nbsp;&nbsp; echo </span><span class="string">"setsockopt() failed, error: " </span><span class="keyword">. </span><span class="default">strerror</span><span class="keyword">(</span><span class="default">$opt_ret</span><span class="keyword">) . </span><span class="string">"\n"</span><span class="keyword">;
<br />
&nbsp; }
<br />
&nbsp; </span><span class="default">$e </span><span class="keyword">= </span><span class="default">socket_sendto</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">, </span><span class="default">$msg</span><span class="keyword">, </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$msg</span><span class="keyword">), </span><span class="default">0</span><span class="keyword">, </span><span class="default">$addr</span><span class="keyword">, </span><span class="default">2050</span><span class="keyword">);
<br />
&nbsp; </span><span class="default">socket_close</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">);
<br />
&nbsp; echo </span><span class="string">"Magic Packet sent ("</span><span class="keyword">.</span><span class="default">$e</span><span class="keyword">.</span><span class="string">") to "</span><span class="keyword">.</span><span class="default">$addr</span><span class="keyword">.</span><span class="string">", MAC="</span><span class="keyword">.</span><span class="default">$mac</span><span class="keyword">;
<br />
&nbsp;}
<br />
}
<br />

<br />
</span><span class="comment">#WakeOnLan('yourIPorDomain.dyndns.org', 'your:MAC:address');
<br />
#WakeOnLan('192.168.0.2', '00:30:84:2A:90:42');
<br />
#WakeOnLan('192.168.1.2', '00:05:1C:10:04:05');
<br />

<br />
//if you have switch or other routing devices in LAN, sendign to
<br />
// the local IP isn't helps! you need send to the broadcast address like this:
<br />
</span><span class="default">WakeOnLan</span><span class="keyword">(</span><span class="string">'192.168.1.255'</span><span class="keyword">, </span><span class="string">'00:05:1C:10:04:05'</span><span class="keyword">);
<br />

<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="28160""></a>
  <div class="note">
   <strong class="user">talmage at usi-rpg dot com</strong>
   <a href="#28160" class="date">04-Jan-2003 09:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I have spent the past two days ripping out hair trying to figure out how to prevent zombie processes w/the examples above and I just happend to find this in the manual for another lanuage, felt it neccassry to port it here.<br />
<br />
--begin copy--<br />
van[at]webfreshener[dot]com<br />
11-Oct-2002 02:53 <br />
&nbsp;<br />
Forking your PHP daemon will cause it to zombie on exit.<br />
<br />
...or so I've seen on:<br />
FreeBSD (PHP4.2.x)<br />
Debian (PHP4.3.0-dev)<br />
Darwin (PHP4.3.0-dev)<br />
<br />
This was tested with the example code above and other scripts created for evaluation.<br />
<br />
Seems adding &lt;b&gt;--enable-sigchild&lt;/b&gt; to your configure will get rid of the problem.<br />
<br />
Hope that saves some hair tearing :] <br />
<br />
--end copy--<br />
<br />
Thanks vam@wenfreshener.com !!!!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="23096""></a>
  <div class="note">
   <strong class="user">saryon at unfix dot org</strong>
   <a href="#23096" class="date">09-Jul-2002 06:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I found this EXTREMELY useful link on the zend php <br />
mailing list:<br />
<br />
<a href="http://www.zend.com/lists/php-dev/200205/msg00286.html" rel="nofollow" target="_blank">http://www.zend.com/lists/php-dev/200205/msg00286.html</a><br />
<br />
It's about being able to use multiple connections<br />
in a php socket server, WITHOUT having<br />
to use those threads everyone seems to be<br />
so very fond of.<br />
works very well :)<br />
(ps: i didn't make it, so....don't say thanks to me ;),<br />
thank him)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="19302""></a>
  <div class="note">
   <strong class="user">daniel[at]lorch.cc</strong>
   <a href="#19302" class="date">22-Feb-2002 06:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
"Beej's Guide to Network Programming" is an absolutely excellent and easy to understand tutorial to socket programming. It was written for C developers, but as the socket functions in PHP are (almost) analoguous, this should not be a problem.<br />
<br />
<a href="http://www.ecst.csuchico.edu/~beej/guide/net/" rel="nofollow" target="_blank">http://www.ecst.csuchico.edu/~beej/guide/net/</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="13230""></a>
  <div class="note">
   <strong class="user">judeman at yahoo dot com</strong>
   <a href="#13230" class="date">05-Jun-2001 07:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
After several hours of working with sockets in an attempt to do UDP broadcasting, I thought a little help was in order for anyone else looking to do something similar, since it uses a number of those "undocumented" functions.&nbsp; Here's how I did it:
<br />

<br />
<span class="default">&lt;?php
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// here is a basic opening of the a socket.&nbsp; AF_INET specifies the internet domain.&nbsp; SOCK_DGRAM 
<br />
// specifies the Datagram socket type the 0 specifies that I want to use the default protcol (which in this
<br />
// case is UDP)
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$sock </span><span class="keyword">= </span><span class="default">socket</span><span class="keyword">(</span><span class="default">AF_INET</span><span class="keyword">, </span><span class="default">SOCK_DGRAM</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// if the file handle assigned to socket is less than 0 then opening the socket failed
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">$sock </span><span class="keyword">&lt; </span><span class="default">0</span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"socket() failed, error: " </span><span class="keyword">. </span><span class="default">strerror</span><span class="keyword">(</span><span class="default">$sock</span><span class="keyword">) . </span><span class="string">"\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// here's where I set the socket options, this is essential to allow broadcasting.&nbsp; An earlier comment (as of 
<br />
// June 4th, 2001) explains what the parameters are.&nbsp; For my purposes (UDP broadcasting) I need to set 
<br />
// the broadcast option at the socket level to true.&nbsp; In C, this done using SOL_SOCKET as the level param
<br />
// (2) and SO_BROADCAST as the type param (3).&nbsp; These may exist in PHP but I couldn't reference them&nbsp; 
<br />
// so I used the values that referencing these variables in C returns (namely 1 and 6 respectively).&nbsp; This 
<br />
// function is basically just a wrapper to the C&nbsp; function so check out the C documentation for more info
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$opt_ret </span><span class="keyword">= </span><span class="default">setsockopt</span><span class="keyword">(</span><span class="default">$sock</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">, </span><span class="default">6</span><span class="keyword">, </span><span class="default">TRUE</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// if the return value is less than one, an error occured setting the options 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">$opt_ret </span><span class="keyword">&lt; </span><span class="default">0</span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"setsockopt() failed, error: " </span><span class="keyword">. </span><span class="default">strerror</span><span class="keyword">(</span><span class="default">$opt_ret</span><span class="keyword">) . </span><span class="string">"\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// finally I am ready to broad cast something.&nbsp; The sendto function allows this without any 
<br />
// connections (essential for broadcasting).&nbsp; So, this function sends the contents of $broadcast_string to the
<br />
// general broadcast address (255.255.255.255) on port 4096.&nbsp; The 0 (param 4) specifies no special
<br />
// options, you can read about the options with man sendto 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$send_ret </span><span class="keyword">= </span><span class="default">sendto</span><span class="keyword">(</span><span class="default">$sock</span><span class="keyword">, </span><span class="default">$broadcast_string</span><span class="keyword">, </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$broadcast_string</span><span class="keyword">), </span><span class="default">0</span><span class="keyword">, </span><span class="string">'255.255.255.255'</span><span class="keyword">, </span><span class="default">4096</span><span class="keyword">);
<br />

<br />
</span><span class="comment">// if the return value is less than 0, an error has occured 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">$send_ret </span><span class="keyword">&lt; </span><span class="default">0</span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"sendto() failed, error: " </span><span class="keyword">. </span><span class="default">strerror</span><span class="keyword">(</span><span class="default">$send_ret</span><span class="keyword">) . </span><span class="string">"&lt;BR&gt;\n"</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
<br />
</span><span class="comment">// be sure to close your socket when you're done 
<br />
</span><span class="default">close</span><span class="keyword">(</span><span class="default">$sock</span><span class="keyword">);</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
