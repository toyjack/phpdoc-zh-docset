<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>将字符串解析成多个变量</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.ord.html">? ord</a></li>
      <li style="float: right;"><a href="function.print.html">print ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.strings.html">字符串 函数</a></li>
    <li>将字符串解析成多个变量</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.parse-str" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">parse_str</h1>
  <p class="verinfo">(PHP 4, PHP 5, PHP 7)</p><p class="refpurpose"><span class="refname">parse_str</span> &mdash; <span class="dc-title">将字符串解析成多个变量</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.parse-str-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type"><span class="type void">void</span></span> <span class="methodname"><strong>parse_str</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$str</code></span>
   [, <span class="methodparam"><span class="type">array</span> <code class="parameter reference">&$arr</code></span>
  ] )</div>

  <p class="para rdfs-comment">
   如果 <code class="parameter">str</code> 是 URL 传递入的查询字符串（query string），则将它解析为变量并设置到当前作用域。
  </p>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    获取当前的 <em>QUERY_STRING</em>，你可以使用 <var class="varname"><var class="varname"><a href="reserved.variables.server.html" class="classname">$_SERVER['QUERY_STRING']</a></var></var> 变量。
    同时，你也许该阅读 <a href="language.variables.external.html" class="link">来自 PHP 之外的变量</a> 这一节。
   </p>
  </p></blockquote>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    <a href="info.configuration.html#ini.magic-quotes-gpc" class="link">magic_quotes_gpc</a> 影响到了 <span class="function"><strong>parse_str()</strong></span> 这个函数的输出，和 PHP 用于填充 <var class="varname"><var class="varname"><a href="reserved.variables.get.html" class="classname">$_GET</a></var></var>、
    <var class="varname"><var class="varname"><a href="reserved.variables.post.html" class="classname">$_POST</a></var></var> 及其他变量的机制一致。
   </p>
  </p></blockquote>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.parse-str-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">str</code></dt>

     <dd>

      <p class="para">
       输入的字符串。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">arr</code></dt>

     <dd>

      <p class="para">
       如果设置了第二个变量 <code class="parameter">arr</code>，变量将会以数组元素的形式存入到这个数组，作为替代。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.parse-str-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   没有返回值。
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.parse-str-examples">
  <h3 class="title">范例</h3>
  <p class="para">
   <div class="example" id="example-5263">
    <p><strong>Example #1 <span class="function"><strong>parse_str()</strong></span> 的使用</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$str&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"first=value&amp;arr[]=foo+bar&amp;arr[]=baz"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">parse_str</span><span style="color: #007700">(</span><span style="color: #0000BB">$str</span><span style="color: #007700">);<br />echo&nbsp;</span><span style="color: #0000BB">$first</span><span style="color: #007700">;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;value<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">$arr</span><span style="color: #007700">[</span><span style="color: #0000BB">0</span><span style="color: #007700">];&nbsp;</span><span style="color: #FF8000">//&nbsp;foo&nbsp;bar<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">$arr</span><span style="color: #007700">[</span><span style="color: #0000BB">1</span><span style="color: #007700">];&nbsp;</span><span style="color: #FF8000">//&nbsp;baz<br /><br /></span><span style="color: #0000BB">parse_str</span><span style="color: #007700">(</span><span style="color: #0000BB">$str</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$output</span><span style="color: #007700">);<br />echo&nbsp;</span><span style="color: #0000BB">$output</span><span style="color: #007700">[</span><span style="color: #DD0000">'first'</span><span style="color: #007700">];&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;value<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">$output</span><span style="color: #007700">[</span><span style="color: #DD0000">'arr'</span><span style="color: #007700">][</span><span style="color: #0000BB">0</span><span style="color: #007700">];&nbsp;</span><span style="color: #FF8000">//&nbsp;foo&nbsp;bar<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">$output</span><span style="color: #007700">[</span><span style="color: #DD0000">'arr'</span><span style="color: #007700">][</span><span style="color: #0000BB">1</span><span style="color: #007700">];&nbsp;</span><span style="color: #FF8000">//&nbsp;baz<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.parse-str-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.parse-url.html" class="function" rel="rdfs-seeAlso">parse_url()</a> - 解析 URL，返回其组成部分</span></li>
    <li class="member"><span class="function"><a href="function.pathinfo.html" class="function" rel="rdfs-seeAlso">pathinfo()</a> - 返回文件路径的信息</span></li>
    <li class="member"><span class="function"><a href="function.http-build-query.html" class="function" rel="rdfs-seeAlso">http_build_query()</a> - 生成 URL-encode 之后的请求字符串</span></li>
    <li class="member"><span class="function"><a href="function.get-magic-quotes-gpc.html" class="function" rel="rdfs-seeAlso">get_magic_quotes_gpc()</a> - 获取当前 magic_quotes_gpc 的配置选项设置</span></li>
    <li class="member"><span class="function"><a href="function.urldecode.html" class="function" rel="rdfs-seeAlso">urldecode()</a> - 解码已编码的 URL 字符串</span></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="118922""></a>
  <div class="note">
   <strong class="user">aaronw at catalyst dot net dot nz</strong>
   <a href="#118922" class="date">29-Feb-2016 10:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
DO NOT make a practice of using the one-parameter version of this function, particularly for processing user input. It's susceptible to exactly the same sorts of bugs and security problems as the old "register_globals" setting. I'm actually rather surprised there's not a warning message about it on this page.<br />
<br />
If you use the one-parameter version of parse_str() in global scope (i.e. outside of any functions), it lets the user override ANY global variables in your script, even superglobals like $_GET and $_REQUEST.<br />
<br />
If you use it inside a function, it can't touch your global variables but it can still override any variables already defined in the function, or populate variables that later get accessed without prior initialization.<br />
<br />
You can guard against these problems by making sure to call parse_str() only in function/method scope, and before any variable declarations, and making sure to initialize all variables before accessing them. But why leave yourself open? Just use the two-parameter version of parse_str().<br />
<br />
// BAD<br />
parse_str($_SERVER['QUERY_STRING']);<br />
echo $foo;<br />
<br />
// BETTER<br />
parse_str($_SERVER['QUERY_STRING'], $urlparams);<br />
echo $urlparams['foo'];</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="118008""></a>
  <div class="note">
   <strong class="user">StanE</strong>
   <a href="#118008" class="date">18-Sep-2015 06:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that the characters "." and " " (empty space) will be converted to "_". The characters "[" and "]" have special meaning: They represent arrays but there seems to be some weird behaviour, which I don't really understand:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// Note: "[" = %5B, "]" = %5D<br />
<br />
/*<br />
"v][=a" produces ("[" gets replaced by "_"):<br />
Array<br />
(<br />
&nbsp;&nbsp;&nbsp; [v]_] =&gt; a<br />
)<br />
*/<br />
</span><span class="default">parse_str</span><span class="keyword">(</span><span class="string">"v%5D%5B=a"</span><span class="keyword">, </span><span class="default">$r</span><span class="keyword">);<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$r</span><span class="keyword">);<br />
<br />
</span><span class="comment">/*<br />
"v][[=a" produces (first "[" gets replaced by "_", but not all following):<br />
Array<br />
(<br />
&nbsp;&nbsp;&nbsp; [v]_[] =&gt; a<br />
)<br />
*/<br />
</span><span class="default">parse_str</span><span class="keyword">(</span><span class="string">"v%5D%5B%5B=a"</span><span class="keyword">, </span><span class="default">$r</span><span class="keyword">);<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$r</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="117183""></a>
  <div class="note">
   <strong class="user">zweibieren at yahoo dot com</strong>
   <a href="#117183" class="date">28-Apr-2015 12:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If the arr argument is provided, all its existing elements are removed.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="115695""></a>
  <div class="note">
   <strong class="user">jmareda at seznam dot cz</strong>
   <a href="#115695" class="date">10-Sep-2014 09:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just remember that the array you enter will be cleared. So if you have $COOKIES variable to store cookies while crawling something, you'll have to use array_merge to merge new cookies with old ones.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="112568""></a>
  <div class="note">
   <strong class="user">markc</strong>
   <a href="#112568" class="date">01-Jul-2013 01:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Beware using parse_str in a function that has vars passed by reference. It seems that parse_str actually creates new vars even if vars of the same name exist. If you pass by ref vars of the same name as those in a query string being parsed new LOCAL vers will be created and you won't get any values passed back to the caller (relates to what Maikel mentioned below)<br />
<br />
An unrealistic example (vaguely related to what I was doing when I found this out)...<br />
<br />
function get_title($query,&amp;$title)<br />
{<br />
&nbsp; parse_str($query);<br />
&nbsp; $title=str_replace("_"," ",$title);<br />
}<br />
<br />
$title="foo";<br />
$query = "context=something&amp;title=Title_of_Something";<br />
get_title($query,$title);<br />
<br />
echo $title .... "foo"</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="109212""></a>
  <div class="note">
   <strong class="user">jrgns at jadeit dot co dot za</strong>
   <a href="#109212" class="date">27-Jun-2012 05:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The array to be populated does not need to be defined before calling the function:<br />
<br />
<span class="default">&lt;?php<br />
error_reporting</span><span class="keyword">(</span><span class="default">E_ALL </span><span class="keyword">| </span><span class="default">E_STRICT</span><span class="keyword">);<br />
</span><span class="default">parse_str</span><span class="keyword">(</span><span class="string">'var=value'</span><span class="keyword">, </span><span class="default">$array</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
This will not produce a notice.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="108642""></a>
  <div class="note">
   <strong class="user">shagshag</strong>
   <a href="#108642" class="date">14-May-2012 02:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
That's not says in the description but max_input_vars directive affects this function. If there are more input variables on the string than specified by this directive, an E_WARNING is issued, and further input variables are truncated from the request.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="108435""></a>
  <div class="note">
   <strong class="user">Benjamin Garcia</strong>
   <a href="#108435" class="date">26-Apr-2012 06:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
function like parse_str, but doesn't convert spaces and dots to underscores in $_GET AND $_POST<br />
<br />
/**<br />
&nbsp;* GET and POST input containing dots, etc.<br />
&nbsp;*/<br />
function getRealREQUEST() {<br />
&nbsp;&nbsp;&nbsp; $vars = array();<br />
<br />
&nbsp;&nbsp;&nbsp; $input&nbsp; &nbsp; = $_SERVER['REDIRECT_QUERY_STRING'];<br />
&nbsp;&nbsp;&nbsp; if(!empty($input)){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $pairs&nbsp; &nbsp; = explode("&amp;", $input);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach ($pairs&nbsp; &nbsp;&nbsp; as $pair) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $nv&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = explode("=", $pair);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = urldecode($nv[0]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $nameSanitize&nbsp; &nbsp; = preg_replace('/([^\[]*)\[.*$/','$1',$name);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $nameMatched&nbsp; &nbsp; = str_replace('.','_',$nameSanitize);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $nameMatched&nbsp; &nbsp; = str_replace(' ','_',$nameMatched);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $vars[$nameSanitize]&nbsp; &nbsp; = $_REQUEST[$nameMatched];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; $input&nbsp; &nbsp; = file_get_contents("php://input");<br />
&nbsp;&nbsp;&nbsp; if(!empty($input)){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $pairs&nbsp; &nbsp; = explode("&amp;", $input);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach ($pairs as $pair) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $nv&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = explode("=", $pair);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = urldecode($nv[0]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $nameSanitize&nbsp; &nbsp; = preg_replace('/([^\[]*)\[.*$/','$1',$name);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $nameMatched&nbsp; &nbsp; = str_replace('.','_',$nameSanitize);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $nameMatched&nbsp; &nbsp; = str_replace(' ','_',$nameMatched);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $vars[$nameSanitize]&nbsp; &nbsp; = $_REQUEST[$nameMatched];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; return $vars;<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99364""></a>
  <div class="note">
   <strong class="user">Will Voelcker</strong>
   <a href="#99364" class="date">12-Aug-2010 08:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you need a function that does something similar to parse_str, but doesn't convert spaces and dots to underscores, try something like the following:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">parseQueryString</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$op </span><span class="keyword">= array();
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$pairs </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">"&amp;"</span><span class="keyword">, </span><span class="default">$str</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$pairs </span><span class="keyword">as </span><span class="default">$pair</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; list(</span><span class="default">$k</span><span class="keyword">, </span><span class="default">$v</span><span class="keyword">) = </span><span class="default">array_map</span><span class="keyword">(</span><span class="string">"urldecode"</span><span class="keyword">, </span><span class="default">explode</span><span class="keyword">(</span><span class="string">"="</span><span class="keyword">, </span><span class="default">$pair</span><span class="keyword">));
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$op</span><span class="keyword">[</span><span class="default">$k</span><span class="keyword">] = </span><span class="default">$v</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$op</span><span class="keyword">;
<br />
}
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
It may need adapting to handle various edge cases.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="98652""></a>
  <div class="note">
   <strong class="user">sam dot fullman at verizon dot net</strong>
   <a href="#98652" class="date">29-Jun-2010 10:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you're using .htaccess to spoof pages in any type of application, then $QUERY_STRING or $_SERVER['QUERY_STRING'] is going to be blank.&nbsp; Instead, $_SERVER['REDIRECT_QUERY_STRING'] will hold the actual query string passed by user.&nbsp; Use this function to parse this variable.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="96035""></a>
  <div class="note">
   <strong class="user">me at bubjavier dot com</strong>
   <a href="#96035" class="date">04-Feb-2010 11:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
be careful using parse_str() without the [array &amp;$arr] parameter, as this may override values of global and existing variables.<br />
<br />
<span class="default">&lt;?php<br />
$var1 </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;<br />
</span><span class="default">parse_str</span><span class="keyword">(</span><span class="string">'var1=one&amp;var2=two'</span><span class="keyword">);<br />
</span><span class="comment">// $var1 is now 'one'<br />
</span><span class="default">?&gt;<br />
</span><br />
Also may lead to variable value injection when used with user input data:<br />
<br />
<span class="default">&lt;?php<br />
$_POST</span><span class="keyword">[</span><span class="string">'range'</span><span class="keyword">] = </span><span class="string">'min=1&amp;max=5&amp;important_var=important_value_no_more'</span><span class="keyword">;<br />
<br />
</span><span class="default">$important_var </span><span class="keyword">= </span><span class="string">'important_value'</span><span class="keyword">;<br />
</span><span class="default">parse_str</span><span class="keyword">(</span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'range'</span><span class="keyword">]);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84165""></a>
  <div class="note">
   <strong class="user">tobsn at php dot net</strong>
   <a href="#84165" class="date">01-Jul-2008 08:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
just a heads up with the example above:<br />
?var[]=123 - the [] has to be urlencoded.<br />
var names and var values - both have to be urlencoded!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82837""></a>
  <div class="note">
   <strong class="user">helpmepro1 at gmail dot com</strong>
   <a href="#82837" class="date">28-Apr-2008 06:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
&lt;? <br />
//by shimon doodkin<br />
<br />
&nbsp;$url_form=url_to_form($url);<br />
&nbsp;echo '&lt;form action="'.$url_form['action'].'" method="get"&gt;';<br />
&nbsp;echo $url_form['hidden'];<br />
&nbsp;echo '&lt;input name="otherfiled" type="text"&gt;';<br />
&nbsp;echo '&lt;input type="submit"&gt;';<br />
&nbsp;echo '&lt;/form&gt;';<br />
<br />
&nbsp;function url_to_form($url)<br />
&nbsp;{<br />
&nbsp; $url=split('\?',$url,2);<br />
&nbsp; $action=$url[0];<br />
&nbsp; $hidden="";<br />
&nbsp; if(isset($url[1]))<br />
&nbsp; {<br />
&nbsp;&nbsp; $pairs=split('&amp;',$url[1]);<br />
&nbsp;&nbsp; foreach($pairs as $pair)<br />
&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; $pair=split('=',$pair,2);<br />
&nbsp;&nbsp;&nbsp; $name=$pair[0];<br />
&nbsp;&nbsp;&nbsp; if(isset($pair[1]))<br />
&nbsp;&nbsp; &nbsp; $value=$pair[1];<br />
&nbsp;&nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; $value='';<br />
&nbsp;&nbsp;&nbsp; $name=$name;<br />
&nbsp;&nbsp;&nbsp; $value=htmlspecialchars($value);<br />
&nbsp;&nbsp;&nbsp; if($name!='')<br />
&nbsp;&nbsp; &nbsp; $hidden.='&lt;hidden name="'.$name.'" value="'.$value.'"&gt;';<br />
&nbsp;&nbsp; }<br />
&nbsp; }<br />
&nbsp; return array('action'=&gt;$action,'hidden'=&gt;$hidden);<br />
&nbsp;}<br />
<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82675""></a>
  <div class="note">
   <strong class="user">sean at getclicky dot com</strong>
   <a href="#82675" class="date">21-Apr-2008 06:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This function automatically urldecodes values (not mentioned in the docs).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="79154""></a>
  <div class="note">
   <strong class="user">chris at mcfadyen dot ca</strong>
   <a href="#79154" class="date">14-Nov-2007 01:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I shouldn't've posted the original version, as it only worked with the most basic of query strings.<br />
<br />
This function will parse an html-safe query-like url string for variables and php-like ordered and associative arrays.&nbsp; It places them into the global scope as parse_str does and adds minimal slashes for database insertions without the triple-slash problems that magic quotes can produce (the reason I had to write it in the first place).&nbsp; If you don't need the slashes, they're easy enough to remove.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">parse_query</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Separate all name-value pairs<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$pairs </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">'&amp;'</span><span class="keyword">, </span><span class="default">$str</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; foreach(</span><span class="default">$pairs </span><span class="keyword">as </span><span class="default">$pair</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Pull out the names and the values<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">list(</span><span class="default">$name</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">) = </span><span class="default">explode</span><span class="keyword">(</span><span class="string">'='</span><span class="keyword">, </span><span class="default">$pair</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Decode the variable name and look for arrays<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">list(</span><span class="default">$name</span><span class="keyword">, </span><span class="default">$index</span><span class="keyword">) = </span><span class="default">split</span><span class="keyword">(</span><span class="string">'[][]'</span><span class="keyword">, </span><span class="default">urldecode</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Arrays<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(isset(</span><span class="default">$index</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Declare or add to the global array defined by $name<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">global $</span><span class="default">$name</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(!isset($</span><span class="default">$name</span><span class="keyword">)) $</span><span class="default">$name </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Associative array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">$index </span><span class="keyword">!= </span><span class="string">""</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ${</span><span class="default">$name</span><span class="keyword">}[</span><span class="default">$index</span><span class="keyword">] = </span><span class="default">addslashes</span><span class="keyword">(</span><span class="default">urldecode</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Ordered array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">} else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">array_push</span><span class="keyword">($</span><span class="default">$name</span><span class="keyword">, </span><span class="default">addslashes</span><span class="keyword">(</span><span class="default">urldecode</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">)));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Variables<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">} else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Declare or overwrite the global variable defined by $name<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">global $</span><span class="default">$name</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $</span><span class="default">$name </span><span class="keyword">= </span><span class="default">addslashes</span><span class="keyword">(</span><span class="default">urldecode</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="78882""></a>
  <div class="note">
   <strong class="user">chris at mcfadyen dot ca</strong>
   <a href="#78882" class="date">31-Oct-2007 05:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you wish a version of parse_str sans magic quotes, the following will do the trick:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">parse_query</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$pairs </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">'&amp;'</span><span class="keyword">, </span><span class="default">$str</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; foreach(</span><span class="default">$pairs </span><span class="keyword">as </span><span class="default">$pair</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; list(</span><span class="default">$name</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">) = </span><span class="default">explode</span><span class="keyword">(</span><span class="string">'='</span><span class="keyword">, </span><span class="default">$pair</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; global $</span><span class="default">$name</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $</span><span class="default">$name </span><span class="keyword">= </span><span class="default">$value</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76978""></a>
  <div class="note">
   <strong class="user">kermodebear at kermodebear dot org</strong>
   <a href="#76978" class="date">08-Aug-2007 08:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
An old post from several years ago mentions that variable names cannot have a dot. They also cannot have a space. Spaces are automatically replaced with an underscore.<br />
<br />
The following:<br />
parse_str("My Value=Something", $result);<br />
<br />
Will result in:<br />
$result['My_Value'] = 'Something'<br />
<br />
Although I understand why it is done, I still feel that this is unintuitive behavior.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76792""></a>
  <div class="note">
   <strong class="user">Evan K</strong>
   <a href="#76792" class="date">31-Jul-2007 04:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It bears mentioning that the parse_str builtin does NOT process a query string in the CGI standard way, when it comes to duplicate fields.&nbsp; If multiple fields of the same name exist in a query string, every other web processing language would read them into an array, but PHP silently overwrites them:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment"># silently fails to handle multiple values<br />
</span><span class="default">parse_str</span><span class="keyword">(</span><span class="string">'foo=1&amp;foo=2&amp;foo=3'</span><span class="keyword">);<br />
<br />
</span><span class="comment"># the above produces:<br />
</span><span class="default">$foo </span><span class="keyword">= array(</span><span class="string">'foo' </span><span class="keyword">=&gt; </span><span class="string">'3'</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Instead, PHP uses a non-standards compliant practice of including brackets in fieldnames to achieve the same effect.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment"># bizarre php-specific behavior<br />
</span><span class="default">parse_str</span><span class="keyword">(</span><span class="string">'foo[]=1&amp;foo[]=2&amp;foo[]=3'</span><span class="keyword">);<br />
<br />
</span><span class="comment"># the above produces:<br />
</span><span class="default">$foo </span><span class="keyword">= array(</span><span class="string">'foo' </span><span class="keyword">=&gt; array(</span><span class="string">'1'</span><span class="keyword">, </span><span class="string">'2'</span><span class="keyword">, </span><span class="string">'3'</span><span class="keyword">) );<br />
</span><span class="default">?&gt;<br />
</span><br />
This can be confusing for anyone who's used to the CGI standard, so keep it in mind.&nbsp; As an alternative, I use a "proper" querystring parser function:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">proper_parse_str</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">) {<br />
&nbsp; </span><span class="comment"># result array<br />
&nbsp; </span><span class="default">$arr </span><span class="keyword">= array();<br />
<br />
&nbsp; </span><span class="comment"># split on outer delimiter<br />
&nbsp; </span><span class="default">$pairs </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">'&amp;'</span><span class="keyword">, </span><span class="default">$str</span><span class="keyword">);<br />
<br />
&nbsp; </span><span class="comment"># loop through each pair<br />
&nbsp; </span><span class="keyword">foreach (</span><span class="default">$pairs </span><span class="keyword">as </span><span class="default">$i</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment"># split into name and value<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">list(</span><span class="default">$name</span><span class="keyword">,</span><span class="default">$value</span><span class="keyword">) = </span><span class="default">explode</span><span class="keyword">(</span><span class="string">'='</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment"># if name already exists<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if( isset(</span><span class="default">$arr</span><span class="keyword">[</span><span class="default">$name</span><span class="keyword">]) ) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="comment"># stick multiple values into an array<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="keyword">if( </span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$arr</span><span class="keyword">[</span><span class="default">$name</span><span class="keyword">]) ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$arr</span><span class="keyword">[</span><span class="default">$name</span><span class="keyword">][] = </span><span class="default">$value</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$arr</span><span class="keyword">[</span><span class="default">$name</span><span class="keyword">] = array(</span><span class="default">$arr</span><span class="keyword">[</span><span class="default">$name</span><span class="keyword">], </span><span class="default">$value</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment"># otherwise, simply stick it in a scalar<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">else {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$arr</span><span class="keyword">[</span><span class="default">$name</span><span class="keyword">] = </span><span class="default">$value</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
<br />
&nbsp; </span><span class="comment"># return result array<br />
&nbsp; </span><span class="keyword">return </span><span class="default">$arr</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">$query </span><span class="keyword">= </span><span class="default">proper_parse_str</span><span class="keyword">(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'QUERY_STRING'</span><span class="keyword">]);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76481""></a>
  <div class="note">
   <strong class="user">Vladimir Kornea</strong>
   <a href="#76481" class="date">17-Jul-2007 06:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
parse_str() is confused by ampersands (&amp;) being encoded as HTML entities (&amp;amp;). This is relevant if you're extracting your query string from an HTML page (scraping). The solution is to run the string through html_entity_decode() before running it through parse_str().<br />
<br />
(Editors: my original comment was a caution whose solution is obvious, but it has resulted in three replies ("so what?" "as intended" and "this is how to fix it"). Please remove the previous four posts dealing with this (69529, 70234, 72745, 74818) and leave just the above summary. This issue is too trivial to warrant the number of comments it has received.)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76477""></a>
  <div class="note">
   <strong class="user">Vladimir Kornea</strong>
   <a href="#76477" class="date">17-Jul-2007 05:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
parse_str() contained a bug (#39763) in PHP 5.2.0 that caused it to apply magic quotes twice. This bug was marked as fixed in the release notes of PHP 5.2.1, but there were apparently some issues with getting the fix through CVS on time, as our install of PHP 5.2.1 was still affected by it.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75505""></a>
  <div class="note">
   <strong class="user">mike dot coley at inbox dot com</strong>
   <a href="#75505" class="date">02-Jun-2007 09:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is a little function that does the opposite of the parse_str function. It will take an array and build a query string from it.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">/* Converts an array of parameters into a query string to be appended to a URL.<br />
&nbsp;*<br />
&nbsp;* @return&nbsp; string&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : Query string to append to a URL.<br />
&nbsp;* @param&nbsp;&nbsp; array&nbsp; &nbsp; $array&nbsp; &nbsp;&nbsp; : Array of parameters to append to the query string.<br />
&nbsp;* @param&nbsp;&nbsp; string&nbsp;&nbsp; $parent&nbsp; &nbsp; : This should be left blank (it is used internally by the function).<br />
&nbsp;*/<br />
</span><span class="keyword">function </span><span class="default">append_params</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">, </span><span class="default">$parent</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$params </span><span class="keyword">= array();<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$array </span><span class="keyword">as </span><span class="default">$k </span><span class="keyword">=&gt; </span><span class="default">$v</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$v</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$params</span><span class="keyword">[] = </span><span class="default">append_params</span><span class="keyword">(</span><span class="default">$v</span><span class="keyword">, (empty(</span><span class="default">$parent</span><span class="keyword">) ? </span><span class="default">urlencode</span><span class="keyword">(</span><span class="default">$k</span><span class="keyword">) : </span><span class="default">$parent </span><span class="keyword">. </span><span class="string">'[' </span><span class="keyword">. </span><span class="default">urlencode</span><span class="keyword">(</span><span class="default">$k</span><span class="keyword">) . </span><span class="string">']'</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$params</span><span class="keyword">[] = (!empty(</span><span class="default">$parent</span><span class="keyword">) ? </span><span class="default">$parent </span><span class="keyword">. </span><span class="string">'[' </span><span class="keyword">. </span><span class="default">urlencode</span><span class="keyword">(</span><span class="default">$k</span><span class="keyword">) . </span><span class="string">']' </span><span class="keyword">: </span><span class="default">urlencode</span><span class="keyword">(</span><span class="default">$k</span><span class="keyword">)) . </span><span class="string">'=' </span><span class="keyword">. </span><span class="default">urlencode</span><span class="keyword">(</span><span class="default">$v</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$sessid </span><span class="keyword">= </span><span class="default">session_id</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; if (!empty(</span><span class="default">$parent</span><span class="keyword">) || empty(</span><span class="default">$sessid</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">implode</span><span class="keyword">(</span><span class="string">'&amp;'</span><span class="keyword">, </span><span class="default">$params</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Append the session ID to the query string if we have to.<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$sessname </span><span class="keyword">= </span><span class="default">session_name</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">ini_get</span><span class="keyword">(</span><span class="string">'session.use_cookies'</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">ini_get</span><span class="keyword">(</span><span class="string">'session.use_only_cookies'</span><span class="keyword">) &amp;&amp; (!isset(</span><span class="default">$_COOKIE</span><span class="keyword">[</span><span class="default">$sessname</span><span class="keyword">]) || (</span><span class="default">$_COOKIE</span><span class="keyword">[</span><span class="default">$sessname</span><span class="keyword">] != </span><span class="default">$sessid</span><span class="keyword">)))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$params</span><span class="keyword">[] = </span><span class="default">$sessname </span><span class="keyword">. </span><span class="string">'=' </span><span class="keyword">. </span><span class="default">urlencode</span><span class="keyword">(</span><span class="default">$sessid</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; elseif (!</span><span class="default">ini_get</span><span class="keyword">(</span><span class="string">'session.use_only_cookies'</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$params</span><span class="keyword">[] = </span><span class="default">$sessname </span><span class="keyword">. </span><span class="string">'=' </span><span class="keyword">. </span><span class="default">urlencode</span><span class="keyword">(</span><span class="default">$sessid</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">implode</span><span class="keyword">(</span><span class="string">'&amp;'</span><span class="keyword">, </span><span class="default">$params</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Note that the function will also append the session ID to the query string if it needs to be.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74818""></a>
  <div class="note">
   <strong class="user">Michal Zalewski</strong>
   <a href="#74818" class="date">28-Apr-2007 08:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Vladimir Kornea:<br />
Try use html_entity_decode()<br />
<br />
$str = 'first=value&amp;amp;arr[]=foo+bar&amp;amp;arr[]=baz';<br />
parse_str(html_entity_decode($str), $output);<br />
print_r($output);<br />
<br />
Array<br />
(<br />
&nbsp;&nbsp;&nbsp; [first] =&gt; value<br />
&nbsp;&nbsp;&nbsp; [arr] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [0] =&gt; foo bar<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [1] =&gt; baz<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73719""></a>
  <div class="note">
   <strong class="user">php at voodoolabs dot net</strong>
   <a href="#73719" class="date">07-Mar-2007 09:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is probably a better solution than below. The first line makes sure the file doesn't exist then the second line directs all requests to a script. No need to output a 200 header with this method either.<br />
<br />
RewriteEngine On<br />
<br />
RewriteCond %{REQUEST_FILENAME} !-f<br />
RewriteRule ^ index.php&nbsp; &nbsp; &nbsp; [L]</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73151""></a>
  <div class="note">
   <strong class="user">lenix.de</strong>
   <a href="#73151" class="date">11-Feb-2007 01:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
if you would like to get a nice url scheme with php/apache and and want to handle all requests in a central php script there's a simple solution/hack:<br />
<br />
create a .htaccess in your "basedir" where you've got your main script (in this example index.php) containing some lines like:<br />
<br />
"ErrorDocument 404 /index.php"<br />
<br />
inside index.php you can now do<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; $virtual_path </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'REQUEST_URI'</span><span class="keyword">],<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">strlen</span><span class="keyword">( </span><span class="default">dirname</span><span class="keyword">( </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_SELF'</span><span class="keyword">] ) ) + </span><span class="default">1<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if( (</span><span class="default">$pos </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">( </span><span class="default">$virtual_path</span><span class="keyword">, </span><span class="string">'?' </span><span class="keyword">)) !== </span><span class="default">false </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">parse_str</span><span class="keyword">( </span><span class="default">substr</span><span class="keyword">( </span><span class="default">$virtual_path</span><span class="keyword">, </span><span class="default">$pos </span><span class="keyword">+ </span><span class="default">1 </span><span class="keyword">), </span><span class="default">$_GET </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$_REQUEST </span><span class="keyword">= </span><span class="default">array_merge</span><span class="keyword">( </span><span class="default">$_REQUEST</span><span class="keyword">, </span><span class="default">$_GET </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$virtual_path </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">( </span><span class="default">$virtual_path</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$pos </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// some code checking for a valid location, etc...<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">( </span><span class="string">'HTTP/1.1 200 OK' </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">( </span><span class="string">'Content-Type: text/plain' </span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">$virtual_path</span><span class="keyword">.</span><span class="string">"\n\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">print_r</span><span class="keyword">( </span><span class="default">$_REQUEST </span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
// guido 'lenix' boehm</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="72745""></a>
  <div class="note">
   <strong class="user">jgbreezer at gmail dot com</strong>
   <a href="#72745" class="date">31-Jan-2007 01:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Vladimir Kornea wrote on 8 Sep 2006:<br />
"This function is confused by ampersands (&amp;) being encoded as HTML entities (&amp;amp;)"<br />
<br />
Well, it would be - it's not supposed to be passed html entities, that's a different encoding scheme. This function does correctly decode url encoded params for you though (with the rawurlencode rather than urlencode, ie '+' is translated to a space).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="70234""></a>
  <div class="note">
   <strong class="user">Olivier Mengué</strong>
   <a href="#70234" class="date">07-Oct-2006 11:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Vladimir: the function is OK in how it deals with &amp;amp;.<br />
&amp;amp; must only be used when outputing URLs in HTML/XML data.<br />
You should ask yourself why you have &amp;amp; in your URL when you give it to parse_str.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69529""></a>
  <div class="note">
   <strong class="user">Vladimir Kornea</strong>
   <a href="#69529" class="date">08-Sep-2006 11:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This function is confused by ampersands (&amp;) being encoded as HTML entities (&amp;amp;).<br />
<br />
$str = "first=value&amp;amp;arr[]=foo+bar&amp;amp;arr[]=baz";<br />
parse_str($str, $output);<br />
print_r($output);<br />
<br />
Array<br />
(<br />
&nbsp;&nbsp;&nbsp; [first] =&gt; value<br />
&nbsp;&nbsp;&nbsp; [amp;arr] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [0] =&gt; foo bar<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [1] =&gt; baz<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69254""></a>
  <div class="note">
   <strong class="user">PEPE_RIVAS at repixel dot net</strong>
   <a href="#69254" class="date">29-Aug-2006 03:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
CONVERT ANY FORMATTED STRING INTO VARIABLES<br />
<br />
I developed a online payment solution for credit cards using a merchant, and this merchant returns me an answer of the state of the transaction like this:<br />
<br />
estado=1,txnid=5555444-8454445-4455554,monto=100.00<br />
<br />
to have all that data into variables could be fine for me! so i use str_replace(), the problem is this function recognizes each group of variables with the &amp; character... and i have&nbsp; comma separated values... so i replace comma with &amp;<br />
<br />
<span class="default">&lt;?php<br />
$string </span><span class="keyword">= </span><span class="string">"estado=1,txnid=5555444-8454445-4455554,monto=100.00"</span><span class="keyword">;<br />
</span><span class="default">$string </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">","</span><span class="keyword">,</span><span class="string">"&amp;"</span><span class="keyword">,</span><span class="default">$string</span><span class="keyword">);<br />
</span><span class="default">parse_str</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">);<br />
echo </span><span class="default">$monto</span><span class="keyword">; </span><span class="comment">// outputs 100.00<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="64472""></a>
  <div class="note">
   <strong class="user">motin at demomusic dot nu</strong>
   <a href="#64472" class="date">15-Apr-2006 03:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When you have scripts run through the command-line (like locally via cron), you might want to be able to use _GET and _POST vars. Put this in top of your scheduled task files:<br />
<br />
&lt;?<br />
&nbsp;&nbsp;&nbsp; parse_str ($_SERVER['argv'][1], $GLOBALS['_GET']);<br />
&nbsp;&nbsp;&nbsp; parse_str ($_SERVER['argv'][2], $GLOBALS['_POST']);<br />
?&gt;<br />
<br />
And call your script by:<br />
<br />
/usr/local/bin/php /path/to/script.php "id=45&amp;action=delete" "formsubmitted=true"<br />
<br />
Cheers!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="56475""></a>
  <div class="note">
   <strong class="user">avi at amarcus dot com</strong>
   <a href="#56475" class="date">04-Sep-2005 03:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are trying to preserve a complex array, the function serialize might be better than http_build_query or other methods of making a query string.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="54275""></a>
  <div class="note">
   <strong class="user"></strong>
   <a href="#54275" class="date">29-Jun-2005 02:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As of PHP 5, you can do the exact opposite with http_build_query(). Just remember to use the optional array output parameter.<br />
<br />
This is a very useful combination if you want to re-use a search string url, but also slightly modify it:<br />
<br />
Example:<br />
&lt;?<br />
$url1 = "action=search&amp;interest[]=sports&amp;interest[]=music&amp;sort=id";<br />
$str = parse_str($url1, $output);<br />
<br />
// Modifying criteria:<br />
$output['sort'] = "interest";<br />
<br />
$url2 = http_build_query($output);<br />
<br />
echo "&lt;br&gt;url1: ".$url1;<br />
echo "&lt;br&gt;url2: ".$url2;<br />
?&gt;<br />
<br />
Results in:<br />
url1: action=search&amp;interest[]=sports&amp;interest[]=music&amp;sort=id<br />
url2: action=search&amp;interest[0]=sports&amp;interest[1]=music&amp;sort=interest<br />
<br />
(Array indexes are automatically created.)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="53346""></a>
  <div class="note">
   <strong class="user">kerosuppi</strong>
   <a href="#53346" class="date">29-May-2005 06:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This does not work as expected.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">someclass<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$query_string</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">someclass</span><span class="keyword">(</span><span class="default">$a_query_string</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">query_string </span><span class="keyword">= </span><span class="default">$a_query_string</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">parse_str</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">query_string</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">output</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">action</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">$a_class </span><span class="keyword">= new </span><span class="default">someclass</span><span class="keyword">(</span><span class="string">"action=go"</span><span class="keyword">);<br />
</span><span class="default">$a_class</span><span class="keyword">-&gt;</span><span class="default">output</span><span class="keyword">();<br />
</span><span class="default">?&gt;<br />
</span><br />
Use this instead.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">someclass<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$arr</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">someclass</span><span class="keyword">(</span><span class="default">$a_query_string</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">parse_str</span><span class="keyword">(</span><span class="default">$a_query_string</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">arr</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">output</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">arr</span><span class="keyword">[</span><span class="string">'action'</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">$a_class </span><span class="keyword">= new </span><span class="default">someclass</span><span class="keyword">(</span><span class="string">"action=go"</span><span class="keyword">);<br />
</span><span class="default">$a_class</span><span class="keyword">-&gt;</span><span class="default">output</span><span class="keyword">();<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="53175""></a>
  <div class="note">
   <strong class="user">mortoray at ecircle-ag dot com</strong>
   <a href="#53175" class="date">25-May-2005 09:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In Kent's solution you may wish to switch "urldecode" into "rawurldecode" if you'd like to get rid of the [annoying] plus '+' converted to space ' ' translation.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="52588""></a>
  <div class="note">
   <strong class="user">kent at nospam dot ioflux dot com</strong>
   <a href="#52588" class="date">06-May-2005 05:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You may want to parse the query string into an array. <br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/**<br />
&nbsp;* Similar to parse_str. Returns false if the query string or URL is empty. Because we're not parsing to <br />
&nbsp;* variables but to array key entries, this function will handle ?[]=1&amp;[]=2 "correctly."<br />
&nbsp;*<br />
&nbsp;* @return array Similar to the $_GET formatting that PHP does automagically.<br />
&nbsp;* @param string $url A query string or URL <br />
&nbsp;* @param boolean $qmark Find and strip out everything before the question mark in the string<br />
*/<br />
</span><span class="keyword">function </span><span class="default">parse_query_string</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">, </span><span class="default">$qmark</span><span class="keyword">=</span><span class="default">true</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$qmark</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pos </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">, </span><span class="string">"?"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$pos </span><span class="keyword">!== </span><span class="default">false</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$url </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">, </span><span class="default">$pos </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if (empty(</span><span class="default">$url</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$tokens </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">"&amp;"</span><span class="keyword">, </span><span class="default">$url</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$urlVars </span><span class="keyword">= array();<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$tokens </span><span class="keyword">as </span><span class="default">$token</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$value </span><span class="keyword">= </span><span class="default">string_pair</span><span class="keyword">(</span><span class="default">$token</span><span class="keyword">, </span><span class="string">"="</span><span class="keyword">, </span><span class="string">""</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'/^([^\[]*)(\[.*\])$/'</span><span class="keyword">, </span><span class="default">$token</span><span class="keyword">, </span><span class="default">$matches</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">parse_query_string_array</span><span class="keyword">(</span><span class="default">$urlVars</span><span class="keyword">, </span><span class="default">$matches</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">], </span><span class="default">$matches</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">], </span><span class="default">$value</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$urlVars</span><span class="keyword">[</span><span class="default">urldecode</span><span class="keyword">(</span><span class="default">$token</span><span class="keyword">)] = </span><span class="default">urldecode</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$urlVars</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="comment">/**<br />
&nbsp;* Utility function for parse_query_string. Given a result array, a starting key, and a set of keys formatted like "[a][b][c]" <br />
&nbsp;* and the final value, updates the result array with the correct PHP array keys.<br />
&nbsp;*<br />
&nbsp;* @return void<br />
&nbsp;* @param array $result A result array to populate from the query string<br />
&nbsp;* @param string $k The starting key to populate in $result<br />
&nbsp;* @param string $arrayKeys The key list to parse in the form "[][a][what%20ever]"<br />
&nbsp;* @param string $value The value to place at the destination array key<br />
*/<br />
</span><span class="keyword">function </span><span class="default">parse_query_string_array</span><span class="keyword">(&amp;</span><span class="default">$result</span><span class="keyword">, </span><span class="default">$k</span><span class="keyword">, </span><span class="default">$arrayKeys</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; if (!</span><span class="default">preg_match_all</span><span class="keyword">(</span><span class="string">'/\[([^\]]*)\]/'</span><span class="keyword">, </span><span class="default">$arrayKeys</span><span class="keyword">, </span><span class="default">$matches</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$value</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if (!isset(</span><span class="default">$result</span><span class="keyword">[</span><span class="default">$k</span><span class="keyword">])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result</span><span class="keyword">[</span><span class="default">urldecode</span><span class="keyword">(</span><span class="default">$k</span><span class="keyword">)] = array();<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$temp </span><span class="keyword">=&amp; </span><span class="default">$result</span><span class="keyword">[</span><span class="default">$k</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$last </span><span class="keyword">= </span><span class="default">urldecode</span><span class="keyword">(</span><span class="default">array_pop</span><span class="keyword">(</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]));<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] as </span><span class="default">$k</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$k </span><span class="keyword">= </span><span class="default">urldecode</span><span class="keyword">(</span><span class="default">$k</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$k </span><span class="keyword">=== </span><span class="string">""</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$temp</span><span class="keyword">[] = array();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$temp </span><span class="keyword">=&amp; </span><span class="default">$temp</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$temp</span><span class="keyword">)-</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else if (!isset(</span><span class="default">$temp</span><span class="keyword">[</span><span class="default">$k</span><span class="keyword">])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$temp</span><span class="keyword">[</span><span class="default">$k</span><span class="keyword">] = array();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$temp </span><span class="keyword">=&amp; </span><span class="default">$temp</span><span class="keyword">[</span><span class="default">$k</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$last </span><span class="keyword">=== </span><span class="string">""</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$temp</span><span class="keyword">[] = </span><span class="default">$value</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$temp</span><span class="keyword">[</span><span class="default">urldecode</span><span class="keyword">(</span><span class="default">$last</span><span class="keyword">)] = </span><span class="default">$value</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="comment">/**<br />
* Breaks a string into a pair for a common parsing function. <br />
*<br />
* The string passed in is truncated to the left half of the string pair, if any, and the right half, if anything, is returned.<br />
*<br />
* An example of using this would be:<br />
* &lt;code&gt;<br />
* $path = "Account.Balance";<br />
* $field = string_pair($path);<br />
* <br />
* $path is "Account"<br />
* $field is "Balance"<br />
*<br />
* $path = "Account";<br />
* $field = string_pair($path);<br />
*<br />
* $path is "Account"<br />
* $field is false<br />
* &lt;/code&gt;<br />
*<br />
* @return string The "right" portion of the string is returned if the delimiter is found.<br />
* @param string $a A string to break into a pair. The "left" portion of the string is returned here if the delimiter is found.<br />
* @param string $delim The characters used to delimit a string pair<br />
* @param mixed $default The value to return if the delimiter is not found in the string<br />
* @desc <br />
*/<br />
</span><span class="keyword">function </span><span class="default">string_pair</span><span class="keyword">(&amp;</span><span class="default">$a</span><span class="keyword">, </span><span class="default">$delim</span><span class="keyword">=</span><span class="string">'.'</span><span class="keyword">, </span><span class="default">$default</span><span class="keyword">=</span><span class="default">false</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$n </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">, </span><span class="default">$delim</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$n </span><span class="keyword">=== </span><span class="default">false</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$default</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">, </span><span class="default">$n</span><span class="keyword">+</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$delim</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$a </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$n</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$result</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="46481""></a>
  <div class="note">
   <strong class="user">anatilmizun at gmail dot com</strong>
   <a href="#46481" class="date">13-Oct-2004 01:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I wrote a pair of functions using parse_str() that will write values in an array to a textfile and vice versa, read those values from the textfile back into the array. Quite useful if you need to store lots of data but don't have access to SQL.<br />
<br />
Save the array by calling cfg_save($filename,$array) and load it back using $array=cfg_load($filename)<br />
<br />
<span class="default">&lt;?php<br />
$newline</span><span class="keyword">=</span><span class="string">"?"</span><span class="keyword">;<br />
<br />
function </span><span class="default">cfg_load</span><span class="keyword">(</span><span class="default">$cfgfile</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; global </span><span class="default">$newline</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$setting</span><span class="keyword">=</span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">file_exists</span><span class="keyword">(</span><span class="default">$cfgfile</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$setting</span><span class="keyword">=</span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$cfgfile</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ookk</span><span class="keyword">=</span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while(</span><span class="default">$ook</span><span class="keyword">=</span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$setting</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">#strip comment<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$commt</span><span class="keyword">=</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$ook</span><span class="keyword">,</span><span class="string">"##"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$commt</span><span class="keyword">!==</span><span class="default">false</span><span class="keyword">) </span><span class="default">$ook</span><span class="keyword">=</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$ook</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$commt</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">#append<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">$ook</span><span class="keyword">!=</span><span class="string">""</span><span class="keyword">) </span><span class="default">$ookk</span><span class="keyword">=</span><span class="default">$ookk</span><span class="keyword">.</span><span class="string">"&amp;"</span><span class="keyword">.&nbsp; &nbsp; </span><span class="default">str_replace</span><span class="keyword">(</span><span class="default">$newline</span><span class="keyword">,</span><span class="string">"\n"</span><span class="keyword">,</span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"&amp;"</span><span class="keyword">,</span><span class="string">"%26"</span><span class="keyword">,</span><span class="default">trim</span><span class="keyword">(</span><span class="default">$ook</span><span class="keyword">)));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$setting</span><span class="keyword">);&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">parse_str</span><span class="keyword">(</span><span class="default">$ookk</span><span class="keyword">, </span><span class="default">$setting</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$setting</span><span class="keyword">;<br />
}<br />
<br />
function </span><span class="default">cfg_save</span><span class="keyword">(</span><span class="default">$cfgfile</span><span class="keyword">,</span><span class="default">$setting</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; global </span><span class="default">$intArray</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$intArray</span><span class="keyword">=</span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">2000</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">++)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$intArray</span><span class="keyword">[]=</span><span class="default">$i</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$setting</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$allkeys</span><span class="keyword">=</span><span class="default">array_keys</span><span class="keyword">(</span><span class="default">$setting</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$allkeys </span><span class="keyword">as </span><span class="default">$aKey</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">cfg_recurse</span><span class="keyword">(</span><span class="default">$setting</span><span class="keyword">[</span><span class="default">$aKey</span><span class="keyword">], </span><span class="default">$aKey</span><span class="keyword">, </span><span class="default">$outArray</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$cfgf</span><span class="keyword">=</span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$cfgfile</span><span class="keyword">,</span><span class="string">"w"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; foreach(</span><span class="default">$outArray </span><span class="keyword">as </span><span class="default">$aLine</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$cfgf</span><span class="keyword">,</span><span class="default">stripslashes</span><span class="keyword">(</span><span class="default">$aLine</span><span class="keyword">).</span><span class="string">"\r\n"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$cfgf</span><span class="keyword">);<br />
}<br />
<br />
function </span><span class="default">cfg_recurse</span><span class="keyword">(</span><span class="default">$stuffIn</span><span class="keyword">, </span><span class="default">$keysofar</span><span class="keyword">, &amp;</span><span class="default">$toAppend</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; global </span><span class="default">$intArray</span><span class="keyword">, </span><span class="default">$newline</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$stuffIn</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$allkeys</span><span class="keyword">=</span><span class="default">array_keys</span><span class="keyword">(</span><span class="default">$stuffIn</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">array_slice</span><span class="keyword">(</span><span class="default">$intArray</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">sizeof</span><span class="keyword">(</span><span class="default">$allkeys</span><span class="keyword">))==</span><span class="default">$allkeys</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nokey</span><span class="keyword">=</span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nokey</span><span class="keyword">=</span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$allkeys </span><span class="keyword">as </span><span class="default">$aKey</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(!</span><span class="default">$nokey</span><span class="keyword">) </span><span class="default">$toKey</span><span class="keyword">=</span><span class="default">$aKey</span><span class="keyword">;&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">cfg_recurse</span><span class="keyword">(</span><span class="default">$stuffIn</span><span class="keyword">[</span><span class="default">$aKey</span><span class="keyword">], </span><span class="default">$keysofar</span><span class="keyword">.</span><span class="string">"["</span><span class="keyword">.</span><span class="default">$toKey</span><span class="keyword">.</span><span class="string">"]"</span><span class="keyword">, </span><span class="default">$toAppend</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }else<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$toAppend</span><span class="keyword">[]=</span><span class="default">$keysofar</span><span class="keyword">.</span><span class="string">"="</span><span class="keyword">.</span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"\n"</span><span class="keyword">,</span><span class="default">$newline</span><span class="keyword">,</span><span class="default">$stuffIn</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Note that these functions support nested arrays of unlimited levels ;)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="45493""></a>
  <div class="note">
   <strong class="user">Matt Curtis</strong>
   <a href="#45493" class="date">09-Sep-2004 05:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If the querystring contains duplicate keys in the key-value pairs, parse_str will only return the last instance of the value.&nbsp; For example, in the following:<br />
<br />
<span class="default">&lt;?php<br />
$mystr </span><span class="keyword">= </span><span class="string">"test1=blah&amp;test2=bleh&amp;test1=burp"</span><span class="keyword">;<br />
</span><span class="default">parse_str</span><span class="keyword">(</span><span class="default">$mystr</span><span class="keyword">, </span><span class="default">$myarray</span><span class="keyword">);<br />
echo </span><span class="default">$myarray</span><span class="keyword">[</span><span class="string">'test1'</span><span class="keyword">];<br />
</span><span class="default">?&gt;<br />
</span>The value output will be 'burp'.&nbsp; <br />
<br />
I wrote a function that takes a querystring and returns the the key-value pairs as a two-dimensional array so each duplicate key is available:<br />
<br />
<span class="default">&lt;?php<br />
$str </span><span class="keyword">= </span><span class="string">"test1=blah&amp;test2=bleh&amp;test1=burp"</span><span class="keyword">;<br />
</span><span class="default">$valsarray </span><span class="keyword">= </span><span class="default">parse_str_ext</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">);<br />
echo </span><span class="default">$valsarray</span><span class="keyword">[</span><span class="string">'test1'</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">];<br />
echo </span><span class="default">$valsarray</span><span class="keyword">[</span><span class="string">'test1'</span><span class="keyword">][</span><span class="default">1</span><span class="keyword">];<br />
echo </span><span class="default">$valsarray</span><span class="keyword">[</span><span class="string">'test2'</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">];<br />
<br />
function </span><span class="default">parse_str_ext</span><span class="keyword">(</span><span class="default">$toparse</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$returnarray </span><span class="keyword">= array();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$keyvaluepairs </span><span class="keyword">= </span><span class="default">split</span><span class="keyword">(</span><span class="string">"&amp;"</span><span class="keyword">, </span><span class="default">$toparse</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; foreach(</span><span class="default">$keyvaluepairs </span><span class="keyword">as </span><span class="default">$pairval</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$splitpair </span><span class="keyword">= </span><span class="default">split</span><span class="keyword">(</span><span class="string">"="</span><span class="keyword">, </span><span class="default">$pairval</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(!</span><span class="default">array_key_exists</span><span class="keyword">(</span><span class="default">$splitpair</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="default">$returnarray</span><span class="keyword">)) </span><span class="default">$returnarray</span><span class="keyword">[</span><span class="default">$splitpair</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]] = array();<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$returnarray</span><span class="keyword">[</span><span class="default">$splitpair</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]][] = </span><span class="default">$splitpair</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$returnarray</span><span class="keyword">;&nbsp; &nbsp; <br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Output will be:<br />
blah<br />
burp<br />
bleh</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="43317""></a>
  <div class="note">
   
   <a href="#43317" class="date">17-Jun-2004 02:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that variables cannot contain a DOT (.) in PHP. So, DOT will be replaced by underscore. <br />
e.g. variables like "variable.something" will be converted into "variable_something".</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="41143""></a>
  <div class="note">
   
   <a href="#41143" class="date">31-Mar-2004 07:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The documentation does not appear to mention that parse_str also urldecodes each item in the resulting array.<br />
<br />
There also appears to be a bug in earlier versions of PHP that causes these urldecoded strings to also be escaped.&nbsp; (Certainly I was having problems with %22 being turned into /" on my server, but not on my development box, despite forcing magic quotes off).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
