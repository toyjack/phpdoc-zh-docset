<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>打开一个网络连接或者一个Unix套接字连接</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.dns-get-record.html">? dns_get_record</a></li>
      <li style="float: right;"><a href="function.gethostbyaddr.html">gethostbyaddr ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.network.html">网络 函数</a></li>
    <li>打开一个网络连接或者一个Unix套接字连接</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.fsockopen" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">fsockopen</h1>
  <p class="verinfo">(PHP 4, PHP 5)</p><p class="refpurpose"><span class="refname">fsockopen</span> &mdash; <span class="dc-title">打开一个网络连接或者一个Unix套接字连接</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.fsockopen-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">resource</span> <span class="methodname"><strong>fsockopen</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$hostname</code></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$port</code><span class="initializer"> = -1</span></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter reference">&$errno</code></span>
   [, <span class="methodparam"><span class="type">string</span> <code class="parameter reference">&$errstr</code></span>
   [, <span class="methodparam"><span class="type">float</span> <code class="parameter">$timeout</code><span class="initializer"> = ini_get(&quot;default_socket_timeout&quot;)</span></span>
  ]]]] )</div>

  <p class="para rdfs-comment">
   初始化一个套接字连接到指定主机（<code class="parameter">hostname</code>）。
  </p>
  <p class="para">
   PHP支持以下的套接字传输器类型列表
   <a href="transports.html" class="xref">所支持的套接字传输器（Socket Transports）列表</a>。也可以通过<span class="function"><a href="function.stream-get-transports.html" class="function">stream_get_transports()</a></span>来获取套接字传输器支持类型。
  </p>
  <p class="para">
   默认情况下将以阻塞模式开启套接字连接。当然你可以通过<span class="function"><a href="function.stream-set-blocking.html" class="function">stream_set_blocking()</a></span>将它转换到非阻塞模式。
  </p>
  <p class="para"><span class="function"><a href="function.stream-socket-client.html" class="function">stream_socket_client()</a></span>与之非常相似，而且提供了更加丰富的参数设置，包括非阻塞模式和提供上下文的的设置。
  </p>
 </div>

 <div class="refsect1 parameters" id="refsect1-function.fsockopen-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">hostname</code></dt>

     <dd>

      <p class="para">
       如果安装了<a href="openssl.installation.html" class="link">OpenSSL</a>，那么你也许应该在你的主机名地址前面添加访问协议<em>ssl://</em>或者是<em>tls://</em>，从而可以使用基于TCP/IP协议的SSL或者TLS的客户端连接到远程主机。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">port</code></dt>

     <dd>

      <p class="para">
       端口号。如果对该参数传一个-1，则表示不使用端口，例如<em>unix://</em>。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">errno</code></dt>

     <dd>

      <p class="para">
       如果传入了该参数，holds the system level error number that occurred in the
       system-level <em>connect()</em> call。
      </p>
      <p class="para">
       如果<code class="parameter">errno</code>的返回值为<em>0</em>，而且这个函数的返回值为<strong><code>FALSE</code></strong>，那么这表明该错误发生在套接字连接（<em>connect()</em>）调用之前，导致连接失败的原因最大的可能是初始化套接字的时候发生了错误。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">errstr</code></dt>

     <dd>

      <p class="para">
       错误信息将以字符串的信息返回。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">timeout</code></dt>

     <dd>

      <p class="para">
       设置连接的时限，单位为秒。
      </p>
      <blockquote class="note"><p><strong class="note">Note</strong>: 
       <p class="para">
        注意：如果你要对建立在套接字基础上的读写操作设置操作时间设置连接时限，请使用<span class="function"><a href="function.stream-set-timeout.html" class="function">stream_set_timeout()</a></span>，<span class="function"><strong>fsockopen()</strong></span>的连接时限（<code class="parameter">timeout</code>）的参数仅仅在套接字连接的时候生效。
       </p>
      </p></blockquote>
     </dd>

    
   </dl>

  </p>
 </div>

 <div class="refsect1 returnvalues" id="refsect1-function.fsockopen-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   <span class="function"><strong>fsockopen()</strong></span>将返回一个文件句柄，之后可以被其他文件类函数调用（例如：<span class="function"><a href="function.fgets.html" class="function">fgets()</a></span>，<span class="function"><a href="function.fgetss.html" class="function">fgetss()</a></span>，<span class="function"><a href="function.fwrite.html" class="function">fwrite()</a></span>，<span class="function"><a href="function.fclose.html" class="function">fclose()</a></span>还有<span class="function"><a href="function.feof.html" class="function">feof()</a></span>）。如果调用失败，将返回<strong><code>FALSE</code></strong>。
  </p>
 </div>

 <div class="refsect1 errors" id="refsect1-function.fsockopen-errors">
  <h3 class="title">错误／异常</h3>
  <p class="para">
   如果主机（<code class="parameter">hostname</code>）不可访问，将会抛出一个警告级别（<strong><code>E_WARNING</code></strong>）的错误提示。
  </p>
 </div>

 <div class="refsect1 changelog" id="refsect1-function.fsockopen-changelog">
  <h3 class="title">更新日志</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead>
      <tr>
       <th>版本</th>
       <th>说明</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
       <td>4.3.0</td>
       <td>
        在win32系统上增加了对时限设置（<code class="parameter">timeout</code>）参数的支持。
       </td>
      </tr>

      <tr>
       <td>4.3.0</td>
       <td>
        在TCP/IP协议的基础上增加了SSL和TLS。
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>

 <div class="refsect1 examples" id="refsect1-function.fsockopen-examples">
  <h3 class="title">范例</h3>
  <p class="para">
   <div class="example" id="example-4479">
    <p><strong>Example #1 <span class="function"><strong>fsockopen()</strong></span>的例子</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$fp&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">fsockopen</span><span style="color: #007700">(</span><span style="color: #DD0000">"www.example.com"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">80</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$errno</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$errstr</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">30</span><span style="color: #007700">);<br />if&nbsp;(!</span><span style="color: #0000BB">$fp</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"</span><span style="color: #0000BB">$errstr</span><span style="color: #DD0000">&nbsp;(</span><span style="color: #0000BB">$errno</span><span style="color: #DD0000">)&lt;br&nbsp;/&gt;\n"</span><span style="color: #007700">;<br />}&nbsp;else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$out&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"GET&nbsp;/&nbsp;HTTP/1.1\r\n"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$out&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #DD0000">"Host:&nbsp;www.example.com\r\n"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$out&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #DD0000">"Connection:&nbsp;Close\r\n\r\n"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">fwrite</span><span style="color: #007700">(</span><span style="color: #0000BB">$fp</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$out</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;(!</span><span style="color: #0000BB">feof</span><span style="color: #007700">(</span><span style="color: #0000BB">$fp</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">fgets</span><span style="color: #007700">(</span><span style="color: #0000BB">$fp</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">128</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">fclose</span><span style="color: #007700">(</span><span style="color: #0000BB">$fp</span><span style="color: #007700">);<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
  <p class="para">
   <div class="example" id="example-4480">
    <p><strong>Example #2 使用UDP连接</strong></p>
    <div class="example-contents"><p>
     下面这个例子展示了怎么样在自己的机器上通过UDP套接字连接（端口号13）来检索日期和时间。
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$fp&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">fsockopen</span><span style="color: #007700">(</span><span style="color: #DD0000">"udp://127.0.0.1"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">13</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$errno</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$errstr</span><span style="color: #007700">);<br />if&nbsp;(!</span><span style="color: #0000BB">$fp</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"ERROR:&nbsp;</span><span style="color: #0000BB">$errno</span><span style="color: #DD0000">&nbsp;-&nbsp;</span><span style="color: #0000BB">$errstr</span><span style="color: #DD0000">&lt;br&nbsp;/&gt;\n"</span><span style="color: #007700">;<br />}&nbsp;else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">fwrite</span><span style="color: #007700">(</span><span style="color: #0000BB">$fp</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">fread</span><span style="color: #007700">(</span><span style="color: #0000BB">$fp</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">26</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">fclose</span><span style="color: #007700">(</span><span style="color: #0000BB">$fp</span><span style="color: #007700">);<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>

 <div class="refsect1 notes" id="refsect1-function.fsockopen-notes">
  <h3 class="title">注释</h3>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    因为环境的不同，某些情况下在Unix套接字连接或者自定义的连接设置连接时限（<code class="parameter">timeout</code>）可能不会生效。
   </p>
  </p></blockquote>
  <div class="warning"><strong class="warning">Warning</strong>
   <p class="para">
    UDP套接字有些时候在即使远程主机未知的情况，也能打开，并且不发生任何错误。只有当你通过该套接字进行读写的时候才会发现错误。之所以会这样，是因为UDP是一个"非连接状态"的协议，那么这就意味着当前操作系统直到它（套接字）真正需要发送和接受数据的时候才会去尝试为其去建立连接。
   </p>
  </div>
  <blockquote class="note"><p><strong class="note">Note</strong>: <span class="simpara">当指定数值型的 IPv6
地址（例如 <em>fe80::1</em>）时必须用方括号将 IP 围起来&mdash;&mdash;例如，
<em>tcp://[fe80::1]:80</em>。</span></p></blockquote>
 </div>

 <div class="refsect1 seealso" id="refsect1-function.fsockopen-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.pfsockopen.html" class="function" rel="rdfs-seeAlso">pfsockopen()</a> - 打开一个持久的网络连接或者Unix套接字连接。</span></li>
    <li class="member"><span class="function"><a href="function.stream-socket-client.html" class="function" rel="rdfs-seeAlso">stream_socket_client()</a> - Open Internet or Unix domain socket connection</span></li>
    <li class="member"><span class="function"><a href="function.stream-set-blocking.html" class="function" rel="rdfs-seeAlso">stream_set_blocking()</a> - 为资源流设置阻塞或者阻塞模式</span></li>
    <li class="member"><span class="function"><a href="function.stream-set-timeout.html" class="function" rel="rdfs-seeAlso">stream_set_timeout()</a> - Set timeout period on a stream</span></li>
    <li class="member"><span class="function"><a href="function.fgets.html" class="function" rel="rdfs-seeAlso">fgets()</a> - 从文件指针中读取一行</span></li>
    <li class="member"><span class="function"><a href="function.fgetss.html" class="function" rel="rdfs-seeAlso">fgetss()</a> - 从文件指针中读取一行并过滤掉 HTML 标记</span></li>
    <li class="member"><span class="function"><a href="function.fwrite.html" class="function" rel="rdfs-seeAlso">fwrite()</a> - 写入文件（可安全用于二进制文件）</span></li>
    <li class="member"><span class="function"><a href="function.fclose.html" class="function" rel="rdfs-seeAlso">fclose()</a> - 关闭一个已打开的文件指针</span></li>
    <li class="member"><span class="function"><a href="function.feof.html" class="function" rel="rdfs-seeAlso">feof()</a> - 测试文件指针是否到了文件结束的位置</span></li>
    <li class="member"><span class="function"><a href="function.socket-connect.html" class="function" rel="rdfs-seeAlso">socket_connect()</a> - 开启一个套接字连接</span></li>
    <li class="member">The <a href="ref.curl.html" class="link">Curl extension</a></li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="115405""></a>
  <div class="note">
   <strong class="user">p14nd4</strong>
   <a href="#115405" class="date">19-Jul-2014 06:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It appears that in PHP 5.6.0 (at least the version in Debian jessie, with openssl 1.0.1h-3), this function *is* now validating SSL certificates (in a variety of ways). First, it appears to fail for untrusted certificates (i.e. no matching CA trusted locally), and secondly, it appears to fail for mismatched hostnames in the request and certificate.<br />
<br />
---------<br />
$ echo "<span class="default">&lt;?php </span><span class="keyword">echo </span><span class="default">fsockopen</span><span class="keyword">(\</span><span class="string">"ssl://localhost\", 993); ?&gt;" </span><span class="keyword">| </span><span class="default">php </span><span class="keyword">-</span><span class="default">a<br />
Interactive mode enabled<br />
<br />
PHP Warning</span><span class="keyword">:&nbsp; </span><span class="default">fsockopen</span><span class="keyword">(): </span><span class="default">Peer certificate CN</span><span class="keyword">=`</span><span class="string">my.test.server' did not match expected CN=</span><span class="keyword">`</span><span class="default">localhost</span><span class="string">' in - on line 1<br />
PHP Warning:&nbsp; fsockopen(): Failed to enable crypto in - on line 1<br />
PHP Warning:&nbsp; fsockopen(): unable to connect to ssl://localhost:993 (Unknown error) in - on line 1<br />
----------<br />
$ echo "&lt;?php echo fsockopen(\"ssl://my.test.server\", 993); ?&gt;" | php -a<br />
Interactive mode enabled<br />
<br />
PHP Warning:&nbsp; fsockopen(): SSL operation failed with code 1. OpenSSL Error messages:<br />
error:14090086:SSL routines:SSL3_GET_SERVER_CERTIFICATE:certificate verify failed in - on line 1<br />
PHP Warning:&nbsp; fsockopen(): Failed to enable crypto in - on line 1<br />
PHP Warning:&nbsp; fsockopen(): unable to connect to ssl://my.test.server:993 (Unknown error) in - on line 1<br />
---------<br />
#installed CA locally<br />
---------<br />
$ echo "&lt;?php echo fsockopen(\"ssl://my.test.server\", 993); ?&gt;" | php -a<br />
Interactive mode enabled<br />
<br />
Resource id #1</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="114657""></a>
  <div class="note">
   <strong class="user">biguenique at yahoo dot ca</strong>
   <a href="#114657" class="date">19-Mar-2014 01:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Did you know that fsockopen() DOES NOT validate SSL certificates whatsoever? For the sake of World's overall security level, I guess it would be a very positive idea to add a BIG WARNING notice on the manual page!<br />
<br />
Citing the extensive study&nbsp; titled "The Most Dangerous Code in the World: Validating SSL Certi?cates in Non-Browser Software" published in 2012 (google it if they removed the link) on page 5:<br />
<br />
"PHP provides several methods for establishing SSL connections. For example, fsockopen, which opens a raw socket to the remote server, can be used to connect to SSL servers by putting "ssl://" in the URL. Even though fsockopen does not perform any certificate checks whatsoever, PHP application developers routinely use it for SSL connection establishment (see Section 9)."<br />
<br />
For proper certificate validation with some level of ease, you can always move to cURL, but be careful:<br />
<br />
"PHP also provides a cURL binding, which uses cURL's default settings to establish SSL connections with proper certificate validation. As we show in Sections 7.1, 7.2, and 7.3, application developers often set cURL options incorrectly, overriding the defaults and breaking certificate validation."<br />
<br />
For more detailed insights, try out the following code:<br />
<span class="default">&lt;?php readfile</span><span class="keyword">(</span><span class="string">"http"</span><span class="keyword">.</span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'+'</span><span class="keyword">, </span><span class="string">'.'</span><span class="keyword">, </span><span class="default">implode</span><span class="keyword">(</span><span class="string">'/'</span><span class="keyword">, array(</span><span class="string">":"</span><span class="keyword">, </span><span class="default">null</span><span class="keyword">, </span><span class="string">"www+cs+utexas+edu"</span><span class="keyword">, </span><span class="string">"~shmat"</span><span class="keyword">, </span><span class="string">"shmat_ccs12.pdf"</span><span class="keyword">)))); </span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="112063""></a>
  <div class="note">
   <strong class="user">Charles Torvalds</strong>
   <a href="#112063" class="date">29-Apr-2013 02:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Rewrite/Update of king dot macro's DNS lookups function.<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">gethostbyaddr_timeout</span><span class="keyword">( </span><span class="default">$ip</span><span class="keyword">, </span><span class="default">$dns</span><span class="keyword">, </span><span class="default">$timeout </span><span class="keyword">= </span><span class="default">3 </span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// src: <a href="http://www.askapache.com/php/php-fsockopen-dns-udp.html" rel="nofollow" target="_blank">http://www.askapache.com/php/php-fsockopen-dns-udp.html</a><br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; // random transaction number (for routers etc to get the reply back)<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">rand</span><span class="keyword">( </span><span class="default">10</span><span class="keyword">, </span><span class="default">77 </span><span class="keyword">) . </span><span class="string">"\1\0\0\1\0\0\0\0\0\0"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// octals in the array, keys are strlen of bit<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$bitso </span><span class="keyword">= array(</span><span class="string">""</span><span class="keyword">,</span><span class="string">"\1"</span><span class="keyword">,</span><span class="string">"\2"</span><span class="keyword">,</span><span class="string">"\3" </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; foreach( </span><span class="default">array_reverse</span><span class="keyword">( </span><span class="default">explode</span><span class="keyword">( </span><span class="string">'.'</span><span class="keyword">, </span><span class="default">$ip </span><span class="keyword">) ) as </span><span class="default">$bit </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$l</span><span class="keyword">=</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$bit</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$data</span><span class="keyword">.=</span><span class="string">"</span><span class="keyword">{</span><span class="default">$bitso</span><span class="keyword">[</span><span class="default">$l</span><span class="keyword">]}</span><span class="string">"</span><span class="keyword">.</span><span class="default">$bit</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// and the final bit of the request<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">.= </span><span class="string">"\7in-addr\4arpa\0\0\x0C\0\1"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// create UDP socket<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$errno </span><span class="keyword">= </span><span class="default">$errstr </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">( </span><span class="string">"udp://</span><span class="keyword">{</span><span class="default">$dns</span><span class="keyword">}</span><span class="string">"</span><span class="keyword">, </span><span class="default">53</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">$timeout </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if( ! </span><span class="default">$fp </span><span class="keyword">|| ! </span><span class="default">is_resource</span><span class="keyword">( </span><span class="default">$fp </span><span class="keyword">) )<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$errno</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; if( </span><span class="default">function_exists</span><span class="keyword">( </span><span class="string">'socket_set_timeout' </span><span class="keyword">) ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">socket_set_timeout</span><span class="keyword">( </span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$timeout </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; } elseif ( </span><span class="default">function_exists</span><span class="keyword">( </span><span class="string">'stream_set_timeout' </span><span class="keyword">) ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">stream_set_timeout</span><span class="keyword">( </span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$timeout </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// send our request (and store request size so we can cheat later)<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$requestsize </span><span class="keyword">= </span><span class="default">fwrite</span><span class="keyword">( </span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$data </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$max_rx </span><span class="keyword">= </span><span class="default">$requestsize </span><span class="keyword">* </span><span class="default">3</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$start </span><span class="keyword">= </span><span class="default">time</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$responsesize </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; while ( </span><span class="default">$rxed </span><span class="keyword">&lt; </span><span class="default">$max_rx </span><span class="keyword">&amp;&amp; ( ( </span><span class="default">time</span><span class="keyword">() - </span><span class="default">$start </span><span class="keyword">) &lt; </span><span class="default">$timeout </span><span class="keyword">) &amp;&amp; (</span><span class="default">$b </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">( </span><span class="default">$fp</span><span class="keyword">, </span><span class="default">1 </span><span class="keyword">) ) !== </span><span class="default">false </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$responsesize</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$response </span><span class="keyword">.= </span><span class="default">$b</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"[tx: </span><span class="default">$requestsize</span><span class="string"> bytes]&nbsp; [rx: </span><span class="keyword">{</span><span class="default">$responsesize</span><span class="keyword">}</span><span class="string"> bytes]"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// hope we get a reply<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if ( </span><span class="default">is_resource</span><span class="keyword">( </span><span class="default">$fp </span><span class="keyword">) )<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">( </span><span class="default">$fp </span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// if empty response or bad response, return original ip<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if ( empty( </span><span class="default">$response </span><span class="keyword">) || </span><span class="default">bin2hex</span><span class="keyword">( </span><span class="default">substr</span><span class="keyword">( </span><span class="default">$response</span><span class="keyword">, </span><span class="default">$requestsize </span><span class="keyword">+ </span><span class="default">2</span><span class="keyword">, </span><span class="default">2 </span><span class="keyword">) ) != </span><span class="string">'000c' </span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$ip</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// set up our variables<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$host </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$len </span><span class="keyword">= </span><span class="default">$loops </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// set our pointer at the beginning of the hostname uses the request size from earlier rather than work it out<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$pos </span><span class="keyword">= </span><span class="default">$requestsize </span><span class="keyword">+ </span><span class="default">12</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; do {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// get segment size<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$len </span><span class="keyword">= </span><span class="default">unpack</span><span class="keyword">( </span><span class="string">'c'</span><span class="keyword">, </span><span class="default">substr</span><span class="keyword">( </span><span class="default">$response</span><span class="keyword">, </span><span class="default">$pos</span><span class="keyword">, </span><span class="default">1 </span><span class="keyword">) );<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// null terminated string, so length 0 = finished - return the hostname, without the trailing .<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if ( </span><span class="default">$len</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] == </span><span class="default">0 </span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">substr</span><span class="keyword">( </span><span class="default">$host</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, -</span><span class="default">1 </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// add segment to our host<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$host </span><span class="keyword">.= </span><span class="default">substr</span><span class="keyword">( </span><span class="default">$response</span><span class="keyword">, </span><span class="default">$pos </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">, </span><span class="default">$len</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] ) . </span><span class="string">'.'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// move pointer on to the next segment<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pos </span><span class="keyword">+= </span><span class="default">$len</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] + </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// recursion protection<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$loops</span><span class="keyword">++;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; while ( </span><span class="default">$len</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] != </span><span class="default">0 </span><span class="keyword">&amp;&amp; </span><span class="default">$loops </span><span class="keyword">&lt; </span><span class="default">20 </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// return the ip in case <br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">$ip</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="107020""></a>
  <div class="note">
   <strong class="user">kexianbin at diyism dot com</strong>
   <a href="#107020" class="date">29-Dec-2011 05:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
My recursive unchunk function:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">unchunk</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; {return </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/([0-9A-F]+)\r\n(.*)/sie'</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'($cnt=@base_convert("\1", 16, 10))
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ?substr(($str=@strtr(\'\2\', array(\'\"\'=&gt;\'"\', \'\\\\0\'=&gt;"\x00"))), 0, $cnt).unchunk(substr($str, $cnt+2))
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; :""
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; '</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; }
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="101872""></a>
  <div class="note">
   <strong class="user">Jeremy Saintot</strong>
   <a href="#101872" class="date">15-Jan-2011 01:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is my fsockopen-based HTTP request fonction (GET and POST) :
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">http_request</span><span class="keyword">(
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$verb </span><span class="keyword">= </span><span class="string">'GET'</span><span class="keyword">,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/* HTTP Request Method (GET and POST supported) */
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ip</span><span class="keyword">,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/* Target IP/Hostname */
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$port </span><span class="keyword">= </span><span class="default">80</span><span class="keyword">,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">/* Target TCP port */
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$uri </span><span class="keyword">= </span><span class="string">'/'</span><span class="keyword">,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">/* Target URI */
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$getdata </span><span class="keyword">= array(),&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">/* HTTP GET Data ie. array('var1' =&gt; 'val1', 'var2' =&gt; 'val2') */
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$postdata </span><span class="keyword">= array(),&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/* HTTP POST Data ie. array('var1' =&gt; 'val1', 'var2' =&gt; 'val2') */
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$cookie </span><span class="keyword">= array(),&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/* HTTP Cookie Data ie. array('var1' =&gt; 'val1', 'var2' =&gt; 'val2') */
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$custom_headers </span><span class="keyword">= array(), </span><span class="comment">/* Custom HTTP headers ie. array('Referer: <a href="http://localhost/ */" rel="nofollow" target="_blank">http://localhost/ */</a>
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$timeout </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/* Socket timeout in seconds */
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$req_hdr </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">/* Include HTTP request headers */
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$res_hdr </span><span class="keyword">= </span><span class="default">false&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/* Include HTTP response headers */
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">)
<br />
{
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ret </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$verb </span><span class="keyword">= </span><span class="default">strtoupper</span><span class="keyword">(</span><span class="default">$verb</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$cookie_str </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$getdata_str </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$getdata</span><span class="keyword">) ? </span><span class="string">'?' </span><span class="keyword">: </span><span class="string">''</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$postdata_str </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$getdata </span><span class="keyword">as </span><span class="default">$k </span><span class="keyword">=&gt; </span><span class="default">$v</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$getdata_str </span><span class="keyword">.= </span><span class="default">urlencode</span><span class="keyword">(</span><span class="default">$k</span><span class="keyword">) .</span><span class="string">'='</span><span class="keyword">. </span><span class="default">urlencode</span><span class="keyword">(</span><span class="default">$v</span><span class="keyword">) . </span><span class="string">'&amp;'</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$postdata </span><span class="keyword">as </span><span class="default">$k </span><span class="keyword">=&gt; </span><span class="default">$v</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$postdata_str </span><span class="keyword">.= </span><span class="default">urlencode</span><span class="keyword">(</span><span class="default">$k</span><span class="keyword">) .</span><span class="string">'='</span><span class="keyword">. </span><span class="default">urlencode</span><span class="keyword">(</span><span class="default">$v</span><span class="keyword">) .</span><span class="string">'&amp;'</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$cookie </span><span class="keyword">as </span><span class="default">$k </span><span class="keyword">=&gt; </span><span class="default">$v</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$cookie_str </span><span class="keyword">.= </span><span class="default">urlencode</span><span class="keyword">(</span><span class="default">$k</span><span class="keyword">) .</span><span class="string">'='</span><span class="keyword">. </span><span class="default">urlencode</span><span class="keyword">(</span><span class="default">$v</span><span class="keyword">) .</span><span class="string">'; '</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$crlf </span><span class="keyword">= </span><span class="string">"\r\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$req </span><span class="keyword">= </span><span class="default">$verb </span><span class="keyword">.</span><span class="string">' '</span><span class="keyword">. </span><span class="default">$uri </span><span class="keyword">. </span><span class="default">$getdata_str </span><span class="keyword">.</span><span class="string">' HTTP/1.1' </span><span class="keyword">. </span><span class="default">$crlf</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$req </span><span class="keyword">.= </span><span class="string">'Host: '</span><span class="keyword">. </span><span class="default">$ip </span><span class="keyword">. </span><span class="default">$crlf</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$req </span><span class="keyword">.= </span><span class="string">'User-Agent: Mozilla/5.0 Firefox/3.6.12' </span><span class="keyword">. </span><span class="default">$crlf</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$req </span><span class="keyword">.= </span><span class="string">'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8' </span><span class="keyword">. </span><span class="default">$crlf</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$req </span><span class="keyword">.= </span><span class="string">'Accept-Language: en-us,en;q=0.5' </span><span class="keyword">. </span><span class="default">$crlf</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$req </span><span class="keyword">.= </span><span class="string">'Accept-Encoding: deflate' </span><span class="keyword">. </span><span class="default">$crlf</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$req </span><span class="keyword">.= </span><span class="string">'Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7' </span><span class="keyword">. </span><span class="default">$crlf</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$custom_headers </span><span class="keyword">as </span><span class="default">$k </span><span class="keyword">=&gt; </span><span class="default">$v</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$req </span><span class="keyword">.= </span><span class="default">$k </span><span class="keyword">.</span><span class="string">': '</span><span class="keyword">. </span><span class="default">$v </span><span class="keyword">. </span><span class="default">$crlf</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; if (!empty(</span><span class="default">$cookie_str</span><span class="keyword">))
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$req </span><span class="keyword">.= </span><span class="string">'Cookie: '</span><span class="keyword">. </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$cookie_str</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, -</span><span class="default">2</span><span class="keyword">) . </span><span class="default">$crlf</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$verb </span><span class="keyword">== </span><span class="string">'POST' </span><span class="keyword">&amp;&amp; !empty(</span><span class="default">$postdata_str</span><span class="keyword">))
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$postdata_str </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$postdata_str</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, -</span><span class="default">1</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$req </span><span class="keyword">.= </span><span class="string">'Content-Type: application/x-www-form-urlencoded' </span><span class="keyword">. </span><span class="default">$crlf</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$req </span><span class="keyword">.= </span><span class="string">'Content-Length: '</span><span class="keyword">. </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$postdata_str</span><span class="keyword">) . </span><span class="default">$crlf </span><span class="keyword">. </span><span class="default">$crlf</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$req </span><span class="keyword">.= </span><span class="default">$postdata_str</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; else </span><span class="default">$req </span><span class="keyword">.= </span><span class="default">$crlf</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$req_hdr</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ret </span><span class="keyword">.= </span><span class="default">$req</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; if ((</span><span class="default">$fp </span><span class="keyword">= @</span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">)) == </span><span class="default">false</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">"Error </span><span class="default">$errno</span><span class="string">: </span><span class="default">$errstr</span><span class="string">\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">stream_set_timeout</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$timeout </span><span class="keyword">* </span><span class="default">1000</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$req</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; while (</span><span class="default">$line </span><span class="keyword">= </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">)) </span><span class="default">$ret </span><span class="keyword">.= </span><span class="default">$line</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; if (!</span><span class="default">$res_hdr</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ret </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$ret</span><span class="keyword">, </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$ret</span><span class="keyword">, </span><span class="string">"\r\n\r\n"</span><span class="keyword">) + </span><span class="default">4</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$ret</span><span class="keyword">;
<br />
}
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Example usages :
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">echo </span><span class="default">http_request</span><span class="keyword">(</span><span class="string">'GET'</span><span class="keyword">, </span><span class="string">'www.php.net'</span><span class="keyword">);
<br />
echo </span><span class="default">http_request</span><span class="keyword">(</span><span class="string">'GET'</span><span class="keyword">, </span><span class="string">'www.php.net'</span><span class="keyword">, </span><span class="default">80</span><span class="keyword">, </span><span class="string">'/manual/en/function.phpinfo.php'</span><span class="keyword">);
<br />
echo </span><span class="default">http_request</span><span class="keyword">(</span><span class="string">'GET'</span><span class="keyword">, </span><span class="string">'www.php.net'</span><span class="keyword">, </span><span class="default">80</span><span class="keyword">, </span><span class="string">'/manual/en/function.phpinfo.php'</span><span class="keyword">, array(</span><span class="string">'get1' </span><span class="keyword">=&gt; </span><span class="string">'v_get1'</span><span class="keyword">), array(), array(</span><span class="string">'cookie1' </span><span class="keyword">=&gt; </span><span class="string">'v_cookie1'</span><span class="keyword">), array(</span><span class="string">'X-My-Header' </span><span class="keyword">=&gt; </span><span class="string">'My Value'</span><span class="keyword">));
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
[EDIT BY danbrown AT php DOT net: Contains a bugfix provided by "Wrinkled Cheese" on 24-JUN-2011 to fix the $getdata foreach() loop; another bugfix provided by Suat Secmen on 12-JAN-2012 to fix a $timeout = 1000, then stream_set_timeout($fp, 0, $timeout * 1000), equaling 1,000 seconds.]</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99689""></a>
  <div class="note">
   <strong class="user">gratcypalma at gmail dot com</strong>
   <a href="#99689" class="date">31-Aug-2010 05:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
</span><span class="comment">/*<br />
this script i used for remote my PvPGN Server, to check email user.<br />
not good, but it work.<br />
*/<br />
<br />
</span><span class="default">set_time_limit</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">); <br />
</span><span class="default">$host&nbsp;&nbsp; </span><span class="keyword">= </span><span class="string">'host'</span><span class="keyword">;<br />
</span><span class="default">$port&nbsp;&nbsp; </span><span class="keyword">= </span><span class="string">'port'</span><span class="keyword">;<br />
</span><span class="default">$user&nbsp;&nbsp; </span><span class="keyword">= </span><span class="string">'user'</span><span class="keyword">;<br />
</span><span class="default">$pass&nbsp;&nbsp; </span><span class="keyword">= </span><span class="string">'pass'</span><span class="keyword">;<br />
</span><span class="default">$socket </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">) or die(</span><span class="string">'Could not connect to: '</span><span class="keyword">.</span><span class="default">$host</span><span class="keyword">);<br />
</span><span class="default">$userdota </span><span class="keyword">= </span><span class="string">"palma"</span><span class="keyword">;<br />
if(</span><span class="default">$socket</span><span class="keyword">) <br />
{ <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">sendcmd</span><span class="keyword">(</span><span class="string">"\r"</span><span class="keyword">,</span><span class="default">$socket</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$status </span><span class="keyword">= </span><span class="string">"open"</span><span class="keyword">; </span><span class="comment">// set status open<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">while(</span><span class="default">$status</span><span class="keyword">==</span><span class="string">"open"</span><span class="keyword">) </span><span class="comment">//while we are connected to the server <br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="keyword">{&nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$line </span><span class="keyword">= @</span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">, </span><span class="default">1024</span><span class="keyword">) ;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/////////////login////////////////&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">strstr</span><span class="keyword">(</span><span class="default">$line</span><span class="keyword">, </span><span class="string">"there is no guest account"</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">sendcmd</span><span class="keyword">(</span><span class="default">$user</span><span class="keyword">.</span><span class="string">"\r\n"</span><span class="keyword">,</span><span class="default">$socket</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">sendcmd</span><span class="keyword">(</span><span class="default">$pass</span><span class="keyword">.</span><span class="string">"\r\n"</span><span class="keyword">,</span><span class="default">$socket</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//////////////send command ////////////////////<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">strstr</span><span class="keyword">(</span><span class="default">$line</span><span class="keyword">,</span><span class="string">"Your unique name: "</span><span class="keyword">.</span><span class="default">$user</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {&nbsp; </span><span class="default">sendcmd</span><span class="keyword">(</span><span class="string">"/finger "</span><span class="keyword">.</span><span class="default">$userdota</span><span class="keyword">.</span><span class="string">"\r\n"</span><span class="keyword">,</span><span class="default">$socket</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//////////////get email////////////////////<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">strstr</span><span class="keyword">(</span><span class="default">$line</span><span class="keyword">,</span><span class="string">"email:"</span><span class="keyword">)) </span><span class="comment">// if respone server write "email:"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">{&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$pattern </span><span class="keyword">= </span><span class="string">'/email:(.*) ,/'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">preg_match</span><span class="keyword">(</span><span class="default">$pattern</span><span class="keyword">, </span><span class="default">$line</span><span class="keyword">, </span><span class="default">$matches</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">); <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$status</span><span class="keyword">=</span><span class="string">"close"</span><span class="keyword">; </span><span class="comment">// status close<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$matches</span><span class="keyword">=</span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">" "</span><span class="keyword">,</span><span class="string">""</span><span class="keyword">, </span><span class="default">$matches</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$matches</span><span class="keyword">=</span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">",is_operator:0,is_admin:0,"</span><span class="keyword">,</span><span class="string">""</span><span class="keyword">, </span><span class="default">$matches</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$matches</span><span class="keyword">=</span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"email:"</span><span class="keyword">,</span><span class="string">""</span><span class="keyword">, </span><span class="default">$matches</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print </span><span class="default">$matches</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$email</span><span class="keyword">=</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">strstr</span><span class="keyword">(</span><span class="default">$line</span><span class="keyword">,</span><span class="string">"ERROR: Invalid user."</span><span class="keyword">)) </span><span class="comment">// if respone server write "ERROR: Invalid user."<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">{&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">); <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$status</span><span class="keyword">=</span><span class="string">"close"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$error </span><span class="keyword">=</span><span class="string">"Invalid User"</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">// error message<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">}<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">////////////login failed //////////////////////////&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">strstr</span><span class="keyword">(</span><span class="default">$line</span><span class="keyword">, </span><span class="string">"Login failed"</span><span class="keyword">)) </span><span class="comment">// if respone server write "Login failed"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$error </span><span class="keyword">= </span><span class="string">"Login Failed"</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">// error message<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">); <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$status</span><span class="keyword">=</span><span class="string">"close"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">flush</span><span class="keyword">(); </span><span class="comment">// close<br />
&nbsp;&nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="keyword">}<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
}<br />
function </span><span class="default">sendcmd</span><span class="keyword">(</span><span class="default">$cmd</span><span class="keyword">,</span><span class="default">$socket</span><span class="keyword">) </span><span class="comment">// send command function<br />
</span><span class="keyword">{<br />
&nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">, </span><span class="default">$cmd</span><span class="keyword">, </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$cmd</span><span class="keyword">)); <br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="98915""></a>
  <div class="note">
   <strong class="user">ken at kenmclean dot com dot au</strong>
   <a href="#98915" class="date">15-Jul-2010 02:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Make sure you don't use a double line break ("\r\n\r\n") during the middle of your header, as it appears to end the header. <br />
<br />
This means a \r\n\r\n before "Connection: close\r\n\r\n" will not correctly tell fsockopen to close the request, leading to a max timeout error.<br />
<br />
Some of the code on this page does this. It took me days to figure out. Example:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Wrong:<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="string">"GET / HTTP/1.1\r\n"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="string">"Host: php.net\r\n"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="string">"User-Agent: example\r\n\r\n"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="string">"Connection: Close\r\n\r\n"</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Right:<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="string">"GET / HTTP/1.1\r\n" </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="string">"Host: php.net\r\n"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="string">"User-Agent: example\r\n"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="string">"Connection: Close\r\n\r\n"</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="97962""></a>
  <div class="note">
   <strong class="user">SoupNazi</strong>
   <a href="#97962" class="date">18-May-2010 08:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I would like to save people some time.&nbsp; I spent a couple hours trying to de-hunkify the response from apache2.&nbsp; I found out that if you simply make a 1.0 request vs. a 1.1 request you will get no hunks and so this simple script below will get the page you want in plain text, no hunks:<br />
<br />
<span class="default">&lt;?php<br />
$data</span><span class="keyword">=</span><span class="default">false</span><span class="keyword">;<br />
</span><span class="default">$url</span><span class="keyword">=</span><span class="string">'www.example.com'</span><span class="keyword">;<br />
<br />
</span><span class="default">$fp </span><span class="keyword">= @</span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">, </span><span class="default">80</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
if (</span><span class="default">$fp</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">stream_set_timeout</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">);&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">= </span><span class="string">"GET / HTTP/1.0\r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">.= </span><span class="string">"Host: www.example.com\r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">.= </span><span class="string">"Connection: Close\r\n\r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$out</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$content</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$header </span><span class="keyword">= </span><span class="string">"not yet"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$data</span><span class="keyword">=</span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$line</span><span class="keyword">=</span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">,</span><span class="default">128</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$line</span><span class="keyword">==</span><span class="string">"\r\n" </span><span class="keyword">&amp;&amp; </span><span class="default">$header</span><span class="keyword">==</span><span class="string">"not yet"</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$header </span><span class="keyword">= </span><span class="string">"passed"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$header</span><span class="keyword">==</span><span class="string">"passed"</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$content</span><span class="keyword">.=</span><span class="default">$line</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose </span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
if (!</span><span class="default">$data</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; print </span><span class="string">"Unable to retrieve all or part of </span><span class="default">$url</span><span class="string">"</span><span class="keyword">;<br />
} else {<br />
&nbsp;&nbsp;&nbsp; print </span><span class="string">"</span><span class="default">$content</span><span class="string">"</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
I borrowed some of the script from another poster here - the portion removing the returned header.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="96183""></a>
  <div class="note">
   <strong class="user">steve at visual77 dot com</strong>
   <a href="#96183" class="date">12-Feb-2010 07:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A short, quick unchunk function that makes use of regular expressions:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">unchunk</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">preg_replace_callback</span><span class="keyword">(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'/(?:(?:\r\n|\n)|^)([0-9A-F]+)(?:\r\n|\n){1,2}(.*?)'</span><span class="keyword">.<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'((?:\r\n|\n)(?:[0-9A-F]+(?:\r\n|\n))|$)/si'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">create_function</span><span class="keyword">(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'$matches'</span><span class="keyword">, <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'return hexdec($matches[1]) == strlen($matches[2]) ? $matches[2] : $matches[0];'<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">), <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="95605""></a>
  <div class="note">
   <strong class="user">nytro_rst at yahoo dot com</strong>
   <a href="#95605" class="date">12-Jan-2010 11:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A simple proxy list checker. You can check a list ip:port if that port is opened on that IP.<br />
<br />
<span class="default">&lt;?php<br />
<br />
$fisier </span><span class="keyword">= </span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="string">'proxy_list.txt'</span><span class="keyword">); </span><span class="comment">// Read the file with the proxy list<br />
</span><span class="default">$linii </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">"\n"</span><span class="keyword">, </span><span class="default">$fisier</span><span class="keyword">); </span><span class="comment">// Get each proxy<br />
</span><span class="default">$fisier </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="string">"bune.txt"</span><span class="keyword">, </span><span class="string">"a"</span><span class="keyword">); </span><span class="comment">// Here we will write the good ones<br />
<br />
</span><span class="keyword">for(</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">count</span><span class="keyword">(</span><span class="default">$linii</span><span class="keyword">) - </span><span class="default">1</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) </span><span class="default">test</span><span class="keyword">(</span><span class="default">$linii</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]); </span><span class="comment">// Test each proxy<br />
<br />
</span><span class="keyword">function </span><span class="default">test</span><span class="keyword">(</span><span class="default">$proxy</span><span class="keyword">)<br />
{<br />
&nbsp; global </span><span class="default">$fisier</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$splited </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">':'</span><span class="keyword">,</span><span class="default">$proxy</span><span class="keyword">); </span><span class="comment">// Separate IP and port<br />
&nbsp; </span><span class="keyword">if(</span><span class="default">$con </span><span class="keyword">= @</span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$splited</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="default">$splited</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">], </span><span class="default">$eroare</span><span class="keyword">, </span><span class="default">$eroare_str</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">)) <br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fisier</span><span class="keyword">, </span><span class="default">$proxy </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">); </span><span class="comment">// Check if we can connect to that IP and port<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">print </span><span class="default">$proxy </span><span class="keyword">. </span><span class="string">'&lt;br&gt;'</span><span class="keyword">; </span><span class="comment">// Show the proxy<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$con</span><span class="keyword">); </span><span class="comment">// Close the socket handle<br />
&nbsp; </span><span class="keyword">}<br />
}<br />
<br />
</span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fisier</span><span class="keyword">); </span><span class="comment">// Close the file<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93509""></a>
  <div class="note">
   <strong class="user">FaTe</strong>
   <a href="#93509" class="date">14-Sep-2009 05:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In all header aspects I can understand for 3rd party content you may not be able to apply the following but for those reading pages where content being read by fsockopen is editable then I suggest adding a simple unique tag to the beginning of any page being read such as ":THISTAG:"<br />
<br />
Cleaning the header contents becomes simplier when you can then use a method like split to grab your data like:<br />
<br />
list($header,$data) = explode(":THISTAG:",$data);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92588""></a>
  <div class="note">
   <strong class="user">walter</strong>
   <a href="#92588" class="date">30-Jul-2009 05:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For some reason the default FreeBSD 7.0 port (jailed environment) breaks fsockopen() on SSL URLs, returning a constant stream of nothing!&nbsp; In my case this resulted in php-cgi bringing down lighttpd completely, in rapid time!&nbsp; Avoid FreeBSD/jails/fsockopen + SSL.&nbsp; Use curl_init() instead.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91668""></a>
  <div class="note">
   <strong class="user">ghzero at ghzero dot de</strong>
   <a href="#91668" class="date">22-Jun-2009 02:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
note:<br />
the default protocol - if not given - seems to be tcp://</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91644""></a>
  <div class="note">
   <strong class="user">oliver dot christen at camptocamp dot com</strong>
   <a href="#91644" class="date">21-Jun-2009 12:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When downloading large files, it is not really efficient to put the whole server answer in memory before parsing the data to remove the header parts. Here is a simple way to do it while writing the data as it arrive:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">// $socket is a valid fsockopen handle<br />
<br />
</span><span class="default">$out </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
</span><span class="default">$headerendfound </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
</span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$fileTarget</span><span class="keyword">, </span><span class="string">'w'</span><span class="keyword">);<br />
</span><span class="default">$buffer </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">)) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">= </span><span class="default">fgets </span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">,</span><span class="default">16384</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$headerendfound</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$out</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; print </span><span class="string">'.'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if (!</span><span class="default">$headerendfound</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$buffer </span><span class="keyword">.= </span><span class="default">$out</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; print </span><span class="string">"searching for header\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$headerend </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$buffer</span><span class="keyword">, </span><span class="string">"\r\n\r\n"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$headerend </span><span class="keyword">!== </span><span class="default">false</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$headerendfound </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$buffer</span><span class="keyword">, </span><span class="default">$headerend</span><span class="keyword">+</span><span class="default">4</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$buffer </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
} <br />
</span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br />
</span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91554""></a>
  <div class="note">
   <strong class="user">andypsv at rcdrugs dot com</strong>
   <a href="#91554" class="date">16-Jun-2009 10:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
look at this smart ssl/http fsockopen function as a good solution for dealing with things
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">_get</span><span class="keyword">(</span><span class="default">$type</span><span class="keyword">,</span><span class="default">$host</span><span class="keyword">,</span><span class="default">$port</span><span class="keyword">=</span><span class="string">'80'</span><span class="keyword">,</span><span class="default">$path</span><span class="keyword">=</span><span class="string">'/'</span><span class="keyword">,</span><span class="default">$data</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$_err </span><span class="keyword">= </span><span class="string">'lib sockets::'</span><span class="keyword">.</span><span class="default">__FUNCTION__</span><span class="keyword">.</span><span class="string">'(): '</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; switch(</span><span class="default">$type</span><span class="keyword">) { case </span><span class="string">'http'</span><span class="keyword">: </span><span class="default">$type </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">; case </span><span class="string">'ssl'</span><span class="keyword">: continue; default: die(</span><span class="default">$_err</span><span class="keyword">.</span><span class="string">'bad $type'</span><span class="keyword">); } if(!</span><span class="default">ctype_digit</span><span class="keyword">(</span><span class="default">$port</span><span class="keyword">)) die(</span><span class="default">$_err</span><span class="keyword">.</span><span class="string">'bad port'</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; if(!empty(</span><span class="default">$data</span><span class="keyword">)) foreach(</span><span class="default">$data </span><span class="keyword">AS </span><span class="default">$k </span><span class="keyword">=&gt; </span><span class="default">$v</span><span class="keyword">) </span><span class="default">$str </span><span class="keyword">.= </span><span class="default">urlencode</span><span class="keyword">(</span><span class="default">$k</span><span class="keyword">).</span><span class="string">'='</span><span class="keyword">.</span><span class="default">urlencode</span><span class="keyword">(</span><span class="default">$v</span><span class="keyword">).</span><span class="string">'&amp;'</span><span class="keyword">; </span><span class="default">$str </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,-</span><span class="default">1</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">,</span><span class="default">$port</span><span class="keyword">,</span><span class="default">$errno</span><span class="keyword">,</span><span class="default">$errstr</span><span class="keyword">,</span><span class="default">$timeout</span><span class="keyword">=</span><span class="default">30</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; if(!</span><span class="default">$fp</span><span class="keyword">) die(</span><span class="default">$_err</span><span class="keyword">.</span><span class="default">$errstr</span><span class="keyword">.</span><span class="default">$errno</span><span class="keyword">); else {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="string">"POST </span><span class="default">$path</span><span class="string"> HTTP/1.1\r\n"</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="string">"Host: </span><span class="default">$host</span><span class="string">\r\n"</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="string">"Content-type: application/x-www-form-urlencoded\r\n"</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="string">"Content-length: "</span><span class="keyword">.</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">).</span><span class="string">"\r\n"</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="string">"Connection: close\r\n\r\n"</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$str</span><span class="keyword">.</span><span class="string">"\r\n\r\n"</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while(!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">)) </span><span class="default">$d </span><span class="keyword">.= </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">,</span><span class="default">4096</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; } return </span><span class="default">$d</span><span class="keyword">;
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="87144""></a>
  <div class="note">
   <strong class="user">Hyan Christian</strong>
   <a href="#87144" class="date">21-Nov-2008 07:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To just take the HTTP content from fsockopen, better wait until feof finish to read the \r\n separator
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="comment">//fsockopen, fputs..
<br />

<br />
</span><span class="default">$content </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;
<br />
</span><span class="default">$header </span><span class="keyword">= </span><span class="string">"not yet"</span><span class="keyword">;
<br />

<br />
while( !</span><span class="default">feof</span><span class="keyword">( </span><span class="default">$pointer </span><span class="keyword">) ) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$line </span><span class="keyword">= </span><span class="default">fgets</span><span class="keyword">( </span><span class="default">$pointer</span><span class="keyword">, </span><span class="default">128 </span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; if( </span><span class="default">$line </span><span class="keyword">== </span><span class="string">"\r\n" </span><span class="keyword">&amp;&amp; </span><span class="default">$header </span><span class="keyword">== </span><span class="string">"not yet" </span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$header </span><span class="keyword">= </span><span class="string">"passed"</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; if( </span><span class="default">$header </span><span class="keyword">== </span><span class="string">"passed" </span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$content </span><span class="keyword">.= </span><span class="default">$line</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
}
<br />

<br />
</span><span class="comment">//fclose..
<br />

<br />
</span><span class="keyword">echo( </span><span class="default">substr</span><span class="keyword">( </span><span class="default">$content</span><span class="keyword">, </span><span class="default">2 </span><span class="keyword">) );
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86862""></a>
  <div class="note">
   <strong class="user">Doug</strong>
   <a href="#86862" class="date">07-Nov-2008 12:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
[NOTE BY danbrown AT php DOT net: Updated version.&nbsp; Contains author-submitted bug fixes.]
<br />

<br />
Here is a way to get an array of cities / states for any zip code anywhere in the US.&nbsp; This example uses a $_GET variable to specify which zip code, but you can get it from any source you wish.&nbsp; This will return actual and acceptable zip code cities (according to USPS), but can be easily modified to include just the actual city.
<br />

<br />
<span class="default">&lt;?php
<br />

<br />
</span><span class="keyword">if(</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'zip'</span><span class="keyword">])
<br />
{
<br />
&nbsp;&nbsp;&nbsp; if(!(</span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="string">'zip4.usps.com'</span><span class="keyword">, </span><span class="default">80</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">)))
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">'Could not connect to USPS! Error number: ' </span><span class="keyword">. </span><span class="default">$errno </span><span class="keyword">. </span><span class="string">'(' </span><span class="keyword">. </span><span class="default">$errstr </span><span class="keyword">. </span><span class="string">')'</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp;&nbsp; else
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$poststring </span><span class="keyword">=
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"GET /zip4/zcl_3_results.jsp?zip5=" </span><span class="keyword">. </span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'zip'</span><span class="keyword">] . </span><span class="string">" HTTP/1.0\r\n" </span><span class="keyword">.
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"Connection: close\r\n\r\n"</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$poststring</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$buffer </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while(!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">))
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$buffer </span><span class="keyword">.= </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">128</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'/Actual City name(.*)/s'</span><span class="keyword">, </span><span class="default">$buffer</span><span class="keyword">, </span><span class="default">$match</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$temp </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">'Not Acceptable'</span><span class="keyword">, </span><span class="default">$match</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Capture city/state combination for all valid cities
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">preg_match_all</span><span class="keyword">(</span><span class="string">'/headers="pre"&gt;(?:&lt;b&gt;)?([\w|\s]+), (\w+)/'</span><span class="keyword">, </span><span class="default">$temp</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="default">$acceptable</span><span class="keyword">, </span><span class="default">PREG_SET_ORDER</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$values </span><span class="keyword">= array();
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$acceptable </span><span class="keyword">as </span><span class="default">$value</span><span class="keyword">)
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$values</span><span class="keyword">[] =
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; array
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'city' </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">],
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'state' </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; );
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">count</span><span class="keyword">(</span><span class="default">$values</span><span class="keyword">) == </span><span class="default">0</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">'Zip could not be found in the database!'</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
}
<br />
else
<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">'Please specify a zip!'</span><span class="keyword">;
<br />

<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86621""></a>
  <div class="note">
   <strong class="user">laisebrown at gmail dot com</strong>
   <a href="#86621" class="date">27-Oct-2008 12:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When you're connecting through a proxy server you can't rely on fsockopen returning false to indicate that the connection has failed. (This also applies to fgets and fwrite.)<br />
<br />
To check whether the proxy succeeded in contacting the real target host, you need to look for the http response code in the headers that get returned. Typically, if the proxy was unable to reach the host, you'll find a line containing something like:<br />
HTTP/1.0 503 Service Unavailable</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86305""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#86305" class="date">12-Oct-2008 02:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
"system level connect()" is not further documented inside the php documentation so it is hard to find out more about error numbers.<br />
<br />
someone suggest a more system-close way to find out more about error numbers here: <a href="http://www.askapache.com/php/fsockopen-socket.html (an interesting read about fsockopen anyway" rel="nofollow" target="_blank">http://www.askapache.com/php/fsockopen-socket.html (an interesting read about fsockopen anyway</a>).<br />
<br />
in my case i could debug to the fact that fsocketopen error number 16 was resulted in the inpossibility to resolve a hostname.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85622""></a>
  <div class="note">
   <strong class="user">andrew at enigma-pro dot com</strong>
   <a href="#85622" class="date">09-Sep-2008 05:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Notice using "tcp" insted of "http"
<br />
<span class="default">&lt;?php
<br />
fsockopen</span><span class="keyword">(</span><span class="string">"tcp://example.net"</span><span class="keyword">,</span><span class="default">80 </span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">30</span><span class="keyword">);
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85572""></a>
  <div class="note">
   <strong class="user">mikey at badpenguins dot com</strong>
   <a href="#85572" class="date">06-Sep-2008 06:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
My $0.02 on handling chunked transfer encoded output...&nbsp; Has rudimentary error handling.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="comment">//
<br />
// Example usage...
<br />
//
<br />
</span><span class="default">$server&nbsp; </span><span class="keyword">= </span><span class="string">'127.0.0.1'</span><span class="keyword">;
<br />
</span><span class="default">$port&nbsp; &nbsp; </span><span class="keyword">= </span><span class="string">'80'</span><span class="keyword">;
<br />
</span><span class="default">$uri&nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="string">'/cgi-bin/random-cgi'</span><span class="keyword">;
<br />
</span><span class="default">$content </span><span class="keyword">= </span><span class="string">'Your post content...'</span><span class="keyword">;
<br />

<br />
</span><span class="default">$post_results </span><span class="keyword">= </span><span class="default">httpPost</span><span class="keyword">(</span><span class="default">$server</span><span class="keyword">,</span><span class="default">$port</span><span class="keyword">,</span><span class="default">$uri</span><span class="keyword">,</span><span class="default">$content</span><span class="keyword">);
<br />
if (!</span><span class="default">is_string</span><span class="keyword">(</span><span class="default">$post_results</span><span class="keyword">)) {
<br />
&nbsp;&nbsp;&nbsp; die(</span><span class="string">'uh oh, something went wrong'</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; } else {
<br />
&nbsp;&nbsp;&nbsp; die(</span><span class="string">'Here are your results: ' </span><span class="keyword">. </span><span class="default">$post_results</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
</span><span class="comment">//
<br />
// Post provided content to an http server and optionally
<br />
// convert chunk encoded results.&nbsp; Returns false on errors,
<br />
// result of post on success.&nbsp; This example only handles http,
<br />
// not https.
<br />
//
<br />
</span><span class="keyword">function </span><span class="default">httpPost</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">=</span><span class="default">null</span><span class="keyword">,</span><span class="default">$port</span><span class="keyword">=</span><span class="default">80</span><span class="keyword">,</span><span class="default">$uri</span><span class="keyword">=</span><span class="default">null</span><span class="keyword">,</span><span class="default">$content</span><span class="keyword">=</span><span class="default">null</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; if (empty(</span><span class="default">$ip</span><span class="keyword">))&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; { return </span><span class="default">false</span><span class="keyword">; }
<br />
&nbsp;&nbsp;&nbsp; if (!</span><span class="default">is_numeric</span><span class="keyword">(</span><span class="default">$port</span><span class="keyword">)) { return </span><span class="default">false</span><span class="keyword">; }
<br />
&nbsp;&nbsp;&nbsp; if (empty(</span><span class="default">$uri</span><span class="keyword">))&nbsp; &nbsp; &nbsp; &nbsp; { return </span><span class="default">false</span><span class="keyword">; }
<br />
&nbsp;&nbsp;&nbsp; if (empty(</span><span class="default">$content</span><span class="keyword">))&nbsp; &nbsp; { return </span><span class="default">false</span><span class="keyword">; }
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// generate headers in array.
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$t&nbsp;&nbsp; </span><span class="keyword">= array();
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$t</span><span class="keyword">[] = </span><span class="string">'POST ' </span><span class="keyword">. </span><span class="default">$uri </span><span class="keyword">. </span><span class="string">' HTTP/1.1'</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$t</span><span class="keyword">[] = </span><span class="string">'Content-Type: text/html'</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$t</span><span class="keyword">[] = </span><span class="string">'Host: ' </span><span class="keyword">. </span><span class="default">$ip </span><span class="keyword">. </span><span class="string">':' </span><span class="keyword">. </span><span class="default">$port</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$t</span><span class="keyword">[] = </span><span class="string">'Content-Length: ' </span><span class="keyword">. </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$content</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$t</span><span class="keyword">[] = </span><span class="string">'Connection: close'</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$t&nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">implode</span><span class="keyword">(</span><span class="string">"\r\n"</span><span class="keyword">,</span><span class="default">$t</span><span class="keyword">) . </span><span class="string">"\r\n\r\n" </span><span class="keyword">. </span><span class="default">$content</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//
<br />
&nbsp;&nbsp;&nbsp; // Open socket, provide error report vars and timeout of 10
<br />
&nbsp;&nbsp;&nbsp; // seconds.
<br />
&nbsp;&nbsp;&nbsp; //
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fp&nbsp; </span><span class="keyword">= @</span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">,</span><span class="default">$port</span><span class="keyword">,</span><span class="default">$errno</span><span class="keyword">,</span><span class="default">$errstr</span><span class="keyword">,</span><span class="default">10</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// If we don't have a stream resource, abort.
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (!(</span><span class="default">get_resource_type</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">) == </span><span class="string">'stream'</span><span class="keyword">)) { return </span><span class="default">false</span><span class="keyword">; }
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//
<br />
&nbsp;&nbsp;&nbsp; // Send headers and content.
<br />
&nbsp;&nbsp;&nbsp; //
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (!</span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">,</span><span class="default">$t</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//
<br />
&nbsp;&nbsp;&nbsp; // Read all of response into $rsp and close the socket.
<br />
&nbsp;&nbsp;&nbsp; //
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$rsp </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; while(!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">)) { </span><span class="default">$rsp </span><span class="keyword">.= </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">,</span><span class="default">8192</span><span class="keyword">); }
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//
<br />
&nbsp;&nbsp;&nbsp; // Call parseHttpResponse() to return the results.
<br />
&nbsp;&nbsp;&nbsp; //
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">parseHttpResponse</span><span class="keyword">(</span><span class="default">$rsp</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
</span><span class="comment">//
<br />
// Accepts provided http content, checks for a valid http response,
<br />
// unchunks if needed, returns http content without headers on
<br />
// success, false on any errors.
<br />
//
<br />
</span><span class="keyword">function </span><span class="default">parseHttpResponse</span><span class="keyword">(</span><span class="default">$content</span><span class="keyword">=</span><span class="default">null</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; if (empty(</span><span class="default">$content</span><span class="keyword">)) { return </span><span class="default">false</span><span class="keyword">; }
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// split into array, headers and content.
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$hunks </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">"\r\n\r\n"</span><span class="keyword">,</span><span class="default">trim</span><span class="keyword">(</span><span class="default">$content</span><span class="keyword">));
<br />
&nbsp;&nbsp;&nbsp; if (!</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$hunks</span><span class="keyword">) or </span><span class="default">count</span><span class="keyword">(</span><span class="default">$hunks</span><span class="keyword">) &lt; </span><span class="default">2</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$header&nbsp; </span><span class="keyword">= </span><span class="default">$hunks</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$hunks</span><span class="keyword">) - </span><span class="default">2</span><span class="keyword">];
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$body&nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">$hunks</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$hunks</span><span class="keyword">) - </span><span class="default">1</span><span class="keyword">];
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$headers </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">"\n"</span><span class="keyword">,</span><span class="default">$header</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; unset(</span><span class="default">$hunks</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; unset(</span><span class="default">$header</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; if (!</span><span class="default">verifyHttpResponse</span><span class="keyword">(</span><span class="default">$headers</span><span class="keyword">)) { return </span><span class="default">false</span><span class="keyword">; }
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">in_array</span><span class="keyword">(</span><span class="string">'Transfer-Encoding: chunked'</span><span class="keyword">,</span><span class="default">$headers</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">trim</span><span class="keyword">(</span><span class="default">unchunkHttpResponse</span><span class="keyword">(</span><span class="default">$body</span><span class="keyword">));
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$body</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
</span><span class="comment">//
<br />
// Validate http responses by checking header.&nbsp; Expects array of
<br />
// headers as argument.&nbsp; Returns boolean.
<br />
//
<br />
</span><span class="keyword">function </span><span class="default">validateHttpResponse</span><span class="keyword">(</span><span class="default">$headers</span><span class="keyword">=</span><span class="default">null</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; if (!</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$headers</span><span class="keyword">) or </span><span class="default">count</span><span class="keyword">(</span><span class="default">$headers</span><span class="keyword">) &lt; </span><span class="default">1</span><span class="keyword">) { return </span><span class="default">false</span><span class="keyword">; }
<br />
&nbsp;&nbsp;&nbsp; switch(</span><span class="default">trim</span><span class="keyword">(</span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">$headers</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]))) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'http/1.0 100 ok'</span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'http/1.0 200 ok'</span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'http/1.1 100 ok'</span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'http/1.1 200 ok'</span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">true</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; break;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
</span><span class="comment">//
<br />
// Unchunk http content.&nbsp; Returns unchunked content on success,
<br />
// false on any errors...&nbsp; Borrows from code posted above by
<br />
// jbr at ya-right dot com.
<br />
//
<br />
</span><span class="keyword">function </span><span class="default">unchunkHttpResponse</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">=</span><span class="default">null</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; if (!</span><span class="default">is_string</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">) or </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">) &lt; </span><span class="default">1</span><span class="keyword">) { return </span><span class="default">false</span><span class="keyword">; }
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$eol </span><span class="keyword">= </span><span class="string">"\r\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$add </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$eol</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$tmp </span><span class="keyword">= </span><span class="default">$str</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$str </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; do {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tmp </span><span class="keyword">= </span><span class="default">ltrim</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pos </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">, </span><span class="default">$eol</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$pos </span><span class="keyword">=== </span><span class="default">false</span><span class="keyword">) { return </span><span class="default">false</span><span class="keyword">; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$len </span><span class="keyword">= </span><span class="default">hexdec</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$pos</span><span class="keyword">));
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">is_numeric</span><span class="keyword">(</span><span class="default">$len</span><span class="keyword">) or </span><span class="default">$len </span><span class="keyword">&lt; </span><span class="default">0</span><span class="keyword">) { return </span><span class="default">false</span><span class="keyword">; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$str </span><span class="keyword">.= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">, (</span><span class="default">$pos </span><span class="keyword">+ </span><span class="default">$add</span><span class="keyword">), </span><span class="default">$len</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tmp&nbsp; </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">, (</span><span class="default">$len </span><span class="keyword">+ </span><span class="default">$pos </span><span class="keyword">+ </span><span class="default">$add</span><span class="keyword">));
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$check </span><span class="keyword">= </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } while(!empty(</span><span class="default">$check</span><span class="keyword">));
<br />
&nbsp;&nbsp;&nbsp; unset(</span><span class="default">$tmp</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$str</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84599""></a>
  <div class="note">
   <strong class="user">admin at lab-9 dot com</strong>
   <a href="#84599" class="date">21-Jul-2008 02:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When you try to POST/GET requests via HTTPS over SSL/TLS you should notice this:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// preconditions<br />
</span><span class="default">$port </span><span class="keyword">= </span><span class="default">80 </span><span class="keyword">| </span><span class="default">443<br />
$host </span><span class="keyword">= </span><span class="string">"www.example.com"</span><span class="keyword">;<br />
</span><span class="default">$method </span><span class="keyword">= </span><span class="string">"POST" </span><span class="keyword">| </span><span class="string">"GET"</span><span class="keyword">;<br />
</span><span class="default">$contenttype </span><span class="keyword">= </span><span class="string">"text/html" </span><span class="keyword">| </span><span class="string">"text/plain" </span><span class="keyword">| </span><span class="string">"text/xml" </span><span class="keyword">| ...;<br />
</span><span class="default">$data </span><span class="keyword">= </span><span class="string">"&lt;something&gt;"</span><span class="keyword">;<br />
<br />
</span><span class="comment">// script<br />
</span><span class="keyword">if(</span><span class="default">$port </span><span class="keyword">== </span><span class="default">443</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$sslhost </span><span class="keyword">= </span><span class="string">"ssl://"</span><span class="keyword">.</span><span class="default">$host</span><span class="keyword">;<br />
else<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$sslhost </span><span class="keyword">= </span><span class="default">$host</span><span class="keyword">;<br />
</span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$sslhost</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">);<br />
</span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="string">"</span><span class="default">$method</span><span class="string"> </span><span class="default">$path</span><span class="string"> HTTP/1.1\r\n"</span><span class="keyword">);<br />
</span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="string">"Host: </span><span class="default">$host</span><span class="string">\r\n"</span><span class="keyword">);<br />
</span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="string">"Content-type: </span><span class="default">$contenttype</span><span class="string">\r\n"</span><span class="keyword">);<br />
</span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="string">"Content-length: "</span><span class="keyword">.</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">).</span><span class="string">"\r\n"</span><span class="keyword">);<br />
</span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="string">"Connection: close\r\n"</span><span class="keyword">);<br />
</span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="string">"\r\n"</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
The server usually does not understand the HTTP-header "Host: XXX" if you provide it with the trailing "ssl://" used by fsockopen(); If you do it anyway you probably get a HTTP 400 back as response. :-)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82586""></a>
  <div class="note">
   <strong class="user">jabeba at web dot de</strong>
   <a href="#82586" class="date">17-Apr-2008 03:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you have to use a proxy to make requests outside of your local network, you may use this class:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="comment">/*
<br />
&nbsp;* 
<br />
&nbsp;* No Proxy Authentification Implemented; PHP 5
<br />
&nbsp;* 
<br />
&nbsp;*/
<br />

<br />
</span><span class="keyword">class </span><span class="default">RemoteFopenViaProxy </span><span class="keyword">{
<br />

<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$result</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$proxy_name</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$proxy_port</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$request_url</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">get_proxy_name</span><span class="keyword">() {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">proxy_name</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">set_proxy_name</span><span class="keyword">(</span><span class="default">$n</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">proxy_name </span><span class="keyword">= </span><span class="default">$n</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">get_proxy_port</span><span class="keyword">() {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">proxy_port</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">set_proxy_port</span><span class="keyword">(</span><span class="default">$p</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">proxy_port </span><span class="keyword">= </span><span class="default">$p</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">get_request_url</span><span class="keyword">() {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">request_url</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">set_request_url</span><span class="keyword">(</span><span class="default">$u</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">request_url </span><span class="keyword">= </span><span class="default">$u</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">get_result</span><span class="keyword">() {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">result</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">set_result</span><span class="keyword">(</span><span class="default">$r</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">result </span><span class="keyword">= </span><span class="default">$r</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; private function </span><span class="default">get_url_via_proxy</span><span class="keyword">() {
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$proxy_fp </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">get_proxy_name</span><span class="keyword">(), </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">get_proxy_port</span><span class="keyword">());
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">$proxy_fp</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$proxy_fp</span><span class="keyword">, </span><span class="string">"GET " </span><span class="keyword">. </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">get_request_url</span><span class="keyword">() . </span><span class="string">" HTTP/1.0\r\nHost: " </span><span class="keyword">. </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">get_proxy_name</span><span class="keyword">() . </span><span class="string">"\r\n\r\n"</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$proxy_fp</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$proxy_cont </span><span class="keyword">.= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$proxy_fp</span><span class="keyword">, </span><span class="default">4096</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$proxy_fp</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$proxy_cont </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$proxy_cont</span><span class="keyword">, </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$proxy_cont</span><span class="keyword">, </span><span class="string">"\r\n\r\n"</span><span class="keyword">) + </span><span class="default">4</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$proxy_cont</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; private function </span><span class="default">get_url</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fd </span><span class="keyword">= @ </span><span class="default">file</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$fd</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$fd</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; private function </span><span class="default">logger</span><span class="keyword">(</span><span class="default">$line</span><span class="keyword">, </span><span class="default">$file</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fd </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$file </span><span class="keyword">. </span><span class="string">".log"</span><span class="keyword">, </span><span class="string">"a+"</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fd</span><span class="keyword">, </span><span class="default">date</span><span class="keyword">(</span><span class="string">"Ymd G:i:s"</span><span class="keyword">) . </span><span class="string">" - " </span><span class="keyword">. </span><span class="default">$file </span><span class="keyword">. </span><span class="string">" - " </span><span class="keyword">. </span><span class="default">$line </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fd</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">, </span><span class="default">$proxy_name </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">, </span><span class="default">$proxy_port </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">) {
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">set_request_url</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">set_proxy_name</span><span class="keyword">(</span><span class="default">$proxy_name</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">set_proxy_port</span><span class="keyword">(</span><span class="default">$proxy_port</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">request_via_proxy</span><span class="keyword">() {
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">set_result</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">get_url_via_proxy</span><span class="keyword">());
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">get_result</span><span class="keyword">()) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">logger</span><span class="keyword">(</span><span class="string">"FAILED: get_url_via_proxy(" </span><span class="keyword">. </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">get_proxy_name</span><span class="keyword">() . </span><span class="string">"," </span><span class="keyword">. </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">get_proxy_port</span><span class="keyword">() . </span><span class="string">"," </span><span class="keyword">. </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">get_request_url</span><span class="keyword">() . </span><span class="string">")"</span><span class="keyword">, </span><span class="string">"RemoteFopenViaProxyClass.log"</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">request_without_proxy</span><span class="keyword">() {
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">set_result</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">get_url</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">get_request_url</span><span class="keyword">()));
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">get_result</span><span class="keyword">()) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">logger</span><span class="keyword">(</span><span class="string">"FAILED: get_url(" </span><span class="keyword">. </span><span class="default">$url </span><span class="keyword">. </span><span class="string">")"</span><span class="keyword">, </span><span class="string">"RemoteFopenViaProxyClass.log"</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />
}
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Use it this way:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="comment">// call constructor
<br />
</span><span class="default">$obj </span><span class="keyword">= new </span><span class="default">RemoteFopenViaProxy</span><span class="keyword">(</span><span class="default">$insert_request_url</span><span class="keyword">, </span><span class="default">$insert_proxy_name</span><span class="keyword">, </span><span class="default">$insert_proxy_port</span><span class="keyword">);
<br />
</span><span class="comment">// change settings after object generation
<br />
</span><span class="default">$obj</span><span class="keyword">-&gt;</span><span class="default">set_proxy_name</span><span class="keyword">(</span><span class="default">$insert_proxy_name</span><span class="keyword">);
<br />
</span><span class="default">$obj</span><span class="keyword">-&gt;</span><span class="default">set_proxy_port</span><span class="keyword">(</span><span class="default">$insert_proxy_port</span><span class="keyword">);
<br />
</span><span class="default">$obj</span><span class="keyword">-&gt;</span><span class="default">set_request_url</span><span class="keyword">(</span><span class="default">$insert_request_url</span><span class="keyword">);
<br />
</span><span class="default">$obj</span><span class="keyword">-&gt;</span><span class="default">request_via_proxy</span><span class="keyword">();
<br />
echo </span><span class="default">$obj</span><span class="keyword">-&gt;</span><span class="default">get_result</span><span class="keyword">();
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
If there are errors during execution, the script tries to write some useful information into a log file.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81652""></a>
  <div class="note">
   <strong class="user"> dot  dot  dot  dot  dot alexander at gmail dot com</strong>
   <a href="#81652" class="date">08-Mar-2008 04:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
An edit to my below function for extra headers support and a bit of debugging<br />
( array("key" =&gt; "value")&nbsp; type)<br />
&nbsp;<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">if(!</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">"download"</span><span class="keyword">)){<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">download</span><span class="keyword">(</span><span class="default">$uri</span><span class="keyword">, </span><span class="default">$port </span><span class="keyword">= </span><span class="default">80</span><span class="keyword">, </span><span class="default">$extra_headers </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">){<br />
if(!</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">"stripos"</span><span class="keyword">)){<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">stripos</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">, </span><span class="default">$needle</span><span class="keyword">, </span><span class="default">$offset</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">),</span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">$needle</span><span class="keyword">),</span><span class="default">$offset</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }</span><span class="comment">/* endfunction stripos */<br />
</span><span class="keyword">}</span><span class="comment">/* endfunction exists stripos*/<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(!</span><span class="default">is_int</span><span class="keyword">(</span><span class="default">$port</span><span class="keyword">))</span><span class="default">$port </span><span class="keyword">= </span><span class="default">80</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(!</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$extra_headers</span><span class="keyword">))</span><span class="default">$extra_headers </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$uri </span><span class="keyword">= </span><span class="default">strtr</span><span class="keyword">( </span><span class="default">strval</span><span class="keyword">(</span><span class="default">$uri</span><span class="keyword">), array(</span><span class="string">"<a href="http://" rel="nofollow" target="_blank">http://</a>" </span><span class="keyword">=&gt; </span><span class="string">""</span><span class="keyword">, </span><span class="string">"https://" </span><span class="keyword">=&gt; </span><span class="string">"ssl://"</span><span class="keyword">, </span><span class="string">"ssl://" </span><span class="keyword">=&gt; </span><span class="string">"ssl://"</span><span class="keyword">, </span><span class="string">"\\" </span><span class="keyword">=&gt; </span><span class="string">"/"</span><span class="keyword">, </span><span class="string">"//" </span><span class="keyword">=&gt; </span><span class="string">"/"</span><span class="keyword">) );<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(&nbsp; ( </span><span class="default">$protocol </span><span class="keyword">= </span><span class="default">stripos</span><span class="keyword">(</span><span class="default">$uri</span><span class="keyword">, </span><span class="string">"://"</span><span class="keyword">) ) !== </span><span class="default">FALSE&nbsp; </span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(&nbsp; ( </span><span class="default">$domain_pos </span><span class="keyword">= </span><span class="default">stripos</span><span class="keyword">(</span><span class="default">$uri</span><span class="keyword">, </span><span class="string">"/"</span><span class="keyword">, (</span><span class="default">$protocol </span><span class="keyword">+ </span><span class="default">3</span><span class="keyword">)) ) !== </span><span class="default">FALSE&nbsp; </span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$domain </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$uri</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$domain_pos</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$file </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$uri</span><span class="keyword">, </span><span class="default">$domain_pos</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$domain </span><span class="keyword">= </span><span class="default">$uri</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$file </span><span class="keyword">= </span><span class="string">"/"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(&nbsp; ( </span><span class="default">$domain_pos </span><span class="keyword">= </span><span class="default">stripos</span><span class="keyword">(</span><span class="default">$uri</span><span class="keyword">, </span><span class="string">"/"</span><span class="keyword">) ) !== </span><span class="default">FALSE&nbsp; </span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$domain </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$uri</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$domain_pos</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$file </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$uri</span><span class="keyword">, </span><span class="default">$domain_pos</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$domain </span><span class="keyword">= </span><span class="default">$uri</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$file </span><span class="keyword">= </span><span class="string">"/"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$domain</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">30</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(!</span><span class="default">$fp</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">FALSE</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">= </span><span class="string">"GET " </span><span class="keyword">. </span><span class="default">$file </span><span class="keyword">. </span><span class="string">" HTTP/1.1\r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">.= </span><span class="string">"Host: " </span><span class="keyword">. </span><span class="default">$domain </span><span class="keyword">. </span><span class="string">"\r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach( </span><span class="default">$extra_headers </span><span class="keyword">as </span><span class="default">$nm </span><span class="keyword">=&gt; </span><span class="default">$vl </span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">.= </span><span class="default">strtr</span><span class="keyword">( </span><span class="default">strval</span><span class="keyword">(</span><span class="default">$nm</span><span class="keyword">), array( </span><span class="string">"\r" </span><span class="keyword">=&gt; </span><span class="string">""</span><span class="keyword">, </span><span class="string">"\n" </span><span class="keyword">=&gt; </span><span class="string">""</span><span class="keyword">, </span><span class="string">": " </span><span class="keyword">=&gt; </span><span class="string">""</span><span class="keyword">, </span><span class="string">":" </span><span class="keyword">=&gt; </span><span class="string">""</span><span class="keyword">) ) . </span><span class="string">": " </span><span class="keyword">. </span><span class="default">strtr</span><span class="keyword">( </span><span class="default">strval</span><span class="keyword">(</span><span class="default">$vl</span><span class="keyword">), array( </span><span class="string">"\r" </span><span class="keyword">=&gt; </span><span class="string">""</span><span class="keyword">, </span><span class="string">"\n" </span><span class="keyword">=&gt; </span><span class="string">""</span><span class="keyword">, </span><span class="string">": " </span><span class="keyword">=&gt; </span><span class="string">""</span><span class="keyword">, </span><span class="string">":" </span><span class="keyword">=&gt; </span><span class="string">""</span><span class="keyword">) ) . </span><span class="string">"\r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">.= </span><span class="string">"Connection: Close\r\n\r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$response </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$out</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$response </span><span class="keyword">.= </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">128</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; global </span><span class="default">$http_response_header</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$http_response_header </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(&nbsp; </span><span class="default">stripos</span><span class="keyword">(</span><span class="default">$response</span><span class="keyword">, </span><span class="string">"\r\n\r\n"</span><span class="keyword">) !== </span><span class="default">FALSE&nbsp; </span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$hc </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">"\r\n\r\n"</span><span class="keyword">,&nbsp; </span><span class="default">$response</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$headers </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">"\r\n"</span><span class="keyword">,&nbsp; </span><span class="default">$hc</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(!</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$headers</span><span class="keyword">))</span><span class="default">$headers </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$headers </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$header</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$a </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$b </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(&nbsp; </span><span class="default">stripos</span><span class="keyword">(</span><span class="default">$header</span><span class="keyword">, </span><span class="string">":"</span><span class="keyword">) !== </span><span class="default">FALSE&nbsp; </span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; list(</span><span class="default">$a</span><span class="keyword">, </span><span class="default">$b</span><span class="keyword">) = </span><span class="default">explode</span><span class="keyword">(</span><span class="string">":"</span><span class="keyword">, </span><span class="default">$header</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$http_response_header</span><span class="keyword">[</span><span class="default">trim</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">)] = </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$b</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">end</span><span class="keyword">(</span><span class="default">$hc</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else if(&nbsp; </span><span class="default">stripos</span><span class="keyword">(</span><span class="default">$response</span><span class="keyword">, </span><span class="string">"\r\n"</span><span class="keyword">) !== </span><span class="default">FALSE&nbsp; </span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$headers </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">"\r\n"</span><span class="keyword">,&nbsp; </span><span class="default">$response</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(!</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$headers</span><span class="keyword">))</span><span class="default">$headers </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$headers </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$header</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(&nbsp; </span><span class="default">$key </span><span class="keyword">&lt; ( </span><span class="default">count</span><span class="keyword">(</span><span class="default">$headers</span><span class="keyword">) - </span><span class="default">1 </span><span class="keyword">)&nbsp; ){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$a </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$b </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(&nbsp; </span><span class="default">stripos</span><span class="keyword">(</span><span class="default">$header</span><span class="keyword">, </span><span class="string">":"</span><span class="keyword">) !== </span><span class="default">FALSE&nbsp; </span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; list(</span><span class="default">$a</span><span class="keyword">, </span><span class="default">$b</span><span class="keyword">) = </span><span class="default">explode</span><span class="keyword">(</span><span class="string">":"</span><span class="keyword">, </span><span class="default">$header</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$http_response_header</span><span class="keyword">[</span><span class="default">trim</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">)] = </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$b</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">end</span><span class="keyword">(</span><span class="default">$headers</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$response</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }</span><span class="comment">/*endfunction download*/<br />
</span><span class="keyword">}</span><span class="comment">/*endif no function download*/<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="80066""></a>
  <div class="note">
   <strong class="user">huli0401 at gmail dot com</strong>
   <a href="#80066" class="date">27-Dec-2007 06:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php
<br />
</span><span class="comment">// Check for new version
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$current_version </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">'.'</span><span class="keyword">, </span><span class="string">'1.0.00'</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$minor_revision </span><span class="keyword">= (int) </span><span class="default">$current_version</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">];
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$errno </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$errstr </span><span class="keyword">= </span><span class="default">$version_info </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$fsock </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="string">"www.exanmple.eu"</span><span class="keyword">, </span><span class="default">80</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">30</span><span class="keyword">))
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; @</span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fsock</span><span class="keyword">, </span><span class="string">"GET /ver.txt HTTP/1.1\r\n"</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; @</span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fsock</span><span class="keyword">, </span><span class="string">"HOST: www.example.eu\r\n"</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; @</span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fsock</span><span class="keyword">, </span><span class="string">"Connection: close\r\n\r\n"</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$get_info </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while (!@</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fsock</span><span class="keyword">))
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$get_info</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$version_info </span><span class="keyword">.= @</span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fsock</span><span class="keyword">, </span><span class="default">1024</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (@</span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$fsock</span><span class="keyword">, </span><span class="default">1024</span><span class="keyword">) == </span><span class="string">"\r\n"</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$get_info </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; @</span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fsock</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$version_info </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">"\n"</span><span class="keyword">, </span><span class="default">$version_info</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$latest_head_revision </span><span class="keyword">= (int) </span><span class="default">$version_info</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$latest_minor_revision </span><span class="keyword">= (int) </span><span class="default">$version_info</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">];
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$latest_version </span><span class="keyword">= (int) </span><span class="default">$version_info</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] . </span><span class="string">'.' </span><span class="keyword">. (int) </span><span class="default">$version_info</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] . </span><span class="string">'.' </span><span class="keyword">. (int) </span><span class="default">$version_info</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">];
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$latest_head_revision </span><span class="keyword">== </span><span class="default">2 </span><span class="keyword">&amp;&amp; </span><span class="default">$minor_revision </span><span class="keyword">== </span><span class="default">$latest_minor_revision</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$version_info </span><span class="keyword">= </span><span class="string">'&lt;p style="color:green"&gt;OK&lt;/p&gt;'</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$version_info </span><span class="keyword">= </span><span class="string">'&lt;p style="color:red"&gt;neaktualne'</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$version_info </span><span class="keyword">.= </span><span class="string">'&lt;br /&gt;'</span><span class="default">Latest_version_info</span><span class="string">' . $latest_version) . ' ' . sprintf(Current_version_info'</span><span class="keyword">. </span><span class="string">'1.0.00'</span><span class="keyword">) . </span><span class="string">'&lt;/p&gt;'</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; else
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$errstr</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$version_info </span><span class="keyword">= </span><span class="string">'&lt;p style="color:red"&gt;' </span><span class="keyword">. </span><span class="default">sprintf</span><span class="keyword">(</span><span class="default">Connect_socket_error</span><span class="keyword">) . </span><span class="string">'&lt;/p&gt;'</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$version_info </span><span class="keyword">= </span><span class="string">'&lt;p&gt;'</span><span class="default">Socket_functions_disabled</span><span class="string">'&lt;/p&gt;'</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$version_info </span><span class="keyword">.= </span><span class="string">'&lt;p&gt;'</span><span class="default">Mailing_list_subscribe_reminder</span><span class="string">'&lt;/p&gt;'</span><span class="keyword">;
<br />

<br />
echo </span><span class="default">$version_info</span><span class="keyword">;
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77587""></a>
  <div class="note">
   <strong class="user">anarchy</strong>
   <a href="#77587" class="date">05-Sep-2007 03:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The DEFAULT stream timeout is set according to default_socket_timeout in your php.ini file.&nbsp; Took forever for me to dig that up....</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76899""></a>
  <div class="note">
   <strong class="user">Adlez</strong>
   <a href="#76899" class="date">04-Aug-2007 10:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For those of you who do not have cURL, you might want to try this. 
<br />
It doesn't have all the functions that cURL has, but it has the basics. 
<br />
Please let me know of any bugs or problems.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">open_page</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">,</span><span class="default">$f</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">,</span><span class="default">$c</span><span class="keyword">=</span><span class="default">2</span><span class="keyword">,</span><span class="default">$r</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">,</span><span class="default">$a</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">,</span><span class="default">$cf</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">,</span><span class="default">$pd</span><span class="keyword">=</span><span class="string">""</span><span class="keyword">){
<br />
&nbsp;global </span><span class="default">$oldheader</span><span class="keyword">;
<br />
&nbsp;</span><span class="default">$url </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"<a href="http://" rel="nofollow" target="_blank">http://</a>"</span><span class="keyword">,</span><span class="string">""</span><span class="keyword">,</span><span class="default">$url</span><span class="keyword">);
<br />
&nbsp;if (</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"#/#"</span><span class="keyword">,</span><span class="string">"</span><span class="default">$url</span><span class="string">"</span><span class="keyword">)){
<br />
&nbsp; </span><span class="default">$page </span><span class="keyword">= </span><span class="default">$url</span><span class="keyword">;
<br />
&nbsp; </span><span class="default">$url </span><span class="keyword">= @</span><span class="default">explode</span><span class="keyword">(</span><span class="string">"/"</span><span class="keyword">,</span><span class="default">$url</span><span class="keyword">);
<br />
&nbsp; </span><span class="default">$url </span><span class="keyword">= </span><span class="default">$url</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];
<br />
&nbsp; </span><span class="default">$page </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">,</span><span class="string">""</span><span class="keyword">,</span><span class="default">$page</span><span class="keyword">);
<br />
&nbsp; if (!</span><span class="default">$page </span><span class="keyword">|| </span><span class="default">$page </span><span class="keyword">== </span><span class="string">""</span><span class="keyword">){
<br />
&nbsp;&nbsp; </span><span class="default">$page </span><span class="keyword">= </span><span class="string">"/"</span><span class="keyword">;
<br />
&nbsp; }
<br />
&nbsp; </span><span class="default">$ip </span><span class="keyword">= </span><span class="default">gethostbyname</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">);
<br />
&nbsp;}else{
<br />
&nbsp; </span><span class="default">$ip </span><span class="keyword">= </span><span class="default">gethostbyname</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">);
<br />
&nbsp; </span><span class="default">$page </span><span class="keyword">= </span><span class="string">"/"</span><span class="keyword">;
<br />
&nbsp;}
<br />
&nbsp;</span><span class="default">$open </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">, </span><span class="default">80</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">60</span><span class="keyword">);
<br />
&nbsp;if (</span><span class="default">$pd</span><span class="keyword">){
<br />
&nbsp; </span><span class="default">$send </span><span class="keyword">= </span><span class="string">"POST </span><span class="default">$page</span><span class="string"> HTTP/1.0\r\n"</span><span class="keyword">;
<br />
&nbsp;}else{
<br />
&nbsp; </span><span class="default">$send </span><span class="keyword">= </span><span class="string">"GET </span><span class="default">$page</span><span class="string"> HTTP/1.0\r\n"</span><span class="keyword">;
<br />
&nbsp;}
<br />
&nbsp;</span><span class="default">$send </span><span class="keyword">.= </span><span class="string">"Host: </span><span class="default">$url</span><span class="string">\r\n"</span><span class="keyword">;
<br />
&nbsp;if (</span><span class="default">$r</span><span class="keyword">){
<br />
&nbsp; </span><span class="default">$send </span><span class="keyword">.= </span><span class="string">"Referer: </span><span class="default">$r</span><span class="string">\r\n"</span><span class="keyword">;
<br />
&nbsp;}else{
<br />
&nbsp; if (</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'HTTP_REFERER'</span><span class="keyword">]){
<br />
&nbsp;&nbsp; </span><span class="default">$send </span><span class="keyword">.= </span><span class="string">"Referer: </span><span class="keyword">{</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'HTTP_REFERER'</span><span class="keyword">]}</span><span class="string">\r\n"</span><span class="keyword">;
<br />
&nbsp; }
<br />
&nbsp;}
<br />
&nbsp;if (</span><span class="default">$cf</span><span class="keyword">){
<br />
&nbsp; if (@</span><span class="default">file_exists</span><span class="keyword">(</span><span class="default">$cf</span><span class="keyword">)){
<br />
&nbsp;&nbsp; </span><span class="default">$cookie </span><span class="keyword">= </span><span class="default">urldecode</span><span class="keyword">(@</span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="default">$cf</span><span class="keyword">));
<br />
&nbsp;&nbsp; if (</span><span class="default">$cookie</span><span class="keyword">){
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$send </span><span class="keyword">.= </span><span class="string">"Cookie: </span><span class="default">$cookie</span><span class="string">\r\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$add </span><span class="keyword">= @</span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$cf</span><span class="keyword">,</span><span class="string">'w'</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$add</span><span class="keyword">,</span><span class="string">""</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$add</span><span class="keyword">);
<br />
&nbsp;&nbsp; }
<br />
&nbsp; }
<br />
&nbsp;}
<br />
&nbsp;</span><span class="default">$send </span><span class="keyword">.= </span><span class="string">"Accept-Language: en-us, en;q=0.50\r\n"</span><span class="keyword">;
<br />
&nbsp;if (</span><span class="default">$a</span><span class="keyword">){
<br />
&nbsp; </span><span class="default">$send </span><span class="keyword">.= </span><span class="string">"User-Agent: </span><span class="default">$a</span><span class="string">\r\n"</span><span class="keyword">;
<br />
&nbsp;}else{
<br />
&nbsp; </span><span class="default">$send </span><span class="keyword">.= </span><span class="string">"User-Agent: </span><span class="keyword">{</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'HTTP_USER_AGENT'</span><span class="keyword">]}</span><span class="string">\r\n"</span><span class="keyword">;
<br />
&nbsp;}
<br />
&nbsp;if (</span><span class="default">$pd</span><span class="keyword">){
<br />
&nbsp; </span><span class="default">$send </span><span class="keyword">.= </span><span class="string">"Content-Type: application/x-www-form-urlencoded\r\n"</span><span class="keyword">;&nbsp; 
<br />
&nbsp; </span><span class="default">$send </span><span class="keyword">.= </span><span class="string">"Content-Length: " </span><span class="keyword">.</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$pd</span><span class="keyword">) .</span><span class="string">"\r\n\r\n"</span><span class="keyword">;
<br />
&nbsp; </span><span class="default">$send </span><span class="keyword">.= </span><span class="default">$pd</span><span class="keyword">;
<br />
&nbsp;}else{
<br />
&nbsp; </span><span class="default">$send </span><span class="keyword">.= </span><span class="string">"Connection: Close\r\n\r\n"</span><span class="keyword">;
<br />
&nbsp;}
<br />
&nbsp;</span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$open</span><span class="keyword">, </span><span class="default">$send</span><span class="keyword">);
<br />
&nbsp;while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$open</span><span class="keyword">)) {
<br />
&nbsp; </span><span class="default">$return </span><span class="keyword">.= </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$open</span><span class="keyword">, </span><span class="default">4096</span><span class="keyword">);
<br />
&nbsp;}
<br />
&nbsp;</span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$open</span><span class="keyword">);
<br />
&nbsp;</span><span class="default">$return </span><span class="keyword">= @</span><span class="default">explode</span><span class="keyword">(</span><span class="string">"\r\n\r\n"</span><span class="keyword">,</span><span class="default">$return</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">);
<br />
&nbsp;</span><span class="default">$header </span><span class="keyword">= </span><span class="default">$return</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];
<br />
&nbsp;if (</span><span class="default">$cf</span><span class="keyword">){
<br />
&nbsp; if (</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/Set\-Cookie\: /i"</span><span class="keyword">,</span><span class="string">"</span><span class="default">$header</span><span class="string">"</span><span class="keyword">)){
<br />
&nbsp;&nbsp; </span><span class="default">$cookie </span><span class="keyword">= @</span><span class="default">explode</span><span class="keyword">(</span><span class="string">"Set-Cookie: "</span><span class="keyword">,</span><span class="default">$header</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">);
<br />
&nbsp;&nbsp; </span><span class="default">$cookie </span><span class="keyword">= </span><span class="default">$cookie</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];
<br />
&nbsp;&nbsp; </span><span class="default">$cookie </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">"\r"</span><span class="keyword">,</span><span class="default">$cookie</span><span class="keyword">);
<br />
&nbsp;&nbsp; </span><span class="default">$cookie </span><span class="keyword">= </span><span class="default">$cookie</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];
<br />
&nbsp;&nbsp; </span><span class="default">$cookie </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"path=/"</span><span class="keyword">,</span><span class="string">""</span><span class="keyword">,</span><span class="default">$cookie</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]);
<br />
&nbsp;&nbsp; </span><span class="default">$add </span><span class="keyword">= @</span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$cf</span><span class="keyword">,</span><span class="string">'a'</span><span class="keyword">);
<br />
&nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$add</span><span class="keyword">,</span><span class="default">$cookie</span><span class="keyword">,</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$read</span><span class="keyword">));
<br />
&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$add</span><span class="keyword">);
<br />
&nbsp; }
<br />
&nbsp;}
<br />
&nbsp;if (</span><span class="default">$oldheader</span><span class="keyword">){
<br />
&nbsp; </span><span class="default">$header </span><span class="keyword">= </span><span class="string">"</span><span class="default">$oldheader</span><span class="string">&lt;br /&gt;&lt;br /&gt;\n</span><span class="default">$header</span><span class="string">"</span><span class="keyword">;
<br />
&nbsp;}
<br />
&nbsp;</span><span class="default">$header </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"\n"</span><span class="keyword">,</span><span class="string">"&lt;br /&gt;"</span><span class="keyword">,</span><span class="default">$header</span><span class="keyword">);
<br />
&nbsp;if (</span><span class="default">$return</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]){
<br />
&nbsp; </span><span class="default">$body </span><span class="keyword">= </span><span class="default">$return</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];
<br />
&nbsp;}else{
<br />
&nbsp; </span><span class="default">$body </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;
<br />
&nbsp;}
<br />
&nbsp;if (</span><span class="default">$c </span><span class="keyword">=== </span><span class="default">2</span><span class="keyword">){
<br />
&nbsp; if (</span><span class="default">$body</span><span class="keyword">){
<br />
&nbsp;&nbsp; </span><span class="default">$return </span><span class="keyword">= </span><span class="default">$body</span><span class="keyword">;
<br />
&nbsp; }else{
<br />
&nbsp;&nbsp; </span><span class="default">$return </span><span class="keyword">= </span><span class="default">$header</span><span class="keyword">;
<br />
&nbsp; }
<br />
&nbsp;}
<br />
&nbsp;if (</span><span class="default">$c </span><span class="keyword">=== </span><span class="default">1</span><span class="keyword">){
<br />
&nbsp; </span><span class="default">$return </span><span class="keyword">= </span><span class="default">$header</span><span class="keyword">;
<br />
&nbsp;}
<br />
&nbsp;if (</span><span class="default">$c </span><span class="keyword">=== </span><span class="default">3</span><span class="keyword">){
<br />
&nbsp; </span><span class="default">$return </span><span class="keyword">= </span><span class="string">"</span><span class="default">$header$body</span><span class="string">"</span><span class="keyword">;
<br />
&nbsp;}
<br />
&nbsp;if (</span><span class="default">$f</span><span class="keyword">){
<br />
&nbsp; if (</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/Location\:/"</span><span class="keyword">,</span><span class="string">"</span><span class="default">$header</span><span class="string">"</span><span class="keyword">)){
<br />
&nbsp;&nbsp; </span><span class="default">$url </span><span class="keyword">= @</span><span class="default">explode</span><span class="keyword">(</span><span class="string">"Location: "</span><span class="keyword">,</span><span class="default">$header</span><span class="keyword">);
<br />
&nbsp;&nbsp; </span><span class="default">$url </span><span class="keyword">= </span><span class="default">$url</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];
<br />
&nbsp;&nbsp; </span><span class="default">$url </span><span class="keyword">= @</span><span class="default">explode</span><span class="keyword">(</span><span class="string">"\r"</span><span class="keyword">,</span><span class="default">$url</span><span class="keyword">);
<br />
&nbsp;&nbsp; </span><span class="default">$url </span><span class="keyword">= </span><span class="default">$url</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];
<br />
&nbsp;&nbsp; </span><span class="default">$oldheader </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"\r\n\r\n"</span><span class="keyword">,</span><span class="string">""</span><span class="keyword">,</span><span class="default">$header</span><span class="keyword">);
<br />
&nbsp;&nbsp; </span><span class="default">$l </span><span class="keyword">= </span><span class="string">"&amp;#76&amp;#111&amp;#99&amp;#97&amp;#116&amp;#105&amp;#111&amp;#110&amp;#58"</span><span class="keyword">;
<br />
&nbsp;&nbsp; </span><span class="default">$oldheader </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"Location:"</span><span class="keyword">,</span><span class="default">$l</span><span class="keyword">,</span><span class="default">$oldheader</span><span class="keyword">);
<br />
&nbsp;&nbsp; return </span><span class="default">open_page</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">,</span><span class="default">$f</span><span class="keyword">,</span><span class="default">$c</span><span class="keyword">,</span><span class="default">$r</span><span class="keyword">,</span><span class="default">$a</span><span class="keyword">,</span><span class="default">$cf</span><span class="keyword">,</span><span class="default">$pd</span><span class="keyword">);
<br />
&nbsp; }else{
<br />
&nbsp;&nbsp; return </span><span class="default">$return</span><span class="keyword">;
<br />
&nbsp; }
<br />
&nbsp;}else{
<br />
&nbsp; return </span><span class="default">$return</span><span class="keyword">;
<br />
&nbsp;}
<br />
}
<br />
</span><span class="comment">/////////////
<br />
////Usage////
<br />
/////////////
<br />
</span><span class="default">$url </span><span class="keyword">= </span><span class="string">"<a href="http://www.php.net" rel="nofollow" target="_blank">http://www.php.net</a>"</span><span class="keyword">;
<br />
</span><span class="default">$f </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;
<br />
</span><span class="default">$c </span><span class="keyword">= </span><span class="default">2</span><span class="keyword">;</span><span class="comment">//1 for header, 2 for body, 3 for both
<br />
</span><span class="default">$r </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">;
<br />
</span><span class="default">$a </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">;
<br />
</span><span class="default">$cf </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">;
<br />
</span><span class="default">$pd </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">;
<br />
</span><span class="default">$page </span><span class="keyword">= </span><span class="default">open_page</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">,</span><span class="default">$f</span><span class="keyword">,</span><span class="default">$c</span><span class="keyword">,</span><span class="default">$r</span><span class="keyword">,</span><span class="default">$a</span><span class="keyword">,</span><span class="default">$cf</span><span class="keyword">,</span><span class="default">$pd</span><span class="keyword">);
<br />
print </span><span class="default">$page</span><span class="keyword">;
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76626""></a>
  <div class="note">
   <strong class="user">bradland at umich dot edu</strong>
   <a href="#76626" class="date">23-Jul-2007 06:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I was having trouble doing an https in fopen and with fsockopen where the address had ssl://.&nbsp; I was getting error code 114 in the log.&nbsp; After much research i found that there was some ssl conflict trouble with MySQL 5.0.20-5.0.33.&nbsp; It had some functions that were interfering with openssl that showed up in the php install.<br />
<br />
<a href="http://bugs.mysql.com/bug.php?id=21930" rel="nofollow" target="_blank">http://bugs.mysql.com/bug.php?id=21930</a><br />
<a href="http://bugs.mysql.com/bug.php?id=19289" rel="nofollow" target="_blank">http://bugs.mysql.com/bug.php?id=19289</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76468""></a>
  <div class="note">
   <strong class="user">warezthebeef at gmail dot com</strong>
   <a href="#76468" class="date">17-Jul-2007 01:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I ran into a problem where I needed to make an fsockopen() style connection from one specific ip address on a server with multiple ip aliases. Unfortunately fsockopen() does not allow the specification of a source address making it unsuitable. I could not find any other solutions elsewhere so here is mine for those with php 5.1.0 or greater.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="comment">// connect to the internet using the '192.168.0.100' IP
<br />
</span><span class="default">$opts </span><span class="keyword">= array(</span><span class="string">'socket' </span><span class="keyword">=&gt; array(</span><span class="string">'bindto' </span><span class="keyword">=&gt; </span><span class="string">'192.168.0.100:0'</span><span class="keyword">));
<br />

<br />
</span><span class="default">$context </span><span class="keyword">= </span><span class="default">stream_context_create</span><span class="keyword">(</span><span class="default">$opts</span><span class="keyword">);
<br />

<br />
</span><span class="default">$fp </span><span class="keyword">= </span><span class="default">stream_socket_client</span><span class="keyword">(</span><span class="string">"tcp://www.example.com:80"</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">30</span><span class="keyword">, </span><span class="default">STREAM_CLIENT_CONNECT</span><span class="keyword">, </span><span class="default">$context</span><span class="keyword">);
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Now $fp can be used like a resource handle returned by a vanilla fsockopen() call!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75388""></a>
  <div class="note">
   <strong class="user">Alexander Wegener</strong>
   <a href="#75388" class="date">26-May-2007 04:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To check if a Url is Online (with http and https)<br />
Using @fgets to hide Warning when using SSL<br />
(Bug: "Warning: function.fgets SSL: fatal protocol error", <a href="http://bugs.php.net/bug.php?id=23220" rel="nofollow" target="_blank">http://bugs.php.net/bug.php?id=23220</a>)<br />
<br />
<span class="default">&lt;?php<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">isOnline</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">$url_info </span><span class="keyword">= </span><span class="default">parse_url</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; switch (</span><span class="default">$url_info</span><span class="keyword">[</span><span class="string">'scheme'</span><span class="keyword">]) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'https'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$scheme </span><span class="keyword">= </span><span class="string">'ssl://'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$port </span><span class="keyword">= </span><span class="default">443</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'http'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; default:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$scheme </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$port </span><span class="keyword">= </span><span class="default">80</span><span class="keyword">;&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fid </span><span class="keyword">= @</span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$scheme </span><span class="keyword">. </span><span class="default">$url_info</span><span class="keyword">[</span><span class="string">'host'</span><span class="keyword">], </span><span class="default">$port</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">30</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$fid</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fid</span><span class="keyword">, </span><span class="string">'HEAD ' </span><span class="keyword">. (isset(</span><span class="default">$url_info</span><span class="keyword">[</span><span class="string">'path'</span><span class="keyword">])? </span><span class="default">$url_info</span><span class="keyword">[</span><span class="string">'path'</span><span class="keyword">]: </span><span class="string">'/'</span><span class="keyword">) . (isset(</span><span class="default">$url_info</span><span class="keyword">[</span><span class="string">'query'</span><span class="keyword">])? </span><span class="string">'?' </span><span class="keyword">. </span><span class="default">$url_info</span><span class="keyword">[</span><span class="string">'query'</span><span class="keyword">]: </span><span class="string">''</span><span class="keyword">) . </span><span class="string">" HTTP/1.0\r\n" </span><span class="keyword">. <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"Connection: close\r\n" </span><span class="keyword">. <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'Host: ' </span><span class="keyword">. </span><span class="default">$url_info</span><span class="keyword">[</span><span class="string">'host'</span><span class="keyword">] . </span><span class="string">"\r\n\r\n"</span><span class="keyword">);&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fid</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">.= @</span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$fid</span><span class="keyword">, </span><span class="default">128</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fid</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return !empty(</span><span class="default">$data</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; } <br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="72674""></a>
  <div class="note">
   <strong class="user">ryan1_00 at hotmail dot com</strong>
   <a href="#72674" class="date">29-Jan-2007 04:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This script checks specific ports so you need to have the correct port open on the server for this to work.
<br />

<br />
E.g if i have a windows domain controller and it is servering LDAP then the following would be used to check it is online:
<br />
<span class="default">&lt;?php
<br />
chkServer</span><span class="keyword">(</span><span class="string">"MyDC"</span><span class="keyword">, </span><span class="string">"389"</span><span class="keyword">);
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
for a webserver:
<br />
<span class="default">&lt;?php
<br />
chkServer</span><span class="keyword">(</span><span class="string">"MyWebSvr"</span><span class="keyword">, </span><span class="string">"80"</span><span class="keyword">);
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
etc etc
<br />
--------------------------------------------------------
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="comment">// check if a server is up by connecting to a port
<br />
</span><span class="keyword">function </span><span class="default">chkServer</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">)
<br />
{&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$hostip </span><span class="keyword">= @</span><span class="default">gethostbyname</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">); </span><span class="comment">// resloves IP from Hostname returns hostname on failure
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$hostip </span><span class="keyword">== </span><span class="default">$host</span><span class="keyword">) </span><span class="comment">// if the IP is not resloved
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">{
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Server is down or does not exist"</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; else
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">$x </span><span class="keyword">= @</span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$hostip</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">5</span><span class="keyword">)) </span><span class="comment">// attempt to connect
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">{
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Server is down"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Server is up"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$x</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; @</span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">); </span><span class="comment">//close connection
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">}
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; }
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="72576""></a>
  <div class="note">
   <strong class="user">v13+phpnet at it dot teithe dot gr</strong>
   <a href="#72576" class="date">25-Jan-2007 12:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The following function performs pop3 authentication. Returns NULL on error, or true/false to indicate username/password matching:<br />
<br />
$address is the hostname of the server and $ssl is a boolean that indicates whether an SSL connection is requested.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">pop3authCheck</span><span class="keyword">(</span><span class="default">$username</span><span class="keyword">, </span><span class="default">$password</span><span class="keyword">, </span><span class="default">$address</span><span class="keyword">, </span><span class="default">$ssl</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$ssl</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$uri</span><span class="keyword">=</span><span class="string">"ssl://</span><span class="default">$address</span><span class="string">:995"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$uri</span><span class="keyword">=</span><span class="string">"tcp://</span><span class="default">$address</span><span class="string">:110"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fp</span><span class="keyword">=</span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$uri</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; if (!</span><span class="default">$fp</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return(</span><span class="default">NULL</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$st</span><span class="keyword">=</span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">512</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$st</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">)!=</span><span class="string">"+OK"</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return(</span><span class="default">NULL</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$st</span><span class="keyword">=</span><span class="string">"USER </span><span class="default">$username</span><span class="string">\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$st</span><span class="keyword">)!=</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$st</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return(</span><span class="default">NULL</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$st</span><span class="keyword">=</span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">512</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$st</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">)!=</span><span class="string">"+OK"</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return(</span><span class="default">NULL</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$st</span><span class="keyword">=</span><span class="string">"PASS </span><span class="default">$password</span><span class="string">\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$st</span><span class="keyword">)!=</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$st</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return(</span><span class="default">NULL</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$st</span><span class="keyword">=</span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">512</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$st</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">)==</span><span class="string">"+OK"</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return(</span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; else if (</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$st</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">4</span><span class="keyword">)==</span><span class="string">"+ERR"</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return(</span><span class="default">false</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return(</span><span class="default">NULL</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71532""></a>
  <div class="note">
   
   <a href="#71532" class="date">04-Dec-2006 05:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I've had issues with some of the handlers for chunked http 1.1 responses.&nbsp; Here's a method that worked for me, if it works for you as well, then cheers :P<br />
<br />
<span class="default">&lt;?php<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">httpSocketConnection</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">, </span><span class="default">$method</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$method </span><span class="keyword">= </span><span class="default">strtoupper</span><span class="keyword">(</span><span class="default">$method</span><span class="keyword">);&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$method </span><span class="keyword">== </span><span class="string">"GET"</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$path</span><span class="keyword">.= </span><span class="string">'?'</span><span class="keyword">.</span><span class="default">$data</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$filePointer </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">, </span><span class="default">80</span><span class="keyword">, </span><span class="default">$errorNumber</span><span class="keyword">, </span><span class="default">$errorString</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">$filePointer</span><span class="keyword">) <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">logEvent</span><span class="keyword">(</span><span class="string">'debug'</span><span class="keyword">, </span><span class="string">'Failed opening http socket connection: '</span><span class="keyword">.</span><span class="default">$errorString</span><span class="keyword">.</span><span class="string">' ('</span><span class="keyword">.</span><span class="default">$errorNumber</span><span class="keyword">.</span><span class="string">')&lt;br/&gt;\n'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$requestHeader </span><span class="keyword">= </span><span class="default">$method</span><span class="keyword">.</span><span class="string">" "</span><span class="keyword">.</span><span class="default">$path</span><span class="keyword">.</span><span class="string">"&nbsp; HTTP/1.1\r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$requestHeader</span><span class="keyword">.= </span><span class="string">"Host: "</span><span class="keyword">.</span><span class="default">$host</span><span class="keyword">.</span><span class="string">"\r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$requestHeader</span><span class="keyword">.= </span><span class="string">"User-Agent:&nbsp; &nbsp; &nbsp; Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1) Gecko/20061010 Firefox/2.0\r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$requestHeader</span><span class="keyword">.= </span><span class="string">"Content-Type: application/x-www-form-urlencoded\r\n"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$method </span><span class="keyword">== </span><span class="string">"POST"</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$requestHeader</span><span class="keyword">.= </span><span class="string">"Content-Length: "</span><span class="keyword">.</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">).</span><span class="string">"\r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$requestHeader</span><span class="keyword">.= </span><span class="string">"Connection: close\r\n\r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$method </span><span class="keyword">== </span><span class="string">"POST"</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$requestHeader</span><span class="keyword">.= </span><span class="default">$data</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$filePointer</span><span class="keyword">, </span><span class="default">$requestHeader</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$responseHeader </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$responseContent </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; do <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$responseHeader</span><span class="keyword">.= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$filePointer</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">); <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while (!</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'/\\r\\n\\r\\n$/'</span><span class="keyword">, </span><span class="default">$responseHeader</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">strstr</span><span class="keyword">(</span><span class="default">$responseHeader</span><span class="keyword">, </span><span class="string">"Transfer-Encoding: chunked"</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$filePointer</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$responseContent</span><span class="keyword">.= </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$filePointer</span><span class="keyword">, </span><span class="default">128</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; while (</span><span class="default">$chunk_length </span><span class="keyword">= </span><span class="default">hexdec</span><span class="keyword">(</span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$filePointer</span><span class="keyword">))) <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$responseContentChunk </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">logEventToTextFile</span><span class="keyword">(</span><span class="string">'debug'</span><span class="keyword">, </span><span class="default">$chunk_length</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$read_length </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; while (</span><span class="default">$read_length </span><span class="keyword">&lt; </span><span class="default">$chunk_length</span><span class="keyword">) <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$responseContentChunk </span><span class="keyword">.= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$filePointer</span><span class="keyword">, </span><span class="default">$chunk_length </span><span class="keyword">- </span><span class="default">$read_length</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$read_length </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$responseContentChunk</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$responseContent</span><span class="keyword">.= </span><span class="default">$responseContentChunk</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$filePointer</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">logEventToTextFile</span><span class="keyword">(</span><span class="string">'debug'</span><span class="keyword">, </span><span class="default">$responseContent</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">chop</span><span class="keyword">(</span><span class="default">$responseContent</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="64094""></a>
  <div class="note">
   <strong class="user">yadiutama_skom at yahoo dot com</strong>
   <a href="#64094" class="date">07-Apr-2006 11:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is a simple example for sending and retrieve SOAP message by using fsockopen:<br />
<br />
<span class="default">&lt;?php<br />
$fp </span><span class="keyword">= @</span><span class="default">fsockopen</span><span class="keyword">(</span><span class="string">"www.example.com"</span><span class="keyword">, </span><span class="default">80</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">);<br />
if (!</span><span class="default">$fp</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"</span><span class="default">$errstr</span><span class="string"> (</span><span class="default">$errno</span><span class="string">)&lt;br /&gt;\n"</span><span class="keyword">;<br />
} else {<br />
<br />
</span><span class="default">$soap_out&nbsp; </span><span class="keyword">= </span><span class="string">"POST /example/exampleServer.php HTTP/1.0\r\n"</span><span class="keyword">;<br />
</span><span class="default">$soap_out </span><span class="keyword">.= </span><span class="string">"Host: www.example.com\r\n"</span><span class="keyword">;<br />
</span><span class="default">$soap_out </span><span class="keyword">.= </span><span class="string">"User-Agent: MySOAPisOKGuys \r\n"</span><span class="keyword">;<br />
</span><span class="default">$soap_out </span><span class="keyword">.= </span><span class="string">"Content-Type: text/xml; charset=ISO-8859-1\r\n"</span><span class="keyword">;<br />
</span><span class="default">$soap_out </span><span class="keyword">.= </span><span class="string">"Content-Length: 512\r\n\r\n"</span><span class="keyword">;<br />
</span><span class="default">$soap_out </span><span class="keyword">.= </span><span class="string">'&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;<br />
&lt;SOAP-ENV:Envelope SOAP-ENV:encodingStyle="<a href="http://schemas.xmlsoap.org/soap/encoding/" rel="nofollow" target="_blank">http://schemas.xmlsoap.org/soap/encoding/</a>" xmlns:SOAP-ENV="<a href="http://schemas.xmlsoap.org/soap/envelope/" rel="nofollow" target="_blank">http://schemas.xmlsoap.org/soap/envelope/</a>" xmlns:xsd="<a href="http://www.w3.org/2001/XMLSchema" rel="nofollow" target="_blank">http://www.w3.org/2001/XMLSchema</a>" xmlns:xsi="<a href="http://www.w3.org/2001/XMLSchema-instance" rel="nofollow" target="_blank">http://www.w3.org/2001/XMLSchema-instance</a>" xmlns:SOAP-ENC="<a href="http://schemas.xmlsoap.org/soap/encoding/" rel="nofollow" target="_blank">http://schemas.xmlsoap.org/soap/encoding/</a>"&gt;<br />
&lt;SOAP-ENV:Body&gt;<br />
&lt;ns5973:contact xmlns:ns5973="<a href="http://tempuri.org" rel="nofollow" target="_blank">http://tempuri.org</a>"&gt;<br />
&lt;__numeric_0&gt;&lt;id&nbsp; xsi:nil="true"/&gt;&lt;/__numeric_0&gt;<br />
&lt;/ns5973:contact&gt;<br />
&lt;/SOAP-ENV:Body&gt;<br />
&lt;/SOAP-ENV:Envelope&gt;'</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$soap_out</span><span class="keyword">, </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$soap_out</span><span class="keyword">));&nbsp; </span><span class="comment">// send request SOAP<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">echo </span><span class="string">"&lt;xmp&gt;"</span><span class="keyword">.</span><span class="default">$out</span><span class="keyword">.</span><span class="string">"&lt;/xmp&gt;"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$soap_in </span><span class="keyword">. = </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">100</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"&lt;xmp&gt;</span><span class="default">$soap_in</span><span class="string">&lt;/xmp&gt;"</span><span class="keyword">;&nbsp;&nbsp; </span><span class="comment">//display response SOAP<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;</span> <br />
<br />
And this is an example result:<br />
<br />
POST /soap/example/contactServer.php HTTP/1.0<br />
Host: www.example.com<br />
User-Agent: MySOAPisOKGuys<br />
Content-Type: text/xml; charset=ISO-8859-1<br />
Content-Length: 512<br />
&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;<br />
&lt;SOAP-ENV:Envelope<br />
SOAP-ENV:encodingStyle="<a href="http://schemas.xmlsoap.org/soap/encoding/" rel="nofollow" target="_blank">http://schemas.xmlsoap.org/soap/encoding/</a>"<br />
xmlns:SOAP-ENV="<a href="http://schemas.xmlsoap.org/soap/envelope/" rel="nofollow" target="_blank">http://schemas.xmlsoap.org/soap/envelope/</a>"<br />
xmlns:xsd="<a href="http://www.w3.org/2001/XMLSchema" rel="nofollow" target="_blank">http://www.w3.org/2001/XMLSchema</a>"<br />
xmlns:xsi="<a href="http://www.w3.org/2001/XMLSchema-instance" rel="nofollow" target="_blank">http://www.w3.org/2001/XMLSchema-instance</a>"<br />
xmlns:SOAP-ENC="<a href="http://schemas.xmlsoap.org/soap/encoding/" rel="nofollow" target="_blank">http://schemas.xmlsoap.org/soap/encoding/</a>"&gt;<br />
&lt;SOAP-ENV:Body&gt;&lt;ns5973:contact<br />
xmlns:ns5973="<a href="http://tempuri.org" rel="nofollow" target="_blank">http://tempuri.org</a>"&gt;&lt;__numeric_0&gt;&lt;id<br />
xsi:nil="true"/&gt;&lt;/__numeric_0&gt;&lt;/ns5973:contact&gt;<br />
&lt;/SOAP-ENV:Body&gt;<br />
&lt;/SOAP-ENV:Envelope&gt;<br />
<br />
HTTP/1.1 200 OK<br />
Date: Thu, 06 Apr 2006 07:03:26 GMT<br />
Server: Apache/1.3.23 (Win32)<br />
X-Powered-By: PHP/4.1.1<br />
X-SOAP-Server: MySOAPisOKGuys<br />
Content-Length: 625<br />
Connection: close<br />
Content-Type: text/xml; charset=ISO-8859-1<br />
&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;<br />
&lt;SOAP-ENV:Envelope<br />
SOAP-ENV:encodingStyle="<a href="http://schemas.xmlsoap.org/soap/encoding/" rel="nofollow" target="_blank">http://schemas.xmlsoap.org/soap/encoding/</a>"<br />
xmlns:SOAP-ENV="<a href="http://schemas.xmlsoap.org/soap/envelope/" rel="nofollow" target="_blank">http://schemas.xmlsoap.org/soap/envelope/</a>"<br />
xmlns:xsd="<a href="http://www.w3.org/2001/XMLSchema" rel="nofollow" target="_blank">http://www.w3.org/2001/XMLSchema</a>"<br />
xmlns:xsi="<a href="http://www.w3.org/2001/XMLSchema-instance" rel="nofollow" target="_blank">http://www.w3.org/2001/XMLSchema-instance</a>"<br />
xmlns:SOAP-ENC="<a href="http://schemas.xmlsoap.org/soap/encoding/" rel="nofollow" target="_blank">http://schemas.xmlsoap.org/soap/encoding/</a>"&gt;<br />
&lt;SOAP-ENV:Body&gt;&lt;ns1:contactResponse<br />
xmlns:ns1="<a href="http://tempuri.org" rel="nofollow" target="_blank">http://tempuri.org</a>"&gt;<br />
&lt;return xsi:type="xsd:string"&gt;<br />
&lt;/return&gt;<br />
&lt;/ns1:contactResponse&gt;<br />
&lt;/SOAP-ENV:Body&gt;<br />
&lt;/SOAP-ENV:Envelope&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="62380""></a>
  <div class="note">
   <strong class="user">Duukkis</strong>
   <a href="#62380" class="date">27-Feb-2006 02:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Lots of tries and lots of reading http-headers...<br />
<br />
If you want to post $_POST vars and (in this case) one file named userfile to $remote_server and $remote_url.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// get the necessary data<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$file_name </span><span class="keyword">= </span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'userfile'</span><span class="keyword">][</span><span class="string">'name'</span><span class="keyword">];&nbsp; &nbsp;&nbsp; </span><span class="comment">// the file<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tmp_name </span><span class="keyword">= </span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'userfile'</span><span class="keyword">][</span><span class="string">'tmp_name'</span><span class="keyword">];&nbsp; &nbsp;&nbsp; </span><span class="comment">// the file<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$content_type </span><span class="keyword">= </span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'userfile'</span><span class="keyword">][</span><span class="string">'type'</span><span class="keyword">];&nbsp; &nbsp;&nbsp; </span><span class="comment">// the file mime type<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">srand</span><span class="keyword">((double)</span><span class="default">microtime</span><span class="keyword">()*</span><span class="default">1000000</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$boundary </span><span class="keyword">= </span><span class="string">"---------------------"</span><span class="keyword">.</span><span class="default">substr</span><span class="keyword">(</span><span class="default">md5</span><span class="keyword">(</span><span class="default">rand</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,</span><span class="default">32000</span><span class="keyword">)),</span><span class="default">0</span><span class="keyword">,</span><span class="default">10</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Build the header<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$header </span><span class="keyword">= </span><span class="string">"POST </span><span class="default">$remote_url</span><span class="string"> HTTP/1.0\r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$header </span><span class="keyword">.= </span><span class="string">"Host: </span><span class="default">$remote_server</span><span class="string">\r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$header </span><span class="keyword">.= </span><span class="string">"Content-type: multipart/form-data, boundary=</span><span class="default">$boundary</span><span class="string">\r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// attach post vars<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">foreach(</span><span class="default">$_POST </span><span class="keyword">AS </span><span class="default">$index </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">.=</span><span class="string">"--</span><span class="default">$boundary</span><span class="string">\r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">.= </span><span class="string">"Content-Disposition: form-data; name=\""</span><span class="keyword">.</span><span class="default">$index</span><span class="keyword">.</span><span class="string">"\"\r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">.= </span><span class="string">"\r\n"</span><span class="keyword">.</span><span class="default">$value</span><span class="keyword">.</span><span class="string">"\r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">.=</span><span class="string">"--</span><span class="default">$boundary</span><span class="string">\r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// and attach the file<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">.= </span><span class="string">"--</span><span class="default">$boundary</span><span class="string">\r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$content_file </span><span class="keyword">= </span><span class="default">join</span><span class="keyword">(</span><span class="string">""</span><span class="keyword">, </span><span class="default">file</span><span class="keyword">(</span><span class="default">$tmp_name</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">.=</span><span class="string">"Content-Disposition: form-data; name=\"userfile\"; filename=\"</span><span class="default">$file_name</span><span class="string">\"\r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">.= </span><span class="string">"Content-Type: </span><span class="default">$content_type</span><span class="string">\r\n\r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">.= </span><span class="string">""</span><span class="keyword">.</span><span class="default">$content_file</span><span class="keyword">.</span><span class="string">"\r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">.=</span><span class="string">"--</span><span class="default">$boundary</span><span class="string">--\r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$header </span><span class="keyword">.= </span><span class="string">"Content-length: " </span><span class="keyword">. </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">) . </span><span class="string">"\r\n\r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Open the connection<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$remote_server</span><span class="keyword">, </span><span class="default">80</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// then just <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$header</span><span class="keyword">.</span><span class="default">$data</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="61957""></a>
  <div class="note">
   <strong class="user">ittasks at gmail dot com</strong>
   <a href="#61957" class="date">16-Feb-2006 01:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
login to the site prior to downloading page:
<br />

<br />
In some wierd situations site security is based on
<br />
&nbsp;ASPSESSION ID and where could be a
<br />
&nbsp;login asp&nbsp; script in one place, and the actual page with 
<br />
information in another place.
<br />

<br />
for such cases you have to submit ( POST ) you login and 
<br />
password first, when grab ASP session (and also some 
<br />
cookies from response, and when use that ASP SESSION in 
<br />
second request to the actual page: (i took some parts of 
<br />
codes from other ppl)
<br />
<span class="default">&lt;?php 
<br />
</span><span class="comment">//submit login form: (url, post data, extra headers (optional))
<br />
//do not put&nbsp; http into URL, just domain name
<br />
</span><span class="default">$mycookies </span><span class="keyword">= </span><span class="default">GetCookies</span><span class="keyword">(</span><span class="string">"www.yourdomain.com/login.login.asp"</span><span class="keyword">,
<br />
</span><span class="string">"password=12345&amp;username=your_username&amp;submit=LOGIN&amp;set=Y"</span><span class="keyword">,</span><span class="string">""</span><span class="keyword">);
<br />
</span><span class="comment">//some extra params if you need them
<br />
// echo "Cookies:&lt;br&gt;&lt;pre&gt;\n".$mycookies."\n&lt;/pre&gt;";
<br />
//$body =PostPage("www.example.com/coolpage.asp",
<br />
//"action=zzz",$mycookies);
<br />
//echo "&lt;br&gt;Body:&lt;br&gt;\n".$body."\n";
<br />
//im using get page - so it goes like this:
<br />
</span><span class="default">$opts </span><span class="keyword">= array(</span><span class="string">'http'</span><span class="keyword">=&gt;array(</span><span class="string">'method'</span><span class="keyword">=&gt;</span><span class="string">"GET"</span><span class="keyword">,
<br />
</span><span class="string">'header'</span><span class="keyword">=&gt;</span><span class="string">"Accept-language: en\r\nCookie: "</span><span class="keyword">.</span><span class="default">$mycookies</span><span class="keyword">.</span><span class="string">"\r\n" </span><span class="keyword">));
<br />
</span><span class="default">$context </span><span class="keyword">= </span><span class="default">stream_context_create</span><span class="keyword">(</span><span class="default">$opts</span><span class="keyword">);
<br />
</span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="string">'<a href="http://www.example.com/coolpage.asp?p1=1&amp;p2=23" rel="nofollow" target="_blank">http://www.example.com/coolpage.asp?p1=1&amp;p2=23</a>'</span><span class="keyword">, </span><span class="string">'r'</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">, </span><span class="default">$context</span><span class="keyword">);
<br />
</span><span class="default">fpassthru</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);
<br />
</span><span class="default">$html </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">1000000</span><span class="keyword">);
<br />
</span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);
<br />
echo </span><span class="default">$html</span><span class="keyword">;
<br />

<br />
function </span><span class="default">PostPage</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">,</span><span class="default">$query</span><span class="keyword">,</span><span class="default">$others</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">){
<br />
&nbsp;&nbsp; </span><span class="default">$path</span><span class="keyword">=</span><span class="default">explode</span><span class="keyword">(</span><span class="string">'/'</span><span class="keyword">,</span><span class="default">$host</span><span class="keyword">);
<br />
&nbsp;&nbsp; </span><span class="default">$host</span><span class="keyword">=</span><span class="default">$path</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];
<br />
&nbsp;&nbsp; unset(</span><span class="default">$path</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]);
<br />
&nbsp;&nbsp; </span><span class="default">$path</span><span class="keyword">=</span><span class="string">'/'</span><span class="keyword">.(</span><span class="default">implode</span><span class="keyword">(</span><span class="string">'/'</span><span class="keyword">,</span><span class="default">$path</span><span class="keyword">));
<br />
</span><span class="default">$post</span><span class="keyword">=</span><span class="string">"POST </span><span class="default">$path</span><span class="string"> HTTP/1.1\r\nHost: </span><span class="default">$host</span><span class="string">\r\n"</span><span class="keyword">;
<br />
</span><span class="default">$post</span><span class="keyword">.=</span><span class="string">"Content-type: application/x-www-form-"</span><span class="keyword">;
<br />
</span><span class="default">$post</span><span class="keyword">.=</span><span class="string">"urlencoded\r\n</span><span class="keyword">${</span><span class="default">others</span><span class="keyword">}</span><span class="string">"</span><span class="keyword">;
<br />
</span><span class="default">$post</span><span class="keyword">.=</span><span class="string">"User-Agent: Mozilla 4.0\r\nContent-length: "</span><span class="keyword">;
<br />
</span><span class="default">$post</span><span class="keyword">.=</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">).</span><span class="string">"\r\nConnection: close\r\n\r\n</span><span class="default">$query</span><span class="string">"</span><span class="keyword">;
<br />
&nbsp;&nbsp; </span><span class="default">$h</span><span class="keyword">=</span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">,</span><span class="default">80</span><span class="keyword">);
<br />
&nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$h</span><span class="keyword">,</span><span class="default">$post</span><span class="keyword">);
<br />
&nbsp;&nbsp; for(</span><span class="default">$a</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">,</span><span class="default">$r</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">;!</span><span class="default">$a</span><span class="keyword">;){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$b</span><span class="keyword">=</span><span class="default">fread</span><span class="keyword">(</span><span class="default">$h</span><span class="keyword">,</span><span class="default">8192</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$r</span><span class="keyword">.=</span><span class="default">$b</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$a</span><span class="keyword">=((</span><span class="default">$b</span><span class="keyword">==</span><span class="string">''</span><span class="keyword">)?</span><span class="default">1</span><span class="keyword">:</span><span class="default">0</span><span class="keyword">);
<br />
&nbsp;&nbsp; }
<br />
&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$h</span><span class="keyword">);
<br />
&nbsp;&nbsp; return </span><span class="default">$r</span><span class="keyword">;
<br />
}
<br />
function </span><span class="default">GetCookies</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">,</span><span class="default">$query</span><span class="keyword">,</span><span class="default">$others</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">){
<br />
&nbsp;&nbsp; </span><span class="default">$path</span><span class="keyword">=</span><span class="default">explode</span><span class="keyword">(</span><span class="string">'/'</span><span class="keyword">,</span><span class="default">$host</span><span class="keyword">);
<br />
&nbsp;&nbsp; </span><span class="default">$host</span><span class="keyword">=</span><span class="default">$path</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];
<br />
&nbsp;&nbsp; unset(</span><span class="default">$path</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]);
<br />
&nbsp;&nbsp; </span><span class="default">$crlf </span><span class="keyword">= </span><span class="string">"\r\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; </span><span class="default">$path</span><span class="keyword">=</span><span class="string">'/'</span><span class="keyword">.(</span><span class="default">implode</span><span class="keyword">(</span><span class="string">'/'</span><span class="keyword">,</span><span class="default">$path</span><span class="keyword">));
<br />
&nbsp;&nbsp; </span><span class="default">$post</span><span class="keyword">=</span><span class="string">"POST </span><span class="default">$path</span><span class="string"> HTTP/1.1\r\nHost: </span><span class="default">$host</span><span class="string">\r\n"</span><span class="keyword">;
<br />
</span><span class="default">$post</span><span class="keyword">.=</span><span class="string">"Content-type: application/x-www-form-urlencoded\r\n</span><span class="keyword">${</span><span class="default">others</span><span class="keyword">}</span><span class="string">"</span><span class="keyword">;
<br />
</span><span class="default">$post</span><span class="keyword">.=</span><span class="string">"User-Agent: Mozilla 4.0\r\nContent-length: "</span><span class="keyword">;
<br />
</span><span class="default">$post</span><span class="keyword">.=</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">).</span><span class="string">"\r\nConnection: close\r\n\r\n</span><span class="default">$query</span><span class="string">"</span><span class="keyword">;
<br />
&nbsp;&nbsp; </span><span class="default">$h</span><span class="keyword">=</span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">,</span><span class="default">80</span><span class="keyword">);
<br />
&nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$h</span><span class="keyword">,</span><span class="default">$post</span><span class="keyword">);
<br />
&nbsp;&nbsp; </span><span class="default">$r</span><span class="keyword">=</span><span class="string">""</span><span class="keyword">; 
<br />
&nbsp;&nbsp; for(</span><span class="default">$a</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;!</span><span class="default">$a</span><span class="keyword">;){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$b</span><span class="keyword">=</span><span class="default">fread</span><span class="keyword">(</span><span class="default">$h</span><span class="keyword">,</span><span class="default">512</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; echo </span><span class="default">$b</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$r</span><span class="keyword">.=</span><span class="default">$b</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$gotSession</span><span class="keyword">=</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$r</span><span class="keyword">,</span><span class="string">"ASPSESSION"</span><span class="keyword">);
<br />
&nbsp;&nbsp; if(</span><span class="default">$gotSession</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp;&nbsp; if(</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$r</span><span class="keyword">, </span><span class="default">$crlf </span><span class="keyword">. </span><span class="default">$crlf</span><span class="keyword">,</span><span class="default">$gotSession</span><span class="keyword">)&gt;</span><span class="default">0</span><span class="keyword">) break;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$a</span><span class="keyword">=((</span><span class="default">$b</span><span class="keyword">==</span><span class="string">''</span><span class="keyword">)?</span><span class="default">1</span><span class="keyword">:</span><span class="default">0</span><span class="keyword">);
<br />
&nbsp;&nbsp; }
<br />
&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$h</span><span class="keyword">);
<br />
&nbsp;&nbsp; </span><span class="default">$arr </span><span class="keyword">= </span><span class="default">split</span><span class="keyword">(</span><span class="string">"Set-Cookie:"</span><span class="keyword">,</span><span class="default">$r</span><span class="keyword">);
<br />
&nbsp;&nbsp; </span><span class="default">$AllCookies</span><span class="keyword">=</span><span class="string">""</span><span class="keyword">;</span><span class="default">$count</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">;
<br />
&nbsp;&nbsp; while (</span><span class="default">$count </span><span class="keyword">&lt; </span><span class="default">count</span><span class="keyword">(</span><span class="default">$arr</span><span class="keyword">)) {
<br />
</span><span class="default">$AllCookies</span><span class="keyword">.=</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$arr</span><span class="keyword">[</span><span class="default">$count</span><span class="keyword">].</span><span class="string">";"</span><span class="keyword">,
<br />
</span><span class="default">0</span><span class="keyword">,</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$arr</span><span class="keyword">[</span><span class="default">$count</span><span class="keyword">].</span><span class="string">";"</span><span class="keyword">,</span><span class="string">";"</span><span class="keyword">)+</span><span class="default">1</span><span class="keyword">);
<br />

<br />
&nbsp;</span><span class="default">$count</span><span class="keyword">++;}
<br />
&nbsp;&nbsp; return </span><span class="default">$AllCookies</span><span class="keyword">;
<br />

<br />
}
<br />
&nbsp;</span><span class="default">?&gt;
<br />
</span>
<br />
It's not optimized , but i hope someone might find it usefull.
<br />
Best Regards 
<br />
DRY_GIN</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="59556""></a>
  <div class="note">
   <strong class="user">sivann at cs dot ntua dot gr</strong>
   <a href="#59556" class="date">09-Dec-2005 04:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is an ident request example. If your client is running identd your real username will be known by the server.
<br />
It is also usefull to identify people bypassing IP ACLs by using SOCKS proxy and dynamic IP forwarding. If the socks proxy server uses ident (most unices do) you will know his real username.
<br />
For more information see RFC1413
<br />
Timeout of 2 seconds in the example may not be enough.
<br />

<br />
<span class="default">&lt;?php
<br />
error_reporting</span><span class="keyword">(</span><span class="default">E_ALL</span><span class="keyword">);
<br />
</span><span class="default">$remip </span><span class="keyword">= </span><span class="default">$HTTP_SERVER_VARS</span><span class="keyword">[</span><span class="string">'REMOTE_ADDR'</span><span class="keyword">];
<br />
</span><span class="default">$remport </span><span class="keyword">= </span><span class="default">$HTTP_SERVER_VARS</span><span class="keyword">[</span><span class="string">'REMOTE_PORT'</span><span class="keyword">];
<br />

<br />
</span><span class="default">ob_implicit_flush</span><span class="keyword">();
<br />
</span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$remip</span><span class="keyword">, </span><span class="default">113</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">);
<br />
if (!</span><span class="default">$fp</span><span class="keyword">) {
<br />
&nbsp;&nbsp; echo </span><span class="string">"</span><span class="default">$errstr</span><span class="string"> (</span><span class="default">$errno</span><span class="string">)&lt;br&gt;\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; exit;
<br />
} 
<br />
else {
<br />
&nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">= </span><span class="string">"</span><span class="default">$remport</span><span class="string">, 80\r\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$out</span><span class="keyword">);
<br />
&nbsp;&nbsp; </span><span class="default">$answer</span><span class="keyword">=</span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">128</span><span class="keyword">);
<br />
}
<br />
</span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);
<br />
</span><span class="default">$ansparts</span><span class="keyword">=</span><span class="default">explode</span><span class="keyword">(</span><span class="string">":"</span><span class="keyword">,</span><span class="default">$answer</span><span class="keyword">); 
<br />
</span><span class="default">$user</span><span class="keyword">=</span><span class="default">chop</span><span class="keyword">(</span><span class="default">$ansparts</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">]);
<br />
echo </span><span class="string">"You are </span><span class="default">$user</span><span class="string">@</span><span class="default">$remip</span><span class="string">:</span><span class="default">$remport</span><span class="string">"</span><span class="keyword">;
<br />

<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="58196""></a>
  <div class="note">
   <strong class="user">Kiki_EF</strong>
   <a href="#58196" class="date">27-Oct-2005 09:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Additional ICQ status request over proxy
<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">icq_uin</span><span class="keyword">(</span><span class="default">$uin</span><span class="keyword">)
<br />
{
<br />
&nbsp;&nbsp;&nbsp; if (! </span><span class="default">is_numeric</span><span class="keyword">(</span><span class="default">$uin</span><span class="keyword">))
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$proxy_name </span><span class="keyword">= </span><span class="string">'proxy.mydomain.de'</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$proxy_port </span><span class="keyword">= </span><span class="default">8080</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$proxy_user </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$proxy_pass </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$proxy_cont </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$request_url </span><span class="keyword">= </span><span class="string">"<a href="http://status.icq.com/online.gif?icq=" rel="nofollow" target="_blank">http://status.icq.com/online.gif?icq=</a></span><span class="default">$uin</span><span class="string">"</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$proxy_fp </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$proxy_name</span><span class="keyword">, </span><span class="default">$proxy_port</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; if (!</span><span class="default">$proxy_fp</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$proxy_fp</span><span class="keyword">, </span><span class="string">"GET </span><span class="default">$request_url</span><span class="string"> HTTP/1.0\r\nHost: </span><span class="default">$proxy_name</span><span class="string">\r\n"</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$proxy_fp</span><span class="keyword">, </span><span class="string">"Proxy-Authorization: Basic "</span><span class="keyword">. </span><span class="default">base64_encode </span><span class="keyword">(</span><span class="string">"</span><span class="default">$proxy_user</span><span class="string">:</span><span class="default">$proxy_pass</span><span class="string">"</span><span class="keyword">).</span><span class="string">"\r\n\r\n"</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; while(!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$proxy_fp</span><span class="keyword">)){
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$proxy_cont </span><span class="keyword">.= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$proxy_fp</span><span class="keyword">,</span><span class="default">4096</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$proxy_fp</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$proxy_cont </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$proxy_cont</span><span class="keyword">, </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$proxy_cont</span><span class="keyword">,</span><span class="string">"\r\n\r\n"</span><span class="keyword">)+</span><span class="default">4</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">strstr</span><span class="keyword">(</span><span class="default">$proxy_cont</span><span class="keyword">, </span><span class="string">'online1'</span><span class="keyword">))
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">'online'</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">strstr</span><span class="keyword">(</span><span class="default">$proxy_cont</span><span class="keyword">, </span><span class="string">'online0'</span><span class="keyword">))
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">'offline'</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">strstr</span><span class="keyword">(</span><span class="default">$proxy_cont</span><span class="keyword">, </span><span class="string">'online2'</span><span class="keyword">))
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">'disabled'</span><span class="keyword">;
<br />
}
<br />
echo </span><span class="string">"User is "</span><span class="keyword">.</span><span class="default">icq_uin</span><span class="keyword">(</span><span class="default">123456789012345</span><span class="keyword">);
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Thanx
<br />

<br />
[EDIT BY danbrown AT php DOT net: Based on code provided in a note by (rafaelbc AT matrix DOT com DOT br) on 23-MAY-09, which has since been removed.]</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="56049""></a>
  <div class="note">
   <strong class="user">robin at pozytron dot com</strong>
   <a href="#56049" class="date">22-Aug-2005 12:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I have found, when using fsockopen() and the POST method, that using HTTP/1.1 is VERY significantly slower than HTTP/1.0 (at least for the server I'm querying, an Orion-based server). Also, using cURL tended to be faster than fsockopen(), though only slightly. For example, here was a recent set of data (for the same exact request in each case):
<br />

<br />
cURL: 4.2sec
<br />
fsockopen() HTTP/1.0: 4.9sec
<br />
fsockopen() HTTP/1.1: 19.9sec (!)
<br />

<br />
I'm not sure why this was occurring. Perhaps it has something to do with the Orion server, which I have little experience with. However, it was not a fluke, and I double-checked the code to make sure there were no errors.
<br />

<br />
EDITORS NOTE: HTTP/1.1 uses persistent connection causing this delay. Use "Connection: close" header to disable it.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="55675""></a>
  <div class="note">
   <strong class="user">dna at revold-design dot de</strong>
   <a href="#55675" class="date">10-Aug-2005 02:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Something useful for ICQ:
<br />
<span class="default">&lt;?php
<br />
$icquin </span><span class="keyword">= </span><span class="string">"197829943"</span><span class="keyword">;
<br />
function </span><span class="default">GetICQ</span><span class="keyword">(</span><span class="default">$uin</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; if (!</span><span class="default">is_numeric</span><span class="keyword">(</span><span class="default">$uin</span><span class="keyword">)) return </span><span class="default">FALSE</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="string">'status.icq.com'</span><span class="keyword">, </span><span class="default">80</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">8</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; if (!</span><span class="default">$fp</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="string">"N/A"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; else {
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$request </span><span class="keyword">= </span><span class="string">"HEAD /online.gif?icq=</span><span class="default">$uin</span><span class="string"> HTTP/1.0\r\n"
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">.</span><span class="string">"Host: web.icq.com\r\n"
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">.</span><span class="string">"Connection: close\r\n\r\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$request</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp;&nbsp; do {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$response </span><span class="keyword">= </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">1024</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">) &amp;&amp; !</span><span class="default">stristr</span><span class="keyword">(</span><span class="default">$response</span><span class="keyword">, </span><span class="string">'Location'</span><span class="keyword">));
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">strstr</span><span class="keyword">(</span><span class="default">$response</span><span class="keyword">, </span><span class="string">'online1'</span><span class="keyword">)) return </span><span class="string">'Online'</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">strstr</span><span class="keyword">(</span><span class="default">$response</span><span class="keyword">, </span><span class="string">'online0'</span><span class="keyword">)) return </span><span class="string">'Offline'</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">strstr</span><span class="keyword">(</span><span class="default">$response</span><span class="keyword">, </span><span class="string">'online2'</span><span class="keyword">)) return </span><span class="string">'N/A'</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// N/A means, this User set the Option, his Online
<br />
&nbsp;&nbsp;&nbsp; // Status cannot be shown over the Internet
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">FALSE</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
}
<br />

<br />
echo </span><span class="default">GetICQ</span><span class="keyword">(</span><span class="default">$icquin</span><span class="keyword">);
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="52966""></a>
  <div class="note">
   <strong class="user">richard dot lajaunie at cote-azur dot cci dot fr</strong>
   <a href="#52966" class="date">19-May-2005 09:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php
<br />
</span><span class="comment">/************************************************************
<br />
* Author: Richard Lajaunie
<br />
* Mail : richard.lajaunie@cote-azur.cci.fr
<br />
*
<br />
* subject : this script retreive all mac-addresses on all ports
<br />
* of a Cisco 3548 Switch by a telnet connection
<br />
*
<br />
* base on the script by: xbensemhoun at t-systems dot fr
<br />
**************************************************************/
<br />

<br />
</span><span class="keyword">if ( </span><span class="default">array_key_exists</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">, </span><span class="default">$argv</span><span class="keyword">) ){
<br />
&nbsp;&nbsp; </span><span class="default">$cfgServer </span><span class="keyword">= </span><span class="default">$argv</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];
<br />
}else{
<br />
&nbsp;&nbsp; echo </span><span class="string">"ex: 'php test.php 10.0.0.0' \n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; exit;
<br />
}
<br />

<br />
</span><span class="default">$cfgPort&nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">23</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">//port, 22 if SSH
<br />
</span><span class="default">$cfgTimeOut </span><span class="keyword">= </span><span class="default">10</span><span class="keyword">;
<br />

<br />
</span><span class="default">$usenet </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$cfgServer</span><span class="keyword">, </span><span class="default">$cfgPort</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">), </span><span class="default">$cfgTimeOut</span><span class="keyword">);
<br />

<br />
if(!</span><span class="default">$usenet</span><span class="keyword">){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; echo </span><span class="string">"Connexion failed\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; exit();
<br />
}else{
<br />
&nbsp;&nbsp; &nbsp; &nbsp; echo </span><span class="string">"Connected\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">fputs </span><span class="keyword">(</span><span class="default">$usenet</span><span class="keyword">, </span><span class="string">"password\r\n"</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">fputs </span><span class="keyword">(</span><span class="default">$usenet</span><span class="keyword">, </span><span class="string">"en\r\n"</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">fputs </span><span class="keyword">(</span><span class="default">$usenet</span><span class="keyword">, </span><span class="string">"password\r\n"</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">fputs </span><span class="keyword">(</span><span class="default">$usenet</span><span class="keyword">, </span><span class="string">"sh mac-address-table\r\n"</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">fputs </span><span class="keyword">(</span><span class="default">$usenet</span><span class="keyword">, </span><span class="string">" "</span><span class="keyword">); </span><span class="comment">// this space bar is this for long output
<br />
&nbsp;&nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; // this skip non essential text
<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$j </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; while (</span><span class="default">$j</span><span class="keyword">&lt;</span><span class="default">16</span><span class="keyword">){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$usenet</span><span class="keyword">, </span><span class="default">128</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$j</span><span class="keyword">++;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; }
<br />
&nbsp;&nbsp; </span><span class="default">stream_set_timeout</span><span class="keyword">(</span><span class="default">$usenet</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">); </span><span class="comment">// set the timeout for the fgets
<br />
&nbsp;&nbsp; </span><span class="default">$j </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$usenet</span><span class="keyword">)){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$ret </span><span class="keyword">= </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$usenet</span><span class="keyword">, </span><span class="default">128</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$ret </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"\r"</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$ret</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$ret </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"\n"</span><span class="keyword">, </span><span class="string">""</span><span class="keyword">, </span><span class="default">$ret</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; if&nbsp; (</span><span class="default">ereg</span><span class="keyword">(</span><span class="string">"FastEthernet"</span><span class="keyword">, </span><span class="default">$ret</span><span class="keyword">)){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">"</span><span class="default">$ret</span><span class="string"> \n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; if (</span><span class="default">ereg</span><span class="keyword">(</span><span class="string">'--More--'</span><span class="keyword">, </span><span class="default">$ret</span><span class="keyword">) ){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fputs </span><span class="keyword">(</span><span class="default">$usenet</span><span class="keyword">, </span><span class="string">" "</span><span class="keyword">); </span><span class="comment">// for following page
<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="keyword">}
<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$info </span><span class="keyword">= </span><span class="default">stream_get_meta_data</span><span class="keyword">(</span><span class="default">$usenet</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; if (</span><span class="default">$info</span><span class="keyword">[</span><span class="string">'timed_out'</span><span class="keyword">]) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$j</span><span class="keyword">++;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; if (</span><span class="default">$j </span><span class="keyword">&gt;</span><span class="default">2</span><span class="keyword">){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fputs </span><span class="keyword">(</span><span class="default">$usenet</span><span class="keyword">, </span><span class="string">"lo"</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; }
<br />
&nbsp;&nbsp; }
<br />
}
<br />
echo </span><span class="string">"End.\r\n"</span><span class="keyword">;
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="52033""></a>
  <div class="note">
   <strong class="user">saul dot dobney at dobney dot com</strong>
   <a href="#52033" class="date">19-Apr-2005 05:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are using fsockopen to access webpage, but come across a redirect (Location: ) in the header and want to find and follow the redirect as in this snippet:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; </span><span class="default">$line</span><span class="keyword">=</span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">1024</span><span class="keyword">);&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br />
&nbsp;&nbsp; if (</span><span class="default">stristr</span><span class="keyword">(</span><span class="default">$line</span><span class="keyword">,</span><span class="string">"location:"</span><span class="keyword">)!=</span><span class="string">""</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$redirect</span><span class="keyword">=</span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"/location:/i"</span><span class="keyword">,</span><span class="string">""</span><span class="keyword">,</span><span class="default">$line</span><span class="keyword">);
<br />
&nbsp;&nbsp; }
<br />
}
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Then don't forget to <span class="default">&lt;?php $redirect </span><span class="keyword">= </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$redirect</span><span class="keyword">); </span><span class="default">?&gt;</span> before trying to follow this new link as $redirect actually has a \r\n on the end of it and won't give you a valid path in the next iteration otherwise. A six hour bug.
<br />

<br />
Saul Dobney</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="51363""></a>
  <div class="note">
   <strong class="user">ahauk at NO-SPAM dot synergynt dot net</strong>
   <a href="#51363" class="date">28-Mar-2005 11:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The following script will login to a POP3 account using the username, password and server name provided via a standard form; determine the amount of messages using a binary search; then purge all messages.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; $server </span><span class="keyword">= </span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">"server"</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$user </span><span class="keyword">= </span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">"user"</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$pass </span><span class="keyword">= </span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">"pass"</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$count </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$low </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$mid </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$high </span><span class="keyword">= </span><span class="default">100000</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$connection </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$server</span><span class="keyword">, </span><span class="default">110</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">30</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; if(!</span><span class="default">$connection</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; print </span><span class="string">"Connect Failed: </span><span class="default">$errstr</span><span class="string"> (</span><span class="default">$errno</span><span class="string">)"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$output </span><span class="keyword">= </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">, </span><span class="default">128</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">, </span><span class="string">"user </span><span class="default">$user</span><span class="string">\n"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$output </span><span class="keyword">= </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">, </span><span class="default">128</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">, </span><span class="string">"pass </span><span class="default">$pass</span><span class="string">\n"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$output </span><span class="keyword">= </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">, </span><span class="default">128</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while(</span><span class="default">$low </span><span class="keyword">&lt; </span><span class="default">$high </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$mid </span><span class="keyword">= </span><span class="default">floor</span><span class="keyword">((</span><span class="default">$low </span><span class="keyword">+ </span><span class="default">$high</span><span class="keyword">) / </span><span class="default">2</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">, </span><span class="string">"list </span><span class="default">$mid</span><span class="string">\n"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$output </span><span class="keyword">= </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">, </span><span class="default">128</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$subout </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$output</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">4</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$subout </span><span class="keyword">== </span><span class="string">"+OK "</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$low </span><span class="keyword">= </span><span class="default">$mid</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; continue;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; elseif(</span><span class="default">$subout </span><span class="keyword">== </span><span class="string">"-ERR"</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$high </span><span class="keyword">= </span><span class="default">$mid</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; continue;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; print </span><span class="string">"An error has occurred. Please try again."</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$limit </span><span class="keyword">= </span><span class="default">$mid </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while(</span><span class="default">$count </span><span class="keyword">&lt;= </span><span class="default">$limit</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">, </span><span class="string">"dele </span><span class="default">$count</span><span class="string">\n"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">, </span><span class="default">128</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$count </span><span class="keyword">= </span><span class="default">$count </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">, </span><span class="string">"quit\n"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; print </span><span class="string">"Successfully removed </span><span class="default">$limit</span><span class="string"> messages."</span><span class="keyword">;<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="50641""></a>
  <div class="note">
   <strong class="user">lukas at MORESPAM dot jhu dot edu</strong>
   <a href="#50641" class="date">05-Mar-2005 04:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's a function that I needed and couldn't use CURL... it helps you if you want to send the POST data (instead of GET) from one form to 2 or more other PHP scripts.&nbsp; Trust me... it's a life saver!!
<br />

<br />
<span class="default">&lt;?php
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">HTTP_Post</span><span class="keyword">(</span><span class="default">$URL</span><span class="keyword">,</span><span class="default">$data</span><span class="keyword">, </span><span class="default">$referrer</span><span class="keyword">=</span><span class="string">""</span><span class="keyword">) {
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// parsing the given URL
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$URL_Info</span><span class="keyword">=</span><span class="default">parse_url</span><span class="keyword">(</span><span class="default">$URL</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Building referrer
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">$referrer</span><span class="keyword">==</span><span class="string">""</span><span class="keyword">) </span><span class="comment">// if not given use this script as referrer
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$referrer</span><span class="keyword">=</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">"SCRIPT_URI"</span><span class="keyword">];
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// making string from $data
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">foreach(</span><span class="default">$data </span><span class="keyword">as </span><span class="default">$key</span><span class="keyword">=&gt;</span><span class="default">$value</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$values</span><span class="keyword">[]=</span><span class="string">"</span><span class="default">$key</span><span class="string">="</span><span class="keyword">.</span><span class="default">urlencode</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$data_string</span><span class="keyword">=</span><span class="default">implode</span><span class="keyword">(</span><span class="string">"&amp;"</span><span class="keyword">,</span><span class="default">$values</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Find out which port is needed - if not given use standard (=80)
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(!isset(</span><span class="default">$URL_Info</span><span class="keyword">[</span><span class="string">"port"</span><span class="keyword">]))
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$URL_Info</span><span class="keyword">[</span><span class="string">"port"</span><span class="keyword">]=</span><span class="default">80</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// building POST-request:
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$request</span><span class="keyword">.=</span><span class="string">"POST "</span><span class="keyword">.</span><span class="default">$URL_Info</span><span class="keyword">[</span><span class="string">"path"</span><span class="keyword">].</span><span class="string">" HTTP/1.1\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$request</span><span class="keyword">.=</span><span class="string">"Host: "</span><span class="keyword">.</span><span class="default">$URL_Info</span><span class="keyword">[</span><span class="string">"host"</span><span class="keyword">].</span><span class="string">"\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$request</span><span class="keyword">.=</span><span class="string">"Referer: </span><span class="default">$referer</span><span class="string">\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$request</span><span class="keyword">.=</span><span class="string">"Content-type: application/x-www-form-urlencoded\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$request</span><span class="keyword">.=</span><span class="string">"Content-length: "</span><span class="keyword">.</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$data_string</span><span class="keyword">).</span><span class="string">"\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$request</span><span class="keyword">.=</span><span class="string">"Connection: close\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$request</span><span class="keyword">.=</span><span class="string">"\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$request</span><span class="keyword">.=</span><span class="default">$data_string</span><span class="keyword">.</span><span class="string">"\n"</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$URL_Info</span><span class="keyword">[</span><span class="string">"host"</span><span class="keyword">],</span><span class="default">$URL_Info</span><span class="keyword">[</span><span class="string">"port"</span><span class="keyword">]);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$request</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while(!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">.= </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">128</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$result</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$output1</span><span class="keyword">=</span><span class="default">HTTP_Post</span><span class="keyword">(</span><span class="string">"<a href="http://www.example.com/script1.php" rel="nofollow" target="_blank">http://www.example.com/script1.php</a>"</span><span class="keyword">,</span><span class="default">$_POST</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$output2</span><span class="keyword">=</span><span class="default">HTTP_Post</span><span class="keyword">(</span><span class="string">"<a href="http://www.example.net/script2.php" rel="nofollow" target="_blank">http://www.example.net/script2.php</a>"</span><span class="keyword">,</span><span class="default">$_POST</span><span class="keyword">);
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="50293""></a>
  <div class="note">
   <strong class="user">dante at dantecubed dot com</strong>
   <a href="#50293" class="date">24-Feb-2005 01:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You may be able to speed this function up by using an IP address instead of a domain. PHP uses getHostByAddr internally in this function anyway, so you can save a step in the function process.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="49938""></a>
  <div class="note">
   <strong class="user">konrad dot meyer at gmail dot com</strong>
   <a href="#49938" class="date">12-Feb-2005 10:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The documentation example is of a GET request. I have found POST documentation to be lacking, and here's a function to easily simulate submitting form data:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment"># $host includes host and path and filename<br />
&nbsp;&nbsp;&nbsp; # ex: "myserver.com/this/is/path/to/file.php"<br />
# $query is the POST query data<br />
&nbsp;&nbsp;&nbsp; # ex: "a=thisstring&amp;number=46&amp;string=thatstring<br />
# $others is any extra headers you want to send<br />
&nbsp;&nbsp;&nbsp; # ex: "Accept-Encoding: compress, gzip\r\n"<br />
</span><span class="keyword">function </span><span class="default">post</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">,</span><span class="default">$query</span><span class="keyword">,</span><span class="default">$others</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$path</span><span class="keyword">=</span><span class="default">explode</span><span class="keyword">(</span><span class="string">'/'</span><span class="keyword">,</span><span class="default">$host</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$host</span><span class="keyword">=</span><span class="default">$path</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; unset(</span><span class="default">$path</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$path</span><span class="keyword">=</span><span class="string">'/'</span><span class="keyword">.(</span><span class="default">implode</span><span class="keyword">(</span><span class="string">'/'</span><span class="keyword">,</span><span class="default">$path</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$post</span><span class="keyword">=</span><span class="string">"POST </span><span class="default">$path</span><span class="string"> HTTP/1.1\r\nHost: </span><span class="default">$host</span><span class="string">\r\nContent-type: application/x-www-form-urlencoded\r\n</span><span class="keyword">${</span><span class="default">others</span><span class="keyword">}</span><span class="string">User-Agent: Mozilla 4.0\r\nContent-length: "</span><span class="keyword">.</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">).</span><span class="string">"\r\nConnection: close\r\n\r\n</span><span class="default">$query</span><span class="string">"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$h</span><span class="keyword">=</span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">,</span><span class="default">80</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$h</span><span class="keyword">,</span><span class="default">$post</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; for(</span><span class="default">$a</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">,</span><span class="default">$r</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">;!</span><span class="default">$a</span><span class="keyword">;){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$b</span><span class="keyword">=</span><span class="default">fread</span><span class="keyword">(</span><span class="default">$h</span><span class="keyword">,</span><span class="default">8192</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$r</span><span class="keyword">.=</span><span class="default">$b</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$a</span><span class="keyword">=((</span><span class="default">$b</span><span class="keyword">==</span><span class="string">''</span><span class="keyword">)?</span><span class="default">1</span><span class="keyword">:</span><span class="default">0</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$h</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$r</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="47845""></a>
  <div class="note">
   <strong class="user">edwin at bitstorm dot org</strong>
   <a href="#47845" class="date">02-Dec-2004 02:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's a function to just fetch the contents behind an URL.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">fetchURL</span><span class="keyword">( </span><span class="default">$url </span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$url_parsed </span><span class="keyword">= </span><span class="default">parse_url</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$host </span><span class="keyword">= </span><span class="default">$url_parsed</span><span class="keyword">[</span><span class="string">"host"</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$port </span><span class="keyword">= </span><span class="default">$url_parsed</span><span class="keyword">[</span><span class="string">"port"</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$port</span><span class="keyword">==</span><span class="default">0</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$port </span><span class="keyword">= </span><span class="default">80</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$path </span><span class="keyword">= </span><span class="default">$url_parsed</span><span class="keyword">[</span><span class="string">"path"</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$url_parsed</span><span class="keyword">[</span><span class="string">"query"</span><span class="keyword">] != </span><span class="string">""</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$path </span><span class="keyword">.= </span><span class="string">"?"</span><span class="keyword">.</span><span class="default">$url_parsed</span><span class="keyword">[</span><span class="string">"query"</span><span class="keyword">];<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">= </span><span class="string">"GET </span><span class="default">$path</span><span class="string"> HTTP/1.0\r\nHost: </span><span class="default">$host</span><span class="string">\r\n\r\n"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">30</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$out</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$body </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$s </span><span class="keyword">= </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">1024</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( </span><span class="default">$body </span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$in </span><span class="keyword">.= </span><span class="default">$s</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( </span><span class="default">$s </span><span class="keyword">== </span><span class="string">"\r\n" </span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$body </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$in</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="46836""></a>
  <div class="note">
   <strong class="user">michiel at parse dot nl</strong>
   <a href="#46836" class="date">25-Oct-2004 01:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The following snippet allows you to retrieve the title of a page.
<br />

<br />
Great for rewriting auto-url detectors to display the actual title rather then <a href="http://..." rel="nofollow" target="_blank">http://...</a>
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">echo </span><span class="default">get_url_title</span><span class="keyword">(</span><span class="string">"<a href="http://www.php.net/cal.php?id=409" rel="nofollow" target="_blank">http://www.php.net/cal.php?id=409</a>"</span><span class="keyword">);
<br />

<br />
function </span><span class="default">get_url_title</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">, </span><span class="default">$timeout </span><span class="keyword">= </span><span class="default">2</span><span class="keyword">)
<br />
{
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$url </span><span class="keyword">= </span><span class="default">parse_url</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp;&nbsp; if(!</span><span class="default">in_array</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">[</span><span class="string">'scheme'</span><span class="keyword">],array(</span><span class="string">''</span><span class="keyword">,</span><span class="string">'http'</span><span class="keyword">)))
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return;
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fsockopen </span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">[</span><span class="string">'host'</span><span class="keyword">], (</span><span class="default">$url</span><span class="keyword">[</span><span class="string">'port'</span><span class="keyword">] &gt; </span><span class="default">0 </span><span class="keyword">? </span><span class="default">$url</span><span class="keyword">[</span><span class="string">'port'</span><span class="keyword">] : </span><span class="default">80</span><span class="keyword">), </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">$timeout</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; if (!</span><span class="default">$fp</span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// echo "$errstr ($errno)&lt;br&gt;\n";
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">}
<br />
&nbsp;&nbsp;&nbsp; else
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fputs </span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="string">"GET /"</span><span class="keyword">.</span><span class="default">$url</span><span class="keyword">[</span><span class="string">'path'</span><span class="keyword">].(</span><span class="default">$url</span><span class="keyword">[</span><span class="string">'query'</span><span class="keyword">] ? </span><span class="string">'?'</span><span class="keyword">.</span><span class="default">$url</span><span class="keyword">[</span><span class="string">'query'</span><span class="keyword">] : </span><span class="string">''</span><span class="keyword">).</span><span class="string">" HTTP/1.0\r\nHost: "</span><span class="keyword">.</span><span class="default">$url</span><span class="keyword">[</span><span class="string">'host'</span><span class="keyword">].</span><span class="string">"\r\n\r\n"</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$d </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">))
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$d </span><span class="keyword">.= </span><span class="default">fgets </span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">,</span><span class="default">2048</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'~(&lt;/head&gt;|&lt;body&gt;|(&lt;title&gt;\s*(.*?)\s*&lt;/title&gt;))~i'</span><span class="keyword">, </span><span class="default">$d</span><span class="keyword">, </span><span class="default">$m</span><span class="keyword">))
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose </span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$m</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">];
<br />
&nbsp;&nbsp;&nbsp; }
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="40836""></a>
  <div class="note">
   <strong class="user">alex at renesource dot lv</strong>
   <a href="#40836" class="date">16-Mar-2004 08:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Set up SSL connection to server that requires client certificate:
<br />

<br />
Convert client certificate from *.pfx (pkcs12) into*.pem with openssl (if needed):
<br />

<br />
&gt; openssl pkcs12 -in keys.pfx -out keys.pem
<br />

<br />
PHP:
<br />

<br />
<span class="default">&lt;?php
<br />
$context </span><span class="keyword">= </span><span class="default">stream_context_create</span><span class="keyword">();
<br />
</span><span class="default">$result </span><span class="keyword">= </span><span class="default">stream_context_set_option</span><span class="keyword">(</span><span class="default">$context</span><span class="keyword">, </span><span class="string">'ssl'</span><span class="keyword">, </span><span class="string">'local_cert'</span><span class="keyword">, </span><span class="string">'/path/to/keys.pem'</span><span class="keyword">);
<br />
</span><span class="default">$result </span><span class="keyword">= </span><span class="default">stream_context_set_option</span><span class="keyword">(</span><span class="default">$context</span><span class="keyword">, </span><span class="string">'ssl'</span><span class="keyword">, </span><span class="string">'passphrase'</span><span class="keyword">, </span><span class="string">'pass_to_access_keys'</span><span class="keyword">);
<br />

<br />
</span><span class="default">$socket </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="string">'ssl://'</span><span class="keyword">.</span><span class="default">$host</span><span class="keyword">, </span><span class="default">443</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">30</span><span class="keyword">, </span><span class="default">$context</span><span class="keyword">);
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="39948""></a>
  <div class="note">
   <strong class="user">jack at jtr dot de</strong>
   <a href="#39948" class="date">16-Feb-2004 11:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is a function for testing a website/URI for availability:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/*<br />
&nbsp;&nbsp;&nbsp; * @return boolean<br />
&nbsp;&nbsp;&nbsp; * @param&nbsp; string $link<br />
&nbsp;&nbsp;&nbsp; * @desc&nbsp;&nbsp; ?berpr?ft die angegeben URL auf Erreichbarkeit (HTTP-Code: 200)<br />
&nbsp;&nbsp;&nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">url_validate</span><span class="keyword">( </span><span class="default">$link </span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$url_parts </span><span class="keyword">= @</span><span class="default">parse_url</span><span class="keyword">( </span><span class="default">$link </span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( empty( </span><span class="default">$url_parts</span><span class="keyword">[</span><span class="string">"host"</span><span class="keyword">] ) ) return( </span><span class="default">false </span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( !empty( </span><span class="default">$url_parts</span><span class="keyword">[</span><span class="string">"path"</span><span class="keyword">] ) )<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$documentpath </span><span class="keyword">= </span><span class="default">$url_parts</span><span class="keyword">[</span><span class="string">"path"</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$documentpath </span><span class="keyword">= </span><span class="string">"/"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( !empty( </span><span class="default">$url_parts</span><span class="keyword">[</span><span class="string">"query"</span><span class="keyword">] ) )<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$documentpath </span><span class="keyword">.= </span><span class="string">"?" </span><span class="keyword">. </span><span class="default">$url_parts</span><span class="keyword">[</span><span class="string">"query"</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$host </span><span class="keyword">= </span><span class="default">$url_parts</span><span class="keyword">[</span><span class="string">"host"</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$port </span><span class="keyword">= </span><span class="default">$url_parts</span><span class="keyword">[</span><span class="string">"port"</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Now (HTTP-)GET $documentpath at $host";<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (empty( </span><span class="default">$port </span><span class="keyword">) ) </span><span class="default">$port </span><span class="keyword">= </span><span class="string">"80"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$socket </span><span class="keyword">= @</span><span class="default">fsockopen</span><span class="keyword">( </span><span class="default">$host</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">30 </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">$socket</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return(</span><span class="default">false</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fwrite </span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">, </span><span class="string">"HEAD "</span><span class="keyword">.</span><span class="default">$documentpath</span><span class="keyword">.</span><span class="string">" HTTP/1.0\r\nHost: </span><span class="default">$host</span><span class="string">\r\n\r\n"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$http_response </span><span class="keyword">= </span><span class="default">fgets</span><span class="keyword">( </span><span class="default">$socket</span><span class="keyword">, </span><span class="default">22 </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ( </span><span class="default">ereg</span><span class="keyword">(</span><span class="string">"200 OK"</span><span class="keyword">, </span><span class="default">$http_response</span><span class="keyword">, </span><span class="default">$regs </span><span class="keyword">) )<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return(</span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">( </span><span class="default">$socket </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
</span><span class="comment">//&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo "HTTP-Response: $http_response&lt;br&gt;";<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">return(</span><span class="default">false</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="39868""></a>
  <div class="note">
   <strong class="user">sir_reality2001 at yahoo dot com</strong>
   <a href="#39868" class="date">13-Feb-2004 06:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php
<br />
</span><span class="comment">// This script is an example of posting multiple files using 
<br />
// fsockopen.
<br />
// The tricky part is making sure the HTTP headers and file boundaries are acceptable to the target webserver.
<br />
// This script is for example purposes only and could/should be improved upon.
<br />

<br />
</span><span class="default">$host</span><span class="keyword">=</span><span class="string">'targethost'</span><span class="keyword">;
<br />
</span><span class="default">$port</span><span class="keyword">=</span><span class="default">80</span><span class="keyword">;
<br />
</span><span class="default">$path</span><span class="keyword">=</span><span class="string">'/test/socket/file_upload/receive_files.php'</span><span class="keyword">;
<br />

<br />
</span><span class="comment">// the file you want to upload 
<br />
</span><span class="default">$file_array</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] = </span><span class="string">"dingoboy.gif"</span><span class="keyword">; </span><span class="comment">// the file 
<br />
</span><span class="default">$file_array</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] = </span><span class="string">"dingoboy2.gif"</span><span class="keyword">; </span><span class="comment">// the file 
<br />
</span><span class="default">$file_array</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">] = </span><span class="string">"dingoboy3.gif"</span><span class="keyword">; </span><span class="comment">// the file 
<br />
</span><span class="default">$content_type </span><span class="keyword">= </span><span class="string">"image/gif"</span><span class="keyword">; </span><span class="comment">// the file mime type
<br />
//$content_type = "text/plain";
<br />
//echo "file_array[0]:$file_array[0]&lt;br&gt;&lt;br&gt;";
<br />

<br />
</span><span class="default">srand</span><span class="keyword">((double)</span><span class="default">microtime</span><span class="keyword">()*</span><span class="default">1000000</span><span class="keyword">);
<br />
</span><span class="default">$boundary </span><span class="keyword">= </span><span class="string">"---------------------------"</span><span class="keyword">.</span><span class="default">substr</span><span class="keyword">(</span><span class="default">md5</span><span class="keyword">(</span><span class="default">rand</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,</span><span class="default">32000</span><span class="keyword">)),</span><span class="default">0</span><span class="keyword">,</span><span class="default">10</span><span class="keyword">);
<br />

<br />
</span><span class="default">$data </span><span class="keyword">= </span><span class="string">"--</span><span class="default">$boundary</span><span class="string">"</span><span class="keyword">;
<br />

<br />
for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">count</span><span class="keyword">(</span><span class="default">$file_array</span><span class="keyword">);</span><span class="default">$i</span><span class="keyword">++){
<br />
&nbsp;&nbsp; </span><span class="default">$content_file </span><span class="keyword">= </span><span class="default">join</span><span class="keyword">(</span><span class="string">""</span><span class="keyword">, </span><span class="default">file</span><span class="keyword">(</span><span class="default">$file_array</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]));
<br />

<br />
&nbsp;&nbsp; </span><span class="default">$data</span><span class="keyword">.=</span><span class="string">"
<br />
Content-Disposition: form-data; name=\"file"</span><span class="keyword">.(</span><span class="default">$i</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">).</span><span class="string">"\"; filename=\"</span><span class="default">$file_array</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]</span><span class="string">\"
<br />
Content-Type: </span><span class="default">$content_type</span><span class="string"> 
<br />

<br />
</span><span class="default">$content_file</span><span class="string">
<br />
--</span><span class="default">$boundary</span><span class="string">"</span><span class="keyword">;
<br />

<br />
}
<br />

<br />
</span><span class="default">$data</span><span class="keyword">.=</span><span class="string">"--\r\n\r\n"</span><span class="keyword">;
<br />

<br />
</span><span class="default">$msg </span><span class="keyword">=
<br />
</span><span class="string">"POST </span><span class="default">$path</span><span class="string"> HTTP/1.0
<br />
Content-Type: multipart/form-data; boundary=</span><span class="default">$boundary</span><span class="string">
<br />
Content-Length: "</span><span class="keyword">.</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">).</span><span class="string">"\r\n\r\n"</span><span class="keyword">;
<br />

<br />
</span><span class="default">$result</span><span class="keyword">=</span><span class="string">""</span><span class="keyword">;
<br />

<br />
</span><span class="comment">// open the connection
<br />
</span><span class="default">$f </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">);
<br />

<br />
</span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$f</span><span class="keyword">,</span><span class="default">$msg</span><span class="keyword">.</span><span class="default">$data</span><span class="keyword">);
<br />

<br />
</span><span class="comment">// get the response
<br />
</span><span class="keyword">while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$f</span><span class="keyword">)) </span><span class="default">$result </span><span class="keyword">.= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$f</span><span class="keyword">,</span><span class="default">32000</span><span class="keyword">);
<br />

<br />
</span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$f</span><span class="keyword">);
<br />

<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="39295""></a>
  <div class="note">
   <strong class="user">rob at robhulme dot com</strong>
   <a href="#39295" class="date">23-Jan-2004 06:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just a note to everyone who is using fsockopen and fread / fgets for a HTTP connection.<br />
<br />
Unless you specify "Connection: Close" in your headers you will need to wait for the socket to time out before feof($streamPointer) to return true.<br />
<br />
This has wasted 2 days of my time, grr!<br />
<br />
-Rob</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="37517""></a>
  <div class="note">
   <strong class="user">asalamanca at redcetus dot com</strong>
   <a href="#37517" class="date">18-Nov-2003 08:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is a very fast program for test a form or link (many times).
<br />
<span class="default">&lt;?php
<br />
$repeat&nbsp; </span><span class="keyword">= </span><span class="default">100</span><span class="keyword">;&nbsp; </span><span class="comment">// How many times repeat the test
<br />

<br />
</span><span class="default">$timeout </span><span class="keyword">= </span><span class="default">100</span><span class="keyword">;&nbsp; </span><span class="comment">// Max time for stablish the conection
<br />
</span><span class="default">$size&nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">16</span><span class="keyword">;&nbsp;&nbsp; </span><span class="comment">// Bytes will be read (and display). 0 for read all
<br />

<br />
</span><span class="default">$server&nbsp; </span><span class="keyword">= </span><span class="string">'127.0.0.1'</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// IP address
<br />
</span><span class="default">$host&nbsp; &nbsp; </span><span class="keyword">= </span><span class="string">'www.example.net'</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Domain name
<br />
</span><span class="default">$target&nbsp; </span><span class="keyword">= </span><span class="string">'/poll/answer.asp'</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Specific program
<br />
</span><span class="default">$referer </span><span class="keyword">= </span><span class="string">'<a href="http://www.example.com/" rel="nofollow" target="_blank">http://www.example.com/</a>'</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">// Referer
<br />
</span><span class="default">$port&nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">80</span><span class="keyword">;
<br />

<br />
</span><span class="comment">// Setup an array of fields to get with then create the get string
<br />
</span><span class="default">$gets </span><span class="keyword">= array ( </span><span class="string">'get_field_1' </span><span class="keyword">=&gt; </span><span class="string">'somevalue'</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'get_field_2' </span><span class="keyword">=&gt; </span><span class="string">'somevalue' </span><span class="keyword">);
<br />

<br />
</span><span class="comment">// Setup an array of fields to post with then create the post string
<br />
</span><span class="default">$posts </span><span class="keyword">= array ( </span><span class="string">'post_field_1' </span><span class="keyword">=&gt; </span><span class="string">'somevalue'</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">'post_field_2' </span><span class="keyword">=&gt; </span><span class="string">'somevalue' </span><span class="keyword">);
<br />

<br />
</span><span class="comment">// That's all. Now the program proccess $repeat times
<br />

<br />
</span><span class="default">$method </span><span class="keyword">= </span><span class="string">"GET"</span><span class="keyword">;
<br />
if ( </span><span class="default">is_array</span><span class="keyword">( </span><span class="default">$gets </span><span class="keyword">) ) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$getValues </span><span class="keyword">= </span><span class="string">'?'</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; foreach( </span><span class="default">$gets </span><span class="keyword">AS </span><span class="default">$name </span><span class="keyword">=&gt; </span><span class="default">$value </span><span class="keyword">){
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$getValues </span><span class="keyword">.= </span><span class="default">urlencode</span><span class="keyword">( </span><span class="default">$name </span><span class="keyword">) . </span><span class="string">"=" </span><span class="keyword">. </span><span class="default">urlencode</span><span class="keyword">( </span><span class="default">$value </span><span class="keyword">) . </span><span class="string">'&amp;'</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$getValues </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">( </span><span class="default">$getValues</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, -</span><span class="default">1 </span><span class="keyword">);
<br />
} else {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$getValues </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;
<br />
}
<br />

<br />
if ( </span><span class="default">is_array</span><span class="keyword">( </span><span class="default">$posts </span><span class="keyword">) ) {
<br />
&nbsp;&nbsp;&nbsp; foreach( </span><span class="default">$posts </span><span class="keyword">AS </span><span class="default">$name </span><span class="keyword">=&gt; </span><span class="default">$value </span><span class="keyword">){
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$postValues </span><span class="keyword">.= </span><span class="default">urlencode</span><span class="keyword">( </span><span class="default">$name </span><span class="keyword">) . </span><span class="string">"=" </span><span class="keyword">. </span><span class="default">urlencode</span><span class="keyword">( </span><span class="default">$value </span><span class="keyword">) . </span><span class="string">'&amp;'</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$postValues </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">( </span><span class="default">$postValues</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, -</span><span class="default">1 </span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$method </span><span class="keyword">= </span><span class="string">"POST"</span><span class="keyword">;
<br />
} else {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$postValues </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;
<br />
}
<br />

<br />
</span><span class="default">$request&nbsp; </span><span class="keyword">= </span><span class="string">"</span><span class="default">$method</span><span class="string"> </span><span class="default">$target$getValues</span><span class="string"> HTTP/1.1\r\n"</span><span class="keyword">;
<br />
</span><span class="default">$request </span><span class="keyword">.= </span><span class="string">"Host: </span><span class="default">$host</span><span class="string">\r\n"</span><span class="keyword">;
<br />
</span><span class="default">$request </span><span class="keyword">.= </span><span class="string">'User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.2.1) '</span><span class="keyword">;
<br />
</span><span class="default">$request </span><span class="keyword">.= </span><span class="string">"Gecko/20021204\r\n"</span><span class="keyword">;
<br />
</span><span class="default">$request </span><span class="keyword">.= </span><span class="string">'Accept: text/xml,application/xml,application/xhtml+xml,'</span><span class="keyword">;
<br />
</span><span class="default">$request </span><span class="keyword">.= </span><span class="string">'text/html;q=0.9,text/plain;q=0.8,video/x-mng,image/png,'</span><span class="keyword">;
<br />
</span><span class="default">$request </span><span class="keyword">.= </span><span class="string">"image/jpeg,image/gif;q=0.2,text/css,*/*;q=0.1\r\n"</span><span class="keyword">;
<br />
</span><span class="default">$request </span><span class="keyword">.= </span><span class="string">"Accept-Language: en-us, en;q=0.50\r\n"</span><span class="keyword">;
<br />
</span><span class="default">$request </span><span class="keyword">.= </span><span class="string">"Accept-Encoding: gzip, deflate, compress;q=0.9\r\n"</span><span class="keyword">;
<br />
</span><span class="default">$request </span><span class="keyword">.= </span><span class="string">"Accept-Charset: ISO-8859-1, utf-8;q=0.66, *;q=0.66\r\n"</span><span class="keyword">;
<br />
</span><span class="default">$request </span><span class="keyword">.= </span><span class="string">"Keep-Alive: 300\r\n"</span><span class="keyword">;
<br />
</span><span class="default">$request </span><span class="keyword">.= </span><span class="string">"Connection: keep-alive\r\n"</span><span class="keyword">;
<br />
</span><span class="default">$request </span><span class="keyword">.= </span><span class="string">"Referer: </span><span class="default">$referer</span><span class="string">\r\n"</span><span class="keyword">;
<br />
</span><span class="default">$request </span><span class="keyword">.= </span><span class="string">"Cache-Control: max-age=0\r\n"</span><span class="keyword">;
<br />

<br />
if ( </span><span class="default">$method </span><span class="keyword">== </span><span class="string">"POST" </span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$lenght </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">( </span><span class="default">$postValues </span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$request </span><span class="keyword">.= </span><span class="string">"Content-Type: application/x-www-form-urlencoded\r\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$request </span><span class="keyword">.= </span><span class="string">"Content-Length: </span><span class="default">$lenght</span><span class="string">\r\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$request </span><span class="keyword">.= </span><span class="string">"\r\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$request </span><span class="keyword">.= </span><span class="default">$postValues</span><span class="keyword">;
<br />
}
<br />

<br />
for ( </span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$repeat</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++ ) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$socket&nbsp; </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">( </span><span class="default">$server</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">$timeout </span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fputs</span><span class="keyword">( </span><span class="default">$socket</span><span class="keyword">, </span><span class="default">$request </span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; if ( </span><span class="default">$size </span><span class="keyword">&gt; </span><span class="default">0 </span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ret </span><span class="keyword">= </span><span class="default">fgets</span><span class="keyword">( </span><span class="default">$socket</span><span class="keyword">, </span><span class="default">$size </span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; } else {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ret </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while ( !</span><span class="default">feof</span><span class="keyword">( </span><span class="default">$socket </span><span class="keyword">) ) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ret </span><span class="keyword">.= </span><span class="default">fgets</span><span class="keyword">( </span><span class="default">$socket</span><span class="keyword">, </span><span class="default">4096 </span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">( </span><span class="default">$socket </span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"&lt;hr&gt; </span><span class="default">$i</span><span class="string"> -- </span><span class="default">$content</span><span class="string"> </span><span class="default">$ret</span><span class="string">"</span><span class="keyword">;
<br />
}
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Alejandro Salamanca</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="36819""></a>
  <div class="note">
   <strong class="user">terminal</strong>
   <a href="#36819" class="date">23-Oct-2003 09:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Try this.<br />
Use AUTH when necessary.<br />
Read RFC 821 when having problems.<br />
<br />
<span class="default">&lt;?php<br />
<br />
&nbsp;&nbsp;&nbsp; $handle </span><span class="keyword">= </span><span class="default">smtp_connect</span><span class="keyword">(</span><span class="default">$smtp_server</span><span class="keyword">, </span><span class="default">25</span><span class="keyword">, </span><span class="default">30</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">smtp_command</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="string">"EHLO </span><span class="default">$domain</span><span class="string">\r\n"</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">smtp_command</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="string">"MAIL FROM:&lt;</span><span class="default">$from_mail</span><span class="string">&gt;\r\n"</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">smtp_command</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="string">"RCPT TO:&lt;</span><span class="default">$to_mail</span><span class="string">&gt;\r\n"</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">smtp_command</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="string">"DATA\r\n"</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">smtp_command</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="string">"</span><span class="default">$message</span><span class="string">\r\n.\r\n"</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// don't do it like this - it will hang up<br />
&nbsp;&nbsp;&nbsp; // echo smtp_command($handle, "$message", 1, 1);<br />
&nbsp;&nbsp;&nbsp; // echo smtp_command($handle, "\r\n.\r\n", 1, 1);<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">echo </span><span class="default">smtp_command</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="string">"QUIT\r\n"</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">smtp_close</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">); <br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">smtp_connect</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">, </span><span class="default">$timeout</span><span class="keyword">=</span><span class="default">30</span><span class="keyword">, </span><span class="default">$echo_command</span><span class="keyword">=</span><span class="default">False</span><span class="keyword">, </span><span class="default">$echo_response</span><span class="keyword">=</span><span class="default">False</span><span class="keyword">, </span><span class="default">$nl2br</span><span class="keyword">=</span><span class="default">False</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$errno </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$errstr </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$echo_command</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$nl2br</span><span class="keyword">) { echo </span><span class="default">nl2br</span><span class="keyword">(</span><span class="string">"CONNECTING TO </span><span class="default">$host</span><span class="string">\r\n"</span><span class="keyword">); }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else { echo </span><span class="string">"CONNECTING TO </span><span class="default">$host</span><span class="string">\r\n"</span><span class="keyword">; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$handle </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">$timeout</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(!</span><span class="default">$handle</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$echo_command</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$nl2br</span><span class="keyword">) { echo </span><span class="default">nl2br</span><span class="keyword">(</span><span class="string">"CONNECTION FAILED\r\n"</span><span class="keyword">); }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else { echo </span><span class="string">"CONNECTION FAILED\r\n"</span><span class="keyword">; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">False</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$echo_command</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$nl2br</span><span class="keyword">) { echo </span><span class="default">nl2br</span><span class="keyword">(</span><span class="string">"SUCCESS\r\n"</span><span class="keyword">); }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else { echo </span><span class="string">"SUCCESS\r\n"</span><span class="keyword">; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$response </span><span class="keyword">= </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bytes_left </span><span class="keyword">= </span><span class="default">socket_get_status</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$bytes_left </span><span class="keyword">&gt; </span><span class="default">0</span><span class="keyword">) { </span><span class="default">$response </span><span class="keyword">.= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="default">$bytes_left</span><span class="keyword">[</span><span class="string">"unread_bytes"</span><span class="keyword">]); }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$echo_response</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$nl2br</span><span class="keyword">) { echo </span><span class="default">nl2br</span><span class="keyword">(</span><span class="default">$response</span><span class="keyword">); }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else { echo </span><span class="default">$response</span><span class="keyword">; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$handle</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">smtp_command</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="default">$command</span><span class="keyword">, </span><span class="default">$echo_command</span><span class="keyword">=</span><span class="default">False</span><span class="keyword">, </span><span class="default">$nl2br</span><span class="keyword">=</span><span class="default">False</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$echo_command</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$nl2br</span><span class="keyword">) { echo </span><span class="default">nl2br</span><span class="keyword">(</span><span class="default">$command</span><span class="keyword">); }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else { echo </span><span class="default">$command</span><span class="keyword">; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="default">$command</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$response </span><span class="keyword">= </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bytes_left </span><span class="keyword">= </span><span class="default">socket_get_status</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$bytes_left </span><span class="keyword">&gt; </span><span class="default">0</span><span class="keyword">) { </span><span class="default">$response </span><span class="keyword">.= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="default">$bytes_left</span><span class="keyword">[</span><span class="string">"unread_bytes"</span><span class="keyword">]); }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$nl2br</span><span class="keyword">) { return </span><span class="default">nl2br</span><span class="keyword">(</span><span class="default">$response</span><span class="keyword">); }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else { return </span><span class="default">$response</span><span class="keyword">; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">smtp_close</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="36703""></a>
  <div class="note">
   <strong class="user">richardaburton at hotmail dot com</strong>
   <a href="#36703" class="date">19-Oct-2003 05:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Improved HTTP/1.1 chunked transfer-encoding example.
<br />

<br />
The sample code given below by Jack does not function correctly when run against a recent version of Apache (I'm assuming that this did once work, but from the HTTP/1.1 spec I can only assume if it did work it was based mostly on luck).
<br />

<br />
<span class="default">&lt;?php
<br />

<br />
$header </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;
<br />
</span><span class="default">$response </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;
<br />

<br />
</span><span class="comment">// connect
<br />
</span><span class="keyword">if (!(</span><span class="default">$request</span><span class="keyword">=</span><span class="default">fsockopen</span><span class="keyword">(</span><span class="string">'example.com'</span><span class="keyword">,</span><span class="default">80</span><span class="keyword">,</span><span class="default">$errno</span><span class="keyword">,</span><span class="default">$errstr</span><span class="keyword">))) exit(</span><span class="default">$errstr</span><span class="keyword">);
<br />
else {
<br />
&nbsp;&nbsp; </span><span class="default">socket_set_timeout</span><span class="keyword">(</span><span class="default">$request</span><span class="keyword">,</span><span class="default">10</span><span class="keyword">);
<br />
&nbsp;&nbsp; </span><span class="comment">// send request
<br />
&nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$request</span><span class="keyword">,</span><span class="default">$post</span><span class="keyword">);
<br />
&nbsp;&nbsp; </span><span class="comment">// get header
<br />
&nbsp;&nbsp; </span><span class="keyword">do </span><span class="default">$header</span><span class="keyword">.=</span><span class="default">fread</span><span class="keyword">(</span><span class="default">$request</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">); while (!</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'/\\r\\n\\r\\n$/'</span><span class="keyword">,</span><span class="default">$header</span><span class="keyword">));
<br />
&nbsp;&nbsp; </span><span class="comment">// check for chunked encoding
<br />
&nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'/Transfer\\-Encoding:\\s+chunked\\r\\n/'</span><span class="keyword">,</span><span class="default">$header</span><span class="keyword">))
<br />
&nbsp;&nbsp; &nbsp;&nbsp; do {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$byte </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$chunk_size</span><span class="keyword">=</span><span class="string">""</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; do {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$chunk_size</span><span class="keyword">.=</span><span class="default">$byte</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$byte</span><span class="keyword">=</span><span class="default">fread</span><span class="keyword">(</span><span class="default">$request</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; } while (</span><span class="default">$byte</span><span class="keyword">!=</span><span class="string">"\\r"</span><span class="keyword">);&nbsp; &nbsp; &nbsp; </span><span class="comment">// till we match the CR
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$request</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// also drop off the LF
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$chunk_size</span><span class="keyword">=</span><span class="default">hexdec</span><span class="keyword">(</span><span class="default">$chunk_size</span><span class="keyword">); </span><span class="comment">// convert to real number
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$response</span><span class="keyword">.=</span><span class="default">fread</span><span class="keyword">(</span><span class="default">$request</span><span class="keyword">,</span><span class="default">$chunk_size</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$request</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">);&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// ditch the CRLF that trails the chunk
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="keyword">} while (</span><span class="default">$chunk_size</span><span class="keyword">);&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// till we reach the 0 length chunk (end marker)
<br />
&nbsp;&nbsp; </span><span class="keyword">else {
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="comment">// check for specified content length
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'/Content\\-Length:\\s+([0-9]*)\\r\\n/'</span><span class="keyword">,</span><span class="default">$header</span><span class="keyword">,</span><span class="default">$matches</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$response</span><span class="keyword">=</span><span class="default">fread</span><span class="keyword">(</span><span class="default">$request</span><span class="keyword">,</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);
<br />
&nbsp;&nbsp; &nbsp;&nbsp; } else {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// not a nice way to do it (may also result in extra CRLF which trails the real content???)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$request</span><span class="keyword">)) </span><span class="default">$response </span><span class="keyword">.= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$request</span><span class="keyword">, </span><span class="default">4096</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; }
<br />
&nbsp;&nbsp; </span><span class="comment">// close connection
<br />
&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$request</span><span class="keyword">);
<br />
}
<br />

<br />
</span><span class="comment">// do something useful with the response
<br />
</span><span class="keyword">print(</span><span class="default">$header</span><span class="keyword">);
<br />
print(</span><span class="default">$response</span><span class="keyword">);
<br />

<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Richard.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="34887""></a>
  <div class="note">
   <strong class="user">joe at edwardsconsultants dot com</strong>
   <a href="#34887" class="date">10-Aug-2003 11:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
just a quick note for users attempting https and thinking they must resort to curl or alternate methods -
<br />
you can use fsockopen, just read the docs closely.&nbsp; basically they are saying to use 'ssl://' for a HTTPS (SSL) web request.
<br />

<br />
so this would work for authorize.net, and others; even for that paypal IPN - however I think it would be best to leave the site and deal with paypal's form:
<br />

<br />
<span class="default">&lt;?php
<br />
$host </span><span class="keyword">= </span><span class="string">"something.example.com"</span><span class="keyword">;
<br />
</span><span class="default">$port </span><span class="keyword">= </span><span class="default">443</span><span class="keyword">;
<br />
</span><span class="default">$path </span><span class="keyword">= </span><span class="string">"/the/url/path/file.php"</span><span class="keyword">; </span><span class="comment">//or .dll, etc. for authnet, etc.
<br />

<br />
//you will need to setup an array of fields to post with
<br />
//then create the post string
<br />
</span><span class="default">$formdata </span><span class="keyword">= array ( </span><span class="string">"x_field" </span><span class="keyword">=&gt; </span><span class="string">"somevalue"</span><span class="keyword">);
<br />
</span><span class="comment">//build the post string
<br />
&nbsp; </span><span class="keyword">foreach(</span><span class="default">$formdata </span><span class="keyword">AS </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$val</span><span class="keyword">){
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$poststring </span><span class="keyword">.= </span><span class="default">urlencode</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">) . </span><span class="string">"=" </span><span class="keyword">. </span><span class="default">urlencode</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">) . </span><span class="string">"&amp;"</span><span class="keyword">;
<br />
&nbsp; }
<br />
</span><span class="comment">// strip off trailing ampersand
<br />
</span><span class="default">$poststring </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$poststring</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, -</span><span class="default">1</span><span class="keyword">);
<br />

<br />
</span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="string">"ssl://"</span><span class="keyword">.</span><span class="default">$host</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">$timeout </span><span class="keyword">= </span><span class="default">30</span><span class="keyword">);
<br />

<br />
if(!</span><span class="default">$fp</span><span class="keyword">){
<br />
&nbsp;</span><span class="comment">//error tell us
<br />
&nbsp;</span><span class="keyword">echo </span><span class="string">"</span><span class="default">$errstr</span><span class="string"> (</span><span class="default">$errno</span><span class="string">)\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; 
<br />
}else{
<br />

<br />
&nbsp; </span><span class="comment">//send the server request
<br />
&nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="string">"POST </span><span class="default">$path</span><span class="string"> HTTP/1.1\r\n"</span><span class="keyword">);
<br />
&nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="string">"Host: </span><span class="default">$host</span><span class="string">\r\n"</span><span class="keyword">);
<br />
&nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="string">"Content-type: application/x-www-form-urlencoded\r\n"</span><span class="keyword">);
<br />
&nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="string">"Content-length: "</span><span class="keyword">.</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$poststring</span><span class="keyword">).</span><span class="string">"\r\n"</span><span class="keyword">);
<br />
&nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="string">"Connection: close\r\n\r\n"</span><span class="keyword">);
<br />
&nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$poststring </span><span class="keyword">. </span><span class="string">"\r\n\r\n"</span><span class="keyword">);
<br />

<br />
&nbsp; </span><span class="comment">//loop through the response from the server
<br />
&nbsp; </span><span class="keyword">while(!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">)) {
<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">4096</span><span class="keyword">);
<br />
&nbsp; }
<br />
&nbsp; </span><span class="comment">//close fp - we are done with it
<br />
&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="34551""></a>
  <div class="note">
   <strong class="user">sergiopaternoster at tiscali dot it</strong>
   <a href="#34551" class="date">30-Jul-2003 07:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to connect via Telnet, it could be useful to set also the Terminal Type (some OS requires it)
<br />

<br />
<span class="default">&lt;?php
<br />
$IAC&nbsp; </span><span class="keyword">= </span><span class="default">chr</span><span class="keyword">(</span><span class="default">255</span><span class="keyword">);&nbsp;&nbsp; </span><span class="comment">/* interpret as command: */
<br />
</span><span class="default">$SB </span><span class="keyword">= </span><span class="default">chr</span><span class="keyword">(</span><span class="default">250</span><span class="keyword">);&nbsp; &nbsp;&nbsp; </span><span class="comment">/* interpret as subnegotiation */
<br />
</span><span class="default">$SE </span><span class="keyword">= </span><span class="default">chr</span><span class="keyword">(</span><span class="default">240</span><span class="keyword">);&nbsp; &nbsp;&nbsp; </span><span class="comment">/* end sub negotiation */
<br />
</span><span class="default">$TELOPT_TTYPE </span><span class="keyword">= </span><span class="default">chr</span><span class="keyword">(</span><span class="default">24</span><span class="keyword">);&nbsp; &nbsp;&nbsp; </span><span class="comment">/* terminal type */
<br />
</span><span class="default">$TELQUAL_IS </span><span class="keyword">= </span><span class="default">chr</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">/* Option is... */
<br />

<br />
//sending Terminal Type
<br />
</span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$sock</span><span class="keyword">,</span><span class="default">$IAC</span><span class="keyword">.</span><span class="default">$SB</span><span class="keyword">.</span><span class="default">$TELOPT_TTYPE</span><span class="keyword">.</span><span class="default">$TELQUAL_IS</span><span class="keyword">.</span><span class="string">'vt100'</span><span class="keyword">.</span><span class="default">$IAC</span><span class="keyword">.</span><span class="default">$SE</span><span class="keyword">);
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
ciao
<br />
Sergio Paternoster</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="33888""></a>
  <div class="note">
   <strong class="user">brage (a t) jeffnappi (d.o.t) commie</strong>
   <a href="#33888" class="date">10-Jul-2003 11:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
thought you guys may appreciate this function, allows you to pass an array of urls to download and does so simultaneously using non-blocking sockets, then returns the data in an array.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="comment">// function connects to an array of URLS at the same time
<br />
// and returns an array of results.
<br />

<br />
</span><span class="keyword">function </span><span class="default">multiHTTP </span><span class="keyword">(</span><span class="default">$urlArr</span><span class="keyword">) {
<br />
&nbsp;</span><span class="default">$sockets </span><span class="keyword">= Array(); </span><span class="comment">// socket array!
<br />
&nbsp;</span><span class="default">$urlInfo </span><span class="keyword">= Array(); </span><span class="comment">// info arr
<br />
&nbsp;</span><span class="default">$retDone </span><span class="keyword">= Array();
<br />
&nbsp;</span><span class="default">$retData </span><span class="keyword">= Array();
<br />
&nbsp;</span><span class="default">$errno&nbsp;&nbsp; </span><span class="keyword">= Array();
<br />
&nbsp;</span><span class="default">$errstr&nbsp; </span><span class="keyword">= Array();
<br />
&nbsp;for (</span><span class="default">$x</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$x</span><span class="keyword">&lt;</span><span class="default">count</span><span class="keyword">(</span><span class="default">$urlArr</span><span class="keyword">);</span><span class="default">$x</span><span class="keyword">++) {
<br />
&nbsp; </span><span class="default">$urlInfo</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">] = </span><span class="default">parse_url</span><span class="keyword">(</span><span class="default">$urlArr</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">]);
<br />
&nbsp; </span><span class="default">$urlInfo</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">][</span><span class="default">port</span><span class="keyword">] = (</span><span class="default">$urlInfo</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">][</span><span class="default">port</span><span class="keyword">]) ? </span><span class="default">$urlInfo</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">][</span><span class="default">port</span><span class="keyword">] : </span><span class="default">80</span><span class="keyword">;
<br />
&nbsp; </span><span class="default">$urlInfo</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">][</span><span class="default">path</span><span class="keyword">] = (</span><span class="default">$urlInfo</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">][</span><span class="default">path</span><span class="keyword">]) ? </span><span class="default">$urlInfo</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">][</span><span class="default">path</span><span class="keyword">] : </span><span class="string">"/"</span><span class="keyword">;
<br />
&nbsp; </span><span class="default">$sockets</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">] = </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$urlInfo</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">][</span><span class="default">host</span><span class="keyword">], </span><span class="default">$urlInfo</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">][</span><span class="default">port</span><span class="keyword">],
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$errno</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">], </span><span class="default">$errstr</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">], </span><span class="default">30</span><span class="keyword">);
<br />
&nbsp; </span><span class="default">socket_set_blocking</span><span class="keyword">(</span><span class="default">$sockets</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">],</span><span class="default">FALSE</span><span class="keyword">);
<br />
&nbsp; </span><span class="default">$query </span><span class="keyword">= (</span><span class="default">$urlInfo</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">][</span><span class="default">query</span><span class="keyword">]) ? </span><span class="string">"?" </span><span class="keyword">. </span><span class="default">$urlInfo</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">][</span><span class="default">query</span><span class="keyword">] : </span><span class="string">""</span><span class="keyword">;
<br />
&nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$sockets</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">],</span><span class="string">"GET " </span><span class="keyword">. </span><span class="default">$urlInfo</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">][</span><span class="default">path</span><span class="keyword">] . </span><span class="string">"</span><span class="default">$query</span><span class="string"> HTTP/1.0\r\nHost: " </span><span class="keyword">.
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$urlInfo</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">][</span><span class="default">host</span><span class="keyword">] . </span><span class="string">"\r\n\r\n"</span><span class="keyword">);
<br />
&nbsp;}
<br />
&nbsp;</span><span class="comment">// ok read the data from each one
<br />
&nbsp;</span><span class="default">$done </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;
<br />
&nbsp;while (!</span><span class="default">$done</span><span class="keyword">) {
<br />
&nbsp; for (</span><span class="default">$x</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$x </span><span class="keyword">&lt; </span><span class="default">count</span><span class="keyword">(</span><span class="default">$urlArr</span><span class="keyword">);</span><span class="default">$x</span><span class="keyword">++) {
<br />
&nbsp;&nbsp; if (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$sockets</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">])) {
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$retData</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">]) {
<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$retData</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">] .= </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$sockets</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">],</span><span class="default">128</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; } else {
<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$retData</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">] = </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$sockets</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">],</span><span class="default">128</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp; } else {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$retDone</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">] = </span><span class="default">1</span><span class="keyword">;
<br />
&nbsp;&nbsp; }
<br />
&nbsp; }
<br />
&nbsp; </span><span class="default">$done </span><span class="keyword">= (</span><span class="default">array_sum</span><span class="keyword">(</span><span class="default">$retDone</span><span class="keyword">) == </span><span class="default">count</span><span class="keyword">(</span><span class="default">$urlArr</span><span class="keyword">));
<br />
&nbsp;}
<br />
&nbsp;return </span><span class="default">$retData</span><span class="keyword">;
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="33411""></a>
  <div class="note">
   <strong class="user">xbensemhoun at t-systems dot fr</strong>
   <a href="#33411" class="date">25-Jun-2003 11:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To make a telnet connection with a Cisco router:
<br />

<br />
<span class="default">&lt;?php
<br />
$cfgServer </span><span class="keyword">= </span><span class="string">"nnn.nnn.nnn.nnn"</span><span class="keyword">;&nbsp; </span><span class="comment">//IP of your router
<br />
</span><span class="default">$cfgPort&nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">23</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">//port, 22 if SSH
<br />
</span><span class="default">$cfgTimeOut </span><span class="keyword">= </span><span class="default">10</span><span class="keyword">;
<br />

<br />
</span><span class="default">$usenet </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$cfgServer</span><span class="keyword">, </span><span class="default">$cfgPort</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">$cfgTimeOut</span><span class="keyword">);
<br />

<br />
if(!</span><span class="default">$usenet</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Connexion failed\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; exit();
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
else
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Connected\n&lt;BR&gt;"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fputs </span><span class="keyword">(</span><span class="default">$usenet</span><span class="keyword">, </span><span class="string">"toto\r\n"</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fputs </span><span class="keyword">(</span><span class="default">$usenet</span><span class="keyword">, </span><span class="string">"en\r\n"</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fputs </span><span class="keyword">(</span><span class="default">$usenet</span><span class="keyword">, </span><span class="string">"tutu\r\n"</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fputs </span><span class="keyword">(</span><span class="default">$usenet</span><span class="keyword">, </span><span class="string">"exit\r\n"</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$usenet</span><span class="keyword">))
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">". "</span><span class="keyword">.</span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$usenet</span><span class="keyword">, </span><span class="default">128</span><span class="keyword">).</span><span class="string">"&lt;BR&gt;\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Then you will have:
<br />
Connected
<br />
. ????????
<br />
.
<br />
. User Access Verification
<br />
.
<br />
. Password:
<br />
. testXB&gt;en
<br />
. Password:
<br />
. testXB#exit
<br />
.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="32830""></a>
  <div class="note">
   <strong class="user">blazely at removetoemail netspace net au</strong>
   <a href="#32830" class="date">08-Jun-2003 06:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's a quick function to establish a connection to a web server that will time out if the connection is lost after a user definable amount of time or if the server can't be reached.
<br />

<br />
Also supports Basic authentication if a username/password is specified. Any improvements or criticisms, please email me! :-)
<br />

<br />
Returns either a resource ID, an error code or 0 if the server can't be reached at all. Returns -1 in the event that something really wierd happens like a non-standard http response or something. Hope it helps someone.
<br />

<br />
Cheers,
<br />

<br />
Ben Blazely
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">connectToURL</span><span class="keyword">(</span><span class="default">$addr</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">, </span><span class="default">$user</span><span class="keyword">=</span><span class="string">""</span><span class="keyword">, </span><span class="default">$pass</span><span class="keyword">=</span><span class="string">""</span><span class="keyword">, </span><span class="default">$timeout</span><span class="keyword">=</span><span class="string">"30"</span><span class="keyword">)
<br />
{
<br />
&nbsp;</span><span class="default">$urlHandle </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$addr</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">$timeout</span><span class="keyword">);
<br />
&nbsp;if (</span><span class="default">$urlHandle</span><span class="keyword">)
<br />
&nbsp;{
<br />
&nbsp; </span><span class="default">socket_set_timeout</span><span class="keyword">(</span><span class="default">$urlHandle</span><span class="keyword">, </span><span class="default">$timeout</span><span class="keyword">);
<br />
&nbsp; if (</span><span class="default">$path</span><span class="keyword">)
<br />
&nbsp; {
<br />
&nbsp;&nbsp; </span><span class="default">$urlString </span><span class="keyword">= </span><span class="string">"GET </span><span class="default">$path</span><span class="string"> HTTP/1.0\r\nHost: </span><span class="default">$addr</span><span class="string">\r\nConnection: Keep-Alive\r\nUser-Agent: MyURLGrabber\r\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; if (</span><span class="default">$user</span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$urlString </span><span class="keyword">.= </span><span class="string">"Authorization: Basic "</span><span class="keyword">.</span><span class="default">base64_encode</span><span class="keyword">(</span><span class="string">"</span><span class="default">$user</span><span class="string">:</span><span class="default">$pass</span><span class="string">"</span><span class="keyword">).</span><span class="string">"\r\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$urlString </span><span class="keyword">.= </span><span class="string">"\r\n"</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$urlHandle</span><span class="keyword">, </span><span class="default">$urlString</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$response </span><span class="keyword">= </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$urlHandle</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">substr_count</span><span class="keyword">(</span><span class="default">$response</span><span class="keyword">, </span><span class="string">"200 OK"</span><span class="keyword">) &gt; </span><span class="default">0</span><span class="keyword">)&nbsp; &nbsp; &nbsp; </span><span class="comment">// Check the status of the link
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">{
<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$endHeader </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Strip initial header information
<br />
&nbsp;&nbsp; &nbsp; </span><span class="keyword">while ( !</span><span class="default">$endHeader</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; {
<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (</span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$urlHandle</span><span class="keyword">) == </span><span class="string">"\r\n"</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$endHeader </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; }
<br />

<br />
&nbsp;&nbsp; &nbsp; return </span><span class="default">$urlHandle</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// All OK, return the file handle
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">}
<br />
&nbsp;&nbsp;&nbsp; else if (</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$response</span><span class="keyword">) &lt; </span><span class="default">15</span><span class="keyword">)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Cope with wierd non standard responses
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">{
<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$urlHandle</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; return -</span><span class="default">1</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; else&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Cope with a standard error response
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">{
<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$urlHandle</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; return </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$response</span><span class="keyword">,</span><span class="default">9</span><span class="keyword">,</span><span class="default">3</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp; return </span><span class="default">$urlHandle</span><span class="keyword">;
<br />
&nbsp; }
<br />
&nbsp; else
<br />
&nbsp; {
<br />
&nbsp;&nbsp; return </span><span class="default">0</span><span class="keyword">;
<br />
&nbsp; }
<br />
&nbsp;}
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="29005""></a>
  <div class="note">
   <strong class="user">Sherif Gayed</strong>
   <a href="#29005" class="date">30-Jan-2003 07:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is how to connect to the web from behind a proxy server:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="comment">/*************start code**************/
<br />
/*your proxy server address*/
<br />
</span><span class="default">$proxy </span><span class="keyword">= </span><span class="string">"192.168.10.1"</span><span class="keyword">;
<br />
</span><span class="comment">/*your proxy server port*/
<br />
</span><span class="default">$port </span><span class="keyword">= </span><span class="default">8080</span><span class="keyword">;
<br />
</span><span class="comment">/*the url you want to connect to*/
<br />
</span><span class="default">$url </span><span class="keyword">= </span><span class="string">"<a href="http://www.php.net/" rel="nofollow" target="_blank">http://www.php.net/</a>"</span><span class="keyword">;
<br />
</span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$proxy</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">);
<br />
</span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="string">"GET </span><span class="default">$url</span><span class="string"> HTTP/1.0\r\nHost: </span><span class="default">$proxy</span><span class="string">\r\n\r\n"</span><span class="keyword">);
<br />
while(!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">)){
<br />
&nbsp; </span><span class="default">$line </span><span class="keyword">= </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">4000</span><span class="keyword">);
<br />
&nbsp; print(</span><span class="default">$line</span><span class="keyword">);
<br />
}
<br />
</span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);
<br />
</span><span class="comment">/**************end code**************/
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="28137""></a>
  <div class="note">
   <strong class="user">g dot bashi at ntlworld dot com</strong>
   <a href="#28137" class="date">03-Jan-2003 06:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The timeout parameter was not supported under windows until PHP 4.3.0, previously it was fixed at 30sec.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="27755""></a>
  <div class="note">
   <strong class="user">dan at lovepond dot com</strong>
   <a href="#27755" class="date">17-Dec-2002 10:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is some code to help out abit more with the EOF problem.
<br />
I had a problem where I needed to strip out so many lines of server input to get back right data i wanted.
<br />

<br />
<span class="default">&lt;?php
<br />
$port</span><span class="keyword">=</span><span class="default">4000</span><span class="keyword">;
<br />
</span><span class="default">$host</span><span class="keyword">=</span><span class="string">"localhost"</span><span class="keyword">;
<br />
</span><span class="default">$message</span><span class="keyword">=</span><span class="string">"test"</span><span class="keyword">;
<br />
</span><span class="default">$status</span><span class="keyword">=</span><span class="default">senddata</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">,</span><span class="default">$port</span><span class="keyword">,</span><span class="default">$message</span><span class="keyword">);
<br />
print </span><span class="string">"</span><span class="default">$status</span><span class="string">"</span><span class="keyword">;
<br />

<br />
function </span><span class="default">senddata</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">,</span><span class="default">$port</span><span class="keyword">,</span><span class="default">$message</span><span class="keyword">) {
<br />

<br />
</span><span class="comment">#takes in account servers that do not return EOF character
<br />
#send data to server and get back input
<br />

<br />
#function globals
<br />
</span><span class="default">$linenumber</span><span class="keyword">=</span><span class="string">"2"</span><span class="keyword">; </span><span class="comment">#amount of lines to get rid of before we give input
<br />
</span><span class="default">$lineamount</span><span class="keyword">=</span><span class="string">"1"</span><span class="keyword">; </span><span class="comment">#amount of lines to read after we give input
<br />

<br />
</span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="string">"</span><span class="default">$host</span><span class="string">"</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">30</span><span class="keyword">);
<br />
if (!</span><span class="default">$fp</span><span class="keyword">) {
<br />
&nbsp;&nbsp; echo </span><span class="string">"</span><span class="default">$errstr</span><span class="string"> (</span><span class="default">$errno</span><span class="string">)"</span><span class="keyword">;
<br />
}
<br />
else {
<br />
&nbsp;&nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$linenumber</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">fread </span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$bytes_left </span><span class="keyword">= </span><span class="default">socket_get_status</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (</span><span class="default">$bytes_left </span><span class="keyword">&gt; </span><span class="default">0</span><span class="keyword">) { </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$bytes_left</span><span class="keyword">[</span><span class="default">unread_bytes</span><span class="keyword">]); }
<br />
&nbsp;&nbsp; }
<br />
&nbsp;&nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="string">"</span><span class="default">$message</span><span class="string">\r\n"</span><span class="keyword">);
<br />
&nbsp;&nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$lineamount</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$status</span><span class="keyword">.=</span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$bytes_left </span><span class="keyword">= </span><span class="default">socket_get_status</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (</span><span class="default">$bytes_left </span><span class="keyword">&gt; </span><span class="default">0</span><span class="keyword">) { </span><span class="default">$status</span><span class="keyword">.=</span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$bytes_left</span><span class="keyword">[</span><span class="default">unread_bytes</span><span class="keyword">]); }
<br />
&nbsp;&nbsp; }
<br />
&nbsp;&nbsp; </span><span class="default">fclose </span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);
<br />
}
<br />

<br />
return </span><span class="default">$status</span><span class="keyword">;
<br />
}
<br />

<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="26074""></a>
  <div class="note">
   <strong class="user">verran at descent-rangers dot com</strong>
   <a href="#26074" class="date">17-Oct-2002 04:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I was tearing my hair out for a week trying to figure out how to do this.
<br />

<br />
If you use fsockopen with a service that doesn't have an EOF, or you try to read beyond EOF or line break, PHP can hang completely.
<br />

<br />
In my case, I was trying to write a class that talks to Kali servers (www.kali.net) to get a list of people on the chat server. To keep PHP from hanging due to the above, I discovered this:
<br />

<br />
<span class="default">&lt;?php
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">class </span><span class="default">kali_utils </span><span class="keyword">{
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; function </span><span class="default">games_list</span><span class="keyword">(</span><span class="default">$kali_server_ip</span><span class="keyword">, </span><span class="default">$kali_server_port</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">= array();
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$kali_server_ip</span><span class="keyword">, </span><span class="default">$kali_server_port</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$error</span><span class="keyword">, </span><span class="default">30</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">$fp</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result</span><span class="keyword">[</span><span class="string">"errno"</span><span class="keyword">] = </span><span class="default">$errno</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result</span><span class="keyword">[</span><span class="string">"error"</span><span class="keyword">] = </span><span class="default">$error</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="string">"KALIQ"</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$header </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">5</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bytes_left </span><span class="keyword">= </span><span class="default">socket_get_status</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$bytes_left </span><span class="keyword">&gt; </span><span class="default">0</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result</span><span class="keyword">[</span><span class="string">"results"</span><span class="keyword">] = </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$bytes_left</span><span class="keyword">[</span><span class="string">"unread_bytes"</span><span class="keyword">]);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result</span><span class="keyword">[</span><span class="string">"results"</span><span class="keyword">] = </span><span class="string">""</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$result</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
When I send the request packet, I get a response packet of length 5. Then I call socket_get_status() and use the unread_bytes key from it to know how far to fread from the socket. Works very good.
<br />

<br />
I've only used this on PHP 4.2.1 so far.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="23481""></a>
  <div class="note">
   <strong class="user">iain at monitormedia dot co dot uk</strong>
   <a href="#23481" class="date">19-Jul-2002 02:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's how to send an email using SMTP. This includes rudimentary checking on server responses during the process of sending an email. Could be improved by more comprehensive processing of the result codes...or going on to the next mail exchanger when you fail after connecting to the first.
<br />

<br />
<span class="default">&lt;?php
<br />

<br />
</span><span class="keyword">function </span><span class="default">another_mail</span><span class="keyword">(</span><span class="default">$to</span><span class="keyword">,</span><span class="default">$subject</span><span class="keyword">,</span><span class="default">$headers</span><span class="keyword">,</span><span class="default">$message</span><span class="keyword">)
<br />
{
<br />
&nbsp;</span><span class="comment">// Could get this from the php ini?
<br />
&nbsp;</span><span class="default">$from</span><span class="keyword">=</span><span class="string">"me@example.com"</span><span class="keyword">;
<br />
&nbsp;list(</span><span class="default">$me</span><span class="keyword">,</span><span class="default">$mydomain</span><span class="keyword">) = </span><span class="default">split</span><span class="keyword">(</span><span class="string">"@"</span><span class="keyword">,</span><span class="default">$from</span><span class="keyword">);
<br />

<br />
&nbsp;</span><span class="comment">// Now look up the mail exchangers for the recipient
<br />
&nbsp;</span><span class="keyword">list(</span><span class="default">$user</span><span class="keyword">,</span><span class="default">$domain</span><span class="keyword">) = </span><span class="default">split</span><span class="keyword">(</span><span class="string">"@"</span><span class="keyword">,</span><span class="default">$to</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">);
<br />
&nbsp;if(</span><span class="default">getmxrr</span><span class="keyword">(</span><span class="default">$domain</span><span class="keyword">,</span><span class="default">$mx</span><span class="keyword">,</span><span class="default">$weight</span><span class="keyword">) == </span><span class="default">0</span><span class="keyword">)&nbsp; return </span><span class="default">FALSE</span><span class="keyword">;
<br />

<br />
&nbsp;</span><span class="comment">// Try them in order of lowest weight first
<br />
&nbsp;</span><span class="default">array_multisort</span><span class="keyword">(</span><span class="default">$mx</span><span class="keyword">,</span><span class="default">$weight</span><span class="keyword">);
<br />
&nbsp;</span><span class="default">$success</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;
<br />

<br />
&nbsp;foreach(</span><span class="default">$mx </span><span class="keyword">as </span><span class="default">$host</span><span class="keyword">) {
<br />
&nbsp; </span><span class="comment">// Open an SMTP connection
<br />
&nbsp; </span><span class="default">$connection </span><span class="keyword">= </span><span class="default">fsockopen </span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">, </span><span class="default">25</span><span class="keyword">, </span><span class="default">$errno</span><span class="keyword">, </span><span class="default">$errstr</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);
<br />
&nbsp; if (!</span><span class="default">$connection</span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; continue;
<br />
&nbsp; </span><span class="default">$res</span><span class="keyword">=</span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">,</span><span class="default">256</span><span class="keyword">);
<br />
&nbsp; if(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$res</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">3</span><span class="keyword">) != </span><span class="string">"220"</span><span class="keyword">) break;
<br />

<br />
&nbsp; </span><span class="comment">// Introduce ourselves
<br />
&nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">, </span><span class="string">"HELO </span><span class="default">$mydomain</span><span class="string">\n"</span><span class="keyword">);
<br />
&nbsp; </span><span class="default">$res</span><span class="keyword">=</span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">,</span><span class="default">256</span><span class="keyword">);
<br />
&nbsp; if(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$res</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">3</span><span class="keyword">) != </span><span class="string">"250"</span><span class="keyword">) break;
<br />

<br />
&nbsp; </span><span class="comment">// Envelope from
<br />
&nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">, </span><span class="string">"MAIL FROM: </span><span class="default">$from</span><span class="string">\n"</span><span class="keyword">);
<br />
&nbsp; </span><span class="default">$res</span><span class="keyword">=</span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">,</span><span class="default">256</span><span class="keyword">);
<br />
&nbsp; if(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$res</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">3</span><span class="keyword">) != </span><span class="string">"250"</span><span class="keyword">) break;
<br />

<br />
&nbsp; </span><span class="comment">// Envelope to
<br />
&nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">, </span><span class="string">"RCPT TO: </span><span class="default">$to</span><span class="string">\n"</span><span class="keyword">);
<br />
&nbsp; </span><span class="default">$res</span><span class="keyword">=</span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">,</span><span class="default">256</span><span class="keyword">);
<br />
&nbsp; if(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$res</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">3</span><span class="keyword">) != </span><span class="string">"250"</span><span class="keyword">) break;
<br />

<br />
&nbsp; </span><span class="comment">// The message
<br />
&nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">, </span><span class="string">"DATA\n"</span><span class="keyword">);
<br />
&nbsp; </span><span class="default">$res</span><span class="keyword">=</span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">,</span><span class="default">256</span><span class="keyword">);
<br />
&nbsp; if(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$res</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">3</span><span class="keyword">) != </span><span class="string">"354"</span><span class="keyword">) break;
<br />

<br />
&nbsp; </span><span class="comment">// Send To:, From:, Subject:, other headers, blank line, message, and finish
<br />
&nbsp; // with a period on its own line.
<br />
&nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">, </span><span class="string">"To: </span><span class="default">$to</span><span class="string">\nFrom: </span><span class="default">$from</span><span class="string">\nSubject: </span><span class="default">$subject</span><span class="string">\n</span><span class="default">$headers</span><span class="string">\n\n</span><span class="default">$message</span><span class="string">\n.\n"</span><span class="keyword">);
<br />
&nbsp; </span><span class="default">$res</span><span class="keyword">=</span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">,</span><span class="default">256</span><span class="keyword">);
<br />
&nbsp; if(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$res</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">3</span><span class="keyword">) != </span><span class="string">"250"</span><span class="keyword">) break;
<br />

<br />
&nbsp; </span><span class="comment">// Say bye bye
<br />
&nbsp; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">,</span><span class="string">"QUIT\n"</span><span class="keyword">);
<br />
&nbsp; </span><span class="default">$res</span><span class="keyword">=</span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">,</span><span class="default">256</span><span class="keyword">);
<br />
&nbsp; if(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$res</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">3</span><span class="keyword">) != </span><span class="string">"221"</span><span class="keyword">) break;
<br />

<br />
&nbsp; </span><span class="comment">// It worked! So break out of the loop which tries all the mail exchangers.
<br />
&nbsp; </span><span class="default">$success</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">;
<br />
&nbsp; break;
<br />
&nbsp;}
<br />
&nbsp;</span><span class="comment">// Debug for if we fall over - uncomment as desired
<br />
&nbsp;// print $success?"Mail sent":"Failure: $res\n";
<br />
&nbsp;</span><span class="keyword">if(</span><span class="default">$connection</span><span class="keyword">) {
<br />
&nbsp; if(</span><span class="default">$success</span><span class="keyword">==</span><span class="default">0</span><span class="keyword">) </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">, </span><span class="string">"QUIT\n"</span><span class="keyword">);
<br />
&nbsp; </span><span class="default">fclose </span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">);
<br />
&nbsp;}
<br />
&nbsp;return </span><span class="default">$success</span><span class="keyword">?</span><span class="default">TRUE</span><span class="keyword">:</span><span class="default">FALSE</span><span class="keyword">;
<br />
}
<br />

<br />
</span><span class="default">another_mail</span><span class="keyword">(</span><span class="string">"recipient@example.com"</span><span class="keyword">,</span><span class="string">"My Subject"</span><span class="keyword">,</span><span class="string">"X-mailer: PHP Script\nX-another-header: Whatever"</span><span class="keyword">,</span><span class="string">"Test email body.\n\nNote if you actually put a period on a line\nby itself, the function will terminate prematurely.\n\nYou will get a partial email sent though.\n"</span><span class="keyword">);
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
