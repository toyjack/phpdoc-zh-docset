<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>将 ISO-8859-1 编码的字符串转换为 UTF-8 编码</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.utf8-decode.html">? utf8_decode</a></li>
      <li style="float: right;"><a href="function.xml-error-string.html">xml_error_string ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.xml.html">XML 解析器函数</a></li>
    <li>将 ISO-8859-1 编码的字符串转换为 UTF-8 编码</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.utf8-encode" class="refentry">
   <div class="refnamediv">
    <h1 class="refname">utf8_encode</h1>
    <p class="verinfo">(PHP 4, PHP 5)</p><p class="refpurpose"><span class="refname">utf8_encode</span> &mdash; <span class="dc-title">将 ISO-8859-1 编码的字符串转换为 UTF-8 编码</span></p>

   </div>
   <div class="refsect1 unknown-unknown-returnvalueu" id="refsect1-function.utf8-encode-unknown-unknown-returnvalueu">
    <h3 class="title">描述</h3>
    <div class="methodsynopsis dc-description">
     <span class="type">string</span> <span class="methodname"><strong>utf8_encode</strong></span>
      ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$data</code></span>
     )</div>

    <p class="para rdfs-comment">
     该函数将 <code class="parameter">data</code> 字符串转换为 <em>UTF-8</em> 编码，并返回编码后的字符串。<em>UTF-8</em> 是一种用于将<span class="glossterm">宽字符</span>值转换为字节流的 <acronym title="Unique, Universal, and Uniform character enCoding">Unicode</acronym> 的标准机制。<em>UTF-8</em> 对于纯 <abbr class="abbrev">ASCII</abbr> 字符来说是透明的，且是自同步的（也就是说这使得程序能够得知字符从字节流的何处开始），并可被普通字符串比较函数用以比较等操作。PHP 可将 <em>UTF-8</em> 编码为多达四个字节的字符，如：
     <table class="doctable table">
      <caption><strong>UTF-8 编码</strong></caption>
      
       <thead>
        <tr>
         <th>字节（bytes）</th>
         <th>位（bits）</th>
         <th>表 示</th>
        </tr>

       </thead>

       <tbody class="tbody">
        <tr>
         <td>1</td>
         <td>7</td>
         <td>0bbbbbbb</td>
        </tr>

        <tr>
         <td>2</td>
         <td>11</td>
         <td>110bbbbb 10bbbbbb</td>
        </tr>

        <tr>
         <td>3</td>
         <td>16</td>
         <td>1110bbbb 10bbbbbb 10bbbbbb</td>
        </tr>

        <tr>
         <td>4</td>
         <td>21</td>
         <td>11110bbb 10bbbbbb 10bbbbbb 10bbbbbb</td>
        </tr>

       </tbody>
      
     </table>

    </p>
    <p class="para">
     每个 <em>UTF-8</em> 表示一个能被用以储存字符数据的位。
    </p>
   </div>

  </div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="112497""></a>
  <div class="note">
   <strong class="user">a dot rueedlinger at gmail dot com</strong>
   <a href="#112497" class="date">22-Jun-2013 10:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you need a function which converts a string array into a utf8 encoded string array then this function might be useful for you:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">utf8_string_array_encode</span><span class="keyword">(&amp;</span><span class="default">$array</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$func </span><span class="keyword">= function(&amp;</span><span class="default">$value</span><span class="keyword">,&amp;</span><span class="default">$key</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">is_string</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$value </span><span class="keyword">= </span><span class="default">utf8_encode</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">is_string</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$key </span><span class="keyword">= </span><span class="default">utf8_encode</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">utf8_string_array_encode</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; };<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">array_walk</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">,</span><span class="default">$func</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$array</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="109965""></a>
  <div class="note">
   <strong class="user">Oscar Broman</strong>
   <a href="#109965" class="date">06-Sep-2012 08:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Walk through nested arrays/objects and utf8 encode all strings.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// Usage<br />
</span><span class="keyword">class </span><span class="default">Foo </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$somevar </span><span class="keyword">= </span><span class="string">'whoop whoop'</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">$structure </span><span class="keyword">= array(<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'object' </span><span class="keyword">=&gt; (object) array(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'entry' </span><span class="keyword">=&gt; </span><span class="string">'hello w?rld'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'another_array' </span><span class="keyword">=&gt; array(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'string'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">1234</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'another string'<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; ),<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'string' </span><span class="keyword">=&gt; </span><span class="string">'foo'</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'foo_object' </span><span class="keyword">=&gt; new </span><span class="default">Foo<br />
</span><span class="keyword">);<br />
<br />
</span><span class="default">utf8_encode_deep</span><span class="keyword">(</span><span class="default">$structure</span><span class="keyword">);<br />
<br />
</span><span class="comment">// $structure is now utf8 encoded<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$structure</span><span class="keyword">);<br />
<br />
</span><span class="comment">// The function<br />
</span><span class="keyword">function </span><span class="default">utf8_encode_deep</span><span class="keyword">(&amp;</span><span class="default">$input</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">is_string</span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$input </span><span class="keyword">= </span><span class="default">utf8_encode</span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; } else if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$input </span><span class="keyword">as &amp;</span><span class="default">$value</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">utf8_encode_deep</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; unset(</span><span class="default">$value</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; } else if (</span><span class="default">is_object</span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$vars </span><span class="keyword">= </span><span class="default">array_keys</span><span class="keyword">(</span><span class="default">get_object_vars</span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">));<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$vars </span><span class="keyword">as </span><span class="default">$var</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">utf8_encode_deep</span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">-&gt;</span><span class="default">$var</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="104906""></a>
  <div class="note">
   <strong class="user">deceze at gmail dot com</strong>
   <a href="#104906" class="date">15-Jul-2011 03:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Please note that utf8_encode only converts a string encoded in ISO-8859-1 to UTF-8. A more appropriate name for it would be "iso88591_to_utf8". If your text is not encoded in&nbsp; ISO-8859-1, you do not need this function. If your text is already in UTF-8, you do not need this function. In fact, applying this function to text that is not encoded in ISO-8859-1 will most likely simply garble that text.<br />
<br />
If you need to convert text from any encoding to any other encoding, look at iconv() instead.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="103956""></a>
  <div class="note">
   <strong class="user">bastianschwarz t live punkt de</strong>
   <a href="#103956" class="date">13-May-2011 05:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
My version for converting ISO array keys to utf8:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">convertArrayKeysToUtf8</span><span class="keyword">(array </span><span class="default">$array</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$convertedArray </span><span class="keyword">= array();
<br />
&nbsp;&nbsp;&nbsp; foreach(</span><span class="default">$array </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp;&nbsp; if(!</span><span class="default">mb_check_encoding</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">, </span><span class="string">'UTF-8'</span><span class="keyword">)) </span><span class="default">$key </span><span class="keyword">= </span><span class="default">utf8_encode</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp;&nbsp; if(</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">)) </span><span class="default">$value </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">convertArrayKeysToUtf8</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$convertedArray</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">] = </span><span class="default">$value</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$convertedArray</span><span class="keyword">;
<br />
&nbsp; }
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102382""></a>
  <div class="note">
   <strong class="user">powtac 4t gmx d0t de</strong>
   <a href="#102382" class="date">11-Feb-2011 10:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I tried a lot of things, but this seems to be the final fail save method to convert any string to proper UTF-8. 
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">_convert</span><span class="keyword">(</span><span class="default">$content</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; if(!</span><span class="default">mb_check_encoding</span><span class="keyword">(</span><span class="default">$content</span><span class="keyword">, </span><span class="string">'UTF-8'</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; OR !(</span><span class="default">$content </span><span class="keyword">=== </span><span class="default">mb_convert_encoding</span><span class="keyword">(</span><span class="default">mb_convert_encoding</span><span class="keyword">(</span><span class="default">$content</span><span class="keyword">, </span><span class="string">'UTF-32'</span><span class="keyword">, </span><span class="string">'UTF-8' </span><span class="keyword">), </span><span class="string">'UTF-8'</span><span class="keyword">, </span><span class="string">'UTF-32'</span><span class="keyword">))) {
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$content </span><span class="keyword">= </span><span class="default">mb_convert_encoding</span><span class="keyword">(</span><span class="default">$content</span><span class="keyword">, </span><span class="string">'UTF-8'</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">mb_check_encoding</span><span class="keyword">(</span><span class="default">$content</span><span class="keyword">, </span><span class="string">'UTF-8'</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// log('Converted to UTF-8');
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">} else {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// log('Could not converted to UTF-8');
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">}
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$content</span><span class="keyword">;
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99925""></a>
  <div class="note">
   <strong class="user">Yumok</strong>
   <a href="#99925" class="date">15-Sep-2010 01:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Avoiding use of preg_match to detect if utf8_encode is needed:
<br />

<br />
<span class="default">&lt;?php
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $string </span><span class="keyword">= </span><span class="default">$string_input</span><span class="keyword">; </span><span class="comment">// avoid being destructive
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$string </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"#[\x09\x0A\x0D\x20-\x7E]#"&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">,</span><span class="string">""</span><span class="keyword">,</span><span class="default">$string</span><span class="keyword">);&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// ASCII
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$string </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"#[\xC2-\xDF][\x80-\xBF]#"&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">,</span><span class="string">""</span><span class="keyword">,</span><span class="default">$string</span><span class="keyword">);&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// non-overlong 2-byte
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$string </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"#\xE0[\xA0-\xBF][\x80-\xBF]#"&nbsp; &nbsp; </span><span class="keyword">,</span><span class="string">""</span><span class="keyword">,</span><span class="default">$string</span><span class="keyword">);&nbsp; &nbsp;&nbsp; </span><span class="comment">// excluding overlongs
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$string </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"#[\xE1-\xEC\xEE\xEF][\x80-\xBF]{2}#"</span><span class="keyword">,</span><span class="string">""</span><span class="keyword">,</span><span class="default">$string</span><span class="keyword">);&nbsp; &nbsp;&nbsp; </span><span class="comment">// straight 3-byte
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$string </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"#\xED[\x80-\x9F][\x80-\xBF]#"&nbsp; &nbsp; </span><span class="keyword">,</span><span class="string">""</span><span class="keyword">,</span><span class="default">$string</span><span class="keyword">);&nbsp; &nbsp;&nbsp; </span><span class="comment">// excluding surrogates
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$string </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"#\xF0[\x90-\xBF][\x80-\xBF]{2}#"</span><span class="keyword">,</span><span class="string">""</span><span class="keyword">,</span><span class="default">$string</span><span class="keyword">);&nbsp; &nbsp;&nbsp; </span><span class="comment">// planes 1-3
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$string </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"#[\xF1-\xF3][\x80-\xBF]{3}#"&nbsp; &nbsp; </span><span class="keyword">,</span><span class="string">""</span><span class="keyword">,</span><span class="default">$string</span><span class="keyword">);&nbsp; &nbsp;&nbsp; </span><span class="comment">//&nbsp; planes 4-15
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$string </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"#\xF4[\x80-\x8F][\x80-\xBF]{2}#"</span><span class="keyword">,</span><span class="string">""</span><span class="keyword">,</span><span class="default">$string</span><span class="keyword">);&nbsp; &nbsp;&nbsp; </span><span class="comment">// plane 16
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$rc </span><span class="keyword">= (</span><span class="default">$string </span><span class="keyword">== </span><span class="string">""</span><span class="keyword">?</span><span class="default">true</span><span class="keyword">:</span><span class="default">false</span><span class="keyword">);
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99311""></a>
  <div class="note">
   <strong class="user">darkenergy at hispeed dot ch</strong>
   <a href="#99311" class="date">10-Aug-2010 03:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
to encode a string only if it is not yet UTF-8, the most elegant solution i found is:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">//$s is a string from whatever source<br />
</span><span class="default">mb_detect_encoding</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">, </span><span class="string">"UTF-8"</span><span class="keyword">) == </span><span class="string">"UTF-8" </span><span class="keyword">? : </span><span class="default">$s </span><span class="keyword">= </span><span class="default">utf8_encode</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
hope it helps</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93162""></a>
  <div class="note">
   <strong class="user">squeegee</strong>
   <a href="#93162" class="date">26-Aug-2009 03:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I think this is a reasonable port of Perl's Encoding::FixLatin by Grant McLean, which converts a string with mixed encodings (ASCII, ISO-8859-1, CP1252, and UTF-8) to UTF-8.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">init_byte_map</span><span class="keyword">(){<br />
&nbsp; global </span><span class="default">$byte_map</span><span class="keyword">;<br />
&nbsp; for(</span><span class="default">$x</span><span class="keyword">=</span><span class="default">128</span><span class="keyword">;</span><span class="default">$x</span><span class="keyword">&lt;</span><span class="default">256</span><span class="keyword">;++</span><span class="default">$x</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$byte_map</span><span class="keyword">[</span><span class="default">chr</span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">)]=</span><span class="default">utf8_encode</span><span class="keyword">(</span><span class="default">chr</span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">));<br />
&nbsp; }<br />
&nbsp; </span><span class="default">$cp1252_map</span><span class="keyword">=array(<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\x80"</span><span class="keyword">=&gt;</span><span class="string">"\xE2\x82\xAC"</span><span class="keyword">,&nbsp; &nbsp; </span><span class="comment">// EURO SIGN<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\x82" </span><span class="keyword">=&gt; </span><span class="string">"\xE2\x80\x9A"</span><span class="keyword">,&nbsp; </span><span class="comment">// SINGLE LOW-9 QUOTATION MARK<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\x83" </span><span class="keyword">=&gt; </span><span class="string">"\xC6\x92"</span><span class="keyword">,&nbsp; &nbsp; &nbsp; </span><span class="comment">// LATIN SMALL LETTER F WITH HOOK<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\x84" </span><span class="keyword">=&gt; </span><span class="string">"\xE2\x80\x9E"</span><span class="keyword">,&nbsp; </span><span class="comment">// DOUBLE LOW-9 QUOTATION MARK<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\x85" </span><span class="keyword">=&gt; </span><span class="string">"\xE2\x80\xA6"</span><span class="keyword">,&nbsp; </span><span class="comment">// HORIZONTAL ELLIPSIS<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\x86" </span><span class="keyword">=&gt; </span><span class="string">"\xE2\x80\xA0"</span><span class="keyword">,&nbsp; </span><span class="comment">// DAGGER<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\x87" </span><span class="keyword">=&gt; </span><span class="string">"\xE2\x80\xA1"</span><span class="keyword">,&nbsp; </span><span class="comment">// DOUBLE DAGGER<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\x88" </span><span class="keyword">=&gt; </span><span class="string">"\xCB\x86"</span><span class="keyword">,&nbsp; &nbsp; &nbsp; </span><span class="comment">// MODIFIER LETTER CIRCUMFLEX ACCENT<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\x89" </span><span class="keyword">=&gt; </span><span class="string">"\xE2\x80\xB0"</span><span class="keyword">,&nbsp; </span><span class="comment">// PER MILLE SIGN<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\x8A" </span><span class="keyword">=&gt; </span><span class="string">"\xC5\xA0"</span><span class="keyword">,&nbsp; &nbsp; &nbsp; </span><span class="comment">// LATIN CAPITAL LETTER S WITH CARON<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\x8B" </span><span class="keyword">=&gt; </span><span class="string">"\xE2\x80\xB9"</span><span class="keyword">,&nbsp; </span><span class="comment">// SINGLE LEFT-POINTING ANGLE QUOTATION MARK<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\x8C" </span><span class="keyword">=&gt; </span><span class="string">"\xC5\x92"</span><span class="keyword">,&nbsp; &nbsp; &nbsp; </span><span class="comment">// LATIN CAPITAL LIGATURE OE<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\x8E" </span><span class="keyword">=&gt; </span><span class="string">"\xC5\xBD"</span><span class="keyword">,&nbsp; &nbsp; &nbsp; </span><span class="comment">// LATIN CAPITAL LETTER Z WITH CARON<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\x91" </span><span class="keyword">=&gt; </span><span class="string">"\xE2\x80\x98"</span><span class="keyword">,&nbsp; </span><span class="comment">// LEFT SINGLE QUOTATION MARK<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\x92" </span><span class="keyword">=&gt; </span><span class="string">"\xE2\x80\x99"</span><span class="keyword">,&nbsp; </span><span class="comment">// RIGHT SINGLE QUOTATION MARK<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\x93" </span><span class="keyword">=&gt; </span><span class="string">"\xE2\x80\x9C"</span><span class="keyword">,&nbsp; </span><span class="comment">// LEFT DOUBLE QUOTATION MARK<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\x94" </span><span class="keyword">=&gt; </span><span class="string">"\xE2\x80\x9D"</span><span class="keyword">,&nbsp; </span><span class="comment">// RIGHT DOUBLE QUOTATION MARK<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\x95" </span><span class="keyword">=&gt; </span><span class="string">"\xE2\x80\xA2"</span><span class="keyword">,&nbsp; </span><span class="comment">// BULLET<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\x96" </span><span class="keyword">=&gt; </span><span class="string">"\xE2\x80\x93"</span><span class="keyword">,&nbsp; </span><span class="comment">// EN DASH<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\x97" </span><span class="keyword">=&gt; </span><span class="string">"\xE2\x80\x94"</span><span class="keyword">,&nbsp; </span><span class="comment">// EM DASH<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\x98" </span><span class="keyword">=&gt; </span><span class="string">"\xCB\x9C"</span><span class="keyword">,&nbsp; &nbsp; &nbsp; </span><span class="comment">// SMALL TILDE<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\x99" </span><span class="keyword">=&gt; </span><span class="string">"\xE2\x84\xA2"</span><span class="keyword">,&nbsp; </span><span class="comment">// TRADE MARK SIGN<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\x9A" </span><span class="keyword">=&gt; </span><span class="string">"\xC5\xA1"</span><span class="keyword">,&nbsp; &nbsp; &nbsp; </span><span class="comment">// LATIN SMALL LETTER S WITH CARON<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\x9B" </span><span class="keyword">=&gt; </span><span class="string">"\xE2\x80\xBA"</span><span class="keyword">,&nbsp; </span><span class="comment">// SINGLE RIGHT-POINTING ANGLE QUOTATION MARK<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\x9C" </span><span class="keyword">=&gt; </span><span class="string">"\xC5\x93"</span><span class="keyword">,&nbsp; &nbsp; &nbsp; </span><span class="comment">// LATIN SMALL LIGATURE OE<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\x9E" </span><span class="keyword">=&gt; </span><span class="string">"\xC5\xBE"</span><span class="keyword">,&nbsp; &nbsp; &nbsp; </span><span class="comment">// LATIN SMALL LETTER Z WITH CARON<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\x9F" </span><span class="keyword">=&gt; </span><span class="string">"\xC5\xB8"&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// LATIN CAPITAL LETTER Y WITH DIAERESIS<br />
&nbsp; </span><span class="keyword">);<br />
&nbsp; foreach(</span><span class="default">$cp1252_map </span><span class="keyword">as </span><span class="default">$k</span><span class="keyword">=&gt;</span><span class="default">$v</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$byte_map</span><span class="keyword">[</span><span class="default">$k</span><span class="keyword">]=</span><span class="default">$v</span><span class="keyword">;<br />
&nbsp; }<br />
}<br />
<br />
function </span><span class="default">fix_latin</span><span class="keyword">(</span><span class="default">$instr</span><span class="keyword">){<br />
&nbsp; if(</span><span class="default">mb_check_encoding</span><span class="keyword">(</span><span class="default">$instr</span><span class="keyword">,</span><span class="string">'UTF-8'</span><span class="keyword">))return </span><span class="default">$instr</span><span class="keyword">; </span><span class="comment">// no need for the rest if it's all valid UTF-8 already<br />
&nbsp; </span><span class="keyword">global </span><span class="default">$nibble_good_chars</span><span class="keyword">,</span><span class="default">$byte_map</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$outstr</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$char</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$rest</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">;<br />
&nbsp; while((</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$instr</span><span class="keyword">))&gt;</span><span class="default">0</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">1</span><span class="keyword">==</span><span class="default">preg_match</span><span class="keyword">(</span><span class="default">$nibble_good_chars</span><span class="keyword">,</span><span class="default">$input</span><span class="keyword">,</span><span class="default">$match</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$char</span><span class="keyword">=</span><span class="default">$match</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$rest</span><span class="keyword">=</span><span class="default">$match</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$outstr</span><span class="keyword">.=</span><span class="default">$char</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }elseif(</span><span class="default">1</span><span class="keyword">==</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'@^(.)(.*)$@s'</span><span class="keyword">,</span><span class="default">$input</span><span class="keyword">,</span><span class="default">$match</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$char</span><span class="keyword">=</span><span class="default">$match</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$rest</span><span class="keyword">=</span><span class="default">$match</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$outstr</span><span class="keyword">.=</span><span class="default">$byte_map</span><span class="keyword">[</span><span class="default">$char</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$instr</span><span class="keyword">=</span><span class="default">$rest</span><span class="keyword">;<br />
&nbsp; }<br />
&nbsp; return </span><span class="default">$outstr</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">$byte_map</span><span class="keyword">=array();<br />
</span><span class="default">init_byte_map</span><span class="keyword">();<br />
</span><span class="default">$ascii_char</span><span class="keyword">=</span><span class="string">'[\x00-\x7F]'</span><span class="keyword">;<br />
</span><span class="default">$cont_byte</span><span class="keyword">=</span><span class="string">'[\x80-\xBF]'</span><span class="keyword">;<br />
</span><span class="default">$utf8_2</span><span class="keyword">=</span><span class="string">'[\xC0-\xDF]'</span><span class="keyword">.</span><span class="default">$cont_byte</span><span class="keyword">;<br />
</span><span class="default">$utf8_3</span><span class="keyword">=</span><span class="string">'[\xE0-\xEF]'</span><span class="keyword">.</span><span class="default">$cont_byte</span><span class="keyword">.</span><span class="string">'{2}'</span><span class="keyword">;<br />
</span><span class="default">$utf8_4</span><span class="keyword">=</span><span class="string">'[\xF0-\xF7]'</span><span class="keyword">.</span><span class="default">$cont_byte</span><span class="keyword">.</span><span class="string">'{3}'</span><span class="keyword">;<br />
</span><span class="default">$utf8_5</span><span class="keyword">=</span><span class="string">'[\xF8-\xFB]'</span><span class="keyword">.</span><span class="default">$cont_byte</span><span class="keyword">.</span><span class="string">'{4}'</span><span class="keyword">;<br />
</span><span class="default">$nibble_good_chars </span><span class="keyword">= </span><span class="string">"@^(</span><span class="default">$ascii_char</span><span class="string">+|</span><span class="default">$utf8_2</span><span class="string">|</span><span class="default">$utf8_3</span><span class="string">|</span><span class="default">$utf8_4</span><span class="string">|</span><span class="default">$utf8_5</span><span class="string">)(.*)$@s"</span><span class="keyword">;<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Then just call fix_latin wherever you need it.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="89789""></a>
  <div class="note">
   <strong class="user">mrezair at azarbod dot com</strong>
   <a href="#89789" class="date">23-Mar-2009 07:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I found this little function very useful in fixing strings that are not in utf-8 but need be converted
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="comment">// Fixes the encoding to uf8
<br />
</span><span class="keyword">function </span><span class="default">fixEncoding</span><span class="keyword">(</span><span class="default">$in_str</span><span class="keyword">)
<br />
{ 
<br />
&nbsp; </span><span class="default">$cur_encoding </span><span class="keyword">= </span><span class="default">mb_detect_encoding</span><span class="keyword">(</span><span class="default">$in_str</span><span class="keyword">) ;
<br />
&nbsp; if(</span><span class="default">$cur_encoding </span><span class="keyword">== </span><span class="string">"UTF-8" </span><span class="keyword">&amp;&amp; </span><span class="default">mb_check_encoding</span><span class="keyword">(</span><span class="default">$in_str</span><span class="keyword">,</span><span class="string">"UTF-8"</span><span class="keyword">)) 
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$in_str</span><span class="keyword">; 
<br />
&nbsp; else 
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">utf8_encode</span><span class="keyword">(</span><span class="default">$in_str</span><span class="keyword">); 
<br />
} </span><span class="comment">// fixEncoding
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="89688""></a>
  <div class="note">
   <strong class="user">rogeriogirodo at gmail dot com</strong>
   <a href="#89688" class="date">19-Mar-2009 01:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This function may be useful do encode array keys and values [and checks first to see if it's already in UTF format]:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">public static function </span><span class="default">to_utf8</span><span class="keyword">(</span><span class="default">$in</span><span class="keyword">)
<br />
{
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$in</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$in </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$out</span><span class="keyword">[</span><span class="default">to_utf8</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">)] = </span><span class="default">to_utf8</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } elseif(</span><span class="default">is_string</span><span class="keyword">(</span><span class="default">$in</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">mb_detect_encoding</span><span class="keyword">(</span><span class="default">$in</span><span class="keyword">) != </span><span class="string">"UTF-8"</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">utf8_encode</span><span class="keyword">(</span><span class="default">$in</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$in</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$in</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$out</span><span class="keyword">;
<br />
}
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Hope this may help.
<br />

<br />
[NOTE BY danbrown AT php DOT net: Original function written by (cmyk777 AT gmail DOT com) on 28-JAN-09.]</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="88329""></a>
  <div class="note">
   <strong class="user">Julio Cesar</strong>
   <a href="#88329" class="date">20-Jan-2009 02:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
With This Script you can convert a lot of files in<br />
subfolders and convert to UTF8 without problems!<br />
<br />
I thought about that when I was converting an eclipse<br />
Project to UTF-8 and I loose all the Accentuation O.o<br />
<br />
But with this script YOU WILL NOT! ;-)<br />
<br />
I Make this based on Aidan Kehoe's Script and webmaster at<br />
asylum-et dot com of <a href="http://www.php.net/scandir:" rel="nofollow" target="_blank">http://www.php.net/scandir:</a><br />
<br />
<span class="default">&lt;?php<br />
ini_set</span><span class="keyword">(</span><span class="string">"implicit_flush"</span><span class="keyword">, </span><span class="string">"on"</span><span class="keyword">);<br />
</span><span class="default">ini_set</span><span class="keyword">(</span><span class="string">"max_execution_time"</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
</span><span class="default">ini_set</span><span class="keyword">(</span><span class="string">"register_argc_argv"</span><span class="keyword">, </span><span class="string">"on"</span><span class="keyword">);<br />
</span><span class="default">ini_set</span><span class="keyword">(</span><span class="string">"html_errors"</span><span class="keyword">, </span><span class="string">"Off"</span><span class="keyword">);<br />
<br />
function </span><span class="default">cp1252_to_utf8</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$cp1252_map </span><span class="keyword">= array (</span><span class="string">"\xc2\x80" </span><span class="keyword">=&gt; </span><span class="string">"\xe2\x82\xac"</span><span class="keyword">, <br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\xc2\x82" </span><span class="keyword">=&gt; </span><span class="string">"\xe2\x80\x9a"</span><span class="keyword">, <br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\xc2\x83" </span><span class="keyword">=&gt; </span><span class="string">"\xc6\x92"</span><span class="keyword">,&nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\xc2\x84" </span><span class="keyword">=&gt; </span><span class="string">"\xe2\x80\x9e"</span><span class="keyword">, <br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\xc2\x85" </span><span class="keyword">=&gt; </span><span class="string">"\xe2\x80\xa6"</span><span class="keyword">, <br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\xc2\x86" </span><span class="keyword">=&gt; </span><span class="string">"\xe2\x80\xa0"</span><span class="keyword">, <br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\xc2\x87" </span><span class="keyword">=&gt; </span><span class="string">"\xe2\x80\xa1"</span><span class="keyword">, <br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\xc2\x88" </span><span class="keyword">=&gt; </span><span class="string">"\xcb\x86"</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\xc2\x89" </span><span class="keyword">=&gt; </span><span class="string">"\xe2\x80\xb0"</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\xc2\x8a" </span><span class="keyword">=&gt; </span><span class="string">"\xc5\xa0"</span><span class="keyword">, <br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\xc2\x8b" </span><span class="keyword">=&gt; </span><span class="string">"\xe2\x80\xb9"</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\xc2\x8c" </span><span class="keyword">=&gt; </span><span class="string">"\xc5\x92"</span><span class="keyword">, <br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\xc2\x8e" </span><span class="keyword">=&gt; </span><span class="string">"\xc5\xbd"</span><span class="keyword">, <br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\xc2\x91" </span><span class="keyword">=&gt; </span><span class="string">"\xe2\x80\x98"</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\xc2\x92" </span><span class="keyword">=&gt; </span><span class="string">"\xe2\x80\x99"</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\xc2\x93" </span><span class="keyword">=&gt; </span><span class="string">"\xe2\x80\x9c"</span><span class="keyword">, <br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\xc2\x94" </span><span class="keyword">=&gt; </span><span class="string">"\xe2\x80\x9d"</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\xc2\x95" </span><span class="keyword">=&gt; </span><span class="string">"\xe2\x80\xa2"</span><span class="keyword">, <br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\xc2\x96" </span><span class="keyword">=&gt; </span><span class="string">"\xe2\x80\x93"</span><span class="keyword">, <br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\xc2\x97" </span><span class="keyword">=&gt; </span><span class="string">"\xe2\x80\x94"</span><span class="keyword">, <br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\xc2\x98" </span><span class="keyword">=&gt; </span><span class="string">"\xcb\x9c"</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\xc2\x99" </span><span class="keyword">=&gt; </span><span class="string">"\xe2\x84\xa2"</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\xc2\x9a" </span><span class="keyword">=&gt; </span><span class="string">"\xc5\xa1"</span><span class="keyword">, <br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\xc2\x9b" </span><span class="keyword">=&gt; </span><span class="string">"\xe2\x80\xba"</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\xc2\x9c" </span><span class="keyword">=&gt; </span><span class="string">"\xc5\x93"</span><span class="keyword">, <br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\xc2\x9e" </span><span class="keyword">=&gt; </span><span class="string">"\xc5\xbe"</span><span class="keyword">, <br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\xc2\x9f" </span><span class="keyword">=&gt; </span><span class="string">"\xc5\xb8"<br />
</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">strtr </span><span class="keyword">( </span><span class="default">utf8_encode </span><span class="keyword">( </span><span class="default">$str </span><span class="keyword">), </span><span class="default">$cp1252_map </span><span class="keyword">);<br />
}<br />
function </span><span class="default">rscandir</span><span class="keyword">(</span><span class="default">$base</span><span class="keyword">=</span><span class="string">""</span><span class="keyword">, &amp;</span><span class="default">$data</span><span class="keyword">=array()) {<br />
&nbsp;<br />
&nbsp; </span><span class="default">$array </span><span class="keyword">= </span><span class="default">array_diff</span><span class="keyword">(</span><span class="default">scandir</span><span class="keyword">(</span><span class="default">$base</span><span class="keyword">), array(</span><span class="string">"."</span><span class="keyword">, </span><span class="string">".."</span><span class="keyword">)); <br />
&nbsp; <br />
&nbsp; foreach(</span><span class="default">$array </span><span class="keyword">as </span><span class="default">$value</span><span class="keyword">) : <br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$base</span><span class="keyword">.</span><span class="default">$value</span><span class="keyword">)) : <br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="comment">//$data[] = $base.$value."/"; <br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">rscandir</span><span class="keyword">(</span><span class="default">$base</span><span class="keyword">.</span><span class="default">$value</span><span class="keyword">.</span><span class="string">"/"</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">); <br />
&nbsp;&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; elseif (</span><span class="default">is_file</span><span class="keyword">(</span><span class="default">$base</span><span class="keyword">.</span><span class="default">$value</span><span class="keyword">) &amp;&amp;<br />
!</span><span class="default">eregi</span><span class="keyword">(</span><span class="string">".jpg|.gif|.png|.ttf|.dataModel|.wsdlDataModel<br />
|.project|.jsdtscope|.prefs|.name|.container|<br />
.exe|.bat|.cmd|.src|.dll|.ini|.swf|.fla|.bmp\$"</span><span class="keyword">,<br />
</span><span class="default">$value</span><span class="keyword">)) : </span><span class="comment">/* where you put the unwanted extensions&nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">echo </span><span class="string">"Converting to UTF8 " </span><span class="keyword">. </span><span class="default">$base</span><span class="keyword">.</span><span class="default">$value </span><span class="keyword">. </span><span class="string">"\r\n"</span><span class="keyword">;&nbsp; <br />
&nbsp;&nbsp; <br />
</span><span class="default">file_put_contents</span><span class="keyword">(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$base</span><span class="keyword">.</span><span class="default">$value</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">cp1252_to_utf8</span><span class="keyword">(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="default">$base</span><span class="keyword">.</span><span class="default">$value</span><span class="keyword">)));<br />
<br />
&nbsp;&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; endif;<br />
&nbsp;&nbsp; <br />
&nbsp; endforeach;<br />
&nbsp;<br />
&nbsp; return </span><span class="default">$data</span><span class="keyword">;<br />
&nbsp;<br />
}<br />
echo </span><span class="string">"Type a Folder (With a Slash in end): "</span><span class="keyword">;<br />
</span><span class="default">$folder </span><span class="keyword">= </span><span class="default">trim</span><span class="keyword">(</span><span class="default">fgets</span><span class="keyword">(</span><span class="default">STDIN</span><span class="keyword">));<br />
<br />
</span><span class="default">rscandir</span><span class="keyword">(</span><span class="default">$folder</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
You can put this on windows Dir and put a Batch like this:<br />
<br />
@echo off<br />
php -n C:\windows\ConvertUTF8.php<br />
pause<br />
<br />
So you can convert your files from any where, just type on<br />
Execute Command Like: ConvertFilesToUTF8<br />
<br />
I think this will help everyone! Enjoy ;-)<br />
<br />
P.s: I remove the comments becouse the wordwrap</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85866""></a>
  <div class="note">
   <strong class="user">bitseeker</strong>
   <a href="#85866" class="date">22-Sep-2008 11:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
...or just use this simple piece of code to check valid utf-8 string:
<br />

<br />
<span class="default">&lt;?php
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**
<br />
&nbsp;&nbsp; &nbsp; * Returns true if $string is valid UTF-8 and false otherwise.
<br />
&nbsp;&nbsp; &nbsp; * 
<br />
&nbsp;&nbsp; &nbsp; * @since&nbsp; &nbsp; &nbsp; &nbsp; 1.14
<br />
&nbsp;&nbsp; &nbsp; * @param [mixed] $string&nbsp; &nbsp;&nbsp; string to be tested
<br />
&nbsp;&nbsp; &nbsp; * @subpackage
<br />
&nbsp;&nbsp; &nbsp; */
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">is_utf8</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// From <a href="http://w3.org/International/questions/qa-forms-utf-8.html" rel="nofollow" target="_blank">http://w3.org/International/questions/qa-forms-utf-8.html</a>
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'%^(?:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [\x09\x0A\x0D\x20-\x7E]&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # ASCII
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; | [\xC2-\xDF][\x80-\xBF]&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; # non-overlong 2-byte
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; |&nbsp; \xE0[\xA0-\xBF][\x80-\xBF]&nbsp; &nbsp; &nbsp; &nbsp; # excluding overlongs
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; | [\xE1-\xEC\xEE\xEF][\x80-\xBF]{2}&nbsp; # straight 3-byte
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; |&nbsp; \xED[\x80-\x9F][\x80-\xBF]&nbsp; &nbsp; &nbsp; &nbsp; # excluding surrogates
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; |&nbsp; \xF0[\x90-\xBF][\x80-\xBF]{2}&nbsp; &nbsp;&nbsp; # planes 1-3
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; | [\xF1-\xF3][\x80-\xBF]{3}&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # planes 4-15
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; |&nbsp; \xF4[\x80-\x8F][\x80-\xBF]{2}&nbsp; &nbsp;&nbsp; # plane 16
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )*$%xs'</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; 
<br />
&nbsp;&nbsp;&nbsp; }
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85293""></a>
  <div class="note">
   <strong class="user">hmdker at gmail dot com</strong>
   <a href="#85293" class="date">24-Aug-2008 06:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's my is_utf8 function, to detect valid UTF-8 text.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">is_utf8</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$c</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$b</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$bits</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$len</span><span class="keyword">=</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">$len</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++){
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$c</span><span class="keyword">=</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$c </span><span class="keyword">&gt;= </span><span class="default">128</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if((</span><span class="default">$c </span><span class="keyword">&gt;= </span><span class="default">254</span><span class="keyword">)) return </span><span class="default">false</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; elseif(</span><span class="default">$c </span><span class="keyword">&gt;= </span><span class="default">252</span><span class="keyword">) </span><span class="default">$bits</span><span class="keyword">=</span><span class="default">6</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; elseif(</span><span class="default">$c </span><span class="keyword">&gt;= </span><span class="default">248</span><span class="keyword">) </span><span class="default">$bits</span><span class="keyword">=</span><span class="default">5</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; elseif(</span><span class="default">$c </span><span class="keyword">&gt;= </span><span class="default">240</span><span class="keyword">) </span><span class="default">$bits</span><span class="keyword">=</span><span class="default">4</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; elseif(</span><span class="default">$c </span><span class="keyword">&gt;= </span><span class="default">224</span><span class="keyword">) </span><span class="default">$bits</span><span class="keyword">=</span><span class="default">3</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; elseif(</span><span class="default">$c </span><span class="keyword">&gt;= </span><span class="default">192</span><span class="keyword">) </span><span class="default">$bits</span><span class="keyword">=</span><span class="default">2</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else return </span><span class="default">false</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if((</span><span class="default">$i</span><span class="keyword">+</span><span class="default">$bits</span><span class="keyword">) &gt; </span><span class="default">$len</span><span class="keyword">) return </span><span class="default">false</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; while(</span><span class="default">$bits </span><span class="keyword">&gt; </span><span class="default">1</span><span class="keyword">){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$i</span><span class="keyword">++;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$b</span><span class="keyword">=</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$b </span><span class="keyword">&lt; </span><span class="default">128 </span><span class="keyword">|| </span><span class="default">$b </span><span class="keyword">&gt; </span><span class="default">191</span><span class="keyword">) return </span><span class="default">false</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bits</span><span class="keyword">--;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">true</span><span class="keyword">;
<br />
}
<br />

<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
[NOTE BY danbrown AT php DOT net: Contains a bugfix supplied by "svenmika" on 09-JUL-09 with the following note: "A value of exactly 128 (binary 10000000) in the first byte of a character is invalid."]</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84136""></a>
  <div class="note">
   <strong class="user">akam</strong>
   <a href="#84136" class="date">30-Jun-2008 04:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
</span><span class="comment">// Author akam at akameng dot com<br />
// Support 6 bit<br />
</span><span class="keyword">function </span><span class="default">UTF_to_Unicode</span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">, </span><span class="default">$array</span><span class="keyword">=</span><span class="default">False</span><span class="keyword">) {<br />
<br />
&nbsp;</span><span class="default">$bit1&nbsp; </span><span class="keyword">= </span><span class="default">pow</span><span class="keyword">(</span><span class="default">64</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
&nbsp;</span><span class="default">$bit2&nbsp; </span><span class="keyword">= </span><span class="default">pow</span><span class="keyword">(</span><span class="default">64</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;</span><span class="default">$bit3&nbsp; </span><span class="keyword">= </span><span class="default">pow</span><span class="keyword">(</span><span class="default">64</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">);<br />
&nbsp;</span><span class="default">$bit4&nbsp; </span><span class="keyword">= </span><span class="default">pow</span><span class="keyword">(</span><span class="default">64</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">);<br />
&nbsp;</span><span class="default">$bit5&nbsp; </span><span class="keyword">= </span><span class="default">pow</span><span class="keyword">(</span><span class="default">64</span><span class="keyword">, </span><span class="default">4</span><span class="keyword">);<br />
&nbsp;</span><span class="default">$bit6&nbsp; </span><span class="keyword">= </span><span class="default">pow</span><span class="keyword">(</span><span class="default">64</span><span class="keyword">, </span><span class="default">5</span><span class="keyword">);<br />
&nbsp;<br />
&nbsp;</span><span class="default">$value </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;</span><span class="default">$val&nbsp;&nbsp; </span><span class="keyword">= array();<br />
&nbsp;<br />
&nbsp;for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">&lt; </span><span class="default">strlen</span><span class="keyword">( </span><span class="default">$input </span><span class="keyword">); </span><span class="default">$i</span><span class="keyword">++){<br />
&nbsp;<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$ints </span><span class="keyword">= </span><span class="default">ord </span><span class="keyword">( </span><span class="default">$input</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] );<br />
&nbsp;&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$z&nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">ord </span><span class="keyword">( </span><span class="default">$input</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] );<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$y&nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">ord </span><span class="keyword">( </span><span class="default">$input</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">] ) - </span><span class="default">128</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$x&nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">ord </span><span class="keyword">( </span><span class="default">$input</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">+</span><span class="default">2</span><span class="keyword">] ) - </span><span class="default">128</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$w&nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">ord </span><span class="keyword">( </span><span class="default">$input</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">+</span><span class="default">3</span><span class="keyword">] ) - </span><span class="default">128</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$v&nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">ord </span><span class="keyword">( </span><span class="default">$input</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">+</span><span class="default">4</span><span class="keyword">] ) - </span><span class="default">128</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$u&nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">ord </span><span class="keyword">( </span><span class="default">$input</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">+</span><span class="default">5</span><span class="keyword">] ) - </span><span class="default">128</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; if( </span><span class="default">$ints </span><span class="keyword">&gt;= </span><span class="default">0 </span><span class="keyword">&amp;&amp; </span><span class="default">$ints </span><span class="keyword">&lt;= </span><span class="default">127 </span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// 1 bit<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$value </span><span class="keyword">.= </span><span class="string">'&amp;#'</span><span class="keyword">.(</span><span class="default">$z </span><span class="keyword">* </span><span class="default">$bit1</span><span class="keyword">).</span><span class="string">';'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$val</span><span class="keyword">[]&nbsp; = </span><span class="default">$value</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; if( </span><span class="default">$ints </span><span class="keyword">&gt;= </span><span class="default">192 </span><span class="keyword">&amp;&amp; </span><span class="default">$ints </span><span class="keyword">&lt;= </span><span class="default">223 </span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// 2 bit<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$value </span><span class="keyword">.= </span><span class="string">'&amp;#'</span><span class="keyword">.((</span><span class="default">$z</span><span class="keyword">-</span><span class="default">192</span><span class="keyword">) * </span><span class="default">$bit2 </span><span class="keyword">+ </span><span class="default">$y </span><span class="keyword">* </span><span class="default">$bit1</span><span class="keyword">).</span><span class="string">';'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$val</span><span class="keyword">[]&nbsp; = </span><span class="default">$value</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; }&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; if( </span><span class="default">$ints </span><span class="keyword">&gt;= </span><span class="default">224 </span><span class="keyword">&amp;&amp; </span><span class="default">$ints </span><span class="keyword">&lt;= </span><span class="default">239 </span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// 3 bit<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$value </span><span class="keyword">.= </span><span class="string">'&amp;#'</span><span class="keyword">.((</span><span class="default">$z</span><span class="keyword">-</span><span class="default">224</span><span class="keyword">) * </span><span class="default">$bit3 </span><span class="keyword">+ </span><span class="default">$y </span><span class="keyword">* </span><span class="default">$bit2 </span><span class="keyword">+ </span><span class="default">$x </span><span class="keyword">* </span><span class="default">$bit1</span><span class="keyword">).</span><span class="string">';'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$val</span><span class="keyword">[]&nbsp; = </span><span class="default">$value</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; }&nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; if( </span><span class="default">$ints </span><span class="keyword">&gt;= </span><span class="default">240 </span><span class="keyword">&amp;&amp; </span><span class="default">$ints </span><span class="keyword">&lt;= </span><span class="default">247 </span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// 4 bit<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$value </span><span class="keyword">.= </span><span class="string">'&amp;#'</span><span class="keyword">.((</span><span class="default">$z</span><span class="keyword">-</span><span class="default">240</span><span class="keyword">) * </span><span class="default">$bit4 </span><span class="keyword">+ </span><span class="default">$y </span><span class="keyword">* </span><span class="default">$bit3 </span><span class="keyword">+ <br />
</span><span class="default">$x </span><span class="keyword">* </span><span class="default">$bit2 </span><span class="keyword">+ </span><span class="default">$w </span><span class="keyword">* </span><span class="default">$bit1</span><span class="keyword">).</span><span class="string">';'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$val</span><span class="keyword">[]&nbsp; = </span><span class="default">$value</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; }&nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; if( </span><span class="default">$ints </span><span class="keyword">&gt;= </span><span class="default">248 </span><span class="keyword">&amp;&amp; </span><span class="default">$ints </span><span class="keyword">&lt;= </span><span class="default">251 </span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// 5 bit<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$value </span><span class="keyword">.= </span><span class="string">'&amp;#'</span><span class="keyword">.((</span><span class="default">$z</span><span class="keyword">-</span><span class="default">248</span><span class="keyword">) * </span><span class="default">$bit5 </span><span class="keyword">+ </span><span class="default">$y </span><span class="keyword">* </span><span class="default">$bit4 <br />
</span><span class="keyword">+ </span><span class="default">$x </span><span class="keyword">* </span><span class="default">$bit3 </span><span class="keyword">+ </span><span class="default">$w </span><span class="keyword">* </span><span class="default">$bit2 </span><span class="keyword">+ </span><span class="default">$v </span><span class="keyword">* </span><span class="default">$bit1</span><span class="keyword">).</span><span class="string">';'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$val</span><span class="keyword">[]&nbsp; = </span><span class="default">$value</span><span class="keyword">;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; if( </span><span class="default">$ints </span><span class="keyword">== </span><span class="default">252 </span><span class="keyword">&amp;&amp; </span><span class="default">$ints </span><span class="keyword">== </span><span class="default">253 </span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// 6 bit<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$value </span><span class="keyword">.= </span><span class="string">'&amp;#'</span><span class="keyword">.((</span><span class="default">$z</span><span class="keyword">-</span><span class="default">252</span><span class="keyword">) * </span><span class="default">$bit6 </span><span class="keyword">+ </span><span class="default">$y </span><span class="keyword">* </span><span class="default">$bit5 <br />
</span><span class="keyword">+ </span><span class="default">$x </span><span class="keyword">* </span><span class="default">$bit4 </span><span class="keyword">+ </span><span class="default">$w </span><span class="keyword">* </span><span class="default">$bit3 </span><span class="keyword">+ </span><span class="default">$v </span><span class="keyword">* </span><span class="default">$bit2 </span><span class="keyword">+ </span><span class="default">$u </span><span class="keyword">* </span><span class="default">$bit1</span><span class="keyword">).</span><span class="string">';'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$val</span><span class="keyword">[]&nbsp; = </span><span class="default">$value</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; if( </span><span class="default">$ints </span><span class="keyword">== </span><span class="default">254 </span><span class="keyword">|| </span><span class="default">$ints </span><span class="keyword">== </span><span class="default">255 </span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; echo </span><span class="string">'Wrong Result!&lt;br&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; <br />
&nbsp;}<br />
&nbsp;<br />
&nbsp;if( </span><span class="default">$array </span><span class="keyword">=== </span><span class="default">False </span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$unicode </span><span class="keyword">= </span><span class="default">$value</span><span class="keyword">;<br />
&nbsp;}<br />
&nbsp;if(</span><span class="default">$array </span><span class="keyword">=== </span><span class="default">True </span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$val&nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'&amp;#'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$val&nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">';'</span><span class="keyword">, </span><span class="default">$val</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$len </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; unset(</span><span class="default">$val</span><span class="keyword">[</span><span class="default">$len</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; return </span><span class="default">$unicode </span><span class="keyword">= </span><span class="default">$val</span><span class="keyword">;<br />
&nbsp;}<br />
&nbsp;<br />
}<br />
<br />
&nbsp;<br />
function </span><span class="default">Unicode_to_UTF</span><span class="keyword">( </span><span class="default">$input</span><span class="keyword">, </span><span class="default">$array</span><span class="keyword">=</span><span class="default">TRUE</span><span class="keyword">){<br />
<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$utf </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if(!</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$input&nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'&amp;#'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$input</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$input&nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">';'</span><span class="keyword">, </span><span class="default">$input</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$len </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; unset(</span><span class="default">$input</span><span class="keyword">[</span><span class="default">$len</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">count</span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">); </span><span class="default">$i</span><span class="keyword">++){<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; if ( </span><span class="default">$input</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] &lt;</span><span class="default">128 </span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$byte1 </span><span class="keyword">= </span><span class="default">$input</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$utf&nbsp; </span><span class="keyword">.= </span><span class="default">chr</span><span class="keyword">(</span><span class="default">$byte1</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if ( </span><span class="default">$input</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] &gt;=</span><span class="default">128 </span><span class="keyword">&amp;&amp; </span><span class="default">$input</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] &lt;=</span><span class="default">2047 </span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$byte1 </span><span class="keyword">= </span><span class="default">192 </span><span class="keyword">+ (int)(</span><span class="default">$input</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] / </span><span class="default">64</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$byte2 </span><span class="keyword">= </span><span class="default">128 </span><span class="keyword">+ (</span><span class="default">$input</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] % </span><span class="default">64</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$utf&nbsp; </span><span class="keyword">.= </span><span class="default">chr</span><span class="keyword">(</span><span class="default">$byte1</span><span class="keyword">).</span><span class="default">chr</span><span class="keyword">(</span><span class="default">$byte2</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if ( </span><span class="default">$input</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] &gt;=</span><span class="default">2048 </span><span class="keyword">&amp;&amp; </span><span class="default">$input</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] &lt;=</span><span class="default">65535</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$byte1 </span><span class="keyword">= </span><span class="default">224 </span><span class="keyword">+ (int)(</span><span class="default">$input</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] / </span><span class="default">4096</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$byte2 </span><span class="keyword">= </span><span class="default">128 </span><span class="keyword">+ ((int)(</span><span class="default">$input</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] / </span><span class="default">64</span><span class="keyword">) % </span><span class="default">64</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$byte3 </span><span class="keyword">= </span><span class="default">128 </span><span class="keyword">+ (</span><span class="default">$input</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] % </span><span class="default">64</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$utf&nbsp; </span><span class="keyword">.= </span><span class="default">chr</span><span class="keyword">(</span><span class="default">$byte1</span><span class="keyword">).</span><span class="default">chr</span><span class="keyword">(</span><span class="default">$byte2</span><span class="keyword">).</span><span class="default">chr</span><span class="keyword">(</span><span class="default">$byte3</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if ( </span><span class="default">$input</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] &gt;=</span><span class="default">65536 </span><span class="keyword">&amp;&amp; </span><span class="default">$input</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] &lt;=</span><span class="default">2097151</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$byte1 </span><span class="keyword">= </span><span class="default">240 </span><span class="keyword">+ (int)(</span><span class="default">$input</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] / </span><span class="default">262144</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$byte2 </span><span class="keyword">= </span><span class="default">128 </span><span class="keyword">+ ((int)(</span><span class="default">$input</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] / </span><span class="default">4096</span><span class="keyword">) % </span><span class="default">64</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$byte3 </span><span class="keyword">= </span><span class="default">128 </span><span class="keyword">+ ((int)(</span><span class="default">$input</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] / </span><span class="default">64</span><span class="keyword">) % </span><span class="default">64</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$byte4 </span><span class="keyword">= </span><span class="default">128 </span><span class="keyword">+ (</span><span class="default">$input</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] % </span><span class="default">64</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$utf&nbsp; </span><span class="keyword">.= </span><span class="default">chr</span><span class="keyword">(</span><span class="default">$byte1</span><span class="keyword">).</span><span class="default">chr</span><span class="keyword">(</span><span class="default">$byte2</span><span class="keyword">).</span><span class="default">chr</span><span class="keyword">(</span><span class="default">$byte3</span><span class="keyword">).<br />
</span><span class="default">chr</span><span class="keyword">(</span><span class="default">$byte4</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if ( </span><span class="default">$input</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] &gt;=</span><span class="default">2097152 </span><span class="keyword">&amp;&amp; </span><span class="default">$input</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] &lt;=</span><span class="default">67108863</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$byte1 </span><span class="keyword">= </span><span class="default">248 </span><span class="keyword">+ (int)(</span><span class="default">$input</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] / </span><span class="default">16777216</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$byte2 </span><span class="keyword">= </span><span class="default">128 </span><span class="keyword">+ ((int)(</span><span class="default">$input</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] / </span><span class="default">262144</span><span class="keyword">) % </span><span class="default">64</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$byte3 </span><span class="keyword">= </span><span class="default">128 </span><span class="keyword">+ ((int)(</span><span class="default">$input</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] / </span><span class="default">4096</span><span class="keyword">) % </span><span class="default">64</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$byte4 </span><span class="keyword">= </span><span class="default">128 </span><span class="keyword">+ ((int)(</span><span class="default">$input</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] / </span><span class="default">64</span><span class="keyword">) % </span><span class="default">64</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$byte5 </span><span class="keyword">= </span><span class="default">128 </span><span class="keyword">+ (</span><span class="default">$input</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] % </span><span class="default">64</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$utf&nbsp; </span><span class="keyword">.= </span><span class="default">chr</span><span class="keyword">(</span><span class="default">$byte1</span><span class="keyword">).</span><span class="default">chr</span><span class="keyword">(</span><span class="default">$byte2</span><span class="keyword">).</span><span class="default">chr</span><span class="keyword">(</span><span class="default">$byte3</span><span class="keyword">).<br />
</span><span class="default">chr</span><span class="keyword">(</span><span class="default">$byte4</span><span class="keyword">).</span><span class="default">chr</span><span class="keyword">(</span><span class="default">$byte5</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if ( </span><span class="default">$input</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] &gt;=</span><span class="default">67108864 </span><span class="keyword">&amp;&amp; </span><span class="default">$input</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] &lt;=</span><span class="default">2147483647</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$byte1 </span><span class="keyword">= </span><span class="default">252 </span><span class="keyword">+ (</span><span class="default">$input</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] / </span><span class="default">1073741824</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$byte2 </span><span class="keyword">= </span><span class="default">128 </span><span class="keyword">+ ((</span><span class="default">$input</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] / </span><span class="default">16777216</span><span class="keyword">) % </span><span class="default">64</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$byte3 </span><span class="keyword">= </span><span class="default">128 </span><span class="keyword">+ ((</span><span class="default">$input</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] / </span><span class="default">262144</span><span class="keyword">) % </span><span class="default">64</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$byte4 </span><span class="keyword">= </span><span class="default">128 </span><span class="keyword">+ ((</span><span class="default">$input</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] / </span><span class="default">4096</span><span class="keyword">) % </span><span class="default">64</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$byte5 </span><span class="keyword">= </span><span class="default">128 </span><span class="keyword">+ ((</span><span class="default">$input</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] / </span><span class="default">64</span><span class="keyword">) % </span><span class="default">64</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$byte6 </span><span class="keyword">= </span><span class="default">128 </span><span class="keyword">+ (</span><span class="default">$input</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] % </span><span class="default">64</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$utf&nbsp; </span><span class="keyword">.= </span><span class="default">chr</span><span class="keyword">(</span><span class="default">$byte1</span><span class="keyword">).</span><span class="default">chr</span><span class="keyword">(</span><span class="default">$byte2</span><span class="keyword">).</span><span class="default">chr</span><span class="keyword">(</span><span class="default">$byte3</span><span class="keyword">).<br />
</span><span class="default">chr</span><span class="keyword">(</span><span class="default">$byte4</span><span class="keyword">).</span><span class="default">chr</span><span class="keyword">(</span><span class="default">$byte5</span><span class="keyword">).</span><span class="default">chr</span><span class="keyword">(</span><span class="default">$byte6</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp; }<br />
&nbsp;&nbsp; return </span><span class="default">$utf</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83777""></a>
  <div class="note">
   <strong class="user">www.tricinty.com</strong>
   <a href="#83777" class="date">11-Jun-2008 12:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/** <br />
&nbsp;&nbsp;&nbsp; * Encodes an ISO-8859-1 mixed variable to UTF-8 (PHP 4, PHP 5 compat)<br />
&nbsp;&nbsp;&nbsp; * @param&nbsp; &nbsp; mixed&nbsp; &nbsp; $input An array, associative or simple<br />
&nbsp;&nbsp;&nbsp; * @param&nbsp; &nbsp; boolean&nbsp; $encode_keys optional<br />
&nbsp;&nbsp;&nbsp; * @return&nbsp; &nbsp; mixed&nbsp; &nbsp;&nbsp; ( utf-8 encoded $input)<br />
&nbsp;&nbsp;&nbsp; */<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">utf8_encode_mix</span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">, </span><span class="default">$encode_keys</span><span class="keyword">=</span><span class="default">false</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$input </span><span class="keyword">as </span><span class="default">$k </span><span class="keyword">=&gt; </span><span class="default">$v</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$key </span><span class="keyword">= (</span><span class="default">$encode_keys</span><span class="keyword">)? </span><span class="default">utf8_encode</span><span class="keyword">(</span><span class="default">$k</span><span class="keyword">) : </span><span class="default">$k</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">] = </span><span class="default">utf8_encode_mix</span><span class="keyword">( </span><span class="default">$v</span><span class="keyword">, </span><span class="default">$encode_keys</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="default">utf8_encode</span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$result</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83606""></a>
  <div class="note">
   <strong class="user">klein at buchung-24 dot de</strong>
   <a href="#83606" class="date">04-Jun-2008 01:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
IF you don′t use the function from ethan dot nelson at ltd dot org in a class, you′ll get an error, so please try<br />
<br />
function utf_prepare(&amp;$array) <br />
{<br />
&nbsp;&nbsp;&nbsp; foreach($array AS $key =&gt; &amp;$value) <br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (is_array($value)) <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; utf_prepare($value);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $value = utf8_encode($value);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82589""></a>
  <div class="note">
   <strong class="user">www.qaiser.net</strong>
   <a href="#82589" class="date">17-Apr-2008 04:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
that isUTF8 function is a killer...<br />
<br />
wouldn't something like<br />
<br />
if ( preg_match( "~(\x00[\x80-\xff]|[\x00-\x07][\x00-\xff]~", $string ) ) { /* is utf */ };<br />
<br />
be a lot more efficient? it doesn't take into account all the ranges, but it has to be a better method and a simple start since it'll quit on the first successful match. think of encoding and decoding a 1mb string--not good. i'm having to work with +20 meg xml files.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82210""></a>
  <div class="note">
   <strong class="user">renardo13 at free dot fr</strong>
   <a href="#82210" class="date">01-Apr-2008 01:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
another nice way to implement an isUTF8 function ...<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">isUTF8</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; return (</span><span class="default">utf8_encode</span><span class="keyword">(</span><span class="default">utf8_decode</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">)) == </span><span class="default">$string</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="79005""></a>
  <div class="note">
   <strong class="user">ethan dot nelson at ltd dot org</strong>
   <a href="#79005" class="date">07-Nov-2007 02:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This does the same thing as some of the posts below (minus the keys), but I thought I'd share anyway cause it is slightly more elegant.&nbsp; Also, its a good example using references such that this could be used as a callback function.<br />
<br />
&nbsp; function utf_prepare(&amp;$array) {<br />
<br />
&nbsp;&nbsp;&nbsp; foreach($array AS $key =&gt; &amp;$value) {<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (is_array($value)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;utf_prepare($value);<br />
&nbsp;&nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $value = utf8_encode($value);<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp; }</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75942""></a>
  <div class="note">
   <strong class="user">luka8088 at gmail dot com</strong>
   <a href="#75942" class="date">22-Jun-2007 04:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
simple HTML to UTF-8 conversion:<br />
<br />
function html_to_utf8 ($data)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; return preg_replace("/\\&amp;\\#([0-9]{3,10})\\;/e", '_html_to_utf8("\\1")', $data);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
function _html_to_utf8 ($data)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; if ($data &gt; 127)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $i = 5;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while (($i--) &gt; 0)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($data != ($a = $data % ($p = pow(64, $i))))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $ret = chr(base_convert(str_pad(str_repeat(1, $i + 1), 8, "0"), 2, 10) + (($data - $a) / $p));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for ($i; $i &gt; 0; $i--)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $ret .= chr(128 + ((($data % pow(64, $i)) - ($data % ($p = pow(64, $i - 1)))) / $p));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $ret = "&amp;#$data;";<br />
&nbsp;&nbsp;&nbsp; return $ret;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
Example:<br />
echo html_to_utf8("a b &amp;#269; &amp;#263; &amp;#382; &amp;#12371; &amp;#12395; &amp;#12385; &amp;#12431; ()[]{}!#$?* &amp;lt; &amp;#62;");<br />
<br />
Output:<br />
a b ? ? ? こ に ち わ ()[]{}!#$?* &amp;lt; &amp;#62;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75435""></a>
  <div class="note">
   <strong class="user">hillar dot petersen at gmail dot com</strong>
   <a href="#75435" class="date">30-May-2007 07:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In addition to my previous post. If your values are already in utf-8 maybe you want to utf8_encode array keys only. This will do it:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/**<br />
&nbsp;* (Recursively) utf8_encode all array keys.<br />
&nbsp;*<br />
&nbsp;* @param array $array<br />
&nbsp;* @return array with utf8_encoded keys<br />
&nbsp;*/<br />
<br />
</span><span class="keyword">function </span><span class="default">utf8_encode_array_keys</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">)<br />
{<br />
&nbsp; </span><span class="default">$array_type </span><span class="keyword">= </span><span class="default">array_type</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">);<br />
<br />
&nbsp; if (</span><span class="default">$array_type </span><span class="keyword">== </span><span class="string">"map"</span><span class="keyword">)<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$result_array </span><span class="keyword">= array();<br />
<br />
&nbsp;&nbsp;&nbsp; foreach(</span><span class="default">$array </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// recursion<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result_array</span><span class="keyword">[</span><span class="default">utf8_encode</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">)] = </span><span class="default">utf8_encode_array_keys</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// value is not an array, no recursion<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result_array</span><span class="keyword">[</span><span class="default">utf8_encode</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">)] = </span><span class="default">$value</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$result_array</span><span class="keyword">;<br />
&nbsp; }<br />
<br />
&nbsp; else if (</span><span class="default">$array_type </span><span class="keyword">== </span><span class="string">"vector"</span><span class="keyword">)<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// do not encode anything, just follow the value if it is an array<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$result_array </span><span class="keyword">= array();<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$array </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// recursion<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result_array</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">] = </span><span class="default">utf8_encode_array_keys</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// value is not an array, no recursion<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result_array</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">] = </span><span class="default">$value</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$result_array</span><span class="keyword">;<br />
&nbsp; }<br />
<br />
&nbsp; return </span><span class="default">false</span><span class="keyword">;&nbsp; &nbsp;&nbsp; </span><span class="comment">// argument is not an array, return false<br />
</span><span class="keyword">}<br />
</span><span class="default">?&gt;<br />
</span><br />
Also note that both this operation (with keys only) and the operation with both keys and values can be reversed by replacing "encode" by "decode".</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75422""></a>
  <div class="note">
   <strong class="user">hillar dot petersen at gmail dot com</strong>
   <a href="#75422" class="date">29-May-2007 04:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are interested in recursively converting ISO-8859-1-encoded arrays into UTF-8, then this is one way to do it. Could use a small refactor though. (I used it to prepare some ISO-8859-1 arrays for json_encode. Note that for this to work your values and for associative arrays also your keys must be ISO-8859-1-encoded.)<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/**<br />
&nbsp;* (Recursively) utf8_encode each value in an array.<br />
&nbsp;*<br />
&nbsp;* @param array $array<br />
&nbsp;* @return array utf8_encoded<br />
&nbsp;*/<br />
<br />
</span><span class="keyword">function </span><span class="default">utf8_encode_array</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">)<br />
{<br />
&nbsp; if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">))<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$result_array </span><span class="keyword">= array();<br />
<br />
&nbsp;&nbsp;&nbsp; foreach(</span><span class="default">$array </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (</span><span class="default">array_type</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">) == </span><span class="string">"map"</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// encode both key and value<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// recursion<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result_array</span><span class="keyword">[</span><span class="default">utf8_encode</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">)] = </span><span class="default">utf8_encode_array</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// no recursion<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">is_string</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result_array</span><span class="keyword">[</span><span class="default">utf8_encode</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">)] = </span><span class="default">utf8_encode</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// do not re-encode non-strings, just copy data<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result_array</span><span class="keyword">[</span><span class="default">utf8_encode</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">)] = </span><span class="default">$value</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; else if (</span><span class="default">array_type</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">) == </span><span class="string">"vector"</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// encode value only<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// recursion<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result_array</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">] = </span><span class="default">utf8_encode_array</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// no recursion<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">is_string</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result_array</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">] = </span><span class="default">utf8_encode</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// do not re-encode non-strings, just copy data<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result_array</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">] = </span><span class="default">$value</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$result_array</span><span class="keyword">;<br />
&nbsp; }<br />
<br />
&nbsp; return </span><span class="default">false</span><span class="keyword">;&nbsp; &nbsp;&nbsp; </span><span class="comment">// argument is not an array, return false<br />
</span><span class="keyword">}<br />
<br />
</span><span class="comment">/**<br />
&nbsp;* Determines array type ("vector" or "map"). Returns false if not an array at all.<br />
&nbsp;* (I hope a native function will be introduced in some future release of PHP, because<br />
&nbsp;* this check is inefficient and quite costly in worst case scenario.)<br />
&nbsp;*<br />
&nbsp;* @param array $array The array to analyze<br />
&nbsp;* @return string array type ("vector" or "map") or false if not an array<br />
&nbsp;*/<br />
<br />
</span><span class="keyword">function </span><span class="default">array_type</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">)<br />
{<br />
&nbsp; if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">))<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$next </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$return_value </span><span class="keyword">= </span><span class="string">"vector"</span><span class="keyword">;&nbsp; </span><span class="comment">// we have a vector until proved otherwise<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">foreach (</span><span class="default">$array </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (</span><span class="default">$key </span><span class="keyword">!= </span><span class="default">$next</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$return_value </span><span class="keyword">= </span><span class="string">"map"</span><span class="keyword">;&nbsp; </span><span class="comment">// we have a map<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">break;<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$next</span><span class="keyword">++;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$return_value</span><span class="keyword">;<br />
&nbsp; }<br />
<br />
&nbsp; return </span><span class="default">false</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">// not array<br />
</span><span class="keyword">}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74905""></a>
  <div class="note">
   <strong class="user">nikooo adog bk adot ru - Nickolaz</strong>
   <a href="#74905" class="date">03-May-2007 04:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You can use this simple code to convert win-1251 into Unicode.<br />
<br />
&nbsp;&nbsp;&nbsp; function rus2uni($str,$isTo = true)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $arr = array('ё'=&gt;'&amp;#x451;','Ё'=&gt;'&amp;#x401;');<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for($i=192;$i&lt;256;$i++)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $arr[chr($i)] = '&amp;#x4'.dechex($i-176).';';<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $str =preg_replace(array('@([а-я]) @i','@ ([а-я])@i'),array('$1&amp;#x0a0;','&amp;#x0a0;$1'),$str);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return strtr($str,$isTo?$arr:array_flip($arr));<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
That is useful for xml_parser (to parse windows-1251 files like utf-8).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74584""></a>
  <div class="note">
   
   <a href="#74584" class="date">18-Apr-2007 06:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I just read what I wrote, sorry for the typos it was a long day:<br />
<br />
here's the rewritten code:<br />
<br />
xml_tpl.php<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; header</span><span class="keyword">(</span><span class="string">"Content-Type: text/html;charset=ISO-8859-1"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; print </span><span class="string">"&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$names</span><span class="keyword">=array(</span><span class="string">'jack'</span><span class="keyword">,</span><span class="string">'bob'</span><span class="keyword">,</span><span class="string">'vanessa'</span><span class="keyword">,</span><span class="string">'catherine'</span><span class="keyword">,</span><span class="string">'valerie'</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span>&lt;parent&gt;<br />
<span class="default">&lt;?php </span><span class="keyword">foreach(</span><span class="default">$names </span><span class="keyword">as </span><span class="default">$name</span><span class="keyword">) {</span><span class="default">?&gt;<br />
</span>&nbsp; &nbsp; &lt;child name="<span class="default">&lt;?php </span><span class="keyword">print </span><span class="default">$name?&gt;</span>" /&gt;<br />
<span class="default">&lt;?php </span><span class="keyword">} </span><span class="default">?&gt;<br />
</span>&lt;/parent&gt;<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">create_xml</span><span class="keyword">(){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">ob_start</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; include </span><span class="string">"xml_tpl.php"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$trapped_content</span><span class="keyword">=</span><span class="default">ob_get_contents</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">ob_end_clean</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$file_path</span><span class="keyword">= </span><span class="string">"./somefile.xml"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$file_handle</span><span class="keyword">=</span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$file_path</span><span class="keyword">,</span><span class="string">'w'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$file_handle</span><span class="keyword">,</span><span class="default">utf8_encode</span><span class="keyword">(</span><span class="default">$trapped_content</span><span class="keyword">));<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74564""></a>
  <div class="note">
   <strong class="user">penda ekoka</strong>
   <a href="#74564" class="date">17-Apr-2007 08:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
creating utf-8 xml files:<br />
this is something that has wasted a lot of my time, I hope this will spare you the headaches:<br />
<br />
my method consists of creating an xml template that will look like this (this is probably optional, I'm sure you can use good ol' print or echo statements):<br />
<br />
xml_tpl.php<br />
<span class="default">&lt;?php<br />
header</span><span class="keyword">(</span><span class="string">"Content-Type: text/html;charset=ISO-8859-1"</span><span class="keyword">);<br />
print </span><span class="string">"&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;\n"</span><span class="keyword">;<br />
</span><span class="default">$names</span><span class="keyword">=array(</span><span class="string">'jack'</span><span class="keyword">,</span><span class="string">'bob'</span><span class="keyword">,</span><span class="string">'vanessa'</span><span class="keyword">,</span><span class="string">'catherine'</span><span class="keyword">,</span><span class="string">'valerie'</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span>&lt;parent&gt;<br />
<span class="default">&lt;?php </span><span class="keyword">foreach(</span><span class="default">$names </span><span class="keyword">as </span><span class="default">$name</span><span class="keyword">) {</span><span class="default">?&gt;<br />
</span>&nbsp; &nbsp; &lt;child name="<span class="default">&lt;?php </span><span class="keyword">print </span><span class="default">$name?&gt;</span>" /&gt;<br />
<span class="default">&lt;?php </span><span class="keyword">} </span><span class="default">?&gt;<br />
</span>&lt;/parent&gt;<br />
?&gt;<br />
<br />
from a function or a method I include the previous template and trap the outputted content in an output buffer. The buffured content is then inserted into a file:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">create_xml</span><span class="keyword">(){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">ob_start</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; include </span><span class="string">"xml_php.php"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$trapped_content</span><span class="keyword">=</span><span class="default">ob_get_contents</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">ob_end_clean</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$file_path</span><span class="keyword">= </span><span class="string">"./somefile.xml"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$file_handle</span><span class="keyword">=</span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$somefile</span><span class="keyword">,</span><span class="string">'w'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$file_handle</span><span class="keyword">,</span><span class="default">utf8_encode</span><span class="keyword">(</span><span class="default">$trapped_content</span><span class="keyword">));<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Some side notes:<br />
- note that the utf8_encode function goes inside the fwrite() function.<br />
- when troubleshooting, make sure to transfer text file (xml included) and scripts in ascii mode when using ftp. For some unknown reason my ftp client did not have xml set as an ascii transfer candidate and was automatically tranfering them in binary. That little "feature" ended up costing me hours of frustration, as the encoding information would just "vanish" between transfer and I kept scratching my head as to why manually created utf8 files were not behaving as they should.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71814""></a>
  <div class="note">
   <strong class="user">emze at donazga dot net</strong>
   <a href="#71814" class="date">17-Dec-2006 06:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
/*<br />
Every function seen so far is incomplete or resource consumpting. Here are two -- integer 2 utf sequence (i3u) and utf sequence to integer (u3i). Below is a code snippet that checks well behavior at the range boundaries.<br />
<br />
Someday they might be hardcoded into PHP...<br />
*/<br />
<br />
function i3u($i) { // returns UCS-16 or UCS-32 to UTF-8 from an integer<br />
&nbsp; $i=(int)$i; // integer?<br />
&nbsp; if ($i&lt;0) return false; // positive?<br />
&nbsp; if ($i&lt;=0x7f) return chr($i); // range 0<br />
&nbsp; if (($i &amp; 0x7fffffff) &lt;&gt; $i) return '?'; // 31 bit?<br />
&nbsp; if ($i&lt;=0x7ff) return chr(0xc0 | ($i &gt;&gt; 6)) . chr(0x80 | ($i &amp; 0x3f));<br />
&nbsp; if ($i&lt;=0xffff) return chr(0xe0 | ($i &gt;&gt; 12)) . chr(0x80 | ($i &gt;&gt; 6) &amp; 0x3f)<br />
&nbsp;&nbsp; &nbsp;&nbsp; . chr(0x80&nbsp; | $i &amp; 0x3f);<br />
&nbsp; if ($i&lt;=0x1fffff) return chr(0xf0 | ($i &gt;&gt; 18)) . chr(0x80 | ($i &gt;&gt; 12) &amp; 0x3f)<br />
&nbsp;&nbsp; &nbsp;&nbsp; . chr(0x80 | ($i &gt;&gt; 6) &amp; 0x3f) . chr(0x80&nbsp; | $i &amp; 0x3f);<br />
&nbsp; if ($i&lt;=0x3ffffff) return chr(0xf8 | ($i &gt;&gt; 24)) . chr(0x80 | ($i &gt;&gt; 18) &amp; 0x3f)<br />
&nbsp;&nbsp; &nbsp;&nbsp; . chr(0x80 | ($i &gt;&gt; 12) &amp; 0x3f) . chr(0x80 | ($i &gt;&gt; 6) &amp; 0x3f) . chr(0x80&nbsp; | $i &amp; 0x3f);<br />
&nbsp; return chr(0xfc | ($i &gt;&gt; 30)) . chr(0x80 | ($i &gt;&gt; 24) &amp; 0x3f) . chr(0x80 | ($i &gt;&gt; 18) &amp; 0x3f)<br />
&nbsp;&nbsp; &nbsp;&nbsp; . chr(0x80 | ($i &gt;&gt; 12) &amp; 0x3f) . chr(0x80 | ($i &gt;&gt; 6) &amp; 0x3f) . chr(0x80&nbsp; | $i &amp; 0x3f);<br />
}<br />
<br />
function u3i($s,$strict=1) { // returns integer on valid UTF-8 seq, NULL on empty, else FALSE<br />
&nbsp; // NOT strict: takes only DATA bits, present or not; strict: length and bits checking<br />
&nbsp; if ($s=='') return NULL;<br />
&nbsp; $l=strlen($s); $o=ord($s{0});<br />
&nbsp; if ($o &lt;= 0x7f &amp;&amp; $l==1) return $o;<br />
&nbsp; if ($l&gt;6 &amp;&amp; $strict) return false;<br />
&nbsp; if ($strict) for ($i=1;$i&lt;$l;$i++) if (ord($s{$i}) &gt; 0xbf || ord($s{$i})&lt; 0x80) return false;<br />
&nbsp; if ($o &lt; 0xc2) return false; // no-go even if strict=0<br />
&nbsp; if ($o &lt;= 0xdf &amp;&amp; ($l=2 &amp;&amp; $strict)) return (($o &amp; 0x1f) &lt;&lt; 6 | (ord($s{1}) &amp; 0x3f));<br />
&nbsp; if ($o &lt;= 0xef &amp;&amp; ($l=3 &amp;&amp; $strict)) return (($o &amp; 0x0f) &lt;&lt; 12 | (ord($s{1}) &amp; 0x3f) &lt;&lt; 6<br />
&nbsp;&nbsp; &nbsp; |&nbsp; (ord($s{2}) &amp; 0x3f));<br />
&nbsp; if ($o &lt;= 0xf7 &amp;&amp; ($l=4 &amp;&amp; $strict)) return (($o &amp; 0x07) &lt;&lt; 18 | (ord($s{1}) &amp; 0x3f) &lt;&lt; 12<br />
&nbsp;&nbsp; &nbsp; | (ord($s{2}) &amp; 0x3f) &lt;&lt; 6 |&nbsp; (ord($s{3}) &amp; 0x3f));<br />
&nbsp; if ($o &lt;= 0xfb &amp;&amp; ($l=5 &amp;&amp; $strict)) return (($o &amp; 0x03) &lt;&lt; 24 | (ord($s{1}) &amp; 0x3f) &lt;&lt; 18<br />
&nbsp;&nbsp; &nbsp; | (ord($s{2}) &amp; 0x3f) &lt;&lt; 12 | (ord($s{3}) &amp; 0x3f) &lt;&lt; 6 |&nbsp; (ord($s{4}) &amp; 0x3f));<br />
&nbsp; if ($o &lt;= 0xfd &amp;&amp; ($l=6 &amp;&amp; $strict)) return (($o &amp; 0x01) &lt;&lt; 30 | (ord($s{1}) &amp; 0x3f) &lt;&lt; 24<br />
&nbsp;&nbsp; &nbsp; | (ord($s{2}) &amp; 0x3f) &lt;&lt; 18 | (ord($s{3}) &amp; 0x3f) &lt;&lt; 12<br />
&nbsp;&nbsp; &nbsp; | (ord($s{4}) &amp; 0x3f) &lt;&lt; 6 |&nbsp; (ord($s{5}) &amp; 0x3f));<br />
&nbsp; return false;<br />
}<br />
<br />
// boundary behavior checking<br />
$do=array(0x7f,0x7ff,0xffff,0x1fffff,0x3ffffff,0x7fffffff);<br />
foreach ($do as $ii) for ($i=$ii;$i&lt;=$ii+1; $i++) {<br />
&nbsp; $o=i3u($i);<br />
&nbsp; for ($j=0;$j&lt;strlen($o);$j++) print "O[$j]=" . sprintf('%08b',ord($o{$j})) . ", ";<br />
&nbsp; print "c=$i, o=[$o].\n";<br />
&nbsp; print "Back: [$o] =&gt; [" . u3i($o) . "]\n";<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71288""></a>
  <div class="note">
   <strong class="user">sadikkeskin at hotmail dot com</strong>
   <a href="#71288" class="date">21-Nov-2006 11:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
i wrote a function to convert encoding utf8 to iso-8859-9. This function is very useful if you want to use this for ajax.<br />
you can apply same way for other languages. <br />
&lt;?<br />
function str_encode ($string,$to="iso-8859-9",$from="utf8") {<br />
&nbsp;&nbsp;&nbsp; if($to=="iso-8859-9" &amp;&amp; $from=="utf8"){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $str_array = array(<br />
&nbsp;&nbsp; &nbsp; &nbsp; chr(196).chr(177) =&gt; chr(253),<br />
&nbsp;&nbsp; &nbsp; &nbsp; chr(196).chr(176) =&gt; chr(221),<br />
&nbsp;&nbsp; &nbsp; &nbsp; chr(195).chr(182) =&gt; chr(246),<br />
&nbsp;&nbsp; &nbsp; &nbsp; chr(195).chr(150) =&gt; chr(214),<br />
&nbsp;&nbsp; &nbsp; &nbsp; chr(195).chr(167) =&gt; chr(231),<br />
&nbsp;&nbsp; &nbsp; &nbsp; chr(195).chr(135) =&gt; chr(199),<br />
&nbsp;&nbsp; &nbsp; &nbsp; chr(197).chr(159) =&gt; chr(254),<br />
&nbsp;&nbsp; &nbsp; &nbsp; chr(197).chr(158) =&gt; chr(222),<br />
&nbsp;&nbsp; &nbsp; &nbsp; chr(196).chr(159) =&gt; chr(240),<br />
&nbsp;&nbsp; &nbsp; &nbsp; chr(196).chr(158) =&gt; chr(208),<br />
&nbsp;&nbsp; &nbsp; &nbsp; chr(195).chr(188) =&gt; chr(252),<br />
&nbsp;&nbsp; &nbsp; &nbsp; chr(195).chr(156) =&gt; chr(220)<br />
&nbsp;&nbsp; &nbsp; &nbsp; );<br />
&nbsp;&nbsp; &nbsp; &nbsp; return str_replace(array_keys($str_array), array_values($str_array), $string);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; }&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; return $string;<br />
}<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="70050""></a>
  <div class="note">
   <strong class="user">genert at adsuk dot com</strong>
   <a href="#70050" class="date">01-Oct-2006 07:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you encoded data with utf8_encode function and you would like to decode it in javascript use library found here: <a href="http://www.webtoolkit.info/. There is encoder too." rel="nofollow" target="_blank">http://www.webtoolkit.info/. There is encoder too.</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69955""></a>
  <div class="note">
   
   <a href="#69955" class="date">27-Sep-2006 10:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In reply to Cundle:<br />
<br />
Note: The BOM is completely unnecessary in UTF-8. UTF-8 is interpreted the same way regardless of endianness, e.g. Λ (U+039B, GREEK CAPITAL LETTER LAMDA) is represented as the octets 0xCE, 0x9B, always in that order.<br />
<br />
Extra note: UTF-16 and UCS-2 are different. The same letter would be encoded as 0x03 0x9B on big-endian (e.g. Motorola) architecture, but 0x9B 0x03 on little-endian (e.g Intel) architecture.<br />
<br />
But in any case, there's nothing wrong with putting a BOM at the beginning of a UTF-8 encoded file. It is just treated as U+FEFF Zero Width No-Break Space.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68211""></a>
  <div class="note">
   <strong class="user">James Cundle</strong>
   <a href="#68211" class="date">18-Jul-2006 04:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I had some difficulty finding a way to easily write UTF-8 files with the byte order mark included. This is the simple solution I have come up with:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">writeUTF8File</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">,</span><span class="default">$content</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dhandle</span><span class="keyword">=</span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">,</span><span class="string">"w"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment"># Now UTF-8 - Add byte order mark<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$dhandle</span><span class="keyword">, </span><span class="default">pack</span><span class="keyword">(</span><span class="string">"CCC"</span><span class="keyword">,</span><span class="default">0xef</span><span class="keyword">,</span><span class="default">0xbb</span><span class="keyword">,</span><span class="default">0xbf</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$dhandle</span><span class="keyword">,</span><span class="default">$content</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$dhandle</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
When you read the file back in using fopen, the BOM will also be there. To remove it, I also wrote the following function:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">removeBOM</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">=</span><span class="string">""</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">,</span><span class="default">3</span><span class="keyword">) == </span><span class="default">pack</span><span class="keyword">(</span><span class="string">"CCC"</span><span class="keyword">,</span><span class="default">0xef</span><span class="keyword">,</span><span class="default">0xbb</span><span class="keyword">,</span><span class="default">0xbf</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$str</span><span class="keyword">=</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$str</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="63222""></a>
  <div class="note">
   <strong class="user">rocketman</strong>
   <a href="#63222" class="date">16-Mar-2006 01:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are looking for a function to replace special characters with the hex-utf-8 value (e.g. für Webservice-Security/WSS4J compliancy) you might use this:<br />
<br />
$textstart = "Gr??e";<br />
$utf8 ='';<br />
$max = strlen($txt);<br />
<br />
for ($i = 0; $i &lt; $max; $i++) {<br />
<br />
if ($txt{i} == "&amp;"){<br />
$neu = "&amp;x26;";<br />
}<br />
elseif ((ord($txt{$i}) &lt; 32) or (ord($txt{$i}) &gt; 127)){<br />
$neu = urlencode(utf8_encode($txt{$i}));<br />
$neu = preg_replace('#\%(..)\%(..)\%(..)#','&amp;#x\1;&amp;#x\2;&amp;#x\3;',$neu);<br />
$neu = preg_replace('#\%(..)\%(..)#','&amp;#x\1;&amp;#x\2;',$neu);<br />
$neu = preg_replace('#\%(..)#','&amp;#x\1;',$neu);<br />
}<br />
else {<br />
$neu = $txt{$i};<br />
}<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
$utf8 .= $neu;<br />
} // for $i<br />
<br />
$textnew = $utf8;<br />
<br />
In this example $textnew will be "Gr&amp;#xC3;&amp;#xB6;&amp;#xC3;&amp;#x9F;e"</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="60957""></a>
  <div class="note">
   <strong class="user">mailing at jcn50 dot com</strong>
   <a href="#60957" class="date">21-Jan-2006 07:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I recommend using this alternative for every language:<br />
<br />
$new=mb_convert_encoding($s,"UTF-8","auto");<br />
<br />
Don't forget to set all your pages to "utf-8" encoding, otherwise just use HTML entities.<br />
<br />
jcn50.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="59710""></a>
  <div class="note">
   <strong class="user">migueldiaz at gennio dot com</strong>
   <a href="#59710" class="date">14-Dec-2005 06:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's my function to know if one string is encoded in UTF8.<br />
<br />
If we encode in UTF8 a string or text file that is already encoded in UTF8, it's expected to find the character '?' ( ALT+159)&nbsp; in the final string.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">isUTF8</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$string_utf8 </span><span class="keyword">= </span><span class="default">utf8_encode</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if( </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$string_utf8</span><span class="keyword">,</span><span class="string">"?"</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">) !== </span><span class="default">false </span><span class="keyword">) </span><span class="comment">// "?" is ALT+159<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">return </span><span class="default">true</span><span class="keyword">;&nbsp; </span><span class="comment">// the original string was utf8<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">false</span><span class="keyword">; </span><span class="comment">// otherwise<br />
</span><span class="keyword">}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
regards<br />
Miguel D?az</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="58461""></a>
  <div class="note">
   
   <a href="#58461" class="date">04-Nov-2005 11:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
// Reads a file story.txt ascii (as typed on keyboard) <br />
// converts it to Georgian character using utf8 encoding<br />
// if I am correct(?) just as it should be when typed on Georgian computer<br />
// it outputs it as an html file<br />
// <br />
// <a href="http://www.comweb.nl/keys_to_georgian.html" rel="nofollow" target="_blank">http://www.comweb.nl/keys_to_georgian.html</a><br />
// <a href="http://www.comweb.nl/keys_to_georgian.php" rel="nofollow" target="_blank">http://www.comweb.nl/keys_to_georgian.php</a><br />
// <a href="http://www.comweb.nl/story.txt" rel="nofollow" target="_blank">http://www.comweb.nl/story.txt</a><br />
<br />
&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "<a href="http://www.w3.org/TR/html4/loose.dtd" rel="nofollow" target="_blank">http://www.w3.org/TR/html4/loose.dtd</a>"&gt;<br />
<br />
&lt;HTML&gt;<br />
&lt;HEAD&gt;<br />
&lt;TITLE&gt;keys to unicode code&lt;/TITLE&gt;<br />
<br />
// this meta tag is needed<br />
&lt;meta http-equiv="Content-Type" content="text/html;CHARSET=gb2312" &gt;<br />
<br />
// note the sylfean font seems to be standard installed on Windows XP<br />
// It supports Georgian<br />
&nbsp;<br />
&lt;style TYPE="text/css"&gt;<br />
&lt;!--<br />
body {font-family:sylfaen; }<br />
--&gt;<br />
&lt;/style&gt;<br />
&lt;/HEAD&gt;<br />
<br />
&lt;BODY&gt;<br />
<br />
&lt;?<br />
$eng=array(97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,<br />
112,113,114,115,116,117,118,119,120,121,122,87,82,84,83,<br />
67,74,90);<br />
$geo=array(4304,4305,4330,4307,4308,4324,4306,4336,4312,4335,4313,<br />
4314,4315,4316,4317,4318,4325,4320,4321,4322,4323,4309,<br />
4332,4334,4327,4310,4333,4326,4311,4328,4329,4319,4331,<br />
91,93,59,39,44,46,96);<br />
<br />
$fc=file("story.txt");<br />
foreach($fc as $line)<br />
{<br />
&nbsp;&nbsp; $spacestart=1;<br />
&nbsp;&nbsp; for ($i=0; $i&lt;strlen($line); $i+=1)<br />
&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; $character=ord(substr($line,$i,1));<br />
&nbsp;&nbsp; &nbsp;&nbsp; $found=0;<br />
&nbsp;&nbsp; &nbsp;&nbsp; for ($k=0; $k&lt;count($eng); $k+=1)<br />
&nbsp;&nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; if ($eng[$k]==$character)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print code2utf( $geo[$k] );<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $found=1;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; if ($found==0) <br />
&nbsp;&nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; if ($character==126 || $character==32 || $character==10 || $character==9)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($character==9)&nbsp; { print '&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;'; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($character==10) { print "&lt;BR&gt;\n"; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($character==32) <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; { <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ($spacestart==1) {print '&amp;nbsp;'; } else { print " "; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($character==126){ print "~";&nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; } else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; { <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; print substr($line,$i,1);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; } <br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; if ($character!=32) { $spacestart=0; }<br />
&nbsp;&nbsp; }<br />
}<br />
<br />
/**<br />
&nbsp;* Function coverts number of utf char into that character.<br />
&nbsp;* Function taken from: <a href="http://sk2.php.net/manual/en/function.utf8-encode.php#49336" rel="nofollow" target="_blank">http://sk2.php.net/manual/en/function.utf8-encode.php#49336</a><br />
&nbsp;*<br />
&nbsp;* @param int $num<br />
&nbsp;* @return utf8char<br />
*/<br />
function code2utf($num)<br />
{<br />
&nbsp;&nbsp; if($num&lt;128)return chr($num);<br />
&nbsp;&nbsp; if($num&lt;2048)return chr(($num&gt;&gt;6)+192).chr(($num&amp;63)+128);<br />
&nbsp;&nbsp; if($num&lt;65536)return chr(($num&gt;&gt;12)+224).chr((($num&gt;&gt;6)&amp;63)+128).chr(($num&amp;63)+128);<br />
&nbsp;&nbsp; if($num&lt;2097152)return chr(($num&gt;&gt;18)+240).chr((($num&gt;&gt;12)&amp;63)+128).chr((($num&gt;&gt;6)&amp;63)+128) .chr(($num&amp;63)+128);<br />
&nbsp;&nbsp; return '';<br />
}<br />
?&gt;<br />
<br />
&lt;/BODY&gt;<br />
&lt;/HTML&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="58442""></a>
  <div class="note">
   <strong class="user">Janci</strong>
   <a href="#58442" class="date">04-Nov-2005 01:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I was searching for a function similar to Javascript's unescape(). In most cases it is OK to use url_decode() function but not if you've got UTF characters in the strings. They are converted into %uXXXX entities that url_decode() cannot handle.<br />
I googled the net and found a function which actualy converts these entities into HTML entities (&amp;#xxx;) that your browser can show correctly. If you're OK with that, the function can be found here: <a href="http://pure-essence.net/stuff/code/utf8RawUrlDecode.phps" rel="nofollow" target="_blank">http://pure-essence.net/stuff/code/utf8RawUrlDecode.phps</a><br />
<br />
But it was not OK with me because I needed a string in my charset to make some comparations and other stuff. So I have modified the above function and in conjuction with code2utf() function mentioned in some other note here, I have managed to achieve my goal:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/**<br />
&nbsp;* Function converts an Javascript escaped string back into a string with specified charset (default is UTF-8). <br />
&nbsp;* Modified function from <a href="http://pure-essence.net/stuff/code/utf8RawUrlDecode.phps" rel="nofollow" target="_blank">http://pure-essence.net/stuff/code/utf8RawUrlDecode.phps</a><br />
&nbsp;*<br />
&nbsp;* @param string $source escaped with Javascript's escape() function<br />
&nbsp;* @param string $iconv_to destination character set will be used as second paramether in the iconv function. Default is UTF-8.<br />
&nbsp;* @return string<br />
&nbsp;*/<br />
</span><span class="keyword">function </span><span class="default">unescape</span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">, </span><span class="default">$iconv_to </span><span class="keyword">= </span><span class="string">'UTF-8'</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$decodedStr </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$pos </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$len </span><span class="keyword">= </span><span class="default">strlen </span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; while (</span><span class="default">$pos </span><span class="keyword">&lt; </span><span class="default">$len</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$charAt </span><span class="keyword">= </span><span class="default">substr </span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">, </span><span class="default">$pos</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$charAt </span><span class="keyword">== </span><span class="string">'%'</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pos</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$charAt </span><span class="keyword">= </span><span class="default">substr </span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">, </span><span class="default">$pos</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$charAt </span><span class="keyword">== </span><span class="string">'u'</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// we got a unicode character<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pos</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$unicodeHexVal </span><span class="keyword">= </span><span class="default">substr </span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">, </span><span class="default">$pos</span><span class="keyword">, </span><span class="default">4</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$unicode </span><span class="keyword">= </span><span class="default">hexdec </span><span class="keyword">(</span><span class="default">$unicodeHexVal</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$decodedStr </span><span class="keyword">.= </span><span class="default">code2utf</span><span class="keyword">(</span><span class="default">$unicode</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pos </span><span class="keyword">+= </span><span class="default">4</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// we have an escaped ascii character<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$hexVal </span><span class="keyword">= </span><span class="default">substr </span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">, </span><span class="default">$pos</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$decodedStr </span><span class="keyword">.= </span><span class="default">chr </span><span class="keyword">(</span><span class="default">hexdec </span><span class="keyword">(</span><span class="default">$hexVal</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pos </span><span class="keyword">+= </span><span class="default">2</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$decodedStr </span><span class="keyword">.= </span><span class="default">$charAt</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pos</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$iconv_to </span><span class="keyword">!= </span><span class="string">"UTF-8"</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$decodedStr </span><span class="keyword">= </span><span class="default">iconv</span><span class="keyword">(</span><span class="string">"UTF-8"</span><span class="keyword">, </span><span class="default">$iconv_to</span><span class="keyword">, </span><span class="default">$decodedStr</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$decodedStr</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="comment">/**<br />
&nbsp;* Function coverts number of utf char into that character.<br />
&nbsp;* Function taken from: <a href="http://sk2.php.net/manual/en/function.utf8-encode.php#49336" rel="nofollow" target="_blank">http://sk2.php.net/manual/en/function.utf8-encode.php#49336</a><br />
&nbsp;*<br />
&nbsp;* @param int $num<br />
&nbsp;* @return utf8char<br />
&nbsp;*/<br />
</span><span class="keyword">function </span><span class="default">code2utf</span><span class="keyword">(</span><span class="default">$num</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$num</span><span class="keyword">&lt;</span><span class="default">128</span><span class="keyword">)return </span><span class="default">chr</span><span class="keyword">(</span><span class="default">$num</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$num</span><span class="keyword">&lt;</span><span class="default">2048</span><span class="keyword">)return </span><span class="default">chr</span><span class="keyword">((</span><span class="default">$num</span><span class="keyword">&gt;&gt;</span><span class="default">6</span><span class="keyword">)+</span><span class="default">192</span><span class="keyword">).</span><span class="default">chr</span><span class="keyword">((</span><span class="default">$num</span><span class="keyword">&amp;</span><span class="default">63</span><span class="keyword">)+</span><span class="default">128</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$num</span><span class="keyword">&lt;</span><span class="default">65536</span><span class="keyword">)return </span><span class="default">chr</span><span class="keyword">((</span><span class="default">$num</span><span class="keyword">&gt;&gt;</span><span class="default">12</span><span class="keyword">)+</span><span class="default">224</span><span class="keyword">).</span><span class="default">chr</span><span class="keyword">(((</span><span class="default">$num</span><span class="keyword">&gt;&gt;</span><span class="default">6</span><span class="keyword">)&amp;</span><span class="default">63</span><span class="keyword">)+</span><span class="default">128</span><span class="keyword">).</span><span class="default">chr</span><span class="keyword">((</span><span class="default">$num</span><span class="keyword">&amp;</span><span class="default">63</span><span class="keyword">)+</span><span class="default">128</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$num</span><span class="keyword">&lt;</span><span class="default">2097152</span><span class="keyword">)return </span><span class="default">chr</span><span class="keyword">((</span><span class="default">$num</span><span class="keyword">&gt;&gt;</span><span class="default">18</span><span class="keyword">)+</span><span class="default">240</span><span class="keyword">).</span><span class="default">chr</span><span class="keyword">(((</span><span class="default">$num</span><span class="keyword">&gt;&gt;</span><span class="default">12</span><span class="keyword">)&amp;</span><span class="default">63</span><span class="keyword">)+</span><span class="default">128</span><span class="keyword">).</span><span class="default">chr</span><span class="keyword">(((</span><span class="default">$num</span><span class="keyword">&gt;&gt;</span><span class="default">6</span><span class="keyword">)&amp;</span><span class="default">63</span><span class="keyword">)+</span><span class="default">128</span><span class="keyword">) .</span><span class="default">chr</span><span class="keyword">((</span><span class="default">$num</span><span class="keyword">&amp;</span><span class="default">63</span><span class="keyword">)+</span><span class="default">128</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="string">''</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="56406""></a>
  <div class="note">
   <strong class="user">aktionimskript at gmx dot net</strong>
   <a href="#56406" class="date">01-Sep-2005 05:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
if you want to put variables as parameter in a flashfile, i prefer using to convert the string with utf8_encode() [or preg_replace, or iconv] and after this i encode it with urlencode();<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp; &nbsp; $yourstring</span><span class="keyword">=</span><span class="string">"yourstring"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$str_utf8</span><span class="keyword">=</span><span class="default">utf8_encode</span><span class="keyword">(</span><span class="default">$yourstring</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$str_encoded</span><span class="keyword">=</span><span class="default">urlencode</span><span class="keyword">(</span><span class="default">$str_utf8</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; echo </span><span class="string">"&lt;script language='javascript'&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; echo </span><span class="string">"parameterForFlash='"</span><span class="keyword">.</span><span class="default">$str_encoded</span><span class="keyword">.</span><span class="string">"';"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; echo </span><span class="string">"&lt;/script&gt;"</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
now you can use the variable (parameterForFlash) in your javascript (plugindetection), that writes the flash object/embed.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="53318""></a>
  <div class="note">
   <strong class="user">suttichai at ceforce dot com</strong>
   <a href="#53318" class="date">28-May-2005 09:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This function I use convert Thai font (iso-8859-11) to UTF-8. For my case, It work properly. Please try to use this function if you have a problem to convert charset iso-8859-11 to UTF-8.<br />
<br />
function iso8859_11toUTF8($string) {<br />
&nbsp; <br />
&nbsp;&nbsp; &nbsp; if ( ! ereg("[\241-\377]", $string) )<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; return $string;<br />
&nbsp;<br />
&nbsp;&nbsp; &nbsp; $iso8859_11 = array(<br />
"\xa1" =&gt; "\xe0\xb8\x81",<br />
"\xa2" =&gt; "\xe0\xb8\x82",<br />
"\xa3" =&gt; "\xe0\xb8\x83",<br />
"\xa4" =&gt; "\xe0\xb8\x84",<br />
"\xa5" =&gt; "\xe0\xb8\x85",<br />
"\xa6" =&gt; "\xe0\xb8\x86",<br />
"\xa7" =&gt; "\xe0\xb8\x87",<br />
"\xa8" =&gt; "\xe0\xb8\x88",<br />
"\xa9" =&gt; "\xe0\xb8\x89",<br />
"\xaa" =&gt; "\xe0\xb8\x8a",<br />
"\xab" =&gt; "\xe0\xb8\x8b",<br />
"\xac" =&gt; "\xe0\xb8\x8c",<br />
"\xad" =&gt; "\xe0\xb8\x8d",<br />
"\xae" =&gt; "\xe0\xb8\x8e",<br />
"\xaf" =&gt; "\xe0\xb8\x8f",<br />
"\xb0" =&gt; "\xe0\xb8\x90",<br />
"\xb1" =&gt; "\xe0\xb8\x91",<br />
"\xb2" =&gt; "\xe0\xb8\x92",<br />
"\xb3" =&gt; "\xe0\xb8\x93",<br />
"\xb4" =&gt; "\xe0\xb8\x94",<br />
"\xb5" =&gt; "\xe0\xb8\x95",<br />
"\xb6" =&gt; "\xe0\xb8\x96",<br />
"\xb7" =&gt; "\xe0\xb8\x97",<br />
"\xb8" =&gt; "\xe0\xb8\x98",<br />
"\xb9" =&gt; "\xe0\xb8\x99",<br />
"\xba" =&gt; "\xe0\xb8\x9a",<br />
"\xbb" =&gt; "\xe0\xb8\x9b",<br />
"\xbc" =&gt; "\xe0\xb8\x9c",<br />
"\xbd" =&gt; "\xe0\xb8\x9d",<br />
"\xbe" =&gt; "\xe0\xb8\x9e",<br />
"\xbf" =&gt; "\xe0\xb8\x9f",<br />
"\xc0" =&gt; "\xe0\xb8\xa0",<br />
"\xc1" =&gt; "\xe0\xb8\xa1",<br />
"\xc2" =&gt; "\xe0\xb8\xa2",<br />
"\xc3" =&gt; "\xe0\xb8\xa3",<br />
"\xc4" =&gt; "\xe0\xb8\xa4",<br />
"\xc5" =&gt; "\xe0\xb8\xa5",<br />
"\xc6" =&gt; "\xe0\xb8\xa6",<br />
"\xc7" =&gt; "\xe0\xb8\xa7",<br />
"\xc8" =&gt; "\xe0\xb8\xa8",<br />
"\xc9" =&gt; "\xe0\xb8\xa9",<br />
"\xca" =&gt; "\xe0\xb8\xaa",<br />
"\xcb" =&gt; "\xe0\xb8\xab",<br />
"\xcc" =&gt; "\xe0\xb8\xac",<br />
"\xcd" =&gt; "\xe0\xb8\xad",<br />
"\xce" =&gt; "\xe0\xb8\xae",<br />
"\xcf" =&gt; "\xe0\xb8\xaf",<br />
"\xd0" =&gt; "\xe0\xb8\xb0",<br />
"\xd1" =&gt; "\xe0\xb8\xb1",<br />
"\xd2" =&gt; "\xe0\xb8\xb2",<br />
"\xd3" =&gt; "\xe0\xb8\xb3",<br />
"\xd4" =&gt; "\xe0\xb8\xb4",<br />
"\xd5" =&gt; "\xe0\xb8\xb5",<br />
"\xd6" =&gt; "\xe0\xb8\xb6",<br />
"\xd7" =&gt; "\xe0\xb8\xb7",<br />
"\xd8" =&gt; "\xe0\xb8\xb8",<br />
"\xd9" =&gt; "\xe0\xb8\xb9",<br />
"\xda" =&gt; "\xe0\xb8\xba",<br />
"\xdf" =&gt; "\xe0\xb8\xbf",<br />
"\xe0" =&gt; "\xe0\xb9\x80",<br />
"\xe1" =&gt; "\xe0\xb9\x81",<br />
"\xe2" =&gt; "\xe0\xb9\x82",<br />
"\xe3" =&gt; "\xe0\xb9\x83",<br />
"\xe4" =&gt; "\xe0\xb9\x84",<br />
"\xe5" =&gt; "\xe0\xb9\x85",<br />
"\xe6" =&gt; "\xe0\xb9\x86",<br />
"\xe7" =&gt; "\xe0\xb9\x87",<br />
"\xe8" =&gt; "\xe0\xb9\x88",<br />
"\xe9" =&gt; "\xe0\xb9\x89",<br />
"\xea" =&gt; "\xe0\xb9\x8a",<br />
"\xeb" =&gt; "\xe0\xb9\x8b",<br />
"\xec" =&gt; "\xe0\xb9\x8c",<br />
"\xed" =&gt; "\xe0\xb9\x8d",<br />
"\xee" =&gt; "\xe0\xb9\x8e",<br />
"\xef" =&gt; "\xe0\xb9\x8f",<br />
"\xf0" =&gt; "\xe0\xb9\x90",<br />
"\xf1" =&gt; "\xe0\xb9\x91",<br />
"\xf2" =&gt; "\xe0\xb9\x92",<br />
"\xf3" =&gt; "\xe0\xb9\x93",<br />
"\xf4" =&gt; "\xe0\xb9\x94",<br />
"\xf5" =&gt; "\xe0\xb9\x95",<br />
"\xf6" =&gt; "\xe0\xb9\x96",<br />
"\xf7" =&gt; "\xe0\xb9\x97",<br />
"\xf8" =&gt; "\xe0\xb9\x98",<br />
"\xf9" =&gt; "\xe0\xb9\x99",<br />
"\xfa" =&gt; "\xe0\xb9\x9a",<br />
"\xfb" =&gt; "\xe0\xb9\x9b"<br />
&nbsp;);<br />
&nbsp;<br />
&nbsp;&nbsp; &nbsp; $string=strtr($string,$iso8859_11);<br />
&nbsp;&nbsp; &nbsp; return $string;<br />
&nbsp;}<br />
<br />
Suttichai Mesaard-www.ceforce.com</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="52994""></a>
  <div class="note">
   <strong class="user">bisqwit at iki dot fi</strong>
   <a href="#52994" class="date">20-May-2005 10:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For reference, it may be insightful to point out that:<br />
&nbsp; utf8_encode($s)<br />
is actually identical to:<br />
&nbsp; recode_string('latin1..utf8', $s)<br />
and:<br />
&nbsp; iconv('iso-8859-1', 'utf-8', $s)<br />
That is, utf8_encode is a specialized case of character set conversions.<br />
<br />
If your string to be converted to utf-8 is something other than iso-8859-1 (such as iso-8859-2 (Polish/Croatian)), you should use recode_string() or iconv() instead rather than trying to devise complex str_replace statements.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="51744""></a>
  <div class="note">
   <strong class="user">JF Sebastian</strong>
   <a href="#51744" class="date">09-Apr-2005 12:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The following Perl regular expression tests if a string is well-formed Unicode UTF-8 (Broken up after each | since long lines are not permitted here. Please join as a single line, no spaces, before use.):<br />
<br />
^([\x00-\x7f]|<br />
[\xc2-\xdf][\x80-\xbf]|<br />
\xe0[\xa0-\xbf][\x80-\xbf]|<br />
[\xe1-\xec][\x80-\xbf]{2}|<br />
\xed[\x80-\x9f][\x80-\xbf]|<br />
[\xee-\xef][\x80-\xbf]{2}|<br />
f0[\x90-\xbf][\x80-\xbf]{2}|<br />
[\xf1-\xf3][\x80-\xbf]{3}|<br />
\xf4[\x80-\x8f][\x80-\xbf]{2})*$<br />
<br />
NOTE: This strictly follows the Unicode standard 4.0, as described in chapter 3.9, table 3-6, "Well-formed UTF-8 byte sequences" ( <a href="http://www.unicode.org/versions/Unicode4.0.0/ch03.pdf#G31703 " rel="nofollow" target="_blank">http://www.unicode.org/versions/Unicode4.0.0/ch03.pdf#G31703 </a>).<br />
<br />
ISO-10646, a super-set of Unicode, uses UTF-8 (there called "UCS", see <a href="http://www.unicode.org/faq/utf_bom.html#1 " rel="nofollow" target="_blank">http://www.unicode.org/faq/utf_bom.html#1 </a>) in a relaxed variant that supports a 31-bit space encoded into up to six bytes instead of Unicode's 21 bits in up to four bytes. To check for ISO-10646 UTF-8, use the following Perl regular expression (again, broken up, see above):<br />
<br />
^([\x00-\x7f]|<br />
[\xc0-\xdf][\x80-\xbf]|<br />
[\xe0-\xef][\x80-\xbf]{2}|<br />
[\xf0-\xf7][\x80-\xbf]{3}|<br />
[\xf8-\xfb][\x80-\xbf]{4}|<br />
[\xfc-\xfd][\x80-\xbf]{5})*$<br />
<br />
The following function may be used with above expressions for a quick UTF-8 test, e.g. to distinguish ISO-8859-1-data from UTF-8-data if submitted from a &lt;form accept-charset="utf-8,iso-8859-1" method=..&gt;.<br />
<br />
function is_utf8($string) {<br />
&nbsp;&nbsp; return (preg_match('/[insert regular expression here]/', $string) === 1);<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="50796""></a>
  <div class="note">
   <strong class="user">http://iubito.free.fr</strong>
   <a href="#50796" class="date">10-Mar-2005 08:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's a function I made to know if one string or textfile is already encoded in UTF8 :<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/**<br />
&nbsp;* Returns &lt;kbd&gt;true&lt;/kbd&gt; if the string or array of string is encoded in UTF8.<br />
&nbsp;*<br />
&nbsp;* Example of use. If you want to know if a file is saved in UTF8 format :<br />
&nbsp;* &lt;code&gt; $array = file('one file.txt');<br />
&nbsp;* $isUTF8 = isUTF8($array);<br />
&nbsp;* if (!$isUTF8) --&gt; we need to apply utf8_encode() to be in UTF8<br />
&nbsp;* else --&gt; we are in UTF8 :)<br />
&nbsp;* &lt;/code&gt;<br />
&nbsp;* @param mixed A string, or an array from a file() function.<br />
&nbsp;* @return boolean<br />
&nbsp;*/<br />
</span><span class="keyword">function </span><span class="default">isUTF8</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$enc </span><span class="keyword">= </span><span class="default">implode</span><span class="keyword">(</span><span class="string">''</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return @!((</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$enc</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]) != </span><span class="default">239</span><span class="keyword">) &amp;&amp; (</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$enc</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]) != </span><span class="default">187</span><span class="keyword">) &amp;&amp; (</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$enc</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]) != </span><span class="default">191</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; else<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return (</span><span class="default">utf8_encode</span><span class="keyword">(</span><span class="default">utf8_decode</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">)) == </span><span class="default">$string</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }&nbsp; &nbsp; <br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="50313""></a>
  <div class="note">
   <strong class="user">Denis G.</strong>
   <a href="#50313" class="date">24-Feb-2005 02:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Sniplet to convert ASCII coded text to UTF-8:<br />
<br />
$text= preg_replace ('/([\x80-\xff])/se', "pack (\"C*\", (ord ($1) &gt;&gt; 6) | 0xc0, (ord ($1) &amp; 0x3f) | 0x80)", $text);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="49336""></a>
  <div class="note">
   <strong class="user">anonymous at anonymous dot com</strong>
   <a href="#49336" class="date">24-Jan-2005 11:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A few bugs in your example code:<br />
<br />
&nbsp;function code2utf($num){<br />
&nbsp; if($num&lt;128)return chr($num);<br />
&nbsp; if($num&lt;2048)return chr(($num&gt;&gt;6)+192).chr(($num&amp;63)+128);<br />
&nbsp; if($num&lt;65536)return chr(($num&gt;&gt;12)+224).chr((($num&gt;&gt;6)&amp;63)+128).chr(($num&amp;63)+128);<br />
&nbsp; if($num&lt;2097152)return chr(($num&gt;&gt;18)+240).chr((($num&gt;&gt;12)&amp;63)+128).chr((($num&gt;&gt;6)&amp;63)+128) .chr(($num&amp;63)+128);<br />
&nbsp; return '';<br />
&nbsp;}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="48892""></a>
  <div class="note">
   <strong class="user">schofei at yahoo dot de</strong>
   <a href="#48892" class="date">11-Jan-2005 12:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
regarding the above code2utf function...<br />
<br />
&gt; romans at void dot lv<br />
&gt; 02-Oct-2002 09:59<br />
&gt; Here is optimized function which converts<br />
&gt; binary UTF symbol code into unicoded string....<br />
<br />
Thanks for providing your nice conversion code, however due to some missing parenthesis 4-byte utf-8 chars are not converted properly.<br />
<br />
Here is a corrected version of the code2utf function:<br />
<br />
&nbsp;function code2utf($num){<br />
&nbsp; if($num&lt;128)return chr($num);<br />
&nbsp; if($num&lt;1024)return chr(($num&gt;&gt;6)+192).chr(($num&amp;63)+128);<br />
&nbsp; if($num&lt;32768)return chr(($num&gt;&gt;12)+224).chr((($num&gt;&gt;6)&amp;63)+128).chr(($num&amp;63)+128);<br />
&nbsp; if($num&lt;2097152)return chr(($num&gt;&gt;18)+240).chr((($num&gt;&gt;12)&amp;63)+128).chr((($num&gt;&gt;6)&amp;63)+128) .chr(($num&amp;63)+128);<br />
&nbsp; return '';<br />
&nbsp;}<br />
&nbsp;<br />
regards<br />
Scho Fei</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="48160""></a>
  <div class="note">
   <strong class="user">hrpeters (at) gmx (dot) net</strong>
   <a href="#48160" class="date">14-Dec-2004 07:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
// Validate Unicode UTF-8 Version 4
<br />
// This function takes as reference the table 3.6 found at <a href="http://www.unicode.org/versions/Unicode4.0.0/ch03.pdf" rel="nofollow" target="_blank">http://www.unicode.org/versions/Unicode4.0.0/ch03.pdf</a>
<br />
// It also flags overlong bytes as error
<br />

<br />
function is_validUTF8($str)
<br />
{
<br />
&nbsp;&nbsp;&nbsp; // values of -1 represent disalloweded values for the first bytes in current UTF-8
<br />
&nbsp;&nbsp;&nbsp; static $trailing_bytes = array (
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; -1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1, -1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; -1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1, -1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; -1,-1,1,1,1,1,1,1,1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2, 3,3,3,3,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1
<br />
&nbsp;&nbsp;&nbsp; );
<br />

<br />
&nbsp;&nbsp;&nbsp; $ups = unpack('C*', $str);
<br />
&nbsp;&nbsp;&nbsp; if (!($aCnt = count($ups))) return true; // Empty string *is* valid UTF-8 
<br />
&nbsp;&nbsp;&nbsp; for ($i = 1; $i &lt;= $aCnt;)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!($tbytes = $trailing_bytes[($b1 = $ups[$i++])])) continue;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ($tbytes == -1) return false;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $first = true;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while ($tbytes &gt; 0 &amp;&amp; $i &lt;= $aCnt)
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $cbyte = $ups[$i++];
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (($cbyte &amp; 0xC0) != 0x80) return false;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($first)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; switch ($b1)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case 0xE0:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($cbyte &lt; 0xA0) return false;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case 0xED:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($cbyte &gt; 0x9F) return false;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case 0xF0:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($cbyte &lt; 0x90) return false;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case 0xF4:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($cbyte &gt; 0x8F) return false;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; default:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $first = false;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $tbytes--;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ($tbytes) return false; // incomplete sequence at EOS
<br />
&nbsp;&nbsp;&nbsp; }&nbsp; &nbsp; &nbsp; &nbsp; 
<br />
&nbsp;&nbsp;&nbsp; return true;
<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="47272""></a>
  <div class="note">
   <strong class="user">Mark AT modernbill DOT com</strong>
   <a href="#47272" class="date">09-Nov-2004 08:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you haven't guessed already: If the UTF-8 character has no representation in the ISO-8859-1 codepage, a ? will be returned. You might want to wrap a function around this to make sure you aren't saving a bunch of ???? into your database.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="45226""></a>
  <div class="note">
   <strong class="user">Aidan Kehoe &lt;php-manual at parhasard dot net&gt;</strong>
   <a href="#45226" class="date">30-Aug-2004 04:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's some code that addresses the issue that Steven describes in the previous comment; <br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">/* This structure encodes the difference between ISO-8859-1 and Windows-1252,<br />
&nbsp;&nbsp; as a map from the UTF-8 encoding of some ISO-8859-1 control characters to<br />
&nbsp;&nbsp; the UTF-8 encoding of the non-control characters that Windows-1252 places<br />
&nbsp;&nbsp; at the equivalent code points. */<br />
<br />
</span><span class="default">$cp1252_map </span><span class="keyword">= array(<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\xc2\x80" </span><span class="keyword">=&gt; </span><span class="string">"\xe2\x82\xac"</span><span class="keyword">, </span><span class="comment">/* EURO SIGN */<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\xc2\x82" </span><span class="keyword">=&gt; </span><span class="string">"\xe2\x80\x9a"</span><span class="keyword">, </span><span class="comment">/* SINGLE LOW-9 QUOTATION MARK */<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\xc2\x83" </span><span class="keyword">=&gt; </span><span class="string">"\xc6\x92"</span><span class="keyword">,&nbsp; &nbsp;&nbsp; </span><span class="comment">/* LATIN SMALL LETTER F WITH HOOK */<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\xc2\x84" </span><span class="keyword">=&gt; </span><span class="string">"\xe2\x80\x9e"</span><span class="keyword">, </span><span class="comment">/* DOUBLE LOW-9 QUOTATION MARK */<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\xc2\x85" </span><span class="keyword">=&gt; </span><span class="string">"\xe2\x80\xa6"</span><span class="keyword">, </span><span class="comment">/* HORIZONTAL ELLIPSIS */<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\xc2\x86" </span><span class="keyword">=&gt; </span><span class="string">"\xe2\x80\xa0"</span><span class="keyword">, </span><span class="comment">/* DAGGER */<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\xc2\x87" </span><span class="keyword">=&gt; </span><span class="string">"\xe2\x80\xa1"</span><span class="keyword">, </span><span class="comment">/* DOUBLE DAGGER */<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\xc2\x88" </span><span class="keyword">=&gt; </span><span class="string">"\xcb\x86"</span><span class="keyword">,&nbsp; &nbsp;&nbsp; </span><span class="comment">/* MODIFIER LETTER CIRCUMFLEX ACCENT */<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\xc2\x89" </span><span class="keyword">=&gt; </span><span class="string">"\xe2\x80\xb0"</span><span class="keyword">, </span><span class="comment">/* PER MILLE SIGN */<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\xc2\x8a" </span><span class="keyword">=&gt; </span><span class="string">"\xc5\xa0"</span><span class="keyword">,&nbsp; &nbsp;&nbsp; </span><span class="comment">/* LATIN CAPITAL LETTER S WITH CARON */<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\xc2\x8b" </span><span class="keyword">=&gt; </span><span class="string">"\xe2\x80\xb9"</span><span class="keyword">, </span><span class="comment">/* SINGLE LEFT-POINTING ANGLE QUOTATION */<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\xc2\x8c" </span><span class="keyword">=&gt; </span><span class="string">"\xc5\x92"</span><span class="keyword">,&nbsp; &nbsp;&nbsp; </span><span class="comment">/* LATIN CAPITAL LIGATURE OE */<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\xc2\x8e" </span><span class="keyword">=&gt; </span><span class="string">"\xc5\xbd"</span><span class="keyword">,&nbsp; &nbsp;&nbsp; </span><span class="comment">/* LATIN CAPITAL LETTER Z WITH CARON */<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\xc2\x91" </span><span class="keyword">=&gt; </span><span class="string">"\xe2\x80\x98"</span><span class="keyword">, </span><span class="comment">/* LEFT SINGLE QUOTATION MARK */<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\xc2\x92" </span><span class="keyword">=&gt; </span><span class="string">"\xe2\x80\x99"</span><span class="keyword">, </span><span class="comment">/* RIGHT SINGLE QUOTATION MARK */<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\xc2\x93" </span><span class="keyword">=&gt; </span><span class="string">"\xe2\x80\x9c"</span><span class="keyword">, </span><span class="comment">/* LEFT DOUBLE QUOTATION MARK */<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\xc2\x94" </span><span class="keyword">=&gt; </span><span class="string">"\xe2\x80\x9d"</span><span class="keyword">, </span><span class="comment">/* RIGHT DOUBLE QUOTATION MARK */<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\xc2\x95" </span><span class="keyword">=&gt; </span><span class="string">"\xe2\x80\xa2"</span><span class="keyword">, </span><span class="comment">/* BULLET */<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\xc2\x96" </span><span class="keyword">=&gt; </span><span class="string">"\xe2\x80\x93"</span><span class="keyword">, </span><span class="comment">/* EN DASH */<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\xc2\x97" </span><span class="keyword">=&gt; </span><span class="string">"\xe2\x80\x94"</span><span class="keyword">, </span><span class="comment">/* EM DASH */<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\xc2\x98" </span><span class="keyword">=&gt; </span><span class="string">"\xcb\x9c"</span><span class="keyword">,&nbsp; &nbsp;&nbsp; </span><span class="comment">/* SMALL TILDE */<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\xc2\x99" </span><span class="keyword">=&gt; </span><span class="string">"\xe2\x84\xa2"</span><span class="keyword">, </span><span class="comment">/* TRADE MARK SIGN */<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\xc2\x9a" </span><span class="keyword">=&gt; </span><span class="string">"\xc5\xa1"</span><span class="keyword">,&nbsp; &nbsp;&nbsp; </span><span class="comment">/* LATIN SMALL LETTER S WITH CARON */<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\xc2\x9b" </span><span class="keyword">=&gt; </span><span class="string">"\xe2\x80\xba"</span><span class="keyword">, </span><span class="comment">/* SINGLE RIGHT-POINTING ANGLE QUOTATION*/<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\xc2\x9c" </span><span class="keyword">=&gt; </span><span class="string">"\xc5\x93"</span><span class="keyword">,&nbsp; &nbsp;&nbsp; </span><span class="comment">/* LATIN SMALL LIGATURE OE */<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\xc2\x9e" </span><span class="keyword">=&gt; </span><span class="string">"\xc5\xbe"</span><span class="keyword">,&nbsp; &nbsp;&nbsp; </span><span class="comment">/* LATIN SMALL LETTER Z WITH CARON */<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"\xc2\x9f" </span><span class="keyword">=&gt; </span><span class="string">"\xc5\xb8"&nbsp; &nbsp; &nbsp; </span><span class="comment">/* LATIN CAPITAL LETTER Y WITH DIAERESIS*/<br />
</span><span class="keyword">);<br />
<br />
function </span><span class="default">cp1252_to_utf8</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; global </span><span class="default">$cp1252_map</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return&nbsp; </span><span class="default">strtr</span><span class="keyword">(</span><span class="default">utf8_encode</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">), </span><span class="default">$cp1252_map</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="44843""></a>
  <div class="note">
   <strong class="user">steven -at- acko -dot- net</strong>
   <a href="#44843" class="date">17-Aug-2004 11:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that you should only use utf8_encode() on ISO-8859-1 data, and not on data using the Windows-1252 codepage. Microsoft's Windows-1252 codepage contains ISO-8859-1, but it includes several characters in the range 0x80-0x9F whose codepoints in Unicode do not match the byte's value (in Unicode, codepoints U+80 - U+9F are unassigned).<br />
<br />
utf8_encode() simply assumes the bytes integer value is the codepoint number in Unicode.<br />
<br />
E.g. in 1252, byte 0x80 is the euro sign, which is U+20AC. The same goes for curly quotes, em dashes, etc.<br />
<br />
utf8_encode() will convert 0x80 into U+0080 (an unassigned codepoint) rather than U+20AC.<br />
<br />
To convert 1252 to UTF-8, use iconv, recode or mbstring.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="43534""></a>
  <div class="note">
   <strong class="user">Net Raven</strong>
   <a href="#43534" class="date">24-Jun-2004 09:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I often need to convert multi language text sent to me for use in websites and other apps into UTF8 encoded so I can insert it into source code and databases.<br />
<br />
I knocked up a small web page with its charset set to UTF8 then set it up so I can paste from the original doc (eg word or excel) and have the page return the UTF8 encoded version.<br />
<br />
Of course the browser will convert the unicode to UTF8 for you as part of the submit (I use IE5 or better for this) then all you have to do in the PHP is encode the UTF8 so the browser will show it in its raw form.<br />
<br />
Its a bit bulky but I just convert ALL character to html numbered entities (brute force and ignorance does it again.)<br />
<br />
I've used this to encode everything from Hebrew to Japanese without problems <br />
<br />
&lt;?<br />
header("Content-Type: text/plain; CHARSET=gb2312"); <br />
$code = (get_magic_quotes_gpc())?stripslashes($GLOBALS[code]):$GLOBALS[code];<br />
?&gt;<br />
&lt;html&gt;<br />
&lt;head&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;title&gt;UTF8 ENCODER PAGE&lt;/title&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;meta http-equiv="content-type" content="text/html; CHARSET=gb2312"&gt;<br />
&lt;/head&gt;<br />
&lt;body&gt;<br />
&lt;form method=post action="?seed=<span class="default">&lt;?=time</span><span class="keyword">()</span><span class="default">?&gt;</span>"&gt;<br />
&nbsp;&nbsp;&nbsp; Original Unicode&lt;br /&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;textarea name="code" cols="80" rows="10"&gt;<span class="default">&lt;?=$code?&gt;</span>&lt;/textarea&gt;&lt;br /&gt;<br />
&nbsp;&nbsp;&nbsp; Encoded UTF8&lt;br /&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;textarea name="encd" cols="80" rows="10"&gt;&lt;?<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for ($i = 0; $i &lt; strlen($code); $i++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo '&amp;#'.ord(substr($code,$i,1));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; ?&gt;&lt;/textarea&gt;&lt;br /&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;input type="submit" value="encode"&gt;<br />
&lt;/form&gt;<br />
&lt;/body&gt;<br />
&lt;/html&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="41293""></a>
  <div class="note">
   <strong class="user">lorro at lorro dot wigner dot bme dot hu</strong>
   <a href="#41293" class="date">06-Apr-2004 04:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Good news is that utf8_encode (like UTF-8) passes '&lt;', '&gt;', '/', '\'', '"', etc., so you are free to utf8_encode complete blocks of html text that includes tags.<br />
Bad news is that UTF-8 is stupid enough so that utf8_encode(utf8_encode($str)) != utf8_encode($str) in most of the cases. What you can do is write utf8_ensure like:<br />
<br />
function utf8_ensure($str) {<br />
&nbsp;&nbsp;&nbsp; return seems_utf8($str)? $str: utf8_encode($str);<br />
}<br />
<br />
Comes handy when your view library tries to encode the same text multiple times.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="39932""></a>
  <div class="note">
   <strong class="user">bmorel at ssi dot fr</strong>
   <a href="#39932" class="date">16-Feb-2004 09:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is a simple function that can help, if you want to know if a string could be UTF-8 or not :<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">seems_utf8</span><span class="keyword">(</span><span class="default">$Str</span><span class="keyword">) {<br />
&nbsp;for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$Str</span><span class="keyword">); </span><span class="default">$i</span><span class="keyword">++) {<br />
&nbsp; if (</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$Str</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]) &lt; </span><span class="default">0x80</span><span class="keyword">) </span><span class="default">$n</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="comment"># 0bbbbbbb<br />
&nbsp; </span><span class="keyword">elseif ((</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$Str</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]) &amp; </span><span class="default">0xE0</span><span class="keyword">) == </span><span class="default">0xC0</span><span class="keyword">) </span><span class="default">$n</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">; </span><span class="comment"># 110bbbbb<br />
&nbsp; </span><span class="keyword">elseif ((</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$Str</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]) &amp; </span><span class="default">0xF0</span><span class="keyword">) == </span><span class="default">0xE0</span><span class="keyword">) </span><span class="default">$n</span><span class="keyword">=</span><span class="default">2</span><span class="keyword">; </span><span class="comment"># 1110bbbb<br />
&nbsp; </span><span class="keyword">elseif ((</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$Str</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]) &amp; </span><span class="default">0xF0</span><span class="keyword">) == </span><span class="default">0xF0</span><span class="keyword">) </span><span class="default">$n</span><span class="keyword">=</span><span class="default">3</span><span class="keyword">; </span><span class="comment"># 1111bbbb<br />
&nbsp; </span><span class="keyword">else return </span><span class="default">false</span><span class="keyword">; </span><span class="comment"># Does not match any model<br />
&nbsp; </span><span class="keyword">for (</span><span class="default">$j</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$j</span><span class="keyword">&lt;</span><span class="default">$n</span><span class="keyword">; </span><span class="default">$j</span><span class="keyword">++) { </span><span class="comment"># n octets that match 10bbbbbb follow ?<br />
&nbsp;&nbsp; </span><span class="keyword">if ((++</span><span class="default">$i </span><span class="keyword">== </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$Str</span><span class="keyword">)) || ((</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$Str</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]) &amp; </span><span class="default">0xC0</span><span class="keyword">) != </span><span class="default">0x80</span><span class="keyword">)) return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp; }<br />
&nbsp;}<br />
&nbsp;return </span><span class="default">true</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="36222""></a>
  <div class="note">
   <strong class="user">Karen</strong>
   <a href="#36222" class="date">01-Oct-2003 09:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Re the previous post about converting GB2312 code to Unicode code which displayed the following function:<br />
<br />
&lt;?<br />
// Program by sadly (www.phpx.com)<br />
<br />
function gb2unicode($gb)<br />
{<br />
&nbsp;&nbsp; if(!trim($gb))<br />
&nbsp;&nbsp;&nbsp; return $gb;<br />
&nbsp;&nbsp; $filename="gb2312.txt";<br />
&nbsp;&nbsp; $tmp=file($filename);<br />
&nbsp;&nbsp; $codetable=array();<br />
&nbsp;&nbsp; while(list($key,$value)=each($tmp))<br />
&nbsp;&nbsp;&nbsp; $codetable[hexdec(substr($value,0,6))]=substr($value,9,4);<br />
&nbsp;&nbsp; $utf="";<br />
&nbsp;&nbsp; while($gb)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (ord(substr($gb,0,1))&gt;127)<br />
&nbsp;&nbsp; &nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $this=substr($gb,0,2);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $gb=substr($gb,2,strlen($gb));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $utf.="&amp;#x".$codetable[hexdec(bin2hex($this))-0x8080].";";<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; else<br />
&nbsp;&nbsp; &nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; $gb=substr($gb,1,strlen($gb));<br />
&nbsp;&nbsp; &nbsp;&nbsp; $utf.=substr($gb,0,1);<br />
&nbsp;&nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; }<br />
&nbsp; return $utf;<br />
}<br />
?&gt;<br />
<br />
I found that a small change was needed in the code to properly handle latin characters embedded in the middle of gb2312 text, as when the text includes a URL or email address. Just reverse the two lines in the part of the statement above that handles ord vals !&gt;127. <br />
<br />
Change:<br />
<br />
$gb=substr($gb,1,strlen($gb));<br />
$utf.=substr($gb,0,1);<br />
<br />
to:<br />
<br />
$utf.=substr($gb,0,1);<br />
$gb=substr($gb,1,strlen($gb));<br />
<br />
In the original function, the first latin chacter was dropped and it was not converting the first non-latin character after the latin text (everything was shifted one character too far to the right). Reversing those two lines makes it work correctly in every example I have tried.<br />
<br />
Also, the source of the gb2312.txt file needed for this to work has changed. You can find it a couple places:<br />
<br />
<a href="http://tcl.apache.org/sources/tcl/tools/encoding/gb2312.txt" rel="nofollow" target="_blank">http://tcl.apache.org/sources/tcl/tools/encoding/gb2312.txt</a><br />
<a href="ftp://ftp.unicode.org/Public/MAPPINGS/OBSOLETE/EASTASIA/GB/GB2312.TXT" rel="nofollow" target="_blank">ftp://ftp.unicode.org/Public/MAPPINGS/OBSOLETE/EASTASIA/GB/GB2312.TXT</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="32613""></a>
  <div class="note">
   <strong class="user">artem at w510 dot tm dot odessa dot ua</strong>
   <a href="#32613" class="date">03-Jun-2003 04:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Loading variables in flash <br />
<br />
you can lost a lot of hours if your charset is not iso-88951 and you cant' see your characters in flash<br />
<br />
you must use iconv instead with your codepage <br />
(for example windows-1251 for ukrainian, russian)<br />
<br />
$fw = fopen("flash_input.txt", "w");<br />
if( $fw )<br />
{<br />
&nbsp;&nbsp;&nbsp; $utf = iconv("windows-1251","UTF-8",$variable_value);<br />
&nbsp;&nbsp;&nbsp; $out = 'variable_name='.$utf;<br />
&nbsp;&nbsp;&nbsp; fputs($fw, $out);<br />
&nbsp;&nbsp;&nbsp; fclose($fw);<br />
}<br />
<br />
and no urlecode is needed if you save data in file!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="32264""></a>
  <div class="note">
   <strong class="user">mualem_i at hotmail dot com</strong>
   <a href="#32264" class="date">22-May-2003 03:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hebrew!! What a language. I had some trouble placing the Hebrew in a javascript based drop down menu, the text appeared as UTF8 so I made this function to overcome the problem (Not talking about efficiency) <br />
<br />
function rtf_heb($string)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; $array = split (" ",$string) ;<br />
&nbsp;&nbsp;&nbsp; foreach ($array as $VAL)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $VAL = str_replace("&amp;#1488","?",$VAL);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $VAL = str_replace("&amp;#1489","?",$VAL);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $VAL = str_replace("&amp;#1490","?",$VAL);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $VAL = str_replace("&amp;#1491","?",$VAL);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $VAL = str_replace("&amp;#1492","?",$VAL);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $VAL = str_replace("&amp;#1493","?",$VAL);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $VAL = str_replace("&amp;#1494","?",$VAL);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $VAL = str_replace("&amp;#1495","?",$VAL);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $VAL = str_replace("&amp;#1496","?",$VAL);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $VAL = str_replace("&amp;#1497","?",$VAL);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $VAL = str_replace("&amp;#1499","?",$VAL);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $VAL = str_replace("&amp;#1500","?",$VAL);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $VAL = str_replace("&amp;#1502","?",$VAL);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $VAL = str_replace("&amp;#1504","?",$VAL);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $VAL = str_replace("&amp;#1505","?",$VAL);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $VAL = str_replace("&amp;#1506","?",$VAL);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $VAL = str_replace("&amp;#1508","?",$VAL);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $VAL = str_replace("&amp;#1510","?",$VAL);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $VAL = str_replace("&amp;#1511","?",$VAL);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $VAL = str_replace("&amp;#1512","?",$VAL);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $VAL = str_replace("&amp;#1513","?",$VAL);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $VAL = str_replace("&amp;#1514","?",$VAL);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $VAL = str_replace("&amp;#1498","?",$VAL);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $VAL = str_replace("&amp;#1507","?",$VAL);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $VAL = str_replace("&amp;#1503","?",$VAL);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $VAL = str_replace("&amp;#1501","?",$VAL);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $VAL = str_replace("&amp;#1509","?",$VAL);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $VAL = str_replace(";","",$VAL);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $send_VAR .= $VAL." ";<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return $send_VAR;<br />
&nbsp;&nbsp;&nbsp; }</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="32157""></a>
  <div class="note">
   <strong class="user">RoyLaw at 263 dot Net</strong>
   <a href="#32157" class="date">19-May-2003 01:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There is a function for converting GB2312 code to Unicode code.It maybe useful for programming on XML/WML in non-English lanaguages.<br />
<br />
&lt;?<br />
// Program by sadly (www.phpx.com)<br />
<br />
function gb2unicode($gb)<br />
{<br />
&nbsp;&nbsp; if(!trim($gb))<br />
&nbsp;&nbsp;&nbsp; return $gb;<br />
&nbsp;&nbsp; $filename="gb2312.txt";<br />
&nbsp;&nbsp; $tmp=file($filename);<br />
&nbsp;&nbsp; $codetable=array();<br />
&nbsp;&nbsp; while(list($key,$value)=each($tmp))<br />
&nbsp;&nbsp;&nbsp; $codetable[hexdec(substr($value,0,6))]=substr($value,9,4);<br />
&nbsp;&nbsp; $utf="";<br />
&nbsp;&nbsp; while($gb)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (ord(substr($gb,0,1))&gt;127)<br />
&nbsp;&nbsp; &nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $this=substr($gb,0,2);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $gb=substr($gb,2,strlen($gb));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $utf.="&amp;#x".$codetable[hexdec(bin2hex($this))-0x8080].";";<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; else<br />
&nbsp;&nbsp; &nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; $gb=substr($gb,1,strlen($gb));<br />
&nbsp;&nbsp; &nbsp;&nbsp; $utf.=substr($gb,0,1);<br />
&nbsp;&nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; }<br />
&nbsp; return $utf;<br />
}<br />
?&gt;<br />
<br />
This function requires a code list of gb2312,you can download it at<br />
<a href="ftp://ftp.unicode.org/Public/MAPPINGS/EASTASIA/GB/GB2312.TXT" rel="nofollow" target="_blank">ftp://ftp.unicode.org/Public/MAPPINGS/EASTASIA/GB/GB2312.TXT</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="30947""></a>
  <div class="note">
   <strong class="user">sunish_mv at rediffmail dot com</strong>
   <a href="#30947" class="date">04-Apr-2003 07:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
/*Here I have a class that will convert ISCII (Indian Standard Code for Information Interchange) devnagiri (Hindi) string to unicode string. /*<br />
<br />
<span class="default">&lt;?php<br />
<br />
&nbsp; </span><span class="keyword">class </span><span class="default">iscii2utf8 </span><span class="keyword">{<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; var </span><span class="default">$map</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; function </span><span class="default">iscii2utf8</span><span class="keyword">() {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">map </span><span class="keyword">= array (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"a0" </span><span class="keyword">=&gt;&nbsp; </span><span class="string">'63'&nbsp; </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"a1" </span><span class="keyword">=&gt; </span><span class="string">'2305' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"a2" </span><span class="keyword">=&gt; </span><span class="string">'2306' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"a3" </span><span class="keyword">=&gt; </span><span class="string">'2307' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"a4" </span><span class="keyword">=&gt; </span><span class="string">'2309' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"a5" </span><span class="keyword">=&gt; </span><span class="string">'2310' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"a6" </span><span class="keyword">=&gt; </span><span class="string">'2311' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"a7" </span><span class="keyword">=&gt; </span><span class="string">'2312' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"a8" </span><span class="keyword">=&gt; </span><span class="string">'2313' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"a9" </span><span class="keyword">=&gt; </span><span class="string">'2314' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"aa" </span><span class="keyword">=&gt; </span><span class="string">'2315' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"ab" </span><span class="keyword">=&gt; </span><span class="string">'2318' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"ac" </span><span class="keyword">=&gt; </span><span class="string">'2319' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"ad" </span><span class="keyword">=&gt; </span><span class="string">'2320' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"ae" </span><span class="keyword">=&gt; </span><span class="string">'2317' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"af" </span><span class="keyword">=&gt; </span><span class="string">'2322' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"b0" </span><span class="keyword">=&gt; </span><span class="string">'2323' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"b1" </span><span class="keyword">=&gt; </span><span class="string">'2324' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"b2" </span><span class="keyword">=&gt; </span><span class="string">'2321' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"b3" </span><span class="keyword">=&gt; </span><span class="string">'2325' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"b4" </span><span class="keyword">=&gt; </span><span class="string">'2326' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"b5" </span><span class="keyword">=&gt; </span><span class="string">'2327' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"b6" </span><span class="keyword">=&gt; </span><span class="string">'2328' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"b7" </span><span class="keyword">=&gt; </span><span class="string">'2329' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"b8" </span><span class="keyword">=&gt; </span><span class="string">'2330' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"b9" </span><span class="keyword">=&gt; </span><span class="string">'2331' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"ba" </span><span class="keyword">=&gt; </span><span class="string">'2332' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"bb" </span><span class="keyword">=&gt; </span><span class="string">'2333' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"bc" </span><span class="keyword">=&gt; </span><span class="string">'2334' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"bd" </span><span class="keyword">=&gt; </span><span class="string">'2335' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"be" </span><span class="keyword">=&gt; </span><span class="string">'2336' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"bf" </span><span class="keyword">=&gt; </span><span class="string">'2337' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"c0" </span><span class="keyword">=&gt; </span><span class="string">'2338' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"c1" </span><span class="keyword">=&gt; </span><span class="string">'2339' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"c2" </span><span class="keyword">=&gt; </span><span class="string">'2340' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"c3" </span><span class="keyword">=&gt; </span><span class="string">'2341' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"c4" </span><span class="keyword">=&gt; </span><span class="string">'2342' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"c5" </span><span class="keyword">=&gt; </span><span class="string">'2343' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"c6" </span><span class="keyword">=&gt; </span><span class="string">'2344' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"c7" </span><span class="keyword">=&gt; </span><span class="string">'2345' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"c8" </span><span class="keyword">=&gt; </span><span class="string">'2346' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"c9" </span><span class="keyword">=&gt; </span><span class="string">'2347' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"ca" </span><span class="keyword">=&gt; </span><span class="string">'2348' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"cb" </span><span class="keyword">=&gt; </span><span class="string">'2349' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"cc" </span><span class="keyword">=&gt; </span><span class="string">'2350' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"cd" </span><span class="keyword">=&gt; </span><span class="string">'2351' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"ce" </span><span class="keyword">=&gt; </span><span class="string">'2399' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"cf" </span><span class="keyword">=&gt; </span><span class="string">'2352' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"d0" </span><span class="keyword">=&gt; </span><span class="string">'2353' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"d1" </span><span class="keyword">=&gt; </span><span class="string">'2354' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"d2" </span><span class="keyword">=&gt; </span><span class="string">'2355' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"d3" </span><span class="keyword">=&gt; </span><span class="string">'2356' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"d4" </span><span class="keyword">=&gt; </span><span class="string">'2357' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"d5" </span><span class="keyword">=&gt; </span><span class="string">'2358' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"d6" </span><span class="keyword">=&gt; </span><span class="string">'2359' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"d7" </span><span class="keyword">=&gt; </span><span class="string">'2360' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"d8" </span><span class="keyword">=&gt; </span><span class="string">'2361' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"d9" </span><span class="keyword">=&gt;&nbsp; </span><span class="string">'63'&nbsp; </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"da" </span><span class="keyword">=&gt; </span><span class="string">'2366' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"db" </span><span class="keyword">=&gt; </span><span class="string">'2367' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"dc" </span><span class="keyword">=&gt; </span><span class="string">'2368' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"dd" </span><span class="keyword">=&gt; </span><span class="string">'2369' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"de" </span><span class="keyword">=&gt; </span><span class="string">'2370' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"df" </span><span class="keyword">=&gt; </span><span class="string">'2371' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"e0" </span><span class="keyword">=&gt; </span><span class="string">'2374' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"e1" </span><span class="keyword">=&gt; </span><span class="string">'2375' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"e2" </span><span class="keyword">=&gt; </span><span class="string">'2376' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"e3" </span><span class="keyword">=&gt; </span><span class="string">'2373' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"e4" </span><span class="keyword">=&gt; </span><span class="string">'2378' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"e5" </span><span class="keyword">=&gt; </span><span class="string">'2379' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"e6" </span><span class="keyword">=&gt; </span><span class="string">'2380' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"e7" </span><span class="keyword">=&gt; </span><span class="string">'2377' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"e8" </span><span class="keyword">=&gt; </span><span class="string">'2381' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"e9" </span><span class="keyword">=&gt;&nbsp; </span><span class="string">'63'&nbsp; </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"ea" </span><span class="keyword">=&gt; </span><span class="string">'2404' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"eb" </span><span class="keyword">=&gt;&nbsp; </span><span class="string">'63'&nbsp; </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"ec" </span><span class="keyword">=&gt;&nbsp; </span><span class="string">'63'&nbsp; </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"ed" </span><span class="keyword">=&gt;&nbsp; </span><span class="string">'63'&nbsp; </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"ee" </span><span class="keyword">=&gt;&nbsp; </span><span class="string">'63'&nbsp; </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"ef" </span><span class="keyword">=&gt;&nbsp; </span><span class="string">'63'&nbsp; </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"f0" </span><span class="keyword">=&gt;&nbsp; </span><span class="string">'63'&nbsp; </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"f1" </span><span class="keyword">=&gt; </span><span class="string">'2406' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"f2" </span><span class="keyword">=&gt; </span><span class="string">'2407' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"f3" </span><span class="keyword">=&gt; </span><span class="string">'2408' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"f4" </span><span class="keyword">=&gt; </span><span class="string">'2409' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"f5" </span><span class="keyword">=&gt; </span><span class="string">'2410' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"f6" </span><span class="keyword">=&gt; </span><span class="string">'2411' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"f7" </span><span class="keyword">=&gt; </span><span class="string">'2412' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"f8" </span><span class="keyword">=&gt; </span><span class="string">'2413' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"f9" </span><span class="keyword">=&gt; </span><span class="string">'2414' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"fa" </span><span class="keyword">=&gt; </span><span class="string">'2415' </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"fb" </span><span class="keyword">=&gt;&nbsp; </span><span class="string">'63'&nbsp; </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"fc" </span><span class="keyword">=&gt;&nbsp; </span><span class="string">'63'&nbsp; </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"fd" </span><span class="keyword">=&gt;&nbsp; </span><span class="string">'63'&nbsp; </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"fe" </span><span class="keyword">=&gt;&nbsp; </span><span class="string">'63'&nbsp; </span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"ff" </span><span class="keyword">=&gt;&nbsp; </span><span class="string">'63'&nbsp; </span><span class="keyword">,);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; function </span><span class="default">code2utf</span><span class="keyword">(</span><span class="default">$num</span><span class="keyword">){<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">//Returns the utf string corresponding to the unicode value<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //courtesy - romans@void.lv<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">if(</span><span class="default">$num</span><span class="keyword">&lt;</span><span class="default">128</span><span class="keyword">)return </span><span class="default">chr</span><span class="keyword">(</span><span class="default">$num</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$num</span><span class="keyword">&lt;</span><span class="default">1024</span><span class="keyword">)return </span><span class="default">chr</span><span class="keyword">((</span><span class="default">$num</span><span class="keyword">&gt;&gt;</span><span class="default">6</span><span class="keyword">)+</span><span class="default">192</span><span class="keyword">).</span><span class="default">chr</span><span class="keyword">((</span><span class="default">$num</span><span class="keyword">&amp;</span><span class="default">63</span><span class="keyword">)+</span><span class="default">128</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$num</span><span class="keyword">&lt;</span><span class="default">32768</span><span class="keyword">)return </span><span class="default">chr</span><span class="keyword">((</span><span class="default">$num</span><span class="keyword">&gt;&gt;</span><span class="default">12</span><span class="keyword">)+</span><span class="default">224</span><span class="keyword">).</span><span class="default">chr</span><span class="keyword">(((</span><span class="default">$num</span><span class="keyword">&gt;&gt;</span><span class="default">6</span><span class="keyword">)&amp;</span><span class="default">63</span><span class="keyword">)+</span><span class="default">128</span><span class="keyword">).</span><span class="default">chr</span><span class="keyword">((</span><span class="default">$num</span><span class="keyword">&amp;</span><span class="default">63</span><span class="keyword">)+</span><span class="default">128</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$num</span><span class="keyword">&lt;</span><span class="default">2097152</span><span class="keyword">)return </span><span class="default">chr</span><span class="keyword">(</span><span class="default">$num</span><span class="keyword">&gt;&gt;</span><span class="default">18</span><span class="keyword">+</span><span class="default">240</span><span class="keyword">).</span><span class="default">chr</span><span class="keyword">(((</span><span class="default">$num</span><span class="keyword">&gt;&gt;</span><span class="default">12</span><span class="keyword">)&amp;</span><span class="default">63</span><span class="keyword">)+</span><span class="default">128</span><span class="keyword">).</span><span class="default">chr</span><span class="keyword">((</span><span class="default">$num</span><span class="keyword">&gt;&gt;</span><span class="default">6</span><span class="keyword">)&amp;</span><span class="default">63</span><span class="keyword">+</span><span class="default">128</span><span class="keyword">). </span><span class="default">chr</span><span class="keyword">(</span><span class="default">$num</span><span class="keyword">&amp;</span><span class="default">63</span><span class="keyword">+</span><span class="default">128</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="string">''</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; function </span><span class="default">convertstring</span><span class="keyword">(</span><span class="default">$iscii</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//Returs utf8 string equibalent of given iscii string<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$str </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for(</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$iscii</span><span class="keyword">); </span><span class="default">$i</span><span class="keyword">++) {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$c </span><span class="keyword">= </span><span class="default">dechex</span><span class="keyword">(</span><span class="default">ord</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$iscii</span><span class="keyword">,</span><span class="default">$i</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">)));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (isset(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">map</span><span class="keyword">[</span><span class="default">$c</span><span class="keyword">] )) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$s </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">code2utf</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">map</span><span class="keyword">[</span><span class="default">$c</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$str </span><span class="keyword">.= (</span><span class="default">$s </span><span class="keyword">== </span><span class="string">"?"</span><span class="keyword">)?</span><span class="string">""</span><span class="keyword">:</span><span class="default">$s</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$str </span><span class="keyword">.= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$iscii</span><span class="keyword">,</span><span class="default">$i</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$str</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="30845""></a>
  <div class="note">
   <strong class="user">rbotzer at yahoo dot com</strong>
   <a href="#30845" class="date">01-Apr-2003 10:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
BTW, the 21-bit range is pretty old news.&nbsp; Unicode 3.x uses a 31bit encoding scheme that allows for 2 billion characters.<br />
<br />
I'll post an enhanced encoder soon.&nbsp; In the meanwhile here's the current encoding scheme: <a href="http://www.cl.cam.ac.uk/~mgk25/unicode.html#utf-8" rel="nofollow" target="_blank">http://www.cl.cam.ac.uk/~mgk25/unicode.html#utf-8</a><br />
<br />
Ronen</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="30814""></a>
  <div class="note">
   <strong class="user">webmaster at swisswebgroup dot com</strong>
   <a href="#30814" class="date">31-Mar-2003 02:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
if you try to pass data to a flash movie with the<br />
actionscripts functions loadVars or sendAndLoad give this a try,<br />
if you have problems with special chars like &amp;auml; &amp;ouml; ....<br />
<br />
echo "&amp;data1=".urlencode(utf8_encode("???"))<br />
&nbsp;&nbsp;&nbsp; ."&amp;data2=".urlencode(utf8_encode("???"));<br />
<br />
greets<br />
<br />
js</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="25714""></a>
  <div class="note">
   <strong class="user">romans at void dot lv</strong>
   <a href="#25714" class="date">03-Oct-2002 03:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is optimized function which converts binary UTF symbol code into unicoded string.<br />
<br />
&nbsp;function code2utf($num){<br />
&nbsp; if($num&lt;128)return chr($num);<br />
&nbsp; if($num&lt;1024)return chr(($num&gt;&gt;6)+192).chr(($num&amp;63)+128);<br />
&nbsp; if($num&lt;32768)return chr(($num&gt;&gt;12)+224).chr((($num&gt;&gt;6)&amp;63)+128).chr(($num&amp;63)+128);<br />
&nbsp; if($num&lt;2097152)return chr($num&gt;&gt;18+240).chr((($num&gt;&gt;12)&amp;63)+128).chr(($num&gt;&gt;6)&amp;63+128). chr($num&amp;63+128);<br />
&nbsp; return '';<br />
&nbsp;}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="24791""></a>
  <div class="note">
   <strong class="user">dimitrisATccfDOTauthDOTgr</strong>
   <a href="#24791" class="date">28-Aug-2002 08:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To make utf8_encode and utf8_decode support other than iso-8859-1 encodings, you can easily define your encoding in the PHP source.<br />
In the file PHP_SOURCE/ext/xml/xml.c add the following code, for e.g. greek iso-8859-7:<br />
<br />
DEFINE TWO NEW FUNCTIONS UP TOP:<br />
inline static unsigned short xml_encode_iso_8859_7(unsigned char);<br />
inline static char xml_decode_iso_8859_7(unsigned short);<br />
<br />
AND THEN IMPLEMENT THEM BELOW:<br />
/* {{{ xml_encode_iso_8859_7() - Dimitris Daskopoulos 28/8/02 */<br />
/* map iso-8859-7 chars to Unicode chars */<br />
inline static unsigned short xml_encode_iso_8859_7(unsigned char c)<br />
{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (c &lt; 0x80) { /* low-ASCII, leave as is */<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return (unsigned short)c;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else { /* Greek character in high-ASCII */<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; /* map to UCS greek range (U+0310..03ff) */<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; /* assume that c &lt; 0xff */<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return (unsigned short)(c + 720);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
}<br />
/* }}} */<br />
<br />
/* {{{ xml_decode_iso_8859_7() - Dimitris Daskopoulos 28/8/02 */<br />
/* map Unicode chars to iso-8859-7 chars */<br />
inline static char xml_decode_iso_8859_7(unsigned short c)<br />
{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (c &lt; 0x100) { /* char in latin chart, leave as is */<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return (char)c;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else if (c &gt; 0x030f &amp;&amp; c &lt; 0x0400) { /* char in greek chart */<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; /* map back to ISO-8859-7 greek (high-ASCII) */<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return (char)(c - 720);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else { /* char not in latin or greek Unicode charts */<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; /* return question mark character */<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return (char)('?');<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
}<br />
/* }}} */<br />
<br />
These two work fine for greek iso-8859-7, but studying <a href="http://www.unicode.org/charts you" rel="nofollow" target="_blank">http://www.unicode.org/charts you</a><br />
can implement mappings between unicode and other iso-8859-x quite easily.<br />
<br />
In both functions (utf8_encode and utf8_decode), change the requested encoding to the one you prefer, e.g.<br />
<br />
encoded = xml_utf8_encode(Z_STRVAL_PP(arg), Z_STRLEN_PP(arg), &amp;len, "ISO-8859-7");<br />
<br />
decoded = xml_utf8_decode(Z_STRVAL_PP(arg), Z_STRLEN_PP(arg), &amp;len, "ISO-8859-7");<br />
<br />
Make sure you add the new encoding<br />
in the structure, by entering a new<br />
row with the official name (ISO-8859-7), and the names of the<br />
two functions you have just defined:<br />
xml_encoding xml_encodings[] = {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; { "ISO-8859-1", xml_decode_iso_8859_1, xml_encode_iso_8859_1 },<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; { "US-ASCII",&nbsp;&nbsp; xml_decode_us_ascii,&nbsp;&nbsp; xml_encode_us_ascii&nbsp;&nbsp; },<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; { "UTF-8",&nbsp; &nbsp; &nbsp; NULL,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; NULL&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; },<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; { "ISO-8859-7", xml_decode_iso_8859_7, xml_encode_iso_8859_7 },<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; { NULL,&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; NULL,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; NULL&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
};<br />
<br />
Finally, the following is probably not necessary, but I changed the default encoding (found in 2 spots in this file) to whatever encoding you prefer in your<br />
pages, e.g.:<br />
XML(default_encoding) = "ISO-8859-7";<br />
<br />
This solution is a little messy,<br />
since the utf8_encode function does not accept an argument for choosing the encoding method to use but hardwires the encoding method in the source code. Maybe PHP developers will provide this option in future releases. Until then, this is a quick and dirty solution that will work for<br />
localized PHP pages.<br />
<br />
Dimitris Daskopoulos</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="24741""></a>
  <div class="note">
   
   <a href="#24741" class="date">27-Aug-2002 08:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For XML generation, if you want non-ASCII ISO-8859-1 characters within text and attributes, you don't absolutely need UTF-8 encoding:<br />
<br />
The optional XML declaration can change the default encoding for characters from UTF-8 to ISO-8859-1:<br />
<br />
&lt;?xml version="1.0" encoding="iso-8859-1" ?&gt;<br />
<br />
This can save a lot of PHP code if you just want to generate ISO-8859-1 text and attribute values...<br />
<br />
XML specification requires that all parsers support both the UTF-8 encoding (by default), and the ISO-8859-1 character set. Other character sets may be supported also by specifying them in the encoding attribute of the leading XML declaration (but the target parser must support this character set to allow automatic conversion of the source text into Unicode character entities.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="23926""></a>
  <div class="note">
   <strong class="user">dutoit at NOSPAM dot abonder dot com</strong>
   <a href="#23926" class="date">01-Aug-2002 08:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To write an XML element $title containing "exotic" (eg. non ASCII ? &amp; ? ?...) 2 solutions I found :<br />
Fastest :<br />
$xml .= "&lt;title&gt;&lt;![CDATA[" . $title ."]]&gt;&lt;/title&gt;\n"<br />
<br />
or cleanest :<br />
$xml .= "&lt;title&gt;".utf8_encode(htmlspecialchars($title))."&lt;/title&gt;\n"<br />
<br />
After that, your xml can be parsed without errors.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="19857""></a>
  <div class="note">
   <strong class="user">lars(at)ioflux(dot)net</strong>
   <a href="#19857" class="date">13-Mar-2002 05:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This will also do the job for those who're interested:<br />
<br />
&lt;?<br />
<br />
function utf8toiso8859($string)<br />
{&nbsp; &nbsp; <br />
&nbsp; $returns = "";<br />
&nbsp; $UTF8len = array(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,<br />
1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,<br />
0, 0, 0, 0, 0, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 4, 4, 5, 6);<br />
&nbsp; $pos = 0;<br />
&nbsp; $antal = strlen($string);<br />
&nbsp; <br />
&nbsp; do<br />
&nbsp; { <br />
&nbsp;&nbsp;&nbsp; $c = ord($string[$pos]);<br />
&nbsp;&nbsp;&nbsp; $len = $UTF8len[($c &gt;&gt; 2) &amp; 0x3F];<br />
&nbsp;&nbsp;&nbsp; switch ($len) <br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; case 6: <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $u = $c &amp; 0x01; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp;&nbsp; case 5: <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $u = $c &amp; 0x03; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp;&nbsp; case 4: <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $u = $c &amp; 0x07; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp;&nbsp; case 3: <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $u = $c &amp; 0x0F; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp;&nbsp; case 2: <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $u = $c &amp; 0x1F; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp;&nbsp; case 1: <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $u = $c &amp; 0x7F; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp;&nbsp; case 0:&nbsp; /* unexpected start of a new character */<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $u = $c &amp; 0x3F; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $len = 5; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; while (--$len &amp;&amp; (++$pos &lt; $antal &amp;&amp; $c =<br />
ord($string[$pos])))<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (($c &amp; 0xC0) == 0x80) <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $u = ($u &lt;&lt; 6) | ($c &amp; 0x3F);<br />
&nbsp;&nbsp; &nbsp;&nbsp; else <br />
&nbsp;&nbsp; &nbsp;&nbsp; { /* unexpected start of a new character */<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $pos--;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if ($u &lt;= 0xFF) <br />
&nbsp;&nbsp; &nbsp;&nbsp; $returns .= chr($u);<br />
&nbsp;&nbsp;&nbsp; else <br />
&nbsp;&nbsp; &nbsp;&nbsp; $returns .= '?';<br />
&nbsp; } while (++$pos &lt; $antal);<br />
&nbsp; return $returns;<br />
} <br />
<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="19686""></a>
  <div class="note">
   <strong class="user">ronen at greyzone dot com</strong>
   <a href="#19686" class="date">07-Mar-2002 09:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The following function will utf-8 encode unicode entities &amp;#nnn(nn); with n={0..9}<br />
<br />
/**<br />
* takes a string of unicode entities and converts it to a utf-8 encoded string<br />
* each unicode entitiy has the form &amp;#nnn(nn); n={0..9} and can be displayed by utf-8 supporting<br />
* browsers.&nbsp; Ascii will not be modified.<br />
* @param $source string of unicode entities [STRING]<br />
* @return a utf-8 encoded string [STRING]<br />
* @access public<br />
*/<br />
function utf8Encode ($source) {<br />
&nbsp;&nbsp;&nbsp; $utf8Str = '';<br />
&nbsp;&nbsp;&nbsp; $entityArray = explode ("&amp;#", $source);<br />
&nbsp;&nbsp;&nbsp; $size = count ($entityArray);<br />
&nbsp;&nbsp;&nbsp; for ($i = 0; $i &lt; $size; $i++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $subStr = $entityArray[$i];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $nonEntity = strstr ($subStr, ';');<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ($nonEntity !== false) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $unicode = intval (substr ($subStr, 0, (strpos ($subStr, ';') + 1)));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // determine how many chars are needed to reprsent this unicode char<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($unicode &lt; 128) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $utf8Substring = chr ($unicode);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else if ($unicode &gt;= 128 &amp;&amp; $unicode &lt; 2048) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $binVal = str_pad (decbin ($unicode), 11, "0", STR_PAD_LEFT);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $binPart1 = substr ($binVal, 0, 5);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $binPart2 = substr ($binVal, 5);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $char1 = chr (192 + bindec ($binPart1));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $char2 = chr (128 + bindec ($binPart2));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $utf8Substring = $char1 . $char2;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else if ($unicode &gt;= 2048 &amp;&amp; $unicode &lt; 65536) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $binVal = str_pad (decbin ($unicode), 16, "0", STR_PAD_LEFT);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $binPart1 = substr ($binVal, 0, 4);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $binPart2 = substr ($binVal, 4, 6);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $binPart3 = substr ($binVal, 10);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $char1 = chr (224 + bindec ($binPart1));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $char2 = chr (128 + bindec ($binPart2));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $char3 = chr (128 + bindec ($binPart3));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $utf8Substring = $char1 . $char2 . $char3;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $binVal = str_pad (decbin ($unicode), 21, "0", STR_PAD_LEFT);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $binPart1 = substr ($binVal, 0, 3);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $binPart2 = substr ($binVal, 3, 6);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $binPart3 = substr ($binVal, 9, 6);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $binPart4 = substr ($binVal, 15);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $char1 = chr (240 + bindec ($binPart1));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $char2 = chr (128 + bindec ($binPart2));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $char3 = chr (128 + bindec ($binPart3));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $char4 = chr (128 + bindec ($binPart4));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $utf8Substring = $char1 . $char2 . $char3 . $char4;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (strlen ($nonEntity) &gt; 1)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $nonEntity = substr ($nonEntity, 1); // chop the first char (';')<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $nonEntity = '';<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $utf8Str .= $utf8Substring . $nonEntity;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $utf8Str .= $subStr;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; return $utf8Str;<br />
}<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
Ronen.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
