<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>安全模式</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="features.persistent-connections.html">? 数据库持久连接</a></li>
      <li style="float: right;"><a href="ini.sect.safe-mode.html">保安措施和安全模式 ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="features.html">特点</a></li>
    <li>安全模式</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="features.safe-mode" class="chapter">
 <h1>安全模式</h1>
<h2>Table of Contents</h2><ul class="chunklist chunklist_chapter"><li><a href="ini.sect.safe-mode.html">保安措施和安全模式</a></li><li><a href="features.safe-mode.functions.html">被安全模式限制或屏蔽的函数</a></li></ul>


 <p class="para">
  PHP 的安全模式是为了试图解决共享服务器（shared-server）安全问题而设立的。在结构上，试图在
  PHP 层上解决这个问题是不合理的，但修改 web
  服务器层和操作系统层显得非常不现实。因此许多人，特别是 ISP，目前使用安全模式。
 </p>

 <div class="warning"><strong class="warning">Warning</strong><p class="simpara">本特性已自
PHP 5.3.0 起<em class="emphasis">废弃</em>并将自 PHP 5.4.0
起<em class="emphasis">移除</em>。</p></div>
 
  <p class="para">
   <table class="doctable table">
    <caption><strong>Changelog for <em>safe mode</em></strong></caption>
    
     <thead>
      <tr>
       <th>版本</th>
       <th>说明</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
       <td>5.4.0</td>
       <td>
        Removed from PHP, and generates a fatal <strong><code>E_CORE_ERROR</code></strong>
        level error when enabled.
       </td>
      </tr>

      <tr>
       <td>5.3.0</td>
       <td>
        Deprecated, and <strong><code>E_DEPRECATED</code></strong> errors were added.
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>

 

 

</div>
<div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="69670""></a>
  <div class="note">
   
   <a href="#69670" class="date">14-Sep-2006 07:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Each IIS server in Windows runs as a User so it does have a UID file ACLs can be applied via a Group (GID) or User.&nbsp; The trick is to configure each website to run as a distinct user instead of the default of System.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="58344""></a>
  <div class="note">
   <strong class="user">martin at example dot com</strong>
   <a href="#58344" class="date">01-Nov-2005 01:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
On the note of php security <br />
<br />
have a look at: <a href="http://www.suphp.org/Home.html" rel="nofollow" target="_blank">http://www.suphp.org/Home.html</a><br />
<br />
&nbsp;suPHP is a tool for executing PHP scripts with the permissions of their owners. It consists of an Apache module (mod_suphp) and a setuid root binary (suphp) that is called by the Apache module to change the uid of the process executing the PHP interpreter.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="54858""></a>
  <div class="note">
   <strong class="user">jo at durchholz dot org</strong>
   <a href="#54858" class="date">18-Jul-2005 10:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that safe mode is largely useless. Most ISPs that offer Perl also offer other scripting languages (mostly Perl), and these other languages don't have the equivalent of PHP.<br />
In other words, if PHP's safe mode won't allow vandals into your web presence, they will simply use Perl.<br />
Also, safe mode prevents scripts from creating and using directories (because they will be owned by the WWW server, not by the user who uploaded the PHP script). So it's not only useless, it's also a hindrance.<br />
The only realistic option is to bugger the Apache folks until they run all scripts as the user who's responsible for a given virtualhost or directory.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="52495""></a>
  <div class="note">
   
   <a href="#52495" class="date">03-May-2005 06:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To separate distinct open_basedir use : instead of on , or ; on unix machines.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="52387""></a>
  <div class="note">
   <strong class="user">plyrvt at mail dot ru</strong>
   <a href="#52387" class="date">29-Apr-2005 12:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
[In reply to jedi at tstonramp dot com]<br />
Safe mode is used "since the alternatives at the web server and OS levels aren't very realistic". Manual says about UNIX OS level and UNIX web-servers by design (Apache). It's not realistic for unix-like server, but for NT (IIS) each virtual host can run from different user account, so there is no need in Safe Mode restrictions at all, if proper NTFS rights are set.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="45917""></a>
  <div class="note">
   <strong class="user">bertrand dot gorge at epistema dot com</strong>
   <a href="#45917" class="date">23-Sep-2004 02:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Beware that when in safe mode, mkdir creates folders with apache's UID, though the files you create in them are of your script's UID (usually the same as your FTP uid).<br />
<br />
What this means is that if you create a folder, you won't be able to remove it, nor to remove any of the files you've created in it (because those operations require the UID to be the same).<br />
<br />
Ideally mkdir should create the folder with the script's UID, but this has already been discussed and will not be fixed in the near future. <br />
<br />
In the meantime, I would advice NOT to user mkdir in safe mode, as you may end up with folders you can't remove/use.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="45263""></a>
  <div class="note">
   <strong class="user">Russ</strong>
   <a href="#45263" class="date">31-Aug-2004 05:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Sometimes you're stuck on a system you don't run and you can't control the setting of safe mode.&nbsp; If your script needs to run on different hosts (some with safe mode, some without it), you can code around it with something like:<br />
<br />
<span class="default">&lt;?php <br />
</span><span class="comment">// Check for safe mode<br />
</span><span class="keyword">if( </span><span class="default">ini_get</span><span class="keyword">(</span><span class="string">'safe_mode'</span><span class="keyword">) ){<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Do it the safe mode way<br />
</span><span class="keyword">}else{<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Do it the regular way<br />
</span><span class="keyword">}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="40870""></a>
  <div class="note">
   <strong class="user">daniel dot gaddis at tlc dot state dot tx dot us</strong>
   <a href="#40870" class="date">17-Mar-2004 08:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
on windows if multiple directories are wanted for safe_mode_exec_dir and open_basedir be sure to separate the paths with a semi colon and double quote the whole path string. For example:<br />
<br />
safe_mode = On<br />
safe_mode_exec_dir = "F:\WWW\HTML;F:\batfiles\batch"<br />
open_basedir = "F:\WWW\HTML;F:\batfiles\batch"</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="30151""></a>
  <div class="note">
   <strong class="user">info at phpcoding dot net</strong>
   <a href="#30151" class="date">08-Mar-2003 03:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
readfile() seems not always to take care of the safe_mode setting.<br />
When the file you want to read with readfile() resides in the same directory as the script itself, it doesn`t matter who the owner of the file is, readfile() will work.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="28867""></a>
  <div class="note">
   <strong class="user">gtg782a at mail dot gatech dot edu</strong>
   <a href="#28867" class="date">26-Jan-2003 06:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
zebz: The user would not be able to create a directory outside the namespace where he/she would be able to modify its contents. One can't create a directory that becomes apache-owned unless one owns the parent directory.<br />
<br />
Another security risk: since files created by apache are owned by apache, a user could call the fputs function and output PHP code to a newly-created file with a .php extension, thus creating an apache-owned PHP script on the server. Executing that apache-owned script would allow the script to work with files in the apache user's namespace, such as logs. A solution would be to force PHP-created files to be owned by the same owner/group as the script that created them. Using open_basedir would be a likely workaround to prevent ascension into uncontrolled areas.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="21085""></a>
  <div class="note">
   <strong class="user">zebz at ihaveenoughspam_hotmail dot com</strong>
   <a href="#21085" class="date">28-Apr-2002 05:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
All the filesystem-related functions (unlink, fopen, unlink, etc) seems to be restricted the same way in safe mode, at least on PHP 4.2. If the file UID is different *but* the directory (where the file is located) UID is the same, it will work.<br />
<br />
So creating a directory in safe mode is usually a bad idea since the UID will be different from the script (it will be the apache UID) so it won't be possible to do anything with the files created on this directory.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="18484""></a>
  <div class="note">
   <strong class="user">devik at cdi dot cz</strong>
   <a href="#18484" class="date">25-Jan-2002 01:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just to note, I created patch which allows VirtualHost to set User under which all (PHP too) runs. It is more secure than safe_mode. See luxik.cdi.cz/~devik/apache/ if you are interested</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="15399""></a>
  <div class="note">
   <strong class="user">jedi at tstonramp dot com</strong>
   <a href="#15399" class="date">08-Sep-2001 04:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Many filesystem-related functions are not appropriately restricted when Safe Mode is activated on an NT server it seems.&nbsp; I would assume that this is due to the filesystem not making use of UID.
<br />

<br />
In all of my scripts, no matter WHO owns the script (file Ownership-wise) or WHO owns the directory/file in question; both UIDs display
<br />

<br />
(getmyuid() and fileowner()) as UID = 0
<br />

<br />
This has the rather nasty side effect of Safe Mode allowing multiple filesystem operations because it believes the script owner and file/dir owner are one and the same.
<br />

<br />
While this can be worked around by the judicious application of proper filesystem privileges, it's still a "dud" that many of Safe Mode's securities are simply not there with an NT implementation.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
