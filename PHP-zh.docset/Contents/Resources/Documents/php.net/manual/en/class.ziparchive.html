<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>ZipArchive 类</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="zip.examples.html">? 范例</a></li>
      <li style="float: right;"><a href="ziparchive.addemptydir.html">ZipArchive::addEmptyDir ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="book.zip.html">Zip</a></li>
    <li>ZipArchive 类</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="class.ziparchive" class="reference">
 <h1 class="title"> <a href="class.ziparchive.html" class="classname">ZipArchive</a> 类</h1>
 
 
 <div class="partintro"><p class="verinfo">(PHP 5 &gt;= 5.2.0, PHP 7, PECL zip &gt;= 1.1.0)</p>
  
  
  <div class="section" id="ziparchive.intro">
   <h2 class="title">简介</h2>
   <p class="para">
    一个用 Zip 压缩的文件存档。
   </p>
  </div>
  
  
  <div class="section" id="ziparchive.synopsis">
   <h2 class="title">类摘要</h2>
   
   
   <div class="classsynopsis">
    <div class="ooclass"></div>
    
    
    <div class="classsynopsisinfo">
     <span class="ooclass">
      <strong class="classname">ZipArchive</strong>
     </span>
     {</div>
    
    <div class="classsynopsisinfo classsynopsisinfo_comment">/* 属性 */</div>
    
    
    <div class="classsynopsisinfo classsynopsisinfo_comment">/* 方法 */</div>
    <div class="methodsynopsis dc-description">
   <span class="type">bool</span> <span class="methodname"><a href="ziparchive.addemptydir.html" class="methodname">addEmptyDir</a></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$dirname</code></span>
   )</div>
<div class="methodsynopsis dc-description">
   <span class="type">bool</span> <span class="methodname"><a href="ziparchive.addfile.html" class="methodname">addFile</a></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$filename</code></span>
   [, <span class="methodparam"><span class="type">string</span> <code class="parameter">$localname</code><span class="initializer"> = <strong><code>NULL</code></strong></span></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$start</code><span class="initializer"> = 0</span></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$length</code><span class="initializer"> = 0</span></span>
  ]]] )</div>
<div class="methodsynopsis dc-description">
   <span class="type">bool</span> <span class="methodname"><a href="ziparchive.addfromstring.html" class="methodname">addFromString</a></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$localname</code></span>
   , <span class="methodparam"><span class="type">string</span> <code class="parameter">$contents</code></span>
   )</div>
<div class="methodsynopsis dc-description">
   <span class="type">bool</span> <span class="methodname"><a href="ziparchive.addglob.html" class="methodname">addGlob</a></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$pattern</code></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$flags</code><span class="initializer"> = 0</span></span>
   [, <span class="methodparam"><span class="type">array</span> <code class="parameter">$options</code><span class="initializer"> = array()</span></span>
  ]] )</div>
<div class="methodsynopsis dc-description">
   <span class="type">bool</span> <span class="methodname"><a href="ziparchive.addpattern.html" class="methodname">addPattern</a></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$pattern</code></span>
   [, <span class="methodparam"><span class="type">string</span> <code class="parameter">$path</code><span class="initializer"> = &quot;.&quot;</span></span>
   [, <span class="methodparam"><span class="type">array</span> <code class="parameter">$options</code><span class="initializer"> = array()</span></span>
  ]] )</div>
<div class="methodsynopsis dc-description">
   <span class="type">bool</span> <span class="methodname"><a href="ziparchive.close.html" class="methodname">close</a></span>
    ( <span class="methodparam">void</span>
   )</div>
<div class="methodsynopsis dc-description">
   <span class="type">bool</span> <span class="methodname"><a href="ziparchive.deleteindex.html" class="methodname">deleteIndex</a></span>
    ( <span class="methodparam"><span class="type">int</span> <code class="parameter">$index</code></span>
   )</div>
<div class="methodsynopsis dc-description">
   <span class="type">bool</span> <span class="methodname"><a href="ziparchive.deletename.html" class="methodname">deleteName</a></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$name</code></span>
   )</div>
<div class="methodsynopsis dc-description">
   <span class="type">bool</span> <span class="methodname"><a href="ziparchive.extractto.html" class="methodname">extractTo</a></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$destination</code></span>
   [, <span class="methodparam"><span class="type"><a href="language.pseudo-types.html#language.types.mixed" class="type mixed">mixed</a></span> <code class="parameter">$entries</code></span>
  ] )</div>
<div class="methodsynopsis dc-description">
   <span class="type">string</span> <span class="methodname"><a href="ziparchive.getarchivecomment.html" class="methodname">getArchiveComment</a></span>
    ([ <span class="methodparam"><span class="type">int</span> <code class="parameter">$flags</code></span>
  ] )</div>
<div class="methodsynopsis dc-description">
   <span class="type">string</span> <span class="methodname"><a href="ziparchive.getcommentindex.html" class="methodname">getCommentIndex</a></span>
    ( <span class="methodparam"><span class="type">int</span> <code class="parameter">$index</code></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$flags</code></span>
  ] )</div>
<div class="methodsynopsis dc-description">
   <span class="type">string</span> <span class="methodname"><a href="ziparchive.getcommentname.html" class="methodname">getCommentName</a></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$name</code></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$flags</code></span>
  ] )</div>
<div class="methodsynopsis dc-description">
   <span class="type">bool</span> 
   <span class="methodname"><a href="ziparchive.getexternalattributesindex.html" class="methodname">GetExternalAttributesIndex</a></span>
    ( <span class="methodparam"><span class="type">int</span> <code class="parameter">$index</code></span>
   , <span class="methodparam"><span class="type">int</span> <code class="parameter reference">&$opsys</code></span>
   , <span class="methodparam"><span class="type">int</span> <code class="parameter reference">&$attr</code></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$flags</code></span>
  ] )</div>
<div class="methodsynopsis dc-description">
   <span class="type">bool</span> 
   <span class="methodname"><a href="ziparchive.getexternalattributesname.html" class="methodname">getExternalAttributesName</a></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$name</code></span>
   , <span class="methodparam"><span class="type">int</span> <code class="parameter reference">&$opsys</code></span>
   , <span class="methodparam"><span class="type">int</span> <code class="parameter reference">&$attr</code></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$flags</code></span>
  ] )</div>
<div class="methodsynopsis dc-description">
   <span class="type">string</span> <span class="methodname"><a href="ziparchive.getfromindex.html" class="methodname">getFromIndex</a></span>
    ( <span class="methodparam"><span class="type">int</span> <code class="parameter">$index</code></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$length</code><span class="initializer"> = 0</span></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$flags</code></span>
  ]] )</div>
<div class="methodsynopsis dc-description">
   <span class="type">string</span> <span class="methodname"><a href="ziparchive.getfromname.html" class="methodname">getFromName</a></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$name</code></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$length</code><span class="initializer"> = 0</span></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$flags</code></span>
  ]] )</div>
<div class="methodsynopsis dc-description">
   <span class="type">string</span> <span class="methodname"><a href="ziparchive.getnameindex.html" class="methodname">getNameIndex</a></span>
    ( <span class="methodparam"><span class="type">int</span> <code class="parameter">$index</code></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$flags</code></span>
  ] )</div>
<div class="methodsynopsis dc-description">
   <span class="type">string</span> <span class="methodname"><a href="ziparchive.getstatusstring.html" class="methodname">getStatusString</a></span>
    ( <span class="methodparam">void</span>
   )</div>
<div class="methodsynopsis dc-description">
   <span class="type">resource</span> <span class="methodname"><a href="ziparchive.getstream.html" class="methodname">getStream</a></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$name</code></span>
   )</div>
<div class="methodsynopsis dc-description">
   <span class="type">int</span> <span class="methodname"><a href="ziparchive.locatename.html" class="methodname">locateName</a></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$name</code></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$flags</code></span>
  ] )</div>
<div class="methodsynopsis dc-description">
   <span class="type">mixed</span> <span class="methodname"><a href="ziparchive.open.html" class="methodname">open</a></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$filename</code></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$flags</code></span>
  ] )</div>
<div class="methodsynopsis dc-description">
   <span class="type">bool</span> <span class="methodname"><a href="ziparchive.renameindex.html" class="methodname">renameIndex</a></span>
    ( <span class="methodparam"><span class="type">int</span> <code class="parameter">$index</code></span>
   , <span class="methodparam"><span class="type">string</span> <code class="parameter">$newname</code></span>
   )</div>
<div class="methodsynopsis dc-description">
   <span class="type">bool</span> <span class="methodname"><a href="ziparchive.renamename.html" class="methodname">renameName</a></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$name</code></span>
   , <span class="methodparam"><span class="type">string</span> <code class="parameter">$newname</code></span>
   )</div>
<div class="methodsynopsis dc-description">
   <span class="type">bool</span> <span class="methodname"><a href="ziparchive.setarchivecomment.html" class="methodname">setArchiveComment</a></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$comment</code></span>
   )</div>
<div class="methodsynopsis dc-description">
   <span class="type">bool</span> <span class="methodname"><a href="ziparchive.setcommentindex.html" class="methodname">setCommentIndex</a></span>
    ( <span class="methodparam"><span class="type">int</span> <code class="parameter">$index</code></span>
   , <span class="methodparam"><span class="type">string</span> <code class="parameter">$comment</code></span>
   )</div>
<div class="methodsynopsis dc-description">
   <span class="type">bool</span> <span class="methodname"><a href="ziparchive.setcommentname.html" class="methodname">setCommentName</a></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$name</code></span>
   , <span class="methodparam"><span class="type">string</span> <code class="parameter">$comment</code></span>
   )</div>
<div class="methodsynopsis dc-description">
   <span class="type">bool</span> <span class="methodname"><a href="ziparchive.setcompressionindex.html" class="methodname">setCompressionIndex</a></span>
    ( <span class="methodparam"><span class="type">int</span> <code class="parameter">$index</code></span>
   , <span class="methodparam"><span class="type">int</span> <code class="parameter">$comp_method</code></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$comp_flags</code><span class="initializer"> = 0</span></span>
  ] )</div>
<div class="methodsynopsis dc-description">
   <span class="type">bool</span> <span class="methodname"><a href="ziparchive.setcompressionname.html" class="methodname">setCompressionName</a></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$name</code></span>
   , <span class="methodparam"><span class="type">int</span> <code class="parameter">$comp_method</code></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$comp_flags</code><span class="initializer"> = 0</span></span>
  ] )</div>
<div class="methodsynopsis dc-description">
   <span class="type">bool</span> 
   <span class="methodname"><a href="ziparchive.setexternalattributesindex.html" class="methodname">setExternalAttributesIndex</a></span>
    ( <span class="methodparam"><span class="type">int</span> <code class="parameter">$index</code></span>
   , <span class="methodparam"><span class="type">int</span> <code class="parameter">$opsys</code></span>
   , <span class="methodparam"><span class="type">int</span> <code class="parameter">$attr</code></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$flags</code></span>
  ] )</div>
<div class="methodsynopsis dc-description">
   <span class="type">bool</span> 
   <span class="methodname"><a href="ziparchive.setexternalattributesname.html" class="methodname">setExternalAttributesName</a></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$name</code></span>
   , <span class="methodparam"><span class="type">int</span> <code class="parameter">$opsys</code></span>
   , <span class="methodparam"><span class="type">int</span> <code class="parameter">$attr</code></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$flags</code></span>
  ] )</div>
<div class="methodsynopsis dc-description">
   <span class="modifier">public</span> <span class="type">bool</span> <span class="methodname"><a href="ziparchive.setpassword.html" class="methodname">setPassword</a></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$password</code></span>
   )</div>
<div class="methodsynopsis dc-description">
   <span class="type">array</span> <span class="methodname"><a href="ziparchive.statindex.html" class="methodname">statIndex</a></span>
    ( <span class="methodparam"><span class="type">int</span> <code class="parameter">$index</code></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$flags</code></span>
  ] )</div>
<div class="methodsynopsis dc-description">
   <span class="type">array</span> <span class="methodname"><a href="ziparchive.statname.html" class="methodname">statName</a></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$name</code></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$flags</code></span>
  ] )</div>
<div class="methodsynopsis dc-description">
   <span class="type">bool</span> <span class="methodname"><a href="ziparchive.unchangeall.html" class="methodname">unchangeAll</a></span>
    ( <span class="methodparam">void</span>
   )</div>
<div class="methodsynopsis dc-description">
   <span class="type">bool</span> <span class="methodname"><a href="ziparchive.unchangearchive.html" class="methodname">unchangeArchive</a></span>
    ( <span class="methodparam">void</span>
   )</div>
<div class="methodsynopsis dc-description">
   <span class="type">bool</span> <span class="methodname"><a href="ziparchive.unchangeindex.html" class="methodname">unchangeIndex</a></span>
    ( <span class="methodparam"><span class="type">int</span> <code class="parameter">$index</code></span>
   )</div>
<div class="methodsynopsis dc-description">
   <span class="type">bool</span> <span class="methodname"><a href="ziparchive.unchangename.html" class="methodname">unchangeName</a></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$name</code></span>
   )</div>

    
   }</div>
   
   
  </div>
  
  
  <div class="section" id="ziparchive.props">
   <h2 class="title">属性</h2>
   <dl>

    
     <dt id="ziparchive.props.status"><var class="varname"><var class="varname">status</var></var></dt>

     <dd>

      <p class="para"> Zip Archive 的状态</p>
     </dd>

    
    
     <dt id="ziparchive.props.statussys"><var class="varname"><var class="varname">statusSys</var></var></dt>

     <dd>

      <p class="para">Zip Archive 的系统状态</p>
     </dd>

    
    
     <dt id="ziparchive.props.numfiles"><var class="varname"><var class="varname">numFiles</var></var></dt>

     <dd>

      <p class="para">压缩包里的文件数</p>
     </dd>

    
    
     <dt id="ziparchive.props.filename"><var class="varname"><var class="varname">filename</var></var></dt>

     <dd>

      <p class="para">在文件系统里的文件名</p>
     </dd>

    
    
     <dt id="ziparchive.props.comment"><var class="varname"><var class="varname">comment</var></var></dt>

     <dd>

      <p class="para">压缩包的注释</p>
     </dd>

    
   </dl>

  </div>
  
 </div>
 
 
 






























































































































































































































 
<h2>Table of Contents</h2><ul class="chunklist chunklist_reference"><li><a href="ziparchive.addemptydir.html">ZipArchive::addEmptyDir</a> &mdash; Add a new directory</li><li><a href="ziparchive.addfile.html">ZipArchive::addFile</a> &mdash; Adds a file to a ZIP archive from the given path</li><li><a href="ziparchive.addfromstring.html">ZipArchive::addFromString</a> &mdash; Add a file to a ZIP archive using its contents</li><li><a href="ziparchive.addglob.html">ZipArchive::addGlob</a> &mdash; Add files from a directory by glob pattern</li><li><a href="ziparchive.addpattern.html">ZipArchive::addPattern</a> &mdash; Add files from a directory by PCRE pattern</li><li><a href="ziparchive.close.html">ZipArchive::close</a> &mdash; Close the active archive (opened or newly created)</li><li><a href="ziparchive.deleteindex.html">ZipArchive::deleteIndex</a> &mdash; delete an entry in the archive using its index</li><li><a href="ziparchive.deletename.html">ZipArchive::deleteName</a> &mdash; delete an entry in the archive using its name</li><li><a href="ziparchive.extractto.html">ZipArchive::extractTo</a> &mdash; Extract the archive contents</li><li><a href="ziparchive.getarchivecomment.html">ZipArchive::getArchiveComment</a> &mdash; Returns the Zip archive comment</li><li><a href="ziparchive.getcommentindex.html">ZipArchive::getCommentIndex</a> &mdash; Returns the comment of an entry using the entry index</li><li><a href="ziparchive.getcommentname.html">ZipArchive::getCommentName</a> &mdash; Returns the comment of an entry using the entry name</li><li><a href="ziparchive.getexternalattributesindex.html">ZipArchive::getExternalAttributesIndex</a> &mdash; Retrieve the external attributes of an entry defined by its index</li><li><a href="ziparchive.getexternalattributesname.html">ZipArchive::getExternalAttributesName</a> &mdash; Retrieve the external attributes of an entry defined by its name</li><li><a href="ziparchive.getfromindex.html">ZipArchive::getFromIndex</a> &mdash; Returns the entry contents using its index</li><li><a href="ziparchive.getfromname.html">ZipArchive::getFromName</a> &mdash; Returns the entry contents using its name</li><li><a href="ziparchive.getnameindex.html">ZipArchive::getNameIndex</a> &mdash; Returns the name of an entry using its index</li><li><a href="ziparchive.getstatusstring.html">ZipArchive::getStatusString</a> &mdash; Returns the status error message, system and/or zip messages</li><li><a href="ziparchive.getstream.html">ZipArchive::getStream</a> &mdash; Get a file handler to the entry defined by its name (read only).</li><li><a href="ziparchive.locatename.html">ZipArchive::locateName</a> &mdash; Returns the index of the entry in the archive</li><li><a href="ziparchive.open.html">ZipArchive::open</a> &mdash; Open a ZIP file archive</li><li><a href="ziparchive.renameindex.html">ZipArchive::renameIndex</a> &mdash; Renames an entry defined by its index</li><li><a href="ziparchive.renamename.html">ZipArchive::renameName</a> &mdash; Renames an entry defined by its name</li><li><a href="ziparchive.setarchivecomment.html">ZipArchive::setArchiveComment</a> &mdash; Set the comment of a ZIP archive</li><li><a href="ziparchive.setcommentindex.html">ZipArchive::setCommentIndex</a> &mdash; Set the comment of an entry defined by its index</li><li><a href="ziparchive.setcommentname.html">ZipArchive::setCommentName</a> &mdash; Set the comment of an entry defined by its name</li><li><a href="ziparchive.setcompressionindex.html">ZipArchive::setCompressionIndex</a> &mdash; Set the compression method of an entry defined by its index</li><li><a href="ziparchive.setcompressionname.html">ZipArchive::setCompressionName</a> &mdash; Set the compression method of an entry defined by its name</li><li><a href="ziparchive.setexternalattributesindex.html">ZipArchive::setExternalAttributesIndex</a> &mdash; Set the external attributes of an entry defined by its index</li><li><a href="ziparchive.setexternalattributesname.html">ZipArchive::setExternalAttributesName</a> &mdash; Set the external attributes of an entry defined by its name</li><li><a href="ziparchive.setpassword.html">ZipArchive::setPassword</a> &mdash; Set the password for the active archive</li><li><a href="ziparchive.statindex.html">ZipArchive::statIndex</a> &mdash; Get the details of an entry defined by its index.</li><li><a href="ziparchive.statname.html">ZipArchive::statName</a> &mdash; Get the details of an entry defined by its name.</li><li><a href="ziparchive.unchangeall.html">ZipArchive::unchangeAll</a> &mdash; Undo all changes done in the archive</li><li><a href="ziparchive.unchangearchive.html">ZipArchive::unchangeArchive</a> &mdash; Revert all global changes done in the archive.</li><li><a href="ziparchive.unchangeindex.html">ZipArchive::unchangeIndex</a> &mdash; Revert all changes done to an entry at the given index</li><li><a href="ziparchive.unchangename.html">ZipArchive::unchangeName</a> &mdash; Revert all changes done to an entry with the given name.</li></ul>
</div>
<div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="118392""></a>
  <div class="note">
   <strong class="user">ohcc at 163 dot com</strong>
   <a href="#118392" class="date">29-Nov-2015 03:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
With PHP 5.6+, you may come up with theses errors.<br />
<br />
Warning: Unknown: Cannot destroy the zip context in Unknown on line 0<br />
<br />
Warning: ZipArchive::close(): Can't remove file: No such file or directory in xxxx.php on line xx<br />
<br />
Examples<br />
<br />
Warning: Unknown: Cannot destroy the zip context in Unknown on line 0<br />
<br />
<span class="default">&lt;?php&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; $za </span><span class="keyword">= new </span><span class="default">ZipArchive</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$za</span><span class="keyword">-&gt;</span><span class="default">open</span><span class="keyword">(</span><span class="string">'51-n.com.zip'</span><span class="keyword">,</span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">CREATE</span><span class="keyword">|</span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">OVERWRITE</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Warning: ZipArchive::close(): Can't remove file: No such file or directory in xxxx.php on line xx<br />
<br />
<span class="default">&lt;?php&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; $za </span><span class="keyword">= new </span><span class="default">ZipArchive</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$za</span><span class="keyword">-&gt;</span><span class="default">open</span><span class="keyword">(</span><span class="string">'51-n.com.zip'</span><span class="keyword">,</span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">CREATE</span><span class="keyword">|</span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">OVERWRITE</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$za</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();<br />
</span><span class="default">?&gt;<br />
</span><br />
It happens when the zip archive is empty.<br />
Your zip archive will not be saved on disk unless it has at least one file. What's more, when ZipArchive::OVERWRITE is applied, if there exists a file with the same name, it will be removed after ZipArchive::open() is called.<br />
<br />
So, don't forget to put at least one file to your zip archive.<br />
<br />
<span class="default">&lt;?php&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; $za </span><span class="keyword">= new </span><span class="default">ZipArchive</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$za</span><span class="keyword">-&gt;</span><span class="default">open</span><span class="keyword">(</span><span class="string">'51-n.com.zip'</span><span class="keyword">,</span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">CREATE</span><span class="keyword">|</span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">OVERWRITE</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$za</span><span class="keyword">-&gt;</span><span class="default">addFromString</span><span class="keyword">(</span><span class="string">'wuxiancheng.cn.txt'</span><span class="keyword">,</span><span class="string">'yes'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$za</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="118272""></a>
  <div class="note">
   <strong class="user">ohcc at 163 dot com</strong>
   <a href="#118272" class="date">07-Nov-2015 05:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//use bzip2 + ZipArchive to reduce file size of your zip archives.<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$zip </span><span class="keyword">= new </span><span class="default">ZipArchive</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">open</span><span class="keyword">(</span><span class="string">'i.zip'</span><span class="keyword">,</span><span class="default">ZIPARCHIVE</span><span class="keyword">::</span><span class="default">CREATE</span><span class="keyword">|</span><span class="default">ZIPARCHIVE</span><span class="keyword">::</span><span class="default">OVERWRITE</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$file</span><span class="keyword">=</span><span class="string">'wuxiancheng.cn.sql'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$bzFilename </span><span class="keyword">= </span><span class="default">$file</span><span class="keyword">.</span><span class="string">'.bz2'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$sql </span><span class="keyword">= </span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$sql </span><span class="keyword">= </span><span class="default">bzcompress</span><span class="keyword">(</span><span class="default">$sql</span><span class="keyword">,</span><span class="default">9</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">addFromString</span><span class="keyword">(</span><span class="default">$bzFilename</span><span class="keyword">,</span><span class="default">$sql</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">setArchiveComment</span><span class="keyword">(</span><span class="string">'zipped on '</span><span class="keyword">.</span><span class="default">date</span><span class="keyword">(</span><span class="string">'Y-M-d'</span><span class="keyword">));<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="116937""></a>
  <div class="note">
   <strong class="user">nick at fullfatthings dot com</strong>
   <a href="#116937" class="date">24-Mar-2015 11:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There is a limit withing PHP 5.3.3 (which seems to have been addressed in later versions; 5.3.29 seems ok on a different server).<br />
<br />
If you try to open a zip file with more than 65,535 files in it (in my case it had 237,942 files) then you cannot access the later files. The numFiles property only reports the first 65k files.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="116345""></a>
  <div class="note">
   <strong class="user">ebestwebmaster at gmail dot com</strong>
   <a href="#116345" class="date">16-Dec-2014 08:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A way of zipping files and downloading them thereafter:<br />
<span class="default">&lt;?php<br />
<br />
&nbsp;$files </span><span class="keyword">= array(</span><span class="string">'image.jpeg'</span><span class="keyword">,</span><span class="string">'text.txt'</span><span class="keyword">,</span><span class="string">'music.wav'</span><span class="keyword">);<br />
</span><span class="default">$zipname </span><span class="keyword">= </span><span class="string">'enter_any_name_for_the_zipped_file.zip'</span><span class="keyword">;<br />
</span><span class="default">$zip </span><span class="keyword">= new </span><span class="default">ZipArchive</span><span class="keyword">;<br />
</span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">open</span><span class="keyword">(</span><span class="default">$zipname</span><span class="keyword">, </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">CREATE</span><span class="keyword">);<br />
foreach (</span><span class="default">$files </span><span class="keyword">as </span><span class="default">$file</span><span class="keyword">) {<br />
&nbsp; </span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">addFile</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);<br />
}<br />
</span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();<br />
<br />
</span><span class="comment">///Then download the zipped file.<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-Type: application/zip'</span><span class="keyword">);<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-disposition: attachment; filename='</span><span class="keyword">.</span><span class="default">$zipname</span><span class="keyword">);<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-Length: ' </span><span class="keyword">. </span><span class="default">filesize</span><span class="keyword">(</span><span class="default">$zipname</span><span class="keyword">));<br />
</span><span class="default">readfile</span><span class="keyword">(</span><span class="default">$zipname</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="114158""></a>
  <div class="note">
   <strong class="user">piotr dot stop dot spam at gmail dot com</strong>
   <a href="#114158" class="date">18-Jan-2014 01:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You can check general purpose flag to test if the zip file is encrypted. Example function below.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">/**<br />
&nbsp;* Check if the file is encrypted<br />
&nbsp;* <br />
&nbsp;* Notice: if file doesn't exists or cannot be opened, function<br />
&nbsp;* also return false.<br />
&nbsp;* <br />
&nbsp;* @param string $pathToArchive<br />
&nbsp;* @return boolean return true if file is encrypted<br />
&nbsp;*/<br />
</span><span class="keyword">function </span><span class="default">isEncryptedZip</span><span class="keyword">( </span><span class="default">$pathToArchive </span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fp </span><span class="keyword">= @</span><span class="default">fopen</span><span class="keyword">( </span><span class="default">$pathToArchive</span><span class="keyword">, </span><span class="string">'r' </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$encrypted </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if ( </span><span class="default">$fp </span><span class="keyword">&amp;&amp; </span><span class="default">fseek</span><span class="keyword">( </span><span class="default">$fp</span><span class="keyword">, </span><span class="default">6 </span><span class="keyword">) == </span><span class="default">0 </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$string </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">( </span><span class="default">$fp</span><span class="keyword">, </span><span class="default">2 </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( </span><span class="default">false </span><span class="keyword">!== </span><span class="default">$string </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">unpack</span><span class="keyword">(</span><span class="string">"vgeneral"</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$encrypted </span><span class="keyword">= </span><span class="default">$data</span><span class="keyword">[ </span><span class="string">'general' </span><span class="keyword">] &amp; </span><span class="default">0x01 </span><span class="keyword">? </span><span class="default">true </span><span class="keyword">: </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">( </span><span class="default">$fp </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$encrypted</span><span class="keyword">;<br />
}</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="112195""></a>
  <div class="note">
   <strong class="user">AshleyDambra at live dot com</strong>
   <a href="#112195" class="date">16-May-2013 05:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Simple class xZip to zip big folders into multiple parts and unzip multi zip files at once.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">xZip </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__construct</span><span class="keyword">() {}<br />
&nbsp;&nbsp;&nbsp; private function </span><span class="default">_rglobRead</span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">, &amp;</span><span class="default">$array </span><span class="keyword">= array()) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">$source </span><span class="keyword">|| </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">) == </span><span class="string">""</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$source </span><span class="keyword">= </span><span class="string">"."</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach ((array) </span><span class="default">glob</span><span class="keyword">(</span><span class="default">$source </span><span class="keyword">. </span><span class="string">"/*/"</span><span class="keyword">) as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_rglobRead</span><span class="keyword">(</span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"//"</span><span class="keyword">, </span><span class="string">"/"</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">), </span><span class="default">$array</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach ((array) </span><span class="default">glob</span><span class="keyword">(</span><span class="default">$source </span><span class="keyword">. </span><span class="string">"*.*"</span><span class="keyword">) as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$array</span><span class="keyword">[] = </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"//"</span><span class="keyword">, </span><span class="string">"/"</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; private function </span><span class="default">_zip</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">, </span><span class="default">$part</span><span class="keyword">, </span><span class="default">$destination</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$zip </span><span class="keyword">= new </span><span class="default">ZipArchive</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; @</span><span class="default">mkdir</span><span class="keyword">(</span><span class="default">$destination</span><span class="keyword">, </span><span class="default">0777</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">open</span><span class="keyword">(</span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"//"</span><span class="keyword">, </span><span class="string">"/"</span><span class="keyword">, </span><span class="string">"</span><span class="keyword">{</span><span class="default">$destination</span><span class="keyword">}</span><span class="string">/partz</span><span class="keyword">{</span><span class="default">$part</span><span class="keyword">}</span><span class="string">.zip"</span><span class="keyword">), </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">CREATE</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach ((array) </span><span class="default">$array </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">addFile</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">, </span><span class="default">str_replace</span><span class="keyword">(array(</span><span class="string">"../"</span><span class="keyword">, </span><span class="string">"./"</span><span class="keyword">), </span><span class="default">NULL</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">zip</span><span class="keyword">(</span><span class="default">$limit </span><span class="keyword">= </span><span class="default">500</span><span class="keyword">, </span><span class="default">$source </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">, </span><span class="default">$destination </span><span class="keyword">= </span><span class="string">"./"</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">$destination </span><span class="keyword">|| </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$destination</span><span class="keyword">) == </span><span class="string">""</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$destination </span><span class="keyword">= </span><span class="string">"./"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_rglobRead</span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">, </span><span class="default">$input</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$maxinput </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$splitinto </span><span class="keyword">= ((</span><span class="default">$maxinput </span><span class="keyword">/ </span><span class="default">$limit</span><span class="keyword">) &gt; </span><span class="default">round</span><span class="keyword">(</span><span class="default">$maxinput </span><span class="keyword">/ </span><span class="default">$limit</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">)) ? </span><span class="default">round</span><span class="keyword">(</span><span class="default">$maxinput </span><span class="keyword">/ </span><span class="default">$limit</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">) + </span><span class="default">1 </span><span class="keyword">: </span><span class="default">round</span><span class="keyword">(</span><span class="default">$maxinput </span><span class="keyword">/ </span><span class="default">$limit</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for(</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$splitinto</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_zip</span><span class="keyword">(</span><span class="default">array_slice</span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">, (</span><span class="default">$i </span><span class="keyword">* </span><span class="default">$limit</span><span class="keyword">), </span><span class="default">$limit</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">), </span><span class="default">$i</span><span class="keyword">, </span><span class="default">$destination</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; unset(</span><span class="default">$input</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">unzip</span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">, </span><span class="default">$destination</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; @</span><span class="default">mkdir</span><span class="keyword">(</span><span class="default">$destination</span><span class="keyword">, </span><span class="default">0777</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach ((array) </span><span class="default">glob</span><span class="keyword">(</span><span class="default">$source </span><span class="keyword">. </span><span class="string">"/*.zip"</span><span class="keyword">) as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$zip </span><span class="keyword">= new </span><span class="default">ZipArchive</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">open</span><span class="keyword">(</span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"//"</span><span class="keyword">, </span><span class="string">"/"</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">)) === </span><span class="default">true</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">extractTo</span><span class="keyword">(</span><span class="default">$destination</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__destruct</span><span class="keyword">() {}<br />
}<br />
<br />
</span><span class="comment">//$zip = new xZip;<br />
//$zip-&gt;zip(500, "images/", "images_zip/");<br />
//$zip-&gt;unzip("images_zip/", "images/");<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="110719""></a>
  <div class="note">
   <strong class="user">umbalaconmeogia at NOSPAM dot gmail dot com</strong>
   <a href="#110719" class="date">28-Nov-2012 12:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Zip a folder (include itself).
<br />
Usage:
<br />
&nbsp; HZip::zipDir('/path/to/sourceDir', '/path/to/out.zip');
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">class </span><span class="default">HZip
<br />
</span><span class="keyword">{
<br />
&nbsp; </span><span class="comment">/**
<br />
&nbsp;&nbsp; * Add files and sub-directories in a folder to zip file.
<br />
&nbsp;&nbsp; * @param string $folder
<br />
&nbsp;&nbsp; * @param ZipArchive $zipFile
<br />
&nbsp;&nbsp; * @param int $exclusiveLength Number of text to be exclusived from the file path.
<br />
&nbsp;&nbsp; */
<br />
&nbsp; </span><span class="keyword">private static function </span><span class="default">folderToZip</span><span class="keyword">(</span><span class="default">$folder</span><span class="keyword">, &amp;</span><span class="default">$zipFile</span><span class="keyword">, </span><span class="default">$exclusiveLength</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$handle </span><span class="keyword">= </span><span class="default">opendir</span><span class="keyword">(</span><span class="default">$folder</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; while (</span><span class="default">false </span><span class="keyword">!== </span><span class="default">$f </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (</span><span class="default">$f </span><span class="keyword">!= </span><span class="string">'.' </span><span class="keyword">&amp;&amp; </span><span class="default">$f </span><span class="keyword">!= </span><span class="string">'..'</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$filePath </span><span class="keyword">= </span><span class="string">"</span><span class="default">$folder</span><span class="string">/</span><span class="default">$f</span><span class="string">"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Remove prefix from file path before add to zip.
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$localPath </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$filePath</span><span class="keyword">, </span><span class="default">$exclusiveLength</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_file</span><span class="keyword">(</span><span class="default">$filePath</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$zipFile</span><span class="keyword">-&gt;</span><span class="default">addFile</span><span class="keyword">(</span><span class="default">$filePath</span><span class="keyword">, </span><span class="default">$localPath</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } elseif (</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$filePath</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Add sub-directory.
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$zipFile</span><span class="keyword">-&gt;</span><span class="default">addEmptyDir</span><span class="keyword">(</span><span class="default">$localPath</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">folderToZip</span><span class="keyword">(</span><span class="default">$filePath</span><span class="keyword">, </span><span class="default">$zipFile</span><span class="keyword">, </span><span class="default">$exclusiveLength</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">closedir</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">);
<br />
&nbsp; }
<br />

<br />
&nbsp; </span><span class="comment">/**
<br />
&nbsp;&nbsp; * Zip a folder (include itself).
<br />
&nbsp;&nbsp; * Usage:
<br />
&nbsp;&nbsp; *&nbsp;&nbsp; HZip::zipDir('/path/to/sourceDir', '/path/to/out.zip');
<br />
&nbsp;&nbsp; *
<br />
&nbsp;&nbsp; * @param string $sourcePath Path of directory to be zip.
<br />
&nbsp;&nbsp; * @param string $outZipPath Path of output zip file.
<br />
&nbsp;&nbsp; */
<br />
&nbsp; </span><span class="keyword">public static function </span><span class="default">zipDir</span><span class="keyword">(</span><span class="default">$sourcePath</span><span class="keyword">, </span><span class="default">$outZipPath</span><span class="keyword">)
<br />
&nbsp; {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$pathInfo </span><span class="keyword">= </span><span class="default">pathInfo</span><span class="keyword">(</span><span class="default">$sourcePath</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$parentPath </span><span class="keyword">= </span><span class="default">$pathInfo</span><span class="keyword">[</span><span class="string">'dirname'</span><span class="keyword">];
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$dirName </span><span class="keyword">= </span><span class="default">$pathInfo</span><span class="keyword">[</span><span class="string">'basename'</span><span class="keyword">];
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$z </span><span class="keyword">= new </span><span class="default">ZipArchive</span><span class="keyword">();
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$z</span><span class="keyword">-&gt;</span><span class="default">open</span><span class="keyword">(</span><span class="default">$outZipPath</span><span class="keyword">, </span><span class="default">ZIPARCHIVE</span><span class="keyword">::</span><span class="default">CREATE</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$z</span><span class="keyword">-&gt;</span><span class="default">addEmptyDir</span><span class="keyword">(</span><span class="default">$dirName</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">folderToZip</span><span class="keyword">(</span><span class="default">$sourcePath</span><span class="keyword">, </span><span class="default">$z</span><span class="keyword">, </span><span class="default">strlen</span><span class="keyword">(</span><span class="string">"</span><span class="default">$parentPath</span><span class="string">/"</span><span class="keyword">));
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$z</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();
<br />
&nbsp; }
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="109618""></a>
  <div class="note">
   <strong class="user">niklas dot schumi at NOSPAM dot googlemail dot com</strong>
   <a href="#109618" class="date">02-Aug-2012 07:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hi there.<br />
I just wrote a little function to zip a whole folder while maintaining the dir-structure. I hope it might help someone.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">folderToZip</span><span class="keyword">(</span><span class="default">$folder</span><span class="keyword">, &amp;</span><span class="default">$zipFile</span><span class="keyword">, </span><span class="default">$subfolder </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$zipFile </span><span class="keyword">== </span><span class="default">null</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// no resource given, exit<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// we check if $folder has a slash at its end, if not, we append one<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$folder </span><span class="keyword">.= </span><span class="default">end</span><span class="keyword">(</span><span class="default">str_split</span><span class="keyword">(</span><span class="default">$folder</span><span class="keyword">)) == </span><span class="string">"/" </span><span class="keyword">? </span><span class="string">"" </span><span class="keyword">: </span><span class="string">"/"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$subfolder </span><span class="keyword">.= </span><span class="default">end</span><span class="keyword">(</span><span class="default">str_split</span><span class="keyword">(</span><span class="default">$subfolder</span><span class="keyword">)) == </span><span class="string">"/" </span><span class="keyword">? </span><span class="string">"" </span><span class="keyword">: </span><span class="string">"/"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// we start by going through all files in $folder<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$handle </span><span class="keyword">= </span><span class="default">opendir</span><span class="keyword">(</span><span class="default">$folder</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; while (</span><span class="default">$f </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$f </span><span class="keyword">!= </span><span class="string">"." </span><span class="keyword">&amp;&amp; </span><span class="default">$f </span><span class="keyword">!= </span><span class="string">".."</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_file</span><span class="keyword">(</span><span class="default">$folder </span><span class="keyword">. </span><span class="default">$f</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// if we find a file, store it<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // if we have a subfolder, store it there<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$subfolder </span><span class="keyword">!= </span><span class="default">null</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$zipFile</span><span class="keyword">-&gt;</span><span class="default">addFile</span><span class="keyword">(</span><span class="default">$folder </span><span class="keyword">. </span><span class="default">$f</span><span class="keyword">, </span><span class="default">$subfolder </span><span class="keyword">. </span><span class="default">$f</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$zipFile</span><span class="keyword">-&gt;</span><span class="default">addFile</span><span class="keyword">(</span><span class="default">$folder </span><span class="keyword">. </span><span class="default">$f</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } elseif (</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$folder </span><span class="keyword">. </span><span class="default">$f</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// if we find a folder, create a folder in the zip <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$zipFile</span><span class="keyword">-&gt;</span><span class="default">addEmptyDir</span><span class="keyword">(</span><span class="default">$f</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// and call the function again<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">folderToZip</span><span class="keyword">(</span><span class="default">$folder </span><span class="keyword">. </span><span class="default">$f</span><span class="keyword">, </span><span class="default">$zipFile</span><span class="keyword">, </span><span class="default">$f</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Use it like this:<br />
<span class="default">&lt;?php<br />
$z </span><span class="keyword">= new </span><span class="default">ZipArchive</span><span class="keyword">();<br />
</span><span class="default">$z</span><span class="keyword">-&gt;</span><span class="default">open</span><span class="keyword">(</span><span class="string">"test.zip"</span><span class="keyword">, </span><span class="default">ZIPARCHIVE</span><span class="keyword">::</span><span class="default">CREATE</span><span class="keyword">);<br />
</span><span class="default">folderToZip</span><span class="keyword">(</span><span class="string">"storeThisFolder"</span><span class="keyword">, </span><span class="default">$z</span><span class="keyword">);<br />
</span><span class="default">$z</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();<br />
</span><span class="default">?&gt;<br />
</span><br />
Have a good day!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="109406""></a>
  <div class="note">
   <strong class="user">panique at web dot de</strong>
   <a href="#109406" class="date">14-Jul-2012 08:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Important: Due to the natural file size limit of 4GB (~3,6GB to be correct) of zip files, this class will generate corrupt files of the result is larger than 4 GB. Using tar.gz is a proper alternative.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="108601""></a>
  <div class="note">
   <strong class="user">bruno dot vibert at bonobox dot fr</strong>
   <a href="#108601" class="date">10-May-2012 05:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There is a usefull function to get the ZipArchive status as a human readable string :<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">ZipStatusString</span><span class="keyword">( </span><span class="default">$status </span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; switch( (int) </span><span class="default">$status </span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_OK&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">: return </span><span class="string">'N No error'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_MULTIDISK&nbsp; &nbsp; </span><span class="keyword">: return </span><span class="string">'N Multi-disk zip archives not supported'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_RENAME&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">: return </span><span class="string">'S Renaming temporary file failed'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_CLOSE&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">: return </span><span class="string">'S Closing zip archive failed'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_SEEK&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">: return </span><span class="string">'S Seek error'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_READ&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">: return </span><span class="string">'S Read error'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_WRITE&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">: return </span><span class="string">'S Write error'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_CRC&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">: return </span><span class="string">'N CRC error'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_ZIPCLOSED&nbsp; &nbsp; </span><span class="keyword">: return </span><span class="string">'N Containing zip archive was closed'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_NOENT&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">: return </span><span class="string">'N No such file'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_EXISTS&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">: return </span><span class="string">'N File already exists'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_OPEN&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">: return </span><span class="string">'S Can\'t open file'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_TMPOPEN&nbsp; &nbsp; &nbsp; </span><span class="keyword">: return </span><span class="string">'S Failure to create temporary file'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_ZLIB&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">: return </span><span class="string">'Z Zlib error'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_MEMORY&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">: return </span><span class="string">'N Malloc failure'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_CHANGED&nbsp; &nbsp; &nbsp; </span><span class="keyword">: return </span><span class="string">'N Entry has been changed'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_COMPNOTSUPP&nbsp; </span><span class="keyword">: return </span><span class="string">'N Compression method not supported'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_EOF&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">: return </span><span class="string">'N Premature EOF'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_INVAL&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">: return </span><span class="string">'N Invalid argument'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_NOZIP&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">: return </span><span class="string">'N Not a zip archive'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_INTERNAL&nbsp; &nbsp;&nbsp; </span><span class="keyword">: return </span><span class="string">'N Internal error'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_INCONS&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">: return </span><span class="string">'N Zip archive inconsistent'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_REMOVE&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">: return </span><span class="string">'S Can\'t remove file'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_DELETED&nbsp; &nbsp; &nbsp; </span><span class="keyword">: return </span><span class="string">'N Entry has been deleted'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; default: return </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">'Unknown status %s'</span><span class="keyword">, </span><span class="default">$status </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="106062""></a>
  <div class="note">
   <strong class="user">webmaster at sebastiangrinke dot info</strong>
   <a href="#106062" class="date">06-Oct-2011 10:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is a simple function which zips folders with all sub folders or only a simple file... the $data var can be a string or an array...
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">public function </span><span class="default">un_zip</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">,</span><span class="default">$arcpf</span><span class="keyword">,</span><span class="default">$mode</span><span class="keyword">=</span><span class="string">'zip'</span><span class="keyword">,</span><span class="default">$obj</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">){
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$absoluterpfad </span><span class="keyword">= </span><span class="string">'YOUR_BASE_PATH'</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$arcpf </span><span class="keyword">= </span><span class="default">$absoluterpfad</span><span class="keyword">.</span><span class="default">DS</span><span class="keyword">.</span><span class="default">$arcpf</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">is_object</span><span class="keyword">(</span><span class="default">$obj</span><span class="keyword">)==</span><span class="default">false</span><span class="keyword">){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$archiv </span><span class="keyword">= new </span><span class="default">ZipArchive</span><span class="keyword">();
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$archiv</span><span class="keyword">-&gt;</span><span class="default">open</span><span class="keyword">(</span><span class="default">$arcpf</span><span class="keyword">,</span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">CREATE</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }else{</span><span class="default">$archiv </span><span class="keyword">=&amp; </span><span class="default">$obj</span><span class="keyword">;}
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$mode</span><span class="keyword">==</span><span class="string">'zip'</span><span class="keyword">){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">)==</span><span class="default">true</span><span class="keyword">){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach(</span><span class="default">$data </span><span class="keyword">as </span><span class="default">$dtmp</span><span class="keyword">){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$archiv </span><span class="keyword">=&amp; </span><span class="default">un_zip</span><span class="keyword">(</span><span class="default">$dtmp</span><span class="keyword">,</span><span class="default">$arcpf</span><span class="keyword">,</span><span class="string">'zip'</span><span class="keyword">,&amp;</span><span class="default">$archiv</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }else{
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">)==</span><span class="default">true</span><span class="keyword">){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$archiv</span><span class="keyword">-&gt;</span><span class="default">addEmptyDir</span><span class="keyword">(</span><span class="default">str_replace</span><span class="keyword">(</span><span class="default">$absoluterpfad</span><span class="keyword">.</span><span class="default">DS</span><span class="keyword">,</span><span class="string">''</span><span class="keyword">,</span><span class="default">$data</span><span class="keyword">));
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$files </span><span class="keyword">= </span><span class="default">scandir</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$bad </span><span class="keyword">= array(</span><span class="string">'.'</span><span class="keyword">,</span><span class="string">'..'</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$files </span><span class="keyword">= </span><span class="default">array_diff</span><span class="keyword">(</span><span class="default">$files</span><span class="keyword">,</span><span class="default">$bad</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach(</span><span class="default">$files </span><span class="keyword">as </span><span class="default">$ftmp</span><span class="keyword">){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">.</span><span class="default">DS</span><span class="keyword">.</span><span class="default">$ftmp</span><span class="keyword">)==</span><span class="default">true</span><span class="keyword">){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$archiv</span><span class="keyword">-&gt;</span><span class="default">addEmptyDir</span><span class="keyword">(</span><span class="default">str_replace</span><span class="keyword">(</span><span class="default">$absoluterpfad</span><span class="keyword">.</span><span class="default">DS</span><span class="keyword">,</span><span class="string">''</span><span class="keyword">,</span><span class="default">$data</span><span class="keyword">.</span><span class="string">'/'</span><span class="keyword">.</span><span class="default">$ftmp</span><span class="keyword">));
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$archiv </span><span class="keyword">=&amp; </span><span class="default">un_zip</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">.</span><span class="default">DS</span><span class="keyword">.</span><span class="default">$ftmp</span><span class="keyword">,</span><span class="default">$arcpf</span><span class="keyword">,</span><span class="string">'zip'</span><span class="keyword">,&amp;</span><span class="default">$archiv</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }elseif(</span><span class="default">is_file</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">.</span><span class="default">DS</span><span class="keyword">.</span><span class="default">$ftmp</span><span class="keyword">)==</span><span class="default">true</span><span class="keyword">){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$archiv</span><span class="keyword">-&gt;</span><span class="default">addFile</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">.</span><span class="default">DS</span><span class="keyword">.</span><span class="default">$ftmp</span><span class="keyword">,</span><span class="default">str_replace</span><span class="keyword">(</span><span class="default">$absoluterpfad</span><span class="keyword">.</span><span class="default">DS</span><span class="keyword">,</span><span class="string">''</span><span class="keyword">,</span><span class="default">$data</span><span class="keyword">.</span><span class="string">'/'</span><span class="keyword">.</span><span class="default">$ftmp</span><span class="keyword">));
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }elseif(</span><span class="default">is_file</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">)==</span><span class="default">true</span><span class="keyword">){</span><span class="default">$archiv</span><span class="keyword">-&gt;</span><span class="default">addFile</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">,</span><span class="default">str_replace</span><span class="keyword">(</span><span class="default">$absoluterpfad</span><span class="keyword">.</span><span class="default">DS</span><span class="keyword">,</span><span class="string">''</span><span class="keyword">,</span><span class="default">$data</span><span class="keyword">));}
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">is_object</span><span class="keyword">(</span><span class="default">$obj</span><span class="keyword">)==</span><span class="default">false</span><span class="keyword">){</span><span class="default">$archiv</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();}
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else{return </span><span class="default">$archiv</span><span class="keyword">;}
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$mode</span><span class="keyword">==</span><span class="string">'unzip'</span><span class="keyword">){</span><span class="default">$archiv</span><span class="keyword">-&gt;</span><span class="default">extractTo</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">);}
<br />
&nbsp;&nbsp;&nbsp; }
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="105312""></a>
  <div class="note">
   <strong class="user">Jerry dot Saravia at emc dot com</strong>
   <a href="#105312" class="date">08-Aug-2011 10:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The following code can be used to get a list of all the file names in a zip file.
<br />

<br />
<span class="default">&lt;?php
<br />
$za </span><span class="keyword">= new </span><span class="default">ZipArchive</span><span class="keyword">();
<br />

<br />
</span><span class="default">$za</span><span class="keyword">-&gt;</span><span class="default">open</span><span class="keyword">(</span><span class="string">'theZip.zip'</span><span class="keyword">);
<br />

<br />
for( </span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$za</span><span class="keyword">-&gt;</span><span class="default">numFiles</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++ ){
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$stat </span><span class="keyword">= </span><span class="default">$za</span><span class="keyword">-&gt;</span><span class="default">statIndex</span><span class="keyword">( </span><span class="default">$i </span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">print_r</span><span class="keyword">( </span><span class="default">basename</span><span class="keyword">( </span><span class="default">$stat</span><span class="keyword">[</span><span class="string">'name'</span><span class="keyword">] ) . </span><span class="default">PHP_EOL </span><span class="keyword">);
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100268""></a>
  <div class="note">
   <strong class="user">h-fate at gmx dot net</strong>
   <a href="#100268" class="date">05-Oct-2010 01:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Be wary that there are several algorithms to generate a zip file. I found that Office OpenXML files created with ZipArchive are not recognized by Excel 2007, for example.<br />
<br />
You have to use a different class to zip in this case, such as PclZip.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="98441""></a>
  <div class="note">
   <strong class="user">hardcorevenom at gmx dot com</strong>
   <a href="#98441" class="date">16-Jun-2010 12:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Read a file from an archive to a variable.<br />
A warning is printed automatically in case of a CRC32 mismatch, which we capture, so we can print our own error message.<br />
<br />
<span class="default">&lt;?php<br />
$zip </span><span class="keyword">= new </span><span class="default">ZipArchive</span><span class="keyword">();<br />
if (</span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">open</span><span class="keyword">(</span><span class="string">'archive.zip'</span><span class="keyword">)) {<br />
&nbsp; </span><span class="default">$fp </span><span class="keyword">= </span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">getStream</span><span class="keyword">(</span><span class="string">'myfile.txt'</span><span class="keyword">); </span><span class="comment">//file inside archive<br />
&nbsp; </span><span class="keyword">if(!</span><span class="default">$fp</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; die(</span><span class="string">"Error: can't get stream to zipped file"</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$stat </span><span class="keyword">= </span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">statName</span><span class="keyword">(</span><span class="string">'myfile.txt'</span><span class="keyword">);<br />
<br />
&nbsp; </span><span class="default">$buf </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">; </span><span class="comment">//file buffer<br />
&nbsp; </span><span class="default">ob_start</span><span class="keyword">(); </span><span class="comment">//to capture CRC error message<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$buf </span><span class="keyword">.= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">2048</span><span class="keyword">); </span><span class="comment">//reading more than 2156 bytes seems to disable internal CRC32 verification (bug?)<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">}<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$s </span><span class="keyword">= </span><span class="default">ob_get_contents</span><span class="keyword">();<br />
&nbsp; </span><span class="default">ob_end_clean</span><span class="keyword">();<br />
&nbsp; if(</span><span class="default">stripos</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">, </span><span class="string">"CRC error"</span><span class="keyword">) != </span><span class="default">FALSE</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">'CRC32 mismatch, current '</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">printf</span><span class="keyword">(</span><span class="string">"%08X"</span><span class="keyword">, </span><span class="default">crc32</span><span class="keyword">(</span><span class="default">$buf</span><span class="keyword">)); </span><span class="comment">//current CRC<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">echo </span><span class="string">', expected '</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">printf</span><span class="keyword">(</span><span class="string">"%08X"</span><span class="keyword">, </span><span class="default">$stat</span><span class="keyword">[</span><span class="string">'crc'</span><span class="keyword">]); </span><span class="comment">//expected CRC<br />
&nbsp; </span><span class="keyword">}<br />
<br />
&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();<br />
&nbsp; </span><span class="comment">//Done, unpacked file is stored in $buf<br />
</span><span class="keyword">}<br />
</span><span class="default">?&gt;<br />
</span><br />
To create a corrupt file, change a byte in a zip file using a hex editor.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
