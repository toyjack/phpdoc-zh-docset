<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>图像处理和 GD</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.read-exif-data.html">? read_exif_data</a></li>
      <li style="float: right;"><a href="intro.image.html">简介 ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="refs.utilspec.image.html">图像生成和处理</a></li>
    <li>图像处理和 GD</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="book.image" class="book">
 
 <h1 class="title">图像处理和 GD</h1>
 
 
 
 

 
 
 









 







 









 









<ul class="chunklist chunklist_book"><li><a href="intro.image.html">简介</a></li><li><a href="image.setup.html">安装／配置</a><ul class="chunklist chunklist_book chunklist_children"><li><a href="image.requirements.html">需求</a></li><li><a href="image.installation.html">安装</a></li><li><a href="image.configuration.html">运行时配置</a></li><li><a href="image.resources.html">资源类型</a></li></ul></li><li><a href="image.constants.html">预定义常量</a></li><li><a href="image.examples.html">范例</a><ul class="chunklist chunklist_book chunklist_children"><li><a href="image.examples-png.html">使用 PHP 创建 PNG 图像</a></li><li><a href="image.examples-watermark.html">使用 Alpha 通道为图像加水印</a></li><li><a href="image.examples.merged-watermark.html">使用 imagecopymerge 函数创建半透明水印</a></li></ul></li><li><a href="ref.image.html">GD 和图像处理 函数</a><ul class="chunklist chunklist_book chunklist_children"><li><a href="function.gd-info.html">gd_info</a> &mdash; 取得当前安装的 GD 库的信息</li><li><a href="function.getimagesize.html">getimagesize</a> &mdash; 取得图像大小</li><li><a href="function.getimagesizefromstring.html">getimagesizefromstring</a> &mdash; 从字符串中获取图像尺寸信息</li><li><a href="function.image-type-to-extension.html">image_type_to_extension</a> &mdash; 取得图像类型的文件后缀</li><li><a href="function.image-type-to-mime-type.html">image_type_to_mime_type</a> &mdash; 取得 getimagesize，exif_read_data，exif_thumbnail，exif_imagetype
    所返回的图像类型的 MIME 类型</li><li><a href="function.image2wbmp.html">image2wbmp</a> &mdash; 以 WBMP 格式将图像输出到浏览器或文件</li><li><a href="function.imageaffine.html">imageaffine</a> &mdash; 返回经过仿射变换后的图像，剪切区域可选</li><li><a href="function.imageaffinematrixconcat.html">imageaffinematrixconcat</a> &mdash; Concat two matrices (as in doing many ops in one go)</li><li><a href="function.imageaffinematrixget.html">imageaffinematrixget</a> &mdash; Return an image containing the affine tramsformed src image, using an optional clipping area</li><li><a href="function.imagealphablending.html">imagealphablending</a> &mdash; 设定图像的混色模式</li><li><a href="function.imageantialias.html">imageantialias</a> &mdash; 是否使用抗锯齿（antialias）功能</li><li><a href="function.imagearc.html">imagearc</a> &mdash; 画椭圆弧</li><li><a href="function.imagechar.html">imagechar</a> &mdash; 水平地画一个字符</li><li><a href="function.imagecharup.html">imagecharup</a> &mdash; 垂直地画一个字符</li><li><a href="function.imagecolorallocate.html">imagecolorallocate</a> &mdash; 为一幅图像分配颜色</li><li><a href="function.imagecolorallocatealpha.html">imagecolorallocatealpha</a> &mdash; 为一幅图像分配颜色 + alpha</li><li><a href="function.imagecolorat.html">imagecolorat</a> &mdash; 取得某像素的颜色索引值</li><li><a href="function.imagecolorclosest.html">imagecolorclosest</a> &mdash; 取得与指定的颜色最接近的颜色的索引值</li><li><a href="function.imagecolorclosestalpha.html">imagecolorclosestalpha</a> &mdash; 取得与指定的颜色加透明度最接近的颜色</li><li><a href="function.imagecolorclosesthwb.html">imagecolorclosesthwb</a> &mdash; 取得与给定颜色最接近的色度的黑白色的索引</li><li><a href="function.imagecolordeallocate.html">imagecolordeallocate</a> &mdash; 取消图像颜色的分配</li><li><a href="function.imagecolorexact.html">imagecolorexact</a> &mdash; 取得指定颜色的索引值</li><li><a href="function.imagecolorexactalpha.html">imagecolorexactalpha</a> &mdash; 取得指定的颜色加透明度的索引值</li><li><a href="function.imagecolormatch.html">imagecolormatch</a> &mdash; 使一个图像中调色板版本的颜色与真彩色版本更能匹配</li><li><a href="function.imagecolorresolve.html">imagecolorresolve</a> &mdash; 取得指定颜色的索引值或有可能得到的最接近的替代值</li><li><a href="function.imagecolorresolvealpha.html">imagecolorresolvealpha</a> &mdash; 取得指定颜色 + alpha 的索引值或有可能得到的最接近的替代值</li><li><a href="function.imagecolorset.html">imagecolorset</a> &mdash; 给指定调色板索引设定颜色</li><li><a href="function.imagecolorsforindex.html">imagecolorsforindex</a> &mdash; 取得某索引的颜色</li><li><a href="function.imagecolorstotal.html">imagecolorstotal</a> &mdash; 取得一幅图像的调色板中颜色的数目</li><li><a href="function.imagecolortransparent.html">imagecolortransparent</a> &mdash; 将某个颜色定义为透明色</li><li><a href="function.imageconvolution.html">imageconvolution</a> &mdash; 用系数 div 和 offset 申请一个 3x3 的卷积矩阵</li><li><a href="function.imagecopy.html">imagecopy</a> &mdash; 拷贝图像的一部分</li><li><a href="function.imagecopymerge.html">imagecopymerge</a> &mdash; 拷贝并合并图像的一部分</li><li><a href="function.imagecopymergegray.html">imagecopymergegray</a> &mdash; 用灰度拷贝并合并图像的一部分</li><li><a href="function.imagecopyresampled.html">imagecopyresampled</a> &mdash; 重采样拷贝部分图像并调整大小</li><li><a href="function.imagecopyresized.html">imagecopyresized</a> &mdash; 拷贝部分图像并调整大小</li><li><a href="function.imagecreate.html">imagecreate</a> &mdash; 新建一个基于调色板的图像</li><li><a href="function.imagecreatefromgd2.html">imagecreatefromgd2</a> &mdash; 从 GD2 文件或 URL 新建一图像</li><li><a href="function.imagecreatefromgd2part.html">imagecreatefromgd2part</a> &mdash; 从给定的 GD2 文件或 URL 中的部分新建一图像</li><li><a href="function.imagecreatefromgd.html">imagecreatefromgd</a> &mdash; 从 GD 文件或 URL 新建一图像</li><li><a href="function.imagecreatefromgif.html">imagecreatefromgif</a> &mdash; 由文件或 URL 创建一个新图象。</li><li><a href="function.imagecreatefromjpeg.html">imagecreatefromjpeg</a> &mdash; 由文件或 URL 创建一个新图象。</li><li><a href="function.imagecreatefrompng.html">imagecreatefrompng</a> &mdash; 由文件或 URL 创建一个新图象。</li><li><a href="function.imagecreatefromstring.html">imagecreatefromstring</a> &mdash; 从字符串中的图像流新建一图像</li><li><a href="function.imagecreatefromwbmp.html">imagecreatefromwbmp</a> &mdash; 由文件或 URL 创建一个新图象。</li><li><a href="function.imagecreatefromwebp.html">imagecreatefromwebp</a> &mdash; 由文件或 URL 创建一个新图象。</li><li><a href="function.imagecreatefromxbm.html">imagecreatefromxbm</a> &mdash; 由文件或 URL 创建一个新图象。</li><li><a href="function.imagecreatefromxpm.html">imagecreatefromxpm</a> &mdash; 由文件或 URL 创建一个新图象。</li><li><a href="function.imagecreatetruecolor.html">imagecreatetruecolor</a> &mdash; 新建一个真彩色图像</li><li><a href="function.imagecrop.html">imagecrop</a> &mdash; Crop an image using the given coordinates and size, x, y, width and height</li><li><a href="function.imagecropauto.html">imagecropauto</a> &mdash; Crop an image automatically using one of the available modes</li><li><a href="function.imagedashedline.html">imagedashedline</a> &mdash; 画一虚线</li><li><a href="function.imagedestroy.html">imagedestroy</a> &mdash; 销毁一图像</li><li><a href="function.imageellipse.html">imageellipse</a> &mdash; 画一个椭圆</li><li><a href="function.imagefill.html">imagefill</a> &mdash; 区域填充</li><li><a href="function.imagefilledarc.html">imagefilledarc</a> &mdash; 画一椭圆弧且填充</li><li><a href="function.imagefilledellipse.html">imagefilledellipse</a> &mdash; 画一椭圆并填充</li><li><a href="function.imagefilledpolygon.html">imagefilledpolygon</a> &mdash; 画一多边形并填充</li><li><a href="function.imagefilledrectangle.html">imagefilledrectangle</a> &mdash; 画一矩形并填充</li><li><a href="function.imagefilltoborder.html">imagefilltoborder</a> &mdash; 区域填充到指定颜色的边界为止</li><li><a href="function.imagefilter.html">imagefilter</a> &mdash; 对图像使用过滤器</li><li><a href="function.imageflip.html">imageflip</a> &mdash; Flips an image using a given mode</li><li><a href="function.imagefontheight.html">imagefontheight</a> &mdash; 取得字体高度</li><li><a href="function.imagefontwidth.html">imagefontwidth</a> &mdash; 取得字体宽度</li><li><a href="function.imageftbbox.html">imageftbbox</a> &mdash; 给出一个使用 FreeType 2 字体的文本框</li><li><a href="function.imagefttext.html">imagefttext</a> &mdash; 使用 FreeType 2 字体将文本写入图像</li><li><a href="function.imagegammacorrect.html">imagegammacorrect</a> &mdash; 对 GD 图像应用 gamma 修正</li><li><a href="function.imagegd2.html">imagegd2</a> &mdash; 将 GD2 图像输出到浏览器或文件</li><li><a href="function.imagegd.html">imagegd</a> &mdash; 将 GD 图像输出到浏览器或文件</li><li><a href="function.imagegif.html">imagegif</a> &mdash; 输出图象到浏览器或文件。</li><li><a href="function.imagegrabscreen.html">imagegrabscreen</a> &mdash; Captures the whole screen</li><li><a href="function.imagegrabwindow.html">imagegrabwindow</a> &mdash; Captures a window</li><li><a href="function.imageinterlace.html">imageinterlace</a> &mdash; 激活或禁止隔行扫描</li><li><a href="function.imageistruecolor.html">imageistruecolor</a> &mdash; 检查图像是否为真彩色图像</li><li><a href="function.imagejpeg.html">imagejpeg</a> &mdash; 输出图象到浏览器或文件。</li><li><a href="function.imagelayereffect.html">imagelayereffect</a> &mdash; 设定 alpha 混色标志以使用绑定的 libgd 分层效果</li><li><a href="function.imageline.html">imageline</a> &mdash; 画一条线段</li><li><a href="function.imageloadfont.html">imageloadfont</a> &mdash; 载入一新字体</li><li><a href="function.imagepalettecopy.html">imagepalettecopy</a> &mdash; 将调色板从一幅图像拷贝到另一幅</li><li><a href="function.imagepalettetotruecolor.html">imagepalettetotruecolor</a> &mdash; Converts a palette based image to true color</li><li><a href="function.imagepng.html">imagepng</a> &mdash; 以 PNG 格式将图像输出到浏览器或文件</li><li><a href="function.imagepolygon.html">imagepolygon</a> &mdash; 画一个多边形</li><li><a href="function.imagepsbbox.html">imagepsbbox</a> &mdash; 给出一个使用 PostScript Type1 字体的文本方框</li><li><a href="function.imagepsencodefont.html">imagepsencodefont</a> &mdash; 改变字体中的字符编码矢量</li><li><a href="function.imagepsextendfont.html">imagepsextendfont</a> &mdash; 扩充或精简字体</li><li><a href="function.imagepsfreefont.html">imagepsfreefont</a> &mdash; 释放一个 PostScript Type 1 字体所占用的内存</li><li><a href="function.imagepsloadfont.html">imagepsloadfont</a> &mdash; 从文件中加载一个 PostScript Type 1 字体</li><li><a href="function.imagepsslantfont.html">imagepsslantfont</a> &mdash; 倾斜某字体</li><li><a href="function.imagepstext.html">imagepstext</a> &mdash; 用 PostScript Type1 字体把文本字符串画在图像上</li><li><a href="function.imagerectangle.html">imagerectangle</a> &mdash; 画一个矩形</li><li><a href="function.imagerotate.html">imagerotate</a> &mdash; 用给定角度旋转图像</li><li><a href="function.imagesavealpha.html">imagesavealpha</a> &mdash; 设置标记以在保存 PNG 图像时保存完整的 alpha 通道信息（与单一透明色相反）</li><li><a href="function.imagescale.html">imagescale</a> &mdash; Scale an image using the given new width and height</li><li><a href="function.imagesetbrush.html">imagesetbrush</a> &mdash; 设定画线用的画笔图像</li><li><a href="function.imagesetinterpolation.html">imagesetinterpolation</a> &mdash; Set the interpolation method</li><li><a href="function.imagesetpixel.html">imagesetpixel</a> &mdash; 画一个单一像素</li><li><a href="function.imagesetstyle.html">imagesetstyle</a> &mdash; 设定画线的风格</li><li><a href="function.imagesetthickness.html">imagesetthickness</a> &mdash; 设定画线的宽度</li><li><a href="function.imagesettile.html">imagesettile</a> &mdash; 设定用于填充的贴图</li><li><a href="function.imagestring.html">imagestring</a> &mdash; 水平地画一行字符串</li><li><a href="function.imagestringup.html">imagestringup</a> &mdash; 垂直地画一行字符串</li><li><a href="function.imagesx.html">imagesx</a> &mdash; 取得图像宽度</li><li><a href="function.imagesy.html">imagesy</a> &mdash; 取得图像高度</li><li><a href="function.imagetruecolortopalette.html">imagetruecolortopalette</a> &mdash; 将真彩色图像转换为调色板图像</li><li><a href="function.imagettfbbox.html">imagettfbbox</a> &mdash; 取得使用 TrueType 字体的文本的范围</li><li><a href="function.imagettftext.html">imagettftext</a> &mdash; 用 TrueType 字体向图像写入文本</li><li><a href="function.imagetypes.html">imagetypes</a> &mdash; 返回当前 PHP 版本所支持的图像类型</li><li><a href="function.imagewbmp.html">imagewbmp</a> &mdash; 以 WBMP 格式将图像输出到浏览器或文件</li><li><a href="function.imagewebp.html">imagewebp</a> &mdash; 将 WebP 格式的图像输出到浏览器或文件</li><li><a href="function.imagexbm.html">imagexbm</a> &mdash; 将 XBM 图像输出到浏览器或文件</li><li><a href="function.iptcembed.html">iptcembed</a> &mdash; 将二进制 IPTC 数据嵌入到一幅 JPEG 图像中</li><li><a href="function.iptcparse.html">iptcparse</a> &mdash; 将二进制 IPTC 块解析为单个标记</li><li><a href="function.jpeg2wbmp.html">jpeg2wbmp</a> &mdash; 将 JPEG 图像文件转换为 WBMP 图像文件</li><li><a href="function.png2wbmp.html">png2wbmp</a> &mdash; 将 PNG 图像文件转换为 WBMP 图像文件</li></ul></li></ul></div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="114852""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#114852" class="date">15-Apr-2014 05:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
&lt;form action="index.php" method="POST" enctype="multipart/form-data"&gt;<br />
&nbsp;&nbsp;&nbsp; Titel:<br />
&nbsp;&nbsp;&nbsp; &lt;input type="text" name="titel" /&gt;<br />
&nbsp;&nbsp;&nbsp; File:<br />
&nbsp;&nbsp;&nbsp; &lt;input type="file" name="image"&gt; &lt;input type="submit" name="submit" value="Verzend"&gt;<br />
&lt;/form&gt;<br />
<br />
<span class="default">&lt;?PHP <br />
</span><span class="comment">//connection<br />
</span><span class="keyword">include(</span><span class="string">'connection.php'</span><span class="keyword">);<br />
if(isset(</span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'submit'</span><span class="keyword">]))<br />
{<br />
&nbsp;&nbsp;&nbsp; if((</span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'titel'</span><span class="keyword">])!=</span><span class="string">""</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
<br />
</span><span class="default">$image </span><span class="keyword">= </span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'image'</span><span class="keyword">][</span><span class="string">'tmp_name'</span><span class="keyword">];<br />
</span><span class="default">$titel </span><span class="keyword">= </span><span class="default">$_REQUEST</span><span class="keyword">[</span><span class="string">'titel'</span><span class="keyword">];<br />
<br />
if (!isset(</span><span class="default">$image</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"Please upload an image" </span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; else<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$image_size </span><span class="keyword">= </span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'image'</span><span class="keyword">][</span><span class="string">'tmp_name'</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$image_size</span><span class="keyword">==</span><span class="default">FALSE</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"This is not an image, Nice Try!"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$image </span><span class="keyword">= </span><span class="default">addslashes </span><span class="keyword">(</span><span class="default">file_get_contents </span><span class="keyword">(</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'image'</span><span class="keyword">][</span><span class="string">'tmp_name'</span><span class="keyword">]));&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$image_name </span><span class="keyword">= </span><span class="default">addslashes </span><span class="keyword">(</span><span class="default">$_FILES </span><span class="keyword">[</span><span class="string">'image'</span><span class="keyword">][</span><span class="string">'name'</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$thumb </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">100</span><span class="keyword">,</span><span class="default">100</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$afb </span><span class="keyword">= </span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'image'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$temp </span><span class="keyword">= </span><span class="default">$afb</span><span class="keyword">[</span><span class="string">'tmp_name'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$info </span><span class="keyword">= </span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$temp</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$br </span><span class="keyword">= </span><span class="default">$info</span><span class="keyword">[</span><span class="string">'0'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$hg </span><span class="keyword">= </span><span class="default">$info</span><span class="keyword">[</span><span class="string">'1'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ext </span><span class="keyword">= </span><span class="default">$info</span><span class="keyword">[</span><span class="string">'2'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$source </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$temp</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$thumb</span><span class="keyword">, </span><span class="default">$source</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">100</span><span class="keyword">, </span><span class="default">100</span><span class="keyword">, </span><span class="default">$br</span><span class="keyword">, </span><span class="default">$hg</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$thumbname </span><span class="keyword">= </span><span class="string">"database/thumb/tn"</span><span class="keyword">.</span><span class="default">$image_name</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$thumbnailname </span><span class="keyword">= </span><span class="string">"tn"</span><span class="keyword">.</span><span class="default">$image_name</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagejpeg </span><span class="keyword">(</span><span class="default">$thumb</span><span class="keyword">, </span><span class="default">$thumbname</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">move_uploaded_file </span><span class="keyword">(</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'image'</span><span class="keyword">][</span><span class="string">'tmp_name'</span><span class="keyword">], </span><span class="string">"database/"</span><span class="keyword">.</span><span class="default">$image_name</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">move_uploaded_file </span><span class="keyword">(</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'image'</span><span class="keyword">][</span><span class="string">'tmp_name'</span><span class="keyword">], </span><span class="string">"database/thumb/"</span><span class="keyword">.</span><span class="default">$thumbname</span><span class="keyword">); <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">$insert </span><span class="keyword">= </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="string">"INSERT INTO images VALUES('','</span><span class="default">$titel</span><span class="string">','</span><span class="default">$image_name</span><span class="string">','</span><span class="default">$thumbnailname</span><span class="string">')"</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Upload is not working."</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dir </span><span class="keyword">= </span><span class="string">'database/'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$base_url </span><span class="keyword">= </span><span class="string">'<a href="http://www.yourdomainname.com/foto/database" rel="nofollow" target="_blank">http://www.yourdomainname.com/foto/database</a>'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$newest_mtime </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$show_file </span><span class="keyword">= </span><span class="string">'BROKEN'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$handle </span><span class="keyword">= </span><span class="default">opendir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; while (</span><span class="default">false </span><span class="keyword">!== (</span><span class="default">$file </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">))) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ((</span><span class="default">$file </span><span class="keyword">!= </span><span class="string">'.'</span><span class="keyword">) &amp;&amp; (</span><span class="default">$file </span><span class="keyword">!= </span><span class="string">'..'</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$mtime </span><span class="keyword">= </span><span class="default">filemtime</span><span class="keyword">(</span><span class="string">"</span><span class="default">$dir</span><span class="string">/</span><span class="default">$file</span><span class="string">"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$mtime </span><span class="keyword">&gt; </span><span class="default">$newest_mtime</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$newest_mtime </span><span class="keyword">= </span><span class="default">$mtime</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$show_file </span><span class="keyword">= </span><span class="string">"</span><span class="default">$base_url</span><span class="string">/</span><span class="default">$file</span><span class="string">"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; print </span><span class="string">'&lt;img src="' </span><span class="keyword">.</span><span class="default">$show_file</span><span class="keyword">. </span><span class="string">'" alt="$titel"&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//thumbnail<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dirthumb </span><span class="keyword">= </span><span class="string">'database/thumb/'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$base_urlthumb </span><span class="keyword">= </span><span class="string">'<a href="http://www.yourdomainname.com/foto/database/thumb" rel="nofollow" target="_blank">http://www.yourdomainname.com/foto/database/thumb</a>'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$newest_mtime </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$show_file </span><span class="keyword">= </span><span class="string">'BROKEN'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$handle </span><span class="keyword">= </span><span class="default">opendir</span><span class="keyword">(</span><span class="default">$dirthumb</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; while (</span><span class="default">false </span><span class="keyword">!== (</span><span class="default">$file </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">))) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ((</span><span class="default">$file </span><span class="keyword">!= </span><span class="string">'.'</span><span class="keyword">) &amp;&amp; (</span><span class="default">$file </span><span class="keyword">!= </span><span class="string">'..'</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$mtime </span><span class="keyword">= </span><span class="default">filemtime</span><span class="keyword">(</span><span class="string">"</span><span class="default">$dirthumb</span><span class="string">/</span><span class="default">$file</span><span class="string">"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$mtime </span><span class="keyword">&gt; </span><span class="default">$newest_mtime</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$newest_mtime </span><span class="keyword">= </span><span class="default">$mtime</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$show_file </span><span class="keyword">= </span><span class="string">"</span><span class="default">$base_urlthumb</span><span class="string">/</span><span class="default">$file</span><span class="string">"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; print </span><span class="string">'&lt;img src="' </span><span class="keyword">.</span><span class="default">$show_file</span><span class="keyword">. </span><span class="string">'" alt="$titel"&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; }else { echo </span><span class="string">"Oops! Looks like you forgot to upload the image&lt;br&gt;"</span><span class="keyword">; }<br />
}<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; <br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="112952""></a>
  <div class="note">
   <strong class="user">zsolt dot trenyik at gmail dot com</strong>
   <a href="#112952" class="date">12-Aug-2013 03:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
According to&nbsp; kurdtpage at gmail dot com, we faced a fairly strange behavior of GD. We saved an incluce file incorrectly, and everything worked (OCI8, other php functions) except GD. It took one and half day to find the reason, at the end commenting out the require part of the main file. <br />
<br />
The solution was: we took a HEX editor to see if there is a problem with that .inc file. There was some crazy invisible characters before the <span class="default">&lt;?php tag</span><span class="keyword">, </span><span class="default">signing that the text editor saved the file in utf format</span><span class="keyword">. </span><span class="default">These characters cannot be deleted</span><span class="keyword">, </span><span class="default">we had to open a </span><span class="keyword">new </span><span class="default">file in eclipse </span><span class="keyword">(</span><span class="default">notepad</span><span class="keyword">++ </span><span class="default">also works right</span><span class="keyword">), </span><span class="default">copy the visible part of the file to it</span><span class="keyword">, </span><span class="default">replace them</span><span class="keyword">, </span><span class="default">ready</span><span class="keyword">. <br />
<br />
</span><span class="default">Maybe this detailed warning helps somebody</span><span class="keyword">.</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="107069""></a>
  <div class="note">
   <strong class="user">herbert dot walde at googlemail dot com</strong>
   <a href="#107069" class="date">04-Jan-2012 08:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In case your script is using output-buffering-functions somewhere, then you have to clear the buffer first ( with ob_clear() ), before outputting an image with a function like imagepng(). 
<br />

<br />
And you should make sure that no buffer will get send after outputing an image by using the ob_end_flush()-function.
<br />

<br />
Furthermore you should check if a buffer has already been flushed somewhere before. This can be done using the headers_sent()-function.
<br />

<br />
Here is the full solution:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">if(</span><span class="default">headers_sent</span><span class="keyword">()){
<br />
&nbsp;&nbsp;&nbsp; die(</span><span class="string">'Headers have been send somewhere within my script'</span><span class="keyword">);
<br />
}
<br />

<br />
</span><span class="default">ob_clean</span><span class="keyword">(); </span><span class="comment">//Clears the buffer
<br />

<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-type: image/png'</span><span class="keyword">);
<br />
</span><span class="default">imagepng</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">, </span><span class="default">NULL</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">,&nbsp; </span><span class="default">NULL</span><span class="keyword">);
<br />

<br />
</span><span class="default">ob_end_flush</span><span class="keyword">(); </span><span class="comment">//Now we send the header and image plus we make sure that nothing will get send from now on (including possible shutdown-functions and __destruct()-methods) till the end of page-execution
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="104869""></a>
  <div class="note">
   <strong class="user">donatj at gmail dot com</strong>
   <a href="#104869" class="date">12-Jul-2011 10:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
UTF-8 is fine with GD - as well as any other Unicode transformation format - you just need to ensure your saved file doesn't contain the dreaded byte order mark.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="103685""></a>
  <div class="note">
   <strong class="user">kurdtpage at gmail dot com</strong>
   <a href="#103685" class="date">28-Apr-2011 07:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When using GD, please make sure of the following things:<br />
<br />
1. The file that is used to manipulate images is saved as ANSI format and not UTF-8<br />
2. There is no space in front of the opening tag &lt;?php</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="98153""></a>
  <div class="note">
   <strong class="user">mac_doggie at hotmail dot com</strong>
   <a href="#98153" class="date">28-May-2010 04:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A way to read the color of a pixel:
<br />

<br />
<span class="default">&lt;?php
<br />
&nbsp;&nbsp; $img </span><span class="keyword">= </span><span class="default">imagecreatefrompng</span><span class="keyword">(</span><span class="string">"image1.png"</span><span class="keyword">);
<br />
&nbsp;&nbsp; 
<br />
&nbsp;&nbsp; </span><span class="default">$w </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">);
<br />
&nbsp;&nbsp; </span><span class="default">$h </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">);
<br />
&nbsp;&nbsp; 
<br />
&nbsp;&nbsp; for(</span><span class="default">$y</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$y</span><span class="keyword">&lt;</span><span class="default">$h</span><span class="keyword">;</span><span class="default">$y</span><span class="keyword">++) {
<br />
&nbsp;&nbsp; &nbsp;&nbsp; for(</span><span class="default">$x</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$x</span><span class="keyword">&lt;</span><span class="default">$w</span><span class="keyword">;</span><span class="default">$x</span><span class="keyword">++) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$rgb </span><span class="keyword">= </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$r </span><span class="keyword">= (</span><span class="default">$rgb </span><span class="keyword">&gt;&gt; </span><span class="default">16</span><span class="keyword">) &amp; </span><span class="default">0xFF</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$g </span><span class="keyword">= (</span><span class="default">$rgb </span><span class="keyword">&gt;&gt; </span><span class="default">8</span><span class="keyword">) &amp; </span><span class="default">0xFF</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$b </span><span class="keyword">= </span><span class="default">$rgb </span><span class="keyword">&amp; </span><span class="default">0xFF</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">"#"</span><span class="keyword">.</span><span class="default">str_repeat</span><span class="keyword">(</span><span class="string">"0"</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">-</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">dechex</span><span class="keyword">(</span><span class="default">$r</span><span class="keyword">))).</span><span class="default">dechex</span><span class="keyword">(</span><span class="default">$r</span><span class="keyword">).
<br />
</span><span class="default">str_repeat</span><span class="keyword">(</span><span class="string">"0"</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">-</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">dechex</span><span class="keyword">(</span><span class="default">$g</span><span class="keyword">))).</span><span class="default">dechex</span><span class="keyword">(</span><span class="default">$g</span><span class="keyword">).
<br />
</span><span class="default">str_repeat</span><span class="keyword">(</span><span class="string">"0"</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">-</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">dechex</span><span class="keyword">(</span><span class="default">$b</span><span class="keyword">))).</span><span class="default">dechex</span><span class="keyword">(</span><span class="default">$b</span><span class="keyword">).</span><span class="string">","</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp;&nbsp; echo </span><span class="string">"&lt;br /&gt;\r\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; }
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
[EDIT BY thiago: merged two notes from same submitter.]</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="97137""></a>
  <div class="note">
   <strong class="user">mail at ecross dot nl</strong>
   <a href="#97137" class="date">03-Apr-2010 04:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
hello there,<br />
i made a function to create a gradient image.<br />
<br />
description:<br />
gradient(int image_width, int image_height, <br />
int start_red, int start_green, int start_blue, <br />
int end_red, int end_green, int end_blue, <br />
bool vertical)<br />
<br />
function:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">gradient</span><span class="keyword">(</span><span class="default">$image_width</span><span class="keyword">, </span><span class="default">$image_height</span><span class="keyword">,</span><span class="default">$c1_r</span><span class="keyword">, </span><span class="default">$c1_g</span><span class="keyword">, </span><span class="default">$c1_b</span><span class="keyword">, </span><span class="default">$c2_r</span><span class="keyword">, </span><span class="default">$c2_g</span><span class="keyword">, </span><span class="default">$c2_b</span><span class="keyword">, </span><span class="default">$vertical</span><span class="keyword">=</span><span class="default">false</span><span class="keyword">)<br />
{<br />
</span><span class="comment">// first: lets type cast;<br />
</span><span class="default">$image_width </span><span class="keyword">= (integer)</span><span class="default">$image_width</span><span class="keyword">;<br />
</span><span class="default">$image_height </span><span class="keyword">= (integer)</span><span class="default">$image_height</span><span class="keyword">;<br />
</span><span class="default">$c1_r </span><span class="keyword">= (integer)</span><span class="default">$c1_r</span><span class="keyword">;<br />
</span><span class="default">$c1_g </span><span class="keyword">= (integer)</span><span class="default">$c1_g</span><span class="keyword">;<br />
</span><span class="default">$c1_b </span><span class="keyword">= (integer)</span><span class="default">$c1_b</span><span class="keyword">;<br />
</span><span class="default">$c2_r </span><span class="keyword">= (integer)</span><span class="default">$c2_r</span><span class="keyword">;<br />
</span><span class="default">$c2_g </span><span class="keyword">= (integer)</span><span class="default">$c2_g</span><span class="keyword">;<br />
</span><span class="default">$c2_b </span><span class="keyword">= (integer)</span><span class="default">$c2_b</span><span class="keyword">;<br />
</span><span class="default">$vertical </span><span class="keyword">= (bool)</span><span class="default">$vertical</span><span class="keyword">;<br />
<br />
</span><span class="comment">// create a image<br />
</span><span class="default">$image&nbsp; </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$image_width</span><span class="keyword">, </span><span class="default">$image_height</span><span class="keyword">); <br />
<br />
</span><span class="comment">// make the gradient<br />
</span><span class="keyword">for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">$image_height</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) <br />
{ <br />
</span><span class="default">$color_r </span><span class="keyword">= </span><span class="default">floor</span><span class="keyword">(</span><span class="default">$i </span><span class="keyword">* (</span><span class="default">$c2_r</span><span class="keyword">-</span><span class="default">$c1_r</span><span class="keyword">) / </span><span class="default">$image_height</span><span class="keyword">)+</span><span class="default">$c1_r</span><span class="keyword">;<br />
</span><span class="default">$color_g </span><span class="keyword">= </span><span class="default">floor</span><span class="keyword">(</span><span class="default">$i </span><span class="keyword">* (</span><span class="default">$c2_g</span><span class="keyword">-</span><span class="default">$c1_g</span><span class="keyword">) / </span><span class="default">$image_height</span><span class="keyword">)+</span><span class="default">$c1_g</span><span class="keyword">;<br />
</span><span class="default">$color_b </span><span class="keyword">= </span><span class="default">floor</span><span class="keyword">(</span><span class="default">$i </span><span class="keyword">* (</span><span class="default">$c2_b</span><span class="keyword">-</span><span class="default">$c1_b</span><span class="keyword">) / </span><span class="default">$image_height</span><span class="keyword">)+</span><span class="default">$c1_b</span><span class="keyword">;<br />
<br />
</span><span class="default">$color </span><span class="keyword">= </span><span class="default">ImageColorAllocate</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">$color_r</span><span class="keyword">, </span><span class="default">$color_g</span><span class="keyword">, </span><span class="default">$color_b</span><span class="keyword">);<br />
</span><span class="default">imageline</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">, </span><span class="default">$image_width</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">);<br />
} <br />
<br />
</span><span class="comment"># Prints out all the figures and picture and frees memory <br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-type: image/png'</span><span class="keyword">); <br />
<br />
if(</span><span class="default">$vertical</span><span class="keyword">){</span><span class="default">$image </span><span class="keyword">= </span><span class="default">imagerotate</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">90</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);}<br />
</span><span class="default">ImagePNG</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">); <br />
</span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">); <br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="87566""></a>
  <div class="note">
   <strong class="user">Thomas</strong>
   <a href="#87566" class="date">10-Dec-2008 11:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You know, maybe this goes without saying, but I thought I would drop a note in here.&nbsp; When developing code to resize images, it is best not to use GD.&nbsp; When using the current GD methodologies, you are reading content from an image and manipulating it.&nbsp; By then writing that content to a brand new file, you are losing the EXIF data.<br />
<br />
For purposes when you want to retain EXIF data, it is recommended that you compile in and use the PECL Imagick extension.&nbsp; It has great resizing methods built right in and the EXIF data is retained.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86564""></a>
  <div class="note">
   <strong class="user">code at ashleyhunt dot co dot uk</strong>
   <a href="#86564" class="date">24-Oct-2008 03:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I have been looking to send the output from GD to a text string without proxying via a file or to a browser.<br />
<br />
I have come up with a solution.<br />
<br />
This code buffers the output between the ob_start() and ob_end() functions into ob_get_contents()<br />
<br />
See the example below<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// Create a test source image for this example<br />
</span><span class="default">$im </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">300</span><span class="keyword">, </span><span class="default">50</span><span class="keyword">);<br />
</span><span class="default">$text_color </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">233</span><span class="keyword">, </span><span class="default">14</span><span class="keyword">, </span><span class="default">91</span><span class="keyword">);<br />
</span><span class="default">imagestring</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">, </span><span class="default">5</span><span class="keyword">, </span><span class="default">5</span><span class="keyword">,&nbsp; </span><span class="string">'A Simple Text String'</span><span class="keyword">, </span><span class="default">$text_color</span><span class="keyword">);<br />
<br />
</span><span class="comment">// start buffering<br />
</span><span class="default">ob_start</span><span class="keyword">();<br />
</span><span class="comment">// output jpeg (or any other chosen) format &amp; quality<br />
</span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">NULL</span><span class="keyword">, </span><span class="default">85</span><span class="keyword">);<br />
</span><span class="comment">// capture output to string<br />
</span><span class="default">$contents </span><span class="keyword">= </span><span class="default">ob_get_contents</span><span class="keyword">();<br />
</span><span class="comment">// end capture<br />
</span><span class="default">ob_end_clean</span><span class="keyword">();<br />
<br />
</span><span class="comment">// be tidy; free up memory<br />
</span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br />
<br />
</span><span class="comment">// lastly (for the example) we are writing the string to a file<br />
</span><span class="default">$fh </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="string">"./temp/img.jpg"</span><span class="keyword">, </span><span class="string">"a+" </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">( </span><span class="default">$fh</span><span class="keyword">, </span><span class="default">$contents </span><span class="keyword">);<br />
</span><span class="default">fclose</span><span class="keyword">( </span><span class="default">$fh </span><span class="keyword">);<br />
</span><span class="default">?&gt;</span> <br />
<br />
Enjoy!<br />
Ashley</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
