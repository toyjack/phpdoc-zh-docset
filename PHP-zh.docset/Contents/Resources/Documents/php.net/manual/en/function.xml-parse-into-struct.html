<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>将 XML 数据解析到数组中</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.xml-get-error-code.html">? xml_get_error_code</a></li>
      <li style="float: right;"><a href="function.xml-parse.html">xml_parse ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.xml.html">XML 解析器函数</a></li>
    <li>将 XML 数据解析到数组中</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.xml-parse-into-struct" class="refentry">
   <div class="refnamediv">
    <h1 class="refname">xml_parse_into_struct</h1>
    <p class="verinfo">(PHP 4, PHP 5)</p><p class="refpurpose"><span class="refname">xml_parse_into_struct</span> &mdash; <span class="dc-title">将 XML 数据解析到数组中</span></p>

   </div>
   <div class="refsect1 unknown-seealsp" id="refsect1-function.xml-parse-into-struct-unknown-seealsp">
    <h3 class="title">说明</h3>
    <div class="methodsynopsis dc-description">
     <span class="type">int</span> <span class="methodname"><strong>xml_parse_into_struct</strong></span>
      ( <span class="methodparam"><span class="type">resource</span> <code class="parameter">$parser</code></span>
     , <span class="methodparam"><span class="type">string</span> <code class="parameter">$data</code></span>
     , <span class="methodparam"><span class="type">array</span> <code class="parameter reference">&$values</code></span>
     [, <span class="methodparam"><span class="type">array</span> <code class="parameter reference">&$index</code></span>
    ] )</div>

    <p class="para rdfs-comment">
     该函数将 XML 文件解析到两个对应的数组中，<code class="parameter">index</code>
     参数含有指向 <code class="parameter">values</code>
     数组中对应值的指针。最后两个数组参数可由指针传递给函数。
    </p>
    <blockquote class="note"><p><strong class="note">Note</strong>: 
     <p class="para">
      <span class="function"><strong>xml_parse_into_struct()</strong></span> 失败返回 0，成功返回
      1。这和 <strong><code>FALSE</code></strong> 与
      <strong><code>TRUE</code></strong> 不同，使用例如 === 的运算符时要注意。
     </p>
    </p></blockquote>
    <p class="para">
     以下范例显示了由该函数生成的数组的内部结构。我们简单地将一个
     <em>note</em> 嵌入到一个 <em>para</em>
     标记中，解析后我们可以打印出生成的数组的结构：
     <div class="example" id="example-5517">
      <p><strong>Example #1 <span class="function"><strong>xml_parse_into_struct()</strong></span> 示例</strong></p>
      <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$simple&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"&lt;para&gt;&lt;note&gt;simple&nbsp;note&lt;/note&gt;&lt;/para&gt;"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$p&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">xml_parser_create</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">xml_parse_into_struct</span><span style="color: #007700">(</span><span style="color: #0000BB">$p</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$simple</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$vals</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$index</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">xml_parser_free</span><span style="color: #007700">(</span><span style="color: #0000BB">$p</span><span style="color: #007700">);<br />echo&nbsp;</span><span style="color: #DD0000">"Index&nbsp;array\n"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">print_r</span><span style="color: #007700">(</span><span style="color: #0000BB">$index</span><span style="color: #007700">);<br />echo&nbsp;</span><span style="color: #DD0000">"\nVals&nbsp;array\n"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">print_r</span><span style="color: #007700">(</span><span style="color: #0000BB">$vals</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
      </div>

     <div class="example-contents"><p>
     运行以上代码，我们得到的输出将是：
     </p></div>
      <div class="example-contents screen">
<div class="cdata"><pre>
Index array
Array
(
    [PARA] =&gt; Array
        (
            [0] =&gt; 0
            [1] =&gt; 2
        )

    [NOTE] =&gt; Array
        (
            [0] =&gt; 1
        )

)

Vals array
Array
(
    [0] =&gt; Array
        (
            [tag] =&gt; PARA
            [type] =&gt; open
            [level] =&gt; 1
        )

    [1] =&gt; Array
        (
            [tag] =&gt; NOTE
            [type] =&gt; complete
            [level] =&gt; 2
            [value] =&gt; simple note
        )

    [2] =&gt; Array
        (
            [tag] =&gt; PARA
            [type] =&gt; close
            [level] =&gt; 1
        )

)
</pre></div>
      </div>
     </div>
    </p>
    <p class="para">
     如果您的 XML 文档很复杂，基于该文档的事件处理（Event-driven）解析（基于 expat 扩展库）也会对应的变得复杂。该函数生成的并非 DOM 风格的对象，而是横向的树状结构。因此，我们能够方便的建立表达 XML 文件数据的对象。我们假设以下 XML 文件表示一个关于氨基酸信息的小型数据库：
     <div class="example" id="example-5518">
      <p><strong>Example #2 moldb.xml - 分子信息的小型数据库</strong></p>
      <div class="example-contents">
<div class="xmlcode"><pre class="xmlcode">&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;moldb&gt;

    &lt;molecule&gt;
        &lt;name&gt;Alanine&lt;/name&gt;
        &lt;symbol&gt;ala&lt;/symbol&gt;
        &lt;code&gt;A&lt;/code&gt;
        &lt;type&gt;hydrophobic&lt;/type&gt;
    &lt;/molecule&gt;

    &lt;molecule&gt;
        &lt;name&gt;Lysine&lt;/name&gt;
        &lt;symbol&gt;lys&lt;/symbol&gt;
        &lt;code&gt;K&lt;/code&gt;
        &lt;type&gt;charged&lt;/type&gt;
    &lt;/molecule&gt;

&lt;/moldb&gt;</pre>
</div>
      </div>

     </div>
     以下是解析该文档并生成相应对象的代码：
     <div class="example" id="example-5519">
      <p><strong>Example #3 
       parsemoldb.php - 将 moldb.xml 解析到分子（molecular）对象的数组中
      </strong></p>
      <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br /></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">AminoAcid&nbsp;</span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;</span><span style="color: #0000BB">$name</span><span style="color: #007700">;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;aa&nbsp;姓名<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">var&nbsp;</span><span style="color: #0000BB">$symbol</span><span style="color: #007700">;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;三字母符号<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">var&nbsp;</span><span style="color: #0000BB">$code</span><span style="color: #007700">;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;单字母代码<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">var&nbsp;</span><span style="color: #0000BB">$type</span><span style="color: #007700">;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;hydrophobic,&nbsp;charged&nbsp;或&nbsp;neutral<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">function&nbsp;</span><span style="color: #0000BB">AminoAcid&nbsp;</span><span style="color: #007700">(</span><span style="color: #0000BB">$aa</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;(</span><span style="color: #0000BB">$aa&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$k</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$v</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">$k&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$aa</span><span style="color: #007700">[</span><span style="color: #0000BB">$k</span><span style="color: #007700">];<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /><br />function&nbsp;</span><span style="color: #0000BB">readDatabase</span><span style="color: #007700">(</span><span style="color: #0000BB">$filename</span><span style="color: #007700">)<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;读取&nbsp;aminoacids&nbsp;的&nbsp;XML&nbsp;数据<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$data&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">implode</span><span style="color: #007700">(</span><span style="color: #DD0000">""</span><span style="color: #007700">,</span><span style="color: #0000BB">file</span><span style="color: #007700">(</span><span style="color: #0000BB">$filename</span><span style="color: #007700">));<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$parser&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">xml_parser_create</span><span style="color: #007700">();<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">xml_parser_set_option</span><span style="color: #007700">(</span><span style="color: #0000BB">$parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">XML_OPTION_CASE_FOLDING</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">xml_parser_set_option</span><span style="color: #007700">(</span><span style="color: #0000BB">$parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">XML_OPTION_SKIP_WHITE</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">xml_parse_into_struct</span><span style="color: #007700">(</span><span style="color: #0000BB">$parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$data</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$values</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$tags</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">xml_parser_free</span><span style="color: #007700">(</span><span style="color: #0000BB">$parser</span><span style="color: #007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;遍历&nbsp;XML&nbsp;结构<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">foreach&nbsp;(</span><span style="color: #0000BB">$tags&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$key</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$val</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$key&nbsp;</span><span style="color: #007700">==&nbsp;</span><span style="color: #DD0000">"molecule"</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$molranges&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$val</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;each&nbsp;contiguous&nbsp;pair&nbsp;of&nbsp;array&nbsp;entries&nbsp;are&nbsp;the<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;lower&nbsp;and&nbsp;upper&nbsp;range&nbsp;for&nbsp;each&nbsp;molecule&nbsp;definition<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">for&nbsp;(</span><span style="color: #0000BB">$i</span><span style="color: #007700">=</span><span style="color: #0000BB">0</span><span style="color: #007700">;&nbsp;</span><span style="color: #0000BB">$i&nbsp;</span><span style="color: #007700">&lt;&nbsp;</span><span style="color: #0000BB">count</span><span style="color: #007700">(</span><span style="color: #0000BB">$molranges</span><span style="color: #007700">);&nbsp;</span><span style="color: #0000BB">$i</span><span style="color: #007700">+=</span><span style="color: #0000BB">2</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$offset&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$molranges</span><span style="color: #007700">[</span><span style="color: #0000BB">$i</span><span style="color: #007700">]&nbsp;+&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$len&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$molranges</span><span style="color: #007700">[</span><span style="color: #0000BB">$i&nbsp;</span><span style="color: #007700">+&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">]&nbsp;-&nbsp;</span><span style="color: #0000BB">$offset</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$tdb</span><span style="color: #007700">[]&nbsp;=&nbsp;</span><span style="color: #0000BB">parseMol</span><span style="color: #007700">(</span><span style="color: #0000BB">array_slice</span><span style="color: #007700">(</span><span style="color: #0000BB">$values</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$offset</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$len</span><span style="color: #007700">));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$tdb</span><span style="color: #007700">;<br />}<br /><br />function&nbsp;</span><span style="color: #0000BB">parseMol</span><span style="color: #007700">(</span><span style="color: #0000BB">$mvalues</span><span style="color: #007700">)<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(</span><span style="color: #0000BB">$i</span><span style="color: #007700">=</span><span style="color: #0000BB">0</span><span style="color: #007700">;&nbsp;</span><span style="color: #0000BB">$i&nbsp;</span><span style="color: #007700">&lt;&nbsp;</span><span style="color: #0000BB">count</span><span style="color: #007700">(</span><span style="color: #0000BB">$mvalues</span><span style="color: #007700">);&nbsp;</span><span style="color: #0000BB">$i</span><span style="color: #007700">++)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$mol</span><span style="color: #007700">[</span><span style="color: #0000BB">$mvalues</span><span style="color: #007700">[</span><span style="color: #0000BB">$i</span><span style="color: #007700">][</span><span style="color: #DD0000">"tag"</span><span style="color: #007700">]]&nbsp;=&nbsp;</span><span style="color: #0000BB">$mvalues</span><span style="color: #007700">[</span><span style="color: #0000BB">$i</span><span style="color: #007700">][</span><span style="color: #DD0000">"value"</span><span style="color: #007700">];<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;</span><span style="color: #0000BB">AminoAcid</span><span style="color: #007700">(</span><span style="color: #0000BB">$mol</span><span style="color: #007700">);<br />}<br /><br /></span><span style="color: #0000BB">$db&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">readDatabase</span><span style="color: #007700">(</span><span style="color: #DD0000">"moldb.xml"</span><span style="color: #007700">);<br />echo&nbsp;</span><span style="color: #DD0000">"**&nbsp;Database&nbsp;of&nbsp;AminoAcid&nbsp;objects:\n"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">print_r</span><span style="color: #007700">(</span><span style="color: #0000BB">$db</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
      </div>

     </div>
     在执行完 <var class="filename">parsemoldb.php</var> 后，变量 <var class="varname"><var class="varname">$db</var></var> 将包含有一个由 <strong class="classname">AminoAcid</strong> 对象组成的数组，该脚本的输出如下：
     <div class="informalexample">
      <div class="example-contents screen">
<div class="cdata"><pre>
** Database of AminoAcid objects:
Array
(
    [0] =&gt; aminoacid Object
        (
            [name] =&gt; Alanine
            [symbol] =&gt; ala
            [code] =&gt; A
            [type] =&gt; hydrophobic
        )

    [1] =&gt; aminoacid Object
        (
            [name] =&gt; Lysine
            [symbol] =&gt; lys
            [code] =&gt; K
            [type] =&gt; charged
        )

)
</pre></div>
      </div>
     </div>
    </p>
   </div>

  </div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="114907""></a>
  <div class="note">
   <strong class="user">gramo dot gnu at gmail dot com</strong>
   <a href="#114907" class="date">24-Apr-2014 01:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I really need to make the "xml_parse_into_array" function, and I figured out this "recursive function" solution. (I just test that with ISO-8859-1 charset, but I think it works with ASCII and UTF-8)<br />
<br />
/*------------------------------------------------------------------*/<br />
function xml_parse_into_array($xml)<br />
/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br />
DESCRIPCION:<br />
Convierte un texto en xml codificado en ISO-8859-1 a un arreglo de php.<br />
--------------------------------------------------------------------*/<br />
{<br />
&nbsp;&nbsp;&nbsp; $retorno = array();<br />
<br />
&nbsp;&nbsp;&nbsp; $p = xml_parser_create();<br />
&nbsp;&nbsp;&nbsp; xml_parser_set_option($p, XML_OPTION_TARGET_ENCODING, "ISO-8859-1");<br />
&nbsp;&nbsp;&nbsp; xml_parser_set_option($p, XML_OPTION_CASE_FOLDING, 0);<br />
&nbsp;&nbsp;&nbsp; xml_parser_set_option($p, XML_OPTION_SKIP_WHITE, 1);<br />
&nbsp;&nbsp;&nbsp; xml_parse_into_struct($p, $xml, $elementos, $llaves);<br />
&nbsp;&nbsp;&nbsp; xml_parser_free($p);<br />
<br />
&nbsp;&nbsp;&nbsp; $Qprocesados = 0;<br />
&nbsp;&nbsp;&nbsp; $retorno = xml_sub_parse_into_array($elementos, $Qprocesados);<br />
<br />
&nbsp;&nbsp;&nbsp; return array($retorno, $Qprocesados);<br />
}<br />
<br />
/*------------------------------------------------------------------*/<br />
function xml_sub_parse_into_array($xml, &amp;$i, $abierto = null)<br />
/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br />
DESCRIPCION:<br />
--------------------------------------------------------------------*/<br />
{<br />
&nbsp;&nbsp;&nbsp; $retorno = array();<br />
<br />
&nbsp;&nbsp;&nbsp; //----------------------------------------<br />
&nbsp;&nbsp;&nbsp; // Caso trivial: TAG COMPLETO<br />
&nbsp;&nbsp;&nbsp; //----------------------------------------<br />
&nbsp;&nbsp;&nbsp; if ($xml[$i]['type'] == 'complete' &amp;&amp; isset($xml[$i]['value'])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $retorno[$xml[$i]['tag']] = trim($xml[$i]['value']);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $i ++;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return $retorno;<br />
&nbsp;&nbsp;&nbsp; //----------------------------------------<br />
&nbsp;&nbsp;&nbsp; // Caso trivial: TAG COMPLETO<br />
&nbsp;&nbsp;&nbsp; //----------------------------------------<br />
&nbsp;&nbsp;&nbsp; } else if ($xml[$i]['type'] == 'cdata' &amp;&amp; isset($xml[$i]['value'])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $retorno = trim($xml[$i]['value']);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $i ++;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return $retorno;<br />
&nbsp;&nbsp;&nbsp; //----------------------------------------<br />
&nbsp;&nbsp;&nbsp; // Caso trivial: TAG VACIO<br />
&nbsp;&nbsp;&nbsp; //----------------------------------------<br />
&nbsp;&nbsp;&nbsp; } else if ($xml[$i]['type'] == 'complete') {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // $retorno = "&lt;".$xml[$i]['tag']." /&gt;";<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $retorno[$xml[$i]['tag']] = null;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $i ++;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return $retorno;<br />
&nbsp;&nbsp;&nbsp; //----------------------------------------<br />
&nbsp;&nbsp;&nbsp; // Caso recursivo: TAG CON TAGS ADENTRO<br />
&nbsp;&nbsp;&nbsp; //----------------------------------------<br />
&nbsp;&nbsp;&nbsp; } else if ($xml[$i]['type'] == 'open') {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $abierto = $xml[$i]['tag'];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $nivel&nbsp;&nbsp; = $xml[$i]['level'];<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!isset($retorno[$abierto]))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $retorno[$abierto] = array();<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (isset($xml[$i]['value'])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $retorno[$abierto][] = trim($xml[$i]['value']);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $i ++;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $termino = false;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while (!$termino &amp;&amp; $i &lt; count($xml)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($xml[$i]['tag'] == $abierto &amp;&amp;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $xml[$i]['type'] == 'close' &amp;&amp;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $xml[$i]['level'] == $nivel ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $termino = true;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $retorno[$abierto][] = xml_sub_parse_into_array($xml, $i, $abierto);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($i &lt; count($xml))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($xml[$i]['type'] == 'close') {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $i ++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return $retorno;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return $retorno;<br />
&nbsp;&nbsp;&nbsp; }<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="113951""></a>
  <div class="note">
   <strong class="user">rejeesh_designdirect at yahoo dot com</strong>
   <a href="#113951" class="date">21-Dec-2013 06:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Simple method for format XML to Array<br />
<br />
function xml2array($xml){<br />
&nbsp;&nbsp;&nbsp; $opened = array();<br />
&nbsp;&nbsp;&nbsp; $xml_parser = xml_parser_create();<br />
&nbsp;&nbsp;&nbsp; xml_parse_into_struct($xml_parser, $xml, $xmlarray);<br />
&nbsp;&nbsp;&nbsp; $array = array();<br />
&nbsp;&nbsp;&nbsp; $arrsize = sizeof($xmlarray);<br />
&nbsp;&nbsp;&nbsp; for($j=0;$j&lt;$arrsize;$j++){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $val = $xmlarray[$j];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; switch($val["type"]){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case "open":<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $opened[$val["tag"]] = $array;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; unset($array);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case "complete":<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $array[$val["tag"]][] = $val["value"];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case "close":<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $opened[$val["tag"]] = $array;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $array = $opened;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return $array;<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="109032""></a>
  <div class="note">
   <strong class="user">andy at andynformatics dot de</strong>
   <a href="#109032" class="date">14-Jun-2012 09:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To get out of an XML-Structure like this:
<br />
&lt;root&gt;&lt;element&gt;&lt;subelement attribute="value"&gt;some text&lt;/subelement&gt;&lt;/element&gt;&lt;anotherelement&gt;Hello World&lt;/anotherelement&gt;&lt;/root&gt;
<br />
something like this:
<br />

<br />
Array
<br />
(
<br />
&nbsp;&nbsp;&nbsp; [tag] =&gt; ROOT
<br />
&nbsp;&nbsp;&nbsp; [0] =&gt; Array
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [tag] =&gt; ELEMENT
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [0] =&gt; Array
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [tag] =&gt; SUBELEMENT
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [attributes] =&gt; Array
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [ATTRIBUTE] =&gt; value
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [value] =&gt; some text
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )
<br />

<br />
&nbsp;&nbsp;&nbsp; [1] =&gt; Array
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [tag] =&gt; ANOTHERELEMENT
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [value] =&gt; Hello World
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )
<br />

<br />
)
<br />

<br />
I have written a short and pretty simple function:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">xml2array</span><span class="keyword">(</span><span class="default">$xml</span><span class="keyword">){
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$opened </span><span class="keyword">= array();
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$opened</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] = </span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$xml_parser </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">();
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">xml_parse_into_struct</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">, </span><span class="default">$xml</span><span class="keyword">, </span><span class="default">$xmlarray</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$array </span><span class="keyword">= </span><span class="default">array_shift</span><span class="keyword">(</span><span class="default">$xmlarray</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; unset(</span><span class="default">$array</span><span class="keyword">[</span><span class="string">"level"</span><span class="keyword">]);
<br />
&nbsp;&nbsp;&nbsp; unset(</span><span class="default">$array</span><span class="keyword">[</span><span class="string">"type"</span><span class="keyword">]);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$arrsize </span><span class="keyword">= </span><span class="default">sizeof</span><span class="keyword">(</span><span class="default">$xmlarray</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; for(</span><span class="default">$j</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$j</span><span class="keyword">&lt;</span><span class="default">$arrsize</span><span class="keyword">;</span><span class="default">$j</span><span class="keyword">++){
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$val </span><span class="keyword">= </span><span class="default">$xmlarray</span><span class="keyword">[</span><span class="default">$j</span><span class="keyword">];
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; switch(</span><span class="default">$val</span><span class="keyword">[</span><span class="string">"type"</span><span class="keyword">]){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">"open"</span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$opened</span><span class="keyword">[</span><span class="default">$val</span><span class="keyword">[</span><span class="string">"level"</span><span class="keyword">]]=</span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">"complete"</span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$index </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for(</span><span class="default">$i </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; (</span><span class="default">$val</span><span class="keyword">[</span><span class="string">"level"</span><span class="keyword">]); </span><span class="default">$i</span><span class="keyword">++)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$index </span><span class="keyword">.= </span><span class="string">"[" </span><span class="keyword">. </span><span class="default">$opened</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] . </span><span class="string">"]"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$path </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">']['</span><span class="keyword">, </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$index</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">, -</span><span class="default">1</span><span class="keyword">));
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$value </span><span class="keyword">= &amp;</span><span class="default">$array</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$path </span><span class="keyword">as </span><span class="default">$segment</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$value </span><span class="keyword">= &amp;</span><span class="default">$value</span><span class="keyword">[</span><span class="default">$segment</span><span class="keyword">];
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$value </span><span class="keyword">= </span><span class="default">$val</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; unset(</span><span class="default">$value</span><span class="keyword">[</span><span class="string">"level"</span><span class="keyword">]);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; unset(</span><span class="default">$value</span><span class="keyword">[</span><span class="string">"type"</span><span class="keyword">]);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$val</span><span class="keyword">[</span><span class="string">"type"</span><span class="keyword">] == </span><span class="string">"complete"</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$opened</span><span class="keyword">[</span><span class="default">$val</span><span class="keyword">[</span><span class="string">"level"</span><span class="keyword">]-</span><span class="default">1</span><span class="keyword">]++;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">"close"</span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$opened</span><span class="keyword">[</span><span class="default">$val</span><span class="keyword">[</span><span class="string">"level"</span><span class="keyword">]-</span><span class="default">1</span><span class="keyword">]++;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; unset(</span><span class="default">$opened</span><span class="keyword">[</span><span class="default">$val</span><span class="keyword">[</span><span class="string">"level"</span><span class="keyword">]]);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$array</span><span class="keyword">;
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="94263""></a>
  <div class="note">
   <strong class="user">sujithfem at gmail dot com</strong>
   <a href="#94263" class="date">26-Oct-2009 10:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
following function use to get the value for given XML tag
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">getXmlValueByTag</span><span class="keyword">(</span><span class="default">$inXmlset</span><span class="keyword">,</span><span class="default">$needle</span><span class="keyword">){
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$resource&nbsp; &nbsp; </span><span class="keyword">=&nbsp; &nbsp; </span><span class="default">xml_parser_create</span><span class="keyword">();</span><span class="comment">//Create an XML parser
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_parse_into_struct</span><span class="keyword">(</span><span class="default">$resource</span><span class="keyword">, </span><span class="default">$inXmlset</span><span class="keyword">, </span><span class="default">$outArray</span><span class="keyword">);</span><span class="comment">// Parse XML data into an array structure
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$resource</span><span class="keyword">);</span><span class="comment">//Free an XML parser
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">count</span><span class="keyword">(</span><span class="default">$outArray</span><span class="keyword">);</span><span class="default">$i</span><span class="keyword">++){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$outArray</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][</span><span class="string">'tag'</span><span class="keyword">]==</span><span class="default">strtoupper</span><span class="keyword">(</span><span class="default">$needle</span><span class="keyword">)){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tagValue&nbsp; &nbsp; </span><span class="keyword">=&nbsp; &nbsp; </span><span class="default">$outArray</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][</span><span class="string">'value'</span><span class="keyword">];
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$tagValue</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">getXmlValueByTag</span><span class="keyword">(</span><span class="default">$inXmlset</span><span class="keyword">,</span><span class="default">$needle</span><span class="keyword">);
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="90622""></a>
  <div class="note">
   <strong class="user">Adam Tylmad</strong>
   <a href="#90622" class="date">30-Apr-2009 09:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Thanx to jukea i've upgraded the characterData-function to allow the value 0. Here is the new complete code:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">class </span><span class="default">XMLParser </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$path</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$result</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">cleanString</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">trim</span><span class="keyword">(</span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"'"</span><span class="keyword">, </span><span class="string">"&amp;#39;"</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">XMLParser</span><span class="keyword">(</span><span class="default">$encoding</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">path </span><span class="keyword">= </span><span class="string">"\$this-&gt;result"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">index </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$xml_parser </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">(</span><span class="default">$encoding</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_set_object</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">, &amp;</span><span class="default">$this</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_set_element_handler</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">, </span><span class="string">'startElement'</span><span class="keyword">, </span><span class="string">'endElement'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_set_character_data_handler</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">, </span><span class="string">'characterData'</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_parse</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">startElement</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$tag</span><span class="keyword">, </span><span class="default">$attributeList</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">path </span><span class="keyword">.= </span><span class="string">"-&gt;"</span><span class="keyword">.</span><span class="default">$tag</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; eval(</span><span class="string">"\$data = "</span><span class="keyword">.</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">path</span><span class="keyword">.</span><span class="string">";"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$index </span><span class="keyword">= </span><span class="default">sizeof</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">path </span><span class="keyword">.= </span><span class="string">"["</span><span class="keyword">.</span><span class="default">$index</span><span class="keyword">.</span><span class="string">"]"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else if (</span><span class="default">is_object</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; eval(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">path</span><span class="keyword">.</span><span class="string">" = array("</span><span class="keyword">.</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">path</span><span class="keyword">.</span><span class="string">");"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">path </span><span class="keyword">.= </span><span class="string">"[1]"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$attributeList </span><span class="keyword">as </span><span class="default">$name </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; eval(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">path</span><span class="keyword">.</span><span class="string">"-&gt;"</span><span class="keyword">.</span><span class="default">$name</span><span class="keyword">. </span><span class="string">" = '"</span><span class="keyword">.</span><span class="default">XMLParser</span><span class="keyword">::</span><span class="default">cleanString</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">).</span><span class="string">"';"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">endElement</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$tag</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">path </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">path</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">strrpos</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">path</span><span class="keyword">, </span><span class="string">"-&gt;"</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">characterData</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$data </span><span class="keyword">= </span><span class="default">XMLParser</span><span class="keyword">::</span><span class="default">cleanString</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">)))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; eval(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">path</span><span class="keyword">.</span><span class="string">" = '</span><span class="default">$data</span><span class="string">';"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="90621""></a>
  <div class="note">
   <strong class="user">Adam Tylmad</strong>
   <a href="#90621" class="date">30-Apr-2009 09:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Thanx to jukea i've upgraded the characterData-function to allow the value 0. Here is the new complete code:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">class </span><span class="default">XMLParser </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$path</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$result</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">cleanString</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">trim</span><span class="keyword">(</span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"'"</span><span class="keyword">, </span><span class="string">"&amp;#39;"</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">XMLParser</span><span class="keyword">(</span><span class="default">$encoding</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">path </span><span class="keyword">= </span><span class="string">"\$this-&gt;result"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">index </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$xml_parser </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">(</span><span class="default">$encoding</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_set_object</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">, &amp;</span><span class="default">$this</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_set_element_handler</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">, </span><span class="string">'startElement'</span><span class="keyword">, </span><span class="string">'endElement'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_set_character_data_handler</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">, </span><span class="string">'characterData'</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_parse</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">startElement</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$tag</span><span class="keyword">, </span><span class="default">$attributeList</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">path </span><span class="keyword">.= </span><span class="string">"-&gt;"</span><span class="keyword">.</span><span class="default">$tag</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; eval(</span><span class="string">"\$data = "</span><span class="keyword">.</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">path</span><span class="keyword">.</span><span class="string">";"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$index </span><span class="keyword">= </span><span class="default">sizeof</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">path </span><span class="keyword">.= </span><span class="string">"["</span><span class="keyword">.</span><span class="default">$index</span><span class="keyword">.</span><span class="string">"]"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else if (</span><span class="default">is_object</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; eval(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">path</span><span class="keyword">.</span><span class="string">" = array("</span><span class="keyword">.</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">path</span><span class="keyword">.</span><span class="string">");"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">path </span><span class="keyword">.= </span><span class="string">"[1]"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$attributeList </span><span class="keyword">as </span><span class="default">$name </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; eval(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">path</span><span class="keyword">.</span><span class="string">"-&gt;"</span><span class="keyword">.</span><span class="default">$name</span><span class="keyword">. </span><span class="string">" = '"</span><span class="keyword">.</span><span class="default">XMLParser</span><span class="keyword">::</span><span class="default">cleanString</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">).</span><span class="string">"';"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">endElement</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$tag</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">path </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">path</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">strrpos</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">path</span><span class="keyword">, </span><span class="string">"-&gt;"</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">characterData</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$data </span><span class="keyword">= </span><span class="default">XMLParser</span><span class="keyword">::</span><span class="default">cleanString</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">)))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; eval(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">path</span><span class="keyword">.</span><span class="string">" = '</span><span class="default">$data</span><span class="string">';"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="87304""></a>
  <div class="note">
   <strong class="user">aerik at thesylvans dot com</strong>
   <a href="#87304" class="date">29-Nov-2008 12:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's another attempt at dealing with rebuilding the xml from the array.&nbsp; I'm basically preventing certain tags from being self closing by just checking for them explicitly (sure wish expat didn't interpret &lt;textarea /&gt; and &lt;textarea&gt;&lt;/textarea&gt; the same way (as "complete" tags).
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">array2xml</span><span class="keyword">(</span><span class="default">$xmlary</span><span class="keyword">){
<br />
&nbsp; </span><span class="default">$o</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">;
<br />
&nbsp; foreach(</span><span class="default">$xmlary </span><span class="keyword">as </span><span class="default">$tag </span><span class="keyword">){
<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">] == </span><span class="string">'textarea' </span><span class="keyword">&amp;&amp; !isset(</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">])){
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="comment">//fake a value so it won't self close
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">]=</span><span class="string">''</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//tab space:
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$t </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'level'</span><span class="keyword">];</span><span class="default">$i</span><span class="keyword">++){
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$t</span><span class="keyword">.=</span><span class="string">"\t"</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; switch(</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">]){
<br />
&nbsp;&nbsp; &nbsp;&nbsp; case </span><span class="string">'complete'</span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp;&nbsp; case </span><span class="string">'open'</span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$o</span><span class="keyword">.=</span><span class="default">$t</span><span class="keyword">.</span><span class="string">'&lt;'</span><span class="keyword">.</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">];
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(isset(</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'attributes'</span><span class="keyword">])){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'attributes'</span><span class="keyword">] as </span><span class="default">$attr</span><span class="keyword">=&gt;</span><span class="default">$aval</span><span class="keyword">){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$o</span><span class="keyword">.=</span><span class="string">' '</span><span class="keyword">.</span><span class="default">$attr</span><span class="keyword">.</span><span class="string">'="'</span><span class="keyword">.</span><span class="default">$aval</span><span class="keyword">.</span><span class="string">'"'</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }</span><span class="comment">//foreach
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">}</span><span class="comment">//attributes
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">'complete'</span><span class="keyword">){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(!isset(</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">])){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$o </span><span class="keyword">.= </span><span class="string">' /&gt;'</span><span class="keyword">.</span><span class="string">"\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$o </span><span class="keyword">.= </span><span class="string">'&gt;'</span><span class="keyword">.</span><span class="string">"\n"</span><span class="keyword">.</span><span class="default">$t</span><span class="keyword">.</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">].</span><span class="string">"\n"</span><span class="keyword">.</span><span class="default">$t</span><span class="keyword">.</span><span class="string">'&lt;/'</span><span class="keyword">.</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">].</span><span class="string">'&gt;'</span><span class="keyword">.</span><span class="string">"\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }else{
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$o </span><span class="keyword">.= </span><span class="string">'&gt;'</span><span class="keyword">.</span><span class="string">"\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; break;
<br />
&nbsp;&nbsp; &nbsp;&nbsp; case </span><span class="string">'close'</span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$o </span><span class="keyword">.= </span><span class="default">$t</span><span class="keyword">.</span><span class="string">'&lt;/'</span><span class="keyword">.</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">].</span><span class="string">'&gt;'</span><span class="keyword">.</span><span class="string">"\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; break;
<br />
&nbsp;&nbsp; &nbsp;&nbsp; case </span><span class="string">'cdata'</span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$o </span><span class="keyword">.= </span><span class="default">$t</span><span class="keyword">.</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">].</span><span class="string">"\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; break;
<br />
&nbsp;&nbsp;&nbsp; }</span><span class="comment">//switch
<br />
&nbsp; </span><span class="keyword">}</span><span class="comment">//foreach
<br />
</span><span class="keyword">}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86777""></a>
  <div class="note">
   <strong class="user">lpatrick</strong>
   <a href="#86777" class="date">03-Nov-2008 01:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
@ dale at ucsc dot edu<br />
I modified your code for entries like &lt;caption&gt;Value&lt;/caption&gt;<br />
<span class="default">&lt;?php<br />
$o</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">;<br />
foreach( </span><span class="default">$vals </span><span class="keyword">as </span><span class="default">$tag </span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//tab space:<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'level'</span><span class="keyword">];</span><span class="default">$i</span><span class="keyword">++)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$o</span><span class="keyword">.=</span><span class="string">"\t"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">]!=</span><span class="string">'close'</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">]!=</span><span class="string">'cdata'</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$o</span><span class="keyword">.=</span><span class="string">'&lt;'</span><span class="keyword">.</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(isset(</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'attributes'</span><span class="keyword">])){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'attributes'</span><span class="keyword">] as </span><span class="default">$attr</span><span class="keyword">=&gt;</span><span class="default">$aval</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$o</span><span class="keyword">.=</span><span class="string">' '</span><span class="keyword">.</span><span class="default">$attr</span><span class="keyword">.</span><span class="string">'="'</span><span class="keyword">.</span><span class="default">$aval</span><span class="keyword">.</span><span class="string">'"'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">]!=</span><span class="string">'cdata'</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$o</span><span class="keyword">.=(</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">]==</span><span class="string">'complete' </span><span class="keyword">&amp;&amp; (!isset(</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">]) || </span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">]==</span><span class="string">''</span><span class="keyword">))?</span><span class="string">'/&gt;'</span><span class="keyword">:</span><span class="string">'&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$o</span><span class="keyword">.=(isset(</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">]))?</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">]:</span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">]!=</span><span class="string">'cdata'</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$o</span><span class="keyword">.=(</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">]==</span><span class="string">'complete' </span><span class="keyword">&amp;&amp; (isset(</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">]) &amp;&amp; </span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">]&lt;&gt;</span><span class="string">''</span><span class="keyword">))?</span><span class="string">'&lt;/'</span><span class="keyword">.</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">].</span><span class="string">'&gt;'</span><span class="keyword">:</span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$o</span><span class="keyword">.=</span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }else{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$o</span><span class="keyword">.=</span><span class="string">'&lt;/'</span><span class="keyword">.</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">].</span><span class="string">'&gt;'</span><span class="keyword">.</span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85948""></a>
  <div class="note">
   <strong class="user">dale at ucsc dot edu</strong>
   <a href="#85948" class="date">26-Sep-2008 01:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
here you can [re]assemble xml from a xml_parse_into_struct generated array: ie array2xml
<br />

<br />
<span class="default">&lt;?php
<br />
$xml_parser </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">( </span><span class="string">'UTF-8' </span><span class="keyword">); </span><span class="comment">// UTF-8 or ISO-8859-1
<br />
</span><span class="default">xml_parser_set_option</span><span class="keyword">( </span><span class="default">$xml_parser</span><span class="keyword">, </span><span class="default">XML_OPTION_CASE_FOLDING</span><span class="keyword">, </span><span class="default">0 </span><span class="keyword">);
<br />
</span><span class="default">xml_parser_set_option</span><span class="keyword">( </span><span class="default">$xml_parser</span><span class="keyword">, </span><span class="default">XML_OPTION_SKIP_WHITE</span><span class="keyword">, </span><span class="default">1 </span><span class="keyword">);
<br />
</span><span class="default">xml_parse_into_struct</span><span class="keyword">( </span><span class="default">$xml_parser</span><span class="keyword">, </span><span class="default">$my_text_xml</span><span class="keyword">, </span><span class="default">$aryXML </span><span class="keyword">);
<br />
</span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">);
<br />

<br />
</span><span class="comment">//now use aryXML array to xml string:
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$o</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach( </span><span class="default">$aryXML </span><span class="keyword">as </span><span class="default">$tag </span><span class="keyword">){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//tab space:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'level'</span><span class="keyword">];</span><span class="default">$i</span><span class="keyword">++)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$o</span><span class="keyword">.=</span><span class="string">"\t"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">]!=</span><span class="string">'close'</span><span class="keyword">){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">]!=</span><span class="string">'cdata'</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$o</span><span class="keyword">.=</span><span class="string">'&lt;'</span><span class="keyword">.</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">];
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(isset(</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'attributes'</span><span class="keyword">])){&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'attributes'</span><span class="keyword">] as </span><span class="default">$attr</span><span class="keyword">=&gt;</span><span class="default">$aval</span><span class="keyword">){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$o</span><span class="keyword">.=</span><span class="string">' '</span><span class="keyword">.</span><span class="default">$attr</span><span class="keyword">.</span><span class="string">'="'</span><span class="keyword">.</span><span class="default">$aval</span><span class="keyword">.</span><span class="string">'"'</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">]!=</span><span class="string">'cdata'</span><span class="keyword">){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$o</span><span class="keyword">.=(</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">]==</span><span class="string">'complete'</span><span class="keyword">)?</span><span class="string">'/&gt;'</span><span class="keyword">.</span><span class="string">"\n"</span><span class="keyword">:</span><span class="string">'&gt;'</span><span class="keyword">.</span><span class="string">"\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$o</span><span class="keyword">.=(isset(</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">]))?</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">]:</span><span class="string">''</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }else{
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$o</span><span class="keyword">.=</span><span class="string">'&lt;/'</span><span class="keyword">.</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">].</span><span class="string">'&gt;'</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85636""></a>
  <div class="note">
   <strong class="user">Llorenc</strong>
   <a href="#85636" class="date">10-Sep-2008 12:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Sorry, forgot my last post below, I confused CDATA sections (&lt;![CDATA[]]&gt;) with the value type "cdata", which despite its name it's very different! The first allows adding markup (&amp;,&lt;,&gt;) as regular text and the second is to indicate a not complete node between the open and close nodes. What is true is that the CDATA delimiters are lost after xml_parse_into_struct so it's not possible to revert the process.<br />
<br />
Please, feel free to remove my comments or leave them if you think they can help anyone.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85619""></a>
  <div class="note">
   <strong class="user">Llorenc</strong>
   <a href="#85619" class="date">09-Sep-2008 03:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Many examples below using this function check if a given tag returned is of type "cdata". It seems to me nowadays CDATA sections are not detected by all implementations, if any. In the servers I could test (FreeBSD 6.2 with PHP 5.2.6 and libxml 2.6.26 or PHP 4.4.8 and expat 2.0.0 - MacOSX 10.5.4 with PHP 5.2.6 and libxml 2.6.16) my CDATA sections were reported as being of type "complete".<br />
<br />
This problem was reported earlier as a bug (#26188), but was discarded because "the behaviour is quite dependent on the backend XML parsing implementation" (sic).<br />
<br />
So if you want to detect CDATA sections and not depend on a given implementation, you'll have to forget this function and use xml_parse and xml_set_character_data_handler instead.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85102""></a>
  <div class="note">
   <strong class="user">POST at PSPAETH dot DE</strong>
   <a href="#85102" class="date">14-Aug-2008 05:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I wrote a simple function which totally flattens any xml structure. You can then directly get the data or use regular expression functions to fetch data from the output. E.g., if the input is<br />
&nbsp;&nbsp; &lt;gallery xmlns='<a href="http://www.pspaeth.de/joomlaPlugins/psg" rel="nofollow" target="_blank">http://www.pspaeth.de/joomlaPlugins/psg</a>'&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;g imageDir='einsatzGallerie'&gt;&lt;/g&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;caption for="f1.jpg"}This is picture number 1&lt;/caption&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;caption for="f2.jpg"}This is picture number 2&lt;/caption&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;/g&gt;<br />
&nbsp;&nbsp; &lt;/gallery&gt;<br />
the output will be an array:<br />
&nbsp;&nbsp; ['.gallery0@xmlns']=&gt;&nbsp; <br />
&nbsp;&nbsp; &nbsp;&nbsp; ".gallery0@xmlns=<a href="http://www.pspaeth.de/joomlaPlugins/psg" rel="nofollow" target="_blank">http://www.pspaeth.de/joomlaPlugins/psg</a>" <br />
&nbsp;&nbsp; ['.gallery0.g0@imageDir']=&gt;<br />
&nbsp;&nbsp; &nbsp;&nbsp; ".gallery0.g0@imageDir=einsatzGallerie" <br />
&nbsp;&nbsp; ['.gallery0.g0.caption0@for']=&gt;<br />
&nbsp;&nbsp; &nbsp;&nbsp; ".gallery0.g0.caption0@for=f1.jpg" <br />
&nbsp;&nbsp; ['.gallery0.g0.caption0']=&gt;<br />
&nbsp;&nbsp; &nbsp;&nbsp; ".gallery0.g0.caption0=This is picture number 1" <br />
&nbsp;&nbsp; ['.gallery0.g0.caption1@for']=&gt;&nbsp; <br />
&nbsp;&nbsp; &nbsp;&nbsp; ".gallery0.g0.caption1@for=f2.jpg" <br />
&nbsp;&nbsp; ['.gallery0.g0.caption1']=&gt;&nbsp; <br />
&nbsp;&nbsp; &nbsp;&nbsp; ".gallery0.g0.caption1=This is picture number 2" <br />
<br />
Here the code:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">_xmlToArray</span><span class="keyword">(</span><span class="default">$xml</span><span class="keyword">) {<br />
&nbsp;&nbsp; </span><span class="default">$parser </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">(</span><span class="string">'UTF-8'</span><span class="keyword">); </span><span class="comment">// UTF-8 or ISO-8859-1<br />
&nbsp;&nbsp; </span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">XML_OPTION_CASE_FOLDING</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">); <br />
&nbsp;&nbsp; </span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">XML_OPTION_SKIP_WHITE</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">xml_parse_into_struct</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$xml</span><span class="keyword">, </span><span class="default">$values</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; <br />
&nbsp;&nbsp; </span><span class="default">$return </span><span class="keyword">= array();<br />
&nbsp;&nbsp; </span><span class="default">$stack </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp; </span><span class="default">$attrs </span><span class="keyword">= array();<br />
&nbsp;&nbsp; </span><span class="default">$levelCounters </span><span class="keyword">= array(</span><span class="default">0</span><span class="keyword">);<br />
&nbsp;&nbsp; foreach(</span><span class="default">$values </span><span class="keyword">as </span><span class="default">$val</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; if(</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">"open"</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$ind </span><span class="keyword">= </span><span class="default">array_pop</span><span class="keyword">(</span><span class="default">$levelCounters</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$stack </span><span class="keyword">= </span><span class="default">$stack </span><span class="keyword">. </span><span class="string">"." </span><span class="keyword">. </span><span class="default">$val</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">] . </span><span class="default">$ind</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; if (</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'attributes'</span><span class="keyword">]) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach(</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'attributes'</span><span class="keyword">] as </span><span class="default">$attrKey </span><span class="keyword">=&gt; </span><span class="default">$attrVal</span><span class="keyword">) <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$return</span><span class="keyword">[</span><span class="default">$stack </span><span class="keyword">. </span><span class="string">'@' </span><span class="keyword">. </span><span class="default">$attrKey</span><span class="keyword">] = </span><span class="default">$stack </span><span class="keyword">. </span><span class="string">'@' </span><span class="keyword">. </span><span class="default">$attrKey </span><span class="keyword">. </span><span class="string">"=" </span><span class="keyword">.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$attrVal</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">array_push</span><span class="keyword">(</span><span class="default">$levelCounters</span><span class="keyword">,</span><span class="default">$ind</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">array_push</span><span class="keyword">(</span><span class="default">$levelCounters</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">);&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; } elseif(</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">"close"</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$stack </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$stack</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">strrpos</span><span class="keyword">(</span><span class="default">$stack</span><span class="keyword">,</span><span class="string">'.'</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; } elseif(</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">"complete"</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$ind </span><span class="keyword">= </span><span class="default">array_pop</span><span class="keyword">(</span><span class="default">$levelCounters</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$stack </span><span class="keyword">= </span><span class="default">$stack </span><span class="keyword">. </span><span class="string">"." </span><span class="keyword">. </span><span class="default">$val</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">] . </span><span class="default">$ind</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; if (</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'attributes'</span><span class="keyword">]) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach(</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'attributes'</span><span class="keyword">] as </span><span class="default">$attrKey </span><span class="keyword">=&gt; </span><span class="default">$attrVal</span><span class="keyword">) <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$return</span><span class="keyword">[</span><span class="default">$stack </span><span class="keyword">. </span><span class="string">'@' </span><span class="keyword">. </span><span class="default">$attrKey</span><span class="keyword">] = </span><span class="default">$stack </span><span class="keyword">. </span><span class="string">'@' </span><span class="keyword">. </span><span class="default">$attrKey </span><span class="keyword">. </span><span class="string">"=" </span><span class="keyword">.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$attrVal</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$return</span><span class="keyword">[</span><span class="default">$stack</span><span class="keyword">] = </span><span class="default">$stack </span><span class="keyword">. </span><span class="string">"=" </span><span class="keyword">. </span><span class="default">$val</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$stack </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$stack</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">strrpos</span><span class="keyword">(</span><span class="default">$stack</span><span class="keyword">,</span><span class="string">'.'</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">array_push</span><span class="keyword">(</span><span class="default">$levelCounters</span><span class="keyword">,</span><span class="default">$ind</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; }<br />
&nbsp;&nbsp; }<br />
&nbsp;&nbsp; return </span><span class="default">$return</span><span class="keyword">;<br />
}&nbsp;&nbsp; <br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84261""></a>
  <div class="note">
   <strong class="user">wickedfather at hotmail dot com</strong>
   <a href="#84261" class="date">06-Jul-2008 09:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Had a comment up that was removed saying I'd found drawbacks, but here's a class what I wrote which works fine for me.&nbsp; Comments removed due to post restrictions.&nbsp; Pass the xml into the parse method or in the constructor.&nbsp; Php4 and 5 safe.<br />
<br />
class XMLThing<br />
{<br />
&nbsp;&nbsp;&nbsp; var $rawXML;<br />
&nbsp;&nbsp;&nbsp; var $valueArray = array();<br />
&nbsp;&nbsp;&nbsp; var $keyArray = array();<br />
&nbsp;&nbsp;&nbsp; var $parsed = array();<br />
&nbsp;&nbsp;&nbsp; var $index = 0;<br />
&nbsp;&nbsp;&nbsp; var $attribKey = 'attributes';<br />
&nbsp;&nbsp;&nbsp; var $valueKey = 'value';<br />
&nbsp;&nbsp;&nbsp; var $cdataKey = 'cdata';<br />
&nbsp;&nbsp;&nbsp; var $isError = false;<br />
&nbsp;&nbsp;&nbsp; var $error = '';<br />
<br />
&nbsp;&nbsp;&nbsp; function XMLThing($xml = NULL)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;rawXML = $xml;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function parse($xml = NULL)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!is_null($xml))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;rawXML = $xml;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;isError = false;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!$this-&gt;parse_init())<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return false;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;index = 0;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;parsed = $this-&gt;parse_recurse();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;status = 'parsing complete';<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return $this-&gt;parsed;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function parse_recurse()<br />
&nbsp;&nbsp;&nbsp; {&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $found = array();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $tagCount = array();<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while (isset($this-&gt;valueArray[$this-&gt;index]))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $tag = $this-&gt;valueArray[$this-&gt;index];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;index++;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($tag['type'] == 'close')<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return $found;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($tag['type'] == 'cdata')<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $tag['tag'] = $this-&gt;cdataKey;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $tag['type'] = 'complete';<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $tagName = $tag['tag'];<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (isset($tagCount[$tagName]))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($tagCount[$tagName] == 1)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $found[$tagName] = array($found[$tagName]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $tagRef =&amp; $found[$tagName][$tagCount[$tagName]];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $tagCount[$tagName]++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $tagCount[$tagName] = 1;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $tagRef =&amp; $found[$tagName];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; switch ($tag['type'])<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case 'open':<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $tagRef = $this-&gt;parse_recurse();<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (isset($tag['attributes']))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $tagRef[$this-&gt;attribKey] = $tag['attributes'];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (isset($tag['value']))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (isset($tagRef[$this-&gt;cdataKey]))&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $tagRef[$this-&gt;cdataKey] = (array)$tagRef[$this-&gt;cdataKey];&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; array_unshift($tagRef[$this-&gt;cdataKey], $tag['value']);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $tagRef[$this-&gt;cdataKey] = $tag['value'];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case 'complete':<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (isset($tag['attributes']))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $tagRef[$this-&gt;attribKey] = $tag['attributes'];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $tagRef =&amp; $tagRef[$this-&gt;valueKey];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (isset($tag['value']))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $tagRef = $tag['value'];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return $found;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function parse_init()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;parser = xml_parser_create();<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $parser = $this-&gt;parser;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; xml_parser_set_option($parser, XML_OPTION_CASE_FOLDING, 0);&nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; xml_parser_set_option($parser, XML_OPTION_SKIP_WHITE, 1);&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!$res = (bool)xml_parse_into_struct($parser, $this-&gt;rawXML, $this-&gt;valueArray, $this-&gt;keyArray))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;isError = true;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;error = 'error: '.xml_error_string(xml_get_error_code($parser)).' at line '.xml_get_current_line_number($parser);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; xml_parser_free($parser);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return $res;<br />
&nbsp;&nbsp;&nbsp; }<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84187""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#84187" class="date">02-Jul-2008 05:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
@jemptymethod:<br />
<br />
I found only one downfall to your function. If you have duplicates, the first one cannot be accessed iteratively.<br />
<br />
I added the following to fix the problem:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">...<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$parent</span><span class="keyword">[</span><span class="string">'children'</span><span class="keyword">][</span><span class="default">$tag</span><span class="keyword">])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(!isset(</span><span class="default">$parent</span><span class="keyword">[</span><span class="string">'children'</span><span class="keyword">][</span><span class="default">$tag</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$oldSingle </span><span class="keyword">= </span><span class="default">$parent</span><span class="keyword">[</span><span class="string">'children'</span><span class="keyword">][</span><span class="default">$tag</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$parent</span><span class="keyword">[</span><span class="string">'children'</span><span class="keyword">][</span><span class="default">$tag</span><span class="keyword">] = </span><span class="default">null</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$parent</span><span class="keyword">[</span><span class="string">'children'</span><span class="keyword">][</span><span class="default">$tag</span><span class="keyword">][] = </span><span class="default">$oldSingle</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$parent</span><span class="keyword">[</span><span class="string">'children'</span><span class="keyword">][</span><span class="default">$tag</span><span class="keyword">][] = </span><span class="default">$pop</span><span class="keyword">[</span><span class="string">'children'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
...<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83881""></a>
  <div class="note">
   <strong class="user">jemptymethod at gmail dot com</strong>
   <a href="#83881" class="date">16-Jun-2008 10:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
@wickedfather, re: beaudurrant....I just cannot concur that the latter's class is "great"....First of all, it doesn't handle attributes.&nbsp; Second of all, as my code below demonstrates, there is no need waste processing by determining duplicates within their own loop.&nbsp; Thirdly, when there are duplicates, it collapses the layer in the array above the duplicates.<br />
<br />
Here is some much more consise code, though not (yet) object oriented, and also not yet handling attributes; it maintains a stack for each level:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">xml_parse_into_assoc</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">) {<br />
&nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">implode</span><span class="keyword">(</span><span class="string">""</span><span class="keyword">, </span><span class="default">file</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">));<br />
&nbsp; </span><span class="default">$p </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">();<br />
&nbsp; <br />
&nbsp; </span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$p</span><span class="keyword">, </span><span class="default">XML_OPTION_CASE_FOLDING</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
&nbsp; </span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$p</span><span class="keyword">, </span><span class="default">XML_OPTION_SKIP_WHITE</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp; <br />
&nbsp; </span><span class="default">xml_parse_into_struct</span><span class="keyword">(</span><span class="default">$p</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">, </span><span class="default">$vals</span><span class="keyword">, </span><span class="default">$index</span><span class="keyword">);<br />
&nbsp; </span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$p</span><span class="keyword">);<br />
<br />
&nbsp; </span><span class="default">$levels </span><span class="keyword">= array(</span><span class="default">null</span><span class="keyword">);<br />
&nbsp; <br />
&nbsp; foreach (</span><span class="default">$vals </span><span class="keyword">as </span><span class="default">$val</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">'open' </span><span class="keyword">|| </span><span class="default">$val</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">'complete'</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (!</span><span class="default">array_key_exists</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'level'</span><span class="keyword">], </span><span class="default">$levels</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$levels</span><span class="keyword">[</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'level'</span><span class="keyword">]] = array();<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$prevLevel </span><span class="keyword">=&amp; </span><span class="default">$levels</span><span class="keyword">[</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'level'</span><span class="keyword">] - </span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$parent </span><span class="keyword">= </span><span class="default">$prevLevel</span><span class="keyword">[</span><span class="default">sizeof</span><span class="keyword">(</span><span class="default">$prevLevel</span><span class="keyword">)-</span><span class="default">1</span><span class="keyword">]; <br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">'open'</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$val</span><span class="keyword">[</span><span class="string">'children'</span><span class="keyword">] = array();<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">array_push</span><span class="keyword">(&amp;</span><span class="default">$levels</span><span class="keyword">[</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'level'</span><span class="keyword">]], </span><span class="default">$val</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; continue;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; else if (</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">'complete'</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$parent</span><span class="keyword">[</span><span class="string">'children'</span><span class="keyword">][</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]] = </span><span class="default">$val</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; else if (</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">'close'</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$pop </span><span class="keyword">= </span><span class="default">array_pop</span><span class="keyword">(</span><span class="default">$levels</span><span class="keyword">[</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'level'</span><span class="keyword">]]);<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$tag </span><span class="keyword">= </span><span class="default">$pop</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp;&nbsp; if (</span><span class="default">$parent</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">array_key_exists</span><span class="keyword">(</span><span class="default">$tag</span><span class="keyword">, </span><span class="default">$parent</span><span class="keyword">[</span><span class="string">'children'</span><span class="keyword">])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$parent</span><span class="keyword">[</span><span class="string">'children'</span><span class="keyword">][</span><span class="default">$tag</span><span class="keyword">] = </span><span class="default">$pop</span><span class="keyword">[</span><span class="string">'children'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$parent</span><span class="keyword">[</span><span class="string">'children'</span><span class="keyword">][</span><span class="default">$tag</span><span class="keyword">])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$parent</span><span class="keyword">[</span><span class="string">'children'</span><span class="keyword">][</span><span class="default">$tag</span><span class="keyword">][] = </span><span class="default">$pop</span><span class="keyword">[</span><span class="string">'children'</span><span class="keyword">]; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return(array(</span><span class="default">$pop</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">] =&gt; </span><span class="default">$pop</span><span class="keyword">[</span><span class="string">'children'</span><span class="keyword">]));<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$prevLevel</span><span class="keyword">[</span><span class="default">sizeof</span><span class="keyword">(</span><span class="default">$prevLevel</span><span class="keyword">)-</span><span class="default">1</span><span class="keyword">] = </span><span class="default">$parent</span><span class="keyword">;<br />
&nbsp; }<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82628""></a>
  <div class="note">
   <strong class="user">jukea</strong>
   <a href="#82628" class="date">18-Apr-2008 11:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
concerning Adam Tylmad's code, note that the line<br />
<br />
&nbsp;if ($data = xml::cleanString($data))<br />
<br />
prevents 0 values to be considered, as this will evaluate to false. I just tracked down this bug in our system .. ouch</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82476""></a>
  <div class="note">
   <strong class="user">wickedfather at hotmail dot com</strong>
   <a href="#82476" class="date">12-Apr-2008 05:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To beaudurrant - that class is great and structures things in a very sensible way.&nbsp; Only problem is that it raises an error if a tag is empty, so would suggest a simple mod to the parse method just to add an isset test.<br />
<br />
if (isset($val['value']))<br />
{<br />
&nbsp;&nbsp;&nbsp; $this-&gt;setArrayValue($this-&gt;output, $stack, $val['value']);<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81704""></a>
  <div class="note">
   <strong class="user">mathiasrav at gmail dot com</strong>
   <a href="#81704" class="date">10-Mar-2008 05:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In response to Anonymous' post at 26-Feb-2008 11:50:<br />
<br />
Saying that you "don't understand everything" isn't going to get you very popular - you should understand the code you use.<br />
foreach isn't *slow* in PHP, it is actually faster than the equivalent for-construct (which, in many cases, isn't available).<br />
<br />
The reason your script is slow is simply your use of xml_parse_into_struct - it reads the whole XML-string and doesn't return until it has parsed and validated it all. If you're looking for efficiency, you'll have to use the more low-level xml_parser_create, xml_set_*_handler functions. Then make sure you don't keep everything in a huge array before outputting it (at least don't if you're going for efficiency).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81392""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#81392" class="date">26-Feb-2008 11:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hi, I actually use this parser without understanding everything. I read somewhere that using "foreach" is very slow, and I indeed noticed that this parser was slow, when getting a lot of data, so how should I edit it to make it faster ? (with the exact same output) thanks in advance<br />
<br />
&nbsp;&nbsp;&nbsp; $xml_parser = xml_parser_create();<br />
&nbsp;&nbsp;&nbsp; $data = $outputone;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; xml_parse_into_struct($xml_parser, $data, $vals, $index);<br />
&nbsp;&nbsp;&nbsp; xml_parser_free($xml_parser);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; $params = array();<br />
&nbsp;&nbsp;&nbsp; $level = array();<br />
&nbsp;&nbsp;&nbsp; $i="1";<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; foreach ($vals as $xml_elem) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ($xml_elem['type'] == 'open' &amp;&amp; $xml_elem['level'] == '1') {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $level[$xml_elem['level']] = $xml_elem['tag'];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ($xml_elem['type'] == 'open' &amp;&amp; $xml_elem['level'] == '2') {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $level[$xml_elem['level']] = $xml_elem['tag']."".$i;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $i++;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ($xml_elem['type'] == 'complete') {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $start_level = 1;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $php_stmt = '$params';<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; while($start_level &lt; $xml_elem['level']) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $php_stmt .= '[$level['.$start_level.']]';<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $start_level++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $php_stmt .= '[$xml_elem[\'tag\']] = $xml_elem[\'value\'];';<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; eval($php_stmt);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="80325""></a>
  <div class="note">
   <strong class="user">cesaralcaide at gmail dot com</strong>
   <a href="#80325" class="date">10-Jan-2008 11:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I didn't fount an appropiate xml2array translaction for my purpose, so I wrote this:<br />
<br />
(convert an xml string to an associative array allowing multiple elements with the same name)<br />
<br />
/////////////////////////////////// Inicio XML <br />
//<br />
//<br />
//<br />
// Convierte un XML en un array asociativo cuyos elementos son arrays<br />
// (para permitir varios elementos del mismo nombre)<br />
//<br />
// Limitación: el elemento "attributos" no puede aparecer en el XML, pues corresponde al<br />
// de attribs de un tag (un Tag empieza con "T",no "t")<br />
//<br />
////////////////////////////////////<br />
<br />
function xml_analiza($xml) {<br />
&nbsp;global $xml_resul,$xml_n,$xml_cont,$xml_attr;<br />
&nbsp;$xml_n = 0;<br />
&nbsp;$xml_resul = array();<br />
&nbsp;$xml_cont = array();<br />
&nbsp;$xml_attr = array();<br />
&nbsp;$p = xml_parser_create();<br />
&nbsp;//Si quisiéramos distinguir Mayúsculas-Minúsculas en los nombres de etiquetas:<br />
&nbsp;xml_parser_set_option($p, XML_OPTION_CASE_FOLDING, 0);<br />
&nbsp;xml_set_element_handler($p, "xml_inicio", "xml_fin");<br />
&nbsp;xml_set_character_data_handler($p, "xml_char");<br />
<br />
&nbsp;// Recorta hasta el primer tag del XML:<br />
&nbsp;$i = instr($xml,"&lt;" . "?xml");<br />
&nbsp;if (!$i) return array();<br />
&nbsp;$j = instr($i,$xml,"?" . "&gt;");<br />
&nbsp;if (!$j) return array();<br />
&nbsp;$xml = substr($xml,$j+2);<br />
<br />
&nbsp;if (!xml_parse($p, $xml))<br />
&nbsp; alarma("URG","xml_analiza","XML error: " . xml_error_string(xml_get_error_code($p))<br />
&nbsp;&nbsp; . " en la línea " . xml_get_current_line_number($p) . " ($xml)");<br />
&nbsp;xml_parser_free($p);<br />
&nbsp;if (!sizeof($xml_resul)) return array();<br />
&nbsp;return $xml_resul[0];<br />
}<br />
<br />
function xml_inicio($p, $nombre, $atributos) {<br />
&nbsp;global $xml_resul,$xml_n,$xml_cont,$xml_attr;<br />
&nbsp;$xml_n++;<br />
&nbsp;$xml_resul[] = array();<br />
&nbsp;$xml_cont[] = "";<br />
&nbsp;$xml_attr[] = $atributos;<br />
}<br />
<br />
function xml_fin($p, $nombre) {<br />
&nbsp;global $xml_resul,$xml_n,$xml_cont,$xml_attr;<br />
&nbsp;$xml_n--;<br />
&nbsp;$nuevo = array_pop($xml_resul);<br />
&nbsp;$nombre = $nombre;<br />
&nbsp;if ($nombre == "attributos") alarma("URG","xml_analiza","Tag con nombre no permitido (attributos)");<br />
&nbsp;$conte = array_pop($xml_cont);<br />
&nbsp;$attrib = array_pop($xml_attr);<br />
&nbsp;if ($conte) $xml_resul[$xml_n][$nombre][] = $conte;<br />
&nbsp;else {<br />
&nbsp; if ($nuevo) {<br />
&nbsp;&nbsp; if ($attrib) $nuevo["attributos"][] = $attrib;<br />
&nbsp;&nbsp; $xml_resul[$xml_n][$nombre][] = $nuevo;<br />
&nbsp; }<br />
&nbsp; else<br />
&nbsp;&nbsp; $xml_resul[$xml_n][$nombre][] = "";<br />
&nbsp;}<br />
}<br />
<br />
function xml_char($p, $data) {<br />
&nbsp;global $xml_cont;<br />
&nbsp;$xml_cont[sizeof($xml_cont)-1] .= trim(str_replace("\n","",$data));<br />
}<br />
<br />
function xml_a($a) {<br />
&nbsp;// Devuelve un elemento del array XML, p.e.: xml_a($v,"FichaCircuito","Red",0)<br />
&nbsp;$n = func_num_args();<br />
&nbsp;for ($i=1;$i&lt;$n;$i++) {<br />
&nbsp; $b = func_get_arg($i);<br />
&nbsp; if (isset($a[$b]))<br />
&nbsp;&nbsp; $a = $a[$b];<br />
&nbsp; else {<br />
&nbsp;&nbsp; if (!isset($a[0][$b][0])) return "";<br />
&nbsp;&nbsp; $a = $a[0][$b];<br />
&nbsp; }<br />
&nbsp;}<br />
&nbsp;return $a;<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="79922""></a>
  <div class="note">
   <strong class="user">beaudurrant at gmail dot com</strong>
   <a href="#79922" class="date">19-Dec-2007 08:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is extending what Alf Marius Foss Olsen had posted above.<br />
<br />
It takes into account array keys with the same name and uses an increment for them instead of overwriting the keys.<br />
<br />
I am using it for SOAP requests (20K - 150K) and it parses very fast compared to PEAR.<br />
<br />
&lt;?<br />
<br />
class XMLParser&nbsp; {<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; // raw xml<br />
&nbsp;&nbsp;&nbsp; private $rawXML;<br />
&nbsp;&nbsp;&nbsp; // xml parser<br />
&nbsp;&nbsp;&nbsp; private $parser = null;<br />
&nbsp;&nbsp;&nbsp; // array returned by the xml parser<br />
&nbsp;&nbsp;&nbsp; private $valueArray = array();<br />
&nbsp;&nbsp;&nbsp; private $keyArray = array();<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; // arrays for dealing with duplicate keys<br />
&nbsp;&nbsp;&nbsp; private $duplicateKeys = array();<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; // return data<br />
&nbsp;&nbsp;&nbsp; private $output = array();<br />
&nbsp;&nbsp;&nbsp; private $status;<br />
<br />
&nbsp;&nbsp;&nbsp; public function XMLParser($xml){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;rawXML = $xml;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;parser = xml_parser_create();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return $this-&gt;parse();<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; private function parse(){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $parser = $this-&gt;parser;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; xml_parser_set_option($parser, XML_OPTION_CASE_FOLDING, 0); // Dont mess with my cAsE sEtTings<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; xml_parser_set_option($parser, XML_OPTION_SKIP_WHITE, 1);&nbsp; &nbsp;&nbsp; // Dont bother with empty info<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(!xml_parse_into_struct($parser, $this-&gt;rawXML, $this-&gt;valueArray, $this-&gt;keyArray)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;status = 'error: '.xml_error_string(xml_get_error_code($parser)).' at line '.xml_get_current_line_number($parser);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return false;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; xml_parser_free($parser);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;findDuplicateKeys();<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // tmp array used for stacking<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $stack = array();&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $increment = 0;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach($this-&gt;valueArray as $val) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if($val['type'] == "open") {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //if array key is duplicate then send in increment<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(array_key_exists($val['tag'], $this-&gt;duplicateKeys)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; array_push($stack, $this-&gt;duplicateKeys[$val['tag']]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;duplicateKeys[$val['tag']]++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // else send in tag<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; array_push($stack, $val['tag']);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } elseif($val['type'] == "close") {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; array_pop($stack);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // reset the increment if they tag does not exists in the stack<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(array_key_exists($val['tag'], $stack)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;duplicateKeys[$val['tag']] = 0;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } elseif($val['type'] == "complete") {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //if array key is duplicate then send in increment<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(array_key_exists($val['tag'], $this-&gt;duplicateKeys)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; array_push($stack, $this-&gt;duplicateKeys[$val['tag']]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;duplicateKeys[$val['tag']]++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else{&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // else send in tag<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; array_push($stack,&nbsp; $val['tag']);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;setArrayValue($this-&gt;output, $stack, $val['value']);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; array_pop($stack);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $increment++;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;status = 'success: xml was parsed';<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return true;<br />
<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; private function findDuplicateKeys(){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for($i=0;$i &lt; count($this-&gt;valueArray); $i++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // duplicate keys are when two complete tags are side by side<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if($this-&gt;valueArray[$i]['type'] == "complete"){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if( $i+1 &lt; count($this-&gt;valueArray) ){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if($this-&gt;valueArray[$i+1]['tag'] == $this-&gt;valueArray[$i]['tag'] &amp;&amp; $this-&gt;valueArray[$i+1]['type'] == "complete"){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;duplicateKeys[$this-&gt;valueArray[$i]['tag']] = 0;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // also when a close tag is before an open tag and the tags are the same<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if($this-&gt;valueArray[$i]['type'] == "close"){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if( $i+1 &lt; count($this-&gt;valueArray) ){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(&nbsp; &nbsp; $this-&gt;valueArray[$i+1]['type'] == "open" &amp;&amp; $this-&gt;valueArray[$i+1]['tag'] == $this-&gt;valueArray[$i]['tag'])<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;duplicateKeys[$this-&gt;valueArray[$i]['tag']] = 0; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; private function setArrayValue(&amp;$array, $stack, $value){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ($stack) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $key = array_shift($stack);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;setArrayValue($array[$key], $stack, $value);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return $array;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $array = $value;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public function getOutput(){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return $this-&gt;output;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public function getStatus(){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return $this-&gt;status;&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; <br />
}<br />
<br />
?&gt;<br />
<br />
Usage:<br />
<br />
$p = new XMLParser($xml);<br />
$p-&gt;getOutput();</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="78708""></a>
  <div class="note">
   <strong class="user">php dot net at crazedsanity dot com</strong>
   <a href="#78708" class="date">24-Oct-2007 04:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There's an updated version of cs-phpxml (<a href="http://sf.net/projects/cs-phpxml, or https://cs-phpxml.svn.sourceforge.net/svnroot/cs-phpxml/releases for the latest out of subversion" rel="nofollow" target="_blank">http://sf.net/projects/cs-phpxml, or https://cs-phpxml.svn.sourceforge.net/svnroot/cs-phpxml/releases for the latest out of subversion</a>) which easily converts an XML string into a PHP array.&nbsp; Using my previous example::: <br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/**<br />
&nbsp;*<br />
&nbsp;* *********** EXAMPLE ***********<br />
&nbsp;*<br />
&nbsp;* Original file contents:<br />
&nbsp;* &lt;test xmlns="stuff"&gt;<br />
&nbsp;*&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;indexOne&gt;hello&lt;/indexOne&gt;<br />
&nbsp;*&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;my_single_index testAttribute="hello" /&gt;<br />
&nbsp;*&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;multiple_items&gt;<br />
&nbsp;*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;item&gt;1&lt;/item&gt;<br />
&nbsp;*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;item&gt;2&lt;/item&gt;<br />
&nbsp;*&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;/multiple_items&gt;<br />
&nbsp;* &lt;/test&gt;<br />
&nbsp;*<br />
&nbsp;* Would return:::<br />
&nbsp;*<br />
&nbsp;* array(<br />
&nbsp;*&nbsp; &nbsp;&nbsp; TEST =&gt; array(<br />
&nbsp;*&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; indexOne =&gt; hello,<br />
&nbsp;*&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; my_single_index =&gt; NULL,<br />
&nbsp;*&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; multiple_items =&gt; array(<br />
&nbsp;*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; items =&gt; array(<br />
&nbsp;*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 0 =&gt; 1,<br />
&nbsp;*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 1 =&gt; 2<br />
&nbsp;*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
&nbsp;*&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ),<br />
&nbsp;*&nbsp; &nbsp;&nbsp; ),<br />
&nbsp;* );<br />
*/<br />
</span><span class="default">?&gt;<br />
</span><br />
I've been using this in many production environments, and it's been very stable.&nbsp; The syntax is pretty simple, too:::<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">require_once(</span><span class="default">dirname</span><span class="keyword">(</span><span class="default">__FILE__</span><span class="keyword">) .</span><span class="string">"/cs-phpxml/xmlParserClass.php"</span><span class="keyword">);<br />
</span><span class="default">$xmlParser </span><span class="keyword">= new </span><span class="default">xmlParser</span><span class="keyword">(</span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="string">"test.xml"</span><span class="keyword">));<br />
</span><span class="default">$myArray </span><span class="keyword">= </span><span class="default">$xmlParser</span><span class="keyword">-&gt;</span><span class="default">get_tree</span><span class="keyword">(</span><span class="default">TRUE</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77768""></a>
  <div class="note">
   <strong class="user">Alf Marius Foss Olsen</strong>
   <a href="#77768" class="date">12-Sep-2007 03:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
</span><span class="comment">/*<br />
&nbsp; An easy lightweight (Array -&gt;) XML -&gt; Array algorithm..<br />
<br />
&nbsp; Typical case: You have an array you want to export to an external server,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; so you make XML out of it, exports it, and "on the other side"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; make it into an array again. These two functions will take care<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; of that last part, ie XML -&gt; Array<br />
&nbsp; <br />
&nbsp; NOTE! The function XMLToArray assumes that the XML _dont_ have nodes on the<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; same level with the same name, then it just wont work. This is not a<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; problem, as this case deals with Array -&gt; XML -&gt; Array, and an array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; cant have to identical indexes/keys.<br />
*/<br />
<br />
</span><span class="keyword">function </span><span class="default">XMLToArray</span><span class="keyword">(</span><span class="default">$xml</span><span class="keyword">) {<br />
&nbsp; </span><span class="default">$parser </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">(</span><span class="string">'ISO-8859-1'</span><span class="keyword">); </span><span class="comment">// For Latin-1 charset<br />
&nbsp; </span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">XML_OPTION_CASE_FOLDING</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">); </span><span class="comment">// Dont mess with my cAsE sEtTings<br />
&nbsp; </span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">XML_OPTION_SKIP_WHITE</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">); </span><span class="comment">// Dont bother with empty info<br />
&nbsp; </span><span class="default">xml_parse_into_struct</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$xml</span><span class="keyword">, </span><span class="default">$values</span><span class="keyword">);<br />
&nbsp; </span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">);<br />
&nbsp; <br />
&nbsp; </span><span class="default">$return </span><span class="keyword">= array(); </span><span class="comment">// The returned array<br />
&nbsp; </span><span class="default">$stack </span><span class="keyword">= array(); </span><span class="comment">// tmp array used for stacking<br />
&nbsp; </span><span class="keyword">foreach(</span><span class="default">$values </span><span class="keyword">as </span><span class="default">$val</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">"open"</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">array_push</span><span class="keyword">(</span><span class="default">$stack</span><span class="keyword">, </span><span class="default">$val</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; } elseif(</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">"close"</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">array_pop</span><span class="keyword">(</span><span class="default">$stack</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; } elseif(</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">"complete"</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">array_push</span><span class="keyword">(</span><span class="default">$stack</span><span class="keyword">, </span><span class="default">$val</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">setArrayValue</span><span class="keyword">(</span><span class="default">$return</span><span class="keyword">, </span><span class="default">$stack</span><span class="keyword">, </span><span class="default">$val</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">array_pop</span><span class="keyword">(</span><span class="default">$stack</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }</span><span class="comment">//if-elseif<br />
&nbsp; </span><span class="keyword">}</span><span class="comment">//foreach<br />
&nbsp; </span><span class="keyword">return </span><span class="default">$return</span><span class="keyword">;<br />
}</span><span class="comment">//function XMLToArray<br />
&nbsp; <br />
</span><span class="keyword">function </span><span class="default">setArrayValue</span><span class="keyword">(&amp;</span><span class="default">$array</span><span class="keyword">, </span><span class="default">$stack</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">) {<br />
&nbsp; if (</span><span class="default">$stack</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$key </span><span class="keyword">= </span><span class="default">array_shift</span><span class="keyword">(</span><span class="default">$stack</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">setArrayValue</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">], </span><span class="default">$stack</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$array</span><span class="keyword">;<br />
&nbsp; } else {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$array </span><span class="keyword">= </span><span class="default">$value</span><span class="keyword">;<br />
&nbsp; }</span><span class="comment">//if-else<br />
</span><span class="keyword">}</span><span class="comment">//function setArrayValue<br />
&nbsp; <br />
// USAGE:<br />
</span><span class="default">$xml </span><span class="keyword">= &lt;&lt;&lt;QQQ<br />
</span><span class="string">&lt;?xml version="1.0"?&gt;<br />
&lt;root&gt;<br />
&nbsp; &lt;node1&gt;Some text&lt;/node1&gt;<br />
&nbsp; &lt;node2a&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;node2b&gt;<br />
&nbsp;&nbsp; &nbsp;&nbsp; &lt;node2c&gt;Some text&lt;/node2c&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;/node2b&gt;<br />
&nbsp; &lt;/node2a&gt;<br />
&lt;/root&gt;\n<br />
</span><span class="keyword">QQQ;<br />
</span><span class="default">$array </span><span class="keyword">= </span><span class="default">XMLToArray</span><span class="keyword">(</span><span class="default">$xml</span><span class="keyword">);<br />
print </span><span class="string">"&lt;pre&gt;"</span><span class="keyword">;<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">);<br />
print </span><span class="string">"&lt;/pre&gt;"</span><span class="keyword">;<br />
</span><span class="comment">//&nbsp; Output:<br />
//<br />
//&nbsp; Array<br />
//&nbsp; (<br />
//&nbsp; &nbsp; &nbsp; [root] =&gt; Array<br />
//&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<br />
//&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [node1] =&gt; Some text<br />
//&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [node2a] =&gt; Array<br />
//&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<br />
//&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [node2b] =&gt; Array<br />
//&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (<br />
//&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [node2c] =&gt; Some text<br />
//&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br />
//&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br />
//&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br />
//&nbsp; )<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77503""></a>
  <div class="note">
   <strong class="user">vinod at citadel-soft dot com</strong>
   <a href="#77503" class="date">01-Sep-2007 12:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
My previous code was having some bugs in, that is fixed now <br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">CSLXmlReader </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$tagstack</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$xmlvals</span><span class="keyword">;&nbsp; <br />
&nbsp;&nbsp;&nbsp; private&nbsp; </span><span class="default">$xmlvarArrPos</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$xmlfile</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">)&nbsp; </span><span class="comment">// constructor to intialize the stack and val array<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">{<br />
&nbsp;&nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">tagstack </span><span class="keyword">= array();&nbsp;&nbsp; </span><span class="comment">// contain the open tags till now<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvals </span><span class="keyword">= array(); <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvarArrPos </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvals</span><span class="keyword">;&nbsp; </span><span class="comment">// temporary variable to hold the current tag position&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlfile </span><span class="keyword">= </span><span class="default">$filename</span><span class="keyword">; <br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">readDatabase</span><span class="keyword">() <br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// read the XML database <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">implode</span><span class="keyword">(</span><span class="string">""</span><span class="keyword">, </span><span class="default">file</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlfile</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$parser </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">XML_OPTION_CASE_FOLDING</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">XML_OPTION_SKIP_WHITE</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_parse_into_struct</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">, </span><span class="default">$values</span><span class="keyword">, </span><span class="default">$tags</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$values </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$val</span><span class="keyword">)&nbsp; </span><span class="comment">// <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">"open"</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">array_push</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">tagstack</span><span class="keyword">, </span><span class="default">$val</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">getArrayPath</span><span class="keyword">(); <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">count</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvarArrPos</span><span class="keyword">) &gt; </span><span class="default">0 </span><span class="keyword">&amp;&amp; (!</span><span class="default">array_key_exists</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvarArrPos</span><span class="keyword">)))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$temp1 </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvarArrPos</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvarArrPos </span><span class="keyword">=&nbsp; array();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvarArrPos</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] = </span><span class="default">$temp1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">array_push</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">tagstack</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else if( </span><span class="default">array_key_exists</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvarArrPos</span><span class="keyword">)){ <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$opncount </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvarArrPos</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">array_push</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">tagstack</span><span class="keyword">, </span><span class="default">$opncount</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tagStackPointer </span><span class="keyword">+= </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }else if(</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">"close"</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; while( </span><span class="default">$val</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">] != (</span><span class="default">$lastOpened </span><span class="keyword">= </span><span class="default">array_pop</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">tagstack</span><span class="keyword">))){}<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }else if(</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] ==&nbsp; </span><span class="string">"complete"</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">getArrayPath</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="default">array_key_exists</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">],</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvarArrPos</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">array_key_exists</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvarArrPos</span><span class="keyword">[</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]]))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$elementCount </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvarArrPos</span><span class="keyword">[</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvarArrPos</span><span class="keyword">[</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]][</span><span class="default">$elementCount</span><span class="keyword">] = </span><span class="default">$val</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$temp1 </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvarArrPos</span><span class="keyword">[</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvarArrPos</span><span class="keyword">[</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]] =&nbsp; array();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvarArrPos</span><span class="keyword">[</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]][</span><span class="default">0</span><span class="keyword">] = </span><span class="default">$temp1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvarArrPos</span><span class="keyword">[</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]][</span><span class="default">1</span><span class="keyword">] = </span><span class="default">$val</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvarArrPos</span><span class="keyword">[</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]] = </span><span class="default">$val</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">reset</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvals</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvals</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">getArrayPath</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">reset</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvals</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvarArrPos </span><span class="keyword">= &amp;</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvals</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">tagstack </span><span class="keyword">as </span><span class="default">$key</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvarArrPos </span><span class="keyword">= &amp;</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xmlvarArrPos</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
}<br />
<br />
</span><span class="default">$readerObj&nbsp; </span><span class="keyword">= new </span><span class="default">CSLXmlReader</span><span class="keyword">(</span><span class="string">"test.xml"</span><span class="keyword">);<br />
</span><span class="default">$xmlvals </span><span class="keyword">= </span><span class="default">$readerObj</span><span class="keyword">-&gt;</span><span class="default">readDatabase</span><span class="keyword">();<br />
<br />
echo </span><span class="string">"########## XML Values In array as the multidimentional array&nbsp; #############\n"</span><span class="keyword">;<br />
echo </span><span class="string">"&lt;pre&gt;"</span><span class="keyword">;<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$xmlvals</span><span class="keyword">);<br />
echo </span><span class="string">"&lt;/pre&gt;"</span><span class="keyword">; <br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76409""></a>
  <div class="note">
   <strong class="user">php dot net at crazedsanity dot com</strong>
   <a href="#76409" class="date">13-Jul-2007 07:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you're interested in something that creates arrays in PHP, handles attributes well, and is easily transferrable back into XML, you may want to take a look at the cs-phpxml project at SourceForge.net (<a href="http://sf.net/projects/cs-phpxml" rel="nofollow" target="_blank">http://sf.net/projects/cs-phpxml</a>).&nbsp; It's not necessarily documented very well, but it will do something like this:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/**<br />
&nbsp;* <br />
&nbsp;* *********** EXAMPLE ***********<br />
&nbsp;* <br />
&nbsp;* Original file contents:<br />
&nbsp;* &lt;test xmlns="stuff"&gt;<br />
&nbsp;*&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;indexOne&gt;hello&lt;/indexOne&gt;<br />
&nbsp;*&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;my_single_index testAttribute="hello" /&gt;<br />
&nbsp;*&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;multiple_items&gt;<br />
&nbsp;*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;item&gt;1&lt;/item&gt;<br />
&nbsp;*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;item&gt;2&lt;/item&gt;<br />
&nbsp;*&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;/multiple_items&gt;<br />
&nbsp;* &lt;/test&gt;<br />
&nbsp;* <br />
&nbsp;* Would return:<br />
&nbsp;* <br />
&nbsp;* array(<br />
&nbsp;*&nbsp; &nbsp;&nbsp; TEST =&gt; array(<br />
&nbsp;*&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; type =&gt; 'open',<br />
&nbsp;*&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; attributes =&gt; array(<br />
&nbsp;*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; xmlns =&gt; 'stuff'<br />
&nbsp;*&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
&nbsp;*&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; INDEXONE =&gt; 'hello',<br />
&nbsp;*&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; MY_SINGLE_INDEX = array(<br />
&nbsp;*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; type =&gt; 'complete',<br />
&nbsp;*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;*&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
&nbsp;*&nbsp; &nbsp;&nbsp; )<br />
&nbsp;* );<br />
*/<br />
</span><span class="default">?&gt;<br />
</span><br />
It's presently under development, but I'm using it in several production environments.&nbsp; The XMLCreator is kinda clunky (builds XML within PHP code).&nbsp; NOTE: it has a dependency on "cs-arraytopath", also available at sourceforge via <a href="http://sf.net/projects/cs-arraytopath .&nbsp; The setup is a bit irritating, and it" rel="nofollow" target="_blank">http://sf.net/projects/cs-arraytopath .&nbsp; The setup is a bit irritating, and it</a>'s fragile when handling quoting &amp; formatting the data, but I think it's worth the hassle for most projects.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73044""></a>
  <div class="note">
   <strong class="user">siteres at gmail dot com</strong>
   <a href="#73044" class="date">07-Feb-2007 10:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
PHP: XML to Array and backwards:<br />
<br />
Here the XML with PHP solution: XML-&gt;Array and Array-&gt;XML.<br />
Work with it as with usual array.<br />
<br />
Sources are here:<br />
<a href="http://mysrc.blogspot.com/2007/02/php-xml-to-array-and-backwards.html" rel="nofollow" target="_blank">http://mysrc.blogspot.com/2007/02/php-xml-to-array-and-backwards.html</a><br />
(leave me comments:)<br />
<br />
Example #1 (1.xml):<br />
<br />
&lt;ddd&gt;<br />
&nbsp;&lt;onemore dd="55"&gt;<br />
&nbsp; &lt;tt&gt;333&lt;/tt&gt;<br />
&nbsp; &lt;tt ss="s1"&gt;555&lt;/tt&gt;<br />
&nbsp; &lt;tt&gt;777&lt;/tt&gt;<br />
&nbsp;&lt;/onemore&gt;<br />
&nbsp;&lt;two&gt;sdf rr&lt;/two&gt;<br />
&lt;/ddd&gt;<br />
<br />
The code:<br />
<br />
$xml=xml2ary(file_get_contents('1.xml'));<br />
print_r($xml); <br />
<br />
Here is the Array result:<br />
<br />
Array<br />
(<br />
&nbsp;&nbsp; [ddd] =&gt; Array (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [_c] =&gt; Array (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [_p] =&gt; Array *RECURSION*<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [onemore] =&gt; Array (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [_a] =&gt; Array (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [dd] =&gt; 55<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [_c] =&gt; Array (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [_p] =&gt; Array&nbsp; *RECURSION*<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [tt] =&gt; Array (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [0] =&gt; Array (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [_v] =&gt; 333<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [1] =&gt; Array (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [_a] =&gt; Array (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [ss] =&gt; s1<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [_v] =&gt; 555<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [2] =&gt; Array (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [_v] =&gt; 777<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [two] =&gt; Array (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [_v] =&gt; sdf rr<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br />
&nbsp;&nbsp; &nbsp; &nbsp; )<br />
)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="72227""></a>
  <div class="note">
   <strong class="user">amish</strong>
   <a href="#72227" class="date">08-Jan-2007 06:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Previous parser worked great for me, except a few issues. It did not work well if the element has attributes. I had a huge xml with so many elements, and attributes. Somehow, it mixed up my array, and messed up the keys. Hope following code help fix those issues....<br />
<br />
$xml_response = "<br />
&lt;test&gt;<br />
&nbsp;&nbsp; &lt;item&gt;<br />
&nbsp;&nbsp; &nbsp; &lt;name att=\"this should show up\"&gt;Item1&lt;/name&gt;<br />
&nbsp;&nbsp; &nbsp; &lt;id&gt;item_1&lt;/id&gt;<br />
&nbsp;&nbsp; &nbsp; &lt;description&gt; This is Item 1&lt;/description&gt;<br />
&nbsp;&nbsp; &nbsp; &lt;quantity&gt;10&lt;/quantity&gt;<br />
&nbsp;&nbsp; &nbsp; &lt;navigation website='site1'&gt;test1&lt;/navigation&gt;<br />
&nbsp;&nbsp; &nbsp; &lt;navigation website='site2'&gt;test2&lt;/navigation&gt;<br />
&nbsp;&nbsp; &lt;/item&gt;<br />
&lt;/test&gt;<br />
"<br />
<br />
$parser = xml_parser_create();<br />
xml_parser_set_option($parser,XML_OPTION_CASE_FOLDING,0);&nbsp; &nbsp; <br />
xml_parser_set_option($parser,XML_OPTION_SKIP_WHITE,1);&nbsp; &nbsp; <br />
xml_parse_into_struct($parser,$xml_response,$values,$tags);&nbsp; &nbsp; <br />
xml_parser_free($parser);<br />
<br />
$params = array();<br />
$level = array();<br />
<br />
foreach ($values as $xml_elem) {<br />
&nbsp;&nbsp;&nbsp; $start_level = 1;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ($xml_elem['type'] == 'open') {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (array_key_exists('attributes',$xml_elem)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; list($level[$xml_elem['level']],$extra) = array_values($xml_elem['attributes']);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $level[$xml_elem['level']] = $xml_elem['tag'];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $name_array&nbsp; &nbsp; =&nbsp; &nbsp; array();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; $i=0;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ($xml_elem['type'] == 'complete') {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(!in_array($xml_elem['tag'], $name_array)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; array_push($name_array, $xml_elem['tag']);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $i=0;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }else{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $i++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $php_stmt = '$params';<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; while($start_level &lt; $xml_elem['level']) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $php_stmt .= '[$level['.$start_level.']]';&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $test&nbsp; &nbsp; =&nbsp; &nbsp; $php_stmt;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $start_level++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $php_stmt .= '[$xml_elem[\'tag\']][$i] = $xml_elem[\'value\'];';<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(isset($xml_elem['attributes'])){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach ($xml_elem['attributes'] as $key=&gt;$va){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $attribute&nbsp; &nbsp; =&nbsp; &nbsp; '';<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $new_stmt&nbsp; &nbsp; =&nbsp; &nbsp; '';<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $attribute&nbsp; &nbsp; =&nbsp; &nbsp; "".$i."_attribute_".$key."";&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $new_stmt .= $test.'[$xml_elem[\'tag\']][$attribute] = $va;';&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; eval($new_stmt);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; eval($php_stmt);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $start_level--;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ($xml_elem['type'] == 'close') {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; array_pop($level);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71472""></a>
  <div class="note">
   <strong class="user">webmaster at after5webdesign dot com</strong>
   <a href="#71472" class="date">30-Nov-2006 01:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
That parser also has a problem in which it will not parse more items than the current level it is on. That is, parsing this:&nbsp; &lt;1&gt;&lt;2&gt;A&lt;/2&gt;&lt;2&gt;B&lt;/2&gt;&lt;2&gt;C&lt;/2&gt;&lt;/1&gt;<br />
Will only result in this: A B<br />
C is never processed.<br />
<br />
It might be better with something like this:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $file = get_url('<a href="http://news.search.yahoo.com/news/rss?p=current+events" rel="nofollow" target="_blank">http://news.search.yahoo.com/news/rss?p=current+events</a>', URL_CONTENT);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $data = $file['content'];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $xml_parser = xml_parser_create();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; xml_parse_into_struct($xml_parser, $data, $vals, $index);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; xml_parser_free($xml_parser);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //Uncomment the lines below to see the entire structure of your XML document<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //echo "&lt;pre&gt;INDEX: \n";<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //print_r ($index);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //echo "\n \n \n VALUES:";<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //print_r ($vals);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //echo "&lt;/pre&gt;";<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $params = array();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $level = array();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $start_level = 1;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach ($vals as $xml_elem) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($xml_elem['type'] == 'open') {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (array_key_exists('attributes',$xml_elem)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; list($level[$xml_elem['level']],$extra) = array_values($xml_elem['attributes']);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $level[$xml_elem['level']] = $xml_elem['tag'];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($xml_elem['type'] == 'complete') {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $php_stmt = '$params';<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; while($start_level &lt; $xml_elem['level']) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $php_stmt .= '[$level['.$start_level.']]';<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $start_level++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $php_stmt .= '[$xml_elem[\'tag\']][] = $xml_elem[\'value\'];';<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; eval($php_stmt);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $start_level--;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo "&lt;pre&gt;";<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; print_r ($params);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo "&lt;/pre&gt;";<br />
<br />
~Tim_Myth</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71228""></a>
  <div class="note">
   <strong class="user">tsivert</strong>
   <a href="#71228" class="date">17-Nov-2006 12:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To John.<br />
<br />
The reason that you only get the last item is that you declare a array of one element that is constantly overwritten by the last element...<br />
<br />
I don't know if you want to put the items as two different childarrays of the parent or if you want to put the items in one childarray with two elements.<br />
<br />
To put the items in two different childarrays, change the line<br />
$php_stmt .= '[$level['.$start_level.']]';<br />
to <br />
$php_stmt .= '[$level['.$start_level.']][]';<br />
<br />
To put in same childarray change line <br />
$php_stmt .= '[$xml_elem[\'tag\']] = $xml_elem[\'value\'];';<br />
to <br />
$php_stmt .= '[$xml_elem[\'tag\']][] = $xml_elem[\'value\'];';<br />
<br />
Hope this helps you!<br />
<br />
tsivert</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71074""></a>
  <div class="note">
   <strong class="user">john</strong>
   <a href="#71074" class="date">10-Nov-2006 08:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I'm currently using this parser and it's working the way I want it to, but it has a little glitch and I was hoping maybe someone can let me know why.<br />
<br />
Here's the parser and use for example purposes the following input:<br />
<br />
$xml_response = '&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br />
&lt;test&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;item&gt;First Item&lt;/item&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;item&gt;Second Item&lt;/item&gt;<br />
&lt;/test&gt;'<br />
<br />
$xml_parser = xml_parser_create();<br />
xml_parse_into_struct($xml_parser, $xml_response, $vals, $index);<br />
xml_parser_free($xml_parser);<br />
<br />
$params = array();<br />
$level = array();<br />
foreach ($vals as $xml_elem) {<br />
&nbsp; if ($xml_elem['type'] == 'open') {<br />
&nbsp;&nbsp; if (array_key_exists('attributes',$xml_elem)) {<br />
&nbsp;&nbsp; &nbsp; list($level[$xml_elem['level']],$extra) = array_values($xml_elem['attributes']);<br />
&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; $level[$xml_elem['level']] = $xml_elem['tag'];<br />
&nbsp;&nbsp; }<br />
&nbsp; }<br />
&nbsp; if ($xml_elem['type'] == 'complete') {<br />
&nbsp;&nbsp; $start_level = 1;<br />
&nbsp;&nbsp; $php_stmt = '$params';<br />
&nbsp;&nbsp; while($start_level &lt; $xml_elem['level']) {<br />
&nbsp;&nbsp; &nbsp; $php_stmt .= '[$level['.$start_level.']]';<br />
&nbsp;&nbsp; &nbsp; $start_level++;<br />
&nbsp;&nbsp; }<br />
&nbsp;&nbsp; $php_stmt .= '[$xml_elem[\'tag\']] = $xml_elem[\'value\'];';<br />
&nbsp;&nbsp; eval($php_stmt);<br />
&nbsp; }<br />
}<br />
<br />
echo "&lt;pre&gt;";<br />
print_r ($params);<br />
echo "&lt;/pre&gt;";<br />
<br />
At the output, only the last &lt;item&gt; shows (i.e.Second Item). The first one is lost.<br />
<br />
What should I change so it keeps ALL &lt;item&gt; tags.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="70916""></a>
  <div class="note">
   <strong class="user">A3</strong>
   <a href="#70916" class="date">04-Nov-2006 02:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
XML -&gt; Array<br />
&lt;?<br />
&nbsp;&nbsp;&nbsp; $data = '&lt;root&gt;&lt;a&gt;&lt;b x="s" a="2"&gt;asdf&lt;/b&gt;&lt;c&gt;&lt;/c&gt;&lt;/a&gt;&lt;/root&gt;';<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; $p = xml_parser_create();<br />
&nbsp;&nbsp;&nbsp; xml_parse_into_struct($p, $data, $vals);<br />
&nbsp;&nbsp;&nbsp; xml_parser_free($p);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; $key = $output = array();<br />
&nbsp;&nbsp; foreach ($vals as $id=&gt;$item) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; if ($item["type"]=="open" || $item["level"]&gt;count($key)) {// &amp;&amp; count($key)&lt;=$item["level"])<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; array_push($key, $id);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $temp = array("tag"=&gt;$item["tag"], "value"=&gt;"", "attributes"=&gt;array());<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; eval("\$output[".implode("][", $key)."] = \$temp;");<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; if ($item["type"]=="close" || $item["level"]&lt;count($key))// &amp;&amp; $item["level"]&gt;=count($key))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; array_pop($key);<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (isset($item["attributes"]))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; eval("\$output[".implode("][", $key)."]['attributes'] = array_merge(\$output[".implode("][", $key)."]['attributes'], \$item['attributes']);");<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (isset($item["value"]))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; eval("\$output[".implode("][", $key)."]['value'] .= \$item['value'];");<br />
&nbsp;&nbsp; }<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69616""></a>
  <div class="note">
   <strong class="user">Elad Elrom</strong>
   <a href="#69616" class="date">12-Sep-2006 11:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is a quick fix for parsing XML from remote URL, some of the example above will work when trying to parse on your local server without "<a href="http://" rel="nofollow" target="_blank">http://</a>" but not when trying to parse from remote server using "<a href="http://www.URL" rel="nofollow" target="_blank">http://www.URL</a>"...<br />
<br />
&lt;?<br />
$file="<a href="http://www.URL.com/file.XML" rel="nofollow" target="_blank">http://www.URL.com/file.XML</a>";<br />
<br />
$xml_parser = xml_parser_create();<br />
<br />
$handle = fopen($file, "rb");<br />
$contents = '';<br />
while (!feof($handle)) {<br />
&nbsp; $data .= fread($handle, 8192);<br />
}<br />
fclose($handle);<br />
<br />
xml_parse_into_struct($xml_parser, $data, $vals, $index);<br />
xml_parser_free($xml_parser);<br />
<br />
$params = array();<br />
$level = array();<br />
foreach ($vals as $xml_elem) {<br />
&nbsp; if ($xml_elem['type'] == 'open') {<br />
&nbsp;&nbsp; if (array_key_exists('attributes',$xml_elem)) {<br />
&nbsp;&nbsp; &nbsp; list($level[$xml_elem['level']],$extra) = array_values($xml_elem['attributes']);<br />
&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; $level[$xml_elem['level']] = $xml_elem['tag'];<br />
&nbsp;&nbsp; }<br />
&nbsp; }<br />
&nbsp; if ($xml_elem['type'] == 'complete') {<br />
&nbsp;&nbsp; $start_level = 1;<br />
&nbsp;&nbsp; $php_stmt = '$params';<br />
&nbsp;&nbsp; while($start_level &lt; $xml_elem['level']) {<br />
&nbsp;&nbsp; &nbsp; $php_stmt .= '[$level['.$start_level.']]';<br />
&nbsp;&nbsp; &nbsp; $start_level++;<br />
&nbsp;&nbsp; }<br />
&nbsp;&nbsp; $php_stmt .= '[$xml_elem[\'tag\']] = $xml_elem[\'value\'];';<br />
&nbsp;&nbsp; eval($php_stmt);<br />
&nbsp; }<br />
}<br />
<br />
echo "&lt;pre&gt;";<br />
print_r ($params);<br />
echo "&lt;/pre&gt;";<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69442""></a>
  <div class="note">
   <strong class="user">mad dot cat at mcmadcat dot com</strong>
   <a href="#69442" class="date">06-Sep-2006 01:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
this my love function:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">mc_parse_xml</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$xml </span><span class="keyword">= </span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$p </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">xml_parse_into_struct</span><span class="keyword">(</span><span class="default">$p</span><span class="keyword">, </span><span class="default">$xml</span><span class="keyword">, </span><span class="default">$values</span><span class="keyword">, </span><span class="default">$index</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$p</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">count</span><span class="keyword">(</span><span class="default">$values</span><span class="keyword">);</span><span class="default">$i</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (isset(</span><span class="default">$values</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][</span><span class="string">'attributes'</span><span class="keyword">])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$parent </span><span class="keyword">= </span><span class="default">$values</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][</span><span class="string">'tag'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$keys </span><span class="keyword">= </span><span class="default">array_keys</span><span class="keyword">(</span><span class="default">$values</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][</span><span class="string">'attributes'</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for (</span><span class="default">$z</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$z</span><span class="keyword">&lt;</span><span class="default">count</span><span class="keyword">(</span><span class="default">$keys</span><span class="keyword">);</span><span class="default">$z</span><span class="keyword">++)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$content</span><span class="keyword">[</span><span class="default">$parent</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">][</span><span class="default">$keys</span><span class="keyword">[</span><span class="default">$z</span><span class="keyword">]] = </span><span class="default">$values</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][</span><span class="string">'attributes'</span><span class="keyword">][</span><span class="default">$keys</span><span class="keyword">[</span><span class="default">$z</span><span class="keyword">]];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (isset(</span><span class="default">$content</span><span class="keyword">[</span><span class="default">$parent</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">][</span><span class="string">'VALUE'</span><span class="keyword">])) </span><span class="default">$content</span><span class="keyword">[</span><span class="default">$parent</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">][</span><span class="string">'VALUE'</span><span class="keyword">] = </span><span class="default">$values</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][</span><span class="string">'value'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$content </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$values</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$content</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">] = </span><span class="default">array_values</span><span class="keyword">(</span><span class="default">$content</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">]); <br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$content</span><span class="keyword">)) return </span><span class="default">$content</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; else return </span><span class="default">false</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68173""></a>
  <div class="note">
   <strong class="user">webmaster at unitedscripters dot com</strong>
   <a href="#68173" class="date">17-Jul-2006 02:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Ps keep in mind that some Rss feeds include spurious tags as... html entities (see Google news Rss feeds: they include tables as &amp;lt;table blah blah!).<br />
<br />
If so, in my rssSnapper below add this:<br />
<br />
<span class="default">&lt;?php<br />
$input</span><span class="keyword">=</span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"/(&lt;!\\[CDATA\\[)|(\\]\\]&gt;)/"</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$input</span><span class="keyword">);<br />
</span><span class="default">$input</span><span class="keyword">=</span><span class="default">html_entity_decode</span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">); </span><span class="comment">//&lt;-- added line<br />
</span><span class="default">?&gt;<br />
</span><br />
You may play around with the code and make it perfect, testing it on various feeds. Not _all_ XML is worth of an XML parser and the sleepless nights it entails.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68171""></a>
  <div class="note">
   <strong class="user">webmaster at unitedscripters dot com</strong>
   <a href="#68171" class="date">16-Jul-2006 11:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It may be not entirely immaterial to stress that when you are dealing with incoming XML files such as RSS feeds, and you are about to include several of them in some page of yours, resorting to the PHP XML oriented functions is neither _necessarily_ the best idea, nor it is _strictly_ indispensable.<br />
<br />
I have in mind, here, also a note that time ago was on this documentation by some info at gramba dot tv:<br />
<br />
QUOTE<br />
I was working with the xml2array functions below and had big performance problems. I fired them on a 20MB XML file and had to quit since all approaches of parsing where just too slow (more than 20 Minute parsing etc..). The solution was parsing it manually with preg_match, which increased performance by more than 20 times (processing time about 1 minute).<br />
UNQUOTE<br />
<br />
Calling in a specific XML structure function, and arranging a whole class, when all you want from an incoming files may be the contents of a few tags, is not the only option you are left with, when you are at PHP.<br />
<br />
Here is a simple function that parses a XML RSS feed using no XML oriented function: keeping this in mind may spare you the need to create extremely complex classes as the ones we see here when _all_ you may want is a few titles and descriptions from an RSS (if that's your goal, you don't need XML parsers):<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">rssSnapper</span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">, </span><span class="default">$limit</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">, </span><span class="default">$feedChannel</span><span class="keyword">=</span><span class="string">'Yahoo!News'</span><span class="keyword">){<br />
</span><span class="default">$input</span><span class="keyword">=</span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if(!</span><span class="default">$input</span><span class="keyword">){return </span><span class="string">''</span><span class="keyword">;};<br />
</span><span class="default">$input</span><span class="keyword">=</span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"/[\\n\\r\\t]+/"</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$input</span><span class="keyword">);<br />
</span><span class="default">$input</span><span class="keyword">=</span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"/(&lt;!\\[CDATA\\[)|(\\]\\]&gt;)/"</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$input</span><span class="keyword">);<br />
</span><span class="default">preg_match_all</span><span class="keyword">(</span><span class="string">"/&lt;item&gt;(.*?)&lt;\\/item&gt;/"</span><span class="keyword">, </span><span class="default">$input</span><span class="keyword">, </span><span class="default">$items</span><span class="keyword">, </span><span class="default">PREG_SET_ORDER</span><span class="keyword">);<br />
</span><span class="default">$limit</span><span class="keyword">=(int)</span><span class="default">$limit</span><span class="keyword">;<br />
</span><span class="default">$limit</span><span class="keyword">=(</span><span class="default">$limit </span><span class="keyword">&amp;&amp; </span><span class="default">is_numeric</span><span class="keyword">(</span><span class="default">$limit</span><span class="keyword">) &amp;&amp; </span><span class="default">abs</span><span class="keyword">(</span><span class="default">$limit</span><span class="keyword">)&lt;</span><span class="default">sizeof</span><span class="keyword">(</span><span class="default">$items</span><span class="keyword">))? </span><span class="default">sizeof</span><span class="keyword">(</span><span class="default">$items</span><span class="keyword">)-</span><span class="default">abs</span><span class="keyword">(</span><span class="default">$limit</span><span class="keyword">): </span><span class="default">0</span><span class="keyword">;<br />
while(</span><span class="default">sizeof</span><span class="keyword">(</span><span class="default">$items</span><span class="keyword">)&gt;</span><span class="default">$limit</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$item</span><span class="keyword">=</span><span class="default">array_shift</span><span class="keyword">(</span><span class="default">$items</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$item</span><span class="keyword">=</span><span class="default">$item</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">preg_match_all</span><span class="keyword">(</span><span class="string">"/&lt;link&gt;(.*?)&lt;\\/link&gt;/"</span><span class="keyword">, </span><span class="default">$item</span><span class="keyword">, </span><span class="default">$link</span><span class="keyword">, </span><span class="default">PREG_SET_ORDER</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">preg_match_all</span><span class="keyword">(</span><span class="string">"/&lt;title&gt;(.*?)&lt;\\/title&gt;/"</span><span class="keyword">, </span><span class="default">$item</span><span class="keyword">, </span><span class="default">$title</span><span class="keyword">, </span><span class="default">PREG_SET_ORDER</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">preg_match_all</span><span class="keyword">(</span><span class="string">"/&lt;author&gt;(.*?)&lt;\\/author&gt;/"</span><span class="keyword">, </span><span class="default">$item</span><span class="keyword">, </span><span class="default">$author</span><span class="keyword">, </span><span class="default">PREG_SET_ORDER</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">preg_match_all</span><span class="keyword">(</span><span class="string">"/&lt;pubDate&gt;(.*?)&lt;\\/pubDate&gt;/"</span><span class="keyword">, </span><span class="default">$item</span><span class="keyword">, </span><span class="default">$pubDate</span><span class="keyword">, </span><span class="default">PREG_SET_ORDER</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">preg_match_all</span><span class="keyword">(</span><span class="string">"/&lt;description&gt;(.*?)&lt;\\/description&gt;/"</span><span class="keyword">, </span><span class="default">$item</span><span class="keyword">, </span><span class="default">$description</span><span class="keyword">, </span><span class="default">PREG_SET_ORDER</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">sizeof</span><span class="keyword">(</span><span class="default">$link</span><span class="keyword">)){ </span><span class="default">$link </span><span class="keyword">= </span><span class="default">strip_tags</span><span class="keyword">(</span><span class="default">$link</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">][</span><span class="default">1</span><span class="keyword">]); };<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">sizeof</span><span class="keyword">(</span><span class="default">$title</span><span class="keyword">)){ </span><span class="default">$title </span><span class="keyword">= </span><span class="default">strtoupper</span><span class="keyword">( </span><span class="default">strip_tags</span><span class="keyword">(</span><span class="default">$title</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">][</span><span class="default">1</span><span class="keyword">]) ); };<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">sizeof</span><span class="keyword">(</span><span class="default">$author</span><span class="keyword">)){ </span><span class="default">$author </span><span class="keyword">= </span><span class="default">strip_tags</span><span class="keyword">(</span><span class="default">$author</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">][</span><span class="default">1</span><span class="keyword">]); };<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">sizeof</span><span class="keyword">(</span><span class="default">$pubDate</span><span class="keyword">)){ </span><span class="default">$pubDate </span><span class="keyword">= </span><span class="default">strip_tags</span><span class="keyword">(</span><span class="default">$pubDate</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">][</span><span class="default">1</span><span class="keyword">]); };<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">sizeof</span><span class="keyword">(</span><span class="default">$description</span><span class="keyword">)){ </span><span class="default">$description </span><span class="keyword">= </span><span class="default">strip_tags</span><span class="keyword">(</span><span class="default">$description</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">][</span><span class="default">1</span><span class="keyword">]); };<br />
&nbsp;&nbsp;&nbsp; print &lt;&lt;&lt;USAVIT<br />
</span><span class="string">&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; &lt;!-- ITEM STARTS --&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;div class="news_bg_trick"&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;a href="</span><span class="default">$link</span><span class="string">" class="item" target="_blank"&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;span class="title"&gt;</span><span class="default">$title</span><span class="string">&lt;span class="channel"&gt;</span><span class="default">$feedChannel</span><span class="string">&lt;/span&gt;&lt;/span&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;span class="title_footer"&gt;<br />
&nbsp;&nbsp;&nbsp; by &lt;span class="author"&gt;</span><span class="default">$author</span><span class="string">&lt;/span&gt; -<br />
&nbsp;&nbsp;&nbsp; &lt;span class="date"&gt;</span><span class="default">$pubDate</span><span class="string">&lt;/span&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;/span&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;span class="description"&gt;</span><span class="default">$description</span><span class="string">&lt;/span&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;/a&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;/div&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;!-- ITEM ENDS --&gt;<br />
&nbsp;&nbsp;&nbsp; <br />
</span><span class="keyword">USAVIT;<br />
}</span><span class="comment">//out of loop<br />
/*unitedscripters.com*/</span><span class="keyword">}<br />
</span><span class="default">?&gt;<br />
</span><br />
The printing phase assigns Css class names: the output is thus fully customizable by a mere style sheet.<br />
<br />
The use of strip_tags is a reminder from Chris Shiflett: distrust incoming data, always, anyway.<br />
I hope no typos slipped in in transcription. Arguably not perfect, but I hope a good alternative idea to spending three days on a full fledged XML parser just to grab... three tags from a RSS feed!<br />
bye, ALberto</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="66487""></a>
  <div class="note">
   <strong class="user">efredricksen at gmail dot com</strong>
   <a href="#66487" class="date">24-May-2006 09:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Perhaps the one true parser:? I modified xademax's fine code to tidy it up, codewise and style wise, rationalize some minor crazyness, and make names fit nomenclature from the XML spec. (There are no uses of eval, and shame on you people who do.)<br />
<br />
<span class="default">&lt;?php <br />
</span><span class="keyword">class </span><span class="default">XmlElement </span><span class="keyword">{<br />
&nbsp; var </span><span class="default">$name</span><span class="keyword">;<br />
&nbsp; var </span><span class="default">$attributes</span><span class="keyword">;<br />
&nbsp; var </span><span class="default">$content</span><span class="keyword">;<br />
&nbsp; var </span><span class="default">$children</span><span class="keyword">;<br />
};<br />
<br />
function </span><span class="default">xml_to_object</span><span class="keyword">(</span><span class="default">$xml</span><span class="keyword">) {<br />
&nbsp; </span><span class="default">$parser </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">();<br />
&nbsp; </span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">XML_OPTION_CASE_FOLDING</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
&nbsp; </span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">XML_OPTION_SKIP_WHITE</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp; </span><span class="default">xml_parse_into_struct</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$xml</span><span class="keyword">, </span><span class="default">$tags</span><span class="keyword">);<br />
&nbsp; </span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">);<br />
<br />
&nbsp; </span><span class="default">$elements </span><span class="keyword">= array();&nbsp; </span><span class="comment">// the currently filling [child] XmlElement array<br />
&nbsp; </span><span class="default">$stack </span><span class="keyword">= array();<br />
&nbsp; foreach (</span><span class="default">$tags </span><span class="keyword">as </span><span class="default">$tag</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$index </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$elements</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">"complete" </span><span class="keyword">|| </span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">"open"</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$elements</span><span class="keyword">[</span><span class="default">$index</span><span class="keyword">] = new </span><span class="default">XmlElement</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$elements</span><span class="keyword">[</span><span class="default">$index</span><span class="keyword">]-&gt;</span><span class="default">name </span><span class="keyword">= </span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$elements</span><span class="keyword">[</span><span class="default">$index</span><span class="keyword">]-&gt;</span><span class="default">attributes </span><span class="keyword">= </span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'attributes'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$elements</span><span class="keyword">[</span><span class="default">$index</span><span class="keyword">]-&gt;</span><span class="default">content </span><span class="keyword">= </span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">"open"</span><span class="keyword">) {&nbsp; </span><span class="comment">// push<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$elements</span><span class="keyword">[</span><span class="default">$index</span><span class="keyword">]-&gt;</span><span class="default">children </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$stack</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$stack</span><span class="keyword">)] = &amp;</span><span class="default">$elements</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$elements </span><span class="keyword">= &amp;</span><span class="default">$elements</span><span class="keyword">[</span><span class="default">$index</span><span class="keyword">]-&gt;</span><span class="default">children</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$tag</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">"close"</span><span class="keyword">) {&nbsp; </span><span class="comment">// pop<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$elements </span><span class="keyword">= &amp;</span><span class="default">$stack</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$stack</span><span class="keyword">) - </span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp;&nbsp; unset(</span><span class="default">$stack</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$stack</span><span class="keyword">) - </span><span class="default">1</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
&nbsp; return </span><span class="default">$elements</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];&nbsp; </span><span class="comment">// the single top-level element<br />
</span><span class="keyword">}<br />
<br />
</span><span class="comment">// For example:<br />
</span><span class="default">$xml </span><span class="keyword">= </span><span class="string">'<br />
&lt;parser&gt;<br />
&nbsp;&nbsp; &lt;name language="en-us"&gt;Fred Parser&lt;/name&gt;<br />
&nbsp;&nbsp; &lt;category&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &lt;name&gt;Nomenclature&lt;/name&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &lt;note&gt;Noteworthy&lt;/note&gt;<br />
&nbsp;&nbsp; &lt;/category&gt;<br />
&lt;/parser&gt;<br />
'</span><span class="keyword">;<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">xml_to_object</span><span class="keyword">(</span><span class="default">$xml</span><span class="keyword">));<br />
</span><span class="default">?&gt;<br />
</span><br />
will give:<br />
<br />
xmlelement Object<br />
(<br />
&nbsp;&nbsp;&nbsp; [name] =&gt; parser<br />
&nbsp;&nbsp;&nbsp; [attributes] =&gt; <br />
&nbsp;&nbsp;&nbsp; [content] =&gt; <br />
&nbsp;&nbsp;&nbsp; [children] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [0] =&gt; xmlelement Object<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [name] =&gt; name<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [attributes] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [language] =&gt; en-us<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [content] =&gt; Fred Parser<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [children] =&gt; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [1] =&gt; xmlelement Object<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [name] =&gt; category<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [attributes] =&gt; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [content] =&gt; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [children] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [0] =&gt; xmlelement Object<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [name] =&gt; name<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [attributes] =&gt; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [content] =&gt; Nomenclature<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [children] =&gt; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [1] =&gt; xmlelement Object<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [name] =&gt; note<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [attributes] =&gt; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [content] =&gt; Noteworthy<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [children] =&gt; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="66479""></a>
  <div class="note">
   <strong class="user">Stuart</strong>
   <a href="#66479" class="date">24-May-2006 12:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is a great little function for a lot of XML work, but note that this function does not handle XML entities properly.<br />
<br />
The basic XML entities &amp;lt; &amp;gt; &amp;amp; &amp;quot; are fine, just anything else will not work:<br />
<br />
If the entity is defined in the XML header, the parser will drop it completely from the struct it creates.<br />
<br />
If the entity is not defined in the XML then the parser will crash out with an undefined entity error.<br />
<br />
You should be able to work around this limitation by using a preg_replace on your XML string before passing it to the parser.<br />
<br />
(Further details in Bug #35271; this is just a warning to those thinking of using this function for parsing real XML documents not just trivial XML examples)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="65332""></a>
  <div class="note">
   <strong class="user">donna at coloma dot com</strong>
   <a href="#65332" class="date">28-Apr-2006 09:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I needed a very simple parser for a set of name-value pairs to be stored in a single database field. I started with the mold example, paired it down, picked up the "id" attributes. Perhaps it will be useful for someone else. <br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/* simple conversion for name-value fields */<br />
<br />
</span><span class="default">$xmlInput </span><span class="keyword">= </span><span class="string">"&lt;?xml version=\"1.0\"?&gt;<br />
&lt;mcw_settings&gt;<br />
&nbsp; &lt;field id=\"imageAlign\"&gt;left&lt;/field&gt;<br />
&nbsp; &lt;field id=\"caption\"&gt;What a nice picture.&lt;/field&gt;<br />
&lt;/mcw_settings&gt;"</span><span class="keyword">;<br />
<br />
</span><span class="default">$desiredResult </span><span class="keyword">= array (<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'imageAlign' </span><span class="keyword">=&gt; </span><span class="string">"left"</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'caption' </span><span class="keyword">=&gt; </span><span class="string">"What a nice picture."<br />
</span><span class="keyword">);<br />
<br />
function </span><span class="default">parseFields </span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// read the XML database of fields<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$parser </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">XML_OPTION_CASE_FOLDING</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">XML_OPTION_SKIP_WHITE</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">xml_parse_into_struct</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">, </span><span class="default">$values</span><span class="keyword">, </span><span class="default">$tags</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fields </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// loop through the structures<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fieldIndices </span><span class="keyword">= </span><span class="default">$tags</span><span class="keyword">[</span><span class="string">'field'</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; for ( </span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">count</span><span class="keyword">(</span><span class="default">$fieldIndices</span><span class="keyword">); </span><span class="default">$i</span><span class="keyword">++ ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fieldInfo </span><span class="keyword">= </span><span class="default">$values</span><span class="keyword">[</span><span class="default">$fieldIndices</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fields</span><span class="keyword">[</span><span class="default">$fieldInfo</span><span class="keyword">[</span><span class="string">'attributes'</span><span class="keyword">][</span><span class="string">'id'</span><span class="keyword">]] = </span><span class="default">$fieldInfo</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$fields</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">$test </span><span class="keyword">= </span><span class="default">parseFields</span><span class="keyword">(</span><span class="default">$xmlInput</span><span class="keyword">);<br />
echo </span><span class="string">"** Result:\n"</span><span class="keyword">;<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$test</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="63879""></a>
  <div class="note">
   <strong class="user">matt at australiangamer dot com</strong>
   <a href="#63879" class="date">03-Apr-2006 04:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I liked VampBoy's code as it gave me structure pretty much as I wanted it. Just two notes, though:<br />
<br />
There is a bug in this code. subdivide() checks for pre-existing values, but not in the case of a "complete" element.<br />
<br />
In the following (appallingly bad) XML<br />
<br />
&lt;Names&gt;<br />
&lt;Name&gt;Matt&lt;/Name&gt;<br />
&lt;Name&gt;Stacy&lt;/Name&gt;<br />
&lt;Names&gt; <br />
<br />
Only Stacy is added to Names in the array, wiping Matt in the process.<br />
<br />
To fix this replace the following code <br />
<span class="default">&lt;?php<br />
</span><span class="keyword">elseif (</span><span class="default">$dat</span><span class="keyword">[</span><span class="default">level</span><span class="keyword">] === </span><span class="default">$level </span><span class="keyword">&amp;&amp; </span><span class="default">$dat</span><span class="keyword">[</span><span class="default">type</span><span class="keyword">] === </span><span class="string">"complete"</span><span class="keyword">){<br />
&nbsp;&nbsp; </span><span class="default">$newarray</span><span class="keyword">[</span><span class="default">$dat</span><span class="keyword">[</span><span class="default">tag</span><span class="keyword">]]=</span><span class="default">$dat</span><span class="keyword">[</span><span class="default">value</span><span class="keyword">];<br />
}<br />
</span><span class="default">?&gt;<br />
</span>with <br />
<span class="default">&lt;?php<br />
</span><span class="keyword">elseif (</span><span class="default">$dat</span><span class="keyword">[</span><span class="default">level</span><span class="keyword">] === </span><span class="default">$level </span><span class="keyword">&amp;&amp; </span><span class="default">$dat</span><span class="keyword">[</span><span class="default">type</span><span class="keyword">] === </span><span class="string">"complete"</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; if (isset(</span><span class="default">$newarray</span><span class="keyword">[</span><span class="default">$dat</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]]) &amp;&amp; </span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$newarray</span><span class="keyword">[</span><span class="default">$dat</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]])){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$newarray</span><span class="keyword">[</span><span class="default">$dat</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]][] = </span><span class="default">$dat</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; } elseif (isset(</span><span class="default">$newarray</span><span class="keyword">[</span><span class="default">$dat</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]]) &amp;&amp; !</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$newarray</span><span class="keyword">[</span><span class="default">$dat</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]])){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$newarray</span><span class="keyword">[</span><span class="default">$dat</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]] = array(</span><span class="default">$newarray</span><span class="keyword">[</span><span class="default">$dat</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]], </span><span class="default">$dat</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$newarray</span><span class="keyword">[</span><span class="default">$dat</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]]=</span><span class="default">$dat</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; }<br />
}</span><span class="default">?&gt;<br />
</span><br />
Oh, also, note that the $dat[level], etc, WILL generate warnings, and should be more correctly written as $dat['level'].<br />
<br />
The other thing I thought I should point out is that the array keys when created using xml_parse_into_struct will be an UPPERCASE version of your existing element names. If case is important, especially if you, like me, need mixedCase, do the following:<br />
<br />
<span class="default">&lt;?php<br />
$xml_parser </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">();<br />
</span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">,</span><span class="default">XML_OPTION_CASE_FOLDING</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="63761""></a>
  <div class="note">
   
   <a href="#63761" class="date">30-Mar-2006 08:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
$simple = '&lt;?xml version="1.0"?&gt;<br />
&lt;moldb&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;molecule&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;name&gt;Alanine&lt;/name&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;symbol&gt;ala&lt;/symbol&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;code&gt;A&lt;/code&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;type&gt;hydrophobic&lt;/type&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;/molecule&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;molecule&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;name&gt;Lysine&lt;/name&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;symbol&gt;lys&lt;/symbol&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;code&gt;K&lt;/code&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;type&gt;charged&lt;/type&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;/molecule&gt;<br />
&lt;/moldb&gt;';<br />
<br />
$p = xml_parser_create();<br />
xml_parse_into_struct($p, $simple, $vals, $index);<br />
xml_parser_free($p);<br />
echo "&lt;pre&gt;";<br />
echo "Index array\n";<br />
print_r($index);<br />
echo "\nVals array\n";<br />
print_r($vals);<br />
<br />
foreach ($vals as $k =&gt; $v) {<br />
&nbsp;&nbsp;&nbsp; $i = 0;<br />
&nbsp;&nbsp;&nbsp; if (trim($v['value']) != '') {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ($arr[$i][$v['tag']] != '') {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $i ++;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $arr[$i][$v['tag']] = $v['value'];<br />
&nbsp;&nbsp;&nbsp; }<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="60485""></a>
  <div class="note">
   <strong class="user">xademax at gmail dot com</strong>
   <a href="#60485" class="date">08-Jan-2006 09:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is just another simple xml parser :)<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">class </span><span class="default">Xml<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$tag</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$value</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$attributes</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$next</span><span class="keyword">;<br />
}<br />
<br />
function </span><span class="default">xml2array</span><span class="keyword">(</span><span class="default">$xml_string</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$Parser </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$Parser</span><span class="keyword">, </span><span class="default">XML_OPTION_CASE_FOLDING</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$Parser</span><span class="keyword">, </span><span class="default">XML_OPTION_SKIP_WHITE</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">xml_parse_into_struct</span><span class="keyword">(</span><span class="default">$Parser</span><span class="keyword">, </span><span class="default">$xml_string</span><span class="keyword">, </span><span class="default">$Xml_Values</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$Parser</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$XmlClass </span><span class="keyword">= array();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$LastObj </span><span class="keyword">= array();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$NowObj </span><span class="keyword">= &amp;</span><span class="default">$XmlClass</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; foreach(</span><span class="default">$Xml_Values </span><span class="keyword">as </span><span class="default">$Xml_Key </span><span class="keyword">=&gt; </span><span class="default">$Xml_Value</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$Index </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$NowObj</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$Xml_Value</span><span class="keyword">[</span><span class="string">"type"</span><span class="keyword">] == </span><span class="string">"complete"</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$NowObj</span><span class="keyword">[</span><span class="default">$Index</span><span class="keyword">] = new </span><span class="default">Xml</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$NowObj</span><span class="keyword">[</span><span class="default">$Index</span><span class="keyword">]-&gt;</span><span class="default">tag </span><span class="keyword">= </span><span class="default">$Xml_Value</span><span class="keyword">[</span><span class="string">"tag"</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$NowObj</span><span class="keyword">[</span><span class="default">$Index</span><span class="keyword">]-&gt;</span><span class="default">value </span><span class="keyword">= </span><span class="default">$Xml_Value</span><span class="keyword">[</span><span class="string">"value"</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$NowObj</span><span class="keyword">[</span><span class="default">$Index</span><span class="keyword">]-&gt;</span><span class="default">attributes </span><span class="keyword">= </span><span class="default">$Xml_Value</span><span class="keyword">[</span><span class="string">"attributes"</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; elseif(</span><span class="default">$Xml_Value</span><span class="keyword">[</span><span class="string">"type"</span><span class="keyword">] == </span><span class="string">"open"</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$NowObj</span><span class="keyword">[</span><span class="default">$Index</span><span class="keyword">] = new </span><span class="default">Xml</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$NowObj</span><span class="keyword">[</span><span class="default">$Index</span><span class="keyword">]-&gt;</span><span class="default">tag </span><span class="keyword">= </span><span class="default">$Xml_Value</span><span class="keyword">[</span><span class="string">"tag"</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$NowObj</span><span class="keyword">[</span><span class="default">$Index</span><span class="keyword">]-&gt;</span><span class="default">value </span><span class="keyword">= </span><span class="default">$Xml_Value</span><span class="keyword">[</span><span class="string">"value"</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$NowObj</span><span class="keyword">[</span><span class="default">$Index</span><span class="keyword">]-&gt;</span><span class="default">attributes </span><span class="keyword">= </span><span class="default">$Xml_Value</span><span class="keyword">[</span><span class="string">"attributes"</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$NowObj</span><span class="keyword">[</span><span class="default">$Index</span><span class="keyword">]-&gt;</span><span class="default">next </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$LastObj</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$LastObj</span><span class="keyword">)] = &amp;</span><span class="default">$NowObj</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$NowObj </span><span class="keyword">= &amp;</span><span class="default">$NowObj</span><span class="keyword">[</span><span class="default">$Index</span><span class="keyword">]-&gt;</span><span class="default">next</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; elseif(</span><span class="default">$Xml_Value</span><span class="keyword">[</span><span class="string">"type"</span><span class="keyword">] == </span><span class="string">"close"</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$NowObj </span><span class="keyword">= &amp;</span><span class="default">$LastObj</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$LastObj</span><span class="keyword">) - </span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; unset(</span><span class="default">$LastObj</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$LastObj</span><span class="keyword">) - </span><span class="default">1</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$XmlClass</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">$String </span><span class="keyword">= </span><span class="string">"<br />
&lt;parser&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;parseur_name&gt;MyParser&lt;/parseur_name&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;category&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;name&gt;Name 1&lt;/name&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;note&gt;A note 1&lt;/note&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;/category&gt;<br />
&lt;/parser&gt;<br />
"</span><span class="keyword">;<br />
</span><span class="default">$Xml </span><span class="keyword">= </span><span class="default">xml2array</span><span class="keyword">(</span><span class="default">$String</span><span class="keyword">);<br />
<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$Xml</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
This exemple will show : <br />
Array<br />
(<br />
&nbsp;&nbsp;&nbsp; [0] =&gt; Xml Object<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [tag] =&gt; parser<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [value] =&gt; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [attributes] =&gt; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [next] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [0] =&gt; Xml Object<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [tag] =&gt; parseur_name<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [value] =&gt; MyParser<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [attributes] =&gt; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [next] =&gt; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [1] =&gt; Xml Object<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [tag] =&gt; category<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [value] =&gt; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [attributes] =&gt; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [next] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [0] =&gt; Xml Object<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [tag] =&gt; name<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [value] =&gt; Name 1<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [attributes] =&gt; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [next] =&gt; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [1] =&gt; Xml Object<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [tag] =&gt; note<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [value] =&gt; A note 1<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [attributes] =&gt; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [next] =&gt; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="59753""></a>
  <div class="note">
   <strong class="user">VampBoy</strong>
   <a href="#59753" class="date">14-Dec-2005 11:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
WHUPS! that was a broken test version.here is the real one:<br />
<br />
class xml2array{<br />
/* This class parses XML tags into a recursive, associative array with the tags as the associative array elements names.<br />
<br />
if it encounters multiples of the same tag within a stream, it enumerates them as a sub array under the tag thus:<br />
<br />
Array (<br />
&nbsp;&nbsp;&nbsp; [Lvl1tag] =&gt; Array (<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; [0] =&gt; Array(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [Lvl2tag] = "foo")<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; [1]=&gt; Array(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [Lvl2tag] = "bar")<br />
&nbsp;&nbsp;&nbsp; )<br />
)<br />
<br />
It tries to detect when there is only one copy of a tag under another, and concatinate properly.<br />
*/<br />
<br />
&nbsp;&nbsp;&nbsp; function readxmlfile($xmlfile){ // reads XML file in and returns it<br />
&nbsp;&nbsp; &nbsp;&nbsp; $xmlstream =fopen($xmlfile,r);<br />
&nbsp;&nbsp; &nbsp;&nbsp; $xmlraw=fread($xmlstream,1000000);<br />
&nbsp;&nbsp; &nbsp;&nbsp; fclose($xmlstream);<br />
&nbsp;&nbsp; &nbsp;&nbsp; return $xmlraw;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function parseXMLintoarray ($xmldata){ // starts the process and returns the final array<br />
&nbsp;&nbsp; &nbsp;&nbsp; $xmlparser = xml_parser_create();<br />
&nbsp;&nbsp; &nbsp;&nbsp; xml_parse_into_struct($xmlparser, $xmldata, $arraydat);<br />
&nbsp;&nbsp; &nbsp;&nbsp; xml_parser_free($xmlparser);<br />
&nbsp;&nbsp; &nbsp;&nbsp; $semicomplete = $this-&gt;subdivide($arraydat);<br />
&nbsp;&nbsp; &nbsp;&nbsp; $complete = $this-&gt;correctentries($semicomplete);<br />
&nbsp;&nbsp; &nbsp;&nbsp; return $complete;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function subdivide ($dataarray, $level = 1){<br />
&nbsp;&nbsp; &nbsp;&nbsp; foreach ($dataarray as $key =&gt; $dat){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ($dat[level] === $level &amp;&amp; $dat[type] === "open"){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $toplvltag = $dat[tag];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } elseif ($dat[level] === $level &amp;&amp; $dat[type] === "close" &amp;&amp; $dat[tag]=== $toplvltag){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $newarray[$toplvltag][] = $this-&gt;subdivide($temparray,($level +1));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; unset($temparray,$nextlvl);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } elseif ($dat[level] === $level &amp;&amp; $dat[type] === "complete"){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $newarray[$dat[tag]]=$dat[value];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } elseif ($dat[type] === "complete"||$dat[type] === "close"||$dat[type] === "open"){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $temparray[]=$dat;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; return $newarray;<br />
&nbsp;&nbsp;&nbsp; }<br />
function correctentries($dataarray){<br />
<br />
if (is_array($dataarray)){<br />
&nbsp; $keys =&nbsp; array_keys($dataarray);<br />
&nbsp; if (count($keys)== 1 &amp;&amp; is_int($keys[0])){<br />
&nbsp;&nbsp;&nbsp; $tmp = $dataarray[0];<br />
&nbsp;&nbsp;&nbsp; unset($dataarray[0]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; $dataarray = $tmp;<br />
&nbsp; }<br />
&nbsp; $keys2 = array_keys($dataarray);<br />
&nbsp; foreach($keys2 as $key){<br />
&nbsp;&nbsp;&nbsp; $tmp2 = $dataarray[$key];<br />
&nbsp;&nbsp;&nbsp; unset($dataarray[$key]);<br />
&nbsp;&nbsp;&nbsp; $dataarray[$key] = $this-&gt;correctentries($tmp2);<br />
&nbsp;&nbsp;&nbsp; unset($tmp2);<br />
&nbsp; }<br />
&nbsp; }<br />
return $dataarray;<br />
}<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="59686""></a>
  <div class="note">
   <strong class="user">p dot gasiorowski at axent dot pl</strong>
   <a href="#59686" class="date">13-Dec-2005 03:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Something similar to kieran's _xml2array, however much more faster.<br />
------<br />
class ObjectFromXML<br />
{<br />
&nbsp;&nbsp;&nbsp; var $parser;<br />
&nbsp;&nbsp;&nbsp; var $iter = 0; <br />
&nbsp;&nbsp;&nbsp; var $path = array();<br />
&nbsp;&nbsp;&nbsp; var $xml = array();<br />
<br />
&nbsp;&nbsp;&nbsp; function ObjectFromXML($XML)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;parser = xml_parser_create();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; xml_set_object($this-&gt;parser, &amp;$this);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; xml_parser_set_option($this-&gt;parser, XML_OPTION_SKIP_WHITE, 1);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; xml_parser_set_option($this-&gt;parser, XML_OPTION_CASE_FOLDING, 0);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; xml_set_element_handler($this-&gt;parser, "hanleTagStart", "hanleTagEnd");<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; xml_set_character_data_handler($this-&gt;parser, "hanleTagCData");<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; xml_parse($this-&gt;parser, $XML);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; xml_parser_free($this-&gt;parser);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;xml = $this-&gt;xml['_children'][0];<br />
&nbsp;&nbsp;&nbsp; } <br />
<br />
&nbsp;&nbsp;&nbsp; function getEvalPath()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return '$this-&gt;xml[' . "'" . implode("']['", $this-&gt;path) . "'" . ']';<br />
&nbsp;&nbsp;&nbsp; } <br />
<br />
&nbsp;&nbsp;&nbsp; function hanleTagStart($parser, $tag, $attributes)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; array_push($this-&gt;path, '_children');<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; array_push($this-&gt;path, ($this-&gt;iter++));<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $e = $this-&gt;getEvalPath();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; eval ($e . "['_name'] = \$tag;");<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ($attributes !== array())<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; eval ($e . "['_attributes'] = \$attributes;");<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } <br />
&nbsp;&nbsp;&nbsp; } <br />
<br />
&nbsp;&nbsp;&nbsp; function hanleTagCData($parser, $cdata)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $e = $this-&gt;getEvalPath();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; eval ($e . "['_value'] = \$cdata;");<br />
&nbsp;&nbsp;&nbsp; } <br />
<br />
&nbsp;&nbsp;&nbsp; function hanleTagEnd($parser, $tag)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; array_pop($this-&gt;path);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; array_pop($this-&gt;path);<br />
&nbsp;&nbsp;&nbsp; } <br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="58568""></a>
  <div class="note">
   <strong class="user">mbirth at webwriters dot de</strong>
   <a href="#58568" class="date">08-Nov-2005 12:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Searching for a nice and working way to get a RSS feed into an array-structure, I found the solution posted by kieran but disliked those several eval()s. So I wrote my own using references/pointers.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">class </span><span class="default">RSSParser </span><span class="keyword">{<br />
&nbsp; <br />
&nbsp; var </span><span class="default">$struct </span><span class="keyword">= array();&nbsp; </span><span class="comment">// holds final structure<br />
&nbsp; </span><span class="keyword">var </span><span class="default">$curptr</span><span class="keyword">;&nbsp; </span><span class="comment">// current branch on $struct<br />
&nbsp; </span><span class="keyword">var </span><span class="default">$parents </span><span class="keyword">= array();&nbsp; </span><span class="comment">// parent branches of current branch<br />
&nbsp; <br />
&nbsp; </span><span class="keyword">function </span><span class="default">RSSParser</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">curptr </span><span class="keyword">=&amp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">struct</span><span class="keyword">;&nbsp; </span><span class="comment">// set ref to base<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$xmlparser </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">xml_set_object</span><span class="keyword">(</span><span class="default">$xmlparser</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">xml_set_element_handler</span><span class="keyword">(</span><span class="default">$xmlparser</span><span class="keyword">, </span><span class="string">'tag_open'</span><span class="keyword">, </span><span class="string">'tag_close'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">xml_set_character_data_handler</span><span class="keyword">(</span><span class="default">$xmlparser</span><span class="keyword">, </span><span class="string">'cdata'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">, </span><span class="string">'r'</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; while (</span><span class="default">$data </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">4096</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">xml_parse</span><span class="keyword">(</span><span class="default">$xmlparser</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">, </span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp;&nbsp; || die(</span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">"XML error: %s at line %d"</span><span class="keyword">, <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">xml_error_string</span><span class="keyword">(</span><span class="default">xml_get_error_code</span><span class="keyword">(</span><span class="default">$xmlparser</span><span class="keyword">)), <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">xml_get_current_line_number</span><span class="keyword">(</span><span class="default">$xmlparser</span><span class="keyword">)));<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$xmlparser</span><span class="keyword">);<br />
&nbsp; }<br />
&nbsp; <br />
&nbsp; function </span><span class="default">tag_open</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$tag</span><span class="keyword">, </span><span class="default">$attr</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$i </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">curptr</span><span class="keyword">[</span><span class="string">'children'</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$j </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parents</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">curptr</span><span class="keyword">[</span><span class="string">'children'</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">]=array();&nbsp; </span><span class="comment">// add new child element<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parents</span><span class="keyword">[</span><span class="default">$j</span><span class="keyword">] =&amp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">curptr</span><span class="keyword">;&nbsp; </span><span class="comment">// store current position as parent<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">curptr </span><span class="keyword">=&amp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">curptr</span><span class="keyword">[</span><span class="string">'children'</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">];&nbsp; </span><span class="comment">// submerge to newly created child element<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">curptr</span><span class="keyword">[</span><span class="string">'name'</span><span class="keyword">] = </span><span class="default">$tag</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">count</span><span class="keyword">(</span><span class="default">$attr</span><span class="keyword">)&gt;</span><span class="default">0</span><span class="keyword">) </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">curptr</span><span class="keyword">[</span><span class="string">'attr'</span><span class="keyword">] = </span><span class="default">$attr</span><span class="keyword">;<br />
&nbsp; }<br />
&nbsp; <br />
&nbsp; function </span><span class="default">tag_close</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$tag</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$i </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parents</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$i</span><span class="keyword">&gt;</span><span class="default">0</span><span class="keyword">) </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">curptr </span><span class="keyword">=&amp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parents</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">];&nbsp; </span><span class="comment">// return to parent element<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">unset(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">parents</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">]);&nbsp; </span><span class="comment">// clear from list of parents<br />
&nbsp; </span><span class="keyword">}<br />
&nbsp; <br />
&nbsp; function </span><span class="default">cdata</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if (!empty(</span><span class="default">$data</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">curptr</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">] .= </span><span class="default">$data</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
&nbsp; <br />
}<br />
<br />
</span><span class="default">$myparser </span><span class="keyword">= new </span><span class="default">RSSParser</span><span class="keyword">(</span><span class="string">'getitems.xml'</span><span class="keyword">);<br />
</span><span class="default">$anotherparser </span><span class="keyword">= new </span><span class="default">RSSParser</span><span class="keyword">(</span><span class="string">'<a href="http://johndoe:secret@myfeeds.com/getfeed.xml" rel="nofollow" target="_blank">http://johndoe:secret@myfeeds.com/getfeed.xml</a>'</span><span class="keyword">);<br />
<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$myparser</span><span class="keyword">-&gt;</span><span class="default">struct</span><span class="keyword">);<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$anotherparser</span><span class="keyword">-&gt;</span><span class="default">struct</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="57975""></a>
  <div class="note">
   <strong class="user">kieran at kieran dot ca</strong>
   <a href="#57975" class="date">20-Oct-2005 06:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
&lt;?
<br />
/*
<br />
|
<br />
| _xml2array - another abstraction layer on xml_parse_into_struct 
<br />
|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; that returns a nice nested array.
<br />
|
<br />
|&nbsp; &nbsp; &nbsp; @param: $xml is a string containing a full xml document
<br />
|
<br />
|&nbsp; &nbsp;&nbsp; returns: a nested php array that looks like this: 
<br />
|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; array
<br />
|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (
<br />
|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [_name] =&gt; the name of the tag
<br />
|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [_attributes] =&gt; an array of 'attribute'=&gt;'value' combos
<br />
|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [_value] =&gt; the text contents of the node
<br />
|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [_children] =&gt; an array of these arrays, one for each node.
<br />
|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )
<br />
|
<br />
|&nbsp; &nbsp; &nbsp;&nbsp; notes: thanks to 'jeffg at activestate dot com' who inspired
<br />
|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; me to essentially re-write his example code from php.net
<br />
|
<br />
|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; me: Kieran Huggins &lt; kieran[at]kieran[dot]ca &gt;
<br />
|
<br />
*/
<br />
function _xml2array($xml){
<br />
&nbsp;&nbsp;&nbsp; global $keys;
<br />
&nbsp;&nbsp;&nbsp; global $level;
<br />
&nbsp;&nbsp;&nbsp; if(!is_array($xml)){ // init on first run
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $raw_xml = $xml;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $p = xml_parser_create();
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; xml_parser_set_option($p, XML_OPTION_CASE_FOLDING, 0);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; xml_parser_set_option($p, XML_OPTION_SKIP_WHITE, 1);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; xml_parse_into_struct($p, $raw_xml, $xml, $idx);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; xml_parser_free($p);
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; for($i=0;$i&lt;count($xml,1);$i++){
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // set the current level
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $level = $xml[$i]['level'];
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if($level&lt;1)break;
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // mark this level's tag in the array
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $keys[$level] = '['.$i.']';
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // if we've come down a level, sort output and destroy the upper level
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(count($keys)&gt;$level) unset($keys[count($keys)]);
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // ignore close tags, they're useless
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if($xml[$i]['type']=="open" || $xml[$i]['type']=="complete"){
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // build the evalstring
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $e = '$output'.implode('[\'_children\']',$keys);
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // set the tag name
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; eval($e.'[\'_name\'] = $xml[$i][\'tag\'];');
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // set the attributes
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if($xml[$i]['attributes']){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; eval($e.'[\'_attributes\'] = $xml[$i][\'attributes\'];');
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // set the value
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if($xml[$i]['value']){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; eval($e.'[\'_value\'] = trim($xml[$i][\'value\']);');
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; return $output;
<br />
}
<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="56100""></a>
  <div class="note">
   <strong class="user">info at gramba dot tv</strong>
   <a href="#56100" class="date">23-Aug-2005 05:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I was working with the xml2array functions below and had big performance problems. I fired them on a 20MB XML file and had to quit since all approaches of parsing where just too slow (more than 20 Minute parsing etc..). The solution was parsing it manually with preg_match, which increased performance by more than 20 times (processing time about 1 minute).<br />
<br />
Rough example function with high performance:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">customXMLtoARRAY</span><span class="keyword">(</span><span class="default">$xmlstring</span><span class="keyword">) {<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// get all nodes<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">preg_match_all</span><span class="keyword">(</span><span class="string">"#&lt;node&gt;(.*?)&lt;/node&gt;#s"</span><span class="keyword">,</span><span class="default">$xmlstring</span><span class="keyword">,</span><span class="default">$nodes</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$xmlstring </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$allnodes </span><span class="keyword">= array();<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// put subnodes into node<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">while(</span><span class="default">$nodes </span><span class="keyword">= </span><span class="default">array_pop</span><span class="keyword">(</span><span class="default">$nodes</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">])) {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nodecontent </span><span class="keyword">= array();<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Content1<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"#&lt;content1&gt;(.*?)&lt;/content1&gt;#"</span><span class="keyword">,</span><span class="default">$eventreihe</span><span class="keyword">,</span><span class="default">$val</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nodecontent</span><span class="keyword">[</span><span class="string">'content1'</span><span class="keyword">] = </span><span class="default">$val</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$allnodes</span><span class="keyword">[] = </span><span class="default">$nodecontent</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$allnodes</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="55243""></a>
  <div class="note">
   <strong class="user">Chris Hester</strong>
   <a href="#55243" class="date">28-Jul-2005 02:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The array generated from XML stores not only the elements but also any spaces and linebreaks between the tags. This results in a much longer array. (I had 24 array fields instead of 10!) To cure this use the following code when creating the parser:<br />
<br />
<span class="default">&lt;?php<br />
$xml_parser </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">();<br />
</span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">,</span><span class="default">XML_OPTION_SKIP_WHITE</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="54934""></a>
  <div class="note">
   <strong class="user">grusin at gmail dot com</strong>
   <a href="#54934" class="date">20-Jul-2005 08:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is a simple patch to peter's xml2array function.<br />
<br />
Replace:<br />
<br />
&lt;?<br />
case 'open':<br />
$tag_or_id = (array_key_exists ('attributes', xml_elem)) ? $xml_elem['attributes']['ID'] : $xml_elem['tag'];<br />
$ptrs[$level][$tag_or_id] = array ();<br />
$ptrs[$level+1] = &amp; $ptrs[$level][$tag_or_id];<br />
break;<br />
?&gt;<br />
<br />
with:<br />
<br />
&lt;?<br />
case 'open':<br />
$tag_or_id = (array_key_exists ('attributes', $xml_elem)) ? $xml_elem['attributes']['ID'] : $xml_elem['tag'];<br />
$ptrs[$level][$tag_or_id][] = array ();<br />
$ptrs[$level+1] = &amp; $ptrs[$level][$tag_or_id][count($ptrs[$level][$tag_or_id])-1];<br />
break;<br />
?&gt;<br />
<br />
and now code should handle multiple element case :)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="54718""></a>
  <div class="note">
   <strong class="user">Dustin</strong>
   <a href="#54718" class="date">13-Jul-2005 05:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you happen to have problems with weird charaters, I added this code to the first line of dUDA's function:<br />
<br />
$XML = utf8_decode($XML);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="54106""></a>
  <div class="note">
   <strong class="user">PhF at madmac dot fr</strong>
   <a href="#54106" class="date">23-Jun-2005 10:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The code previously posted by noob at noobsrule dot com doesn't work when the same tag name is used at different levels.<br />
(but perhaps "$php_used_prefix" was intended for that ?)<br />
For example:<br />
&lt;RatedShipment&gt;<br />
&nbsp; &lt;TransportationCharges&gt;<br />
&nbsp;&nbsp;&nbsp; ...<br />
&nbsp; &lt;/TransportationCharges&gt;<br />
&nbsp; &lt;RatedPackage&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;TransportationCharges&gt;<br />
&nbsp;&nbsp; &nbsp;&nbsp; ...<br />
&nbsp;&nbsp;&nbsp; &lt;/TransportationCharges&gt;<br />
&nbsp; &lt;/RatedPackage&gt;<br />
&lt;/RatedShipment&gt;<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; $p </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$p</span><span class="keyword">, </span><span class="default">XML_OPTION_CASE_FOLDING</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$p</span><span class="keyword">, </span><span class="default">XML_OPTION_SKIP_WHITE</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">xml_parse_into_struct</span><span class="keyword">(</span><span class="default">$p</span><span class="keyword">, </span><span class="default">$UPSxml</span><span class="keyword">, </span><span class="default">$values</span><span class="keyword">, </span><span class="default">$idx</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$p</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// tracking used keys<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$usedKeys </span><span class="keyword">= array();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$deepLevel </span><span class="keyword">= -</span><span class="default">1</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// start a php array string (evaluated later)<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$forEvalPrefix </span><span class="keyword">= </span><span class="string">'$xml_array'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// loop throught the value array<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">foreach (</span><span class="default">$values </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$val</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tagName </span><span class="keyword">= </span><span class="default">$val</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]; </span><span class="comment">// pass the key tag into a more friendly looking variable<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$level </span><span class="keyword">= </span><span class="default">$val</span><span class="keyword">[</span><span class="string">'level'</span><span class="keyword">]; </span><span class="comment">// idem<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">'open'</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$deepLevel</span><span class="keyword">++; </span><span class="comment">// increase deep level<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$forEvalPrefix </span><span class="keyword">.= </span><span class="string">'[\''</span><span class="keyword">. </span><span class="default">$tagName </span><span class="keyword">.</span><span class="string">'\']'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// begin used keys checks to allow multidimensionatity under the same tag<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">(isset(</span><span class="default">$usedKeys</span><span class="keyword">[</span><span class="default">$level</span><span class="keyword">][</span><span class="default">$tagName</span><span class="keyword">])) ? </span><span class="default">$usedKeys</span><span class="keyword">[</span><span class="default">$level</span><span class="keyword">][</span><span class="default">$tagName</span><span class="keyword">]++ : </span><span class="default">$usedKeys</span><span class="keyword">[</span><span class="default">$level</span><span class="keyword">][</span><span class="default">$tagName</span><span class="keyword">] = </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$forEvalPrefix </span><span class="keyword">.= </span><span class="string">'['</span><span class="keyword">. </span><span class="default">$usedKeys</span><span class="keyword">[</span><span class="default">$level</span><span class="keyword">][</span><span class="default">$tagName</span><span class="keyword">] .</span><span class="string">']'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">'complete'</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (</span><span class="default">$level </span><span class="keyword">&gt; </span><span class="default">$deepLevel</span><span class="keyword">) ? </span><span class="default">$deepLevel</span><span class="keyword">++ : </span><span class="string">''</span><span class="keyword">; </span><span class="comment">// increase $deepLevel only if current level is bigger<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tagValue </span><span class="keyword">= </span><span class="default">addslashes</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">] ); </span><span class="comment">// format the value for evaluation as a string<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$forEvalSuffix </span><span class="keyword">= </span><span class="string">'[\''</span><span class="keyword">. </span><span class="default">$tagName </span><span class="keyword">.</span><span class="string">'\'] = \''</span><span class="keyword">. </span><span class="default">$tagValue </span><span class="keyword">.</span><span class="string">'\';'</span><span class="keyword">; </span><span class="comment">// create a string to append to the current prefix<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$forEval </span><span class="keyword">= </span><span class="default">$forEvalPrefix </span><span class="keyword">. </span><span class="default">$forEvalSuffix</span><span class="keyword">; </span><span class="comment">// (without "$php_used_prefix"...)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">eval(</span><span class="default">$forEval</span><span class="keyword">); </span><span class="comment">// write the string to the array structure<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">}<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">'close'</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; unset(</span><span class="default">$usedKeys</span><span class="keyword">[</span><span class="default">$deepLevel</span><span class="keyword">]); </span><span class="comment">// Suppress tagname's keys useless<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$deepLevel</span><span class="keyword">--;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$forEvalPrefix </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$forEvalPrefix</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">strrpos</span><span class="keyword">(</span><span class="default">$forEvalPrefix</span><span class="keyword">, </span><span class="string">'['</span><span class="keyword">)); </span><span class="comment">// cut off the used keys node<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$forEvalPrefix </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$forEvalPrefix</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">strrpos</span><span class="keyword">(</span><span class="default">$forEvalPrefix</span><span class="keyword">, </span><span class="string">'['</span><span class="keyword">)); </span><span class="comment">// cut off the end level of the array string prefix<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">}<br />
&nbsp;&nbsp;&nbsp; }<br />
echo </span><span class="string">'&lt;pre&gt;'</span><span class="keyword">;<br />
</span><span class="default">print_r </span><span class="keyword">(</span><span class="default">$xml_array</span><span class="keyword">);<br />
echo </span><span class="string">'&lt;/pre&gt;'</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
MADmac ;-)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="53864""></a>
  <div class="note">
   <strong class="user">peter at elemental dot org</strong>
   <a href="#53864" class="date">15-Jun-2005 05:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Quick addendum to my post below... The code does *not* handle cases where multiple elements are used without attribute IDs, as is the case with the moldb example.&nbsp; (It is probably worth noting that some of the other code below doesn't do this either, and is still more complex.)<br />
<br />
It is not difficult to add that functionality, but I have yet to find an elegant way to integrate that feature, and since I don't need that functionality at the moment, I'm going leave that as an exercise to the reader.&nbsp; ;-)<br />
<br />
-p.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="53840""></a>
  <div class="note">
   <strong class="user">peter at elemental dot org</strong>
   <a href="#53840" class="date">15-Jun-2005 01:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Some of the code posted previously seemed absurdly complex, so I thought I'd see if I could simplify things a bit. Here's what I came up with.&nbsp; (I'm still a PHP newbie, so perhaps I simplified too much.&nbsp; ;-)&nbsp; Untested for speed, but it *should* be pretty quick since it uses references instead of lookups or (gack) evals.<br />
<br />
Enjoy!<br />
<br />
/*<br />
&nbsp;*&nbsp; Convert a string containing XML into a nested array<br />
&nbsp;*<br />
&nbsp;*&nbsp; Takes a raw XML string as input<br />
&nbsp;*&nbsp; Returns a nested array<br />
&nbsp;*/<br />
<br />
function xml2array ($xml_data)<br />
{<br />
&nbsp;&nbsp;&nbsp; // parse the XML datastring<br />
&nbsp;&nbsp;&nbsp; $xml_parser = xml_parser_create ();<br />
&nbsp;&nbsp;&nbsp; xml_parse_into_struct ($xml_parser, $xml_data, $vals, $index);<br />
&nbsp;&nbsp;&nbsp; xml_parser_free ($xml_parser);<br />
<br />
&nbsp;&nbsp;&nbsp; // convert the parsed data into a PHP datatype<br />
&nbsp;&nbsp;&nbsp; $params = array();<br />
&nbsp;&nbsp;&nbsp; $ptrs[0] = &amp; $params;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; foreach ($vals as $xml_elem) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $level = $xml_elem['level'] - 1;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; switch ($xml_elem['type']) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case 'open':<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $tag_or_id = (array_key_exists ('attributes', $xml_elem)) ? $xml_elem['attributes']['ID'] : $xml_elem['tag'];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $ptrs[$level][$tag_or_id] = array ();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $ptrs[$level+1] = &amp; $ptrs[$level][$tag_or_id];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case 'complete':<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $ptrs[$level][$xml_elem['tag']] = (isset ($xml_elem['value'])) ? $xml_elem['value'] : '';<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; return ($params);<br />
<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="51310""></a>
  <div class="note">
   <strong class="user">gleber at mapnet dot pl</strong>
   <a href="#51310" class="date">27-Mar-2005 12:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
XMLtoArray created by dudus at onet dot pl was not good enough for me, that's why i decided to create my own version, and here's the result:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function &amp;</span><span class="default">last</span><span class="keyword">(&amp;</span><span class="default">$array</span><span class="keyword">) {<br />
if (!</span><span class="default">count</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">)) return </span><span class="default">null</span><span class="keyword">;<br />
</span><span class="default">end</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">);<br />
return </span><span class="default">$array</span><span class="keyword">[</span><span class="default">key</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">)];<br />
}<br />
<br />
function </span><span class="default">myParseXML</span><span class="keyword">(&amp;</span><span class="default">$vals</span><span class="keyword">, &amp;</span><span class="default">$dom</span><span class="keyword">, &amp;</span><span class="default">$lev</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; do {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$curr </span><span class="keyword">= </span><span class="default">current</span><span class="keyword">(</span><span class="default">$vals</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$lev </span><span class="keyword">= </span><span class="default">$curr</span><span class="keyword">[</span><span class="string">'level'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; switch (</span><span class="default">$curr</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">]) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'open'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (isset(</span><span class="default">$dom</span><span class="keyword">[</span><span class="default">$curr</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tmp </span><span class="keyword">= </span><span class="default">$dom</span><span class="keyword">[</span><span class="default">$curr</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">$tmp</span><span class="keyword">[</span><span class="string">'__multi'</span><span class="keyword">])<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dom</span><span class="keyword">[</span><span class="default">$curr</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]] = array(</span><span class="string">'__multi' </span><span class="keyword">=&gt; </span><span class="default">true</span><span class="keyword">, </span><span class="default">$tmp</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">array_push</span><span class="keyword">(</span><span class="default">$dom</span><span class="keyword">[</span><span class="default">$curr</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]], array());<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new </span><span class="keyword">=&amp; </span><span class="default">last</span><span class="keyword">(</span><span class="default">$dom</span><span class="keyword">[</span><span class="default">$curr</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dom</span><span class="keyword">[</span><span class="default">$curr</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]] = array();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new </span><span class="keyword">=&amp; </span><span class="default">$dom</span><span class="keyword">[</span><span class="default">$curr</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">next</span><span class="keyword">(</span><span class="default">$vals</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">myParseXML</span><span class="keyword">(&amp;</span><span class="default">$vals</span><span class="keyword">, </span><span class="default">$new</span><span class="keyword">, </span><span class="default">$lev</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'cdata'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'complete'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!isset(</span><span class="default">$dom</span><span class="keyword">[</span><span class="default">$curr</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]]))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dom</span><span class="keyword">[</span><span class="default">$curr</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]] = </span><span class="default">$curr</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$dom</span><span class="keyword">[</span><span class="default">$curr</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]])) <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">array_push</span><span class="keyword">(</span><span class="default">$dom</span><span class="keyword">[</span><span class="default">$curr</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]] , </span><span class="default">$curr</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">array_push</span><span class="keyword">(</span><span class="default">$dom</span><span class="keyword">[</span><span class="default">$curr</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]] = array(</span><span class="default">$dom</span><span class="keyword">[</span><span class="default">$curr</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]]) , </span><span class="default">$curr</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'close'</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; while (</span><span class="default">next</span><span class="keyword">(</span><span class="default">$vals</span><span class="keyword">)!==</span><span class="default">FALSE</span><span class="keyword">);<br />
}<br />
<br />
function </span><span class="default">MyXMLtoArray</span><span class="keyword">(</span><span class="default">$XML</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$xml_parser </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">xml_parse_into_struct</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">, </span><span class="default">$XML</span><span class="keyword">, </span><span class="default">$vals</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">reset</span><span class="keyword">(</span><span class="default">$vals</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$dom </span><span class="keyword">= array(); </span><span class="default">$lev </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">myParseXML</span><span class="keyword">(</span><span class="default">$vals</span><span class="keyword">, </span><span class="default">$dom</span><span class="keyword">, </span><span class="default">$lev</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; return </span><span class="default">$dom</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
MyXMLtoArray() is that function you should call, other are for "internal" use.<br />
<br />
P.S. It's 4-5 time faster then dudus at onet dot pl 's code</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="49334""></a>
  <div class="note">
   <strong class="user">noob at noobsrule dot com</strong>
   <a href="#49334" class="date">24-Jan-2005 07:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is my first time contributing but I found all the examples either didn't work or were beyond my comprehension.&nbsp; I also wanted to maintain the XML multi-dimensionality so I could do loops based on keys I was expecting rather than numbers or some other whatnot.&nbsp; This script is probably way inefficient, but should give you a multidimensional array with a depth that will match the XML source.&nbsp; Great for situations when you aren't sure what you'll be getting back.&nbsp; Its also only based on the values array of xml_parse_into_str() using the 3 tag types (open, complete, and close) -- hopefully it will make more sense to other noobs.<br />
<br />
Basically it just constructs a string ($php_prefix) that is tweaked if it hits an "open" or "close" tag and evaluated if it hits a "complete" tag.<br />
<br />
Thanks.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment"># initiate curl session...<br />
</span><span class="default">$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">( </span><span class="string">"<a href="http://yourtargethost" rel="nofollow" target="_blank">http://yourtargethost</a>" </span><span class="keyword">) or die ( </span><span class="string">"could not initialize curl" </span><span class="keyword">); <br />
<br />
</span><span class="comment"># set curl options...<br />
</span><span class="default">curl_setopt</span><span class="keyword">( </span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_HEADER</span><span class="keyword">, </span><span class="default">0 </span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">( </span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POST</span><span class="keyword">, </span><span class="default">1 </span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">( </span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, </span><span class="default">$request_str </span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">( </span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_FOLLOWLOCATION</span><span class="keyword">, </span><span class="default">0 </span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">( </span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_REFERER</span><span class="keyword">, </span><span class="default">https</span><span class="keyword">:</span><span class="comment">//foobar.com" );<br />
</span><span class="default">curl_setopt</span><span class="keyword">( </span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">1 </span><span class="keyword">);<br />
<br />
</span><span class="comment"># execute curl commands...<br />
</span><span class="default">$curl_result </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">( </span><span class="default">$ch </span><span class="keyword">) or die ( </span><span class="string">"could not execute the post" </span><span class="keyword">);<br />
</span><span class="default">curl_close</span><span class="keyword">( </span><span class="default">$ch </span><span class="keyword">); </span><span class="comment">// close curl session <br />
<br />
# pass the XML result into 2 arrays ( index and values )...<br />
</span><span class="default">$p </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">();<br />
</span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$p</span><span class="keyword">, </span><span class="default">XML_OPTION_CASE_FOLDING</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
</span><span class="default">xml_parser_set_option</span><span class="keyword">(</span><span class="default">$p</span><span class="keyword">, </span><span class="default">XML_OPTION_SKIP_WHITE</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
</span><span class="default">xml_parse_into_struct</span><span class="keyword">(</span><span class="default">$p</span><span class="keyword">, </span><span class="default">$curl_result</span><span class="keyword">, </span><span class="default">$vals</span><span class="keyword">, </span><span class="default">$index</span><span class="keyword">);<br />
</span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$p</span><span class="keyword">);<br />
<br />
</span><span class="comment"># create an empty used key tracker...<br />
</span><span class="default">$used_keys </span><span class="keyword">= array();<br />
<br />
</span><span class="comment"># start a php array string (evaluated later)...<br />
</span><span class="default">$php_prefix </span><span class="keyword">= </span><span class="string">"$"</span><span class="keyword">.</span><span class="string">"my_array"</span><span class="keyword">;<br />
<br />
</span><span class="comment"># loop through the values array...<br />
</span><span class="keyword">foreach (</span><span class="default">$vals </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$val</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if( </span><span class="default">$val</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">"open" </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$my_tag </span><span class="keyword">= </span><span class="default">$val</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]; </span><span class="comment">// pass the key tag into a more friendly looking variable...<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$php_prefix </span><span class="keyword">.= </span><span class="string">"['"</span><span class="keyword">.</span><span class="default">$my_tag</span><span class="keyword">.</span><span class="string">"']"</span><span class="keyword">; </span><span class="comment"># add a new level to the array string...<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; # begin used key checks to allow multidimensionality under the same tag, adds a number to the prefix if necessary...<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if( ! </span><span class="default">array_key_exists</span><span class="keyword">( </span><span class="default">$my_tag</span><span class="keyword">, </span><span class="default">$used_keys </span><span class="keyword">) ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$used_keys</span><span class="keyword">[</span><span class="default">$my_tag</span><span class="keyword">] = </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$php_prefix </span><span class="keyword">.= </span><span class="string">"["</span><span class="keyword">.</span><span class="default">$used_keys</span><span class="keyword">[</span><span class="default">$my_tag</span><span class="keyword">].</span><span class="string">"]"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$used_keys</span><span class="keyword">[</span><span class="default">$my_tag</span><span class="keyword">]++; </span><span class="comment">// increment the key tracker to avoid overwriting existing key...<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$php_prefix </span><span class="keyword">.= </span><span class="string">"["</span><span class="keyword">.</span><span class="default">$used_keys</span><span class="keyword">[</span><span class="default">$my_tag</span><span class="keyword">].</span><span class="string">"]"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; } elseif( </span><span class="default">$val</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">"complete" </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$my_value </span><span class="keyword">= </span><span class="default">addslashes</span><span class="keyword">( </span><span class="default">$val</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">] ); </span><span class="comment"># format the value for evaluation as a string...<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$php_suffix </span><span class="keyword">= </span><span class="string">"['"</span><span class="keyword">.</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">].</span><span class="string">"'] = \""</span><span class="keyword">.</span><span class="default">$my_value</span><span class="keyword">.</span><span class="string">"\";"</span><span class="keyword">; </span><span class="comment"># create a string with the tag and value to append to the current prefix (just used here)...<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$php_str </span><span class="keyword">= </span><span class="default">$php_prefix</span><span class="keyword">.</span><span class="default">$php_used_prefix</span><span class="keyword">.</span><span class="default">$php_suffix</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; eval( </span><span class="default">$php_str </span><span class="keyword">); </span><span class="comment"># write the string to the array structure...<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">}<br />
&nbsp;&nbsp;&nbsp; if( </span><span class="default">$val</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">"close" </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$php_prefix </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">( </span><span class="default">$php_prefix</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">strrpos</span><span class="keyword">( </span><span class="default">$php_prefix</span><span class="keyword">, </span><span class="string">"[" </span><span class="keyword">) ); </span><span class="comment"># cut off the used keys node...<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$php_prefix </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">( </span><span class="default">$php_prefix</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">strrpos</span><span class="keyword">( </span><span class="default">$php_prefix</span><span class="keyword">, </span><span class="string">"[" </span><span class="keyword">) ); </span><span class="comment"># cut off the end level of the array string prefix...<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">}<br />
}<br />
<br />
echo </span><span class="string">"&lt;pre&gt;"</span><span class="keyword">;<br />
</span><span class="comment">//print_r ($index);<br />
//echo "&lt;br&gt;&lt;br&gt;&lt;br&gt;";<br />
//print_r ($vals);<br />
//echo "&lt;br&gt;&lt;br&gt;&lt;br&gt;";<br />
</span><span class="default">print_r </span><span class="keyword">(</span><span class="default">$my_array</span><span class="keyword">);<br />
echo </span><span class="string">"&lt;/pre&gt;"</span><span class="keyword">;<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="49154""></a>
  <div class="note">
   <strong class="user">dudus at onet dot pl</strong>
   <a href="#49154" class="date">18-Jan-2005 03:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This function return array from XML. Included attributes and tags in same level.<br />
I wrote this function based on mmustafa code. <br />
<br />
enjoy! <br />
dUDA<br />
<br />
-------------------------------<br />
<br />
&lt;?<br />
function XMLtoArray($XML)<br />
{<br />
&nbsp;&nbsp;&nbsp; $xml_parser = xml_parser_create();<br />
&nbsp;&nbsp;&nbsp; xml_parse_into_struct($xml_parser, $XML, $vals);<br />
&nbsp;&nbsp;&nbsp; xml_parser_free($xml_parser);<br />
&nbsp;&nbsp;&nbsp; // wyznaczamy tablice z powtarzajacymi sie tagami na tym samym poziomie <br />
&nbsp;&nbsp;&nbsp; $_tmp='';<br />
&nbsp;&nbsp;&nbsp; foreach ($vals as $xml_elem)<br />
&nbsp;&nbsp;&nbsp; { <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $x_tag=$xml_elem['tag'];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $x_level=$xml_elem['level'];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $x_type=$xml_elem['type'];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ($x_level!=1 &amp;&amp; $x_type == 'close')<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (isset($multi_key[$x_tag][$x_level]))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $multi_key[$x_tag][$x_level]=1;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $multi_key[$x_tag][$x_level]=0;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ($x_level!=1 &amp;&amp; $x_type == 'complete')<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($_tmp==$x_tag) <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $multi_key[$x_tag][$x_level]=1;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $_tmp=$x_tag;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; // jedziemy po tablicy<br />
&nbsp;&nbsp;&nbsp; foreach ($vals as $xml_elem)<br />
&nbsp;&nbsp;&nbsp; { <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $x_tag=$xml_elem['tag'];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $x_level=$xml_elem['level'];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $x_type=$xml_elem['type'];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ($x_type == 'open') <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $level[$x_level] = $x_tag;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $start_level = 1;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $php_stmt = '$xml_array';<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ($x_type=='close' &amp;&amp; $x_level!=1) <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $multi_key[$x_tag][$x_level]++;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while($start_level &lt; $x_level)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $php_stmt .= '[$level['.$start_level.']]';<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (isset($multi_key[$level[$start_level]][$start_level]) &amp;&amp; $multi_key[$level[$start_level]][$start_level]) <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $php_stmt .= '['.($multi_key[$level[$start_level]][$start_level]-1).']';<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $start_level++;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $add='';<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (isset($multi_key[$x_tag][$x_level]) &amp;&amp; $multi_key[$x_tag][$x_level] &amp;&amp; ($x_type=='open' || $x_type=='complete'))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!isset($multi_key2[$x_tag][$x_level]))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $multi_key2[$x_tag][$x_level]=0;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $multi_key2[$x_tag][$x_level]++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $add='['.$multi_key2[$x_tag][$x_level].']'; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (isset($xml_elem['value']) &amp;&amp; trim($xml_elem['value'])!='' &amp;&amp; !array_key_exists('attributes',$xml_elem))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($x_type == 'open') <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $php_stmt_main=$php_stmt.'[$x_type]'.$add.'[\'content\'] = $xml_elem[\'value\'];';<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $php_stmt_main=$php_stmt.'[$x_tag]'.$add.' = $xml_elem[\'value\'];';<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; eval($php_stmt_main);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (array_key_exists('attributes',$xml_elem))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (isset($xml_elem['value']))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $php_stmt_main=$php_stmt.'[$x_tag]'.$add.'[\'content\'] = $xml_elem[\'value\'];';<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; eval($php_stmt_main);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach ($xml_elem['attributes'] as $key=&gt;$value)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $php_stmt_att=$php_stmt.'[$x_tag]'.$add.'[$key] = $value;';<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; eval($php_stmt_att);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; return $xml_array;<br />
}&nbsp; &nbsp; // END XMLtoArray<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="48032""></a>
  <div class="note">
   <strong class="user">memandeemail at gmail dot com</strong>
   <a href="#48032" class="date">09-Dec-2004 04:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
a BREAK on right place, will be faster and bugprevent<br />
<br />
&nbsp;&nbsp;&nbsp; /**<br />
&nbsp;&nbsp;&nbsp; * @return bool<br />
&nbsp;&nbsp;&nbsp; * @param xml_array $values<br />
&nbsp;&nbsp;&nbsp; * @param xml_array[reference] $tags<br />
&nbsp;&nbsp;&nbsp; * @desc Reconstruct xml_parse_into_struct to open and close concept<br />
&nbsp;&nbsp;&nbsp; */<br />
&nbsp;&nbsp;&nbsp; function reconstruct_tag($values, &amp;$tags) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; unset($return);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach ($tags as $tkey =&gt; $tvalue) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach ($tvalue as $vvalue) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($values[$vvalue]['type'] == 'open' or $values[$vvalue]['type'] == 'complete') {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $return[$tkey][] = $vvalue;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($values[$vvalue]['type'] == 'open') {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach ($tvalue as $tv_value) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($values[$tv_value]['type'] == 'close'<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; and $values[$tv_value]['level'] == $values[$vvalue]['level']<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; and $tv_value &gt; $vvalue) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $return[$tkey][] = $tv_value;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $tags = $return;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return (bool) $tags;<br />
&nbsp;&nbsp;&nbsp; }</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="47866""></a>
  <div class="note">
   <strong class="user">memandeemail at gmail dot com</strong>
   <a href="#47866" class="date">03-Dec-2004 01:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you have de XML:<br />
&lt;?xml version="1.0" encoding="iso-8859-1"?&gt;<br />
&lt;teste&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;teste&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;teste&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;/teste&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;/teste&gt;<br />
&lt;/teste&gt;<br />
<br />
this function will return this tags:<br />
Array<br />
(<br />
&nbsp;&nbsp;&nbsp; [teste] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [0] =&gt; 0<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [1] =&gt; 1<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [2] =&gt; 2<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [3] =&gt; 3<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [4] =&gt; 4<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
)<br />
<br />
With this function (right below) will convert the struc to OPEN and CLOSE concept.<br />
<br />
The New Struct:<br />
Array<br />
(<br />
&nbsp;&nbsp;&nbsp; [teste] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [0] =&gt; 0<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [1] =&gt; 4<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [2] =&gt; 1<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [3] =&gt; 3<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [4] =&gt; 2<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
)<br />
The Function:<br />
/**<br />
&nbsp;* @return bool<br />
&nbsp;* @param xml_array $values<br />
&nbsp;* @param xml_array[reference] $tags<br />
&nbsp;* @desc Reconstruct xml_parse_into_struct<br />
*/<br />
function reconstruct_tag($values, &amp;$tags) {<br />
&nbsp;&nbsp;&nbsp; unset($return);<br />
&nbsp;&nbsp;&nbsp; foreach ($tags as $tkey =&gt; $tvalue) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach ($tvalue as $vvalue) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($values[$vvalue]['type'] == 'open' or $values[$vvalue]['type'] == 'complete') {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $return[$tkey][] = $vvalue;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($values[$vvalue]['type'] == 'open') {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach ($tvalue as $tv_value) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($values[$tv_value]['type'] == 'close'<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; and $values[$tv_value]['level'] == $values[$vvalue]['level']) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $return[$tkey][] = $tv_value;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; $tags = $return;<br />
&nbsp;&nbsp;&nbsp; return (bool) $tags;<br />
}<br />
<br />
Ahh, DO NOT forget this comment:<br />
<br />
jukkaho at mail dot student dot oulu dot fi<br />
29-Jun-2004 12:17 <br />
Everyone seems to forget the return value of this function (including people making examples!), but it is there for a reason:<br />
0 if failed (invalid XML), 1 if succeeded.<br />
<br />
Return value really is an integer, be careful with those === operators.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="45372""></a>
  <div class="note">
   <strong class="user">rob at digital hyphen crocus dot com</strong>
   <a href="#45372" class="date">03-Sep-2004 06:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I wrote this function in a bad mood, to get some data you can loop through. sprint_r or var_dump its output to see what it does. It's not pretty, but at least you can loop through the data without a LOT of hassle.<br />
<br />
This can also be done with handlers, but I couldn't be bothered with global variables.<br />
<br />
<span class="default">&lt;?php<br />
<br />
$data </span><span class="keyword">= </span><span class="default">xml_parse_into_struct</span><span class="keyword">(</span><span class="default">$somexml</span><span class="keyword">);<br />
<br />
function </span><span class="default">xml_getmeaningfuldata</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">) {<br />
foreach(</span><span class="default">$data </span><span class="keyword">as </span><span class="default">$element</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$element</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">"open"</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">$elementnos</span><span class="keyword">[</span><span class="default">$parents</span><span class="keyword">.</span><span class="default">$element</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]]) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$elementnos</span><span class="keyword">[</span><span class="default">$parents</span><span class="keyword">.</span><span class="default">$element</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]] = </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$elements</span><span class="keyword">[</span><span class="default">$parents</span><span class="keyword">.</span><span class="default">$element</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">].</span><span class="string">":"</span><span class="keyword">. </span><span class="default">$elementnos</span><span class="keyword">[</span><span class="default">$parents</span><span class="keyword">.</span><span class="default">$element</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]]][</span><span class="string">'attributes'</span><span class="keyword">] = </span><span class="default">$element</span><span class="keyword">[</span><span class="string">'attributes'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$elements</span><span class="keyword">[</span><span class="default">$parents</span><span class="keyword">.</span><span class="default">$element</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">].</span><span class="string">":"</span><span class="keyword">. </span><span class="default">$elementnos</span><span class="keyword">[</span><span class="default">$parents</span><span class="keyword">.</span><span class="default">$element</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]]][</span><span class="string">'value'</span><span class="keyword">] = </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$element</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$parents </span><span class="keyword">.= </span><span class="default">$element</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">].</span><span class="string">":"</span><span class="keyword">.</span><span class="default">$elementnos</span><span class="keyword">[</span><span class="default">$parents</span><span class="keyword">.</span><span class="default">$element</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]].</span><span class="string">"^"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$element</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">"cdata"</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">trim</span><span class="keyword">(</span><span class="default">$element</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$elements</span><span class="keyword">[</span><span class="default">$parents</span><span class="keyword">.</span><span class="default">$element</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">].</span><span class="string">":"</span><span class="keyword">. </span><span class="default">$elementnos</span><span class="keyword">[</span><span class="default">$parents</span><span class="keyword">.</span><span class="default">$element</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]]][</span><span class="string">'values'</span><span class="keyword">] = </span><span class="default">$element</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$element</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">"complete"</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">$elementnos</span><span class="keyword">[</span><span class="default">$parents</span><span class="keyword">.</span><span class="default">$element</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]]) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$elementnos</span><span class="keyword">[</span><span class="default">$parents</span><span class="keyword">.</span><span class="default">$element</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]] = </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$elements</span><span class="keyword">[</span><span class="default">$parents</span><span class="keyword">.</span><span class="default">$element</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">].</span><span class="string">":"</span><span class="keyword">. </span><span class="default">$elementnos</span><span class="keyword">[</span><span class="default">$parents</span><span class="keyword">.</span><span class="default">$element</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]]][</span><span class="string">'attributes'</span><span class="keyword">] = </span><span class="default">$element</span><span class="keyword">[</span><span class="string">'attributes'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$elements</span><span class="keyword">[</span><span class="default">$parents</span><span class="keyword">.</span><span class="default">$element</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">].</span><span class="string">":"</span><span class="keyword">. </span><span class="default">$elementnos</span><span class="keyword">[</span><span class="default">$parents</span><span class="keyword">.</span><span class="default">$element</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]]][</span><span class="string">'value'</span><span class="keyword">] = </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$element</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$elementnos</span><span class="keyword">[</span><span class="default">$parents</span><span class="keyword">.</span><span class="default">$element</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]]++;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$element</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">"close"</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$parents </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$parents</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">strrpos</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$parents</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, -</span><span class="default">1</span><span class="keyword">), </span><span class="string">"^"</span><span class="keyword">)+</span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$elementnos</span><span class="keyword">[</span><span class="default">$parents</span><span class="keyword">.</span><span class="default">$element</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">]]++;<br />
</span><span class="comment">//&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (sizeof($parents) == 1) unset($parents);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">}<br />
}<br />
<br />
return </span><span class="default">$elements</span><span class="keyword">;<br />
<br />
}</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="45052""></a>
  <div class="note">
   <strong class="user">happyseb at free dot fr</strong>
   <a href="#45052" class="date">24-Aug-2004 05:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I would just add something about the solution proposed by "gordon at kanazawa dot ac dot jp".<br />
<br />
Something went wrong about the fact that "cdata" are treated the same way as "complete" in the xml_get_children first and in the xml_get_child then.<br />
<br />
When ?<br />
with this method, something like this :<br />
&lt;tagA&gt;<br />
&nbsp; &lt;tagB&gt;valueB&lt;/tagB&gt;<br />
&nbsp; valueA<br />
&nbsp; &lt;tagC&gt;valueC&lt;/tagC&gt;<br />
&lt;/tagA&gt;<br />
is considered as the same thing as<br />
&lt;tagA&gt;<br />
&nbsp; &lt;tagB&gt;valueB&lt;/tagB&gt;<br />
&nbsp; &lt;tagA&gt;valueA&lt;/tagA&gt;<br />
&nbsp; &lt;tagC&gt;valueC&lt;/tagC&gt;<br />
&lt;/tagA&gt;<br />
<br />
The algorithm is nomore bijective.<br />
<br />
Even if it might not be perfect :-) i propose a little modification of the xml_get_child function :<br />
<br />
function xml_get_child(&amp;$v, $children=NULL) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; $c = array(); // the "child"<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (isset($v['tag']) &amp;&amp; $v['type'] != 'cdata') $c['tag'] = $v['tag'];<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (isset($v['value'])) $c['value'] = $v['value'];<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (isset($v['attributes'])) $c['attributes'] = $v['attributes'];<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (is_array($children)) $c['children'] = $children;<br />
&nbsp;&nbsp; &nbsp;&nbsp; return $c;<br />
}<br />
<br />
moreover, the following function will take the tree (made from the xml_get_tree function) as a parameter and build the xml content back<br />
<br />
&nbsp;&nbsp;&nbsp; /*<br />
&nbsp;&nbsp;&nbsp; // setTree<br />
&nbsp;&nbsp;&nbsp; // set xml Tree from a well-formed array<br />
&nbsp;&nbsp;&nbsp; // manage indentation<br />
&nbsp;&nbsp;&nbsp; // Parameters are :<br />
&nbsp;&nbsp;&nbsp; // $1 (needed) : Tree to transform<br />
&nbsp;&nbsp;&nbsp; // $2 (optional) : Indentation type (default is one tabulation)<br />
&nbsp;&nbsp;&nbsp; // $3 (optional) : First indent (default is empty string)<br />
&nbsp;&nbsp;&nbsp; */<br />
<br />
&nbsp;&nbsp;&nbsp; function setTree($Atree, $indentType = '&nbsp; &nbsp; ', $Sindent = '')<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (! isset ($Atree['tag']) &amp;&amp; isset ($Atree['value'])) return ($Sindent.trim($Atree['value'])."\r\n") ;<br />
&nbsp;&nbsp; &nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $Stemp = $Sindent.'&lt;'.$Atree['tag'].' ' ;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (isset ($Atree['attributes']) &amp;&amp; is_array ($Atree['attributes'])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach ($Atree['attributes'] as $Aattribute =&gt; $Svalue) $Stemp .= $Aattribute.'="'.$Svalue.'" ' ;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (! isset ($Atree['children']) &amp;&amp; ! isset ($Atree['value'])) $Stemp .= '/&gt;'."\r\n" ;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $Stemp .= '&gt;'."\r\n" ;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (isset ($Atree['value'])) $Stemp .= $Sindent.$indentType.trim($Atree['value'])."\r\n" ;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (isset ($Atree['children']) &amp;&amp; is_array ($Atree['children']))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach ($Atree['children'] as $Achild) $Stemp .= $this-&gt;setTree($Achild, $indentType, $Sindent.$indentType) ;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $Stemp .= $Sindent.'&lt;/'.$Atree['tag'].'&gt;'."\r\n" ;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return ($Stemp) ;<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="43203""></a>
  <div class="note">
   <strong class="user">sdh33 at cornell dot edu</strong>
   <a href="#43203" class="date">14-Jun-2004 07:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
(The previous post I wrote was incorrect.&nbsp; I fix that herein)<br />
I used the algorithm from stephane for writing back to a file, but ran into the following problem.&nbsp; My original XML looks like<br />
<br />
&lt;ENTRY id="1"&gt; ... &lt;/ENTRY&gt;&lt;ENTRY id="2"&gt; ... &lt;/ENTRY&gt;<br />
<br />
This got saved back as<br />
<br />
&lt;1&gt; ... &lt;/1&gt;&lt;2&gt; ... &lt;/2&gt;,<br />
<br />
which expat doesn't like.&nbsp; So I propose the following modification:<br />
<br />
function writeXmlToFile($data, $f, $niv = 0) {<br />
&nbsp; foreach($data as $name =&gt; $elem) {<br />
&nbsp;&nbsp;&nbsp; if (preg_match("/\A[0-9]/",$name)) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; $open = "ENTRY id=\"$name\""; $name = "ENTRY";<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp;&nbsp; $open = $name;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if(is_array($elem)) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; fwrite($f, str_repeat("&nbsp; ", $niv)."&lt;".$open."&gt;"."\n");<br />
&nbsp;&nbsp; &nbsp;&nbsp; writeXmlToFile($elem, $f, $niv + 1);<br />
&nbsp;&nbsp; &nbsp;&nbsp; fwrite($f, str_repeat("&nbsp; ", $niv)."&lt;/".$name."&gt;"."\n");<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp;&nbsp; fwrite($f, str_repeat("&nbsp; ", $niv)."&lt;".$open."&gt;".$elem."&lt;/".$name."&gt;"."\n");<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="41399""></a>
  <div class="note">
   <strong class="user">stephane dot dekeyzer at noemail dot com</strong>
   <a href="#41399" class="date">08-Apr-2004 08:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
for writing the array of mmustafa back to a xml file, use this code:<br />
<br />
function writeXmlFile($fileName, $struct){<br />
&nbsp; $f = fopen($fileName, "w");<br />
&nbsp; writeXmlToFile($struct, $f);<br />
&nbsp; fclose($f);<br />
}<br />
<br />
function writeXmlToFile($data, $f, $niv = 0){<br />
&nbsp; foreach($data as $name =&gt; $elem){<br />
&nbsp;&nbsp;&nbsp; if(is_array($elem)){<br />
&nbsp;&nbsp; &nbsp;&nbsp; fwrite($f, str_repeat("&nbsp; ", $niv)."&lt;".$name."&gt;"."\n");<br />
&nbsp;&nbsp; &nbsp;&nbsp; writeXmlToFile($elem, $f, $niv + 1);<br />
&nbsp;&nbsp; &nbsp;&nbsp; fwrite($f, str_repeat("&nbsp; ", $niv)."&lt;/".$name."&gt;"."\n");<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; else{<br />
&nbsp;&nbsp; &nbsp;&nbsp; fwrite($f, str_repeat("&nbsp; ", $niv)."&lt;".$name."&gt;".$elem."&lt;/".$name."&gt;"."\n");<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="39363""></a>
  <div class="note">
   <strong class="user">gordon at kanazawa dot ac dot jp</strong>
   <a href="#39363" class="date">26-Jan-2004 05:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Many thanks to "dave at ovumdesign dot com" for his excellent routines based on the fine work of "gdemartini at bol dot com". I offer a further refinement below, which removes the duplication of the code to create a child node. The resulting tree is the same as in Dave's earlier version and so can be compacted using his "xml_condense_tree"<br />
<br />
function xml_get_child(&amp;$v, $children=NULL) {<br />
&nbsp;&nbsp; $c = array(); // the "child"<br />
&nbsp;&nbsp; if (isset($v['tag'])) $c['tag'] = $v['tag'];<br />
&nbsp;&nbsp; if (isset($v['value'])) $c['value'] = $v['value'];<br />
&nbsp;&nbsp; if (isset($v['attributes'])) $c['attributes'] = $v['attributes'];<br />
&nbsp;&nbsp; if (is_array($children)) $c['children'] = $children;<br />
&nbsp;&nbsp; return $c;<br />
}<br />
function xml_get_children(&amp;$values, &amp;$i) {<br />
&nbsp;&nbsp; $children = array();<br />
&nbsp;&nbsp; while ($i &lt; count($values)) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; $v = &amp;$values[$i++];<br />
&nbsp;&nbsp; &nbsp;&nbsp; switch ($v['type']) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; case 'cdata':<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; case 'complete':<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $children[] = xml_get_child($v);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; case 'open':<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $children[] = xml_get_child($v, xml_get_children($values, $i));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; case 'close':<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break 2; // leave "while" loop<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; }<br />
&nbsp;&nbsp; return $children;<br />
}<br />
function xml_get_tree($file) {<br />
&nbsp;&nbsp; $data = join('', file($file));<br />
<br />
&nbsp;&nbsp; $p = xml_parser_create();<br />
&nbsp;&nbsp; xml_parser_set_option($p, XML_OPTION_CASE_FOLDING, 0);<br />
&nbsp;&nbsp; xml_parser_set_option($p, XML_OPTION_SKIP_WHITE,&nbsp; 1);<br />
&nbsp;&nbsp; xml_parse_into_struct($p, $data, $values);<br />
&nbsp;&nbsp; xml_parser_free($p);<br />
<br />
&nbsp;&nbsp; return xml_get_children($values, $i=0);<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="38755""></a>
  <div class="note">
   <strong class="user">mmustafa at vsnl dot com</strong>
   <a href="#38755" class="date">06-Jan-2004 09:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A small and simple php code to convert the raw array returned by xml_parse_into_struct into a proper data structure ..<br />
<br />
<span class="default">&lt;?php<br />
$file </span><span class="keyword">= </span><span class="string">"data.xml"</span><span class="keyword">;<br />
</span><span class="default">$xml_parser </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">();<br />
<br />
if (!(</span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">))) {<br />
&nbsp;&nbsp;&nbsp; die(</span><span class="string">"could not open XML input"</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">$data </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">filesize</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">));<br />
</span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br />
</span><span class="default">xml_parse_into_struct</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">, </span><span class="default">$vals</span><span class="keyword">, </span><span class="default">$index</span><span class="keyword">);<br />
</span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">);<br />
<br />
</span><span class="default">$params </span><span class="keyword">= array();<br />
</span><span class="default">$level </span><span class="keyword">= array();<br />
foreach (</span><span class="default">$vals </span><span class="keyword">as </span><span class="default">$xml_elem</span><span class="keyword">) {<br />
&nbsp; if (</span><span class="default">$xml_elem</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">'open'</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">array_key_exists</span><span class="keyword">(</span><span class="string">'attributes'</span><span class="keyword">,</span><span class="default">$xml_elem</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; list(</span><span class="default">$level</span><span class="keyword">[</span><span class="default">$xml_elem</span><span class="keyword">[</span><span class="string">'level'</span><span class="keyword">]],</span><span class="default">$extra</span><span class="keyword">) = </span><span class="default">array_values</span><span class="keyword">(</span><span class="default">$xml_elem</span><span class="keyword">[</span><span class="string">'attributes'</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$level</span><span class="keyword">[</span><span class="default">$xml_elem</span><span class="keyword">[</span><span class="string">'level'</span><span class="keyword">]] = </span><span class="default">$xml_elem</span><span class="keyword">[</span><span class="string">'tag'</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
&nbsp; if (</span><span class="default">$xml_elem</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">] == </span><span class="string">'complete'</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$start_level </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$php_stmt </span><span class="keyword">= </span><span class="string">'$params'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; while(</span><span class="default">$start_level </span><span class="keyword">&lt; </span><span class="default">$xml_elem</span><span class="keyword">[</span><span class="string">'level'</span><span class="keyword">]) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$php_stmt </span><span class="keyword">.= </span><span class="string">'[$level['</span><span class="keyword">.</span><span class="default">$start_level</span><span class="keyword">.</span><span class="string">']]'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$start_level</span><span class="keyword">++;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$php_stmt </span><span class="keyword">.= </span><span class="string">'[$xml_elem[\'tag\']] = $xml_elem[\'value\'];'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; eval(</span><span class="default">$php_stmt</span><span class="keyword">);<br />
&nbsp; }<br />
}<br />
<br />
echo </span><span class="string">"&lt;pre&gt;"</span><span class="keyword">;<br />
</span><span class="default">print_r </span><span class="keyword">(</span><span class="default">$params</span><span class="keyword">);<br />
echo </span><span class="string">"&lt;/pre&gt;"</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
Converts an XML document like ..<br />
<br />
&lt;country id="ZZ"&gt;<br />
&lt;name&gt;My Land&lt;/name&gt;<br />
&lt;location&gt;15E&lt;/location&gt;<br />
&lt;area&gt;40000&lt;/area&gt;<br />
&lt;state1&gt;<br />
&lt;name&gt;Hi State&lt;/name&gt;<br />
&lt;area&gt;1000&lt;/area&gt;<br />
&lt;population&gt;2000&lt;/population&gt;<br />
&lt;city1&gt;<br />
&lt;location&gt;13E&lt;/location&gt;<br />
&lt;population&gt;500&lt;/population&gt;<br />
&lt;area&gt;500&lt;/area&gt;<br />
&lt;/city1&gt;<br />
&lt;city2&gt;<br />
&lt;location&gt;13E&lt;/location&gt;<br />
&lt;population&gt;500&lt;/population&gt;<br />
&lt;area&gt;5000&lt;/area&gt;<br />
&lt;/city2&gt;<br />
&lt;/state1&gt;<br />
&lt;state2&gt;<br />
&lt;name&gt;Low State&lt;/name&gt;<br />
&lt;area&gt;3000&lt;/area&gt;<br />
&lt;population&gt;20000&lt;/population&gt;<br />
&lt;city1&gt;<br />
&lt;location&gt;15E&lt;/location&gt;<br />
&lt;population&gt;5000&lt;/population&gt;<br />
&lt;area&gt;1500&lt;/area&gt;<br />
&lt;/city1&gt;<br />
&lt;/state2&gt;<br />
&lt;/country&gt;<br />
<br />
To a php datastructure like ..<br />
<br />
Array<br />
(<br />
&nbsp;&nbsp;&nbsp; [ZZ] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [NAME] =&gt; My Land<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [LOCATION] =&gt; 15E<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [AREA] =&gt; 40000<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [STATE1] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [NAME] =&gt; Hi State<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [AREA] =&gt; 1000<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [POPULATION] =&gt; 2000<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [CITY1] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [LOCATION] =&gt; 13E<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [POPULATION] =&gt; 500<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [AREA] =&gt; 500<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [CITY2] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [LOCATION] =&gt; 13E<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [POPULATION] =&gt; 500<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [AREA] =&gt; 5000<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [STATE2] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [NAME] =&gt; Low State<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [AREA] =&gt; 3000<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [POPULATION] =&gt; 20000<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [CITY1] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [LOCATION] =&gt; 15E<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [POPULATION] =&gt; 5000<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [AREA] =&gt; 1500<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="36114""></a>
  <div class="note">
   
   <a href="#36114" class="date">26-Sep-2003 12:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
actually, using the notation<br />
<br />
$object-&gt;property is the right one<br />
<br />
and you can use it always, preventing errors with arrays</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="35996""></a>
  <div class="note">
   <strong class="user">Eric</strong>
   <a href="#35996" class="date">22-Sep-2003 05:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Yet another XML -&gt; nested array converter.<br />
<br />
This is based on <a href="http://www.devdump.com/phpxml.php, but adds features while reducing code complexity." rel="nofollow" target="_blank">http://www.devdump.com/phpxml.php, but adds features while reducing code complexity.</a><br />
<br />
It can take several forms of input:<br />
&nbsp;- string (buffer)<br />
&nbsp;- file handle (pipe)<br />
&nbsp;- file name -or-<br />
&nbsp;- URL<br />
<br />
It can optionally collapse arrays of same-named tags to a single element if there is only one tag with a given name.<br />
<br />
It can optionally preserve tag order for XML applications where position is significant, such as CallXML.<br />
<br />
XMLParser.obj at:<br />
<a href="http://eric.pollmann.net/work/public_domain/" rel="nofollow" target="_blank">http://eric.pollmann.net/work/public_domain/</a><br />
<br />
Corrections and suggestions enthusiastically welcomed.&nbsp; :)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="35726""></a>
  <div class="note">
   <strong class="user">Adam Tylmad</strong>
   <a href="#35726" class="date">12-Sep-2003 02:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I've just debugged and optimized my xmlparser.
<br />

<br />
gdemartini's xml-example generates this structure:
<br />

<br />
stdClass Object
<br />
(
<br />
&nbsp;&nbsp;&nbsp; [FORM] =&gt; stdClass Object
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [SECTION] =&gt; stdClass Object
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [NAME] =&gt; Data
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [EDITFIELD] =&gt; stdClass Object
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [LABEL] =&gt; Text:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [NAME] =&gt; poll_text
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [LENGTH] =&gt; 255
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [SIZE] =&gt; 56
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [REQUIRED] =&gt; T
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [MEMOFIELD] =&gt; stdClass Object
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [LABEL] =&gt; Options
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [NAME] =&gt; options
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [COLS] =&gt; 56
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [ROWS] =&gt; 5
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [REQUIRED] =&gt; T
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )
<br />
)
<br />

<br />
the moldb example generates this structure:
<br />

<br />
stdClass Object
<br />
(
<br />
&nbsp;&nbsp;&nbsp; [MOLDB] =&gt; stdClass Object
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [MOLECULE] =&gt; Array
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [0] =&gt; stdClass Object
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [NAME] =&gt; Alanine
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [SYMBOL] =&gt; ala
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [CODE] =&gt; A
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [TYPE] =&gt; hydrophobic
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [1] =&gt; stdClass Object
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [NAME] =&gt; Lysine
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [SYMBOL] =&gt; lys
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [CODE] =&gt; K
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [TYPE] =&gt; charged
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )
<br />
)
<br />

<br />
here is the code. enjoy!
<br />

<br />
<span class="default">&lt;?php
<br />

<br />
</span><span class="keyword">class </span><span class="default">XMLParser </span><span class="keyword">{
<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$path</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$result</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">cleanString</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">trim</span><span class="keyword">(</span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"'"</span><span class="keyword">, </span><span class="string">"&amp;#39;"</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">));
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">XMLParser</span><span class="keyword">(</span><span class="default">$encoding</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">path </span><span class="keyword">= </span><span class="string">"\$this-&gt;result"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">index </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$xml_parser </span><span class="keyword">= </span><span class="default">xml_parser_create</span><span class="keyword">(</span><span class="default">$encoding</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_set_object</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">, &amp;</span><span class="default">$this</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_set_element_handler</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">, </span><span class="string">'startElement'</span><span class="keyword">, </span><span class="string">'endElement'</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_set_character_data_handler</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">, </span><span class="string">'characterData'</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_parse</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">xml_parser_free</span><span class="keyword">(</span><span class="default">$xml_parser</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">startElement</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$tag</span><span class="keyword">, </span><span class="default">$attributeList</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">path </span><span class="keyword">.= </span><span class="string">"-&gt;"</span><span class="keyword">.</span><span class="default">$tag</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; eval(</span><span class="string">"\$data = "</span><span class="keyword">.</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">path</span><span class="keyword">.</span><span class="string">";"</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$index </span><span class="keyword">= </span><span class="default">sizeof</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">path </span><span class="keyword">.= </span><span class="string">"["</span><span class="keyword">.</span><span class="default">$index</span><span class="keyword">.</span><span class="string">"]"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else if (</span><span class="default">is_object</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; eval(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">path</span><span class="keyword">.</span><span class="string">" = array("</span><span class="keyword">.</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">path</span><span class="keyword">.</span><span class="string">");"</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">path </span><span class="keyword">.= </span><span class="string">"[1]"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$attributeList </span><span class="keyword">as </span><span class="default">$name </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; eval(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">path</span><span class="keyword">.</span><span class="string">"-&gt;"</span><span class="keyword">.</span><span class="default">$name</span><span class="keyword">. </span><span class="string">" = '"</span><span class="keyword">.</span><span class="default">XMLParser</span><span class="keyword">::</span><span class="default">cleanString</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">).</span><span class="string">"';"</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">endElement</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$tag</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">path </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">path</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">strrpos</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">path</span><span class="keyword">, </span><span class="string">"-&gt;"</span><span class="keyword">));
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">characterData</span><span class="keyword">(</span><span class="default">$parser</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$data </span><span class="keyword">= </span><span class="default">XMLParser</span><span class="keyword">::</span><span class="default">cleanString</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">))
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; eval(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">path</span><span class="keyword">.</span><span class="string">" = '</span><span class="default">$data</span><span class="string">';"</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />
}
<br />

<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="33181""></a>
  <div class="note">
   <strong class="user">plusplus7 at hotmail dot com</strong>
   <a href="#33181" class="date">18-Jun-2003 03:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Quick and dirty function to get original file from $vals array in manual example. Build on this for custom parsing of individual elements (something like this should be built-in IMO).<br />
<br />
&lt;pre&gt;<br />
function parseVals($vals){<br />
&nbsp;&nbsp;&nbsp; foreach($vals as $valobj){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if($valobj['type']=='open' || $valobj['type']=='complete'){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $retstr .= '&lt;'.$valobj['tag'];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(is_array($valobj['attributes'])){ <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach($valobj['attributes'] as $key=&gt;$val){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $retstr .= " $key=\"$val\"";<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if($valobj['type']=='open'){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $retstr .= '&gt;'.$valobj['value'];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }elseif($valobj['type']=='complete' &amp;&amp; $valobj['value']){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $retstr .= '&gt;'.$valobj['value'].'&lt;/'.$valobj['tag'].'&gt;';<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }elseif($valobj['type']=='complete'){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $retstr .= ' /&gt;';<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }elseif($valobj['type']=='cdata'){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $retstr .= $valobj['value'];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }elseif($valobj['type']=='close'){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $retstr .= '&lt;/'.$valobj['tag'].'&gt;';<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return $retstr;<br />
}<br />
<br />
&lt;/pre&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="27130""></a>
  <div class="note">
   <strong class="user">masuod_a at hotmail dot com</strong>
   <a href="#27130" class="date">24-Nov-2002 01:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
wanna load object from xml file? this function take a tree returned by xml_get_tree() [dave@ovumdesign.com's version] and return an object.<br />
it can't work with attributes, i hate attributes (except id), but may be useful for you.<br />
<br />
- how to use :<br />
------------------------- xml file -------------<br />
&lt;config&gt;<br />
&nbsp;&nbsp; &lt;images&gt;<br />
&nbsp;&nbsp; &nbsp;&nbsp; &lt;image id="1"&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;name&gt;my pet&lt;/name&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;file&gt;pet001.jpg&lt;/file&gt;<br />
&nbsp;&nbsp; &nbsp;&nbsp; &lt;/image&gt;<br />
&nbsp;&nbsp; &nbsp;&nbsp; &lt;image id="2"&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;name&gt;harry's pet&lt;/name&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;file&gt;pet003.jpg&lt;/file&gt;<br />
&nbsp;&nbsp; &nbsp;&nbsp; &lt;/image&gt;<br />
&nbsp;&nbsp; &lt;/images&gt;<br />
&nbsp;&nbsp; &lt;library&gt;lib_functions.php&lt;/library&gt;<br />
&lt;/config&gt;<br />
----------------------------------------------<br />
$config=xml_to_object($xml_tree);<br />
$config-&gt;library;&nbsp; &nbsp; #return "lib_functions.php"<br />
$config-&gt;images-&gt;image__1-&gt;name; #return "my pet"<br />
----------------------------------------------<br />
function xml_to_object($xml_tree,$root=false){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $object_name=$xml_tree['tag'];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach ($xml_tree['children'] as $children){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $child_id=$children['attributes']['id'];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $child_name=$children['tag'];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $child_name.=($child_id) ? "__".$child_id:'';<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (is_array($children['children'])) {&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $child_object=xml_to_object($children);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $temp_object-&gt;$child_name=$child_object;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $temp_object-&gt;$child_name=$children['value'];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (!$root)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $xml_object=$temp_object;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else&nbsp; &nbsp; &nbsp;&nbsp; $xml_object-&gt;$object_name=$temp_object;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return $xml_object;<br />
}<br />
<br />
also you can use this function for loading array from xml , but i suggest you to use kris@h3x.com's functions[ <a href="http://www.devdump.com/phpxml.php ]." rel="nofollow" target="_blank">http://www.devdump.com/phpxml.php ].</a><br />
<br />
function xml_to_array($xml_tree,$root=false){<br />
&nbsp;&nbsp; $array_name=$xml_tree['tag'];<br />
&nbsp;&nbsp; foreach ($xml_tree['children'] as $children){<br />
&nbsp;&nbsp; &nbsp; &nbsp; $child_id=$children['attributes']['id'];<br />
&nbsp;&nbsp; &nbsp; &nbsp; $child_name=$children['tag'];<br />
&nbsp;&nbsp; &nbsp; &nbsp; $child_name.=($child_id) ? "__".$child_id:'';<br />
&nbsp;&nbsp; &nbsp; &nbsp; if (is_array($children['children'])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $child_array=xml_to_array($children);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $temp_array[$child_name]=$child_array;<br />
&nbsp;&nbsp; &nbsp; &nbsp; } else {&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $temp_array[$child_name]=$children['value'];<br />
&nbsp;&nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; if (!$root)<br />
&nbsp;&nbsp; &nbsp;&nbsp; $xml_array=$temp_array;<br />
&nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp;&nbsp; $xml_array[$array_name]=$temp_array; <br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; return $xml_array;<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="27015""></a>
  <div class="note">
   <strong class="user">bisqwit at iki dot fi dot not dot for dot ads dot invalid</strong>
   <a href="#27015" class="date">20-Nov-2002 05:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I made my own xml2tree()-function.<br />
The difference to the previously suggested ones on this manual page is that this creates a tree where the tags are keys.<br />
<br />
Example input:<br />
<br />
&lt;tree&gt;<br />
&nbsp;&lt;leaf name="gruu"&gt; pl?? &lt;/leaf&gt;<br />
&nbsp;&lt;animal type="cat" /&gt;<br />
&lt;/tree&gt;<br />
<br />
Example output:<br />
<br />
Array<br />
( 'tree' =&gt; Array<br />
&nbsp;&nbsp; &nbsp; ( 0 =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ( 'children' =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ( 'leaf' =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ( 0 =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ( 'attrs' =&gt; Array('name' =&gt; 'gruu'),<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'values' =&gt; Array(0 =&gt; ' pl?? ')<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )&nbsp; &nbsp; ),<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'animal' =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ( 0 =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ( 'attrs' =&gt; Array('type' =&gt; 'cat')<br />
)&nbsp; &nbsp; )&nbsp;&nbsp; )&nbsp; &nbsp; )&nbsp; &nbsp; )&nbsp;&nbsp; )<br />
<br />
function xml2tree2($string)<br />
{<br />
&nbsp; $parser = xml_parser_create();<br />
&nbsp; xml_parser_set_option($parser, XML_OPTION_CASE_FOLDING, 0);<br />
&nbsp; xml_parser_set_option($parser, XML_OPTION_SKIP_WHITE, 1);<br />
&nbsp; xml_parse_into_struct($parser, $string, $vals, $index);<br />
&nbsp; xml_parser_free($parser);<br />
&nbsp; <br />
&nbsp; $stack = array( array() );<br />
&nbsp; $stacktop = 0;<br />
&nbsp; $parent = array();<br />
&nbsp; foreach($vals as $val)<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; $type = $val['type'];<br />
&nbsp;&nbsp;&nbsp; if($type=='open' || $type=='complete')<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; // open tag<br />
&nbsp;&nbsp; &nbsp;&nbsp; $stack[$stacktop++] = $tagi;<br />
&nbsp;&nbsp; &nbsp;&nbsp; $tagi = array('tag' =&gt; $val['tag']);<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; if(isset($val['attributes']))&nbsp; $tagi['attrs'] = $val['attributes'];&nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp;&nbsp; if(isset($val['value']))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $tagi['values'][] = $val['value'];<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if($type=='complete' || $type=='close')<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; // finish tag<br />
&nbsp;&nbsp; &nbsp;&nbsp; $tags[] = $oldtagi = $tagi; <br />
&nbsp;&nbsp; &nbsp;&nbsp; $tagi = $stack[--$stacktop];<br />
&nbsp;&nbsp; &nbsp;&nbsp; $oldtag = $oldtagi['tag'];&nbsp; <br />
&nbsp;&nbsp; &nbsp;&nbsp; unset($oldtagi['tag']);<br />
&nbsp;&nbsp; &nbsp;&nbsp; $tagi['children'][$oldtag][] = $oldtagi;<br />
&nbsp;&nbsp; &nbsp;&nbsp; $parent = $tagi;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if($type=='cdata')<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; $tagi['values'][] = $val['value'];<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
&nbsp; return $parent['children'];<br />
}&nbsp; &nbsp; &nbsp; &nbsp; <br />
<br />
Ps: Note that the xml parsing for some reason chokes if the values contain &lt;&gt; (even inside ""). You need to escape them as &amp;lt; and &amp;gt;.<br />
Same for &amp; (for obvious reasons). Escape it as &amp;amp;.<br />
For example "&amp;nbsp;" should be written as "&amp;amp;nbsp;".</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="26993""></a>
  <div class="note">
   <strong class="user">joeldegan at yahoo dot com</strong>
   <a href="#26993" class="date">20-Nov-2002 01:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Using one of the nice function above, I was able to get these two great structures below on nmap info for a machine and then the PID lists for each open port.. Very handy for my current project.<br />
<br />
$test = `nmap -sU -sS localhost -oX -`;<br />
$ret = xml2array($test);<br />
$z=0;<br />
while (list($key,$val)=each($ret["host"][0][3]["children"])){<br />
&nbsp;&nbsp;&nbsp; if ($val["tag"] == "PORT"){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $new[$z]["PROTOCOL"] = $val["attributes"]["PROTOCOL"];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $new[$z]["PORT"] = $val["attributes"]["PORTID"];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; //echo $val["attributes"]["PROTOCOL"]."\n";&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; //echo $val["attributes"]["PORTID"]."\n";<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $z++;<br />
&nbsp;&nbsp;&nbsp; }//fi<br />
}//wend<br />
<br />
print_r($new);<br />
<br />
function port_pids($portnum){<br />
&nbsp;&nbsp;&nbsp; $ret = `lsof -i :$portnum -F pc`;<br />
&nbsp;&nbsp;&nbsp; $ret = explode("\n", $ret);<br />
&nbsp;&nbsp;&nbsp; $z=0;<br />
&nbsp;&nbsp;&nbsp; for($a=0;$a&lt;count($ret);$a++){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $port = $ret[$a];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $a++;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $com = $ret[$a];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $new[$z]["PID"]=substr($port, 1);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $new[$z]["COMMAND"]=substr($com, 1);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $z++;<br />
&nbsp;&nbsp;&nbsp; }//wend<br />
&nbsp;&nbsp;&nbsp; return $new;<br />
}//end function<br />
<br />
print_r(port_pids("3306"));</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="26670""></a>
  <div class="note">
   <strong class="user">no  at  chance  dot  com</strong>
   <a href="#26670" class="date">08-Nov-2002 07:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Thanks to gdemartini's tree algorithm , I was able to create a variation that display's the information in a way that allows you to then easily parse the information with less code and process time. Here's the variation and I've also posted a quick function at the bottom that allows you to visually display complex arrays in human readable format. Hope this helps someone as much as gdemartini's functions helped me.<br />
<br />
I decided to post it on my server as opposed to the forums as it was too large and needed some good html formatting.&nbsp; It can found at <a href="http://www.devdump.com/phpxml.php ." rel="nofollow" target="_blank">http://www.devdump.com/phpxml.php .</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="25782""></a>
  <div class="note">
   <strong class="user">ambi at gmx dot de</strong>
   <a href="#25782" class="date">06-Oct-2002 12:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Sorry.. unreachable and unneeded code in my posting above :-)<br />
Here is the fixed version:<br />
function xml_condense_tree($tree) {<br />
&nbsp;&nbsp;&nbsp; if ($tree["children"]) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; unset($nodecounters);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach ($tree['children'] as $index =&gt; $node) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!isset($nodecounters[$node['tag']]))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $nodecounters[$node['tag']]=1;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else $nodecounters[$node['tag']]++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach ($tree['children'] as $index =&gt; $node) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (isset($node['children'])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $tree['children'][$index] = xml_condense_tree($node);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } elseif (isset($node['value']) and !$node['attributes'] and $nodecounters[$node['tag']]==1) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $tree['values'][$node['tag']] = $node['value'];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; unset($tree['children'][$index]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if (!$tree['children']) unset($tree['children']);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; return $tree;<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="24199""></a>
  <div class="note">
   
   <a href="#24199" class="date">09-Aug-2002 10:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is based on a comment above by mh@mainlab.de.&nbsp; This version makes more sense to me and I included a few comments that might make it more usefull for specific purposes.<br />
<br />
// Look through $vals and $index,<br />
// generated by parse_xml_data(),<br />
// for $location.&nbsp; $location resembles a unix path.<br />
// E.g. "my/xml/path/to/my/data".<br />
// Note: This is NOT a full-feature xml utility.<br />
// Your path must be unique in the xml data<br />
// and the tags must not contain slashes.<br />
//<br />
// returns: cdata from last element of $location<br />
//&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; or NULL.<br />
function get_xml_values($vals, $index, $location) {<br />
&nbsp; $location = explode('/', $location);<br />
&nbsp; $location_level = count($location);<br />
&nbsp; for ($n=0; $n&lt;$location_level; ++$n) {<br />
&nbsp;&nbsp;&nbsp; $val_indexes=$index[$location[$n]];<br />
&nbsp;&nbsp;&nbsp; $good=0;<br />
&nbsp;&nbsp;&nbsp; for ($i=0; $i&lt;count($val_indexes); ++$i) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; $v = $vals[$val_indexes[$i]];<br />
&nbsp;&nbsp; &nbsp;&nbsp; // level is 1 based, n is 0 based:<br />
&nbsp;&nbsp; &nbsp;&nbsp; if ($v['level']-1 == $n) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ($v['type'] == 'open') {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // We found an open tag at the correct level.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $good=1;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break; // Remove break to avoid 'open' hiding<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // 'complete' at last $n. (Speed Vs. Robustness:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // For now, I'm going with speed).<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ($v['type'] == 'complete') {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // We found it, after finding all the prior elements:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // You may want to change this to<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // return $v<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // so you can call $v['value'] and $v['attributes']<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return $v['value'];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if (!$good) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; return NULL;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="23526""></a>
  <div class="note">
   <strong class="user">farinspace-at-hotmail-dot-com</strong>
   <a href="#23526" class="date">21-Jul-2002 03:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Wow, took a while to consume all of this. I am a noobie at XML, in fact i just really started working with it today. I went ahead and added to the above code by gdemartini@bol.com.br. I also added the update by nyk@cowham.net.<br />
<br />
Added 'value' =&gt; $vals[$i]['value'] to the open case, as some nodes have both cdata as well as a children node. In previous versions of the functions the cdata of a node(a) that also had children would get stored in the children's array of the parent node(a). Now only children values are in the children array and the cdata is in the value key of the parent node(a).<br />
<br />
Added 'value' =&gt; $vals[$i]['value'] to tree array as the vals array produced by PHP includes a value to the top most node if no children exist (for completeness).<br />
<br />
Also, using xml_parser_set_option($parser, XML_OPTION_SKIP_WHITE,1) will strip all white space from both around the XML tags as well as inside the cdata. I added a piece of code by waldo@wh-e.com to take care of this. All SPACE characters are now only stripped from around the XML tags and cdata spacing is retained.<br />
<br />
CODE:<br />
***************************************<br />
<br />
function GetChildren($vals, &amp;$i) {<br />
<br />
&nbsp;&nbsp;&nbsp; $children = array();<br />
<br />
&nbsp;&nbsp;&nbsp; while (++$i &lt; sizeof($vals)) {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // compair type<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; switch ($vals[$i]['type']) {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case 'cdata':<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $children[] = $vals[$i]['value'];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case 'complete':<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $children[] = array(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 'tag' =&gt; $vals[$i]['tag'], <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 'attributes' =&gt; $vals[$i]['attributes'], <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 'value' =&gt; $vals[$i]['value']<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; );<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case 'open':<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $children[] = array(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 'tag' =&gt; $vals[$i]['tag'], <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 'attributes' =&gt; $vals[$i]['attributes'], <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 'value' =&gt; $vals[$i]['value'], <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 'children' =&gt; GetChildren($vals, $i)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; );&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case 'close':<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return $children;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
function GetXMLTree($file) {<br />
<br />
&nbsp;&nbsp;&nbsp; $data = implode('', file($file));<br />
<br />
&nbsp;&nbsp;&nbsp; // by: waldo@wh-e.com - trim space around tags not within<br />
&nbsp;&nbsp;&nbsp; $data = eregi_replace("&gt;"."[[:space:]]+"."&lt;","&gt;&lt;",$data);<br />
<br />
&nbsp;&nbsp;&nbsp; // XML functions<br />
&nbsp;&nbsp;&nbsp; $p = xml_parser_create();<br />
<br />
&nbsp;&nbsp;&nbsp; // by: anony@mous.com - meets XML 1.0 specification<br />
&nbsp;&nbsp;&nbsp; xml_parser_set_option($p, XML_OPTION_CASE_FOLDING, 0);<br />
&nbsp;&nbsp;&nbsp; xml_parse_into_struct($p, $data, &amp;$vals, &amp;$index);<br />
&nbsp;&nbsp;&nbsp; xml_parser_free($p);<br />
<br />
&nbsp;&nbsp;&nbsp; $i = 0;<br />
&nbsp;&nbsp;&nbsp; $tree = array();<br />
&nbsp;&nbsp;&nbsp; $tree[] = array(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'tag' =&gt; $vals[$i]['tag'], <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'attributes' =&gt; $vals[$i]['attributes'], <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'value' =&gt; $vals[$i]['value'], <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'children' =&gt; GetChildren($vals, $i)<br />
&nbsp;&nbsp;&nbsp; );<br />
<br />
&nbsp;&nbsp;&nbsp; return $tree;<br />
}<br />
<br />
***************************************</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="20412""></a>
  <div class="note">
   <strong class="user">dave at ovumdesign dot com</strong>
   <a href="#20412" class="date">03-Apr-2002 12:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is another variation on gdemartini@bol.com.br's nice tree algorithm. I have included nyk@cowham.net's "cdata" suggestion. I made a few changes to suppress unitialized variable warnings with error_reporting(E_ALL), and made a few stylistic changes.<br />
<br />
There are two functional modifications as well. The first is the added option to expat to turn off "case folding", since XML is technically a case-sensitive language. The second is the returned tree - instead of returning a single-element list (an array with index 0 pointing to the top node) like the original algorithm, it returns the top node itself. This saves you an unnecessary level of indirection.<br />
<br />
function xml_get_children($vals, &amp;$i) {<br />
&nbsp;&nbsp;&nbsp; $children = array();<br />
&nbsp;&nbsp;&nbsp; if (isset($vals[$i]['value'])) $children[] = $vals[$i]['value'];<br />
<br />
&nbsp;&nbsp;&nbsp; while (++$i &lt; count($vals)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; switch ($vals[$i]['type']) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case 'cdata':<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $children[] = $vals[$i]['value'];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case 'complete':<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $children[] = array(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 'tag'&nbsp; &nbsp; &nbsp; &nbsp; =&gt; $vals[$i]['tag'],<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 'attributes' =&gt; isset($vals[$i]['attributes'])?<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $vals[$i]['attributes'] : null,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 'value'&nbsp; &nbsp; &nbsp; =&gt; $vals[$i]['value'],<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; );<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case 'open':<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $children[] = array(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 'tag'&nbsp; &nbsp; &nbsp; &nbsp; =&gt; $vals[$i]['tag'],<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 'attributes' =&gt; isset($vals[$i]['attributes'])?<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $vals[$i]['attributes'] : null,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 'children'&nbsp;&nbsp; =&gt; xml_get_children($vals, $i),<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; );<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case 'close':<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return $children;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
function xml_get_tree($file) {<br />
&nbsp;&nbsp;&nbsp; $data = join('', file($file));<br />
<br />
&nbsp;&nbsp;&nbsp; $parser = xml_parser_create();<br />
&nbsp;&nbsp;&nbsp; xml_parser_set_option($parser, XML_OPTION_CASE_FOLDING, 0);<br />
&nbsp;&nbsp;&nbsp; xml_parser_set_option($parser, XML_OPTION_SKIP_WHITE,&nbsp;&nbsp; 1);<br />
&nbsp;&nbsp;&nbsp; xml_parse_into_struct($parser, $data, $vals, $index);<br />
&nbsp;&nbsp;&nbsp; xml_parser_free($parser);<br />
<br />
&nbsp;&nbsp;&nbsp; return array(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'tag'&nbsp; &nbsp; &nbsp; &nbsp; =&gt; $vals[0]['tag'],<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'attributes' =&gt; isset($vals[0]['attributes'])?<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $vals[0]['attributes'] : null,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'children'&nbsp;&nbsp; =&gt; xml_get_children($vals, $i = 0),<br />
&nbsp;&nbsp;&nbsp; );<br />
}<br />
<br />
This function takes a tree returned by xml_get_tree() and simplifies it similarly to voncken@mailandnews.com and oknapp@soly.de's suggestions. It finds any nodes that expat considered "complete" (childless) and contain no attributes, and it moves the tag name (as the key) and value into an element in the parent node's "values" array.<br />
<br />
For example: <br />
$tree = xml_get_tree('moldb.xml');&nbsp;&nbsp; <br />
$tree = xml_condense_tree($tree); <br />
echo $tree['children'][1]['values']['name'];<br />
<br />
Outputs:<br />
Lysine<br />
<br />
function xml_condense_tree($tree) {<br />
&nbsp;&nbsp;&nbsp; foreach ($tree['children'] as $index =&gt; $node) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (isset($node['children'])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $tree['children'][$index] = xml_condense_tree($node);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } elseif (isset($node['value']) and !$node['attributes']) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $tree['values'][$node['tag']] = $node['value'];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; unset($tree['children'][$index]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; if (!$tree['children']) unset($tree['children']);<br />
&nbsp;&nbsp;&nbsp; return $tree;<br />
}<br />
<br />
Enjoy,<br />
Dave</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="17990""></a>
  <div class="note">
   <strong class="user">voncken at mailandnews dot com</strong>
   <a href="#17990" class="date">06-Jan-2002 02:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I needed something a bit different:<br />
this is the result of my xml2array function (from the moldb example)<br />
<br />
Array<br />
(<br />
&nbsp;&nbsp;&nbsp; [molecule] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [0] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [name] =&gt; Alanine<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [symbol] =&gt; ala<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [code] =&gt; A<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [type] =&gt; hydrophobic<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [1] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [name] =&gt; Lysine<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [symbol] =&gt; lys<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [code] =&gt; K<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [type] =&gt; charged<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
)<br />
<br />
function xml2array($data)<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; //mvo voncken@mailandnews.com<br />
&nbsp;&nbsp;&nbsp; //original ripped from&nbsp; on the php-manual:gdemartini@bol.com.br&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; //to be used for data retrieval(result-structure is Data oriented)&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; $p = xml_parser_create();<br />
&nbsp;&nbsp;&nbsp; xml_parser_set_option($p, XML_OPTION_SKIP_WHITE, 1);<br />
&nbsp;&nbsp;&nbsp; xml_parse_into_struct($p, $data, &amp;$vals, &amp;$index);<br />
&nbsp;&nbsp;&nbsp; xml_parser_free($p);<br />
<br />
&nbsp;&nbsp;&nbsp; $tree = array();<br />
&nbsp;&nbsp;&nbsp; $i = 0;<br />
&nbsp;&nbsp;&nbsp; //array_push($tree, array('tag' =&gt; $vals[$i]['tag'], 'attributes'=&gt; $vals[$i]['attributes'],&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'children' =&gt; ));<br />
&nbsp;&nbsp;&nbsp; $tree = GetChildren($vals, $i);<br />
&nbsp;&nbsp;&nbsp; return $tree;<br />
&nbsp; }<br />
<br />
&nbsp;function GetChildren($vals, &amp;$i) <br />
&nbsp; {&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; $children = array();<br />
&nbsp;&nbsp;&nbsp; if ($vals[$i]['value']) array_push($children, $vals[$i]['value']);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; $prevtag = "";<br />
&nbsp;&nbsp;&nbsp; while (++$i &lt; count($vals)) // so pra nao botar while true ;-)<br />
&nbsp;&nbsp;&nbsp; {&nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp;&nbsp; switch ($vals[$i]['type'])<br />
&nbsp;&nbsp; &nbsp;&nbsp; {&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; case 'cdata':<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; array_push($children, $vals[$i]['value']);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; case 'complete':&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $children[ strtolower($vals[$i]['tag']) ] = $vals[$i]['value'];&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; case 'open':&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //restartindex on unique tag-name<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $j++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ($prevtag &lt;&gt; $vals[$i]['tag']) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $j = 0;&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $prevtag = $vals[$i]['tag'];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $children[ strtolower($vals[$i]['tag']) ][$j] = GetChildren($vals,$i);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; case 'close':&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return $children;<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }&nbsp; &nbsp; <br />
&nbsp; }</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
