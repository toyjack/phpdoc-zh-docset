<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>由文件或 URL 创建一个新图象。</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.imagecreatefromjpeg.html">? imagecreatefromjpeg</a></li>
      <li style="float: right;"><a href="function.imagecreatefromstring.html">imagecreatefromstring ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.image.html">GD 和图像处理 函数</a></li>
    <li>由文件或 URL 创建一个新图象。</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.imagecreatefrompng" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">imagecreatefrompng</h1>
  <p class="verinfo">(PHP 4, PHP 5, PHP 7)</p><p class="refpurpose"><span class="refname">imagecreatefrompng</span> &mdash; <span class="dc-title">由文件或 URL 创建一个新图象。</span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.imagecreatefrompng-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">resource</span> <span class="methodname"><strong>imagecreatefrompng</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$filename</code></span>
   )</div>

  <p class="para rdfs-comment"> <span class="function"><strong>imagecreatefrompng()</strong></span>
   返回一图像标识符，代表了从给定的文件名取得的图像。
  </p>
  <div class="tip"><strong class="tip">Tip</strong><p class="simpara">如已启用<a href="filesystem.configuration.html#ini.allow-url-fopen" class="link">fopen 包装器</a>，在此函数中， URL 可作为文件名。关于如何指定文件名详见 <span class="function"><a href="function.fopen.html" class="function">fopen()</a></span>。各种
wapper 的不同功能请参见 <a href="wrappers.html" class="xref">支持的协议和封装协议</a>，注意其用法及其可提供的预定义变量。</p></div>
 </div>

 <div class="refsect1 parameters" id="refsect1-function.imagecreatefrompng-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">filename</code></dt>

     <dd>

      <p class="para">
       PNG 图像的路径。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>

 <div class="refsect1 returnvalues" id="refsect1-function.imagecreatefrompng-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">成功后返回图象资源,失败后返回 <strong><code>FALSE</code></strong> 。</p>
 </div>

 <div class="refsect1 examples" id="refsect1-function.imagecreatefrompng-examples">
  <h3 class="title">范例</h3>
  <div class="example" id="example-3429">
   <p><strong>Example #1 处理创建 PNG 过程中的错误 </strong></p>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">function&nbsp;</span><span style="color: #0000BB">LoadPNG</span><span style="color: #007700">(</span><span style="color: #0000BB">$imgname</span><span style="color: #007700">)<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;Attempt&nbsp;to&nbsp;open&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$im&nbsp;</span><span style="color: #007700">=&nbsp;@</span><span style="color: #0000BB">imagecreatefrompng</span><span style="color: #007700">(</span><span style="color: #0000BB">$imgname</span><span style="color: #007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;See&nbsp;if&nbsp;it&nbsp;failed&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if(!</span><span style="color: #0000BB">$im</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;Create&nbsp;a&nbsp;blank&nbsp;image&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$im&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">imagecreatetruecolor</span><span style="color: #007700">(</span><span style="color: #0000BB">150</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">30</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$bgc&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">imagecolorallocate</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">255</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">255</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">255</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$tc&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">imagecolorallocate</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">imagefilledrectangle</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">150</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">30</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$bgc</span><span style="color: #007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;Output&nbsp;an&nbsp;error&nbsp;message&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">imagestring</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">5</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">5</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'Error&nbsp;loading&nbsp;'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$imgname</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$tc</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$im</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #0000BB">header</span><span style="color: #007700">(</span><span style="color: #DD0000">'Content-Type:&nbsp;image/png'</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$img&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">LoadPNG</span><span style="color: #007700">(</span><span style="color: #DD0000">'bogus.image'</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">imagepng</span><span style="color: #007700">(</span><span style="color: #0000BB">$img</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">imagedestroy</span><span style="color: #007700">(</span><span style="color: #0000BB">$img</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

   <div class="example-contents"><p>以上例程的输出类似于：</p></div>
   <div class="mediaobject">
    
    <div class="imageobject">
     <img src="images/21009b70229598c6a80eef8b45bf282b-imagecreatefrompng.png" alt="imagecreatefrompng() 例子" width="150" height="30" />
    </div>
   </div>
  </div>
 </div>

 <div class="refsect1 notes" id="refsect1-function.imagecreatefrompng-notes">
  <h3 class="title">注释</h3>
  <div class="warning"><strong class="warning">Warning</strong><p class="para">Windows 版本的 PHP 在 4.3.0
版之前不支持通过此函数访问远程文件，即使已经启用 <a href="filesystem.configuration.html#ini.allow-url-fopen" class="link">allow_url_fopen</a>.
</p></div>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="118146""></a>
  <div class="note">
   <strong class="user">Cyrille37</strong>
   <a href="#118146" class="date">14-Oct-2015 08:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The image size (width x height) should not exceed INT_MAX ... It's still thrue on a 64 bits computer.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="90364""></a>
  <div class="note">
   <strong class="user">admin at wdfa dot co dot uk</strong>
   <a href="#90364" class="date">18-Apr-2009 12:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When using imagecreatepng with alpha blending you will lose the blending.<br />
<br />
To over come this use something like the following<br />
<span class="default">&lt;?php<br />
$dstimage</span><span class="keyword">=</span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$width</span><span class="keyword">,</span><span class="default">$height</span><span class="keyword">);<br />
</span><span class="default">$srcimage</span><span class="keyword">=</span><span class="default">imagecreatefrompng</span><span class="keyword">(</span><span class="default">$src</span><span class="keyword">);<br />
</span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$dstimage</span><span class="keyword">,</span><span class="default">$srcimage</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">, </span><span class="default">$width</span><span class="keyword">,</span><span class="default">$height</span><span class="keyword">,</span><span class="default">$width</span><span class="keyword">,</span><span class="default">$height</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span>Where $width and $height are the width and height of the $src image.<br />
<br />
This will create a true colour image then copy the png image to this true colour image and retain alpha blending.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73546""></a>
  <div class="note">
   <strong class="user">marcos at assl-site dot net</strong>
   <a href="#73546" class="date">28-Feb-2007 09:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I had the same problem as jboyd1189 at yahoo dot com but I solve d it allocating more memory dynamically.<br />
<br />
Usually the memory_limit var on php.ini is set to 8M. Unfortunately, the required amount of memory to manage a PNG image about 1000x1000 could be bigger !<br />
<br />
The approach I used to solve the problem is:<br />
<br />
1-Calculate the memory required by the image<br />
2-Set the new memory_limit value <br />
3-Create the PNG image and thumbnail<br />
4-Restore the original value<br />
<br />
1-The following value works for me:<br />
$required_memory = Round($width * $height * $size['bits']);<br />
<br />
Note that for JPEG the requirements are not the same:<br />
<a href="http://es2.php.net/manual/en/function.imagecreatefromjpeg.php#60241" rel="nofollow" target="_blank">http://es2.php.net/manual/en/function.imagecreatefromjpeg.php#60241</a><br />
<br />
2-Use somthing like: <br />
$new_limit=memory_get_usage() + $required_memory;<br />
ini_set("memory_limit", $new_limit);<br />
<br />
4-ini_restore ("memory_limit");</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="67854""></a>
  <div class="note">
   <strong class="user">jboyd1189 at yahoo dot com</strong>
   <a href="#67854" class="date">05-Jul-2006 11:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I was having a terrible time with the imagecreatefrompng function as it was working perfectly for one image and not at all for another.&nbsp; After many hours of frustration, I discovered that the problem was the image size (number of pixels).&nbsp; It appears that the maximum number of pixels this function will process is 1,040,000.&nbsp; So, be sure that the pixel resolution of the image (eg. 1040 x 1000) does not exceed this value.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="43024""></a>
  <div class="note">
   
   <a href="#43024" class="date">07-Jun-2004 01:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you're trying to load a translucent png-24 image but are finding an absence of transparency (like it's black), you need to enable alpha channel AND save the setting. I'm new to GD and it took me almost two hours to figure this out.<br />
<br />
<span class="default">&lt;?php<br />
$imgPng </span><span class="keyword">= </span><span class="default">imageCreateFromPng</span><span class="keyword">(</span><span class="default">$strImagePath</span><span class="keyword">);<br />
</span><span class="default">imageAlphaBlending</span><span class="keyword">(</span><span class="default">$imgPng</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
</span><span class="default">imageSaveAlpha</span><span class="keyword">(</span><span class="default">$imgPng</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
<br />
</span><span class="comment">/* Output image to browser */<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-type: image/png"</span><span class="keyword">);<br />
</span><span class="default">imagePng</span><span class="keyword">(</span><span class="default">$imgPng</span><span class="keyword">); <br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
