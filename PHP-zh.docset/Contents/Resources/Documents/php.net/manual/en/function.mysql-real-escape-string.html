<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>转义 SQL 语句中使用的字符串中的特殊字符，并考虑到连接的当前字符集</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.mysql-query.html">? mysql_query</a></li>
      <li style="float: right;"><a href="function.mysql-result.html">mysql_result ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.mysql.html">MySQL 函数</a></li>
    <li>转义 SQL 语句中使用的字符串中的特殊字符，并考虑到连接的当前字符集</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.mysql-real-escape-string" class="refentry">
   <div class="refnamediv">
    <h1 class="refname">mysql_real_escape_string</h1>
    <p class="verinfo">(PHP 4 &gt;= 4.3.0, PHP 5)</p><p class="refpurpose"><span class="refname">mysql_real_escape_string</span> &mdash; <span class="dc-title">
     转义 SQL 语句中使用的字符串中的特殊字符，并考虑到连接的当前字符集
    </span></p>

   </div>
   <div class="refsect1 unknown-seealsp" id="refsect1-function.mysql-real-escape-string-unknown-seealsp">
    <h3 class="title">说明</h3>
     <div class="methodsynopsis dc-description">
      <span class="type">string</span> <span class="methodname"><strong>mysql_real_escape_string</strong></span>
       ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$unescaped_string</code></span>
      [, <span class="methodparam"><span class="type">resource</span> <code class="parameter">$link_identifier</code></span>
     ] )</div>

    <p class="para rdfs-comment">
     本函数将
     <code class="parameter">unescaped_string</code>
     中的特殊字符转义，并计及连接的当前字符集，因此可以安全用于
     <span class="function"><a href="function.mysql-query.html" class="function">mysql_query()</a></span>。
    </p>
    <blockquote class="note"><p><strong class="note">Note</strong>: 
     <span class="simpara">
      <span class="function"><strong>mysql_real_escape_string()</strong></span> 并不转义
      <em>%</em> 和 <em>_</em>。
     </span>
    </p></blockquote>
    <p class="para">
     <div class="example" id="example-1650">
      <p><strong>Example #1 <span class="function"><strong>mysql_real_escape_string()</strong></span> 例子</strong></p>
      <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$item&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"Zak's&nbsp;and&nbsp;Derick's&nbsp;Laptop"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$escaped_item&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mysql_real_escape_string</span><span style="color: #007700">(</span><span style="color: #0000BB">$item</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">printf&nbsp;</span><span style="color: #007700">(</span><span style="color: #DD0000">"Escaped&nbsp;string:&nbsp;%s\n"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$escaped_item</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
      </div>

      <div class="example-contents"><p>
       以上例子将产生如下输出：
      </p></div>
      <div class="example-contents screen">
<div class="cdata"><pre>
Escaped string: Zak\&#039;s and Derick\&#039;s Laptop
</pre></div>
      </div>
     </div>
    </p>
    <p class="para">
     参见
     <span class="function"><a href="function.mysql-escape-string.html" class="function">mysql_escape_string()</a></span> 和
     <span class="function"><strong>mysql_character_set_name()</strong></span>。
    </p>
   </div>

  </div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="112479""></a>
  <div class="note">
   <strong class="user">mahdi</strong>
   <a href="#112479" class="date">21-Jun-2013 01:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
function clean($str) {<br />
&nbsp;$cleaned = strip_tags($str);<br />
&nbsp;$cleaned = htmlspecialchars(mysql_real_escape_string($cleaned));<br />
&nbsp;<br />
&nbsp;return $cleaned;}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="111995""></a>
  <div class="note">
   <strong class="user">dinho19sp at gmail dot com</strong>
   <a href="#111995" class="date">20-Apr-2013 07:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I use de form very simply on $ _REQUEST [], and I have no problems<br />
<br />
&nbsp; function objSqlRequest($StringVar){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(isset($_REQUEST[$StringVar])){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $StringVar =&nbsp; $_REQUEST[$StringVar];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return mysql_real_escape_string(trim($StringVar));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; }</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="110413""></a>
  <div class="note">
   <strong class="user">sam at numbsafari dot com</strong>
   <a href="#110413" class="date">20-Oct-2012 02:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
No discussion of escaping is complete without telling everyone that you should basically never use external input to generate interpreted code. This goes for SQL statements, or anything you would call any sort of "eval" function on.
<br />

<br />
So, instead of using this terribly broken function, use parametric prepared statements instead.
<br />

<br />
Honestly, using user provided data to compose SQL statements should be considered professional negligence and you should be held accountable by your employer or client for not using parametric prepared statements.
<br />

<br />
What does that mean?
<br />

<br />
It means instead of building a SQL statement like this:
<br />

<br />
"INSERT INTO X (A) VALUES(".$_POST["a"].")"
<br />

<br />
You should use mysqli's prepare() function (<a href="http://php.net/manual/en/mysqli.prepare.php" rel="nofollow" target="_blank">http://php.net/manual/en/mysqli.prepare.php</a>) to execute a statement that looks like this:
<br />

<br />
"INSERT INTO X (A) VALUES(?)"
<br />

<br />
NB: This doesn't mean you should never generate dynamic SQL statements. What it means is that you should never use user-provided data to generate those statements. Any user-provided data should be passed through as parameters to the statement after it has been prepared.
<br />

<br />
So, for example, if you are building up a little framework and want to do an insert to a table based on the request URI, it's in your best interest to not take the $_SERVER['REQUEST_URI'] value (or any part of it) and directly concatenate that with your query. Instead,&nbsp; you should parse out the portion of the $_SERVER['REQUEST_URI'] value that you want, and map that through some kind of function or associative array to a non-user provided value. If the mapping produces no value, you know that something is wrong with the user provided data.
<br />

<br />
Failing to follow this has been the cause of a number of SQL-injection problems in the Ruby On Rails framework, even though it uses parametric prepared statements. This is how GitHub was hacked at one point. So, no language is immune to this problem. That's why this is a general best practice and not something specific to PHP and why you should REALLY adopt it.
<br />

<br />
Also, you should still do some kind of validation of the data provided by users, even when using parametric prepared statements. This is because that user-provided data will often become part of some generated HTML, and you want to ensure that the user provided data isn't going to cause security problems in the browser.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="108125""></a>
  <div class="note">
   <strong class="user">Walter Tross</strong>
   <a href="#108125" class="date">30-Mar-2012 11:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For further information:<br />
<a href="http://dev.mysql.com/doc/refman/5.5/en/mysql-real-escape-string.html" rel="nofollow" target="_blank">http://dev.mysql.com/doc/refman/5.5/en/mysql-real-escape-string.html</a><br />
(replace your MySQL version in the URL)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="107529""></a>
  <div class="note">
   <strong class="user">Ortreum</strong>
   <a href="#107529" class="date">16-Feb-2012 02:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This small function walks through a complete array without a "normal" loop and convert all potentially "bad" inputs like $_POST and $_GET to mysql conform strings.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">db_conform</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">)
<br />
{
<br />
&nbsp;&nbsp;&nbsp; if (!</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">)) </span><span class="default">mysql_real_escape_string</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">db_conform_array_callback</span><span class="keyword">(&amp;</span><span class="default">$item</span><span class="keyword">, </span><span class="default">$key</span><span class="keyword">) { echo </span><span class="default">$key</span><span class="keyword">; </span><span class="default">$item </span><span class="keyword">= </span><span class="default">db_conform</span><span class="keyword">(</span><span class="default">$item</span><span class="keyword">); }
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">array_walk</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">, </span><span class="string">'db_conform_array_callback'</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$s</span><span class="keyword">;
<br />
}
<br />

<br />
</span><span class="default">$_POST </span><span class="keyword">= </span><span class="default">db_conform</span><span class="keyword">(</span><span class="default">$_POST</span><span class="keyword">);
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="107499""></a>
  <div class="note">
   <strong class="user">jeff at lindenlab dot com</strong>
   <a href="#107499" class="date">14-Feb-2012 10:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Yes, this means that you have to start a connection before you can escape data... you can't escape the data first, and then use it to build your SQL, and then connect.&nbsp; <br />
<br />
Be aware of this when you're designing objects and architecture.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="107101""></a>
  <div class="note">
   <strong class="user">ovoznyak at gmail dot com</strong>
   <a href="#107101" class="date">07-Jan-2012 12:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Function safe_string_escape($str) above is not properly working when $str is numeric (not string).<br />
<br />
For example, when call them as safe_string_escape((int) 12), it returns empty string. At the same time mysql_real_escape_string() returns 12.<br />
<br />
So, it is safe to add $str = (string) $str; in the begin of function.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="106035""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#106035" class="date">05-Oct-2011 12:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you try to escape a string which contains signs such as ' or " and it doesnt work, check your website/file charset! Maybe it is NOT utf-8 ;)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="105264""></a>
  <div class="note">
   <strong class="user">upadrian at gmail dot com</strong>
   <a href="#105264" class="date">05-Aug-2011 07:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
</span><span class="comment">/**<br />
&nbsp;* @author upadrian@gmail.com<br />
&nbsp;* Simplified version for array escape using mysql_real_escape_string<br />
&nbsp;* for db store. Key names are not escaped beacuse i don't plain to <br />
&nbsp;* include in a sql. <br />
&nbsp;* <br />
*/<br />
<br />
</span><span class="keyword">function </span><span class="default">mres</span><span class="keyword">(</span><span class="default">$q</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$q</span><span class="keyword">)) <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$q </span><span class="keyword">as </span><span class="default">$k </span><span class="keyword">=&gt; </span><span class="default">$v</span><span class="keyword">) <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$q</span><span class="keyword">[</span><span class="default">$k</span><span class="keyword">] = </span><span class="default">mres</span><span class="keyword">(</span><span class="default">$v</span><span class="keyword">); </span><span class="comment">//recursive<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">elseif(</span><span class="default">is_string</span><span class="keyword">(</span><span class="default">$q</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$q </span><span class="keyword">= </span><span class="default">mysql_real_escape_string</span><span class="keyword">(</span><span class="default">$q</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$q</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102168""></a>
  <div class="note">
   <strong class="user">stefan dot van dot beusekom at gmail dot com</strong>
   <a href="#102168" class="date">31-Jan-2011 02:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Following is a recursive function that makes all the strings it finds safe for data entry. If the underlying value is an array, it will loop through that array as well, to inifity. So any array depth is allowed. This might come in handy when dealing with sessions, posts, gets or whatnot arrays, where you immediately want to make use of the data without having to filter the data first.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/*<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; * Created by: Stefan van Beusekom<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; * Created on: 31-01-2011<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; * Description: A method that ensures safe data entry, and accepts either strings or arrays. If the array is multidimensional, <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; it will recursively loop through the array and make all points of data safe for entry.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; * parameters: string or array;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; * return: string or array;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; */<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">public function </span><span class="default">filterParameters</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Check if the parameter is an array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Loop through the initial dimension<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">foreach(</span><span class="default">$array </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Check if any nodes are arrays themselves<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">]))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// If they are, let the function call itself over that particular node<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$array</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">] = </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">filterParameters</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Check if the nodes are strings<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">is_string</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">]))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// If they are, perform the real escape function over the selected node<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$array</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">] = </span><span class="default">mysql_real_escape_string</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Check if the parameter is a string<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">is_string</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// If it is, perform a&nbsp; mysql_real_escape_string on the parameter<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$array </span><span class="keyword">= </span><span class="default">mysql_real_escape_string</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Return the filtered result<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">$array</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="101248""></a>
  <div class="note">
   <strong class="user">feedr</strong>
   <a href="#101248" class="date">05-Dec-2010 05:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just a little function which mimics the original mysql_real_escape_string but which doesn't need an active mysql connection. Could be implemented as a static function in a database class. Hope it helps someone.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">mysql_escape_mimic</span><span class="keyword">(</span><span class="default">$inp</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$inp</span><span class="keyword">))
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">array_map</span><span class="keyword">(</span><span class="default">__METHOD__</span><span class="keyword">, </span><span class="default">$inp</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp;&nbsp; if(!empty(</span><span class="default">$inp</span><span class="keyword">) &amp;&amp; </span><span class="default">is_string</span><span class="keyword">(</span><span class="default">$inp</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">str_replace</span><span class="keyword">(array(</span><span class="string">'\\'</span><span class="keyword">, </span><span class="string">"\0"</span><span class="keyword">, </span><span class="string">"\n"</span><span class="keyword">, </span><span class="string">"\r"</span><span class="keyword">, </span><span class="string">"'"</span><span class="keyword">, </span><span class="string">'"'</span><span class="keyword">, </span><span class="string">"\x1a"</span><span class="keyword">), array(</span><span class="string">'\\\\'</span><span class="keyword">, </span><span class="string">'\\0'</span><span class="keyword">, </span><span class="string">'\\n'</span><span class="keyword">, </span><span class="string">'\\r'</span><span class="keyword">, </span><span class="string">"\\'"</span><span class="keyword">, </span><span class="string">'\\"'</span><span class="keyword">, </span><span class="string">'\\Z'</span><span class="keyword">), </span><span class="default">$inp</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$inp</span><span class="keyword">;
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100854""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#100854" class="date">11-Nov-2010 06:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
calling this function twice, or on a string for which quotes have already been escaped, causes the quotes to be escaped twice.An example is where we have to check for magic_quotes_gpc&nbsp; before calling mysql_escape_string to sanitize the inputs.
<br />

<br />
The following function can be used to escape singe and double quotes in a string with out the risk of escaping quotes twice.This function&nbsp; escapes a quote, only if it hasn't already been escaped.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">safe_string_escape</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">)
<br />
{
<br />
&nbsp;&nbsp; </span><span class="default">$len</span><span class="keyword">=</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$escapeCount</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$targetString</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; for(</span><span class="default">$offset</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$offset</span><span class="keyword">&lt;</span><span class="default">$len</span><span class="keyword">;</span><span class="default">$offset</span><span class="keyword">++) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; switch(</span><span class="default">$c</span><span class="keyword">=</span><span class="default">$str</span><span class="keyword">{</span><span class="default">$offset</span><span class="keyword">}) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">"'"</span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Escapes this quote only if its not preceded by an unescaped backslash
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">$escapeCount </span><span class="keyword">% </span><span class="default">2 </span><span class="keyword">== </span><span class="default">0</span><span class="keyword">) </span><span class="default">$targetString</span><span class="keyword">.=</span><span class="string">"\\"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$escapeCount</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$targetString</span><span class="keyword">.=</span><span class="default">$c</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'"'</span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Escapes this quote only if its not preceded by an unescaped backslash
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">$escapeCount </span><span class="keyword">% </span><span class="default">2 </span><span class="keyword">== </span><span class="default">0</span><span class="keyword">) </span><span class="default">$targetString</span><span class="keyword">.=</span><span class="string">"\\"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$escapeCount</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$targetString</span><span class="keyword">.=</span><span class="default">$c</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'\\'</span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$escapeCount</span><span class="keyword">++;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$targetString</span><span class="keyword">.=</span><span class="default">$c</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; default:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$escapeCount</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$targetString</span><span class="keyword">.=</span><span class="default">$c</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$targetString</span><span class="keyword">;
<br />
}
<br />
echo </span><span class="default">safe_string_escape</span><span class="keyword">(</span><span class="string">"asda'sda\'dsad\"sadasd'"</span><span class="keyword">);
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
above code echoes 
<br />

<br />
asda\'sda\'dsad\"sadasd\'
<br />

<br />
You can see that the second single quote wasnt escaped again..</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100458""></a>
  <div class="note">
   <strong class="user">m-t at live dot fr</strong>
   <a href="#100458" class="date">17-Oct-2010 06:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You should use mysql_real_escape_string only before inserting the data into your table, otherwise you could just use this function :<br />
<br />
function reverse_escape($str)<br />
{<br />
&nbsp; $search=array("\\\\","\\0","\\n","\\r","\Z","\'",'\"');<br />
&nbsp; $replace=array("\\","\0","\n","\r","\x1a","'",'"');<br />
&nbsp; return str_replace($search,$replace,$str);<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99945""></a>
  <div class="note">
   <strong class="user">anonymous at host dot com</strong>
   <a href="#99945" class="date">16-Sep-2010 11:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You can also use the escape function in a manner as shown in the snapshot out of my own browsertools class:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="comment">//
<br />
// MySQL Database connection
<br />
//
<br />
</span><span class="keyword">public function </span><span class="default">mysqlConnect</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">, </span><span class="default">$user</span><span class="keyword">, </span><span class="default">$password</span><span class="keyword">, </span><span class="default">$database</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">mysql </span><span class="keyword">= </span><span class="default">mysql_connect</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">, </span><span class="default">$user</span><span class="keyword">, </span><span class="default">$password</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; if (!</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">mysql</span><span class="keyword">) die(</span><span class="default">mysql_error</span><span class="keyword">());
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">mysql_select_db</span><span class="keyword">(</span><span class="default">$database</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">mysql</span><span class="keyword">);
<br />
}
<br />

<br />
</span><span class="comment">//
<br />
// MySQL Query
<br />
// usage:
<br />
//&nbsp; &nbsp; $query such as "SELECT * FROM users WHERE nick = '%s' AND pass = '%s'"
<br />
//&nbsp; &nbsp; &nbsp; where %s are the placeholders for the parameters
<br />
// call:
<br />
//&nbsp; &nbsp; $__-&gt;mysqlQuery( $query, arg0, arg1, arg2, ... )
<br />
// description:
<br />
//&nbsp; &nbsp; The parameters given to the function are escaped through mysql_real_escape_string(),
<br />
//&nbsp; &nbsp; merged with the query and then given to the mysql_query function.
<br />
// returns:
<br />
//&nbsp; &nbsp; Array of lines returned by the MySQL Database
<br />
//
<br />
</span><span class="keyword">public function </span><span class="default">mysqlQuery</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$numParams </span><span class="keyword">= </span><span class="default">func_num_args</span><span class="keyword">();
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$params </span><span class="keyword">= </span><span class="default">func_get_args</span><span class="keyword">();
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$numParams </span><span class="keyword">&gt; </span><span class="default">1</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$numParams</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$params</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] = </span><span class="default">mysql_real_escape_string</span><span class="keyword">(</span><span class="default">$params</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$query </span><span class="keyword">= </span><span class="default">call_user_func_array</span><span class="keyword">(</span><span class="string">'sprintf'</span><span class="keyword">, </span><span class="default">$params</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">result </span><span class="keyword">= </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">mysql</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; if (!</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">result</span><span class="keyword">) die(</span><span class="default">mysql_error</span><span class="keyword">());
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ret </span><span class="keyword">= array();
<br />
&nbsp;&nbsp;&nbsp; while (</span><span class="default">$row </span><span class="keyword">= </span><span class="default">mysql_fetch_assoc</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">result</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ret</span><span class="keyword">[] = </span><span class="default">$row</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">mysql_free_result</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">result</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$ret</span><span class="keyword">;
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99878""></a>
  <div class="note">
   <strong class="user">paralescuoctavian at gmail dot com</strong>
   <a href="#99878" class="date">12-Sep-2010 02:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Also don't forget to escape $_COOKIE array before quering the database. In firefox you can edit cookies and insert and inject harmful sql queries.
<br />

<br />
<span class="default">&lt;?php
<br />
&nbsp; </span><span class="keyword">foreach (</span><span class="default">$_COOKIE </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">get_magic_quotes_gpc</span><span class="keyword">()) </span><span class="default">$_COOKIE</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">]=</span><span class="default">stripslashes</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$_COOKIE</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">] = </span><span class="default">mysql_real_escape_string</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">);
<br />
&nbsp; }
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="98506""></a>
  <div class="note">
   <strong class="user">adelbenzarti at yahoo dot fr</strong>
   <a href="#98506" class="date">19-Jun-2010 12:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The function mysql_real_escape_string helps the developer to insert data without having troubles in the process or having risks of SQL Injection.<br />
You can develop a similar function :<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">escape</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$search</span><span class="keyword">=array(</span><span class="string">"\\"</span><span class="keyword">,</span><span class="string">"\0"</span><span class="keyword">,</span><span class="string">"\n"</span><span class="keyword">,</span><span class="string">"\r"</span><span class="keyword">,</span><span class="string">"\x1a"</span><span class="keyword">,</span><span class="string">"'"</span><span class="keyword">,</span><span class="string">'"'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$replace</span><span class="keyword">=array(</span><span class="string">"\\\\"</span><span class="keyword">,</span><span class="string">"\\0"</span><span class="keyword">,</span><span class="string">"\\n"</span><span class="keyword">,</span><span class="string">"\\r"</span><span class="keyword">,</span><span class="string">"\Z"</span><span class="keyword">,</span><span class="string">"\'"</span><span class="keyword">,</span><span class="string">'\"'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">str_replace</span><span class="keyword">(</span><span class="default">$search</span><span class="keyword">,</span><span class="default">$replace</span><span class="keyword">,</span><span class="default">$str</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="97933""></a>
  <div class="note">
   <strong class="user">manixrock -~- gmail ~-~ com</strong>
   <a href="#97933" class="date">17-May-2010 01:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I've come up with an easy way to more easily escape things in an sql query. The simpler things are, the lower the chance that you'll forget to escape something. I use a helper class:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">MysqlStringEscaper<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__get</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">mysql_real_escape_string</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">$str </span><span class="keyword">= new </span><span class="default">MysqlStringEscaper</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
then whenever I run a query I can simply do:<br />
<br />
<span class="default">&lt;?php<br />
mysql_query</span><span class="keyword">(</span><span class="string">"SELECT * FROM users WHERE name LIKE '</span><span class="keyword">{</span><span class="default">$str</span><span class="keyword">-&gt;</span><span class="default">$name</span><span class="keyword">}</span><span class="string">' LIMIT 10"</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
This way it's easy to see what the variable is escaped as (other instances like $int or $list could be implemented), it's inline and it only changes the variable when it's inserted into the query.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="96405""></a>
  <div class="note">
   <strong class="user">gustavo639 at gmail dot com</strong>
   <a href="#96405" class="date">25-Feb-2010 04:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I use:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">public static function </span><span class="default">escaparParametros</span><span class="keyword">(){
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$numParametros </span><span class="keyword">= </span><span class="default">func_num_args</span><span class="keyword">();
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$parametros </span><span class="keyword">= </span><span class="default">func_get_args</span><span class="keyword">();
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$numParametros</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$parametros</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] = </span><span class="default">mysql_real_escape_string</span><span class="keyword">(</span><span class="default">$parametros</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$parametros</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="96391""></a>
  <div class="note">
   <strong class="user">root at aeze dot ru</strong>
   <a href="#96391" class="date">24-Feb-2010 06:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here my simple but very effective function for safe mysql queries.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="comment">/**
<br />
* USAGE: mysql_safe( string $query [, array $params ] )
<br />
* $query - SQL query WITHOUT any user-entered parameters. Replace parameters with "?"
<br />
*&nbsp; &nbsp;&nbsp; e.g. $query = "SELECT date from history WHERE login = ?"
<br />
* $params - array of parameters
<br />
*
<br />
* Example:
<br />
*&nbsp; &nbsp; mysql_safe( "SELECT secret FROM db WHERE login = ?", array($login) );&nbsp; &nbsp; # one parameter
<br />
*&nbsp; &nbsp; mysql_safe( "SELECT secret FROM db WHERE login = ? AND password = ?", array($login, $password) );&nbsp; &nbsp; # multiple parameters
<br />
* That will result safe query to MySQL with escaped $login and $password.
<br />
**/
<br />
</span><span class="keyword">function </span><span class="default">mysql_safe</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">,</span><span class="default">$params</span><span class="keyword">=</span><span class="default">false</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$params</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$params </span><span class="keyword">as &amp;</span><span class="default">$v</span><span class="keyword">) { </span><span class="default">$v </span><span class="keyword">= </span><span class="default">mysql_real_escape_string</span><span class="keyword">(</span><span class="default">$v</span><span class="keyword">); }&nbsp; &nbsp; </span><span class="comment"># Escaping parameters
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; # str_replace - replacing ? -&gt; %s. %s is ugly in raw sql query
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; # vsprintf - replacing all %s to parameters
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$sql_query </span><span class="keyword">= </span><span class="default">vsprintf</span><span class="keyword">( </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"?"</span><span class="keyword">,</span><span class="string">"'%s'"</span><span class="keyword">,</span><span class="default">$query</span><span class="keyword">), </span><span class="default">$params </span><span class="keyword">);&nbsp; &nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$sql_query </span><span class="keyword">= </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="default">$sql_query</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment"># Perfoming escaped query
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">} else {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$sql_query </span><span class="keyword">= </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment"># If no params...
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">}
<br />

<br />
&nbsp;&nbsp;&nbsp; return (</span><span class="default">$sql_query</span><span class="keyword">);
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="95915""></a>
  <div class="note">
   <strong class="user">presto dot dk at gmail dot com</strong>
   <a href="#95915" class="date">28-Jan-2010 04:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to make sure that the ID you're using to do a query is a number, use sprint() of (int) or intval(), but don't use mysql_real_escape_string.<br />
<br />
There is no difference between ISO-8859-1's number 10 and UTF-8's number 10.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="95009""></a>
  <div class="note">
   <strong class="user">strata_ranger at hotmail dot com</strong>
   <a href="#95009" class="date">08-Dec-2009 08:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There's an interesting quirk in the example #2 about SQL injection:&nbsp; AND takes priority over OR, so the injected query actually executes as WHERE (user='aidan' AND password='') OR ''='', so instead of returning a database record corresponding to an arbitrary username (in this case 'aidan'), it would actually return ALL database records.&nbsp; In no particular order.&nbsp; So an attacker might be able to log in as any account, but not necessarily with any control over which account it is.<br />
<br />
Of course a potential attacker could simply modify their parameters to target specific users of interest:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">// E.g. attacker's values<br />
</span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'username'</span><span class="keyword">] = </span><span class="string">''</span><span class="keyword">;<br />
</span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'password'</span><span class="keyword">] = </span><span class="string">"' OR user = 'administrator' AND '' = '"</span><span class="keyword">;<br />
<br />
</span><span class="comment">// Malformed query<br />
</span><span class="default">$query </span><span class="keyword">= </span><span class="string">"SELECT * FROM users WHERE user='</span><span class="default">$_POST</span><span class="keyword">[</span><span class="default">username</span><span class="keyword">]</span><span class="string">' AND password='</span><span class="default">$_POST</span><span class="keyword">[</span><span class="default">password</span><span class="keyword">]</span><span class="string">'"</span><span class="keyword">;<br />
<br />
echo </span><span class="default">$query</span><span class="keyword">;<br />
<br />
</span><span class="comment">// The query sent to MySQL would read:<br />
// SELECT * FROM users WHERE user='' AND password='' OR user='administrator' AND ''='';<br />
// which would allow anyone to gain access to the account named 'administrator'<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92649""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#92649" class="date">02-Aug-2009 12:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I use the following code in my database connection include file (which is of course called at the start of every page that needs to do some SQL)...
<br />
Therefore, all POST and GET vars are automatically escaped before being used anywhere in SQL statements.
<br />

<br />
<span class="default">&lt;?php
<br />
&nbsp; </span><span class="comment">//This stops SQL Injection in POST vars
<br />
&nbsp; </span><span class="keyword">foreach (</span><span class="default">$_POST </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$_POST</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">] = </span><span class="default">mysql_real_escape_string</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">);
<br />
&nbsp; }
<br />

<br />
&nbsp; </span><span class="comment">//This stops SQL Injection in GET vars
<br />
&nbsp; </span><span class="keyword">foreach (</span><span class="default">$_GET </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$_GET</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">] = </span><span class="default">mysql_real_escape_string</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">);
<br />
&nbsp; }
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92493""></a>
  <div class="note">
   <strong class="user">plgs at ozemail dot com dot au</strong>
   <a href="#92493" class="date">27-Jul-2009 10:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Don't forget that if you're using Mysqli (ie, the "improved" Mysql extension) then you need to use the corresponding mysqli function mysqli_real_escape_string().&nbsp; The parameter order is also different.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92184""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#92184" class="date">13-Jul-2009 05:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It is because you swapped $key and $item:<br />
<br />
Just change this:<br />
<span class="default">&lt;?php<br />
&nbsp; </span><span class="keyword">function </span><span class="default">mysql_safe </span><span class="keyword">( </span><span class="default">$item</span><span class="keyword">, </span><span class="default">$key</span><span class="keyword">, </span><span class="default">$type </span><span class="keyword">)<br />
&nbsp; </span><span class="default">?&gt;<br />
</span><br />
To: <br />
<br />
<span class="default">&lt;?php <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">mysql_safe </span><span class="keyword">( </span><span class="default">$key</span><span class="keyword">, </span><span class="default">$item</span><span class="keyword">, </span><span class="default">$type </span><span class="keyword">)<br />
</span><span class="default">?&gt;<br />
</span><br />
And it will work as expected.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92159""></a>
  <div class="note">
   <strong class="user">isaacs dot brian dot c at gmail dot com</strong>
   <a href="#92159" class="date">12-Jul-2009 08:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I had wanted to see the merits of dynamically and "automatically" applying mysql_real_escape_string() to $_GET and $_POST as arrays rather than manually each time I would type up a query. I used array_walk_recursive() to call my function "mysql_safe" to apply mysql_real_escape_string() to each key of the $_GET and $_POST arrays.
<br />

<br />
My function is part of a class, and it is called each time I connect to the database to perform a query:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">class </span><span class="default">MyClass </span><span class="keyword">{
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; function </span><span class="default">mysql_safe </span><span class="keyword">( </span><span class="default">$key</span><span class="keyword">, </span><span class="default">$item</span><span class="keyword">, </span><span class="default">$type </span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; switch( </span><span class="default">$type </span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'get'</span><span class="keyword">: 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="default">count</span><span class="keyword">( </span><span class="default">$_GET </span><span class="keyword">) &gt; </span><span class="default">0 </span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$_GET</span><span class="keyword">[</span><span class="default">$item</span><span class="keyword">] = </span><span class="default">mysql_real_escape_string</span><span class="keyword">( </span><span class="default">$key </span><span class="keyword">); 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">'post'</span><span class="keyword">: 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="default">count</span><span class="keyword">( </span><span class="default">$_POST </span><span class="keyword">) &gt; </span><span class="default">0 </span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$_POST</span><span class="keyword">[</span><span class="default">$item</span><span class="keyword">] = </span><span class="default">mysql_real_escape_string</span><span class="keyword">( </span><span class="default">$key </span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; function </span><span class="default">safe_get </span><span class="keyword">( )
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">#Flag to only run function once&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if( </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">get_flag </span><span class="keyword">== </span><span class="default">true </span><span class="keyword">) { return </span><span class="default">true</span><span class="keyword">; }
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">array_walk_recursive</span><span class="keyword">( </span><span class="default">$_GET</span><span class="keyword">, array( </span><span class="default">$this</span><span class="keyword">, </span><span class="string">'mysql_safe' </span><span class="keyword">), </span><span class="string">'get' </span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">array_walk_recursive</span><span class="keyword">( </span><span class="default">$_POST</span><span class="keyword">, array( </span><span class="default">$this</span><span class="keyword">, </span><span class="string">'mysql_safe' </span><span class="keyword">), </span><span class="string">'post' </span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">get_flag </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
}
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
However, after using this function, I find that it does indeed work, it also creates new $_GET and $_POST values in which $item and $key are swapped. So I end up with $_GET[$item] = $key, as well as $_GET[$key] = $item. I have not yet determined if this is due to the actual coding itself, or my particular method of implementation.
<br />

<br />
[EDIT BY danbrown AT php DOT net: Contains a bugfix by "Anonymous" on 13-JUL-09 to reorder the user function parameters.]</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91504""></a>
  <div class="note">
   <strong class="user">info at saturnprods dot com</strong>
   <a href="#91504" class="date">13-Jun-2009 09:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I always use this function so I don't have to retype over and over the mysql_real_escape_string function.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">safe</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">){
<br />
&nbsp;&nbsp; return </span><span class="default">mysql_real_escape_string</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">);
<br />
}
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Then, when I am using my code, I simply use:
<br />

<br />
<span class="default">&lt;?php
<br />
$name </span><span class="keyword">= </span><span class="default">safe</span><span class="keyword">(</span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">"name"</span><span class="keyword">]);
<br />
</span><span class="default">$password </span><span class="keyword">= </span><span class="default">safe</span><span class="keyword">(</span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">"password"</span><span class="keyword">]);
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="89851""></a>
  <div class="note">
   <strong class="user">kendsnyder at gmail dot com</strong>
   <a href="#89851" class="date">25-Mar-2009 10:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">// Here is a simple named binding function for queries that makes SQL more readable:<br />
// $sql = "SELECT * FROM users WHERE user = :user AND password = :password";<br />
// mysql_bind($sql, array('user' =&gt; $user, 'password' =&gt; $password));<br />
// mysql_query($sql);<br />
<br />
</span><span class="keyword">function </span><span class="default">mysql_bind</span><span class="keyword">(&amp;</span><span class="default">$sql</span><span class="keyword">, </span><span class="default">$vals</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$vals </span><span class="keyword">as </span><span class="default">$name </span><span class="keyword">=&gt; </span><span class="default">$val</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$sql </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">":</span><span class="default">$name</span><span class="string">"</span><span class="keyword">, </span><span class="string">"'" </span><span class="keyword">. </span><span class="default">mysql_real_escape_string</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">) . </span><span class="string">"'"</span><span class="keyword">, </span><span class="default">$sql</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82015""></a>
  <div class="note">
   <strong class="user">Bastiaan Welmers</strong>
   <a href="#82015" class="date">24-Mar-2008 08:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This function won't help you when inserting binary data, to me it will get mallformed into the database. Probably UTF-8 combinations will be translated by this function or somewhere else when inserting data when running mysql in UTF-8 mode.<br />
<br />
A better way to insert binary data is to transfer it to hexadecimal notation like this example:<br />
<br />
<span class="default">&lt;?php<br />
$string </span><span class="keyword">= </span><span class="default">$_REQUEST</span><span class="keyword">[</span><span class="string">'string'</span><span class="keyword">];<br />
</span><span class="default">$binary </span><span class="keyword">= </span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="default">$_FILE</span><span class="keyword">[</span><span class="string">'file'</span><span class="keyword">][</span><span class="string">'tmp_name'</span><span class="keyword">]);<br />
<br />
</span><span class="default">$string </span><span class="keyword">= </span><span class="default">mysql_real_escape_string</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">);<br />
</span><span class="default">$binary_hex </span><span class="keyword">= </span><span class="default">bin2hex</span><span class="keyword">(</span><span class="default">$binary</span><span class="keyword">);<br />
<br />
</span><span class="default">$query </span><span class="keyword">= </span><span class="string">"INSERT INTO `table` (`key`, `string`, `binary`, `other`) VALUES (NULL, '</span><span class="default">$string</span><span class="string">', 0x</span><span class="default">$binary_hex</span><span class="string">, '</span><span class="default">$other</span><span class="string">')"</span><span class="keyword">;<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81530""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#81530" class="date">03-Mar-2008 07:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
My escape function:
<br />

<br />
Automatically adds quotes (unless $quotes is false), but only for strings. Null values are converted to mysql keyword "null", booleans are converted to 1 or 0, and numbers are left alone. Also can escape a single variable or recursively escape an array of unlimited depth.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">db_escape</span><span class="keyword">(</span><span class="default">$values</span><span class="keyword">, </span><span class="default">$quotes </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$values</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$values </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$values</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">] = </span><span class="default">db_escape</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">, </span><span class="default">$quotes</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; else if (</span><span class="default">$values </span><span class="keyword">=== </span><span class="default">null</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$values </span><span class="keyword">= </span><span class="string">'NULL'</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; else if (</span><span class="default">is_bool</span><span class="keyword">(</span><span class="default">$values</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$values </span><span class="keyword">= </span><span class="default">$values </span><span class="keyword">? </span><span class="default">1 </span><span class="keyword">: </span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; else if (!</span><span class="default">is_numeric</span><span class="keyword">(</span><span class="default">$values</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$values </span><span class="keyword">= </span><span class="default">mysql_real_escape_string</span><span class="keyword">(</span><span class="default">$values</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$quotes</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$values </span><span class="keyword">= </span><span class="string">'"' </span><span class="keyword">. </span><span class="default">$values </span><span class="keyword">. </span><span class="string">'"'</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$values</span><span class="keyword">;
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="80053""></a>
  <div class="note">
   <strong class="user">matthijs at yourmediafactory dot com</strong>
   <a href="#80053" class="date">27-Dec-2007 10:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In response to Michael D - DigitalGemstones.com: <br />
<br />
Check the example again: sprintf(%d) already does the int conversion for you, so it's both perfectly save as well as more elegant than manually casting.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77388""></a>
  <div class="note">
   <strong class="user">user at NOSPAM dot example dot com</strong>
   <a href="#77388" class="date">28-Aug-2007 02:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
if you're doing a mysql wildcard query with
<br />
LIKE, GRANT, or REVOKE
<br />
you may use addcslashes to escape the string:
<br />

<br />
<span class="default">&lt;?php
<br />
$param </span><span class="keyword">= </span><span class="default">mysql_real_escape_string</span><span class="keyword">(</span><span class="default">$param</span><span class="keyword">);
<br />
</span><span class="default">$param </span><span class="keyword">= </span><span class="default">addcslashes</span><span class="keyword">(</span><span class="default">$param</span><span class="keyword">, </span><span class="string">'%_'</span><span class="keyword">);
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69452""></a>
  <div class="note">
   <strong class="user">brian dot folts at gmail dot com</strong>
   <a href="#69452" class="date">06-Sep-2006 06:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
mysql_real_escape_string is a bit annoying when you need to do it over an array.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">mysql_real_escape_array</span><span class="keyword">(</span><span class="default">$t</span><span class="keyword">){
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">array_map</span><span class="keyword">(</span><span class="string">"mysql_real_escape_string"</span><span class="keyword">,</span><span class="default">$t</span><span class="keyword">);
<br />
}
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
this one just mysql_real_escape's the whole array.
<br />

<br />
ex) <span class="default">&lt;?php $_POST</span><span class="keyword">=</span><span class="default">mysql_real_escape_array</span><span class="keyword">(</span><span class="default">$_POST</span><span class="keyword">); </span><span class="default">?&gt;
<br />
</span>
<br />
and then you dont have to worry about forgetting to do this.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68221""></a>
  <div class="note">
   <strong class="user">kael dot shipman at DONTSPAMIT! dot gmail dot com</strong>
   <a href="#68221" class="date">18-Jul-2006 10:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It seems to me that you could avoid many hassels by loading valid database values into an array at the beginning of the script, then instead of using user input to query the database directly, use it to query the array you've created. For example:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">//you still have to query safely, so always use cleanup functions like eric256's<br />
</span><span class="default">$categories </span><span class="keyword">= </span><span class="default">sql_query</span><span class="keyword">(</span><span class="string">"select catName from categories where pageID = ?"</span><span class="keyword">,</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'pageID'</span><span class="keyword">]);<br />
while (</span><span class="default">$cts </span><span class="keyword">= @</span><span class="default">mysql_fetch_row</span><span class="keyword">(</span><span class="default">$categories</span><span class="keyword">)) {<br />
&nbsp;</span><span class="comment">//making $cts both the name and the value of the array variable makes it easier to check for in the future.<br />
&nbsp;//obviously, this naming system wouldn't work for a multidimensional array<br />
&nbsp;</span><span class="default">$cat_ar</span><span class="keyword">[</span><span class="default">$cts</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]] = </span><span class="default">$cts</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];<br />
}<br />
...<br />
<br />
</span><span class="comment">//user selects sorting criteria<br />
//this would be from a query string like '?cats[]=cha&amp;cats[]=fah&amp;cats[]=lah&amp;cats[]=badValue...', etc.<br />
</span><span class="default">$cats </span><span class="keyword">= </span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'cats'</span><span class="keyword">];<br />
<br />
</span><span class="comment">//verify that values exist in database before building sorting query<br />
</span><span class="keyword">foreach(</span><span class="default">$cats </span><span class="keyword">as </span><span class="default">$c</span><span class="keyword">) {<br />
&nbsp;if (</span><span class="default">$cat_ar</span><span class="keyword">[</span><span class="default">$c</span><span class="keyword">]) { </span><span class="comment">//instead of in_array(); maybe I'm just lazy... (see above note)<br />
&nbsp; </span><span class="default">$cats1</span><span class="keyword">[] = </span><span class="string">"'"</span><span class="keyword">.</span><span class="default">mysql_real_escape_string</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">).</span><span class="string">"'"</span><span class="keyword">;<br />
&nbsp;}<br />
}<br />
</span><span class="default">$cats </span><span class="keyword">= </span><span class="default">$cats1</span><span class="keyword">;<br />
</span><span class="comment">//$cats now contains the filtered and escaped values of the query string<br />
<br />
</span><span class="default">$cat_query </span><span class="keyword">= </span><span class="string">'&amp;&amp; (category_name = \''</span><span class="keyword">.</span><span class="default">implode</span><span class="keyword">(</span><span class="string">' || category_name = \''</span><span class="keyword">,</span><span class="default">$cats</span><span class="keyword">).</span><span class="string">'\')'</span><span class="keyword">;<br />
</span><span class="comment">//build a sql query insert<br />
//$cat_query is now "&amp;&amp; (category_name = 'cha' || category_name = 'fah' || category_name = 'lah')" - badValue has been removed<br />
//since all values have already been verified and escaped, you can simply use them in a query<br />
//however, since $pageID hasn't been cleaned for this query, you still have to use your cleaning function<br />
</span><span class="default">$items </span><span class="keyword">= </span><span class="default">sql_query</span><span class="keyword">(</span><span class="string">"SELECT * FROM items i, categories c WHERE i.catID = c.catID &amp;&amp; pageID = ? </span><span class="default">$cat_query</span><span class="string">"</span><span class="keyword">, </span><span class="default">$pageID</span><span class="keyword">);</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="66836""></a>
  <div class="note">
   <strong class="user">nicolas</strong>
   <a href="#66836" class="date">30-May-2006 10:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that mysql_real_escape_string doesn't prepend backslashes to \x00, \n, \r, and and \x1a as mentionned in the documentation, but actually replaces the character with a MySQL acceptable representation for queries (e.g. \n is replaced with the '\n' litteral). (\, ', and " are escaped as documented) This doesn't change how you should use this function, but I think it's good to know.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
