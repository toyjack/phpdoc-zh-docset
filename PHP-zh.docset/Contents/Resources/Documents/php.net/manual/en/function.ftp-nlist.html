<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>返回给定目录的文件列表</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.ftp-nb-put.html">? ftp_nb_put</a></li>
      <li style="float: right;"><a href="function.ftp-pasv.html">ftp_pasv ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.ftp.html">FTP 函数</a></li>
    <li>返回给定目录的文件列表</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.ftp-nlist" class="refentry">
   <div class="refnamediv">
    <h1 class="refname">ftp_nlist</h1>
    <p class="verinfo">(PHP 4, PHP 5)</p><p class="refpurpose"><span class="refname">ftp_nlist</span> &mdash; <span class="dc-title">返回给定目录的文件列表</span></p>

   </div>
   <div class="refsect1 description" id="refsect1-function.ftp-nlist-description">
    <h3 class="title">说明</h3>
    <div class="methodsynopsis dc-description">
     <span class="type">array</span> <span class="methodname"><strong>ftp_nlist</strong></span>
      ( <span class="methodparam"><span class="type">resource</span> <code class="parameter">$ftp_stream</code></span>
     , <span class="methodparam"><span class="type">string</span> <code class="parameter">$directory</code></span>
     )</div>

   </div>

   <div class="refsect1 parameters" id="refsect1-function.ftp-nlist-parameters">
   <h3 class="title">参数</h3>
   <p class="para">
    <dl>

     
      <dt>
<code class="parameter">ftp_stream</code></dt>

      <dd>

       <p class="para">
        FTP 连接资源。
       </p>
      </dd>

     
     
      <dt>
<code class="parameter">directory</code></dt>

      <dd>

       <p class="para">
        指定要列表的目录。本参数接受带参数的形式，例如：
        ftp_nlist($conn_id, &quot;-la /you/dir&quot;);
        注意此参数不对传入值做处理，在目录或者文件名包括空格或特殊的情况下，可能会存在问题。
       </p>
      </dd>

     
    </dl>

   </p>
  </div>

  <div class="refsect1 returnvalues" id="refsect1-function.ftp-nlist-returnvalues">
  <h3 class="title">返回值</h3>
    <p class="para">
     如果成功则返回给定目录下的文件名组成的数组，否则返回 <strong><code>FALSE</code></strong>。
    </p>
  </div>

  <div class="refsect1 examples" id="refsect1-function.ftp-nlist-examples">
   <h3 class="title">范例</h3>
   <p class="para">
    <div class="example" id="example-4305">
     <p><strong>Example #1 <span class="function"><strong>ftp_nlist()</strong></span> 例子</strong></p>
     <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br /></span><span style="color: #FF8000">//&nbsp;set&nbsp;up&nbsp;basic&nbsp;connection<br /></span><span style="color: #0000BB">$conn_id&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">ftp_connect</span><span style="color: #007700">(</span><span style="color: #0000BB">$ftp_server</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$login_result&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">ftp_login</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn_id</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$ftp_user_name</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$ftp_user_pass</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;check&nbsp;connection<br /></span><span style="color: #007700">if&nbsp;((!</span><span style="color: #0000BB">$conn_id</span><span style="color: #007700">)&nbsp;||&nbsp;(!</span><span style="color: #0000BB">$login_result</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;die(</span><span style="color: #DD0000">"FTP&nbsp;connection&nbsp;has&nbsp;failed&nbsp;!"</span><span style="color: #007700">);<br />}<br />&nbsp;<br /></span><span style="color: #FF8000">//&nbsp;get&nbsp;contents&nbsp;of&nbsp;the&nbsp;root&nbsp;directory<br /></span><span style="color: #0000BB">$contents&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">ftp_nlist</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn_id</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"/"</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;output&nbsp;$contents<br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$contents</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
     </div>

     <div class="example-contents"><p>以上例程的输出类似于：</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
array(3) {
  [0]=&gt;
  string(11) &quot;public_html&quot;
  [1]=&gt;
  string(10) &quot;public_ftp&quot;
  [2]=&gt;
  string(3) &quot;www&quot;
</pre></div>
    </div>
   </div>
  </p>
 </div>

 <div class="refsect1 seealso" id="refsect1-function.ftp-nlist-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.ftp-rawlist.html" class="function" rel="rdfs-seeAlso">ftp_rawlist()</a> - 返回指定目录下文件的详细列表</span></li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="108501""></a>
  <div class="note">
   <strong class="user">Jacob Slomp</strong>
   <a href="#108501" class="date">02-May-2012 12:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hi,<br />
<br />
I wrote this function to get the file list, I tested it only with php5 with linux ftp. And works fine for me.<br />
<br />
it will return an array with the name, type (file/folder), owner, owner_id and rights.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">ftp_get_filelist</span><span class="keyword">(</span><span class="default">$con</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$files </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$contents </span><span class="keyword">= </span><span class="default">ftp_rawlist </span><span class="keyword">(</span><span class="default">$con</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$a </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">count</span><span class="keyword">(</span><span class="default">$contents</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$contents </span><span class="keyword">as </span><span class="default">$line</span><span class="keyword">){<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"#([drwx\-]+)([\s]+)([0-9]+)([\s]+)([0-9]+)([\s]+)([a-zA-Z0-9\.]+)([\s]+)([0-9]+)([\s]+)([a-zA-Z]+)([\s ]+)([0-9]+)([\s]+)([0-9]+):([0-9]+)([\s]+)([a-zA-Z0-9\.\-\_ ]+)#si"</span><span class="keyword">, </span><span class="default">$line</span><span class="keyword">, </span><span class="default">$out</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$out</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">] != </span><span class="default">1 </span><span class="keyword">&amp;&amp; (</span><span class="default">$out</span><span class="keyword">[</span><span class="default">18</span><span class="keyword">] == </span><span class="string">"." </span><span class="keyword">|| </span><span class="default">$out</span><span class="keyword">[</span><span class="default">18</span><span class="keyword">] == </span><span class="string">".."</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// do nothing<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">} else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$a</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$files</span><span class="keyword">[</span><span class="default">$a</span><span class="keyword">][</span><span class="string">'rights'</span><span class="keyword">] = </span><span class="default">$out</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$files</span><span class="keyword">[</span><span class="default">$a</span><span class="keyword">][</span><span class="string">'type'</span><span class="keyword">] = </span><span class="default">$out</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">] == </span><span class="default">1 </span><span class="keyword">? </span><span class="string">"file"</span><span class="keyword">:</span><span class="string">"folder"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$files</span><span class="keyword">[</span><span class="default">$a</span><span class="keyword">][</span><span class="string">'owner_id'</span><span class="keyword">] = </span><span class="default">$out</span><span class="keyword">[</span><span class="default">5</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$files</span><span class="keyword">[</span><span class="default">$a</span><span class="keyword">][</span><span class="string">'owner'</span><span class="keyword">] = </span><span class="default">$out</span><span class="keyword">[</span><span class="default">7</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$files</span><span class="keyword">[</span><span class="default">$a</span><span class="keyword">][</span><span class="string">'date_modified'</span><span class="keyword">] = </span><span class="default">$out</span><span class="keyword">[</span><span class="default">11</span><span class="keyword">].</span><span class="string">" "</span><span class="keyword">.</span><span class="default">$out</span><span class="keyword">[</span><span class="default">13</span><span class="keyword">] . </span><span class="string">" "</span><span class="keyword">.</span><span class="default">$out</span><span class="keyword">[</span><span class="default">13</span><span class="keyword">].</span><span class="string">":"</span><span class="keyword">.</span><span class="default">$out</span><span class="keyword">[</span><span class="default">16</span><span class="keyword">].</span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$files</span><span class="keyword">[</span><span class="default">$a</span><span class="keyword">][</span><span class="string">'name'</span><span class="keyword">] = </span><span class="default">$out</span><span class="keyword">[</span><span class="default">18</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$files</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;<br />
</span><br />
Greets,<br />
<br />
Jacob</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102969""></a>
  <div class="note">
   <strong class="user">vijay dot mahrra at fronter dot com</strong>
   <a href="#102969" class="date">17-Mar-2011 11:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
We needed to get a list of all files in all subdirectories and couldn't see a method to do this so we wrote our own:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="comment">/**
<br />
&nbsp;* ftpRecursiveFileListing
<br />
&nbsp;*
<br />
&nbsp;* Get a recursive listing of all files in all subfolders given an ftp handle and path
<br />
&nbsp;*
<br />
&nbsp;* @param resource $ftpConnection&nbsp; the ftp connection handle
<br />
&nbsp;* @param string $path&nbsp; the folder/directory path
<br />
&nbsp;* @return array $allFiles the list of files in the format: directory =&gt; $filename
<br />
&nbsp;* @author Niklas Berglund
<br />
&nbsp;* @author Vijay Mahrra
<br />
&nbsp;*/
<br />
</span><span class="keyword">function </span><span class="default">ftpRecursiveFileListing</span><span class="keyword">(</span><span class="default">$ftpConnection</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; static </span><span class="default">$allFiles </span><span class="keyword">= array();
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$contents </span><span class="keyword">= </span><span class="default">ftp_nlist</span><span class="keyword">(</span><span class="default">$ftpConnection</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp;&nbsp; foreach(</span><span class="default">$contents </span><span class="keyword">as </span><span class="default">$currentFile</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// assuming its a folder if there's no dot in the name
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$currentFile</span><span class="keyword">, </span><span class="string">'.'</span><span class="keyword">) === </span><span class="default">false</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ftpRecursiveFileListing</span><span class="keyword">(</span><span class="default">$ftpConnection</span><span class="keyword">, </span><span class="default">$currentFile</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$allFiles</span><span class="keyword">[</span><span class="default">$path</span><span class="keyword">][] = </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$currentFile</span><span class="keyword">, </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">) + </span><span class="default">1</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$allFiles</span><span class="keyword">;
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="101135""></a>
  <div class="note">
   <strong class="user">zgardner at allofe dot com</strong>
   <a href="#101135" class="date">29-Nov-2010 02:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
While running WAMP (Vista, Apache 2.21, MySQL 5.1.36, PHP 5.3) and recursively downloading files from a LAMP FTP server (Ubuntu 8.04, Apache 2.2.8, MySQL 5.1.51a, PHP 5.2.4, VSFPTD), I would find that my script stops downloading files after a while. I traced it to the call to ftp_nlist halting the script.<br />
<br />
To solve this, I did a ftp_pasv($ftp, true). There's nothing in the VSFTPD, Apache, or PHP error logs on either the client or the server. Very strange.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="95371""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#95371" class="date">29-Dec-2009 06:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Some complain that ftp_nlist, always return FALSE. I did experience this behavior myself, until I used ftp_pasv, which is useful if your client is behind a firewall (which most clients are now), then ftp_nlist worked just fine. I don't really know what are all the implications of using ftp_pasv, but if you read or experience that ftp_nlist, ftp_get, ftp_nb_get doesn't work, try adding the following:<br />
<br />
ftp_pasv($conn_id,true);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83021""></a>
  <div class="note">
   <strong class="user">juhakala at gmail dot com</strong>
   <a href="#83021" class="date">07-May-2008 12:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I noticed that this function won't work if working path is different, because $dir keeps value of whole path string. That's why adding basename()-function strips the path and this function will work also sub folders, not only in root folder.<br />
<br />
function ftp_is_dir($dir) {<br />
&nbsp; global $ftp_connect;<br />
&nbsp; if (ftp_chdir($ftp_connect, basename($dir))) {<br />
&nbsp;&nbsp;&nbsp; ftp_chdir($ftp_connect, '..');<br />
&nbsp;&nbsp;&nbsp; return true;<br />
&nbsp; } else {<br />
&nbsp;&nbsp;&nbsp; return false;<br />
&nbsp; }<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="78447""></a>
  <div class="note">
   <strong class="user">webmaster at weltvolk dot de</strong>
   <a href="#78447" class="date">12-Oct-2007 03:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In order to make file/folder separation work on remote servers that do not support ftp_size() it's better to use the function ftp_is_dir() mentioned below:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">//identify directories<br />
<br />
</span><span class="keyword">function </span><span class="default">ftp_is_dir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">) {<br />
&nbsp; global </span><span class="default">$ftp_connect</span><span class="keyword">;<br />
&nbsp; if (</span><span class="default">ftp_chdir</span><span class="keyword">(</span><span class="default">$ftp_connect</span><span class="keyword">, </span><span class="default">$dir</span><span class="keyword">)) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">ftp_chdir</span><span class="keyword">(</span><span class="default">$ftp_connect</span><span class="keyword">, </span><span class="string">'..'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">true</span><span class="keyword">;<br />
&nbsp; } else {<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp; }<br />
}<br />
</span><span class="default">$ftp_nlist </span><span class="keyword">= </span><span class="default">ftp_nlist</span><span class="keyword">(</span><span class="default">$ftp_connect</span><span class="keyword">, </span><span class="string">"."</span><span class="keyword">);<br />
<br />
</span><span class="comment">//alphabetical sorting<br />
<br />
</span><span class="default">sort</span><span class="keyword">(</span><span class="default">$ftp_nlist</span><span class="keyword">);<br />
foreach (</span><span class="default">$ftp_nlist </span><span class="keyword">as </span><span class="default">$v</span><span class="keyword">) {<br />
<br />
</span><span class="comment">//1. ftp_is_dir() is true =&gt; directory<br />
&nbsp; </span><span class="keyword">if (</span><span class="default">ftp_is_dir</span><span class="keyword">(</span><span class="default">$v</span><span class="keyword">)) {<br />
<br />
</span><span class="comment">//output as [ directory ]<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="keyword">echo </span><span class="string">"[ " </span><span class="keyword">. </span><span class="default">$v </span><span class="keyword">. </span><span class="string">" ]&lt;br /&gt;\n"</span><span class="keyword">;<br />
&nbsp; }<br />
}<br />
foreach (</span><span class="default">$ftp_nlist </span><span class="keyword">as </span><span class="default">$v</span><span class="keyword">) {<br />
<br />
</span><span class="comment">//2. ftp_is_dir() is false =&gt; file<br />
&nbsp; </span><span class="keyword">if (!</span><span class="default">ftp_is_dir</span><span class="keyword">(</span><span class="default">$v</span><span class="keyword">)) {<br />
<br />
</span><span class="comment">//output as file<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="keyword">echo </span><span class="string">"" </span><span class="keyword">. </span><span class="default">$v </span><span class="keyword">. </span><span class="string">"&lt;br /&gt;\n"</span><span class="keyword">;<br />
&nbsp; }<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="78280""></a>
  <div class="note">
   <strong class="user">webmaster at weltvolk dot de</strong>
   <a href="#78280" class="date">05-Oct-2007 11:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
How to get the file list in alphabetical order with all directories at the top:<br />
<br />
<span class="default">&lt;?php<br />
$ftp_nlist </span><span class="keyword">= </span><span class="default">ftp_nlist</span><span class="keyword">(</span><span class="default">$ftp_connect</span><span class="keyword">, </span><span class="string">"."</span><span class="keyword">);<br />
<br />
</span><span class="comment">//alphabetical sorting<br />
<br />
</span><span class="default">sort</span><span class="keyword">(</span><span class="default">$ftp_nlist</span><span class="keyword">);<br />
foreach (</span><span class="default">$ftp_nlist </span><span class="keyword">as </span><span class="default">$v</span><span class="keyword">) {<br />
<br />
</span><span class="comment">//1. Size is '-1' =&gt; directory<br />
&nbsp; </span><span class="keyword">if (</span><span class="default">ftp_size</span><span class="keyword">(</span><span class="default">$ftp_connect</span><span class="keyword">, </span><span class="default">$v</span><span class="keyword">) == -</span><span class="default">1</span><span class="keyword">) {<br />
<br />
</span><span class="comment">//output as [ directory ]<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="keyword">echo </span><span class="string">"[ " </span><span class="keyword">. </span><span class="default">$v </span><span class="keyword">. </span><span class="string">" ]&lt;br /&gt;\n"</span><span class="keyword">;<br />
&nbsp; }<br />
}<br />
foreach (</span><span class="default">$ftp_nlist </span><span class="keyword">as </span><span class="default">$v</span><span class="keyword">) {<br />
<br />
</span><span class="comment">//2. Size is not '-1' =&gt; file<br />
&nbsp; </span><span class="keyword">if (!(</span><span class="default">ftp_size</span><span class="keyword">(</span><span class="default">$ftp_connect</span><span class="keyword">, </span><span class="default">$v</span><span class="keyword">) == -</span><span class="default">1</span><span class="keyword">)) {<br />
<br />
</span><span class="comment">//output as file<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="keyword">echo </span><span class="string">"" </span><span class="keyword">. </span><span class="default">$v </span><span class="keyword">. </span><span class="string">"&lt;br /&gt;\n"</span><span class="keyword">;<br />
&nbsp; }<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Result looks like:<br />
<br />
[ a_mydirectory ]<br />
[ b_mydirectory ]<br />
[ c_mydirectory ]<br />
...<br />
a_myfile.htm<br />
b_myfile.css<br />
c_myfile.php<br />
...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77228""></a>
  <div class="note">
   <strong class="user">wim dot dupre at skynet dot be</strong>
   <a href="#77228" class="date">21-Aug-2007 02:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
php 5.2.2 on MAC OS 1.4 (Tiger) seems to defaut to active ftp. to get ftp_nlist functioning, i needed to force ftp to passive.<br />
the default behaviour with PHP 5.2.3 on windows XP seems to be passive ftp.<br />
<br />
greetz,<br />
<br />
wim</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77128""></a>
  <div class="note">
   <strong class="user">ralph at ralphje dot nl</strong>
   <a href="#77128" class="date">16-Aug-2007 12:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you receive an error due some open_basedir restrictions, use the following:<br />
<br />
<span class="default">&lt;?php<br />
putenv</span><span class="keyword">(</span><span class="string">'TMPDIR=/tmp/'</span><span class="keyword">);<br />
</span><span class="default">$filelist </span><span class="keyword">= </span><span class="default">ftp_nlist</span><span class="keyword">(</span><span class="default">$ftp</span><span class="keyword">, </span><span class="string">"./accounts"</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
(if /tmp/ is an allowed directory within open_basedir)<br />
<br />
It took me a while to find this out.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77078""></a>
  <div class="note">
   <strong class="user">AndyM</strong>
   <a href="#77078" class="date">14-Aug-2007 06:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Be careful tom at crysis-online dot com - your suggested method seems to be server dependent. I'm currently trying to talk to a proftpd server and the size returned is -1 for all files it seems.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77007""></a>
  <div class="note">
   <strong class="user">tom at crysis-online dot com</strong>
   <a href="#77007" class="date">10-Aug-2007 01:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This function is way faster than those below for checking if an object is a file or folder.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">is_ftp_dir</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="default">$ftp_connection</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">ftp_size</span><span class="keyword">(</span><span class="default">$ftp_connection</span><span class="keyword">, </span><span class="default">$file</span><span class="keyword">) == </span><span class="string">'-1'</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">true</span><span class="keyword">; </span><span class="comment">// Is directory<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">}else{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">; </span><span class="comment">// Is file<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">}<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76641""></a>
  <div class="note">
   <strong class="user">bintjes at gmail dot com</strong>
   <a href="#76641" class="date">24-Jul-2007 11:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I've made a recursive function to list all files from folders and subfolders using ftp_rawlist() . I used the function below from ari,&nbsp; parse_rawlist() <br />
<br />
function list_all_files($conn_id, $path){<br />
&nbsp;&nbsp;&nbsp; $buff = ftp_rawlist($conn_id, $path);<br />
&nbsp;&nbsp;&nbsp; $res = parse_rawlist( $buff) ;<br />
&nbsp;&nbsp;&nbsp; static $flist = array();<br />
&nbsp;&nbsp;&nbsp; if(count($res)&gt;0){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach($res as $result){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // verify if is dir , if not add to the&nbsp; list of files<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if($result['size']== 0){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // recursively call the function if this file is a folder<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; list_all_files($conn_id, $path.'/'.$result['name']);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // this is a file, add to final list<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $flist[] = $result;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }&nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return $flist;<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73401""></a>
  <div class="note">
   <strong class="user">josh at servebyte dot com</strong>
   <a href="#73401" class="date">21-Feb-2007 07:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Function Keywords: is_file is_dir<br />
<br />
<span class="default">&lt;?php<br />
$ftp_server </span><span class="keyword">= </span><span class="string">'IP OR HOSTNAME HERE'</span><span class="keyword">;<br />
</span><span class="default">$ftp_user_name </span><span class="keyword">= </span><span class="string">'USERNAME'</span><span class="keyword">;<br />
</span><span class="default">$ftp_user_pass </span><span class="keyword">= </span><span class="string">'PASSWORD'</span><span class="keyword">;<br />
</span><span class="comment">// set up basic connection<br />
</span><span class="default">$conn_id </span><span class="keyword">= </span><span class="default">ftp_connect</span><span class="keyword">(</span><span class="default">$ftp_server</span><span class="keyword">);<br />
<br />
</span><span class="comment">// login with username and password<br />
</span><span class="default">$login_result </span><span class="keyword">= </span><span class="default">ftp_login</span><span class="keyword">(</span><span class="default">$conn_id</span><span class="keyword">, </span><span class="default">$ftp_user_name</span><span class="keyword">, </span><span class="default">$ftp_user_pass</span><span class="keyword">);<br />
<br />
function </span><span class="default">ftp_is_dir</span><span class="keyword">(</span><span class="default">$folder</span><span class="keyword">) {<br />
&nbsp;&nbsp; global </span><span class="default">$conn_id</span><span class="keyword">;<br />
&nbsp;&nbsp; if (</span><span class="default">ftp_chdir</span><span class="keyword">(</span><span class="default">$conn_id</span><span class="keyword">, </span><span class="default">$folder</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">ftp_chdir</span><span class="keyword">(</span><span class="default">$conn_id</span><span class="keyword">, </span><span class="string">'..'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; return </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; }<br />
}<br />
<br />
function </span><span class="default">xdir</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">) {<br />
&nbsp;&nbsp; global </span><span class="default">$conn_id</span><span class="keyword">;<br />
&nbsp;&nbsp; </span><span class="default">$contents </span><span class="keyword">= </span><span class="default">ftp_nlist</span><span class="keyword">(</span><span class="default">$conn_id</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">);<br />
&nbsp;&nbsp; foreach(</span><span class="default">$contents </span><span class="keyword">as </span><span class="default">$file</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (</span><span class="default">$file</span><span class="keyword">!=</span><span class="string">'.'</span><span class="keyword">&amp;&amp;</span><span class="default">$file</span><span class="keyword">!=</span><span class="string">'..'</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">ftp_is_dir</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">$file </span><span class="keyword">. </span><span class="string">' is a folder&lt;br&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">$file </span><span class="keyword">. </span><span class="string">' is a file&lt;br&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">xdir</span><span class="keyword">(</span><span class="string">'.'</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
can be looped through... using the function xdir if the file is a folder ;)<br />
Returns a warning upon not being a folder... use error_reporting(0); to resolve this issue.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="72920""></a>
  <div class="note">
   <strong class="user">nigel (at) amanwithapencil (dot) com</strong>
   <a href="#72920" class="date">04-Feb-2007 01:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Actually, this works better (suppresses the error when ftp_chdir() fails)!:<br />
<br />
if (!@ftp_chdir($ftp_conn, $userfolder))<br />
{<br />
&nbsp;&nbsp;&nbsp; ftp_mkdir($ftp_conn, $userfolder);<br />
&nbsp;&nbsp;&nbsp; ftp_chdir($ftp_conn, $userfolder);<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="72875""></a>
  <div class="note">
   <strong class="user">nigel (at) amanwithapencil (dot) com</strong>
   <a href="#72875" class="date">03-Feb-2007 05:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Further to kip's post, this works:<br />
<br />
if (!ftp_chdir($conn, $folder))<br />
{<br />
&nbsp;&nbsp;&nbsp; ftp_mkdir($conn, $folder);<br />
&nbsp;&nbsp;&nbsp; ftp_chdir($conn, $folder);<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71696""></a>
  <div class="note">
   <strong class="user">kip at friendchip dot com</strong>
   <a href="#71696" class="date">12-Dec-2006 01:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you're just after an ftp version of is_dir you can see if ftp_chdir returns true or false.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="70166""></a>
  <div class="note">
   <strong class="user">fx dot menard at pleasenospam dot free dot fr</strong>
   <a href="#70166" class="date">05-Oct-2006 11:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A derived use of ftp_nlist function: determine if a given path exists and is a directory or a plain file (this is not easy with basic ftp functions). This code doesn't issue any warning or error. It makes use of ls option -d for efficiency, and -F to append a slash if the retrieved path is a directory.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// returns information on a given ftp path<br />
// 0 if path does not exist<br />
// 1 if path is a file<br />
// 2 if path is a directory<br />
</span><span class="keyword">function </span><span class="default">ftp_pathtype</span><span class="keyword">( </span><span class="default">$conn</span><span class="keyword">, </span><span class="default">$path </span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$res </span><span class="keyword">= </span><span class="default">ftp_nlist</span><span class="keyword">( </span><span class="default">$conn</span><span class="keyword">, </span><span class="string">"-dF " </span><span class="keyword">. </span><span class="default">$path </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if ( isset( </span><span class="default">$res</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] ) and<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">strlen</span><span class="keyword">( </span><span class="default">$res</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] ) )<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( </span><span class="default">$res</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">][ </span><span class="default">strlen</span><span class="keyword">( </span><span class="default">$res</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] )-</span><span class="default">1 </span><span class="keyword">] === </span><span class="string">"/" </span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// a directory<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">2</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; } else<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">0</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69140""></a>
  <div class="note">
   <strong class="user">artiom1st at yahoo dot com</strong>
   <a href="#69140" class="date">24-Aug-2006 04:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Sometimes, you won't be able to get folder content because of NAT or Firewall issues on your server. As a result you need to put ftp connection into a passive mode:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">// set up basic connection<br />
</span><span class="default">$conn_id </span><span class="keyword">= </span><span class="default">ftp_connect</span><span class="keyword">(</span><span class="default">$ftp_server</span><span class="keyword">);<br />
<br />
</span><span class="comment">// login with username and password<br />
</span><span class="default">$login_result </span><span class="keyword">= </span><span class="default">ftp_login</span><span class="keyword">(</span><span class="default">$conn_id</span><span class="keyword">, </span><span class="default">$ftp_user_name</span><span class="keyword">, </span><span class="default">$ftp_user_pass</span><span class="keyword">);<br />
<br />
</span><span class="comment">// enabling passive mode<br />
</span><span class="default">ftp_pasv</span><span class="keyword">( </span><span class="default">$conn_id</span><span class="keyword">, </span><span class="default">true </span><span class="keyword">);<br />
<br />
</span><span class="comment">// get contents of the current directory<br />
</span><span class="default">$contents </span><span class="keyword">= </span><span class="default">ftp_nlist</span><span class="keyword">(</span><span class="default">$conn_id</span><span class="keyword">, </span><span class="string">"."</span><span class="keyword">);<br />
<br />
</span><span class="comment">// output $contents<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$contents</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69107""></a>
  <div class="note">
   <strong class="user">sksafarath at impelsys dot com</strong>
   <a href="#69107" class="date">23-Aug-2006 01:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If we are giving second parameter as full directory&nbsp; path then it wil return the list of files with full path, If we want to list only files you can do as following code<br />
// set up basic connection<br />
$conn_id = ftp_connect($ftp_server);<br />
<br />
// login with username and password<br />
$login_result = ftp_login($conn_id, $ftp_user_name, $ftp_user_pass);<br />
//if u want to display the files from /home/test/<br />
//change directory point to /home/test using<br />
ftp_chdir($conn_id, "test");<br />
//then pass second parameter as null which will give the list of files.<br />
// get contents of the current directory<br />
$contents = ftp_nlist($conn_id, "");<br />
<br />
Note: This is working for me in PHP5</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68751""></a>
  <div class="note">
   <strong class="user">robtherat at gmx dot de</strong>
   <a href="#68751" class="date">09-Aug-2006 03:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The function from nekrostar at gmx dot net does not work for me, so I've tryed to do it my way. For checking if a found file is a directory or not I use the ftp_size function.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">ftplistdir</span><span class="keyword">(</span><span class="default">$conn_id</span><span class="keyword">, </span><span class="default">$dir</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fold_no </span><span class="keyword">= array(</span><span class="string">"."</span><span class="keyword">, </span><span class="string">".."</span><span class="keyword">, </span><span class="string">"cgi-data"</span><span class="keyword">, </span><span class="string">"comp"</span><span class="keyword">, </span><span class="string">"zuern"</span><span class="keyword">, </span><span class="string">"counter"</span><span class="keyword">); <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$list </span><span class="keyword">= </span><span class="default">ftp_nlist</span><span class="keyword">( </span><span class="default">$conn_id</span><span class="keyword">, </span><span class="default">$dir </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; foreach(</span><span class="default">$list </span><span class="keyword">as </span><span class="default">$file</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">ftp_size</span><span class="keyword">(</span><span class="default">$conn_id</span><span class="keyword">, </span><span class="default">$dir </span><span class="keyword">.</span><span class="string">"/"</span><span class="keyword">.</span><span class="default">$file</span><span class="keyword">)== -</span><span class="default">1</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">in_array</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="default">$fold_no</span><span class="keyword">)) { <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; print </span><span class="default">$file </span><span class="keyword">.</span><span class="string">" Ueberspringe ausgeschlossenes Verzeichnis.&lt;br&gt;"</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else { <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$geslist</span><span class="keyword">[]= </span><span class="default">$dir </span><span class="keyword">.</span><span class="string">"/"</span><span class="keyword">. </span><span class="default">$file</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$temp</span><span class="keyword">=</span><span class="default">ftplistdir</span><span class="keyword">(</span><span class="default">$conn_id</span><span class="keyword">, </span><span class="default">$dir </span><span class="keyword">.</span><span class="string">"/"</span><span class="keyword">. </span><span class="default">$file</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$geslist</span><span class="keyword">=</span><span class="default">array_merge</span><span class="keyword">(</span><span class="default">$geslist</span><span class="keyword">, </span><span class="default">$temp</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }else{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$geslist</span><span class="keyword">[]= </span><span class="default">$dir </span><span class="keyword">.</span><span class="string">"/"</span><span class="keyword">. </span><span class="default">$file</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$geslist</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span>I hope it's usefull for anyone<br />
Robert</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68574""></a>
  <div class="note">
   <strong class="user">nekrostar at gmx dot net</strong>
   <a href="#68574" class="date">02-Aug-2006 01:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This function returns an array with the directory path and all files and subdirs which are in this<br />
<br />
&nbsp;&nbsp;&nbsp; function ftp_searchdir($conn_id, $dir)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( !@ftp_is_dir( $conn_id, $dir ) ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; die( 'No such directory on the ftp-server' );<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( strrchr( $dir, '/' ) != '/' ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $dir = $dir.'/';<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $dirlist[0] = $dir;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $list = ftp_nlist( $conn_id, $dir );<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach( $list as $path ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $path = './'.$path;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if( $path != $dir.'.' &amp;&amp; $path != $dir.'..') {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if( ftp_is_dir( $conn_id, $path ) ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $temp = ftp_searchdir( $conn_id, ($path), 1 );<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $dirlist = array_merge( $dirlist, $temp );<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $dirlist[] = $path;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; ftp_chdir( $conn_id, '/../' );<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return $dirlist;<br />
<br />
&nbsp;&nbsp;&nbsp; }<br />
----------------------------------------------------------------------<br />
&nbsp;&nbsp;&nbsp; //Looks if a directory ($dir) is isset<br />
&nbsp;&nbsp;&nbsp; //returns true or false<br />
<br />
&nbsp;&nbsp;&nbsp; function ftp_is_dir( $conn_id,&nbsp; $dir )<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( @ftp_chdir( $conn_id, $dir ) ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ftp_chdir( $conn_id, '/../' );<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return true;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return false;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="66094""></a>
  <div class="note">
   <strong class="user">mail at martinauer dot net</strong>
   <a href="#66094" class="date">14-May-2006 07:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Beware:<br />
The array will contain complete paths, not just filenames. At least in PHP 4.3.11 when I tried <br />
<br />
ftp_nlist("www.example.com/docs/some/thing")<br />
<br />
it dumped something like this:<br />
<br />
&nbsp; [0]=&gt;<br />
&nbsp; string(41) "www.example.com/docs/some/thing/file1.htm"<br />
&nbsp; [1]=&gt;<br />
&nbsp; string(41) "www.example.com/docs/some/thing/file2.htm"<br />
&nbsp; [2]=&gt;<br />
&nbsp; string(41) "www.example.com/docs/some/thing/file3.htm"<br />
&nbsp; [3]=&gt;<br />
&nbsp; string(41) "www.example.com/docs/some/thing/file4.htm"<br />
&nbsp; [4]=&gt;<br />
&nbsp; string(41) "www.example.com/docs/some/thing/file5.htm"</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="62306""></a>
  <div class="note">
   <strong class="user">franck569 at free dot fr</strong>
   <a href="#62306" class="date">24-Feb-2006 07:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
better version of turigeza on yahoo com ftp_rmdirr() function.<br />
<br />
This return true or false if the path will be removed :<br />
<br />
function ftp_rmdirr($handle, $path)<br />
{<br />
&nbsp;&nbsp;&nbsp; if(!@ftp_delete($handle, $path))<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $list = @ftp_nlist($handle, $path);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(!empty($list))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach($list as $value)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ftp_rmdirr($handle, $value);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; if(@ftp_rmdir($handle, $path))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return true;<br />
&nbsp;&nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return false;<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="58528""></a>
  <div class="note">
   <strong class="user">turigeza on yahoo com</strong>
   <a href="#58528" class="date">07-Nov-2005 04:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Recursive directory delete using ftp_nlist() ...<br />
<span class="default">&lt;?php <br />
</span><span class="keyword">function </span><span class="default">ftp_rmdirr</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">, </span><span class="default">$handle</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; if (!(@</span><span class="default">ftp_rmdir</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">) || @</span><span class="default">ftp_delete</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">)))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$list </span><span class="keyword">= </span><span class="default">ftp_nlist</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!empty(</span><span class="default">$list</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$list </span><span class="keyword">as </span><span class="default">$value</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ftp_rmdirr</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">, </span><span class="default">$handle</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; @</span><span class="default">ftp_rmdir</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;<br />
</span>It would be very useful if it was built into php. After all most of the time we want to remove non empty directories too. I bet everyone out there dealing with the file system had faced this problem.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="54307""></a>
  <div class="note">
   <strong class="user">dreamsavior at gmail dot com</strong>
   <a href="#54307" class="date">30-Jun-2005 06:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is the function that would checking whether the given path is directory or not, using ftp_nlist;<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">is_ftp_dir</span><span class="keyword">(</span><span class="default">$itempath</span><span class="keyword">, </span><span class="default">$ftp_server</span><span class="keyword">, </span><span class="default">$ftp_user_name</span><span class="keyword">=</span><span class="string">'anonymous'</span><span class="keyword">, </span><span class="default">$ftp_user_pass</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if (empty(</span><span class="default">$ftp_user_name</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ftp_user_name </span><span class="keyword">= </span><span class="string">"anonymous"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$itempath</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]!==</span><span class="string">"/"</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$itempath </span><span class="keyword">= </span><span class="string">"/"</span><span class="keyword">.</span><span class="default">$itempath</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$conn_id </span><span class="keyword">= </span><span class="default">ftp_connect</span><span class="keyword">(</span><span class="default">$ftp_server</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$login_result </span><span class="keyword">= </span><span class="default">ftp_login</span><span class="keyword">(</span><span class="default">$conn_id</span><span class="keyword">, </span><span class="default">$ftp_user_name</span><span class="keyword">, </span><span class="default">$ftp_user_pass</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$contents </span><span class="keyword">= </span><span class="default">ftp_nlist</span><span class="keyword">(</span><span class="default">$conn_id</span><span class="keyword">, </span><span class="string">"</span><span class="default">$itempath</span><span class="string">"</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; if (!empty(</span><span class="default">$contents</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$check </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="default">$itempath</span><span class="keyword">, </span><span class="string">""</span><span class="keyword">, </span><span class="default">$contents</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!empty(</span><span class="default">$check</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">ftp_close</span><span class="keyword">(</span><span class="default">$conn_id</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="comment">// example :<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">is_ftp_dir</span><span class="keyword">(</span><span class="string">"/pub/ftp/unknownitem"</span><span class="keyword">, </span><span class="string">"ftp.nowhere"</span><span class="keyword">, </span><span class="string">'username'</span><span class="keyword">, </span><span class="string">'verysecret'')) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // do something related to directory handling action<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // The target item is a file ...<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="48303""></a>
  <div class="note">
   <strong class="user">ds at over dot hu</strong>
   <a href="#48303" class="date">18-Dec-2004 05:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Another file filecollect script, with static.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">filecollect</span><span class="keyword">(</span><span class="default">$conn_id</span><span class="keyword">,</span><span class="default">$dir</span><span class="keyword">=</span><span class="string">'.'</span><span class="keyword">) {<br />
&nbsp; static </span><span class="default">$flist</span><span class="keyword">=array();<br />
&nbsp; if (</span><span class="default">$files </span><span class="keyword">= </span><span class="default">ftp_nlist</span><span class="keyword">(</span><span class="default">$cid</span><span class="keyword">,</span><span class="default">$dir</span><span class="keyword">)){<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$files </span><span class="keyword">as </span><span class="default">$file</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (</span><span class="default">ftp_size</span><span class="keyword">(</span><span class="default">$cid</span><span class="keyword">, </span><span class="default">$file</span><span class="keyword">) == </span><span class="string">"-1"</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">filecollect</span><span class="keyword">(</span><span class="default">$cid</span><span class="keyword">,</span><span class="default">$file</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; } else </span><span class="default">$flist</span><span class="keyword">[] = </span><span class="default">$file</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
&nbsp; return </span><span class="default">$flist</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">$conn_id </span><span class="keyword">= </span><span class="default">ftp_connect</span><span class="keyword">(</span><span class="string">'ftp.nowhere.com'</span><span class="keyword">) or die(</span><span class="string">"Couldn't connect to server"</span><span class="keyword">);<br />
&nbsp; if (@</span><span class="default">ftp_login</span><span class="keyword">(</span><span class="default">$conn_id</span><span class="keyword">, </span><span class="string">'anonymous'</span><span class="keyword">, </span><span class="string">'pass@nowhere.com'</span><span class="keyword">)){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$filelist </span><span class="keyword">= </span><span class="default">filecollect</span><span class="keyword">(</span><span class="default">$conn_id</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"&lt;pre&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$filelist</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"&lt;/pre&gt;"</span><span class="keyword">;<br />
&nbsp; }<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="46011""></a>
  <div class="note">
   <strong class="user">webmaster at torbox dot info</strong>
   <a href="#46011" class="date">26-Sep-2004 06:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To use custom LIST - flags, for example<br />
LIST -aF ../*/<br />
(listing protected pub dirs)<br />
You can use<br />
<span class="default">&lt;?php<br />
$list </span><span class="keyword">= </span><span class="default">ftp_nlist</span><span class="keyword">(</span><span class="default">$ftp</span><span class="keyword">, </span><span class="string">"-aF ../*/"</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span>Took me a while to clever that one out :-)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="40332""></a>
  <div class="note">
   <strong class="user">micksam7 at neodecoder dot com</strong>
   <a href="#40332" class="date">29-Feb-2004 11:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A little correction to king_killa at juggalos4life dot com's note, it isn't ftp_res, it's ftp_size.<br />
<br />
By the way, here is a complete function that will get all the files on a server, then write them to a array.<br />
<br />
<span class="default">&lt;?php<br />
$ftp1 </span><span class="keyword">= </span><span class="default">ftp_connect</span><span class="keyword">(</span><span class="string">'ftp.nowhere1230404.foo'</span><span class="keyword">) or die(</span><span class="string">"Couldn't connect to server"</span><span class="keyword">);<br />
</span><span class="default">ftp_login</span><span class="keyword">(</span><span class="default">$ftp1</span><span class="keyword">,</span><span class="string">'foo'</span><span class="keyword">,</span><span class="string">'bar'</span><span class="keyword">);<br />
</span><span class="default">ftp_pasv</span><span class="keyword">(</span><span class="default">$ftp1</span><span class="keyword">, </span><span class="default">TRUE</span><span class="keyword">); </span><span class="comment">//Passive Mode is better for this<br />
<br />
//Get them file!<br />
</span><span class="keyword">echo </span><span class="string">"Collecting Files on Neodecoder&lt;br&gt;"</span><span class="keyword">;<br />
</span><span class="comment">//Set defaults just in case. PHP complains anyway if we don't.<br />
</span><span class="default">$dir </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
<br />
function </span><span class="default">filecollect</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">,</span><span class="default">$filelist</span><span class="keyword">) {<br />
global </span><span class="default">$ftp1</span><span class="keyword">; </span><span class="comment">//Get our ftp<br />
</span><span class="default">$files </span><span class="keyword">= </span><span class="default">ftp_nlist</span><span class="keyword">(</span><span class="default">$ftp1</span><span class="keyword">,</span><span class="default">$dir</span><span class="keyword">); </span><span class="comment">//get files in directory<br />
</span><span class="keyword">foreach (</span><span class="default">$files </span><span class="keyword">as </span><span class="default">$file</span><span class="keyword">) {<br />
&nbsp;</span><span class="default">$isfile </span><span class="keyword">= </span><span class="default">ftp_size</span><span class="keyword">(</span><span class="default">$ftp1</span><span class="keyword">, </span><span class="default">$file</span><span class="keyword">); <br />
&nbsp;if(</span><span class="default">$isfile </span><span class="keyword">== </span><span class="string">"-1"</span><span class="keyword">) { </span><span class="comment">//Is a file or directory?<br />
&nbsp; </span><span class="default">$filelist </span><span class="keyword">= </span><span class="default">filecollect</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">.</span><span class="string">'/'</span><span class="keyword">.</span><span class="default">$file</span><span class="keyword">,</span><span class="default">$filelist</span><span class="keyword">,</span><span class="default">$num</span><span class="keyword">); </span><span class="comment">//If a folder, do a filecollect on it<br />
&nbsp;</span><span class="keyword">}<br />
&nbsp;else {<br />
&nbsp; </span><span class="default">$filelist</span><span class="keyword">[(</span><span class="default">count</span><span class="keyword">(</span><span class="default">$filelist</span><span class="keyword">)+</span><span class="default">1</span><span class="keyword">)] = </span><span class="default">$file</span><span class="keyword">; </span><span class="comment">//If not, add it as a file to the file list<br />
&nbsp;</span><span class="keyword">}<br />
}<br />
return </span><span class="default">$filelist</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">$filelist </span><span class="keyword">= </span><span class="default">filecollect</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">,</span><span class="default">$filelist</span><span class="keyword">);<br />
<br />
echo </span><span class="string">"&lt;pre&gt;"</span><span class="keyword">;<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$filelist</span><span class="keyword">);<br />
echo </span><span class="string">"&lt;/pre&gt;"</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
This is really handy if your trying to transfer all the files from a ftp server to another server. Which, is why I made the script in the first place. heh..</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="36515""></a>
  <div class="note">
   <strong class="user">tobrien at florahill dot vic dot edu dot au</strong>
   <a href="#36515" class="date">13-Oct-2003 05:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
ftp_nlist() or ftp_rawlist() takes ages then returns nothing...<br />
<br />
If you are having this issue, you may need to enable PASV mode FTP transfers using the ftp_pasv() function.<br />
<br />
Example...<br />
<br />
<span class="default">&lt;?php<br />
$ftp_host </span><span class="keyword">= </span><span class="string">"yourFTPHost"</span><span class="keyword">;<br />
</span><span class="default">$ftp_user </span><span class="keyword">= </span><span class="string">"yourUsername"</span><span class="keyword">;<br />
</span><span class="default">$ftp_password </span><span class="keyword">= </span><span class="string">"yourPassword"</span><span class="keyword">;<br />
<br />
</span><span class="comment">//Connect<br />
</span><span class="keyword">echo </span><span class="string">"&lt;br /&gt;Connecting to </span><span class="default">$ftp_host</span><span class="string"> via FTP..."</span><span class="keyword">;<br />
</span><span class="default">$conn </span><span class="keyword">= </span><span class="default">ftp_connect</span><span class="keyword">(</span><span class="default">$ftp_host</span><span class="keyword">);<br />
</span><span class="default">$login </span><span class="keyword">= </span><span class="default">ftp_login</span><span class="keyword">(</span><span class="default">$conn</span><span class="keyword">, </span><span class="default">$ftp_user</span><span class="keyword">, </span><span class="default">$ftp_password</span><span class="keyword">);<br />
<br />
</span><span class="comment">//<br />
//Enable PASV ( Note: must be done after ftp_login() )<br />
//<br />
</span><span class="default">$mode </span><span class="keyword">= </span><span class="default">ftp_pasv</span><span class="keyword">(</span><span class="default">$conn</span><span class="keyword">, </span><span class="default">TRUE</span><span class="keyword">);<br />
<br />
</span><span class="comment">//Login OK ?<br />
</span><span class="keyword">if ((!</span><span class="default">$conn</span><span class="keyword">) || (!</span><span class="default">$login</span><span class="keyword">) || (!</span><span class="default">$mode</span><span class="keyword">)) {<br />
&nbsp;&nbsp; die(</span><span class="string">"FTP connection has failed !"</span><span class="keyword">);<br />
}<br />
echo </span><span class="string">"&lt;br /&gt;Login Ok.&lt;br /&gt;"</span><span class="keyword">;<br />
<br />
</span><span class="comment">//<br />
//Now run ftp_nlist()<br />
//<br />
</span><span class="default">$file_list </span><span class="keyword">= </span><span class="default">ftp_nlist</span><span class="keyword">(</span><span class="default">$conn</span><span class="keyword">, </span><span class="string">""</span><span class="keyword">);<br />
foreach (</span><span class="default">$file_list </span><span class="keyword">as </span><span class="default">$file</span><span class="keyword">)<br />
{<br />
&nbsp; echo </span><span class="string">"&lt;br&gt;</span><span class="default">$file</span><span class="string">"</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="comment">//close<br />
</span><span class="default">ftp_close</span><span class="keyword">(</span><span class="default">$conn</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="34042""></a>
  <div class="note">
   <strong class="user">aRc</strong>
   <a href="#34042" class="date">14-Jul-2003 09:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
in windows, ftp_nlist will die on a directory with a space in it's name.&nbsp; to get around this, use ftp_chdir:<br />
<br />
//change directory<br />
ftp_chdir($conn, "directory with spaces");<br />
//then blindly list<br />
$contents = ftp_nlist($conn, "");</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="32633""></a>
  <div class="note">
   <strong class="user">neodeus at allesamarsch dot com</strong>
   <a href="#32633" class="date">03-Jun-2003 07:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is an Example tp read out a Complete FTP Server ( beginn at your root dir )<br />
&nbsp;&nbsp;&nbsp; function files($dir)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; /*<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(!isset($dir) || empty($dir))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $dir=ftp_pwd($this-&gt;conn_id);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; */<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; unset($list);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; unset($files);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; unset($folders);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; unset($folder);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; unset($file);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; @ftp_chdir($this-&gt;conn_id, $dir);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $dir = ftp_pwd($this-&gt;conn_id);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $list=Array(); <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $list=ftp_nlist($this-&gt;conn_id, "$dir"); <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $files = Array();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $folders = Array();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for($i = 0; $i != sizeof($list); $i++)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $entry = str_replace("//", "", $list[$i]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(@ftp_chdir($this-&gt;conn_id, $entry))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $folders[] = $entry;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ftp_chdir($this-&gt;conn_id, $dir);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $files[] = $entry;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; print "\t&lt;b&gt; Dateien in ".$dir." :&lt;/b&gt;&lt;br&gt;&lt;br&gt;";<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach($files as $file)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; print $file."&lt;br&gt;";<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; print "\t&lt;b&gt;Ordner in ".$dir." :&lt;/b&gt; &lt;br&gt;&lt;br&gt;";<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach ($folders as $folder)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; print "\t".$folder."&lt;br&gt;";<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ftp_chdir($this-&gt;conn_id, $dir);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;files($folder);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="31668""></a>
  <div class="note">
   <strong class="user">louis at ewens dot com</strong>
   <a href="#31668" class="date">30-Apr-2003 01:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you do a wildcard or other search for a particular file and the file doesn't exist, Solaris FTP servers send back "search*.xml: No such file or directory" as a single element in the response array. This makes it hard to check for the presence of a file.<br />
<br />
One possible work-around is to parse your own raw directory listing. Or you could check for the error verbatim. But different servers could return different values. A simpler way to compensate is to use the ftp_size command to validate the returned file:<br />
<br />
if ( ($filelist = ftp_nlist( $this-&gt;conn_id, $filesearch )) === FALSE )<br />
{<br />
&nbsp;&nbsp; &nbsp; &nbsp; Error( "Could not get file list" );<br />
&nbsp;&nbsp; &nbsp; &nbsp; return FALSE;<br />
}<br />
// File actually exists? Catches invalid FTP server list responses<br />
if ( !count($filelist) || ftp_size( $this-&gt;conn_id, $filelist[0] ) == -1 )<br />
{<br />
&nbsp;&nbsp; &nbsp; &nbsp; Error( "No valid files" );<br />
&nbsp;&nbsp; &nbsp; &nbsp; return FALSE;<br />
}<br />
// File is really there, fetch it or whatever else you want to do</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="29420""></a>
  <div class="note">
   <strong class="user">rfr at ajato dot com dot br</strong>
   <a href="#29420" class="date">13-Feb-2003 05:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There are some FTP servers that just dont accept the ftp_nlist command, they return a bool variable. but I think all of them accept the LIST command which is the ftp_rawlist command. So yu have to parse rawlist to nlist. I found a code here posted by "fredrik" but it shows a bug if the files at the ftp server have spaces oon theeir name... so here its a better function:<br />
function rawlist_2_nlist($list) <br />
{ <br />
&nbsp;&nbsp;&nbsp; $newlist = array();<br />
&nbsp;&nbsp;&nbsp; reset($list); <br />
&nbsp;&nbsp;&nbsp; while (list(,$row) = each($list)) <br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $buf="";<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ($row[0]=='d'||$row[0]=='-'){ <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $buf = substr($row,55);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $newlist[]=$buf;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
return $newlist; <br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="20060""></a>
  <div class="note">
   <strong class="user">ryan at wonko dot com</strong>
   <a href="#20060" class="date">21-Mar-2002 04:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A note to developers using PHP on Windows servers: as of PHP 4.1.2, ftp_nlist() is broken in the Windows build of PHP. It will return nothing at all, even if the same code works fine on UNIX. So if you're going crazy trying to figure out why the function isn't returning anything, stop wasting your time, you're not doing anything wrong. Hopefully this will get fixed in future versions, although it's apparently been an issue since at least 4.0.6.<br />
<br />
More info on this bug is at <a href="http://bugs.php.net/bug.php?id=16057" rel="nofollow" target="_blank">http://bugs.php.net/bug.php?id=16057</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="9583""></a>
  <div class="note">
   <strong class="user">markw at altexa dot com</strong>
   <a href="#9583" class="date">13-Nov-2000 09:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You can do a wildcard file listing with ftp_nlist, as in:
<br />

<br />
$list=ftp_nlist($conn_id, "$dir/*.txt");</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
