<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>Sets terminal attributes and baud rate for a serial port</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.dio-stat.html">? dio_stat</a></li>
      <li style="float: right;"><a href="function.dio-truncate.html">dio_truncate ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.dio.html">Direct IO 函数</a></li>
    <li>Sets terminal attributes and baud rate for a serial port</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.dio-tcsetattr" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">dio_tcsetattr</h1>
  <p class="verinfo">(PHP 4 &gt;= 4.3.0, PHP 5 &lt;= 5.0.5, PHP 7)</p><p class="refpurpose"><span class="refname">dio_tcsetattr</span> &mdash; <span class="dc-title">
   Sets terminal attributes and baud rate for a serial port
  </span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.dio-tcsetattr-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">bool</span> <span class="methodname"><strong>dio_tcsetattr</strong></span>
    ( <span class="methodparam"><span class="type">resource</span> <code class="parameter">$fd</code></span>
   , <span class="methodparam"><span class="type">array</span> <code class="parameter">$options</code></span>
   )</div>

  <p class="para rdfs-comment">
   <span class="function"><strong>dio_tcsetattr()</strong></span> sets the terminal attributes and baud
   rate of the open <code class="parameter">fd</code>.
  </p>
 </div>

 <div class="refsect1 parameters" id="refsect1-function.dio-tcsetattr-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">fd</code></dt>

     <dd>

      <p class="para">
       The file descriptor returned by <span class="function"><a href="function.dio-open.html" class="function">dio_open()</a></span>.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">options</code></dt>

     <dd>

      <p class="para">
       The currently available options are: 
       <ul class="itemizedlist">
        <li class="listitem">
         <p class="para">
          &#039;baud&#039; - baud rate of the port - can be 38400,19200,9600,4800,2400,1800,
          1200,600,300,200,150,134,110,75 or 50, default value is 9600.
         </p>
        </li>
        <li class="listitem">
         <p class="para">
          &#039;bits&#039; - data bits - can be 8,7,6 or 5. Default value is 8.
         </p>
        </li>
        <li class="listitem">
         <p class="para">
          &#039;stop&#039; - stop bits - can be 1 or 2. Default value is 1.
         </p>
        </li>
        <li class="listitem">
         <p class="para">
          &#039;parity&#039; - can be 0,1 or 2. Default value is 0.
         </p>
        </li>
       </ul>
      </p>
     </dd>

    
   </dl>

  </p>
 </div>

 <div class="refsect1 returnvalues" id="refsect1-function.dio-tcsetattr-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   没有返回值。
  </p>
 </div>

 <div class="refsect1 examples" id="refsect1-function.dio-tcsetattr-examples">
  <h3 class="title">范例</h3>
  <p class="para">
   <div class="example" id="example-2473">
    <p><strong>Example #1 Setting the baud rate on a serial port</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br />$fd&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">dio_open</span><span style="color: #007700">(</span><span style="color: #DD0000">'/dev/ttyS0'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">O_RDWR&nbsp;</span><span style="color: #007700">|&nbsp;</span><span style="color: #0000BB">O_NOCTTY&nbsp;</span><span style="color: #007700">|&nbsp;</span><span style="color: #0000BB">O_NONBLOCK</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">dio_fcntl</span><span style="color: #007700">(</span><span style="color: #0000BB">$fd</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">F_SETFL</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">O_SYNC</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">dio_tcsetattr</span><span style="color: #007700">(</span><span style="color: #0000BB">$fd</span><span style="color: #007700">,&nbsp;array(<br />&nbsp;&nbsp;</span><span style="color: #DD0000">'baud'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">9600</span><span style="color: #007700">,<br />&nbsp;&nbsp;</span><span style="color: #DD0000">'bits'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">8</span><span style="color: #007700">,<br />&nbsp;&nbsp;</span><span style="color: #DD0000">'stop'&nbsp;&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">,<br />&nbsp;&nbsp;</span><span style="color: #DD0000">'parity'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">0<br /></span><span style="color: #007700">));&nbsp;<br /><br />while&nbsp;(</span><span style="color: #0000BB">1</span><span style="color: #007700">)&nbsp;{<br /><br />&nbsp;&nbsp;</span><span style="color: #0000BB">$data&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">dio_read</span><span style="color: #007700">(</span><span style="color: #0000BB">$fd</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">256</span><span style="color: #007700">);<br /><br />&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$data</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">$data</span><span style="color: #007700">;<br />&nbsp;&nbsp;}<br />}&nbsp;<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 notes" id="refsect1-function.dio-tcsetattr-notes">
  <h3 class="title">注释</h3>
  <blockquote class="note"><p><strong class="note">Note</strong>: <span class="simpara">此函数未在 Windows 平台下实现。</span></p></blockquote>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="54346""></a>
  <div class="note">
   <strong class="user">daniel widyanto (kunilkuda at gmail dot com)</strong>
   <a href="#54346" class="date">01-Jul-2005 03:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I'm using PHP to interface my AVR microcontroller in /dev/ttyS0. I bet someone else does the same. <br />
<br />
Here's some hint : <br />
- dio_tcsetattr -&gt; is set to enable : <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - RTS / CTS hardware control<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - ICANON mode <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (means that dio_read will wait until 0x0A/LF or other control character is entered in /dev/ttyS0 before it returns reading result, when you use dio_write it will also send 0x0A/LF automatically in the end of the message to your device).<br />
<br />
For those who dont need RTS/CTS and/or ICANON, you can use linux command : stty.<br />
<br />
Here's mine :<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; exec</span><span class="keyword">(</span><span class="string">'stty -F /dev/ttyS0 4800 raw'</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fd</span><span class="keyword">=</span><span class="default">dio_open</span><span class="keyword">(</span><span class="string">'/dev/ttyS0'</span><span class="keyword">,</span><span class="default">O_RDWR </span><span class="keyword">| </span><span class="default">O_NOCTTY </span><span class="keyword">| </span><span class="default">O_NDELAY</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">dio_fcntl</span><span class="keyword">(</span><span class="default">$fd</span><span class="keyword">,</span><span class="default">F_SETFL</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">dio_write</span><span class="keyword">(</span><span class="default">$fd</span><span class="keyword">,</span><span class="string">"\x41"</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">);&nbsp; </span><span class="comment">// write 0x41 or 'A' to /dev/ttyS0<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // Replace result_length with your expected command result length<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">result_length</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$result </span><span class="keyword">.=</span><span class="default">dio_read</span><span class="keyword">(</span><span class="default">$fd</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">$result</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
Refer to :<br />
- Serial Programming Guide for POSIX Operating Systems, <a href="http://www.easysw.com/~mike/serial/" rel="nofollow" target="_blank">http://www.easysw.com/~mike/serial/</a><br />
- stty man pages</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="51509""></a>
  <div class="note">
   <strong class="user">fherrero at noticiasdenavarra dot com</strong>
   <a href="#51509" class="date">02-Apr-2005 01:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For Windows the Example 1 looks same this one:<br />
<br />
<span class="default">&lt;?php<br />
<br />
exec</span><span class="keyword">(</span><span class="string">'mode com1: baud=9600 data=8 stop=1 parity=n xon=on'</span><span class="keyword">);<br />
</span><span class="comment">// execute 'help mode' in command line of Windows for help<br />
<br />
</span><span class="default">$fd </span><span class="keyword">= </span><span class="default">dio_open</span><span class="keyword">(</span><span class="string">'com1:'</span><span class="keyword">, </span><span class="default">O_RDWR</span><span class="keyword">);<br />
<br />
while (</span><span class="default">1</span><span class="keyword">) {<br />
<br />
&nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">dio_read</span><span class="keyword">(</span><span class="default">$fd</span><span class="keyword">, </span><span class="default">256</span><span class="keyword">);<br />
<br />
&nbsp; if (</span><span class="default">$data</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; echo </span><span class="default">$data</span><span class="keyword">;<br />
&nbsp; }<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="34250""></a>
  <div class="note">
   <strong class="user">healer at colorado dot edu</strong>
   <a href="#34250" class="date">20-Jul-2003 12:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It was frustrating at first because I was trying to get my Linux box to talk to an external serial device (a PIC18F452 programmable chip) and the example provided here refers to fcntl() and open() parameters that aren't in the PHP documentation.<br />
<br />
I finally found out what does what through the man pages:<br />
<br />
man open<br />
man fcntl<br />
<br />
still haven't gotten it to work, or how to reset the ttySx, but thought it may help someone...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
