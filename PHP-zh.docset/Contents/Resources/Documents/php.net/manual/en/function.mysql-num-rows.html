<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>取得结果集中行的数目</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.mysql-num-fields.html">? mysql_num_fields</a></li>
      <li style="float: right;"><a href="function.mysql-pconnect.html">mysql_pconnect ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.mysql.html">MySQL 函数</a></li>
    <li>取得结果集中行的数目</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.mysql-num-rows" class="refentry">
   <div class="refnamediv">
    <h1 class="refname">mysql_num_rows</h1>
    <p class="verinfo">(PHP 4, PHP 5)</p><p class="refpurpose"><span class="refname">mysql_num_rows</span> &mdash; <span class="dc-title">取得结果集中行的数目</span></p>

   </div>
   <div class="refsect1 unknown-unknown-unknown-unknown-unknown-unknown-unknown-unknown-unknown-unknown-unknown-unknown-seealta" id="refsect1-function.mysql-num-rows-unknown-unknown-unknown-unknown-unknown-unknown-unknown-unknown-unknown-unknown-unknown-unknown-seealta">
    <h3 class="title">说明</h3>
     <div class="methodsynopsis dc-description">
      <span class="type">int</span> <span class="methodname"><strong>mysql_num_rows</strong></span>
       ( <span class="methodparam"><span class="type">resource</span> <code class="parameter">$result</code></span>
      )</div>

    <p class="para rdfs-comment">
     <span class="function"><strong>mysql_num_rows()</strong></span>
     返回结果集中行的数目。此命令仅对
     SELECT 语句有效。要取得被
     INSERT，UPDATE 或者
     DELETE 查询所影响到的行的数目，用
     <span class="function"><a href="function.mysql-affected-rows.html" class="function">mysql_affected_rows()</a></span>。
     <div class="example" id="example-1904">
      <p><strong>Example #1 <span class="function"><strong>mysql_num_rows()</strong></span> 例子</strong></p>
      <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br />$link&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mysql_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">"localhost"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"mysql_user"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"mysql_password"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">mysql_select_db</span><span style="color: #007700">(</span><span style="color: #DD0000">"database"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$link</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$result&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mysql_query</span><span style="color: #007700">(</span><span style="color: #DD0000">"SELECT&nbsp;*&nbsp;FROM&nbsp;table1"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$link</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$num_rows&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mysql_num_rows</span><span style="color: #007700">(</span><span style="color: #0000BB">$result</span><span style="color: #007700">);<br /><br />echo&nbsp;</span><span style="color: #DD0000">"</span><span style="color: #0000BB">$num_rows</span><span style="color: #DD0000">&nbsp;Rows\n"</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
      </div>

     </div>
    </p>
    <blockquote class="note"><p><strong class="note">Note</strong>: 
     <p class="para">
      如果使用
      <span class="function"><a href="function.mysql-unbuffered-query.html" class="function">mysql_unbuffered_query()</a></span>，则直到结果集中的所有行都被提取后
      <span class="function"><strong>mysql_num_rows()</strong></span>
      才能返回正确的值。
     </p>
    </p></blockquote>
    <p class="para">
     参见
     <span class="function"><a href="function.mysql-affected-rows.html" class="function">mysql_affected_rows()</a></span>，<span class="function"><a href="function.mysql-connect.html" class="function">mysql_connect()</a></span>，<span class="function"><a href="function.mysql-data-seek.html" class="function">mysql_data_seek()</a></span>，<span class="function"><a href="function.mysql-select-db.html" class="function">mysql_select_db()</a></span> 和
     <span class="function"><a href="function.mysql-query.html" class="function">mysql_query()</a></span>。
    </p>
    <p class="para">
     为向下兼容仍然可以使用
     <span class="function"><strong>mysql_numrows()</strong></span>，但反对这样做。
    </p>
   </div>

  </div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="118039""></a>
  <div class="note">
   <strong class="user">Joebomb</strong>
   <a href="#118039" class="date">23-Sep-2015 07:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In Reply to the last post: This may not always work correctly, as $object-&gt;doesExist would contain a result, not a boolean value. A better way (using the same method) would be using a cast: <br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">Object </span><span class="keyword">{<br />
&nbsp; var </span><span class="default">$doesExist </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
<br />
&nbsp; [...]<br />
&nbsp; function </span><span class="default">load</span><span class="keyword">() {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="string">'...'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">doesExist </span><span class="keyword">= (bool) (</span><span class="default">$res </span><span class="keyword">= </span><span class="default">mysql_fetch_array</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; [...]<br />
&nbsp; }<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="103032""></a>
  <div class="note">
   <strong class="user">mauriciocramos at gmail dot com</strong>
   <a href="#103032" class="date">21-Mar-2011 09:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When mysql.trace_mode = On, SELECT FOUND_ROWS() allway returns 0.&nbsp; It looks like a bug.<br />
<br />
In detail:<br />
<br />
If you have a table with 5 rows and issue:<br />
<br />
SELECT SQL_CALC_FOUND_ROWS * FROM table LIMIT 1;<br />
<br />
mysql_num_rows() returns 1 as expected.<br />
<br />
If you issue "SELECT FOUND_ROWS()" just in sequence, in the same connection resource, it allways returns 0 rather than expected 5.<br />
<br />
Just switch mysql.trace_mode to Off and things will work.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="96845""></a>
  <div class="note">
   <strong class="user">Typer85 at gmail dot com</strong>
   <a href="#96845" class="date">18-Mar-2010 08:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Actually I am a little ashamed to be saying this, but I stand corrected about a rather old note I posted on 17-Jul-2007 06:44.<br />
<br />
Using SQL_CALC_FOUND_ROWS and FOUND_ROWS( ) will NOT trigger a race condition on MySQL, as that would pretty much defy their entire purpose.<br />
<br />
The results for their usage is actually unique per connection session as it is impossible for processes to share anything in PHP. As far as PHP is concerned, each request represents a new connection to MySQL as each request is isolated to its own process.<br />
<br />
To simulate this, create the following script:<br />
<br />
<span class="default">&lt;?php<br />
<br />
$Handle </span><span class="keyword">= </span><span class="default">mysql_connect</span><span class="keyword">( </span><span class="string">"localhost" </span><span class="keyword">, </span><span class="string">"root" </span><span class="keyword">, </span><span class="string">"" </span><span class="keyword">);<br />
</span><span class="default">mysql_select_db</span><span class="keyword">( </span><span class="string">"lls" </span><span class="keyword">);<br />
<br />
if( isset( </span><span class="default">$_GET</span><span class="keyword">[ </span><span class="string">'Sleep' </span><span class="keyword">] ) ) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">mysql_query</span><span class="keyword">( </span><span class="string">"SELECT SQL_CALC_FOUND_ROWS `bid` From `blocks` Limit 1" </span><span class="keyword">);<br />
} else {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">mysql_query</span><span class="keyword">( </span><span class="string">"SELECT SQL_CALC_FOUND_ROWS `aid` From `access` Limit 1" </span><span class="keyword">);<br />
}<br />
<br />
if( isset( </span><span class="default">$_GET</span><span class="keyword">[ </span><span class="string">'Sleep' </span><span class="keyword">] ) ) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">sleep</span><span class="keyword">( </span><span class="default">10 </span><span class="keyword">); </span><span class="comment">// Simulate another HTTP request coming in.<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$Result </span><span class="keyword">= </span><span class="default">mysql_query</span><span class="keyword">( </span><span class="string">"SELECT FOUND_ROWS( )" </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">print_r</span><span class="keyword">( </span><span class="default">mysql_fetch_array</span><span class="keyword">( </span><span class="default">$Result </span><span class="keyword">) );<br />
}<br />
<br />
</span><span class="default">mysql_close</span><span class="keyword">( );<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Set the connection and query information for something that matches your environment.<br />
<br />
Run the script once with the Sleep query string and once again without it. Its important to run them both at the same time. Use Apache ab or something similar, or even easier, just open two browser tabs. For example:<br />
<br />
<a href="http://localhost/Script.php?Sleep=10" rel="nofollow" target="_blank">http://localhost/Script.php?Sleep=10</a><br />
<a href="http://localhost/Script.php" rel="nofollow" target="_blank">http://localhost/Script.php</a><br />
<br />
If a race condition existed, the results of the first instance of the script would equal the results of the second instance of the script.<br />
<br />
For example, the second instance of the script will execute the following SQL query:<br />
<br />
<span class="default">&lt;?php<br />
<br />
mysql_query</span><span class="keyword">( </span><span class="string">"SELECT SQL_CALC_FOUND_ROWS `aid` From `access` Limit 1" </span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
This happens while the first instance of the script is sleeping. If a race condition existed, when the first instance of the script wakes up, the result of the FOUND_ROWS( ) it executes should be the number of rows in the SQL query the second instance of the script executed.<br />
<br />
But when you run them, this is not the case. The first instance of the script returns the number of rows of its OWN query, which is:<br />
<br />
<span class="default">&lt;?php<br />
<br />
mysql_query</span><span class="keyword">( </span><span class="string">"SELECT SQL_CALC_FOUND_ROWS `bid` From `blocks` Limit 1" </span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
So it turns out NO race condition exists, and every solution presented to combat this "issue" are pretty much not needed.<br />
<br />
Good Luck,</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85654""></a>
  <div class="note">
   <strong class="user">gtaylor at sonic dot net</strong>
   <a href="#85654" class="date">10-Sep-2008 09:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In preventing the race condition for the SQL_CALC_FOUND_ROWS and FOUND_ROWS() operations, it can become complicated and somewhat kludgy to include the FOUND_ROWS() result in the actual result set, especially for complex queries and/or result ordering. The query gets more complex, you may have trouble isolating/excluding the FOUND_ROWS() result, and mysql_num_rows() will return the number of actual results + 1, all of which makes your code messier and harder to read. However, the race condition is real and must be dealt with.<br />
<br />
A alternative and cleaner method is to explicitly lock the table using a WRITE lock (preventing other processes from reading/writing to the table). The downsides I can see are a performance hit, and your mysql user must have lock permissions.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// excuse the use of mysqli instead of mysql<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$mysqli</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="string">"LOCK TABLE t WRITE"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$results </span><span class="keyword">= </span><span class="default">$mysqli</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="string">"SELECT id FROM t LIMIT 0,10"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$totalNumResults </span><span class="keyword">= </span><span class="default">array_pop</span><span class="keyword">(</span><span class="default">$mysqli</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="string">"SELECT FOUND_ROWS()"</span><span class="keyword">)-&gt;</span><span class="default">fetch_row</span><span class="keyword">());<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$mysqli</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="string">"UNLOCK TABLES"</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Now you may iterate through the results just like any other result set.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83647""></a>
  <div class="note">
   <strong class="user">Tom Fejfar</strong>
   <a href="#83647" class="date">05-Jun-2008 10:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Improvement to chrisdberry82 at gmail dot com's code:<br />
<br />
<span class="default">&lt;?php<br />
$sql </span><span class="keyword">= </span><span class="string">"<br />
SELECT SQL_CALC_FOUND_ROWS <br />
&nbsp; '0', z.id<br />
FROM <br />
&nbsp; zoom AS z <br />
LIMIT <br />
&nbsp; 0,6 <br />
UNION <br />
&nbsp; SELECT <br />
&nbsp;&nbsp;&nbsp; '1', FOUND_ROWS() <br />
ORDER BY `0` DESC , RAND()"</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
You can see, that you can even ORDER the final result anyway you like ;)<br />
Then you can fetch the result like this:<br />
<span class="default">&lt;?php<br />
$res </span><span class="keyword">= </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="default">$sql</span><span class="keyword">);<br />
</span><span class="default">$count </span><span class="keyword">= </span><span class="default">mysql_fetch_assoc</span><span class="keyword">(</span><span class="default">$res</span><span class="keyword">); <br />
while(</span><span class="default">$row </span><span class="keyword">= </span><span class="default">mysql_fetch_assoc</span><span class="keyword">(</span><span class="default">$res</span><span class="keyword">)){<br />
&nbsp;unset(</span><span class="default">$row</span><span class="keyword">[</span><span class="string">"0"</span><span class="keyword">]); </span><span class="comment">//get rid of the "sorting col"<br />
&nbsp;</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$row</span><span class="keyword">); </span><span class="comment">//or whatever ;)<br />
</span><span class="keyword">}<br />
echo </span><span class="default">$count</span><span class="keyword">[</span><span class="string">"id"</span><span class="keyword">]; </span><span class="comment">// the total number of rows<br />
</span><span class="default">?&gt;<br />
</span><br />
And you got rid of the lousy IFs ;)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83469""></a>
  <div class="note">
   <strong class="user">timo</strong>
   <a href="#83469" class="date">27-May-2008 06:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
&lt;?<br />
$strQuery="SELECT * FROM `tabel`";<br />
$strResult = mysql_query($strQuery);<br />
$Aantalvelden = mysql_num_fields($strResult);<br />
$Aantalrijen=mysql_num_rows($strResult);<br />
<br />
echo "&lt;table border='1'&gt;&lt;tr&gt;";<br />
for($ikolom=0;$ikolom&lt;$Aantalvelden;$ikolom++){<br />
$strVeldnaam = mysql_field_name($strResult,$ikolom);<br />
echo "&lt;td&gt;$strVeldnaam&lt;/td&gt;" ;<br />
}<br />
echo "&lt;/tr&gt;";<br />
<br />
for($ir=0;$irij&lt;$Aantalrijen;$irij++){<br />
echo "&lt;tr&gt;";<br />
for($ikolom=0;$ikolom&lt;$Aantalvelden;$ikolom++){<br />
$strKolomwaarde = mysql_result($strResult,$irij,$ikolom);<br />
echo "&lt;td&gt;$strKolomwaarde&lt;/td&gt;";<br />
}<br />
}<br />
echo "&lt;/table&gt;";<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83424""></a>
  <div class="note">
   <strong class="user">chrisdberry82 at gmail dot com</strong>
   <a href="#83424" class="date">25-May-2008 07:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The following code can wrap it all up in a single query so you don't have to worry about multiple client requests:<br />
<br />
$stmtMain = $mysqli-&gt;prepare("SELECT SQL_CALC_FOUND_ROWS jobid,title FROM tbljobs <br />
&nbsp;&nbsp;&nbsp; LIMIT ?, ? UNION SELECT FOUND_ROWS(),'!!IgnoreCount!!';")<br />
<br />
Then iterate through the results with something like:<br />
<br />
while ($stmtMain-&gt;fetch() &amp;&amp; $strResultTitle !="!!IgnoreCount!!") {&nbsp; <br />
//do stuff<br />
}<br />
($strResultSector == '!!IgnoreCount!!')? $intTotal = $intResultCount : 1;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77222""></a>
  <div class="note">
   <strong class="user">deaggi at deaggi dot net</strong>
   <a href="#77222" class="date">20-Aug-2007 09:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In Reply to the last post: This may not always work correctly, as $object-&gt;doesExist would contain a result, not a boolean value. A better way (using the same method) would be using a cast: <br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">Object </span><span class="keyword">{<br />
&nbsp; var </span><span class="default">$doesExist </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
<br />
&nbsp; [...]<br />
&nbsp; function </span><span class="default">load</span><span class="keyword">() {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="string">'...'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">doesExist </span><span class="keyword">= (bool) (</span><span class="default">$res </span><span class="keyword">= </span><span class="default">mysql_fetch_array</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; [...]<br />
&nbsp; }<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
johannes</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77208""></a>
  <div class="note">
   <strong class="user">webmaster  dasourcerer  net</strong>
   <a href="#77208" class="date">20-Aug-2007 02:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In one of my applications, I had to let an object know wether it exists in the database or not. I found a cheap solution w/o the usage of mysql_num_rows():<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">Object </span><span class="keyword">{<br />
&nbsp; var </span><span class="default">$doesExist </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
<br />
&nbsp; [...]<br />
&nbsp; function </span><span class="default">load</span><span class="keyword">() {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="string">'...'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">doesExist </span><span class="keyword">= (</span><span class="default">$res </span><span class="keyword">= </span><span class="default">mysql_fetch_array</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; [...]<br />
&nbsp; }<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76463""></a>
  <div class="note">
   <strong class="user">Typer85 at gmail dot com</strong>
   <a href="#76463" class="date">17-Jul-2007 08:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A note on the following usage; that suggest to use several MySQL Functions to get the number of Table Records.<br />
<br />
You may be familiar with following:<br />
<br />
<span class="default">&lt;?php<br />
<br />
$sqlQuery </span><span class="keyword">= </span><span class="string">'Select SQL_CALC_FOUND_ROWS `MyField` From `MyTable` Limit 1;'</span><span class="keyword">; <br />
<br />
</span><span class="default">$sqlQuery_1 </span><span class="keyword">= </span><span class="string">'Select FOUND_ROWS( );'</span><span class="keyword">;<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
I omitted the actual connection to MySQL and the execution of the query, but you get the idea.<br />
<br />
I did some tests and on a fairly high traffic web site, one that executes several queries quite often and found that using this combination of MySQL Functions can actually result in wrong results.<br />
<br />
For example, assume I have two queries to get the number of Table Records in two different Tables. So in essence, we are executing 4 queries ( 2 queries for each Table ).<br />
<br />
If two different requests come in through PHP, your going to run into problems. Note than when I mean request, I mean two different clients requesting your PHP page.<br />
<br />
---------------<br />
Request 1:<br />
---------------<br />
<br />
Execute: SQL_CALC_FOUND_ROWS On Table 1<br />
<br />
---------------<br />
Request 2:<br />
---------------<br />
<br />
Execute: SQL_CALC_FOUND_ROWS On Table 2<br />
<br />
---------------<br />
Request 1:<br />
---------------<br />
<br />
Execute: Select FOUND_ROWS( )<br />
<br />
At this point, you see the race condition that occurred. While Request 1 was being executed, Request 2 came in.<br />
<br />
At this point Request 1 will return the number of Table Records in Table 2 and not Table 1 as expected!<br />
<br />
Why? Because MySQL does not differ between requests. Each query is in a queue waiting its turn. As soon as its turn comes in it will be executed my MySQL.<br />
<br />
The MySQL Function Select FOUND_ROWS( ) will return the result of the last SQL_CALC_FOUND_ROWS!<br />
<br />
Keep in mind.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="59509""></a>
  <div class="note">
   <strong class="user">Jonas</strong>
   <a href="#59509" class="date">08-Dec-2005 10:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A small tip concerning SQL_CALC_FOUND_ROWS and FOUND_ROWS()<br />
<br />
Remember that you can us "AS" when working with mysql_fetch_assoc.<br />
<br />
$sql="<br />
&nbsp;&nbsp;&nbsp; SELECT<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; FOUND_ROWS() AS `found_rows`;<br />
";<br />
$result = mysql_query($sql);<br />
$myrow = mysql_fetch_assoc($result);<br />
$row_count = $myrow['found_rows'];<br />
<br />
echo $row_count;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="58697""></a>
  <div class="note">
   <strong class="user">simon_nuttall at hotmail dot com</strong>
   <a href="#58697" class="date">12-Nov-2005 04:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Object oriented version of wil1488 at gmail dot com's comment for counting table rows:<br />
<span class="default">&lt;?php<br />
$result </span><span class="keyword">= </span><span class="default">$mysqli</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="string">"SELECT COUNT(*) as TOTALFOUND from table"</span><span class="keyword">);<br />
</span><span class="default">$row_array</span><span class="keyword">=</span><span class="default">$result</span><span class="keyword">-&gt;</span><span class="default">fetch_array</span><span class="keyword">(</span><span class="default">MYSQLI_ASSOC</span><span class="keyword">);<br />
print(</span><span class="default">$row_array</span><span class="keyword">[</span><span class="string">'TOTALFOUND'</span><span class="keyword">]); <br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="53416""></a>
  <div class="note">
   <strong class="user">wil1488 at gmail dot com</strong>
   <a href="#53416" class="date">01-Jun-2005 04:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To use SQL COUNT function, without select the source...<br />
<br />
see an example:<br />
<br />
&lt;?<br />
//MAKE THE CONNECTION WITH DATABASE<br />
<br />
$my_table = mysql_query("SELECT COUNT(*) as TOTALFOUND from table", $link); //EXECUTE SQL CODE<br />
Note: will return the total on TOTALFOUND<br />
<br />
print (mysql_result($my_table,0,"TOTALFOUND")); //use the field camp to get the total from your SQL query!<br />
?&gt;<br />
<br />
Thanks, good luck.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="50166""></a>
  <div class="note">
   <strong class="user">dzver at abv dot bg</strong>
   <a href="#50166" class="date">20-Feb-2005 02:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It is faster to run second query "select count(...) from ... ", than adding SQL_CALC_FOUND_ROWS to your first query, and then using select FOUND_ROWS() + mysql_num_rows().</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="49487""></a>
  <div class="note">
   
   <a href="#49487" class="date">30-Jan-2005 02:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In response to oran at trifeed dot com:<br />
<br />
You are only experiencing this behaviour because you have not given your FOUND_ROWS() result an alias:<br />
<br />
$qry = mysql_query ( 'SELECT FOUND_ROWS() AS total' );<br />
$rst = mysql_fetch_array ( $qry, MYSQL_ASSOC );<br />
echo $rst['total'];<br />
<br />
Sean :)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="48219""></a>
  <div class="note">
   <strong class="user">oran at trifeed dot com</strong>
   <a href="#48219" class="date">15-Dec-2004 06:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For me <br />
<br />
SELECT SQL_CALC_FOUND_ROWS together with<br />
SELECT FOUND_ROWS()<br />
<br />
Only worked with the following syntax:<br />
$result = @mysql_query($query);<br />
$resultTotal = @mysql_query("SELECT FOUND_ROWS()");<br />
$res=&nbsp; &nbsp; mysql_fetch_array($resultTotal);<br />
echo $res['FOUND_ROWS()'];<br />
<br />
hope it helped<br />
<br />
oran<br />
<a href="http://www.trifeed.com" rel="nofollow" target="_blank">http://www.trifeed.com</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="47521""></a>
  <div class="note">
   <strong class="user">pjoe444 at yahoo dot com</strong>
   <a href="#47521" class="date">19-Nov-2004 12:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Re my last entry:<br />
<br />
This seems the best workaround to get an 'ordinary' loop going, with possibility of altering output according to row number<br />
(eg laying out a schedule)<br />
<br />
$rowno=mysql_num_rows($result);<br />
<br />
for ($i=0; $i&lt;mysql_num_rows($result); $i++) {<br />
$row = mysql_fetch_assoc($result);<br />
<br />
print "&lt;div class=\"showing\"&gt;";<br />
print "&lt;b&gt;".$row['timeon']."-".$row['timeoff']."&lt;/b&gt; ".$row['event']."&lt;br /&gt;;<br />
if ($i!=$rowno-1) {<br />
&nbsp;&nbsp;&nbsp; print "other-html-within-sched-here&lt;/div&gt;"; <br />
&nbsp;&nbsp;&nbsp; }&nbsp; <br />
else print "end-last-entry-html-here&lt;/div&gt;"; <br />
}&nbsp; //close loop</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="47520""></a>
  <div class="note">
   <strong class="user">pjoe444 at yahoo dot com</strong>
   <a href="#47520" class="date">18-Nov-2004 11:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A pity there seems no way of getting the CURRENT&nbsp; row number that's under iteration in a typical loop, <br />
such as:<br />
while ($row = mysql_fetch_assoc($result)) { }<br />
<br />
After all there is an array of row arrays, as signified by<br />
mysql_num_rows($result):<br />
<br />
Say this gives "40 rows" : it would be useful to know when the iteration is on row 39.<br />
<br />
The nearest seems to be "data seek":but it connects directly to a<br />
row number eg (from mysql_data_seek page)<br />
<br />
for ($i = mysql_num_rows($result) - 1; $i &gt;= 0; $i--) {<br />
&nbsp;&nbsp; if (!mysql_data_seek($result, $i)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; echo "Cannot seek to row $i: " . mysql_error() . "\n";<br />
&nbsp;&nbsp; &nbsp; &nbsp; continue;<br />
&nbsp;&nbsp; }<br />
<br />
= it still wouldn't solve knowing what row number you're on in an ordinary loop.<br />
<br />
One reason for this situation is the php fetch (fetch-a-single-row) construction, without any reasonable FOR loop possibility with row numbers.<br />
<br />
Suggestion:<br />
$Rows[$i] possibility where<br />
$i would be the row number<br />
<br />
$Rows[$row[], $row[], $row[].....]<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2&nbsp; &nbsp;&nbsp; etc<br />
<br />
-- the excellent retrieval WITHIN a row ( $row[$i] ),<br />
while certainly more important,&nbsp; is not matched by <br />
similar possibilities for rows themselves.<br />
<br />
and Count($result) doesnt work of course, $result being a <br />
mere ticket-identifier...<br />
<br />
Peter T</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="47144""></a>
  <div class="note">
   <strong class="user">sam at liddicott dot com</strong>
   <a href="#47144" class="date">04-Nov-2004 02:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Some user comments on this page, and some resources including the FAQ at :<br />
<br />
<a href="http://www.faqts.com/knowledge_base/view.phtml/aid/114/fid/12 suggest using count(*" rel="nofollow" target="_blank">http://www.faqts.com/knowledge_base/view.phtml/aid/114/fid/12 suggest using count(*</a>) to count the number of rows<br />
<br />
This is not a particularly universal solution, and those who read these comments on this page should also be aware that <br />
<br />
select count(*) may not give correct results if you are using "group by" or "having" in your query, as count(*) is an agregate function and resets eachtime a group-by column changes.<br />
<br />
select sum(..) ... left join .. group by ... having ...<br />
<br />
can be an alternative to sub-selects in mysql 3, and such queries cannot have the select fields replaced by count(*) to give good results, it just doesn't work.<br />
<br />
Sam</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="29699""></a>
  <div class="note">
   <strong class="user">aaronp123 att yahoo dott comm</strong>
   <a href="#29699" class="date">22-Feb-2003 02:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I may indeed be the only one ever to encounter this - however if you have a myisam table with one row, and you search with valid table and column name for a result where you might expect 0 rows, you will not get 0, you will get 1, which is the myisam optimised response when a table has 0 or one rows.&nbsp; Under "5.2.4 How MySQL Optimises WHERE Clauses" it reads:<br />
<br />
*Early detection of invalid constant expressions. MySQL quickly detects that some SELECT statements are impossible and returns no rows. <br />
<br />
and<br />
<br />
*All constant tables are read first, before any other tables in the query. A constant table is: <br />
1) An empty table or a table with 1 row. <br />
2) A table that is used with a WHERE clause on a UNIQUE index, or a PRIMARY KEY, where all index parts are used with constant expressions and the index parts are defined as NOT NULL. <br />
<br />
Hopefully this will keep someone from staying up all night with 1146 errors, unless I am completely mistaken in thinking I have this figured out.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="18191""></a>
  <div class="note">
   <strong class="user">tac at smokescreen dot org</strong>
   <a href="#18191" class="date">14-Jan-2002 08:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
MySQL 4.0 supports a fabulous new feature that allows you to get the number of rows that would have been returned if the query did not have a LIMIT clause.&nbsp; To use it, you need to add SQL_CALC_FOUND_ROWS to the query, e.g.<br />
<br />
$sql = "Select SQL_CALC_FOUND_ROWS * from table where state='CA' limit 50";<br />
$result = mysql_query($sql);<br />
<br />
$sql = "Select FOUND_ROWS()";<br />
$count_result = mysql_query($sql);<br />
<br />
You now have the total number of rows in table that match the criteria.&nbsp; This is great for knowing the total number of records when browsing through a list.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="12780""></a>
  <div class="note">
   <strong class="user">philip at cornado dot c()m</strong>
   <a href="#12780" class="date">06-May-2001 08:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Regarding SQL count(), see this faq :
<br />
* <a href="http://www.faqts.com/knowledge_base/view.phtml/aid/114/fid/12" rel="nofollow" target="_blank">http://www.faqts.com/knowledge_base/view.phtml/aid/114/fid/12</a>
<br />
Note: If you already have a $result, use mysql_num_rows() on it otherwise use SQL count().&nbsp; Don't SELECT data just for a count.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
