<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>SQLite3</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.sqlite-valid.html">? sqlite_valid</a></li>
      <li style="float: right;"><a href="intro.sqlite3.html">简介 ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="refs.database.vendors.html">针对各数据库系统对应的扩展</a></li>
    <li>SQLite3</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="book.sqlite3" class="book">
 
 <h1 class="title">SQLite3</h1>
 

 

 









 









 








 








 









<ul class="chunklist chunklist_book"><li><a href="intro.sqlite3.html">简介</a></li><li><a href="sqlite3.setup.html">安装／配置</a><ul class="chunklist chunklist_book chunklist_children"><li><a href="sqlite3.requirements.html">需求</a></li><li><a href="sqlite3.installation.html">安装</a></li><li><a href="sqlite3.configuration.html">运行时配置</a></li><li><a href="sqlite3.resources.html">资源类型</a></li></ul></li><li><a href="sqlite3.constants.html">预定义常量</a></li><li><a href="class.sqlite3.html">SQLite3</a> &mdash; SQLite3 类<ul class="chunklist chunklist_book chunklist_children"><li><a href="sqlite3.busytimeout.html">SQLite3::busyTimeout</a> &mdash; Sets the busy connection handler</li><li><a href="sqlite3.changes.html">SQLite3::changes</a> &mdash; Returns the number of database rows that were changed (or inserted or
   deleted) by the most recent SQL statement</li><li><a href="sqlite3.close.html">SQLite3::close</a> &mdash; Closes the database connection</li><li><a href="sqlite3.construct.html">SQLite3::__construct</a> &mdash; Instantiates an SQLite3 object and opens an SQLite 3 database</li><li><a href="sqlite3.createaggregate.html">SQLite3::createAggregate</a> &mdash; Registers a PHP function for use as an SQL aggregate function</li><li><a href="sqlite3.createcollation.html">SQLite3::createCollation</a> &mdash; Registers a PHP function for use as an SQL collating function</li><li><a href="sqlite3.createfunction.html">SQLite3::createFunction</a> &mdash; Registers a PHP function for use as an SQL scalar function</li><li><a href="sqlite3.escapestring.html">SQLite3::escapeString</a> &mdash; Returns a string that has been properly escaped</li><li><a href="sqlite3.exec.html">SQLite3::exec</a> &mdash; Executes a result-less query against a given database</li><li><a href="sqlite3.lasterrorcode.html">SQLite3::lastErrorCode</a> &mdash; Returns the numeric result code of the most recent failed SQLite request</li><li><a href="sqlite3.lasterrormsg.html">SQLite3::lastErrorMsg</a> &mdash; Returns English text describing the most recent failed SQLite request</li><li><a href="sqlite3.lastinsertrowid.html">SQLite3::lastInsertRowID</a> &mdash; Returns the row ID of the most recent INSERT into the database</li><li><a href="sqlite3.loadextension.html">SQLite3::loadExtension</a> &mdash; Attempts to load an SQLite extension library</li><li><a href="sqlite3.open.html">SQLite3::open</a> &mdash; Opens an SQLite database</li><li><a href="sqlite3.prepare.html">SQLite3::prepare</a> &mdash; Prepares an SQL statement for execution</li><li><a href="sqlite3.query.html">SQLite3::query</a> &mdash; Executes an SQL query</li><li><a href="sqlite3.querysingle.html">SQLite3::querySingle</a> &mdash; Executes a query and returns a single result</li><li><a href="sqlite3.version.html">SQLite3::version</a> &mdash; Returns the SQLite3 library version as a string constant and as a number</li></ul></li><li><a href="class.sqlite3stmt.html">SQLite3Stmt</a> &mdash; SQLite3Stmt 类<ul class="chunklist chunklist_book chunklist_children"><li><a href="sqlite3stmt.bindparam.html">SQLite3Stmt::bindParam</a> &mdash; Binds a parameter to a statement variable</li><li><a href="sqlite3stmt.bindvalue.html">SQLite3Stmt::bindValue</a> &mdash; Binds the value of a parameter to a statement variable</li><li><a href="sqlite3stmt.clear.html">SQLite3Stmt::clear</a> &mdash; Clears all current bound parameters</li><li><a href="sqlite3stmt.close.html">SQLite3Stmt::close</a> &mdash; Closes the prepared statement</li><li><a href="sqlite3stmt.execute.html">SQLite3Stmt::execute</a> &mdash; Executes a prepared statement and returns a result set object</li><li><a href="sqlite3stmt.paramcount.html">SQLite3Stmt::paramCount</a> &mdash; Returns the number of parameters within the prepared statement</li><li><a href="sqlite3stmt.reset.html">SQLite3Stmt::reset</a> &mdash; Resets the prepared statement</li></ul></li><li><a href="class.sqlite3result.html">SQLite3Result</a> &mdash; SQLite3Result 类<ul class="chunklist chunklist_book chunklist_children"><li><a href="sqlite3result.columnname.html">SQLite3Result::columnName</a> &mdash; Returns the name of the nth column</li><li><a href="sqlite3result.columntype.html">SQLite3Result::columnType</a> &mdash; Returns the type of the nth column</li><li><a href="sqlite3result.fetcharray.html">SQLite3Result::fetchArray</a> &mdash; Fetches a result row as an associative or numerically indexed array or both</li><li><a href="sqlite3result.finalize.html">SQLite3Result::finalize</a> &mdash; Closes the result set</li><li><a href="sqlite3result.numcolumns.html">SQLite3Result::numColumns</a> &mdash; Returns the number of columns in the result set</li><li><a href="sqlite3result.reset.html">SQLite3Result::reset</a> &mdash; Resets the result set back to the first row</li></ul></li></ul></div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="114885""></a>
  <div class="note">
   <strong class="user">bohwaz</strong>
   <a href="#114885" class="date">21-Apr-2014 09:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Another undocumented feature of the PHP SQLite3 object, available since 2009 is openBlob. Basically it's a function that will return a stream pointer to a blob value in a table. Very very useful when you are dealing with files stored in a SQLite3 database.<br />
<br />
Source code says:<br />
<br />
proto resource SQLite3::openBlob(string table, string column, int rowid [, string dbname])<br />
Open a blob as a stream which we can read / write to.<br />
<br />
But despite that it's not possible to write to the blob, only to read (the write method is empty in the extension source code: it won't return any error but no change will be recorded).<br />
<br />
One example of use:<br />
<br />
<span class="default">&lt;?php<br />
<br />
$db </span><span class="keyword">= new </span><span class="default">SQLite3</span><span class="keyword">(</span><span class="string">'files.sqlite'</span><span class="keyword">);<br />
</span><span class="default">$db</span><span class="keyword">-&gt;</span><span class="default">exec</span><span class="keyword">(</span><span class="string">'CREATE TABLE files (id INTEGER PRIMARY KEY, filename TEXT, content BLOB);'</span><span class="keyword">);<br />
<br />
</span><span class="default">$statement </span><span class="keyword">= </span><span class="default">$db</span><span class="keyword">-&gt;</span><span class="default">prepare</span><span class="keyword">(</span><span class="string">'INSERT INTO files (filename, content) VALUES (?, ?);'</span><span class="keyword">);<br />
</span><span class="default">$statement</span><span class="keyword">-&gt;</span><span class="default">bindValue</span><span class="keyword">(</span><span class="string">'filename'</span><span class="keyword">, </span><span class="string">'Archive.zip'</span><span class="keyword">);<br />
</span><span class="default">$statement</span><span class="keyword">-&gt;</span><span class="default">bindValue</span><span class="keyword">(</span><span class="string">'content'</span><span class="keyword">, </span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="string">'Archive.zip'</span><span class="keyword">));<br />
</span><span class="default">$statement</span><span class="keyword">-&gt;</span><span class="default">execute</span><span class="keyword">();<br />
<br />
</span><span class="default">$fp </span><span class="keyword">= </span><span class="default">$db</span><span class="keyword">-&gt;</span><span class="default">openBlob</span><span class="keyword">(</span><span class="string">'files'</span><span class="keyword">, </span><span class="string">'content'</span><span class="keyword">, </span><span class="default">$id</span><span class="keyword">);<br />
<br />
while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">))<br />
{<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
You can also seek in the stream. This is pretty useful for saving large files from the database too, this way you can use stream_copy_to_stream, it will be faster and more memory-efficient than dumping the file in memory before writing it to the disk.<br />
<br />
Please note that openBlob() won't work on VIRTUAL FTS4 compressed tables.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="113144""></a>
  <div class="note">
   <strong class="user">bohwaz</strong>
   <a href="#113144" class="date">05-Sep-2013 01:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As reported here: https://bugs.php.net/bug.php?id=65216 there are two undocumented and useful methods available:<br />
<br />
SQLite3::createCollation(collation name, callback function) appeared in PHP 5.3.11 and allows to define a custom collation method.<br />
<br />
SQLite3Stmt::readOnly(void) appeared in PHP 5.3.5 and returns true if a statement doesn't write in the database.<br />
<br />
See the documentation pages on the corresponding classes for my comments showing example use of those methods.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="106779""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#106779" class="date">06-Dec-2011 09:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As of PHP 5.4 support for Sqlite2 has been removed. I have a large web app that was built with sqlite2 as the database backend and thus it exploded when I updated PHP. If you're in a similar situation I've written a few wrapper functions that will allow your app to work whilst you convert the code to sqlite3. 
<br />

<br />
Firstly convert your DB to an sqlite3 db. 
<br />

<br />
sqlite OLD.DB .dump | sqlite3 NEW.DB
<br />

<br />
Then add the following functions to your app:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">sqlite_open</span><span class="keyword">(</span><span class="default">$location</span><span class="keyword">,</span><span class="default">$mode</span><span class="keyword">)
<br />
{
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$handle </span><span class="keyword">= new </span><span class="default">SQLite3</span><span class="keyword">(</span><span class="default">$location</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$handle</span><span class="keyword">;
<br />
}
<br />
function </span><span class="default">sqlite_query</span><span class="keyword">(</span><span class="default">$dbhandle</span><span class="keyword">,</span><span class="default">$query</span><span class="keyword">)
<br />
{
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$array</span><span class="keyword">[</span><span class="string">'dbhandle'</span><span class="keyword">] = </span><span class="default">$dbhandle</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$array</span><span class="keyword">[</span><span class="string">'query'</span><span class="keyword">] = </span><span class="default">$query</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="default">$dbhandle</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$result</span><span class="keyword">;
<br />
}
<br />
function </span><span class="default">sqlite_fetch_array</span><span class="keyword">(&amp;</span><span class="default">$result</span><span class="keyword">,</span><span class="default">$type</span><span class="keyword">)
<br />
{
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">#Get Columns
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; while (</span><span class="default">$result</span><span class="keyword">-&gt;</span><span class="default">columnName</span><span class="keyword">(</span><span class="default">$i</span><span class="keyword">))
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$columns</span><span class="keyword">[ ] = </span><span class="default">$result</span><span class="keyword">-&gt;</span><span class="default">columnName</span><span class="keyword">(</span><span class="default">$i</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$i</span><span class="keyword">++;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$resx </span><span class="keyword">= </span><span class="default">$result</span><span class="keyword">-&gt;</span><span class="default">fetchArray</span><span class="keyword">(</span><span class="default">SQLITE3_ASSOC</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$resx</span><span class="keyword">;
<br />
}
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
They're not perfect by any stretch but they seem to be working ok as a temporary measure while I convert the site. 
<br />
Hope that helps someone</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99290""></a>
  <div class="note">
   <strong class="user">alan at chandlerfamily dot org dot uk</strong>
   <a href="#99290" class="date">09-Aug-2010 10:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
PHP 5.3.3 introduced sqlite3::busyTimeout(int milliseconds) which does not currently seem to be documented.<br />
<br />
It believe it acts like sqlite::busyTimeout - that is it tells sqlite3 to call an internal busyHandler if SQLITE_BUSY is returned from any call which waits a short period and then retries.&nbsp; It continues to do this until milliseconds milliseconds have elapsed and then returns the SQLITE_BUSY status.<br />
<br />
I don't know whether the default 60 second value is in place if this function is not called.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
