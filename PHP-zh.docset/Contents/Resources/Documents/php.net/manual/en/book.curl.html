<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>Client URL Library</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.chdb-create.html">? chdb_create</a></li>
      <li style="float: right;"><a href="intro.curl.html">简介 ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="refs.remote.other.html">其它服务</a></li>
    <li>Client URL Library</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="book.curl" class="book">
 <h1 class="title">Client URL Library</h1>
 

 
 
 
 
 









 





 







 


 




<ul class="chunklist chunklist_book"><li><a href="intro.curl.html">简介</a></li><li><a href="curl.setup.html">安装／配置</a><ul class="chunklist chunklist_book chunklist_children"><li><a href="curl.requirements.html">需求</a></li><li><a href="curl.installation.html">安装</a></li><li><a href="curl.configuration.html">运行时配置</a></li><li><a href="curl.resources.html">资源类型</a></li></ul></li><li><a href="curl.constants.html">预定义常量</a></li><li><a href="curl.examples.html">范例</a><ul class="chunklist chunklist_book chunklist_children"><li><a href="curl.examples-basic.html"></a></li></ul></li><li><a href="ref.curl.html">cURL 函数</a><ul class="chunklist chunklist_book chunklist_children"><li><a href="function.curl-close.html">curl_close</a> &mdash; 关闭一个cURL会话</li><li><a href="function.curl-copy-handle.html">curl_copy_handle</a> &mdash; 复制一个cURL句柄和它的所有选项</li><li><a href="function.curl-errno.html">curl_errno</a> &mdash; 返回最后一次的错误号</li><li><a href="function.curl-error.html">curl_error</a> &mdash; 返回一个保护当前会话最近一次错误的字符串</li><li><a href="function.curl-escape.html">curl_escape</a> &mdash; 使用 URL 编码给定的字符串</li><li><a href="function.curl-exec.html">curl_exec</a> &mdash; 执行一个cURL会话</li><li><a href="function.curl-file-create.html">curl_file_create</a> &mdash; Create a CURLFile object</li><li><a href="function.curl-getinfo.html">curl_getinfo</a> &mdash; 获取一个cURL连接资源句柄的信息</li><li><a href="function.curl-init.html">curl_init</a> &mdash; 初始化一个cURL会话</li><li><a href="function.curl-multi-add-handle.html">curl_multi_add_handle</a> &mdash; 向curl批处理会话中添加单独的curl句柄</li><li><a href="function.curl-multi-close.html">curl_multi_close</a> &mdash; 关闭一组cURL句柄</li><li><a href="function.curl-multi-exec.html">curl_multi_exec</a> &mdash; 运行当前 cURL 句柄的子连接</li><li><a href="function.curl-multi-getcontent.html">curl_multi_getcontent</a> &mdash; 如果设置了CURLOPT_RETURNTRANSFER，则返回获取的输出的文本流</li><li><a href="function.curl-multi-info-read.html">curl_multi_info_read</a> &mdash; 获取当前解析的cURL的相关传输信息</li><li><a href="function.curl-multi-init.html">curl_multi_init</a> &mdash; 返回一个新cURL批处理句柄</li><li><a href="function.curl-multi-remove-handle.html">curl_multi_remove_handle</a> &mdash; 移除curl批处理句柄资源中的某个句柄资源</li><li><a href="function.curl-multi-select.html">curl_multi_select</a> &mdash; 等待所有cURL批处理中的活动连接</li><li><a href="function.curl-multi-setopt.html">curl_multi_setopt</a> &mdash; Set an option for the cURL multi handle</li><li><a href="function.curl-multi-strerror.html">curl_multi_strerror</a> &mdash; Return string describing error code</li><li><a href="function.curl-pause.html">curl_pause</a> &mdash; Pause and unpause a connection</li><li><a href="function.curl-reset.html">curl_reset</a> &mdash; Reset all options of a libcurl session handle</li><li><a href="function.curl-setopt-array.html">curl_setopt_array</a> &mdash; 为cURL传输会话批量设置选项</li><li><a href="function.curl-setopt.html">curl_setopt</a> &mdash; 设置一个cURL传输选项</li><li><a href="function.curl-share-close.html">curl_share_close</a> &mdash; Close a cURL share handle</li><li><a href="function.curl-share-init.html">curl_share_init</a> &mdash; Initialize a cURL share handle</li><li><a href="function.curl-share-setopt.html">curl_share_setopt</a> &mdash; Set an option for a cURL share handle.</li><li><a href="function.curl-strerror.html">curl_strerror</a> &mdash; Return string describing the given error code</li><li><a href="function.curl-unescape.html">curl_unescape</a> &mdash; 解码给定的 URL 编码的字符串</li><li><a href="function.curl-version.html">curl_version</a> &mdash; 获取cURL版本信息</li></ul></li></ul></div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="116122""></a>
  <div class="note">
   <strong class="user">qrworld.net</strong>
   <a href="#116122" class="date">12-Nov-2014 01:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here you have a function that I use to get the content of a URL using cURL:<br />
<br />
function getUrlContent($url){<br />
&nbsp;$ch = curl_init();<br />
&nbsp;curl_setopt($ch, CURLOPT_URL, $url);<br />
&nbsp;curl_setopt($ch, CURLOPT_USERAGENT, 'Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; .NET CLR 1.1.4322)');<br />
&nbsp;curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);<br />
&nbsp;curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, 5);<br />
&nbsp;curl_setopt($ch, CURLOPT_TIMEOUT, 5);<br />
&nbsp;$data = curl_exec($ch);<br />
&nbsp;$httpcode = curl_getinfo($ch, CURLINFO_HTTP_CODE);<br />
&nbsp;curl_close($ch);<br />
&nbsp;return ($httpcode&gt;=200 &amp;&amp; $httpcode&lt;300) ? $data : false;<br />
}<br />
<br />
The source comes from this website:<br />
<br />
<a href="http://softontherocks.blogspot.com/2014/11/descargar-el-contenido-de-una-url.html" rel="nofollow" target="_blank">http://softontherocks.blogspot.com/2014/11/descargar-el-contenido-de-una-url.html</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="113910""></a>
  <div class="note">
   <strong class="user">fred dot knieper at gmail dot com</strong>
   <a href="#113910" class="date">17-Dec-2013 01:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
After a lot of frustration with the fact that nobody has documented which curl commandline options go with which library functions, I discovered that the curl commandline will tell you (in the form of a C program) if you add `--libcurl foo.c`<br />
<br />
If you've been struggling with trying to figure out how to get your fancy curl commandline to work in PHP, this makes it a breeze!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="113074""></a>
  <div class="note">
   <strong class="user">mkucera66 at seznam dot cz</strong>
   <a href="#113074" class="date">27-Aug-2013 08:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
FYI cURL support (default enabled, ok) is prerequisite for Installation and Configuration of the Collection Extension of wiki portal.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="112403""></a>
  <div class="note">
   <strong class="user">arturo at midnightvip dot com</strong>
   <a href="#112403" class="date">12-Jun-2013 07:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hey I modified script for php 5. Also I add support server auth. and fixed some little bugs on the script. <br />
<br />
<span class="default">&lt;?php <br />
&nbsp;</span><span class="keyword">class </span><span class="default">mycurl </span><span class="keyword">{ <br />
&nbsp;&nbsp; &nbsp; protected </span><span class="default">$_useragent </span><span class="keyword">= </span><span class="string">'Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1'</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; protected </span><span class="default">$_url</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; protected </span><span class="default">$_followlocation</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; protected </span><span class="default">$_timeout</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; protected </span><span class="default">$_maxRedirects</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; protected </span><span class="default">$_cookieFileLocation </span><span class="keyword">= </span><span class="string">'./cookie.txt'</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; protected </span><span class="default">$_post</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; protected </span><span class="default">$_postFields</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; protected </span><span class="default">$_referer </span><span class="keyword">=</span><span class="string">"<a href="http://www.midnightvip.com" rel="nofollow" target="_blank">http://www.midnightvip.com</a>"</span><span class="keyword">; <br />
<br />
&nbsp;&nbsp; &nbsp; protected </span><span class="default">$_session</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; protected </span><span class="default">$_webpage</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; protected </span><span class="default">$_includeHeader</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; protected </span><span class="default">$_noBody</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; protected </span><span class="default">$_status</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; protected </span><span class="default">$_binaryTransfer</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; public&nbsp; &nbsp; </span><span class="default">$authentication </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; public&nbsp; &nbsp; </span><span class="default">$auth_name&nbsp; &nbsp; &nbsp; </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; public&nbsp; &nbsp; </span><span class="default">$auth_pass&nbsp; &nbsp; &nbsp; </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">; <br />
<br />
&nbsp;&nbsp; &nbsp; public function </span><span class="default">useAuth</span><span class="keyword">(</span><span class="default">$use</span><span class="keyword">){ <br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">authentication </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; &nbsp; if(</span><span class="default">$use </span><span class="keyword">== </span><span class="default">true</span><span class="keyword">) </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">authentication </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; } <br />
<br />
&nbsp;&nbsp; &nbsp; public function </span><span class="default">setName</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">){ <br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">auth_name </span><span class="keyword">= </span><span class="default">$name</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; } <br />
&nbsp;&nbsp; &nbsp; public function </span><span class="default">setPass</span><span class="keyword">(</span><span class="default">$pass</span><span class="keyword">){ <br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">auth_pass </span><span class="keyword">= </span><span class="default">$pass</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; } <br />
<br />
&nbsp;&nbsp; &nbsp; public function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">,</span><span class="default">$followlocation </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">,</span><span class="default">$timeOut </span><span class="keyword">= </span><span class="default">30</span><span class="keyword">,</span><span class="default">$maxRedirecs </span><span class="keyword">= </span><span class="default">4</span><span class="keyword">,</span><span class="default">$binaryTransfer </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">,</span><span class="default">$includeHeader </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">,</span><span class="default">$noBody </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">) <br />
&nbsp;&nbsp; &nbsp; { <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_url </span><span class="keyword">= </span><span class="default">$url</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_followlocation </span><span class="keyword">= </span><span class="default">$followlocation</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_timeout </span><span class="keyword">= </span><span class="default">$timeOut</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_maxRedirects </span><span class="keyword">= </span><span class="default">$maxRedirecs</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_noBody </span><span class="keyword">= </span><span class="default">$noBody</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_includeHeader </span><span class="keyword">= </span><span class="default">$includeHeader</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_binaryTransfer </span><span class="keyword">= </span><span class="default">$binaryTransfer</span><span class="keyword">; <br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_cookieFileLocation </span><span class="keyword">= </span><span class="default">dirname</span><span class="keyword">(</span><span class="default">__FILE__</span><span class="keyword">).</span><span class="string">'/cookie.txt'</span><span class="keyword">; <br />
<br />
&nbsp;&nbsp; &nbsp; } <br />
<br />
&nbsp;&nbsp; &nbsp; public function </span><span class="default">setReferer</span><span class="keyword">(</span><span class="default">$referer</span><span class="keyword">){ <br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_referer </span><span class="keyword">= </span><span class="default">$referer</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; } <br />
<br />
&nbsp;&nbsp; &nbsp; public function </span><span class="default">setCookiFileLocation</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">) <br />
&nbsp;&nbsp; &nbsp; { <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_cookieFileLocation </span><span class="keyword">= </span><span class="default">$path</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; } <br />
<br />
&nbsp;&nbsp; &nbsp; public function </span><span class="default">setPost </span><span class="keyword">(</span><span class="default">$postFields</span><span class="keyword">) <br />
&nbsp;&nbsp; &nbsp; { <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_post </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_postFields </span><span class="keyword">= </span><span class="default">$postFields</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; } <br />
<br />
&nbsp;&nbsp; &nbsp; public function </span><span class="default">setUserAgent</span><span class="keyword">(</span><span class="default">$userAgent</span><span class="keyword">) <br />
&nbsp;&nbsp; &nbsp; { <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_useragent </span><span class="keyword">= </span><span class="default">$userAgent</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; } <br />
<br />
&nbsp;&nbsp; &nbsp; public function </span><span class="default">createCurl</span><span class="keyword">(</span><span class="default">$url </span><span class="keyword">= </span><span class="string">'nul'</span><span class="keyword">) <br />
&nbsp;&nbsp; &nbsp; { <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$url </span><span class="keyword">!= </span><span class="string">'nul'</span><span class="keyword">){ <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_url </span><span class="keyword">= </span><span class="default">$url</span><span class="keyword">; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } <br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$s </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">(); <br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">,</span><span class="default">CURLOPT_URL</span><span class="keyword">,</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_url</span><span class="keyword">); <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">,</span><span class="default">CURLOPT_HTTPHEADER</span><span class="keyword">,array(</span><span class="string">'Expect:'</span><span class="keyword">)); <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">,</span><span class="default">CURLOPT_TIMEOUT</span><span class="keyword">,</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_timeout</span><span class="keyword">); <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">,</span><span class="default">CURLOPT_MAXREDIRS</span><span class="keyword">,</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_maxRedirects</span><span class="keyword">); <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">,</span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">,</span><span class="default">true</span><span class="keyword">); <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">,</span><span class="default">CURLOPT_FOLLOWLOCATION</span><span class="keyword">,</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_followlocation</span><span class="keyword">); <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">,</span><span class="default">CURLOPT_COOKIEJAR</span><span class="keyword">,</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_cookieFileLocation</span><span class="keyword">); <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">,</span><span class="default">CURLOPT_COOKIEFILE</span><span class="keyword">,</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_cookieFileLocation</span><span class="keyword">); <br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">authentication </span><span class="keyword">== </span><span class="default">1</span><span class="keyword">){ <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">, </span><span class="default">CURLOPT_USERPWD</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">auth_name</span><span class="keyword">.</span><span class="string">':'</span><span class="keyword">.</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">auth_pass</span><span class="keyword">); <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; } <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_post</span><span class="keyword">) <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; { <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">,</span><span class="default">CURLOPT_POST</span><span class="keyword">,</span><span class="default">true</span><span class="keyword">); <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">,</span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">,</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_postFields</span><span class="keyword">); <br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; } <br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_includeHeader</span><span class="keyword">) <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; { <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">,</span><span class="default">CURLOPT_HEADER</span><span class="keyword">,</span><span class="default">true</span><span class="keyword">); <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; } <br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_noBody</span><span class="keyword">) <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; { <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">,</span><span class="default">CURLOPT_NOBODY</span><span class="keyword">,</span><span class="default">true</span><span class="keyword">); <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; } <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">/* <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; if($this-&gt;_binary) <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; { <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; curl_setopt($s,CURLOPT_BINARYTRANSFER,true); <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; } <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; */ <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">,</span><span class="default">CURLOPT_USERAGENT</span><span class="keyword">,</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_useragent</span><span class="keyword">); <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">,</span><span class="default">CURLOPT_REFERER</span><span class="keyword">,</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_referer</span><span class="keyword">); <br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_webpage </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">); <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_status </span><span class="keyword">= </span><span class="default">curl_getinfo</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">,</span><span class="default">CURLINFO_HTTP_CODE</span><span class="keyword">); <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">); <br />
<br />
&nbsp;&nbsp; &nbsp; } <br />
<br />
&nbsp;&nbsp; public function </span><span class="default">getHttpStatus</span><span class="keyword">() <br />
&nbsp;&nbsp; { <br />
&nbsp;&nbsp; &nbsp; &nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_status</span><span class="keyword">; <br />
&nbsp;&nbsp; } <br />
<br />
&nbsp;&nbsp; public function </span><span class="default">__tostring</span><span class="keyword">(){ <br />
&nbsp;&nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_webpage</span><span class="keyword">; <br />
&nbsp;&nbsp; } <br />
} <br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="103600""></a>
  <div class="note">
   <strong class="user">madhouse-network at hotmail dot com</strong>
   <a href="#103600" class="date">21-Apr-2011 10:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
curl does not seem to work with SSL TLS (FTPES)<br />
<br />
It will throw the following error:<br />
<br />
(1) Protocol ftpes not supported or disabled in libcurl</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102885""></a>
  <div class="note">
   <strong class="user">frank at interactinet dot com</strong>
   <a href="#102885" class="date">12-Mar-2011 06:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I wrote the following to see if a submitted URL has a valid http response code and also if it responds quickly. 
<br />

<br />
Use the code like this:
<br />

<br />
<span class="default">&lt;?php
<br />
$is_ok </span><span class="keyword">= </span><span class="default">http_response</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">); </span><span class="comment">// returns true only if http response code &lt; 400
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
The second argument is optional, and it allows you to check for&nbsp; a specific response code
<br />

<br />
<span class="default">&lt;?php
<br />
http_response</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">,</span><span class="string">'400'</span><span class="keyword">); </span><span class="comment">// returns true if http status is 400
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
The third allows you to specify how long you are willing to wait for a response.
<br />

<br />
<span class="default">&lt;?php
<br />
http_response</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">,</span><span class="string">'200'</span><span class="keyword">,</span><span class="default">3</span><span class="keyword">); </span><span class="comment">// returns true if the response takes less than 3 seconds and the response code is 200
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">http_response</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">, </span><span class="default">$status </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">, </span><span class="default">$wait </span><span class="keyword">= </span><span class="default">3</span><span class="keyword">)
<br />
{
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$time </span><span class="keyword">= </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$expire </span><span class="keyword">= </span><span class="default">$time </span><span class="keyword">+ </span><span class="default">$wait</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// we fork the process so we don't have to wait for a timeout
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pid </span><span class="keyword">= </span><span class="default">pcntl_fork</span><span class="keyword">();
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$pid </span><span class="keyword">== -</span><span class="default">1</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; die(</span><span class="string">'could not fork'</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else if (</span><span class="default">$pid</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// we are the parent
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">();
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="default">$url</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_HEADER</span><span class="keyword">, </span><span class="default">TRUE</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_NOBODY</span><span class="keyword">, </span><span class="default">TRUE</span><span class="keyword">); </span><span class="comment">// remove body
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">TRUE</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$head </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$httpCode </span><span class="keyword">= </span><span class="default">curl_getinfo</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLINFO_HTTP_CODE</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(!</span><span class="default">$head</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">FALSE</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$status </span><span class="keyword">=== </span><span class="default">null</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$httpCode </span><span class="keyword">&lt; </span><span class="default">400</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">TRUE</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">FALSE</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; elseif(</span><span class="default">$status </span><span class="keyword">== </span><span class="default">$httpCode</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">TRUE</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">FALSE</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">pcntl_wait</span><span class="keyword">(</span><span class="default">$status</span><span class="keyword">); </span><span class="comment">//Protect against Zombie children
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">} else {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// we are the child
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">while(</span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">) &lt; </span><span class="default">$expire</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">sleep</span><span class="keyword">(</span><span class="default">0.5</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">FALSE</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Hope this example helps.&nbsp; It is not 100% tested, so any feedback [sent directly to me by email] is appreciated.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="101953""></a>
  <div class="note">
   <strong class="user">shidec00 at yahoo dot com</strong>
   <a href="#101953" class="date">19-Jan-2011 11:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This anomali only happen on windows.
<br />
Server indicates that some variables built by http_build_query() is missing.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="comment">//...
<br />
//...
<br />
//...
<br />
</span><span class="default">$ping_url </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">sx_url</span><span class="keyword">.</span><span class="string">'ping.php?'</span><span class="keyword">.</span><span class="default">http_build_query</span><span class="keyword">(</span><span class="default">$options</span><span class="keyword">);
<br />
</span><span class="default">$message </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_post_curl</span><span class="keyword">(</span><span class="default">$ping_url</span><span class="keyword">);
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
After debugging i found that $ping_url contain url like :
<br />

<br />
<a href="http://example.com/ping.php?app=1&amp;amp;key=mail&amp;amp;ttd=df52861e" rel="nofollow" target="_blank">http://example.com/ping.php?app=1&amp;amp;key=mail&amp;amp;ttd=df52861e</a>
<br />

<br />
But myserver give "No ttd GET variable" response
<br />

<br />
This problem fixed by adding optional parameter to make sure that http_build_query() use only '&amp;' as arg separator rather than '&amp;amp;'
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="comment">//...
<br />
//...
<br />
//...
<br />
</span><span class="default">$ping_url </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">sx_url</span><span class="keyword">.</span><span class="string">'ping.php?'</span><span class="keyword">.</span><span class="default">http_build_query</span><span class="keyword">(</span><span class="default">$options</span><span class="keyword">,</span><span class="string">''</span><span class="keyword">,</span><span class="string">'&amp;'</span><span class="keyword">);
<br />
</span><span class="default">$message </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_post_curl</span><span class="keyword">(</span><span class="default">$ping_url</span><span class="keyword">);
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100646""></a>
  <div class="note">
   <strong class="user">ramez at  dot dontspan dot zegenie dot com</strong>
   <a href="#100646" class="date">28-Oct-2010 06:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
CURL failed with PHP5.3 and Apache2.2.X on my Windows 7 machine. <br />
<br />
It turns out that it's not enough to copy the two dll's mentioned (libeay32 and sslea32) from the php folder into your system32 folder. You HAVE TO UNBLOCK THESE TWO FILES.<br />
<br />
Right click the file, select unblock, for each one. Then restart Apache.<br />
<br />
Another very handy security feature added into Windows.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99979""></a>
  <div class="note">
   <strong class="user">artax_N_O_S_P_A_M_erxes2 at iname dot com</strong>
   <a href="#99979" class="date">17-Sep-2010 05:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I needed to use cURL in a php script to download data using not only SSL for the server authentication but also for client authentication.
<br />
On a default install of Fedora, setting up the proper cURL parameters, I would get an error: 
<br />

<br />
$ php curl.php
<br />
&nbsp;Peer certificate cannot be authenticated with known CA certificates
<br />

<br />
The data on <a href="http://curl.haxx.se/docs/sslcerts.html was most useful. Indeed, toward to bottom it tells you to add a missing link inside /etc/pki/nssdb to use the ca-bundle.crt file. You do it so:" rel="nofollow" target="_blank">http://curl.haxx.se/docs/sslcerts.html was most useful. Indeed, toward to bottom it tells you to add a missing link inside /etc/pki/nssdb to use the ca-bundle.crt file. You do it so:</a>
<br />

<br />
# cd /etc/pki/nssdb
<br />
# ln -s /usr/lib64/libnssckbi.so libnssckbi.so
<br />

<br />
Now you can do client authentication, provided you have your certificate handy with:
<br />

<br />
<span class="default">&lt;?php
<br />
$data </span><span class="keyword">= </span><span class="string">"&lt;soap:Envelope&gt;[...]&lt;/soap:Envelope&gt;"</span><span class="keyword">;
<br />
</span><span class="default">$tuCurl </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">();
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$tuCurl</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="string">"https://example.com/path/for/soap/url/"</span><span class="keyword">);
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$tuCurl</span><span class="keyword">, </span><span class="default">CURLOPT_PORT </span><span class="keyword">, </span><span class="default">443</span><span class="keyword">);
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$tuCurl</span><span class="keyword">, </span><span class="default">CURLOPT_VERBOSE</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$tuCurl</span><span class="keyword">, </span><span class="default">CURLOPT_HEADER</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$tuCurl</span><span class="keyword">, </span><span class="default">CURLOPT_SSLVERSION</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">);
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$tuCurl</span><span class="keyword">, </span><span class="default">CURLOPT_SSLCERT</span><span class="keyword">, </span><span class="default">getcwd</span><span class="keyword">() . </span><span class="string">"/client.pem"</span><span class="keyword">);
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$tuCurl</span><span class="keyword">, </span><span class="default">CURLOPT_SSLKEY</span><span class="keyword">, </span><span class="default">getcwd</span><span class="keyword">() . </span><span class="string">"/keyout.pem"</span><span class="keyword">);
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$tuCurl</span><span class="keyword">, </span><span class="default">CURLOPT_CAINFO</span><span class="keyword">, </span><span class="default">getcwd</span><span class="keyword">() . </span><span class="string">"/ca.pem"</span><span class="keyword">);
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$tuCurl</span><span class="keyword">, </span><span class="default">CURLOPT_POST</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$tuCurl</span><span class="keyword">, </span><span class="default">CURLOPT_SSL_VERIFYPEER</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$tuCurl</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$tuCurl</span><span class="keyword">, </span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">);
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$tuCurl</span><span class="keyword">, </span><span class="default">CURLOPT_HTTPHEADER</span><span class="keyword">, array(</span><span class="string">"Content-Type: text/xml"</span><span class="keyword">,</span><span class="string">"SOAPAction: \"/soap/action/query\""</span><span class="keyword">, </span><span class="string">"Content-length: "</span><span class="keyword">.</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">)));
<br />

<br />
</span><span class="default">$tuData </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$tuCurl</span><span class="keyword">);
<br />
if(!</span><span class="default">curl_errno</span><span class="keyword">(</span><span class="default">$tuCurl</span><span class="keyword">)){
<br />
&nbsp; </span><span class="default">$info </span><span class="keyword">= </span><span class="default">curl_getinfo</span><span class="keyword">(</span><span class="default">$tuCurl</span><span class="keyword">);
<br />
&nbsp; echo </span><span class="string">'Took ' </span><span class="keyword">. </span><span class="default">$info</span><span class="keyword">[</span><span class="string">'total_time'</span><span class="keyword">] . </span><span class="string">' seconds to send a request to ' </span><span class="keyword">. </span><span class="default">$info</span><span class="keyword">[</span><span class="string">'url'</span><span class="keyword">];
<br />
} else {
<br />
&nbsp; echo </span><span class="string">'Curl error: ' </span><span class="keyword">. </span><span class="default">curl_error</span><span class="keyword">(</span><span class="default">$tuCurl</span><span class="keyword">);
<br />
}
<br />

<br />
</span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$tuCurl</span><span class="keyword">);
<br />
echo </span><span class="default">$tuData</span><span class="keyword">;
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="97160""></a>
  <div class="note">
   <strong class="user">cliffclof atty gmail dotty com</strong>
   <a href="#97160" class="date">05-Apr-2010 11:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A solution that addresses repeat calls to the same set of urls using the same connection simulating frequent ajax calls in separate browser tabs.
<br />

<br />
In a unique situation you may need to set a cookie then use that cookie for multiple separate persistent connections using the same session cookie.&nbsp; The problem is the session cookie may change while your doing your persistent calls.&nbsp; If you set every curl handle to update a shared cookiejar on close you may overwrite the new found session value with the old session value depending on the closing order of your handles. Also, because the cookiejar is only written to on a curl_close, you may be using dissimilar or old session info in some of your 'faked browser tabs'.
<br />

<br />
To solve this problem I created a unique handle that opens and closes specifically to set a cookie file using CURLOPT_COOKIEJAR. Then I just use the read-only CURLOPT_COOKIEFILE on the multiple separate persistent handles.
<br />

<br />
This solves the problem of shared cookies fighting to write their values and keep persistent calls using the most up to date cookie information.
<br />

<br />
Note: In my case the multiple calls were in a while loop and I was using php in shell.&nbsp; The session cookie value plus browser type limited the number of connections available and i wanted to use the max connections per session.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="90821""></a>
  <div class="note">
   <strong class="user">artem at zabsoft dot co dot in</strong>
   <a href="#90821" class="date">11-May-2009 08:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hey I modified script for php 5. Also I add support server auth. and fixed some little bugs on the script.
<br />

<br />
[EDIT BY danbrown AT php DOT net: Original was written by (unlcuky13 AT gmail DOT com) on 19-APR-09.&nbsp; The following note was included:
<br />
Below is the my way of using through PHP 5 objecte oriented encapsulation to make thing easier.]
<br />

<br />
<span class="default">&lt;?php
<br />
&nbsp;</span><span class="keyword">class </span><span class="default">mycurl </span><span class="keyword">{
<br />
&nbsp;&nbsp; &nbsp; protected </span><span class="default">$_useragent </span><span class="keyword">= </span><span class="string">'Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1'</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; protected </span><span class="default">$_url</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; protected </span><span class="default">$_followlocation</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; protected </span><span class="default">$_timeout</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; protected </span><span class="default">$_maxRedirects</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; protected </span><span class="default">$_cookieFileLocation </span><span class="keyword">= </span><span class="string">'./cookie.txt'</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; protected </span><span class="default">$_post</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; protected </span><span class="default">$_postFields</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; protected </span><span class="default">$_referer </span><span class="keyword">=</span><span class="string">"<a href="http://www.google.com" rel="nofollow" target="_blank">http://www.google.com</a>"</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp; &nbsp; protected </span><span class="default">$_session</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; protected </span><span class="default">$_webpage</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; protected </span><span class="default">$_includeHeader</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; protected </span><span class="default">$_noBody</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; protected </span><span class="default">$_status</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; protected </span><span class="default">$_binaryTransfer</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; public&nbsp; &nbsp; </span><span class="default">$authentication </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; public&nbsp; &nbsp; </span><span class="default">$auth_name&nbsp; &nbsp; &nbsp; </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; public&nbsp; &nbsp; </span><span class="default">$auth_pass&nbsp; &nbsp; &nbsp; </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp; &nbsp; public function </span><span class="default">useAuth</span><span class="keyword">(</span><span class="default">$use</span><span class="keyword">){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">authentication </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; if(</span><span class="default">$use </span><span class="keyword">== </span><span class="default">true</span><span class="keyword">) </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">authentication </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; }
<br />

<br />
&nbsp;&nbsp; &nbsp; public function </span><span class="default">setName</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">auth_name </span><span class="keyword">= </span><span class="default">$name</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; }
<br />
&nbsp;&nbsp; &nbsp; public function </span><span class="default">setPass</span><span class="keyword">(</span><span class="default">$pass</span><span class="keyword">){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">auth_pass </span><span class="keyword">= </span><span class="default">$pass</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; }
<br />

<br />
&nbsp;&nbsp; &nbsp; public function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">,</span><span class="default">$followlocation </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">,</span><span class="default">$timeOut </span><span class="keyword">= </span><span class="default">30</span><span class="keyword">,</span><span class="default">$maxRedirecs </span><span class="keyword">= </span><span class="default">4</span><span class="keyword">,</span><span class="default">$binaryTransfer </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">,</span><span class="default">$includeHeader </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">,</span><span class="default">$noBody </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_url </span><span class="keyword">= </span><span class="default">$url</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_followlocation </span><span class="keyword">= </span><span class="default">$followlocation</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_timeout </span><span class="keyword">= </span><span class="default">$timeOut</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_maxRedirects </span><span class="keyword">= </span><span class="default">$maxRedirecs</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_noBody </span><span class="keyword">= </span><span class="default">$noBody</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_includeHeader </span><span class="keyword">= </span><span class="default">$includeHeader</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_binaryTransfer </span><span class="keyword">= </span><span class="default">$binaryTransfer</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_cookieFileLocation </span><span class="keyword">= </span><span class="default">dirname</span><span class="keyword">(</span><span class="default">__FILE__</span><span class="keyword">).</span><span class="string">'/cookie.txt'</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp; &nbsp; }
<br />

<br />
&nbsp;&nbsp; &nbsp; public function </span><span class="default">setReferer</span><span class="keyword">(</span><span class="default">$referer</span><span class="keyword">){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_referer </span><span class="keyword">= </span><span class="default">$referer</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; }
<br />

<br />
&nbsp;&nbsp; &nbsp; public function </span><span class="default">setCookiFileLocation</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_cookieFileLocation </span><span class="keyword">= </span><span class="default">$path</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; }
<br />

<br />
&nbsp;&nbsp; &nbsp; public function </span><span class="default">setPost </span><span class="keyword">(</span><span class="default">$postFields</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_post </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_postFields </span><span class="keyword">= </span><span class="default">$postFields</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; }
<br />

<br />
&nbsp;&nbsp; &nbsp; public function </span><span class="default">setUserAgent</span><span class="keyword">(</span><span class="default">$userAgent</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_useragent </span><span class="keyword">= </span><span class="default">$userAgent</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; }
<br />

<br />
&nbsp;&nbsp; &nbsp; public function </span><span class="default">createCurl</span><span class="keyword">(</span><span class="default">$url </span><span class="keyword">= </span><span class="string">'nul'</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$url </span><span class="keyword">!= </span><span class="string">'nul'</span><span class="keyword">){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_url </span><span class="keyword">= </span><span class="default">$url</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$s </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">();
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">,</span><span class="default">CURLOPT_URL</span><span class="keyword">,</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_url</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">,</span><span class="default">CURLOPT_HTTPHEADER</span><span class="keyword">,array(</span><span class="string">'Expect:'</span><span class="keyword">));
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">,</span><span class="default">CURLOPT_TIMEOUT</span><span class="keyword">,</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_timeout</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">,</span><span class="default">CURLOPT_MAXREDIRS</span><span class="keyword">,</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_maxRedirects</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">,</span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">,</span><span class="default">true</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">,</span><span class="default">CURLOPT_FOLLOWLOCATION</span><span class="keyword">,</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_followlocation</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">,</span><span class="default">CURLOPT_COOKIEJAR</span><span class="keyword">,</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_cookieFileLocation</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">,</span><span class="default">CURLOPT_COOKIEFILE</span><span class="keyword">,</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_cookieFileLocation</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">authentication </span><span class="keyword">== </span><span class="default">1</span><span class="keyword">){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">, </span><span class="default">CURLOPT_USERPWD</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">auth_name</span><span class="keyword">.</span><span class="string">':'</span><span class="keyword">.</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">auth_pass</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_post</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">,</span><span class="default">CURLOPT_POST</span><span class="keyword">,</span><span class="default">true</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">,</span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">,</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_postFields</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; }
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_includeHeader</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">,</span><span class="default">CURLOPT_HEADER</span><span class="keyword">,</span><span class="default">true</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; }
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; if(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_noBody</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">,</span><span class="default">CURLOPT_NOBODY</span><span class="keyword">,</span><span class="default">true</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">/*
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; if($this-&gt;_binary)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; curl_setopt($s,CURLOPT_BINARYTRANSFER,true);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; */
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">,</span><span class="default">CURLOPT_USERAGENT</span><span class="keyword">,</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_useragent</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">,</span><span class="default">CURLOPT_REFERER</span><span class="keyword">,</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_referer</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_webpage </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_status </span><span class="keyword">= </span><span class="default">curl_getinfo</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">,</span><span class="default">CURLINFO_HTTP_CODE</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp; &nbsp; }
<br />

<br />
&nbsp;&nbsp; public function </span><span class="default">getHttpStatus</span><span class="keyword">()
<br />
&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_status</span><span class="keyword">;
<br />
&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp; public function </span><span class="default">__tostring</span><span class="keyword">(){
<br />
&nbsp;&nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_webpage</span><span class="keyword">;
<br />
&nbsp;&nbsp; }
<br />
}
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
[EDIT BY danbrown AT php DOT net: Contains a bugfix supplied by "roetsch.beni at googlemail (dot) com" on 02-AUG-09, with the following note: "Fixes the bugfix: 417 bug at lighthttp server."]</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="89669""></a>
  <div class="note">
   <strong class="user">admin at jeremyzaretski dot com</strong>
   <a href="#89669" class="date">18-Mar-2009 05:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I wanted to create a script that acted as a bridge between an external server and an internal server, wherein the internal server was not connected to the internet, but had information required by the users connecting to the external server. I hatched the idea to use curl to connect from the external server to the internal server (using request variables to send queries) and return everything (data and headers) returned by the file server.
<br />

<br />
After being driven mad by segmentation faults and crashes because the curl_exec didn't like me having the CURLOPT_HEADERFUNCTION's function directly dumping the header:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">Duplicate_Header</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">, </span><span class="default">$header</span><span class="keyword">)
<br />
{
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="default">$header</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$header</span><span class="keyword">);
<br />
}
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
... I tried (on a whim) duplicating and trimming the header and passing the duplicate to the header function...
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">Duplicate_Header</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">, </span><span class="default">$header</span><span class="keyword">)
<br />
{
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$duplicate </span><span class="keyword">= </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$header</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="default">$duplicate</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$header</span><span class="keyword">);
<br />
}
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Which worked just fine. I don't know if this is just some quirk of PHP4 or my lack of understanding of how the curl and header function works.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86391""></a>
  <div class="note">
   <strong class="user">pyromus at gmail dot com</strong>
   <a href="#86391" class="date">16-Oct-2008 01:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You can use this class for fast entry
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">class </span><span class="default">cURL </span><span class="keyword">{
<br />
var </span><span class="default">$headers</span><span class="keyword">;
<br />
var </span><span class="default">$user_agent</span><span class="keyword">;
<br />
var </span><span class="default">$compression</span><span class="keyword">;
<br />
var </span><span class="default">$cookie_file</span><span class="keyword">;
<br />
var </span><span class="default">$proxy</span><span class="keyword">;
<br />
function </span><span class="default">cURL</span><span class="keyword">(</span><span class="default">$cookies</span><span class="keyword">=</span><span class="default">TRUE</span><span class="keyword">,</span><span class="default">$cookie</span><span class="keyword">=</span><span class="string">'cookies.txt'</span><span class="keyword">,</span><span class="default">$compression</span><span class="keyword">=</span><span class="string">'gzip'</span><span class="keyword">,</span><span class="default">$proxy</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">) {
<br />
</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">headers</span><span class="keyword">[] = </span><span class="string">'Accept: image/gif, image/x-bitmap, image/jpeg, image/pjpeg'</span><span class="keyword">;
<br />
</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">headers</span><span class="keyword">[] = </span><span class="string">'Connection: Keep-Alive'</span><span class="keyword">;
<br />
</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">headers</span><span class="keyword">[] = </span><span class="string">'Content-type: application/x-www-form-urlencoded;CHARSET=gb2312'</span><span class="keyword">;
<br />
</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">user_agent </span><span class="keyword">= </span><span class="string">'Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; .NET CLR 1.0.3705; .NET CLR 1.1.4322; Media Center PC 4.0)'</span><span class="keyword">;
<br />
</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">compression</span><span class="keyword">=</span><span class="default">$compression</span><span class="keyword">;
<br />
</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">proxy</span><span class="keyword">=</span><span class="default">$proxy</span><span class="keyword">;
<br />
</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">cookies</span><span class="keyword">=</span><span class="default">$cookies</span><span class="keyword">;
<br />
if (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">cookies </span><span class="keyword">== </span><span class="default">TRUE</span><span class="keyword">) </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">cookie</span><span class="keyword">(</span><span class="default">$cookie</span><span class="keyword">);
<br />
}
<br />
function </span><span class="default">cookie</span><span class="keyword">(</span><span class="default">$cookie_file</span><span class="keyword">) {
<br />
if (</span><span class="default">file_exists</span><span class="keyword">(</span><span class="default">$cookie_file</span><span class="keyword">)) {
<br />
</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">cookie_file</span><span class="keyword">=</span><span class="default">$cookie_file</span><span class="keyword">;
<br />
} else {
<br />
</span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$cookie_file</span><span class="keyword">,</span><span class="string">'w'</span><span class="keyword">) or </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">error</span><span class="keyword">(</span><span class="string">'The cookie file could not be opened. Make sure this directory has the correct permissions'</span><span class="keyword">);
<br />
</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">cookie_file</span><span class="keyword">=</span><span class="default">$cookie_file</span><span class="keyword">;
<br />
</span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">cookie_file</span><span class="keyword">);
<br />
}
<br />
}
<br />
function </span><span class="default">get</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">) {
<br />
</span><span class="default">$process </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">);
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$process</span><span class="keyword">, </span><span class="default">CURLOPT_HTTPHEADER</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">headers</span><span class="keyword">);
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$process</span><span class="keyword">, </span><span class="default">CURLOPT_HEADER</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$process</span><span class="keyword">, </span><span class="default">CURLOPT_USERAGENT</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">user_agent</span><span class="keyword">);
<br />
if (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">cookies </span><span class="keyword">== </span><span class="default">TRUE</span><span class="keyword">) </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$process</span><span class="keyword">, </span><span class="default">CURLOPT_COOKIEFILE</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">cookie_file</span><span class="keyword">);
<br />
if (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">cookies </span><span class="keyword">== </span><span class="default">TRUE</span><span class="keyword">) </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$process</span><span class="keyword">, </span><span class="default">CURLOPT_COOKIEJAR</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">cookie_file</span><span class="keyword">);
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$process</span><span class="keyword">,</span><span class="default">CURLOPT_ENCODING </span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">compression</span><span class="keyword">);
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$process</span><span class="keyword">, </span><span class="default">CURLOPT_TIMEOUT</span><span class="keyword">, </span><span class="default">30</span><span class="keyword">);
<br />
if (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">proxy</span><span class="keyword">) </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$process</span><span class="keyword">, </span><span class="default">CURLOPT_PROXY</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">proxy</span><span class="keyword">);
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$process</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$process</span><span class="keyword">, </span><span class="default">CURLOPT_FOLLOWLOCATION</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);
<br />
</span><span class="default">$return </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$process</span><span class="keyword">);
<br />
</span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$process</span><span class="keyword">);
<br />
return </span><span class="default">$return</span><span class="keyword">;
<br />
}
<br />
function </span><span class="default">post</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">,</span><span class="default">$data</span><span class="keyword">) {
<br />
</span><span class="default">$process </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">);
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$process</span><span class="keyword">, </span><span class="default">CURLOPT_HTTPHEADER</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">headers</span><span class="keyword">);
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$process</span><span class="keyword">, </span><span class="default">CURLOPT_HEADER</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$process</span><span class="keyword">, </span><span class="default">CURLOPT_USERAGENT</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">user_agent</span><span class="keyword">);
<br />
if (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">cookies </span><span class="keyword">== </span><span class="default">TRUE</span><span class="keyword">) </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$process</span><span class="keyword">, </span><span class="default">CURLOPT_COOKIEFILE</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">cookie_file</span><span class="keyword">);
<br />
if (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">cookies </span><span class="keyword">== </span><span class="default">TRUE</span><span class="keyword">) </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$process</span><span class="keyword">, </span><span class="default">CURLOPT_COOKIEJAR</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">cookie_file</span><span class="keyword">);
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$process</span><span class="keyword">, </span><span class="default">CURLOPT_ENCODING </span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">compression</span><span class="keyword">);
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$process</span><span class="keyword">, </span><span class="default">CURLOPT_TIMEOUT</span><span class="keyword">, </span><span class="default">30</span><span class="keyword">);
<br />
if (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">proxy</span><span class="keyword">) </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$process</span><span class="keyword">, </span><span class="default">CURLOPT_PROXY</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">proxy</span><span class="keyword">);
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$process</span><span class="keyword">, </span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">);
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$process</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$process</span><span class="keyword">, </span><span class="default">CURLOPT_FOLLOWLOCATION</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);
<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$process</span><span class="keyword">, </span><span class="default">CURLOPT_POST</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);
<br />
</span><span class="default">$return </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$process</span><span class="keyword">);
<br />
</span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$process</span><span class="keyword">);
<br />
return </span><span class="default">$return</span><span class="keyword">;
<br />
}
<br />
function </span><span class="default">error</span><span class="keyword">(</span><span class="default">$error</span><span class="keyword">) {
<br />
echo </span><span class="string">"&lt;center&gt;&lt;div style='width:500px;border: 3px solid #FFEEFF; padding: 3px; background-color: #FFDDFF;font-family: verdana; font-size: 10px'&gt;&lt;b&gt;cURL Error&lt;/b&gt;&lt;br&gt;</span><span class="default">$error</span><span class="string">&lt;/div&gt;&lt;/center&gt;"</span><span class="keyword">;
<br />
die;
<br />
}
<br />
}
<br />
</span><span class="default">$cc </span><span class="keyword">= new </span><span class="default">cURL</span><span class="keyword">();
<br />
</span><span class="default">$cc</span><span class="keyword">-&gt;</span><span class="default">get</span><span class="keyword">(</span><span class="string">'<a href="http://www.example.com" rel="nofollow" target="_blank">http://www.example.com</a>'</span><span class="keyword">);
<br />
</span><span class="default">$cc</span><span class="keyword">-&gt;</span><span class="default">post</span><span class="keyword">(</span><span class="string">'<a href="http://www.example.com" rel="nofollow" target="_blank">http://www.example.com</a>'</span><span class="keyword">,</span><span class="string">'foo=bar'</span><span class="keyword">);
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
[EDIT BY danbrown AT php DOT net: Includes a bugfix provided by "Anonymous" on 01-Dec-2008 @ 06:52.&nbsp; Also replaced real URL with example.com as per RFC 2606.]
<br />

<br />
[EDIT BY danbrown AT php DOT net: Includes a bugfix provided by (manuel AT rankone DOT ch) on 24-NOV-09 to properly reference cURL initialization.]</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86143""></a>
  <div class="note">
   <strong class="user">eflash at gmx dot net</strong>
   <a href="#86143" class="date">05-Oct-2008 06:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In order to use curl with secure sites you will need a ca-bundle.crt file; here's a PHP script I've written which creates a fresh ca-bundle:<br />
<a href="http://www.gknw.net/php/phpscripts/mk-ca-bundle.php" rel="nofollow" target="_blank">http://www.gknw.net/php/phpscripts/mk-ca-bundle.php</a><br />
I've also written scripts in other languages, f.e. the Perl one which ships now with curl distributions:<br />
<a href="http://curl.haxx.se/lxr/source/lib/mk-ca-bundle.pl" rel="nofollow" target="_blank">http://curl.haxx.se/lxr/source/lib/mk-ca-bundle.pl</a><br />
and also a Win32 WSH script if you prefer that:<br />
<a href="http://www.gknw.net/vb/scripts/mk-ca-bundle.vbs" rel="nofollow" target="_blank">http://www.gknw.net/vb/scripts/mk-ca-bundle.vbs</a><br />
<br />
HTH, Guenter.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
