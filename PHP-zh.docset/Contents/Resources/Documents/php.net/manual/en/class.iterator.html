<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>Iterator（迭代器）接口</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="class.traversable.html">? 遍历</a></li>
      <li style="float: right;"><a href="iterator.current.html">Iterator::current ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="reserved.interfaces.html">预定义接口</a></li>
    <li>Iterator（迭代器）接口</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="class.iterator" class="reference">

 <h1 class="title">Iterator（迭代器）接口</h1>
 

 <div class="partintro"><p class="verinfo">(No version information available, might only be in Git)</p>


  <div class="section" id="iterator.intro">
   <h2 class="title">简介</h2>
   <p class="para">
    可在内部迭代自己的外部迭代器或类的接口。
   </p>
  </div>


  <div class="section" id="iterator.synopsis">
   <h2 class="title">接口摘要</h2>


   <div class="classsynopsis">
    <div class="ooclass"></div>


    <div class="classsynopsisinfo">
     <span class="ooclass">
      <strong class="classname">Iterator</strong>
     </span>
     
     <span class="ooclass">
      <span class="modifier">extends</span>
      <strong class="classname">Traversable</strong>
     </span>
     {</div>

    
    <div class="classsynopsisinfo classsynopsisinfo_comment">/* 方法 */</div>
    <div class="methodsynopsis dc-description">
   <span class="modifier">abstract</span> <span class="modifier">public</span> <span class="type">mixed</span> <span class="methodname"><a href="iterator.current.html" class="methodname">current</a></span>
    ( <span class="methodparam">void</span>
   )</div>
<div class="methodsynopsis dc-description">
   <span class="modifier">abstract</span> <span class="modifier">public</span> <span class="type">scalar</span> <span class="methodname"><a href="iterator.key.html" class="methodname">key</a></span>
    ( <span class="methodparam">void</span>
   )</div>
<div class="methodsynopsis dc-description">
   <span class="modifier">abstract</span> <span class="modifier">public</span> <span class="type">void</span> <span class="methodname"><a href="iterator.next.html" class="methodname">next</a></span>
    ( <span class="methodparam">void</span>
   )</div>
<div class="methodsynopsis dc-description">
   <span class="modifier">abstract</span> <span class="modifier">public</span> <span class="type">void</span> <span class="methodname"><a href="iterator.rewind.html" class="methodname">rewind</a></span>
    ( <span class="methodparam">void</span>
   )</div>
<div class="methodsynopsis dc-description">
   <span class="modifier">abstract</span> <span class="modifier">public</span> <span class="type">boolean</span> <span class="methodname"><a href="iterator.valid.html" class="methodname">valid</a></span>
    ( <span class="methodparam">void</span>
   )</div>

   }</div>


  </div>
  
  <div class="section" id="iterator.iterators">
   <h2 class="title">预定义迭代器</h2>
   <p class="para">
    PHP 已经提供了一些用于日常任务的迭代器。
    详细列表参见 <a href="spl.iterators.html" class="link">SPL 迭代器</a>。
   </p>
  </div>
  
  <div class="section" id="iterator.examples">
  <h2 class="title">范例</h2>
   <div class="example" id="iterator.example.basic">
    <p><strong>Example #1 基本用法</strong></p>
    <div class="example-contents"><p>
     这个例子展示了使用 <a href="control-structures.foreach.html" class="link">foreach</a> 时，迭代器方法的调用顺序。
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">myIterator&nbsp;</span><span style="color: #007700">implements&nbsp;</span><span style="color: #0000BB">Iterator&nbsp;</span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;</span><span style="color: #0000BB">$position&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;</span><span style="color: #0000BB">$array&nbsp;</span><span style="color: #007700">=&nbsp;array(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"firstelement"</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"secondelement"</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"lastelement"</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;);&nbsp;&nbsp;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">__construct</span><span style="color: #007700">()&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">position&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;</span><span style="color: #0000BB">rewind</span><span style="color: #007700">()&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">__METHOD__</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">position&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;</span><span style="color: #0000BB">current</span><span style="color: #007700">()&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">__METHOD__</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">array</span><span style="color: #007700">[</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">position</span><span style="color: #007700">];<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;</span><span style="color: #0000BB">key</span><span style="color: #007700">()&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">__METHOD__</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">position</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;</span><span style="color: #0000BB">next</span><span style="color: #007700">()&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">__METHOD__</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">position</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;</span><span style="color: #0000BB">valid</span><span style="color: #007700">()&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">__METHOD__</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;isset(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">array</span><span style="color: #007700">[</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">position</span><span style="color: #007700">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /><br /></span><span style="color: #0000BB">$it&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">myIterator</span><span style="color: #007700">;<br /><br />foreach(</span><span style="color: #0000BB">$it&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$key&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$key</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>以上例程的输出类似于：</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
string(18) &quot;myIterator::rewind&quot;
string(17) &quot;myIterator::valid&quot;
string(19) &quot;myIterator::current&quot;
string(15) &quot;myIterator::key&quot;
int(0)
string(12) &quot;firstelement&quot;

string(16) &quot;myIterator::next&quot;
string(17) &quot;myIterator::valid&quot;
string(19) &quot;myIterator::current&quot;
string(15) &quot;myIterator::key&quot;
int(1)
string(13) &quot;secondelement&quot;

string(16) &quot;myIterator::next&quot;
string(17) &quot;myIterator::valid&quot;
string(19) &quot;myIterator::current&quot;
string(15) &quot;myIterator::key&quot;
int(2)
string(11) &quot;lastelement&quot;

string(16) &quot;myIterator::next&quot;
string(17) &quot;myIterator::valid&quot;
</pre></div>
    </div>
   </div>
  </div>


 </div>

 








 








 








 








 









<h2>Table of Contents</h2><ul class="chunklist chunklist_reference"><li><a href="iterator.current.html">Iterator::current</a> &mdash; 返回当前元素</li><li><a href="iterator.key.html">Iterator::key</a> &mdash; 返回当前元素的键</li><li><a href="iterator.next.html">Iterator::next</a> &mdash; 向前移动到下一个元素</li><li><a href="iterator.rewind.html">Iterator::rewind</a> &mdash; 返回到迭代器的第一个元素</li><li><a href="iterator.valid.html">Iterator::valid</a> &mdash; 检查当前位置是否有效</li></ul>
</div>
<div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="118838""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#118838" class="date">14-Feb-2016 09:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
An interesting fact that I didn't read in the doc:<br />
<br />
the key() method is called only if your foreach loop needs it.<br />
<br />
For instance, the following loop calls the key() method:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">foreach(</span><span class="default">$it </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"\n"</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
But the following loop doesn't:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">foreach(</span><span class="default">$it </span><span class="keyword">as </span><span class="default">$value</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"\n"</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="114776""></a>
  <div class="note">
   <strong class="user">Gilles A</strong>
   <a href="#114776" class="date">05-Apr-2014 12:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Examples of use<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">myIterator </span><span class="keyword">implements </span><span class="default">Iterator <br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; private <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$_array </span><span class="keyword">= array();<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__construct</span><span class="keyword">(array </span><span class="default">$array</span><span class="keyword">) <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_array </span><span class="keyword">= </span><span class="default">$array</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">rewind</span><span class="keyword">() <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">reset</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_array</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">current</span><span class="keyword">() <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">current</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_array</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">key</span><span class="keyword">() <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">key</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_array</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">next</span><span class="keyword">() <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">next</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_array</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">valid</span><span class="keyword">() <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">key</span><span class="keyword">() !== </span><span class="default">null</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
</span><span class="default">$it </span><span class="keyword">= new </span><span class="default">myIterator</span><span class="keyword">(array(</span><span class="string">'foo_1' </span><span class="keyword">=&gt; </span><span class="string">'bar_1'</span><span class="keyword">,</span><span class="string">'foo_2' </span><span class="keyword">=&gt; </span><span class="string">'bar_2'</span><span class="keyword">));<br />
<br />
</span><span class="comment">//example 1 : foreach<br />
<br />
</span><span class="keyword">foreach(</span><span class="default">$it </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">) <br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
</span><span class="comment">//example 2 : while<br />
<br />
</span><span class="default">$it </span><span class="keyword">-&gt; </span><span class="default">rewind</span><span class="keyword">();<br />
while(</span><span class="default">$it</span><span class="keyword">-&gt;</span><span class="default">valid</span><span class="keyword">())<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$it</span><span class="keyword">-&gt;</span><span class="default">key</span><span class="keyword">(), </span><span class="default">$it</span><span class="keyword">-&gt;</span><span class="default">current</span><span class="keyword">());<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$it</span><span class="keyword">-&gt;</span><span class="default">next</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;<br />
</span><span class="comment">//example 3 : for<br />
<br />
</span><span class="keyword">for(</span><span class="default">$it</span><span class="keyword">-&gt;</span><span class="default">rewind</span><span class="keyword">();</span><span class="default">$it</span><span class="keyword">-&gt;</span><span class="default">valid</span><span class="keyword">();</span><span class="default">$it</span><span class="keyword">-&gt;</span><span class="default">next</span><span class="keyword">())<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$it</span><span class="keyword">-&gt;</span><span class="default">key</span><span class="keyword">(), </span><span class="default">$it</span><span class="keyword">-&gt;</span><span class="default">current</span><span class="keyword">());<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="112499""></a>
  <div class="note">
   <strong class="user">Daniel Lo Nigro</strong>
   <a href="#112499" class="date">23-Jun-2013 03:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you're using PHP 5.5 or above and are creating a simple iterator, consider using a generator function instead. There is significantly less boilerplate code and the code is easier to read. <a href="http://au1.php.net/generators" rel="nofollow" target="_blank">http://au1.php.net/generators</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="108609""></a>
  <div class="note">
   <strong class="user">fetidfrog at gmail dot com</strong>
   <a href="#108609" class="date">11-May-2012 12:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you have a custom iterator that may throw an exception in it's current() method, there is no way to catch the exception without breaking a foreach loop.<br />
<br />
The following for loop allows you to skip elements for which $iterator-&gt;current() throws an exception, rather than breaking the loop.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">for (</span><span class="default">$iterator</span><span class="keyword">-&gt;</span><span class="default">rewind</span><span class="keyword">(); </span><span class="default">$iterator</span><span class="keyword">-&gt;</span><span class="default">valid</span><span class="keyword">(); </span><span class="default">$iterator</span><span class="keyword">-&gt;</span><span class="default">next</span><span class="keyword">()) {<br />
&nbsp;&nbsp;&nbsp; try {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$value </span><span class="keyword">= </span><span class="default">$iterator</span><span class="keyword">-&gt;</span><span class="default">current</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; } catch (</span><span class="default">Exception $exception</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; continue;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment"># ...<br />
</span><span class="keyword">}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="106010""></a>
  <div class="note">
   <strong class="user">dwlnetnl at users dot sourceforge dot net</strong>
   <a href="#106010" class="date">02-Oct-2011 11:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Be aware that when you call a method like current($this) within the Iterator class, the properties of the class are returned and the Iterator's current() isn't called. This is because current() applies to arrays and the Iterator class is then interpretated as an array.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="105121""></a>
  <div class="note">
   <strong class="user">ct</strong>
   <a href="#105121" class="date">28-Jul-2011 09:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">/*<br />
&nbsp;* An implementation of the Iterator<br />
&nbsp;* with simpleXML to remove a node and generate a new XML file.<br />
&nbsp;* <br />
&nbsp;* project.xml file:<br />
&nbsp;* &lt;?xml version="1.0" encoding="UTF-8"?&gt;<br />
&nbsp;* ...<br />
&nbsp;* &lt;data&gt;<br />
&nbsp;*&nbsp; &lt;item&gt;<br />
&nbsp;*&nbsp; &nbsp; &nbsp; &lt;value&gt;one&lt;/value&gt;<br />
&nbsp;*&nbsp; &lt;/item&gt;<br />
&nbsp;*&nbsp; &lt;item&gt;<br />
&nbsp;*&nbsp; &nbsp; &nbsp; &lt;value&gt;two&lt;/value&gt;<br />
&nbsp;*&nbsp; &lt;/item&gt;<br />
&nbsp;*&nbsp; ...<br />
&nbsp;* &lt;/data&gt;<br />
&nbsp;* <br />
&nbsp;*/<br />
<br />
</span><span class="keyword">class </span><span class="default">parseXML </span><span class="keyword">implements </span><span class="default">Iterator </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$position</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$xml</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$item</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__construct</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">position </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xml </span><span class="keyword">= </span><span class="default">simplexml_load_file</span><span class="keyword">(</span><span class="string">'project.xml'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">unsetItem</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$this </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$value</span><span class="keyword">-&gt;</span><span class="default">value </span><span class="keyword">== </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">item </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; unset(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xml</span><span class="keyword">-&gt;</span><span class="default">data</span><span class="keyword">-&gt;</span><span class="default">item</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">mkXML</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">mkXML</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">file_put_contents</span><span class="keyword">(</span><span class="string">'project.xml'</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xml</span><span class="keyword">-&gt;</span><span class="default">asXML</span><span class="keyword">() );<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">rewind</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">position </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">current</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xml</span><span class="keyword">-&gt;</span><span class="default">data</span><span class="keyword">-&gt;</span><span class="default">item</span><span class="keyword">[</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">position</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">key</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">position</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">next</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; ++</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">position</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">valid</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return isset(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xml</span><span class="keyword">-&gt;</span><span class="default">data</span><span class="keyword">-&gt;</span><span class="default">item</span><span class="keyword">[</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">position</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
}<br />
<br />
</span><span class="default">$itemRemove </span><span class="keyword">= new </span><span class="default">parseXML</span><span class="keyword">();<br />
<br />
</span><span class="default">$itemRemove</span><span class="keyword">-&gt;</span><span class="default">item </span><span class="keyword">= </span><span class="string">"one"</span><span class="keyword">;<br />
<br />
</span><span class="default">$itemRemove</span><span class="keyword">-&gt;</span><span class="default">unsetItem</span><span class="keyword">();<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="104720""></a>
  <div class="note">
   <strong class="user">geompse at gmail dot com</strong>
   <a href="#104720" class="date">03-Jul-2011 03:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Be carefull with Iterator when using nested loops or deleting items inside the collection while looping over it.<br />
It can be tricky to detect.<br />
This unexpected behavior is pertinent if you think about it long enough.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">foreach(</span><span class="default">$it </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">$value</span><span class="keyword">;<br />
</span><span class="comment">#output: value1, value2, value3<br />
<br />
</span><span class="keyword">foreach(</span><span class="default">$it </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; foreach(</span><span class="default">$it </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">$value</span><span class="keyword">;<br />
</span><span class="comment">#output: value1, value2, value3<br />
<br />
</span><span class="keyword">foreach(</span><span class="default">$it </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; foreach(clone </span><span class="default">$it </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">$value</span><span class="keyword">;<br />
</span><span class="comment">#output: value1, value2, value3, value1, value2, value3, value1, value2, value3<br />
<br />
</span><span class="keyword">foreach(</span><span class="default">$it </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">$value</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">array_shift</span><span class="keyword">(</span><span class="default">$it</span><span class="keyword">-&gt;</span><span class="default">values</span><span class="keyword">);<br />
}<br />
</span><span class="comment">#ouput: value1, value3<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="101381""></a>
  <div class="note">
   <strong class="user">kent at marketacumen dot com</strong>
   <a href="#101381" class="date">13-Dec-2010 10:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For Iterators implement database queries, what I've found is that if you want to chain multiple iterators together using a "MultipleIterator" then you *do not* want ::rewind() to actually execute your query, especially if it's expensive.<br />
<br />
Instead, what I've done is implement that portion in "valid." <br />
<br />
e.g.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">Database_Result_Iterator </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; ...<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$_db_resource </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$_loaded </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$_valid </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">rewind</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_db_resource</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">mysql_free</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_db_resource</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_db_resource </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_loaded </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_valid </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">valid</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_loaded</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">load</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_valid</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; private function </span><span class="default">load</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_db_resource </span><span class="keyword">= </span><span class="default">mysql_query</span><span class="keyword">(...);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_loaded </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">next</span><span class="keyword">(); </span><span class="comment">// Sets _valid<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">}<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
That way if you chain multiple queries in a "MultipleIterator" together, the "rewind" call (which rewinds all iterators at once) does not execute every query at once. <br />
<br />
In addition, I found that the MultipleIterator may now work best for other reasons, but still, the above is a good idea to postpone queries until the last possible moment they are needed.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="96691""></a>
  <div class="note">
   <strong class="user">robert_e_lee at dell dot com</strong>
   <a href="#96691" class="date">11-Mar-2010 07:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Order of operations when using a foreach loop:<br />
<br />
1. Before the first iteration of the loop, Iterator::rewind() is called.<br />
2. Before each iteration of the loop, Iterator::valid() is called.<br />
3a. It Iterator::valid() returns false, the loop is terminated.<br />
3b. If Iterator::valid() returns true, Iterator::current() and<br />
Iterator::key() are called.<br />
4. The loop body is evaluated.<br />
5. After each iteration of the loop, Iterator::next() is called and we repeat from step 2 above.<br />
<br />
This is roughly equivalent to:<br />
<br />
<span class="default">&lt;?php<br />
$it</span><span class="keyword">-&gt;</span><span class="default">rewind</span><span class="keyword">();<br />
<br />
while (</span><span class="default">$it</span><span class="keyword">-&gt;</span><span class="default">valid</span><span class="keyword">())<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$key </span><span class="keyword">= </span><span class="default">$it</span><span class="keyword">-&gt;</span><span class="default">key</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$value </span><span class="keyword">= </span><span class="default">$it</span><span class="keyword">-&gt;</span><span class="default">current</span><span class="keyword">();<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// ...<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$it</span><span class="keyword">-&gt;</span><span class="default">next</span><span class="keyword">();<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
The loop isn't terminated until Iterator::valid() returns false or the body of the loop executes a break statement.<br />
<br />
The only two methods that are always executed are Iterator::rewind() and Iterator::valid() (unless rewind throws an exception).<br />
<br />
The Iterator::next() method need not return anything. It is defined as returning void. On the other hand, sometimes it is convenient for this method to return something, in which case you can do so if you want.<br />
<br />
If your iterator is doing something expensive, like making a database query and iterating over the result set, the best place to make the query is probably in the Iterator::rewind() implementation.<br />
<br />
In this case, the construction of the iterator itself can be cheap, and after construction you can continue to set the properties of the query all the way up to the beginning of the foreach loop since the<br />
Iterator::rewind() method isn't called until then.<br />
<br />
Things to keep in mind when making a database result set iterator:<br />
<br />
* Make sure you close your cursor or otherwise clean up any previous query at the top of the rewind method. Otherwise your code will break if the same iterator is used in two consecutive foreach loops when the first loop terminates with a break statement before all the results are iterated over.<br />
<br />
* Make sure your rewind() implementation tries to grab the first result so that the subsequent call to valid() will know whether or not the result set is empty. I do this by explicitly calling next() from the end of my rewind() implementation.<br />
<br />
* For things like result set iterators, there really isn't always a "key" that you can return, unless you know you have a scalar primary key column in the query. Unfortunately, there will be cases where either the iterator doesn't know the primary key column because it isn't providing the query, the nature of the query is such that a primary key isn't applicable, the iterator is iterating over a table that doesn't have one, or the iterator is iterating over a table that has a compound primary key. In these cases, key() can return either:<br />
the row index (based on a simple counter that you provide), or can simply return null.<br />
<br />
Iterators can also be used to:<br />
<br />
* iterate over the lines of a file or rows of a CSV file<br />
* iterate over the characters of a string<br />
* iterate over the tokens in an input stream<br />
* iterate over the matches returned by an xpath expression<br />
* iterate over the matches returned by a regexp<br />
* iterate over the files in a folder<br />
* etc...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93580""></a>
  <div class="note">
   <strong class="user">Anthony Sterling</strong>
   <a href="#93580" class="date">17-Sep-2009 11:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's a Fibonacci example using the formula, rather than addition.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/**<br />
&nbsp;* @author&nbsp; &nbsp; Anthony Sterling<br />
&nbsp;*/<br />
</span><span class="keyword">class </span><span class="default">FibonacciSequence </span><span class="keyword">implements </span><span class="default">Iterator<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; protected<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$limit&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; protected<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$key&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$limit </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">limit </span><span class="keyword">= (integer)</span><span class="default">$limit</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">current</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">round</span><span class="keyword">(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (</span><span class="default">pow</span><span class="keyword">(((</span><span class="default">1 </span><span class="keyword">+ </span><span class="default">sqrt</span><span class="keyword">(</span><span class="default">5</span><span class="keyword">)) / </span><span class="default">2</span><span class="keyword">), </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">key</span><span class="keyword">) - </span><span class="default">pow</span><span class="keyword">((-</span><span class="default">1 </span><span class="keyword">/ (</span><span class="default">1 </span><span class="keyword">+ </span><span class="default">sqrt</span><span class="keyword">(</span><span class="default">5</span><span class="keyword">)) / </span><span class="default">2</span><span class="keyword">), </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">key</span><span class="keyword">)) / </span><span class="default">sqrt</span><span class="keyword">(</span><span class="default">5</span><span class="keyword">),<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">null<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">key</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">key</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">next</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">key</span><span class="keyword">++;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">rewind</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">key </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">valid</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">key </span><span class="keyword">&lt; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">limit</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; } <br />
}<br />
<br />
foreach(new </span><span class="default">FibonacciSequence</span><span class="keyword">() as </span><span class="default">$number</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">printf</span><span class="keyword">(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'%d&lt;br /&gt;'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$number<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">);<br />
}<br />
</span><span class="comment">/*<br />
&nbsp;&nbsp;&nbsp; 0<br />
&nbsp;&nbsp;&nbsp; 1<br />
&nbsp;&nbsp;&nbsp; 1<br />
&nbsp;&nbsp;&nbsp; 2<br />
&nbsp;&nbsp;&nbsp; 3<br />
&nbsp;&nbsp;&nbsp; 5<br />
&nbsp;&nbsp;&nbsp; 8<br />
&nbsp;&nbsp;&nbsp; 13<br />
&nbsp;&nbsp;&nbsp; 21<br />
&nbsp;&nbsp;&nbsp; 34<br />
&nbsp;&nbsp;&nbsp; 55<br />
&nbsp;&nbsp;&nbsp; 89<br />
&nbsp;&nbsp;&nbsp; 144<br />
&nbsp;&nbsp;&nbsp; 233<br />
&nbsp;&nbsp;&nbsp; 377<br />
&nbsp;&nbsp;&nbsp; 610<br />
&nbsp;&nbsp;&nbsp; 987<br />
&nbsp;&nbsp;&nbsp; 1597<br />
&nbsp;&nbsp;&nbsp; 2584<br />
&nbsp;&nbsp;&nbsp; 4181<br />
&nbsp;&nbsp;&nbsp; 6765<br />
&nbsp;&nbsp;&nbsp; 10946<br />
&nbsp;&nbsp;&nbsp; 17711<br />
&nbsp;&nbsp;&nbsp; 28657<br />
&nbsp;&nbsp;&nbsp; 46368<br />
&nbsp;&nbsp;&nbsp; 75025<br />
&nbsp;&nbsp;&nbsp; 121393<br />
&nbsp;&nbsp;&nbsp; 196418<br />
&nbsp;&nbsp;&nbsp; 317811<br />
&nbsp;&nbsp;&nbsp; 514229<br />
*/<br />
</span><span class="default">?&gt;<br />
</span><br />
Anthony.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91068""></a>
  <div class="note">
   <strong class="user">Geoffrey Sneddon</strong>
   <a href="#91068" class="date">23-May-2009 07:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
So, playing around with iterators in PHP (coming from languages where I'm spoiled with generators to do things like this), I wrote a quick piece of code to give the Fibonacci sequence (to infinity, though only the first terms up to F_{10} are output).
<br />

<br />
<span class="default">&lt;?php
<br />

<br />
</span><span class="keyword">class </span><span class="default">Fibonacci </span><span class="keyword">implements </span><span class="default">Iterator </span><span class="keyword">{
<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$previous </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$current </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$key </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">current</span><span class="keyword">() {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">current</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">key</span><span class="keyword">() {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">key</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">next</span><span class="keyword">() {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$newprevious </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">current</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">current </span><span class="keyword">+= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">previous</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">previous </span><span class="keyword">= </span><span class="default">$newprevious</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">key</span><span class="keyword">++;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">rewind</span><span class="keyword">() {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">previous </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">current </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">key </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">valid</span><span class="keyword">() {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">true</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
}
<br />

<br />
</span><span class="default">$seq </span><span class="keyword">= new </span><span class="default">Fibonacci</span><span class="keyword">;
<br />
</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br />
foreach (</span><span class="default">$seq </span><span class="keyword">as </span><span class="default">$f</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"</span><span class="default">$f</span><span class="string">\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$i</span><span class="keyword">++ === </span><span class="default">10</span><span class="keyword">) break;
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="90830""></a>
  <div class="note">
   <strong class="user">RocketInABog at techno-monks dot net</strong>
   <a href="#90830" class="date">12-May-2009 01:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
</span><span class="comment"># - Here is an implementation of the Iterator interface for arrays<br />
#&nbsp; &nbsp;&nbsp; which works with maps (key/value pairs)<br />
#&nbsp; &nbsp;&nbsp; as well as traditional arrays<br />
#&nbsp; &nbsp;&nbsp; (contiguous monotonically increasing indexes).<br />
#&nbsp;&nbsp; Though it pretty much does what an array<br />
#&nbsp; &nbsp;&nbsp; would normally do within foreach() loops,<br />
#&nbsp; &nbsp;&nbsp; this class may be useful for using arrays<br />
#&nbsp; &nbsp;&nbsp; with code that generically/only supports the<br />
#&nbsp; &nbsp;&nbsp; Iterator interface.<br />
#&nbsp; Another use of this class is to simply provide<br />
#&nbsp; &nbsp;&nbsp; object methods with tightly controlling iteration of arrays.<br />
<br />
</span><span class="keyword">class </span><span class="default">tIterator_array </span><span class="keyword">implements </span><span class="default">Iterator </span><span class="keyword">{<br />
&nbsp; private </span><span class="default">$myArray</span><span class="keyword">;<br />
<br />
&nbsp; public function </span><span class="default">__construct</span><span class="keyword">( </span><span class="default">$givenArray </span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">myArray </span><span class="keyword">= </span><span class="default">$givenArray</span><span class="keyword">;<br />
&nbsp; }<br />
&nbsp; function </span><span class="default">rewind</span><span class="keyword">() {<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">reset</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">myArray</span><span class="keyword">);<br />
&nbsp; }<br />
&nbsp; function </span><span class="default">current</span><span class="keyword">() {<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">current</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">myArray</span><span class="keyword">);<br />
&nbsp; }<br />
&nbsp; function </span><span class="default">key</span><span class="keyword">() {<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">key</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">myArray</span><span class="keyword">);<br />
&nbsp; }<br />
&nbsp; function </span><span class="default">next</span><span class="keyword">() {<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">next</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">myArray</span><span class="keyword">);<br />
&nbsp; }<br />
&nbsp; function </span><span class="default">valid</span><span class="keyword">() {<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">key</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">myArray</span><span class="keyword">) !== </span><span class="default">null</span><span class="keyword">;<br />
&nbsp; }<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="90715""></a>
  <div class="note">
   <strong class="user">mike dot thornton at firstroi dot com</strong>
   <a href="#90715" class="date">05-May-2009 10:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It's important to note that following won't work if you have null values.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">valid</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">__METHOD__</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return isset(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">array</span><span class="keyword">[</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">position</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;<br />
</span><br />
Other examples have shown the following which won't work if you have false values:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">valid</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">current</span><span class="keyword">() !== </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;<br />
</span><br />
Instead use:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">valid</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">array_key_exists</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">array</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">position</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;<br />
</span><br />
Or the following if you do not store the position.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public function </span><span class="default">valid</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return !</span><span class="default">is_null</span><span class="keyword">(</span><span class="default">key</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">array</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
