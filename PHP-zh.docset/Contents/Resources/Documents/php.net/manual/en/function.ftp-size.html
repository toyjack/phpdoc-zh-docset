<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>返回指定文件的大小</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.ftp-site.html">? ftp_site</a></li>
      <li style="float: right;"><a href="function.ftp-ssl-connect.html">ftp_ssl_connect ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.ftp.html">FTP 函数</a></li>
    <li>返回指定文件的大小</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.ftp-size" class="refentry">
   <div class="refnamediv">
    <h1 class="refname">ftp_size</h1>
    <p class="verinfo">(PHP 4, PHP 5, PHP 7)</p><p class="refpurpose"><span class="refname">ftp_size</span> &mdash; <span class="dc-title">返回指定文件的大小</span></p>

   </div>
   <div class="refsect1 description" id="refsect1-function.ftp-size-description">
    <h3 class="title">说明</h3>
    <div class="methodsynopsis dc-description">
     <span class="type">int</span> <span class="methodname"><strong>ftp_size</strong></span>
      ( <span class="methodparam"><span class="type">resource</span> <code class="parameter">$ftp_stream</code></span>
     , <span class="methodparam"><span class="type">string</span> <code class="parameter">$remote_file</code></span>
     )</div>

    <p class="para rdfs-comment">
     <span class="function"><strong>ftp_size()</strong></span> 函数以字节返回远程文件
     <code class="parameter">remote_file</code> 的大小。如果指定文件不存在或发生错误，则返回
     -1。有些 FTP 服务器可能不支持此特性。
    </p>
    <blockquote class="note"><p><strong class="note">Note</strong>: 
     <p class="para">
      获取成功返回文件大小，否则返回 -1。
     </p> 
    </p></blockquote>
   </div>

   <div class="refsect1 parameters" id="refsect1-function.ftp-size-parameters">
    <h3 class="title">参数</h3>
    <p class="para">
     <dl>

      
       <dt>
<code class="parameter">ftp_stream</code></dt>

       <dd>

        <p class="para">
         FTP 连接资源。
        </p>
       </dd>

      
      
       <dt>
<code class="parameter">remote_file</code></dt>

       <dd>

        <p class="para">
         远程文件。
        </p>
       </dd>

      
     </dl>

    </p>
   </div>

   <div class="refsect1 returnvalues" id="refsect1-function.ftp-size-returnvalues">
   <h3 class="title">返回值</h3>
   <p class="para">
    执行成功返回文件大小，失败返回 -1。
   </p>
   </div>

   <div class="refsect1 examples" id="refsect1-function.ftp-size-examples">
    <h3 class="title">范例</h3>
     <p class="para">
     <div class="example" id="example-4706">
      <p><strong>Example #1 <span class="function"><strong>ftp_size()</strong></span> 例子</strong></p>
      <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$file&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'somefile.txt'</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//&nbsp;set&nbsp;up&nbsp;basic&nbsp;connection&nbsp;<br /></span><span style="color: #0000BB">$conn_id&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">ftp_connect</span><span style="color: #007700">(</span><span style="color: #0000BB">$ftp_server</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;login&nbsp;with&nbsp;username&nbsp;and&nbsp;password<br /></span><span style="color: #0000BB">$login_result&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">ftp_login</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn_id</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$ftp_user_name</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$ftp_user_pass</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;get&nbsp;the&nbsp;size&nbsp;of&nbsp;$file<br /></span><span style="color: #0000BB">$res&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">ftp_size</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn_id</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$file</span><span style="color: #007700">);<br /><br />if&nbsp;(</span><span style="color: #0000BB">$res&nbsp;</span><span style="color: #007700">!=&nbsp;-</span><span style="color: #0000BB">1</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"size&nbsp;of&nbsp;</span><span style="color: #0000BB">$file</span><span style="color: #DD0000">&nbsp;is&nbsp;</span><span style="color: #0000BB">$res</span><span style="color: #DD0000">&nbsp;bytes"</span><span style="color: #007700">;<br />}&nbsp;else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"couldn't&nbsp;get&nbsp;the&nbsp;size"</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #FF8000">//close&nbsp;the&nbsp;conntion<br /></span><span style="color: #0000BB">ftp_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn_id</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
      </div>

     </div>
    </p>
   </div>

   <div class="refsect1 seealso" id="refsect1-function.ftp-size-seealso">
   <h3 class="title">参见</h3>
   <p class="para">
    <ul class="simplelist">
     <li class="member"><span class="function"><a href="function.ftp-rawlist.html" class="function" rel="rdfs-seeAlso">ftp_rawlist()</a> - 返回指定目录下文件的详细列表</span></li>
    </ul>
   </p>
   </div>

  </div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="109141""></a>
  <div class="note">
   <strong class="user">gerben at gerbs dot net</strong>
   <a href="#109141" class="date">23-Jun-2012 04:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To overcome the 2 GB limitation, the ftp_raw solution below is probably the nicest. You can also perform this command using regular FTP commands:
<br />

<br />
<span class="default">&lt;?php
<br />
$response </span><span class="keyword">=&nbsp; </span><span class="default">ftp_raw</span><span class="keyword">(</span><span class="default">$ftpConnection</span><span class="keyword">, </span><span class="string">"SIZE </span><span class="default">$filename</span><span class="string">"</span><span class="keyword">);
<br />
</span><span class="default">$filesize </span><span class="keyword">= </span><span class="default">floatval</span><span class="keyword">(</span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'213 '</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$response</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]));
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
[However, this] is insufficient for use on directories. As per RFC 3659 (<a href="http://tools.ietf.org/html/rfc3659#section-4.2" rel="nofollow" target="_blank">http://tools.ietf.org/html/rfc3659#section-4.2</a>), servers should return error 550 (File not found) if the command is issued on something else than a file, or if some other error occurred. For example, Filezilla indeed returns this string when using the ftp_raw command on a directory:
<br />

<br />
array(1) {
<br />
&nbsp; [0]=&gt;
<br />
&nbsp; string(18) "550 File not found"
<br />
}
<br />

<br />
RFC 959 (<a href="http://tools.ietf.org/html/rfc959" rel="nofollow" target="_blank">http://tools.ietf.org/html/rfc959</a>) dictates that the returned string always consists of exactly 3 digits, followed by 1 space, followed by some text. (Multi-line text is allowed, but I am ignoring that.) So it is probably better to split the string with substr, or even a regular expression.
<br />

<br />
<span class="default">&lt;?php
<br />
$response </span><span class="keyword">= </span><span class="default">ftp_raw</span><span class="keyword">(</span><span class="default">$ftp</span><span class="keyword">, </span><span class="string">"SIZE </span><span class="default">$filename</span><span class="string">"</span><span class="keyword">);
<br />
</span><span class="default">$responseCode </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$response</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="default">0</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">);
<br />
</span><span class="default">$responseMessage </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$response</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="default">4</span><span class="keyword">);
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Or with a regular expression:
<br />

<br />
<span class="default">&lt;?php
<br />
$response </span><span class="keyword">= </span><span class="default">ftp_raw</span><span class="keyword">(</span><span class="default">$ftp</span><span class="keyword">, </span><span class="string">"SIZE </span><span class="default">$filename</span><span class="string">"</span><span class="keyword">);
<br />
if (</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/^(\\d{3}) (.*)$/"</span><span class="keyword">, </span><span class="default">$response</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="default">$matches</span><span class="keyword">) == </span><span class="default">0</span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="string">"Unable to parse FTP reply: "</span><span class="keyword">.</span><span class="default">$response</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]);
<br />
list(</span><span class="default">$response</span><span class="keyword">, </span><span class="default">$responseCode</span><span class="keyword">, </span><span class="default">$responseMessage</span><span class="keyword">) = </span><span class="default">$matches</span><span class="keyword">;
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
You could then decide to assume that response code '550' means that it's a directory. I guess that's just as 'dangerous' as assuming that ftp_size -1 means that it's a directory.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="105112""></a>
  <div class="note">
   <strong class="user">ibeono at gmail dot com</strong>
   <a href="#105112" class="date">28-Jul-2011 01:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you experience troubles with size of large file then you can use ftp_rawlist function and parse it result</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92127""></a>
  <div class="note">
   <strong class="user">bluerain [at] telenet [dot] be</strong>
   <a href="#92127" class="date">10-Jul-2009 10:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To overcome the 2GB file size limit, you can open your own socket to get the file size of a large file. Quick and dirty script:
<br />

<br />
<span class="default">&lt;?php
<br />
$socket</span><span class="keyword">=</span><span class="default">fsockopen</span><span class="keyword">(</span><span class="default">$hostName</span><span class="keyword">, </span><span class="default">21</span><span class="keyword">);
<br />
</span><span class="default">$t</span><span class="keyword">=</span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">, </span><span class="default">128</span><span class="keyword">);
<br />
</span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">, </span><span class="string">"USER </span><span class="default">$myLogin</span><span class="string">\r\n"</span><span class="keyword">);
<br />
</span><span class="default">$t</span><span class="keyword">=</span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">, </span><span class="default">128</span><span class="keyword">);
<br />
</span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">, </span><span class="string">"PASS </span><span class="default">$myPass</span><span class="string">\r\n"</span><span class="keyword">);
<br />
</span><span class="default">$t</span><span class="keyword">=</span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">, </span><span class="default">128</span><span class="keyword">);
<br />
</span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">, </span><span class="string">"SIZE </span><span class="default">$fileName</span><span class="string">\r\n"</span><span class="keyword">);
<br />
</span><span class="default">$t</span><span class="keyword">=</span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">, </span><span class="default">128</span><span class="keyword">);
<br />
</span><span class="default">$fileSize</span><span class="keyword">=</span><span class="default">floatval</span><span class="keyword">(</span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"213 "</span><span class="keyword">,</span><span class="string">""</span><span class="keyword">,</span><span class="default">$t</span><span class="keyword">));
<br />
echo </span><span class="default">$fileSize</span><span class="keyword">;
<br />
</span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">, </span><span class="string">"QUIT\r\n"</span><span class="keyword">);
<br />
</span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$socket</span><span class="keyword">);
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="78834""></a>
  <div class="note">
   <strong class="user">miccots at gmail dot com</strong>
   <a href="#78834" class="date">30-Oct-2007 10:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
2 adams[AT]techweavers[DOT]net:<br />
To get a size of large file (f. ex.: 3.2 Gb) you have to format the result returned by ftp_size():<br />
<br />
$size = sprintf ("%u", ftp_size($connection, $file_name));<br />
<br />
So you can get the real size of big files. But this method is not good for checking is this a dir (when ftp_size() returns -1).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76594""></a>
  <div class="note">
   <strong class="user">C_Muller</strong>
   <a href="#76594" class="date">22-Jul-2007 12:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For checking if a certain folder exists try using ftp_nlist() function to get a directory list in array. By using in_array('foldername') you can find out if it is there or not.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="66471""></a>
  <div class="note">
   <strong class="user">chuck at t8design dot com</strong>
   <a href="#66471" class="date">23-May-2006 06:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
note that project_t4 at hotmail dot com's example above doesn't work in general, though it works on his Win2K/Apache server; as far as I can tell there is no way to check over ftp whether a directory exists.&nbsp; This function's behavior given a directory name seems to be at least somewhat dependent on your OS, web server, or ftp server, I don't know which.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="54041""></a>
  <div class="note">
   <strong class="user">adams[AT]techweavers[DOT]net</strong>
   <a href="#54041" class="date">21-Jun-2005 11:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Well this function is nice but if you have files larger then 2.1Gb or 2.1 Billion Bytes you cannot get its size.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="46088""></a>
  <div class="note">
   
   <a href="#46088" class="date">29-Sep-2004 03:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To get a dirsize recursive you can use this simple function:<br />
<br />
<span class="default">&lt;?php </span><span class="comment"># copyright by fackelkind | codeMaster<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">getRecDirSize </span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">, </span><span class="default">$dir</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$temp </span><span class="keyword">= </span><span class="default">ftp_rawlist </span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">, </span><span class="string">"-alR </span><span class="default">$dir</span><span class="string">"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$temp </span><span class="keyword">as </span><span class="default">$file</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">ereg </span><span class="keyword">(</span><span class="string">"([-d][rwxst-]+).* ([0-9]) ([a-zA-Z0-9]+).* ([a-zA-Z0-9]+).* ([0-9]*) ([a-zA-Z]+[0-9: ]*[0-9]) ([0-9]{2}:[0-9]{2}) (.+)"</span><span class="keyword">, </span><span class="default">$file</span><span class="keyword">, </span><span class="default">$regs</span><span class="keyword">)){&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$isdir </span><span class="keyword">= (</span><span class="default">substr </span><span class="keyword">(</span><span class="default">$regs</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">],</span><span class="default">0</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">) == </span><span class="string">"d"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">$isdir</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$size </span><span class="keyword">+= </span><span class="default">$regs</span><span class="keyword">[</span><span class="default">5</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$size</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$dirSize </span><span class="keyword">= </span><span class="default">getRecDirSize </span><span class="keyword">(</span><span class="default">$conID</span><span class="keyword">, </span><span class="string">"/"</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="40905""></a>
  <div class="note">
   <strong class="user">project_t4 at hotmail dot com</strong>
   <a href="#40905" class="date">18-Mar-2004 08:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just to let people out there know, on my windows 2000 server running Apache and php i was returned 0 not -1 for directories.<br />
<br />
foreach ($dir_list as $item)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; if(ftp_size($conn_id, $item) == "0")<br />
&nbsp;&nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; echo "&lt;br&gt;Directory:: ".$item;<br />
&nbsp;&nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp;&nbsp; echo "&lt;br&gt;File:: ".$item;<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
This outputs a list of the remote directory and indicates which items are directories and which are files.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="36297""></a>
  <div class="note">
   <strong class="user">nicke_ at at_h9k dot com</strong>
   <a href="#36297" class="date">04-Oct-2003 03:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This will return the filesize on remote host and the size if you download it in FTP_BINARY mode. If you are using FTP_ASCII in ftp_get() the size can be changed.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="27883""></a>
  <div class="note">
   <strong class="user">victor59 at yahoo dot com dot hk</strong>
   <a href="#27883" class="date">23-Dec-2002 10:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
$file= 'filename with space.txt';<br />
$size = ftp_size($this-&gt;ftp, urldecode($file) );<br />
<br />
this one can correctly return the size<br />
otherwize, it always return -1</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
