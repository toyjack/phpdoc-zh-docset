<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>Compress a string</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.gzclose.html">? gzclose</a></li>
      <li style="float: right;"><a href="function.gzdecode.html">gzdecode ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.zlib.html">Zlib 函数</a></li>
    <li>Compress a string</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.gzcompress" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">gzcompress</h1>
  <p class="verinfo">(PHP 4 &gt;= 4.0.1, PHP 5, PHP 7)</p><p class="refpurpose"><span class="refname">gzcompress</span> &mdash; <span class="dc-title">Compress a string</span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.gzcompress-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">string</span> <span class="methodname"><strong>gzcompress</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$data</code></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$level</code><span class="initializer"> = -1</span></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$encoding</code><span class="initializer"> = ZLIB_ENCODING_DEFLATE</span></span>
  ]] )</div>

  <p class="para rdfs-comment">
   This function compresses the given string using the <em>ZLIB</em>
   data format.
  </p>
  <p class="para">
   For details on the ZLIB compression algorithm see the document
   &quot;<a href="http://www.faqs.org/rfcs/rfc1950" class="link external" title="Link : http://www.faqs.org/rfcs/rfc1950">&raquo;&nbsp;ZLIB Compressed Data Format
   Specification version 3.3</a>&quot; (RFC 1950).
  </p>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    This is <em class="emphasis">not</em> the same as gzip compression,
    which includes some header data. See <span class="function"><a href="function.gzencode.html" class="function">gzencode()</a></span>
    for gzip compression.
   </p>
  </p></blockquote>
 </div>

 <div class="refsect1 parameters" id="refsect1-function.gzcompress-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">data</code></dt>

     <dd>

      <p class="para">
       The data to compress.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">level</code></dt>

     <dd>

      <p class="para">
       The level of compression. Can be given as 0 for no compression up to 9
       for maximum compression.
      </p>
      <p class="para">
       If -1 is used, the default compression of the zlib library is used which is 6.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">encoding</code></dt>

     <dd>

      <p class="para">
       One of <strong><code>ZLIB_ENCODING_*</code></strong> constants.
      </p>
     </dd>

    
   </dl>

  </p>
 </div>

 <div class="refsect1 returnvalues" id="refsect1-function.gzcompress-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   The compressed string or <strong><code>FALSE</code></strong> if an error occurred.
  </p>
 </div>

 <div class="refsect1 examples" id="refsect1-function.gzcompress-examples">
  <h3 class="title">范例</h3>
  <p class="para">
   <div class="example" id="example-859">
    <p><strong>Example #1 <span class="function"><strong>gzcompress()</strong></span> example</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$compressed&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">gzcompress</span><span style="color: #007700">(</span><span style="color: #DD0000">'Compress&nbsp;me'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">9</span><span style="color: #007700">);<br />echo&nbsp;</span><span style="color: #0000BB">$compressed</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.gzcompress-changelog">
  <h3 class="title">更新日志</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead>
      <tr>
       <th>版本</th>
       <th>说明</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
       <td>5.4.0</td>
       <td>
        Added <code class="parameter">encoding</code> parameter.
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.gzcompress-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.gzdeflate.html" class="function" rel="rdfs-seeAlso">gzdeflate()</a> - Deflate a string</span></li>
    <li class="member"><span class="function"><a href="function.gzinflate.html" class="function" rel="rdfs-seeAlso">gzinflate()</a> - Inflate a deflated string</span></li>
    <li class="member"><span class="function"><a href="function.gzuncompress.html" class="function" rel="rdfs-seeAlso">gzuncompress()</a> - Uncompress a compressed string</span></li>
    <li class="member"><span class="function"><a href="function.gzencode.html" class="function" rel="rdfs-seeAlso">gzencode()</a> - Create a gzip compressed string</span></li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="112555""></a>
  <div class="note">
   <strong class="user">stockton at wowway dot com</strong>
   <a href="#112555" class="date">30-Jun-2013 12:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
After some searching and experimentation I found that output generated with gzcompress() can be uncompressed by the objective c 'zlibInflate' wrapper for 'zlib' as available at <a href="http://cocoadev.com/wiki/NSDataCategory but that " rel="nofollow" target="_blank">http://cocoadev.com/wiki/NSDataCategory but that </a>'gzdeflate()' cannot. I hope this saves someone else the searching.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="106239""></a>
  <div class="note">
   <strong class="user">Eric</strong>
   <a href="#106239" class="date">20-Oct-2011 07:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Did some simple benchmarking of gzcompress() this morning on a lightly-loaded Fedora 12 server with an AMD Phenom II 940 (quad-core) rocking 8 gigs of ram and executing PHP 5.3.2.2 as an Apache module:<br />
<br />
Compression benchmark: (level, time, size (%)):<br />
0: 0.000373 - 82.08 kB (100.02%)<br />
1: 0.000914 - 19.61 kB (23.90%)<br />
2: 0.000951 - 18.88 kB (23.01%)<br />
3: 0.000999 - 18.43 kB (22.46%)<br />
4: 0.001498 - 17.65 kB (21.51%)<br />
5: 0.001744 - 17.09 kB (20.82%)<br />
6: 0.002060 - 16.88 kB (20.57%)<br />
7: 0.002233 - 16.85 kB (20.53%)<br />
8: 0.002808 - 16.71 kB (20.36%)<br />
9: 0.002928 - 16.71 kB (20.36%)<br />
<br />
The time code evaluates to:<br />
1. Get start microtime<br />
2. Call gzcompress<br />
3. Get end microtime<br />
4. Report average duration of 100 cycles<br />
<br />
The 82.08 kB was a copied and pasted string of two actual, PHP-generated pages we use on our intranet. Running some rough calculations, the time it takes to compress the data at level 9 will never be larger than the time it takes to transmit slightly-less compressed data at levels 6 or lower. In other words, in our application, we have no reason not to fully-compress each PHP script's output.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="90140""></a>
  <div class="note">
   <strong class="user">Timo</strong>
   <a href="#90140" class="date">07-Apr-2009 11:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
With PHP it is quite easy to modify SWF files. The compression algorithm of SWF is Zlib.<br />
<br />
SWF default compression level is 6, at least Flash CS2 uses this level. I tested this by uncompressing compressed SWF file and then compressed the contents with levels 0-9. With level 6, the contents of files were identical.<br />
<br />
Maybe it can be whatever else, but when trying to compare files at hex level or compare filesizes, it is easier to use the same level.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="88044""></a>
  <div class="note">
   <strong class="user">Samnan</strong>
   <a href="#88044" class="date">07-Jan-2009 03:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To properly use gzcompress to send compressed data to browsers that support it (most of modern browsers do, even mobile ones !), use this function (I dont think W3C validator issue mentioned earlier is valid ). use ob_start() at start of your script also
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">print_gzipped_output</span><span class="keyword">()
<br />
{
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$HTTP_ACCEPT_ENCODING </span><span class="keyword">= </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">"HTTP_ACCEPT_ENCODING"</span><span class="keyword">];
<br />
&nbsp;&nbsp;&nbsp; if( </span><span class="default">headers_sent</span><span class="keyword">() )
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$encoding </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; else if( </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$HTTP_ACCEPT_ENCODING</span><span class="keyword">, </span><span class="string">'x-gzip'</span><span class="keyword">) !== </span><span class="default">false </span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$encoding </span><span class="keyword">= </span><span class="string">'x-gzip'</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; else if( </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$HTTP_ACCEPT_ENCODING</span><span class="keyword">,</span><span class="string">'gzip'</span><span class="keyword">) !== </span><span class="default">false </span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$encoding </span><span class="keyword">= </span><span class="string">'gzip'</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; else
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$encoding </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; if( </span><span class="default">$encoding </span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$contents </span><span class="keyword">= </span><span class="default">ob_get_clean</span><span class="keyword">();
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$_temp1 </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$contents</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$_temp1 </span><span class="keyword">&lt; </span><span class="default">2048</span><span class="keyword">)&nbsp; &nbsp; </span><span class="comment">// no need to waste resources in compressing very little data
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">print(</span><span class="default">$contents</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-Encoding: '</span><span class="keyword">.</span><span class="default">$encoding</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; print(</span><span class="string">"\x1f\x8b\x08\x00\x00\x00\x00\x00"</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$contents </span><span class="keyword">= </span><span class="default">gzcompress</span><span class="keyword">(</span><span class="default">$contents</span><span class="keyword">, </span><span class="default">9</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$contents </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$contents</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$_temp1</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; print(</span><span class="default">$contents</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; else
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ob_end_flush</span><span class="keyword">();
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85587""></a>
  <div class="note">
   <strong class="user">plasma</strong>
   <a href="#85587" class="date">07-Sep-2008 07:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is a benchmark comparing strengths of bzip and gzip compression:<br />
<br />
gz[0] - 1.647ms - 189058 Byte (100%)<br />
gz[1] - 3.333ms - 44572 Byte (23.58%)<br />
gz[2] - 3.519ms - 42685 Byte (22.58%)<br />
gz[3] - 4.713ms - 40840 Byte (21.6%)<br />
gz[4] - 5.274ms - 39111 Byte (20.69%)<br />
gz[5] - 6.526ms - 37039 Byte (19.59%)<br />
gz[6] - 8.036ms - 36206 Byte (19.15%)<br />
gz[7] - 9.098ms - 35940 Byte (19.01%)<br />
gz[8] - 12.87ms - 35713 Byte (18.89%)<br />
gz[9] - 14.319ms - 35707 Byte (18.89%)<br />
<br />
bz[1] - 40.282ms - 32247 Byte (17.06%)<br />
bz[2] - 43.716ms - 29690 Byte (15.7%)<br />
bz[3] - 43.765ms - 29690 Byte (15.7%)<br />
bz[4] - 44.213ms - 29690 Byte (15.7%)<br />
bz[5] - 43.704ms - 29690 Byte (15.7%)<br />
bz[6] - 43.814ms - 29690 Byte (15.7%)<br />
bz[7] - 43.934ms - 29690 Byte (15.7%)<br />
bz[8] - 43.725ms - 29690 Byte (15.7%)<br />
bz[9] - 45.129ms - 29690 Byte (15.7%)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="61961""></a>
  <div class="note">
   <strong class="user">prgTW at poczta dot onet dot pl</strong>
   <a href="#61961" class="date">16-Feb-2006 02:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I don't know why, but W3C Validator can't validate pages that are GZIP compressed (with functions posted below: gzcompress, pack etc.; not by ob_gzhandler).<br />
<br />
Because of this, I use similar code to this below:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">if( </span><span class="default">strstr</span><span class="keyword">(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'HTTP_USER_AGENT'</span><span class="keyword">], </span><span class="string">'W3C_Validator'</span><span class="keyword">)!==</span><span class="default">false </span><span class="keyword">|| </span><span class="default">strstr</span><span class="keyword">(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'HTTP_ACCEPT_ENCODING'</span><span class="keyword">], </span><span class="string">'gzip'</span><span class="keyword">)===</span><span class="default">false </span><span class="keyword">){<br />
&nbsp; </span><span class="comment">// do not compress<br />
</span><span class="keyword">}else{<br />
&nbsp; </span><span class="comment">// can send GZIP compressed data<br />
</span><span class="keyword">}<br />
</span><span class="default">?&gt;<br />
</span><br />
This code also checks if user agent is W3C Validator. If it is NOT W3C Validator and user acceptes GZIP encoded data then we can compress the page, in other case if it is W3C Validator or user agent does not accept GZIP enoded data we can't compress the page, 'cause user agent couldn't properly handle it.<br />
<br />
Sorry for my bad English</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="57710""></a>
  <div class="note">
   <strong class="user">Chris Watt</strong>
   <a href="#57710" class="date">12-Oct-2005 03:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Contrary to popular opinion the checksum in the last four bytes of output is not "wrong", it's just not very useful: RFC 1950 s8.2 specifies that the "Adler-32" checksum, not CRC32 should be appended to the compressed data and PHP function follows the RFC (if for no other reason because it uses zlib and Mark Adler was one of the authors thereof). In contrast gzip expects a CRC32 (i.e. it doesn't follow that RFC), and treats the Adler-32 checksum as an incorrect CRC32.<br />
<br />
AFAICT there is no simple way to compute the CRC32 directly from the Adler32 checksum.<br />
<br />
Personally, my solution was to write a short C program that performs a deflate on, and calculates the CRC32 of, stdin while writing the compressed data (with trailing CRC32 instead of Adler32) on stdout. It's an ugly hack, but it does allow me to&nbsp; serve a ~1GB compressed output with only a single pass over the uncompressed data and without hitting my 8MB memory limit. In contrast, methods using gzcompress() and crc32() would seem to require a theoretical minimum of three passes across the input data (read into memory, compress, calculate CRC) and 2GB of allocated memory to produce a 1GB compressed output... Short of writing crc32() and deflate() functions from scratch, I couldn't find any way of doing this without either storing the whole output in a variable or resorting to a module in another language.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="53830""></a>
  <div class="note">
   
   <a href="#53830" class="date">14-Jun-2005 04:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If no parameter is given, the default level of 6 is used.<br />
<br />
benchmarking the speed:<br />
(compression, datasize, compress time)<br />
0: 37440 (0.002 s)<br />
1: 2537 (0.002 s)<br />
2: 2298 (0.003 s)<br />
3: 2199 (0.003 s)<br />
4: 2299 (0.003 s)<br />
5: 1939 (0.004 s)<br />
6: 1789 (0.004 s)<br />
7: 1724 (0.004 s)<br />
8: 1635 (0.005 s)<br />
9: 1635 (0.005 s)<br />
<br />
Level 0 = no compression, then level 1-4 are roughly the fastest to compress with reasonable quality. level 5-7 give better compression but take a little longer and 8-9 take nearly double the time to compress but give best results.<br />
<br />
So the system default of 6 is actually a good compromise in speed/size. But for very fast compression times, I go with the threshold value of 3.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="52490""></a>
  <div class="note">
   <strong class="user">gaelreth at gmail dot com</strong>
   <a href="#52490" class="date">03-May-2005 05:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There is a useful zipfile class at <a href="http://www.zend.com/codex.php?id=696&amp;single=1 that allows you to zip many files into one zip file." rel="nofollow" target="_blank">http://www.zend.com/codex.php?id=696&amp;single=1 that allows you to zip many files into one zip file.</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="34556""></a>
  <div class="note">
   <strong class="user">dwales at easyetrader dot com</strong>
   <a href="#34556" class="date">30-Jul-2003 09:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I find this works well, save the snip below in your php/ directory then edit your prepend.php file and add a require statement that requires the compression.php file below. Once complete watch (tail -f) your php error log to see the results of compression in action.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">// Gzip encode the contents of the output buffer.<br />
</span><span class="keyword">function </span><span class="default">compress_output_option</span><span class="keyword">(</span><span class="default">$output</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Compress the data into a new var.<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$compressed_out </span><span class="keyword">= </span><span class="default">gzencode</span><span class="keyword">(</span><span class="default">$output</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Don't compress any pages less than 1000 bytes<br />
&nbsp;&nbsp;&nbsp; // as it's not worth the overhead at either side.<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$output</span><span class="keyword">) &gt;= </span><span class="default">1000</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">error_log</span><span class="keyword">(</span><span class="string">'compression.php Gzipd Output'</span><span class="keyword">.</span><span class="string">"\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">.</span><span class="string">'Before compression size '<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">.</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$output</span><span class="keyword">).</span><span class="string">' bytes'</span><span class="keyword">.</span><span class="string">"\n"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">.</span><span class="string">' After compression size '<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">.</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$compressed_out</span><span class="keyword">).</span><span class="string">' bytes'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Tell the browser the content is compressed with gzip<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-Encoding: gzip"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$compressed_out</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; else<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// No compression<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">error_log</span><span class="keyword">(</span><span class="string">'compression.php Standard Output.'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$output</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="comment">// Check if the browser supports gzip encoding, HTTP_ACCEPT_ENCODING<br />
</span><span class="keyword">if (</span><span class="default">strstr</span><span class="keyword">(</span><span class="default">$HTTP_SERVER_VARS</span><span class="keyword">[</span><span class="string">'HTTP_ACCEPT_ENCODING'</span><span class="keyword">], </span><span class="string">'gzip'</span><span class="keyword">))<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Start output buffering, and register compress_output() (see<br />
&nbsp;&nbsp;&nbsp; // below)<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">ob_start</span><span class="keyword">(</span><span class="string">"compress_output_option"</span><span class="keyword">);<br />
<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="30630""></a>
  <div class="note">
   <strong class="user">devcontact at tech-island dot com</strong>
   <a href="#30630" class="date">24-Mar-2003 04:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The method of first reading the source file and then passing its content to the gzip function instead of simply the source and destination filename was a bit confusing for me.<br />
<br />
So I have written a simple funtion you can use to compress files in the gzip format (gzip is readable by winzip like .zip files)<br />
<br />
function compress($srcName, $dstName)<br />
{<br />
&nbsp; $fp = fopen($srcName, "r");<br />
&nbsp; $data = fread ($fp, filesize($srcName));<br />
&nbsp; fclose($fp);<br />
<br />
&nbsp; $zp = gzopen($dstName, "w9");<br />
&nbsp; gzwrite($zp, $data);<br />
&nbsp; gzclose($zp);<br />
}<br />
<br />
// Compress a file<br />
compress("/web/myfile.dat", "/web/myfile.gz");</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="30229""></a>
  <div class="note">
   <strong class="user">mail at ciruz dot de</strong>
   <a href="#30229" class="date">11-Mar-2003 09:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You should use the crc coz' some linux browsers need it. Some browser won't display anything without crc. My code works with these browsers (tested ;))</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="29842""></a>
  <div class="note">
   <strong class="user">chris at mad-teaparty dot com</strong>
   <a href="#29842" class="date">26-Feb-2003 07:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
little correction of the one above:<br />
the crc is not necessarily needed to display the content in browsers, but it's still useful as a checksum. I suggest that most of the browsers don't check it anyway, otherwise they would not display contents with broken checksums.<br />
Scripts seem to be a little bit faster, you may weigh up advantages with disadvantages (e.g. when you use a secure connection).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="29824""></a>
  <div class="note">
   <strong class="user">chris at mad-teaparty dot com</strong>
   <a href="#29824" class="date">26-Feb-2003 12:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It seems that you don't have to pack the crc-checksum and the length of the string. The crucial thing is to erase the last 4 bytes of the gzcompressed content. They seem to be redundant in any case. I rewrote the function "gzDocOut" and I think, it is the most efficient and shortest way to encode an output with gzcompress:<br />
<br />
function gzDocOut() {<br />
<br />
&nbsp;&nbsp; &nbsp; if ($encoding = checkCanGzip()) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; $contents = ob_get_contents();<br />
&nbsp;&nbsp; &nbsp; &nbsp; ob_end_clean();<br />
&nbsp;&nbsp; &nbsp; &nbsp; header("Content-Encoding: ". $encoding);<br />
&nbsp;&nbsp; &nbsp; &nbsp; $output = "\x1f\x8b\x08\x00\x00\x00\x00\x00";<br />
&nbsp;&nbsp; &nbsp; &nbsp; $output .= substr(gzcompress($contents, 2), 0, -4);<br />
&nbsp;&nbsp; &nbsp; &nbsp; echo $output; <br />
&nbsp;&nbsp; &nbsp; &nbsp; exit();<br />
&nbsp;&nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; ob_end_flush();<br />
&nbsp;&nbsp; &nbsp; &nbsp; exit();<br />
&nbsp;&nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; <br />
}<br />
<br />
Tested with IE5.5, Netscape 7, Mozilla 1.2, Opera 7, Opera 6 as well as Netscape 4.7. I'll test further browsers to be sure...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="22003""></a>
  <div class="note">
   <strong class="user">orlink at hotmail dot com</strong>
   <a href="#22003" class="date">03-Jun-2002 09:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I tried sending a pre-compressed javascript with header("Content-Encoding: gzip") to a request from &lt;script type=javascript src="<a href="http://...?op=getscript" rel="nofollow" target="_blank">http://...?op=getscript</a>"&gt;.<br />
<br />
I have found out so far that IE4 does not support external compressed scripts and stylesheets (that is not embedded in the HTML but included with &lt;script ...src=...&gt; and &lt;link src=...&gt;).&nbsp; With other versions of IE it works on some computers and not on others even if they have exactly the same versions of IE and Windows.&nbsp;&nbsp; For instance IE 5.0xxxxxx and Windows 98 Buldxxxx.&nbsp;&nbsp; <br />
If anyones knows of at least one configuration of IE and a OS for which it works for SURE let me know.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="21980""></a>
  <div class="note">
   <strong class="user">postmaster at ak-dev dot com</strong>
   <a href="#21980" class="date">03-Jun-2002 01:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Second try! In my mind, the following source code is right with 4.1.2 and higher, and seems to be right with other versions... and its works with all browser I tried(NS 4.7x, mozilla 1.00rc3, IE5.5, opera6.01)...<br />
As it is said in documentation of the function gzencode, you have to use this function, if you want to get the right result! gzcompress doesn't create the right stream output for browsers!(It is explained in gzencode documentation: generated headers are not the same!)<br />
<br />
The source code:<br />
<br />
&lt;?<br />
&nbsp; function checkCanGzip() {<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; global $HTTP_ACCEPT_ENCODING;<br />
&nbsp;&nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp;&nbsp; if (headers_sent()) return 0;<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (strpos($HTTP_ACCEPT_ENCODING, 'x-gzip') !== false) return<br />
"x-gzip";<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (strpos($HTTP_ACCEPT_ENCODING,'gzip') !== false) return<br />
"gzip";<br />
&nbsp;&nbsp; &nbsp;&nbsp; return 0;<br />
<br />
&nbsp; }<br />
<br />
&nbsp; function gzDocOut() {<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; if ($encoding = checkCanGzip()) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $contents = ob_get_contents();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; ob_end_clean();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; header("Content-Encoding: ".$encoding);<br />
//&nbsp; &nbsp; &nbsp; &nbsp; print("\x1f\x8b\x08\x00\x00\x00\x00\x00");<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $contents = gzencode($contents);<br />
//&nbsp; &nbsp; &nbsp; &nbsp; $contents = substr($contents, 0, strlen($contents) - 4);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; print($contents);<br />
//&nbsp; &nbsp; &nbsp; &nbsp; print(pack('V', crc32($contents)));<br />
//&nbsp; &nbsp; &nbsp; &nbsp; print(pack('V', strlen($contents)));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; exit();<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; ob_end_flush();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; exit();<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; <br />
&nbsp; }<br />
<br />
&nbsp; ob_start();<br />
&nbsp; ob_implicit_flush(0);<br />
<br />
&nbsp; print("your stuff...");<br />
<br />
&nbsp; gzDocOut();<br />
<br />
?&gt;<br />
<br />
You have to note, that gzencode is able to generate deflate compression, but the previous source code, does not implemente it. You just have to read gzencode documentation to find this tip.<br />
function gzencode in php 4.2.0 (and higher) allows to use a compression level, it is not possible in loder versions.<br />
<br />
The code which is commented, is wrong source code, used, in the different exemple found on this page!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="21966""></a>
  <div class="note">
   <strong class="user">postmaster at ak-dev dot com</strong>
   <a href="#21966" class="date">02-Jun-2002 04:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It seems that you don't need anymore to add the crc and the size at the end of the stream, it works fairly with php4.06! I don't have tried for the moment with highest version than php 4.06.<br />
The source code:<br />
<br />
&lt;?<br />
&nbsp; function checkCanGzip() {<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; global $HTTP_ACCEPT_ENCODING;<br />
&nbsp;&nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp;&nbsp; if (headers_sent()) return 0;<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (strpos($HTTP_ACCEPT_ENCODING, 'x-gzip') !== false) return "x-gzip";<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (strpos($HTTP_ACCEPT_ENCODING,'gzip') !== false) return "gzip";<br />
&nbsp;&nbsp; &nbsp;&nbsp; return 0;<br />
<br />
&nbsp; }<br />
<br />
&nbsp; function gzDocOut() {<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; if ($encoding = checkCanGzip()) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $contents = ob_get_contents();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; ob_end_clean();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; header("Content-Encoding: ".$encoding);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; print("\x1f\x8b\x08\x00\x00\x00\x00\x00");<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $size = strlen($contents);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $contents = gzcompress($contents, 9);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $contents = substr($contents, 0, $size);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; print($contents);<br />
//&nbsp; &nbsp; &nbsp; &nbsp; print(pack('V', crc32($contents)));<br />
//&nbsp; &nbsp; &nbsp; &nbsp; print(pack('V', $size));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; exit();<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; ob_end_flush();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; exit();<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; <br />
&nbsp; }<br />
<br />
&nbsp; ob_start();<br />
&nbsp; ob_implicit_flush(0);<br />
<br />
&nbsp; print("your stuff...");<br />
<br />
&nbsp; gzDocOut();<br />
<br />
?&gt;<br />
<br />
For the&nbsp; moment, I have only tried on IE5.5, and it works well.<br />
Effectively, with the crc and the size at the end of gile, it doesn't work!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="15569""></a>
  <div class="note">
   <strong class="user">rostor at swzone dot org</strong>
   <a href="#15569" class="date">18-Sep-2001 02:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To solve I.E.5.x data compress problem on IIS5, such opening a download dial box or wrong page load, the only way for me was to change the header content type:
<br />

<br />
&lt;? header("Content-type: gzip");ob_start ("ob_gzhandler");?&gt;
<br />

<br />
but now all browser that doesn't support gzip don't load the page.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="14463""></a>
  <div class="note">
   <strong class="user">webmaster at mail.bg</strong>
   <a href="#14463" class="date">01-Aug-2001 12:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When you compress your data IE (5.x for sure, no idea about Netscape) may mess up the mime headers, so you may e.g. loose your extensions after compressing output. In my case in attachment saving with no compression everything works fine. When I compress output everything seems OK except I loose the file extension (althogh it really is in the headers). This is because IE seems to think your attachment is mimetype gzip, and not what you send in the headers that follow.
<br />

<br />
In such cases the easiest sollution would be to disable compression (maybe partially with an .htaccess file?).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="10402""></a>
  <div class="note">
   <strong class="user">gvirgo at mithril dot com</strong>
   <a href="#10402" class="date">02-Jan-2001 08:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
&gt;&gt;Netscape 4 (on all platforms[?]), IE4/IE5 on the Mac do NOT support
<br />
&gt;&gt;gz-compression. Email me if you want to know more.
<br />

<br />
As a matter of fact, Netscape 4.7x on Win32 DOES support gz-compression.&nbsp; Calling the following script in my auto_prepend directive seems to work fine.&nbsp; The script is taken from the Output Buffering article on Zend.com (<a href="http://www.zend.com/zend/art/buffering.php" rel="nofollow" target="_blank">http://www.zend.com/zend/art/buffering.php</a>).&nbsp; As noted in the article, it only works with PHP 4.0.4 and higher.
<br />

<br />
<span class="default">&lt;?php 
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// function to compress the output buffer in preparation for transmission to client
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">compress_output</span><span class="keyword">(</span><span class="default">$output</span><span class="keyword">) { 
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// compress and return the output buffer 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">gzencode</span><span class="keyword">(</span><span class="default">$output</span><span class="keyword">); 
<br />
&nbsp;&nbsp;&nbsp; } 
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Check if the browser supports gzip encoding, HTTP_ACCEPT_ENCODING 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">strstr</span><span class="keyword">(</span><span class="default">$HTTP_SERVER_VARS</span><span class="keyword">[</span><span class="string">'HTTP_ACCEPT_ENCODING'</span><span class="keyword">], </span><span class="string">'gzip'</span><span class="keyword">)) {
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Start output buffering, and register compress_output()
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ob_start</span><span class="keyword">(</span><span class="string">"compress_output"</span><span class="keyword">); 
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Tell the browser the content is compressed with gzip 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-Encoding: gzip"</span><span class="keyword">); 
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="10233""></a>
  <div class="note">
   <strong class="user">fil at rezox dot com</strong>
   <a href="#10233" class="date">20-Dec-2000 03:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
GZ-compression works perfectly for html content sent to IE5/IE5.5/Netscape6 browsers. I even compress the &lt;script src='javascriptstuff'&gt; javascript code. It speeds throughput immensely: best case so far 160k html file --&gt; 8k gzip sent.
<br />

<br />
Netscape 4 (on all platforms[?]), IE4/IE5 on the Mac do NOT support gz-compression. Email me if you want to know more.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="8785""></a>
  <div class="note">
   <strong class="user">ck at newsclub dot de</strong>
   <a href="#8785" class="date">28-Sep-2000 09:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Ah right, I did not realize it because my browsers (Acorn Browse on RISC OS and Netscape on Windows) don't make problems at all.
<br />

<br />
Anyway, you can replace your function "gzip_PrintFourChars"
<br />
with "echo pack("V",$Crc)".</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="8753""></a>
  <div class="note">
   <strong class="user">@boas.anthro.mnsu.edu</strong>
   <a href="#8753" class="date">27-Sep-2000 08:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
No, it doesn't return gzip compressed data -- specifically, the CRC is messed up.&nbsp; However, after massaging the output a lot, I have come up with a solution.&nbsp; I also commented it a lot, pointing out odd things.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="comment">// Start the output buffer
<br />
</span><span class="default">ob_start</span><span class="keyword">();
<br />
</span><span class="default">ob_implicit_flush</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">);
<br />

<br />
</span><span class="comment">// Output stuff here...
<br />

<br />
// Get the contents of the output buffer&nbsp; &nbsp; 
<br />
</span><span class="default">$contents </span><span class="keyword">= </span><span class="default">ob_get_contents</span><span class="keyword">();
<br />
</span><span class="default">ob_end_clean</span><span class="keyword">();
<br />

<br />
</span><span class="comment">// Tell the browser that they are going to get gzip data
<br />
// Of course, you already checked if they support gzip or x-gzip
<br />
// and if they support x-gzip, you'd change the header to say
<br />
// x-gzip instead, right?
<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-Encoding: gzip"</span><span class="keyword">);
<br />

<br />
</span><span class="comment">// Display the header of the gzip file
<br />
// Thanks ck@medienkombinat.de!
<br />
// Only display this once
<br />
</span><span class="keyword">echo </span><span class="string">"\x1f\x8b\x08\x00\x00\x00\x00\x00"</span><span class="keyword">;
<br />

<br />
</span><span class="comment">// Figure out the size and CRC of the original for later
<br />
</span><span class="default">$Size </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$contents</span><span class="keyword">);
<br />
</span><span class="default">$Crc </span><span class="keyword">= </span><span class="default">crc32</span><span class="keyword">(</span><span class="default">$contents</span><span class="keyword">);
<br />

<br />
</span><span class="comment">// Compress the data
<br />
</span><span class="default">$contents </span><span class="keyword">= </span><span class="default">gzcompress</span><span class="keyword">(</span><span class="default">$contents</span><span class="keyword">, </span><span class="default">9</span><span class="keyword">);
<br />

<br />
</span><span class="comment">// We can't just output it here, since the CRC is messed up.
<br />
// If I try to "echo $contents" at this point, the compressed
<br />
// data is sent, but not completely.&nbsp; There are four bytes at
<br />
// the end that are a CRC.&nbsp; Three are sent.&nbsp; The last one is
<br />
// left in limbo.&nbsp; Also, if we "echo $contents", then the next
<br />
// byte we echo will not be sent to the client.&nbsp; I am not sure
<br />
// if this is a bug in 4.0.2 or not, but the best way to avoid
<br />
// this is to put the correct CRC at the end of the compressed
<br />
// data.&nbsp; (The one generated by gzcompress looks WAY wrong.)
<br />
// This will stop Opera from crashing, gunzip will work, and
<br />
// other browsers won't keep loading indefinately.
<br />
//
<br />
// Strip off the old CRC (it's there, but it won't be displayed
<br />
// all the way -- very odd)
<br />
</span><span class="default">$contents </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$contents</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$contents</span><span class="keyword">) - </span><span class="default">4</span><span class="keyword">);
<br />

<br />
</span><span class="comment">// Show only the compressed data
<br />
</span><span class="keyword">echo </span><span class="default">$contents</span><span class="keyword">;
<br />

<br />
</span><span class="comment">// Output the CRC, then the size of the original
<br />
</span><span class="default">gzip_PrintFourChars</span><span class="keyword">(</span><span class="default">$Crc</span><span class="keyword">);
<br />
</span><span class="default">gzip_PrintFourChars</span><span class="keyword">(</span><span class="default">$Size</span><span class="keyword">);
<br />

<br />

<br />
</span><span class="comment">// Done.&nbsp; You can append further data by gzcompressing
<br />
// another string and reworking the CRC and Size stuff for
<br />
// it too.&nbsp; Repeat until done.
<br />

<br />

<br />
</span><span class="keyword">function </span><span class="default">gzip_PrintFourChars</span><span class="keyword">(</span><span class="default">$Val</span><span class="keyword">)
<br />
{
<br />
&nbsp;&nbsp;&nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">4</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">++)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">chr</span><span class="keyword">(</span><span class="default">$Val </span><span class="keyword">% </span><span class="default">256</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$Val </span><span class="keyword">= </span><span class="default">floor</span><span class="keyword">(</span><span class="default">$Val </span><span class="keyword">/ </span><span class="default">256</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
