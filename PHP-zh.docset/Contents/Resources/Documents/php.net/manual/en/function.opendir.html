<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>打开目录句柄</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.getcwd.html">? getcwd</a></li>
      <li style="float: right;"><a href="function.readdir.html">readdir ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.dir.html">Directory 函数</a></li>
    <li>打开目录句柄</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.opendir" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">opendir</h1>
  <p class="verinfo">(PHP 4, PHP 5, PHP 7)</p><p class="refpurpose"><span class="refname">opendir</span> &mdash; <span class="dc-title">打开目录句柄</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-function.opendir-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">resource</span> <span class="methodname"><strong>opendir</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$path</code></span>
   [, <span class="methodparam"><span class="type">resource</span> <code class="parameter">$context</code></span>
  ] )</div>

  <p class="para rdfs-comment">
   打开一个目录句柄，可用于之后的
   <span class="function"><a href="function.closedir.html" class="function">closedir()</a></span>，<span class="function"><a href="function.readdir.html" class="function">readdir()</a></span> 和
   <span class="function"><a href="function.rewinddir.html" class="function">rewinddir()</a></span> 调用中。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.opendir-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">path</code></dt>

     <dd>

      <p class="para">
       要打开的目录路径
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">context</code></dt>

     <dd>

      <p class="para">
       <code class="parameter">context</code> 参数的说明见手册中的
       <a href="ref.stream.html" class="link">Streams API</a> 一章。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.opendir-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   如果成功则返回目录句柄的 <span class="type"><a href="language.types.resource.html" class="type resource">resource</a></span>，失败则返回 <strong><code>FALSE</code></strong>。
  </p>
  <p class="para">
   如果 <code class="parameter">path</code>
   不是一个合法的目录或者因为权限限制或文件系统错误而不能打开目录，<span class="function"><strong>opendir()</strong></span>
   返回 <strong><code>FALSE</code></strong> 并产生一个 <a href="errorfunc.constants.html" class="link">E_WARNING</a>
   级别的 PHP 错误信息。可以在 <span class="function"><strong>opendir()</strong></span>
   前面加上"<a href="language.operators.errorcontrol.html" class="link">@</a>"符号来抑制错误信息的输出。
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.opendir-changelog">
  <h3 class="title">更新日志</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead>
      <tr>
       <th>版本</th>
       <th>说明</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
       <td>5.0.0</td>
       <td>
        <code class="parameter">path</code> 支持 <em>ftp://</em>
        URL wrapper
       </td>
      </tr>

      <tr>
       <td>4.3.0</td>
       <td>
        <code class="parameter">path</code> 可以是任何支持目录列表的
        URL，不过在 PHP 4 中只有 <em>file://</em>
        URL wrapper 支持此功能
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.opendir-examples">
  <h3 class="title">范例</h3>
  <p class="para">
   <div class="example" id="example-2479">
    <p><strong>Example #1 <span class="function"><strong>opendir()</strong></span> 例子</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$dir&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"/etc/php5/"</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//&nbsp;Open&nbsp;a&nbsp;known&nbsp;directory,&nbsp;and&nbsp;proceed&nbsp;to&nbsp;read&nbsp;its&nbsp;contents<br /></span><span style="color: #007700">if&nbsp;(</span><span style="color: #0000BB">is_dir</span><span style="color: #007700">(</span><span style="color: #0000BB">$dir</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$dh&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">opendir</span><span style="color: #007700">(</span><span style="color: #0000BB">$dir</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;((</span><span style="color: #0000BB">$file&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">readdir</span><span style="color: #007700">(</span><span style="color: #0000BB">$dh</span><span style="color: #007700">))&nbsp;!==&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"filename:&nbsp;</span><span style="color: #0000BB">$file</span><span style="color: #DD0000">&nbsp;:&nbsp;filetype:&nbsp;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">filetype</span><span style="color: #007700">(</span><span style="color: #0000BB">$dir&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$file</span><span style="color: #007700">)&nbsp;.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">closedir</span><span style="color: #007700">(</span><span style="color: #0000BB">$dh</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>以上例程的输出类似于：</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
filename: . : filetype: dir
filename: .. : filetype: dir
filename: apache : filetype: dir
filename: cgi : filetype: dir
filename: cli : filetype: dir
</pre></div>
    </div>
   </div>
  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.opendir-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.is-dir.html" class="function" rel="rdfs-seeAlso">is_dir()</a> - 判断给定文件名是否是一个目录</span></li>
    <li class="member"><span class="function"><a href="function.readdir.html" class="function" rel="rdfs-seeAlso">readdir()</a> - 从目录句柄中读取条目</span></li>
    <li class="member"><span class="function"><a href="function.dir.html" class="function" rel="rdfs-seeAlso">dir()</a> - 返回一个 Directory 类实例</span></li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="119237""></a>
  <div class="note">
   <strong class="user">hz_php at hotmail dot com { hussam alzahabi }</strong>
   <a href="#119237" class="date">25-Apr-2016 07:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Sometimes the programmer needs to access folder content which has arabic name but the opendir function will return null resources id<br />
<br />
for that we must convert the dirname charset from utf-8 to windows-1256 by the iconv function just if the preg_match function detect arabic characters and use " U " additionality to enable multibyte matching<br />
<br />
<span class="default">&lt;?php<br />
<br />
$dir </span><span class="keyword">= (</span><span class="string">"./"</span><span class="keyword">); </span><span class="comment">// on this file dir<br />
&nbsp;&nbsp; &nbsp;&nbsp; <br />
// detect if the path has arabic characters and use " u "&nbsp; optional to enable function to match multibyte characters<br />
<br />
</span><span class="keyword">if (</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'#[\x{0600}-\x{06FF}]#iu'</span><span class="keyword">, </span><span class="default">$dir</span><span class="keyword">) )&nbsp; <br />
{<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// convert input ( utf-8 ) to output ( windows-1256 ) <br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$dir </span><span class="keyword">= </span><span class="default">iconv</span><span class="keyword">(</span><span class="string">"utf-8"</span><span class="keyword">,</span><span class="string">"windows-1256"</span><span class="keyword">,</span><span class="default">$dir</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
}<br />
<br />
&nbsp;if( </span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">) ) <br />
&nbsp;{<br />
&nbsp;&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; if(&nbsp; ( </span><span class="default">$dh </span><span class="keyword">= </span><span class="default">opendir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">) ) !== </span><span class="default">null&nbsp; </span><span class="keyword">) <br />
&nbsp;&nbsp; &nbsp; {<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; while ( ( </span><span class="default">$file </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$dh</span><span class="keyword">) ) !== </span><span class="default">false&nbsp; </span><span class="keyword">) <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">"filename: "</span><span class="keyword">.</span><span class="default">$file </span><span class="keyword">.</span><span class="string">" filetype : "</span><span class="keyword">.</span><span class="default">filetype</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">.</span><span class="default">$file</span><span class="keyword">).</span><span class="string">"&lt;br/&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; <br />
&nbsp;}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="117322""></a>
  <div class="note">
   <strong class="user">gothic dot javier at gmail dot com</strong>
   <a href="#117322" class="date">22-May-2015 01:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
About<br />
// Define the parameters for the shell command<br />
$location = "\\servername\sharename";<br />
$user = "USERNAME";<br />
$pass = "PASSWORD";<br />
$letter = "Z";<br />
<br />
// Map the drive<br />
system("net use ".$letter.": \"".$location."\" ".$pass." /user:".$user." /persistent:no&gt;nul 2&gt;&amp;1");<br />
<br />
// Open the directory<br />
$dir = opendir($letter.":/an/example/path")<br />
<br />
With apache in windows this is not working is needed to double all backslashes to work.<br />
<br />
$location = "\\\\servername\\sharename";<br />
$user = "USERNAME";<br />
$pass = "PASSWORD";<br />
$letter = "Z";<br />
<br />
// Map the drive<br />
system("net use ".$letter.":&nbsp; ".$location." ".$pass." /user:".$user." /persistent:no&gt;nul 2&gt;&amp;1");<br />
$dir = $letter.":/";<br />
$dh = opendir($dir);<br />
This worked for me.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="113890""></a>
  <div class="note">
   <strong class="user">no-michael-spam at placecreativecompany dot com</strong>
   <a href="#113890" class="date">14-Dec-2013 12:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You can't rely on is_dir() and a permissions check to know whether opendir() will succeed.<br />
<br />
I'm working on a Windows system and accessing files on an OSX share. There are file/folder names with unsupported characters in them, (such as "&gt;"), so opendir() fails with "the volume label syntax is incorrect." However, is_dir() will report - correctly - that it these are valid directories!<br />
<br />
Though for what it's worth, Windows can't get in there either. The "&gt;" character existing in the folder name is a problem for both.<br />
<br />
Bottom line: you may need to test the result of opendir() before you go on to process it, even if you've checked permissions and is_dir() beforehand.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100221""></a>
  <div class="note">
   <strong class="user">sebastian dot kroskiewicz at gmail dot com</strong>
   <a href="#100221" class="date">02-Oct-2010 03:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you search for a comfortable way to include javascript code from other javascript code, here is a useful tool based on opendir():<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">class </span><span class="default">JSIncluder </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; private static </span><span class="default">$included </span><span class="keyword">= array();<br />
<br />
&nbsp;&nbsp;&nbsp; private static function </span><span class="default">ext</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">pathinfo</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">, </span><span class="default">PATHINFO_EXTENSION</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; public static function </span><span class="default">includeFile</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (isset(</span><span class="default">JSIncluder</span><span class="keyword">::</span><span class="default">$included</span><span class="keyword">[</span><span class="default">$file</span><span class="keyword">]))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">JSIncluder</span><span class="keyword">::</span><span class="default">$included</span><span class="keyword">[</span><span class="default">$file</span><span class="keyword">] = </span><span class="default">true</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$contents </span><span class="keyword">= </span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">preg_match_all</span><span class="keyword">(</span><span class="string">'/\/\*include:([^*]+)\*\//'</span><span class="keyword">, </span><span class="default">$contents</span><span class="keyword">, </span><span class="default">$deps</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$deps</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] as </span><span class="default">$dep</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_file</span><span class="keyword">(</span><span class="default">$dep</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">JSIncluder</span><span class="keyword">::</span><span class="default">includeFile</span><span class="keyword">(</span><span class="default">$dep</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">JSIncluder</span><span class="keyword">::</span><span class="default">includeAll</span><span class="keyword">(</span><span class="default">$dep</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">'&lt;script type="text/javascript"&gt;' </span><span class="keyword">. </span><span class="default">$file </span><span class="keyword">. </span><span class="string">'&lt;/script&gt;' </span><span class="keyword">. </span><span class="default">PHP_EOL</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; private static function </span><span class="default">includeAll</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ((</span><span class="default">$handle </span><span class="keyword">= </span><span class="default">opendir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">))) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; while (</span><span class="default">$file </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">clearstatcache</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_file</span><span class="keyword">(</span><span class="default">$dir </span><span class="keyword">. </span><span class="string">'/' </span><span class="keyword">. </span><span class="default">$file</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">JSIncluder</span><span class="keyword">::</span><span class="default">ext</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">) == </span><span class="string">'js'</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">JSIncluder</span><span class="keyword">::</span><span class="default">includeFile</span><span class="keyword">(</span><span class="default">$dir </span><span class="keyword">. </span><span class="string">'/' </span><span class="keyword">. </span><span class="default">$file</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } elseif (</span><span class="default">$file </span><span class="keyword">!= </span><span class="string">'..' </span><span class="keyword">&amp;&amp; </span><span class="default">$file </span><span class="keyword">!= </span><span class="string">'.'</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">JSIncluder</span><span class="keyword">::</span><span class="default">includeAll</span><span class="keyword">(</span><span class="default">$dir </span><span class="keyword">. </span><span class="string">'/' </span><span class="keyword">. </span><span class="default">$file</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">closedir</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Now, you can just write <span class="default">&lt;?php JSIncluder</span><span class="keyword">::</span><span class="default">includeFile</span><span class="keyword">(</span><span class="string">'path/to/script/main.js'</span><span class="keyword">) </span><span class="default">?&gt;</span> in your &lt;head&gt; section and then you can include files directly from your javascript files by typing /*include:path/to/other/script/foo.js*/ anywhere! For example:<br />
<br />
/*include:scripts/lib*/ //it will include the whole lib dir and its subdirectories<br />
/*include:scripts/helloworld.js*/ //it will include only one file<br />
<br />
$(function() {<br />
&nbsp;&nbsp;&nbsp; $(body).html('Hello world!');<br />
});<br />
<br />
and in your html code:<br />
&lt;head&gt;<br />
<span class="default">&lt;?php JSIncluder</span><span class="keyword">::</span><span class="default">includeFile</span><span class="keyword">(</span><span class="string">'scripts/main.js'</span><span class="keyword">) </span><span class="default">?&gt;<br />
</span>&lt;/head&gt;<br />
<br />
The JSIncluder should be safe, because all the work is done server-side and clients just can't affect anything. They could write /*include:/foo/bar*/ but nothing will happen, because the code does nothing but automatically generates &lt;script&gt; tags in specific order in your &lt;head&gt; section.<br />
<br />
Feel free to modify my code. I believe that it will be useful!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99113""></a>
  <div class="note">
   <strong class="user">cgray at metamedia dot us</strong>
   <a href="#99113" class="date">28-Jul-2010 04:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To extend the examples already given into something more flexible and complete.<br />
-c!<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/**<br />
* directory_list<br />
* return an array containing optionally all files, only directiories or only files at a file system path<br />
* @author&nbsp; &nbsp;&nbsp; cgray The Metamedia Corporation www.metamedia.us<br />
*<br />
* @param&nbsp; &nbsp; $base_path&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; string&nbsp; &nbsp; either absolute or relative path<br />
* @param&nbsp; &nbsp; $filter_dir&nbsp; &nbsp; &nbsp; &nbsp; boolean&nbsp; &nbsp; Filter directories from result (ignored except in last directory if $recursive is true)<br />
* @param&nbsp; &nbsp; $filter_files&nbsp; &nbsp; boolean&nbsp; &nbsp; Filter files from result<br />
* @param&nbsp; &nbsp; $exclude&nbsp; &nbsp; &nbsp; &nbsp; string&nbsp; &nbsp; Pipe delimited string of files to always ignore<br />
* @param&nbsp; &nbsp; $recursive&nbsp; &nbsp; &nbsp; &nbsp; boolean&nbsp; &nbsp; Descend directory to the bottom?<br />
* @return&nbsp; &nbsp; $result_list&nbsp; &nbsp; array&nbsp; &nbsp; Nested array or false<br />
* @access public<br />
* @license&nbsp; &nbsp; GPL v3<br />
*/<br />
</span><span class="keyword">function </span><span class="default">directory_list</span><span class="keyword">(</span><span class="default">$directory_base_path</span><span class="keyword">, </span><span class="default">$filter_dir </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">, </span><span class="default">$filter_files </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">, </span><span class="default">$exclude </span><span class="keyword">= </span><span class="string">".|..|.DS_Store|.svn"</span><span class="keyword">, </span><span class="default">$recursive </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$directory_base_path </span><span class="keyword">= </span><span class="default">rtrim</span><span class="keyword">(</span><span class="default">$directory_base_path</span><span class="keyword">, </span><span class="string">"/"</span><span class="keyword">) . </span><span class="string">"/"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; if (!</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$directory_base_path</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">error_log</span><span class="keyword">(</span><span class="default">__FUNCTION__ </span><span class="keyword">. </span><span class="string">"File at: </span><span class="default">$directory_base_path</span><span class="string"> is not a directory."</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$result_list </span><span class="keyword">= array();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$exclude_array </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">"|"</span><span class="keyword">, </span><span class="default">$exclude</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; if (!</span><span class="default">$folder_handle </span><span class="keyword">= </span><span class="default">opendir</span><span class="keyword">(</span><span class="default">$directory_base_path</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">error_log</span><span class="keyword">(</span><span class="default">__FUNCTION__ </span><span class="keyword">. </span><span class="string">"Could not open directory at: </span><span class="default">$directory_base_path</span><span class="string">"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }else{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while(</span><span class="default">false </span><span class="keyword">!== (</span><span class="default">$filename </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$folder_handle</span><span class="keyword">))) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(!</span><span class="default">in_array</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">, </span><span class="default">$exclude_array</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$directory_base_path </span><span class="keyword">. </span><span class="default">$filename </span><span class="keyword">. </span><span class="string">"/"</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$recursive </span><span class="keyword">&amp;&amp; </span><span class="default">strcmp</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">, </span><span class="string">"."</span><span class="keyword">)!=</span><span class="default">0 </span><span class="keyword">&amp;&amp; </span><span class="default">strcmp</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">, </span><span class="string">".."</span><span class="keyword">)!=</span><span class="default">0 </span><span class="keyword">){ </span><span class="comment">// prevent infinite recursion<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">error_log</span><span class="keyword">(</span><span class="default">$directory_base_path </span><span class="keyword">. </span><span class="default">$filename </span><span class="keyword">. </span><span class="string">"/"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result_list</span><span class="keyword">[</span><span class="default">$filename</span><span class="keyword">] = </span><span class="default">directory_list</span><span class="keyword">(</span><span class="string">"</span><span class="default">$directory_base_path$filename</span><span class="string">/"</span><span class="keyword">, </span><span class="default">$filter_dir</span><span class="keyword">, </span><span class="default">$filter_files</span><span class="keyword">, </span><span class="default">$exclude</span><span class="keyword">, </span><span class="default">$recursive</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }elseif(!</span><span class="default">$filter_dir</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result_list</span><span class="keyword">[] = </span><span class="default">$filename</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }elseif(!</span><span class="default">$filter_files</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result_list</span><span class="keyword">[] = </span><span class="default">$filename</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">closedir</span><span class="keyword">(</span><span class="default">$folder_handle</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$result_list</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="94116""></a>
  <div class="note">
   <strong class="user">diego at moon-sand dot net</strong>
   <a href="#94116" class="date">17-Oct-2009 01:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Correction on the previous function. Was missing full path on recursive line.<br />
<br />
&lt;? function file_array($path, $exclude = ".|..", $recursive = true) {<br />
&nbsp;&nbsp;&nbsp; $path = rtrim($path, "/") . "/";<br />
&nbsp;&nbsp;&nbsp; $folder_handle = opendir($path);<br />
&nbsp;&nbsp;&nbsp; $exclude_array = explode("|", $exclude);<br />
&nbsp;&nbsp;&nbsp; $result = array();<br />
&nbsp;&nbsp;&nbsp; while(false !== ($filename = readdir($folder_handle))) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(!in_array(strtolower($filename), $exclude_array)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(is_dir($path . $filename . "/")) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // Need to include full "path" or it's an infinite loop<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if($recursive) $result[] = file_array($path . $filename . "/", $exclude, true);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $result[] = $filename;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return $result;<br />
}<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92679""></a>
  <div class="note">
   <strong class="user">olivernassar.com</strong>
   <a href="#92679" class="date">03-Aug-2009 10:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hopefully this helps someone else. Returns a list of all the files in the directory and any subdirectories.
<br />
Excludes files/folders that are in the $exempt array. Can modifiy it so files aren't passed by reference fairly easily.
<br />

<br />
<span class="default">&lt;?php
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">getFiles</span><span class="keyword">(</span><span class="default">$directory</span><span class="keyword">,</span><span class="default">$exempt </span><span class="keyword">= array(</span><span class="string">'.'</span><span class="keyword">,</span><span class="string">'..'</span><span class="keyword">,</span><span class="string">'.ds_store'</span><span class="keyword">,</span><span class="string">'.svn'</span><span class="keyword">),&amp;</span><span class="default">$files </span><span class="keyword">= array()) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$handle </span><span class="keyword">= </span><span class="default">opendir</span><span class="keyword">(</span><span class="default">$directory</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while(</span><span class="default">false </span><span class="keyword">!== (</span><span class="default">$resource </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">))) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(!</span><span class="default">in_array</span><span class="keyword">(</span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">$resource</span><span class="keyword">),</span><span class="default">$exempt</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$directory</span><span class="keyword">.</span><span class="default">$resource</span><span class="keyword">.</span><span class="string">'/'</span><span class="keyword">))
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">array_merge</span><span class="keyword">(</span><span class="default">$files</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">getFiles</span><span class="keyword">(</span><span class="default">$directory</span><span class="keyword">.</span><span class="default">$resource</span><span class="keyword">.</span><span class="string">'/'</span><span class="keyword">,</span><span class="default">$exempt</span><span class="keyword">,</span><span class="default">$files</span><span class="keyword">));
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$files</span><span class="keyword">[] = </span><span class="default">$directory</span><span class="keyword">.</span><span class="default">$resource</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">closedir</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$files</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92448""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#92448" class="date">24-Jul-2009 05:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to iterate through a directory, have a look at the SPL DirectoryIterator:<br />
<a href="http://php.net/manual/class.directoryiterator.php" rel="nofollow" target="_blank">http://php.net/manual/class.directoryiterator.php</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="90789""></a>
  <div class="note">
   <strong class="user">Madog Llwyd</strong>
   <a href="#90789" class="date">10-May-2009 02:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A simple piece to open a directory and display any files with a given extension. Great for things like newsletters, score sheets or the like where you just want to make it easy on the user - they just dump in the file with the correct extension and it's done. A link is given to the file which opens up in a new window.
<br />

<br />
<span class="default">&lt;?php
<br />
&nbsp; $current_dir </span><span class="keyword">= </span><span class="string">"</span><span class="default">$DOCUMENT_ROOT</span><span class="string">"</span><span class="keyword">.</span><span class="string">"dirname/"</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">//Put in second part, the directory - without a leading slash but with a trailing slash!
<br />
&nbsp; </span><span class="default">$dir </span><span class="keyword">= </span><span class="default">opendir</span><span class="keyword">(</span><span class="default">$current_dir</span><span class="keyword">);&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Open the sucker
<br />
&nbsp; 
<br />
&nbsp; </span><span class="keyword">echo (</span><span class="string">"&lt;p&gt;&lt;h1&gt;List of available files:&lt;/h1&gt;&lt;/p&gt;&lt;hr&gt;&lt;br /&gt;"</span><span class="keyword">);
<br />
&nbsp; while (</span><span class="default">$file </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">))&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// while loop
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">{
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$parts </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">"."</span><span class="keyword">, </span><span class="default">$file</span><span class="keyword">);&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// pull apart the name and dissect by period
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$parts</span><span class="keyword">) &amp;&amp; </span><span class="default">count</span><span class="keyword">(</span><span class="default">$parts</span><span class="keyword">) &gt; </span><span class="default">1</span><span class="keyword">) {&nbsp; &nbsp; </span><span class="comment">// does the dissected array have more than one part
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$extension </span><span class="keyword">= </span><span class="default">end</span><span class="keyword">(</span><span class="default">$parts</span><span class="keyword">);&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// set to we can see last file extension
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$extension </span><span class="keyword">== </span><span class="string">"ext" </span><span class="keyword">OR </span><span class="default">$extension </span><span class="keyword">== </span><span class="string">"EXT"</span><span class="keyword">)&nbsp; &nbsp; </span><span class="comment">// is extension ext or EXT ?
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">echo </span><span class="string">"&lt;a href=\"</span><span class="default">$file</span><span class="string">\" target=\"_blank\"&gt; </span><span class="default">$file</span><span class="string"> &lt;/a&gt;&lt;br /&gt;"</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">// If so, echo it out else do nothing cos it's not what we want
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">}
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp; echo </span><span class="string">"&lt;hr&gt;&lt;br /&gt;"</span><span class="keyword">;
<br />
&nbsp; </span><span class="default">closedir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">);&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// Close the directory after we are done
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="90373""></a>
  <div class="note">
   <strong class="user">DaveRandom</strong>
   <a href="#90373" class="date">18-Apr-2009 06:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A couple of notes on Matt's posts on Windows Network Drives:<br />
<br />
Since the system() command writes the output of the executed shell command straight to the output buffer, if you wish to hide the return of the mapping command (i.e. "The command completed succesfully" or an error message) from a web browser, you need to alter the command that is sent to the shell so that the output of that command is hidden.<br />
<br />
You probably thinking "why not just use exec()?", and it's a reasonable question, but for some reason it doesn't always work - I guess it's another NT user permissions issue. If you want to guarantee you app will work with no messing around on the host system, use the system() command.<br />
<br />
In the Windows command shell, you can hide the output of a command by sending both the output (1) and error (2) messages to "nul" using pipes, in other words "&gt;nul 2&gt;&amp;1" on the end of the command. The username and password order in the "net use..." command needs switching in Matt's post.<br />
<br />
Here (<a href="http://networkm.co.uk/static/drive.html" rel="nofollow" target="_blank">http://networkm.co.uk/static/drive.html</a>) is a function I wrote to dynamically choose which drive letter to use, based on what is currently mapped and accessible to PHP.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">// Define the parameters for the shell command<br />
</span><span class="default">$location </span><span class="keyword">= </span><span class="string">"\\servername\sharename"</span><span class="keyword">;<br />
</span><span class="default">$user </span><span class="keyword">= </span><span class="string">"USERNAME"</span><span class="keyword">;<br />
</span><span class="default">$pass </span><span class="keyword">= </span><span class="string">"PASSWORD"</span><span class="keyword">;<br />
</span><span class="default">$letter </span><span class="keyword">= </span><span class="string">"Z"</span><span class="keyword">;<br />
<br />
</span><span class="comment">// Map the drive<br />
</span><span class="default">system</span><span class="keyword">(</span><span class="string">"net use "</span><span class="keyword">.</span><span class="default">$letter</span><span class="keyword">.</span><span class="string">": \""</span><span class="keyword">.</span><span class="default">$location</span><span class="keyword">.</span><span class="string">"\" "</span><span class="keyword">.</span><span class="default">$pass</span><span class="keyword">.</span><span class="string">" /user:"</span><span class="keyword">.</span><span class="default">$user</span><span class="keyword">.</span><span class="string">" /persistent:no&gt;nul 2&gt;&amp;1"</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Open the directory<br />
</span><span class="default">$dir </span><span class="keyword">= </span><span class="default">opendir</span><span class="keyword">(</span><span class="default">$letter</span><span class="keyword">.</span><span class="string">":/an/example/path"</span><span class="keyword">)<br />
<br />
...<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="89517""></a>
  <div class="note">
   <strong class="user">Richard Bronosky</strong>
   <a href="#89517" class="date">12-Mar-2009 06:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The easiest way to get a dir listing and sort it is to exec() out to ls (eg:'ls -t'). But, that is considered "unsafe". My hosting company finally caught me doing it so here is my fastest solution. (Lucky for me each file is created with a Unix Timestamp at the end of the name and no other numbers in it.)<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">#exec('ls -t ./images/motion_detection/', $files); # They outlawed exec, so now I have to do it by hand.<br />
</span><span class="keyword">if (</span><span class="default">$handle </span><span class="keyword">= </span><span class="default">opendir</span><span class="keyword">(</span><span class="string">'./images/motion_detection/'</span><span class="keyword">)) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$files</span><span class="keyword">=array();<br />
&nbsp;&nbsp;&nbsp; while (</span><span class="default">false </span><span class="keyword">!== (</span><span class="default">$file </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">))) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$files</span><span class="keyword">[</span><span class="default">$file</span><span class="keyword">] = </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/[^0-9]/'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$file</span><span class="keyword">); </span><span class="comment"># Timestamps may not be unique, file names are.<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">}<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">closedir</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">arsort</span><span class="keyword">(</span><span class="default">$files</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$files</span><span class="keyword">=</span><span class="default">array_keys</span><span class="keyword">(</span><span class="default">$files</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Before you go copying someone's bloat kitchen sink function/class, consider what you have and what you really need.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="89091""></a>
  <div class="note">
   <strong class="user">matt</strong>
   <a href="#89091" class="date">21-Feb-2009 11:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I tried it as in the post before described, but it still won't work. Maybe cause i'm using an Apache-Server on Windows 2003 Server.<br />
<br />
Now, i found a way that it works and i got access to the share. First of all, you need to set the run user for Apache to a user that has access to the share (see in post before).<br />
Then map your drive in the php script before you read the dir:<br />
<br />
system('net use K: \\servername\sharename /user:username password /persistent:no');<br />
<br />
$share = opendir('\\\\servername\\sharename');<br />
....</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="87479""></a>
  <div class="note">
   <strong class="user">Post from everything2 dot com</strong>
   <a href="#87479" class="date">06-Dec-2008 08:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
when you run Apache as a service on your Windows computer, it chooses to run as the LocalSystem account by default (usually SYSTEM). The LocalSystem account has no network privileges whatsoever which, while no doubt a good thing, makes it impossible to access networked resources (such as a shared drive) in your Apache service.<br />
<br />
First, you have to change the user the Apache service runs as. <br />
Go to your Services panel (Start -&gt; Run -&gt; "services.msc").<br />
Find the Service labeled Apache, right-click, and hit Properties. <br />
Choose the "Log On" tab.<br />
Presumably you'll see that Apache is set up to run as the Local System Account. You'll want to change this to the second option, "This account", and then fill in the details of the User account you would like Apache to run under.<br />
Some sites tell you to create a special Apache-based user account just for this occasion. It's not a bad idea, but then you have to make sure it has all of the proper permissions that an Apache user would need, such as read/write to to htdocs and the .conf and .log files, and permissions to log on as a service, etc etc - as well as the permissions to access the network resource you're trying to get to in the first place.<br />
In light of that process, I chose to just run it under my own account instead. Once you get it working, you can go back and create that special account.<br />
Hit "Apply" - it'll pop up a box saying you need to restart Apache to take effect, but hold off on that for a moment.<br />
This is the tricky part: you have to give the user (the one you're running Apache as) permissions to act as part of the OS.<br />
Go to the Local Security Policy panel (Start -&gt; Run -&gt; "secpol.msc").<br />
Under the navigation section in the left sidebar, choose Local Policies -&gt; User Rights Assignments.<br />
In the right-hand frame, double-click the item "Act as part of the operating system" to open up its properties.<br />
Select "Add User or Group, Enter the appropriate user in the box provided, and hit "OK."<br />
At this point, you are technically complete - Apache can now do the same things to the network resource that your user can - read, write, execute, whatever. However, in my case, I was trying to create an actual readable resource, so I edited my Apache config file to create an alias to my share.<br />
Open up your Apache configuration file. For most people it's httpd.conf in the conf subdirectory of your Apache install directory.<br />
Add the following text to your config file (obviously substituting your UNC for "//servername/sharename" and renaming ALIAS_DIRECTORY to whatever you'd like):<br />
<br />
Alias /ALIAS_DIRECTORY "//servername/sharename"<br />
<br />
&lt;Directory "//servername/sharename"&gt;<br />
&nbsp;&nbsp;&nbsp; Options Indexes<br />
&nbsp;&nbsp;&nbsp; AllowOverride None<br />
&nbsp;&nbsp;&nbsp; Order allow,deny<br />
&nbsp;&nbsp;&nbsp; Allow from all<br />
&lt;/Directory<br />
The other thing that is tricky and caught me up is that unlike Windows UNCs, the Apache config file requires forward slashes, not backslashes. So if you're copying the UNC directly from Windows, you'll have to turn all those slashes around.<br />
<br />
Now you can restart your Apache service. Take a swing over to <a href="http://your.site.name/ALIAS_DIRECTORY and you should be able to view the network resource just fine." rel="nofollow" target="_blank">http://your.site.name/ALIAS_DIRECTORY and you should be able to view the network resource just fine.</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="87454""></a>
  <div class="note">
   <strong class="user">php at uchange dot co dot uk</strong>
   <a href="#87454" class="date">05-Dec-2008 06:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Having spent an hour or so trying to get a complete list of files from a network share on Windows, I've given up (Apache 2.2 Win32, WinXP, PHP5 -&gt; Windows 2000 R2).<br />
<br />
Trying to use a mapped drive letter gives me an error and trying to use the UNC path works but is dog slow (it takes a couple of minutes to open and readdir() a directory with a couple of hundred files).<br />
<br />
Using this code is fast and instant (you'll have to chop up the output yourself but so be it!)<br />
<br />
$out = `dir $dir /B /S`;<br />
<br />
If you don't need recursive subdirectories remove the /S from the command - for more details run 'dir /?' on Windows.<br />
<br />
Hope this helps somebody in a similar fix!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83990""></a>
  <div class="note">
   <strong class="user">archipel dot gb at online dot fr</strong>
   <a href="#83990" class="date">22-Jun-2008 07:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here are two versions of the same function to list all files in a directory tree.<br />
<br />
The first one is recursive (calls itself while going through subdirectories) :<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">rec_listFiles</span><span class="keyword">( </span><span class="default">$from </span><span class="keyword">= </span><span class="string">'.'</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; if(! </span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$from</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$files </span><span class="keyword">= array();<br />
&nbsp;&nbsp;&nbsp; if( </span><span class="default">$dh </span><span class="keyword">= </span><span class="default">opendir</span><span class="keyword">(</span><span class="default">$from</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while( </span><span class="default">false </span><span class="keyword">!== (</span><span class="default">$file </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$dh</span><span class="keyword">)))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Skip '.' and '..'<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if( </span><span class="default">$file </span><span class="keyword">== </span><span class="string">'.' </span><span class="keyword">|| </span><span class="default">$file </span><span class="keyword">== </span><span class="string">'..'</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; continue;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$path </span><span class="keyword">= </span><span class="default">$from </span><span class="keyword">. </span><span class="string">'/' </span><span class="keyword">. </span><span class="default">$file</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">) )<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$files </span><span class="keyword">+= </span><span class="default">rec_listFiles</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$files</span><span class="keyword">[] = </span><span class="default">$path</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">closedir</span><span class="keyword">(</span><span class="default">$dh</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$files</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
The second one is iterative (uses less memory) :<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">listFiles</span><span class="keyword">( </span><span class="default">$from </span><span class="keyword">= </span><span class="string">'.'</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; if(! </span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$from</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$files </span><span class="keyword">= array();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$dirs </span><span class="keyword">= array( </span><span class="default">$from</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; while( </span><span class="default">NULL </span><span class="keyword">!== (</span><span class="default">$dir </span><span class="keyword">= </span><span class="default">array_pop</span><span class="keyword">( </span><span class="default">$dirs</span><span class="keyword">)))<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="default">$dh </span><span class="keyword">= </span><span class="default">opendir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; while( </span><span class="default">false </span><span class="keyword">!== (</span><span class="default">$file </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$dh</span><span class="keyword">)))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="default">$file </span><span class="keyword">== </span><span class="string">'.' </span><span class="keyword">|| </span><span class="default">$file </span><span class="keyword">== </span><span class="string">'..'</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; continue;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$path </span><span class="keyword">= </span><span class="default">$dir </span><span class="keyword">. </span><span class="string">'/' </span><span class="keyword">. </span><span class="default">$file</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dirs</span><span class="keyword">[] = </span><span class="default">$path</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$files</span><span class="keyword">[] = </span><span class="default">$path</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">closedir</span><span class="keyword">(</span><span class="default">$dh</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$files</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span>The iterative version should be a little faster most of the time, but the big difference is in the memory usage.<br />
<br />
Here is also a profiling function (works in php5 only) :<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">profile</span><span class="keyword">( </span><span class="default">$func</span><span class="keyword">, </span><span class="default">$trydir</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$mem1 </span><span class="keyword">= </span><span class="default">memory_get_usage</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">'&lt;pre&gt;-----------------------<br />
Test run for '</span><span class="keyword">.</span><span class="default">$func</span><span class="keyword">.</span><span class="string">'() ...<br />
'</span><span class="keyword">; </span><span class="default">flush</span><span class="keyword">();<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$time_start </span><span class="keyword">= </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$list </span><span class="keyword">= </span><span class="default">$func</span><span class="keyword">( </span><span class="default">$trydir</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$time </span><span class="keyword">= </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">) - </span><span class="default">$time_start</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">'Finished : '</span><span class="keyword">.</span><span class="default">count</span><span class="keyword">(</span><span class="default">$list</span><span class="keyword">).</span><span class="string">' files&lt;/pre&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$mem2 </span><span class="keyword">= </span><span class="default">memory_get_peak_usage</span><span class="keyword">();<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">printf</span><span class="keyword">( </span><span class="string">'&lt;pre&gt;Max memory for '</span><span class="keyword">.</span><span class="default">$func</span><span class="keyword">.</span><span class="string">'() : %0.2f kbytes<br />
Running time for '</span><span class="keyword">.</span><span class="default">$func</span><span class="keyword">.</span><span class="string">'() : %0.f s&lt;/pre&gt;'</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; (</span><span class="default">$mem2</span><span class="keyword">-</span><span class="default">$mem1</span><span class="keyword">)/</span><span class="default">1024.0</span><span class="keyword">, </span><span class="default">$time</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$list</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83225""></a>
  <div class="note">
   <strong class="user">kdouglas at satarah dot com</strong>
   <a href="#83225" class="date">16-May-2008 01:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Breadth-first-search (BFS) for a file or directory (vs. Depth-first-search)<br />
<a href="http://en.wikipedia.org/wiki/Breadth-first_search" rel="nofollow" target="_blank">http://en.wikipedia.org/wiki/Breadth-first_search</a><br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">// Breadth-First Recursive Directory Search, for a File or Directory<br />
// with optional black-list paths and optional callback function.<br />
//<br />
// $root -- is the relative path to the start-of-search directory<br />
// $file -- is the qualified file name: 'name.ext' EX: 'data.xml'<br />
//&nbsp; &nbsp; (or) $file -- is the target directory name EX: 'xml_files'<br />
// $callback -- is an optional function name and will be passed all<br />
//&nbsp; &nbsp; matching paths EX: 'my_func', instead of exiting on first match<br />
// $omit -- is an optional array of exclude paths -- relative to root<br />
//&nbsp; &nbsp; To use $omit but not $callback, pass NULL as the $callback argument<br />
//<br />
// TESTING VALUES FOLLOW ...<br />
<br />
</span><span class="keyword">function </span><span class="default">my_func </span><span class="keyword">( </span><span class="default">$path </span><span class="keyword">) {<br />
&nbsp; print </span><span class="string">"&lt;strong&gt;</span><span class="default">$path</span><span class="string">&lt;/strong&gt;&lt;br&gt;\n"</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">$root </span><span class="keyword">= </span><span class="string">'../public_html'</span><span class="keyword">;<br />
</span><span class="default">$file </span><span class="keyword">= </span><span class="string">'data.xml'</span><span class="keyword">;<br />
</span><span class="default">$callback </span><span class="keyword">= </span><span class="string">'my_func'</span><span class="keyword">;<br />
</span><span class="default">$omit </span><span class="keyword">= array( </span><span class="string">'include/img'</span><span class="keyword">, </span><span class="string">'include/css'</span><span class="keyword">, </span><span class="string">'scripts' </span><span class="keyword">);<br />
<br />
</span><span class="comment">//print breadth_first_file_search ( $root, $file );<br />
//print breadth_first_file_search ( $root, $file, $callback );<br />
//print breadth_first_file_search ( $root, $file, NULL, $omit );<br />
</span><span class="keyword">print </span><span class="default">breadth_first_file_search </span><span class="keyword">( </span><span class="default">$root</span><span class="keyword">, </span><span class="default">$file</span><span class="keyword">, </span><span class="default">$callback</span><span class="keyword">, </span><span class="default">$omit </span><span class="keyword">);<br />
<br />
function </span><span class="default">breadth_first_file_search </span><span class="keyword">( </span><span class="default">$root</span><span class="keyword">, </span><span class="default">$file</span><span class="keyword">, </span><span class="default">$callback </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">, </span><span class="default">$omit </span><span class="keyword">= array() ) {<br />
&nbsp; </span><span class="default">$queue </span><span class="keyword">= array( </span><span class="default">rtrim</span><span class="keyword">( </span><span class="default">$root</span><span class="keyword">, </span><span class="string">'/' </span><span class="keyword">).</span><span class="string">'/' </span><span class="keyword">); </span><span class="comment">// normalize all paths<br />
&nbsp; </span><span class="keyword">foreach ( </span><span class="default">$omit </span><span class="keyword">as &amp;</span><span class="default">$path </span><span class="keyword">) { </span><span class="comment">// &amp;$path Req. PHP ver 5.x and later<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$path </span><span class="keyword">= </span><span class="default">$root</span><span class="keyword">.</span><span class="default">trim</span><span class="keyword">( </span><span class="default">$path</span><span class="keyword">, </span><span class="string">'/' </span><span class="keyword">).</span><span class="string">'/'</span><span class="keyword">;<br />
&nbsp; }<br />
&nbsp; while ( </span><span class="default">$base </span><span class="keyword">= </span><span class="default">array_shift</span><span class="keyword">( </span><span class="default">$queue </span><span class="keyword">) ) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$file_path </span><span class="keyword">= </span><span class="default">$base</span><span class="keyword">.</span><span class="default">$file</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if ( </span><span class="default">file_exists</span><span class="keyword">( </span><span class="default">$file_path </span><span class="keyword">) ) { </span><span class="comment">// file found<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="keyword">if ( </span><span class="default">is_callable</span><span class="keyword">( </span><span class="default">$callback </span><span class="keyword">) ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$callback</span><span class="keyword">( </span><span class="default">$file_path </span><span class="keyword">); </span><span class="comment">// callback =&gt; CONTINUE<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="keyword">} else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$file_path</span><span class="keyword">; </span><span class="comment">// return file-path =&gt; EXIT<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="keyword">}<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if ( ( </span><span class="default">$handle </span><span class="keyword">= </span><span class="default">opendir</span><span class="keyword">( </span><span class="default">$base </span><span class="keyword">) ) ) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; while ( ( </span><span class="default">$child </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">( </span><span class="default">$handle </span><span class="keyword">) ) !== </span><span class="default">FALSE </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( </span><span class="default">is_dir</span><span class="keyword">( </span><span class="default">$base</span><span class="keyword">.</span><span class="default">$child </span><span class="keyword">) &amp;&amp; </span><span class="default">$child </span><span class="keyword">!= </span><span class="string">'.' </span><span class="keyword">&amp;&amp; </span><span class="default">$child </span><span class="keyword">!= </span><span class="string">'..' </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$combined_path </span><span class="keyword">= </span><span class="default">$base</span><span class="keyword">.</span><span class="default">$child</span><span class="keyword">.</span><span class="string">'/'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ( !</span><span class="default">in_array</span><span class="keyword">( </span><span class="default">$combined_path</span><span class="keyword">, </span><span class="default">$omit </span><span class="keyword">) ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">array_push</span><span class="keyword">( </span><span class="default">$queue</span><span class="keyword">, </span><span class="default">$combined_path</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">closedir</span><span class="keyword">( </span><span class="default">$handle </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; } </span><span class="comment">// else unable to open directory =&gt; NEXT CHILD<br />
&nbsp; </span><span class="keyword">}<br />
&nbsp; return </span><span class="default">FALSE</span><span class="keyword">; </span><span class="comment">// end of tree, file not found<br />
</span><span class="keyword">}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83211""></a>
  <div class="note">
   <strong class="user">info at myweb dot lu</strong>
   <a href="#83211" class="date">15-May-2008 05:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Read a Windows SMB Directory ;)<br />
<br />
&lt;?<br />
<br />
function SMBMap($username, $password, $server, $dir) {<br />
&nbsp;&nbsp;&nbsp; $command = "mount -t smbfs -o username=$username,password=$password //$server/$dir /mnt/tmp";<br />
&nbsp;&nbsp;&nbsp; echo system($command);<br />
}<br />
<br />
function SMBRelease() {<br />
&nbsp;&nbsp;&nbsp; $command = "umount /mnt/tmp";<br />
&nbsp;&nbsp;&nbsp; echo system($command);<br />
}<br />
<br />
function GetFiles($dir) {<br />
&nbsp;&nbsp;&nbsp; $files = array();<br />
&nbsp;&nbsp;&nbsp; if (is_dir($dir)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ($dh = opendir($dir)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; while (($file = readdir($dh)) !== false) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $files[] = $file."{".filetype("$dir/$file")."}";<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; closedir($dh);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return $files;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
}<br />
<br />
SMBMap("Daniel", "", "10.0.0.2", "Kram");<br />
$any = GetFiles("/mnt/tmp");<br />
SMBRelease();<br />
print_r($any);<br />
<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="79759""></a>
  <div class="note">
   <strong class="user">Peter Hkansson</strong>
   <a href="#79759" class="date">11-Dec-2007 06:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Would you like to view your directories in your browser this script might come in handy.<br />
<br />
<span class="default">&lt;?php<br />
$sub </span><span class="keyword">= (</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'dir'</span><span class="keyword">]);<br />
</span><span class="default">$path </span><span class="keyword">= </span><span class="string">'enter/your/directory/here/'</span><span class="keyword">;<br />
</span><span class="default">$path </span><span class="keyword">= </span><span class="default">$path </span><span class="keyword">. </span><span class="string">"</span><span class="default">$sub</span><span class="string">"</span><span class="keyword">;<br />
</span><span class="default">$dh </span><span class="keyword">= </span><span class="default">opendir</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">);<br />
</span><span class="default">$i</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">;<br />
while ((</span><span class="default">$file </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$dh</span><span class="keyword">)) !== </span><span class="default">false</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$file </span><span class="keyword">!= </span><span class="string">"." </span><span class="keyword">&amp;&amp; </span><span class="default">$file </span><span class="keyword">!= </span><span class="string">".."</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, -</span><span class="default">4</span><span class="keyword">, -</span><span class="default">3</span><span class="keyword">) ==</span><span class="string">"."</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"</span><span class="default">$i</span><span class="string">. </span><span class="default">$file</span><span class="string"> &lt;br /&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }else{&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"</span><span class="default">$i</span><span class="string">. &lt;a href='?dir=</span><span class="default">$sub</span><span class="string">/</span><span class="default">$file</span><span class="string">'&gt;</span><span class="default">$file</span><span class="string">&lt;/a&gt;&lt;br /&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$i</span><span class="keyword">++;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">closedir</span><span class="keyword">(</span><span class="default">$dh</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="79685""></a>
  <div class="note">
   <strong class="user">mana at averna dot com</strong>
   <a href="#79685" class="date">08-Dec-2007 12:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I was trying to access network drives using this opendir function. I read so many posts saying that it was almost impossible to access a network drive and finally, I found the answer; there are 2 steps to be followed to access a network drive with PHP either on the same machine or another machine.<br />
<br />
But first of all, here's the error I was getting:<br />
Warning: opendir(\\server\folder1\sub_folder) [function.opendir]: failed to open dir: No error in C:\wamp\www\PMOT\v0.1\REPORT_MENU\index.php on line 17<br />
<br />
Firstly, one must make sure that the folder \\server\folder1\sub_folder can be accessed by a user, let's say USER_TEST with a password PASS_TEST. By setting properties to this folder, one can add this given user with the correct password (USER_TEST with PASS_TEST).<br />
<br />
Secondly, the APACHE service must be set-up to take this user into account. If no user is specified, APACHE uses an anonymous user and this is where the problem/error message is coming from. One must go in control panel-&gt;administrative tools-&gt;services. One will see the list of services and must look for APACHE with Apache/2.X.X in the description. (For Wampserver, it will be called wampapache, and so on!) Right click on that and pop up the properties screen. In the tab LOG ON, there are 2 options: local system account and "this account" which will be a user specified account. This is where one must specify the USER_TEST and PASS_TEST.<br />
<br />
Following these steps worked perfectly for me but if either the folder privileges or apache log on user is disabled, then I get the initial aforementioned error message.<br />
<br />
Anyways, I hope this can help out someone!<br />
<br />
Cheers!<br />
<br />
Marc</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="78262""></a>
  <div class="note">
   <strong class="user">MetaNull</strong>
   <a href="#78262" class="date">04-Oct-2007 09:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
How to find files in a directory, using regular expressions (case-sensitive or not)<br />
<br />
<span class="default">&lt;?php<br />
<br />
clearstatcache</span><span class="keyword">();<br />
<br />
</span><span class="default">$sourcepath </span><span class="keyword">= </span><span class="string">"C:/WINDOWS/TEMP"</span><span class="keyword">;<br />
<br />
</span><span class="comment">// Replace \ by / and remove the final / if any<br />
</span><span class="default">$root </span><span class="keyword">= </span><span class="default">ereg_replace</span><span class="keyword">( </span><span class="string">"/$"</span><span class="keyword">, </span><span class="string">""</span><span class="keyword">, </span><span class="default">ereg_replace</span><span class="keyword">( </span><span class="string">"[\\]"</span><span class="keyword">, </span><span class="string">"/"</span><span class="keyword">, </span><span class="default">$sourcepath </span><span class="keyword">));<br />
<br />
</span><span class="comment">// Search for text files<br />
</span><span class="default">$results </span><span class="keyword">= </span><span class="default">m_find_in_dir</span><span class="keyword">( </span><span class="default">$root</span><span class="keyword">, </span><span class="string">".*\.txt" </span><span class="keyword">);<br />
if( </span><span class="default">false </span><span class="keyword">=== </span><span class="default">$results </span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"'</span><span class="keyword">{</span><span class="default">$sourcepath</span><span class="keyword">}</span><span class="string">' is not a valid directory\n"</span><span class="keyword">;<br />
} else {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">print_r</span><span class="keyword">( </span><span class="default">$results </span><span class="keyword">);<br />
}<br />
<br />
</span><span class="comment">/**<br />
&nbsp;* Search for a file maching a regular expression<br />
&nbsp;*<br />
&nbsp;* @param string $root Root path<br />
&nbsp;* @param string $pattern POSIX regular expression pattern<br />
&nbsp;* @param boolean $recursive Set to true to walk the subdirectories recursively<br />
&nbsp;* @param boolean $case_sensitive Set to true for case sensitive search<br />
&nbsp;* @return array An array of string representing the path of the matching files, or false in case of error<br />
&nbsp;*/<br />
</span><span class="keyword">function </span><span class="default">m_find_in_dir</span><span class="keyword">( </span><span class="default">$root</span><span class="keyword">, </span><span class="default">$pattern</span><span class="keyword">, </span><span class="default">$recursive </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">, </span><span class="default">$case_sensitive </span><span class="keyword">= </span><span class="default">false </span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">= array();<br />
&nbsp;&nbsp;&nbsp; if( </span><span class="default">$case_sensitive </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="default">false </span><span class="keyword">=== </span><span class="default">m_find_in_dir__</span><span class="keyword">( </span><span class="default">$root</span><span class="keyword">, </span><span class="default">$pattern</span><span class="keyword">, </span><span class="default">$recursive</span><span class="keyword">, </span><span class="default">$result </span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="default">false </span><span class="keyword">=== </span><span class="default">m_find_in_dir_i__</span><span class="keyword">( </span><span class="default">$root</span><span class="keyword">, </span><span class="default">$pattern</span><span class="keyword">, </span><span class="default">$recursive</span><span class="keyword">, </span><span class="default">$result </span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$result</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="comment">/**<br />
&nbsp;* @access private<br />
&nbsp;*/<br />
</span><span class="keyword">function </span><span class="default">m_find_in_dir__</span><span class="keyword">( </span><span class="default">$root</span><span class="keyword">, </span><span class="default">$pattern</span><span class="keyword">, </span><span class="default">$recursive</span><span class="keyword">, &amp;</span><span class="default">$result </span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$dh </span><span class="keyword">= @</span><span class="default">opendir</span><span class="keyword">( </span><span class="default">$root </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if( </span><span class="default">false </span><span class="keyword">=== </span><span class="default">$dh </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; while( </span><span class="default">$file </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">( </span><span class="default">$dh </span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="string">"." </span><span class="keyword">== </span><span class="default">$file </span><span class="keyword">|| </span><span class="string">".." </span><span class="keyword">== </span><span class="default">$file </span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; continue;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="default">false </span><span class="keyword">!== @</span><span class="default">ereg</span><span class="keyword">( </span><span class="default">$pattern</span><span class="keyword">, </span><span class="string">"</span><span class="keyword">{</span><span class="default">$root</span><span class="keyword">}</span><span class="string">/</span><span class="keyword">{</span><span class="default">$file</span><span class="keyword">}</span><span class="string">" </span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result</span><span class="keyword">[] = </span><span class="string">"</span><span class="keyword">{</span><span class="default">$root</span><span class="keyword">}</span><span class="string">/</span><span class="keyword">{</span><span class="default">$file</span><span class="keyword">}</span><span class="string">"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="default">false </span><span class="keyword">!== </span><span class="default">$recursive </span><span class="keyword">&amp;&amp; </span><span class="default">is_dir</span><span class="keyword">( </span><span class="string">"</span><span class="keyword">{</span><span class="default">$root</span><span class="keyword">}</span><span class="string">/</span><span class="keyword">{</span><span class="default">$file</span><span class="keyword">}</span><span class="string">" </span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">m_find_in_dir__</span><span class="keyword">( </span><span class="string">"</span><span class="keyword">{</span><span class="default">$root</span><span class="keyword">}</span><span class="string">/</span><span class="keyword">{</span><span class="default">$file</span><span class="keyword">}</span><span class="string">"</span><span class="keyword">, </span><span class="default">$pattern</span><span class="keyword">, </span><span class="default">$recursive</span><span class="keyword">, </span><span class="default">$result </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">closedir</span><span class="keyword">( </span><span class="default">$dh </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">true</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="comment">/**<br />
&nbsp;* @access private<br />
&nbsp;*/<br />
</span><span class="keyword">function </span><span class="default">m_find_in_dir_i__</span><span class="keyword">( </span><span class="default">$root</span><span class="keyword">, </span><span class="default">$pattern</span><span class="keyword">, </span><span class="default">$recursive</span><span class="keyword">, &amp;</span><span class="default">$result </span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$dh </span><span class="keyword">= @</span><span class="default">opendir</span><span class="keyword">( </span><span class="default">$root </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if( </span><span class="default">false </span><span class="keyword">=== </span><span class="default">$dh </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; while( </span><span class="default">$file </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">( </span><span class="default">$dh </span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="string">"." </span><span class="keyword">== </span><span class="default">$file </span><span class="keyword">|| </span><span class="string">".." </span><span class="keyword">== </span><span class="default">$file </span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; continue;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="default">false </span><span class="keyword">!== @</span><span class="default">eregi</span><span class="keyword">( </span><span class="default">$pattern</span><span class="keyword">, </span><span class="string">"</span><span class="keyword">{</span><span class="default">$root</span><span class="keyword">}</span><span class="string">/</span><span class="keyword">{</span><span class="default">$file</span><span class="keyword">}</span><span class="string">" </span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result</span><span class="keyword">[] = </span><span class="string">"</span><span class="keyword">{</span><span class="default">$root</span><span class="keyword">}</span><span class="string">/</span><span class="keyword">{</span><span class="default">$file</span><span class="keyword">}</span><span class="string">"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="default">false </span><span class="keyword">!== </span><span class="default">$recursive </span><span class="keyword">&amp;&amp; </span><span class="default">is_dir</span><span class="keyword">( </span><span class="string">"</span><span class="keyword">{</span><span class="default">$root</span><span class="keyword">}</span><span class="string">/</span><span class="keyword">{</span><span class="default">$file</span><span class="keyword">}</span><span class="string">" </span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">m_find_in_dir__</span><span class="keyword">( </span><span class="string">"</span><span class="keyword">{</span><span class="default">$root</span><span class="keyword">}</span><span class="string">/</span><span class="keyword">{</span><span class="default">$file</span><span class="keyword">}</span><span class="string">"</span><span class="keyword">, </span><span class="default">$pattern</span><span class="keyword">, </span><span class="default">$recursive</span><span class="keyword">, </span><span class="default">$result </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">closedir</span><span class="keyword">( </span><span class="default">$dh </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">true</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="78261""></a>
  <div class="note">
   <strong class="user">MetaNull</strong>
   <a href="#78261" class="date">04-Oct-2007 08:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
An other way to recursively walk a directory and it's content, applying a callback to each file.<br />
<br />
Exemple: Update the last modification time of each file in a folder<br />
<br />
<span class="default">&lt;?php<br />
<br />
clearstatcache</span><span class="keyword">();<br />
<br />
</span><span class="default">$sourcepath </span><span class="keyword">= </span><span class="string">"C:/WINDOWS/TEMP"</span><span class="keyword">;<br />
<br />
</span><span class="comment">// Replace \ by / and remove the final / if any<br />
</span><span class="default">$root </span><span class="keyword">= </span><span class="default">ereg_replace</span><span class="keyword">( </span><span class="string">"/$"</span><span class="keyword">, </span><span class="string">""</span><span class="keyword">, </span><span class="default">ereg_replace</span><span class="keyword">( </span><span class="string">"[\\]"</span><span class="keyword">, </span><span class="string">"/"</span><span class="keyword">, </span><span class="default">$sourcepath </span><span class="keyword">));<br />
</span><span class="comment">// Touch all the files from the $root directory<br />
</span><span class="keyword">if( </span><span class="default">false </span><span class="keyword">=== </span><span class="default">m_walk_dir</span><span class="keyword">( </span><span class="default">$root</span><span class="keyword">, </span><span class="string">"m_touch_file"</span><span class="keyword">, </span><span class="default">true </span><span class="keyword">)) {<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"'</span><span class="keyword">{</span><span class="default">$root</span><span class="keyword">}</span><span class="string">' is not a valid directory\n"</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="comment">// Walk a directory recursivelly, and apply a callback on each file<br />
</span><span class="keyword">function </span><span class="default">m_walk_dir</span><span class="keyword">( </span><span class="default">$root</span><span class="keyword">, </span><span class="default">$callback</span><span class="keyword">, </span><span class="default">$recursive </span><span class="keyword">= </span><span class="default">true </span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$dh </span><span class="keyword">= @</span><span class="default">opendir</span><span class="keyword">( </span><span class="default">$root </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if( </span><span class="default">false </span><span class="keyword">=== </span><span class="default">$dh </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; while( </span><span class="default">$file </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">( </span><span class="default">$dh </span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="string">"." </span><span class="keyword">== </span><span class="default">$file </span><span class="keyword">|| </span><span class="string">".." </span><span class="keyword">== </span><span class="default">$file </span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; continue;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">call_user_func</span><span class="keyword">( </span><span class="default">$callback</span><span class="keyword">, </span><span class="string">"</span><span class="keyword">{</span><span class="default">$root</span><span class="keyword">}</span><span class="string">/</span><span class="keyword">{</span><span class="default">$file</span><span class="keyword">}</span><span class="string">" </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="default">false </span><span class="keyword">!== </span><span class="default">$recursive </span><span class="keyword">&amp;&amp; </span><span class="default">is_dir</span><span class="keyword">( </span><span class="string">"</span><span class="keyword">{</span><span class="default">$root</span><span class="keyword">}</span><span class="string">/</span><span class="keyword">{</span><span class="default">$file</span><span class="keyword">}</span><span class="string">" </span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">m_walk_dir</span><span class="keyword">( </span><span class="string">"</span><span class="keyword">{</span><span class="default">$root</span><span class="keyword">}</span><span class="string">/</span><span class="keyword">{</span><span class="default">$file</span><span class="keyword">}</span><span class="string">"</span><span class="keyword">, </span><span class="default">$callback</span><span class="keyword">, </span><span class="default">$recursive </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">closedir</span><span class="keyword">( </span><span class="default">$dh </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">true</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="comment">// if the path indicates a file, run touch() on it<br />
</span><span class="keyword">function </span><span class="default">m_touch_file</span><span class="keyword">( </span><span class="default">$path </span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">$path </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if( !</span><span class="default">is_dir</span><span class="keyword">( </span><span class="default">$path </span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">touch</span><span class="keyword">( </span><span class="default">$path </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77691""></a>
  <div class="note">
   <strong class="user">arjan at wepwn dot nl</strong>
   <a href="#77691" class="date">09-Sep-2007 09:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A simple function to count all the files and/or dirs inside a dir.<br />
With optional extention when counting files.<br />
<br />
Index of /<br />
Some text file.txt<br />
files/<br />
num_files.phps <br />
test.php <br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">num_files</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">, </span><span class="default">$type</span><span class="keyword">, </span><span class="default">$ext</span><span class="keyword">=</span><span class="string">""</span><span class="keyword">)<br />
{<br />
</span><span class="comment">// type 1: files only<br />
// type 2: direcories only<br />
// type 3: files and directories added<br />
// type 4: files and directories separated with a space<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (!isset(</span><span class="default">$dir</span><span class="keyword">) OR empty(</span><span class="default">$dir</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">'&lt;b&gt;Syntax error:&lt;/b&gt; $dir value empty.'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; exit;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$num_files </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$num_dirs </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; switch(</span><span class="default">$type</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; { <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">1</span><span class="keyword">: </span><span class="comment">// count only files, not dirs<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$dir </span><span class="keyword">= @</span><span class="default">opendir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; while ((</span><span class="default">$file </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">)) !== </span><span class="default">false</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">is_file</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">) AND </span><span class="default">$file </span><span class="keyword">!= </span><span class="string">"." </span><span class="keyword">AND </span><span class="default">$file </span><span class="keyword">!= </span><span class="string">".."</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (isset(</span><span class="default">$ext</span><span class="keyword">) AND !empty(</span><span class="default">$ext</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$extension </span><span class="keyword">= </span><span class="default">end</span><span class="keyword">(</span><span class="default">explode</span><span class="keyword">(</span><span class="string">"."</span><span class="keyword">, </span><span class="default">$file</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$ext </span><span class="keyword">== </span><span class="default">$extension</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$num_files</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$num_files</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">closedir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$total </span><span class="keyword">= </span><span class="default">$num_files</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; break;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">2</span><span class="keyword">: </span><span class="comment">// count only dirs, not files<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$dir </span><span class="keyword">= @</span><span class="default">opendir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; while ((</span><span class="default">$file </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">)) !== </span><span class="default">false</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">) AND </span><span class="default">$file </span><span class="keyword">!= </span><span class="string">"." </span><span class="keyword">AND </span><span class="default">$file </span><span class="keyword">!= </span><span class="string">".."</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$num_dirs</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">closedir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">);&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$total </span><span class="keyword">= </span><span class="default">$num_dirs</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; break;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">3</span><span class="keyword">: </span><span class="comment">// count files PLUS dirs in once variable<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$dir </span><span class="keyword">= @</span><span class="default">opendir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; while ((</span><span class="default">$file </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">)) !== </span><span class="default">false</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">) OR </span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$file </span><span class="keyword">!= </span><span class="string">"." </span><span class="keyword">AND </span><span class="default">$file </span><span class="keyword">!= </span><span class="string">".."</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$num_files</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">closedir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$total </span><span class="keyword">= </span><span class="default">$num_files</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; break;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">4</span><span class="keyword">: </span><span class="comment">// count files AND dirs separately<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$dir </span><span class="keyword">= @</span><span class="default">opendir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; while ((</span><span class="default">$file </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">)) !== </span><span class="default">false</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">is_file</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">) AND </span><span class="default">$file </span><span class="keyword">!= </span><span class="string">"." </span><span class="keyword">AND </span><span class="default">$file </span><span class="keyword">!= </span><span class="string">".."</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$num_files</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">) AND </span><span class="default">$file </span><span class="keyword">!= </span><span class="string">"." </span><span class="keyword">AND </span><span class="default">$file </span><span class="keyword">!= </span><span class="string">".."</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$num_dirs</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">closedir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$total </span><span class="keyword">= </span><span class="default">$num_files</span><span class="keyword">.</span><span class="string">" "</span><span class="keyword">.</span><span class="default">$num_dirs</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; break;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; default:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">'&lt;b&gt;Syntax error:&lt;/b&gt; $type value empty.'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$total</span><span class="keyword">;<br />
}<br />
<br />
echo </span><span class="default">num_files</span><span class="keyword">(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'DOCUMENT_ROOT'</span><span class="keyword">], </span><span class="default">1</span><span class="keyword">, </span><span class="string">"php"</span><span class="keyword">). </span><span class="string">" file(s) met php extention&lt;br /&gt; "</span><span class="keyword">;<br />
echo </span><span class="default">num_files</span><span class="keyword">(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'DOCUMENT_ROOT'</span><span class="keyword">], </span><span class="default">1</span><span class="keyword">). </span><span class="string">" file(s)&lt;br /&gt;"</span><span class="keyword">;<br />
echo </span><span class="default">num_files</span><span class="keyword">(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'DOCUMENT_ROOT'</span><span class="keyword">], </span><span class="default">2</span><span class="keyword">). </span><span class="string">" dir(s)&lt;br /&gt;"</span><span class="keyword">;<br />
echo </span><span class="default">num_files</span><span class="keyword">(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'DOCUMENT_ROOT'</span><span class="keyword">], </span><span class="default">3</span><span class="keyword">). </span><span class="string">" file(s) + dir(s)&lt;br /&gt;"</span><span class="keyword">;<br />
</span><span class="default">$nummers </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">" "</span><span class="keyword">, </span><span class="default">num_files</span><span class="keyword">(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'DOCUMENT_ROOT'</span><span class="keyword">], </span><span class="default">4</span><span class="keyword">));<br />
echo </span><span class="default">reset</span><span class="keyword">(</span><span class="default">$nummers</span><span class="keyword">) .</span><span class="string">" file(s) en "</span><span class="keyword">. </span><span class="default">end</span><span class="keyword">(</span><span class="default">$nummers</span><span class="keyword">) .</span><span class="string">" dir(s)"</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
will output:<br />
1 file(s) with php extention<br />
3 file(s)<br />
1 dir(s)<br />
1 file(s) + dir(s)<br />
3 file(s) en 1 dir(s)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75118""></a>
  <div class="note">
   <strong class="user">lolwut</strong>
   <a href="#75118" class="date">13-May-2007 03:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I sometimes find this useful. Hope you will too.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">//list_by_ext: returns an array containing an alphabetic list of files in the specified directory ($path) with a file extension that matches $extension<br />
<br />
</span><span class="keyword">function </span><span class="default">list_by_ext</span><span class="keyword">(</span><span class="default">$extension</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$list </span><span class="keyword">= array(); </span><span class="comment">//initialise a variable<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$dir_handle </span><span class="keyword">= @</span><span class="default">opendir</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">) or die(</span><span class="string">"Unable to open </span><span class="default">$path</span><span class="string">"</span><span class="keyword">); </span><span class="comment">//attempt to open path<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">while(</span><span class="default">$file </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$dir_handle</span><span class="keyword">)){ </span><span class="comment">//loop through all the files in the path<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">$file </span><span class="keyword">== </span><span class="string">"." </span><span class="keyword">|| </span><span class="default">$file </span><span class="keyword">== </span><span class="string">".."</span><span class="keyword">){continue;} </span><span class="comment">//ignore these<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$filename </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">"."</span><span class="keyword">,</span><span class="default">$file</span><span class="keyword">); </span><span class="comment">//seperate filename from extenstion<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$cnt </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">); </span><span class="default">$cnt</span><span class="keyword">--; </span><span class="default">$ext </span><span class="keyword">= </span><span class="default">$filename</span><span class="keyword">[</span><span class="default">$cnt</span><span class="keyword">]; </span><span class="comment">//as above<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">$ext</span><span class="keyword">) == </span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">$extension</span><span class="keyword">)){ </span><span class="comment">//if the extension of the file matches the extension we are looking for...<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">array_push</span><span class="keyword">(</span><span class="default">$list</span><span class="keyword">, </span><span class="default">$file</span><span class="keyword">); </span><span class="comment">//...then stick it onto the end of the list array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">}<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$list</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]){ </span><span class="comment">//...if matches were found...<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">$list</span><span class="keyword">; </span><span class="comment">//...return the array<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">} else {</span><span class="comment">//otherwise...<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="comment">//example usage<br />
</span><span class="keyword">if(</span><span class="default">$win32_exectuables </span><span class="keyword">= </span><span class="default">list_by_ext</span><span class="keyword">(</span><span class="string">"exe"</span><span class="keyword">, </span><span class="string">"C:\WINDOWS"</span><span class="keyword">)){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$win32_exectuables</span><span class="keyword">);<br />
} else {<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"No windows executables found :(\n"</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75085""></a>
  <div class="note">
   <strong class="user">Michael mt1955 (a) gmail.com</strong>
   <a href="#75085" class="date">11-May-2007 04:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
# simple directory walk with callback function<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">callbackDir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">)<br />
{ <br />
&nbsp;&nbsp; </span><span class="comment"># do whatever you want here<br />
&nbsp;&nbsp; </span><span class="keyword">echo </span><span class="string">"</span><span class="default">$dir</span><span class="string">\n"</span><span class="keyword">;<br />
}<br />
<br />
function </span><span class="default">walkDir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">,</span><span class="default">$fx</span><span class="keyword">)<br />
{<br />
&nbsp; </span><span class="default">$arStack </span><span class="keyword">= array();<br />
&nbsp; </span><span class="default">$fx</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">);<br />
&nbsp; if( (</span><span class="default">$dh</span><span class="keyword">=</span><span class="default">opendir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">)) )<br />
&nbsp; { while( (</span><span class="default">$file</span><span class="keyword">=</span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$dh</span><span class="keyword">))!==</span><span class="default">false </span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; { if( </span><span class="default">$file</span><span class="keyword">==</span><span class="string">'.' </span><span class="keyword">|| </span><span class="default">$file</span><span class="keyword">==</span><span class="string">'..' </span><span class="keyword">) continue;<br />
&nbsp;&nbsp; &nbsp;&nbsp; if( </span><span class="default">is_dir</span><span class="keyword">(</span><span class="string">"</span><span class="default">$dir</span><span class="string">/</span><span class="default">$file</span><span class="string">"</span><span class="keyword">) )<br />
&nbsp;&nbsp; &nbsp;&nbsp; { if( !</span><span class="default">in_array</span><span class="keyword">(</span><span class="string">"</span><span class="default">$dir</span><span class="string">/</span><span class="default">$file</span><span class="string">"</span><span class="keyword">,</span><span class="default">$arStack</span><span class="keyword">) ) </span><span class="default">$arStack</span><span class="keyword">[]=</span><span class="string">"</span><span class="default">$dir</span><span class="string">/</span><span class="default">$file</span><span class="string">"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">closedir</span><span class="keyword">(</span><span class="default">$dh</span><span class="keyword">);<br />
&nbsp; }<br />
&nbsp; if( </span><span class="default">count</span><span class="keyword">(</span><span class="default">$arStack</span><span class="keyword">) )<br />
&nbsp; { foreach( </span><span class="default">$arStack </span><span class="keyword">as </span><span class="default">$subdir </span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; { </span><span class="default">walkDir</span><span class="keyword">(</span><span class="default">$subdir</span><span class="keyword">,</span><span class="default">$fx</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
}<br />
<br />
</span><span class="default">walkDir</span><span class="keyword">(</span><span class="default">$root</span><span class="keyword">,</span><span class="default">callBackDir</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74997""></a>
  <div class="note">
   <strong class="user">Dblurred</strong>
   <a href="#74997" class="date">08-May-2007 02:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In reponse to Tozeiler.&nbsp; Nice short directory dump.&nbsp; However, that displays the "." and "..".&nbsp; This removes those.&nbsp; It also makes an ordered list in case I needed to be on the phone while looking at the page.&nbsp; Easy to call out.<br />
<br />
<span class="default">&lt;?php<br />
<br />
$path </span><span class="keyword">= </span><span class="string">"your path"</span><span class="keyword">;<br />
</span><span class="default">$dh </span><span class="keyword">= </span><span class="default">opendir</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">);<br />
</span><span class="default">$i</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">;<br />
while ((</span><span class="default">$file </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$dh</span><span class="keyword">)) !== </span><span class="default">false</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$file </span><span class="keyword">!= </span><span class="string">"." </span><span class="keyword">&amp;&amp; </span><span class="default">$file </span><span class="keyword">!= </span><span class="string">".."</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"</span><span class="default">$i</span><span class="string">. &lt;a href='</span><span class="default">$path</span><span class="string">/</span><span class="default">$file</span><span class="string">'&gt;</span><span class="default">$file</span><span class="string">&lt;/a&gt;&lt;br /&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$i</span><span class="keyword">++;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">closedir</span><span class="keyword">(</span><span class="default">$dh</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73085""></a>
  <div class="note">
   <strong class="user">NerdyDork</strong>
   <a href="#73085" class="date">08-Feb-2007 05:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is a snippet to create a site map of all html files in a folder:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// read all html file in the current directory<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$dh </span><span class="keyword">= </span><span class="default">opendir</span><span class="keyword">(</span><span class="string">'./'</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$files </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while ((</span><span class="default">$file </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$dh</span><span class="keyword">)) !== </span><span class="default">false</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">) - </span><span class="default">5</span><span class="keyword">) == </span><span class="string">'.html'</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">array_push</span><span class="keyword">(</span><span class="default">$files</span><span class="keyword">, </span><span class="default">$file</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">closedir</span><span class="keyword">(</span><span class="default">$dh</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Sort the files and display<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">sort</span><span class="keyword">(</span><span class="default">$files</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"&lt;ul&gt;\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$files </span><span class="keyword">as </span><span class="default">$file</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$title </span><span class="keyword">= </span><span class="default">Title</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"&lt;li&gt;&lt;a href=\"</span><span class="default">$file</span><span class="string">\" title=\"</span><span class="default">$title</span><span class="string">\"&gt;</span><span class="default">$title</span><span class="string">&lt;/a&gt;&lt;/li&gt;\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"&lt;/ul&gt;\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Function to get a human readable title from the filename<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">Title</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$title </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">) - </span><span class="default">5</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$title </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'-'</span><span class="keyword">, </span><span class="string">' '</span><span class="keyword">, </span><span class="default">$title</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$title </span><span class="keyword">= </span><span class="default">ucwords</span><span class="keyword">(</span><span class="default">$title</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$title</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="72492""></a>
  <div class="note">
   <strong class="user">frogstarr78 at yahoo dot com</strong>
   <a href="#72492" class="date">21-Jan-2007 09:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's a function that will recrusively turn a directory into a hash of directory hashes and file arrays, automatically ignoring "dot" files. <br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">hashify_directory</span><span class="keyword">(</span><span class="default">$topdir</span><span class="keyword">, &amp;</span><span class="default">$list</span><span class="keyword">, </span><span class="default">$ignoredDirectories</span><span class="keyword">=array()) {<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$topdir</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$dh </span><span class="keyword">= </span><span class="default">opendir</span><span class="keyword">(</span><span class="default">$topdir</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; while ((</span><span class="default">$file </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$dh</span><span class="keyword">)) !== </span><span class="default">false</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!(</span><span class="default">array_search</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">,</span><span class="default">$ignoredDirectories</span><span class="keyword">) &gt; -</span><span class="default">1</span><span class="keyword">) &amp;&amp; </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'/^\./'</span><span class="keyword">, </span><span class="default">$file</span><span class="keyword">) == </span><span class="default">0</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_dir</span><span class="keyword">(</span><span class="string">"</span><span class="default">$topdir$file</span><span class="string">"</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(!isset(</span><span class="default">$list</span><span class="keyword">[</span><span class="default">$file</span><span class="keyword">])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$list</span><span class="keyword">[</span><span class="default">$file</span><span class="keyword">] = array();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ksort</span><span class="keyword">(</span><span class="default">$list</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">hashify_directory</span><span class="keyword">(</span><span class="string">"</span><span class="default">$topdir$file</span><span class="string">/"</span><span class="keyword">, </span><span class="default">$list</span><span class="keyword">[</span><span class="default">$file</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">array_push</span><span class="keyword">(</span><span class="default">$list</span><span class="keyword">, </span><span class="default">$file</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">closedir</span><span class="keyword">(</span><span class="default">$dh</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
e.g.<br />
<span class="default">&lt;?php<br />
$public_html</span><span class="keyword">[</span><span class="string">"StudentFiles"</span><span class="keyword">] = array();<br />
</span><span class="default">hashify_directory</span><span class="keyword">(</span><span class="string">"StudentFiles/"</span><span class="keyword">, </span><span class="default">$public_html</span><span class="keyword">[</span><span class="string">"StudentFiles"</span><span class="keyword">]);<br />
</span><span class="default">?&gt;<br />
</span>on the directory structure: <br />
./StudentFiles/tutorial_01/case1/file1.html<br />
./StudentFiles/tutorial_01/case1/file2.html<br />
./StudentFiles/tutorial_02/case1/file1.html<br />
./StudentFiles/tutorial_02/case2/file2.html<br />
./StudentFiles/tutorial_03/case1/file2.html<br />
etc...<br />
becomes:<br />
<span class="default">&lt;?php<br />
print_r</span><span class="keyword">(</span><span class="default">$public_html</span><span class="keyword">); <br />
</span><span class="comment">/*<br />
outputs:<br />
array(<br />
&nbsp; "StudentFiles" =&gt; array (<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; "tutorial_01" =&gt; array (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; "case1" =&gt; array( "file1.html", "file2.html")<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; ),<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; "tutorial_02" =&gt; array (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; "case1" =&gt; array( "file1.html"),<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; "case2" =&gt; array( "file2.html")<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; ),<br />
&nbsp;&nbsp; &nbsp; &nbsp; "tutorial_03" =&gt; array (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; "case1" =&gt; array( "file2.html")<br />
&nbsp;&nbsp; &nbsp; &nbsp; )<br />
&nbsp; )<br />
)<br />
*/<br />
</span><span class="default">?&gt;<br />
</span>I'm using it to create a tree view of a directory.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71742""></a>
  <div class="note">
   <strong class="user">phpguy at mailstop dot yogelements dot omitme dot com</strong>
   <a href="#71742" class="date">13-Dec-2006 10:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
An issue that I ran into is that opendir() could care less if you've got server authentication set on sub directories and so any such authentication is bypassed completely when accesses in this way. I did solve it for my application of a pretty file manager, by redirecting to all sub directories thusly:<br />
$fdir = "./subdirectory_I_want_to_visit/";<br />
if ($fdir != './') { //basically where we are or the parent<br />
&nbsp;&nbsp;&nbsp; //redirect the browser to force authentication check on any subdirectories<br />
&nbsp;&nbsp;&nbsp; header("Location: <a href="http://my.domain.com" rel="nofollow" target="_blank">http://my.domain.com</a>".dirname($_SERVER["PHP_SELF"]).substr($fdir,2));<br />
&nbsp;&nbsp;&nbsp; exit;<br />
} else {<br />
&nbsp;&nbsp;&nbsp; $dir = opendir($fdir);<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68421""></a>
  <div class="note">
   <strong class="user">Christian</strong>
   <a href="#68421" class="date">26-Jul-2006 12:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Pointing on the previous post, I'd like to say the following.<br />
<br />
You can use opendir on all valid (existant and reachable) folders.<br />
This counts not only for windows but also for linux.<br />
Under linux, you can also read root folders etc.<br />
<br />
To avoid access to non-public data, you should check the given parameter for opendir before executing opendir.<br />
<br />
Let's say you have this:<br />
<br />
/home/users/mrsmith/<br />
/home/users/mrsmith/info.txt<br />
/home/users/mrsmith/test/photo.jpg<br />
/home/users/mradmin/private.txt<br />
<br />
Now you don't want mrsmith to access mradmin's folders/files.<br />
In that case you could/should define the path where the data MUST be inside.<br />
<br />
Attention:<br />
Don't check the data with substr though, it's not a secure solution.<br />
Exploit example: /home/users/mrsmith/../mradmin/<br />
Exploit example2: /home/users/mrsmith/../../../../../../../../../../../../../dev/<br />
<br />
I'd do a case sensitive regex match.<br />
So after the first folder there may not be a subfolder named ".." because that would jump one folder back.<br />
<br />
I hope this isn't too offtopic or so but I think it's important to think of that when creating file systems.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="66052""></a>
  <div class="note">
   <strong class="user">tim2005</strong>
   <a href="#66052" class="date">13-May-2006 02:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hello,<br />
<br />
A friend of mine is running a webhost, I think i found a security leak with this script:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">select_files</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">, </span><span class="default">$label </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">, </span><span class="default">$select_name</span><span class="keyword">, </span><span class="default">$curr_val </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">, </span><span class="default">$char_length </span><span class="keyword">= </span><span class="default">30</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$teller </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$handle </span><span class="keyword">= </span><span class="default">opendir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$mydir </span><span class="keyword">= (</span><span class="default">$label </span><span class="keyword">!= </span><span class="string">""</span><span class="keyword">) ? </span><span class="string">"&lt;label for=\""</span><span class="keyword">.</span><span class="default">$select_name</span><span class="keyword">.</span><span class="string">"\"&gt;"</span><span class="keyword">.</span><span class="default">$label</span><span class="keyword">.</span><span class="string">"&lt;/label&gt;\n" </span><span class="keyword">: </span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$mydir </span><span class="keyword">.= </span><span class="string">"&lt;select name=\""</span><span class="keyword">.</span><span class="default">$select_name</span><span class="keyword">.</span><span class="string">"\"&gt;\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$curr_val </span><span class="keyword">= (isset(</span><span class="default">$_REQUEST</span><span class="keyword">[</span><span class="default">$select_name</span><span class="keyword">])) ? </span><span class="default">$_REQUEST</span><span class="keyword">[</span><span class="default">$select_name</span><span class="keyword">] : </span><span class="default">$curr_val</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$mydir </span><span class="keyword">.= (</span><span class="default">$curr_val </span><span class="keyword">== </span><span class="string">""</span><span class="keyword">) ? </span><span class="string">"&nbsp; &lt;option value=\"\" selected&gt;...\n" </span><span class="keyword">: </span><span class="string">"&lt;option value=\"\"&gt;...\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while (</span><span class="default">false </span><span class="keyword">!== (</span><span class="default">$file </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">))) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$files</span><span class="keyword">[] = </span><span class="default">$file</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">closedir</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">sort</span><span class="keyword">(</span><span class="default">$files</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$files </span><span class="keyword">as </span><span class="default">$val</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_file</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">.</span><span class="default">$val</span><span class="keyword">)) { </span><span class="comment">// show only real files (ver. 1.01)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$mydir </span><span class="keyword">.= </span><span class="string">"&nbsp; &nbsp; &lt;option value=\""</span><span class="keyword">.</span><span class="default">$val</span><span class="keyword">.</span><span class="string">"\""</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$mydir </span><span class="keyword">.= (</span><span class="default">$val </span><span class="keyword">== </span><span class="default">$curr_val</span><span class="keyword">) ? </span><span class="string">" selected&gt;" </span><span class="keyword">: </span><span class="string">"&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$mydir </span><span class="keyword">.= (</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">) &gt; </span><span class="default">$char_length</span><span class="keyword">) ? </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$char_length</span><span class="keyword">).</span><span class="string">"...\n" </span><span class="keyword">: </span><span class="default">$val</span><span class="keyword">.</span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$teller</span><span class="keyword">++;&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$mydir </span><span class="keyword">.= </span><span class="string">"&lt;/select&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$teller </span><span class="keyword">== </span><span class="default">0</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$mydir </span><span class="keyword">= </span><span class="string">"No files!"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$mydir</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
echo </span><span class="default">select_files</span><span class="keyword">(</span><span class="string">"C:/winnt/"</span><span class="keyword">, </span><span class="string">""</span><span class="keyword">, </span><span class="string">""</span><span class="keyword">, </span><span class="string">""</span><span class="keyword">, </span><span class="string">"60"</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span> <br />
<br />
Now i can see hist files in his windows dir. Is this a leak? and is it fixable? I'll report this as bug too!<br />
<br />
Tim2005</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="64480""></a>
  <div class="note">
   <strong class="user">tozeiler</strong>
   <a href="#64480" class="date">15-Apr-2006 10:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
"opendir" said:<br />
------------------------------------------------------------------<br />
<br />
23-Jan-2006 08:04<br />
I Just wanted a directory list and a clickable link to download the files <br />
<br />
&lt;snip&gt;<br />
------<br />
&lt;?<br />
echo ("&lt;h1&gt;Directory Overzicht:&lt;/h1&gt;");<br />
<br />
function getFiles($path) {<br />
<br />
&lt;snip complicated function contents&gt;<br />
<br />
------------------------------------------------------------------<br />
Here's a more straightforward way to linkify $path/files:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">echo </span><span class="string">"&lt;h1&gt;Directory Overzicht:&lt;/h1&gt;"</span><span class="keyword">;<br />
<br />
</span><span class="default">$dh </span><span class="keyword">= </span><span class="default">opendir</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">);<br />
while ((</span><span class="default">$file </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$dh</span><span class="keyword">)) !== </span><span class="default">false</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"&lt;a href='</span><span class="default">$path</span><span class="string">/</span><span class="default">$file</span><span class="string">'&gt;</span><span class="default">$file</span><span class="string">&lt;/a&gt;&lt;br /&gt;"</span><span class="keyword">;<br />
}<br />
</span><span class="default">closedir</span><span class="keyword">(</span><span class="default">$dh</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="61012""></a>
  <div class="note">
   
   <a href="#61012" class="date">23-Jan-2006 04:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I Just wanted a directory list and a clickable link to download the files because my plesk server does not give me this function. I edited the script a little bit.<br />
<br />
Many thanks from a script-noob<br />
<br />
------<br />
&lt;?<br />
echo ("&lt;h1&gt;Directory Overzicht:&lt;/h1&gt;");<br />
<br />
function getFiles($path) {<br />
&nbsp;&nbsp; //Function takes a path, and returns a numerically indexed array of associative arrays containing file information,<br />
&nbsp;&nbsp; //sorted by the file name (case insensitive).&nbsp; If two files are identical when compared without case, they will sort<br />
&nbsp;&nbsp; //relative to each other in the order presented by readdir()<br />
&nbsp;&nbsp; $files = array();<br />
&nbsp;&nbsp; $fileNames = array();<br />
&nbsp;&nbsp; $i = 0;<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp; if (is_dir($path)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; if ($dh = opendir($path)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; while (($file = readdir($dh)) !== false) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ($file == "." || $file == "..") continue;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $fullpath = $path . "/" . $file;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $fkey = strtolower($file);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; while (array_key_exists($fkey,$fileNames)) $fkey .= " ";<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $a = stat($fullpath);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $files[$fkey]['size'] = $a['size'];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ($a['size'] == 0) $files[$fkey]['sizetext'] = "-";<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else if ($a['size'] &gt; 1024) $files[$fkey]['sizetext'] = (ceil($a['size']/1024*100)/100) . " K";<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else if ($a['size'] &gt; 1024*1024) $files[$fkey]['sizetext'] = (ceil($a['size']/(1024*1024)*100)/100) . " Mb";<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else $files[$fkey]['sizetext'] = $a['size'] . " bytes";<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $files[$fkey]['name'] = $file;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $files[$fkey]['type'] = filetype($fullpath);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $fileNames[$i++] = $fkey;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; closedir($dh);<br />
&nbsp;&nbsp; &nbsp; &nbsp; } else die ("Cannot open directory:&nbsp; $path");<br />
&nbsp;&nbsp; } else die ("Path is not a directory:&nbsp; $path");<br />
&nbsp;&nbsp; sort($fileNames,SORT_STRING);<br />
&nbsp;&nbsp; $sortedFiles = array();<br />
&nbsp;&nbsp; $i = 0;<br />
&nbsp;&nbsp; foreach($fileNames as $f) $sortedFiles[$i++] = $files[$f];<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp; return $sortedFiles;<br />
}<br />
<br />
$files = getFiles("./");<br />
foreach ($files as $file) print "&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;b&gt;&lt;a href=\"$file[name]\"&gt;$file[name]&lt;/a&gt;&lt;/b&gt;&lt;br&gt;\n";<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="60169""></a>
  <div class="note">
   <strong class="user">mstabile75 at gmail dot com</strong>
   <a href="#60169" class="date">28-Dec-2005 05:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In my previous post I ran into a problem with the "global" definition of $directorylist.&nbsp; If I called the function more than once on the same page it would combine the file lists. I looked at Lasse Dalegaard's example and used the following solution.<br />
<br />
remove global definition<br />
&nbsp;&nbsp; &nbsp; global $directorylist; <br />
<br />
REPLACE <br />
&lt;?<br />
if ((($maxlevel) == "all") or ($maxlevel &gt; $level)) {<br />
&nbsp;&nbsp; filelist($startdir . $file . "/", $searchSubdirs, $directoriesonly, $maxlevel, $level + 1);<br />
}<br />
?&gt;<br />
WITH<br />
&lt;?<br />
if ((($maxlevel) == "all") or ($maxlevel &gt; $level)) {<br />
&nbsp;&nbsp;&nbsp; $list2 = filelist($startdir . $file . "/", $searchSubdirs, $directoriesonly, $maxlevel, $level + 1);<br />
&nbsp;&nbsp;&nbsp; if(is_array($list2)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $directorylist = array_merge($directorylist, $list2);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="60127""></a>
  <div class="note">
   <strong class="user">mstabile75 at gmail dot com</strong>
   <a href="#60127" class="date">27-Dec-2005 04:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
</span><span class="comment">/* The below function will list all folders and files within a directory<br />
It is a recursive function that uses a global array.&nbsp; The global array was the easiest <br />
way for me to work with an array in a recursive function<br />
*This function has no limit on the number of levels down you can search.<br />
*The array structure was one that worked for me.<br />
ARGUMENTS:<br />
$startdir =&gt; specify the directory to start from; format: must end in a "/"<br />
$searchSubdirs =&gt; True/false; True if you want to search subdirectories<br />
$directoriesonly =&gt; True/false; True if you want to only return directories<br />
$maxlevel =&gt; "all" or a number; specifes the number of directories down that you want to search<br />
$level =&gt; integer; directory level that the function is currently searching<br />
*/<br />
</span><span class="keyword">function </span><span class="default">filelist </span><span class="keyword">(</span><span class="default">$startdir</span><span class="keyword">=</span><span class="string">"./"</span><span class="keyword">, </span><span class="default">$searchSubdirs</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">, </span><span class="default">$directoriesonly</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">, </span><span class="default">$maxlevel</span><span class="keyword">=</span><span class="string">"all"</span><span class="keyword">, </span><span class="default">$level</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//list the directory/file names that you want to ignore<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ignoredDirectory</span><span class="keyword">[] = </span><span class="string">"."</span><span class="keyword">; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ignoredDirectory</span><span class="keyword">[] = </span><span class="string">".."</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ignoredDirectory</span><span class="keyword">[] = </span><span class="string">"_vti_cnf"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; global </span><span class="default">$directorylist</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">//initialize global array<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$startdir</span><span class="keyword">)) { <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$dh </span><span class="keyword">= </span><span class="default">opendir</span><span class="keyword">(</span><span class="default">$startdir</span><span class="keyword">)) { <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; while ((</span><span class="default">$file </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$dh</span><span class="keyword">)) !== </span><span class="default">false</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!(</span><span class="default">array_search</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">,</span><span class="default">$ignoredDirectory</span><span class="keyword">) &gt; -</span><span class="default">1</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">filetype</span><span class="keyword">(</span><span class="default">$startdir </span><span class="keyword">. </span><span class="default">$file</span><span class="keyword">) == </span><span class="string">"dir"</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">//build your directory array however you choose; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //add other file details that you want.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$directorylist</span><span class="keyword">[</span><span class="default">$startdir </span><span class="keyword">. </span><span class="default">$file</span><span class="keyword">][</span><span class="string">'level'</span><span class="keyword">] = </span><span class="default">$level</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$directorylist</span><span class="keyword">[</span><span class="default">$startdir </span><span class="keyword">. </span><span class="default">$file</span><span class="keyword">][</span><span class="string">'dir'</span><span class="keyword">] = </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$directorylist</span><span class="keyword">[</span><span class="default">$startdir </span><span class="keyword">. </span><span class="default">$file</span><span class="keyword">][</span><span class="string">'name'</span><span class="keyword">] = </span><span class="default">$file</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$directorylist</span><span class="keyword">[</span><span class="default">$startdir </span><span class="keyword">. </span><span class="default">$file</span><span class="keyword">][</span><span class="string">'path'</span><span class="keyword">] = </span><span class="default">$startdir</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$searchSubdirs</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (((</span><span class="default">$maxlevel</span><span class="keyword">) == </span><span class="string">"all"</span><span class="keyword">) or (</span><span class="default">$maxlevel </span><span class="keyword">&gt; </span><span class="default">$level</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">filelist</span><span class="keyword">(</span><span class="default">$startdir </span><span class="keyword">. </span><span class="default">$file </span><span class="keyword">. </span><span class="string">"/"</span><span class="keyword">, </span><span class="default">$searchSubdirs</span><span class="keyword">, </span><span class="default">$directoriesonly</span><span class="keyword">, </span><span class="default">$maxlevel</span><span class="keyword">, </span><span class="default">$level </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (!</span><span class="default">$directoriesonly</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">//if you want to include files; build your file array&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //however you choose; add other file details that you want.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$directorylist</span><span class="keyword">[</span><span class="default">$startdir </span><span class="keyword">. </span><span class="default">$file</span><span class="keyword">][</span><span class="string">'level'</span><span class="keyword">] = </span><span class="default">$level</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$directorylist</span><span class="keyword">[</span><span class="default">$startdir </span><span class="keyword">. </span><span class="default">$file</span><span class="keyword">][</span><span class="string">'dir'</span><span class="keyword">] = </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$directorylist</span><span class="keyword">[</span><span class="default">$startdir </span><span class="keyword">. </span><span class="default">$file</span><span class="keyword">][</span><span class="string">'name'</span><span class="keyword">] = </span><span class="default">$file</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$directorylist</span><span class="keyword">[</span><span class="default">$startdir </span><span class="keyword">. </span><span class="default">$file</span><span class="keyword">][</span><span class="string">'path'</span><span class="keyword">] = </span><span class="default">$startdir</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; }}}}<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">closedir</span><span class="keyword">(</span><span class="default">$dh</span><span class="keyword">);<br />
}}<br />
return(</span><span class="default">$directorylist</span><span class="keyword">);<br />
}<br />
</span><span class="default">$files </span><span class="keyword">= </span><span class="default">filelist</span><span class="keyword">(</span><span class="string">"./"</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">); </span><span class="comment">// call the function<br />
</span><span class="keyword">foreach (</span><span class="default">$files </span><span class="keyword">as </span><span class="default">$list</span><span class="keyword">) {</span><span class="comment">//print array<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">echo </span><span class="string">"Directory: " </span><span class="keyword">. </span><span class="default">$list</span><span class="keyword">[</span><span class="string">'dir'</span><span class="keyword">] . </span><span class="string">" =&gt; Level: " </span><span class="keyword">. </span><span class="default">$list</span><span class="keyword">[</span><span class="string">'level'</span><span class="keyword">] . </span><span class="string">" =&gt; Name: " </span><span class="keyword">. </span><span class="default">$list</span><span class="keyword">[</span><span class="string">'name'</span><span class="keyword">] . </span><span class="string">" =&gt; Path: " </span><span class="keyword">. </span><span class="default">$list</span><span class="keyword">[</span><span class="string">'path'</span><span class="keyword">] .</span><span class="string">"&lt;br&gt;"</span><span class="keyword">;<br />
}</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="59599""></a>
  <div class="note">
   <strong class="user">chrys at mytechjournal dot com</strong>
   <a href="#59599" class="date">10-Dec-2005 08:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I wrote a function to recursively delete files from a starting directory.&nbsp; I had to do this because my server doesn't allow me to delete files that apache writes because I don't have permissions, so... I let apache do the work.<br />
<br />
<span class="default">&lt;?php<br />
$dir </span><span class="keyword">= </span><span class="string">"/path/to/base/dir"</span><span class="keyword">;<br />
<br />
</span><span class="default">recursive_delete</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">);<br />
<br />
function </span><span class="default">recursive_delete</span><span class="keyword">( </span><span class="default">$dir </span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$dh </span><span class="keyword">= </span><span class="default">opendir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; while ((</span><span class="default">$file </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$dh</span><span class="keyword">)) !== </span><span class="default">false </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="default">$file </span><span class="keyword">!= </span><span class="string">"." </span><span class="keyword">&amp;&amp; </span><span class="default">$file </span><span class="keyword">!= </span><span class="string">".." </span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="default">is_dir</span><span class="keyword">( </span><span class="default">$dir </span><span class="keyword">. </span><span class="default">$file </span><span class="keyword">) )<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Entering Directory: </span><span class="default">$dir$file</span><span class="string">&lt;br/&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">recursive_delete</span><span class="keyword">( </span><span class="default">$dir </span><span class="keyword">. </span><span class="default">$file </span><span class="keyword">. </span><span class="string">"/" </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Removing Directory: </span><span class="default">$dir$file</span><span class="string">&lt;br/&gt;&lt;br/&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">rmdir</span><span class="keyword">( </span><span class="default">$dir </span><span class="keyword">. </span><span class="default">$file </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Deleting file: </span><span class="default">$dir$file</span><span class="string">&lt;br/&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">unlink</span><span class="keyword">( </span><span class="default">$dir </span><span class="keyword">. </span><span class="default">$file </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">closedir</span><span class="keyword">(</span><span class="default">$dh</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="59249""></a>
  <div class="note">
   <strong class="user">neale-php at woozle dot org</strong>
   <a href="#59249" class="date">30-Nov-2005 06:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
oryan's example is still sub-optimal, even if people using it never ever substitute a variable for directory.<br />
<br />
Just use PHP's glob() function, which will be faster and more efficient anyway since it doesn't have to launch a shell and run the ls program (that's what the shell_exec does).<br />
<br />
$result = glob("directory/*");</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="58341""></a>
  <div class="note">
   <strong class="user">oryan at zareste dot com</strong>
   <a href="#58341" class="date">01-Nov-2005 12:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There might be a bit of truth to that.&nbsp; If, by chance, the webmaster made a form saying "type a random directory name here" and used that in the function, there'd be a problem.&nbsp; So let's eliminate the 'function' part<br />
<br />
$files=shell_exec("ls directory");<br />
$result=explode("\n",$files);<br />
<br />
'$result' will now be an array of the directory files.&nbsp; You can use variables in the shell_exec command, but don't use anything that could be user-sent.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="58335""></a>
  <div class="note">
   <strong class="user">aligma at gmail dot com</strong>
   <a href="#58335" class="date">01-Nov-2005 04:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The example given by oryan at zareste dot com may also be a "simpler faster way" of creating security holes in your code. The function listed above prevents risking execution of abitrary shell commands listed after a semicolon (;) in your directory name.<br />
Example: $directory = '.;rm -rf /';<br />
Result: List this directory, erase contents of filesystem.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="58301""></a>
  <div class="note">
   <strong class="user">oryan at zareste dot com</strong>
   <a href="#58301" class="date">31-Oct-2005 02:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There's a simpler faster way to get a whole directory if you're using PHP 4.&nbsp; This function uses shell_exec - <a href="http://us3.php.net/shell_exec - and assumes you" rel="nofollow" target="_blank">http://us3.php.net/shell_exec - and assumes you</a>'re using Unix/Linux and have shell access -<br />
<br />
function dir($directory){<br />
&nbsp;&nbsp; $files=shell_exec("ls ".$directory);<br />
&nbsp;&nbsp; return explode("\n",$files);<br />
}<br />
<br />
This returns an array with all the files.<br />
This way, you can use modifiers like -t, which shows files in order of modification time ($files=shell_exec("ls -t ".$directory);).&nbsp; Enough tweaking and you can use it on Windows, though I can't say how since I don't have a Windows server to try it on</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="57568""></a>
  <div class="note">
   <strong class="user">asharm4 at ilstu dot edu</strong>
   <a href="#57568" class="date">07-Oct-2005 06:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
//this is a function I wrote to sort out the contents of the directory date wise for display.<br />
<br />
&nbsp;$content_array = array();<br />
<br />
//set current working directory<br />
$dirname = "C:\temp";<br />
<br />
//Load Directory Into Array<br />
$handle=opendir($dirname);<br />
$i=0;<br />
while ($file = readdir($handle))<br />
if ($file != "." &amp;&amp; $file != "..")<br />
{<br />
&nbsp;&nbsp; &nbsp; &nbsp; $content_array[$i][0] = $file;<br />
&nbsp;&nbsp; &nbsp; &nbsp; $content_array[$i][1] = date ("Y m d", filemtime($dirname."/".$file));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $i++;<br />
}<br />
//close the directory handle<br />
closedir($handle);<br />
<br />
//these lines sort the contents of the directory by the date<br />
&nbsp;&nbsp;&nbsp; foreach($content_array as $res)<br />
&nbsp;&nbsp; &nbsp; &nbsp; $sortAux[] = $res[1];<br />
&nbsp;&nbsp;&nbsp; array_multisort($sortAux, SORT_ASC, $content_array);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="57504""></a>
  <div class="note">
   
   <a href="#57504" class="date">06-Oct-2005 06:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This function sorts files by name as strings, but without regard to case.&nbsp; It also does some handy string formatting of the file size information.<br />
<br />
&lt;?<br />
function getFiles($path) {<br />
&nbsp;&nbsp;&nbsp; //Function takes a path, and returns a numerically indexed array of associative arrays containing file information,<br />
&nbsp;&nbsp;&nbsp; //sorted by the file name (case insensitive).&nbsp; If two files are identical when compared without case, they will sort<br />
&nbsp;&nbsp;&nbsp; //relative to each other in the order presented by readdir()<br />
&nbsp;&nbsp;&nbsp; $files = array();<br />
&nbsp;&nbsp;&nbsp; $fileNames = array();<br />
&nbsp;&nbsp;&nbsp; $i = 0;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; if (is_dir($path)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ($dh = opendir($path)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; while (($file = readdir($dh)) !== false) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($file == "." || $file == "..") continue;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $fullpath = $path . "/" . $file;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $fkey = strtolower($file);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; while (array_key_exists($fkey,$fileNames)) $fkey .= " ";<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $a = stat($fullpath);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $files[$fkey]['size'] = $a['size'];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($a['size'] == 0) $files[$fkey]['sizetext'] = "-";<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else if ($a['size'] &gt; 1024) $files[$fkey]['sizetext'] = (ceil($a['size']/1024*100)/100) . " K";<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else if ($a['size'] &gt; 1024*1024) $files[$fkey]['sizetext'] = (ceil($a['size']/(1024*1024)*100)/100) . " Mb";<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else $files[$fkey]['sizetext'] = $a['size'] . " bytes";<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $files[$fkey]['name'] = $file;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $files[$fkey]['type'] = filetype($fullpath);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $fileNames[$i++] = $fkey;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; closedir($dh);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else die ("Cannot open directory:&nbsp; $path");<br />
&nbsp;&nbsp;&nbsp; } else die ("Path is not a directory:&nbsp; $path");<br />
&nbsp;&nbsp;&nbsp; sort($fileNames,SORT_STRING);<br />
&nbsp;&nbsp;&nbsp; $sortedFiles = array();<br />
&nbsp;&nbsp;&nbsp; $i = 0;<br />
&nbsp;&nbsp;&nbsp; foreach($fileNames as $f) $sortedFiles[$i++] = $files[$f];<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; return $sortedFiles;<br />
}<br />
<br />
$files = getFiles("C:");<br />
foreach ($files as $file) print "$file[name]&lt;br&gt;\n";<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="53045""></a>
  <div class="note">
   <strong class="user">Lasse Dalegaard</strong>
   <a href="#53045" class="date">21-May-2005 09:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I made a function for finding all files in a specified directory and all subdirectories. It can be quite usefull when searching in alot of files in alot subdirectories. The function returns an array with the path of all the files found.<br />
<br />
&lt;?<br />
function getFiles($directory) {<br />
&nbsp;&nbsp;&nbsp; // Try to open the directory<br />
&nbsp;&nbsp;&nbsp; if($dir = opendir($directory)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // Create an array for all files found<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $tmp = Array();<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // Add the files<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while($file = readdir($dir)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // Make sure the file exists<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if($file != "." &amp;&amp; $file != ".." &amp;&amp; $file[0] != '.') {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // If it's a directiry, list all files within it<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(is_dir($directory . "/" . $file)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $tmp2 = getFiles($directory . "/" . $file);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(is_array($tmp2)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $tmp = array_merge($tmp, $tmp2);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; array_push($tmp, $directory . "/" . $file);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // Finish off the function<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; closedir($dir);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return $tmp;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
// Example of use<br />
print_r(getFiles('.')); // This will find all files in the current directory and all subdirectories<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="51395""></a>
  <div class="note">
   <strong class="user">iamnotanerd</strong>
   <a href="#51395" class="date">29-Mar-2005 06:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is a snippet of the code that I created to search for a file..recursively open the directories and search for a match..
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">search</span><span class="keyword">(</span><span class="default">$target</span><span class="keyword">, </span><span class="default">$directory</span><span class="keyword">){
<br />
&nbsp;&nbsp; &nbsp; 
<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$directory</span><span class="keyword">)){
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$direc </span><span class="keyword">= </span><span class="default">opendir</span><span class="keyword">(</span><span class="default">$directory</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while(</span><span class="default">false </span><span class="keyword">!== (</span><span class="default">$file </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$direc</span><span class="keyword">))){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$file </span><span class="keyword">!=</span><span class="string">"." </span><span class="keyword">&amp;&amp; </span><span class="default">$file </span><span class="keyword">!= </span><span class="string">".."</span><span class="keyword">){
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">is_file</span><span class="keyword">(</span><span class="default">$directory</span><span class="keyword">.</span><span class="string">"/"</span><span class="keyword">.</span><span class="default">$file</span><span class="keyword">)){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/</span><span class="default">$target</span><span class="string">/i"</span><span class="keyword">, </span><span class="default">$file</span><span class="keyword">)){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"&lt;a href=\"</span><span class="default">$directory</span><span class="string">/</span><span class="default">$file</span><span class="string">\"&gt;</span><span class="default">$file</span><span class="string">&lt;/a&gt;&lt;br&gt;"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }else if(</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$directory</span><span class="keyword">.</span><span class="string">"/"</span><span class="keyword">.</span><span class="default">$file</span><span class="keyword">)){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">search</span><span class="keyword">(</span><span class="default">$target</span><span class="keyword">,</span><span class="default">$directory</span><span class="keyword">.</span><span class="string">"/"</span><span class="keyword">.</span><span class="default">$file</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">closedir</span><span class="keyword">(</span><span class="default">$direc</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; return ;
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="49756""></a>
  <div class="note">
   <strong class="user">hendrik dot wermer at gmx dot de</strong>
   <a href="#49756" class="date">08-Feb-2005 02:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's another version of directory listing, since I had some problems using the examples below. It will display the content of the current directory, sorted by directories and files.<br />
You can also search subdirectories by setting $maxDepth &gt; 0. There's a link to other directories, so you can easily switch to the parent directory or to other directories in the current directory.<br />
Hope it helps!<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// show directory content<br />
</span><span class="keyword">function </span><span class="default">showDir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">, </span><span class="default">$maxDepth</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$i</span><span class="keyword">++;<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$checkDir </span><span class="keyword">= </span><span class="default">opendir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$cDir </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$cFile </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// check all files in $dir, add to array listDir or listFile<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">while(</span><span class="default">$file </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$checkDir</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$file </span><span class="keyword">!= </span><span class="string">"." </span><span class="keyword">&amp;&amp; </span><span class="default">$file </span><span class="keyword">!= </span><span class="string">".."</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$dir </span><span class="keyword">. </span><span class="string">"/" </span><span class="keyword">. </span><span class="default">$file</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$listDir</span><span class="keyword">[</span><span class="default">$cDir</span><span class="keyword">] = </span><span class="default">$file</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$cDir</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$listFile</span><span class="keyword">[</span><span class="default">$cFile</span><span class="keyword">] = </span><span class="default">$file</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$cFile</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// show directories<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">count</span><span class="keyword">(</span><span class="default">$listDir</span><span class="keyword">) &gt; </span><span class="default">0</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">sort</span><span class="keyword">(</span><span class="default">$listDir</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for(</span><span class="default">$j </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$j </span><span class="keyword">&lt; </span><span class="default">count</span><span class="keyword">(</span><span class="default">$listDir</span><span class="keyword">); </span><span class="default">$j</span><span class="keyword">++){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;tr&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$spacer </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for(</span><span class="default">$l </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$l </span><span class="keyword">&lt; </span><span class="default">$i</span><span class="keyword">; </span><span class="default">$l</span><span class="keyword">++) </span><span class="default">$spacer </span><span class="keyword">.= </span><span class="string">"&amp;emsp;"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// create link<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$link </span><span class="keyword">= </span><span class="string">"&lt;a href=\"" </span><span class="keyword">. </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">"PHP_SELF"</span><span class="keyword">] . </span><span class="string">"?dir=" </span><span class="keyword">. </span><span class="default">$dir </span><span class="keyword">. </span><span class="string">"/" </span><span class="keyword">. </span><span class="default">$listDir</span><span class="keyword">[</span><span class="default">$j</span><span class="keyword">] . </span><span class="string">"\"&gt;</span><span class="default">$listDir</span><span class="keyword">[</span><span class="default">$j</span><span class="keyword">]</span><span class="string">&lt;/a&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"&lt;td&gt;" </span><span class="keyword">. </span><span class="default">$spacer </span><span class="keyword">. </span><span class="default">$link </span><span class="keyword">. </span><span class="string">"&lt;/td&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;/tr&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// list all subdirectories up to maxDepth<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$maxDepth</span><span class="keyword">) </span><span class="default">showDir</span><span class="keyword">(</span><span class="default">$dir </span><span class="keyword">. </span><span class="string">"/" </span><span class="keyword">. </span><span class="default">$listDir</span><span class="keyword">[</span><span class="default">$j</span><span class="keyword">], </span><span class="default">$i</span><span class="keyword">, </span><span class="default">$maxDepth</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// show files<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">count</span><span class="keyword">(</span><span class="default">$listFile</span><span class="keyword">) &gt; </span><span class="default">0</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">sort</span><span class="keyword">(</span><span class="default">$listFile</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for(</span><span class="default">$k </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$k </span><span class="keyword">&lt; </span><span class="default">count</span><span class="keyword">(</span><span class="default">$listFile</span><span class="keyword">); </span><span class="default">$k</span><span class="keyword">++){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$spacer </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for(</span><span class="default">$l </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$l </span><span class="keyword">&lt; </span><span class="default">$i</span><span class="keyword">; </span><span class="default">$l</span><span class="keyword">++) </span><span class="default">$spacer </span><span class="keyword">.= </span><span class="string">"&amp;emsp;"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;tr&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;td&gt;" </span><span class="keyword">. </span><span class="default">$spacer </span><span class="keyword">. </span><span class="default">$listFile</span><span class="keyword">[</span><span class="default">$k</span><span class="keyword">] . </span><span class="string">"&lt;/td&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;/tr&gt;"</span><span class="keyword">;&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">closedir</span><span class="keyword">(</span><span class="default">$checkDir</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
if(</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">"dir"</span><span class="keyword">] == </span><span class="string">"" </span><span class="keyword">|| !</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">"dir"</span><span class="keyword">])) </span><span class="default">$dir </span><span class="keyword">= </span><span class="default">getcwd</span><span class="keyword">();<br />
else </span><span class="default">$dir </span><span class="keyword">= </span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">"dir"</span><span class="keyword">];<br />
</span><span class="comment">// replace backslashes, not necessary, but better to look at<br />
</span><span class="default">$dir </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"\\"</span><span class="keyword">, </span><span class="string">"/"</span><span class="keyword">, </span><span class="default">$dir</span><span class="keyword">);<br />
<br />
</span><span class="comment">// show parent path<br />
</span><span class="default">$pDir </span><span class="keyword">= </span><span class="default">pathinfo</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">);<br />
</span><span class="default">$parentDir </span><span class="keyword">= </span><span class="default">$pDir</span><span class="keyword">[</span><span class="string">"dirname"</span><span class="keyword">];<br />
<br />
echo </span><span class="string">"&lt;a href=\"" </span><span class="keyword">. </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">"PHP_SELF"</span><span class="keyword">] . </span><span class="string">"\"&gt;&lt;h3&gt;Home&lt;/h3&gt;&lt;/a&gt;"</span><span class="keyword">;<br />
echo </span><span class="string">"Current directory: " </span><span class="keyword">. </span><span class="default">$dir</span><span class="keyword">;<br />
echo </span><span class="string">"&lt;a href=\"" </span><span class="keyword">. </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">"PHP_SELF"</span><span class="keyword">] . </span><span class="string">"?dir=</span><span class="default">$parentDir</span><span class="string">\"&gt;&lt;h4&gt;Parent directory: </span><span class="default">$parentDir</span><span class="string">&lt;/h4&gt;&lt;/a&gt;"</span><span class="keyword">;<br />
<br />
</span><span class="comment">// Display directory content<br />
</span><span class="keyword">echo</span><span class="string">"&lt;table border=1 cellspacing=0 cellpadding=2&gt;<br />
&lt;tr&gt;&lt;th align=left&gt;File / Dir&lt;/th&gt;"</span><span class="keyword">;<br />
<br />
</span><span class="comment">// specifies the maxDepth of included subdirectories<br />
// set maxDepth to 0 if u want to display the current directory<br />
</span><span class="default">$maxDepth </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
</span><span class="default">showDir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">, -</span><span class="default">1</span><span class="keyword">, </span><span class="default">$maxDepth</span><span class="keyword">);&nbsp; <br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="46126""></a>
  <div class="note">
   <strong class="user">sandy at montana-riverboats dot com</strong>
   <a href="#46126" class="date">30-Sep-2004 06:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
</span><span class="comment">/*<br />
** This recursive file lister only slurps in one page at time,<br />
** so it doesn't take forever to load when operating over<br />
** a large system.....comes with an "Up" link for every page too.<br />
*/<br />
<br />
</span><span class="default">$PHP_SELF </span><span class="keyword">= </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_SELF'</span><span class="keyword">];<br />
</span><span class="default">$DOCUMENT_ROOT </span><span class="keyword">= </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'DOCUMENT_ROOT'</span><span class="keyword">];<br />
</span><span class="comment"># activate the next line (and deactivate the last) to<br />
# use this script in a $DOCUMENT_ROOT/~anybody<br />
# environment.<br />
#$DOCUMENT_ROOT="/home/sandy/public_html/";<br />
<br />
</span><span class="default">$tdir </span><span class="keyword">= </span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'dir'</span><span class="keyword">];<br />
echo </span><span class="string">"tdir==</span><span class="default">$tdir</span><span class="string">&lt;br&gt;"</span><span class="keyword">;<br />
</span><span class="default">$tparent_path </span><span class="keyword">= </span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'parent_path'</span><span class="keyword">];<br />
</span><span class="default">$dbg </span><span class="keyword">= </span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'dbg'</span><span class="keyword">];<br />
<br />
if(!</span><span class="default">strstr</span><span class="keyword">(</span><span class="default">$tdir</span><span class="keyword">, </span><span class="default">$DOCUMENT_ROOT</span><span class="keyword">))<br />
&nbsp; </span><span class="default">$tdir </span><span class="keyword">= </span><span class="default">getcwd</span><span class="keyword">();<br />
if(!</span><span class="default">strstr</span><span class="keyword">(</span><span class="default">$tparent_path</span><span class="keyword">, </span><span class="default">$DOCUMENT_ROOT</span><span class="keyword">))<br />
&nbsp; </span><span class="default">$tparent_path </span><span class="keyword">= </span><span class="default">$tdir</span><span class="keyword">;<br />
<br />
if (!isset (</span><span class="default">$tdir</span><span class="keyword">))<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$dir </span><span class="keyword">= </span><span class="default">getcwd </span><span class="keyword">();<br />
&nbsp; }<br />
else<br />
&nbsp; </span><span class="default">$dir </span><span class="keyword">= </span><span class="default">$tdir</span><span class="keyword">;<br />
<br />
if (!isset (</span><span class="default">$tparent_path</span><span class="keyword">))<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$parent_path </span><span class="keyword">= </span><span class="default">$dir</span><span class="keyword">;<br />
&nbsp; }<br />
else<br />
&nbsp; </span><span class="default">$parent_path </span><span class="keyword">= </span><span class="default">$tparent_path</span><span class="keyword">;<br />
<br />
echo </span><span class="string">"&lt;br&gt;"</span><span class="keyword">;<br />
if (!isset (</span><span class="default">$tdir</span><span class="keyword">))<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$upurl </span><span class="keyword">= </span><span class="default">$PHP_SELF</span><span class="keyword">;<br />
&nbsp; }<br />
else<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$parent_path </span><span class="keyword">== </span><span class="default">$DOCUMENT_ROOT</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$parent_parent_path </span><span class="keyword">= </span><span class="default">$parent_path</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$parent_parent_path </span><span class="keyword">= </span><span class="default">dirname </span><span class="keyword">(</span><span class="default">$parent_path</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$upurl </span><span class="keyword">= </span><span class="default">$PHP_SELF</span><span class="keyword">.</span><span class="string">"?dir="</span><span class="keyword">.</span><span class="default">$parent_path</span><span class="keyword">.</span><span class="string">"&amp;parent_path="</span><span class="keyword">.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$parent_parent_path</span><span class="keyword">;<br />
&nbsp; }<br />
<br />
if(</span><span class="default">$dbg</span><span class="keyword">==</span><span class="default">1</span><span class="keyword">)<br />
{<br />
&nbsp; echo </span><span class="string">"PHP_SELF: </span><span class="default">$PHP_SELF</span><span class="string">&lt;br&gt;\n"</span><span class="keyword">;<br />
&nbsp; echo </span><span class="string">"DOCUMENT_ROOT: </span><span class="default">$DOCUMENT_ROOT</span><span class="string">&lt;br&gt;\n"</span><span class="keyword">;<br />
&nbsp; echo </span><span class="string">"dir: </span><span class="default">$dir</span><span class="string">&lt;br&gt;\n"</span><span class="keyword">;<br />
&nbsp; echo </span><span class="string">"parent_path: </span><span class="default">$parent_path</span><span class="string">&lt;br&gt;\n"</span><span class="keyword">;<br />
&nbsp; echo </span><span class="string">"upurl: </span><span class="default">$upurl</span><span class="string">&lt;br&gt;\n"</span><span class="keyword">;<br />
}<br />
<br />
echo </span><span class="string">"&lt;a href=\"</span><span class="default">$upurl</span><span class="string">\"&gt; &lt;h3&gt;Up&lt;/h3&gt; &lt;/a&gt;\n"</span><span class="keyword">;<br />
echo </span><span class="string">"&lt;h2&gt;</span><span class="default">$dir</span><span class="string">&lt;/h2&gt;\n"</span><span class="keyword">;<br />
<br />
</span><span class="default">create_tree </span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">, </span><span class="default">$parent_path</span><span class="keyword">);<br />
<br />
function<br />
</span><span class="default">urlFromPath </span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">)<br />
{<br />
&nbsp; global </span><span class="default">$PHP_SELF</span><span class="keyword">;<br />
&nbsp; global </span><span class="default">$DOCUMENT_ROOT</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$prefix </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
&nbsp; if (</span><span class="default">substr </span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">) != </span><span class="string">"/"</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$prefix </span><span class="keyword">= </span><span class="string">"/"</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$url </span><span class="keyword">= </span><span class="default">$prefix</span><span class="keyword">.</span><span class="default">ereg_replace </span><span class="keyword">(</span><span class="default">$DOCUMENT_ROOT</span><span class="keyword">, </span><span class="string">""</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">);<br />
&nbsp; return </span><span class="default">$url</span><span class="keyword">;<br />
}<br />
<br />
function<br />
</span><span class="default">create_tree </span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">, </span><span class="default">$parent_path</span><span class="keyword">)<br />
{<br />
&nbsp; if (</span><span class="default">$handle </span><span class="keyword">= </span><span class="default">opendir </span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; while (</span><span class="default">false </span><span class="keyword">!== (</span><span class="default">$file </span><span class="keyword">= @</span><span class="default">readdir </span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">)))<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (</span><span class="default">$file </span><span class="keyword">!= </span><span class="string">"." </span><span class="keyword">&amp;&amp; </span><span class="default">$file </span><span class="keyword">!= </span><span class="string">".."</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$list</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] = </span><span class="default">$file</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$i</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$dir_length </span><span class="keyword">= </span><span class="default">count </span><span class="keyword">(</span><span class="default">$list</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; echo </span><span class="string">"&lt;ul&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$dir_length</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; global </span><span class="default">$PHP_SELF</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; global </span><span class="default">$DOCUMENT_ROOT</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$label </span><span class="keyword">= </span><span class="default">$list</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$test </span><span class="keyword">= </span><span class="default">$dir</span><span class="keyword">.</span><span class="string">"/"</span><span class="keyword">.</span><span class="default">$label</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$alink </span><span class="keyword">= </span><span class="default">$dir</span><span class="keyword">.</span><span class="string">"/"</span><span class="keyword">.</span><span class="default">ereg_replace</span><span class="keyword">(</span><span class="string">" "</span><span class="keyword">,</span><span class="string">"%20"</span><span class="keyword">,</span><span class="default">$label</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (!</span><span class="default">strstr </span><span class="keyword">(</span><span class="default">$PHP_SELF</span><span class="keyword">, </span><span class="default">$label</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_dir </span><span class="keyword">(</span><span class="default">$test</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tmp </span><span class="keyword">= </span><span class="default">$PHP_SELF</span><span class="keyword">. </span><span class="string">"?dir="</span><span class="keyword">.</span><span class="default">$alink</span><span class="keyword">.</span><span class="string">"&amp;parent_path="</span><span class="keyword">.</span><span class="default">$dir</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$url </span><span class="keyword">= </span><span class="default">ereg_replace</span><span class="keyword">(</span><span class="string">" "</span><span class="keyword">, </span><span class="string">"%20"</span><span class="keyword">, </span><span class="default">$tmp</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"</span><span class="default">$url</span><span class="string">&lt;br&gt;\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"&lt;a href=\"</span><span class="default">$url</span><span class="string">\"&gt;&lt;b&gt;</span><span class="default">$label</span><span class="string">&lt;/b&gt;/&lt;/a&gt;&lt;br&gt;\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$link </span><span class="keyword">= </span><span class="default">urlFromPath </span><span class="keyword">(</span><span class="default">$alink</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$label </span><span class="keyword">= </span><span class="default">$list</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"&lt;a href=\"</span><span class="default">$link</span><span class="string">\"&gt;"</span><span class="keyword">.</span><span class="default">$label</span><span class="keyword">.</span><span class="string">"&lt;/a&gt;&lt;br&gt;\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; echo </span><span class="string">"&lt;/ul&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">closedir </span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="45767""></a>
  <div class="note">
   <strong class="user">cnichols at nmu dot edu</strong>
   <a href="#45767" class="date">17-Sep-2004 08:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's another recursive function that prints out everything from the starting path to the end. It doesn't have any search function, but just another example. I wrote it for getting a quick hierarchial view of websites (even through Dreamweaver will show it to me, it'd be a chore to go through each folder and expand it).<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">// map_dirs(path,level)<br />
// path, level to start (start at 0)<br />
<br />
</span><span class="default">map_dirs</span><span class="keyword">(</span><span class="string">"/var/ww/html/"</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">);<br />
<br />
function </span><span class="default">map_dirs</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">,</span><span class="default">$level</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$contents </span><span class="keyword">= </span><span class="default">opendir</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; while((</span><span class="default">$node </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$contents</span><span class="keyword">)) !== </span><span class="default">false</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$node</span><span class="keyword">!=</span><span class="string">"." </span><span class="keyword">&amp;&amp; </span><span class="default">$node</span><span class="keyword">!=</span><span class="string">".."</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">$level</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">++) echo </span><span class="string">"&nbsp; "</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">.</span><span class="string">"/"</span><span class="keyword">.</span><span class="default">$node</span><span class="keyword">)) echo </span><span class="string">"+"</span><span class="keyword">; else echo </span><span class="string">" "</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">$node</span><span class="keyword">.</span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">map_dirs</span><span class="keyword">(</span><span class="string">"</span><span class="default">$path</span><span class="string">/</span><span class="default">$node</span><span class="string">"</span><span class="keyword">,</span><span class="default">$level</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
}<br />
&nbsp;<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="44524""></a>
  <div class="note">
   <strong class="user">MagicalTux at FF.st</strong>
   <a href="#44524" class="date">09-Aug-2004 03:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that the opendir() function will use ISO8859-1 characterset under windows...<br />
<br />
If you have korean, japanese, etc.. filenames, you won't be able to open them. I still didn't find any solution to workaround that.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="41042""></a>
  <div class="note">
   <strong class="user">Cabal  at  CnCWorld dot org</strong>
   <a href="#41042" class="date">28-Mar-2004 03:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I had problems getting it to work because I'm not the best at PHP, but there IS a way to use opendir to list things in alphabetical order. I'm using it for my university project. All you have to do is read the filenames into an array, sort the array and then do what you want with the filenames.... like this....<br />
<br />
So that you know what all my variables mean in this - $stats is the folder that it looks in for the files - for example<br />
?stats=images<br />
would look in the images folder<br />
<br />
Obviously you will want to modify it so it fits your needs, but I thought you guys would want this - especially if your server doesnt have the latest version of php.<br />
<br />
===========================<br />
<br />
<span class="default">&lt;?php <br />
$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
</span><span class="default">$arraycount </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
</span><span class="default">$home</span><span class="keyword">=</span><span class="string">"/home/cabal/public_html/b146/admin/</span><span class="default">$stats</span><span class="string">"</span><span class="keyword">;<br />
<br />
if (</span><span class="default">$stats</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$dircheck</span><span class="keyword">=</span><span class="string">"/home/cabal/public_html/b146/admin/</span><span class="default">$stats</span><span class="string">"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$dircheck</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$handle </span><span class="keyword">= </span><span class="default">opendir</span><span class="keyword">(</span><span class="default">$home</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; while (</span><span class="default">false </span><span class="keyword">!== (</span><span class="default">$file </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">))) <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; { <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$file </span><span class="keyword">!= </span><span class="string">"." </span><span class="keyword">&amp;&amp; </span><span class="default">$file </span><span class="keyword">!= </span><span class="string">".."</span><span class="keyword">) <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$path </span><span class="keyword">= </span><span class="string">"</span><span class="default">$home</span><span class="string">/</span><span class="default">$file</span><span class="string">"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$extension </span><span class="keyword">= </span><span class="default">array_pop</span><span class="keyword">(</span><span class="default">explode</span><span class="keyword">(</span><span class="string">'.'</span><span class="keyword">, </span><span class="default">basename</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">)));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$filearray</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] = </span><span class="default">$file</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$i</span><span class="keyword">++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">closedir</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">); <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; else<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"INCORRECT SELECTION"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
}<br />
<br />
else<br />
<br />
{<br />
echo </span><span class="string">"NOTHING SELECTED"</span><span class="keyword">;<br />
}<br />
echo </span><span class="string">"&amp;nbsp;"</span><span class="keyword">;<br />
<br />
echo(</span><span class="string">"&lt;table width='100%' border='1'&gt;&lt;tr&gt;&lt;td&gt;&lt;b&gt;&lt;font color='#ff0000'&gt;"</span><span class="keyword">);<br />
echo(</span><span class="string">"</span><span class="default">$stats</span><span class="string"> : Log File"</span><span class="keyword">);<br />
echo(</span><span class="string">"&lt;/b&gt;&lt;/font&gt;&lt;/td&gt;&lt;td&gt;&lt;font color='#FF0000'&gt;&lt;b&gt;Page Views&lt;/b&gt;&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;"</span><span class="keyword">);<br />
</span><span class="default">sort</span><span class="keyword">(</span><span class="default">$filearray</span><span class="keyword">);<br />
</span><span class="default">reset</span><span class="keyword">(</span><span class="default">$filearray</span><span class="keyword">);<br />
while (list(</span><span class="default">$key</span><span class="keyword">, </span><span class="default">$val</span><span class="keyword">) = </span><span class="default">each</span><span class="keyword">(</span><span class="default">$filearray</span><span class="keyword">))<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$includearray </span><span class="keyword">= </span><span class="string">"</span><span class="default">$home</span><span class="string">/</span><span class="default">$filearray</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">]</span><span class="string">"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; echo(</span><span class="string">"&lt;tr&gt;&lt;td&gt;"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; echo(</span><span class="string">"</span><span class="default">$val</span><span class="string">"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; echo(</span><span class="string">"&lt;/td&gt;&lt;td&gt;"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; include(</span><span class="default">$includearray</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; echo(</span><span class="string">"&lt;/td&gt;&lt;/tr&gt;"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
}<br />
echo(</span><span class="string">"&lt;/table&gt;"</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="40241""></a>
  <div class="note">
   <strong class="user">dieck at gmx dot de</strong>
   <a href="#40241" class="date">26-Feb-2004 01:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you have problems like "failed to open dir: Invalid argument"<br />
when using IIS and trying to access windows/smb network shares, try<br />
//servername/share/directory<br />
instead of<br />
\\servername\share</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="37558""></a>
  <div class="note">
   <strong class="user">micklweiss at gmx dot net</strong>
   <a href="#37558" class="date">19-Nov-2003 10:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I ran into a little snag in example 1. opendir() lists files by the last time the file was accessed. I was trying to print the files numerically in a directory. <br />
<br />
Solution: Use scandir() instead (php5) or store the files in an array and sort it.<br />
<br />
Hope this helps someone. <br />
<br />
- Mick<br />
<br />
(o&gt; Web / software developer <br />
( )&nbsp; &nbsp;&nbsp; UNIX Systems Admin<br />
---&nbsp;&nbsp; ~ www.mickweiss.com ~</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="35198""></a>
  <div class="note">
   <strong class="user">info at 4design dot nu</strong>
   <a href="#35198" class="date">23-Aug-2003 03:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In addition to notes above about IIS &amp; PHP reading network shares, here's one solution that works better for me.<br />
<br />
in the management console I created a folder where my "read_dir" script runs. click on properties then select the security tab. here you can set the anonymous account to the standard IUSR_$computername% , BUT.. in this case I chose another account that I set up for reading my shares. (make sure login name and password match the credantials you set on the remote machin ;-))<br />
<br />
I use this to read a dir and it's contents into a searchable database. and it works like a charm...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="32782""></a>
  <div class="note">
   <strong class="user">Matt Grimm</strong>
   <a href="#32782" class="date">06-Jun-2003 10:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Thought I could help clarify something with accessing network shares on a Windows network (2000 in this case), running PHP 4.3.2 under Apache 2.0.44.<br />
<br />
However you are logged into the Windows box, your Apache service must be running under an account which has access to the share.&nbsp; The easiest (and probably least safe) way for me was to change the user for the Apache service to the computer administrator (do this in the service properties, under the "Log On" tab).&nbsp; After restarting Apache, I could access mapped drives by their assigned drive letter ("z:\\") or regular shares by their UNC path ("\\\\shareDrive\\shareDir").</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="25567""></a>
  <div class="note">
   <strong class="user">mitka at actdev.com</strong>
   <a href="#25567" class="date">28-Sep-2002 01:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Re: Accessing network directories on W32<br />
<br />
In reply to the previous comments, to enable opendir() to open directories like "\\SOMEHOST\shareddir", with PHP+IIS:<br />
<br />
Follow the instructions here: <a href="http://support.microsoft.com/default.aspx?scid=kb;en-us;Q189408" rel="nofollow" target="_blank">http://support.microsoft.com/default.aspx?scid=kb;en-us;Q189408</a><br />
<br />
Check that the file share allows reads to IUSR_[HOSTNAME] user.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
