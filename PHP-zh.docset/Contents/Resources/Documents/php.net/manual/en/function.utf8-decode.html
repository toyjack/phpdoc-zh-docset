<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>将用 UTF-8 方式编码的 ISO-8859-1 字符串转换成单字节的 ISO-8859-1 字符串。</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="ref.xml.html">? XML 解析器函数</a></li>
      <li style="float: right;"><a href="function.utf8-encode.html">utf8_encode ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.xml.html">XML 解析器函数</a></li>
    <li>将用 UTF-8 方式编码的 ISO-8859-1 字符串转换成单字节的 ISO-8859-1 字符串。</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.utf8-decode" class="refentry">
   <div class="refnamediv">
    <h1 class="refname">utf8_decode</h1> 
    <p class="verinfo">(PHP 4, PHP 5)</p><p class="refpurpose"><span class="refname">utf8_decode</span> &mdash; <span class="dc-title">
     将用 UTF-8 方式编码的 ISO-8859-1 字符串转换成单字节的 ISO-8859-1 字符串。
    </span></p>

   </div>
   <div class="refsect1 unknown-returnvaluet" id="refsect1-function.utf8-decode-unknown-returnvaluet">
    <h3 class="title">描述</h3>
    <div class="methodsynopsis dc-description">
     <span class="type">string</span> <span class="methodname"><strong>utf8_decode</strong></span>
      ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$data</code></span>
     )</div>

    <p class="para rdfs-comment">
     该函数将用 <em>UTF-8</em> 编码的数据解码为 <em>ISO-8859-1</em> 编码。
    </p>
    <p class="para">
     请参阅 <span class="function"><a href="function.utf8-encode.html" class="function">utf8_encode()</a></span> 以查看关于 UTF-8 编码的解释。
    </p>
   </div>

  </div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="116671""></a>
  <div class="note">
   <strong class="user">okx dot oliver dot koenig at gmail dot com</strong>
   <a href="#116671" class="date">08-Feb-2015 08:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
// This finally helped me to do the job, thanks to Blackbit, had to modify deprecated ereg:<br />
// original comment: "Squirrelmail contains a nice function in the sources to convert unicode to entities:"<br />
<br />
function charset_decode_utf_8 ($string) {<br />
&nbsp;&nbsp;&nbsp; /* Only do the slow convert if there are 8-bit characters */<br />
&nbsp;&nbsp;&nbsp; /* avoid using 0xA0 (\240) in ereg ranges. RH73 does not like that */<br />
&nbsp;&nbsp;&nbsp; if (!preg_match("/[\200-\237]/", $string)<br />
&nbsp;&nbsp; &nbsp; &amp;&amp; !preg_match("/[\241-\377]/", $string)<br />
&nbsp;&nbsp;&nbsp; ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return $string;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; // decode three byte unicode characters<br />
&nbsp;&nbsp;&nbsp; $string = preg_replace("/([\340-\357])([\200-\277])([\200-\277])/e",<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; "'&amp;#'.((ord('\\1')-224)*4096 + (ord('\\2')-128)*64 + (ord('\\3')-128)).';'",<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $string<br />
&nbsp;&nbsp;&nbsp; );<br />
<br />
&nbsp;&nbsp;&nbsp; // decode two byte unicode characters<br />
&nbsp;&nbsp;&nbsp; $string = preg_replace("/([\300-\337])([\200-\277])/e",<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; "'&amp;#'.((ord('\\1')-192)*64+(ord('\\2')-128)).';'",<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $string<br />
&nbsp;&nbsp;&nbsp; );<br />
<br />
&nbsp;&nbsp;&nbsp; return $string;<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="116271""></a>
  <div class="note">
   <strong class="user">sashott at gmail dot com</strong>
   <a href="#116271" class="date">04-Dec-2014 08:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Use of utf8_decode was not enough for me by get page content from another site. Problem appear by different alphabet from standard latin. As example some chars (corresponding to HTML codes &amp;bdquo; , &amp;nbsp; and others) are converted to "?" or "xA0" (hex value). You need to make some conversion before execute utf8_decode. And you can not replace simple, that they can be part of 2 bytes code for a char (UTF-8 use 2 bytes). Next is for cyrillic alphabet, but for other must be very close.<br />
<br />
function convertMethod($text){<br />
&nbsp;&nbsp;&nbsp; //Problem is that utf8_decode convert HTML chars for &amp;bdquo; and other to ? or &amp;nbsp; to \xA0. And you can not replace, that they are in some char bytes and you broke cyrillic (or other alphabet) chars.<br />
&nbsp;&nbsp;&nbsp; $problem_enc=array(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'euro',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'sbquo',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'bdquo',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'hellip',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'dagger',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'Dagger',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'permil',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'lsaquo',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'lsquo',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'rsquo',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'ldquo',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'rdquo',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'bull',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'ndash',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'mdash',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'trade',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'rsquo',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'brvbar',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'copy',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'laquo',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'reg',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'plusmn',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'micro',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'para',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'middot',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'raquo',<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 'nbsp'<br />
&nbsp;&nbsp;&nbsp; );<br />
&nbsp;&nbsp;&nbsp; $text=mb_convert_encoding($text,'HTML-ENTITIES','UTF-8');<br />
&nbsp;&nbsp;&nbsp; $text=preg_replace('#(?&lt;!\&amp;ETH;)\&amp;('.implode('|',$problem_enc).');#s','--amp{$1}',$text);<br />
&nbsp;&nbsp;&nbsp; $text=mb_convert_encoding($text,'UTF-8','HTML-ENTITIES');<br />
&nbsp;&nbsp;&nbsp; $text=utf8_decode($text);<br />
&nbsp;&nbsp;&nbsp; $text=mb_convert_encoding($text,'HTML-ENTITIES','UTF-8');<br />
&nbsp;&nbsp;&nbsp; $text=preg_replace('#\-\-amp\{([^\}]+)\}#su','&amp;$1;',$text);<br />
&nbsp;&nbsp;&nbsp; $text=mb_convert_encoding($text,'UTF-8','HTML-ENTITIES');<br />
&nbsp;&nbsp;&nbsp; return $text;<br />
}<br />
<br />
If this don't work, try to set "die($text);" on some places to look, what is happen to this row. Is better to test with long text. It is very possible to broke other alphabet character. In this case, it is very possible, that for you alphabet set "&amp;ETH;" is not the right one. You need to set "die($text);" after this preg_replace and look HTML code for character before set "--amp".</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="111815""></a>
  <div class="note">
   <strong class="user">Nitrogen</strong>
   <a href="#111815" class="date">01-Apr-2013 09:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hi all. I have written this comprehensive UTF-8 decoder as I needed a way to split any UTF-8 string<br />
into nice and useable pieces of information, such as an array of code points that make up the input<br />
string regardless if it's UTF-8 or not.<br />
<br />
Here's what's good about this function:<br />
1) It splits a UTF-8 encoded string into an array of code points.<br />
2) It supports from 1 byte (7 bit) to 6 byte (31 bit) UTF-8 characters.<br />
3) It checks the validity of the UTF-8 input string and provides an array of erroneous UTF-8 offsets.<br />
4) Provides you with the character length of the UTF-8 string.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">get_utf_8</span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">, </span><span class="default">$include_raw </span><span class="keyword">= </span><span class="default">FALSE</span><span class="keyword">) {<br />
&nbsp; </span><span class="default">$result </span><span class="keyword">= array(<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'length'</span><span class="keyword">=&gt;</span><span class="default">0</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'errorbytes'</span><span class="keyword">=&gt;array(),<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'codepoints'</span><span class="keyword">=&gt;array()<br />
&nbsp; );<br />
&nbsp; </span><span class="default">$codepoints </span><span class="keyword">= array();<br />
&nbsp; </span><span class="default">$len </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">);<br />
<br />
&nbsp; for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">$len</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">++) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$c </span><span class="keyword">= </span><span class="default">ord</span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">{</span><span class="default">$i</span><span class="keyword">});<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$msb </span><span class="keyword">= (</span><span class="default">$c</span><span class="keyword">&gt;&gt;</span><span class="default">7</span><span class="keyword">)&amp;</span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$bytes </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; if(!</span><span class="default">$msb</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$codepoints</span><span class="keyword">[]= </span><span class="default">$include_raw</span><span class="keyword">?array(</span><span class="default">$c</span><span class="keyword">, </span><span class="default">chr</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">)):</span><span class="default">$c</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp;&nbsp; for(</span><span class="default">$j</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$j</span><span class="keyword">&lt;</span><span class="default">8</span><span class="keyword">&amp;&amp;((</span><span class="default">$c</span><span class="keyword">&gt;&gt;(</span><span class="default">7</span><span class="keyword">-</span><span class="default">$j</span><span class="keyword">))&amp;</span><span class="default">1</span><span class="keyword">);</span><span class="default">$j</span><span class="keyword">++); </span><span class="comment">// how many bytes represent this Unicode character? $j<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="keyword">if((</span><span class="default">$j</span><span class="keyword">&gt;=</span><span class="default">2 </span><span class="keyword">&amp;&amp; </span><span class="default">$j</span><span class="keyword">&lt;=</span><span class="default">6</span><span class="keyword">) &amp;&amp; </span><span class="default">$len</span><span class="keyword">&gt;</span><span class="default">$i</span><span class="keyword">+</span><span class="default">$j</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">) { </span><span class="comment">// valid range? is there $j-1 extra bytes?<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$code </span><span class="keyword">= </span><span class="default">$c</span><span class="keyword">&amp;</span><span class="default">pow</span><span class="keyword">(</span><span class="default">2</span><span class="keyword">, </span><span class="default">7</span><span class="keyword">-</span><span class="default">$j</span><span class="keyword">)-</span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for(</span><span class="default">$k</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">;</span><span class="default">$k</span><span class="keyword">&lt;</span><span class="default">$j</span><span class="keyword">;</span><span class="default">$k</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(((</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">{</span><span class="default">$i</span><span class="keyword">+</span><span class="default">$k</span><span class="keyword">})&gt;&gt;</span><span class="default">6</span><span class="keyword">)&amp;</span><span class="default">3</span><span class="keyword">)==</span><span class="default">2</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$code </span><span class="keyword">= (</span><span class="default">$code</span><span class="keyword">&lt;&lt;</span><span class="default">6</span><span class="keyword">)|(</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">{</span><span class="default">$i</span><span class="keyword">+</span><span class="default">$k</span><span class="keyword">})&amp;</span><span class="default">63</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result</span><span class="keyword">[</span><span class="string">'errorbytes'</span><span class="keyword">][]= </span><span class="default">$i</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; continue </span><span class="default">2</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$codepoints</span><span class="keyword">[]= </span><span class="default">$include_raw</span><span class="keyword">?array(</span><span class="default">$code</span><span class="keyword">, </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">, </span><span class="default">$j</span><span class="keyword">)):</span><span class="default">$code</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$i</span><span class="keyword">+=</span><span class="default">$j</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result</span><span class="keyword">[</span><span class="string">'errorbytes'</span><span class="keyword">][]= </span><span class="default">$i</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$result</span><span class="keyword">[</span><span class="string">'length'</span><span class="keyword">]++;<br />
&nbsp; }<br />
&nbsp; </span><span class="default">$result</span><span class="keyword">[</span><span class="string">'codepoints'</span><span class="keyword">] = </span><span class="default">$codepoints</span><span class="keyword">;<br />
&nbsp; return(</span><span class="default">$result</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Some examples of the result:<br />
<br />
<span class="default">&lt;?php<br />
$r </span><span class="keyword">= </span><span class="default">get_utf_8</span><span class="keyword">(</span><span class="string">'迎接。'</span><span class="keyword">);<br />
</span><span class="comment">/*<br />
Array(<br />
&nbsp; [length] =&gt; 3<br />
&nbsp; [errorbytes] =&gt; Array(<br />
&nbsp; )<br />
&nbsp; [codepoints] =&gt; Array(<br />
&nbsp;&nbsp;&nbsp; [0] =&gt; 36814<br />
&nbsp;&nbsp;&nbsp; [1] =&gt; 25509<br />
&nbsp;&nbsp;&nbsp; [2] =&gt; 12290<br />
&nbsp; )<br />
)<br />
*/<br />
<br />
// Using the $include_raw parameter includes the raw UTF-8 bytes...<br />
</span><span class="default">$r </span><span class="keyword">= </span><span class="default">get_utf_8</span><span class="keyword">(</span><span class="string">'迎接。'</span><span class="keyword">, </span><span class="default">TRUE</span><span class="keyword">);<br />
</span><span class="comment">/*<br />
Array(<br />
&nbsp; [length] =&gt; 3<br />
&nbsp; [errorbytes] =&gt; Array(<br />
&nbsp; )<br />
&nbsp; [codepoints] =&gt; Array(<br />
&nbsp;&nbsp;&nbsp; [0] =&gt; Array(<br />
&nbsp;&nbsp; &nbsp;&nbsp; [0] =&gt; 36814<br />
&nbsp;&nbsp; &nbsp;&nbsp; [1] =&gt; 迎<br />
&nbsp;&nbsp;&nbsp; )<br />
&nbsp;&nbsp;&nbsp; [1] =&gt; Array(<br />
&nbsp;&nbsp; &nbsp;&nbsp; [0] =&gt; 25509<br />
&nbsp;&nbsp; &nbsp;&nbsp; [1] =&gt; 接<br />
&nbsp;&nbsp;&nbsp; )<br />
&nbsp;&nbsp;&nbsp; [2] =&gt; Array(<br />
&nbsp;&nbsp; &nbsp;&nbsp; [0] =&gt; 12290<br />
&nbsp;&nbsp; &nbsp;&nbsp; [1] =&gt; 。<br />
&nbsp;&nbsp;&nbsp; )<br />
&nbsp; )<br />
)<br />
*/<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="110494""></a>
  <div class="note">
   <strong class="user">christoffer</strong>
   <a href="#110494" class="date">29-Oct-2012 07:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The preferred way to use this on an array would be with the built in PHP function "array_map()", as for example:<br />
$array = array_map("utf8_decode", $array);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="110019""></a>
  <div class="note">
   <strong class="user">Michael Pfister</strong>
   <a href="#110019" class="date">12-Sep-2012 10:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I personally prefer this method for decoding an array:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">private function </span><span class="default">utf8DecodeArray</span><span class="keyword">(&amp;</span><span class="default">$item</span><span class="keyword">, </span><span class="default">$key</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$item </span><span class="keyword">= </span><span class="default">utf8_decode</span><span class="keyword">(</span><span class="default">$item</span><span class="keyword">);
<br />
}
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Then just call it like this within the same class:
<br />
array_walk_recursive($YOURARRAY, array(&amp;$this, 'utf8DecodeArray'));
<br />

<br />
This will replace your array with the utf8 decoded one.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="108339""></a>
  <div class="note">
   <strong class="user">chris at deliens dot be</strong>
   <a href="#108339" class="date">18-Apr-2012 09:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I didn't see any post showing a way to recursively utf8_decode an array.<br />
So here's one I've just built for this purpose:<br />
<br />
function utf8DecodeArray($array) {<br />
&nbsp;&nbsp;&nbsp; $utf8DecodedArray = array();<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; foreach ($array as $key =&gt; $value) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (is_array($value)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $utf8DecodedArray[$key] = utf8DecodeArray($value);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; continue;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $utf8DecodedArray[$key] = utf8_decode($value);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; return $utf8DecodedArray;<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="104907""></a>
  <div class="note">
   <strong class="user">deceze at gmail dot com</strong>
   <a href="#104907" class="date">15-Jul-2011 04:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Please note that utf8_decode simply converts a string encoded in UTF-8 to ISO-8859-1. A more appropriate name for it would be utf8_to_iso88591. If your text is already encoded in ISO-8859-1, you do not need this function. If you don't want to use ISO-8859-1, you do not need this function.<br />
<br />
Note that UTF-8 can represent many more characters than ISO-8859-1. Trying to convert a UTF-8 string that contains characters that can't be represented in ISO-8859-1 to ISO-8859-1 will garble your text and/or cause characters to go missing. Trying to convert text that is not encoded in UTF-8 using this function will most likely garble the text.<br />
<br />
If you need to convert any text from any encoding to any other encoding, look at iconv() instead.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="104379""></a>
  <div class="note">
   <strong class="user">gabriel arobase gabsoftware dot com</strong>
   <a href="#104379" class="date">12-Jun-2011 05:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to retrieve some UTF-8 data from your database, you don't need utf8_decode().<br />
<br />
Simply do the following query before any SELECT :<br />
<br />
$result = mysql_query("SET NAMES utf8");</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99949""></a>
  <div class="note">
   <strong class="user">mkluczka at gmail dot com</strong>
   <a href="#99949" class="date">16-Sep-2010 01:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In jQuery AJAX requests, latin2 specific chars have 2B length, and common chars have 1B length.<br />
<br />
PHP functions for UTF8-&gt;latin2 conversion didn't work for me, so I wrote this simple function <br />
to convert from jQuery AJAX encoding to ISO-8859-2 (latin2).<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">jquery2iso</span><span class="keyword">(</span><span class="default">$in</span><span class="keyword">)<br />
{<br />
&nbsp; </span><span class="default">$CONV </span><span class="keyword">= array();<br />
&nbsp; </span><span class="default">$CONV</span><span class="keyword">[</span><span class="string">'c4'</span><span class="keyword">][</span><span class="string">'85'</span><span class="keyword">] = </span><span class="string">'?'</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$CONV</span><span class="keyword">[</span><span class="string">'c4'</span><span class="keyword">][</span><span class="string">'84'</span><span class="keyword">] = </span><span class="string">'?'</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$CONV</span><span class="keyword">[</span><span class="string">'c4'</span><span class="keyword">][</span><span class="string">'87'</span><span class="keyword">] = </span><span class="string">'?'</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$CONV</span><span class="keyword">[</span><span class="string">'c4'</span><span class="keyword">][</span><span class="string">'86'</span><span class="keyword">] = </span><span class="string">'?'</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$CONV</span><span class="keyword">[</span><span class="string">'c4'</span><span class="keyword">][</span><span class="string">'99'</span><span class="keyword">] = </span><span class="string">'?'</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$CONV</span><span class="keyword">[</span><span class="string">'c4'</span><span class="keyword">][</span><span class="string">'98'</span><span class="keyword">] = </span><span class="string">'?'</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$CONV</span><span class="keyword">[</span><span class="string">'c5'</span><span class="keyword">][</span><span class="string">'82'</span><span class="keyword">] = </span><span class="string">'?'</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$CONV</span><span class="keyword">[</span><span class="string">'c5'</span><span class="keyword">][</span><span class="string">'81'</span><span class="keyword">] = </span><span class="string">'?'</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$CONV</span><span class="keyword">[</span><span class="string">'c4'</span><span class="keyword">][</span><span class="string">'84'</span><span class="keyword">] = </span><span class="string">''</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$CONV</span><span class="keyword">[</span><span class="string">'c4'</span><span class="keyword">][</span><span class="string">'83'</span><span class="keyword">] = </span><span class="string">'?'</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$CONV</span><span class="keyword">[</span><span class="string">'c3'</span><span class="keyword">][</span><span class="string">'b3'</span><span class="keyword">] = </span><span class="string">'ó'</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$CONV</span><span class="keyword">[</span><span class="string">'c3'</span><span class="keyword">][</span><span class="string">'93'</span><span class="keyword">] = </span><span class="string">'ó'</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$CONV</span><span class="keyword">[</span><span class="string">'c5'</span><span class="keyword">][</span><span class="string">'9b'</span><span class="keyword">] = </span><span class="string">'?'</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$CONV</span><span class="keyword">[</span><span class="string">'c5'</span><span class="keyword">][</span><span class="string">'9a'</span><span class="keyword">] = </span><span class="string">'?'</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$CONV</span><span class="keyword">[</span><span class="string">'c5'</span><span class="keyword">][</span><span class="string">'ba'</span><span class="keyword">] = </span><span class="string">'?'</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$CONV</span><span class="keyword">[</span><span class="string">'c5'</span><span class="keyword">][</span><span class="string">'b9'</span><span class="keyword">] = </span><span class="string">'?'</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$CONV</span><span class="keyword">[</span><span class="string">'c5'</span><span class="keyword">][</span><span class="string">'bc'</span><span class="keyword">] = </span><span class="string">'?'</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$CONV</span><span class="keyword">[</span><span class="string">'c5'</span><span class="keyword">][</span><span class="string">'bb'</span><span class="keyword">] = </span><span class="string">'?'</span><span class="keyword">;<br />
<br />
&nbsp; </span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$out </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp; while(</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$in</span><span class="keyword">))<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">array_key_exists</span><span class="keyword">(</span><span class="default">bin2hex</span><span class="keyword">(</span><span class="default">$in</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]), </span><span class="default">$CONV</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">.= </span><span class="default">$CONV</span><span class="keyword">[</span><span class="default">bin2hex</span><span class="keyword">(</span><span class="default">$in</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">])][</span><span class="default">bin2hex</span><span class="keyword">(</span><span class="default">$in</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">])];<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$i </span><span class="keyword">+= </span><span class="default">2</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; else<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">.= </span><span class="default">$in</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$i </span><span class="keyword">+= </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
<br />
&nbsp; return </span><span class="default">$out</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="94801""></a>
  <div class="note">
   <strong class="user">andrew</strong>
   <a href="#94801" class="date">25-Nov-2009 05:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
a simple function to convert encoding that appears mixed.
<br />

<br />
<span class="default">&lt;?php
<br />
$trans </span><span class="keyword">= new </span><span class="default">Latin1UTF8</span><span class="keyword">();
<br />

<br />
</span><span class="default">$mixed </span><span class="keyword">= </span><span class="string">"MIXED TEXT INPUT"</span><span class="keyword">;
<br />

<br />
print </span><span class="string">"Original: "</span><span class="keyword">.</span><span class="default">$mixed</span><span class="keyword">;
<br />
print </span><span class="string">"Latin1:&nbsp;&nbsp; "</span><span class="keyword">.</span><span class="default">$trans</span><span class="keyword">-&gt;</span><span class="default">mixed_to_latin1</span><span class="keyword">(</span><span class="default">$mixed</span><span class="keyword">);
<br />
print </span><span class="string">"UTF-8:&nbsp; &nbsp; "</span><span class="keyword">.</span><span class="default">$trans</span><span class="keyword">-&gt;</span><span class="default">mixed_to_utf8</span><span class="keyword">(</span><span class="default">$mixed</span><span class="keyword">);
<br />

<br />
class </span><span class="default">Latin1UTF8 </span><span class="keyword">{
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$latin1_to_utf8</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$utf8_to_latin1</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__construct</span><span class="keyword">() {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">32</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">&lt;=</span><span class="default">255</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">latin1_to_utf8</span><span class="keyword">[</span><span class="default">chr</span><span class="keyword">(</span><span class="default">$i</span><span class="keyword">)] = </span><span class="default">utf8_encode</span><span class="keyword">(</span><span class="default">chr</span><span class="keyword">(</span><span class="default">$i</span><span class="keyword">));
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">utf8_to_latin1</span><span class="keyword">[</span><span class="default">utf8_encode</span><span class="keyword">(</span><span class="default">chr</span><span class="keyword">(</span><span class="default">$i</span><span class="keyword">))] = </span><span class="default">chr</span><span class="keyword">(</span><span class="default">$i</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">mixed_to_latin1</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach( </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">utf8_to_latin1 </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$val </span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$text </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">, </span><span class="default">$val</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$text</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">mixed_to_utf8</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">utf8_encode</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">mixed_to_latin1</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">));
<br />
&nbsp;&nbsp;&nbsp; }
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92777""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#92777" class="date">08-Aug-2009 11:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In addition to Blackbit's note below, here's my shot at converting UTF-8 strings to HTML entities.<br />
<br />
<span class="default">&lt;?php $encoded </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/([\200-\277])/e'</span><span class="keyword">, </span><span class="string">"'&amp;#'.(ord('\\1')).';'"</span><span class="keyword">, </span><span class="default">$utf8str</span><span class="keyword">); </span><span class="default">?&gt;<br />
</span><br />
This code converts one byte UTF-8 to HTML entities while below you'll find conversions for two byte and three byte UTF-8.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="90718""></a>
  <div class="note">
   <strong class="user">pedro at pontonet dot com</strong>
   <a href="#90718" class="date">06-May-2009 12:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I've modified above utf8_array_decode to utf8_array_encode. The main difference is the later encodes a multi-dimension array.
<br />

<br />
Here goes the code:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">utf8_array_encode</span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">)
<br />
{
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$return </span><span class="keyword">= array();
<br />

<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$input </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$val</span><span class="keyword">) 
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">) )
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$return</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">] = </span><span class="default">utf8_array_encode</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$return</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">] = </span><span class="default">utf8_encode</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$return</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
}
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Enjoy it!
<br />

<br />
Pedro Bastos</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="88594""></a>
  <div class="note">
   <strong class="user">ytak at gmx dot net</strong>
   <a href="#88594" class="date">30-Jan-2009 06:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you running Gentoo Linux and encounter problems with some PHP5 applications saying:<br />
Call to undefined function: utf8_decode()<br />
Try reemerge PHP4 with 'xml' flag enabled.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="88488""></a>
  <div class="note">
   <strong class="user">info at vanylla dot it</strong>
   <a href="#88488" class="date">26-Jan-2009 09:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
IMPORTANT: when converting UTF8 data that contains the EURO sign DON'T USE utf_decode function.<br />
<br />
utf_decode converts the data into ISO-8859-1 charset. But ISO-8859-1 charset does not contain the EURO sign, therefor the EURO sign will be converted into a question mark character '?'<br />
<br />
In order to convert properly UTF8 data with EURO sign you must use:<br />
<br />
iconv("UTF-8", "CP1252", $data)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85034""></a>
  <div class="note">
   <strong class="user">Blackbit</strong>
   <a href="#85034" class="date">12-Aug-2008 01:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Squirrelmail contains a nice function in the sources to convert unicode to entities:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">charset_decode_utf_8 </span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="comment">/* Only do the slow convert if there are 8-bit characters */
<br />
&nbsp;&nbsp;&nbsp; /* avoid using 0xA0 (\240) in ereg ranges. RH73 does not like that */
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (! </span><span class="default">ereg</span><span class="keyword">(</span><span class="string">"[\200-\237]"</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">) and ! </span><span class="default">ereg</span><span class="keyword">(</span><span class="string">"[\241-\377]"</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">))
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$string</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// decode three byte unicode characters
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$string </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"/([\340-\357])([\200-\277])([\200-\277])/e"</span><span class="keyword">,&nbsp; &nbsp; &nbsp; &nbsp; \
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"'&amp;#'.((ord('\\1')-224)*4096 + (ord('\\2')-128)*64 + (ord('\\3')-128)).';'"</span><span class="keyword">,&nbsp; &nbsp; \
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$string</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// decode two byte unicode characters
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$string </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"/([\300-\337])([\200-\277])/e"</span><span class="keyword">, \
<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">"'&amp;#'.((ord('\\1')-192)*64+(ord('\\2')-128)).';'"</span><span class="keyword">, \
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$string</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$string</span><span class="keyword">;
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84031""></a>
  <div class="note">
   <strong class="user">punchivan at gmail dot com</strong>
   <a href="#84031" class="date">24-Jun-2008 11:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
EY! the bug is not in the function 'utf8_decode'. The bug is in the function 'mb_detect_encoding'. If you put a word with a special char at the end like this 'accentué', that will lead to a wrong result (UTF-8) but if you put another char at the end like this 'accentuée' you will get it right. So you should always add a ISO-8859-1 character to your string for this check. My advise is to use a blank space.<br />
I′ve tried it and it works! <br />
<br />
function ISO_convert($array)<br />
{<br />
&nbsp;&nbsp;&nbsp; $array_temp = array();<br />
&nbsp;&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; foreach($array as $name =&gt; $value)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(is_array($value))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $array_temp[(mb_detect_encoding($name." ",'UTF-8,ISO-8859-1') == 'UTF-8' ? utf8_decode($name) : $name )] = ISO_convert($value);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $array_temp[(mb_detect_encoding($name." ",'UTF-8,ISO-8859-1') == 'UTF-8' ? utf8_decode($name) : $name )] = (mb_detect_encoding($value." ",'UTF-8,ISO-8859-1') == 'UTF-8' ? utf8_decode($value) : $value );<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; return $array_temp; <br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83935""></a>
  <div class="note">
   <strong class="user">webmaster at lapstore dot de</strong>
   <a href="#83935" class="date">19-Jun-2008 05:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
[EDITED BY cataphract AT php DOT net - NOTE: This has been fixed
<br />
in PHP 5.3.4 and 5.2.15.]
<br />

<br />
Warning!
<br />
This function contains a possible security risk when you try to convert escaped strings (see addslashes() and related functions).
<br />
It reacts nasty on broken multibyte sequences. In UTF-8, follow-up bytes ALWAYS have the binary pattern 10xxxxxx, but this fact is not handled by utf8_decode in the way you would expect: If you pass a start byte (110xxxxx, 1110xxxx, 11110xxx - or even invalid sequences like 11111100), followed by one or more non-multibyte chars (0xxxxxxx), the start sequence "char" will be replaced by '?' (0x3F) and up to three following chars will disappear even if they are single-byte-chars (0xxxxxxx). So if you escape a string with a typical escape char like backslash, you would expect that your escaping would always survive a call to utf8decode because the escape char is in the assumed safe ascii range 0-127, but that is NOT the case!
<br />
Try things like utf8_decode("test: ü\\\"123456") to check it out.
<br />
To avoid problems take care that string-escaping always is the last step of data manipulation when you depend on leak-proof escaping.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83486""></a>
  <div class="note">
   <strong class="user">juantxito at example dot com</strong>
   <a href="#83486" class="date">28-May-2008 10:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To decode the values and the keys, i think this would work<br />
<br />
&nbsp;function utf8_array_decode($input){<br />
<br />
&nbsp;&nbsp;&nbsp; $return = array();<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach ($input as $key =&gt; $val) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $k = utf8_decode($key);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $return[$k] = utf8_decode($val);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return $return;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83082""></a>
  <div class="note">
   <strong class="user">phpnet at freshsite dot de</strong>
   <a href="#83082" class="date">09-May-2008 10:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I didn't find an utf8_array_decode. This one only decodes the values, not the keys.<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; function utf8_array_decode($input){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach ($input as $key =&gt; $val) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $input[$key] = utf8_decode($val);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return $input;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83051""></a>
  <div class="note">
   <strong class="user">haugas at gmail dot com</strong>
   <a href="#83051" class="date">08-May-2008 11:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you don't know exactly, how many times your string is encoded, you can use this function:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">_utf8_decode</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">)<br />
{<br />
&nbsp; </span><span class="default">$tmp </span><span class="keyword">= </span><span class="default">$string</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$count </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp; while (</span><span class="default">mb_detect_encoding</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">)==</span><span class="string">"UTF-8"</span><span class="keyword">)<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$tmp </span><span class="keyword">= </span><span class="default">utf8_decode</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$count</span><span class="keyword">++;<br />
&nbsp; }<br />
&nbsp; <br />
&nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$count</span><span class="keyword">-</span><span class="default">1 </span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++)<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$string </span><span class="keyword">= </span><span class="default">utf8_decode</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp; }<br />
&nbsp; return </span><span class="default">$string</span><span class="keyword">;<br />
&nbsp; <br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81599""></a>
  <div class="note">
   <strong class="user">lukasz dot mlodzik at gmail dot com</strong>
   <a href="#81599" class="date">05-Mar-2008 01:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Update to MARC13 function utf2iso()<br />
I'm using it to handle AJAX POST calls. <br />
Despite using <br />
http.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded'; charset='utf-8'); <br />
it still code Polish letters using UTF-16<br />
<br />
This is only for Polish letters:<br />
&nbsp;<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">utf16_2_utf8 </span><span class="keyword">(</span><span class="default">$nowytekst</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'%u0104'</span><span class="keyword">,</span><span class="string">'?'</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//?<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'%u0106'</span><span class="keyword">,</span><span class="string">'?'</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//?<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'%u0118'</span><span class="keyword">,</span><span class="string">'?'</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//?<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'%u0141'</span><span class="keyword">,</span><span class="string">'?'</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//?<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'%u0143'</span><span class="keyword">,</span><span class="string">'?'</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//?<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'%u00D3'</span><span class="keyword">,</span><span class="string">'ó'</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//ó<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'%u015A'</span><span class="keyword">,</span><span class="string">'?'</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//?<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'%u0179'</span><span class="keyword">,</span><span class="string">'?'</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//?<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'%u017B'</span><span class="keyword">,</span><span class="string">'?'</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//?<br />
&nbsp;&nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'%u0105'</span><span class="keyword">,</span><span class="string">'?'</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//?<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'%u0107'</span><span class="keyword">,</span><span class="string">'?'</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//?<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'%u0119'</span><span class="keyword">,</span><span class="string">'?'</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//?<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'%u0142'</span><span class="keyword">,</span><span class="string">'?'</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//?<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'%u0144'</span><span class="keyword">,</span><span class="string">''</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'%u00F3'</span><span class="keyword">,</span><span class="string">'ó'</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//ó<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'%u015B'</span><span class="keyword">,</span><span class="string">'?'</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//?<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'%u017A'</span><span class="keyword">,</span><span class="string">'?'</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//?<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'%u017C'</span><span class="keyword">,</span><span class="string">'?'</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//?<br />
&nbsp;&nbsp; </span><span class="keyword">return (</span><span class="default">$nowytekst</span><span class="keyword">);<br />
&nbsp;&nbsp; }&nbsp; &nbsp; <br />
</span><span class="default">?&gt;<br />
</span><br />
Everything goes smooth, but it doesn't change '%u00D3','ó' and '%u00F3','ó'. I dont have idea what to do with that.<br />
<br />
Remember! File must be saved in UTF-8 coding.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="79801""></a>
  <div class="note">
   <strong class="user">tacchete at gmail dot com</strong>
   <a href="#79801" class="date">13-Dec-2007 01:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Known problem with Byte Order Mark (BOM) and header() in pages of a site.<br />
<br />
For example at sending headings or to a dynamic conclusion in other coding distinct from UTF-8 by means of XSLT (&lt;xsl:output encoding="windows-1251"/&gt;).<br />
<br />
To clean all symbols BOM from the text of page: <br />
<br />
1. exclude BOM from the main file; <br />
2. write down function of a return call for the buffer <br />
<br />
<span class="default">&lt;?php<br />
header</span><span class="keyword">(</span><span class="string">'content-type: text/html; charset: utf-8'</span><span class="keyword">);<br />
</span><span class="default">ob_start</span><span class="keyword">(</span><span class="string">'ob'</span><span class="keyword">); <br />
function </span><span class="default">ob</span><span class="keyword">(</span><span class="default">$buffer</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"\xef\xbb\xbf"</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$buffer</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
it will exclude BOM from a code of the connected files; <br />
3. do not experience for BOM in connected files;<br />
4. be pleased.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76434""></a>
  <div class="note">
   <strong class="user">ludvig dot ericson at gmail dot com</strong>
   <a href="#76434" class="date">15-Jul-2007 07:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A better way to convert would be to use iconv, see <a href="http://www.php.net/iconv -- example:" rel="nofollow" target="_blank">http://www.php.net/iconv -- example:</a><br />
<br />
<span class="default">&lt;?php<br />
$myUnicodeString </span><span class="keyword">= </span><span class="string">"???"</span><span class="keyword">;<br />
echo </span><span class="default">iconv</span><span class="keyword">(</span><span class="string">"UTF-8"</span><span class="keyword">, </span><span class="string">"ISO-8859-1"</span><span class="keyword">, </span><span class="default">$myUnicodeString</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Above would echo out the given variable in ISO-8859-1 encoding, you may replace it with whatever you prefer.<br />
<br />
Another solution to the issue of misdisplayed glyphs is to simply send the document as UTF-8, and of course send UTF-8 data:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment"># Replace text/html with whatever MIME-type you prefer.<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-Type: text/html; CHARSET=gb2312"</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76250""></a>
  <div class="note">
   <strong class="user">MARC13</strong>
   <a href="#76250" class="date">07-Jul-2007 04:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I did this function to convert data from AJAX call to insert to my database.<br />
It converts UTF-8 from XMLHttpRequest() to ISO-8859-2 that I use in LATIN2 MySQL database.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">utf2iso</span><span class="keyword">(</span><span class="default">$tekst</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"%u0104"</span><span class="keyword">,</span><span class="string">"\xA1"</span><span class="keyword">,</span><span class="default">$tekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//?<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"%u0106"</span><span class="keyword">,</span><span class="string">"\xC6"</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//?<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"%u0118"</span><span class="keyword">,</span><span class="string">"\xCA"</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//?<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"%u0141"</span><span class="keyword">,</span><span class="string">"\xA3"</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//?<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"%u0143"</span><span class="keyword">,</span><span class="string">"\xD1"</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//?<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"%u00D3"</span><span class="keyword">,</span><span class="string">"\xD3"</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//ó<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"%u015A"</span><span class="keyword">,</span><span class="string">"\xA6"</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//?<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"%u0179"</span><span class="keyword">,</span><span class="string">"\xAC"</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//?<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"%u017B"</span><span class="keyword">,</span><span class="string">"\xAF"</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//?<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"%u0105"</span><span class="keyword">,</span><span class="string">"\xB1"</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//?<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"%u0107"</span><span class="keyword">,</span><span class="string">"\xE6"</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//?<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"%u0119"</span><span class="keyword">,</span><span class="string">"\xEA"</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//?<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"%u0142"</span><span class="keyword">,</span><span class="string">"\xB3"</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//?<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"%u0144"</span><span class="keyword">,</span><span class="string">"\xF1"</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"%u00D4"</span><span class="keyword">,</span><span class="string">"\xF3"</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//ó<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"%u015B"</span><span class="keyword">,</span><span class="string">"\xB6"</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//?<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"%u017A"</span><span class="keyword">,</span><span class="string">"\xBC"</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//?<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$nowytekst </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"%u017C"</span><span class="keyword">,</span><span class="string">"\xBF"</span><span class="keyword">,</span><span class="default">$nowytekst</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//?<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">return (</span><span class="default">$nowytekst</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
In my case also the code file that deals with AJAX calls must be in UTF-8 coding.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75952""></a>
  <div class="note">
   <strong class="user">visus at portsonline dot net</strong>
   <a href="#75952" class="date">23-Jun-2007 06:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Following code helped me with mixed (UTF8+ISO-8859-1(x)) encodings. In this case, I have template files made and maintained by designers who do not care about encoding and MySQL data in utf8_binary_ci encoded tables.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">class </span><span class="default">Helper<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">strSplit</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">, </span><span class="default">$split </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">is_string</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">)) return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">is_numeric</span><span class="keyword">(</span><span class="default">$split</span><span class="keyword">) &amp;&amp; </span><span class="default">$split </span><span class="keyword">&lt; </span><span class="default">1</span><span class="keyword">) return </span><span class="default">false</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$len </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$array </span><span class="keyword">= array();<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while (</span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$len</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$key </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for (</span><span class="default">$j </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$j </span><span class="keyword">&lt; </span><span class="default">$split</span><span class="keyword">; </span><span class="default">$j </span><span class="keyword">+= </span><span class="default">1</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$key </span><span class="keyword">.= </span><span class="default">$text</span><span class="keyword">{</span><span class="default">$i</span><span class="keyword">};<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$i </span><span class="keyword">+= </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$array</span><span class="keyword">[] = </span><span class="default">$key</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$array</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">UTF8ToHTML</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$search </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$search</span><span class="keyword">[] = </span><span class="string">"/([\\xC0-\\xF7]{1,1}[\\x80-\\xBF]+)/e"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$search</span><span class="keyword">[] = </span><span class="string">"/&amp;#228;/"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$search</span><span class="keyword">[] = </span><span class="string">"/&amp;#246;/"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$search</span><span class="keyword">[] = </span><span class="string">"/&amp;#252;/"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$search</span><span class="keyword">[] = </span><span class="string">"/&amp;#196;/"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$search</span><span class="keyword">[] = </span><span class="string">"/&amp;#214;/"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$search</span><span class="keyword">[] = </span><span class="string">"/&amp;#220;/"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$search</span><span class="keyword">[] = </span><span class="string">"/&amp;#223;/"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$replace </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$replace</span><span class="keyword">[] = </span><span class="string">'Helper::_UTF8ToHTML("\\1")'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$replace</span><span class="keyword">[] = </span><span class="string">"?"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$replace</span><span class="keyword">[] = </span><span class="string">"?"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$replace</span><span class="keyword">[] = </span><span class="string">"ü"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$replace</span><span class="keyword">[] = </span><span class="string">"?"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$replace</span><span class="keyword">[] = </span><span class="string">"?"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$replace</span><span class="keyword">[] = </span><span class="string">"ü"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$replace</span><span class="keyword">[] = </span><span class="string">"?"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$str </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="default">$search</span><span class="keyword">, </span><span class="default">$replace</span><span class="keyword">, </span><span class="default">$str</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$str</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">_UTF8ToHTML</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ret </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach((</span><span class="default">Helper</span><span class="keyword">::</span><span class="default">strSplit</span><span class="keyword">(</span><span class="default">strrev</span><span class="keyword">(</span><span class="default">chr</span><span class="keyword">((</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">{</span><span class="default">0</span><span class="keyword">}) % </span><span class="default">252 </span><span class="keyword">% </span><span class="default">248 </span><span class="keyword">% </span><span class="default">240 </span><span class="keyword">% </span><span class="default">224 </span><span class="keyword">% </span><span class="default">192</span><span class="keyword">) + </span><span class="default">128</span><span class="keyword">).</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">)))) as </span><span class="default">$k </span><span class="keyword">=&gt; </span><span class="default">$v</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ret </span><span class="keyword">+= (</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$v</span><span class="keyword">) % </span><span class="default">128</span><span class="keyword">) * </span><span class="default">pow</span><span class="keyword">(</span><span class="default">64</span><span class="keyword">, </span><span class="default">$k</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">"&amp;#"</span><span class="keyword">.</span><span class="default">$ret</span><span class="keyword">.</span><span class="string">";"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="comment">// Usage example:<br />
<br />
</span><span class="default">$tpl </span><span class="keyword">= </span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="string">"template.tpl"</span><span class="keyword">);<br />
</span><span class="comment">/* ... */<br />
</span><span class="default">$row </span><span class="keyword">= </span><span class="default">mysql_fetch_assoc</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">);<br />
<br />
print(</span><span class="default">Helper</span><span class="keyword">::</span><span class="default">UTF8ToHTML</span><span class="keyword">(</span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"{VAR}"</span><span class="keyword">, </span><span class="default">$row</span><span class="keyword">[</span><span class="string">'var'</span><span class="keyword">], </span><span class="default">$tpl</span><span class="keyword">)));<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75941""></a>
  <div class="note">
   <strong class="user">luka8088 at gmail dot com</strong>
   <a href="#75941" class="date">22-Jun-2007 04:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
simple UTF-8 to HTML conversion:<br />
<br />
function utf8_to_html ($data)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; return preg_replace("/([\\xC0-\\xF7]{1,1}[\\x80-\\xBF]+)/e", '_utf8_to_html("\\1")', $data);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
function _utf8_to_html ($data)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; $ret = 0;<br />
&nbsp;&nbsp;&nbsp; foreach((str_split(strrev(chr((ord($data{0}) % 252 % 248 % 240 % 224 % 192) + 128) . substr($data, 1)))) as $k =&gt; $v)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $ret += (ord($v) % 128) * pow(64, $k);<br />
&nbsp;&nbsp;&nbsp; return "&amp;#$ret;";<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
Example:<br />
echo utf8_to_html("a b ? ? ? こ に ち わ ()[]{}!#$?*");<br />
<br />
Output:<br />
a b &amp;#269; &amp;#263; &amp;#382; &amp;#12371; &amp;#12395; &amp;#12385; &amp;#12431; ()[]{}!#$?*</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75723""></a>
  <div class="note">
   <strong class="user">Sadi</strong>
   <a href="#75723" class="date">13-Jun-2007 12:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Once again about polish letters. If you use fananf's solution, make sure that PHP file is coded with cp1250 or else it won't work. It's quite obvious, however I spent some time before I finally figured that out, so I thought I post it here.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75261""></a>
  <div class="note">
   <strong class="user">alexlevin at kvadro dot net</strong>
   <a href="#75261" class="date">21-May-2007 05:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you running Gentoo Linux and encounter problems with some PHP4 applications saying:<br />
Call to undefined function: utf8_decode()<br />
Try reemerge PHP4 with 'expat' flag enabled.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73736""></a>
  <div class="note">
   <strong class="user">ahmed dot adaileh at gmail dot com</strong>
   <a href="#73736" class="date">08-Mar-2007 12:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I searched a lot everywhere to find a suitable function which converts my UTF8 characters to the windows-1250 charset for Polish language, but couldn't find anything :(<br />
<br />
Following is a function which does that:<br />
<br />
function show_polish ($text) {<br />
&nbsp;$text = str_replace("??", '&amp;#260;', $text); //?<br />
&nbsp;$text = str_replace("??", '&amp;#262;', $text); //?<br />
&nbsp;$text = str_replace("??", '&amp;#280;', $text); //?<br />
&nbsp;$text = str_replace("??", '&amp;#321;', $text); //?<br />
&nbsp;$text = str_replace("??", '&amp;#323;', $text); //?<br />
&nbsp;$text = str_replace("?"", '&amp;#211;', $text); //ó<br />
&nbsp;$text = str_replace("??", '&amp;#346;', $text); //?<br />
&nbsp;$text = str_replace("?1", '&amp;#377;', $text); //?<br />
&nbsp;$text = str_replace("??", '&amp;#379;', $text); //?<br />
&nbsp;$text = str_replace("?...", '&amp;#261;', $text); //?<br />
&nbsp;$text = str_replace("??", '&amp;#263;', $text); //?<br />
&nbsp;$text = str_replace("?&trade;", '&amp;#281;', $text); //?<br />
&nbsp;$text = str_replace("??", '&amp;#322;', $text); //?<br />
&nbsp;$text = str_replace("??", '&amp;#324;', $text); //<br />
&nbsp;$text = str_replace("?3", '&amp;#243;', $text); //ó<br />
&nbsp;$text = str_replace("??", '&amp;#347;', $text); //?<br />
&nbsp;$text = str_replace("?o", '&amp;#378;', $text); //?<br />
&nbsp;$text = str_replace("??", '&amp;#380;', $text); //?<br />
&nbsp;<br />
return $text;<br />
}<br />
<br />
You can refer to <a href="http://hermes.umcs.lublin.pl/~awmarcz/awm/info/pl-codes.htm " rel="nofollow" target="_blank">http://hermes.umcs.lublin.pl/~awmarcz/awm/info/pl-codes.htm </a><br />
if you want to use HTML hex. code rather than HTML dec. code which I used in my function.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73639""></a>
  <div class="note">
   <strong class="user">fananf at nerdshack dot com</strong>
   <a href="#73639" class="date">05-Mar-2007 04:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Comment to AJGORS reply from 28-Dec-2006 02:38:<br />
<br />
You have used twice "?" instead of "?".<br />
<br />
Correct code should be:<br />
<br />
ISO version:<br />
<br />
function utf82iso88592($text) {<br />
&nbsp;$text = str_replace("\xC4\x85", '±', $text);<br />
&nbsp;$text = str_replace("\xC4\x84", 'ˇ', $text);<br />
&nbsp;$text = str_replace("\xC4\x87", '?', $text);<br />
&nbsp;$text = str_replace("\xC4\x86", '?', $text);<br />
&nbsp;$text = str_replace("\xC4\x99", '?', $text);<br />
&nbsp;$text = str_replace("\xC4\x98", '?', $text);<br />
&nbsp;$text = str_replace("\xC5\x82", '?', $text);<br />
&nbsp;$text = str_replace("\xC5\x81", '?', $text);<br />
&nbsp;$text = str_replace("\xC3\xB3", 'ó', $text);<br />
&nbsp;$text = str_replace("\xC3\x93", 'ó', $text);<br />
&nbsp;$text = str_replace("\xC5\x9B", '?', $text);<br />
&nbsp;$text = str_replace("\xC5\x9A", '|', $text);<br />
&nbsp;$text = str_replace("\xC5\xBC", '?', $text);<br />
&nbsp;$text = str_replace("\xC5\xBB", '?', $text);<br />
&nbsp;$text = str_replace("\xC5\xBA", '?', $text);<br />
&nbsp;$text = str_replace("\xC5\xB9", '?', $text);<br />
&nbsp;$text = str_replace("\xc5\x84", '', $text);<br />
&nbsp;$text = str_replace("\xc5\x83", '?', $text);<br />
<br />
return $text;<br />
}<br />
<br />
CP version:<br />
<br />
function utf82iso88592($text) {<br />
&nbsp;$text = str_replace("\xC4\x85", '?', $text);<br />
&nbsp;$text = str_replace("\xC4\x84", '?', $text);<br />
&nbsp;$text = str_replace("\xC4\x87", '?', $text);<br />
&nbsp;$text = str_replace("\xC4\x86", '?', $text);<br />
&nbsp;$text = str_replace("\xC4\x99", '?', $text);<br />
&nbsp;$text = str_replace("\xC4\x98", '?', $text);<br />
&nbsp;$text = str_replace("\xC5\x82", '?', $text);<br />
&nbsp;$text = str_replace("\xC5\x81", '?', $text);<br />
&nbsp;$text = str_replace("\xC3\xB3", 'ó', $text);<br />
&nbsp;$text = str_replace("\xC3\x93", 'ó', $text);<br />
&nbsp;$text = str_replace("\xC5\x9B", '?', $text);<br />
&nbsp;$text = str_replace("\xC5\x9A", '?', $text);<br />
&nbsp;$text = str_replace("\xC5\xBC", '?', $text);<br />
&nbsp;$text = str_replace("\xC5\xBB", '?', $text);<br />
&nbsp;$text = str_replace("\xC5\xBA", '?', $text);<br />
&nbsp;$text = str_replace("\xC5\xB9", '?', $text);<br />
&nbsp;$text = str_replace("\xc5\x84", '', $text);<br />
&nbsp;$text = str_replace("\xc5\x83", '?', $text);<br />
<br />
return $text;<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="72978""></a>
  <div class="note">
   <strong class="user">sam</strong>
   <a href="#72978" class="date">06-Feb-2007 05:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In addition to yannikh's note, to convert a hex utf8 string<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">echo </span><span class="default">utf8_decode</span><span class="keyword">(</span><span class="string">"\x61\xc3\xb6\x61"</span><span class="keyword">);<br />
</span><span class="comment">// works as expected<br />
<br />
</span><span class="default">$abc</span><span class="keyword">=</span><span class="string">"61c3b661"</span><span class="keyword">;<br />
</span><span class="default">$newstr </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
</span><span class="default">$l </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$abc</span><span class="keyword">);<br />
for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">$l</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">+=</span><span class="default">2</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$newstr </span><span class="keyword">.= </span><span class="string">"\x"</span><span class="keyword">.</span><span class="default">$abc</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">].</span><span class="default">$abc</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">];<br />
}<br />
echo </span><span class="default">utf8_decode</span><span class="keyword">(</span><span class="default">$newstr</span><span class="keyword">);<br />
</span><span class="comment">// or varieties&nbsp; of "\x": "\\x" etc does NOT output what you want<br />
<br />
</span><span class="keyword">echo </span><span class="default">utf8_decode</span><span class="keyword">(</span><span class="default">pack</span><span class="keyword">(</span><span class="string">'H*'</span><span class="keyword">,</span><span class="default">$abc</span><span class="keyword">));<br />
</span><span class="comment">// this outputs the correct string, like the first line.<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71999""></a>
  <div class="note">
   <strong class="user">Ajgor</strong>
   <a href="#71999" class="date">28-Dec-2006 02:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
small upgrade for polish decoding:<br />
<br />
function utf82iso88592($text) {<br />
&nbsp;$text = str_replace("\xC4\x85", '?', $text);<br />
&nbsp;$text = str_replace("\xC4\x84", '?', $text);<br />
&nbsp;$text = str_replace("\xC4\x87", '?', $text);<br />
&nbsp;$text = str_replace("\xC4\x86", '?', $text);<br />
&nbsp;$text = str_replace("\xC4\x99", '?', $text);<br />
&nbsp;$text = str_replace("\xC4\x98", '?', $text);<br />
&nbsp;$text = str_replace("\xC5\x82", '?', $text);<br />
&nbsp;$text = str_replace("\xC5\x81", '?', $text);<br />
&nbsp;$text = str_replace("\xC3\xB3", 'ó', $text);<br />
&nbsp;$text = str_replace("\xC3\x93", 'ó', $text);<br />
&nbsp;$text = str_replace("\xC5\x9B", '?', $text);<br />
&nbsp;$text = str_replace("\xC5\x9A", '?', $text);<br />
&nbsp;$text = str_replace("\xC5\xBC", '?', $text);<br />
&nbsp;$text = str_replace("\xC5\xBB", '?', $text);<br />
&nbsp;$text = str_replace("\xC5\xBA", '?', $text);<br />
&nbsp;$text = str_replace("\xC5\xB9", '?', $text);<br />
&nbsp;$text = str_replace("\xc5\x84", '', $text);<br />
&nbsp;$text = str_replace("\xc5\x83", '?', $text);<br />
<br />
return $text;<br />
} // utf82iso88592</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="70776""></a>
  <div class="note">
   <strong class="user">paul.hayes at entropedia.co.uk</strong>
   <a href="#70776" class="date">27-Oct-2006 04:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I noticed that the utf-8 to html functions below are only for 2 byte long codes. Well I wanted 3 byte support (sorry haven't done 4, 5 or 6). Also I noticed the concatination of the character codes did have the hex prefix 0x and so failed with the large 2 byte codes)<br />
<br />
&lt;?<br />
&nbsp; public function utf2html (&amp;$str) {<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; $ret = "";<br />
&nbsp;&nbsp;&nbsp; $max = strlen($str);<br />
&nbsp;&nbsp;&nbsp; $last = 0;&nbsp; // keeps the index of the last regular character<br />
&nbsp;&nbsp;&nbsp; for ($i=0; $i&lt;$max; $i++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $c = $str{$i};<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $c1 = ord($c);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ($c1&gt;&gt;5 == 6) {&nbsp; // 110x xxxx, 110 prefix for 2 bytes unicode<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $ret .= substr($str, $last, $i-$last); // append all the regular characters we've passed<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $c1 &amp;= 31; // remove the 3 bit two bytes prefix<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $c2 = ord($str{++$i}); // the next byte<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $c2 &amp;= 63;&nbsp; // remove the 2 bit trailing byte prefix<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $c2 |= (($c1 &amp; 3) &lt;&lt; 6); // last 2 bits of c1 become first 2 of c2<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $c1 &gt;&gt;= 2; // c1 shifts 2 to the right<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $ret .= "&amp;#" . ($c1 * 0x100 + $c2) . ";"; // this is the fastest string concatenation<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $last = $i+1;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; elseif ($c1&gt;&gt;4 == 14) {&nbsp; // 1110 xxxx, 110 prefix for 3 bytes unicode<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $ret .= substr($str, $last, $i-$last); // append all the regular characters we've passed<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $c2 = ord($str{++$i}); // the next byte<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $c3 = ord($str{++$i}); // the third byte<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $c1 &amp;= 15; // remove the 4 bit three bytes prefix<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $c2 &amp;= 63;&nbsp; // remove the 2 bit trailing byte prefix<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $c3 &amp;= 63;&nbsp; // remove the 2 bit trailing byte prefix<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $c3 |= (($c2 &amp; 3) &lt;&lt; 6); // last 2 bits of c2 become first 2 of c3<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $c2 &gt;&gt;=2; //c2 shifts 2 to the right<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $c2 |= (($c1 &amp; 15) &lt;&lt; 4); // last 4 bits of c1 become first 4 of c2<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $c1 &gt;&gt;= 4; // c1 shifts 4 to the right<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $ret .= '&amp;#' . (($c1 * 0x10000) + ($c2 * 0x100) + $c3) . ';'; // this is the fastest string concatenation<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $last = $i+1;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; $str=$ret . substr($str, $last, $i); // append the last batch of regular characters<br />
} <br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="70561""></a>
  <div class="note">
   <strong class="user">tobias at code-x dot de</strong>
   <a href="#70561" class="date">20-Oct-2006 02:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
converting uft8-html sign &amp;#301; to uft8<br />
<br />
&lt;?<br />
function uft8html2utf8( $s ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( !function_exists('uft8html2utf8_callback') ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; function uft8html2utf8_callback($t) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $dec = $t[1];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($dec &lt; 128) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $utf = chr($dec);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else if ($dec &lt; 2048) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $utf = chr(192 + (($dec - ($dec % 64)) / 64));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $utf .= chr(128 + ($dec % 64));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $utf = chr(224 + (($dec - ($dec % 4096)) / 4096));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $utf .= chr(128 + ((($dec % 4096) - ($dec % 64)) / 64));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $utf .= chr(128 + ($dec % 64));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return $utf;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return preg_replace_callback('|&amp;#([0-9]{1,});|', 'uft8html2utf8_callback', $s );&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
}<br />
echo uft8html2utf8('test: &amp;#301;');<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="70154""></a>
  <div class="note">
   <strong class="user">e dot panzyk at panzyk dot net</strong>
   <a href="#70154" class="date">04-Oct-2006 11:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
enhanced UTF8-Decoder<br />
<br />
After recognising that UTF8-Decode converts some French Characters to "?" i end with that Function.<br />
<br />
The space will be need when a String ends with a converted Char ( a buggy Php Function will fit a /hex00 char at the End )<br />
<br />
function utf8dec ( $s_String )<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; $s_String = html_entity_decode(htmlentities($s_String." ", ENT_COMPAT, 'UTF-8'));<br />
&nbsp;&nbsp;&nbsp; return substr($s_String, 0, strlen($s_String)-1);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
Hope it helps ... cost me a lot of time ...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68566""></a>
  <div class="note">
   <strong class="user">ethaizone [AT] hotmail [DOT] com</strong>
   <a href="#68566" class="date">02-Aug-2006 07:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This function I use convert UTF-8 to Thai font (iso-8859-11).
<br />
It from iso8859_11toUTF8 function [Suttichai Mesaard-www.ceforce.com] at utf8_encode page.
<br />

<br />
It useful for translate string from mod_rewrite to real url.
<br />
I makes SEO Url In Thai language.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">UTF8toiso8859_11</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">) {
<br />
&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; if ( ! </span><span class="default">ereg</span><span class="keyword">(</span><span class="string">"[\241-\377]"</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">) )
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">$string</span><span class="keyword">;
<br />
&nbsp;
<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$UTF8 </span><span class="keyword">= array(
<br />
</span><span class="string">"\xe0\xb8\x81" </span><span class="keyword">=&gt; </span><span class="string">"\xa1"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb8\x82" </span><span class="keyword">=&gt; </span><span class="string">"\xa2"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb8\x83" </span><span class="keyword">=&gt; </span><span class="string">"\xa3"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb8\x84" </span><span class="keyword">=&gt; </span><span class="string">"\xa4"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb8\x85" </span><span class="keyword">=&gt; </span><span class="string">"\xa5"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb8\x86" </span><span class="keyword">=&gt; </span><span class="string">"\xa6"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb8\x87" </span><span class="keyword">=&gt; </span><span class="string">"\xa7"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb8\x88" </span><span class="keyword">=&gt; </span><span class="string">"\xa8"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb8\x89" </span><span class="keyword">=&gt; </span><span class="string">"\xa9"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb8\x8a" </span><span class="keyword">=&gt; </span><span class="string">"\xaa"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb8\x8b" </span><span class="keyword">=&gt; </span><span class="string">"\xab"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb8\x8c" </span><span class="keyword">=&gt; </span><span class="string">"\xac"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb8\x8d" </span><span class="keyword">=&gt; </span><span class="string">"\xad"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb8\x8e" </span><span class="keyword">=&gt; </span><span class="string">"\xae"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb8\x8f" </span><span class="keyword">=&gt; </span><span class="string">"\xaf"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb8\x90" </span><span class="keyword">=&gt; </span><span class="string">"\xb0"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb8\x91" </span><span class="keyword">=&gt; </span><span class="string">"\xb1"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb8\x92" </span><span class="keyword">=&gt; </span><span class="string">"\xb2"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb8\x93" </span><span class="keyword">=&gt; </span><span class="string">"\xb3"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb8\x94" </span><span class="keyword">=&gt; </span><span class="string">"\xb4"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb8\x95" </span><span class="keyword">=&gt; </span><span class="string">"\xb5"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb8\x96" </span><span class="keyword">=&gt; </span><span class="string">"\xb6"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb8\x97" </span><span class="keyword">=&gt; </span><span class="string">"\xb7"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb8\x98" </span><span class="keyword">=&gt; </span><span class="string">"\xb8"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb8\x99" </span><span class="keyword">=&gt; </span><span class="string">"\xb9"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb8\x9a" </span><span class="keyword">=&gt; </span><span class="string">"\xba"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb8\x9b" </span><span class="keyword">=&gt; </span><span class="string">"\xbb"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb8\x9c" </span><span class="keyword">=&gt; </span><span class="string">"\xbc"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb8\x9d" </span><span class="keyword">=&gt; </span><span class="string">"\xbd"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb8\x9e" </span><span class="keyword">=&gt; </span><span class="string">"\xbe"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb8\x9f" </span><span class="keyword">=&gt; </span><span class="string">"\xbf"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb8\xa0" </span><span class="keyword">=&gt; </span><span class="string">"\xc0"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb8\xa1" </span><span class="keyword">=&gt; </span><span class="string">"\xc1"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb8\xa2" </span><span class="keyword">=&gt; </span><span class="string">"\xc2"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb8\xa3" </span><span class="keyword">=&gt; </span><span class="string">"\xc3"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb8\xa4" </span><span class="keyword">=&gt; </span><span class="string">"\xc4"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb8\xa5" </span><span class="keyword">=&gt; </span><span class="string">"\xc5"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb8\xa6" </span><span class="keyword">=&gt; </span><span class="string">"\xc6"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb8\xa7" </span><span class="keyword">=&gt; </span><span class="string">"\xc7"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb8\xa8" </span><span class="keyword">=&gt; </span><span class="string">"\xc8"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb8\xa9" </span><span class="keyword">=&gt; </span><span class="string">"\xc9"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb8\xaa" </span><span class="keyword">=&gt; </span><span class="string">"\xca"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb8\xab" </span><span class="keyword">=&gt; </span><span class="string">"\xcb"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb8\xac" </span><span class="keyword">=&gt; </span><span class="string">"\xcc"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb8\xad" </span><span class="keyword">=&gt; </span><span class="string">"\xcd"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb8\xae" </span><span class="keyword">=&gt; </span><span class="string">"\xce"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb8\xaf" </span><span class="keyword">=&gt; </span><span class="string">"\xcf"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb8\xb0" </span><span class="keyword">=&gt; </span><span class="string">"\xd0"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb8\xb1" </span><span class="keyword">=&gt; </span><span class="string">"\xd1"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb8\xb2" </span><span class="keyword">=&gt; </span><span class="string">"\xd2"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb8\xb3" </span><span class="keyword">=&gt; </span><span class="string">"\xd3"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb8\xb4" </span><span class="keyword">=&gt; </span><span class="string">"\xd4"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb8\xb5" </span><span class="keyword">=&gt; </span><span class="string">"\xd5"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb8\xb6" </span><span class="keyword">=&gt; </span><span class="string">"\xd6"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb8\xb7" </span><span class="keyword">=&gt; </span><span class="string">"\xd7"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb8\xb8" </span><span class="keyword">=&gt; </span><span class="string">"\xd8"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb8\xb9" </span><span class="keyword">=&gt; </span><span class="string">"\xd9"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb8\xba" </span><span class="keyword">=&gt; </span><span class="string">"\xda"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb8\xbf" </span><span class="keyword">=&gt; </span><span class="string">"\xdf"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb9\x80" </span><span class="keyword">=&gt; </span><span class="string">"\xe0"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb9\x81" </span><span class="keyword">=&gt; </span><span class="string">"\xe1"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb9\x82" </span><span class="keyword">=&gt; </span><span class="string">"\xe2"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb9\x83" </span><span class="keyword">=&gt; </span><span class="string">"\xe3"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb9\x84" </span><span class="keyword">=&gt; </span><span class="string">"\xe4"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb9\x85" </span><span class="keyword">=&gt; </span><span class="string">"\xe5"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb9\x86" </span><span class="keyword">=&gt; </span><span class="string">"\xe6"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb9\x87" </span><span class="keyword">=&gt; </span><span class="string">"\xe7"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb9\x88" </span><span class="keyword">=&gt; </span><span class="string">"\xe8"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb9\x89" </span><span class="keyword">=&gt; </span><span class="string">"\xe9"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb9\x8a" </span><span class="keyword">=&gt; </span><span class="string">"\xea"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb9\x8b" </span><span class="keyword">=&gt; </span><span class="string">"\xeb"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb9\x8c" </span><span class="keyword">=&gt; </span><span class="string">"\xec"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb9\x8d" </span><span class="keyword">=&gt; </span><span class="string">"\xed"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb9\x8e" </span><span class="keyword">=&gt; </span><span class="string">"\xee"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb9\x8f" </span><span class="keyword">=&gt; </span><span class="string">"\xef"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb9\x90" </span><span class="keyword">=&gt; </span><span class="string">"\xf0"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb9\x91" </span><span class="keyword">=&gt; </span><span class="string">"\xf1"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb9\x92" </span><span class="keyword">=&gt; </span><span class="string">"\xf2"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb9\x93" </span><span class="keyword">=&gt; </span><span class="string">"\xf3"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb9\x94" </span><span class="keyword">=&gt; </span><span class="string">"\xf4"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb9\x95" </span><span class="keyword">=&gt; </span><span class="string">"\xf5"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb9\x96" </span><span class="keyword">=&gt; </span><span class="string">"\xf6"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb9\x97" </span><span class="keyword">=&gt; </span><span class="string">"\xf7"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb9\x98" </span><span class="keyword">=&gt; </span><span class="string">"\xf8"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb9\x99" </span><span class="keyword">=&gt; </span><span class="string">"\xf9"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb9\x9a" </span><span class="keyword">=&gt; </span><span class="string">"\xfa"</span><span class="keyword">,
<br />
</span><span class="string">"\xe0\xb9\x9b" </span><span class="keyword">=&gt; </span><span class="string">"\xfb"</span><span class="keyword">,
<br />
&nbsp;);
<br />
&nbsp;
<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$string</span><span class="keyword">=</span><span class="default">strtr</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">,</span><span class="default">$UTF8</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; return </span><span class="default">$string</span><span class="keyword">;
<br />
&nbsp;}
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Jo, EThaiZone.Com</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="61120""></a>
  <div class="note">
   <strong class="user">2ge at NO2geSPAM dot us</strong>
   <a href="#61120" class="date">26-Jan-2006 10:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hello all,
<br />

<br />
I like to use COOL (nice) URIs, example: <a href="http://example.com/try-something" rel="nofollow" target="_blank">http://example.com/try-something</a>
<br />
I'm using UTF8 as input, so I have to write a function UTF8toASCII to have nice URI. Here is what I come with:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">urlize</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">) {
<br />
&nbsp;</span><span class="default">$search </span><span class="keyword">= array(</span><span class="string">'/[^a-z0-9]/'</span><span class="keyword">, </span><span class="string">'/--+/'</span><span class="keyword">, </span><span class="string">'/^-+/'</span><span class="keyword">, </span><span class="string">'/-+$/' </span><span class="keyword">);
<br />
&nbsp;</span><span class="default">$replace </span><span class="keyword">= array( </span><span class="string">'-'</span><span class="keyword">, </span><span class="string">'-'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">);
<br />
&nbsp;return </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="default">$search</span><span class="keyword">, </span><span class="default">$replace</span><span class="keyword">, </span><span class="default">utf2ascii</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">));
<br />
}&nbsp; &nbsp;&nbsp; 
<br />

<br />
function </span><span class="default">utf2ascii</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">) {
<br />
&nbsp;</span><span class="default">$iso88591&nbsp; </span><span class="keyword">= </span><span class="string">"\\xE0\\xE1\\xE2\\xE3\\xE4\\xE5\\xE6\\xE7"</span><span class="keyword">;
<br />
&nbsp;</span><span class="default">$iso88591 </span><span class="keyword">.= </span><span class="string">"\\xE8\\xE9\\xEA\\xEB\\xEC\\xED\\xEE\\xEF"</span><span class="keyword">;
<br />
&nbsp;</span><span class="default">$iso88591 </span><span class="keyword">.= </span><span class="string">"\\xF0\\xF1\\xF2\\xF3\\xF4\\xF5\\xF6\\xF7"</span><span class="keyword">;
<br />
&nbsp;</span><span class="default">$iso88591 </span><span class="keyword">.= </span><span class="string">"\\xF8\\xF9\\xFA\\xFB\\xFC\\xFD\\xFE\\xFF"</span><span class="keyword">;
<br />
&nbsp;</span><span class="default">$ascii </span><span class="keyword">= </span><span class="string">"aaaaaaaceeeeiiiidnooooooouuuuyyy"</span><span class="keyword">;
<br />
&nbsp;return </span><span class="default">strtr</span><span class="keyword">(</span><span class="default">mb_strtolower</span><span class="keyword">(</span><span class="default">utf8_decode</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">), </span><span class="string">'ISO-8859-1'</span><span class="keyword">),</span><span class="default">$iso88591</span><span class="keyword">,</span><span class="default">$ascii</span><span class="keyword">);
<br />
}
<br />

<br />
echo </span><span class="default">urlize</span><span class="keyword">(</span><span class="string">"Fucking ?m?l"</span><span class="keyword">);
<br />

<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
I hope this helps someone.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="59485""></a>
  <div class="note">
   <strong class="user">php-net at ---NOSPAM---lc dot yi dot org</strong>
   <a href="#59485" class="date">08-Dec-2005 09:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I've just created this code snippet to improve the user-customizable emails sent by one of my websites.<br />
<br />
The goal was to use UTF-8 (Unicode) so that non-english users have all the Unicode benefits, BUT also make life seamless for English (or specifically, English MS-Outlook users).&nbsp; The niggle: Outlook prior to 2003 (?)&nbsp; does not properly detect unicode emails.&nbsp; When "smart quotes" from MS Word were pasted into a rich text area and saved in Unicode, then sent by email to an Outlook user, more often than not, these characters were wrongly rendered as "greek". <br />
<br />
So, the following code snippet replaces a few strategic characters into html entities which Outlook XP (and possibly earlier) will render as expected.&nbsp; [Code based on bits of code from previous posts on this and the htmlenties page]<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; $badwordchars</span><span class="keyword">=array(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"\xe2\x80\x98"</span><span class="keyword">, </span><span class="comment">// left single quote<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"\xe2\x80\x99"</span><span class="keyword">, </span><span class="comment">// right single quote<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"\xe2\x80\x9c"</span><span class="keyword">, </span><span class="comment">// left double quote<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"\xe2\x80\x9d"</span><span class="keyword">, </span><span class="comment">// right double quote<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"\xe2\x80\x94"</span><span class="keyword">, </span><span class="comment">// em dash<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"\xe2\x80\xa6" </span><span class="comment">// elipses<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fixedwordchars</span><span class="keyword">=array(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"&amp;#8216;"</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"&amp;#8217;"</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'&amp;#8220;'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'&amp;#8221;'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'&amp;mdash;'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'&amp;#8230;'<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$html</span><span class="keyword">=</span><span class="default">str_replace</span><span class="keyword">(</span><span class="default">$badwordchars</span><span class="keyword">,</span><span class="default">$fixedwordchars</span><span class="keyword">,</span><span class="default">$html</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="59484""></a>
  <div class="note">
   <strong class="user">yannikh at gmeil dot com</strong>
   <a href="#59484" class="date">08-Dec-2005 08:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I had to tackle a very interesting problem:<br />
<br />
I wanted to replace all \xXX in a text by it's letters. Unfortunatelly XX were ASCII and not utf8. I solved my problem that way:<br />
<span class="default">&lt;?php preg_replace </span><span class="keyword">(</span><span class="string">'/\\\\x([0-9a-fA-F]{2})/e'</span><span class="keyword">, </span><span class="string">"pack('H*',utf8_decode('\\1'))"</span><span class="keyword">,</span><span class="default">$v</span><span class="keyword">); </span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="57339""></a>
  <div class="note">
   <strong class="user">thierry.bo # netcourrier point com</strong>
   <a href="#57339" class="date">30-Sep-2005 09:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In response to fhoech (22-Sep-2005 11:55), I just tried a simultaneous test with the file UTF-8-test.txt using your regexp, 'j dot dittmer' (20-Sep-2005 06:30) regexp (message #56962), `php-note-2005` (17-Feb-2005 08:57) regexp in his message on `mb-detect-encoding` page (<a href="http://us3.php.net/manual/en/function.mb-detect-encoding.php#50087" rel="nofollow" target="_blank">http://us3.php.net/manual/en/function.mb-detect-encoding.php#50087</a>) who is using a regexp from the W3C (<a href="http://w3.org/International/questions/qa-forms-utf-8.html" rel="nofollow" target="_blank">http://w3.org/International/questions/qa-forms-utf-8.html</a>), and PHP mb_detect_encoding function.<br />
<br />
Here are a summarize of the results :<br />
<br />
201 lines are valid UTF8 strings using phpnote regexp<br />
203 lines are valid UTF8 strings using j.dittmer regexp<br />
200 lines are valid UTF8 strings using fhoech regexp<br />
239 lines are valid&nbsp; UTF8 strings using using mb_detect_encoding<br />
<br />
Here are the lines with differences (left to right, phpnote, j.dittmer and fhoech) :<br />
<br />
Line #70 : NOT UTF8|IS UTF8!|IS UTF8! :2.1.1 1 byte (U-00000000): "" <br />
Line #79 : NOT UTF8|IS UTF8!|IS UTF8! :2.2.1 1 byte (U-0000007F): "" <br />
Line #81 : IS UTF8!|IS UTF8!|NOT UTF8 :2.2.3 3 bytes (U-0000FFFF): "&amp;#65535;" | <br />
Line #267 : IS UTF8!|IS UTF8!|NOT UTF8 :5.3.1 U+FFFE = ef bf be = "&amp;#65534;" |<br />
Line #268 : IS UTF8!|IS UTF8!|NOT UTF8 :5.3.2 U+FFFF = ef bf bf = "&amp;#65535;" | <br />
<br />
Interesting is that you said that your regexp corrected j.dittmer regexp that failed on 5.3 section, but it my test I have the opposite result ?!<br />
<br />
I ran this test on windows XP with PHP 4.3.11dev. Maybe these differences come from operating system, or PHP version. <br />
<br />
For mb_detect_encoding I used the command :<br />
<br />
mb_detect_encoding($line, 'UTF-8, ISO-8859-1, ASCII');</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="57070""></a>
  <div class="note">
   <strong class="user">fhoech</strong>
   <a href="#57070" class="date">22-Sep-2005 07:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Sorry, I had a typo in my last comment. Corrected regexp:<br />
<br />
^([\\x00-\\x7f]|<br />
[\\xc2-\\xdf][\\x80-\\xbf]|<br />
\\xe0[\\xa0-\\xbf][\\x80-\\xbf]|<br />
[\\xe1-\\xec][\\x80-\\xbf]{2}|<br />
\\xed[\\x80-\\x9f][\\x80-\\xbf]|<br />
\\xef[\\x80-\\xbf][\\x80-\\xbd]|<br />
\\xee[\\x80-\\xbf]{2}|<br />
\xf0[\\x90-\\xbf][\\x80-\\xbf]{2}|<br />
[\\xf1-\\xf3][\\x80-\\xbf]{3}|<br />
\\xf4[\\x80-\\x8f][\\x80-\\xbf]{2})*$</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="57069""></a>
  <div class="note">
   <strong class="user">fhoech</strong>
   <a href="#57069" class="date">22-Sep-2005 07:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
JF Sebastian's regex is almost perfect as far as I'm concerned. I found one error (it failed section 5.3 "Other illegal code positions" from <a href="http://www.cl.cam.ac.uk/~mgk25/ucs/examples/UTF-8-test.txt" rel="nofollow" target="_blank">http://www.cl.cam.ac.uk/~mgk25/ucs/examples/UTF-8-test.txt</a>) which I corrected as follows:<br />
<br />
^([\\x00-\\x7f]|<br />
[\\xc2-\\xdf][\\x80-\\xbf]|<br />
\\xe0[\\xa0-\\xbf][\\x80-\\xbf]|<br />
[\\xe1-\\xec][\\x80-\\xbf]{2}|<br />
\\xed[\\x80-\\x9f][\\x80-\\xbf]|<br />
\\xef[\\x80-\\xbf][\\x80-\\xbc]|<br />
\\xee[\\x80-\\xbf]{2}|<br />
\\xf0[\\x90-\\xbf][\\x80-\\xbf]{2}|<br />
[\\xf1-\\xf3][\\x80-\\xbf]{3}|<br />
\\xf4[\\x80-\\x8f][\\x80-\\xbf]{2})*$<br />
<br />
(Again, concatenate to one single line to make it work)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="56962""></a>
  <div class="note">
   <strong class="user">j dot dittmer at portrix dot net</strong>
   <a href="#56962" class="date">20-Sep-2005 02:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The regex in the last comment has some typos. This is a<br />
syntactically valid one, don't know if it's correct though.<br />
You've to concat the expression in one long line.<br />
<br />
^(<br />
[\x00-\x7f]|<br />
[\xc2-\xdf][\x80-\xbf]|<br />
[\xe0][\xa0-\xbf][\x80-\xbf]|<br />
[\xe1-\xec][\x80-\xbf]{2}|<br />
[\xed][\x80-\x9f][\x80-\xbf]|<br />
[\xee-\xef][\x80-\xbf]{2}|<br />
[\xf0][\x90-\xbf][\x80-\xbf]{2}|<br />
[\xf1-\xf3][\x80-\xbf]{3}|<br />
[\xf4][\x80-\x8f][\x80-\xbf]{2}<br />
)*$</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="55631""></a>
  <div class="note">
   <strong class="user">chris at mrwsp dot com</strong>
   <a href="#55631" class="date">09-Aug-2005 12:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A small improvement.<br />
<br />
JF Sebastian's regex for UTF-8 is not quite correct.&nbsp; Because code points could otherwise be coded in more than one way using UTF-8, the Standard stipulates that the shortest possible representation for a character should be used.&nbsp; So some 'duplicate' combinations his regex accepts are not valid UTF-8.&nbsp; Additionally, his regex accepts characters beyond the valid Unicode code space.<br />
<br />
The regex should be:<br />
<br />
^([\x00-\x7f]|<br />
[\xc2-\xdf][\x80-\xbf]|<br />
[\xe0][\xa0-\xbf][\x80-xbf]|<br />
[\xe1-\xec][\x80-\xbf]{2}|<br />
[\xed][\x80-\x9f][\x80-\xbf]|<br />
[\xee-\xef][\x80-\xbf]{2}|<br />
[\xf0][\x90-\xbf][\x80-\xbf]{2}|<br />
[\xf1-\xf3][\x80-\xbf]{3}|<br />
[\xf4][\x80-\x8f][\x80-\xbf]{2}*$)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="53815""></a>
  <div class="note">
   <strong class="user">miracle at balkansys dot com</strong>
   <a href="#53815" class="date">14-Jun-2005 11:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The best multilanguage library I have found is a part of a CMS system - typo3<br />
<br />
<a href="http://www.typo3.org" rel="nofollow" target="_blank">http://www.typo3.org</a><br />
<br />
It can convert from and to any charset + it does it by three methods - mbstring, iconv, or the raw way by scripts. It uses only one of these techniques - the fastest if available.<br />
<br />
That was the only way I could make mysql 3.23 contain letters in almost any language, while maintaining my website in utf-8 only.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="52656""></a>
  <div class="note">
   <strong class="user">Vladimir Stwora, vlad4321 at fastmail dot fm</strong>
   <a href="#52656" class="date">09-May-2005 12:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to convert utf-8 to ascii, you can use the following procedure:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">utf2ascii</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">) {<br />
&nbsp;&nbsp; </span><span class="default">$string</span><span class="keyword">=</span><span class="default">iconv</span><span class="keyword">(</span><span class="string">'utf-8'</span><span class="keyword">,</span><span class="string">'windows-1250'</span><span class="keyword">,</span><span class="default">$string</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">$win&nbsp; </span><span class="keyword">=</span><span class="string">'??????...'</span><span class="keyword">;&nbsp; </span><span class="comment">// I was unable to paste here all set of characters, but you get the point<br />
&nbsp;&nbsp; </span><span class="default">$ascii</span><span class="keyword">=</span><span class="string">'zyaieuu...'</span><span class="keyword">;<br />
&nbsp;&nbsp; </span><span class="default">$string </span><span class="keyword">= </span><span class="default">StrTr</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">,</span><span class="default">$win</span><span class="keyword">,</span><span class="default">$ascii</span><span class="keyword">);<br />
&nbsp;&nbsp; return </span><span class="default">$string</span><span class="keyword">;<br />
&nbsp; }<br />
</span><span class="default">?&gt;<br />
</span>This works based on the assumption that you know what language text (and thus what charset) you want to convert from. In the above example I am converting from an eastern European language, so I know I can safely use windows-1250 charset as an intermediem charset. You will have to adjust the charset based on your language.<br />
<br />
Please remember that you have to save this file separately and it must be coded in the charset, which you will call within function iconv. Otherwise it will not work.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="51417""></a>
  <div class="note">
   <strong class="user">JF Sebastian</strong>
   <a href="#51417" class="date">30-Mar-2005 04:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The following Perl regular expression tests if a string is well-formed Unicode UTF-8 (Broken up after each | since long lines are not permitted here. Please join as a single line, no spaces, before use.):<br />
<br />
^([\x00-\x7f]|<br />
[\xc2-\xdf][\x80-\xbf]|<br />
\xe0[\xa0-\xbf][\x80-\xbf]|<br />
[\xe1-\xec][\x80-\xbf]{2}|<br />
\xed[\x80-\x9f][\x80-\xbf]|<br />
[\xee-\xef][\x80-\xbf]{2}|<br />
f0[\x90-\xbf][\x80-\xbf]{2}|<br />
[\xf1-\xf3][\x80-\xbf]{3}|<br />
\xf4[\x80-\x8f][\x80-\xbf]{2})*$<br />
<br />
NOTE: This strictly follows the Unicode standard 4.0, as described in chapter 3.9, table 3-6, "Well-formed UTF-8 byte sequences" ( <a href="http://www.unicode.org/versions/Unicode4.0.0/ch03.pdf#G31703 " rel="nofollow" target="_blank">http://www.unicode.org/versions/Unicode4.0.0/ch03.pdf#G31703 </a>).<br />
<br />
ISO-10646, a super-set of Unicode, uses UTF-8 (there called "UCS", see <a href="http://www.unicode.org/faq/utf_bom.html#1 " rel="nofollow" target="_blank">http://www.unicode.org/faq/utf_bom.html#1 </a>) in a relaxed variant that supports a 31-bit space encoded into up to six bytes instead of Unicode's 21 bits in up to four bytes. To check for ISO-10646 UTF-8, use the following Perl regular expression (again, broken up, see above):<br />
<br />
^([\x00-\x7f]|<br />
[\xc0-\xdf][\x80-\xbf]|<br />
[\xe0-\xef][\x80-\xbf]{2}|<br />
[\xf0-\xf7][\x80-\xbf]{3}|<br />
[\xf8-\xfb][\x80-\xbf]{4}|<br />
[\xfc-\xfd][\x80-\xbf]{5})*$<br />
<br />
The following function may be used with above expressions for a quick UTF-8 test, e.g. to distinguish ISO-8859-1-data from UTF-8-data if submitted from a &lt;form accept-charset="utf-8,iso-8859-1" method=..&gt;.<br />
<br />
function is_utf8($string) {<br />
&nbsp;&nbsp;&nbsp; return (preg_match('/[insert regular expression here]/', $string) === 1);<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="50985""></a>
  <div class="note">
   <strong class="user">ivanmaz(remove) at mech dot math dot msu dot su</strong>
   <a href="#50985" class="date">16-Mar-2005 12:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is my variant of UTF8 to Cyrillic Win-1251 encoding convertor that replaces all characters but latin and Russian ones with &amp;#...; entities:<br />
<br />
function utf2win1251 ($s)<br />
{<br />
&nbsp;$out = "";<br />
<br />
&nbsp;for ($i=0; $i&lt;strlen($s); $i++) <br />
&nbsp;{<br />
&nbsp; $c1 = substr ($s, $i, 1);<br />
&nbsp; $byte1 = ord ($c1);<br />
&nbsp; if ($byte1&gt;&gt;5 == 6) // 110x xxxx, 110 prefix for 2 bytes unicode<br />
&nbsp; {<br />
&nbsp;&nbsp; $i++;<br />
&nbsp;&nbsp; $c2 = substr ($s, $i, 1);<br />
&nbsp;&nbsp; $byte2 = ord ($c2);<br />
&nbsp;&nbsp; $byte1 &amp;= 31; // remove the 3 bit two bytes prefix<br />
&nbsp;&nbsp; $byte2 &amp;= 63; // remove the 2 bit trailing byte prefix<br />
&nbsp;&nbsp; $byte2 |= (($byte1 &amp; 3) &lt;&lt; 6); // last 2 bits of c1 become first 2 of c2<br />
&nbsp;&nbsp; $byte1 &gt;&gt;= 2; // c1 shifts 2 to the right<br />
<br />
&nbsp;&nbsp; $word = ($byte1&lt;&lt;8) + $byte2;<br />
&nbsp;&nbsp; if ($word==1025) $out .= chr(168);&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // ?<br />
&nbsp;&nbsp; elseif ($word==1105) $out .= chr(184);&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // ?<br />
&nbsp;&nbsp; elseif ($word&gt;=0x0410 &amp;&amp; $word&lt;=0x044F) $out .= chr($word-848); // ?-? ?-?<br />
&nbsp;&nbsp; else<br />
&nbsp;&nbsp; {&nbsp; <br />
&nbsp;&nbsp; &nbsp; $a = dechex($byte1);<br />
&nbsp;&nbsp; &nbsp; $a = str_pad($a, 2, "0", STR_PAD_LEFT);<br />
&nbsp;&nbsp; &nbsp; $b = dechex($byte2);<br />
&nbsp;&nbsp; &nbsp; $b = str_pad($b, 2, "0", STR_PAD_LEFT);<br />
&nbsp;&nbsp; &nbsp; $out .= "&amp;#x".$a.$b.";";<br />
&nbsp;&nbsp; }<br />
&nbsp; }<br />
&nbsp; else <br />
&nbsp; {<br />
&nbsp;&nbsp; $out .= $c1;<br />
&nbsp; }<br />
&nbsp;}<br />
<br />
&nbsp;return $out;<br />
}<br />
<br />
The function is based on 2 other functions posted below.<br />
I hope it will help those who convert UTF8-encoded text to Win-1251 to use it safely on Russian web pages (works fine in all browsers).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="49985""></a>
  <div class="note">
   <strong class="user">marcelo at maccoy dot com dot br</strong>
   <a href="#49985" class="date">14-Feb-2005 07:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
function decode_utf8($str){<br />
&nbsp;&nbsp; &nbsp; &nbsp; # erase null signs in string<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $str=eregi_replace("^.{10,13}q\?","",$str);<br />
&nbsp;&nbsp; &nbsp; &nbsp; # paterns<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $pat = "/=([0-9A-F]{2})/"; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $cha="'.chr(hexdec(";<br />
&nbsp;&nbsp; &nbsp; &nbsp; # to decode with eval and replace<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; eval("\$str='".<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; preg_replace($pat,$cha."'$1')).'",$str).<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; "';");<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; # return<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return $str;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } <br />
<br />
Note:<br />
It's possible put it in 3 lines, but I don't got in this first code submition.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="49418""></a>
  <div class="note">
   <strong class="user">husamb at maksimum dot net</strong>
   <a href="#49418" class="date">27-Jan-2005 10:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hi, I collected the some scripts in this page and I written a new customizable script. You can switch easily iso type to convert. There are definitions in unicode.org page at <a href="http://www.unicode.org/Public/MAPPINGS/ISO8859/. " rel="nofollow" target="_blank">http://www.unicode.org/Public/MAPPINGS/ISO8859/. </a><br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment"># GLOBAL VARIABLES <br />
</span><span class="default">$url </span><span class="keyword">= </span><span class="string">"<a href="http://www.unicode.org/Public/MAPPINGS/ISO8859/8859-9.TXT" rel="nofollow" target="_blank">http://www.unicode.org/Public/MAPPINGS/ISO8859/8859-9.TXT</a>"</span><span class="keyword">;<br />
</span><span class="comment">//$url = "8859-9.txt";<br />
</span><span class="default">$iso2utf </span><span class="keyword">= array();<br />
</span><span class="default">$utf2iso </span><span class="keyword">= array();<br />
<br />
</span><span class="comment"># UNICODE MAPPING TABLE PARSING<br />
</span><span class="keyword">function </span><span class="default">create_map</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; global </span><span class="default">$iso2utf</span><span class="keyword">, </span><span class="default">$utf2iso</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fl </span><span class="keyword">= @(</span><span class="default">file</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">)) OR (die(</span><span class="string">"cannot open file : </span><span class="default">$url</span><span class="string">\n"</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">count</span><span class="keyword">(</span><span class="default">$fl</span><span class="keyword">); </span><span class="default">$i</span><span class="keyword">++){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$fl</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">] != </span><span class="string">'#' </span><span class="keyword">&amp;&amp; </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$fl</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">])){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; list(</span><span class="default">$iso</span><span class="keyword">, </span><span class="default">$uni</span><span class="keyword">, </span><span class="default">$s</span><span class="keyword">, </span><span class="default">$desc</span><span class="keyword">) = </span><span class="default">split</span><span class="keyword">(</span><span class="string">"\t"</span><span class="keyword">,</span><span class="default">$fl</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$iso2utf</span><span class="keyword">[</span><span class="default">$iso</span><span class="keyword">] = </span><span class="default">$uni</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$utf2iso</span><span class="keyword">[</span><span class="default">$uni</span><span class="keyword">] = </span><span class="default">$iso</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="comment"># FINDING UNICODE LETTER'S DECIMAL ASCII VALUE<br />
</span><span class="keyword">function </span><span class="default">uniord</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ud </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">{</span><span class="default">0</span><span class="keyword">})&gt;=</span><span class="default">0 </span><span class="keyword">&amp;&amp; </span><span class="default">ord</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">{</span><span class="default">0</span><span class="keyword">})&lt;=</span><span class="default">127</span><span class="keyword">)&nbsp;&nbsp; </span><span class="default">$ud </span><span class="keyword">= </span><span class="default">$c</span><span class="keyword">{</span><span class="default">0</span><span class="keyword">};<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">{</span><span class="default">0</span><span class="keyword">})&gt;=</span><span class="default">192 </span><span class="keyword">&amp;&amp; </span><span class="default">ord</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">{</span><span class="default">0</span><span class="keyword">})&lt;=</span><span class="default">223</span><span class="keyword">) </span><span class="default">$ud </span><span class="keyword">= (</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">{</span><span class="default">0</span><span class="keyword">})-</span><span class="default">192</span><span class="keyword">)*</span><span class="default">64 </span><span class="keyword">+ (</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">{</span><span class="default">1</span><span class="keyword">})-</span><span class="default">128</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">{</span><span class="default">0</span><span class="keyword">})&gt;=</span><span class="default">224 </span><span class="keyword">&amp;&amp; </span><span class="default">ord</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">{</span><span class="default">0</span><span class="keyword">})&lt;=</span><span class="default">239</span><span class="keyword">) </span><span class="default">$ud </span><span class="keyword">= (</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">{</span><span class="default">0</span><span class="keyword">})-</span><span class="default">224</span><span class="keyword">)*</span><span class="default">4096 </span><span class="keyword">+ (</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">{</span><span class="default">1</span><span class="keyword">})-</span><span class="default">128</span><span class="keyword">)*</span><span class="default">64 </span><span class="keyword">+ (</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">{</span><span class="default">2</span><span class="keyword">})-</span><span class="default">128</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">{</span><span class="default">0</span><span class="keyword">})&gt;=</span><span class="default">240 </span><span class="keyword">&amp;&amp; </span><span class="default">ord</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">{</span><span class="default">0</span><span class="keyword">})&lt;=</span><span class="default">247</span><span class="keyword">) </span><span class="default">$ud </span><span class="keyword">= (</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">{</span><span class="default">0</span><span class="keyword">})-</span><span class="default">240</span><span class="keyword">)*</span><span class="default">262144 </span><span class="keyword">+ (</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">{</span><span class="default">1</span><span class="keyword">})-</span><span class="default">128</span><span class="keyword">)*</span><span class="default">4096 </span><span class="keyword">+ (</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">{</span><span class="default">2</span><span class="keyword">})-</span><span class="default">128</span><span class="keyword">)*</span><span class="default">64 </span><span class="keyword">+ (</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">{</span><span class="default">3</span><span class="keyword">})-</span><span class="default">128</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">{</span><span class="default">0</span><span class="keyword">})&gt;=</span><span class="default">248 </span><span class="keyword">&amp;&amp; </span><span class="default">ord</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">{</span><span class="default">0</span><span class="keyword">})&lt;=</span><span class="default">251</span><span class="keyword">) </span><span class="default">$ud </span><span class="keyword">= (</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">{</span><span class="default">0</span><span class="keyword">})-</span><span class="default">248</span><span class="keyword">)*</span><span class="default">16777216 </span><span class="keyword">+ (</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">{</span><span class="default">1</span><span class="keyword">})-</span><span class="default">128</span><span class="keyword">)*</span><span class="default">262144 </span><span class="keyword">+ (</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">{</span><span class="default">2</span><span class="keyword">})-</span><span class="default">128</span><span class="keyword">)*</span><span class="default">4096 </span><span class="keyword">+ (</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">{</span><span class="default">3</span><span class="keyword">})-</span><span class="default">128</span><span class="keyword">)*</span><span class="default">64 </span><span class="keyword">+ (</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">{</span><span class="default">4</span><span class="keyword">})-</span><span class="default">128</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">{</span><span class="default">0</span><span class="keyword">})&gt;=</span><span class="default">252 </span><span class="keyword">&amp;&amp; </span><span class="default">ord</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">{</span><span class="default">0</span><span class="keyword">})&lt;=</span><span class="default">253</span><span class="keyword">) </span><span class="default">$ud </span><span class="keyword">= (</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">{</span><span class="default">0</span><span class="keyword">})-</span><span class="default">252</span><span class="keyword">)*</span><span class="default">1073741824 </span><span class="keyword">+ (</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">{</span><span class="default">1</span><span class="keyword">})-</span><span class="default">128</span><span class="keyword">)*</span><span class="default">16777216 </span><span class="keyword">+ (</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">{</span><span class="default">2</span><span class="keyword">})-</span><span class="default">128</span><span class="keyword">)*</span><span class="default">262144 </span><span class="keyword">+ (</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">{</span><span class="default">3</span><span class="keyword">})-</span><span class="default">128</span><span class="keyword">)*</span><span class="default">4096 </span><span class="keyword">+ (</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">{</span><span class="default">4</span><span class="keyword">})-</span><span class="default">128</span><span class="keyword">)*</span><span class="default">64 </span><span class="keyword">+ (</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">{</span><span class="default">5</span><span class="keyword">})-</span><span class="default">128</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">{</span><span class="default">0</span><span class="keyword">})&gt;=</span><span class="default">254 </span><span class="keyword">&amp;&amp; </span><span class="default">ord</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">{</span><span class="default">0</span><span class="keyword">})&lt;=</span><span class="default">255</span><span class="keyword">) </span><span class="default">$ud </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">; </span><span class="comment">//error<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">$ud</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="comment"># PARSING UNICODE STRING<br />
</span><span class="keyword">function </span><span class="default">utf2iso</span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; global </span><span class="default">$utf2iso</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$pos </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$len </span><span class="keyword">= </span><span class="default">strlen </span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$encodedString </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; while (</span><span class="default">$pos </span><span class="keyword">&lt; </span><span class="default">$len</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$is_ascii </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$asciiPos </span><span class="keyword">= </span><span class="default">ord </span><span class="keyword">(</span><span class="default">substr </span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">, </span><span class="default">$pos</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if((</span><span class="default">$asciiPos </span><span class="keyword">&gt;= </span><span class="default">240</span><span class="keyword">) &amp;&amp; (</span><span class="default">$asciiPos </span><span class="keyword">&lt;= </span><span class="default">255</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// 4 chars representing one unicode character<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$thisLetter </span><span class="keyword">= </span><span class="default">substr </span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">, </span><span class="default">$pos</span><span class="keyword">, </span><span class="default">4</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$thisLetterOrd </span><span class="keyword">= </span><span class="default">uniord</span><span class="keyword">(</span><span class="default">$thisLetter</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pos </span><span class="keyword">+= </span><span class="default">4</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else if((</span><span class="default">$asciiPos </span><span class="keyword">&gt;= </span><span class="default">224</span><span class="keyword">) &amp;&amp; (</span><span class="default">$asciiPos </span><span class="keyword">&lt;= </span><span class="default">239</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// 3 chars representing one unicode character<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$thisLetter </span><span class="keyword">= </span><span class="default">substr </span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">, </span><span class="default">$pos</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$thisLetterOrd </span><span class="keyword">= </span><span class="default">uniord</span><span class="keyword">(</span><span class="default">$thisLetter</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pos </span><span class="keyword">+= </span><span class="default">3</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else if((</span><span class="default">$asciiPos </span><span class="keyword">&gt;= </span><span class="default">192</span><span class="keyword">) &amp;&amp; (</span><span class="default">$asciiPos </span><span class="keyword">&lt;= </span><span class="default">223</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// 2 chars representing one unicode character<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$thisLetter </span><span class="keyword">= </span><span class="default">substr </span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">, </span><span class="default">$pos</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$thisLetterOrd </span><span class="keyword">= </span><span class="default">uniord</span><span class="keyword">(</span><span class="default">$thisLetter</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pos </span><span class="keyword">+= </span><span class="default">2</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// 1 char (lower ascii)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$thisLetter </span><span class="keyword">= </span><span class="default">substr </span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">, </span><span class="default">$pos</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$thisLetterOrd </span><span class="keyword">= </span><span class="default">uniord</span><span class="keyword">(</span><span class="default">$thisLetter</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pos </span><span class="keyword">+= </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$encodedString </span><span class="keyword">.= </span><span class="default">$thisLetterOrd</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$is_ascii </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(!</span><span class="default">$is_ascii</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$hex </span><span class="keyword">= </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">"%X"</span><span class="keyword">, </span><span class="default">$thisLetterOrd</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$hex</span><span class="keyword">)&lt;</span><span class="default">4</span><span class="keyword">) for(</span><span class="default">$t</span><span class="keyword">=</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$hex</span><span class="keyword">);</span><span class="default">$t</span><span class="keyword">&lt;</span><span class="default">4</span><span class="keyword">;</span><span class="default">$t</span><span class="keyword">++)</span><span class="default">$hex </span><span class="keyword">= </span><span class="string">"0"</span><span class="keyword">.</span><span class="default">$hex</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$hex </span><span class="keyword">= </span><span class="string">"0x"</span><span class="keyword">.</span><span class="default">$hex</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$hex </span><span class="keyword">= </span><span class="default">$utf2iso</span><span class="keyword">[</span><span class="default">$hex</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$hex </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'0x'</span><span class="keyword">,</span><span class="string">''</span><span class="keyword">,</span><span class="default">$hex</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dec </span><span class="keyword">= </span><span class="default">hexdec</span><span class="keyword">(</span><span class="default">$hex</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$encodedString </span><span class="keyword">.= </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">"%c"</span><span class="keyword">, </span><span class="default">$dec</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$encodedString</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="comment"># CREATING ISO2UTF &amp; UTF2ISO MAPS<br />
</span><span class="default">create_map</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">);<br />
<br />
</span><span class="comment"># TESTING<br />
</span><span class="default">$unicode_string </span><span class="keyword">= </span><span class="string">"Ekonomi_ve_\xc4\xb0\xc5\x9f_D\xc3\xbcnyas\xc4\xb1"</span><span class="keyword">;<br />
<br />
echo </span><span class="string">"unicode string : &lt;b&gt;" </span><span class="keyword">. </span><span class="default">$unicode_string </span><span class="keyword">. </span><span class="string">"&lt;/b&gt;"</span><span class="keyword">;<br />
echo </span><span class="string">"&lt;br&gt;&lt;br&gt;"</span><span class="keyword">;<br />
echo </span><span class="string">"ISO8859 (latin5 / turkish) converted string : &lt;b&gt;" </span><span class="keyword">. </span><span class="default">utf2iso</span><span class="keyword">(</span><span class="default">$unicode_string</span><span class="keyword">) . </span><span class="string">"&lt;/b&gt;"</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
The unicode string is turkish. ITs mean in english is 'Economy and Business World' :)<br />
<br />
Husam</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="49185""></a>
  <div class="note">
   <strong class="user">rasmus at flajm dot se</strong>
   <a href="#49185" class="date">19-Jan-2005 11:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you don't have the multibyte extension installed, here's a function to decode UTF-16 encoded strings. It support both BOM-less and BOM'ed strings, (big- and little-endian byte order.)<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/**<br />
&nbsp;* Decode UTF-16 encoded strings.<br />
&nbsp;* <br />
&nbsp;* Can handle both BOM'ed data and un-BOM'ed data. <br />
&nbsp;* Assumes Big-Endian byte order if no BOM is available.<br />
&nbsp;* <br />
&nbsp;* @param&nbsp;&nbsp; string&nbsp; $str&nbsp; UTF-16 encoded data to decode.<br />
&nbsp;* @return&nbsp; string&nbsp; UTF-8 / ISO encoded data.<br />
&nbsp;* @access&nbsp; public<br />
&nbsp;* @version 0.1 / 2005-01-19<br />
&nbsp;* @author&nbsp; Rasmus Andersson {@link <a href="http://rasmusandersson.se/}" rel="nofollow" target="_blank">http://rasmusandersson.se/}</a><br />
&nbsp;* @package Groupies<br />
&nbsp;*/<br />
</span><span class="keyword">function </span><span class="default">utf16_decode</span><span class="keyword">( </span><span class="default">$str </span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if( </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">) &lt; </span><span class="default">2 </span><span class="keyword">) return </span><span class="default">$str</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$bom_be </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$c0 </span><span class="keyword">= </span><span class="default">ord</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">{</span><span class="default">0</span><span class="keyword">});<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$c1 </span><span class="keyword">= </span><span class="default">ord</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">{</span><span class="default">1</span><span class="keyword">});<br />
&nbsp;&nbsp;&nbsp; if( </span><span class="default">$c0 </span><span class="keyword">== </span><span class="default">0xfe </span><span class="keyword">&amp;&amp; </span><span class="default">$c1 </span><span class="keyword">== </span><span class="default">0xff </span><span class="keyword">) { </span><span class="default">$str </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">); }<br />
&nbsp;&nbsp;&nbsp; elseif( </span><span class="default">$c0 </span><span class="keyword">== </span><span class="default">0xff </span><span class="keyword">&amp;&amp; </span><span class="default">$c1 </span><span class="keyword">== </span><span class="default">0xfe </span><span class="keyword">) { </span><span class="default">$str </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">); </span><span class="default">$bom_be </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$len </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$newstr </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">$len</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">+=</span><span class="default">2</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="default">$bom_be </span><span class="keyword">) { </span><span class="default">$val </span><span class="keyword">= </span><span class="default">ord</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">{</span><span class="default">$i</span><span class="keyword">})&nbsp;&nbsp; &lt;&lt; </span><span class="default">4</span><span class="keyword">; </span><span class="default">$val </span><span class="keyword">+= </span><span class="default">ord</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">{</span><span class="default">$i</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">}); }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else {&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$val </span><span class="keyword">= </span><span class="default">ord</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">{</span><span class="default">$i</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">}) &lt;&lt; </span><span class="default">4</span><span class="keyword">; </span><span class="default">$val </span><span class="keyword">+= </span><span class="default">ord</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">{</span><span class="default">$i</span><span class="keyword">}); }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$newstr </span><span class="keyword">.= (</span><span class="default">$val </span><span class="keyword">== </span><span class="default">0x228</span><span class="keyword">) ? </span><span class="string">"\n" </span><span class="keyword">: </span><span class="default">chr</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$newstr</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="47146""></a>
  <div class="note">
   <strong class="user">dobersch at gmx dot net</strong>
   <a href="#47146" class="date">04-Nov-2004 03:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Sorry, there's an error in my previous comment, my error_reporting was not set to E_ALL ... so the notices disappeared...<br />
<br />
It seems that those Google URLs are not only UTF-8 encoded, but after encoding, several values also get replaced. (cp1252 ?)<br />
<br />
Just the way as described in following comments on the utf8_encode() page:<br />
<a href="http://de3.php.net/manual/de/function.utf8-encode.php#44843 and" rel="nofollow" target="_blank">http://de3.php.net/manual/de/function.utf8-encode.php#44843 and</a><br />
<a href="http://de3.php.net/manual/de/function.utf8-encode.php#45226" rel="nofollow" target="_blank">http://de3.php.net/manual/de/function.utf8-encode.php#45226</a><br />
<br />
Below I post a solution for getting back the ISO-8859-1 encoded string from the encoded data, by turning the function from Aidan the other way around.<br />
<br />
hope this time, everything is alright...<br />
<br />
<span class="default">&lt;?PHP<br />
ini_set</span><span class="keyword">(</span><span class="string">'error_reporting'</span><span class="keyword">, </span><span class="default">E_ALL</span><span class="keyword">);<br />
</span><span class="comment">// map taken from <a href="http://de3.php.net/manual/de/function.utf8-encode.php#45226" rel="nofollow" target="_blank">http://de3.php.net/manual/de/function.utf8-encode.php#45226</a><br />
</span><span class="default">$cp1252_map </span><span class="keyword">= array(<br />
&nbsp;&nbsp; </span><span class="string">"\xc2\x80" </span><span class="keyword">=&gt; </span><span class="string">"\xe2\x82\xac"</span><span class="keyword">, </span><span class="comment">/* EURO SIGN */<br />
&nbsp;&nbsp; </span><span class="string">"\xc2\x82" </span><span class="keyword">=&gt; </span><span class="string">"\xe2\x80\x9a"</span><span class="keyword">, </span><span class="comment">/* SINGLE LOW-9 QUOTATION MARK */<br />
&nbsp;&nbsp; </span><span class="string">"\xc2\x83" </span><span class="keyword">=&gt; </span><span class="string">"\xc6\x92"</span><span class="keyword">,&nbsp; &nbsp; </span><span class="comment">/* LATIN SMALL LETTER F WITH HOOK */<br />
&nbsp;&nbsp; </span><span class="string">"\xc2\x84" </span><span class="keyword">=&gt; </span><span class="string">"\xe2\x80\x9e"</span><span class="keyword">, </span><span class="comment">/* DOUBLE LOW-9 QUOTATION MARK */<br />
&nbsp;&nbsp; </span><span class="string">"\xc2\x85" </span><span class="keyword">=&gt; </span><span class="string">"\xe2\x80\xa6"</span><span class="keyword">, </span><span class="comment">/* HORIZONTAL ELLIPSIS */<br />
&nbsp;&nbsp; </span><span class="string">"\xc2\x86" </span><span class="keyword">=&gt; </span><span class="string">"\xe2\x80\xa0"</span><span class="keyword">, </span><span class="comment">/* DAGGER */<br />
&nbsp;&nbsp; </span><span class="string">"\xc2\x87" </span><span class="keyword">=&gt; </span><span class="string">"\xe2\x80\xa1"</span><span class="keyword">, </span><span class="comment">/* DOUBLE DAGGER */<br />
&nbsp;&nbsp; </span><span class="string">"\xc2\x88" </span><span class="keyword">=&gt; </span><span class="string">"\xcb\x86"</span><span class="keyword">,&nbsp; &nbsp; </span><span class="comment">/* MODIFIER LETTER CIRCUMFLEX ACCENT */<br />
&nbsp;&nbsp; </span><span class="string">"\xc2\x89" </span><span class="keyword">=&gt; </span><span class="string">"\xe2\x80\xb0"</span><span class="keyword">, </span><span class="comment">/* PER MILLE SIGN */<br />
&nbsp;&nbsp; </span><span class="string">"\xc2\x8a" </span><span class="keyword">=&gt; </span><span class="string">"\xc5\xa0"</span><span class="keyword">,&nbsp; &nbsp; </span><span class="comment">/* LATIN CAPITAL LETTER S WITH CARON */<br />
&nbsp;&nbsp; </span><span class="string">"\xc2\x8b" </span><span class="keyword">=&gt; </span><span class="string">"\xe2\x80\xb9"</span><span class="keyword">, </span><span class="comment">/* SINGLE LEFT-POINTING ANGLE QUOTATION */<br />
&nbsp;&nbsp; </span><span class="string">"\xc2\x8c" </span><span class="keyword">=&gt; </span><span class="string">"\xc5\x92"</span><span class="keyword">,&nbsp; &nbsp; </span><span class="comment">/* LATIN CAPITAL LIGATURE OE */<br />
&nbsp;&nbsp; </span><span class="string">"\xc2\x8e" </span><span class="keyword">=&gt; </span><span class="string">"\xc5\xbd"</span><span class="keyword">,&nbsp; &nbsp; </span><span class="comment">/* LATIN CAPITAL LETTER Z WITH CARON */<br />
&nbsp;&nbsp; </span><span class="string">"\xc2\x91" </span><span class="keyword">=&gt; </span><span class="string">"\xe2\x80\x98"</span><span class="keyword">, </span><span class="comment">/* LEFT SINGLE QUOTATION MARK */<br />
&nbsp;&nbsp; </span><span class="string">"\xc2\x92" </span><span class="keyword">=&gt; </span><span class="string">"\xe2\x80\x99"</span><span class="keyword">, </span><span class="comment">/* RIGHT SINGLE QUOTATION MARK */<br />
&nbsp;&nbsp; </span><span class="string">"\xc2\x93" </span><span class="keyword">=&gt; </span><span class="string">"\xe2\x80\x9c"</span><span class="keyword">, </span><span class="comment">/* LEFT DOUBLE QUOTATION MARK */<br />
&nbsp;&nbsp; </span><span class="string">"\xc2\x94" </span><span class="keyword">=&gt; </span><span class="string">"\xe2\x80\x9d"</span><span class="keyword">, </span><span class="comment">/* RIGHT DOUBLE QUOTATION MARK */<br />
&nbsp;&nbsp; </span><span class="string">"\xc2\x95" </span><span class="keyword">=&gt; </span><span class="string">"\xe2\x80\xa2"</span><span class="keyword">, </span><span class="comment">/* BULLET */<br />
&nbsp;&nbsp; </span><span class="string">"\xc2\x96" </span><span class="keyword">=&gt; </span><span class="string">"\xe2\x80\x93"</span><span class="keyword">, </span><span class="comment">/* EN DASH */<br />
&nbsp;&nbsp; </span><span class="string">"\xc2\x97" </span><span class="keyword">=&gt; </span><span class="string">"\xe2\x80\x94"</span><span class="keyword">, </span><span class="comment">/* EM DASH */<br />
<br />
&nbsp;&nbsp; </span><span class="string">"\xc2\x98" </span><span class="keyword">=&gt; </span><span class="string">"\xcb\x9c"</span><span class="keyword">,&nbsp; &nbsp; </span><span class="comment">/* SMALL TILDE */<br />
&nbsp;&nbsp; </span><span class="string">"\xc2\x99" </span><span class="keyword">=&gt; </span><span class="string">"\xe2\x84\xa2"</span><span class="keyword">, </span><span class="comment">/* TRADE MARK SIGN */<br />
&nbsp;&nbsp; </span><span class="string">"\xc2\x9a" </span><span class="keyword">=&gt; </span><span class="string">"\xc5\xa1"</span><span class="keyword">,&nbsp; &nbsp; </span><span class="comment">/* LATIN SMALL LETTER S WITH CARON */<br />
&nbsp;&nbsp; </span><span class="string">"\xc2\x9b" </span><span class="keyword">=&gt; </span><span class="string">"\xe2\x80\xba"</span><span class="keyword">, </span><span class="comment">/* SINGLE RIGHT-POINTING ANGLE QUOTATION*/<br />
&nbsp;&nbsp; </span><span class="string">"\xc2\x9c" </span><span class="keyword">=&gt; </span><span class="string">"\xc5\x93"</span><span class="keyword">,&nbsp; &nbsp; </span><span class="comment">/* LATIN SMALL LIGATURE OE */<br />
&nbsp;&nbsp; </span><span class="string">"\xc2\x9e" </span><span class="keyword">=&gt; </span><span class="string">"\xc5\xbe"</span><span class="keyword">,&nbsp; &nbsp; </span><span class="comment">/* LATIN SMALL LETTER Z WITH CARON */<br />
&nbsp;&nbsp; </span><span class="string">"\xc2\x9f" </span><span class="keyword">=&gt; </span><span class="string">"\xc5\xb8"&nbsp; &nbsp; &nbsp; </span><span class="comment">/* LATIN CAPITAL LETTER Y WITH DIAERESIS*/<br />
</span><span class="keyword">);<br />
<br />
</span><span class="comment">// I find this name a little misleading because the result won't be valid UTF8 data<br />
</span><span class="keyword">function </span><span class="default">cp1252_to_utf8</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">) {<br />
&nbsp;&nbsp; global </span><span class="default">$cp1252_map</span><span class="keyword">; <br />
&nbsp;&nbsp; return&nbsp; </span><span class="default">strtr</span><span class="keyword">(</span><span class="default">utf8_encode</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">), </span><span class="default">$cp1252_map</span><span class="keyword">);<br />
}<br />
<br />
function </span><span class="default">cp1252_utf8_to_iso</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">) { </span><span class="comment">// the other way around...<br />
&nbsp; </span><span class="keyword">global </span><span class="default">$cp1252_map</span><span class="keyword">;<br />
&nbsp; return&nbsp; </span><span class="default">utf8_decode</span><span class="keyword">( </span><span class="default">strtr</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">, </span><span class="default">array_flip</span><span class="keyword">(</span><span class="default">$cp1252_map</span><span class="keyword">)) );<br />
}<br />
<br />
</span><span class="default">$euro </span><span class="keyword">= </span><span class="string">"\xe2\x82\xac"</span><span class="keyword">;&nbsp; </span><span class="comment">// "google encoded" euro sign<br />
</span><span class="default">$str </span><span class="keyword">= </span><span class="default">cp1252_utf8_to_iso</span><span class="keyword">(</span><span class="default">$euro</span><span class="keyword">);<br />
<br />
for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">); </span><span class="default">$i</span><span class="keyword">++) {<br />
&nbsp; print </span><span class="string">'&amp;quot;' </span><span class="keyword">. </span><span class="default">$str</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] . </span><span class="string">'&amp;quot; - ' </span><span class="keyword">. </span><span class="default">ord</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]) . </span><span class="string">' (decimal)&lt;br /&gt;'</span><span class="keyword">;<br />
} <br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="45561""></a>
  <div class="note">
   <strong class="user">vpribish at shopping dot com</strong>
   <a href="#45561" class="date">10-Sep-2004 08:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
big thanks to wielspm and mittag for the function to convert wide utf to html.&nbsp; I have altered your function to output decimal html entities which i hear are more widely supported.&nbsp; Also I've optimized it, it is now twice as fast.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">utf2html </span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">) {
<br />
</span><span class="default">$ret </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;
<br />
</span><span class="default">$max </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">);
<br />
</span><span class="default">$last </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;&nbsp; </span><span class="comment">// keeps the index of the last regular character
<br />
</span><span class="keyword">for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">$max</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {
<br />
&nbsp;</span><span class="default">$c </span><span class="keyword">= </span><span class="default">$str</span><span class="keyword">{</span><span class="default">$i</span><span class="keyword">};
<br />
&nbsp;</span><span class="default">$c1 </span><span class="keyword">= </span><span class="default">ord</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">);
<br />
&nbsp;if (</span><span class="default">$c1</span><span class="keyword">&gt;&gt;</span><span class="default">5 </span><span class="keyword">== </span><span class="default">6</span><span class="keyword">) {&nbsp;&nbsp; </span><span class="comment">// 110x xxxx, 110 prefix for 2 bytes unicode
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ret </span><span class="keyword">.= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">, </span><span class="default">$last</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">-</span><span class="default">$last</span><span class="keyword">); </span><span class="comment">// append all the regular characters we've passed
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$c1 </span><span class="keyword">&amp;= </span><span class="default">31</span><span class="keyword">; </span><span class="comment">// remove the 3 bit two bytes prefix
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$c2 </span><span class="keyword">= </span><span class="default">ord</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">{++</span><span class="default">$i</span><span class="keyword">}); </span><span class="comment">// the next byte
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$c2 </span><span class="keyword">&amp;= </span><span class="default">63</span><span class="keyword">;&nbsp; </span><span class="comment">// remove the 2 bit trailing byte prefix
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$c2 </span><span class="keyword">|= ((</span><span class="default">$c1 </span><span class="keyword">&amp; </span><span class="default">3</span><span class="keyword">) &lt;&lt; </span><span class="default">6</span><span class="keyword">); </span><span class="comment">// last 2 bits of c1 become first 2 of c2
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$c1 </span><span class="keyword">&gt;&gt;= </span><span class="default">2</span><span class="keyword">; </span><span class="comment">// c1 shifts 2 to the right
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ret </span><span class="keyword">.= </span><span class="string">"&amp;#" </span><span class="keyword">. (</span><span class="default">$c1 </span><span class="keyword">* </span><span class="default">100 </span><span class="keyword">+ </span><span class="default">$c2</span><span class="keyword">) . </span><span class="string">";"</span><span class="keyword">; </span><span class="comment">// this is the fastest string concatenation
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$last </span><span class="keyword">= </span><span class="default">$i</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;}
<br />
}
<br />
return </span><span class="default">$ret </span><span class="keyword">. </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">, </span><span class="default">$last</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">); </span><span class="comment">// append the last batch of regular characters
<br />
</span><span class="keyword">}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="39517""></a>
  <div class="note">
   <strong class="user">Aidan Kehoe &lt;php-manual at parhasard dot net&gt;</strong>
   <a href="#39517" class="date">31-Jan-2004 02:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The fastest way I've found to check if something is valid UTF-8 is <br />
<span class="default">&lt;?php <br />
</span><span class="keyword">if (</span><span class="default">iconv</span><span class="keyword">(</span><span class="string">'UTF-8'</span><span class="keyword">, </span><span class="string">'UTF-8'</span><span class="keyword">, </span><span class="default">$input</span><span class="keyword">) != </span><span class="default">$input</span><span class="keyword">) { <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/* It's not UTF-8--for me, it's probably CP1252, the Windows<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; version of Latin 1, with directed quotation marks and<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; the Euro sign.&nbsp; */<br />
</span><span class="keyword">}<br />
&nbsp;</span><span class="default">?&gt;</span>. <br />
The iconv() C library fails if it's told a string is UTF-8 and it isn't; the PHP one doesn't, it just returns the conversion up to the point of failure, so you have to compare the result to the input to find out if the conversion succeeded.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="38591""></a>
  <div class="note">
   <strong class="user">lg83news at free dot fr</strong>
   <a href="#38591" class="date">29-Dec-2003 06:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here are some functions for converting UTF-8 to and from Latin 9 (aka ISO-8859-15), if your PHP file is encoded as UTF-8.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">latin9_to_utf8</span><span class="keyword">(</span><span class="default">$latin9str</span><span class="keyword">) { </span><span class="comment">// replaces utf8_encode()<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$trans </span><span class="keyword">= array(</span><span class="string">"?"</span><span class="keyword">=&gt;</span><span class="string">"?"</span><span class="keyword">, </span><span class="string">"?"</span><span class="keyword">=&gt;</span><span class="string">"?"</span><span class="keyword">, </span><span class="string">"?"</span><span class="keyword">=&gt;</span><span class="string">"?"</span><span class="keyword">, </span><span class="string">"?"</span><span class="keyword">=&gt;</span><span class="string">"?"</span><span class="keyword">, </span><span class="string">"?"</span><span class="keyword">=&gt;</span><span class="string">"?"</span><span class="keyword">, </span><span class="string">"?"</span><span class="keyword">=&gt;</span><span class="string">"?"</span><span class="keyword">, </span><span class="string">"?"</span><span class="keyword">=&gt;</span><span class="string">"?"</span><span class="keyword">, </span><span class="string">"?"</span><span class="keyword">=&gt;</span><span class="string">"?"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$wrong_utf8str </span><span class="keyword">= </span><span class="default">utf8_encode</span><span class="keyword">(</span><span class="default">$latin9str</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$utf8str </span><span class="keyword">= </span><span class="default">strtr</span><span class="keyword">(</span><span class="default">$wrong_utf8str</span><span class="keyword">, </span><span class="default">$trans</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$utf8str</span><span class="keyword">;<br />
}<br />
function </span><span class="default">utf8_to_latin9</span><span class="keyword">(</span><span class="default">$utf8str</span><span class="keyword">) { </span><span class="comment">// replaces utf8_decode()<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$trans </span><span class="keyword">= array(</span><span class="string">"?"</span><span class="keyword">=&gt;</span><span class="string">"?"</span><span class="keyword">, </span><span class="string">"?"</span><span class="keyword">=&gt;</span><span class="string">"?"</span><span class="keyword">, </span><span class="string">"?"</span><span class="keyword">=&gt;</span><span class="string">"?"</span><span class="keyword">, </span><span class="string">"?"</span><span class="keyword">=&gt;</span><span class="string">"?"</span><span class="keyword">, </span><span class="string">"?"</span><span class="keyword">=&gt;</span><span class="string">"?"</span><span class="keyword">, </span><span class="string">"?"</span><span class="keyword">=&gt;</span><span class="string">"?"</span><span class="keyword">, </span><span class="string">"?"</span><span class="keyword">=&gt;</span><span class="string">"?"</span><span class="keyword">, </span><span class="string">"?"</span><span class="keyword">=&gt;</span><span class="string">"?"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$wrong_utf8str </span><span class="keyword">= </span><span class="default">strtr</span><span class="keyword">(</span><span class="default">$utf8str</span><span class="keyword">, </span><span class="default">$trans</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$latin9str </span><span class="keyword">= </span><span class="default">utf8_decode</span><span class="keyword">(</span><span class="default">$wrong_utf8str</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$latin9str</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Note: the above functions will not work if your PHP file is not encoded in UTF-8.<br />
<br />
You can copy this binary data to your PHP file instead, it'll work with any encoding (including UTF-8) as long as you copy it as bytes, not characters:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">latin9_to_utf8</span><span class="keyword">(</span><span class="default">$latin9str</span><span class="keyword">) { </span><span class="comment">// replaces utf8_encode()<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$trans </span><span class="keyword">= array(</span><span class="string">"¤"</span><span class="keyword">=&gt;</span><span class="string">""</span><span class="keyword">, </span><span class="string">"|"</span><span class="keyword">=&gt;</span><span class="string">"? "</span><span class="keyword">, </span><span class="string">"¨"</span><span class="keyword">=&gt;</span><span class="string">"?"</span><span class="keyword">, </span><span class="string">"′"</span><span class="keyword">=&gt;</span><span class="string">"?"</span><span class="keyword">, </span><span class="string">"?"</span><span class="keyword">=&gt;</span><span class="string">"?"</span><span class="keyword">, </span><span class="string">"?"</span><span class="keyword">=&gt;</span><span class="string">"?"</span><span class="keyword">, </span><span class="string">"?"</span><span class="keyword">=&gt;</span><span class="string">"?"</span><span class="keyword">, </span><span class="string">"?"</span><span class="keyword">=&gt;</span><span class="string">"?"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$wrong_utf8str </span><span class="keyword">= </span><span class="default">utf8_encode</span><span class="keyword">(</span><span class="default">$latin9str</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$utf8str </span><span class="keyword">= </span><span class="default">strtr</span><span class="keyword">(</span><span class="default">$wrong_utf8str</span><span class="keyword">, </span><span class="default">$trans</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$utf8str</span><span class="keyword">;<br />
}<br />
function </span><span class="default">utf8_to_latin9</span><span class="keyword">(</span><span class="default">$utf8str</span><span class="keyword">) { </span><span class="comment">// replaces utf8_decode()<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$trans </span><span class="keyword">= array(</span><span class="string">""</span><span class="keyword">=&gt;</span><span class="string">"¤"</span><span class="keyword">, </span><span class="string">"? "</span><span class="keyword">=&gt;</span><span class="string">"|"</span><span class="keyword">, </span><span class="string">"?"</span><span class="keyword">=&gt;</span><span class="string">"¨"</span><span class="keyword">, </span><span class="string">"?"</span><span class="keyword">=&gt;</span><span class="string">"′"</span><span class="keyword">, </span><span class="string">"?"</span><span class="keyword">=&gt;</span><span class="string">"?"</span><span class="keyword">, </span><span class="string">"?"</span><span class="keyword">=&gt;</span><span class="string">"?"</span><span class="keyword">, </span><span class="string">"?"</span><span class="keyword">=&gt;</span><span class="string">"?"</span><span class="keyword">, </span><span class="string">"?"</span><span class="keyword">=&gt;</span><span class="string">"?"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$wrong_utf8str </span><span class="keyword">= </span><span class="default">strtr</span><span class="keyword">(</span><span class="default">$utf8str</span><span class="keyword">, </span><span class="default">$trans</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$latin9str </span><span class="keyword">= </span><span class="default">utf8_decode</span><span class="keyword">(</span><span class="default">$wrong_utf8str</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$latin9str</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
(Note: the PHP manual is served as ISO-8859-1, but many of the bytes used here have no meaning in ISO-8859-1, so they'll probably be displayed as Windows-1252 if your using Windows, or garbage otherwise. Just copy the bytes!)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="37747""></a>
  <div class="note">
   <strong class="user">gto at interia dot pl</strong>
   <a href="#37747" class="date">25-Nov-2003 04:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Correction to function converting utf82iso88592 and iso88592tutf8.<br />
Janusz forgot about "&amp;#324;", and "&amp;#380;" exchanged from "&amp;#378;" here and there.<br />
<br />
GTo<br />
<br />
function utf82iso88592($tekscik) {<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace("\xC4\x85", "&amp;#261;", $tekscik);<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace("\xC4\x84", '&amp;#260;', $tekscik);<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace("\xC4\x87", '&amp;#263;', $tekscik);<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace("\xC4\x86", '&amp;#262;', $tekscik);<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace("\xC4\x99", '&amp;#281;', $tekscik);<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace("\xC4\x98", '&amp;#280;', $tekscik);<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace("\xC5\x82", '&amp;#322;', $tekscik);<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace("\xC5\x81", '&amp;#321;', $tekscik);<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace("\xC5\x84", '&amp;#324;', $tekscik);&nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace("\xC5\x83", '&amp;#323;', $tekscik);<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace("\xC3\xB3", '?', $tekscik);<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace("\xC3\x93", '?', $tekscik);<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace("\xC5\x9B", '&amp;#347;', $tekscik);<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace("\xC5\x9A", '&amp;#346;', $tekscik);<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace("\xC5\xBC", '&amp;#380;', $tekscik);<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace("\xC5\xBB", '&amp;#379;', $tekscik);<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace("\xC5\xBA", '&amp;#378;', $tekscik);<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace("\xC5\xB9", '&amp;#377;', $tekscik);<br />
&nbsp;&nbsp; &nbsp; return $tekscik;<br />
} // utf82iso88592<br />
<br />
function iso885922utf8($tekscik) {<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace("&amp;#261;", "\xC4\x85", $tekscik);<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace('&amp;#260;', "\xC4\x84", $tekscik);<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace('&amp;#263;', "\xC4\x87", $tekscik);<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace('&amp;#262;', "\xC4\x86", $tekscik);<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace('&amp;#281;', "\xC4\x99", $tekscik);<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace('&amp;#280;', "\xC4\x98", $tekscik);<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace('&amp;#322;', "\xC5\x82", $tekscik);<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace('&amp;#321;', "\xC5\x81", $tekscik);<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace('&amp;#324;', "\xC5\x84", $tekscik);<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace('&amp;#323;',"\xC5\x83", $tekscik);<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace('?', "\xC3\xB3", $tekscik);<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace('?', "\xC3\x93", $tekscik);<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace('&amp;#347;', "\xC5\x9B", $tekscik);<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace('&amp;#346;', "\xC5\x9A", $tekscik);<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace('&amp;#380;', "\xC5\xBC", $tekscik);<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace('&amp;#379;', "\xC5\xBB", $tekscik);<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace('&amp;#378;', "\xC5\xBA", $tekscik);<br />
&nbsp;&nbsp; &nbsp; $tekscik = str_replace('&amp;#377;', "\xC5\xB9", $tekscik);&nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; return $tekscik;<br />
} // iso885922utf8</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="37694""></a>
  <div class="note">
   <strong class="user">nospam at jra dot nu</strong>
   <a href="#37694" class="date">23-Nov-2003 12:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There is an error in the 'smart_utf8_decode' function posted by ' goran_johansson' below. It should look like this:
<br />

<br />
function smart_utf8_decode($in_str)
<br />
{
<br />
&nbsp;&nbsp;&nbsp; // Replace ? with a unique string
<br />
&nbsp;&nbsp;&nbsp; $new_str = str_replace("?", "q0u0e0s0t0i0o0n", $in_str);
<br />

<br />
&nbsp;&nbsp;&nbsp; // Try the utf8_decode
<br />
&nbsp;&nbsp;&nbsp; $new_str=utf8_decode($new_str);
<br />

<br />
&nbsp;&nbsp;&nbsp; // if it contains ? marks
<br />
&nbsp;&nbsp;&nbsp; if (strpos($new_str,"?") !== false)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // Something went wrong, set new_str to the original string.
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $new_str=$in_str;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; else
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // If not then all is well, put the ?-marks back where is belongs
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $new_str = str_replace("q0u0e0s0t0i0o0n", "?", $new_str);
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; return $new_str;
<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="36870""></a>
  <div class="note">
   <strong class="user">janusz dot s at remove_this dot and_this dot poczta dot fm</strong>
   <a href="#36870" class="date">25-Oct-2003 05:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here are functions to PROPERLY de/encode Unicode (UTF-8) string to/from ISO-8859-2 (Polish character set).<br />
<br />
Regards,<br />
Janusz<br />
<br />
function utf82iso88592($tekscik) {<br />
&nbsp;$tekscik = str_replace("\xC4\x85", "?", $tekscik);<br />
&nbsp;$tekscik = str_replace("\xC4\x84", '?', $tekscik);<br />
&nbsp;$tekscik = str_replace("\xC4\x87", '?', $tekscik);<br />
&nbsp;$tekscik = str_replace("\xC4\x86", '?', $tekscik);<br />
&nbsp;$tekscik = str_replace("\xC4\x99", '?', $tekscik);<br />
&nbsp;$tekscik = str_replace("\xC4\x98", '?', $tekscik);<br />
&nbsp;$tekscik = str_replace("\xC5\x82", '?', $tekscik);<br />
&nbsp;$tekscik = str_replace("\xC5\x81", '?', $tekscik);<br />
&nbsp;$tekscik = str_replace("\xC3\xB3", '?', $tekscik);<br />
&nbsp;$tekscik = str_replace("\xC3\x93", '?', $tekscik);<br />
&nbsp;$tekscik = str_replace("\xC5\x9B", '?', $tekscik);<br />
&nbsp;$tekscik = str_replace("\xC5\x9A", '?', $tekscik);<br />
&nbsp;$tekscik = str_replace("\xC5\xBC", '?', $tekscik);<br />
&nbsp;$tekscik = str_replace("\xC5\xBB", '?', $tekscik);<br />
&nbsp;$tekscik = str_replace("\xC5\xBA", '?', $tekscik);<br />
&nbsp;$tekscik = str_replace("\xC5\xB9", '?', $tekscik);<br />
&nbsp;return $tekscik;<br />
} // utf82iso88592<br />
<br />
function iso885922utf8($tekscik) {<br />
&nbsp;$tekscik = str_replace("?", "\xC4\x85", $tekscik);<br />
&nbsp;$tekscik = str_replace('?', "\xC4\x84", $tekscik);<br />
&nbsp;$tekscik = str_replace('?', "\xC4\x87", $tekscik);<br />
&nbsp;$tekscik = str_replace('?', "\xC4\x86", $tekscik);<br />
&nbsp;$tekscik = str_replace('?', "\xC4\x99", $tekscik);<br />
&nbsp;$tekscik = str_replace('?', "\xC4\x98", $tekscik);<br />
&nbsp;$tekscik = str_replace('?', "\xC5\x82", $tekscik);<br />
&nbsp;$tekscik = str_replace('?', "\xC5\x81", $tekscik);<br />
&nbsp;$tekscik = str_replace('?', "\xC3\xB3", $tekscik);<br />
&nbsp;$tekscik = str_replace('?', "\xC3\x93", $tekscik);<br />
&nbsp;$tekscik = str_replace('?', "\xC5\x9B", $tekscik);<br />
&nbsp;$tekscik = str_replace('?', "\xC5\x9A", $tekscik);<br />
&nbsp;$tekscik = str_replace('?', "\xC5\xBC", $tekscik);<br />
&nbsp;$tekscik = str_replace('?', "\xC5\xBB", $tekscik);<br />
&nbsp;$tekscik = str_replace('?', "\xC5\xBA", $tekscik);<br />
&nbsp;$tekscik = str_replace('?', "\xC5\xB9", $tekscik);<br />
&nbsp;return $tekscik;<br />
} // iso885922utf8</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="35443""></a>
  <div class="note">
   <strong class="user">bn2 (bn2 at ukr dot net)</strong>
   <a href="#35443" class="date">01-Sep-2003 05:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Function to decode uft8 to win-1251 (russian) charset. Don't support ukrainian letters. Support only 2-byte coding.<br />
<br />
function utf8win1251($s){<br />
$out="";$c1="";$byte2=false;<br />
for ($c=0;$c&lt;strlen($s);$c++){<br />
$i=ord($s[$c]);<br />
if ($i&lt;=127) $out.=$s[$c];<br />
if ($byte2){<br />
$new_c2=($c1&amp;3)*64+($i&amp;63);<br />
$new_c1=($c1&gt;&gt;2)&amp;5;<br />
$new_i=$new_c1*256+$new_c2;<br />
if ($new_i==1025) $out_i=168; else<br />
if ($new_i==1105) $out_i=184; else $out_i=$new_i-848;<br />
$out.=chr($out_i);<br />
$byte2=false;}<br />
if (($i&gt;&gt;5)==6) {$c1=$i;$byte2=true;}<br />
}<br />
return $out;}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="35067""></a>
  <div class="note">
   <strong class="user">morris_hirsch at hotmail dot com</strong>
   <a href="#35067" class="date">18-Aug-2003 06:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Be aware that utf8_decode can not properly store ''wide'' code entities which have a numeric value too big for a byte.<br />
<br />
This function may help you.&nbsp; It converts utf8 to strict ASCII with no high-bit codes, they are all written as numerics.<br />
<br />
// UTF-8 encoding<br />
// bytes bits representation<br />
// 1&nbsp;&nbsp; 7&nbsp; 0bbbbbbb<br />
// 2&nbsp; 11&nbsp; 110bbbbb 10bbbbbb<br />
// 3&nbsp; 16&nbsp; 1110bbbb 10bbbbbb 10bbbbbb<br />
// 4&nbsp; 21&nbsp; 11110bbb 10bbbbbb 10bbbbbb 10bbbbbb<br />
// Each b represents a bit that can be used to store character data.<br />
<br />
// input CANNOT have single byte upper half extended ascii codes<br />
<br />
function numeric_entify_utf8 ($utf8_string) {<br />
<br />
&nbsp; $out = "";<br />
&nbsp; $ns = strlen ($utf8_string);<br />
&nbsp; for ($nn = 0; $nn &lt; $ns; $nn++) {<br />
&nbsp;&nbsp;&nbsp; $ch = $utf8_string [$nn];<br />
&nbsp;&nbsp;&nbsp; $ii = ord ($ch);<br />
<br />
//1 7 0bbbbbbb (127)<br />
<br />
&nbsp;&nbsp;&nbsp; if ($ii &lt; 128) $out .= $ch;<br />
<br />
//2 11 110bbbbb 10bbbbbb (2047)<br />
<br />
&nbsp;&nbsp; else if ($ii &gt;&gt;5 == 6) {<br />
&nbsp; $b1 = ($ii &amp; 31);<br />
<br />
&nbsp; $nn++;<br />
&nbsp;&nbsp; $ch = $utf8_string [$nn];<br />
&nbsp;&nbsp;&nbsp; $ii = ord ($ch);<br />
&nbsp; $b2 = ($ii &amp; 63);<br />
<br />
&nbsp; $ii = ($b1 * 64) + $b2;<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; $ent = sprintf ("&amp;#%d;", $ii);<br />
&nbsp;&nbsp; &nbsp;&nbsp; $out .= $ent;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
//3 16 1110bbbb 10bbbbbb 10bbbbbb<br />
<br />
&nbsp;&nbsp; else if ($ii &gt;&gt;4 == 14) {<br />
&nbsp; $b1 = ($ii &amp; 31);<br />
<br />
&nbsp; $nn++;<br />
&nbsp;&nbsp; $ch = $utf8_string [$nn];<br />
&nbsp;&nbsp;&nbsp; $ii = ord ($ch);<br />
&nbsp; $b2 = ($ii &amp; 63);<br />
<br />
&nbsp; $nn++;<br />
&nbsp;&nbsp; $ch = $utf8_string [$nn];<br />
&nbsp;&nbsp;&nbsp; $ii = ord ($ch);<br />
&nbsp; $b3 = ($ii &amp; 63);<br />
<br />
&nbsp; $ii = ((($b1 * 64) + $b2) * 64) + $b3;<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; $ent = sprintf ("&amp;#%d;", $ii);<br />
&nbsp;&nbsp; &nbsp;&nbsp; $out .= $ent;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
//4 21 11110bbb 10bbbbbb 10bbbbbb 10bbbbbb<br />
<br />
&nbsp;&nbsp; else if ($ii &gt;&gt;3 == 30) {<br />
&nbsp; $b1 = ($ii &amp; 31);<br />
<br />
&nbsp; $nn++;<br />
&nbsp;&nbsp; $ch = $utf8_string [$nn];<br />
&nbsp;&nbsp;&nbsp; $ii = ord ($ch);<br />
&nbsp; $b2 = ($ii &amp; 63);<br />
<br />
&nbsp; $nn++;<br />
&nbsp;&nbsp; $ch = $utf8_string [$nn];<br />
&nbsp;&nbsp;&nbsp; $ii = ord ($ch);<br />
&nbsp; $b3 = ($ii &amp; 63);<br />
<br />
&nbsp; $nn++;<br />
&nbsp;&nbsp; $ch = $utf8_string [$nn];<br />
&nbsp;&nbsp;&nbsp; $ii = ord ($ch);<br />
&nbsp; $b4 = ($ii &amp; 63);<br />
<br />
&nbsp; $ii = ((((($b1 * 64) + $b2) * 64) + $b3) * 64) + $b4;<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; $ent = sprintf ("&amp;#%d;", $ii);<br />
&nbsp;&nbsp; &nbsp;&nbsp; $out .= $ent;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp; }<br />
&nbsp; return $out;<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="31815""></a>
  <div class="note">
   <strong class="user">johan dot andersson at strateg dot se</strong>
   <a href="#31815" class="date">05-May-2003 10:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A simple way to convert utf-8 encoded strings... <br />
(PHP 4 &gt;= 4.3.0)<br />
<br />
<span class="default">&lt;?php<br />
$newstring </span><span class="keyword">= </span><span class="default">html_entity_decode</span><span class="keyword">(</span><span class="default">htmlentities</span><span class="keyword">(</span><span class="default">$utf8_string</span><span class="keyword">, </span><span class="default">ENT_COMPAT</span><span class="keyword">, </span><span class="string">'UTF-8'</span><span class="keyword">));<br />
</span><span class="default">?&gt;<br />
</span><br />
(For 4.1.0 &gt;= PHP &lt; 4.3.0 use this function instead of html_entity_decode)<br />
<br />
<span class="default">&lt;?php <br />
</span><span class="keyword">function </span><span class="default">unhtmlentities </span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$trans_tbl </span><span class="keyword">= </span><span class="default">get_html_translation_table </span><span class="keyword">(</span><span class="default">HTML_ENTITIES</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$trans_tbl </span><span class="keyword">= </span><span class="default">array_flip </span><span class="keyword">(</span><span class="default">$trans_tbl</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">strtr </span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">, </span><span class="default">$trans_tbl</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">$newstring </span><span class="keyword">= </span><span class="default">unhtmlentities</span><span class="keyword">(</span><span class="default">htmlentities</span><span class="keyword">(</span><span class="default">$utf8_string</span><span class="keyword">, </span><span class="default">ENT_COMPAT</span><span class="keyword">, </span><span class="string">'UTF-8'</span><span class="keyword">));<br />
</span><span class="default">?&gt;<br />
</span><br />
//Johan</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="29757""></a>
  <div class="note">
   
   <a href="#29757" class="date">24-Feb-2003 03:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Oups, this is the non bugged version :)<br />
<br />
Well sometimes you need to store a utf-8 string in a database table column with a fixed size.<br />
Here is a function that fix a string which has been broken (by a substr for example) in a middle of a utf-8 char sequence.<br />
<br />
function FixUtf8BrokenString($Desc)<br />
{<br />
&nbsp;// UTF-8 encoding<br />
&nbsp;// bytes : representation<br />
&nbsp;// 1&nbsp; &nbsp;&nbsp; : 0bbbbbbb<br />
&nbsp;// 2&nbsp; &nbsp; : 110bbbbb 10bbbbbb<br />
&nbsp;// 3&nbsp; &nbsp;&nbsp; : 1110bbbb 10bbbbbb 10bbbbbb<br />
&nbsp;// 4&nbsp; &nbsp;&nbsp; : 11110bbb 10bbbbbb 10bbbbbb 10bbbbbb<br />
&nbsp;// to see if a string is broken in middle of a utf8 char<br />
&nbsp;// we search for last byte encoding size of utf-8 char<br />
&nbsp;// if number of last bytes in string is lower than encoding size<br />
&nbsp;// we remove those last bytes<br />
<br />
&nbsp;// if last byte is ord &lt; 128, ok. we return !<br />
&nbsp;if (ord($Desc[strlen($Desc) - 1]) &lt; (0x80))<br />
&nbsp;&nbsp; return $Desc<br />
<br />
&nbsp;// loop for finding byte encoding size<br />
&nbsp;$nbbytes = 1;<br />
&nbsp;while (ord($Desc[strlen($Desc) - $nbbytes]) &gt; 0x7F)<br />
&nbsp;{<br />
&nbsp;&nbsp; if (ord($Desc[strlen($Desc) - $nbbytes]) &gt; 0xBF)<br />
&nbsp;&nbsp; &nbsp; break;<br />
&nbsp;&nbsp; $nbbytes++;<br />
&nbsp;}<br />
<br />
&nbsp; // check if byte encoding size is encoding a size of 4 bytes<br />
&nbsp; if ((ord($Desc[strlen($Desc) - $nbbytes]) &gt; 0xF0) &amp;&amp; ($nbbytes == 4))<br />
&nbsp;&nbsp;&nbsp; return $Desc;<br />
&nbsp; // check if byte encoding size is encoding a size of 3 bytes<br />
&nbsp; if ((ord($Desc[strlen($Desc) - $nbbytes]) &gt; 0xE0) &amp;&amp; ($nbbytes == 3))<br />
&nbsp;&nbsp;&nbsp; return $Desc;<br />
&nbsp; // check if byte encoding size is encoding a size of 2 bytes<br />
&nbsp; if ((ord($Desc[strlen($Desc) - $nbbytes]) &gt; 0xC0) &amp;&amp; ($nbbytes == 2))<br />
&nbsp;&nbsp;&nbsp; return $Desc;<br />
&nbsp; // then this is the case where string is badly broken, we remove last bytes<br />
&nbsp; return substr($Desc, 0, -$nbbytes);<br />
}<br />
<br />
$str = "Ekonomi_ve_\xc4\xb0\xc5\x9f_D\xc3\xbcnyas\xc4\xb1";<br />
$broken = substr($str, 0, 12);<br />
$fixed = FixUtf8BrokenString($broken);<br />
<br />
echo "$str&lt;hr&gt;$fixed&lt;hr&gt;$broken&lt;hr&gt;";<br />
<br />
Sebastien Meudec.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="27778""></a>
  <div class="note">
   
   <a href="#27778" class="date">18-Dec-2002 06:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
addition to above entrie:<br />
<br />
it does not mean "when it comes to a '='" but when it comes to a "0"</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="27776""></a>
  <div class="note">
   <strong class="user">mittag - -add- -marcmittag- -dot- -de</strong>
   <a href="#27776" class="date">18-Dec-2002 05:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The above function does not work entirely correct. It comes to problems, if there is a leading "=" in one of the two Strings it produces and glues out of the two bytes of the unicode letter.<br />
<br />
The following works:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">//Convert Unicode to ASCII + Entities<br />
</span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$DOCUMENT_ROOT</span><span class="keyword">.</span><span class="string">"/your_unicode_text.txt"</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">);<br />
while ( !</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">) )<br />
{ </span><span class="default">$string </span><span class="keyword">= </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">1000</span><span class="keyword">);<br />
<br />
&nbsp;</span><span class="default">$utf2html_string </span><span class="keyword">.= </span><span class="default">$string</span><span class="keyword">;<br />
}<br />
</span><span class="default">$string2 </span><span class="keyword">= </span><span class="default">$utf2html_string</span><span class="keyword">;<br />
</span><span class="default">fclose </span><span class="keyword">( </span><span class="default">$fp</span><span class="keyword">);<br />
<br />
function </span><span class="default">utf2html </span><span class="keyword">()<br />
{<br />
global </span><span class="default">$utf2html_string</span><span class="keyword">;<br />
<br />
</span><span class="default">$utf2html_retstr </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
&nbsp;for (</span><span class="default">$utf2html_p</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$utf2html_p</span><span class="keyword">&lt;</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$utf2html_string</span><span class="keyword">); </span><span class="default">$utf2html_p</span><span class="keyword">++) {<br />
&nbsp;</span><span class="default">$utf2html_c </span><span class="keyword">= </span><span class="default">substr </span><span class="keyword">(</span><span class="default">$utf2html_string</span><span class="keyword">, </span><span class="default">$utf2html_p</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;</span><span class="default">$utf2html_c1 </span><span class="keyword">= </span><span class="default">ord </span><span class="keyword">(</span><span class="default">$utf2html_c</span><span class="keyword">);<br />
&nbsp; if (</span><span class="default">$utf2html_c1</span><span class="keyword">&gt;&gt;</span><span class="default">5 </span><span class="keyword">== </span><span class="default">6</span><span class="keyword">) {</span><span class="comment">// 110x xxxx, 110 prefix for 2 bytes unicode<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$utf2html_p</span><span class="keyword">++;<br />
&nbsp;&nbsp; </span><span class="default">$utf2html_t </span><span class="keyword">= </span><span class="default">substr </span><span class="keyword">(</span><span class="default">$utf2html_string</span><span class="keyword">, </span><span class="default">$utf2html_p</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$utf2html_c2 </span><span class="keyword">= </span><span class="default">ord </span><span class="keyword">(</span><span class="default">$utf2html_t</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">$utf2html_c1 </span><span class="keyword">&amp;= </span><span class="default">31</span><span class="keyword">; </span><span class="comment">// remove the 3 bit two bytes prefix<br />
&nbsp;&nbsp; </span><span class="default">$utf2html_c2 </span><span class="keyword">&amp;= </span><span class="default">63</span><span class="keyword">; </span><span class="comment">// remove the 2 bit trailing byte prefix<br />
&nbsp;&nbsp; </span><span class="default">$utf2html_c2 </span><span class="keyword">|= ((</span><span class="default">$utf2html_c1 </span><span class="keyword">&amp; </span><span class="default">3</span><span class="keyword">) &lt;&lt; </span><span class="default">6</span><span class="keyword">); </span><span class="comment">// last 2 bits of c1 become first 2 of c2<br />
&nbsp;&nbsp; </span><span class="default">$utf2html_c1 </span><span class="keyword">&gt;&gt;= </span><span class="default">2</span><span class="keyword">; </span><span class="comment">// c1 shifts 2 to the right<br />
&nbsp;&nbsp; </span><span class="default">$a </span><span class="keyword">= </span><span class="default">dechex</span><span class="keyword">(</span><span class="default">$utf2html_c1</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">$a </span><span class="keyword">= </span><span class="default">str_pad</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">, </span><span class="string">"0"</span><span class="keyword">, </span><span class="default">STR_PAD_LEFT</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">$b </span><span class="keyword">= </span><span class="default">dechex</span><span class="keyword">(</span><span class="default">$utf2html_c2</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">$b </span><span class="keyword">= </span><span class="default">str_pad</span><span class="keyword">(</span><span class="default">$b</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">, </span><span class="string">"0"</span><span class="keyword">, </span><span class="default">STR_PAD_LEFT</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; </span><span class="default">$utf2html_n_neu </span><span class="keyword">= </span><span class="default">$a</span><span class="keyword">.</span><span class="default">$b</span><span class="keyword">;<br />
&nbsp;&nbsp; </span><span class="default">$utf2html_n_neu_speicher </span><span class="keyword">= </span><span class="default">$utf2html_n_neu</span><span class="keyword">;<br />
&nbsp;&nbsp; </span><span class="default">$utf2html_n_neu </span><span class="keyword">= </span><span class="string">"&amp;#x"</span><span class="keyword">.</span><span class="default">$utf2html_n_neu</span><span class="keyword">.</span><span class="string">";"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; <br />
&nbsp;</span><span class="default">$utf2html_retstr </span><span class="keyword">.= </span><span class="default">$utf2html_n_neu</span><span class="keyword">;<br />
&nbsp;<br />
&nbsp; }<br />
&nbsp; else {<br />
&nbsp;&nbsp; </span><span class="default">$utf2html_retstr </span><span class="keyword">.= </span><span class="default">$utf2html_c</span><span class="keyword">;<br />
&nbsp; }<br />
&nbsp;}<br />
&nbsp;echo </span><span class="default">$utf2html_retstr</span><span class="keyword">;<br />
&nbsp;</span><span class="comment">//return $utf2html_retstr;<br />
<br />
</span><span class="keyword">}<br />
<br />
</span><span class="default">utf2html</span><span class="keyword">();<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="27426""></a>
  <div class="note">
   <strong class="user">wielspm at xs4all dot nl</strong>
   <a href="#27426" class="date">05-Dec-2002 06:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is a function I made to convert all 2 byte utf in a &amp;#xxx; form:<br />
<br />
function utf2html ($utf2html_string)<br />
{<br />
&nbsp; $utf2html_retstr = "";<br />
&nbsp; for ($utf2html_p=0; $utf2html_p&lt;strlen($utf2html_string); $utf2html_p++):<br />
&nbsp;&nbsp;&nbsp; $utf2html_c = substr ($utf2html_string, $utf2html_p, 1);<br />
&nbsp;&nbsp;&nbsp; $utf2html_c1 = ord ($utf2html_c);<br />
&nbsp;&nbsp;&nbsp; if ($utf2html_c1&gt;&gt;5 == 6): // 110x xxxx, 110 prefix for 2 bytes unicode<br />
&nbsp;&nbsp; &nbsp;&nbsp; $utf2html_p++;<br />
&nbsp;&nbsp; &nbsp; &nbsp; $utf2html_t = substr ($utf2html_string, $utf2html_p, 1);<br />
&nbsp;&nbsp; &nbsp;&nbsp; $utf2html_c2 = ord ($utf2html_t);<br />
&nbsp;&nbsp; &nbsp;&nbsp; $utf2html_c1 &amp;= 31; // remove the 3 bit two bytes prefix<br />
&nbsp;&nbsp; &nbsp;&nbsp; $utf2html_c2 &amp;= 63; // remove the 2 bit trailing byte prefix<br />
&nbsp;&nbsp; &nbsp;&nbsp; $utf2html_c2 |= (($utf2html_c1 &amp; 3) &lt;&lt; 6); // last 2 bits of c1 become first 2 of c2<br />
&nbsp;&nbsp; &nbsp;&nbsp; $utf2html_c1 &gt;&gt;= 2; // c1 shifts 2 to the right<br />
&nbsp;&nbsp; &nbsp; &nbsp; $utf2html_n = dechex($utf2html_c1).dechex($utf2html_c2);<br />
&nbsp;&nbsp; &nbsp;&nbsp; $utf2html_retstr .= sprintf ("&amp;#%03d;", hexdec($utf2html_n));<br />
&nbsp;&nbsp;&nbsp; else:<br />
&nbsp;&nbsp; &nbsp;&nbsp; $utf2html_retstr .= $utf2html_c;<br />
&nbsp;&nbsp;&nbsp; endif;<br />
&nbsp; endfor;<br />
&nbsp; return $utf2html_retstr;<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="24747""></a>
  <div class="note">
   
   <a href="#24747" class="date">27-Aug-2002 09:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
echo utf8_decode(<br />
"Ekonomi_ve_\xc4\xb0\xc5\x9f_D\xc3xbcnyas\xc4\xb1");<br />
<br />
Outputs: Ekonomi_ve_??_D?nyas?<br />
<br />
This is not a bug. For example "\xc4\xb0" is decoded like this:<br />
0xC4 = 110 00100 (110 prefix for 2 bytes)<br />
0xB0 = 10 110000 (10 for trailing byte)<br />
Character = 001 0011 0000 = 0x130<br />
<br />
This U+0130 Unicode character is not defined in ISO-8859-1<br />
(where all codes are below 0x100), so the utf8_decode() function<br />
cannot represent it, and inserts a '?' replacement character<br />
in the result string...<br />
<br />
There's no alternative in the utf8_decode() function<br />
which returns a string made of<br />
single-byte characters.<br />
<br />
PHP really lacks a datatype for UTF-16 (a.k.a. Unicode) strings,<br />
unlike Java whose strings are always natively encoded<br />
with UTF-16...<br />
<br />
The alternative for PHP would be that it allows inserting SGML<br />
character entities. In the above example, it could return<br />
"&amp;#x130;" when decoding "\xc4\xb0".<br />
<br />
May be a future version of PHP could make strings using<br />
double-byte UTF-16 encoding, so that Unicode could be natively<br />
supported, but this would require adding new functions to<br />
define the behavior of I/O functions to provide external<br />
encode/decode capabilities when sending Unicode strings to<br />
a file stream, or with echo and print builtins for the<br />
standard input and output streams:<br />
<br />
- What would be the semantic of fwrite($fp, $string)<br />
if $string can contain any UTF-16 characters ?<br />
- Should fwrite() truncate the highest byte of each UTF-16<br />
character, letting the user anticipating this truncation by<br />
performing the conversion to UTF-8 or character entities himself ?<br />
- Should the user be able to specify an encoder/decoder object<br />
used by all I/O operations performed on a file ?<br />
<br />
For example:<br />
- set_encoder($fp, 'utf8_encode') would define the PHP function<br />
to call to encode a string.<br />
- set_encoder($fp) or set_encoder($fp, null) would restore the<br />
default (stripping) encoder...<br />
- then fwrite($fp, $string) would return the number of bytes<br />
written to the stream, which may be larger than the length of<br />
$string...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="19531""></a>
  <div class="note">
   <strong class="user">ronen at greyzone dot com</strong>
   <a href="#19531" class="date">02-Mar-2002 02:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The following function will take a utf-8 encoded string and convert it to Unicode entities (the format is &amp;#nnn; or &amp;#nnnnn; with n={0..9} ).&nbsp; Most browsers will display Unicode entities regardless of the encoding of the page.&nbsp; Otherwise try CHARSET=gb2312 to make sure the entities display correctly.&nbsp; This works well with IE and Mozilla (tested with Mozilla 0.9.8 for X-Windos).
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="comment">/**
<br />
* takes a string of utf-8 encoded characters and converts it to a string of unicode entities
<br />
* each unicode entitiy has the form &amp;#nnnnn; n={0..9} and can be displayed by utf-8 supporting
<br />
* browsers
<br />
* @param $source string encoded using utf-8 [STRING]
<br />
* @return string of unicode entities [STRING]
<br />
* @access public
<br />
*/
<br />
</span><span class="keyword">function </span><span class="default">utf8ToUnicodeEntities </span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// array used to figure what number to decrement from character order value 
<br />
&nbsp;&nbsp;&nbsp; // according to number of characters used to map unicode to ascii by utf-8
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$decrement</span><span class="keyword">[</span><span class="default">4</span><span class="keyword">] = </span><span class="default">240</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$decrement</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">] = </span><span class="default">224</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$decrement</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">] = </span><span class="default">192</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$decrement</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] = </span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// the number of bits to shift each charNum by
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$shift</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">] = </span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$shift</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">] = </span><span class="default">6</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$shift</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">][</span><span class="default">1</span><span class="keyword">] = </span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$shift</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">] = </span><span class="default">12</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$shift</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">][</span><span class="default">1</span><span class="keyword">] = </span><span class="default">6</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$shift</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">][</span><span class="default">2</span><span class="keyword">] = </span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$shift</span><span class="keyword">[</span><span class="default">4</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">] = </span><span class="default">18</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$shift</span><span class="keyword">[</span><span class="default">4</span><span class="keyword">][</span><span class="default">1</span><span class="keyword">] = </span><span class="default">12</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$shift</span><span class="keyword">[</span><span class="default">4</span><span class="keyword">][</span><span class="default">2</span><span class="keyword">] = </span><span class="default">6</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$shift</span><span class="keyword">[</span><span class="default">4</span><span class="keyword">][</span><span class="default">3</span><span class="keyword">] = </span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$pos </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$len </span><span class="keyword">= </span><span class="default">strlen </span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$encodedString </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; while (</span><span class="default">$pos </span><span class="keyword">&lt; </span><span class="default">$len</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$asciiPos </span><span class="keyword">= </span><span class="default">ord </span><span class="keyword">(</span><span class="default">substr </span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">, </span><span class="default">$pos</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">));
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ((</span><span class="default">$asciiPos </span><span class="keyword">&gt;= </span><span class="default">240</span><span class="keyword">) &amp;&amp; (</span><span class="default">$asciiPos </span><span class="keyword">&lt;= </span><span class="default">255</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// 4 chars representing one unicode character
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$thisLetter </span><span class="keyword">= </span><span class="default">substr </span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">, </span><span class="default">$pos</span><span class="keyword">, </span><span class="default">4</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pos </span><span class="keyword">+= </span><span class="default">4</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else if ((</span><span class="default">$asciiPos </span><span class="keyword">&gt;= </span><span class="default">224</span><span class="keyword">) &amp;&amp; (</span><span class="default">$asciiPos </span><span class="keyword">&lt;= </span><span class="default">239</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// 3 chars representing one unicode character
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$thisLetter </span><span class="keyword">= </span><span class="default">substr </span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">, </span><span class="default">$pos</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pos </span><span class="keyword">+= </span><span class="default">3</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else if ((</span><span class="default">$asciiPos </span><span class="keyword">&gt;= </span><span class="default">192</span><span class="keyword">) &amp;&amp; (</span><span class="default">$asciiPos </span><span class="keyword">&lt;= </span><span class="default">223</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// 2 chars representing one unicode character
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$thisLetter </span><span class="keyword">= </span><span class="default">substr </span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">, </span><span class="default">$pos</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pos </span><span class="keyword">+= </span><span class="default">2</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// 1 char (lower ascii)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$thisLetter </span><span class="keyword">= </span><span class="default">substr </span><span class="keyword">(</span><span class="default">$source</span><span class="keyword">, </span><span class="default">$pos</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pos </span><span class="keyword">+= </span><span class="default">1</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// process the string representing the letter to a unicode entity
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$thisLen </span><span class="keyword">= </span><span class="default">strlen </span><span class="keyword">(</span><span class="default">$thisLetter</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$thisPos </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$decimalCode </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while (</span><span class="default">$thisPos </span><span class="keyword">&lt; </span><span class="default">$thisLen</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$thisCharOrd </span><span class="keyword">= </span><span class="default">ord </span><span class="keyword">(</span><span class="default">substr </span><span class="keyword">(</span><span class="default">$thisLetter</span><span class="keyword">, </span><span class="default">$thisPos</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">));
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$thisPos </span><span class="keyword">== </span><span class="default">0</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$charNum </span><span class="keyword">= </span><span class="default">intval </span><span class="keyword">(</span><span class="default">$thisCharOrd </span><span class="keyword">- </span><span class="default">$decrement</span><span class="keyword">[</span><span class="default">$thisLen</span><span class="keyword">]);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$decimalCode </span><span class="keyword">+= (</span><span class="default">$charNum </span><span class="keyword">&lt;&lt; </span><span class="default">$shift</span><span class="keyword">[</span><span class="default">$thisLen</span><span class="keyword">][</span><span class="default">$thisPos</span><span class="keyword">]);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$charNum </span><span class="keyword">= </span><span class="default">intval </span><span class="keyword">(</span><span class="default">$thisCharOrd </span><span class="keyword">- </span><span class="default">128</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$decimalCode </span><span class="keyword">+= (</span><span class="default">$charNum </span><span class="keyword">&lt;&lt; </span><span class="default">$shift</span><span class="keyword">[</span><span class="default">$thisLen</span><span class="keyword">][</span><span class="default">$thisPos</span><span class="keyword">]);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$thisPos</span><span class="keyword">++;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$thisLen </span><span class="keyword">== </span><span class="default">1</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$encodedLetter </span><span class="keyword">= </span><span class="string">"&amp;#"</span><span class="keyword">. </span><span class="default">str_pad</span><span class="keyword">(</span><span class="default">$decimalCode</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">, </span><span class="string">"0"</span><span class="keyword">, </span><span class="default">STR_PAD_LEFT</span><span class="keyword">) . </span><span class="string">';'</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$encodedLetter </span><span class="keyword">= </span><span class="string">"&amp;#"</span><span class="keyword">. </span><span class="default">str_pad</span><span class="keyword">(</span><span class="default">$decimalCode</span><span class="keyword">, </span><span class="default">5</span><span class="keyword">, </span><span class="string">"0"</span><span class="keyword">, </span><span class="default">STR_PAD_LEFT</span><span class="keyword">) . </span><span class="string">';'</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$encodedString </span><span class="keyword">.= </span><span class="default">$encodedLetter</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$encodedString</span><span class="keyword">;
<br />
}
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Ronen.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
