<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>函数</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="control-structures.goto.html">? goto</a></li>
      <li style="float: right;"><a href="functions.user-defined.html">用户自定义函数 ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="langref.html">语言参考</a></li>
    <li>函数</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="language.functions" class="chapter">
  <h1>函数</h1>
<h2>Table of Contents</h2><ul class="chunklist chunklist_chapter"><li><a href="functions.user-defined.html">用户自定义函数</a></li><li><a href="functions.arguments.html">函数的参数</a></li><li><a href="functions.returning-values.html">返回值</a></li><li><a href="functions.variable-functions.html">可变函数</a></li><li><a href="functions.internal.html">内部（内置）函数</a></li><li><a href="functions.anonymous.html">匿名函数</a></li></ul>


  

  

  

  

  

    

 </div>
<div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="87519""></a>
  <div class="note">
   <strong class="user">info at warpdesign dot fr</strong>
   <a href="#87519" class="date">08-Dec-2008 09:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note about function names:
<br />
--
<br />

<br />
According to the specified regular expression ([a-zA-Z_\x7f-\xff][a-zA-Z0-9_\x7f-\xff]*), a function name like this one is valid:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default"></span><span class="keyword">()
<br />
{
<br />
&nbsp;&nbsp; echo </span><span class="string">'foo'</span><span class="keyword">;
<br />
}
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
And PHP interpreter correctly interprets the function. However some parsers (ex: PDT/Eclipse) does not see this as a valid function name, and only accept function names starting with a letter or an underscore.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77295""></a>
  <div class="note">
   <strong class="user">Gautam</strong>
   <a href="#77295" class="date">23-Aug-2007 11:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
</span><span class="comment">/*<br />
User Defined Functions<br />
<br />
function function_name($arg_1, $arg_2, ...,&nbsp; $arg_n)<br />
{<br />
&nbsp;&nbsp;&nbsp; code_line1;<br />
&nbsp;&nbsp;&nbsp; code_line2;<br />
&nbsp;&nbsp;&nbsp; code_line3;<br />
&nbsp;&nbsp;&nbsp; return ($value); //stops execution of the function and returns its argument as the value at the point where the function was called.<br />
}<br />
One may have more than one return()statements in a function.<br />
*/<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$text</span><span class="keyword">= </span><span class="string">'This Line is Bold and Italics.'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">makebold_n_italics</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$text </span><span class="keyword">= </span><span class="string">"&lt;i&gt;&lt;b&gt;</span><span class="default">$text</span><span class="string">&lt;/i&gt;&lt;/b&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return(</span><span class="default">$text</span><span class="keyword">); </span><span class="comment">//the return() statement immediately ends execution of the current function, and returns its argument as the value of the function call in print command<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">}<br />
&nbsp;&nbsp;&nbsp; print(</span><span class="string">"This Line is not Bold.&lt;br&gt;\n"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; print(</span><span class="string">"This Line is not Italics.&lt;br&gt;\n"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">makebold_n_italics</span><span class="keyword">(</span><span class="string">"</span><span class="default">$text</span><span class="string">"</span><span class="keyword">) ,</span><span class="string">"---&gt;"</span><span class="keyword">, </span><span class="string">'It prints the returned value of variable $text when function is called.'</span><span class="keyword">.</span><span class="string">"&lt;br&gt;\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"</span><span class="default">$text</span><span class="string">"</span><span class="keyword">, </span><span class="string">'---&gt; prints the original value of&nbsp; variable $text.'</span><span class="keyword">.</span><span class="string">"&lt;br&gt;\n"</span><span class="keyword">; </span><span class="comment">// prints the original value of $text<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$thanks</span><span class="keyword">=</span><span class="string">'Thanks to Zeev Suraski and Andi Gutmans !!!'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$text</span><span class="keyword">=</span><span class="default">$thanks</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">makebold_n_italics</span><span class="keyword">(</span><span class="string">"</span><span class="default">$text</span><span class="string">"</span><span class="keyword">);<br />
<br />
</span><span class="comment">/*<br />
Above codes produces output in a browser as under:<br />
<br />
This Line is not Bold.<br />
This Line is not Italics.<br />
This Line is Bold and Italics.---&gt;It prints the returned value of variable $text when function is called.<br />
This Line is Bold and Italics.---&gt; prints the original value of variable $text.<br />
Thanks to Zeev Suraski and Andi Gutmans !!!<br />
*/<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="70922""></a>
  <div class="note">
   <strong class="user">leblanc at tamu dot edu</strong>
   <a href="#70922" class="date">04-Nov-2006 05:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
manual says:<br />
&gt;nor is it possible to undefine or redefine previously-declared functions.<br />
<br />
you can undefine or redefine a function.. or so it says.. using <br />
runkit_function_remove<br />
runkit_function_redefine<br />
maybe to implement perl's Memoize module</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="61486""></a>
  <div class="note">
   <strong class="user">tom pittlik</strong>
   <a href="#61486" class="date">05-Feb-2006 08:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is a way of formatting different strings with different mandatory functions and is especially useful when processing form data or outputting database fields using structured configuration files:
<br />

<br />
<span class="default">&lt;?php
<br />

<br />
</span><span class="keyword">function </span><span class="default">format_string</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">,</span><span class="default">$functions</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$funcs </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">","</span><span class="keyword">,</span><span class="default">$functions</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$funcs </span><span class="keyword">as </span><span class="default">$func</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">function_exists</span><span class="keyword">(</span><span class="default">$func</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$string </span><span class="keyword">= </span><span class="default">$func</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$string</span><span class="keyword">;
<br />
}
<br />

<br />
echo </span><span class="default">format_string</span><span class="keyword">(</span><span class="string">"&nbsp; &lt;b&gt;&nbsp;&nbsp; this is a test&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;/b&gt;"</span><span class="keyword">, </span><span class="string">"strip_tags,strtoupper,trim"</span><span class="keyword">);
<br />
</span><span class="comment">// outputs "THIS IS A TEST"
<br />

<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="60355""></a>
  <div class="note">
   <strong class="user">gnirts dot REMOVE_THIS at HATE_SPAM dot gmail dot com</strong>
   <a href="#60355" class="date">04-Jan-2006 07:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to validate that a string could be a valid function name, watch out. preg_match() matches anywhere inside the test string, so strings like 'foo#' and '&nbsp; &nbsp; bar' will pass with the regex that they give ([a-zA-Z_\x7f-\xff][a-zA-Z0-9_\x7f-\xff]*)<br />
<br />
The solution is to use anchors in the regex (^ and $) and check the offset of the match (using PREG_OFFSET_CAPTURE).<br />
<br />
&lt;?<br />
<br />
function is_valid_function_name( $function_name_to_test )<br />
{<br />
&nbsp;&nbsp;&nbsp; $number_of_matches = preg_match( '&lt;^[a-zA-Z_\x7f-\xff][a-zA-Z0-9_\x7f-\xff]*$&gt;'<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; , $function_name_to_test<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; , $match_offset_array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; , PREG_OFFSET_CAPTURE );<br />
<br />
&nbsp;&nbsp;&nbsp; if( $number_of_matches === false )<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; trigger_error( 'Error with preg_match' , E_USER_WARNING );<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; if( $match_offset_array[0][1] !== 0 || $number_of_matches !== 1 )<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return false;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; else<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return true;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="48376""></a>
  <div class="note">
   <strong class="user">spy-j at rainbowtroopers dot com</strong>
   <a href="#48376" class="date">21-Dec-2004 12:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Take care when using parameters passed by reference to return new values in it:<br />
<br />
<span class="default">&lt;?PHP<br />
<br />
</span><span class="keyword">function </span><span class="default">foo</span><span class="keyword">( &amp;</span><span class="default">$refArray</span><span class="keyword">, ....) {<br />
&nbsp; <br />
&nbsp; UNSET(</span><span class="default">$refArray</span><span class="keyword">); </span><span class="comment">//&lt;-- fatal!!!<br />
<br />
&nbsp; </span><span class="keyword">for (....) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$refArray</span><span class="keyword">[] = ....<br />
&nbsp; }</span><span class="comment">//end for<br />
<br />
</span><span class="keyword">}</span><span class="comment">//end foo<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
I tried to make sure the passed variable is empty so i can fill it up as an array. So i put the UNSET. Unfortunately, this seems to cause a loss with the reference to the passed variable: the filled array was NOT returned in the passed argument refArray!<br />
<br />
I have found that replacing unset as follows seems to work correctly:<br />
<br />
<span class="default">&lt;?PHP<br />
<br />
</span><span class="keyword">function </span><span class="default">bar</span><span class="keyword">( &amp;</span><span class="default">$refArray</span><span class="keyword">, ....) {<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp; if (!EMPTY(</span><span class="default">$refArray</span><span class="keyword">)) </span><span class="default">$refArray </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
<br />
&nbsp; : : : <br />
<br />
}</span><span class="comment">//end bar<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="31145""></a>
  <div class="note">
   <strong class="user">php at simoneast dot net</strong>
   <a href="#31145" class="date">11-Apr-2003 06:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you're frustrated by not having access to global variables from within your functions, instead of declaring each one (particularly if you don't know them all) there are a couple of workarounds...<br />
<br />
If your function just needs to read global variables...<br />
<br />
function aCoolFunction () {<br />
&nbsp;&nbsp;&nbsp; extract($GLOBALS);<br />
....<br />
<br />
This creates a copy of all the global variables in the function scope.&nbsp; Notice that because it's a copy of the variables, changing them won't affect the variables outside the function and the copies are lost at the conclusion of the function.<br />
<br />
If you need to write to your global variables, I haven't tested it, but you could probably loop through the $GLOBALS array and make a "global" declaration for each one.&nbsp; Then you could modify the variables.<br />
<br />
Please note that this shouldn't be standard practice, but only in the case where a function needs access to all the global variables when they may be different from one call to another.&nbsp; Use the "global var1, var2..." declaration where possible.<br />
<br />
Hope that helps some people.<br />
<br />
Simon.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="21150""></a>
  <div class="note">
   <strong class="user">bishop</strong>
   <a href="#21150" class="date">01-May-2002 04:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Consider:
<br />

<br />
<span class="default">&lt;?php
<br />

<br />
</span><span class="keyword">function </span><span class="default">a</span><span class="keyword">() {
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">b</span><span class="keyword">() {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">'I am b'</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">'I am a'</span><span class="keyword">;
<br />
}
<br />

<br />
</span><span class="default">a</span><span class="keyword">();
<br />
</span><span class="default">a</span><span class="keyword">();
<br />

<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
As you might NOT expect, the second call to a() fails with a "Cannot redeclare b()" error.&nbsp; This behaviour is correct, insofar as PHP doesn't "allow functions to be redefined."
<br />

<br />
A work around:
<br />

<br />
<span class="default">&lt;?php
<br />

<br />
</span><span class="keyword">function </span><span class="default">a</span><span class="keyword">() {
<br />
&nbsp;&nbsp;&nbsp; if ( ! </span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">'b'</span><span class="keyword">) ) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; function </span><span class="default">b</span><span class="keyword">() {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">'I am b'</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">'I am a'</span><span class="keyword">;
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="19060""></a>
  <div class="note">
   <strong class="user">fabio at city dot ac dot uk</strong>
   <a href="#19060" class="date">14-Feb-2002 03:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As a corollary to other people's contributions in this section, you have to be careful when transforming a piece of code in to a function (say F1). If this piece of code contains calls to another function (say F2), then each variable used in F2 and defined in F1 must be declared as GLOBAL both in F1 and F2. This is tricky.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="16814""></a>
  <div class="note">
   <strong class="user">xpaz at somm dot com</strong>
   <a href="#16814" class="date">14-Nov-2001 09:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It is possible to define a function from inside another function. 
<br />
The result is that the inner function does not exist until the outer function gets executed. 
<br />

<br />
For example, the following code:
<br />

<br />
<span class="default">&lt;?php
<br />

<br />
</span><span class="keyword">function </span><span class="default">a </span><span class="keyword">() {
<br />
&nbsp; function </span><span class="default">b</span><span class="keyword">() {
<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"I am b.\n"</span><span class="keyword">;
<br />
&nbsp; }
<br />
&nbsp; echo </span><span class="string">"I am a.\n"</span><span class="keyword">;
<br />
}
<br />
if (</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">"b"</span><span class="keyword">)) echo </span><span class="string">"b is defined.\n"</span><span class="keyword">; else echo </span><span class="string">"b is not defined.\n"</span><span class="keyword">;
<br />
</span><span class="default">a</span><span class="keyword">();
<br />
if (</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">"b"</span><span class="keyword">)) echo </span><span class="string">"b is defined.\n"</span><span class="keyword">; else echo </span><span class="string">"b is not defined.\n"</span><span class="keyword">;
<br />

<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
echoes:
<br />

<br />
b is not defined.
<br />
I am a.
<br />
b is defined.
<br />

<br />
Classes too can be defined inside functions, and will not exist until the outer function gets executed.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="12314""></a>
  <div class="note">
   <strong class="user">aboyd at ssti dot com</strong>
   <a href="#12314" class="date">05-Apr-2001 05:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
[Editor's note: put your includes in the beginning of your script. You can call an included function, after it has been included&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; --jeroen]
<br />

<br />
The documentation states: "In PHP 3, functions must be defined before they are referenced. No such requirement exists in PHP 4."
<br />

<br />
I thought it wise to note here that there is in fact a limitation: you cannot bury your function in an include() or require().&nbsp; If the function is in an include()'d file, there is NO way to call that function beforehand.&nbsp; The workaround is to put the function directly in the file that calls the function.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="5284""></a>
  <div class="note">
   <strong class="user">GMCardoe at netherworldrpg dot net</strong>
   <a href="#5284" class="date">24-Apr-2000 11:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Stack overflow means your function called itself recursivly too many times and just completely filled up the processes stack. That error is there to stop a recursive call from completely taking up the entire system memory.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="3923""></a>
  <div class="note">
   <strong class="user">cap at capsi dot cx</strong>
   <a href="#3923" class="date">22-Feb-2000 01:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When using a function within a function, using global in the inner function will not make variables available that have been first initialized within the outer function.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="3603""></a>
  <div class="note">
   <strong class="user">php at paintbot dot com</strong>
   <a href="#3603" class="date">05-Feb-2000 04:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Important Note to All New Users: functions do NOT have default access to GLOBAL variables.&nbsp; You must specify globals as such in your function using the 'global' type/keyword.&nbsp; See the section on variables:scope.
<br />

<br />
This note should also be added to the documentation, as it would help the majority of programmers who use languages where globals are, well, global (that is, available from anywhere).&nbsp; The scoping rules should also not be buried in subsection 4 of the variables section.&nbsp; It should be front and center because I think this is probably one of the most non-standard and thus confusing design choices of PHP. 
<br />

<br />
[Ed. note: the variables $_GET, $_POST, $_REQUEST, $_SESSION, and $_FILES are superglobals, which means you don't need the global keyword to use them inside a function]</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
