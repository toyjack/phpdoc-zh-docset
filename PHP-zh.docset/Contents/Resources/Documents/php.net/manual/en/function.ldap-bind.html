<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>绑定 LDAP 目录</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.ldap-add.html">? ldap_add</a></li>
      <li style="float: right;"><a href="function.ldap-close.html">ldap_close ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.ldap.html">LDAP 函数</a></li>
    <li>绑定 LDAP 目录</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.ldap-bind" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">ldap_bind</h1>
  <p class="verinfo">(PHP 4, PHP 5, PHP 7)</p><p class="refpurpose"><span class="refname">ldap_bind</span> &mdash; <span class="dc-title">绑定 LDAP 目录</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.ldap-bind-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">bool</span> <span class="methodname"><strong>ldap_bind</strong></span>
    ( <span class="methodparam"><span class="type">resource</span> <code class="parameter">$link_identifier</code></span>
   [, <span class="methodparam"><span class="type">string</span> <code class="parameter">$bind_rdn</code><span class="initializer"> = <strong><code>NULL</code></strong></span></span>
   [, <span class="methodparam"><span class="type">string</span> <code class="parameter">$bind_password</code><span class="initializer"> = <strong><code>NULL</code></strong></span></span>
  ]] )</div>

  <p class="para rdfs-comment">
   使用指定的 RDN 和密码绑定到 LDAP 目录。 
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.ldap-bind-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">link_identifier</code></dt>

     <dd>

      <p class="para">
       通过 <span class="function"><a href="function.ldap-connect.html" class="function">ldap_connect()</a></span> 连接之后返回的 LDAP 连接标识。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">bind_rdn</code></dt>

     <dd>

      <p class="para">
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">bind_password</code></dt>

     <dd>

      <p class="para">
      </p>
     </dd>

    
   </dl>

  </p>
  <p class="para">
   如果没有指定 <code class="parameter">bind_rdn</code> 和 <code class="parameter">bind_password</code> ，将会以匿名身份绑定。
  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.ldap-bind-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   成功时返回 <strong><code>TRUE</code></strong>， 或者在失败时返回 <strong><code>FALSE</code></strong>。
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.ldap-bind-examples">
  <h3 class="title">范例</h3>
  <p class="para">
   <div class="example" id="example-4751">
    <p><strong>Example #1 使用 LDAP Bind</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br /></span><span style="color: #FF8000">//&nbsp;using&nbsp;ldap&nbsp;bind<br /></span><span style="color: #0000BB">$ldaprdn&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'uname'</span><span style="color: #007700">;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;ldap&nbsp;rdn&nbsp;or&nbsp;dn<br /></span><span style="color: #0000BB">$ldappass&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'password'</span><span style="color: #007700">;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;associated&nbsp;password<br /><br />//&nbsp;connect&nbsp;to&nbsp;ldap&nbsp;server<br /></span><span style="color: #0000BB">$ldapconn&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">ldap_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">"ldap.example.com"</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;die(</span><span style="color: #DD0000">"Could&nbsp;not&nbsp;connect&nbsp;to&nbsp;LDAP&nbsp;server."</span><span style="color: #007700">);<br /><br />if&nbsp;(</span><span style="color: #0000BB">$ldapconn</span><span style="color: #007700">)&nbsp;{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;binding&nbsp;to&nbsp;ldap&nbsp;server<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$ldapbind&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">ldap_bind</span><span style="color: #007700">(</span><span style="color: #0000BB">$ldapconn</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$ldaprdn</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$ldappass</span><span style="color: #007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;verify&nbsp;binding<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if&nbsp;(</span><span style="color: #0000BB">$ldapbind</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"LDAP&nbsp;bind&nbsp;successful..."</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"LDAP&nbsp;bind&nbsp;failed..."</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />}<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
   <div class="example" id="example-4752">
    <p><strong>Example #2 Using LDAP Bind Anonymously</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br /></span><span style="color: #FF8000">//using&nbsp;ldap&nbsp;bind&nbsp;anonymously<br /><br />//&nbsp;connect&nbsp;to&nbsp;ldap&nbsp;server<br /></span><span style="color: #0000BB">$ldapconn&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">ldap_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">"ldap.example.com"</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;die(</span><span style="color: #DD0000">"Could&nbsp;not&nbsp;connect&nbsp;to&nbsp;LDAP&nbsp;server."</span><span style="color: #007700">);<br /><br />if&nbsp;(</span><span style="color: #0000BB">$ldapconn</span><span style="color: #007700">)&nbsp;{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;binding&nbsp;anonymously<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$ldapbind&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">ldap_bind</span><span style="color: #007700">(</span><span style="color: #0000BB">$ldapconn</span><span style="color: #007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$ldapbind</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"LDAP&nbsp;bind&nbsp;anonymous&nbsp;successful..."</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"LDAP&nbsp;bind&nbsp;anonymous&nbsp;failed..."</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />}<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.ldap-bind-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.ldap-unbind.html" class="function" rel="rdfs-seeAlso">ldap_unbind()</a> - Unbind from LDAP directory</span></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="118543""></a>
  <div class="note">
   <strong class="user">info at multiotp dot net</strong>
   <a href="#118543" class="date">25-Dec-2015 01:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
GnuTLS and SChannel (Microsoft) implementations are not (yet) compatible for TLS 1.2 negotiation during LDAPS binding (when binding with Microsoft Windows 2012R2 server).<br />
<br />
The trick is to disable TLS1.2 before using LDAP functions:<br />
<br />
putenv('LDAPTLS_CIPHER_SUITE=NORMAL:!VERS-TLS1.2');</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="117968""></a>
  <div class="note">
   <strong class="user">user_o at hbt dot com</strong>
   <a href="#117968" class="date">10-Sep-2015 12:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Set timeout for ldap_bind:<br />
<br />
<span class="default">&lt;?php<br />
$ld </span><span class="keyword">= </span><span class="default">ldap_connect</span><span class="keyword">(</span><span class="string">"ldap.example.com"</span><span class="keyword">);<br />
</span><span class="default">ldap_set_option</span><span class="keyword">(</span><span class="default">$ld</span><span class="keyword">, </span><span class="default">LDAP_OPT_NETWORK_TIMEOUT</span><span class="keyword">, </span><span class="default">10</span><span class="keyword">); <br />
</span><span class="comment">/* 10 second timeout */<br />
</span><span class="default">ldap_bind</span><span class="keyword">(</span><span class="default">$ld</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
ref. https://bugs.php.net/bug.php?id=42837</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="115247""></a>
  <div class="note">
   <strong class="user">john dot doe at somewhere dot org</strong>
   <a href="#115247" class="date">20-Jun-2014 02:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In some structures its not possible to know the dn or rdn up front. However one can use $ldapuser= $samaccountname.'@'.domainname;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="114432""></a>
  <div class="note">
   <strong class="user">inakma87 at gmail dot com</strong>
   <a href="#114432" class="date">20-Feb-2014 05:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Getting an error "Can't contact LDAP server"<br />
Solved by adding:<br />
TLS_CACERTDIR /etc/openldap/cacerts<br />
TLS_CACERT /etc/openldap/ssl/cacert.pem</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="109371""></a>
  <div class="note">
   <strong class="user">deniskutin at gmail dot com</strong>
   <a href="#109371" class="date">11-Jul-2012 09:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It's nessesary to add: 
<br />

<br />
<span class="default">&lt;?php
<br />
ldap_set_option</span><span class="keyword">(</span><span class="default">$ds</span><span class="keyword">, </span><span class="default">LDAP_OPT_PROTOCOL_VERSION</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">)
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
for ldap_bind returned true, while you try to bind for openldap (at least version 2.4.21)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="109095""></a>
  <div class="note">
   <strong class="user">peter dot schlaf at web dot de</strong>
   <a href="#109095" class="date">20-Jun-2012 09:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I had a problem doing a ldap_bind over SSL against Active Directory. The server kept telling me: 'Unable to bind to server:'. To solve this (OS: CentOS 6) make sure that /etc/openldap/ldap.conf has this line:<br />
<br />
TLS_REQCERT allow</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="107048""></a>
  <div class="note">
   <strong class="user">IanB</strong>
   <a href="#107048" class="date">03-Jan-2012 09:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you're using SSL (e.g. ldaps) and ldap_bind is throwing 'Unable to bind to server:' errors, check that the hostname used in the ldap_connect matches the 'CN' in the SSL certificate on the LDAP server. For example:<br />
<br />
&lt;?<br />
&nbsp;&nbsp; ldap_connect('ldaps://ldap01');<br />
&nbsp; // 'ldap01' should match the CN in your LDAP server's SSL cert, otherwise the subsequent ldap_bind() will throw a bind error<br />
<br />
?&gt;<br />
<br />
You can check your LDAP server's SSL cert using Openssl utility (Linux) - look for the 'Subject' line:<br />
<br />
&nbsp;&nbsp; $ openssl x509 -in /etc/pki/tls/certs/ldap01.crt -text -noout<br />
&nbsp;&nbsp; ...<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; Subject: C=XY, ST=My State, L=My City, O=My Org, CN=ldap01/emailAddress=me@domain.com<br />
&nbsp;&nbsp; ...<br />
<br />
I recently applied some updates to my system (now Centos 5.7 and PHP 5.3.6) and started having this issue with PHP scripts that had been fine previously where I was simply using the IP address of the server. Replacing the IP address with the hostname fixed my issue.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="105620""></a>
  <div class="note">
   <strong class="user">marnijt at LIKEHAM dot gmail dot com</strong>
   <a href="#105620" class="date">01-Sep-2011 01:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
After a lot of trail and error i've found the way to authenticate to apple's Opendirectory (snow leopard server) and thought it maybe useful to share.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// using ldap bind<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ldaprdn&nbsp; </span><span class="keyword">= </span><span class="string">'uid=USERNAME,cn=users,dc=HOSTNAME,dc=DOMAIN,dc=com'</span><span class="keyword">;&nbsp; &nbsp;&nbsp; </span><span class="comment">// ldap rdn or dn<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ldappass </span><span class="keyword">= </span><span class="string">'PASSWORD'</span><span class="keyword">;&nbsp; </span><span class="comment">// associated password<br />
<br />
&nbsp;&nbsp;&nbsp; // connect to ldap server<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ldapconn </span><span class="keyword">= </span><span class="default">ldap_connect</span><span class="keyword">(</span><span class="string">"HOSTNAME.DOMAIN.com"</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; or die(</span><span class="string">"Could not connect to LDAP server."</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Set some ldap options for talking to <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">ldap_set_option</span><span class="keyword">(</span><span class="default">$ldapconn</span><span class="keyword">, </span><span class="default">LDAP_OPT_PROTOCOL_VERSION</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">ldap_set_option</span><span class="keyword">(</span><span class="default">$ldapconn</span><span class="keyword">, </span><span class="default">LDAP_OPT_REFERRALS</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$ldapconn</span><span class="keyword">) {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// binding to ldap server<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ldapbind </span><span class="keyword">= @</span><span class="default">ldap_bind</span><span class="keyword">(</span><span class="default">$ldapconn</span><span class="keyword">, </span><span class="default">$ldaprdn</span><span class="keyword">, </span><span class="default">$ldappass</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// verify binding<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$ldapbind</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"LDAP bind successful...\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"LDAP bind failed...\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="105037""></a>
  <div class="note">
   <strong class="user">bydand1959 at yahoo dot com</strong>
   <a href="#105037" class="date">24-Jul-2011 01:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
LDAP control support is missing from this implementation. Response controls might be part of the response(s) to the BIND request and must be handled in code.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="103034""></a>
  <div class="note">
   <strong class="user">gtkspert_SPAMMENOT_ at gmail dot com</strong>
   <a href="#103034" class="date">22-Mar-2011 02:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Interesting point,<br />
<br />
if you can't bind to active directory with the error "49: Invalid Credentials", you can get the extended error output from the ldap_get_option function, using the option: LDAP_OPT_DIAGNOSTIC_MESSAGE. Unfortunately php hasn't defined this by default, but it's value is 0x0032.<br />
<br />
This is useful if a user must change their password at first login (Data: 773), or if their account has expired on the network (Data: 532).<br />
<br />
<span class="default">&lt;?php<br />
<br />
define</span><span class="keyword">(</span><span class="default">LDAP_OPT_DIAGNOSTIC_MESSAGE</span><span class="keyword">, </span><span class="default">0x0032</span><span class="keyword">)<br />
<br />
</span><span class="default">$handle </span><span class="keyword">= </span><span class="default">ldap_connect</span><span class="keyword">(</span><span class="string">'ldap://active.directory.server/'</span><span class="keyword">);<br />
</span><span class="default">$bind </span><span class="keyword">= </span><span class="default">ldap_bind</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="string">'user'</span><span class="keyword">, </span><span class="string">'expiredpass'</span><span class="keyword">);<br />
<br />
if (</span><span class="default">$bind</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">ldap_get_option</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="default">LDAP_OPT_DIAGNOSTIC_MESSAGE</span><span class="keyword">, </span><span class="default">$extended_error</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Error Binding to LDAP: </span><span class="default">$extended_error</span><span class="string">"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Error Binding to LDAP: No additional information is available."</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Or something to that effect..<br />
<br />
It took me a while to work this one out, so i figured i'd share my results..</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="101445""></a>
  <div class="note">
   <strong class="user">elsint at yahoo dot com</strong>
   <a href="#101445" class="date">16-Dec-2010 11:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are still having trouble after following all the instructions on the Web to get LDAPS to work, here's what worked for me:<br />
<br />
I was trying to do LDAPS connection (our LDAP server was using port 40636) by running following command:<br />
<br />
ldap_connect("www.example.com",40636)<br />
<br />
This didn't work for days till I changed it to the following format:<br />
<br />
ldap_connect("ldaps://www.example.com:40636")<br />
<br />
Hope it'll help some out there.<br />
<br />
-Cagdas</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100610""></a>
  <div class="note">
   <strong class="user">magnetik at magnetik dot org</strong>
   <a href="#100610" class="date">26-Oct-2010 09:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Due to a bug in PHP 5.3 you may have to place the ldap.conf in the root of all your drives (I had to place it on D:).<br />
<br />
See <a href="http://bugs.php.net/bug.php?id=48866" rel="nofollow" target="_blank">http://bugs.php.net/bug.php?id=48866</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="98351""></a>
  <div class="note">
   <strong class="user">[nie ten]archie</strong>
   <a href="#98351" class="date">10-Jun-2010 01:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I'm using OpenLDAP on linux and found out the right bind sequence the hard way... so I'm sharing it with you:<br />
<br />
(wkaiser solution is ok if everything works fine, but for development I would suggest using ldap_error command like this)<br />
<br />
<span class="default">&lt;?php<br />
$ldapconfig</span><span class="keyword">[</span><span class="string">'host'</span><span class="keyword">] = </span><span class="string">'10.10.10.10'</span><span class="keyword">;<br />
</span><span class="default">$ldapconfig</span><span class="keyword">[</span><span class="string">'port'</span><span class="keyword">] = </span><span class="default">NULL</span><span class="keyword">;<br />
</span><span class="default">$ldapconfig</span><span class="keyword">[</span><span class="string">'basedn'</span><span class="keyword">] = </span><span class="string">'dc=company,dc=com'</span><span class="keyword">;<br />
<br />
</span><span class="default">$ds</span><span class="keyword">=</span><span class="default">ldap_connect</span><span class="keyword">(</span><span class="default">$ldapconfig</span><span class="keyword">[</span><span class="string">'host'</span><span class="keyword">], </span><span class="default">$ldapconfig</span><span class="keyword">[</span><span class="string">'port'</span><span class="keyword">]);<br />
<br />
</span><span class="default">$dn</span><span class="keyword">=</span><span class="string">"uid="</span><span class="keyword">.</span><span class="default">$username</span><span class="keyword">.</span><span class="string">",ou=people,"</span><span class="keyword">.</span><span class="default">$ldapconfig</span><span class="keyword">[</span><span class="string">'basedn'</span><span class="keyword">];<br />
<br />
if (</span><span class="default">$bind</span><span class="keyword">=</span><span class="default">ldap_bind</span><span class="keyword">(</span><span class="default">$ds</span><span class="keyword">, </span><span class="default">$dn</span><span class="keyword">, </span><span class="default">$password</span><span class="keyword">)) {<br />
&nbsp; echo(</span><span class="string">"Login correct"</span><span class="keyword">);<br />
} else {<br />
<br />
&nbsp; echo(</span><span class="string">"Unable to bind to server.&lt;/br&gt;"</span><span class="keyword">);<br />
<br />
&nbsp; echo(</span><span class="string">"msg:'"</span><span class="keyword">.</span><span class="default">ldap_error</span><span class="keyword">(</span><span class="default">$ds</span><span class="keyword">).</span><span class="string">"'&lt;/br&gt;"</span><span class="keyword">);</span><span class="comment">#check if the message isn't: Can't contact LDAP server :)<br />
&nbsp; #if it say something about a cn or user then you are trying with the wrong $dn pattern i found this by looking at OpenLDAP source code :)<br />
&nbsp; #we can figure out the right pattern by searching the user tree<br />
&nbsp; #remember to turn on the anonymous search on the ldap server<br />
&nbsp; </span><span class="keyword">if (</span><span class="default">$bind</span><span class="keyword">=</span><span class="default">ldap_bind</span><span class="keyword">(</span><span class="default">$ds</span><span class="keyword">)) {<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$filter </span><span class="keyword">= </span><span class="string">"(cn=*)"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; if (!(</span><span class="default">$search</span><span class="keyword">=@</span><span class="default">ldap_search</span><span class="keyword">(</span><span class="default">$ds</span><span class="keyword">, </span><span class="default">$ldapconfig</span><span class="keyword">[</span><span class="string">'basedn'</span><span class="keyword">], </span><span class="default">$filter</span><span class="keyword">))) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; echo(</span><span class="string">"Unable to search ldap server&lt;br&gt;"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; echo(</span><span class="string">"msg:'"</span><span class="keyword">.</span><span class="default">ldap_error</span><span class="keyword">(</span><span class="default">$ds</span><span class="keyword">).</span><span class="string">"'&lt;/br&gt;"</span><span class="keyword">);</span><span class="comment">#check the message again<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">} else {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$number_returned </span><span class="keyword">= </span><span class="default">ldap_count_entries</span><span class="keyword">(</span><span class="default">$ds</span><span class="keyword">,</span><span class="default">$search</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$info </span><span class="keyword">= </span><span class="default">ldap_get_entries</span><span class="keyword">(</span><span class="default">$ds</span><span class="keyword">, </span><span class="default">$search</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; echo </span><span class="string">"The number of entries returned is "</span><span class="keyword">. </span><span class="default">$number_returned</span><span class="keyword">.</span><span class="string">"&lt;p&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">$info</span><span class="keyword">[</span><span class="string">"count"</span><span class="keyword">]; </span><span class="default">$i</span><span class="keyword">++) {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$info</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]);</span><span class="comment">#look for your user account in this pile of junk and apply the whole pattern where you build $dn to match exactly the ldap tree entry<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="keyword">}<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; } else {<br />
&nbsp;&nbsp;&nbsp; echo(</span><span class="string">"Unable to bind anonymously&lt;br&gt;"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; echo(</span><span class="string">"msg:"</span><span class="keyword">.</span><span class="default">ldap_error</span><span class="keyword">(</span><span class="default">$ds</span><span class="keyword">).</span><span class="string">"&lt;br&gt;"</span><span class="keyword">);<br />
&nbsp; }<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
as you can see most of the examples use "cn=username" and OpenLDAP uses "uid=username" but who knows what will be used in the future builds, this code will help you check it out (I hope :)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="94556""></a>
  <div class="note">
   <strong class="user">ben _at_ onshop_co_uk</strong>
   <a href="#94556" class="date">11-Nov-2009 08:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I tried using putenv() to point LDAP to the certificate path etc.<br />
<br />
putenv("TLS_CACERT=/path/to/certificate");<br />
putenv("TLS_REQCERT=never");<br />
<br />
This did not work for me. It has to be in the Apache configuration or LDAP configuration:<br />
<br />
LDAP CONFIGURATION<br />
<br />
Put these values in ldap.conf:<br />
<br />
TLS_CACERT /path/to/certificate<br />
TLS_REQCERT never<br />
<br />
The path varies on UNIX systems.<br />
<br />
On Windows it is C:\openldap\sysconf\ldap.conf<br />
<br />
APACHE CONFIGURATION<br />
<br />
Add these values to httpd.conf:<br />
<br />
LDAPTrustedGlobalCert &lt;encryption method&gt; /path/to/certificate<br />
LDAPVerifyServerCert Off<br />
<br />
The encryption method I was using was 'CA_BASE64'. Check the encryption method with your LDAP/AD sysadmin.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93345""></a>
  <div class="note">
   <strong class="user">spam[AT]it-blog[DOT]net</strong>
   <a href="#93345" class="date">04-Sep-2009 04:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When using LDAP with SSL and a LDAP server which uses a self-signed SSL certificate normally no connection will be established. Therefor you have to allow such connections explicitly.<br />
With Linux (e.g. Debian, Ubuntu) you have to add "TLS_REQCERT never" to your /etc/ldap/ldap.conf. On other distributions this config file may be located somewhere else.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="88822""></a>
  <div class="note">
   <strong class="user">taomanjay at _DIESPAM_gmail dot com</strong>
   <a href="#88822" class="date">09-Feb-2009 11:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just a quick and easy function to authenticate against an AD domain controller:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">ad_auth</span><span class="keyword">( </span><span class="default">$server</span><span class="keyword">, </span><span class="default">$username</span><span class="keyword">, </span><span class="default">$password </span><span class="keyword">){
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ldap </span><span class="keyword">= @</span><span class="default">ldap_connect</span><span class="keyword">( </span><span class="default">$server </span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( @</span><span class="default">ldap_bind</span><span class="keyword">( </span><span class="default">$ldap</span><span class="keyword">, </span><span class="default">$username</span><span class="keyword">, </span><span class="default">$password </span><span class="keyword">) ){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ldap_unbind</span><span class="keyword">( </span><span class="default">$ldap </span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">1</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else{
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="88046""></a>
  <div class="note">
   <strong class="user">juan[dot]pineda[at]resultstel.com</strong>
   <a href="#88046" class="date">07-Jan-2009 05:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Active Directory doesn't accept anonymous requests anymore.<br />
<br />
With Windows Server 2003, only authenticated users may initiate an LDAP request against Windows Server 2003-based domain controllers. You can override this new default behavior by changing the seventh character of the dsHeuristics attribute on the DN path as follows: <br />
CN=Directory Service,CN=Windows NT,CN=Services,CN=Configuration,Root domain in forest<br />
<br />
from: <a href="http://support.microsoft.com/kb/326690" rel="nofollow" target="_blank">http://support.microsoft.com/kb/326690</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86635""></a>
  <div class="note">
   <strong class="user">james at NOSPAM dot revillini dot com</strong>
   <a href="#86635" class="date">27-Oct-2008 03:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I couldn't get ldap_bind to work on an ldaps connection until I followed some instructions about creating an ldap.conf file.&nbsp; I don't see these instructions anywhere on the php site.&nbsp; Maybe they're on the OpenLDAP site, but I thought it would be useful to have here as well.&nbsp; Credit goes to a dude known as 'LRM', and I found my solution here: <a href="http://lists.horde.org/archives/sork/Week-of-Mon-20040503/001578.html" rel="nofollow" target="_blank">http://lists.horde.org/archives/sork/Week-of-Mon-20040503/001578.html</a><br />
<br />
My setup is XAMPP on Win XP.<br />
###### ApacheFriends XAMPP (basic package) version 1.6.3a ######<br />
<br />
&nbsp; + Apache 2.2.4<br />
&nbsp; + MySQL 5.0.45<br />
&nbsp; + PHP 5.2.3 + PHP 4.4.7 + PEAR<br />
&nbsp; + PHP-Switch win32 1.0 (please use the "php-switch.bat")<br />
&nbsp; + XAMPP Control Version 2.5 from www.nat32.com&nbsp; &nbsp; <br />
&nbsp; + XAMPP Security 1.0&nbsp; &nbsp; <br />
&nbsp; + SQLite 2.8.15<br />
&nbsp; + OpenSSL 0.9.8e<br />
&nbsp; + phpMyAdmin 2.10.3<br />
&nbsp; + ADOdb 4.95<br />
&nbsp; + Mercury Mail Transport System v4.01b<br />
&nbsp; + FileZilla FTP Server 0.9.23<br />
&nbsp; + Webalizer 2.01-10<br />
&nbsp; + Zend Optimizer 3.3.0<br />
&nbsp; + eAccelerator 0.9.5.1 for PHP 5.2.3&nbsp; (comment out in the php.ini)<br />
<br />
1. create C:\OpenLDAP\sysconf\ldap.conf (Yes, it MUST be this path because it's hard-coded in the dll)<br />
2. put this line at the top:<br />
<br />
TLS_REQCERT never<br />
<br />
3. Save, stop/start apache.<br />
<br />
The reason is, I think, because it doesn't understand the certificate, so this directive tells it to not bother checking it.&nbsp; I guess that could be unsafe in some cases, but in my case I'm confident with the server I'm connecting to.<br />
<br />
My connection code was as follows (nothing new here, I don't think):<br />
<br />
<span class="default">&lt;?php<br />
$con </span><span class="keyword">= @</span><span class="default">ldap_connect</span><span class="keyword">(</span><span class="string">'ldaps://the.ldap.server'</span><span class="keyword">, </span><span class="default">636</span><span class="keyword">);<br />
</span><span class="default">ldap_set_option</span><span class="keyword">(</span><span class="default">$con</span><span class="keyword">, </span><span class="default">LDAP_OPT_PROTOCOL_VERSION</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">);<br />
</span><span class="default">ldap_set_option</span><span class="keyword">(</span><span class="default">$con</span><span class="keyword">, </span><span class="default">LDAP_OPT_REFERRALS</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
</span><span class="default">var_dump</span><span class="keyword">(@</span><span class="default">ldap_bind</span><span class="keyword">(</span><span class="default">$con</span><span class="keyword">, </span><span class="string">'user@sub.domain.com'</span><span class="keyword">, </span><span class="string">'password'</span><span class="keyword">));<br />
</span><span class="default">?&gt;<br />
</span><br />
Good luck!&nbsp; LDAPS can be a real bitch.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84007""></a>
  <div class="note">
   <strong class="user">Devia dot Fan at gmail dot com</strong>
   <a href="#84007" class="date">23-Jun-2008 07:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hi All, I just thought people should realize that the bug, or whatever change that was implemented with slapd and Openldap for the version V3 protocol has either not been repaired, or isn;t believed to be a bug or whatever...but still requires an implicit setting to V3 for use of the ldap_bind function. I am using Apache 2 and PHP 5.1 with LDAP 2. The default is set to deny V2 protocol, and even reconfiguring the slapd config file will not fix the problem. <br />
<br />
You must still use the ldap_set_option function. <br />
<br />
EX:<br />
<br />
<span class="default">&lt;?php <br />
&nbsp;&nbsp;&nbsp; $ldapHost </span><span class="keyword">= </span><span class="string">"ldap://server"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ldapPort </span><span class="keyword">= </span><span class="string">"port"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ldapUser </span><span class="keyword">=</span><span class="string">"cn=name,dc=domain"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ldapPswd </span><span class="keyword">=</span><span class="string">"password"</span><span class="keyword">;<br />
<br />
</span><span class="default">$ldapLink </span><span class="keyword">=</span><span class="default">ldap_connect</span><span class="keyword">(</span><span class="default">$ldapHost</span><span class="keyword">, </span><span class="default">$ldapPort</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; or die(</span><span class="string">"Can't establish LDAP connection"</span><span class="keyword">);<br />
<br />
if (</span><span class="default">ldap_set_option</span><span class="keyword">(</span><span class="default">$ldapLink</span><span class="keyword">,</span><span class="default">LDAP_OPT_PROTOCOL_VERSION</span><span class="keyword">,</span><span class="default">3</span><span class="keyword">))<br />
{<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"Using LDAP v3"</span><span class="keyword">;<br />
}else{<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"Failed to set version to protocol 3"</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">ldap_bind</span><span class="keyword">(</span><span class="default">$ldapLink</span><span class="keyword">,</span><span class="default">$ldapUser</span><span class="keyword">,</span><span class="default">$ldapPswd</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; or die(</span><span class="string">"Can't bind to server."</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Thanks to Ken on below for showing the way. There was a slight code error in what he chose as his link_id, but thats all. This code above worked nice and shinny, and demonstrates we are still working with 2004 problems. I wish they would update this in the code above.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77545""></a>
  <div class="note">
   <strong class="user">Nicolas Van Lancker</strong>
   <a href="#77545" class="date">03-Sep-2007 11:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It seems that Active Directory stores information in UTF8 format.<br />
<br />
I needed to utf8_encode() the username and password otherwise the bind failed when a user has accented characters in his password...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76562""></a>
  <div class="note">
   <strong class="user">Josh A.</strong>
   <a href="#76562" class="date">20-Jul-2007 04:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The OpenLDAP libraries will return error 53 (Server unwilling to perform) when trying to re-bind to a non-anonymous account if you accidentally leave the password field blank. If you want to authenticate against a different field than the dn, you have to bind to the server twice. Your code may look like the following:<br />
<br />
&lt;?<br />
function ldapLogin($uname, $pass, $base_dn, $fname, $server, $port){<br />
&nbsp;&nbsp;&nbsp; $ldc=@ldap_connect($server, $port);<br />
&nbsp;&nbsp;&nbsp; if (!$ldc) return ERROR_CODE;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; $bn='cn=anonymous-user,'.$base_dn;<br />
&nbsp;&nbsp;&nbsp; $pw='anonymous-pass';<br />
&nbsp;&nbsp;&nbsp; $lbind=@ldap_bind($ldc, $bn, $pw);<br />
&nbsp;&nbsp;&nbsp; if (!$lbind) return ERROR_CODE;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; $ureturn=@ldap_search($ldc, $base_dn, "($fname=$uname)", array('dn', 'givenName', 'sn', 'mail'));<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; $uent=@ldap_first_entry($ldc, $ureturn);<br />
&nbsp;&nbsp;&nbsp; if (!$uent) return ERROR_CODE;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; $bn=@ldap_get_dn($ldc, $uent);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; //This line should use $pass rather than $password<br />
&nbsp;&nbsp;&nbsp; $lbind=@ldap_bind($ldc, $bn, $password);<br />
&nbsp;&nbsp;&nbsp; // Now you can find the error<br />
&nbsp;&nbsp;&nbsp; echo ldap_error($ltc);<br />
<br />
&nbsp;&nbsp;&nbsp; if ($lbind) return true; else return false;<br />
?&gt;<br />
<br />
Hope this helps someone else running in to the same error.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74189""></a>
  <div class="note">
   <strong class="user">Teemu</strong>
   <a href="#74189" class="date">29-Mar-2007 09:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Example of connecting and searching AD<br />
<br />
$con = ldap_connect('ad.domain.com');<br />
ldap_set_option($con, LDAP_OPT_PROTOCOL_VERSION, 3);<br />
ldap_set_option($con, LDAP_OPT_REFERRALS, 0);<br />
ldap_bind($con, 'user@DOMAIN.COM', 'clear password');<br />
<br />
ldap_search($con, 'DC=domain,DC=com', '(uniqueMember=user)');</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73718""></a>
  <div class="note">
   <strong class="user">alex dot everett at okstate dot edu</strong>
   <a href="#73718" class="date">07-Mar-2007 09:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A number of examples and implementations of authentication schemes which use LDAP simple binds to authenticate users fail to properly sanitize user-submitted data. This can allow for an anonymous user to authenticate to a web-based application as an existing user. Provided below is a brief description and example of how this vulnerability can arise. For more detailed information please visit the links at the bottom of this posting.<br />
<br />
The bind operation of LDAP, as described in RFC 4513, provides a method which allows for authentication of users. For the Simple Authentication Method a user may use the anonymous authentication mechanism, the unauthenticated authentication mechanism, or the name/password authentication mechanism. The unauthenticated authentication mechanism is used when a client who desires to establish an anonymous authorization state passes a non-zero length distinguished name and a zero length password. Most LDAP servers either can be configured to allow this mechanism or allow it by default. Web-based applications which perform the simple bind operation with the client's credentials are at risk when an anonymous authorization state is established. This can occur when the web-based application passes a distinguished name and a zero length password to the LDAP server.<br />
This is commonly encountered when no password is provided from the client to the web-based application. This situation is described in some of the postings found below. For this situation, the recommendations found in other postings is sufficient to prevent authentication bypass.<br />
However, no prior postings at php.net describe a situation in which a client may pass a distinguished username and a password of non-zero length to the web-based application which results in an anonymous authorization state. Below is an example of this situation.<br />
<br />
$dn="testuser";<br />
$pass="\x00\x41";<br />
if (empty($dn) or empty($pass)) { exit(); } //check for empty strings<br />
//if (preg_match('/[^a-zA-Z]/',$dn) or preg_match('/[^a-zA-Z0-9\x20!@#$%^&amp;*()]/',$pass)) { exit(); } //check for expected values (whitelisting)<br />
//if (preg_match('/\x00/',$dn) or preg_match('/\x00/',$pass)) { exit(); } //check for null byte (blacklisting)<br />
$ldapconn=ldap_connect("192.0.2.2") or die("Could not connect to LDAP server.");<br />
if ($ldapconn) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; ldap_set_option($ldapconn, LDAP_OPT_PROTOCOL_VERSION, 3);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $ldapbind=ldap_bind($ldapconn, $dn, $pass);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ($ldapbind) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo("success");<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo("fail");<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
References:<br />
<a href="http://security.okstate.edu" rel="nofollow" target="_blank">http://security.okstate.edu</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="72795""></a>
  <div class="note">
   <strong class="user">john dot hargrove at sellingsource dot com</strong>
   <a href="#72795" class="date">02-Feb-2007 12:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that you have to specify the protocol version prior to making a call to ldap_bind, when the server is expecting LDAP protocol version 3.&nbsp; If you do not, you will receive a warning and fail to bind, such as:<br />
<br />
ldap_bind(): Unable to bind to server: Protocol error<br />
<br />
In order to avoid this, make this call:<br />
<br />
<span class="default">&lt;?php<br />
ldap_set_option</span><span class="keyword">(</span><span class="default">$ds</span><span class="keyword">, </span><span class="default">LDAP_OPT_PROTOCOL_VERSION</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Where $ds is the result returned by ldap_connect(...);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68733""></a>
  <div class="note">
   <strong class="user">david dot marsh at hartfordlife dot com</strong>
   <a href="#68733" class="date">08-Aug-2006 09:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
had to do a bunch of research on this, but it does work, once config'd correctly.<br />
<br />
using Apache/2.2.3 (Win32) mod_ssl/2.2.3 OpenSSL/0.9.8b <br />
PHP PHP Version 5.1.5-dev<br />
<br />
ldap_bind was getting "81 Can't contact LDAP server" which was really annoying, since the connection worked fine without "ldaps"<br />
using:<br />
<br />
$ldapconnect = @ldap_connect( $connection_string );<br />
<br />
well, actually the bind was really the one failing...<br />
<br />
$bind = ldap_bind($ldapconnect, $client, $this-&gt;objSecurityLogin-&gt;Password);<br />
<br />
many attempts to determine until i smartened up and turned on the trace level:<br />
<br />
ldap_set_option(NULL, LDAP_OPT_DEBUG_LEVEL, 7);<br />
<br />
which must go before the connect!<br />
<br />
found that on windows, you can't specifiy a quote in the ldap.conf:<br />
i had:<br />
TLS_REQCERT never<br />
TLS_CACERT "C:\\Documents\\Tools\\Apache2\\conf\\ssl\\ad.pem"<br />
which throws the error..<br />
TLS: could not load verify locations (file:`"C:\Documents\Tools\Apache2\conf\ssl\ad.pem"',dir:`').<br />
TLS: error:0200107B:system library:fopen:Unknown error .\crypto\bio\bss_file.c:122<br />
TLS: error:2006D002:BIO routines:BIO_new_file:system lib .\crypto\bio\bss_file.c:127<br />
TLS: error:0B084002:x509 certificate routines:X509_load_cert_crl_file:system lib .\crypto\x509\by_file.c:274<br />
ldap_err2string<br />
<br />
changed to:<br />
TLS_REQCERT never<br />
TLS_CACERT C:\\Documents\\Tools\\Apache2\\conf\\ssl\\ad.pem <br />
which cleans it up as:<br />
TLS trace: SSL_connect:before/connect initialization<br />
TLS trace: SSL_connect:SSLv2/v3 write client hello A<br />
TLS trace: SSL_connect:SSLv3 read server hello A<br />
TLS certificate verification: depth: 1, err: 0, subject: /DC=xxx/DC=yyy/CN=zzzz, issuer: /DC=abab/DC=yyy/CN=zzzz<br />
TLS certificate verification: depth: 0, err: 0, subject: ......<br />
<br />
so the moral to the story is even though PHP wants quotes in some windows config parms, it won't work if its in ldap.conf!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68093""></a>
  <div class="note">
   <strong class="user">romerom at cox dot net</strong>
   <a href="#68093" class="date">12-Jul-2006 11:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I ran into an issue trying to bind as "cn=manager,dc=example,dc=com".&nbsp; I took the example kenn posted where he set LDAP_OPT_PROTOCOL_VERSION to "3" for the connection.&nbsp; Once I set this, I was able to bind with my manager id.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="65547""></a>
  <div class="note">
   <strong class="user">dedlfix</strong>
   <a href="#65547" class="date">03-May-2006 09:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It doesn't make much sense to let die() the script in case of an error, otherwise to ask if there were no errors before proceeding the script, as the official examples do.<br />
<br />
better: <br />
<br />
<span class="default">&lt;?php<br />
ldap_bind</span><span class="keyword">(...) or die(...);<br />
</span><span class="default">do_something</span><span class="keyword">();<br />
</span><span class="default">?&gt;<br />
</span><br />
or even better (die() is quick but dirty)<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">if (!</span><span class="default">ldap_bind</span><span class="keyword">(...)) {<br />
&nbsp; </span><span class="default">error</span><span class="keyword">();<br />
} else {<br />
&nbsp; </span><span class="default">do_something</span><span class="keyword">();<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="58472""></a>
  <div class="note">
   <strong class="user">baroque at citromail dot hu</strong>
   <a href="#58472" class="date">05-Nov-2005 10:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This code sample shows how to connect and bind to eDirectory in PHP using LDAP for Netware.<br />
<br />
<span class="default">&lt;?php<br />
<br />
$server</span><span class="keyword">=</span><span class="string">'137.65.138.159'</span><span class="keyword">;<br />
</span><span class="default">$admin</span><span class="keyword">=</span><span class="string">'cn=admin,o=novell'</span><span class="keyword">;<br />
</span><span class="default">$passwd</span><span class="keyword">=</span><span class="string">'novell'</span><span class="keyword">;<br />
<br />
</span><span class="default">$ds</span><span class="keyword">=</span><span class="default">ldap_connect</span><span class="keyword">(</span><span class="default">$server</span><span class="keyword">);&nbsp; </span><span class="comment">// assuming the LDAP server is on this host<br />
<br />
</span><span class="keyword">if (</span><span class="default">$ds</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// bind with appropriate dn to give update access<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$r</span><span class="keyword">=</span><span class="default">ldap_bind</span><span class="keyword">(</span><span class="default">$ds</span><span class="keyword">, </span><span class="default">$admin</span><span class="keyword">, </span><span class="default">$passwd</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if(!</span><span class="default">$r</span><span class="keyword">) die(</span><span class="string">"ldap_bind failed&lt;br&gt;"</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"ldap_bind success"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">ldap_close</span><span class="keyword">(</span><span class="default">$ds</span><span class="keyword">);<br />
} else {<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"Unable to connect to LDAP server"</span><span class="keyword">; <br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="57882""></a>
  <div class="note">
   
   <a href="#57882" class="date">18-Oct-2005 08:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When using Active Directory 2003 (possibly also 2000) you can't search anonymously so you have to bind with a (known) user and password. Or else you will get an Search operations error. I also can confirm that an empty password bind succeeds! So test for an empty password first!<br />
<br />
Some excellent information is found here:<br />
<a href="http://www.scit.wlv.ac.uk/~jphb/sst/php/extra/ldap.html" rel="nofollow" target="_blank">http://www.scit.wlv.ac.uk/~jphb/sst/php/extra/ldap.html</a><br />
<a href="http://www.scit.wlv.ac.uk/~jphb/sst/basics/ldap.html" rel="nofollow" target="_blank">http://www.scit.wlv.ac.uk/~jphb/sst/basics/ldap.html</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="56782""></a>
  <div class="note">
   <strong class="user">darkstar_ae at hotmail dot com</strong>
   <a href="#56782" class="date">15-Sep-2005 09:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This may be a security issue but after tinkering for hours with the below ldap auth function (edi01 at gmx dot at), I discovered that the ldap_bind function will return true if you enter a valid username AND a NULL value!<br />
<br />
so if that function were to receive something like $username = 'someuser' and $password = '', it would return true. As long as it isn't a null value the function will work as expected. Might as well check if it is null or empty then.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="56105""></a>
  <div class="note">
   <strong class="user">get_your_gun at hotmail dot com</strong>
   <a href="#56105" class="date">23-Aug-2005 08:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hey<br />
<br />
I was trying this all day and final noticed that when you use bind and authenticate. The user name needs to be as follows for it to work. I am using PHP V 4.03 so this might be different now but here is what I used and the auth worked.<br />
<br />
<span class="default">&lt;?php<br />
$ldaphost </span><span class="keyword">= </span><span class="string">"ldap.what.at.greatnet.com"</span><span class="keyword">;<br />
</span><span class="default">$ldapport </span><span class="keyword">= </span><span class="default">389</span><span class="keyword">;<br />
<br />
</span><span class="default">$ds </span><span class="keyword">= </span><span class="default">ldap_connect</span><span class="keyword">(</span><span class="default">$ldaphost</span><span class="keyword">, </span><span class="default">$ldapport</span><span class="keyword">)<br />
or die(</span><span class="string">"Could not connect to </span><span class="default">$ldaphost</span><span class="string">"</span><span class="keyword">);<br />
<br />
if (</span><span class="default">$ds</span><span class="keyword">) <br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$username </span><span class="keyword">= </span><span class="string">"johndoe@what.at.greatnet.com"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$upasswd </span><span class="keyword">= </span><span class="string">"pass"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ldapbind </span><span class="keyword">= </span><span class="default">ldap_bind</span><span class="keyword">(</span><span class="default">$ds</span><span class="keyword">, </span><span class="default">$username</span><span class="keyword">, </span><span class="default">$upasswd</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$ldapbind</span><span class="keyword">) <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {print </span><span class="string">"Congratulations! </span><span class="default">$username</span><span class="string"> is authenticated."</span><span class="keyword">;}<br />
&nbsp;&nbsp;&nbsp; else <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {print </span><span class="string">"Nice try, kid. Better luck next time!"</span><span class="keyword">;}<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="51587""></a>
  <div class="note">
   <strong class="user">edi01 at gmx dot at</strong>
   <a href="#51587" class="date">05-Apr-2005 10:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
complete ldap authentication script:<br />
<br />
function checkldapuser($username,$password,$ldap_server){<br />
&nbsp; if($connect=@ldap_connect($ldap_server)){ // if connected to ldap server<br />
<br />
&nbsp;&nbsp;&nbsp; if (ldap_set_option($connect, LDAP_OPT_PROTOCOL_VERSION, 3)) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; echo "version 3&lt;br&gt;\n";<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp;&nbsp; echo "version 2&lt;br&gt;\n";<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; echo "verification on '$ldap_server': ";<br />
<br />
&nbsp;&nbsp;&nbsp; // bind to ldap connection<br />
&nbsp;&nbsp;&nbsp; if(($bind=@ldap_bind($connect)) == false){<br />
&nbsp;&nbsp; &nbsp;&nbsp; print "bind:__FAILED__&lt;br&gt;\n";<br />
&nbsp;&nbsp; &nbsp;&nbsp; return false;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; // search for user<br />
&nbsp;&nbsp;&nbsp; if (($res_id = ldap_search( $connect,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; "dc=auto,dc=tuwien,dc=ac,dc=at",<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; "uid=$username")) == false) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; print "failure: search in LDAP-tree failed&lt;br&gt;";<br />
&nbsp;&nbsp; &nbsp;&nbsp; return false;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; if (ldap_count_entries($connect, $res_id) != 1) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; print "failure: username $username found more than once&lt;br&gt;\n";<br />
&nbsp;&nbsp; &nbsp;&nbsp; return false;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; if (( $entry_id = ldap_first_entry($connect, $res_id))== false) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; print "failur: entry of searchresult couln't be fetched&lt;br&gt;\n";<br />
&nbsp;&nbsp; &nbsp;&nbsp; return false;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; if (( $user_dn = ldap_get_dn($connect, $entry_id)) == false) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; print "failure: user-dn coulnd't be fetched&lt;br&gt;\n";<br />
&nbsp;&nbsp; &nbsp;&nbsp; return false;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; /* Authentifizierung des User */<br />
&nbsp;&nbsp;&nbsp; if (($link_id = ldap_bind($connect, $user_dn, $password)) == false) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; print "failure: username, password didn't match: $user_dn&lt;br&gt;\n";<br />
&nbsp;&nbsp; &nbsp;&nbsp; return false;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; return true;<br />
&nbsp;&nbsp;&nbsp; @ldap_close($connect);<br />
&nbsp; } else {&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // no conection to ldap server<br />
&nbsp;&nbsp;&nbsp; echo "no connection to '$ldap_server'&lt;br&gt;\n";<br />
&nbsp; }<br />
<br />
&nbsp; echo "failed: ".ldap_error($connect)."&lt;BR&gt;\n";<br />
<br />
&nbsp; @ldap_close($connect);<br />
&nbsp; return(false);<br />
<br />
}//end function checkldapuser<br />
<br />
Here a sample for using this function:<br />
<br />
if (checkldapuser('myuser', 'secretpassword', 'ldap://link.to.ldap')) {<br />
&nbsp; echo "ACCESS GRANTED\n";<br />
} else {<br />
&nbsp; echo "ACCESS DENIED\n";<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="50309""></a>
  <div class="note">
   <strong class="user">owen at delong dot com</strong>
   <a href="#50309" class="date">24-Feb-2005 01:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I am assuming that ldap_bind does a simple bind and that for other<br />
types of bind, ldap_sasl_bind should be used.<br />
<br />
Also, while the allow bind v2 solution will work with slapd, you really should<br />
use ldap v3 if at all possible because of the security improvements and<br />
better protocol definition.&nbsp; LDAP v2 is largely deprecated at this point.<br />
<br />
Hopefully the PHP default LDAP version will move to v3 soon.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="50060""></a>
  <div class="note">
   <strong class="user">phredbroughton at yahoo dot com</strong>
   <a href="#50060" class="date">16-Feb-2005 08:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As noted before with the password, I have found that if either&nbsp; of the valuse for user or password are blank, or as in my case a typo resulted in a blank user as it was an undefined variable, the ldap_bind() will just perform an anonymous bind and return true!<br />
Shouldn't this detect the presence of the additional values and return an error? At least if the user or password is passed. If they are both blank I'm not sure what it should do.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="47685""></a>
  <div class="note">
   <strong class="user">wkaiser at mpimf-heidelberg dot mpg dot de</strong>
   <a href="#47685" class="date">25-Nov-2004 08:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you do not want to bind as unixadmin or *manager (i. e., for authentication on web applications), the following code could be useful:<br />
<span class="default">&lt;?php<br />
<br />
$ldaphost </span><span class="keyword">= </span><span class="string">"ldap.yourdomain.com"</span><span class="keyword">;<br />
<br />
</span><span class="comment">/*for a SSL secured ldap_connect()<br />
<br />
$ldaphost = "ldap.yourdomain.com"; */<br />
<br />
</span><span class="default">$ldapport </span><span class="keyword">= </span><span class="default">389</span><span class="keyword">;<br />
<br />
</span><span class="default">$ds </span><span class="keyword">= </span><span class="default">ldap_connect</span><span class="keyword">(</span><span class="default">$ldaphost</span><span class="keyword">, </span><span class="default">$ldapport</span><span class="keyword">)<br />
or die(</span><span class="string">"Could not connect to </span><span class="default">$ldaphost</span><span class="string">"</span><span class="keyword">);<br />
<br />
if (</span><span class="default">$ds</span><span class="keyword">) {<br />
<br />
</span><span class="default">$username </span><span class="keyword">= </span><span class="string">"some_user"</span><span class="keyword">;<br />
</span><span class="default">$upasswd </span><span class="keyword">= </span><span class="string">"secret"</span><span class="keyword">;<br />
</span><span class="default">$binddn </span><span class="keyword">= </span><span class="string">"uid=</span><span class="default">$username</span><span class="string">,ou=people,dc=yourdomain,dc=com"</span><span class="keyword">;<br />
<br />
</span><span class="default">$ldapbind </span><span class="keyword">= </span><span class="default">ldap_bind</span><span class="keyword">(</span><span class="default">$ds</span><span class="keyword">, </span><span class="default">$binddn</span><span class="keyword">, </span><span class="default">$upasswd</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
if (</span><span class="default">$ldapbind</span><span class="keyword">) {<br />
<br />
print </span><span class="string">"Congratulations! </span><span class="default">$some_user</span><span class="string"> is authenticated."</span><span class="keyword">;}<br />
<br />
else {<br />
<br />
print </span><span class="string">"Nice try, kid. Better luck next time!"</span><span class="keyword">;}}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="46660""></a>
  <div class="note">
   <strong class="user">jakob at grimstveit dot no</strong>
   <a href="#46660" class="date">19-Oct-2004 05:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As "john dot lewis at waldenweb dot com" correctly writes (and this is important to note and SHOULD be incorporated into the documentation as a warning - trying to bind with specific username and empty password will return TRUE.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="43204""></a>
  <div class="note">
   <strong class="user">kenn at pcintelligent dot com</strong>
   <a href="#43204" class="date">14-Jun-2004 08:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I want to point out that the line that reads <br />
<br />
"$ldaprdn&nbsp; = 'uname';"&nbsp; <br />
<br />
is a bit confusing. You need to ensure that you use the entire rootdn. for instance. your code should look more like this...<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">// using ldap bind *** NOTE the uname *****<br />
</span><span class="default">$ldaprdn&nbsp; </span><span class="keyword">= </span><span class="string">'cn=root,dc=testserver,dc=com'</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">// ldap rdn or dn<br />
</span><span class="default">$ldappass </span><span class="keyword">= </span><span class="string">'secret'</span><span class="keyword">;&nbsp; </span><span class="comment">// associated password<br />
<br />
// connect to ldap server<br />
</span><span class="default">$ldapconn </span><span class="keyword">= </span><span class="default">ldap_connect</span><span class="keyword">(</span><span class="string">"ldap.testserver.com"</span><span class="keyword">)<br />
&nbsp;&nbsp; or die(</span><span class="string">"Could not connect to LDAP server."</span><span class="keyword">);<br />
<br />
if (</span><span class="default">ldap_set_option</span><span class="keyword">(</span><span class="default">$ds</span><span class="keyword">, </span><span class="default">LDAP_OPT_PROTOCOL_VERSION</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">)) {<br />
&nbsp;&nbsp; echo </span><span class="string">"Using LDAPv3"</span><span class="keyword">;<br />
} else {<br />
&nbsp;&nbsp; echo </span><span class="string">"Failed to set protocol version to 3"</span><span class="keyword">;<br />
}<br />
<br />
if (</span><span class="default">$ldapconn</span><span class="keyword">) {<br />
<br />
&nbsp;&nbsp; </span><span class="comment">// binding to ldap server<br />
&nbsp;&nbsp; </span><span class="default">$ldapbind </span><span class="keyword">= </span><span class="default">ldap_bind</span><span class="keyword">(</span><span class="default">$ldapconn</span><span class="keyword">, </span><span class="default">$ldaprdn</span><span class="keyword">, </span><span class="default">$ldappass</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; </span><span class="comment">// verify binding<br />
&nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$ldapbind</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; echo </span><span class="string">"LDAP bind successful..."</span><span class="keyword">;<br />
&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; echo </span><span class="string">"LDAP bind failed..."</span><span class="keyword">;<br />
&nbsp;&nbsp; }<br />
<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="38640""></a>
  <div class="note">
   <strong class="user">pete dot rowley at example dot com</strong>
   <a href="#38640" class="date">31-Dec-2003 05:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You should NOT attempt to bind with a made up password.&nbsp; However small the chance, the chance remains that your code produces a valid password.&nbsp; The correct behaviour is to test for an empty password, and if your application will only service authenticated users, not perform any more LDAP operations on behalf of the user - this also happens to be more efficient.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="27039""></a>
  <div class="note">
   <strong class="user">kokheng at jhs dot com dot sg</strong>
   <a href="#27039" class="date">21-Nov-2002 10:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
OpenLdap 2.1.x libraries support both LDAPv2 and LDAPv3. The problem lies with the slapd, the ldap server bundled with OpenLDAP.&nbsp; It's default supported version is LDAPv3. One can set the "allow bind_v2" in the slapd.conf file, with this configured, the PHP ldap_set_option() is not required.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="25555""></a>
  <div class="note">
   <strong class="user">elvisciousatrmci.net</strong>
   <a href="#25555" class="date">27-Sep-2002 08:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I ran into a problem where I was getting a protocol error when I tried to bind.&nbsp; I was able to connect fine and ldap commands worked fine from the command line.&nbsp; <br />
<br />
The problem turned out to be that openldap (v 2.1.5) was starting up in version 3 ldap mode, and php (4.2.3) expected it to be in version 2 mode.<br />
<br />
To fix this use the ldap_set_option command to change the version that php expects.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="21289""></a>
  <div class="note">
   <strong class="user">naujocke at nospam dot abacusii dot com</strong>
   <a href="#21289" class="date">07-May-2002 06:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
One useful item when trying to bind to Novell's NDS LDAP servers.<br />
<br />
If you are using NDS 8 and attempt to bind it will work with a partail context.<br />
<br />
As an example if you full context is cn=user.ou=sales.ou=division.o=company <br />
and you use as your authentication context cn=user.o=company it will work.<br />
<br />
But you will be required to supply the full context to authenticate to an eDirectory based LDAP setup. Such as Netware 6 or eDirectory 8.5 or greater.<br />
<br />
Also when using the wildcard * symbol in your object class. If you are not careful it is possible to dump the entire contents of your NDS tree into an array.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="19388""></a>
  <div class="note">
   <strong class="user">tpiper at pinnacle dot couk</strong>
   <a href="#19388" class="date">26-Feb-2002 04:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
An example to help you authenticate against M$ Exchange, rather than use anonymous mode...<br />
<br />
you will need to create an NT domain member (I've called it ldapquery) and give it search permission in the LDAP protocol settings in Exchange.<br />
<br />
then:<br />
$ds=ldap_connect ("&lt;exchange server&gt;");&nbsp; <br />
$r=@ldap_bind($ds,"cn=ldapquery, o=&lt;your organisation&gt;, c=&lt;your country&gt;, ","&lt;the password for ldapquery account&gt;");<br />
<br />
we've tested this on Exchange 5.5SP3.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
