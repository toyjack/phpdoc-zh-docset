<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>对已编码的 URL 字符串进行解码</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.parse-url.html">? parse_url</a></li>
      <li style="float: right;"><a href="function.rawurlencode.html">rawurlencode ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.url.html">URL 函数</a></li>
    <li>对已编码的 URL 字符串进行解码</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.rawurldecode" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">rawurldecode</h1>
  <p class="verinfo">(PHP 4, PHP 5, PHP 7)</p><p class="refpurpose"><span class="refname">rawurldecode</span> &mdash; <span class="dc-title">对已编码的 URL 字符串进行解码</span></p>

 </div>
 
  <div class="refsect1 description" id="refsect1-function.rawurldecode-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">string</span> <span class="methodname"><strong>rawurldecode</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$str</code></span>
   )</div>

  <p class="para rdfs-comment">
   返回字符串，此字符串中百分号（<em>%</em>）后跟两位十六进制数的序列都将被替换成原义字符。
  </p>
 </div>

 
  <div class="refsect1 parameters" id="refsect1-function.rawurldecode-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">str</code></dt>

     <dd>

      <p class="para">
       要解码的 URL。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


  <div class="refsect1 returnvalues" id="refsect1-function.rawurldecode-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   返回解码后的 URL 字符串。
  </p>
 </div>


  <div class="refsect1 examples" id="refsect1-function.rawurldecode-examples">
  <h3 class="title">范例</h3>
  <p class="para">
   <div class="example" id="example-4503">
    <p><strong>Example #1 <span class="function"><strong>rawurldecode()</strong></span> 示例</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">rawurldecode</span><span style="color: #007700">(</span><span style="color: #DD0000">'foo%20bar%40baz'</span><span style="color: #007700">);&nbsp;</span><span style="color: #FF8000">//&nbsp;foo&nbsp;bar@baz<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 notes" id="refsect1-function.rawurldecode-notes">
  <h3 class="title">注释</h3>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
   <span class="function"><strong>rawurldecode()</strong></span> 不会把加号（&#039;+&#039;）解码为空格，而
    <span class="function"><a href="function.urldecode.html" class="function">urldecode()</a></span> 可以。
   </p>
  </p></blockquote>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.rawurldecode-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.rawurlencode.html" class="function" rel="rdfs-seeAlso">rawurlencode()</a> - 按照 RFC 3986 对 URL 进行编码</span></li>
    <li class="member"><span class="function"><a href="function.urldecode.html" class="function" rel="rdfs-seeAlso">urldecode()</a> - 解码已编码的 URL 字符串</span></li>
    <li class="member"><span class="function"><a href="function.urlencode.html" class="function" rel="rdfs-seeAlso">urlencode()</a> - 编码 URL 字符串</span></li>
    <li class="member"><a href="http://www.faqs.org/rfcs/rfc3986" class="link external" title="Link : http://www.faqs.org/rfcs/rfc3986">&raquo;&nbsp;RFC 3986</a></li>
   </ul>
  </p>
 </div>

 
</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="114205""></a>
  <div class="note">
   <strong class="user">jakub dot lopuszanski at nasza-klasa dot pl</strong>
   <a href="#114205" class="date">24-Jan-2014 04:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Be aware that rawurldecode does not warn you in any way if the output is nonvalid UTF-8.<br />
For example if the input passed to the function is just "%C5", then since C is 1100 in binary, and UTF-8 characters starting with 110 should be followed by another character, the result of rawurldecode will be just a single byte (with value \xC5) which is not a correct UTF-8.<br />
Confront this with for example Javascript which will warn you about it:<br />
<br />
JAVASCRIPT:<br />
<br />
decodeURI("%C5")<br />
URIError: URI malformed<br />
<br />
decodeURIComponent("%C5")<br />
URIError: URI malformed<br />
<br />
unescape("%C5")<br />
"?"<br />
<br />
PHP:<br />
var_dump(rawurldecode("%C5"))<br />
string(1) "?"<br />
<br />
php -v<br />
PHP 5.3.6 (cli) (built: Oct&nbsp; 4 2012 10:19:07)<br />
Copyright (c) 1997-2011 The PHP Group<br />
Zend Engine v2.3.0, Copyright (c) 1998-2011 Zend Technologies<br />
&nbsp;&nbsp;&nbsp; with Suhosin v0.9.32.1, Copyright (c) 2007-2010, by SektionEins GmbH</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92029""></a>
  <div class="note">
   <strong class="user">Cagivaracer</strong>
   <a href="#92029" class="date">06-Jul-2009 01:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Please note that the combination encodeURIComponent (Javascript) and rawurldecode (PHP) only works well if magic quotes are turned off in php.ini (magic_quotes_gpc = Off)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="80209""></a>
  <div class="note">
   <strong class="user">Javier A. Segura at gmail dot com</strong>
   <a href="#80209" class="date">04-Jan-2008 09:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hi everybody =) My name is Javier and I'm from Argentina.<br />
I've had a little issue with latin characters like ?","?","á","é","í", etc.<br />
They are not decoded with rawurlencode(), so I've made this:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">urlRawDecode</span><span class="keyword">(</span><span class="default">$raw_url_encoded</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment"># Hex conversion table<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$hex_table </span><span class="keyword">= array(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">0 </span><span class="keyword">=&gt; </span><span class="default">0x00</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">1 </span><span class="keyword">=&gt; </span><span class="default">0x01</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">2 </span><span class="keyword">=&gt; </span><span class="default">0x02</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">3 </span><span class="keyword">=&gt; </span><span class="default">0x03</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">4 </span><span class="keyword">=&gt; </span><span class="default">0x04</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">5 </span><span class="keyword">=&gt; </span><span class="default">0x05</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">6 </span><span class="keyword">=&gt; </span><span class="default">0x06</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">7 </span><span class="keyword">=&gt; </span><span class="default">0x07</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">8 </span><span class="keyword">=&gt; </span><span class="default">0x08</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">9 </span><span class="keyword">=&gt; </span><span class="default">0x09</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"A"</span><span class="keyword">=&gt; </span><span class="default">0x0a</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"B"</span><span class="keyword">=&gt; </span><span class="default">0x0b</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"C"</span><span class="keyword">=&gt; </span><span class="default">0x0c</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"D"</span><span class="keyword">=&gt; </span><span class="default">0x0d</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"E"</span><span class="keyword">=&gt; </span><span class="default">0x0e</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"F"</span><span class="keyword">=&gt; </span><span class="default">0x0f<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment"># Fixin' latin character problem<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">preg_match_all</span><span class="keyword">(</span><span class="string">"/\%C3\%([A-Z0-9]{2})/i"</span><span class="keyword">, </span><span class="default">$raw_url_encoded</span><span class="keyword">,</span><span class="default">$res</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$res </span><span class="keyword">= </span><span class="default">array_unique</span><span class="keyword">(</span><span class="default">$res </span><span class="keyword">= </span><span class="default">$res</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$arr_unicoded </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$res </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$arr_unicoded</span><span class="keyword">[] = </span><span class="default">chr</span><span class="keyword">(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (</span><span class="default">0xc0 </span><span class="keyword">| (</span><span class="default">$hex_table</span><span class="keyword">[</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">)]&lt;&lt;</span><span class="default">4</span><span class="keyword">)) <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | (</span><span class="default">0x03 </span><span class="keyword">&amp; </span><span class="default">$hex_table</span><span class="keyword">[</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">)])<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; );<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$res</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">] = </span><span class="string">"%C3%" </span><span class="keyword">. </span><span class="default">$value</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$raw_url_encoded </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$res</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$arr_unicoded</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$raw_url_encoded<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment"># Return decoded&nbsp; raw url encoded data <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">rawurldecode</span><span class="keyword">(</span><span class="default">$raw_url_encoded</span><span class="keyword">);<br />
}<br />
<br />
print </span><span class="default">urlRawDecode</span><span class="keyword">(</span><span class="string">"%C3%A1%C3%B1"</span><span class="keyword">);<br />
<br />
</span><span class="comment">// output:<br />
// á?<br />
<br />
</span><span class="default">?&gt;<br />
</span>For example, you have the character "?" encoded like this "%C3%B1". <br />
This is nothing more and nothing less than 0xc3 and 0xb1, <br />
they are binary numbers, (HHHH LLLL, where HHHH=High and LLLL=Low).<br />
0xc3 = 1100 0011 (binary 8 bit word), 0xb1 = 1011 0001 (binary 8 bit word),<br />
To convert a raw encoded character to ascii we have to make boolean operations<br />
between this two operands (0xc3 and 0xb1), boolean algebra were defined by George&nbsp; <br />
Boole, we need to use them here. The first one we going to use is the <br />
logical OR ("|" or "pipe") and logical AND ("&amp;" or "and person").<br />
<br />
A logical OR implies the following truth table:<br />
a b (a OR b)<br />
0 0&nbsp; &nbsp;&nbsp; 0<br />
0 1&nbsp; &nbsp;&nbsp; 1&nbsp;&nbsp; (a OR b or Both, a and b, must be true to get a true result)<br />
1 0&nbsp; &nbsp;&nbsp; 1<br />
1 1&nbsp; &nbsp;&nbsp; 1<br />
<br />
A logical AND implies the following truth table:<br />
a b (a AND b)<br />
0 0&nbsp; &nbsp;&nbsp; 0<br />
0 1&nbsp; &nbsp;&nbsp; 0&nbsp;&nbsp; <br />
1 0&nbsp; &nbsp;&nbsp; 0<br />
1 1&nbsp; &nbsp;&nbsp; 1&nbsp;&nbsp; (Both a AND b, must be true to get a true result)<br />
<br />
So, here we have to make a logical OR with both 0xc3 and 0xb1 HIGH nibble,<br />
a nibble is a half byte (4 bits), so we have to make a logical OR between <br />
1100 (0xc) and 1011 (0xb), we going to get this: 1111 (0xf), then we have to make<br />
a logical AND between both LOW nibble, 0011 (0x3) and 0001 (0x1), we going to get <br />
this: 0001, so, if we want to see the final result, we have to put HIGH and LOW <br />
nibble on his Byte position, like this: 1111 0001 (0xf1) and that is nothing <br />
more and nothing less than "?" (to check this out, try the following: print(chr(0xf1));).<br />
<br />
This "&lt;&lt;" is a logical shift left, if we have this binary number 0001 (1) and we make this:<br />
0001 &lt;&lt; 2 we'll get 0100 (4) right bits are filled with 0's.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment"># Conversion example %C3%B1 to ASCII (0x71)<br />
</span><span class="keyword">print(<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">chr</span><span class="keyword">(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (</span><span class="default">0xc0</span><span class="keyword">|</span><span class="default">0x0b</span><span class="keyword">&lt;&lt;</span><span class="default">4</span><span class="keyword">) | (</span><span class="default">0x03</span><span class="keyword">&amp;</span><span class="default">0x01</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; )<br />
);<br />
<br />
</span><span class="comment">// Output will be:<br />
// ?<br />
<br />
// 1100 0000 OR 1011 0000 = 1111 0000 (0xf0)<br />
// 0000 0011 AND 0000 0001 = 0000 0001 (0x01)<br />
// 1111 0000 OR 0000 0001 = 1111 0001 (0xf1)<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
PS: I'm so sorry about my english, I know, is horrible :P</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="80208""></a>
  <div class="note">
   <strong class="user">Javier A. Segura at gmail dot com</strong>
   <a href="#80208" class="date">04-Jan-2008 09:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hi everybody =) My name is Javier and I'm from Argentina.<br />
I've had a little issue with latin characters like ?","?","á","é","í", etc.<br />
They are not decoded with rawurlencode(), so I've made this:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">urlRawDecode</span><span class="keyword">(</span><span class="default">$raw_url_encoded</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment"># Hex conversion table<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$hex_table </span><span class="keyword">= array(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">0 </span><span class="keyword">=&gt; </span><span class="default">0x00</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">1 </span><span class="keyword">=&gt; </span><span class="default">0x01</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">2 </span><span class="keyword">=&gt; </span><span class="default">0x02</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">3 </span><span class="keyword">=&gt; </span><span class="default">0x03</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">4 </span><span class="keyword">=&gt; </span><span class="default">0x04</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">5 </span><span class="keyword">=&gt; </span><span class="default">0x05</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">6 </span><span class="keyword">=&gt; </span><span class="default">0x06</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">7 </span><span class="keyword">=&gt; </span><span class="default">0x07</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">8 </span><span class="keyword">=&gt; </span><span class="default">0x08</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">9 </span><span class="keyword">=&gt; </span><span class="default">0x09</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"A"</span><span class="keyword">=&gt; </span><span class="default">0x0a</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"B"</span><span class="keyword">=&gt; </span><span class="default">0x0b</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"C"</span><span class="keyword">=&gt; </span><span class="default">0x0c</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"D"</span><span class="keyword">=&gt; </span><span class="default">0x0d</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"E"</span><span class="keyword">=&gt; </span><span class="default">0x0e</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"F"</span><span class="keyword">=&gt; </span><span class="default">0x0f<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment"># Fixin' latin character problem<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">preg_match_all</span><span class="keyword">(</span><span class="string">"/\%C3\%([A-Z0-9]{2})/i"</span><span class="keyword">, </span><span class="default">$raw_url_encoded</span><span class="keyword">,</span><span class="default">$res</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$res </span><span class="keyword">= </span><span class="default">array_unique</span><span class="keyword">(</span><span class="default">$res </span><span class="keyword">= </span><span class="default">$res</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$arr_unicoded </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$res </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$arr_unicoded</span><span class="keyword">[] = </span><span class="default">chr</span><span class="keyword">(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (</span><span class="default">0xc0 </span><span class="keyword">| (</span><span class="default">$hex_table</span><span class="keyword">[</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">)]&lt;&lt;</span><span class="default">4</span><span class="keyword">)) <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | (</span><span class="default">0x03 </span><span class="keyword">&amp; </span><span class="default">$hex_table</span><span class="keyword">[</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">)])<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; );<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$res</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">] = </span><span class="string">"%C3%" </span><span class="keyword">. </span><span class="default">$value</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$raw_url_encoded </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$res</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$arr_unicoded</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$raw_url_encoded<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment"># Return decoded&nbsp; raw url encoded data <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">rawurldecode</span><span class="keyword">(</span><span class="default">$raw_url_encoded</span><span class="keyword">);<br />
}<br />
<br />
print </span><span class="default">urlRawDecode</span><span class="keyword">(</span><span class="string">"%C3%A1%C3%B1"</span><span class="keyword">);<br />
<br />
</span><span class="comment">// output:<br />
// á?<br />
<br />
</span><span class="default">?&gt;<br />
</span>For example, you have the character "?" encoded like this "%C3%B1". <br />
This is nothing more and nothing less than 0xc3 and 0xb1, <br />
they are binary numbers, (HHHH LLLL, where HHHH=High and LLLL=Low).<br />
0xc3 = 1100 0011 (binary 8 bit word), 0xb1 = 1011 0001 (binary 8 bit word),<br />
To convert a raw encoded character to ascii we have to make boolean operations<br />
between this two operands (0xc3 and 0xb1), boolean algebra were defined by George&nbsp; <br />
Boole, we need to use them here. The first one we going to use is the <br />
logical OR ("|" or "pipe") and logical AND ("&amp;" or "and person").<br />
<br />
A logical OR implies the following truth table:<br />
a b (a OR b)<br />
0 0&nbsp; &nbsp;&nbsp; 0<br />
0 1&nbsp; &nbsp;&nbsp; 1&nbsp;&nbsp; (a OR b or Both, a and b, must be true to get a true result)<br />
1 0&nbsp; &nbsp;&nbsp; 1<br />
1 1&nbsp; &nbsp;&nbsp; 1<br />
<br />
A logical AND implies the following truth table:<br />
a b (a AND b)<br />
0 0&nbsp; &nbsp;&nbsp; 0<br />
0 1&nbsp; &nbsp;&nbsp; 0&nbsp;&nbsp; <br />
1 0&nbsp; &nbsp;&nbsp; 0<br />
1 1&nbsp; &nbsp;&nbsp; 1&nbsp;&nbsp; (Both a AND b, must be true to get a true result)<br />
<br />
So, here we have to make a logical OR with both 0xc3 and 0xb1 HIGH nibble,<br />
a nibble is a half byte (4 bits), so we have to make a logical OR between <br />
1100 (0xc) and 1011 (0xb), we going to get this: 1111 (0xf), then we have to make<br />
a logical AND between both LOW nibble, 0011 (0x3) and 0001 (0x1), we going to get <br />
this: 0001, so, if we want to see the final result, we have to put HIGH and LOW <br />
nibble on his Byte position, like this: 1111 0001 (0xf1) and that is nothing <br />
more and nothing less than "?" (to check this out, try the following: print(chr(0xf1));).<br />
<br />
This "&lt;&lt;" is a logical shift left, if we have this binary number 0001 (1) and we make this:<br />
0001 &lt;&lt; 2 we'll get 0100 (4) right bits are filled with 0's.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment"># Conversion example %C3%B1 to ASCII (0x71)<br />
</span><span class="keyword">print(<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">chr</span><span class="keyword">(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (</span><span class="default">0xc0</span><span class="keyword">|</span><span class="default">0x0b</span><span class="keyword">&lt;&lt;</span><span class="default">4</span><span class="keyword">) | (</span><span class="default">0x03</span><span class="keyword">&amp;</span><span class="default">0x01</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; )<br />
);<br />
<br />
</span><span class="comment">// Output will be:<br />
// ?<br />
<br />
// 1100 0000 OR 1011 0000 = 1111 0000 (0xf0)<br />
// 0000 0011 AND 0000 0001 = 0000 0001 (0x01)<br />
// 1111 0000 OR 0000 0001 = 1111 0001 (0xf1)<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
PS: I'm so sorry about my english, I know, is horrible :P</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71142""></a>
  <div class="note">
   <strong class="user">Tomek Perlak [tomekperlak at tlen pl]</strong>
   <a href="#71142" class="date">14-Nov-2006 12:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Let's say you pass some data between the client and the server in a more or less array-like structure.<br />
<br />
If using the [] brackets in the field names is not enough (or won't comply with the rest of the project for some reason), you might have to use a string with a number of different delimiters (rows, fields, rows inside fields and such).<br />
<br />
To make sure that the data doesn't get mistaken for delimiters, you can use the encodeURIComponent() JavaScript function. It pairs nicely with rawurldecode().<br />
<br />
Once the string passed to the server side finally gets exploded into an array (or set of such), you could use the following function to recursively rawurldecode the array(s):<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">rawurldecode_array</span><span class="keyword">(&amp;</span><span class="default">$arr</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">array_keys</span><span class="keyword">(</span><span class="default">$arr</span><span class="keyword">) as </span><span class="default">$key</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$arr</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">]))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">rawurldecode_array</span><span class="keyword">(</span><span class="default">$arr</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$arr</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">] = </span><span class="default">rawurldecode</span><span class="keyword">(</span><span class="default">$arr</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">$a</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] = </span><span class="default">rawurlencode</span><span class="keyword">(</span><span class="string">"2+1:3?9"</span><span class="keyword">);<br />
</span><span class="default">$a</span><span class="keyword">[</span><span class="string">"k"</span><span class="keyword">] = </span><span class="default">rawurlencode</span><span class="keyword">(</span><span class="string">"@:-/"</span><span class="keyword">);<br />
</span><span class="default">$a</span><span class="keyword">[-</span><span class="default">3</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">] = </span><span class="default">rawurlencode</span><span class="keyword">(</span><span class="string">"+"</span><span class="keyword">);<br />
</span><span class="default">$a</span><span class="keyword">[-</span><span class="default">3</span><span class="keyword">][</span><span class="default">2</span><span class="keyword">] = </span><span class="default">rawurlencode</span><span class="keyword">(</span><span class="string">"=_~"</span><span class="keyword">);<br />
</span><span class="default">$a</span><span class="keyword">[-</span><span class="default">3</span><span class="keyword">][</span><span class="string">"a"</span><span class="keyword">] = </span><span class="default">rawurlencode</span><span class="keyword">(</span><span class="string">"this+is a%test"</span><span class="keyword">);<br />
<br />
echo </span><span class="string">"&lt;pre&gt;"</span><span class="keyword">; </span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">); echo </span><span class="string">"&lt;/pre&gt;"</span><span class="keyword">;<br />
<br />
</span><span class="default">rawurldecode_array</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">);<br />
<br />
echo </span><span class="string">"&lt;pre&gt;"</span><span class="keyword">; </span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">); echo </span><span class="string">"&lt;/pre&gt;"</span><span class="keyword">;<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
The program will output:<br />
<br />
Array<br />
(<br />
&nbsp;&nbsp;&nbsp; [0] =&gt; 2%2B1%3A3%3F9<br />
&nbsp;&nbsp;&nbsp; [k] =&gt; %40%3A-%2F<br />
&nbsp;&nbsp;&nbsp; [-3] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [0] =&gt; %2B<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [2] =&gt; %3D_%7E<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [a] =&gt; this%2Bis%20a%25test<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
)<br />
<br />
Array<br />
(<br />
&nbsp;&nbsp;&nbsp; [0] =&gt; 2+1:3?9<br />
&nbsp;&nbsp;&nbsp; [k] =&gt; @:-/<br />
&nbsp;&nbsp;&nbsp; [-3] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [0] =&gt; +<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [2] =&gt; =_~<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [a] =&gt; this+is a%test<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="53108""></a>
  <div class="note">
   <strong class="user">php dot net at hiddemann dot org</strong>
   <a href="#53108" class="date">23-May-2005 11:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To sum it up: the only difference of this function to the urldecode function is that the "+" character won't get translated.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
