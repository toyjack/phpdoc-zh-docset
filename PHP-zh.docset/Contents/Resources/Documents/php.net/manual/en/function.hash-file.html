<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>使用给定文件的内容生成哈希值</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.hash-equals.html">? hash_equals</a></li>
      <li style="float: right;"><a href="function.hash-final.html">hash_final ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.hash.html">Hash 函数</a></li>
    <li>使用给定文件的内容生成哈希值</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.hash-file" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">hash_file</h1>
  <p class="verinfo">(PHP 5 &gt;= 5.1.2, PECL hash &gt;= 1.1)</p><p class="refpurpose"><span class="refname">hash_file</span> &mdash; <span class="dc-title">使用给定文件的内容生成哈希值</span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.hash-file-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">string</span> <span class="methodname"><strong>hash_file</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$algo</code></span>
   , <span class="methodparam"><span class="type">string</span> <code class="parameter">$filename</code></span>
   [, <span class="methodparam"><span class="type">bool</span> <code class="parameter">$raw_output</code><span class="initializer"> = false</span></span>
  ] )</div>


 </div>

 <div class="refsect1 parameters" id="refsect1-function.hash-file-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">algo</code></dt>

     <dd>

      <p class="para">
       要使用的哈希算法的名称，例如：&quot;md5&quot;，&quot;sha256&quot;，&quot;haval160,4&quot; 等。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">filename</code></dt>

     <dd>

      <p class="para">
       要进行哈希运算的文件路径。支持 fopen 封装器。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">raw_output</code></dt>

     <dd>

      <p class="para">
       设置为 <strong><code>TRUE</code></strong>，输出格式为原始的二进制数据。
       设置为 <strong><code>FALSE</code></strong>，输出小写的 16 进制字符串。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.hash-file-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   如果 <code class="parameter">raw_output</code> 设置为 <strong><code>TRUE</code></strong>， 则返回原始二进制数据表示的信息摘要，
   否则返回 16 进制小写字符串格式表示的信息摘要。
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.hash-file-examples">
  <h3 class="title">范例</h3>
  <p class="para">
   <div class="example" id="example-842">
    <p><strong>Example #1 使用 <span class="function"><strong>hash_file()</strong></span></strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">/*&nbsp;创建一个要计算哈希值的文件&nbsp;*/<br /></span><span style="color: #0000BB">file_put_contents</span><span style="color: #007700">(</span><span style="color: #DD0000">'example.txt'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'The&nbsp;quick&nbsp;brown&nbsp;fox&nbsp;jumped&nbsp;over&nbsp;the&nbsp;lazy&nbsp;dog.'</span><span style="color: #007700">);<br /><br />echo&nbsp;</span><span style="color: #0000BB">hash_file</span><span style="color: #007700">(</span><span style="color: #DD0000">'md5'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'example.txt'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>以上例程会输出：</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
5c6ffbdd40d9556b73a21e63c3e0e904
</pre></div>
    </div>
   </div>
  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.hash-file-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.hash.html" class="function" rel="rdfs-seeAlso">hash()</a> - 生成哈希值 （消息摘要）</span></li>
    <li class="member"><span class="function"><a href="function.hash-hmac-file.html" class="function" rel="rdfs-seeAlso">hash_hmac_file()</a> - 使用 HMAC 方法和给定文件的内容生成带密钥的哈希值</span></li>
    <li class="member"><span class="function"><a href="function.hash-update-file.html" class="function" rel="rdfs-seeAlso">hash_update_file()</a> - 从文件向活跃的哈希运算上下文中填充数据</span></li>
    <li class="member"><span class="function"><a href="function.md5-file.html" class="function" rel="rdfs-seeAlso">md5_file()</a> - 计算指定文件的 MD5 散列值</span></li>
    <li class="member"><span class="function"><a href="function.sha1-file.html" class="function" rel="rdfs-seeAlso">sha1_file()</a> - 计算文件的 sha1 散列值</span></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="109259""></a>
  <div class="note">
   <strong class="user">holdoffhunger at gmail dot com</strong>
   <a href="#109259" class="date">30-Jun-2012 10:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The Hash_File() function returns the same value as if the function Hash() had been performed on the same exact piece of data.&nbsp; At first, I was uncertain if Hash_File() used the filename, or even the permission settings, when defining the data to be hashed for the given algorithm.&nbsp; If it did work that way, then that means the same exact files would have different HASH values when you moved or renamed them on your system.&nbsp; Anyway, fortunately, it does not work that way.&nbsp; Hash() and Hash_File() produce identical results for the same pieces of data.&nbsp; This is also true for the relationship between the Hash_HMAC() and Hash_HMAC_File() functions: the same pieces of data, the same keys, produce identical results.&nbsp; It was a wise, design principle.<br />
<br />
Some sample code to demonstrate this principle :<br />
<br />
<span class="default">&lt;?php<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Author: holdoffhunger@gmail.com<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // Preset Data<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // ------------------------------------------------<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$test_data </span><span class="keyword">= </span><span class="string">"php-hashing"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$test_file </span><span class="keyword">= </span><span class="string">"test.txt"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$test_file_read </span><span class="keyword">= </span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="default">$test_file</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Hash Data<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // ------------------------------------------------<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$test_data_hash </span><span class="keyword">= </span><span class="default">hash</span><span class="keyword">(</span><span class="string">"md2"</span><span class="keyword">, </span><span class="default">$test_data</span><span class="keyword">, </span><span class="default">FALSE</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$test_file_hash </span><span class="keyword">= </span><span class="default">hash_file</span><span class="keyword">(</span><span class="string">"md2"</span><span class="keyword">, </span><span class="default">$test_file</span><span class="keyword">, </span><span class="default">FALSE</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Print Hash Results<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // ------------------------------------------------<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">print(</span><span class="string">"Data Hash (</span><span class="default">$test_data</span><span class="string">): </span><span class="default">$test_data_hash</span><span class="string">&lt;br&gt;&lt;br&gt;"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; print(</span><span class="string">"File Hash (</span><span class="default">$test_file_read</span><span class="string">): </span><span class="default">$test_file_hash</span><span class="string">"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
</span><span class="default">?&gt;<br />
</span><br />
&nbsp;&nbsp;&nbsp; Expected Results<br />
&nbsp;&nbsp;&nbsp; ..................................<br />
&nbsp;&nbsp;&nbsp; <br />
Data Hash (php-hashing): 457d84e1d69e519a7b73348db21477d3<br />
<br />
File Hash (php-hashing): 457d84e1d69e519a7b73348db21477d3</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="104836""></a>
  <div class="note">
   <strong class="user">apm at domain itsmee.co.uk</strong>
   <a href="#104836" class="date">10-Jul-2011 01:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I have verified that the output of the "crc32" is the ITU I.363.5 algorithm (a.k.a. AAL5 CRC - popularised by BZIP2 but also used in ATM transmissions - the algorithm is the same as that in POSIX 1003.2-1992 in Cksum but that stuffs the size into the CRC at the end for extra measure).&nbsp; However, the output is expressed in reverse order to many CRC programs.&nbsp; Using the "standard" crctest.txt (numbers 1 to 9 in sequence - google it, it's not hard to find), php will output 181989fc - many other (Intel little endian) programs would output this as fc891918, hence the confusion (that I have had, at least).<br />
<br />
The crc32b is the 32-bit Frame Check Sequence of ITU V.42 (used in Ethernet and popularised by PKZip).&nbsp; The output from this CRC is popularised in Intel little endian format and would produce cbf43926 on the same file.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="103656""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#103656" class="date">26-Apr-2011 06:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Please take note that hash-file will throw error on files &gt;=2GB.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100061""></a>
  <div class="note">
   <strong class="user">chernyshevsky at hotmail dot com</strong>
   <a href="#100061" class="date">23-Sep-2010 01:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to use hash_file() to get the CRC32 value of a file, use the following to unpack the hex string returned by the function to an integer (similar to crc32()):<br />
<br />
$hash = hash_file('crc32b', $filepath);<br />
$array = unpack('N', pack('H*', $hash));<br />
$crc32 = $array[1];</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85672""></a>
  <div class="note">
   <strong class="user">Keisial at gmail dot com</strong>
   <a href="#85672" class="date">11-Sep-2008 08:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The 'octets reversed' you are seeing is the bug 45028 which has been fixed. <a href="http://bugs.php.net/bug.php?id=45028" rel="nofollow" target="_blank">http://bugs.php.net/bug.php?id=45028</a><br />
<br />
The difference between crc32 and crc32b is explained on mhash man page. crc32 is the one used on ethernet, while crc32b is the one used on zip, png... They differ on the table used.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84653""></a>
  <div class="note">
   <strong class="user">allaryin at gmail dot com</strong>
   <a href="#84653" class="date">24-Jul-2008 12:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For those who are wondering, there appears to be no fundamental difference between hash_file('md5')/hash_file('sha1') and md5_file()/sha1_file(). They produce identical output and have comparable performance.<br />
<br />
There is, however, a difference between hash_file('crc32') and something silly like crc32(file_get_contents()).<br />
<br />
crc32(file_get_contents())'s results are most similar to those of hash_file('crc32b'), just with the octets reversed:<br />
<br />
<span class="default">&lt;?php<br />
$fname </span><span class="keyword">= </span><span class="string">"something.png"</span><span class="keyword">;<br />
<br />
</span><span class="default">$hash </span><span class="keyword">= </span><span class="default">hash_file</span><span class="keyword">( </span><span class="string">'crc32'</span><span class="keyword">, </span><span class="default">$fname </span><span class="keyword">);<br />
echo </span><span class="string">"crc32&nbsp; = </span><span class="default">$hash</span><span class="string">\n"</span><span class="keyword">;<br />
<br />
</span><span class="default">$hash </span><span class="keyword">= </span><span class="default">hash_file</span><span class="keyword">( </span><span class="string">'crc32b'</span><span class="keyword">, </span><span class="default">$fname </span><span class="keyword">);<br />
echo </span><span class="string">"crc32b = </span><span class="default">$hash</span><span class="string">\n"</span><span class="keyword">;<br />
<br />
</span><span class="default">$hash </span><span class="keyword">= </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">"%x"</span><span class="keyword">,</span><span class="default">crc32</span><span class="keyword">(</span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="default">$fname</span><span class="keyword">)));<br />
echo </span><span class="string">"manual = </span><span class="default">$hash</span><span class="string">\n"</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
crc32&nbsp; = f41d7f4e<br />
crc32b = 7dafbba4<br />
manual = a4bbaf7d</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
