<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>Microsoft SQL Server</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.msql.html">? msql</a></li>
      <li style="float: right;"><a href="intro.mssql.html">简介 ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="refs.database.vendors.html">针对各数据库系统对应的扩展</a></li>
    <li>Microsoft SQL Server</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="book.mssql" class="book">
 
 <h1 class="title">Microsoft SQL Server</h1>
 
 
 
 
 
 
 







 





 


 





<ul class="chunklist chunklist_book"><li><a href="intro.mssql.html">简介</a></li><li><a href="mssql.setup.html">安装／配置</a><ul class="chunklist chunklist_book chunklist_children"><li><a href="mssql.requirements.html">需求</a></li><li><a href="mssql.installation.html">安装</a></li><li><a href="mssql.configuration.html">运行时配置</a></li><li><a href="mssql.resources.html">资源类型</a></li></ul></li><li><a href="mssql.constants.html">预定义常量</a></li><li><a href="ref.mssql.html">Mssql 函数</a><ul class="chunklist chunklist_book chunklist_children"><li><a href="function.mssql-bind.html">mssql_bind</a> &mdash; Adds a parameter to a stored procedure or a remote stored procedure</li><li><a href="function.mssql-close.html">mssql_close</a> &mdash; Close MS SQL Server connection</li><li><a href="function.mssql-connect.html">mssql_connect</a> &mdash; Open MS SQL server connection</li><li><a href="function.mssql-data-seek.html">mssql_data_seek</a> &mdash; Moves internal row pointer</li><li><a href="function.mssql-execute.html">mssql_execute</a> &mdash; Executes a stored procedure on a MS SQL server database</li><li><a href="function.mssql-fetch-array.html">mssql_fetch_array</a> &mdash; Fetch a result row as an associative array, a numeric array, or both</li><li><a href="function.mssql-fetch-assoc.html">mssql_fetch_assoc</a> &mdash; Returns an associative array of the current row in the result</li><li><a href="function.mssql-fetch-batch.html">mssql_fetch_batch</a> &mdash; Returns the next batch of records</li><li><a href="function.mssql-fetch-field.html">mssql_fetch_field</a> &mdash; Get field information</li><li><a href="function.mssql-fetch-object.html">mssql_fetch_object</a> &mdash; Fetch row as object</li><li><a href="function.mssql-fetch-row.html">mssql_fetch_row</a> &mdash; Get row as enumerated array</li><li><a href="function.mssql-field-length.html">mssql_field_length</a> &mdash; Get the length of a field</li><li><a href="function.mssql-field-name.html">mssql_field_name</a> &mdash; Get the name of a field</li><li><a href="function.mssql-field-seek.html">mssql_field_seek</a> &mdash; Seeks to the specified field offset</li><li><a href="function.mssql-field-type.html">mssql_field_type</a> &mdash; Gets the type of a field</li><li><a href="function.mssql-free-result.html">mssql_free_result</a> &mdash; Free result memory</li><li><a href="function.mssql-free-statement.html">mssql_free_statement</a> &mdash; Free statement memory</li><li><a href="function.mssql-get-last-message.html">mssql_get_last_message</a> &mdash; Returns the last message from the server</li><li><a href="function.mssql-guid-string.html">mssql_guid_string</a> &mdash; Converts a 16 byte binary GUID to a string</li><li><a href="function.mssql-init.html">mssql_init</a> &mdash; Initializes a stored procedure or a remote stored procedure</li><li><a href="function.mssql-min-error-severity.html">mssql_min_error_severity</a> &mdash; Sets the minimum error severity</li><li><a href="function.mssql-min-message-severity.html">mssql_min_message_severity</a> &mdash; Sets the minimum message severity</li><li><a href="function.mssql-next-result.html">mssql_next_result</a> &mdash; Move the internal result pointer to the next result</li><li><a href="function.mssql-num-fields.html">mssql_num_fields</a> &mdash; Gets the number of fields in result</li><li><a href="function.mssql-num-rows.html">mssql_num_rows</a> &mdash; Gets the number of rows in result</li><li><a href="function.mssql-pconnect.html">mssql_pconnect</a> &mdash; Open persistent MS SQL connection</li><li><a href="function.mssql-query.html">mssql_query</a> &mdash; Send MS SQL query</li><li><a href="function.mssql-result.html">mssql_result</a> &mdash; Get result data</li><li><a href="function.mssql-rows-affected.html">mssql_rows_affected</a> &mdash; Returns the number of records affected by the query</li><li><a href="function.mssql-select-db.html">mssql_select_db</a> &mdash; Select MS SQL database</li></ul></li></ul></div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="107056""></a>
  <div class="note">
   <strong class="user">bryanpiercecap at gmail dot com</strong>
   <a href="#107056" class="date">03-Jan-2012 07:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is version 3.0 of the MSSQL PHP driver.<br />
1.1 is severely deprecated. <br />
<br />
<a href="http://www.microsoft.com/download/en/details.aspx?id=17308" rel="nofollow" target="_blank">http://www.microsoft.com/download/en/details.aspx?id=17308</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100283""></a>
  <div class="note">
   <strong class="user">jezza at 9000internets dot com</strong>
   <a href="#100283" class="date">06-Oct-2010 03:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Using the new MS driver I have come across a difference between the array that I get back compared to mssql.
<br />

<br />
Example is here (both return types are associative arrays:
<br />

<br />
sqlsrv_fetch_array($resource, SQLSRV_FETCH_ASSOC)
<br />
"same as" sqlsrv_fetch($resource), as this returns by default an associative array, by default sqlsrv_fetch_array returns both an associative and a numeric array.
<br />

<br />
returns...
<br />

<br />
array(6) { ["yaxis"]=&gt; object(DateTime)#58 (3) { ["date"]=&gt; string(19) "2010-09-29 00:00:00" ["timezone_type"]=&gt; int(3) ["timezone"]=&gt; string(19) "Australia/Melbourne" } ["xaxis"]=&gt; string(7) "Inbound" ["tt"]=&gt; int(280345) ["ht"]=&gt; int(297219) ["wt"]=&gt; int(16874) ["calls"]=&gt; int(1539) } string(8) ""
<br />

<br />
mssql_fetch_assoc($resource)
<br />

<br />
returns
<br />

<br />
array(6) { ["yaxis"]=&gt; string(19) "2010-09-29 00:00:00" ["xaxis"]=&gt; string(7) "Inbound" ["tt"]=&gt; int(280345) ["ht"]=&gt; int(297219) ["wt"]=&gt; int(16874) ["calls"]=&gt; int(1539) } string(8) ""
<br />

<br />
it would be much too difficult to change a large number of applications to compensate for this.
<br />

<br />
Found my answer...
<br />
add this to your connection objects parameters on instantiation
<br />

<br />
"ReturnDatesAsStrings"=&gt;true
<br />

<br />
Found it buried in this article: <a href="http://msdn.microsoft.com/en-us/library/ee376928(SQL.90" rel="nofollow" target="_blank">http://msdn.microsoft.com/en-us/library/ee376928(SQL.90</a>).aspx</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100219""></a>
  <div class="note">
   <strong class="user">vexx at pisem dot net</strong>
   <a href="#100219" class="date">02-Oct-2010 12:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
this function get inserted ident like function mysql_insert_id()
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">mssql_insert_id</span><span class="keyword">() {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$id </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$res </span><span class="keyword">= </span><span class="default">mssql_query</span><span class="keyword">(</span><span class="string">"SELECT @@identity AS id"</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$row </span><span class="keyword">= </span><span class="default">mysql_fetch_array</span><span class="keyword">(</span><span class="default">$res</span><span class="keyword">, </span><span class="default">MYSQL_ASSOC</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$id </span><span class="keyword">= </span><span class="default">$row</span><span class="keyword">[</span><span class="string">"id"</span><span class="keyword">];
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$id</span><span class="keyword">;
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="96059""></a>
  <div class="note">
   <strong class="user">beartenor1</strong>
   <a href="#96059" class="date">05-Feb-2010 09:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As of October 2009, the new name is "SQL Server Driver for PHP 1.1"<br />
<br />
Go to Microsoft Download Center <a href="http://www.microsoft.com/downloads and search " rel="nofollow" target="_blank">http://www.microsoft.com/downloads and search </a><br />
for "SQL Server Driver for PHP" which should take you to the following link:<br />
<br />
<a href="http://www.microsoft.com/downloads/details.aspx?displaylang=en" rel="nofollow" target="_blank">http://www.microsoft.com/downloads/details.aspx?displaylang=en</a><br />
&amp;FamilyID=ccdf728b-1ea0-48a8-a84a-5052214caad9<br />
<br />
But I wouldn't trust it to stay there. Microsoft has been moving a lot of download links lately.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93355""></a>
  <div class="note">
   <strong class="user">tummen at jgd dot se</strong>
   <a href="#93355" class="date">05-Sep-2009 12:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
i struggled with sqlsrv_connect for some time, first i had to get native client 2008 to get it to work, 2005 was not enough.<br />
<br />
then i got som note that dll was compiled with wrong version, so i had to use test version 1.1 istead of 1.0 of the client and pick the version called php_sqlsrv_53_ts_vc6.dll<br />
<br />
but still no success with connect.<br />
<br />
finally i spent 7 hours testing things before i found out:<br />
<br />
$serverName = "(local)"; ERROR for me<br />
<br />
$serverName = "localhost\myinstansofdatabase"; //WOHOOOO</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93003""></a>
  <div class="note">
   <strong class="user">michal dot kocarek at brainbox dot cz</strong>
   <a href="#93003" class="date">19-Aug-2009 11:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Microsoft has issued in nearly past Native SQL driver for PHP.<br />
This driver works with MSSQL 2000, 2005 and 2008 servers. Driver is issued as PHP extension. Source codes also available.<br />
<br />
The driver supports native conversion to UTF-8, scrollable cursors and other features which this (old) library does not.<br />
<br />
For more information and extension download please see<br />
<a href="http://www.codeplex.com/SQLSRVPHP" rel="nofollow" target="_blank">http://www.codeplex.com/SQLSRVPHP</a><br />
They have also blog on <a href="http://blogs.msdn.com/sqlphp/" rel="nofollow" target="_blank">http://blogs.msdn.com/sqlphp/</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92929""></a>
  <div class="note">
   <strong class="user">ccsalway at yahoo dot co dot uk</strong>
   <a href="#92929" class="date">15-Aug-2009 09:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Im running PHP 5.3 and used the php development ini and when I use the Microsoft SQL for PHP driver, I get the following error:<br />
<br />
[15-Aug-2009 07:48:13] PHP Warning:&nbsp; PHP Startup: sqlsrv: Unable to initialize module<br />
Module compiled with module API=20060613<br />
PHP&nbsp; &nbsp; compiled with module API=20090626<br />
These options need to match<br />
&nbsp;in Unknown on line 0</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92722""></a>
  <div class="note">
   <strong class="user">exidas at madnes dot eu</strong>
   <a href="#92722" class="date">05-Aug-2009 09:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hi, i was need some short and simple script to list all tables and columns of MSSQL database. There was nothing easy to explain on the net, so i've decided to share my short script, i hope it will help.
<br />

<br />
<span class="default">&lt;?php
<br />
$all </span><span class="keyword">= </span><span class="default">MSSQL_Query</span><span class="keyword">(</span><span class="string">"select TABLE_NAME, COLUMN_NAME from INFORMATION_SCHEMA.COLUMNS order by TABLE_NAME, ORDINAL_POSITION"</span><span class="keyword">);
<br />

<br />
</span><span class="default">$tables </span><span class="keyword">= array();
<br />
</span><span class="default">$columns </span><span class="keyword">= array();
<br />

<br />
while(</span><span class="default">$fet_tbl </span><span class="keyword">= </span><span class="default">MSSQL_Fetch_Assoc</span><span class="keyword">(</span><span class="default">$all</span><span class="keyword">)) { </span><span class="comment">// PUSH ALL TABLES AND COLUMNS INTO THE ARRAY
<br />

<br />
&nbsp; </span><span class="default">$tables</span><span class="keyword">[] = </span><span class="default">$fet_tbl</span><span class="keyword">[</span><span class="default">TABLE_NAME</span><span class="keyword">];
<br />
&nbsp; </span><span class="default">$columns</span><span class="keyword">[] = </span><span class="default">$fet_tbl</span><span class="keyword">[</span><span class="default">COLUMN_NAME</span><span class="keyword">];
<br />

<br />
}
<br />

<br />
</span><span class="default">$sltml </span><span class="keyword">= </span><span class="default">array_count_values</span><span class="keyword">(</span><span class="default">$tables</span><span class="keyword">); </span><span class="comment">// HOW MANY COLUMNS ARE IN THE TABLE
<br />

<br />
</span><span class="keyword">foreach(</span><span class="default">$sltml </span><span class="keyword">as </span><span class="default">$table_name </span><span class="keyword">=&gt; </span><span class="default">$id</span><span class="keyword">) {
<br />
&nbsp;
<br />
&nbsp;echo </span><span class="string">"&lt;h2&gt;"</span><span class="keyword">. </span><span class="default">$table_name </span><span class="keyword">.</span><span class="string">" ("</span><span class="keyword">. </span><span class="default">$id </span><span class="keyword">.</span><span class="string">")&lt;/h2&gt;&lt;ol&gt;"</span><span class="keyword">;
<br />
&nbsp;
<br />
&nbsp;&nbsp;&nbsp; for(</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt;= </span><span class="default">$id</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"&lt;li&gt;"</span><span class="keyword">. </span><span class="default">$columns</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] .</span><span class="string">"&lt;/li&gt;"</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp; echo</span><span class="string">"&lt;/ol&gt;"</span><span class="keyword">;
<br />
&nbsp;
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91261""></a>
  <div class="note">
   <strong class="user">opc dot three at gmail dot com</strong>
   <a href="#91261" class="date">02-Jun-2009 05:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
After extensive research trying to get PHP on Linux communicating with SQL Server 2005 and 2008 including support for all Unicode, MAX and XML data types I could not find any open source solutions...yes, I spent a lot of time trying to get FreeTDS to work to no avail.<br />
<br />
I found one free solution that runs on Windows which is to use the "SQL Server Driver for PHP" provided by Microsoft (<a href="http://sql2k5php.codeplex.com" rel="nofollow" target="_blank">http://sql2k5php.codeplex.com</a>). The driver relies on the Microsoft Native Client ODBC drivers for SQL Server 2008 (part of the "Microsoft SQL Server 2008 Native Client" which is downloadable from Microsoft) which is why this solution will not work on anything except Windows.<br />
<br />
I did find a solution that works for PHP on Linux but it's not free...use the standard PHP::ODBC lib (free) and the Easysoft ODBC driver for SQL Server (not free, but reasonable by Enterprise standards). You can check out the ODBC driver by going here <a href="http://www.easysoft.com/products/data_access and looking for " rel="nofollow" target="_blank">http://www.easysoft.com/products/data_access and looking for </a>"Easysoft ODBC-SQL Server Driver"</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="90669""></a>
  <div class="note">
   <strong class="user">thanhha dot phan at yahoo dot com</strong>
   <a href="#90669" class="date">04-May-2009 04:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I got a serious problem with Unicode data when working with PHP and MSSQL. I have to say the PHP and MSSQL doesn't seem to be a good combination.<br />
<br />
MSSQL is really complicated to work with since the whole server uses a single character encoding[ucs-2]. In order to store unicode information, the column data types must be specified as one of the national character types, NVARCHAR, NCHAR or NTEXT. <br />
<br />
In order to retrieve data saved in unicode format, M$ suggest users to cast columns to binary data.Unfortunately php_mssql extension doesn't support&nbsp; binary data to be returned in string columns.<br />
<br />
My advice is to use FreeTDS driver [it's just an php extension]. This driver seems to handle unicode data better. I can put and receive unicode with casting or change encoding.<br />
<br />
A good tutorial "Using freeTDS" can be found here<br />
<br />
<a href="http://docs.moodle.org/en/Installing_MSSQL_for_PHP" rel="nofollow" target="_blank">http://docs.moodle.org/en/Installing_MSSQL_for_PHP</a><br />
<br />
However, freeTDS is not a perfect solution for unicode data. I'm not able to execute stored procedures with mssql_bind, mssql_bind without having my text changed.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="89509""></a>
  <div class="note">
   <strong class="user">AA</strong>
   <a href="#89509" class="date">11-Mar-2009 09:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
On windows, do not use this for mssql 2005 of later.&nbsp; The methods of access are deprecated.<br />
<br />
Use the Microsoft SQL Server 2005 Driver for PHP instead.<br />
Current link is.<br />
<a href="http://www.microsoft.com/sqlserver/2005/en/us/PHP-Driver.aspx" rel="nofollow" target="_blank">http://www.microsoft.com/sqlserver/2005/en/us/PHP-Driver.aspx</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
