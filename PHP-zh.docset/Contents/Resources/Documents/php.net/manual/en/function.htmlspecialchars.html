<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>Convert special characters to HTML entities</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.htmlspecialchars-decode.html">? htmlspecialchars_decode</a></li>
      <li style="float: right;"><a href="function.implode.html">implode ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.strings.html">字符串 函数</a></li>
    <li>Convert special characters to HTML entities</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.htmlspecialchars" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">htmlspecialchars</h1>
  <p class="verinfo">(PHP 4, PHP 5, PHP 7)</p><p class="refpurpose"><span class="refname">htmlspecialchars</span> &mdash; <span class="dc-title">Convert special characters to HTML entities</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-function.htmlspecialchars-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">string</span> <span class="methodname"><strong>htmlspecialchars</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$string</code></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$flags</code><span class="initializer"> = ENT_COMPAT | ENT_HTML401</span></span>
   [, <span class="methodparam"><span class="type">string</span> <code class="parameter">$encoding</code><span class="initializer"> = ini_get(&quot;default_charset&quot;)</span></span>
   [, <span class="methodparam"><span class="type">bool</span> <code class="parameter">$double_encode</code><span class="initializer"> = true</span></span>
  ]]] )</div>

  <p class="para rdfs-comment">
   Certain characters have special significance in HTML, and should
   be represented by HTML entities if they are to preserve their
   meanings. This function returns a string with these
   conversions made. If you require all input substrings that have associated
   named entities to be translated, use <span class="function"><a href="function.htmlentities.html" class="function">htmlentities()</a></span>
   instead.
  </p>
  <p class="para">
   If the input string passed to this function and the final document share the
   same character set, this function is sufficient to prepare input for
   inclusion in most contexts of an HTML document. If, however, the input can
   represent characters that are not coded in the final document character set
   and you wish to retain those characters (as numeric or named entities),
   both this function and <span class="function"><a href="function.htmlentities.html" class="function">htmlentities()</a></span> (which only encodes
   substrings that have named entity equivalents) may be insufficient.
   You may have to use <span class="function"><a href="function.mb-encode-numericentity.html" class="function">mb_encode_numericentity()</a></span> instead.
  </p>
  <p class="para">
   The translations performed are:
   <ul class="itemizedlist">
    <li class="listitem">
     <span class="simpara">
      &#039;&amp;&#039; (ampersand) becomes &#039;&amp;amp;&#039;
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      &#039;&quot;&#039; (double quote) becomes &#039;&amp;quot;&#039; when <strong><code>ENT_NOQUOTES</code></strong>
      is not set.
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      &quot;&#039;&quot; (single quote) becomes &#039;&amp;#039;&#039; (or &amp;apos;)
      only when <strong><code>ENT_QUOTES</code></strong> is set.
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      &#039;&lt;&#039; (less than) becomes &#039;&amp;lt;&#039;
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      &#039;&gt;&#039; (greater than) becomes &#039;&amp;gt;&#039;
     </span>
    </li>
   </ul>
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.htmlspecialchars-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">string</code></dt>

     <dd>

      <p class="para">
       The <span class="type"><a href="language.types.string.html" class="type string">string</a></span> being converted.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">flags</code></dt>

     <dd>

      <p class="para">
       A bitmask of one or more of the following flags, which specify how to handle quotes,
       invalid code unit sequences and the used document type. The default is
       <em>ENT_COMPAT | ENT_HTML401</em>.
       <table class="doctable table">
        <caption><strong>Available <code class="parameter">flags</code> constants</strong></caption>
        
         <thead>
          <tr>
           <th>Constant Name</th>
           <th>Description</th>
          </tr>

         </thead>

         <tbody class="tbody">
          <tr>
           <td><strong><code>ENT_COMPAT</code></strong></td>
           <td>Will convert double-quotes and leave single-quotes alone.</td>
          </tr>

          <tr>
           <td><strong><code>ENT_QUOTES</code></strong></td>
           <td>Will convert both double and single quotes.</td>
          </tr>

          <tr>
           <td><strong><code>ENT_NOQUOTES</code></strong></td>
           <td>Will leave both double and single quotes unconverted.</td>
          </tr>

          <tr>
           <td><strong><code>ENT_IGNORE</code></strong></td>
           <td>
            Silently discard invalid code unit sequences instead of returning
            an empty string. Using this flag is discouraged as it
            <a href="http://unicode.org/reports/tr36/#Deletion_of_Noncharacters" class="link external" title="Link : http://unicode.org/reports/tr36/#Deletion_of_Noncharacters">&raquo;&nbsp;may have security implications</a>.
           </td>
          </tr>

          <tr>
           <td><strong><code>ENT_SUBSTITUTE</code></strong></td>
           <td>
            Replace invalid code unit sequences with a Unicode Replacement Character
            U+FFFD (UTF-8) or &amp;#FFFD; (otherwise) instead of returning an empty string.
           </td>
          </tr>

          <tr>
           <td><strong><code>ENT_DISALLOWED</code></strong></td>
           <td>
            Replace invalid code points for the given document type with a
            Unicode Replacement Character U+FFFD (UTF-8) or &amp;#FFFD;
            (otherwise) instead of leaving them as is. This may be useful, for
            instance, to ensure the well-formedness of XML documents with
            embedded external content.
           </td>
          </tr>

          <tr>
           <td><strong><code>ENT_HTML401</code></strong></td>
           <td>
            Handle code as HTML 4.01.
           </td>
          </tr>

          <tr>
           <td><strong><code>ENT_XML1</code></strong></td>
           <td>
            Handle code as XML 1.
           </td>
          </tr>

          <tr>
           <td><strong><code>ENT_XHTML</code></strong></td>
           <td>
            Handle code as XHTML.
           </td>
          </tr>

          <tr>
           <td><strong><code>ENT_HTML5</code></strong></td>
           <td>
            Handle code as HTML 5.
           </td>
          </tr>

         </tbody>
        
       </table>

      </p>
     </dd>

    
    
     <dt>
<code class="parameter">encoding</code></dt>

     <dd>

      
 <p class="para">
  An optional argument defining the encoding used when converting characters.
 </p>

 <p class="para">
  If omitted, the default value of the <code class="parameter">encoding</code> varies
  depending on the PHP version in use. In PHP 5.6 and later, the
  <a href="ini.core.html#ini.default-charset" class="link">default_charset</a> configuration
  option is used as the default value. PHP 5.4 and 5.5 will use
  <em>UTF-8</em> as the default. Earlier versions of PHP use
  <em>ISO-8859-1</em>.
 </p>

 <p class="para">
  Although this argument is technically optional, you are highly encouraged to
  specify the correct value for your code if you are using PHP 5.5 or earlier,
  or if your <a href="ini.core.html#ini.default-charset" class="link">default_charset</a>
  configuration option may be set incorrectly for the given input.
 </p>

      <p class="para">
       For the purposes of this function, the encodings
       <em>ISO-8859-1</em>, <em>ISO-8859-15</em>,
       <em>UTF-8</em>, <em>cp866</em>,
       <em>cp1251</em>, <em>cp1252</em>, and
       <em>KOI8-R</em> are effectively equivalent, provided the
       <code class="parameter">string</code> itself is valid for the encoding, as
       the characters affected by <span class="function"><strong>htmlspecialchars()</strong></span> occupy
       the same positions in all of these encodings.
      </p>
      


<p class="para">
 支持以下字符集：
 <table class="doctable table">
  <caption><strong>支持的字符集列表</strong></caption>
  
   <thead>
    <tr>
     <th>字符集</th>
     <th>别名</th>
     <th>描述</th>
    </tr>

   </thead>

   <tbody class="tbody">
    <tr>
     <td>ISO-8859-1</td>
     <td>ISO8859-1</td>
     <td>
      西欧，Latin-1
     </td>
    </tr>

    <tr>
     <td>ISO-8859-5</td>
     <td>ISO8859-5</td>
     <td>
      Little used cyrillic charset (Latin/Cyrillic).
     </td>
    </tr>

    <tr>
     <td>ISO-8859-15</td>
     <td>ISO8859-15</td>
     <td>
      西欧，Latin-9。增加欧元符号，法语和芬兰语字母在 Latin-1(ISO-8859-1) 中缺失。
     </td>
    </tr>

    <tr>
     <td>UTF-8</td>
     <td class="empty">&nbsp;</td>
     <td>
      ASCII 兼容的多字节 8 位 Unicode。
     </td>
    </tr>

    <tr>
     <td>cp866</td>
     <td>ibm866, 866</td>
     <td>
      DOS 特有的西里尔编码。本字符集在 4.3.2 版本中得到支持。
     </td>
    </tr>

    <tr>
     <td>cp1251</td>
     <td>Windows-1251, win-1251, 1251</td>
     <td>
      Windows 特有的西里尔编码。本字符集在 4.3.2 版本中得到支持。
     </td>
    </tr>

    <tr>
     <td>cp1252</td>
     <td>Windows-1252, 1252</td>
     <td>
      Windows 特有的西欧编码。
     </td>
    </tr>

    <tr>
     <td>KOI8-R</td>
     <td>koi8-ru, koi8r</td>
     <td>
      俄语。本字符集在 4.3.2 版本中得到支持。
     </td>
    </tr>

    <tr>
     <td>BIG5</td>
     <td>950</td>
     <td>
      繁体中文，主要用于中国台湾省。
     </td>
    </tr>

    <tr>
     <td>GB2312</td>
     <td>936</td>
     <td>
      简体中文，中国国家标准字符集。
     </td>
    </tr>

    <tr>
     <td>BIG5-HKSCS</td>
     <td class="empty">&nbsp;</td>
     <td>
      繁体中文，附带香港扩展的 Big5 字符集。
     </td>
    </tr>

    <tr>
     <td>Shift_JIS</td>
     <td>SJIS, 932</td>
     <td>
      日语
     </td>
    </tr>

    <tr>
     <td>EUC-JP</td>
     <td>EUCJP</td>
     <td>
      日语
     </td>
    </tr>

    <tr>
     <td>MacRoman</td>
     <td class="empty">&nbsp;</td>
     <td>
      Mac OS 使用的字符串。
     </td>
    </tr>

    <tr>
     <td><em>&#039;&#039;</em></td>
     <td class="empty">&nbsp;</td>
     <td>
      An empty string activates detection from script encoding (Zend multibyte),
      <a href="ini.core.html#ini.default-charset" class="link">default_charset</a> and current
      locale (see <span class="function"><a href="function.nl-langinfo.html" class="function">nl_langinfo()</a></span> and
      <span class="function"><a href="function.setlocale.html" class="function">setlocale()</a></span>), in this order. Not recommended.
     </td>
    </tr>

   </tbody>
  
 </table>

 <blockquote class="note"><p><strong class="note">Note</strong>: 
  <span class="simpara">
   其他字符集没有认可。将会使用默认编码并抛出异常。
  </span>
 </p></blockquote>
</p>


     </dd>

    
    
     <dt>
<code class="parameter">double_encode</code></dt>

     <dd>

      <p class="para">
       When <code class="parameter">double_encode</code> is turned off PHP will not
       encode existing html entities, the default is to convert everything.
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.htmlspecialchars-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   The converted <span class="type"><a href="language.types.string.html" class="type string">string</a></span>.
  </p>
  <p class="para">
   If the input <code class="parameter">string</code> contains an invalid code unit
   sequence within the given <code class="parameter">encoding</code> an empty string
   will be returned, unless either the <strong><code>ENT_IGNORE</code></strong> or
   <strong><code>ENT_SUBSTITUTE</code></strong> flags are set.
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.htmlspecialchars-changelog">
  <h3 class="title">更新日志</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead>
      <tr>
       <th>版本</th>
       <th>说明</th>
      </tr>

     </thead>

     <tbody class="tbody">
      
 <tr>
  <td>5.6.0</td>
  <td>
   The default value for the <code class="parameter">encoding</code> parameter was
   changed to be the value of the
   <a href="ini.core.html#ini.default-charset" class="link">default_charset</a> configuration
   option.
  </td>
 </tr>


      <tr>
       <td>5.4.0</td>
       <td>
        The default value for the <code class="parameter">encoding</code> parameter was
        changed to UTF-8.
       </td>
      </tr>

      <tr>
       <td>5.4.0</td>
       <td>
        The constants <strong><code>ENT_SUBSTITUTE</code></strong>, <strong><code>ENT_DISALLOWED</code></strong>,
        <strong><code>ENT_HTML401</code></strong>, <strong><code>ENT_XML1</code></strong>,
        <strong><code>ENT_XHTML</code></strong> and <strong><code>ENT_HTML5</code></strong> were added.
       </td>
      </tr>

      <tr>
       <td>5.3.0</td>
       <td>
        The constant <strong><code>ENT_IGNORE</code></strong> was added.
       </td>
      </tr>

      <tr>
       <td>5.2.3</td>
       <td>
        The <code class="parameter">double_encode</code> parameter was added.
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.htmlspecialchars-examples">
  <h3 class="title">范例</h3>
  <p class="para">
   <div class="example" id="example-5247">
    <p><strong>Example #1 <span class="function"><strong>htmlspecialchars()</strong></span> example</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$new&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">htmlspecialchars</span><span style="color: #007700">(</span><span style="color: #DD0000">"&lt;a&nbsp;href='test'&gt;Test&lt;/a&gt;"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">ENT_QUOTES</span><span style="color: #007700">);<br />echo&nbsp;</span><span style="color: #0000BB">$new</span><span style="color: #007700">;&nbsp;</span><span style="color: #FF8000">//&nbsp;&amp;lt;a&nbsp;href=&amp;#039;test&amp;#039;&amp;gt;Test&amp;lt;/a&amp;gt;<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 notes" id="refsect1-function.htmlspecialchars-notes">
  <h3 class="title">注释</h3>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    Note that this function does not translate anything beyond what
    is listed above. For full entity translation, see
    <span class="function"><a href="function.htmlentities.html" class="function">htmlentities()</a></span>.
   </p>
  </p></blockquote>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.htmlspecialchars-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.get-html-translation-table.html" class="function" rel="rdfs-seeAlso">get_html_translation_table()</a> - 返回使用 htmlspecialchars 和 htmlentities 后的转换表</span></li>
    <li class="member"><span class="function"><a href="function.htmlspecialchars-decode.html" class="function" rel="rdfs-seeAlso">htmlspecialchars_decode()</a> - 将特殊的 HTML 实体转换回普通字符</span></li>
    <li class="member"><span class="function"><a href="function.strip-tags.html" class="function" rel="rdfs-seeAlso">strip_tags()</a> - 从字符串中去除 HTML 和 PHP 标记</span></li>
    <li class="member"><span class="function"><a href="function.htmlentities.html" class="function" rel="rdfs-seeAlso">htmlentities()</a> - Convert all applicable characters to HTML entities</span></li>
    <li class="member"><span class="function"><a href="function.nl2br.html" class="function" rel="rdfs-seeAlso">nl2br()</a> - 在字符串所有新行之前插入 HTML 换行标记</span></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="117290""></a>
  <div class="note">
   <strong class="user">PoV</strong>
   <a href="#117290" class="date">18-May-2015 08:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Be aware of the encoding of your source files!!! <br />
<br />
Some of the suggestions here make reference to workarounds where you hard-code an encoding.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp; </span><span class="keyword">echo </span><span class="default">htmlspecialchars</span><span class="keyword">(</span><span class="string">'&lt;b&gt;W?rmann&lt;/b&gt;'</span><span class="keyword">);&nbsp; </span><span class="comment">// Why isn't this working?<br />
</span><span class="default">?&gt;<br />
</span><br />
As it turns out, it may actually be your text editor that is to blame.<br />
<br />
As of PHP 5.4, htmlspecialchars now defaults to the UTF-8 encoding. That said, many text editors default to non-UTF encodings like ISO-8859-1 (i.e. Latin-1) or WIN-1252. If you change the encoding of the file to UTF-8, the code above will now work (i.e. the ? is encoded differently in UTF-8 and ISO-8859-1, and you need the UTF-8 version).<br />
<br />
Make sure you are editing in UTF-8 Unicode mode! Check your UI or manual for how to convert files to Unicode. It's also a good idea to figure out where to look in your UI to see what the current file encoding is.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="117116""></a>
  <div class="note">
   <strong class="user">Albert</strong>
   <a href="#117116" class="date">16-Apr-2015 11:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The code I posted this morning (for giving back to htmlspecialchars etc. the old default ISO encoding) had some strange problem, didn't work if a page was reloaded! Here the code I came up with, without this problem:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">if (</span><span class="default">version_compare</span><span class="keyword">(</span><span class="default">phpversion</span><span class="keyword">(), </span><span class="string">"5.3.3"</span><span class="keyword">, </span><span class="string">"&gt;"</span><span class="keyword">)) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">runkit_function_copy</span><span class="keyword">(</span><span class="string">'htmlspecialchars'</span><span class="keyword">, </span><span class="string">'htmlspecialchars_new'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">runkit_function_redefine</span><span class="keyword">(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'htmlspecialchars'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'$string, $flags, $encoding'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'return $encoding == "" ? htmlspecialchars_new($string, ENT_COMPAT | ENT_HTML401, "ISO-8859-1") : htmlspecialchars_new($string, $flags, $encoding);'<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">runkit_function_copy</span><span class="keyword">(</span><span class="string">'htmlentities'</span><span class="keyword">, </span><span class="string">'htmlentities_new'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">runkit_function_redefine</span><span class="keyword">(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'htmlentities'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'$string, $flags, $encoding'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'return $encoding == "" ? htmlentities_new($string, ENT_COMPAT | ENT_HTML401, "ISO-8859-1") : htmlentities_new($string, $flags, $encoding);'<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">runkit_function_copy</span><span class="keyword">(</span><span class="string">'html_entity_decode'</span><span class="keyword">, </span><span class="string">'html_entity_decode_new'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">runkit_function_redefine</span><span class="keyword">(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'html_entity_decode'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'$string, $flags, $encoding'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'return $encoding == "" ? html_entity_decode_new($string, ENT_COMPAT | ENT_HTML401, "ISO-8859-1") : html_entity_decode_new($string, $flags, $encoding);'<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
So first I copy the original function, then I redefine the same.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="117113""></a>
  <div class="note">
   <strong class="user">Albert</strong>
   <a href="#117113" class="date">16-Apr-2015 07:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I found a simple solution for the changed default character encoding in htmlspecialchars, htmlentities and html_entity_decode, so my (very) old code kept running:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">if (</span><span class="default">version_compare</span><span class="keyword">(</span><span class="default">phpversion</span><span class="keyword">(), </span><span class="string">"5.3.3"</span><span class="keyword">, </span><span class="string">"&gt;"</span><span class="keyword">)) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">runkit_function_rename</span><span class="keyword">(</span><span class="string">'htmlspecialchars'</span><span class="keyword">, </span><span class="string">'htmlspecialchars_new'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">runkit_function_add</span><span class="keyword">(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'htmlspecialchars'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'$string, $flags, $encoding'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'return $encoding == "" ? htmlspecialchars_new($string, ENT_COMPAT | ENT_HTML401, "ISO-8859-1") : htmlspecialchars_new($string, $flags, $encoding);'<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">runkit_function_rename</span><span class="keyword">(</span><span class="string">'htmlentities'</span><span class="keyword">, </span><span class="string">'htmlentities_new'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">runkit_function_add</span><span class="keyword">(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'htmlentities'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'$string, $flags, $encoding'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'return $encoding == "" ? htmlentities_new($string, ENT_COMPAT | ENT_HTML401, "ISO-8859-1") : htmlentities_new($string, $flags, $encoding);'<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">runkit_function_rename</span><span class="keyword">(</span><span class="string">'html_entity_decode'</span><span class="keyword">, </span><span class="string">'html_entity_decode_new'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">runkit_function_add</span><span class="keyword">(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'html_entity_decode'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'$string, $flags, $encoding'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'return $encoding == "" ? html_entity_decode_new($string, ENT_COMPAT | ENT_HTML401, "ISO-8859-1") : html_entity_decode_new($string, $flags, $encoding);'<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="115831""></a>
  <div class="note">
   <strong class="user">sascham78 at php dot net</strong>
   <a href="#115831" class="date">01-Oct-2014 05:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are using UTF-8 encoding with htmlspecialchars() you may experience blank values with certain language-specific characters i.e. spanish or portuguese "a?á". <br />
So instead of using<br />
<span class="default">&lt;?php<br />
$utf8encoded</span><span class="keyword">= </span><span class="default">htmlspecialchars</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">, </span><span class="default">ENT_QUOTES</span><span class="keyword">, </span><span class="string">'UTF-8'</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span>try <br />
<span class="default">&lt;?php<br />
$utf8encoded</span><span class="keyword">= </span><span class="default">utf8_encode</span><span class="keyword">(</span><span class="default">htmlspecialchars</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">, </span><span class="default">ENT_QUOTES</span><span class="keyword">));<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="114244""></a>
  <div class="note">
   <strong class="user">glapa.wojciech.com</strong>
   <a href="#114244" class="date">29-Jan-2014 01:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To show result in comment it should be:<br />
<br />
<span class="default">&lt;?php<br />
$new </span><span class="keyword">= </span><span class="default">htmlspecialchars</span><span class="keyword">(</span><span class="string">"&lt;a href='test'&gt;Test&lt;/a&gt;"</span><span class="keyword">, </span><span class="default">ENT_QUOTES</span><span class="keyword">);<br />
echo </span><span class="default">htmlspecialchars</span><span class="keyword">(</span><span class="default">$new</span><span class="keyword">); </span><span class="comment">// &amp;lt;a href=&amp;#039;test&amp;#039;&amp;gt;Test&amp;lt;/a&amp;gt;<br />
</span><span class="default">?&gt;<br />
</span><br />
...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="114085""></a>
  <div class="note">
   <strong class="user">Felix D.</strong>
   <a href="#114085" class="date">10-Jan-2014 08:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Another thing important to mention is that<br />
htmlspecialchars(NULL)<br />
returnes an empty string and not NULL!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="113373""></a>
  <div class="note">
   <strong class="user">support at playnext dot ru</strong>
   <a href="#113373" class="date">03-Oct-2013 05:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For those having problems after the change of default value of $encoding argument to UTF-8 since PHP 5.4.<br />
<br />
If your old non-UTF8 projects ruined - pls consider:<br />
1. <a href="http://php.net/manual/en/function.override-function.php" rel="nofollow" target="_blank">http://php.net/manual/en/function.override-function.php</a><br />
2. <a href="http://php.net/manual/ru/function.runkit-function-redefine.php" rel="nofollow" target="_blank">http://php.net/manual/ru/function.runkit-function-redefine.php</a><br />
<br />
The idea - you override the built-in htmlspecialchars() function with your customized variant which is able to respect non UTF-8 default encoding. This small piece of code can be then easily inserted somewhere at the start of yout project. No need to rewrite all htmlspecialchars() entries globally.<br />
<br />
I've spent several hours with both approaches. Variant 1 looks good especaially in combination with <a href="http://www.php.net/manual/en/function.rename-function.php as it allows to call original htmlspecialchars(" rel="nofollow" target="_blank">http://www.php.net/manual/en/function.rename-function.php as it allows to call original htmlspecialchars(</a>) with just altered default args. The code could be as follows:<br />
<br />
<span class="default">&lt;?php<br />
rename_function</span><span class="keyword">(</span><span class="string">'htmlspecialchars'</span><span class="keyword">, </span><span class="string">'renamed_htmlspecialchars'</span><span class="keyword">);<br />
function </span><span class="default">overriden_htmlspecialchars</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">, </span><span class="default">$flags</span><span class="keyword">=</span><span class="default">NULL</span><span class="keyword">, </span><span class="default">$encoding</span><span class="keyword">=</span><span class="string">'cp1251'</span><span class="keyword">, </span><span class="default">$double_encode</span><span class="keyword">=</span><span class="default">true</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$flags </span><span class="keyword">= </span><span class="default">$flags </span><span class="keyword">? </span><span class="default">$flags </span><span class="keyword">: (</span><span class="default">ENT_COMPAT</span><span class="keyword">|</span><span class="default">ENT_HTML401</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">renamed_htmlspecialchars</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">, </span><span class="default">$flags</span><span class="keyword">, </span><span class="default">$encoding</span><span class="keyword">, </span><span class="default">$double_encode</span><span class="keyword">);<br />
}<br />
</span><span class="default">override_function</span><span class="keyword">(</span><span class="string">'htmlspecialchars'</span><span class="keyword">, </span><span class="string">'$string, $flags, $encoding, $double_encode'</span><span class="keyword">, </span><span class="string">'return overriden_htmlspecialchars($string, $flags, $encoding, $double_encode);'</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Unfortunatelly this didn't work for me properly - my site managed to call overriden function but not every time I reloaded the pages. Moreover other PHP sites crashed under my Apache server as they suddenly started blaming htmlspecialchars() was not defined. I suppose I had to spend more time to make it work thread/request/site/whatever-safe.<br />
<br />
So I switched to runkit (variant 2). It worked for me, although even after trying runkit_function_rename()+runkit_function_add() I didn't managed to recall original htmlspecialchars() function. So as a quick solution I decided to call htmlentities() instead:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">overriden_htmlspecialchars</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">, </span><span class="default">$flags</span><span class="keyword">=</span><span class="default">NULL</span><span class="keyword">, </span><span class="default">$encoding</span><span class="keyword">=</span><span class="string">'UTF-8'</span><span class="keyword">, </span><span class="default">$double_encode</span><span class="keyword">=</span><span class="default">true</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$flags </span><span class="keyword">= </span><span class="default">$flags </span><span class="keyword">? </span><span class="default">$flags </span><span class="keyword">: (</span><span class="default">ENT_COMPAT</span><span class="keyword">|</span><span class="default">ENT_HTML401</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$encoding </span><span class="keyword">= </span><span class="default">$encoding </span><span class="keyword">? </span><span class="default">$encoding </span><span class="keyword">: </span><span class="string">'cp1251'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">htmlentities</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">, </span><span class="default">$flags</span><span class="keyword">, </span><span class="default">$encoding</span><span class="keyword">, </span><span class="default">$double_encode</span><span class="keyword">);<br />
}<br />
</span><span class="default">runkit_function_redefine</span><span class="keyword">(</span><span class="string">'htmlspecialchars'</span><span class="keyword">, </span><span class="string">'$string, $flags, $encoding, $double_encode'</span><span class="keyword">, </span><span class="string">'return overriden_htmlspecialchars($string, $flags, $encoding, $double_encode);'</span><span class="keyword">); <br />
</span><span class="default">?&gt;<br />
</span><br />
You may be able to implement your more powerfull overriden function.<br />
Good luck!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="112476""></a>
  <div class="note">
   <strong class="user">Dave</strong>
   <a href="#112476" class="date">20-Jun-2013 08:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As of PHP 5.4 they changed default encoding from "ISO-8859-1" to "UTF-8". So if you get null from htmlspecialchars or htmlentities<br />
<br />
where you have only set <br />
<span class="default">&lt;?php<br />
</span><span class="keyword">echo </span><span class="default">htmlspecialchars</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">);<br />
echo </span><span class="default">htmlentities</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
you can fix it by<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">echo </span><span class="default">htmlspecialchars</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">, </span><span class="default">ENT_COMPAT</span><span class="keyword">,</span><span class="string">'ISO-8859-1'</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
echo </span><span class="default">htmlentities</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">, </span><span class="default">ENT_COMPAT</span><span class="keyword">,</span><span class="string">'ISO-8859-1'</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span> <br />
<br />
On linux you can find the scripts you need to fix by<br />
<br />
grep -Rl "htmlspecialchars\\|htmlentities" /path/to/php/scripts/</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="112228""></a>
  <div class="note">
   <strong class="user">minder at ufive dot unibe dot ch</strong>
   <a href="#112228" class="date">19-May-2013 10:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Problem<br />
<br />
In many PHP legacy products the function htmlspecialchars($string) is used to convert characters like &lt; and &gt; and quotes a.s.o to HTML-entities. That avoids the interpretation of HTML Tags and asymmetric quote situations.<br />
<br />
Since PHP 5.4 for $string in htmlspecialchars($string) utf8 characters are expected if no charset is defined explicitly as third parameter in the function. Legacy products are mostly in Latin1 (alias iso-8859-1) what makes the functions htmlspecialchars(), htmlentites() and html_entity_decode() to return empty strings if a special character, e. g. a German Umlaut, is present in $string:<br />
<br />
PHP&lt;5.4<br />
<br />
echo htmlspecialchars('&lt;b&gt;Woermann&lt;/b&gt;') //Output: &amp;lt;b&amp;gt;Woermann&amp;lt;b&amp;gt;<br />
echo htmlspecialchars('W?rmann') //Output: &amp;lt;b&amp;gt;W?rmann&amp;lt;b&amp;gt;<br />
<br />
PHP=5.4<br />
<br />
echo htmlspecialchars('&lt;b&gt;Woermann&lt;/b&gt;') //Output: &amp;lt;b&amp;gt;Woermann&amp;lt;b&amp;gt;<br />
echo htmlspecialchars('&lt;b&gt;W?rmann&lt;/b&gt;') //Output: empty<br />
<br />
Three alternative solutions<br />
<br />
a) Not runnig legacy products on PHP 5.4<br />
b) Change all find spots in your code from <br />
htmlspecialchars($string) and *** to <br />
htmlspecialchars($string, ENT_COMPAT | ENT_HTML401, 'ISO-8859-1')<br />
c) Replace all htmlspecialchars() and *** with a new self-made function<br />
<br />
*** The same is true for htmlentities() and html_entity_decode();<br />
<br />
Solution c<br />
<br />
1 Make Search and Replace in the concerned legacy project:<br />
Search for:&nbsp; &nbsp; &nbsp; &nbsp; htmlspecialchars<br />
Replace with:&nbsp;&nbsp; htmlXspecialchars<br />
Search for:&nbsp; &nbsp; &nbsp; &nbsp; htmlentities<br />
Replace with:&nbsp;&nbsp; htmlXentities<br />
Search for:&nbsp; &nbsp; &nbsp; &nbsp; html_entity_decode<br />
Replace with:&nbsp;&nbsp; htmlX_entity_decode<br />
2a Copy and paste the following three functions into an existing already everywhere included PHP-file in your legacy project. (of course that PHP-file must be included only once per request, otherwise you will get a Redeclare Function Fatal Error).<br />
<br />
function htmlXspecialchars($string, $ent=ENT_COMPAT, $charset='ISO-8859-1') {<br />
return htmlspecialchars($string, $ent, $charset);<br />
}<br />
<br />
function htmlXentities($string, $ent=ENT_COMPAT, $charset='ISO-8859-1') {<br />
return htmlentities($string, $ent, $charset);<br />
}<br />
<br />
function htmlX_entity_decode($string, $ent=ENT_COMPAT, $charset='ISO-8859-1') {<br />
return html_entity_decode($string, $ent, $charset);<br />
}<br />
<br />
or 2b crate a new PHP-file containing the three functions mentioned above, let's say, z. B. htmlXfunctions.inc.php and include it on the first line of every PHP-file in your legacy product like this: require_once('htmlXfunctions.inc.php').</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="111666""></a>
  <div class="note">
   <strong class="user">Mike Robinson</strong>
   <a href="#111666" class="date">14-Mar-2013 09:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Unfortunately, as far as I can tell, the PHP devs did not provide ANY way to set the default encoding used by htmlspecialchars() or htmlentities(), even though they changed the default encoding in PHP 5.4 (*golf clap for PHP devs*). To save someone the time of trying it, this does not work:<br />
<br />
<span class="default">&lt;?php<br />
ini_set</span><span class="keyword">(</span><span class="string">'default_charset'</span><span class="keyword">, </span><span class="default">$charset</span><span class="keyword">); </span><span class="comment">// doesn't work.<br />
</span><span class="default">?&gt;<br />
</span><br />
Unfortunately, the only way to not have to explicitly provide the second and third parameter every single time this function is called (which gets extremely tedious) is to write your own function as a wrapper:<br />
<br />
<span class="default">&lt;?php<br />
define</span><span class="keyword">(</span><span class="string">'CHARSET'</span><span class="keyword">, </span><span class="string">'ISO-8859-1'</span><span class="keyword">);<br />
</span><span class="default">define</span><span class="keyword">(</span><span class="string">'REPLACE_FLAGS'</span><span class="keyword">, </span><span class="default">ENT_COMPAT </span><span class="keyword">| </span><span class="default">ENT_XHTML</span><span class="keyword">);<br />
<br />
function </span><span class="default">html</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">htmlspecialchars</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">, </span><span class="default">REPLACE_FLAGS</span><span class="keyword">, </span><span class="default">CHARSET</span><span class="keyword">);<br />
}<br />
<br />
echo </span><span class="default">html</span><span class="keyword">(</span><span class="string">"?"</span><span class="keyword">); </span><span class="comment">// works<br />
</span><span class="default">?&gt;<br />
</span><br />
You can do the same for htmlentities()</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="111596""></a>
  <div class="note">
   <strong class="user">strange dot alex at gmail dot com</strong>
   <a href="#111596" class="date">07-Mar-2013 02:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
&gt; For the purposes of this function, the encodings ISO-8859-1, ISO-8859-15, UTF-8, cp866, cp1251, cp1252, and KOI8-R are effectively equivalent, provided the string itself is valid for the encoding, as the characters affected by htmlspecialchars() occupy the same positions in all of these encodings. <br />
<br />
This is not true, actually!<br />
$txt = "Russian text in KOI8-r&lt;br&gt;"; // type here realy russian text in koi8-r !<br />
<br />
htmlspecialchars($txt,null,'KOI8-R') = Russian text in KOI8-r&lt;br&gt;<br />
htmlspecialchars($txt,null,'UTF-8') =<br />
&nbsp;Result is EMPTY !!!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="109062""></a>
  <div class="note">
   <strong class="user">odegroot+php at gmail dot com</strong>
   <a href="#109062" class="date">18-Jun-2012 06:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This function can be used to escape single quotes only, and not double quotes, by calling it as follows.<br />
<br />
<span class="default">&lt;?php $escaped_string </span><span class="keyword">= </span><span class="default">htmlspecialchars</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">, </span><span class="default">ENT_QUOTES </span><span class="keyword">&amp; ~</span><span class="default">ENT_COMPAT</span><span class="keyword">, </span><span class="default">$encoding</span><span class="keyword">); </span><span class="default">?&gt;<br />
</span><br />
This works because single/double quote escaping actually each have their own flag.<br />
<br />
#define ENT_HTML_QUOTE_NONE&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 0<br />
#define ENT_HTML_QUOTE_SINGLE&nbsp; &nbsp; &nbsp;&nbsp; 1<br />
#define ENT_HTML_QUOTE_DOUBLE&nbsp; &nbsp; &nbsp;&nbsp; 2<br />
<br />
#define ENT_COMPAT&nbsp; &nbsp; &nbsp; ENT_HTML_QUOTE_DOUBLE<br />
#define ENT_QUOTES&nbsp; &nbsp; &nbsp; (ENT_HTML_QUOTE_DOUBLE | ENT_HTML_QUOTE_SINGLE)<br />
#define ENT_NOQUOTES&nbsp; &nbsp; ENT_HTML_QUOTE_NONE<br />
<br />
Snippet from: php-src/ext/standard/html.h<br />
https://github.com/php/php-src/blob/master/ext/standard/html.h</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="106188""></a>
  <div class="note">
   <strong class="user">steve at mcdragonsoftware dot com</strong>
   <a href="#106188" class="date">18-Oct-2011 06:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I am working with xml and zip functions to create an xlsx document from a template. Just as I thought I had it finished it stopped working. After a bit of hunting I discovered my zip file began with php notices about undefined constant. I have no idea why my installation can't remember what ENT_XML1 is, it used to know it (or so I thought)<br />
<br />
To save anyone else this headache I recommend adding the code at the top of your scripts to verify that these constants are registered. Something like:<br />
<br />
defined( "ENT_XML1") or define( "ENT_XML1",&nbsp; &nbsp; &nbsp; &nbsp; 16&nbsp; &nbsp; );<br />
<br />
for each constant you use. Again, I don't know why this problem suddenly came up, but better safe than "Excel cannot open the file....... format... extension... corrupted... blah blah blah".<br />
<br />
cheers :)<br />
<br />
here's a list of the constant values (since they are not on this page) as taken from html.h for php5 <br />
<br />
#define ENT_HTML_QUOTE_NONE&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0<br />
#define ENT_HTML_QUOTE_SINGLE&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 1<br />
#define ENT_HTML_QUOTE_DOUBLE&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2<br />
#define ENT_HTML_IGNORE_ERRORS&nbsp; &nbsp; &nbsp; &nbsp; 4<br />
#define ENT_HTML_SUBSTITUTE_ERRORS&nbsp; &nbsp;&nbsp; 8<br />
#define ENT_HTML_DOC_TYPE_MASK&nbsp; &nbsp; &nbsp; &nbsp; (16|32)<br />
#define ENT_HTML_DOC_HTML401&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 0<br />
#define ENT_HTML_DOC_XML1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 16<br />
#define ENT_HTML_DOC_XHTML&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 32<br />
#define ENT_HTML_DOC_HTML5&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (16|32)<br />
/* reserve bit 6 */<br />
#define ENT_HTML_SUBSTITUTE_DISALLOWED_CHARS&nbsp; &nbsp; 128<br />
<br />
#define ENT_COMPAT&nbsp; &nbsp; &nbsp; &nbsp; ENT_HTML_QUOTE_DOUBLE<br />
#define ENT_QUOTES&nbsp; &nbsp; &nbsp; &nbsp; (ENT_HTML_QUOTE_DOUBLE | ENT_HTML_QUOTE_SINGLE)<br />
#define ENT_NOQUOTES&nbsp; &nbsp; ENT_HTML_QUOTE_NONE<br />
#define ENT_IGNORE&nbsp; &nbsp; &nbsp; &nbsp; ENT_HTML_IGNORE_ERRORS<br />
#define ENT_SUBSTITUTE&nbsp; &nbsp; ENT_HTML_SUBSTITUTE_ERRORS<br />
#define ENT_HTML401&nbsp; &nbsp; &nbsp; &nbsp; 0<br />
#define ENT_XML1&nbsp; &nbsp; &nbsp; &nbsp; 16<br />
#define ENT_XHTML&nbsp; &nbsp; &nbsp; &nbsp; 32<br />
#define ENT_HTML5&nbsp; &nbsp; &nbsp; &nbsp; (16|32)<br />
#define ENT_DISALLOWED&nbsp; &nbsp; 128</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="104433""></a>
  <div class="note">
   <strong class="user">ivan at lutrov dot com</strong>
   <a href="#104433" class="date">15-Jun-2011 10:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Be careful, the "charset" argument IS case sensitive. This is counter-intuitive and serves no practical purpose because the HTML spec actually has the opposite.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="103939""></a>
  <div class="note">
   <strong class="user">info at 8th dot at</strong>
   <a href="#103939" class="date">12-May-2011 08:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
English:
<br />
I'd found THE Final Solution!
<br />
it finds and replaces all unknown letters!
<br />
(like ?, ?, ü, ?, and much much more)
<br />

<br />
it turn em in a HTML AND XML compatible format
<br />

<br />
parameter: $text: a String with unsuported letters in it
<br />
return: a String where all unsupported(XML und HTML) letters are changed into the Unicode value (for example &amp;#196;)
<br />

<br />
Deutsch/German:
<br />
Ich hab die perfekte L?sung gefunden!
<br />
Es findet und tauscht alle unbekannten Buchstaben!
<br />
(wie ?, ?, ü, ?, und viel viel mehr)
<br />

<br />
es tauscht sie in ein HTML und XML kompatibles Format
<br />

<br />
parameter: $text: ein String mit nichtunterstüzten Buchstaben
<br />
return: ein String wo alle von XML und HTML ununterstützten Buchstaben ins Unicode-Format getauscht sind (z.B. &amp;#196;)
<br />

<br />
FUNCTION:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">umlaute</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">){
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$returnvalue</span><span class="keyword">=</span><span class="string">""</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">);</span><span class="default">$i</span><span class="keyword">++){
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$teil</span><span class="keyword">=</span><span class="default">hexdec</span><span class="keyword">(</span><span class="default">rawurlencode</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">)));
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$teil</span><span class="keyword">&lt;</span><span class="default">32</span><span class="keyword">||</span><span class="default">$teil</span><span class="keyword">&gt;</span><span class="default">1114111</span><span class="keyword">){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$returnvalue</span><span class="keyword">.=</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }else{
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$returnvalue</span><span class="keyword">.=</span><span class="string">"&amp;#"</span><span class="keyword">.</span><span class="default">$teil</span><span class="keyword">.</span><span class="string">";"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$returnvalue</span><span class="keyword">;
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102871""></a>
  <div class="note">
   <strong class="user">pinkgothic at gmail dot com</strong>
   <a href="#102871" class="date">11-Mar-2011 02:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Please note that this function results in an E_WARNING when display_errors is off and an invalid multibyte string is passed to it (e.g. with 'utf-8' as the encoding parameter and broken utf-8 characters somewhere in the string).<br />
<br />
This is ESPECIALLY IMPORTANT if you have an EXCEPTION-THROWING ERROR HANDLER, since even though you can't reproduce it in a development mode where display_errors is on, you MUST wrap your function call in a try-catch, or your application will crash.<br />
<br />
[ The reason PHP makes this distinction is because this is a core function and many production servers are misconfigured to have display_errors on (to prevent such things as path disclosure from error messages from accidentally cropping up). See: <a href="http://bugs.php.net/bug.php?id=47494 ]" rel="nofollow" target="_blank">http://bugs.php.net/bug.php?id=47494 ]</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="101592""></a>
  <div class="note">
   <strong class="user">Thomasvdbulk at gmail dot com</strong>
   <a href="#101592" class="date">28-Dec-2010 07:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
i searched for a while for a script, that could see the difference between an html tag and just &lt; and &gt; placed in the text, <br />
the reason is that i recieve text from a database,<br />
wich is inserted by an html form, and contains text and html tags, <br />
the text can contain &lt; and &gt;, so does the tags,<br />
with htmlspecialchars you can validate your text to XHTML,<br />
but you'll also change the tags, like &lt;b&gt; to &amp;lt;b&amp;gt;,<br />
so i needed a script that could see the difference between those two...<br />
but i couldn't find one so i made my own one, <br />
i havent fully tested it, but the parts i tested worked perfect!<br />
just for people that were searching for something like this,<br />
it may looks big, could be done easier, but it works for me, so im happy.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">fixtags</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">){<br />
</span><span class="default">$text </span><span class="keyword">= </span><span class="default">htmlspecialchars</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">);<br />
</span><span class="default">$text </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"/=/"</span><span class="keyword">, </span><span class="string">"=\"\""</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">);<br />
</span><span class="default">$text </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"/&amp;quot;/"</span><span class="keyword">, </span><span class="string">"&amp;quot;\""</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">);<br />
</span><span class="default">$tags </span><span class="keyword">= </span><span class="string">"/&amp;lt;(\/|)(\w*)(\ |)(\w*)([\\\=]*)(?|(\")\"&amp;quot;\"|)(?|(.*)?&amp;quot;(\")|)([\ ]?)(\/|)&amp;gt;/i"</span><span class="keyword">;<br />
</span><span class="default">$replacement </span><span class="keyword">= </span><span class="string">"&lt;$1$2$3$4$5$6$7$8$9$10&gt;"</span><span class="keyword">;<br />
</span><span class="default">$text </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="default">$tags</span><span class="keyword">, </span><span class="default">$replacement</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">);<br />
</span><span class="default">$text </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"/=\"\"/"</span><span class="keyword">, </span><span class="string">"="</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">);<br />
return </span><span class="default">$text</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
an example:<br />
<br />
<span class="default">&lt;?php<br />
$string </span><span class="keyword">= </span><span class="string">"<br />
this is smaller &lt; than this&lt;br /&gt; <br />
this is greater &gt; than this&lt;br /&gt;<br />
this is the same = as this&lt;br /&gt;<br />
&lt;a href=\"<a href="http://www.example.com/example.php?test=test" rel="nofollow" target="_blank">http://www.example.com/example.php?test=test</a>\"&gt;This is a link&lt;/a&gt;&lt;br /&gt;<br />
&lt;b&gt;Bold&lt;/b&gt; &lt;i&gt;italic&lt;/i&gt; etc..."</span><span class="keyword">;<br />
echo </span><span class="default">fixtags</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
will echo:<br />
this is smaller &amp;lt; than this&lt;br /&gt; <br />
this is greater &amp;gt; than this&lt;br /&gt; <br />
this is the same = as this&lt;br /&gt; <br />
&lt;a href="<a href="http://www.example.com/example.php?test=test" rel="nofollow" target="_blank">http://www.example.com/example.php?test=test</a>"&gt;This is a link&lt;/a&gt;&lt;br /&gt; <br />
&lt;b&gt;Bold&lt;/b&gt; &lt;i&gt;italic&lt;/i&gt; etc...<br />
<br />
I hope its helpfull!!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99185""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#99185" class="date">01-Aug-2010 10:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This may seem obvious, but if you want to output arbitrary (i.e. user-input) data as an attribute inside an HTML tag (such as the INPUT tags on a FORM), be aware of whether you are using ENT_QUOTES or ENT_COMPAT.&nbsp; If you're using ENT_COMPAT, the attribute must be wrapped in double-quotes, as single-quotes will not be encoded and the user will be able to inject arbitrary HTML attributes (including javascript behavior) inside the tag, even though they will not be able to inject arbitrary HTML tags.<br />
<br />
Also, if you want to allow users to input HTML attributes without them being double-encoded on display, there are two ways to accomplish this:<br />
<br />
1 - Run their input through htmlentities_decode() followed by htmlspecialchars().<br />
<br />
2 - Call htmlspecialchars() with $double_encode=false.<br />
<br />
There is one functional difference between these two methods:&nbsp; If you want to perform any search-replace on a user's input (such as word censoring in a message-board application), the second method will allow users to circumvent it by HTML-encoding their input, whereas the first will not.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="98698""></a>
  <div class="note">
   <strong class="user">nachitox2000 [at] hotmail [dot] com</strong>
   <a href="#98698" class="date">01-Jul-2010 02:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I had problems with spanish special characters. So i think in using htmlspecialchars but my strings also contain HTML.
<br />
So I used this :) Hope it help
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">htmlspanishchars</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">) 
<br />
{
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">str_replace</span><span class="keyword">(array(</span><span class="string">"&amp;lt;"</span><span class="keyword">, </span><span class="string">"&amp;gt;"</span><span class="keyword">), array(</span><span class="string">"&lt;"</span><span class="keyword">, </span><span class="string">"&gt;"</span><span class="keyword">), </span><span class="default">htmlspecialchars</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">, </span><span class="default">ENT_NOQUOTES</span><span class="keyword">, </span><span class="string">"UTF-8"</span><span class="keyword">));
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="97991""></a>
  <div class="note">
   <strong class="user">nessthehero at gmail dot com</strong>
   <a href="#97991" class="date">19-May-2010 08:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's a simple function I wrote for parsing form data.
<br />

<br />
It checks if it's an array and it is recursive (it calls itself).
<br />

<br />
It also decodes things that have already been encoded so it doesn't change &amp;amp; to &amp;amp;amp;
<br />

<br />
[In this version,] I found it easier to use a regular expression to check and see if any previously encoded data exists, then decode it repeatedly until there is none left, then re-encode it.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">formspecialchars</span><span class="keyword">(</span><span class="default">$var</span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pattern </span><span class="keyword">= </span><span class="string">'/&amp;(#)?[a-zA-Z0-9]{0,};/'</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$var</span><span class="keyword">)) {&nbsp; &nbsp; </span><span class="comment">// If variable is an array
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">= array();&nbsp; &nbsp; &nbsp; </span><span class="comment">// Set output as an array
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">foreach (</span><span class="default">$var </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$v</span><span class="keyword">) {&nbsp; &nbsp; &nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$out</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">] = </span><span class="default">formspecialchars</span><span class="keyword">(</span><span class="default">$v</span><span class="keyword">);&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Run formspecialchars on every element of the array and return the result. Also maintains the keys.
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">}
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">= </span><span class="default">$var</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; while (</span><span class="default">preg_match</span><span class="keyword">(</span><span class="default">$pattern</span><span class="keyword">,</span><span class="default">$out</span><span class="keyword">) &gt; </span><span class="default">0</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">= </span><span class="default">htmlspecialchars_decode</span><span class="keyword">(</span><span class="default">$out</span><span class="keyword">,</span><span class="default">ENT_QUOTES</span><span class="keyword">);&nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">= </span><span class="default">htmlspecialchars</span><span class="keyword">(</span><span class="default">stripslashes</span><span class="keyword">(</span><span class="default">trim</span><span class="keyword">(</span><span class="default">$out</span><span class="keyword">)), </span><span class="default">ENT_QUOTES</span><span class="keyword">,</span><span class="string">'UTF-8'</span><span class="keyword">,</span><span class="default">true</span><span class="keyword">);&nbsp; &nbsp;&nbsp; </span><span class="comment">// Trim the variable, strip all slashes, and encode it
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">}
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$out</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93620""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#93620" class="date">18-Sep-2009 07:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This may seem obvious, but it caused me some frustration. If you try and use htmlspecialchars with the $charset argument set and the string you run it on is not actually the same charset you specify, you get any empty string returned without any notice/warning/error.<br />
<br />
<span class="default">&lt;?php<br />
<br />
$ok_utf8 </span><span class="keyword">= </span><span class="string">"A valid UTF-8 string"</span><span class="keyword">;<br />
</span><span class="default">$bad_utf8 </span><span class="keyword">= </span><span class="string">"An invalid UTF-8 string"</span><span class="keyword">;<br />
<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">htmlspecialchars</span><span class="keyword">(</span><span class="default">$bad_utf8</span><span class="keyword">, </span><span class="default">ENT_NOQUOTES</span><span class="keyword">, </span><span class="string">'UTF-8'</span><span class="keyword">));&nbsp; </span><span class="comment">// string(0) ""<br />
<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">htmlspecialchars</span><span class="keyword">(</span><span class="default">$ok_utf8</span><span class="keyword">, </span><span class="default">ENT_NOQUOTES</span><span class="keyword">, </span><span class="string">'UTF-8'</span><span class="keyword">));&nbsp; </span><span class="comment">// string(20) "A valid UTF-8 string"<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
So make sure your charsets are consistent<br />
<br />
<span class="default">&lt;?php<br />
<br />
$bad_utf8 </span><span class="keyword">= </span><span class="string">"An invalid UTF-8 string"</span><span class="keyword">;<br />
<br />
</span><span class="comment">// make sure it's really UTF-8<br />
</span><span class="default">$bad_utf8 </span><span class="keyword">= </span><span class="default">mb_convert_encoding</span><span class="keyword">(</span><span class="default">$bad_utf8</span><span class="keyword">, </span><span class="string">'UTF-8'</span><span class="keyword">, </span><span class="default">mb_detect_encoding</span><span class="keyword">(</span><span class="default">$bad_utf8</span><span class="keyword">));<br />
<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">htmlspecialchars</span><span class="keyword">(</span><span class="default">$bad_utf8</span><span class="keyword">, </span><span class="default">ENT_NOQUOTES</span><span class="keyword">, </span><span class="string">'UTF-8'</span><span class="keyword">));&nbsp; </span><span class="comment">// string(23) "An invalid UTF-8 string" <br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
I had this problem because a Mac user was submitting posts copy/pasted from a program and it contained weird chars in it.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93577""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#93577" class="date">17-Sep-2009 06:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just a few notes on how one can use htmlspecialchars() and htmlentities() to filter user input on forms for later display and/or database storage... <br />
<br />
1. Use htmlspecialchars() to filter text input values for html input tags.&nbsp; i.e.,<br />
<br />
echo '&lt;input name=userdata type=text value="'.htmlspecialchars($data).'" /&gt;';<br />
<br />
&nbsp;<br />
2. Use htmlentities() to filter the same data values for most other kinds of html tags, i.e.,<br />
<br />
echo '&lt;p&gt;'.htmlentities($data).'&lt;/p&gt;';<br />
<br />
3. Use your database escape string function to filter the data for database updates &amp; insertions, for instance, using postgresql, <br />
<br />
pg_query($connection,"UPDATE datatable SET datavalue='".pg_escape_string($data)."'");<br />
&nbsp;<br />
<br />
This strategy seems to work well and consistently, without restricting anything the user might like to type and display, while still providing a good deal of protection against a wide variety of html and database escape sequence injections, which might otherwise be introduced through deliberate and/or accidental input of such character sequences by users submitting their input data via html forms.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92867""></a>
  <div class="note">
   <strong class="user">chuck at N0SPAM1command dot com</strong>
   <a href="#92867" class="date">12-Aug-2009 04:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
NOTE:<br />
I made an error in my last post.<br />
<br />
The last 3 lines should have read<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">...<br />
<br />
</span><span class="default">$text </span><span class="keyword">= </span><span class="default">get_page</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">);<br />
--------^^^^^^^^<br />
</span><span class="default">$new </span><span class="keyword">= </span><span class="default">htmlspecialchars</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">, </span><span class="default">ENT_QUOTES</span><span class="keyword">); </span><span class="comment">// here is the magic :)<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">echo </span><span class="string">'&lt;pre&gt;' </span><span class="keyword">.</span><span class="default">$new</span><span class="keyword">. </span><span class="string">'&lt;/pre&gt;'</span><span class="keyword">;<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
OOPS!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91675""></a>
  <div class="note">
   <strong class="user">hm2k at php.net</strong>
   <a href="#91675" class="date">22-Jun-2009 07:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php
<br />
</span><span class="comment">/**
<br />
&nbsp;* A recursive version of htmlspecialchars() for arrays and strings.
<br />
&nbsp;*
<br />
&nbsp;*/
<br />

<br />
</span><span class="keyword">function </span><span class="default">htmlspecialchars_deep</span><span class="keyword">(</span><span class="default">$mixed</span><span class="keyword">, </span><span class="default">$quote_style </span><span class="keyword">= </span><span class="default">ENT_QUOTES</span><span class="keyword">, </span><span class="default">$charset </span><span class="keyword">= </span><span class="string">'UTF-8'</span><span class="keyword">)
<br />
{
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$mixed</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$mixed </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$mixed</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">] = </span><span class="default">htmlspecialchars_deep</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">, </span><span class="default">$quote_style</span><span class="keyword">, </span><span class="default">$charset</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; } elseif (</span><span class="default">is_string</span><span class="keyword">(</span><span class="default">$mixed</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$mixed </span><span class="keyword">= </span><span class="default">htmlspecialchars</span><span class="keyword">(</span><span class="default">htmlspecialchars_decode</span><span class="keyword">(</span><span class="default">$mixed</span><span class="keyword">, </span><span class="default">$quote_style</span><span class="keyword">), </span><span class="default">$quote_style</span><span class="keyword">, </span><span class="default">$charset</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$mixed</span><span class="keyword">;
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="89796""></a>
  <div class="note">
   <strong class="user">hello at haroonahmad dot co dot uk</strong>
   <a href="#89796" class="date">23-Mar-2009 10:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
a common confusion among beginner is that what is the difference between htmlentities() and htmlspecialchars() really, because the manual examples are converting angular brackets for both.<br />
<br />
well, htmlentities() will ALSO look for other language characters in the string e.g German, French or Italian etc. So if you think your attacker can use some foreign language characters for a XSS attack in URL etc then use htmlentities() instead of htmlspecialchars().<br />
<br />
I hope it helps, <br />
<br />
Haroon Ahmad</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86240""></a>
  <div class="note">
   <strong class="user">Kenneth Kin Lum</strong>
   <a href="#86240" class="date">09-Oct-2008 03:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
if your goal is just to protect your page from Cross Site Scripting (XSS) attack, or just to show HTML tags on a web page (showing &lt;body&gt; on the page, for example), then using htmlspecialchars() is good enough and better than using htmlentities().&nbsp; A minor point is htmlspecialchars() is faster than htmlentities().&nbsp; A more important point is, when we use&nbsp; htmlspecialchars($s) in our code, it is automatically compatible with UTF-8 string.&nbsp; Otherwise, if we use htmlentities($s), and there happens to be foreign characters in the string $s in UTF-8 encoding, then htmlentities() is going to mess it up, as it modifies the byte 0x80 to 0xFF in the string to entities like &amp;eacute;.&nbsp; (unless you specifically provide a second argument and a third argument to htmlentities(), with the third argument being "UTF-8").<br />
<br />
The reason htmlspecialchars($s) already works with UTF-8 string is that, it changes bytes that are in the range 0x00 to 0x7F to &amp;lt; etc, while leaving bytes in the range 0x80 to 0xFF unchanged.&nbsp; We may wonder whether htmlspecialchars() may accidentally change any byte in a 2 to 4 byte UTF-8 character to &amp;lt; etc.&nbsp; The answer is, it won't.&nbsp; When a UTF-8 character is 2 to 4 bytes long, all the bytes in this character is in the 0x80 to 0xFF range. None can be in the 0x00 to 0x7F range.&nbsp; When a UTF-8 character is 1 byte long, it is just the same as ASCII, which is 7 bit, from 0x00 to 0x7F.&nbsp; As a result, when a UTF-8 character is 1 byte long, htmlspecialchars($s) will do its job, and when the UTF-8 character is 2 to 4 bytes long, htmlspecialchars($s) will just pass those bytes unchanged.&nbsp; So htmlspecialchars($s) will do the same job no matter whether $s is in ASCII, ISO-8859-1 (Latin-1), or UTF-8.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83216""></a>
  <div class="note">
   <strong class="user">brendel at krumedia dot de</strong>
   <a href="#83216" class="date">15-May-2008 07:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I know some people posted similar functions but may be you are looking for this version:<br />
<br />
function jschars($str)<br />
{<br />
&nbsp;&nbsp;&nbsp; $str = mb_ereg_replace("\\\\", "\\\\", $str);<br />
&nbsp;&nbsp;&nbsp; $str = mb_ereg_replace("\"", "\\\"", $str);<br />
&nbsp;&nbsp;&nbsp; $str = mb_ereg_replace("'", "\\'", $str);<br />
&nbsp;&nbsp;&nbsp; $str = mb_ereg_replace("\r\n", "\\n", $str);<br />
&nbsp;&nbsp;&nbsp; $str = mb_ereg_replace("\r", "\\n", $str);<br />
&nbsp;&nbsp;&nbsp; $str = mb_ereg_replace("\n", "\\n", $str);<br />
&nbsp;&nbsp;&nbsp; $str = mb_ereg_replace("\t", "\\t", $str);<br />
&nbsp;&nbsp;&nbsp; $str = mb_ereg_replace("&lt;", "\\x3C", $str); // for inclusion in HTML<br />
&nbsp;&nbsp;&nbsp; $str = mb_ereg_replace("&gt;", "\\x3E", $str);<br />
&nbsp;&nbsp;&nbsp; return $str;<br />
}<br />
<br />
if you use smarty your code may look like:<br />
<br />
&lt;a onclick="alert('{$text|jschars|htmlchars}');return false;"&gt;Test&lt;/a&gt;<br />
<br />
(Yes, we have the shortcur htmlchars instead of htmlspecialchars, so we are able to tell the encoding e.g. UTF-8 or ISO-8859-1 to htmlspecialchars)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82435""></a>
  <div class="note">
   <strong class="user">php dot net at orakio dot net</strong>
   <a href="#82435" class="date">10-Apr-2008 08:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I was recently exploring some code when I saw this being used to make data safe for "SQL".<br />
<br />
This function should not be used to make data SQL safe (although to prevent phishing it is perfectly good).<br />
<br />
Here is an example of how NOT to use this function:<br />
<br />
<span class="default">&lt;?php<br />
$username </span><span class="keyword">= </span><span class="default">htmlspecialchars</span><span class="keyword">(</span><span class="default">trim</span><span class="keyword">(</span><span class="string">"</span><span class="default">$_POST</span><span class="keyword">[</span><span class="default">username</span><span class="keyword">]</span><span class="string">"</span><span class="keyword">));<br />
<br />
</span><span class="default">$uniqueuser </span><span class="keyword">= </span><span class="default">$realm_db</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="string">"SELECT `login` FROM `accounts` WHERE `login` = '</span><span class="default">$username</span><span class="string">'"</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
(Only other check on $_POST['username'] is to make sure it isn't empty which it is after trim on a white space only name)<br />
<br />
The problem here is that it is left to default which allows single quote marks which are used in the sql query. Turning on magic quotes might fix it but you should not rely on magic quotes, in fact you should never use it and fix the code instead. There are also problems with \ not being escaped. Even if magic quotes were used there would be the problem of allowing usernames longer than the limit and having some really weird usernames given they are to be used outside of html, this just provide a front end for registering to another system using mysql. Of course using it on the output wouldn;t cause that problem.<br />
<br />
Another way to make something of a fix would be to use ENT_QUOTE or do:<br />
<br />
<span class="default">&lt;?php<br />
$uniqueuser </span><span class="keyword">= </span><span class="default">$realm_db</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="string">'SELECT `login` FROM `accounts` WHERE `login` = "'</span><span class="keyword">.</span><span class="default">$username</span><span class="keyword">.</span><span class="string">'";'</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Eitherway none of these solutions are good practice and are not entirely unflawed. This function should simply never be used in such a fashion.<br />
<br />
I hope this will prevent newbies using this function incorrectly (as they apparently do).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="79309""></a>
  <div class="note">
   <strong class="user">ish1301 at gmail doooot com</strong>
   <a href="#79309" class="date">20-Nov-2007 11:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
used this function for making a variable javascript compatible<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">jsspecialchars</span><span class="keyword">( </span><span class="default">$string </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$string </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"/\r*\n/"</span><span class="keyword">,</span><span class="string">"\\n"</span><span class="keyword">,</span><span class="default">$string</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$string </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"/\//"</span><span class="keyword">,</span><span class="string">"\\\/"</span><span class="keyword">,</span><span class="default">$string</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$string </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"/\"/"</span><span class="keyword">,</span><span class="string">"\\\""</span><span class="keyword">,</span><span class="default">$string</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$string </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"/'/"</span><span class="keyword">,</span><span class="string">" "</span><span class="keyword">,</span><span class="default">$string</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$string</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span>hope this may help those embedding php in javascripts</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75795""></a>
  <div class="note">
   <strong class="user">solar-energy</strong>
   <a href="#75795" class="date">16-Jun-2007 12:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
also see function "urlencode()", useful for passing text with ampersand and other special chars through url<br />
<br />
(i.e. the text is encoded as if sent from form using GET method)<br />
<br />
e.g.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">echo </span><span class="string">"&lt;a href='foo.php?text="</span><span class="keyword">.</span><span class="default">urlencode</span><span class="keyword">(</span><span class="string">"foo?&amp;bar!"</span><span class="keyword">).</span><span class="string">"'&gt;link&lt;/a&gt;"</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
produces<br />
<br />
&lt;a href='foo.php?text=foo%3F%26bar%21'&gt;link&lt;/a&gt;<br />
<br />
and if the link is followed, the $_GET["text"] in foo.php will contain "foo?&amp;bar!"</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74796""></a>
  <div class="note">
   <strong class="user">terminatorul at gmail dot com</strong>
   <a href="#74796" class="date">27-Apr-2007 07:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To html-encode Unicode characters that may not be part of your document character set (given in the META tag of your page), and so can not be output directly into your document source, you need to use mb_encode_numericentity(). Pay attention to it's conversion map argument.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="72377""></a>
  <div class="note">
   <strong class="user">frank at codedor dot be</strong>
   <a href="#72377" class="date">16-Jan-2007 10:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you seem to have a problem with rendering dynamic RSS files from a database - try using htmlspecialchars() or htmlentities() on the text you are rendering. <br />
<br />
Since XML and RSS is very strict about what is allowed inside nodes, you need to make sure everything is "A-OK" according to XML standards ...<br />
<br />
Especially if the database you're pulling data from is fi. Latin-Swedish encoding, which seems to be the standard setting for MySQL databases.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="62555""></a>
  <div class="note">
   <strong class="user">richard at mf2fm dot com</strong>
   <a href="#62555" class="date">03-Mar-2006 10:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I had a script which detected swearing and wanted to make sure that words such as 'f &amp;uuml; c k' didn't slip through the system.<br />
<br />
After using htmlentities(), the following line converts most extended alphabet characters back to the standard alphabet so you can spot such problems..<br />
<br />
$text=eregi_replace("&amp;([a-z])[a-z0-9]{3,};", "\\\\1", $text);<br />
<br />
This changes, for example, '&amp;uuml;' into 'u' and '&amp;szlig' into 's'.&nbsp; Sadly it also converts '&amp;pound;' and '&amp;para;' into 'p' so it's not perfect but does solve a lot of the problems</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="57544""></a>
  <div class="note">
   <strong class="user">mikiwoz at yahoo dot co dot uk</strong>
   <a href="#57544" class="date">06-Oct-2005 11:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I am not sure, maybe I'm missing something, but I have found something interesting:<br />
I've been working on a project, where I had to use htmlspecialchars (for opbvious reasons). I olso needed to de-code the encoded string. What I have done was almost a copy and paste from php.net:<br />
$trans=get_html_translation_table(HTML_SPECIALCHARS, ENT_QUOTES);<br />
$trans=array_flip($trans);<br />
$string=strtr($encoded, $trans);<br />
(it looked a bit different in my code, but the idea is clear)<br />
I couldn't get the apostrophe sign de-coded, and I needed it for the &lt;A&gt; tags. After an hour or so of debuging, I decided do print_r($trans). What I got was:<br />
...<br />
[&amp;#39;] =&gt; '<br />
...<br />
BUT the apostrophe was encoded to $#039; -&gt; note the zero.<br />
I don't suppose it's a bug, but it definetely IS a potential pitfall, watch out for this one.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="56400""></a>
  <div class="note">
   <strong class="user">Luiz Miguel Axcar (lmaxcar at yahoo dot com dot br)</strong>
   <a href="#56400" class="date">01-Sep-2005 03:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hello,<br />
<br />
If you are getting trouble to SGDB write/read HTML data, try to use this:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">//from html_entity_decode() manual page<br />
</span><span class="keyword">function </span><span class="default">unhtmlentities </span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">) {<br />
&nbsp;&nbsp; </span><span class="default">$trans_tbl </span><span class="keyword">=</span><span class="default">get_html_translation_table </span><span class="keyword">(</span><span class="default">HTML_ENTITIES </span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">$trans_tbl </span><span class="keyword">=</span><span class="default">array_flip </span><span class="keyword">(</span><span class="default">$trans_tbl </span><span class="keyword">);<br />
&nbsp;&nbsp; return </span><span class="default">strtr </span><span class="keyword">(</span><span class="default">$string </span><span class="keyword">,</span><span class="default">$trans_tbl </span><span class="keyword">);<br />
}<br />
<br />
</span><span class="comment">//read from db<br />
</span><span class="default">$content </span><span class="keyword">= </span><span class="default">stripslashes </span><span class="keyword">(</span><span class="default">htmlspecialchars </span><span class="keyword">(</span><span class="default">$field</span><span class="keyword">[</span><span class="string">'content'</span><span class="keyword">]));<br />
<br />
</span><span class="comment">//write to db<br />
</span><span class="default">$content </span><span class="keyword">= </span><span class="default">unhtmlentities </span><span class="keyword">(</span><span class="default">addslashes </span><span class="keyword">(</span><span class="default">trim </span><span class="keyword">(</span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'content'</span><span class="keyword">])));<br />
<br />
</span><span class="comment">//make sure result of function get_magic_quotes_gpc () == 0, you can get strange slashes in your content adding slashes twice<br />
<br />
//better to do this using addslashes<br />
</span><span class="default">$content </span><span class="keyword">= (! </span><span class="default">get_magic_quotes_gpc </span><span class="keyword">()) ? </span><span class="default">addslashes </span><span class="keyword">(</span><span class="default">$content</span><span class="keyword">) : </span><span class="default">$content</span><span class="keyword">;<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="52425""></a>
  <div class="note">
   <strong class="user">urbanheroes {at} gmail {dot} com</strong>
   <a href="#52425" class="date">30-Apr-2005 08:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In response to the note made by Alexander Nofftz on October 2004, &amp;#39; is used instead of &amp;apos; because IE unfortunately seems to have trouble with the latter.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="52186""></a>
  <div class="note">
   <strong class="user">took</strong>
   <a href="#52186" class="date">23-Apr-2005 06:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The Algo from donwilson at gmail dot com to reverse the action of htmlspecialchars(), edited for germany:<br />
<br />
function unhtmlspecialchars( $string )<br />
{<br />
&nbsp; $string = str_replace ( '&amp;amp;', '&amp;', $string );<br />
&nbsp; $string = str_replace ( '&amp;#039;', '\'', $string );<br />
&nbsp; $string = str_replace ( '&amp;quot;', '"', $string );<br />
&nbsp; $string = str_replace ( '&amp;lt;', '&lt;', $string );<br />
&nbsp; $string = str_replace ( '&amp;gt;', '&gt;', $string );<br />
&nbsp; $string = str_replace ( '&amp;uuml;', '?', $string );<br />
&nbsp; $string = str_replace ( '&amp;Uuml;', '?', $string );<br />
&nbsp; $string = str_replace ( '&amp;auml;', '?', $string );<br />
&nbsp; $string = str_replace ( '&amp;Auml;', '?', $string );<br />
&nbsp; $string = str_replace ( '&amp;ouml;', '?', $string );<br />
&nbsp; $string = str_replace ( '&amp;Ouml;', '?', $string );&nbsp; &nbsp; <br />
&nbsp; return $string;<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="50842""></a>
  <div class="note">
   
   <a href="#50842" class="date">11-Mar-2005 01:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
function htmlspecialchars_array($arr = array()) {<br />
&nbsp;&nbsp; $rs =&nbsp; array();<br />
&nbsp;&nbsp; while(list($key,$val) = each($arr)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; if(is_array($val)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $rs[$key] = htmlspecialchars_array($val);<br />
&nbsp;&nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $rs[$key] = htmlspecialchars($val, ENT_QUOTES);<br />
&nbsp;&nbsp; &nbsp; &nbsp; }&nbsp; &nbsp; <br />
&nbsp;&nbsp; }<br />
&nbsp;&nbsp; return $rs;<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="48166""></a>
  <div class="note">
   <strong class="user">zolinak at zoli dot szathmari dot hu</strong>
   <a href="#48166" class="date">14-Dec-2004 01:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A sample function, if anybody want to turn html entities (and special characters) back to simple. (eg: "&amp;egrave;", "&lt;" etc)<br />
<br />
function html2specialchars($str){<br />
&nbsp;&nbsp;&nbsp; $trans_table = array_flip(get_html_translation_table(HTML_ENTITIES));<br />
&nbsp;&nbsp;&nbsp; return strtr($str, $trans_table);<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="45340""></a>
  <div class="note">
   <strong class="user">thelatesundayshow.com @ nathan (flip it)</strong>
   <a href="#45340" class="date">02-Sep-2004 08:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
heres a version of the recursive escape function that takes the array byref rather than byval so saves some resources in case of big arrays<br />
<br />
function recurse_array_HTML_safe(&amp;$arr) {<br />
&nbsp;&nbsp;&nbsp; foreach ($arr as $key =&gt; $val)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (is_array($val))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; recurse_array_HTML_safe($arr[$key]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $arr[$key] = htmlspecialchars($val, ENT_QUOTES);<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="41733""></a>
  <div class="note">
   <strong class="user">moc.xnoitadnuof@310symerej</strong>
   <a href="#41733" class="date">21-Apr-2004 01:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here are some usefull functions.<br />
They will apply || decode, htmlspecialchars || htmlentities recursivly to arrays() || to regular $variables. They also protect agains "double encoding".<br />
<br />
<span class="default">&lt;?PHP<br />
</span><span class="keyword">function </span><span class="default">htmlspecialchars_or</span><span class="keyword">( </span><span class="default">$mixed</span><span class="keyword">, </span><span class="default">$quote_style </span><span class="keyword">= </span><span class="default">ENT_QUOTES </span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$mixed</span><span class="keyword">) ? </span><span class="default">array_map</span><span class="keyword">(</span><span class="string">'htmlspecialchars_or'</span><span class="keyword">,</span><span class="default">$mixed</span><span class="keyword">, </span><span class="default">array_fill</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,</span><span class="default">count</span><span class="keyword">(</span><span class="default">$mixed</span><span class="keyword">),</span><span class="default">$quote_style</span><span class="keyword">)) : </span><span class="default">htmlspecialchars</span><span class="keyword">(</span><span class="default">htmlspecialchars_decode</span><span class="keyword">(</span><span class="default">$mixed</span><span class="keyword">, </span><span class="default">$quote_style </span><span class="keyword">),</span><span class="default">$quote_style</span><span class="keyword">);<br />
}<br />
<br />
function </span><span class="default">htmlspecialchars_decode</span><span class="keyword">( </span><span class="default">$mixed</span><span class="keyword">, </span><span class="default">$quote_style </span><span class="keyword">= </span><span class="default">ENT_QUOTES </span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$mixed</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp;&nbsp; return </span><span class="default">array_map</span><span class="keyword">(</span><span class="string">'htmlspecialchars_decode'</span><span class="keyword">,</span><span class="default">$mixed</span><span class="keyword">, </span><span class="default">array_fill</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,</span><span class="default">count</span><span class="keyword">(</span><span class="default">$mixed</span><span class="keyword">),</span><span class="default">$quote_style</span><span class="keyword">));<br />
&nbsp; }<br />
&nbsp; </span><span class="default">$trans_table </span><span class="keyword">= </span><span class="default">get_html_translation_table</span><span class="keyword">( </span><span class="default">HTML_SPECIALCHARS</span><span class="keyword">, </span><span class="default">$quote_style </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if( </span><span class="default">$trans_table</span><span class="keyword">[</span><span class="string">"'"</span><span class="keyword">] != </span><span class="string">'&amp;#039;' </span><span class="keyword">) { </span><span class="comment"># some versions of PHP match single quotes to &amp;#39;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$trans_table</span><span class="keyword">[</span><span class="string">"'"</span><span class="keyword">] = </span><span class="string">'&amp;#039;'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return (</span><span class="default">strtr</span><span class="keyword">(</span><span class="default">$mixed</span><span class="keyword">, </span><span class="default">array_flip</span><span class="keyword">(</span><span class="default">$trans_table</span><span class="keyword">)));<br />
}<br />
<br />
function </span><span class="default">htmlentities_or</span><span class="keyword">(</span><span class="default">$mixed</span><span class="keyword">, </span><span class="default">$quote_style </span><span class="keyword">= </span><span class="default">ENT_QUOTES</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$mixed</span><span class="keyword">) ? </span><span class="default">array_map</span><span class="keyword">(</span><span class="string">'htmlentities_or'</span><span class="keyword">,</span><span class="default">$mixed</span><span class="keyword">, </span><span class="default">array_fill</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,</span><span class="default">count</span><span class="keyword">(</span><span class="default">$mixed</span><span class="keyword">),</span><span class="default">$quote_style</span><span class="keyword">)) : </span><span class="default">htmlentities</span><span class="keyword">(</span><span class="default">htmlentities_decode</span><span class="keyword">(</span><span class="default">$mixed</span><span class="keyword">, </span><span class="default">$quote_style </span><span class="keyword">),</span><span class="default">$quote_style</span><span class="keyword">);<br />
}<br />
<br />
function </span><span class="default">htmlentities_decode</span><span class="keyword">( </span><span class="default">$mixed</span><span class="keyword">, </span><span class="default">$quote_style </span><span class="keyword">= </span><span class="default">ENT_QUOTES </span><span class="keyword">) {<br />
&nbsp; if(</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$mixed</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp;&nbsp; return </span><span class="default">array_map</span><span class="keyword">(</span><span class="string">'htmlentities_decode'</span><span class="keyword">,</span><span class="default">$mixed</span><span class="keyword">, </span><span class="default">array_fill</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,</span><span class="default">count</span><span class="keyword">(</span><span class="default">$mixed</span><span class="keyword">),</span><span class="default">$quote_style</span><span class="keyword">));<br />
&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$trans_table </span><span class="keyword">= </span><span class="default">get_html_translation_table</span><span class="keyword">(</span><span class="default">HTML_ENTITIES</span><span class="keyword">, </span><span class="default">$quote_style </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if( </span><span class="default">$trans_table</span><span class="keyword">[</span><span class="string">"'"</span><span class="keyword">] != </span><span class="string">'&amp;#039;' </span><span class="keyword">) { </span><span class="comment"># some versions of PHP match single quotes to &amp;#39;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$trans_table</span><span class="keyword">[</span><span class="string">"'"</span><span class="keyword">] = </span><span class="string">'&amp;#039;'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return (</span><span class="default">strtr</span><span class="keyword">(</span><span class="default">$mixed</span><span class="keyword">, </span><span class="default">array_flip</span><span class="keyword">(</span><span class="default">$trans_table</span><span class="keyword">)));<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
These functions are an addition to an earlier post. I would like to give the person some credit but I do not know who it was.<br />
<br />
&lt;?&nbsp; ;llnu=u!eJq dHd?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="25217""></a>
  <div class="note">
   <strong class="user">_____ at luukku dot com</strong>
   <a href="#25217" class="date">14-Sep-2002 11:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
People, don't use ereg_replace for the most simple string replacing operations (replacing constant string with another).<br />
Use str_replace.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="19221""></a>
  <div class="note">
   <strong class="user">joseph at nextique dot com</strong>
   <a href="#19221" class="date">20-Feb-2002 10:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is a handy function to htmlalize an array (or scalar) before you hand it off to xml.<br />
<br />
function htmlspecialchars_array($arr = array()) {<br />
&nbsp;&nbsp;&nbsp; $rs =&nbsp; array();<br />
&nbsp;&nbsp;&nbsp; while(list($key,$val) = each($arr)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(is_array($val)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $rs[$key] = htmlspecialchars_array($val);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $rs[$key] = htmlspecialchars($val, ENT_QUOTES);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return $rs;<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="14054""></a>
  <div class="note">
   
   <a href="#14054" class="date">15-Jul-2001 08:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If your sending data from one form to another, the data in the textareas and text inputs may need to have htmlspecialchars("form data", ENT_QUOTES) applied, assuming you will ever have quotes or less-than signs or any of those special characters.&nbsp; Using htmlspecialchars will make the text show up properly in the second form.&nbsp; The changes are automatically undone whenever the form data is submitted. It does seem a little strange, but it works and my headache is now starting to go away.
<br />

<br />
AZ</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="13693""></a>
  <div class="note">
   <strong class="user">ryan at ryano dot net</strong>
   <a href="#13693" class="date">29-Jun-2001 12:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Actually, if you're using &gt;= 4.0.5, this should theoretically be quicker (less overhead anyway):
<br />

<br />
$text = str_replace(array("&amp;gt;", "&amp;lt;", "&amp;quot;", "&amp;amp;"), array("&gt;", "&lt;", "\"", "&amp;"), $text);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
