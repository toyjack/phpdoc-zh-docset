<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>对象复制</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="language.oop5.final.html">? Final 关键字</a></li>
      <li style="float: right;"><a href="language.oop5.object-comparison.html">对象比较 ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="language.oop5.html">类与对象</a></li>
    <li>对象复制</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="language.oop5.cloning" class="sect1">
  <h2 class="title">对象复制</h2>
  
  <p class="para"> 
   在多数情况下，我们并不需要完全复制一个对象来获得其中属性。但有一个情况下确实需要：如果你有一个
   GTK 窗口对象，该对象持有窗口相关的资源。你可能会想复制一个新的窗口，保持所有属性与原来的窗口相同，但必须是一个新的对象（因为如果不是新的对象，那么一个窗口中的改变就会影响到另一个窗口）。还有一种情况：如果对象
   A 中保存着对象 B 的引用，当你复制对象 A 时，你想其中使用的对象不再是对象 B 而是 B
   的一个副本，那么你必须得到对象 A 的一个副本。
  </p>

  <p class="para">
   对象复制可以通过 clone 关键字来完成（如果可能，这将调用对象的
   <a href="language.oop5.cloning.html#object.clone" class="link">__clone()</a> 方法）。对象中的
   <a href="language.oop5.cloning.html#object.clone" class="link">__clone()</a> 方法不能被直接调用。
  </p>

  <div class="informalexample">
   <div class="example-contents">
<div class="cdata"><pre>
$copy_of_object = clone $object;
</pre></div>
   </div>

  </div>

  <p class="para">
  当对象被复制后，PHP 5 会对对象的所有属性执行一个浅复制（shallow copy）。所有的引用属性
   仍然会是一个指向原来的变量的引用。
  </p>
  <div class="methodsynopsis dc-description" id="object.clone">
   <span class="type"><span class="type void">void</span></span> <span class="methodname"><strong>__clone</strong></span>
    ( <span class="methodparam">void</span>
   )</div>

   
  <p class="para">
   当复制完成时，如果定义了 <a href="language.oop5.cloning.html#object.clone" class="link">__clone()</a>
   方法，则新创建的对象（复制生成的对象）中的 <a href="language.oop5.cloning.html#object.clone" class="link">__clone()</a>
   方法会被调用，可用于修改属性的值（如果有必要的话）。
  </p>
   

  <div class="example" id="example-251">
   <p><strong>Example #1 复制一个对象</strong></p>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">SubObject<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;static&nbsp;</span><span style="color: #0000BB">$instances&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;</span><span style="color: #0000BB">$instance</span><span style="color: #007700">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">__construct</span><span style="color: #007700">()&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">instance&nbsp;</span><span style="color: #007700">=&nbsp;++</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">$instances</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">__clone</span><span style="color: #007700">()&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">instance&nbsp;</span><span style="color: #007700">=&nbsp;++</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">$instances</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /><br />class&nbsp;</span><span style="color: #0000BB">MyCloneable<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;</span><span style="color: #0000BB">$object1</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;</span><span style="color: #0000BB">$object2</span><span style="color: #007700">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;</span><span style="color: #0000BB">__clone</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;强制复制一份this-&gt;object，&nbsp;否则仍然指向同一个对象<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">object1&nbsp;</span><span style="color: #007700">=&nbsp;clone&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">object1</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /><br /></span><span style="color: #0000BB">$obj&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">MyCloneable</span><span style="color: #007700">();<br /><br /></span><span style="color: #0000BB">$obj</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">object1&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">SubObject</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">$obj</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">object2&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">SubObject</span><span style="color: #007700">();<br /><br /></span><span style="color: #0000BB">$obj2&nbsp;</span><span style="color: #007700">=&nbsp;clone&nbsp;</span><span style="color: #0000BB">$obj</span><span style="color: #007700">;<br /><br /><br />print(</span><span style="color: #DD0000">"Original&nbsp;Object:\n"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">print_r</span><span style="color: #007700">(</span><span style="color: #0000BB">$obj</span><span style="color: #007700">);<br /><br />print(</span><span style="color: #DD0000">"Cloned&nbsp;Object:\n"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">print_r</span><span style="color: #007700">(</span><span style="color: #0000BB">$obj2</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

   <div class="example-contents"><p>以上例程会输出：</p></div>
   <div class="example-contents screen">
<div class="cdata"><pre>
Original Object:
MyCloneable Object
(
    [object1] =&gt; SubObject Object
        (
            [instance] =&gt; 1
        )

    [object2] =&gt; SubObject Object
        (
            [instance] =&gt; 2
        )

)
Cloned Object:
MyCloneable Object
(
    [object1] =&gt; SubObject Object
        (
            [instance] =&gt; 3
        )

    [object2] =&gt; SubObject Object
        (
            [instance] =&gt; 2
        )

)
</pre></div>

   </div>

  </div>

 </div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="118877""></a>
  <div class="note">
   <strong class="user">fabio at naoimporta dot com</strong>
   <a href="#118877" class="date">22-Feb-2016 06:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It's possible to know how many clones have been created of a&nbsp; object. I'm think that is correct:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">class </span><span class="default">Classe </span><span class="keyword">{<br />
<br />
&nbsp;&nbsp;&nbsp; public static </span><span class="default">$howManyClones </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__clone</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; ++static::</span><span class="default">$howManyClones</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; public static function </span><span class="default">howManyClones</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return static::</span><span class="default">$howManyClones</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__destruct</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; --static::</span><span class="default">$howManyClones</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">$a </span><span class="keyword">= new </span><span class="default">Classe</span><span class="keyword">;<br />
<br />
</span><span class="default">$b </span><span class="keyword">= clone </span><span class="default">$a</span><span class="keyword">;<br />
</span><span class="default">$c </span><span class="keyword">= clone </span><span class="default">$b</span><span class="keyword">;<br />
</span><span class="default">$d </span><span class="keyword">= clone </span><span class="default">$c</span><span class="keyword">;<br />
<br />
echo </span><span class="string">'Clones:' </span><span class="keyword">. </span><span class="default">Classe</span><span class="keyword">::</span><span class="default">howManyClones</span><span class="keyword">() . </span><span class="default">PHP_EOL</span><span class="keyword">;<br />
<br />
unset(</span><span class="default">$d</span><span class="keyword">);<br />
<br />
echo </span><span class="string">'Clones:' </span><span class="keyword">. </span><span class="default">Classe</span><span class="keyword">::</span><span class="default">howManyClones</span><span class="keyword">() . </span><span class="default">PHP_EOL</span><span class="keyword">;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="118049""></a>
  <div class="note">
   <strong class="user">jason at jewelrysupply dot com</strong>
   <a href="#118049" class="date">25-Sep-2015 06:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
@DPB<br />
<br />
I believe the two functions are not quite the same. The serialize followed by deserialize method is the way I've done deep cloning in other languages (bypasses any weird clone function behavior and ensures you have a no-strings-attached copy of the object).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="117616""></a>
  <div class="note">
   <strong class="user">dennis</strong>
   <a href="#117616" class="date">09-Jul-2015 07:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I had some trouble with cloning an array with objects in another object.<br />
But I found a function on the internet&nbsp; that was very helpful:<br />
<br />
&nbsp;function array_clone( array $array ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $result = array();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach( $array as $key =&gt; $val ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if( is_array( $val ) ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $result[$key] = arrayCopy( $val );<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } elseif ( is_object( $val ) ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $result[$key] = clone $val;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $result[$key] = $val;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return $result;<br />
} <br />
<br />
//== my test case:<br />
class Employee<br />
{<br />
&nbsp;&nbsp;&nbsp; public $sName = '';<br />
}<br />
<br />
class EmployeesContainer<br />
{<br />
&nbsp;&nbsp;&nbsp; private $arrObjects = array();<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public function __clone()<br />
&nbsp;&nbsp;&nbsp; {&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; //try to comment out the line below, you will see the out differs<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;arrObjects = array_clone($this-&gt;arrObjects);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public function add(Employee $objEmployee)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;arrObjects[] = $objEmployee;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public function getInternalArray()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return $this-&gt;arrObjects;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
$objContainerOriginal = new EmployeesContainer();<br />
<br />
$objEmpl1 = new Employee();<br />
$objEmpl1-&gt;sName = 'erny';<br />
$objContainerOriginal-&gt;add($objEmpl1);<br />
<br />
$objEmpl2 = new Employee();<br />
$objEmpl2-&gt;sName = 'bert';<br />
$objContainerOriginal-&gt;add($objEmpl2);<br />
<br />
$objContainerClone = clone $objContainerOriginal;<br />
<br />
if ($objContainerClone-&gt;getInternalArray()[1] === $objEmpl2)<br />
&nbsp;&nbsp;&nbsp; echo 'SAME object: '.$objContainerClone-&gt;getInternalArray()[0]-&gt;sName.' &lt;-&gt; '.$objEmpl1-&gt;sName;<br />
else <br />
&nbsp;&nbsp;&nbsp; echo 'OTHER object: '.$objContainerClone-&gt;getInternalArray()[0]-&gt;sName.' &lt;-&gt; '.$objEmpl1-&gt;sName;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="116329""></a>
  <div class="note">
   <strong class="user">stanislav dot eckert at vizson dot de</strong>
   <a href="#116329" class="date">13-Dec-2014 09:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This base class automatically clones attributes of type object or array values of type object recursively. Just inherit your own classes from this base class.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">class </span><span class="default">clone_base<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; public function </span><span class="default">__clone</span><span class="keyword">()<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$object_vars </span><span class="keyword">= </span><span class="default">get_object_vars</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$object_vars </span><span class="keyword">as </span><span class="default">$attr_name </span><span class="keyword">=&gt; </span><span class="default">$attr_value</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_object</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">$attr_name</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">$attr_name </span><span class="keyword">= clone </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">$attr_name</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">$attr_name</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Note: This copies only one dimension arrays<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">foreach (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">$attr_name </span><span class="keyword">as &amp;</span><span class="default">$attr_array_value</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_object</span><span class="keyword">(</span><span class="default">$attr_array_value</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$attr_array_value </span><span class="keyword">= clone </span><span class="default">$attr_array_value</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; unset(</span><span class="default">$attr_array_value</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;<br />
</span><br />
Example:<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">class </span><span class="default">foo </span><span class="keyword">extends </span><span class="default">clone_base<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; public </span><span class="default">$attr </span><span class="keyword">= </span><span class="string">"Hello"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; public </span><span class="default">$b </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; public </span><span class="default">$attr2 </span><span class="keyword">= array();<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; public function </span><span class="default">__construct</span><span class="keyword">()<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">b </span><span class="keyword">= new </span><span class="default">bar</span><span class="keyword">(</span><span class="string">"World"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">attr2</span><span class="keyword">[] = new </span><span class="default">bar</span><span class="keyword">(</span><span class="string">"What's"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">attr2</span><span class="keyword">[] = new </span><span class="default">bar</span><span class="keyword">(</span><span class="string">"up?"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; class </span><span class="default">bar </span><span class="keyword">extends </span><span class="default">clone_base<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; public </span><span class="default">$attr</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; public function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$attr_value</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">attr </span><span class="keyword">= </span><span class="default">$attr_value</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"&lt;pre&gt;"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$f1 </span><span class="keyword">= new </span><span class="default">foo</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$f2 </span><span class="keyword">= clone </span><span class="default">$f1</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$f2</span><span class="keyword">-&gt;</span><span class="default">attr </span><span class="keyword">= </span><span class="string">"James"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$f2</span><span class="keyword">-&gt;</span><span class="default">b</span><span class="keyword">-&gt;</span><span class="default">attr </span><span class="keyword">= </span><span class="string">"Bond"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$f2</span><span class="keyword">-&gt;</span><span class="default">attr2</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]-&gt;</span><span class="default">attr </span><span class="keyword">= </span><span class="string">"Agent"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$f2</span><span class="keyword">-&gt;</span><span class="default">attr2</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]-&gt;</span><span class="default">attr </span><span class="keyword">= </span><span class="string">"007"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"f1.attr = " </span><span class="keyword">. </span><span class="default">$f1</span><span class="keyword">-&gt;</span><span class="default">attr </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"f1.b.attr = " </span><span class="keyword">. </span><span class="default">$f1</span><span class="keyword">-&gt;</span><span class="default">b</span><span class="keyword">-&gt;</span><span class="default">attr </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"f1.attr2[0] = " </span><span class="keyword">. </span><span class="default">$f1</span><span class="keyword">-&gt;</span><span class="default">attr2</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]-&gt;</span><span class="default">attr </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"f1.attr2[1] = " </span><span class="keyword">. </span><span class="default">$f1</span><span class="keyword">-&gt;</span><span class="default">attr2</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]-&gt;</span><span class="default">attr </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"f2.attr = " </span><span class="keyword">. </span><span class="default">$f2</span><span class="keyword">-&gt;</span><span class="default">attr </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"f2.b.attr = " </span><span class="keyword">. </span><span class="default">$f2</span><span class="keyword">-&gt;</span><span class="default">b</span><span class="keyword">-&gt;</span><span class="default">attr </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"f2.attr2[0] = " </span><span class="keyword">. </span><span class="default">$f2</span><span class="keyword">-&gt;</span><span class="default">attr2</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]-&gt;</span><span class="default">attr </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"f2.attr2[1] = " </span><span class="keyword">. </span><span class="default">$f2</span><span class="keyword">-&gt;</span><span class="default">attr2</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]-&gt;</span><span class="default">attr </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">;<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="114932""></a>
  <div class="note">
   <strong class="user">obaidmaroof at gmail dot com</strong>
   <a href="#114932" class="date">29-Apr-2014 11:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">A</span><span class="keyword">{<br />
&nbsp; public </span><span class="default">$my_var</span><span class="keyword">;<br />
&nbsp; function </span><span class="default">__construct</span><span class="keyword">() { </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">my_var </span><span class="keyword">= </span><span class="string">'aaa'</span><span class="keyword">; }<br />
&nbsp; }<br />
&nbsp; <br />
&nbsp; </span><span class="default">$a </span><span class="keyword">= new </span><span class="default">A</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$b </span><span class="keyword">= clone </span><span class="default">$a</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$b</span><span class="keyword">-&gt;</span><span class="default">my_var </span><span class="keyword">= </span><span class="string">'bbb'</span><span class="keyword">;<br />
&nbsp; <br />
&nbsp; echo(</span><span class="default">$a</span><span class="keyword">-&gt;</span><span class="default">my_var</span><span class="keyword">);&nbsp;&nbsp; </span><span class="comment">// 'aaa'<br />
&nbsp; </span><span class="keyword">echo(</span><span class="default">$b</span><span class="keyword">-&gt;</span><span class="default">my_var</span><span class="keyword">);&nbsp;&nbsp; </span><span class="comment">// 'bbb'<br />
&nbsp;<br />
&nbsp; </span><span class="default">$c </span><span class="keyword">= new </span><span class="default">A</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$d </span><span class="keyword">= </span><span class="default">$c</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$d</span><span class="keyword">-&gt;</span><span class="default">my_var </span><span class="keyword">= </span><span class="string">'bbb'</span><span class="keyword">;<br />
&nbsp; <br />
&nbsp; echo(</span><span class="default">$c</span><span class="keyword">-&gt;</span><span class="default">my_var</span><span class="keyword">);&nbsp;&nbsp; </span><span class="comment">// 'bbb'<br />
&nbsp; </span><span class="keyword">echo(</span><span class="default">$d</span><span class="keyword">-&gt;</span><span class="default">my_var</span><span class="keyword">);&nbsp;&nbsp; </span><span class="comment">// 'bbb'<br />
</span><span class="default">?&gt;<br />
</span><br />
simple example to understand the basic concept behind clone.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="108938""></a>
  <div class="note">
   <strong class="user">seriously at something dot com</strong>
   <a href="#108938" class="date">07-Jun-2012 01:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want a property that gets the same value in every clone if changed, you can do this simple trick:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">class </span><span class="default">A<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public static </span><span class="default">$name </span><span class="keyword">;<br />
<br />
}<br />
<br />
</span><span class="default">$a </span><span class="keyword">= new </span><span class="default">A</span><span class="keyword">;<br />
</span><span class="default">$a</span><span class="keyword">::</span><span class="default">$name </span><span class="keyword">= </span><span class="string">'George'</span><span class="keyword">;<br />
<br />
</span><span class="default">$b </span><span class="keyword">= clone </span><span class="default">$a</span><span class="keyword">;<br />
</span><span class="default">$b</span><span class="keyword">::</span><span class="default">$name </span><span class="keyword">= </span><span class="string">"Somebody else"</span><span class="keyword">;<br />
<br />
echo </span><span class="string">'a: ' </span><span class="keyword">. </span><span class="default">$a</span><span class="keyword">::</span><span class="default">$name </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">;<br />
echo </span><span class="string">'b: ' </span><span class="keyword">. </span><span class="default">$b</span><span class="keyword">::</span><span class="default">$name </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">;<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
this will output:<br />
<br />
a: Somebody else<br />
b: Somebody else<br />
<br />
You can change any of the clones property and all of the others will change accordingly.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="106135""></a>
  <div class="note">
   <strong class="user">walkman at walkman dot pk</strong>
   <a href="#106135" class="date">13-Oct-2011 02:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want a property that gets the same value in every clone if changed, you can do this simple trick:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">class </span><span class="default">A<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$name </span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__construct</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">name </span><span class="keyword">= &amp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">name</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">$a </span><span class="keyword">= new </span><span class="default">A</span><span class="keyword">;<br />
</span><span class="default">$a</span><span class="keyword">-&gt;</span><span class="default">name </span><span class="keyword">= </span><span class="string">"George"</span><span class="keyword">;<br />
<br />
</span><span class="default">$b </span><span class="keyword">= clone </span><span class="default">$a</span><span class="keyword">;<br />
</span><span class="default">$b</span><span class="keyword">-&gt;</span><span class="default">name </span><span class="keyword">= </span><span class="string">"Somebody else"</span><span class="keyword">;<br />
<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">);<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$b</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
this will output:<br />
<br />
object(A)#1 (1) {<br />
&nbsp; ["name"]=&gt;<br />
&nbsp; &amp;string(13) "Somebody else"<br />
}<br />
object(A)#2 (1) {<br />
&nbsp; ["name"]=&gt;<br />
&nbsp; &amp;string(13) "Somebody else"<br />
}<br />
<br />
You can change any of the clones property and all of the others will change accordingly.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="98297""></a>
  <div class="note">
   <strong class="user">jojor at gmx dot net</strong>
   <a href="#98297" class="date">07-Jun-2010 10:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is test script i wrote to test the behaviour of clone when i have arrays with primitive values in my class - as an additonal test of the note below by jeffrey at whinger dot nl<br />
<br />
&lt;pre&gt;<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">class </span><span class="default">MyClass </span><span class="keyword">{<br />
<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$myArray </span><span class="keyword">= array();<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">pushSomethingToArray</span><span class="keyword">(</span><span class="default">$var</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">array_push</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">myArray</span><span class="keyword">, </span><span class="default">$var</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">getArray</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">myArray</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
}<br />
<br />
</span><span class="comment">//push some values to the myArray of Mainclass<br />
</span><span class="default">$myObj </span><span class="keyword">= new </span><span class="default">MyClass</span><span class="keyword">();<br />
</span><span class="default">$myObj</span><span class="keyword">-&gt;</span><span class="default">pushSomethingToArray</span><span class="keyword">(</span><span class="string">'blue'</span><span class="keyword">);<br />
</span><span class="default">$myObj</span><span class="keyword">-&gt;</span><span class="default">pushSomethingToArray</span><span class="keyword">(</span><span class="string">'orange'</span><span class="keyword">);<br />
</span><span class="default">$myObjClone </span><span class="keyword">= clone </span><span class="default">$myObj</span><span class="keyword">;<br />
</span><span class="default">$myObj</span><span class="keyword">-&gt;</span><span class="default">pushSomethingToArray</span><span class="keyword">(</span><span class="string">'pink'</span><span class="keyword">);<br />
<br />
</span><span class="comment">//testing<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$myObj</span><span class="keyword">-&gt;</span><span class="default">getArray</span><span class="keyword">());&nbsp; &nbsp;&nbsp; </span><span class="comment">//Array([0] =&gt; blue,[1] =&gt; orange,[2] =&gt; pink)<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$myObjClone</span><span class="keyword">-&gt;</span><span class="default">getArray</span><span class="keyword">());</span><span class="comment">//Array([0] =&gt; blue,[1] =&gt; orange)<br />
//so array&nbsp; cloned <br />
<br />
</span><span class="default">?&gt;<br />
</span>&lt;/pre&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="97348""></a>
  <div class="note">
   <strong class="user">jeffrey at whinger dot nl</strong>
   <a href="#97348" class="date">15-Apr-2010 02:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For me it wasn't very clear to how this cloning of objects really worked so I made this little bit of code:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">foo<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$test</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">test</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">'give us a '</span><span class="keyword">.</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">test</span><span class="keyword">.</span><span class="string">"&lt;br&gt;\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
class </span><span class="default">bar<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$foo</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">insertFoo</span><span class="keyword">(</span><span class="default">$foo</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">foo </span><span class="keyword">= </span><span class="default">$foo</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">$foo </span><span class="keyword">= new </span><span class="default">foo</span><span class="keyword">();<br />
<br />
</span><span class="default">$foo</span><span class="keyword">-&gt;</span><span class="default">test </span><span class="keyword">= </span><span class="string">'foo'</span><span class="keyword">;<br />
<br />
</span><span class="default">$bar </span><span class="keyword">= new </span><span class="default">bar</span><span class="keyword">();<br />
<br />
</span><span class="default">$bar</span><span class="keyword">-&gt;</span><span class="default">insertFoo</span><span class="keyword">(</span><span class="default">$foo</span><span class="keyword">);<br />
<br />
</span><span class="default">$foo</span><span class="keyword">-&gt;</span><span class="default">test</span><span class="keyword">();<br />
<br />
</span><span class="default">$bar</span><span class="keyword">-&gt;</span><span class="default">foo</span><span class="keyword">-&gt;</span><span class="default">test</span><span class="keyword">();<br />
<br />
</span><span class="default">$foo</span><span class="keyword">-&gt;</span><span class="default">test </span><span class="keyword">= </span><span class="string">'bar'</span><span class="keyword">;<br />
<br />
</span><span class="default">$foo</span><span class="keyword">-&gt;</span><span class="default">test</span><span class="keyword">();<br />
<br />
</span><span class="default">$bar</span><span class="keyword">-&gt;</span><span class="default">foo</span><span class="keyword">-&gt;</span><span class="default">test</span><span class="keyword">();<br />
<br />
</span><span class="default">$bar</span><span class="keyword">-&gt;</span><span class="default">foo </span><span class="keyword">= clone </span><span class="default">$foo</span><span class="keyword">;<br />
<br />
</span><span class="default">$bar</span><span class="keyword">-&gt;</span><span class="default">foo</span><span class="keyword">-&gt;</span><span class="default">test </span><span class="keyword">= </span><span class="string">'woop woop'</span><span class="keyword">;<br />
<br />
</span><span class="default">$foo</span><span class="keyword">-&gt;</span><span class="default">test</span><span class="keyword">();<br />
<br />
</span><span class="default">$bar</span><span class="keyword">-&gt;</span><span class="default">foo</span><span class="keyword">-&gt;</span><span class="default">test</span><span class="keyword">();<br />
<br />
</span><span class="comment">// result:<br />
// give us a foo<br />
// give us a foo<br />
// give us a bar<br />
// give us a bar<br />
// give us a bar<br />
// give us a woop woop<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="97249""></a>
  <div class="note">
   <strong class="user">henke at henke37 dot cjb dot net</strong>
   <a href="#97249" class="date">10-Apr-2010 12:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Arrays are shallow cloned on assignment, so don't use the clone keyword on them, just assign it to a new variable. That would lead to an error instead.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="96852""></a>
  <div class="note">
   <strong class="user">olivier dot pons at goo dot without dot oo dot mail dot com</strong>
   <a href="#96852" class="date">19-Mar-2010 07:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you think "clone" will create a new instance, thus calling "__constructor", you're wrong. clone seems to only allocate memory for the object cloned, and simply copies the variables memory from the original to the new one (imagine something alike memcpy() in C). Nothing more. Keep in mind you'll have to do all the rest by yourself.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="96493""></a>
  <div class="note">
   <strong class="user">emile at webflow dot nl</strong>
   <a href="#96493" class="date">02-Mar-2010 10:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Another gotcha I encountered: like __construct and __desctruct, you must call parent::__clone() yourself from inside a child's __clone() function. The manual kind of got me on the wrong foot here: "An object's __clone() method cannot be called directly."</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91323""></a>
  <div class="note">
   <strong class="user">ben at last dot fm</strong>
   <a href="#91323" class="date">05-Jun-2009 07:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here are some cloning and reference gotchas we came up against at Last.fm.<br />
<br />
1. PHP treats variables as either 'values types' or 'reference types', where the difference is supposed to be transparent. Object cloning is one of the few times when it can make a big difference. I know of no programmatic way to tell if a variable is intrinsically a value or reference type. There IS however a non-programmatic ways to tell if an object property is value or reference type:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">class </span><span class="default">A </span><span class="keyword">{ var </span><span class="default">$p</span><span class="keyword">; }<br />
<br />
</span><span class="default">$a </span><span class="keyword">= new </span><span class="default">A</span><span class="keyword">;<br />
</span><span class="default">$a</span><span class="keyword">-&gt;</span><span class="default">p </span><span class="keyword">= </span><span class="string">'Hello'</span><span class="keyword">; </span><span class="comment">// $a-&gt;p is a value type<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">);<br />
<br />
</span><span class="comment">/*<br />
object(A)#1 (1) {<br />
&nbsp; ["p"]=&gt;<br />
&nbsp; string(5) "Hello" // &lt;-- no &amp;<br />
}<br />
*/<br />
<br />
</span><span class="default">$ref </span><span class="keyword">=&amp; </span><span class="default">$a</span><span class="keyword">-&gt;</span><span class="default">p</span><span class="keyword">; </span><span class="comment">// note that this CONVERTS $a-&gt;p into a reference type!!<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">);<br />
<br />
</span><span class="comment">/*<br />
object(A)#1 (1) {<br />
&nbsp; ["p"]=&gt;<br />
&nbsp; &amp;string(5) "Hello" // &lt;-- note the &amp;, this indicates it's a reference.<br />
}<br />
*/<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
2. unsetting all-but-one of the references will convert the remaining reference back into a value. Continuing from the previous example:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">unset(</span><span class="default">$ref</span><span class="keyword">);<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">);<br />
<br />
</span><span class="comment">/*<br />
object(A)#1 (1) {<br />
&nbsp; ["p"]=&gt;<br />
&nbsp; string(5) "Hello"<br />
}<br />
*/<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
I interpret this as the reference-count jumping from 2 straight to 0. However...<br />
<br />
2. It IS possible to create a reference with a reference count of 1 - i.e. to convert an property from value type to reference type, without any extra references. All you have to do is declare that it refers to itself. This is HIGHLY idiosyncratic, but nevertheless it works. This leads to the observation that although the manual states that 'Any properties that are references to other variables, will remain references,' this is not strictly true. Any variables that are references, even to *themselves* (not necessarily to other variables), will be copied by reference rather than by value. <br />
<br />
Here's an example to demonstrate:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">class </span><span class="default">ByVal<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$prop</span><span class="keyword">;<br />
}<br />
<br />
class </span><span class="default">ByRef<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$prop</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__construct</span><span class="keyword">() { </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">prop </span><span class="keyword">=&amp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">prop</span><span class="keyword">; }<br />
}<br />
<br />
</span><span class="default">$a </span><span class="keyword">= new </span><span class="default">ByVal</span><span class="keyword">;<br />
</span><span class="default">$a</span><span class="keyword">-&gt;</span><span class="default">prop </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;<br />
</span><span class="default">$b </span><span class="keyword">= clone </span><span class="default">$a</span><span class="keyword">;<br />
</span><span class="default">$b</span><span class="keyword">-&gt;</span><span class="default">prop </span><span class="keyword">= </span><span class="default">2</span><span class="keyword">; </span><span class="comment">// $a-&gt;prop remains at 1<br />
<br />
</span><span class="default">$a </span><span class="keyword">= new </span><span class="default">ByRef</span><span class="keyword">;<br />
</span><span class="default">$a</span><span class="keyword">-&gt;</span><span class="default">prop </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;<br />
</span><span class="default">$b </span><span class="keyword">= clone </span><span class="default">$a</span><span class="keyword">;<br />
</span><span class="default">$b</span><span class="keyword">-&gt;</span><span class="default">prop </span><span class="keyword">= </span><span class="default">2</span><span class="keyword">; </span><span class="comment">// $a-&gt;prop is now 2<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="89321""></a>
  <div class="note">
   <strong class="user">koyama</strong>
   <a href="#89321" class="date">03-Mar-2009 04:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The __clone() method for deep cloning by cheetah at tanabi dot org also works when the object to be cloned contains references to itself. This is not the case for any variation of the __clone() method in edit by danbrown at php dot net.<br />
<br />
We are taking advantage of the fact that one can serialize an object that references itself.<br />
<br />
Example:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">Foo<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__construct</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_myself </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__clone</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$this </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$val</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_object</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">) || (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">))) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;{</span><span class="default">$key</span><span class="keyword">} = </span><span class="default">unserialize</span><span class="keyword">(</span><span class="default">serialize</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="comment">// this object references itself<br />
</span><span class="default">$foo </span><span class="keyword">= new </span><span class="default">Foo</span><span class="keyword">();<br />
<br />
</span><span class="comment">// create a deep clone<br />
</span><span class="default">$bar </span><span class="keyword">= clone </span><span class="default">$foo</span><span class="keyword">;<br />
<br />
</span><span class="comment">// check if we reach this point<br />
</span><span class="keyword">echo </span><span class="string">'Finished cloning!'</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
Replacing the __clone() method with the one shown in edit by danbrown at php dot net we run into an infinite loop, and we never get message 'Finished cloning!'.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="87066""></a>
  <div class="note">
   <strong class="user">cheetah at tanabi dot org</strong>
   <a href="#87066" class="date">18-Nov-2008 02:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Want deep cloning without too much hassle?
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">__clone</span><span class="keyword">() {
<br />
&nbsp;&nbsp;&nbsp; foreach(</span><span class="default">$this </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$val</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">is_object</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">)||(</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">))){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;{</span><span class="default">$key</span><span class="keyword">} = </span><span class="default">unserialize</span><span class="keyword">(</span><span class="default">serialize</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">));
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />
}
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
That will insure any object, or array that may potentially contain objects, will get cloned without using recursion or other support methods.
<br />

<br />

<br />

<br />
[EDIT BY danbrown AT php DOT net: An almost exact function was contributed on 02-DEC-2008-10:18 by (david ashe AT metabin):
<br />

<br />
<span class="default">&lt;?php
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">__clone</span><span class="keyword">(){
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$this </span><span class="keyword">as </span><span class="default">$name </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">gettype</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">)==</span><span class="string">'object'</span><span class="keyword">){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">$name</span><span class="keyword">= clone(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">$name</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Giving credit where it's due.&nbsp; ~DPB]</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86093""></a>
  <div class="note">
   <strong class="user">wbcarts at juno dot com</strong>
   <a href="#86093" class="date">02-Oct-2008 08:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
CLONED ARMIES? USE STATIC DATA<br />
<br />
When I think of cloning, I always think of Star Wars "Cloned Army"... where the number of clones are in the hundreds of thousands. So far, I have only seen examples of one or two clones with either shallow, deep, or recursive references. My fix is to use the static keyword. With static, you choose the properties your objects share... and makes scaling up the number of so-called "clones" much easier.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">class </span><span class="default">Soldier </span><span class="keyword">{<br />
&nbsp; public static </span><span class="default">$status</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// this is the property I'm trying to clone<br />
<br />
&nbsp; </span><span class="keyword">protected static </span><span class="default">$idCount </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;&nbsp;&nbsp; </span><span class="comment">// used to increment ID numbers<br />
&nbsp; </span><span class="keyword">protected </span><span class="default">$id</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// each Soldier will have a unique ID<br />
<br />
&nbsp; </span><span class="keyword">public function </span><span class="default">__construct</span><span class="keyword">() {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">id </span><span class="keyword">= ++</span><span class="default">self</span><span class="keyword">::</span><span class="default">$idCount</span><span class="keyword">;<br />
&nbsp; }&nbsp; <br />
<br />
&nbsp; public function </span><span class="default">issueCommand</span><span class="keyword">(</span><span class="default">$task</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; switch(</span><span class="default">$task</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp;&nbsp; case </span><span class="string">'Deploy Troops'</span><span class="keyword">: </span><span class="default">self</span><span class="keyword">::</span><span class="default">$status </span><span class="keyword">= </span><span class="string">'deploying'</span><span class="keyword">; break;<br />
&nbsp;&nbsp; &nbsp;&nbsp; case </span><span class="string">'March Forward'</span><span class="keyword">: </span><span class="default">self</span><span class="keyword">::</span><span class="default">$status </span><span class="keyword">= </span><span class="string">'marching forward'</span><span class="keyword">; break;<br />
&nbsp;&nbsp; &nbsp;&nbsp; case </span><span class="string">'Fire!'</span><span class="keyword">: </span><span class="default">self</span><span class="keyword">::</span><span class="default">$status </span><span class="keyword">= </span><span class="string">'shot fired'</span><span class="keyword">; break;<br />
&nbsp;&nbsp; &nbsp;&nbsp; case </span><span class="string">'Retreat!'</span><span class="keyword">: </span><span class="default">self</span><span class="keyword">::</span><span class="default">$status </span><span class="keyword">= </span><span class="string">'course reversed'</span><span class="keyword">; break;<br />
&nbsp;&nbsp; &nbsp;&nbsp; default: </span><span class="default">self</span><span class="keyword">::</span><span class="default">$status </span><span class="keyword">= </span><span class="string">'at ease'</span><span class="keyword">; break;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">'COMMAND ISSUED: ' </span><span class="keyword">. </span><span class="default">$task </span><span class="keyword">. </span><span class="string">'&lt;br&gt;'</span><span class="keyword">;<br />
&nbsp; }<br />
<br />
&nbsp; public function </span><span class="default">__toString</span><span class="keyword">() {<br />
&nbsp;&nbsp;&nbsp; return </span><span class="string">"Soldier[id=</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">id</span><span class="string">, status=" </span><span class="keyword">. </span><span class="default">self</span><span class="keyword">::</span><span class="default">$status </span><span class="keyword">. </span><span class="string">']'</span><span class="keyword">;<br />
&nbsp; }<br />
}<br />
<br />
</span><span class="comment"># create the General and the Cloned Army<br />
</span><span class="default">$general </span><span class="keyword">= new </span><span class="default">Soldier</span><span class="keyword">();<br />
</span><span class="default">$platoon </span><span class="keyword">= array();<br />
&nbsp; for(</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">250</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) </span><span class="default">$platoon</span><span class="keyword">[] = new </span><span class="default">Soldier</span><span class="keyword">();<br />
<br />
</span><span class="comment"># issue commands, then check what soldiers are doing<br />
</span><span class="default">$general</span><span class="keyword">-&gt;</span><span class="default">issueCommand</span><span class="keyword">(</span><span class="string">'Deploy Troops'</span><span class="keyword">);<br />
echo </span><span class="default">$general </span><span class="keyword">. </span><span class="string">'&lt;br&gt;'</span><span class="keyword">;<br />
echo </span><span class="default">$platoon</span><span class="keyword">[</span><span class="default">223</span><span class="keyword">] . </span><span class="string">'&lt;br&gt;'</span><span class="keyword">;<br />
echo </span><span class="default">$platoon</span><span class="keyword">[</span><span class="default">12</span><span class="keyword">] . </span><span class="string">'&lt;br&gt;'</span><span class="keyword">;<br />
<br />
</span><span class="default">$general</span><span class="keyword">-&gt;</span><span class="default">issueCommand</span><span class="keyword">(</span><span class="string">'March Forward'</span><span class="keyword">);<br />
echo </span><span class="default">$platoon</span><span class="keyword">[</span><span class="default">47</span><span class="keyword">] . </span><span class="string">'&lt;br&gt;'</span><span class="keyword">;<br />
echo </span><span class="default">$platoon</span><span class="keyword">[</span><span class="default">163</span><span class="keyword">] . </span><span class="string">'&lt;br&gt;'</span><span class="keyword">;<br />
<br />
</span><span class="default">$general</span><span class="keyword">-&gt;</span><span class="default">issueCommand</span><span class="keyword">(</span><span class="string">'Fire!'</span><span class="keyword">);<br />
echo </span><span class="default">$platoon</span><span class="keyword">[</span><span class="default">248</span><span class="keyword">] . </span><span class="string">'&lt;br&gt;'</span><span class="keyword">;<br />
echo </span><span class="default">$platoon</span><span class="keyword">[</span><span class="default">68</span><span class="keyword">] . </span><span class="string">'&lt;br&gt;'</span><span class="keyword">;<br />
<br />
</span><span class="default">$general</span><span class="keyword">-&gt;</span><span class="default">issueCommand</span><span class="keyword">(</span><span class="string">'Retreat!'</span><span class="keyword">);<br />
echo </span><span class="default">$platoon</span><span class="keyword">[</span><span class="default">26</span><span class="keyword">] . </span><span class="string">'&lt;br&gt;'</span><span class="keyword">;<br />
echo </span><span class="default">$platoon</span><span class="keyword">[</span><span class="default">197</span><span class="keyword">] . </span><span class="string">'&lt;br&gt;'</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
COMMAND ISSUED: Deploy Troops<br />
&nbsp; Soldier[id=1, status=deploying]<br />
&nbsp; Soldier[id=225, status=deploying]<br />
&nbsp; Soldier[id=14, status=deploying]<br />
<br />
COMMAND ISSUED: March Forward<br />
&nbsp; Soldier[id=49, status=marching forward]<br />
&nbsp; Soldier[id=165, status=marching forward]<br />
<br />
COMMAND ISSUED: Fire!<br />
&nbsp; Soldier[id=250, status=shot fired]<br />
&nbsp; Soldier[id=70, status=shot fired]<br />
<br />
COMMAND ISSUED: Retreat!<br />
&nbsp; Soldier[id=28, status=course reversed]<br />
&nbsp; Soldier[id=199, status=course reversed]</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84575""></a>
  <div class="note">
   <strong class="user">Jim Brown</strong>
   <a href="#84575" class="date">20-Jul-2008 12:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Regarding the generic deep __clone() example provided by david ashe at metabin:<br />
<br />
If your object has a variable that stores an array of objects, that particular __clone() example will NOT perform a deep copy on your array of objects.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83286""></a>
  <div class="note">
   <strong class="user">alex dot offshore at gmail dot com</strong>
   <a href="#83286" class="date">19-May-2008 12:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Remember that in PHP 5 ALL objects are assigned BY REFERENCE.<br />
<br />
<span class="default">&lt;?php<br />
<br />
&nbsp; </span><span class="keyword">function </span><span class="default">foo</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">) </span><span class="comment">// notice that '&amp;' near $a is missing<br />
&nbsp; </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$a</span><span class="keyword">[</span><span class="string">'bar'</span><span class="keyword">] = </span><span class="default">10</span><span class="keyword">;<br />
&nbsp; }<br />
<br />
&nbsp; </span><span class="default">$x </span><span class="keyword">= array(</span><span class="string">'bar' </span><span class="keyword">=&gt; </span><span class="default">0</span><span class="keyword">); </span><span class="comment">// built-in array() is not an object<br />
&nbsp; </span><span class="default">$y </span><span class="keyword">= new </span><span class="default">ArrayObject</span><span class="keyword">(array(</span><span class="string">'bar' </span><span class="keyword">=&gt; </span><span class="default">0</span><span class="keyword">));<br />
<br />
&nbsp; echo </span><span class="string">"\$x['bar'] == </span><span class="keyword">${</span><span class="default">x</span><span class="keyword">[</span><span class="string">'bar'</span><span class="keyword">]}</span><span class="string">;\n\$y['bar'] == </span><span class="keyword">${</span><span class="default">y</span><span class="keyword">[</span><span class="string">'bar'</span><span class="keyword">]}</span><span class="string">;\n\n"</span><span class="keyword">;<br />
<br />
&nbsp; </span><span class="default">foo</span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">);<br />
&nbsp; </span><span class="default">foo</span><span class="keyword">(</span><span class="default">$y</span><span class="keyword">);<br />
<br />
&nbsp; echo </span><span class="string">"\$x['bar'] == </span><span class="keyword">${</span><span class="default">x</span><span class="keyword">[</span><span class="string">'bar'</span><span class="keyword">]}</span><span class="string">;\n\$y['bar'] == </span><span class="keyword">${</span><span class="default">y</span><span class="keyword">[</span><span class="string">'bar'</span><span class="keyword">]}</span><span class="string">;\n"</span><span class="keyword">;<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Output:<br />
$x['bar'] == 0;<br />
$y['bar'] == 0;<br />
<br />
$x['bar'] == 0;<br />
$y['bar'] == 10;<br />
<br />
Hope this will be useful.<br />
<br />
By the way, to determine whether the variable is compatible with ArrayAccess/ArrayObject see <a href="http://php.net/manual/en/function.is-array.php#48083" rel="nofollow" target="_blank">http://php.net/manual/en/function.is-array.php#48083</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81774""></a>
  <div class="note">
   <strong class="user">crrodriguez at suse dot de</strong>
   <a href="#81774" class="date">13-Mar-2008 06:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Keep in mind that since PHP 5.2.5, trying to clone a non-object correctly results in a fatal error, this differs from previous versions where only a Warning was thrown.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="79886""></a>
  <div class="note">
   <strong class="user">Hayley Watson</strong>
   <a href="#79886" class="date">18-Dec-2007 12:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It should go without saying that if you have circular references, where a property of object A refers to object B while a property of B refers to A (or more indirect loops than that), then you'll be glad that clone does NOT automatically make a deep copy!<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">class </span><span class="default">Foo<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$that</span><span class="keyword">;<br />
<br />
function </span><span class="default">__clone</span><span class="keyword">()<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">that </span><span class="keyword">= clone </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">that</span><span class="keyword">;<br />
}<br />
<br />
}<br />
<br />
</span><span class="default">$a </span><span class="keyword">= new </span><span class="default">Foo</span><span class="keyword">;<br />
</span><span class="default">$b </span><span class="keyword">= new </span><span class="default">Foo</span><span class="keyword">;<br />
</span><span class="default">$a</span><span class="keyword">-&gt;</span><span class="default">that </span><span class="keyword">= </span><span class="default">$b</span><span class="keyword">;<br />
</span><span class="default">$b</span><span class="keyword">-&gt;</span><span class="default">that </span><span class="keyword">= </span><span class="default">$a</span><span class="keyword">;<br />
<br />
</span><span class="default">$c </span><span class="keyword">= clone </span><span class="default">$a</span><span class="keyword">;<br />
echo </span><span class="string">'What happened?'</span><span class="keyword">;<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">);</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73081""></a>
  <div class="note">
   <strong class="user">Alexey</strong>
   <a href="#73081" class="date">08-Feb-2007 04:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To implement __clone() method in complex classes I use this simple function:<br />
<br />
function clone_($some)<br />
{<br />
&nbsp;&nbsp; return (is_object($some)) ? clone $some : $some;<br />
}<br />
<br />
In this way I don't need to care about type of my class properties.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="72502""></a>
  <div class="note">
   <strong class="user">MakariVerslund at gmail dot com</strong>
   <a href="#72502" class="date">22-Jan-2007 01:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I ran into the same problem of an array of objects inside of an object that I wanted to clone all pointing to the same objects. However, I agreed that serializing the data was not the answer. It was relatively simple, really:
<br />

<br />
public function __clone() {
<br />
&nbsp;&nbsp;&nbsp; foreach ($this-&gt;varName as &amp;$a) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach ($a as &amp;$b) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $b = clone $b;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />
}
<br />

<br />
Note, that I was working with a multi-dimensional array and I was not using the Key=&gt;Value pair system, but basically, the point is that if you use foreach, you need to specify that the copied data is to be accessed by reference.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="51439""></a>
  <div class="note">
   <strong class="user">jorge dot villalobos at gmail dot com</strong>
   <a href="#51439" class="date">31-Mar-2005 12:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I think it's relevant to note that __clone is NOT an override. As the example shows, the normal cloning process always occurs, and it's the responsibility of the __clone method to "mend" any "wrong" action performed by it.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
