<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>由文件或 URL 创建一个新图象。</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.imagecreatefromgif.html">? imagecreatefromgif</a></li>
      <li style="float: right;"><a href="function.imagecreatefrompng.html">imagecreatefrompng ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.image.html">GD 和图像处理 函数</a></li>
    <li>由文件或 URL 创建一个新图象。</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.imagecreatefromjpeg" class="refentry">
 <div class="refnamediv">
 <h1 class="refname">imagecreatefromjpeg</h1>
  <p class="verinfo">(PHP 4, PHP 5, PHP 7)</p><p class="refpurpose"><span class="refname">imagecreatefromjpeg</span> &mdash; <span class="dc-title">由文件或 URL 创建一个新图象。</span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.imagecreatefromjpeg-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">resource</span> <span class="methodname"><strong>imagecreatefromjpeg</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$filename</code></span>
   )</div>

  <p class="para rdfs-comment">
   <span class="function"><strong>imagecreatefromjpeg()</strong></span>
   返回一图像标识符，代表了从给定的文件名取得的图像。
  </p>
    <div class="tip"><strong class="tip">Tip</strong><p class="simpara">如已启用<a href="filesystem.configuration.html#ini.allow-url-fopen" class="link">fopen 包装器</a>，在此函数中， URL 可作为文件名。关于如何指定文件名详见 <span class="function"><a href="function.fopen.html" class="function">fopen()</a></span>。各种
wapper 的不同功能请参见 <a href="wrappers.html" class="xref">支持的协议和封装协议</a>，注意其用法及其可提供的预定义变量。</p></div>
 </div>

 <div class="refsect1 parameters" id="refsect1-function.imagecreatefromjpeg-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">filename</code></dt>

     <dd>

      <p class="para">
       JPEG 图像的路径。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>

 <div class="refsect1 returnvalues" id="refsect1-function.imagecreatefromjpeg-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">成功后返回图象资源,失败后返回 <strong><code>FALSE</code></strong> 。</p>
 </div>

 <div class="refsect1 examples" id="refsect1-function.imagecreatefromjpeg-examples">
  <h3 class="title">范例</h3>
  <div class="example" id="example-3428">
   <p><strong>Example #1 处理创建过程中的错误</strong></p>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">function&nbsp;</span><span style="color: #0000BB">LoadJpeg</span><span style="color: #007700">(</span><span style="color: #0000BB">$imgname</span><span style="color: #007700">)<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;尝试打开&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$im&nbsp;</span><span style="color: #007700">=&nbsp;@</span><span style="color: #0000BB">imagecreatefromjpeg</span><span style="color: #007700">(</span><span style="color: #0000BB">$imgname</span><span style="color: #007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;See&nbsp;if&nbsp;it&nbsp;failed&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if(!</span><span style="color: #0000BB">$im</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;Create&nbsp;a&nbsp;black&nbsp;image&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$im&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">imagecreatetruecolor</span><span style="color: #007700">(</span><span style="color: #0000BB">150</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">30</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$bgc&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">imagecolorallocate</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">255</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">255</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">255</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$tc&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">imagecolorallocate</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">imagefilledrectangle</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">150</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">30</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$bgc</span><span style="color: #007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*&nbsp;Output&nbsp;an&nbsp;error&nbsp;message&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">imagestring</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">5</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">5</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'Error&nbsp;loading&nbsp;'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$imgname</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$tc</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$im</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #0000BB">header</span><span style="color: #007700">(</span><span style="color: #DD0000">'Content-Type:&nbsp;image/jpeg'</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$img&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">LoadJpeg</span><span style="color: #007700">(</span><span style="color: #DD0000">'bogus.image'</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">imagejpeg</span><span style="color: #007700">(</span><span style="color: #0000BB">$img</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">imagedestroy</span><span style="color: #007700">(</span><span style="color: #0000BB">$img</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

   <div class="example-contents"><p>以上例程的输出类似于：</p></div>
   <div class="mediaobject">
    
    <div class="imageobject">
     <img src="images/21009b70229598c6a80eef8b45bf282b-imagecreatefromjpeg.jpg" alt="例子输出：加载图片出现错误时的处理范例" width="150" height="30" />
    </div>
   </div>
  </div>
 </div>

 <div class="refsect1 notes" id="refsect1-function.imagecreatefromjpeg-notes">
  <h3 class="title">注释</h3>
  <blockquote class="note"><p><strong class="note">Note</strong>: <span class="simpara">JPEG 支持仅在 PHP 与 GD-1.8 或更高版本一起编译时可用。</span></p></blockquote>
  <div class="warning"><strong class="warning">Warning</strong><p class="para">Windows 版本的 PHP 在 4.3.0
版之前不支持通过此函数访问远程文件，即使已经启用 <a href="filesystem.configuration.html#ini.allow-url-fopen" class="link">allow_url_fopen</a>.
</p></div>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="119443""></a>
  <div class="note">
   <strong class="user">reorganisation at evo-german dot com</strong>
   <a href="#119443" class="date">07-Jun-2016 08:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Had to fight with this error message:<br />
<br />
imagecreatefromjpeg(): gd-jpeg: JPEG library reports unrecoverable error<br />
<br />
and found, that some picture tools like GIMP are adding EXIF-Informantions about changes.<br />
Those pictures are running in the above problem.<br />
<br />
Using an easy picture tool like Windows Paint - save the image new - and imagecreatefromjpeg worked for me.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="118434""></a>
  <div class="note">
   <strong class="user">glapa</strong>
   <a href="#118434" class="date">05-Dec-2015 07:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
people, those long codes...<br />
If you need to resize an image just write:<br />
<br />
$size= getimagesize($path);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($size['mime'] == 'image/jpeg')<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $image = imagecreatefromjpeg($path);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; imagejpeg($image, $path, 30);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo '&lt;img src="'. $path.'" width="50%" height="50%"&gt;&lt;/img&gt;&lt;/a&gt;&lt;br /&gt;';<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="112902""></a>
  <div class="note">
   <strong class="user">jan at recreatie-zorg dot nl</strong>
   <a href="#112902" class="date">05-Aug-2013 07:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This function does not honour EXIF orientation data.&nbsp; Pictures that are rotated using EXIF, will show up in the original orientation after being handled by imagecreatefromjpeg().&nbsp; Below is a function to create an image from JPEG while honouring EXIF orientation data.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">imagecreatefromjpegexif</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$img </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$exif </span><span class="keyword">= </span><span class="default">exif_read_data</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$img </span><span class="keyword">&amp;&amp; </span><span class="default">$exif </span><span class="keyword">&amp;&amp; isset(</span><span class="default">$exif</span><span class="keyword">[</span><span class="string">'Orientation'</span><span class="keyword">]))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ort </span><span class="keyword">= </span><span class="default">$exif</span><span class="keyword">[</span><span class="string">'Orientation'</span><span class="keyword">];<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$ort </span><span class="keyword">== </span><span class="default">6 </span><span class="keyword">|| </span><span class="default">$ort </span><span class="keyword">== </span><span class="default">5</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$img </span><span class="keyword">= </span><span class="default">imagerotate</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">, </span><span class="default">270</span><span class="keyword">, </span><span class="default">null</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$ort </span><span class="keyword">== </span><span class="default">3 </span><span class="keyword">|| </span><span class="default">$ort </span><span class="keyword">== </span><span class="default">4</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$img </span><span class="keyword">= </span><span class="default">imagerotate</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">, </span><span class="default">180</span><span class="keyword">, </span><span class="default">null</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$ort </span><span class="keyword">== </span><span class="default">8 </span><span class="keyword">|| </span><span class="default">$ort </span><span class="keyword">== </span><span class="default">7</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$img </span><span class="keyword">= </span><span class="default">imagerotate</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">, </span><span class="default">90</span><span class="keyword">, </span><span class="default">null</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$ort </span><span class="keyword">== </span><span class="default">5 </span><span class="keyword">|| </span><span class="default">$ort </span><span class="keyword">== </span><span class="default">4 </span><span class="keyword">|| </span><span class="default">$ort </span><span class="keyword">== </span><span class="default">7</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imageflip</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">, </span><span class="default">IMG_FLIP_HORIZONTAL</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$img</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="110547""></a>
  <div class="note">
   <strong class="user">matt dot squirrell dot php at hsmx dot com</strong>
   <a href="#110547" class="date">05-Nov-2012 10:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This little function allows you to create an image based on the popular image types without worrying about what it is:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">imageCreateFromAny</span><span class="keyword">(</span><span class="default">$filepath</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$type </span><span class="keyword">= </span><span class="default">exif_imagetype</span><span class="keyword">(</span><span class="default">$filepath</span><span class="keyword">); </span><span class="comment">// [] if you don't have exif you could use getImageSize()
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$allowedTypes </span><span class="keyword">= array(
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">1</span><span class="keyword">,&nbsp; </span><span class="comment">// [] gif
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">2</span><span class="keyword">,&nbsp; </span><span class="comment">// [] jpg
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">3</span><span class="keyword">,&nbsp; </span><span class="comment">// [] png
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">6&nbsp;&nbsp; </span><span class="comment">// [] bmp
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; if (!</span><span class="default">in_array</span><span class="keyword">(</span><span class="default">$type</span><span class="keyword">, </span><span class="default">$allowedTypes</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; switch (</span><span class="default">$type</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">1 </span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$im </span><span class="keyword">= </span><span class="default">imageCreateFromGif</span><span class="keyword">(</span><span class="default">$filepath</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; break;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">2 </span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$im </span><span class="keyword">= </span><span class="default">imageCreateFromJpeg</span><span class="keyword">(</span><span class="default">$filepath</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; break;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">3 </span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$im </span><span class="keyword">= </span><span class="default">imageCreateFromPng</span><span class="keyword">(</span><span class="default">$filepath</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; break;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">6 </span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$im </span><span class="keyword">= </span><span class="default">imageCreateFromBmp</span><span class="keyword">(</span><span class="default">$filepath</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; break;
<br />
&nbsp;&nbsp;&nbsp; }&nbsp; &nbsp; 
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$im</span><span class="keyword">;&nbsp; 
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="108533""></a>
  <div class="note">
   <strong class="user">pavel.lint at vk.com</strong>
   <a href="#108533" class="date">04-May-2012 06:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I was experiencing troubles with imagecreatefromjpeg() as it outputted errors even when called with @ in front. ini_set("gd.jpeg_ignore_warning", 1) didnt work for me, so I came up with another simple solution. <br />
<br />
The problem is caused by gd error output, so by redirecting STDERR to /dev/null all the error messages in it are supressed and you can still use regular STDOUT for your error output.<br />
<br />
So, just use<br />
&lt;?<br />
fclose( STDERR );<br />
$STDERR = fopen( "/dev/null", "wb" );<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="104902""></a>
  <div class="note">
   <strong class="user">Zane, MegaLab.it</strong>
   <a href="#104902" class="date">14-Jul-2011 06:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Some image where failing with a Warning: imagecreatefromjpeg(): gd-jpeg, libjpeg: recoverable error: Premature end of JPEG file<br />
<br />
The only way to make it work was to ini_set("gd.jpeg_ignore_warning", 1); and then call it with @imagecreatefromjpeg()<br />
<br />
It's far less than ideal, but if you're stuck as I was, give it a try.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="103657""></a>
  <div class="note">
   <strong class="user">Jrn Berkefeld</strong>
   <a href="#103657" class="date">26-Apr-2011 08:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I encountered a very strange behaviour:
<br />
The background: 
<br />
Each time users uploaded images, the original file was stored along with a thumbnail and a medium sized version for small-sized slideshows.
<br />
that means that on upload all of these original images were acknowledged by php as valid jpg
<br />

<br />
The change:
<br />
I created a new slideshow script that featured full-screen display. My old "medium-sized" version were only about 600px wide which caused them to luck all ugly after stretching that to modern screen sizes.
<br />
--&gt; I created a small script that opens all original images and saves bigger "medium-sized" versions than the once I had.
<br />

<br />
the problem:
<br />
for some reason about 1/3 of all images (not the last third but always the same images) were now labeled as "... is not a valid JPEG file ..." by php
<br />

<br />
the cause:
<br />
still unknown
<br />

<br />
the solution:
<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">...
<br />
</span><span class="default">$src_img </span><span class="keyword">= @</span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$myJPGfile_relative</span><span class="keyword">);
<br />
if (!</span><span class="default">$src_img</span><span class="keyword">) { 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$src_img </span><span class="keyword">= </span><span class="default">LoadJPEG</span><span class="keyword">(</span><span class="string">"<a href="http://example.com/" rel="nofollow" target="_blank">http://example.com/</a>"</span><span class="keyword">.</span><span class="default">$myJPGfile</span><span class="keyword">);
<br />
}
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Each time the local approach fails the script falls back to loading the same file "from the outside" via the below mentioned "LoadJPEG" script - big thanks to the author!
<br />
That worked even though I'm talking about the exact same file on the exact same server. The only difference is that one time it's accessed locally and the second via port 80.
<br />

<br />
when using this, watch for correct paths relative to your script and the possibly different path relative to your domain.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100486""></a>
  <div class="note">
   <strong class="user">juozaspo at gmail dot com</strong>
   <a href="#100486" class="date">19-Oct-2010 11:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There is my actual script to resize image without distortion to generate a thumbnail and/or show a smaller to browser. <br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// usual header used on my all pages<br />
</span><span class="default">ob_start</span><span class="keyword">(</span><span class="string">"ob_gzhandler"</span><span class="keyword">);<br />
</span><span class="default">$PHP_SELF</span><span class="keyword">=</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_SELF'</span><span class="keyword">];<br />
include </span><span class="string">"include/errors.php"</span><span class="keyword">; </span><span class="comment">//error log script<br />
<br />
// actual script begins here<br />
</span><span class="default">$type</span><span class="keyword">=</span><span class="default">false</span><span class="keyword">;<br />
function </span><span class="default">open_image </span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//detect type and process accordinally<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">global </span><span class="default">$type</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$size</span><span class="keyword">=</span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; switch(</span><span class="default">$size</span><span class="keyword">[</span><span class="string">"mime"</span><span class="keyword">]){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">"image/jpeg"</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$im </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">); </span><span class="comment">//jpeg file<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="string">"image/gif"</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$im </span><span class="keyword">= </span><span class="default">imagecreatefromgif</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">); </span><span class="comment">//gif file<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="keyword">break;<br />
&nbsp;&nbsp; &nbsp;&nbsp; case </span><span class="string">"image/png"</span><span class="keyword">:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$im </span><span class="keyword">= </span><span class="default">imagecreatefrompng</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">); </span><span class="comment">//png file<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="keyword">break;<br />
&nbsp;&nbsp;&nbsp; default: <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$im</span><span class="keyword">=</span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; break;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$im</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">$url </span><span class="keyword">= </span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'url'</span><span class="keyword">];<br />
if (isset(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'HTTP_IF_MODIFIED_SINCE'</span><span class="keyword">]) &amp;&amp; (</span><span class="default">strtotime</span><span class="keyword">(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'HTTP_IF_MODIFIED_SINCE'</span><span class="keyword">]) == </span><span class="default">filemtime</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">))) {<br />
&nbsp; </span><span class="comment">// send the last mod time of the file back<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Last-Modified: '</span><span class="keyword">.</span><span class="default">gmdate</span><span class="keyword">(</span><span class="string">'D, d M Y H:i:s'</span><span class="keyword">, </span><span class="default">filemtime</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">)).</span><span class="string">' GMT'</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">, </span><span class="default">304</span><span class="keyword">); </span><span class="comment">//is it cached?<br />
</span><span class="keyword">} else {<br />
<br />
</span><span class="default">$image </span><span class="keyword">= </span><span class="default">open_image</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">);<br />
<br />
if (</span><span class="default">$image </span><span class="keyword">=== </span><span class="default">false</span><span class="keyword">) { die (</span><span class="string">'Unable to open image'</span><span class="keyword">); }<br />
<br />
</span><span class="default">$w </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);<br />
</span><span class="default">$h </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);<br />
<br />
</span><span class="comment">//calculate new image dimensions (preserve aspect)<br />
</span><span class="keyword">if(isset(</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'w'</span><span class="keyword">]) &amp;&amp; !isset(</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'h'</span><span class="keyword">])){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$new_w</span><span class="keyword">=</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'w'</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$new_h</span><span class="keyword">=</span><span class="default">$new_w </span><span class="keyword">* (</span><span class="default">$h</span><span class="keyword">/</span><span class="default">$w</span><span class="keyword">);<br />
} elseif (isset(</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'h'</span><span class="keyword">]) &amp;&amp; !isset(</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'w'</span><span class="keyword">])) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$new_h</span><span class="keyword">=</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'h'</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$new_w</span><span class="keyword">=</span><span class="default">$new_h </span><span class="keyword">* (</span><span class="default">$w</span><span class="keyword">/</span><span class="default">$h</span><span class="keyword">);<br />
} else {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$new_w</span><span class="keyword">=isset(</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'w'</span><span class="keyword">])?</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'w'</span><span class="keyword">]:</span><span class="default">560</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$new_h</span><span class="keyword">=isset(</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'h'</span><span class="keyword">])?</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'h'</span><span class="keyword">]:</span><span class="default">560</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if((</span><span class="default">$w</span><span class="keyword">/</span><span class="default">$h</span><span class="keyword">) &gt; (</span><span class="default">$new_w</span><span class="keyword">/</span><span class="default">$new_h</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_h</span><span class="keyword">=</span><span class="default">$new_w</span><span class="keyword">*(</span><span class="default">$h</span><span class="keyword">/</span><span class="default">$w</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_w</span><span class="keyword">=</span><span class="default">$new_h</span><span class="keyword">*(</span><span class="default">$w</span><span class="keyword">/</span><span class="default">$h</span><span class="keyword">);&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; }<br />
} <br />
<br />
</span><span class="default">$im2 </span><span class="keyword">= </span><span class="default">ImageCreateTrueColor</span><span class="keyword">(</span><span class="default">$new_w</span><span class="keyword">, </span><span class="default">$new_h</span><span class="keyword">);<br />
</span><span class="default">imagecopyResampled </span><span class="keyword">(</span><span class="default">$im2</span><span class="keyword">, </span><span class="default">$image</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$new_w</span><span class="keyword">, </span><span class="default">$new_h</span><span class="keyword">, </span><span class="default">$w</span><span class="keyword">, </span><span class="default">$h</span><span class="keyword">);<br />
</span><span class="comment">//effects<br />
</span><span class="keyword">if(isset(</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'blur'</span><span class="keyword">])){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$lv</span><span class="keyword">=</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'blur'</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">$lv</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">++){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$matrix</span><span class="keyword">=array(array(</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">),array(</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">),array(</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$divisor </span><span class="keyword">= </span><span class="default">9</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$offset </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imageconvolution</span><span class="keyword">(</span><span class="default">$im2</span><span class="keyword">, </span><span class="default">$matrix</span><span class="keyword">, </span><span class="default">$divisor</span><span class="keyword">, </span><span class="default">$offset</span><span class="keyword">); <br />
&nbsp;&nbsp;&nbsp; } <br />
}<br />
if(isset(</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'sharpen'</span><span class="keyword">])){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$lv</span><span class="keyword">=</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'sharpen'</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">$lv</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">++){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$matrix </span><span class="keyword">= array(array(-</span><span class="default">1</span><span class="keyword">,-</span><span class="default">1</span><span class="keyword">,-</span><span class="default">1</span><span class="keyword">),array(-</span><span class="default">1</span><span class="keyword">,</span><span class="default">16</span><span class="keyword">,-</span><span class="default">1</span><span class="keyword">),array(-</span><span class="default">1</span><span class="keyword">,-</span><span class="default">1</span><span class="keyword">,-</span><span class="default">1</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$divisor </span><span class="keyword">= </span><span class="default">8</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$offset </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imageconvolution</span><span class="keyword">(</span><span class="default">$im2</span><span class="keyword">, </span><span class="default">$matrix</span><span class="keyword">, </span><span class="default">$divisor</span><span class="keyword">, </span><span class="default">$offset</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; } <br />
}<br />
<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-type: image/jpeg'</span><span class="keyword">);<br />
</span><span class="default">$name</span><span class="keyword">=</span><span class="default">explode</span><span class="keyword">(</span><span class="string">"."</span><span class="keyword">, </span><span class="default">basename</span><span class="keyword">(</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'url'</span><span class="keyword">]));<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-Disposition: inline; filename="</span><span class="keyword">.</span><span class="default">$name</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">].</span><span class="string">"_t.jpg"</span><span class="keyword">);<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">'Last-Modified: ' </span><span class="keyword">. </span><span class="default">gmdate</span><span class="keyword">(</span><span class="string">'D, d M Y H:i:s'</span><span class="keyword">, </span><span class="default">filemtime</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">)) . </span><span class="string">' GMT'</span><span class="keyword">);<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">"Cache-Control: public"</span><span class="keyword">);<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">"Pragma: public"</span><span class="keyword">);<br />
</span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$im2</span><span class="keyword">);<br />
</span><span class="comment">//imagedestroy($im2); <br />
//imagedestroy($image);<br />
</span><span class="keyword">}&nbsp;&nbsp; <br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100338""></a>
  <div class="note">
   <strong class="user">Ray.Paseur sometimes uses Gmail</strong>
   <a href="#100338" class="date">09-Oct-2010 12:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you have a blank in the file name, and you use a local URL, this function works.&nbsp; Not so with a fully qualified URL
<br />

<br />
<span class="default">&lt;?php 
<br />
$url </span><span class="keyword">= </span><span class="string">'RAY_rgb 300x100.jpg'</span><span class="keyword">;
<br />
</span><span class="default">$img </span><span class="keyword">= </span><span class="default">ImageCreateFromJPEG</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">);
<br />
</span><span class="comment">// WORKS PERFECTLY
<br />

<br />
</span><span class="default">$url </span><span class="keyword">= </span><span class="string">'<a href="http://www.example.com/RAY_rgb 300x100.jpg" rel="nofollow" target="_blank">http://www.example.com/RAY_rgb 300x100.jpg</a>'</span><span class="keyword">;
<br />
</span><span class="default">$img </span><span class="keyword">= </span><span class="default">ImageCreateFromJPEG</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">);
<br />
</span><span class="comment">// FAILS Warning: imagecreatefromjpeg() [function.imagecreatefromjpeg]: gd-jpeg: JPEG library reports unrecoverable error
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99793""></a>
  <div class="note">
   <strong class="user">nico at anvilstudios dot co dot za</strong>
   <a href="#99793" class="date">07-Sep-2010 09:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I encountered a problem with this function on a windows system. Instead of returning false in case of the file not being a JPG, the function resulted in an error: 
<br />
"imagecreatefromjpeg() : gd-jpeg : JPEG library reports unrecoverable error".
<br />

<br />
To get around this first check whether the file is a JPEG file using its mime type, if it is not return false.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="96227""></a>
  <div class="note">
   <strong class="user">brentwientjes at NOSPAM dot comcast dot net</strong>
   <a href="#96227" class="date">16-Feb-2010 09:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Last night I posted the following note under move_upload_file and looked tonight to see if it got into the system.&nbsp; I happen to also pull up imagecreatefromjpeg and got reminded of many resize scripts in this section.&nbsp; Unfortunately, my experience was not covered by most of the examples below because each of them assumed less than obvious requirements of the server and browser.&nbsp; So here is the post again under this section to help others uncover the mystery in file uploading and resizing arbitrary sized images.&nbsp; I have been testing for several days with hundreds of various size images and it seems to work well.&nbsp; Many additional features could be added such as transparency, alpha blending, camera specific knowledge, more error checking.&nbsp; Best of luck.<br />
<br />
---&nbsp; from move_upload_file post ---<br />
<br />
I have for a couple of years been stymed to understand how to effectively load images (of more than 2MB) and then create thumbnails.&nbsp; My note below on general file uploading was an early hint of some of the system default limitations and I have recently discovered the final limit&nbsp; I offer this as an example of the various missing pieces of information to successfully load images of more than 2MB and then create thumbnails.&nbsp; This particular example assumes a picture of a user is being uploaded and because of browser caching needs a unique number at the end to make the browser load a new picture for review at the time of upload.&nbsp; The overall calling program I am using is a Flex based application which calls this php file to upload user thumbnails.<br />
<br />
The secret sauce is:<br />
<br />
1.&nbsp; adjust server memory size, file upload size, and post size<br />
2.&nbsp; convert image to standard formate (in this case jpg) and scale<br />
<br />
The server may be adjusted with the .htaccess file or inline code.&nbsp; This example has an .htaccess file with file upload size and post size and then inline code for dynamic system memory.<br />
<br />
htaccess file:<br />
php_value post_max_size 16M<br />
php_value upload_max_filesize 6M<br />
<br />
<span class="default">&lt;?php <br />
</span><span class="comment">//&nbsp; $img_base = base directory structure for thumbnail images<br />
//&nbsp; $w_dst = maximum width of thumbnail<br />
//&nbsp; $h_dst = maximum height of thumbnail<br />
//&nbsp; $n_img = new thumbnail name<br />
//&nbsp; $o_img = old thumbnail name<br />
</span><span class="keyword">function </span><span class="default">convertPic</span><span class="keyword">(</span><span class="default">$img_base</span><span class="keyword">, </span><span class="default">$w_dst</span><span class="keyword">, </span><span class="default">$h_dst</span><span class="keyword">, </span><span class="default">$n_img</span><span class="keyword">, </span><span class="default">$o_img</span><span class="keyword">)<br />
&nbsp; {</span><span class="default">ini_set</span><span class="keyword">(</span><span class="string">'memory_limit'</span><span class="keyword">, </span><span class="string">'100M'</span><span class="keyword">);&nbsp;&nbsp; </span><span class="comment">//&nbsp; handle large images<br />
&nbsp;&nbsp; </span><span class="default">unlink</span><span class="keyword">(</span><span class="default">$img_base</span><span class="keyword">.</span><span class="default">$n_img</span><span class="keyword">);&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//&nbsp; remove old images if present<br />
&nbsp;&nbsp; </span><span class="default">unlink</span><span class="keyword">(</span><span class="default">$img_base</span><span class="keyword">.</span><span class="default">$o_img</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">$new_img </span><span class="keyword">= </span><span class="default">$img_base</span><span class="keyword">.</span><span class="default">$n_img</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; <br />
&nbsp;&nbsp; </span><span class="default">$file_src </span><span class="keyword">= </span><span class="default">$img_base</span><span class="keyword">.</span><span class="string">"img.jpg"</span><span class="keyword">;&nbsp; </span><span class="comment">//&nbsp; temporary safe image storage<br />
&nbsp;&nbsp; </span><span class="default">unlink</span><span class="keyword">(</span><span class="default">$file_src</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">move_uploaded_file</span><span class="keyword">(</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'Filedata'</span><span class="keyword">][</span><span class="string">'tmp_name'</span><span class="keyword">], </span><span class="default">$file_src</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; list(</span><span class="default">$w_src</span><span class="keyword">, </span><span class="default">$h_src</span><span class="keyword">, </span><span class="default">$type</span><span class="keyword">) = </span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$file_src</span><span class="keyword">);&nbsp; </span><span class="comment">// create new dimensions, keeping aspect ratio<br />
&nbsp;&nbsp; </span><span class="default">$ratio </span><span class="keyword">= </span><span class="default">$w_src</span><span class="keyword">/</span><span class="default">$h_src</span><span class="keyword">;<br />
&nbsp;&nbsp; if (</span><span class="default">$w_dst</span><span class="keyword">/</span><span class="default">$h_dst </span><span class="keyword">&gt; </span><span class="default">$ratio</span><span class="keyword">) {</span><span class="default">$w_dst </span><span class="keyword">= </span><span class="default">floor</span><span class="keyword">(</span><span class="default">$h_dst</span><span class="keyword">*</span><span class="default">$ratio</span><span class="keyword">);} else {</span><span class="default">$h_dst </span><span class="keyword">= </span><span class="default">floor</span><span class="keyword">(</span><span class="default">$w_dst</span><span class="keyword">/</span><span class="default">$ratio</span><span class="keyword">);}<br />
<br />
&nbsp;&nbsp; switch (</span><span class="default">$type</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; {case </span><span class="default">1</span><span class="keyword">:&nbsp;&nbsp; </span><span class="comment">//&nbsp;&nbsp; gif -&gt; jpg<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$img_src </span><span class="keyword">= </span><span class="default">imagecreatefromgif</span><span class="keyword">(</span><span class="default">$file_src</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp;&nbsp; case </span><span class="default">2</span><span class="keyword">:&nbsp;&nbsp; </span><span class="comment">//&nbsp;&nbsp; jpeg -&gt; jpg<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$img_src </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$file_src</span><span class="keyword">); <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp;&nbsp; case </span><span class="default">3</span><span class="keyword">:&nbsp; </span><span class="comment">//&nbsp;&nbsp; png -&gt; jpg<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$img_src </span><span class="keyword">= </span><span class="default">imagecreatefrompng</span><span class="keyword">(</span><span class="default">$file_src</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; }<br />
&nbsp;&nbsp; </span><span class="default">$img_dst </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$w_dst</span><span class="keyword">, </span><span class="default">$h_dst</span><span class="keyword">);&nbsp; </span><span class="comment">//&nbsp; resample<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp; </span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$img_dst</span><span class="keyword">, </span><span class="default">$img_src</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$w_dst</span><span class="keyword">, </span><span class="default">$h_dst</span><span class="keyword">, </span><span class="default">$w_src</span><span class="keyword">, </span><span class="default">$h_src</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$img_dst</span><span class="keyword">, </span><span class="default">$new_img</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">//&nbsp; save new image<br />
<br />
&nbsp;&nbsp; </span><span class="default">unlink</span><span class="keyword">(</span><span class="default">$file_src</span><span class="keyword">);&nbsp; </span><span class="comment">//&nbsp; clean up image storage<br />
&nbsp;&nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$img_src</span><span class="keyword">);&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$img_dst</span><span class="keyword">);<br />
&nbsp; }<br />
<br />
</span><span class="default">$p_id </span><span class="keyword">= (Integer) </span><span class="default">$_POST</span><span class="keyword">[</span><span class="default">uid</span><span class="keyword">];<br />
</span><span class="default">$ver </span><span class="keyword">= (Integer) </span><span class="default">$_POST</span><span class="keyword">[</span><span class="default">ver</span><span class="keyword">];<br />
</span><span class="default">$delver </span><span class="keyword">= (Integer) </span><span class="default">$_POST</span><span class="keyword">[</span><span class="default">delver</span><span class="keyword">];<br />
</span><span class="default">convertPic</span><span class="keyword">(</span><span class="string">"your/file/structure/"</span><span class="keyword">, </span><span class="default">150</span><span class="keyword">, </span><span class="default">150</span><span class="keyword">, </span><span class="string">"u"</span><span class="keyword">.</span><span class="default">$p_id</span><span class="keyword">.</span><span class="string">"v"</span><span class="keyword">.</span><span class="default">$ver</span><span class="keyword">.</span><span class="string">".jpg"</span><span class="keyword">, </span><span class="string">"u"</span><span class="keyword">.</span><span class="default">$p_id</span><span class="keyword">.</span><span class="string">"v"</span><span class="keyword">.</span><span class="default">$delver</span><span class="keyword">.</span><span class="string">".jpg"</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="94500""></a>
  <div class="note">
   <strong class="user">v1d4l0k4 at gmail.com</strong>
   <a href="#94500" class="date">09-Nov-2009 07:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As of PHP 5.1.3, if you are dealing with corrupted JPEG images you should set the 'gd.jpeg_ignore_warning' directive to 1 to ignore warnings that could mess up your code.<br />
<br />
In runtime, you should do this:<br />
<br />
<span class="default">&lt;?php<br />
<br />
ini_set</span><span class="keyword">(</span><span class="string">'gd.jpeg_ignore_warning'</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Regards,<br />
Paulo Ricardo</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="89865""></a>
  <div class="note">
   <strong class="user">francesco@essensys</strong>
   <a href="#89865" class="date">26-Mar-2009 02:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I didn't find any example like this, so I mixed pieces together.. hope this will save time to other people!<br />
<br />
Here's a complete solution to READ any image (gif jpg png) from the FILESYSTEM, SCALE it to a max width/height, SAVE the scaled image to a BLOB field keeping the original image type. Quite tricky.. <br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">scaleImageFileToBlob</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">) {<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$source_pic </span><span class="keyword">= </span><span class="default">$file</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$max_width </span><span class="keyword">= </span><span class="default">200</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$max_height </span><span class="keyword">= </span><span class="default">200</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; list(</span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">, </span><span class="default">$image_type</span><span class="keyword">) = </span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; switch (</span><span class="default">$image_type</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">1</span><span class="keyword">: </span><span class="default">$src </span><span class="keyword">= </span><span class="default">imagecreatefromgif</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">); break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">2</span><span class="keyword">: </span><span class="default">$src </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">3</span><span class="keyword">: </span><span class="default">$src </span><span class="keyword">= </span><span class="default">imagecreatefrompng</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">); break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; default: return </span><span class="string">''</span><span class="keyword">;&nbsp; break;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$x_ratio </span><span class="keyword">= </span><span class="default">$max_width </span><span class="keyword">/ </span><span class="default">$width</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$y_ratio </span><span class="keyword">= </span><span class="default">$max_height </span><span class="keyword">/ </span><span class="default">$height</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; if( (</span><span class="default">$width </span><span class="keyword">&lt;= </span><span class="default">$max_width</span><span class="keyword">) &amp;&amp; (</span><span class="default">$height </span><span class="keyword">&lt;= </span><span class="default">$max_height</span><span class="keyword">) ){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tn_width </span><span class="keyword">= </span><span class="default">$width</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tn_height </span><span class="keyword">= </span><span class="default">$height</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }elseif ((</span><span class="default">$x_ratio </span><span class="keyword">* </span><span class="default">$height</span><span class="keyword">) &lt; </span><span class="default">$max_height</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tn_height </span><span class="keyword">= </span><span class="default">ceil</span><span class="keyword">(</span><span class="default">$x_ratio </span><span class="keyword">* </span><span class="default">$height</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tn_width </span><span class="keyword">= </span><span class="default">$max_width</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }else{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tn_width </span><span class="keyword">= </span><span class="default">ceil</span><span class="keyword">(</span><span class="default">$y_ratio </span><span class="keyword">* </span><span class="default">$width</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tn_height </span><span class="keyword">= </span><span class="default">$max_height</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$tmp </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$tn_width</span><span class="keyword">,</span><span class="default">$tn_height</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/* Check if this image is PNG or GIF to preserve its transparency */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if((</span><span class="default">$image_type </span><span class="keyword">== </span><span class="default">1</span><span class="keyword">) OR (</span><span class="default">$image_type</span><span class="keyword">==</span><span class="default">3</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagealphablending</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagesavealpha</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">,</span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$transparent </span><span class="keyword">= </span><span class="default">imagecolorallocatealpha</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">127</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">imagefilledrectangle</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$tn_width</span><span class="keyword">, </span><span class="default">$tn_height</span><span class="keyword">, </span><span class="default">$transparent</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">imagecopyresampled</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">,</span><span class="default">$src</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$tn_width</span><span class="keyword">, </span><span class="default">$tn_height</span><span class="keyword">,</span><span class="default">$width</span><span class="keyword">,</span><span class="default">$height</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/*<br />
&nbsp;&nbsp; &nbsp; * imageXXX() has only two options, save as a file, or send to the browser.<br />
&nbsp;&nbsp; &nbsp; * It does not provide you the oppurtunity to manipulate the final GIF/JPG/PNG file stream<br />
&nbsp;&nbsp; &nbsp; * So I start the output buffering, use imageXXX() to output the data stream to the browser, <br />
&nbsp;&nbsp; &nbsp; * get the contents of the stream, and use clean to silently discard the buffered contents.<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">ob_start</span><span class="keyword">();<br />
<br />
&nbsp;&nbsp;&nbsp; switch (</span><span class="default">$image_type</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">1</span><span class="keyword">: </span><span class="default">imagegif</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">); break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">2</span><span class="keyword">: </span><span class="default">imagejpeg</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">, </span><span class="default">NULL</span><span class="keyword">, </span><span class="default">100</span><span class="keyword">);&nbsp; break; </span><span class="comment">// best quality<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">case </span><span class="default">3</span><span class="keyword">: </span><span class="default">imagepng</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">, </span><span class="default">NULL</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">); break; </span><span class="comment">// no compression<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">default: echo </span><span class="string">''</span><span class="keyword">; break;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$final_image </span><span class="keyword">= </span><span class="default">ob_get_contents</span><span class="keyword">();<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">ob_end_clean</span><span class="keyword">();<br />
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$final_image</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
So, let's suppose you have a form where a user can upload an image, and you have to scale it and save it into your database.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">[..] </span><span class="comment">// the user has clicked the Submit button..<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; // Check if the user entered an image<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'imagefile'</span><span class="keyword">][</span><span class="string">'name'</span><span class="keyword">] != </span><span class="string">''</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$image </span><span class="keyword">= </span><span class="default">scaleImageFileToBlob</span><span class="keyword">(</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'imagefile'</span><span class="keyword">][</span><span class="string">'tmp_name'</span><span class="keyword">]);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$image </span><span class="keyword">== </span><span class="string">''</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">'Image type not supported'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$image_type </span><span class="keyword">= </span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'imagefile'</span><span class="keyword">][</span><span class="string">'type'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$image </span><span class="keyword">= </span><span class="default">addslashes</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$query&nbsp; </span><span class="keyword">= </span><span class="string">"UPDATE yourtable SET image_type='</span><span class="default">$image_type</span><span class="string">', image='</span><span class="default">$image</span><span class="string">' WHERE ..."</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$result</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">'Image scaled and uploaded'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">'Error running the query'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="80598""></a>
  <div class="note">
   <strong class="user">webmaster [at] justuspics [tod] com</strong>
   <a href="#80598" class="date">24-Jan-2008 02:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Make a mental note, if it looks like your routine is crashing non-stop, double check to make sure you didn't spell the function like so...<br />
<br />
imagecreatefromjpg&nbsp; (should be jpeg)<br />
<br />
I spent an entire night overlooking this one small detail. I love how php won't crash out with an error saying the function doesn't exist, but then again, that could be my host.<br />
<br />
<a href="http://www.justuspics.com" rel="nofollow" target="_blank">http://www.justuspics.com</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76968""></a>
  <div class="note">
   <strong class="user">dmhouse at gmail dot com</strong>
   <a href="#76968" class="date">08-Aug-2007 12:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For a script that allows you to calculate the "fudge factor" discussed below by Karolis and Yaroukh, try the following. Grab a few images, preferably some large ones (the script should cope with images of up to 10 megapixels or so), some small ones, and some ones in between. Add their filenames to the $images array, then load the script in your browser.<br />
<br />
<span class="default">&lt;?php<br />
<br />
header</span><span class="keyword">(</span><span class="string">'Content-Type: text/plain'</span><span class="keyword">);<br />
<br />
</span><span class="default">ini_set</span><span class="keyword">(</span><span class="string">'memory_limit'</span><span class="keyword">, </span><span class="string">'50M'</span><span class="keyword">);<br />
<br />
function </span><span class="default">format_size</span><span class="keyword">(</span><span class="default">$size</span><span class="keyword">) {<br />
&nbsp; if (</span><span class="default">$size </span><span class="keyword">&lt; </span><span class="default">1024</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$size </span><span class="keyword">. </span><span class="string">' bytes'</span><span class="keyword">;<br />
&nbsp; }<br />
&nbsp; else {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$size </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">(</span><span class="default">$size </span><span class="keyword">/ </span><span class="default">1024</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$suffix </span><span class="keyword">= </span><span class="string">'KB'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$size </span><span class="keyword">&gt;= </span><span class="default">1024</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$size </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">(</span><span class="default">$size </span><span class="keyword">/ </span><span class="default">1024</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$suffix </span><span class="keyword">= </span><span class="string">'MB'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$size </span><span class="keyword">. </span><span class="string">' ' </span><span class="keyword">. </span><span class="default">$suffix</span><span class="keyword">;<br />
&nbsp; }<br />
}<br />
<br />
</span><span class="default">$start_mem </span><span class="keyword">= </span><span class="default">memory_get_usage</span><span class="keyword">();<br />
<br />
echo &lt;&lt;&lt;INTRO<br />
</span><span class="string">The memory required to load an image using imagecreatefromjpeg() is a function <br />
of the image's dimensions and the images's bit depth, multipled by an overhead.<br />
It can calculated from this formula: <br />
Num bytes = Width * Height * Bytes per pixel * Overhead fudge factor<br />
Where Bytes per pixel = Bit depth/8, or Bits per channel * Num channels / 8.<br />
This script calculates the Overhead fudge factor by loading images of <br />
various sizes.<br />
</span><span class="keyword">INTRO;<br />
<br />
echo </span><span class="string">"\n\n"</span><span class="keyword">;<br />
<br />
echo </span><span class="string">'Limit: ' </span><span class="keyword">. </span><span class="default">ini_get</span><span class="keyword">(</span><span class="string">'memory_limit'</span><span class="keyword">) . </span><span class="string">"\n"</span><span class="keyword">;<br />
echo </span><span class="string">'Usage before: ' </span><span class="keyword">. </span><span class="default">format_size</span><span class="keyword">(</span><span class="default">$start_mem</span><span class="keyword">) . </span><span class="string">"\n"</span><span class="keyword">;<br />
<br />
</span><span class="comment">// Place the images to load in the following array:<br />
</span><span class="default">$images </span><span class="keyword">= array(</span><span class="string">'image1.jpg'</span><span class="keyword">, </span><span class="string">'image2.jpg'</span><span class="keyword">, </span><span class="string">'image3.jpg'</span><span class="keyword">);<br />
</span><span class="default">$ffs </span><span class="keyword">= array();<br />
<br />
echo </span><span class="string">"\n"</span><span class="keyword">;<br />
<br />
foreach (</span><span class="default">$images </span><span class="keyword">as </span><span class="default">$image</span><span class="keyword">) {<br />
&nbsp; </span><span class="default">$info </span><span class="keyword">= </span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);<br />
&nbsp; </span><span class="default">printf</span><span class="keyword">(</span><span class="string">'Loading image %s, size %s * %s, bpp %s... '</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$image</span><span class="keyword">, </span><span class="default">$info</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="default">$info</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">], </span><span class="default">$info</span><span class="keyword">[</span><span class="string">'bits'</span><span class="keyword">]);<br />
&nbsp; </span><span class="default">$im </span><span class="keyword">= </span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$mem </span><span class="keyword">= </span><span class="default">memory_get_usage</span><span class="keyword">();<br />
&nbsp; echo </span><span class="string">'done' </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp; echo </span><span class="string">'Memory usage: ' </span><span class="keyword">. </span><span class="default">format_size</span><span class="keyword">(</span><span class="default">$mem</span><span class="keyword">) . </span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp; echo </span><span class="string">'Difference: ' </span><span class="keyword">. </span><span class="default">format_size</span><span class="keyword">(</span><span class="default">$mem </span><span class="keyword">- </span><span class="default">$start_mem</span><span class="keyword">) . </span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$ff </span><span class="keyword">= ((</span><span class="default">$mem </span><span class="keyword">- </span><span class="default">$start_mem</span><span class="keyword">) /<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; (</span><span class="default">$info</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] * </span><span class="default">$info</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] * (</span><span class="default">$info</span><span class="keyword">[</span><span class="string">'bits'</span><span class="keyword">] / </span><span class="default">8</span><span class="keyword">) * </span><span class="default">$info</span><span class="keyword">[</span><span class="string">'channels'</span><span class="keyword">]));<br />
&nbsp; </span><span class="default">$ffs</span><span class="keyword">[] = </span><span class="default">$ff</span><span class="keyword">;<br />
&nbsp; echo </span><span class="string">'Difference / (Width * Height * Bytes per pixel): ' </span><span class="keyword">. </span><span class="default">$ff </span><span class="keyword">. </span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$start_mem </span><span class="keyword">= </span><span class="default">memory_get_usage</span><span class="keyword">();<br />
&nbsp; echo </span><span class="string">'Destroyed. Memory usage: ' </span><span class="keyword">. </span><span class="default">format_size</span><span class="keyword">(</span><span class="default">$start_mem</span><span class="keyword">) . </span><span class="string">"\n"</span><span class="keyword">;<br />
<br />
&nbsp; echo </span><span class="string">"\n"</span><span class="keyword">;<br />
}<br />
<br />
echo </span><span class="string">'Mean fudge factor: ' </span><span class="keyword">. (</span><span class="default">array_sum</span><span class="keyword">(</span><span class="default">$ffs</span><span class="keyword">) / </span><span class="default">count</span><span class="keyword">(</span><span class="default">$ffs</span><span class="keyword">));<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75540""></a>
  <div class="note">
   <strong class="user">jhon at stockton dot com dot com</strong>
   <a href="#75540" class="date">04-Jun-2007 10:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
// a function for resize the images(png,jpg,gif) in a directory<br />
//for the png you must have the zlib actived<br />
<br />
//$diror origin directory<br />
//$dirdest destination directory<br />
//$val value of resize(1,2,3..)<br />
//$qual quality(80 if you don't know)<br />
<br />
function imgres($diror,$dirdest,$val,$qual){<br />
$q=$qual;<br />
//open the directory<br />
if (is_dir($diror)) {<br />
&nbsp;&nbsp; if ($dh = opendir($diror)) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; while (($file = readdir($dh)) !== false) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if($file == "." || $file == ".."){continue;}<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $k=explode(".",$file);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(strpos($k[1],"jpg")===0 || strpos($k[1],"jpeg")===0){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $salva=$dirdest.$file;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $image=$diror.$file;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $im =imagecreatefromjpeg("$image");<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $x=imagesx($im); <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $y=imagesy($im);&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $thumbnail=imagecreatetruecolor($x/$val,$y/$val);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $im_ridimensionata=imagecopyresized( $thumbnail, $im, 0, 0, 0, 0, $x/$val,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $y/$val, $x, $y);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; imagejpeg($thumbnail, $salva, $q);&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; elseif(strpos($k[1],"gif")===0){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $salva=$dirdest.$file;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $image=$diror.$file;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $im =imagecreatefromgif("$image");<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $x=imagesx($im); <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $y=imagesy($im);&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $thumbnail=imagecreatetruecolor($x/$val,$y/$val);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $im_ridimensionata=imagecopyresized( $thumbnail, $im, 0, 0, 0, 0, $x/$val,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $y/$val, $x, $y);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; imagegif($thumbnail, $salva, $q);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; elseif(strpos($k[1],"png")===0){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $salva=$dirdest.$file;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $image=$diror.$file;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $im =imagecreatefrompng("$image");<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $x=imagesx($im); <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $y=imagesy($im);&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $thumbnail=imagecreatetruecolor($x/$val,$y/$val);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $im_ridimensionata=imagecopyresized( $thumbnail, $im, 0, 0, 0, 0, $x/$val,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $y/$val, $x, $y);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; imagepng($thumbnail, $salva, $q);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo "File not compatible(no jpg,gif or png)";<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; closedir($dh);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75184""></a>
  <div class="note">
   <strong class="user">huguowen at cn dot ibm dot com</strong>
   <a href="#75184" class="date">17-May-2007 08:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Tips for Windows User to Set up GD(dynamic graphic lib) with PHP.<br />
<br />
Problem I meet:<br />
<br />
When i run following function, which terminates at&nbsp;&nbsp; <br />
<br />
$img = @imagecreatefromjpeg($image_path);<br />
<br />
error message is : undefined function imagecreatefromjpeg();<br />
<br />
no other code of the script gets executed. <br />
<br />
Solution:<br />
<br />
In one word, you need to turn on gd lib, <br />
which hold the implementation of imagecreatefromjpeg();<br />
<br />
please follow below steps:<br />
<br />
my php install dir is: c:/php/<br />
first you must try to find:<br />
c:/php/php.ini&nbsp; <br />
c:/php/ext/php_gd2.dll(php 5) <br />
c:/php/extension/php_gd2.dll(php 4)<br />
<br />
The php_gd2.dll is included in a standard PHP installation for Windows, <br />
however, it's not enabled by default. <br />
You have to turn it on, <br />
You may simply uncomment the line "extension=php_gd2.dll" in php.ini and restart the PHP extension. <br />
<br />
Change: <br />
,extension=php_gd2.dll<br />
<br />
To: <br />
extension=php_gd2.dll<br />
<br />
You may also have to correct the extension directory setting <br />
from: <br />
extension_dir = "./"<br />
extension_dir = "./extensions"<br />
To (FOR WINDOWS): <br />
extension_dir = "c:/php/extensions"(php 4)<br />
extension_dir = "c:/php/ext"(php 5)<br />
<br />
Cheers!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74891""></a>
  <div class="note">
   <strong class="user">sales at wholehogsoftware dot com</strong>
   <a href="#74891" class="date">02-May-2007 06:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I've found a bug in CentOS 4.x that, while previously addressed, does not seem to be directly addressed here as far as the nature of the bug is concerned.<br />
<br />
If you are having a problem getting this function to work on CentOS 4.4 (may appear earlier) and are receiving this error:<br />
<br />
Call to undefined function imagecreatefromjpeg()<br />
<br />
This is because the installation *does* support JPG by default if you have libjpeg installed. However, the config script finds libjpeg in /usr/lib but it is never successfully added to the PHP build.<br />
<br />
To fix this, you should recompile PHP and be absolutely sure to add '--with-jpeg-dir' to the config command. This should appear BEFORE the --with-gd option. Example:<br />
<br />
'--with-jpeg-dir' '--with-gd'<br />
<br />
If you don't put it before --with-gd, the option is completely ignored.<br />
<br />
As always, be sure to do a 'make clean' before a 'make install'. I made the mistake of forgetting to check and wasted 30 minutes trying to resolve this problem simply because I forgot to clean up after myself previously.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="70832""></a>
  <div class="note">
   <strong class="user">hvozda at ack dot org</strong>
   <a href="#70832" class="date">31-Oct-2006 12:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If imagecreatefromjpeg() fails with "PHP Fatal error:&nbsp; Call to undefined function:&nbsp; imagecreatefromjpeg()", it does NOT necessarily mean that you don't have GD installed.<br />
<br />
If phpinfo() shows GD, but not JPEG support, then that's the problem.&nbsp; You would think that --with-gd would do the right thing since it does check for the existance of libjpeg (and finds it) and add that feature to GD, but it doesn't in v4.4.4 at least on RHEL v2.1, RHEL v3, CentOS v2.1 or CentOS v4.3.<br />
<br />
On those platforms, it's *important* that --with-jpeg-dir be *before* --with-gd.&nbsp; If it's not, GD won't build with jpeg support as if --with-jpeg-dir had never been specified...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69272""></a>
  <div class="note">
   <strong class="user">info at daleconsulting dot com dot au</strong>
   <a href="#69272" class="date">29-Aug-2006 03:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In a post by Angel Leon, an example script was given that forms a thumbnail gallery using imagecreatefromjpeg.&nbsp; I am fairly new to php scripts, but I found that the script did not display the table of thumbnail images if the row wasn't "filled" with images.. i.e. if there were 5 images in the folder and the script specified 3 rows in the table, then the page would only display the thumbnails for the first row and only three images were shown.&nbsp; I found that if you specified the variable row with this equation, then the table would display properly:<br />
<br />
$row = intval(count($files)+($row_size-1));<br />
<br />
(This is the first line in the createThumbTable function.)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68035""></a>
  <div class="note">
   <strong class="user">kapishonas at yahoo dot com</strong>
   <a href="#68035" class="date">11-Jul-2006 01:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
script for nokia photos which end with FF D9 and still imagecreatefromjpeg() returns error.<br />
<br />
<span class="default">&lt;?php<br />
<br />
error_reporting</span><span class="keyword">( </span><span class="default">32 </span><span class="keyword">);<br />
</span><span class="default">header</span><span class="keyword">( </span><span class="string">'Content-Type: image/jpeg' </span><span class="keyword">);<br />
<br />
</span><span class="default">$imgPath </span><span class="keyword">= </span><span class="string">'att.jpg'</span><span class="keyword">;<br />
<br />
</span><span class="comment">// Atdod atpaka? GD_ImageResource<br />
</span><span class="keyword">function </span><span class="default">imageCreateFromJpegEx</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$im </span><span class="keyword">= @</span><span class="default">imagecreatefromstring</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; while (!</span><span class="default">$im</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">substr_replace</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">, </span><span class="string">""</span><span class="keyword">, -</span><span class="default">3</span><span class="keyword">, -</span><span class="default">2</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$im </span><span class="keyword">= @</span><span class="default">imagecreatefromstring</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$im</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">$im </span><span class="keyword">= </span><span class="default">imageCreateFromJpegEx</span><span class="keyword">(</span><span class="default">$imgPath</span><span class="keyword">);<br />
</span><span class="default">imagejpeg</span><span class="keyword">( </span><span class="default">$im </span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
script by Delfins in latvian php forums</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="67199""></a>
  <div class="note">
   
   <a href="#67199" class="date">05-Jun-2006 07:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
regarding e dot a dot schultz at gmail dot com post<br />
<br />
i tried the script (with the bugfixes posted later) and still got memorytrouble. most often it is still not enough memory to upload big images, even if it seems to calculate right. so this helped my perfectly:<br />
<br />
$newLimit = $newLimit+3000000; (before passing it to the ini_set() function).<br />
<br />
extremly simple and maybe not the best solution, but it works for now (you sure can give it less than an additional 3mb, just try what works for you).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="66499""></a>
  <div class="note">
   <strong class="user">ben dot lancaster at design-ontap dot co dot uk</strong>
   <a href="#66499" class="date">24-May-2006 02:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It is worth noting that all of the imagecreate* functions quite intentionally do not look in the include_path</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="65656""></a>
  <div class="note">
   <strong class="user">anatol at nugob dot org</strong>
   <a href="#65656" class="date">05-May-2006 07:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When working with uploaded jpeg files it is usually a good idea to execute a little but very useful program called jhead<br />
( <a href="http://www.sentex.net/~mwandel/jhead/ " rel="nofollow" target="_blank">http://www.sentex.net/~mwandel/jhead/ </a>).<br />
<br />
This will clean up unnecessary jpeg header information which can cause trouble. Some cameras or applications write binary data into the headers which may result in ugly results such as strange colors when you resample the image later on.<br />
<br />
Usage:<br />
<span class="default">&lt;?php<br />
exec</span><span class="keyword">(</span><span class="string">"/path/to/jhead -purejpg /path/to/image"</span><span class="keyword">);<br />
</span><span class="comment">// for example when you uploaded a file through a form, do this before you proceed:<br />
</span><span class="default">exec</span><span class="keyword">(</span><span class="string">"/path/to/jhead -purejpg "</span><span class="keyword">.</span><span class="default">$file</span><span class="keyword">[</span><span class="string">'tmp_name'</span><span class="keyword">]);<br />
</span><span class="default">?&gt;<br />
</span><br />
I didn't have the chance to test this but I guess this might even solve the problem caused by images that were taken with Canon PowerShot cameras which crash PHP.<br />
<br />
This is from the jhead documentation: "-purejpg: Delete all JPEG sections that aren't necessary for rendering the image. Strips any metadata that various applications may have left in the image."<br />
<br />
jhead got some other useful options as well...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="65161""></a>
  <div class="note">
   <strong class="user">webmaster at killer dot com dot ar</strong>
   <a href="#65161" class="date">25-Apr-2006 10:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The prior script by "e dot a dot schultz at gmail dot com", have a bug<br />
<br />
$memoryLimitMB don't have a value<br />
<br />
Add <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; $memoryLimitMB = 8;<br />
Before<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $memoryLimit = 8 * $MB;<br />
And change that line for:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $memoryLimit = $memoryLimitMB * $MB;<br />
<br />
--------------<br />
<br />
Something similar happens with the script by "JohnBrook at pobox dot com"<br />
<br />
$memoryLimit don't have a value<br />
<br />
Change:<br />
<br />
$memoryLimit = $memoryLimit * $MB;<br />
<br />
For:<br />
&nbsp; $memoryLimit = $memoryLimitMB * $MB;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="64155""></a>
  <div class="note">
   <strong class="user">e dot a dot schultz at gmail dot com</strong>
   <a href="#64155" class="date">09-Apr-2006 01:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In John's human readable code version of Karolis code to dynimicly allocate need memory there are a few bugs. If you didn't compile with the "--enable-memory-limit" option, this script will error with a level E_ERROR. Bellow is a fixed version rapped as a function. To view replacement functions for memory_get_usage() look at <a href="http://us2.php.net/manual/en/function.memory-get-usage.php" rel="nofollow" target="_blank">http://us2.php.net/manual/en/function.memory-get-usage.php</a><br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">setMemoryForImage</span><span class="keyword">( </span><span class="default">$filename </span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$imageInfo </span><span class="keyword">= </span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$MB </span><span class="keyword">= </span><span class="default">1048576</span><span class="keyword">;&nbsp; </span><span class="comment">// number of bytes in 1M<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$K64 </span><span class="keyword">= </span><span class="default">65536</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">// number of bytes in 64K<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$TWEAKFACTOR </span><span class="keyword">= </span><span class="default">1.5</span><span class="keyword">;&nbsp; </span><span class="comment">// Or whatever works for you<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$memoryNeeded </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">( ( </span><span class="default">$imageInfo</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] * </span><span class="default">$imageInfo</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; * </span><span class="default">$imageInfo</span><span class="keyword">[</span><span class="string">'bits'</span><span class="keyword">]<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; * </span><span class="default">$imageInfo</span><span class="keyword">[</span><span class="string">'channels'</span><span class="keyword">] / </span><span class="default">8<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">+ </span><span class="default">$K64<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">) * </span><span class="default">$TWEAKFACTOR<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//ini_get('memory_limit') only works if compiled with "--enable-memory-limit" also<br />
&nbsp;&nbsp;&nbsp; //Default memory limit is 8MB so well stick with that. <br />
&nbsp;&nbsp;&nbsp; //To find out what yours is, view your php.ini file.<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$memoryLimit </span><span class="keyword">= </span><span class="default">8 </span><span class="keyword">* </span><span class="default">$MB</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">'memory_get_usage'</span><span class="keyword">) &amp;&amp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">memory_get_usage</span><span class="keyword">() + </span><span class="default">$memoryNeeded </span><span class="keyword">&gt; </span><span class="default">$memoryLimit</span><span class="keyword">) <br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$newLimit </span><span class="keyword">= </span><span class="default">$memoryLimitMB </span><span class="keyword">+ </span><span class="default">ceil</span><span class="keyword">( ( </span><span class="default">memory_get_usage</span><span class="keyword">()<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; + </span><span class="default">$memoryNeeded<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">- </span><span class="default">$memoryLimit<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">) / </span><span class="default">$MB<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ini_set</span><span class="keyword">( </span><span class="string">'memory_limit'</span><span class="keyword">, </span><span class="default">$newLimit </span><span class="keyword">. </span><span class="string">'M' </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }else<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="63116""></a>
  <div class="note">
   <strong class="user">Christoph Ziegenberg</strong>
   <a href="#63116" class="date">13-Mar-2006 10:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Matt reported that PHP crashs using imagecreatefromjpeg() - that's true and it took me a lot of time to find the error - but not only the Canon PowerShot S70, also the Canon PowerShot&nbsp; A400 lets PHP (5.1.2) crash, without any chance to catch it!<br />
<br />
So I exclude all Canon PowerShot images with the following check:<br />
<br />
&nbsp;&nbsp;&nbsp; function check_canonpowershot($filename) <br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (strpos(file_get_contents($filename), 'Canon PowerShot') !== false) <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return true;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return false;<br />
&nbsp;&nbsp;&nbsp; }</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="61709""></a>
  <div class="note">
   <strong class="user">JohnBrook at pobox dot com</strong>
   <a href="#61709" class="date">10-Feb-2006 04:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Also, here is the same formula presented in a somewhat more human-readable way, if you'd rather:<br />
<br />
<span class="default">&lt;?php<br />
$MB </span><span class="keyword">= </span><span class="default">Pow</span><span class="keyword">(</span><span class="default">1024</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">);&nbsp;&nbsp; </span><span class="comment">// number of bytes in 1M<br />
</span><span class="default">$K64 </span><span class="keyword">= </span><span class="default">Pow</span><span class="keyword">(</span><span class="default">2</span><span class="keyword">,</span><span class="default">16</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">// number of bytes in 64K<br />
</span><span class="default">$TWEAKFACTOR </span><span class="keyword">= </span><span class="default">1.8</span><span class="keyword">;&nbsp;&nbsp; </span><span class="comment">// Or whatever works for you<br />
</span><span class="default">$memoryNeeded </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">( ( </span><span class="default">$imageInfo</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] * </span><span class="default">$imageInfo</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * </span><span class="default">$imageInfo</span><span class="keyword">[</span><span class="string">'bits'</span><span class="keyword">]<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * </span><span class="default">$imageInfo</span><span class="keyword">[</span><span class="string">'channels'</span><span class="keyword">] / </span><span class="default">8<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">+ </span><span class="default">$K64<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">) * </span><span class="default">$TWEAKFACTOR<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">);<br />
</span><span class="default">$memoryHave </span><span class="keyword">= </span><span class="default">memory_get_usage</span><span class="keyword">();<br />
</span><span class="default">$memoryLimitMB </span><span class="keyword">= (integer) </span><span class="default">ini_get</span><span class="keyword">(</span><span class="string">'memory_limit'</span><span class="keyword">);<br />
</span><span class="default">$memoryLimit </span><span class="keyword">= </span><span class="default">$memoryLimit </span><span class="keyword">* </span><span class="default">$MB</span><span class="keyword">;<br />
<br />
if ( </span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">'memory_get_usage'</span><span class="keyword">) <br />
&nbsp;&nbsp; &nbsp; &amp;&amp; </span><span class="default">$memoryHave </span><span class="keyword">+ </span><span class="default">$memoryNeeded </span><span class="keyword">&gt; </span><span class="default">$memoryLimit <br />
&nbsp;&nbsp; </span><span class="keyword">) {<br />
&nbsp;&nbsp; </span><span class="default">$newLimit </span><span class="keyword">= </span><span class="default">$memoryLimitMB </span><span class="keyword">+ </span><span class="default">ceil</span><span class="keyword">( ( </span><span class="default">$memoryHave <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">+ </span><span class="default">$memoryNeeded <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">- </span><span class="default">$memoryLimit <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">) / </span><span class="default">$MB <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">ini_set</span><span class="keyword">( </span><span class="string">'memory_limit'</span><span class="keyword">, </span><span class="default">$newLimit </span><span class="keyword">. </span><span class="string">'M' </span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="61708""></a>
  <div class="note">
   <strong class="user">JohnBrook at pobox dot com</strong>
   <a href="#61708" class="date">10-Feb-2006 03:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Additional note on allocating memory: The 1.65 in the formula provided below by yaroukh and Karolis is evidently a "fudge factor" arrived at through experimentation. I found that I had to nudge it up a little bit in order to accurately predict the memory that would be needed, otherwise the allocation still failed. In my case, I went right to 1.8 and that has worked so far. Your mileage may vary, so experiment as needed.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="61680""></a>
  <div class="note">
   <strong class="user">yaroukh at gmail dot com</strong>
   <a href="#61680" class="date">09-Feb-2006 01:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hello Karolis<br />
<br />
My solution was intended to solve situations when your webhoster puts a limit on the memory usage; in such a situations ini_set doesn't work ofcourse (even for variables that have 'PHP_INI_ALL' flag in a typical PHP-installation).<br />
<br />
Have a nice day<br />
&nbsp; Yaroukh</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="60241""></a>
  <div class="note">
   <strong class="user">Karolis Tamutis karolis.t_AT_gmail.com</strong>
   <a href="#60241" class="date">31-Dec-2005 02:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In addition to yaroukh at gmail dot com comment.<br />
<br />
It seems that even a small image can eat up your default memory limit real quick. Config value 'memory_limit' is marked PHP_INI_ALL, so you can change it dynamically using ini_set. Therefore, we can "allocate memory dynamically", to prevent those memory limit exceeded errors. <br />
<br />
<span class="default">&lt;?php<br />
<br />
$imageInfo </span><span class="keyword">= </span><span class="default">getimagesize</span><span class="keyword">(</span><span class="string">'PATH/TO/YOUR/IMAGE'</span><span class="keyword">);<br />
</span><span class="default">$memoryNeeded </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">((</span><span class="default">$imageInfo</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] * </span><span class="default">$imageInfo</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] * </span><span class="default">$imageInfo</span><span class="keyword">[</span><span class="string">'bits'</span><span class="keyword">] * </span><span class="default">$imageInfo</span><span class="keyword">[</span><span class="string">'channels'</span><span class="keyword">] / </span><span class="default">8 </span><span class="keyword">+ </span><span class="default">Pow</span><span class="keyword">(</span><span class="default">2</span><span class="keyword">, </span><span class="default">16</span><span class="keyword">)) * </span><span class="default">1.65</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
if (</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">'memory_get_usage'</span><span class="keyword">) &amp;&amp; </span><span class="default">memory_get_usage</span><span class="keyword">() + </span><span class="default">$memoryNeeded </span><span class="keyword">&gt; (integer) </span><span class="default">ini_get</span><span class="keyword">(</span><span class="string">'memory_limit'</span><span class="keyword">) * </span><span class="default">pow</span><span class="keyword">(</span><span class="default">1024</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">ini_set</span><span class="keyword">(</span><span class="string">'memory_limit'</span><span class="keyword">, (integer) </span><span class="default">ini_get</span><span class="keyword">(</span><span class="string">'memory_limit'</span><span class="keyword">) + </span><span class="default">ceil</span><span class="keyword">(((</span><span class="default">memory_get_usage</span><span class="keyword">() + </span><span class="default">$memoryNeeded</span><span class="keyword">) - (integer) </span><span class="default">ini_get</span><span class="keyword">(</span><span class="string">'memory_limit'</span><span class="keyword">) * </span><span class="default">pow</span><span class="keyword">(</span><span class="default">1024</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">)) / </span><span class="default">pow</span><span class="keyword">(</span><span class="default">1024</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">)) . </span><span class="string">'M'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="56032""></a>
  <div class="note">
   <strong class="user">yaroukh at gmail dot com</strong>
   <a href="#56032" class="date">21-Aug-2005 01:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Estimated memory needed for ImageCreateFromJPEG<br />
<br />
First I supposed simple width*height*bpp will be enough, it isn't though; there is some pretty big overhead.<br />
<br />
$imageInfo = GetImageSize($imageFilename);<br />
$memoryNeeded = Round(($imageInfo[0] * $imageInfo[1] * $imageInfo['bits'] * $imageInfo['channels'] / 8 + Pow(2, 16)) * 1.65);<br />
<br />
With memory_limit enabled running out of memory causes script to crash; above written will tel you how much memory you're gonna need for creating an image-resource out of image-file. So in conjunction with Memory_Get_Usage() and Get_CFG_Var('memory_limit') you can avoid the mentioned ending. (Yet there won't be too many images blocked from processing that would still fit in the memory, as the results of this are pretty accurate.)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="55402""></a>
  <div class="note">
   <strong class="user">rich at launchcode dot co dot uk</strong>
   <a href="#55402" class="date">02-Aug-2005 03:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you get this error: "Warning: imagecreatefromjpeg(): gd-jpeg: JPEG library reports unrecoverable error" then check the JPEG files. If they are saved in CMYK format (instead of RGB) then GD will fail to load them (tested with GD 2.0.12)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="55391""></a>
  <div class="note">
   <strong class="user">elyoukey at hotmail dot com</strong>
   <a href="#55391" class="date">02-Aug-2005 09:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
here is a code, inspired by the button of<br />
tl at comvironment dot com<br />
<br />
but here, you can make as many buttons as you need by cutting the image in as many parts as defined in the table<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">Button_Array</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$tab_button </span><span class="keyword">= array();</span><span class="comment">// the text of each button you want to create<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">var </span><span class="default">$im</span><span class="keyword">;</span><span class="comment">//the image file<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">Button_Array</span><span class="keyword">(</span><span class="default">$fileName</span><span class="keyword">, </span><span class="default">$tab_string</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this </span><span class="keyword">-&gt; </span><span class="default">tab_button </span><span class="keyword">= </span><span class="default">$tab_string</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this </span><span class="keyword">-&gt; </span><span class="default">im </span><span class="keyword">= </span><span class="default">$fileName</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//parameters<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$font&nbsp; </span><span class="keyword">= </span><span class="default">10</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//cut the full image in X parts<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; //X = the number of buttons you want<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$imgFull</span><span class="keyword">=</span><span class="default">ImageCreateFromJPEG</span><span class="keyword">(</span><span class="default">$this </span><span class="keyword">-&gt; </span><span class="default">im</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; list(</span><span class="default">$width</span><span class="keyword">, </span><span class="default">$heightFull</span><span class="keyword">, </span><span class="default">$type</span><span class="keyword">, </span><span class="default">$attr</span><span class="keyword">) = </span><span class="default">getimagesize</span><span class="keyword">(</span><span class="default">$this </span><span class="keyword">-&gt; </span><span class="default">im</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$height </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">(</span><span class="default">$heightFull</span><span class="keyword">/</span><span class="default">sizeof</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">tab_button</span><span class="keyword">),</span><span class="default">0</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">sizeof</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">tab_button</span><span class="keyword">);</span><span class="default">$i</span><span class="keyword">++ ) {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pos</span><span class="keyword">=</span><span class="default">$i</span><span class="keyword">*</span><span class="default">$height</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$imgParts</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]=</span><span class="default">ImageCreateTrueColor</span><span class="keyword">(</span><span class="default">$width</span><span class="keyword">,</span><span class="default">$height</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">imagecopy</span><span class="keyword">(</span><span class="default">$imgParts</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">],</span><span class="default">$imgFull</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$pos</span><span class="keyword">,</span><span class="default">$width</span><span class="keyword">,</span><span class="default">$height</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//manips<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$textColor </span><span class="keyword">= </span><span class="default">imagecolorallocate </span><span class="keyword">(</span><span class="default">$imgParts</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">],</span><span class="default">0</span><span class="keyword">,</span><span class="default">20</span><span class="keyword">,</span><span class="default">90</span><span class="keyword">);&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ImageString </span><span class="keyword">(</span><span class="default">$imgParts</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">],</span><span class="default">$font</span><span class="keyword">,</span><span class="default">200</span><span class="keyword">,</span><span class="default">10</span><span class="keyword">,</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">tab_button</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">],</span><span class="default">$textColor</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//cr?ation du fichier<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ImageJPEG</span><span class="keyword">(</span><span class="default">$imgParts</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] , </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">tab_button</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">].</span><span class="string">'.jpg'</span><span class="keyword">,</span><span class="default">85</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">$tab</span><span class="keyword">[]=</span><span class="string">"topic1"</span><span class="keyword">;<br />
</span><span class="default">$tab</span><span class="keyword">[]=</span><span class="string">"topic2"</span><span class="keyword">;<br />
</span><span class="default">$tab</span><span class="keyword">[]=</span><span class="string">"topic3"</span><span class="keyword">;<br />
</span><span class="default">$tab</span><span class="keyword">[]=</span><span class="string">"topic4"</span><span class="keyword">;<br />
</span><span class="default">$tab</span><span class="keyword">[]=</span><span class="string">"more topics"</span><span class="keyword">;<br />
<br />
</span><span class="default">$tabButton</span><span class="keyword">=new </span><span class="default">Button_Array</span><span class="keyword">(</span><span class="string">"a.jpg"</span><span class="keyword">,</span><span class="default">$tab</span><span class="keyword">);<br />
<br />
echo </span><span class="string">"&lt;table border=0 cellspacing=0 cellpadding=0&gt;"</span><span class="keyword">;<br />
foreach (</span><span class="default">$tab </span><span class="keyword">as </span><span class="default">$source</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"&lt;tr&gt;&lt;td&gt;&lt;img src='</span><span class="default">$source</span><span class="string">.jpg'&gt;&lt;/td&gt;&lt;/tr&gt;"</span><span class="keyword">;<br />
}<br />
echo </span><span class="string">"&lt;/table&gt;"</span><span class="keyword">;<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="55340""></a>
  <div class="note">
   <strong class="user">miczimbett at gmail dot com</strong>
   <a href="#55340" class="date">31-Jul-2005 02:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
the check_jpeg function listed above has a small "bug" when u set $fix=true... after the fix, the function does not close the file... and the imagecreatefromjpeg would still crash on an open file.<br />
<br />
&nbsp;&nbsp;&nbsp; //# [070203]<br />
&nbsp;&nbsp;&nbsp; //# check for jpeg file header and footer - also try to fix it<br />
&nbsp;&nbsp;&nbsp; function check_jpeg($f, $fix=false ){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( false !== (@$fd = fopen($f, 'r+b' )) ){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (fread($fd,2)==chr(255).chr(216) ){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; fseek ( $fd, -2, SEEK_END );<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ( fread($fd,2)==chr(255).chr(217) ){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; fclose($fd);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return true;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }else{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($fix &amp;&amp; fwrite($fd,chr(255).chr(217)) ){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; fclose($fd);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return true;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; fclose($fd);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return false;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; fclose($fd);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return false;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return false;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="53345""></a>
  <div class="note">
   <strong class="user">linus at flowingcreativity dot net</strong>
   <a href="#53345" class="date">29-May-2005 06:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I am using PHP 4.3.8 and GD 2.0.23-compatible, and this function does not return an empty string on failure as stated. This line:<br />
<br />
<span class="default">&lt;?php<br />
var_dump</span><span class="keyword">(</span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="string">'bogus filename'</span><span class="keyword">));<br />
</span><span class="default">?&gt;<br />
</span><br />
outputs:<br />
<br />
bool(false)<br />
<br />
Of course this doesn't matter unless you're using a strict comparison operator to evaluate the result, but I thought I'd point it out.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="51903""></a>
  <div class="note">
   <strong class="user">Zap</strong>
   <a href="#51903" class="date">14-Apr-2005 04:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Under some configurations imagecreatefromjpeg will create files that are owned by the webserver rather than the php user. For example, php may be run as phpuser and the image will be created under apache.<br />
<br />
This can lead to permissions problems - only a +0777 will be enough to be able to create a picture. <br />
<br />
My solution was to chmod over ftp to 0777 just before the picture is written then change back to 0755 when the image has been created.<br />
<br />
The alternative of course would be to have a properly configured system...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="51466""></a>
  <div class="note">
   <strong class="user">Angel Leon</strong>
   <a href="#51466" class="date">31-Mar-2005 03:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is a very useful script when you have hundreds of images and you need a quick setup for a thumbnail, where you can select how many<br />
pictures per row, size of the thumbnail, and the size of the pictures when clicked, all in one script. Just throw all your images and this script in a file named index.php or index.html (if your apache httpd.conf defaults to html and runs .html as php).<br />
<br />
Script also contains simple text watermarking. See function thumbImage()<br />
and modify to add image watermarking if you like.<br />
<br />
&lt;?<br />
// 30 Minutes Thumbnail script written by Angel Leon from wedoit4you.com<br />
// Licensed under the GPL<br />
// Courtesy of wedoit4you.com<br />
<br />
//Instructions:<br />
//copy this script wherever you have a bunch of .jpgs<br />
// Invoke your thumbnail like this <a href="http://mysite.com/imageFolder/index.php" rel="nofollow" target="_blank">http://mysite.com/imageFolder/index.php</a><br />
//where index.php is this script.<br />
<br />
//Modify and redistribute but don't remove our trademark.<br />
&nbsp;<br />
//configure script here<br />
<br />
//pictures per row<br />
$row_size = 3;<br />
<br />
//height of the pictures in thumbnail<br />
$thumb_height = 200;<br />
<br />
//height of the pictures when clicked (to save bandwidth)<br />
$big_image_height=668;<br />
<br />
//short name of your site<br />
$waterMark = "mysite.com";<br />
<br />
$dh = opendir(".");<br />
$files = array();<br />
while (($file = readdir($dh)) !== false) {<br />
&nbsp; if (ereg("jpg",$file) || ereg("gif",$file) || ereg("png",$file)) {<br />
&nbsp; $files[] = $file;<br />
&nbsp; }<br />
}<br />
closedir($dh);<br />
<br />
if ($show_image) {<br />
&nbsp; thumbImage($show_image,$big_image_height,$waterMark);<br />
} else if ($thumb_image) {<br />
&nbsp; thumbImage($thumb_image,$thumb_height,$waterMark);<br />
}<br />
else {<br />
&nbsp; echo "&lt;center&gt;" . createThumbTable($files,$row_size) . "&lt;/center&gt;";<br />
}<br />
<br />
function createThumbTable($files,$pics_wide) {<br />
&nbsp; $row = intval(count($files)/$pics_wide);<br />
&nbsp; $picIndex = 0;<br />
<br />
&nbsp; $rs = "Mostrando " . count($files) . " imagenes&lt;br&gt;";<br />
&nbsp; $rs .= "&lt;table border=0 cellspacing=1 cellpadding=0 style='border:1px solid black'&gt;\n";<br />
&nbsp; for ($i=0; $i &lt;$row; $i++) {<br />
&nbsp;&nbsp;&nbsp; $rs .= "\t&lt;tr&gt;\n";<br />
&nbsp;&nbsp;&nbsp; for ($picIndex,$j=0; <br />
&nbsp;&nbsp; &nbsp; $j &lt; $pics_wide &amp;&amp; $picIndex &lt; count($files); <br />
&nbsp;&nbsp; &nbsp; $j++,$picIndex++) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; $rs .= "\t\t&lt;td&gt;&lt;a href=index.php?show_image=" .<br />
&nbsp;&nbsp;&nbsp; $files[$picIndex] . "&gt;" . <br />
&nbsp;&nbsp;&nbsp; "&lt;img src=index.php?thumb_image=" . <br />
&nbsp;&nbsp; &nbsp;&nbsp; $files[$picIndex] . " border=0 title='Copyright wedoit4you.com'&gt;&lt;/a&gt;&lt;/td&gt;\n";<br />
&nbsp;&nbsp; &nbsp;&nbsp; //$rs .= "&lt;td&gt;i=$i / $j=$picIndex&lt;/td&gt;";<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; $rs .= "\t&lt;/tr&gt;\n";<br />
&nbsp; }//for<br />
&nbsp; $rs .= "&lt;tr&gt;&lt;td colspan=$pics_wide align=center&gt;Free Thumbnail script by &lt;a href=<a href="http://www.wedoit4you.com&gt;wedoit4you.com&lt;/a&gt;&lt;br&gt;Written by Angel Leon (March 2005" rel="nofollow" target="_blank">http://www.wedoit4you.com&gt;wedoit4you.com&lt;/a&gt;&lt;br&gt;Written by Angel Leon (March 2005</a>)&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;\n";<br />
<br />
&nbsp; return $rs;<br />
} //createThumbTable<br />
<br />
function thumbImage($file,$img_height,$waterMark) {<br />
<br />
&nbsp; $img_temp = imagecreatefromjpeg($file);<br />
<br />
&nbsp; $black = @imagecolorallocate ($img_temp, 0, 0, 0);<br />
&nbsp; $white = @imagecolorallocate ($img_temp, 255, 255, 255);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp; $font = 2;<br />
<br />
&nbsp; $img_width=imagesx($img_temp)/imagesy($img_temp)*$img_height;<br />
&nbsp; $img_thumb=imagecreatetruecolor($img_width,$img_height);<br />
<br />
&nbsp; imagecopyresampled($img_thumb, <br />
&nbsp; $img_temp,0,0,0,0,$img_width, <br />
&nbsp; $img_height, <br />
&nbsp; imagesx ($img_temp), <br />
&nbsp; imagesy($img_temp));<br />
<br />
&nbsp; $originx = imagesx($img_thumb) - 100;<br />
&nbsp; $originy = imagesy($img_thumb) - 15;<br />
<br />
&nbsp; @imagestring ($img_thumb, $font, $originx + 10, $originy, <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $waterMark, $black);<br />
&nbsp; @imagestring ($img_thumb, $font, $originx + 11, $originy - 1, <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $waterMark, $white);<br />
<br />
&nbsp; header ("Content-type: image/jpeg");<br />
&nbsp; imagejpeg($img_thumb, "", 60);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp; imagedestroy ($img_thumb); <br />
}<br />
<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="50545""></a>
  <div class="note">
   <strong class="user">dmf four one fiive at yahoo dot com</strong>
   <a href="#50545" class="date">03-Mar-2005 01:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Another thing to note, is the file not might actually be a jpeg , even though the filename ends in .jpg. If this is the case the command won't work. You will need imagecreatefromgif() <br />
<br />
The easiest way to check is to use your favorite editor like vi.<br />
<br />
On Line one it will tell you if its a gif or a jpg..<br />
<br />
I took a quick look at a few image files. the gifs say GIF87a and the real jpegs should say JFIF or something like that.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="50330""></a>
  <div class="note">
   <strong class="user">ceefour -at!- gauldong.net</strong>
   <a href="#50330" class="date">24-Feb-2005 11:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I have to say recompiling PHP from the sources and enabling JPEG support in gd took me awhile to figure out.<br />
<br />
Somewhere especially configure --help should have stated that --with-jpeg-dir is MANDATORY if you want to have JPEG support. And even if you did so, it doesn't mean you'll get it. If it's wrongly configured, no error is going to be output, all you get is "no JPEG support". What's more confusing is when JPEG support is disabled phpinfo won't say "JPEG Support: disabled", but just omit the entry so you won't even realize something is wrong.<br />
<br />
If you recompile PHP or gd, make sure:<br />
- rm -f config.cache FIRST<br />
- make clean (this helps A LOT), actually you can just delete modules/gd.*, and every *.o in ext/gd. this part actually gave me the best headache<br />
- ./configure --with-jpeg-dir=/usr/lib OR any other directory which contains the BINARY library of libjpeg<br />
- make, make install<br />
<br />
phpinfo should now display jpeg support... good luck.<br />
(you lucky guys who already have PHP 5 installed on your server... you don't have to go through all the mess I had)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="50328""></a>
  <div class="note">
   <strong class="user">tl at comvironment dot com</strong>
   <a href="#50328" class="date">24-Feb-2005 10:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I made a script to produce, save, and use dynamic buttons simultaneously. If the file exists, it will be shown as usual. If not, this script produces a new image and saves it. You only need the background (back.jpg). Maybe it is useful for somone.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">class </span><span class="default">Button </span><span class="keyword">{<br />
<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$ib </span><span class="keyword">= </span><span class="string">'back.jpg'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$im</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">Button </span><span class="keyword">(</span><span class="default">$fileName</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this </span><span class="keyword">-&gt; </span><span class="default">im </span><span class="keyword">= </span><span class="default">$fileName</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(!</span><span class="default">file_exists</span><span class="keyword">(</span><span class="default">$this </span><span class="keyword">-&gt; </span><span class="default">im</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this </span><span class="keyword">-&gt; </span><span class="default">_createButton</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">getFileName</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$this </span><span class="keyword">-&gt; </span><span class="default">im</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">_createButton</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$font&nbsp; </span><span class="keyword">= </span><span class="default">4</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$width&nbsp; </span><span class="keyword">= </span><span class="default">max</span><span class="keyword">(</span><span class="default">400</span><span class="keyword">,(</span><span class="default">ImageFontWidth</span><span class="keyword">(</span><span class="default">$font</span><span class="keyword">) * </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">)) + </span><span class="default">4</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$height </span><span class="keyword">= </span><span class="default">max</span><span class="keyword">(</span><span class="default">20</span><span class="keyword">,(</span><span class="default">ImageFontHeight</span><span class="keyword">(</span><span class="default">$font</span><span class="keyword">) + </span><span class="default">4</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$imgBack</span><span class="keyword">=</span><span class="default">ImageCreateFromJPEG</span><span class="keyword">(</span><span class="default">$this </span><span class="keyword">-&gt; </span><span class="default">ib</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$imgText</span><span class="keyword">=</span><span class="default">ImageCreateTrueColor</span><span class="keyword">(</span><span class="default">$width</span><span class="keyword">,</span><span class="default">$height</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$textColor </span><span class="keyword">= </span><span class="default">imagecolorallocate </span><span class="keyword">(</span><span class="default">$imgText</span><span class="keyword">,</span><span class="default">90</span><span class="keyword">,</span><span class="default">90</span><span class="keyword">,</span><span class="default">90</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ImageCopy</span><span class="keyword">(</span><span class="default">$imgText</span><span class="keyword">,</span><span class="default">$imgBack</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$width</span><span class="keyword">,</span><span class="default">$height</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ImageString </span><span class="keyword">(</span><span class="default">$imgText</span><span class="keyword">,</span><span class="default">$font</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">,</span><span class="default">$string</span><span class="keyword">,</span><span class="default">$textColor</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ImageJPEG</span><span class="keyword">(</span><span class="default">$imgText</span><span class="keyword">,</span><span class="default">$this </span><span class="keyword">-&gt; </span><span class="default">im</span><span class="keyword">,</span><span class="default">85</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ImageDestroy</span><span class="keyword">(</span><span class="default">$imgBack</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">ImageDestroy</span><span class="keyword">(</span><span class="default">$imgText</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">chmod </span><span class="keyword">(</span><span class="default">$this </span><span class="keyword">-&gt; </span><span class="default">im</span><span class="keyword">,</span><span class="default">0644</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
}<br />
<br />
</span><span class="default">$button </span><span class="keyword">= new </span><span class="default">Button</span><span class="keyword">(</span><span class="string">'button.jpg'</span><span class="keyword">,</span><span class="string">'button text'</span><span class="keyword">);<br />
echo </span><span class="string">'&lt;img src="' </span><span class="keyword">. </span><span class="default">$button </span><span class="keyword">-&gt; </span><span class="default">getFileName</span><span class="keyword">() . </span><span class="string">'"&gt;'</span><span class="keyword">;<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="47064""></a>
  <div class="note">
   <strong class="user">cs at kainaw dot com</strong>
   <a href="#47064" class="date">01-Nov-2004 08:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The ImageCreateFromJPEG() function is capable of throwing an emalloc() error.&nbsp; If this happens, the script will die, but the error will be in your error logs.&nbsp; You should ensure that you have memory available before creating a large image from a jpeg file.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="46833""></a>
  <div class="note">
   <strong class="user">webmaster at kautto dot se</strong>
   <a href="#46833" class="date">25-Oct-2004 12:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Concerning the path discussion. A relative path works just fine, if it is used properly. The thing is just to keep track of where in the file system you actually are calling the function from. <br />
<br />
E.g. including file A into file B, and then executing file A. Now calls made in file B will act as if they actually are made file A, due to the inclusion. So a well designed filesystem is very important. Also moving a file might lead to this type of path related problems. <br />
<br />
Hope this made any sence! :)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="46760""></a>
  <div class="note">
   <strong class="user">Jezu</strong>
   <a href="#46760" class="date">22-Oct-2004 12:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I have noticed that Nokia's old camera-phones create non-standard JPEG's.<br />
<br />
Nokias' JPEG doesn't end with 0xFFD9. Add 0xFFD9 end of file and image works fine with imagecreatefromjpeg(). Willertan1980 already sent code to do that.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="44132""></a>
  <div class="note">
   <strong class="user">dmjoe</strong>
   <a href="#44132" class="date">16-Jul-2004 01:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This function DOES accept paths in the filename, just make sure they're absolute paths.&nbsp; A relative path won't work, at least it didn't for me. This is in response to jonlup's comment from june 25:<br />
<br />
"I played with "imagecreatefromjpeg()" function and, after a few tests, I found that the filename that it requires as parameter should be only a simple filename: the function does not work if in the string of the filename is specified a path to that file."</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="43668""></a>
  <div class="note">
   
   <a href="#43668" class="date">30-Jun-2004 01:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
here is my clear method to resize images<br />
you can check how it works on <a href="http://www.jetevents.pl" rel="nofollow" target="_blank">http://www.jetevents.pl</a><br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp; $maxx</span><span class="keyword">=</span><span class="default">100</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">// maximum width<br />
&nbsp;&nbsp; </span><span class="default">$maxy</span><span class="keyword">=</span><span class="default">75</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">// maximum height<br />
<br />
&nbsp;&nbsp; </span><span class="default">$name</span><span class="keyword">=</span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'file'</span><span class="keyword">][</span><span class="string">'name'</span><span class="keyword">],</span><span class="default">0</span><span class="keyword">,-</span><span class="default">4</span><span class="keyword">)).</span><span class="string">".jpg"</span><span class="keyword">;&nbsp; </span><span class="comment">// name of file - must be jpg<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$size </span><span class="keyword">= </span><span class="default">GetImageSize </span><span class="keyword">(</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'file'</span><span class="keyword">][</span><span class="string">'tmp_name'</span><span class="keyword">]);&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// params of image<br />
<br />
&nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$size</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]&gt;</span><span class="default">$size</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]) {</span><span class="default">$sizemin</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]=</span><span class="default">$maxx</span><span class="keyword">;</span><span class="default">$sizemin</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]=</span><span class="default">$maxy</span><span class="keyword">;};<br />
&nbsp;&nbsp; if (</span><span class="default">$size</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]&gt;</span><span class="default">$size</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]) {</span><span class="default">$sizemin</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]=</span><span class="default">$maxy</span><span class="keyword">;</span><span class="default">$sizemin</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]=</span><span class="default">$maxx</span><span class="keyword">;};<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp; </span><span class="default">$im</span><span class="keyword">=@</span><span class="default">imagecreatefromjpeg</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">);&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// path to your gallery<br />
&nbsp;&nbsp; </span><span class="default">$small </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$sizemin</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="default">$sizemin</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);&nbsp; &nbsp; </span><span class="comment">// new image<br />
&nbsp;&nbsp; </span><span class="default">ImageCopyResampled</span><span class="keyword">(</span><span class="default">$small</span><span class="keyword">, </span><span class="default">$im</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$sizemin</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="default">$sizemin</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">], </span><span class="default">$size</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="default">$size</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br />
&nbsp;&nbsp; </span><span class="comment">// below is main function resampling image<br />
<br />
&nbsp;&nbsp; </span><span class="default">ImageDestroy</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">);&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// free memory<br />
<br />
&nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">ImageJPEG</span><span class="keyword">(</span><span class="default">$small</span><span class="keyword">,</span><span class="default">$path</span><span class="keyword">,</span><span class="default">100</span><span class="keyword">))&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// try to save image<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="keyword">{<br />
&nbsp;&nbsp; &nbsp; &nbsp; echo </span><span class="string">"File </span><span class="default">$path</span><span class="string"> has been written&lt;br&gt;\n"</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// success<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="keyword">echo </span><span class="string">"size: "</span><span class="keyword">.</span><span class="default">$sizemin</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">].</span><span class="string">"x"</span><span class="keyword">.</span><span class="default">$sizemin</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] .</span><span class="string">"&lt;br&gt;\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; echo </span><span class="string">"&lt;font color=red&gt;&lt;b&gt;"</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// failed to write file<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="keyword">echo </span><span class="string">"Error ! File has not been written."</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; echo </span><span class="string">"&lt;/b&gt;&lt;/font&gt;&lt;br&gt;\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; };<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="43571""></a>
  <div class="note">
   <strong class="user">jonlup at yahoo dot com</strong>
   <a href="#43571" class="date">26-Jun-2004 04:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I played with "imagecreatefromjpeg()" function and, after a few tests, I found that the filename that it requires as parameter should be only a simple filename: the function does not work if in the string of the filename is specified a path to that file.<br />
The quickest workaround found: do a chdir() to the directory of your image file before try to use "imagecreatefromjpeg()" with your file as parameter.<br />
I did not test the other functions (imagecreatefromgd2(), imagecreatefromgd(), imagecreatefromgif() etc.), but I suppose that they work in the same way.<br />
I think that little trick should be specified in the manual.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="42655""></a>
  <div class="note">
   <strong class="user">Javier Rayon</strong>
   <a href="#42655" class="date">25-May-2004 08:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Using imagecreate() combined with imagecreatefromjpeg() in PHP 4.3.0 and up creates wrong color jpeg's.<br />
<br />
Use imagecreatetruecolor() instead of imagecreate() for right color images.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="41370""></a>
  <div class="note">
   <strong class="user">Sne</strong>
   <a href="#41370" class="date">08-Apr-2004 03:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
small script that calculates square (in %) of eche color on the PNG image.<br />
<br />
&lt;?<br />
$t1=time();<br />
$im1=ImageCreatefrompng('1.png'); //name of the png file<br />
echo "&lt;img src=1.png&gt;";<br />
$widthIm=ImageSX($im1);<br />
$heightIm=ImageSY($im1);<br />
$total=$widthIm*$heightIm;<br />
$cvcol=imagecolorstotal($im1);<br />
&nbsp;&nbsp;&nbsp; for ($i=0; $i&lt;$widthIm; $i++){<br />
&nbsp;&nbsp;&nbsp; for ($j=0; $j&lt;$heightIm; $j++){<br />
&nbsp;&nbsp;&nbsp; $tochka=imagecolorat($im1,$i,$j);<br />
&nbsp;&nbsp;&nbsp; $num[$tochka]=$num[$tochka]+1;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
echo "&lt;br&gt;&lt;br&gt;$widthIm x $heightIm ($total pixels).";<br />
echo " Number of colors in pallette - $cvcol&lt;br&gt;&lt;br&gt;<br />
";<br />
echo "&lt;table width=400 border =1&gt;";<br />
for ($k=0; $k&lt;$cvcol; $k++) {<br />
$proc=round($num[$k]/$total*100, 2);<br />
$Palitra =ImageColorsForIndex($im1,$k);<br />
$Palitra[red]= dechex($Palitra[red]);<br />
$Palitra[green]= dechex($Palitra[green]);<br />
$Palitra[blue]= dechex($Palitra[blue]);<br />
echo "&lt;tr&gt;&lt;td&gt;$k&lt;/td&gt;&lt;td width=100&gt;$Palitra[red]-$Palitra[green]-$Palitra[blue]&lt;/td&gt;";<br />
echo "&lt;td width=100&gt;$proc %&lt;/td&gt;";<br />
echo "&lt;td width=100 bgcolor=$Palitra[red],$Palitra";<br />
echo "[green],$Palitra[blue]&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;";<br />
}<br />
echo "&lt;/table&gt;";<br />
imagedestroy($im1);<br />
$t2=-$t1+time();<br />
echo "&lt;br&gt;Time past: $t2 sec";<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="35116""></a>
  <div class="note">
   <strong class="user">willertan1980 at yahoo dot com</strong>
   <a href="#35116" class="date">20-Aug-2003 01:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
did you found that sometimes it hang the php when imagecreatefromjpeg() run on bad JPEG. I found that this is cause by the JPEG file U used dont have EOI (end of image) <br />
the FF D9 at the end of your JPEG<br />
<br />
JPEG image should start with 0xFFD8 and end with 0xFFD9<br />
<br />
// this may help to fix the error<br />
function check_jpeg($f, $fix=false ){<br />
# [070203]<br />
# check for jpeg file header and footer - also try to fix it<br />
&nbsp;&nbsp;&nbsp; if ( false !== (@$fd = fopen($f, 'r+b' )) ){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( fread($fd,2)==chr(255).chr(216) ){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; fseek ( $fd, -2, SEEK_END );<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ( fread($fd,2)==chr(255).chr(217) ){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; fclose($fd);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return true;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }else{<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ( $fix &amp;&amp; fwrite($fd,chr(255).chr(217)) ){return true;}<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; fclose($fd);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return false;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }else{fclose($fd); return false;}<br />
&nbsp;&nbsp;&nbsp; }else{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return false;<br />
&nbsp;&nbsp;&nbsp; }<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="33821""></a>
  <div class="note">
   <strong class="user">office at 4point-webdesign dot com</strong>
   <a href="#33821" class="date">08-Jul-2003 09:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's the answer for your 256 color only problem!!!<br />
use these functions in order then it works fine!<br />
<br />
$img_src=imagecreatefromjpeg('yoursource.jpg');<br />
$img_dst=imagecreatetruecolor(20,20);<br />
imagecopyresampled($img_dst, $img_src, 0, 0, 0, 0, 20, 20, 20, 20);<br />
imagejpeg($img_dst, $g_dstfile, 100);<br />
imagedestroy($img_dst);<br />
<br />
Greetz, GTB</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="33351""></a>
  <div class="note">
   <strong class="user">lordneon at deskmod dot com</strong>
   <a href="#33351" class="date">23-Jun-2003 11:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For Windows users who wants to enable the GD libary:<br />
<br />
It took me some while to figure this out, but in the end it worked (and still does) great.<br />
<br />
1. First download the latest (stable recommended) version of php<br />
2. Unzip to f.ex c:\php\<br />
<br />
3. Now you should have a file in c:\php\ that's named php.ini.dist (or something like that). Rename that to php.ini and copy it to the root of you Windows directory.<br />
<br />
4. Open the php.ini file (the easiers way is to open the run promnt at your start menu and just type php.ini and hit enter).<br />
<br />
5. Search (ctrl+f) for extension_dir. The default value is set to "./", make it to "./extensions"<br />
<br />
6. Now you need to find where in the php.ini the modules for Windows is located. Search for gd.<br />
<br />
7. Remove the ; char infront of this line: extension=php_gd2.dll<br />
<br />
8. Try make a php script with some image functions and see if it works. F.ex $im = imageCreate("test.jpg");<br />
If you get a message that says something like imageCreate function doesn't exist the gd libary is not loaded.<br />
<br />
9. That's all. Have fun using GD in Windows :)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="32567""></a>
  <div class="note">
   <strong class="user">atapi103 at hotmail dot com</strong>
   <a href="#32567" class="date">31-May-2003 10:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As jpsy sugested Windows users can download the zip to get the gd2_dll extension <br />
<br />
OR<br />
<br />
If you already installed with the windows installer and are too lazy to get the zip you can go here<br />
<br />
<a href="http://www.coupin.net/gd-freetype/windows.php" rel="nofollow" target="_blank">http://www.coupin.net/gd-freetype/windows.php</a><br />
<br />
Download the php_gd2.dll file put it wherever you want, and change the<br />
<br />
extension_dir=C:\php\extensions<br />
<br />
Wherever you saved the dll to is the path you put in, remember to uncomment<br />
<br />
extension=php_gd2.dll<br />
<br />
Do not uncomment the one above for gd.dll (the one without the 2)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="29068""></a>
  <div class="note">
   <strong class="user">tom at ierna dot com</strong>
   <a href="#29068" class="date">01-Feb-2003 12:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Doing a "make clean", regardless of which platform you're on (including MacOS X) should clean up the source tree enough to ensure that config changes take effect...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="22783""></a>
  <div class="note">
   <strong class="user">bpiere21 at hotmail dot com</strong>
   <a href="#22783" class="date">30-Jun-2002 03:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
###--- imagecreatefromjpeg only opens JPEG files from your disk.<br />
###--- To load JPEG images from a URL, use the function below.<br />
<br />
function LoadJPEG ($imgURL) {<br />
<br />
&nbsp;&nbsp;&nbsp; ##-- Get Image file from Port 80 --##<br />
&nbsp;&nbsp;&nbsp; $fp = fopen($imgURL, "r");<br />
&nbsp;&nbsp;&nbsp; $imageFile = fread ($fp, 3000000);<br />
&nbsp;&nbsp;&nbsp; fclose($fp);<br />
<br />
&nbsp;&nbsp;&nbsp; ##-- Create a temporary file on disk --##<br />
&nbsp;&nbsp;&nbsp; $tmpfname = tempnam ("/temp", "IMG");<br />
<br />
&nbsp;&nbsp;&nbsp; ##-- Put image data into the temp file --##<br />
&nbsp;&nbsp;&nbsp; $fp = fopen($tmpfname, "w");<br />
&nbsp;&nbsp;&nbsp; fwrite($fp, $imageFile);<br />
&nbsp;&nbsp;&nbsp; fclose($fp);<br />
<br />
&nbsp;&nbsp;&nbsp; ##-- Load Image from Disk with GD library --##<br />
&nbsp;&nbsp;&nbsp; $im = imagecreatefromjpeg ($tmpfname);<br />
<br />
&nbsp;&nbsp;&nbsp; ##-- Delete Temporary File --##<br />
&nbsp;&nbsp;&nbsp; unlink($tmpfname);<br />
<br />
&nbsp;&nbsp;&nbsp; ##-- Check for errors --##<br />
&nbsp;&nbsp;&nbsp; if (!$im) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; print "Could not create JPEG image $imgURL";<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; return $im;<br />
}<br />
<br />
$imageData = LoadJPEG("<a href="http://www.example.com/example.jpg" rel="nofollow" target="_blank">http://www.example.com/example.jpg</a>");<br />
<br />
Header( "Content-Type: image/jpeg");<br />
<br />
imagejpeg($imageData, '', 100);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="17974""></a>
  <div class="note">
   <strong class="user">mihkel at raba dot ee</strong>
   <a href="#17974" class="date">05-Jan-2002 10:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
[Ed Note: You must have netpbm installed for this to work --alindeman @ php.net]
<br />

<br />
Just wanted to let you know that
<br />
imagecreatefromjpeg crashes php 
<br />
(command line at least) sometimes with segmentation fault when jpeg is corrupted.
<br />
To get rid of the nasty segmentation fault i used 
<br />
system ("jpegtopnm f.jpg &gt; f.pnm", $r);
<br />
if ($r != 0) {printf ("invalid jpeg\n"); return; }
<br />
system ("pnmtopng f.pnm &gt; f.png");
<br />
$im =imagecreatefrompng ("f.png");</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="15760""></a>
  <div class="note">
   <strong class="user">jason_wilk at hotmail dot com</strong>
   <a href="#15760" class="date">02-Oct-2001 07:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Wow, it only took me 3 hours to get all of the lib paths correct for my install. Some of them are /usr, and some are /usr/lib...go figure. I figured that I would post this in the hopes that it will save somebody some time. 
<br />

<br />
Remember that if you're using rpm installs...you have to install the devel packages. For example, if you're installing mysql from rpm, and you want to compile with support for your particular MySql dist, you must install mysql-devel*.rpm.
<br />

<br />
Anyway, I'm a redhat 7.1 install...with all appropriate devel packages installed.
<br />

<br />
./configure \
<br />
--with-mysql=/usr \
<br />
--with-ftp \
<br />
--with-apxs=/home/www/bin/apxs \
<br />
--with-xpm-dir=/usr/X11R6 \
<br />
--with-gdbm=/usr/lib \
<br />
--with-gd=/usr \
<br />
--with-zlib-dir=/usr/lib \
<br />
--with-jpeg-dir=/usr/lib \
<br />
--with-png-dir=/usr/lib \
<br />
--with-tiff-dir=/usr/lib \
<br />
--with-config-file-path=/home/www/conf \
<br />
--with-freetype-dir=/usr/lib \
<br />
--enable-magic-quotes \
<br />
--enable-track-vars</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="13665""></a>
  <div class="note">
   <strong class="user">dmsales at design-monster dot com</strong>
   <a href="#13665" class="date">28-Jun-2001 07:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I just wanted to note here something i found else where that was very helpful to me when using jpeg images.&nbsp; when using imagecreatefromjpeg()&nbsp; it can be difficult to allocate new colors.&nbsp; 
<br />

<br />
The work around i found was posted under imagecolorallocate() and prescribes that you first use imagecreate(), allocate colors, and then copy the jpeg into this image.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="12371""></a>
  <div class="note">
   <strong class="user">infoNOSPAM at psnetworks dot net</strong>
   <a href="#12371" class="date">09-Apr-2001 06:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For those having trouble getting jpeg support using gd, make sure you
<br />
rm config.cache
<br />
before reconfiguring php. Otherwise the configure script will assume jpeg support is still not compiled into gd.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="11401""></a>
  <div class="note">
   <strong class="user">mboucher at ampmedia dot net</strong>
   <a href="#11401" class="date">20-Feb-2001 01:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In response to my own post:
<br />

<br />
Maybe this is common knowledge but here is how I solved my problem. Hopefully this will help out seeing how I couldn't find any other articles on this topic with a solution.
<br />

<br />
This seems to work pretty well. Displays in browser and QT Picture Viewer but for some reason Photoshop won't open it. Translation error. Since I'm just using it to cache the image for when the our content provider goes down no biggie there.
<br />

<br />
<span class="default">&lt;?php
<br />
$si </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$imagePathURL</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">);&nbsp;&nbsp; </span><span class="comment">// open URL
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$serverImg </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$si</span><span class="keyword">, </span><span class="default">1000000</span><span class="keyword">);&nbsp;&nbsp; </span><span class="comment">// read contents
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 
<br />
</span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$si</span><span class="keyword">);&nbsp;&nbsp; </span><span class="comment">// close file
<br />
</span><span class="default">?&gt;
<br />
</span>&nbsp; &nbsp; 
<br />
/* open file to save to (w+ creates if file does not exist || b opens binary safe [Win32]) Seemed to work fine with out the 'b' on Windows NT but just to be safe. */
<br />

<br />
<span class="default">&lt;?php
<br />
$si </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$saveImgTo</span><span class="keyword">, </span><span class="string">"w+b"</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$si</span><span class="keyword">, </span><span class="default">$serverImg</span><span class="keyword">);&nbsp;&nbsp; </span><span class="comment">// write contents to file
<br />
&nbsp;&nbsp;&nbsp; 
<br />
</span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$si</span><span class="keyword">);&nbsp;&nbsp; </span><span class="comment">// close file
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Hope this helps somebody...long live PHP</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="10266""></a>
  <div class="note">
   <strong class="user">support at corbach dot de</strong>
   <a href="#10266" class="date">22-Dec-2000 12:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Wonder why that's just the only image function you can't get to work? Remember that you have to use a gd library that supports JPEG (make it manually and &lt;important&gt;edit the makefile&lt;/important&gt;)! Especially all gd RPMs from SuSE (including 7.0) don't support it as it's not default up to gd 1.8.3.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="8663""></a>
  <div class="note">
   <strong class="user">timpie2000 at zeelandnet dot nl</strong>
   <a href="#8663" class="date">23-Sep-2000 02:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Be sure to allocate your colors AFTER you used this function or else you might get some strange colors..</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="6884""></a>
  <div class="note">
   <strong class="user">rodders_plonker at yahoo dot com</strong>
   <a href="#6884" class="date">21-Jul-2000 05:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To all those having trouble with a message to the effect of:
<br />
CreateImageFromJpeg() not supported in this PHP build
<br />
Start by adding --with-jpeg-dir to your ./configure options as I left this out (not knowing I needed it) and I spent the best part of 6 hours trying to compile to get this option. (RH 6.2, PHP 4.0.1pl2, Apache 1.3.12, GD 1.8.3)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
