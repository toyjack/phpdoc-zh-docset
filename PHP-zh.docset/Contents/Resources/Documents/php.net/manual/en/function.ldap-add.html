<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>Add entries to LDAP directory</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.ldap-8859-to-t61.html">? ldap_8859_to_t61</a></li>
      <li style="float: right;"><a href="function.ldap-bind.html">ldap_bind ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.ldap.html">LDAP 函数</a></li>
    <li>Add entries to LDAP directory</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.ldap-add" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">ldap_add</h1>
  <p class="verinfo">(PHP 4, PHP 5, PHP 7)</p><p class="refpurpose"><span class="refname">ldap_add</span> &mdash; <span class="dc-title">Add entries to LDAP directory</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.ldap-add-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">bool</span> <span class="methodname"><strong>ldap_add</strong></span>
    ( <span class="methodparam"><span class="type">resource</span> <code class="parameter">$link_identifier</code></span>
   , <span class="methodparam"><span class="type">string</span> <code class="parameter">$dn</code></span>
   , <span class="methodparam"><span class="type">array</span> <code class="parameter">$entry</code></span>
   )</div>

  <p class="para rdfs-comment">
   Add entries in the LDAP directory. 
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.ldap-add-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">link_identifier</code></dt>

     <dd>

      <p class="para">
       An LDAP link identifier, returned by <span class="function"><a href="function.ldap-connect.html" class="function">ldap_connect()</a></span>.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">dn</code></dt>

     <dd>

      <p class="para">
       The distinguished name of an LDAP entity.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">entry</code></dt>

     <dd>

      <p class="para">
       An array that specifies the information about the entry. The values in
       the entries are indexed by individual attributes.
       In case of multiple values for an attribute, they are indexed using
       integers starting with 0.
       <div class="informalexample">
        <div class="example-contents">
     <div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$entry</span><span style="color: #007700">[</span><span style="color: #DD0000">"attribute1"</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #DD0000">"value"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$entry</span><span style="color: #007700">[</span><span style="color: #DD0000">"attribute2"</span><span style="color: #007700">][</span><span style="color: #0000BB">0</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #DD0000">"value1"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$entry</span><span style="color: #007700">[</span><span style="color: #DD0000">"attribute2"</span><span style="color: #007700">][</span><span style="color: #0000BB">1</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #DD0000">"value2"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
        </div>

       </div>
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.ldap-add-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   成功时返回 <strong><code>TRUE</code></strong>， 或者在失败时返回 <strong><code>FALSE</code></strong>。
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.ldap-add-examples">
  <h3 class="title">范例</h3>
  <p class="para">
   <div class="example" id="example-4750">
    <p><strong>Example #1 Complete example with authenticated bind</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$ds&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">ldap_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">"localhost"</span><span style="color: #007700">);&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;assuming&nbsp;the&nbsp;LDAP&nbsp;server&nbsp;is&nbsp;on&nbsp;this&nbsp;host<br /><br /></span><span style="color: #007700">if&nbsp;(</span><span style="color: #0000BB">$ds</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;bind&nbsp;with&nbsp;appropriate&nbsp;dn&nbsp;to&nbsp;give&nbsp;update&nbsp;access<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$r&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">ldap_bind</span><span style="color: #007700">(</span><span style="color: #0000BB">$ds</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"cn=root,&nbsp;o=My&nbsp;Company,&nbsp;c=US"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"secret"</span><span style="color: #007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;prepare&nbsp;data<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$info</span><span style="color: #007700">[</span><span style="color: #DD0000">"cn"</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #DD0000">"John&nbsp;Jones"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$info</span><span style="color: #007700">[</span><span style="color: #DD0000">"sn"</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #DD0000">"Jones"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$info</span><span style="color: #007700">[</span><span style="color: #DD0000">"objectclass"</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #DD0000">"person"</span><span style="color: #007700">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;add&nbsp;data&nbsp;to&nbsp;directory<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$r&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">ldap_add</span><span style="color: #007700">(</span><span style="color: #0000BB">$ds</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"cn=John&nbsp;Jones,&nbsp;o=My&nbsp;Company,&nbsp;c=US"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$info</span><span style="color: #007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">ldap_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$ds</span><span style="color: #007700">);<br />}&nbsp;else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"Unable&nbsp;to&nbsp;connect&nbsp;to&nbsp;LDAP&nbsp;server"</span><span style="color: #007700">;<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 notes" id="refsect1-function.ldap-add-notes">
  <h3 class="title">注释</h3>
  <blockquote class="note"><p><strong class="note">Note</strong>: <span class="simpara">此函数可安全用于二进制对象。</span></p></blockquote>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.ldap-add-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.ldap-delete.html" class="function" rel="rdfs-seeAlso">ldap_delete()</a> - Delete an entry from a directory</span></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="113145""></a>
  <div class="note">
   <strong class="user">Igor2i</strong>
   <a href="#113145" class="date">05-Sep-2013 04:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Решил добавить специально для русскоязычных пользователей.<br />
У меня сервер на Gentoo с поддержкой кириллици в кодировке UTF-8.<br />
И при вводе через форму кириллицы выдавал ошибку синтаксиса.<br />
Решение проблемы: <br />
1) код требуется перекодировать в UTF-8 без BOM<br />
2) и в начале кода вставить строку <br />
<span class="default">&lt;?php<br />
header</span><span class="keyword">(</span><span class="string">'Content-Type: text/html; CHARSET=gb2312'</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="111095""></a>
  <div class="note">
   <strong class="user">paul90brown at gmail dot com</strong>
   <a href="#111095" class="date">14-Jan-2013 04:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I kept getting "Object Class Violation" when I tried adding posixAccount and shadowAccount as an objectclass. It turned out that these object classes had a lot of required fields that I was not adding. You may need to export a working user (if you have phpLDAPadmin) and see exactly what fields they have, then try to copy it exactly in the script. It also doesn't hurt if you make everything an Array the first time around, you can fix those fields later.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82702""></a>
  <div class="note">
   <strong class="user">sergioshev</strong>
   <a href="#82702" class="date">22-Apr-2008 07:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
once i'am having problmes to add attributes with boolean syntax (1.3.6.1.4.1.1466.115.121.1.7)<br />
<br />
$['boolean_attr']=true; //give me one warning, ldap_add(): Add: Invalid syntax<br />
<br />
solved this by setting the value on this:<br />
&nbsp;<br />
$['boolean_attr']='TRUE';<br />
<br />
hope this can helps.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81113""></a>
  <div class="note">
   <strong class="user">phil at networkalliance dot com</strong>
   <a href="#81113" class="date">14-Feb-2008 06:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I created a simple function that can be called to create global distribution groups in Active Directory:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">ldap_createGroup</span><span class="keyword">(</span><span class="default">$object_name</span><span class="keyword">, </span><span class="default">$dn</span><span class="keyword">, </span><span class="default">$members</span><span class="keyword">, </span><span class="default">$ldap_conn</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$addgroup_ad</span><span class="keyword">[</span><span class="string">'cn'</span><span class="keyword">]=</span><span class="string">"</span><span class="default">$object_name</span><span class="string">"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$addgroup_ad</span><span class="keyword">[</span><span class="string">'objectClass'</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">] = </span><span class="string">"top"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$addgroup_ad</span><span class="keyword">[</span><span class="string">'objectClass'</span><span class="keyword">][</span><span class="default">1</span><span class="keyword">] =</span><span class="string">"group"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$addgroup_ad</span><span class="keyword">[</span><span class="string">'groupType'</span><span class="keyword">]=</span><span class="string">"2"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$addgroup_ad</span><span class="keyword">[</span><span class="string">'member'</span><span class="keyword">]=</span><span class="default">$members</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$addgroup_ad</span><span class="keyword">[</span><span class="string">"sAMAccountName"</span><span class="keyword">] =</span><span class="default">$object_name</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">ldap_add</span><span class="keyword">(</span><span class="default">$ldap_conn</span><span class="keyword">,</span><span class="default">$dn</span><span class="keyword">,</span><span class="default">$addgroup_ad</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">ldap_error</span><span class="keyword">(</span><span class="default">$ldap_conn</span><span class="keyword">) == </span><span class="string">"Success"</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp;&nbsp; return </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
You can call this function using the follow code:<br />
<br />
<span class="default">&lt;?php<br />
$ldap_conn </span><span class="keyword">= </span><span class="default">ldap_bind</span><span class="keyword">();<br />
</span><span class="default">$object_name</span><span class="keyword">=</span><span class="string">"Test Group"</span><span class="keyword">;<br />
</span><span class="default">$dn</span><span class="keyword">=</span><span class="string">"CN="</span><span class="keyword">.</span><span class="default">$object_name</span><span class="keyword">.</span><span class="string">",OU=PathToAddGroupTo,OU=All Users,DC=YOURDOMAIN,DC=COM"</span><span class="keyword">;<br />
</span><span class="default">$members</span><span class="keyword">[] =</span><span class="string">"CN=User1,OU=PathToAddGroupTo,OU=All Users,DC=YOURDOMAIN,DC=COM"</span><span class="keyword">;<br />
</span><span class="default">$members</span><span class="keyword">[] =</span><span class="string">"CN=User2,OU=PathToAddGroupTo,OU=All Users,DC=YOURDOMAIN,DC=COM"</span><span class="keyword">;<br />
<br />
</span><span class="default">ldap_createGroup</span><span class="keyword">(</span><span class="default">$object_name</span><span class="keyword">, </span><span class="default">$dn</span><span class="keyword">, </span><span class="default">$members</span><span class="keyword">, </span><span class="default">$ldap_conn</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
The other function I created is ldap_bind(), and this can be used to bind to an LDAP server:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">ldap_bind</span><span class="keyword">()<br />
{<br />
&nbsp; </span><span class="default">$ldap_addr </span><span class="keyword">= </span><span class="string">'192.168.1.1'</span><span class="keyword">;&nbsp; </span><span class="comment">// Change this to the IP address of the LDAP server<br />
&nbsp; </span><span class="default">$ldap_conn </span><span class="keyword">= </span><span class="default">ldap_connect</span><span class="keyword">(</span><span class="default">$ldap_addr</span><span class="keyword">) or die(</span><span class="string">"Couldn't connect!"</span><span class="keyword">);<br />
&nbsp; </span><span class="default">ldap_set_option</span><span class="keyword">(</span><span class="default">$ldap_conn</span><span class="keyword">, </span><span class="default">LDAP_OPT_PROTOCOL_VERSION</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$ldap_rdn </span><span class="keyword">= </span><span class="string">"domain_name\\user_account"</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$ldap_pass </span><span class="keyword">= </span><span class="string">"user_password"</span><span class="keyword">;<br />
<br />
&nbsp; </span><span class="comment">// Authenticate the user against the domain controller<br />
&nbsp; </span><span class="default">$flag_ldap </span><span class="keyword">= </span><span class="default">ldap_bind</span><span class="keyword">(</span><span class="default">$ldap_conn</span><span class="keyword">,</span><span class="default">$ldap_rdn</span><span class="keyword">,</span><span class="default">$ldap_pass</span><span class="keyword">);<br />
&nbsp; return </span><span class="default">$ldap_conn</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="78902""></a>
  <div class="note">
   <strong class="user">stian</strong>
   <a href="#78902" class="date">01-Nov-2007 03:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This solution works for us. <br />
In the form the CN and pwdtxt are randomly generated from strict rules. <br />
This script creates 50-60 users i AD pr.day! and never even had a glitch!<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">## From form<br />
</span><span class="default">$CN </span><span class="keyword">= </span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'CN'</span><span class="keyword">]; <br />
</span><span class="default">$givenName </span><span class="keyword">= </span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'givenName'</span><span class="keyword">];<br />
</span><span class="default">$SN </span><span class="keyword">= </span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'SN'</span><span class="keyword">];<br />
</span><span class="default">$mail </span><span class="keyword">= </span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'mail'</span><span class="keyword">];<br />
</span><span class="default">$Phone </span><span class="keyword">= </span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'Phone'</span><span class="keyword">];<br />
</span><span class="default">$pwdtxt </span><span class="keyword">= </span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'pwdtxt'</span><span class="keyword">];<br />
<br />
</span><span class="default">$AD_server </span><span class="keyword">= </span><span class="string">"localhost:390"</span><span class="keyword">; </span><span class="comment">// Local Stunnel --&gt; <a href="http://www.stunnel.org/" rel="nofollow" target="_blank">http://www.stunnel.org/</a><br />
</span><span class="default">$AD_Auth_User </span><span class="keyword">= </span><span class="string">"administrator@student.somwhere.com"</span><span class="keyword">; </span><span class="comment">//Administrative user<br />
</span><span class="default">$AD_Auth_PWD </span><span class="keyword">= </span><span class="string">"duppiduppdupp"</span><span class="keyword">; </span><span class="comment">//The password <br />
<br />
</span><span class="default">$dn </span><span class="keyword">= </span><span class="string">'CN='</span><span class="keyword">.</span><span class="default">$CN</span><span class="keyword">.</span><span class="string">',OU=Brukere,DC=student,DC=somwhere,DC=com'</span><span class="keyword">;<br />
<br />
</span><span class="comment">## Create Unicode password<br />
</span><span class="default">$newPassword </span><span class="keyword">= </span><span class="string">"\"" </span><span class="keyword">. </span><span class="default">$pwdtxt </span><span class="keyword">. </span><span class="string">"\""</span><span class="keyword">;<br />
</span><span class="default">$len </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$newPassword</span><span class="keyword">);<br />
</span><span class="default">$newPassw </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
<br />
for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">$len</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">++) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$newPassw </span><span class="keyword">.= </span><span class="string">"</span><span class="keyword">{</span><span class="default">$newPassword</span><span class="keyword">{</span><span class="default">$i</span><span class="keyword">}}</span><span class="string">\000"</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="comment">## CONNNECT TO AD<br />
</span><span class="default">$ds </span><span class="keyword">= </span><span class="default">ldap_connect</span><span class="keyword">(</span><span class="default">$AD_server</span><span class="keyword">);<br />
if (</span><span class="default">$ds</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">ldap_set_option</span><span class="keyword">(</span><span class="default">$ds</span><span class="keyword">, </span><span class="default">LDAP_OPT_PROTOCOL_VERSION</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">); </span><span class="comment">// IMPORTANT<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$r </span><span class="keyword">= </span><span class="default">ldap_bind</span><span class="keyword">(</span><span class="default">$ds</span><span class="keyword">, </span><span class="default">$AD_Auth_User</span><span class="keyword">, </span><span class="default">$AD_Auth_PWD</span><span class="keyword">); </span><span class="comment">//BIND<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ldaprecord</span><span class="keyword">[</span><span class="string">'cn'</span><span class="keyword">] = </span><span class="default">$CN</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ldaprecord</span><span class="keyword">[</span><span class="string">'givenName'</span><span class="keyword">] = </span><span class="default">$givenName</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ldaprecord</span><span class="keyword">[</span><span class="string">'sn'</span><span class="keyword">] = </span><span class="default">$SN</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ldaprecord</span><span class="keyword">[</span><span class="string">'objectclass'</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">] = </span><span class="string">"top"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ldaprecord</span><span class="keyword">[</span><span class="string">'objectclass'</span><span class="keyword">][</span><span class="default">1</span><span class="keyword">] = </span><span class="string">"person"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ldaprecord</span><span class="keyword">[</span><span class="string">'objectclass'</span><span class="keyword">][</span><span class="default">1</span><span class="keyword">] = </span><span class="string">"organizationalPerson"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ldaprecord</span><span class="keyword">[</span><span class="string">'objectclass'</span><span class="keyword">][</span><span class="default">2</span><span class="keyword">] = </span><span class="string">"user"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ldaprecord</span><span class="keyword">[</span><span class="string">'mail'</span><span class="keyword">] = </span><span class="default">$mail</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ldaprecord</span><span class="keyword">[</span><span class="string">'telephoneNumber'</span><span class="keyword">] = </span><span class="default">$Phone</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ldaprecord</span><span class="keyword">[</span><span class="string">"unicodepwd"</span><span class="keyword">] = </span><span class="default">$newPassw</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ldaprecord</span><span class="keyword">[</span><span class="string">"sAMAccountName"</span><span class="keyword">] = </span><span class="default">$CN</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ldaprecord</span><span class="keyword">[</span><span class="string">"UserAccountControl"</span><span class="keyword">] = </span><span class="string">"512"</span><span class="keyword">; <br />
</span><span class="comment">//This is to prevent the user from beeing disabled. --&gt;<br />
</span><span class="default">http</span><span class="keyword">:</span><span class="comment">//support.microsoft.com/default.aspx?scid=kb;en-us;305144<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$r </span><span class="keyword">= </span><span class="default">ldap_add</span><span class="keyword">(</span><span class="default">$ds</span><span class="keyword">, </span><span class="default">$dn</span><span class="keyword">, </span><span class="default">$ldaprecord</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
} else { <br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"cannot connect to LDAP server at </span><span class="default">$AD_server</span><span class="string">."</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
This is code example creates a user i AD.<br />
We use this on an internal web page to create <br />
temporary users that kan access the wireless network. <br />
We have a .pl script that deletes the users after 24H.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77113""></a>
  <div class="note">
   <strong class="user">Willie</strong>
   <a href="#77113" class="date">15-Aug-2007 11:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In response to:<br />
Note that you cannot use base64 encoding, you have to use utf-8 encoding for special chars instead.<br />
--<br />
<br />
I have found that if I have a special character (or a newline) that ldap_add and ldap_modify will automatically do the base64 encoding for you.&nbsp; For example:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// assuming binding is done, etc.<br />
</span><span class="default">$entry</span><span class="keyword">[</span><span class="string">'postalAddress'</span><span class="keyword">] = </span><span class="string">"123 East 456 West\nSuite A103"</span><span class="keyword">;<br />
</span><span class="default">ldap_modify</span><span class="keyword">(</span><span class="default">$ds</span><span class="keyword">, </span><span class="default">$dn</span><span class="keyword">, </span><span class="default">$entry</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
The function or server will take the newline and convert it into base64 automatically (same goes for other special characters).<br />
<br />
You may be able to verify by using a command-line ldapsearch<br />
ldapsearch -b "dc=example,dc=com" -x "(cn=Example Person)" postalAddress<br />
<br />
You'll see that the result comes up as<br />
dn: cn=Example Person,dc=example,dc=com<br />
postalAddress:: MTIzIEVhc3QgNDU2IFdlc3QKU3VpdGUgQTEwMw==<br />
<br />
See the double colons after postal address?&nbsp; That's how LDAP states it's base64 encoded in this case.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71857""></a>
  <div class="note">
   <strong class="user">damien at groovey dot com</strong>
   <a href="#71857" class="date">19-Dec-2006 11:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is how to add a user with a hashed MD5 password to OpenLDAP.&nbsp; I used this technique to migrate Drupal accounts into OpenLDAP for a single-sign-on solution.&nbsp;&nbsp; <br />
<br />
The trick to it is to tell OpenLDAP the hash type (e.g. {MD5}) before the password, and also to base64 encode the BINARY hashed result.&nbsp; You cannot just base64 encode what is returned by PHP's md5() or sha() hash functions, because they return a hexadecimal text string.&nbsp; First you must use pack("H*", $hash_result) to make that a binary string, THEN you can base64 encode it.<br />
<br />
Here is complete code for connecting and adding a user with a hashed password.&nbsp; You don't have to use {MD5}, you could pick a different hash if that is what you have.&nbsp; The output from one of these hashed passwords will look like this:&nbsp; {md5}bdwD04RS9xMDGVi1n/H36Q== <br />
<br />
Finally some caveats:&nbsp; This technique will not work if you hashed the password using a salt value (but Drupal does not).&nbsp; This technique will also certainly not work with active directory, where passwords can definitely only be set over SSL connections and hashing probably works differently.<br />
<br />
---- snip ----<br />
<br />
$ds = ldap_connect($serverAddress);<br />
if ($ds) {<br />
&nbsp; ldap_set_option($ds, LDAP_OPT_PROTOCOL_VERSION, 3);&nbsp; // otherwise PHP defaults to ldap v2 and you will get a Syntax Error!<br />
&nbsp; $r = ldap_bind($ds, $managerDN, $managerPassword);<br />
&nbsp; $ldaprecord['cn'] = $newuser_username;<br />
&nbsp; $ldaprecord['givenName'] = $newuser_firstname;<br />
&nbsp; $ldaprecord['sn'] = $newuser_surname;<br />
&nbsp; // put user in objectClass inetOrgPerson so we can set the mail and phone number attributes<br />
&nbsp; $ldaprecord['objectclass'][0] = "person";<br />
&nbsp; $ldaprecord['objectclass'][1] = "organizationalPerson";<br />
&nbsp; $ldaprecord['objectclass'][2] = "inetOrgPerson";<br />
&nbsp; $ldaprecord['mail'] = $newuser_email_address;<br />
&nbsp; $ldaprecord['telephoneNumber'] = $newuser_phone_number;<br />
&nbsp; // and now the tricky part, base64 encode the binary hash result:<br />
&nbsp; $ldaprecord['userPassword'] = '{MD5}' . base64_encode(pack('H*',$newuser_md5hashed_password));<br />
&nbsp; // If you have the plain text password instead, you could use:<br />
&nbsp; // $ldaprecord['userPassword'] = '{MD5}' . base64_encode(pack('H*',md5($newuser_plaintext_password)));<br />
&nbsp; $r = ldap_add($ds, $base_user_dn, $ldaprecord);<br />
} else { die "cannot connect to LDAP server at $serverAddress."; }</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="57300""></a>
  <div class="note">
   <strong class="user">chad dot smith at 50marketing dot com</strong>
   <a href="#57300" class="date">29-Sep-2005 11:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I took spam2004 at turniton dot dk example and made it a bit better.&nbsp; Maybe my setup was a bit different but either way here is how I added a group in Microsoft Windows Server 2003.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// Connect using ldap_connect<br />
// Bind using ldap_bind<br />
// Set LDAP_OPT_PROTOCOL_VERSION to 3<br />
</span><span class="default">$member_array </span><span class="keyword">= array();<br />
</span><span class="default">$member_array</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] = </span><span class="string">"cn=user1,cn=Users,dc=yourdomain,dc=com"</span><span class="keyword">;<br />
</span><span class="default">$member_array</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] = </span><span class="string">"cn=administrator,cn=Users,dc=yourdomain,dc=com"</span><span class="keyword">;<br />
<br />
</span><span class="default">$addgroup_ad</span><span class="keyword">[</span><span class="string">"cn"</span><span class="keyword">] = </span><span class="string">"testgroup"</span><span class="keyword">;<br />
</span><span class="default">$addgroup_ad</span><span class="keyword">[</span><span class="string">"samaccountname"</span><span class="keyword">] = </span><span class="string">"testgroup"</span><span class="keyword">;<br />
</span><span class="default">$addgroup_ad</span><span class="keyword">[</span><span class="string">"objectClass"</span><span class="keyword">] = </span><span class="string">"Group"</span><span class="keyword">;<br />
</span><span class="default">$addgroup_ad</span><span class="keyword">[</span><span class="string">"description"</span><span class="keyword">] = </span><span class="string">"Yep just a test."</span><span class="keyword">;<br />
</span><span class="default">$addgroup_ad</span><span class="keyword">[</span><span class="string">"member"</span><span class="keyword">] = </span><span class="default">$member_array</span><span class="keyword">;<br />
</span><span class="default">$base_dn </span><span class="keyword">= </span><span class="string">"cn=testgroup,cn=Users,DC=yourdomain,DC=com"</span><span class="keyword">;<br />
</span><span class="default">ldap_add</span><span class="keyword">(</span><span class="default">$ldap_conn</span><span class="keyword">,</span><span class="default">$base_dn</span><span class="keyword">,</span><span class="default">$addgroup_ad</span><span class="keyword">);<br />
</span><span class="comment">// This is it.<br />
</span><span class="default">?&gt;<br />
</span><br />
Take care and good luck,<br />
Chad R. Smith</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="54814""></a>
  <div class="note">
   <strong class="user">theiderich AT laweekly dot com</strong>
   <a href="#54814" class="date">15-Jul-2005 07:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When adding/editing attributes for a user, keep in mind that the 'memberof' attribute is a special case.&nbsp; The memberOf attribute is not an accessible attribute of the user schema. To add someone to a group, you have to add the user in the group, and not the group in the user. You can do this by accessing the group attribute 'member':<br />
<br />
<span class="default">&lt;?php<br />
<br />
$group_name </span><span class="keyword">= </span><span class="string">"CN=MyGroup,OU=Groups,DC=example,DC=com"</span><span class="keyword">;<br />
</span><span class="default">$group_info</span><span class="keyword">[</span><span class="string">'member'</span><span class="keyword">] = </span><span class="default">$dn</span><span class="keyword">; </span><span class="comment">// User's DN is added to group's 'member' array<br />
</span><span class="default">ldap_mod_add</span><span class="keyword">(</span><span class="default">$connect</span><span class="keyword">,</span><span class="default">$group_name</span><span class="keyword">,</span><span class="default">$group_info</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="52457""></a>
  <div class="note">
   <strong class="user">micattack+phpnet at gmail dot com</strong>
   <a href="#52457" class="date">02-May-2005 03:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When getting the dreaded invalid syntax, it helps turning on debugging in ldap. Looking at /var/log/ldap, gets you things like<br />
<br />
May&nbsp; 2 13:51:21 tux slapd[12985]: conn=4934 op=1 RESULT tag=105 err=21 text=phpgwtz: value #0 invalid per syntax<br />
May&nbsp; 2 13:52:02 tux slapd[12697]: No objectClass for entry (uid=1, ou=adressen, dc=...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="46974""></a>
  <div class="note">
   <strong class="user">hp at syntomax dot com</strong>
   <a href="#46974" class="date">29-Oct-2004 03:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Another fun thing: ldap_add() doesn't like arrays with empty members: so <br />
array (<br />
&nbsp;&nbsp; &nbsp;&nbsp; [cn] = "name"<br />
&nbsp;&nbsp; &nbsp;&nbsp; [key] = ""<br />
&nbsp;&nbsp; &nbsp;&nbsp; [anotherkey] = "value"<br />
)<br />
will yield a syntax error!<br />
<br />
solve this with a simple peice of code:<br />
<br />
foreach ($originalobject as $key =&gt; $value){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ($value != ""){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $object[$key] = $value;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
}<br />
<br />
where $originalobject is the uncecked array and $object is the one without empty members.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="46743""></a>
  <div class="note">
   <strong class="user">amcnabb</strong>
   <a href="#46743" class="date">21-Oct-2004 11:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Be careful with types.&nbsp; PHP switches automatically between strings and numbers, but LDAP doesn't, and PHP will send whatever is most convenient for PHP, not LDAP, unless you specify a type.<br />
<br />
If you inadvertently send a number as a string, you will get an error: "ldap_add(): Add: Invalid syntax in [filename] on line LINENUM."<br />
<br />
Observe this example which makes an array to send to LDAP to create a POSIX group.&nbsp; Note that $new_groupid, which is technically a string, must be typecast with (int).<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; $new_ldap_group['cn'] = $groupname;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; $new_ldap_group['objectclass'][0] = 'posixgroup';<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; $new_ldap_group['objectclass'][1] = 'top';<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; $new_ldap_group['gidnumber'] = (int) $new_groupid;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="46247""></a>
  <div class="note">
   <strong class="user">spam2004 at turniton dot dk</strong>
   <a href="#46247" class="date">04-Oct-2004 01:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To add a group in Windows AD..<br />
$object_name="testgroup2";<br />
$members[]="CN=THU,ou=Users,dc=addomain,dc=domain,dc=dk";<br />
$members[]="CN=testgroup2,ou=Groups,dc=addomain,dc=domain,dc=dk";<br />
$addgroup_ad['cn']="$object_name";<br />
$addgroup_ad['objectClass'][0] = "top";<br />
$addgroup_ad['objectClass'][1] ="group";<br />
$addgroup_ad['descripton']=$object_description;<br />
$addgroup_ad['member']=$members;<br />
$addgroup_ad["sAMAccountName"] =$object_name;<br />
<br />
// notice param 2 (dn) will probably be different<br />
$dn="cn=".$object_name.",ou=Groups,dc=addomain,dc=domain,dc=dk";<br />
ldap_add($ldapc,$dn,$addgroup_ad);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="38999""></a>
  <div class="note">
   <strong class="user">ondrej dot duchon at t-systems dot cz</strong>
   <a href="#38999" class="date">14-Jan-2004 03:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
IF you need use national characters (iso 8859-2,8 etc.) it's good way to use&nbsp; ldap_set_option.<br />
It was hard job to find where is a bug ;-))). I hope that helps somebody.<br />
<br />
&nbsp;ldap_set_option($ldap, LDAP_OPT_PROTOCOL_VERSION, 3);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="38990""></a>
  <div class="note">
   <strong class="user">ondrej dot duchon at t-systems dot cz</strong>
   <a href="#38990" class="date">14-Jan-2004 01:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
jharnett at artschool dot com:<br />
For active user in AD u must change "useraccountcontrol" to 512, 512 = enabled, 514 = disabled</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="36075""></a>
  <div class="note">
   <strong class="user">Andrew (a.whyte at cqu.edu.au)</strong>
   <a href="#36075" class="date">25-Sep-2003 04:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In reference to the questions about Account Enabling, you can use the table found at Microsoft's Support site to help with these attributes.<br />
<br />
You are correct that '2' is the Account Disabled flag, but there are others, which allow you to detect/set password force expiry and the like.<br />
<br />
Hope this URL is usefull for that:<br />
<br />
<a href="http://support.microsoft.com/default.aspx?scid=kb;en-us;305144" rel="nofollow" target="_blank">http://support.microsoft.com/default.aspx?scid=kb;en-us;305144</a><br />
<br />
Cheers.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="32187""></a>
  <div class="note">
   <strong class="user">John Van Atta</strong>
   <a href="#32187" class="date">20-May-2003 03:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In response to jharnett's question about accounts disabled by default from ldap_add, we have found a solution. <br />
<br />
The attribute userAccountControl contains a value that includes whether the account is disabled or enabled. The default for us is 546; when we changed that to 544 the account became enabled. Changing whatever value is in userAccountControl by 2 seems to enable or disable the account.<br />
<br />
The following code worked for us to create a new user with an enabled account:<br />
<br />
$adduserAD["userAccountControl"] = "544";<br />
<br />
We just added this element to the above example's array.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="30023""></a>
  <div class="note">
   <strong class="user">Axel D. (FRANCE)</strong>
   <a href="#30023" class="date">04-Mar-2003 05:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Try this script if you don't know how to add an user in the AD Win2K.<br />
To have more informations about the attributes, open the adsiedit console in the Support Tools for Win2K.<br />
<br />
$adduserAD["cn"][0] = <br />
$adduserAD["instancetype"][0] = <br />
$adduserAD["samaccountname"][0] = <br />
$adduserAD["objectclass"][0] = "top";<br />
$adduserAD["objectclass"][1] = "person";<br />
$adduserAD["objectclass"][2] = "organizationalPerson";<br />
$adduserAD["objectclass"][3] = "user";<br />
$adduserAD["displayname"][0] = <br />
$adduserAD["name"][0] = <br />
$adduserAD["givenname"][0] = <br />
$adduserAD["sn"][0] = <br />
$adduserAD["company"][0] =<br />
$adduserAD["department"][0] = <br />
$adduserAD["title"][0] = <br />
$adduserAD["description"][0] = <br />
$adduserAD["mail"][0] = <br />
$adduserAD["initials"][0] = <br />
$adduserAD["samaccountname"][0] = <br />
$adduserAD["userprincipalname"][0] = <br />
$adduserAD["profilepath"][0] =<br />
$adduserAD["manager"][0] = ***Use DistinguishedName***<br />
<br />
if (!($ldap = ldap_connect("localhost"))) { <br />
&nbsp;&nbsp; &nbsp; die ("Could not connect to LDAP server"); <br />
}<br />
if (!($res = @ldap_bind($ldap, "user@pc.com", $password))) { <br />
&nbsp;&nbsp; &nbsp; die ("Could not bind to the LDAP account"); <br />
}<br />
if (!(ldap_add($ldap, "CN=New User,OU=OU Users,DC=pc,DC=com", $adduserAD))){<br />
&nbsp;&nbsp; &nbsp; echo "There is a problem to create the account<br />
&nbsp;&nbsp; &nbsp; echo "Please contact your administrator !";<br />
&nbsp;&nbsp; &nbsp; exit;<br />
}<br />
ldap_unbind($ldap);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="26216""></a>
  <div class="note">
   <strong class="user">jharnett at artschool dot com</strong>
   <a href="#26216" class="date">22-Oct-2002 11:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For some wacky reason, when the new account is added using ldap_add(), the account is set to "inactive".<br />
And from what I can see there is no modifiable attribute to "re-enable" that user. I suppose by default, if the specific flags are not set the default values are used. Anyone that has a fix for this, please post, I'm pulling out what little hair I have left.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="22583""></a>
  <div class="note">
   <strong class="user">del at babel dot com dot au</strong>
   <a href="#22583" class="date">24-Jun-2002 06:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you need to add an attribute that is binary encoded (eg: userCertificate), then you need to add the ";binary" specification at the end of the field name.<br />
<br />
eg:<br />
<br />
$info["userCertificate;binary"] = $myBinaryCert;<br />
$ldap_add ...<br />
<br />
Del</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="15167""></a>
  <div class="note">
   <strong class="user">titus dot stahl at experts4 dot com</strong>
   <a href="#15167" class="date">30-Aug-2001 03:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that you cannot use base64 encoding, you have to use utf-8 encoding for special chars instead.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="1606""></a>
  <div class="note">
   <strong class="user">akohlsmith at mixdown dot org</strong>
   <a href="#1606" class="date">13-Sep-1999 01:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
ldap_add() will only honour the $entry["attribute"][x]="value" *if there are multiple values for the attribute*.&nbsp; If there is only one attribute value, it *MUST* be entered as $entry["attribute"]="value" or ldap_add() sets the value for the attribute to be "Array" instead of what you put into $entry["attribute"][0].
<br />

<br />
Here is a little routine I wrote up to do this automatically.&nbsp; when you're parsing the input, just use multi_add():
<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">multi_add</span><span class="keyword">(</span><span class="default">$attribute</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">)
<br />
{
<br />
&nbsp;global </span><span class="default">$entry</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// the LDAP entry you're gonna add
<br />

<br />
&nbsp;</span><span class="keyword">if(isset(</span><span class="default">$entry</span><span class="keyword">[</span><span class="default">$attribute</span><span class="keyword">]))
<br />
&nbsp;&nbsp; if(</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$entry</span><span class="keyword">[</span><span class="default">$attribute</span><span class="keyword">]))
<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$entry</span><span class="keyword">[</span><span class="default">$attribute</span><span class="keyword">][</span><span class="default">count</span><span class="keyword">(</span><span class="default">$entry</span><span class="keyword">[</span><span class="default">$attribute</span><span class="keyword">])] = </span><span class="default">$value</span><span class="keyword">;
<br />
&nbsp;&nbsp; else
<br />
&nbsp;&nbsp; &nbsp; {
<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$tmp </span><span class="keyword">= </span><span class="default">$entry</span><span class="keyword">[</span><span class="default">$attribute</span><span class="keyword">];
<br />
&nbsp;&nbsp; &nbsp; unset(</span><span class="default">$entry</span><span class="keyword">[</span><span class="default">$attribute</span><span class="keyword">]);
<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$entry</span><span class="keyword">[</span><span class="default">$attribute</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">] = </span><span class="default">$tmp</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$entry</span><span class="keyword">[</span><span class="default">$attribute</span><span class="keyword">][</span><span class="default">1</span><span class="keyword">] = </span><span class="default">$value</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; }
<br />
&nbsp;else
<br />
&nbsp;&nbsp; </span><span class="default">$entry</span><span class="keyword">[</span><span class="default">$attribute</span><span class="keyword">] = </span><span class="default">$value</span><span class="keyword">;
<br />
}
<br />
</span><span class="default">?&gt;
<br />
</span>multi_add() checks to see if there is already a value for the attribute.&nbsp; if not, it adds it as $entry[$attribute]=$value.&nbsp; If there is already a value for the attribute, it converts the attribute to an array and adds the multiple values correctly.
<br />

<br />
How to use it:
<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">switch(</span><span class="default">$form_data_name</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp;&nbsp; case </span><span class="string">'phone'</span><span class="keyword">: </span><span class="default">multi_add</span><span class="keyword">(</span><span class="string">"telephoneNumber"</span><span class="keyword">, </span><span class="default">$form_data_value</span><span class="keyword">); break;
<br />
&nbsp;&nbsp; &nbsp;&nbsp; case </span><span class="string">'fax'</span><span class="keyword">: </span><span class="default">multi_add</span><span class="keyword">(</span><span class="string">"facsimileTelephoneNumber"</span><span class="keyword">, </span><span class="default">$form_data_value</span><span class="keyword">); break;
<br />
&nbsp;&nbsp; &nbsp;&nbsp; case </span><span class="string">'email'</span><span class="keyword">: </span><span class="default">multi_add</span><span class="keyword">(</span><span class="string">"mail"</span><span class="keyword">, </span><span class="default">$form_data_value</span><span class="keyword">); break;
<br />
&nbsp;&nbsp; &nbsp;&nbsp; ...
<br />
&nbsp;&nbsp; &nbsp;&nbsp; }
<br />
</span><span class="default">?&gt;
<br />
</span>In the system I designed the form has pulldowns with names ctype1, ctype2, ctype3, etc. and the values are "fax, mail, phone...".&nbsp; The actual contact data (phone number, fax, email, etc) is contact1, contact2, contact3, etc.&nbsp; The user pulls down what the contact type is (phone, email) and then enters the data (number, address, etc.)
<br />

<br />
I use variable variables to fill the entry and skip blanks.&nbsp; Makes for a very clean form entry system.&nbsp; email me if you're interested in it, as I think I'm outgrowing the size of note allowed here.&nbsp; :-)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
