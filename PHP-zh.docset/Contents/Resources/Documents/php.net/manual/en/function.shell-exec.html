<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>通过 shell 环境执行命令，并且将完整的输出以字符串的方式返回。</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.proc-terminate.html">? proc_terminate</a></li>
      <li style="float: right;"><a href="function.system.html">system ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.exec.html">程序执行 函数</a></li>
    <li>通过 shell 环境执行命令，并且将完整的输出以字符串的方式返回。</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.shell-exec" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">shell_exec</h1>
  <p class="verinfo">(PHP 4, PHP 5)</p><p class="refpurpose"><span class="refname">shell_exec</span> &mdash; <span class="dc-title">通过 shell 环境执行命令，并且将完整的输出以字符串的方式返回。</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-function.shell-exec-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">string</span> <span class="methodname"><strong>shell_exec</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$cmd</code></span>
   )</div>

  <p class="para rdfs-comment">
   本函数同 <a href="language.operators.execution.html" class="link">执行操作符</a>。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.shell-exec-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">cmd</code></dt>

     <dd>

      <p class="para">
       要执行的命令。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.shell-exec-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
    命令执行的输出。
    如果执行过程中发生错误或者进程不产生输出，则返回 <strong><code>NULL</code></strong>。
  </p>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    当进程执行过程中发生错误，或者进程不产生输出的情况下，都会返回 <strong><code>NULL</code></strong>，
    所以，使用本函数无法通过返回值检测进程是否成功执行。
    如果需要检查进程执行的退出码，请使用 <span class="function"><a href="function.exec.html" class="function">exec()</a></span> 函数。
   </p>
  </p></blockquote>
 </div>


 <div class="refsect1 examples" id="refsect1-function.shell-exec-examples">
  <h3 class="title">范例</h3>
  <p class="para">
   <div class="example" id="example-3670">
    <p><strong>Example #1 <span class="function"><strong>shell_exec()</strong></span> 例程</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$output&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">shell_exec</span><span style="color: #007700">(</span><span style="color: #DD0000">'ls&nbsp;-lart'</span><span style="color: #007700">);<br />echo&nbsp;</span><span style="color: #DD0000">"&lt;pre&gt;</span><span style="color: #0000BB">$output</span><span style="color: #DD0000">&lt;/pre&gt;"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 notes" id="refsect1-function.shell-exec-notes">
  <h3 class="title">注释</h3>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    当 PHP 运行在 <a href="features.safe-mode.html" class="link">安全模式</a> 时，不能使用此函数。
   </p>
  </p></blockquote>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.shell-exec-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.exec.html" class="function" rel="rdfs-seeAlso">exec()</a> - 执行一个外部程序</span></li>
    <li class="member"><span class="function"><a href="function.escapeshellcmd.html" class="function" rel="rdfs-seeAlso">escapeshellcmd()</a> - shell 元字符转义</span></li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="115702""></a>
  <div class="note">
   <strong class="user">jack dot harris-7ot2j4ip at yopmail dot Com</strong>
   <a href="#115702" class="date">11-Sep-2014 10:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
On Windows, if shell_exec does NOT return the result you expected and the PC is on an enterprise network, set the Apache service (or wampapache) to run under your account instead of the 'Local system account'. Your account must have admin privileges.<br />
<br />
To change the account go to console services, right click on the Apache service, choose properties, and select the connection tab.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="114870""></a>
  <div class="note">
   <strong class="user">xxxpaul1104xxx at gmail dot com</strong>
   <a href="#114870" class="date">18-Apr-2014 12:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
//wish this could help for handle the shell_exec() output strings where "\n" that looks like a " " space.<br />
//ex:<br />
$configPath = "/home/somewhere";<br />
$configList = shell_exec("ls $configPath/123.*.cfg"); // output is "/home/somewhere/123.111.cfg /home/somewhere/123.112.cfg"<br />
// there looks like a "space" between output strings, but that's a "\n" actually.<br />
$nodeList = trim(str_replace("\n",",",str_replace("$configPath/","",str_replace(".cfg","",$configList))));&nbsp; // get "123.111,123.112"</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="110480""></a>
  <div class="note">
   <strong class="user">ptitjib at hotmail dot fr</strong>
   <a href="#110480" class="date">26-Oct-2012 07:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Run shell_exec powershell on IIS 7, PHP-Fast-CGI:<br />
First of all, make sure you have set TPC protocol in IIS FastCGI Settings.<br />
Next you can run shell_exec command as:<br />
$output = shell_exec('powershell get-process &lt; NUL');<br />
echo $output;<br />
Hope this help.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="109693""></a>
  <div class="note">
   <strong class="user">wally at soggysoftware dot co dot uk</strong>
   <a href="#109693" class="date">10-Aug-2012 08:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As others have noted, shell_exec and the backtick operator (`) both return NULL if the executed command doesn't output anything.<br />
<br />
This can be worked around by doing anything like the following:<br />
<br />
shell_exec ("silentcmd &amp;&amp; echo ' '");<br />
<br />
Here we're simply outputting blank whitespace if&nbsp; the command succeeds - which satisfies this slightly strange issue.&nbsp; From there, you can trim() the command output etc.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="106250""></a>
  <div class="note">
   <strong class="user">trev at dedicate.co.uk</strong>
   <a href="#106250" class="date">21-Oct-2011 04:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you're trying to run a command such as "gunzip -t" in shell_exec and getting an empty result, you might need to add 2&gt;&amp;1 to the end of the command, eg:<br />
<br />
Won't always work:<br />
echo shell_exec("gunzip -c -t $path_to_backup_file");<br />
<br />
Should work:<br />
echo shell_exec("gunzip -c -t $path_to_backup_file 2&gt;&amp;1");<br />
<br />
In the above example, a line break at the beginning of the gunzip output seemed to prevent shell_exec printing anything else. Hope this saves someone else an hour or two.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="101440""></a>
  <div class="note">
   <strong class="user">ilya at linemedia dot ru</strong>
   <a href="#101440" class="date">16-Dec-2010 05:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
sudo can be executed without storing pass in a file<br />
<br />
system('echo "PASS" | sudo -u root -S COMMAND');</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100703""></a>
  <div class="note">
   <strong class="user">fabjoa dot mwoz at gmail dot com</strong>
   <a href="#100703" class="date">01-Nov-2010 01:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I don't know how it goes in Windows, but in Linux, shell returns result with a line break at the end, I guess to make it more readable in shell, so don't forget to use trim() to encapsulate the returned result!<br />
<br />
if(trim(shell_exec('whoami'))!='www-data')</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="96422""></a>
  <div class="note">
   <strong class="user">nowayoutlive.de</strong>
   <a href="#96422" class="date">26-Feb-2010 10:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Today I needed a piece of code, which makes use of the shell_exec function. For those who want to scan 2 letter domains too, here is a nice linux and php5 way, using a character generator class.<br />
<br />
<span class="default">&lt;?php<br />
define</span><span class="keyword">(</span><span class="string">"__USED_CHARS__"</span><span class="keyword">, </span><span class="string">"abcdefghijklmnopqrstuvwxyz0123456789"</span><span class="keyword">);<br />
</span><span class="default">define</span><span class="keyword">(</span><span class="string">"__CASE_SENSITIVE__"</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">); </span><span class="comment">// Use string above or use uppercase / lowercase variant<br />
<br />
</span><span class="default">$bf </span><span class="keyword">= new </span><span class="default">chargen</span><span class="keyword">(</span><span class="default">2</span><span class="keyword">); </span><span class="comment">// new chargen object, length 2<br />
</span><span class="default">$bf</span><span class="keyword">-&gt;</span><span class="default">generate</span><span class="keyword">(</span><span class="string">"whois"</span><span class="keyword">); </span><span class="comment">// generate chars and call whois function<br />
<br />
</span><span class="keyword">function </span><span class="default">whois</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$domain </span><span class="keyword">= </span><span class="default">$str</span><span class="keyword">.</span><span class="string">".com"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$retval </span><span class="keyword">= </span><span class="default">shell_exec</span><span class="keyword">(</span><span class="string">"whois </span><span class="default">$domain</span><span class="string">"</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">eregi</span><span class="keyword">(</span><span class="string">"no match"</span><span class="keyword">, </span><span class="default">$retval</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">$domain</span><span class="keyword">.</span><span class="string">" ist available\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">$domain</span><span class="keyword">.</span><span class="string">" is unavailable\n"</span><span class="keyword">;<br />
}<br />
<br />
class </span><span class="default">chargen<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; private </span><span class="default">$chars </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; private </span><span class="default">$maxlength </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; protected </span><span class="default">$buffer </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; function </span><span class="default">generate</span><span class="keyword">(</span><span class="default">$mycallback </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">buffer </span><span class="keyword">as </span><span class="default">$char</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">chars </span><span class="keyword">as </span><span class="default">$nextchar</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$retval </span><span class="keyword">= </span><span class="default">$char</span><span class="keyword">.</span><span class="default">$nextchar</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">buffer</span><span class="keyword">[</span><span class="default">$retval</span><span class="keyword">] = </span><span class="default">$retval</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$mycallback </span><span class="keyword">&amp;&amp; </span><span class="default">function_exists</span><span class="keyword">(</span><span class="default">$mycallback</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$mycallback</span><span class="keyword">(</span><span class="default">$retval</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">$retval</span><span class="keyword">.</span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$retval</span><span class="keyword">) == </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">maxlength</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">generate</span><span class="keyword">(</span><span class="default">$mycallback</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$maxlength </span><span class="keyword">= </span><span class="default">8</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$chars </span><span class="keyword">= array();<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">buffer </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">array_push</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">buffer</span><span class="keyword">, </span><span class="string">""</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">__USED_CHARS__</span><span class="keyword">); </span><span class="default">$i</span><span class="keyword">++)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$index </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">__USED_CHARS__</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">__CASE_SENSITIVE__</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">chars</span><span class="keyword">[</span><span class="default">$index</span><span class="keyword">] = </span><span class="default">$index</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">chars</span><span class="keyword">[</span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">$index</span><span class="keyword">)] = </span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">$index</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">chars</span><span class="keyword">[</span><span class="default">strtoupper</span><span class="keyword">(</span><span class="default">$index</span><span class="keyword">)] = </span><span class="default">strtoupper</span><span class="keyword">(</span><span class="default">$index</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">maxlength </span><span class="keyword">= </span><span class="default">$maxlength</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="96249""></a>
  <div class="note">
   <strong class="user">martin at intelli-gens dot com</strong>
   <a href="#96249" class="date">17-Feb-2010 12:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Also after lots of hair pulling why shell_exec didn't want to work for me I found out that in my case some things needed to be set (which normally are set by default).<br />
<br />
the options -jo&nbsp; <br />
-j means: don't recreate the paths found in the archive<br />
-o means: always overwrite files<br />
<br />
And I needed to specify the destination path (even though it should unzip in the same directory when not specified), this is done by -d [path]<br />
<br />
The strange thing was that I didn't have to put these options when I would give the command on the command-line, only when I would call it with shell_exec.<br />
<br />
So the complete command in php would be for me:<br />
<br />
shell_exec('unzip -jo /path_to_archive/archive.zip&nbsp; -d /destination_path')<br />
<br />
And putting en echo in front will help you a lot.<br />
it should tell you something like this:<br />
&nbsp;&nbsp; &nbsp; <br />
<br />
Archive:&nbsp; /path_to_zip/archive.zip<br />
&nbsp; inflating: /destination_path/file1.jpeg&nbsp; <br />
&nbsp; inflating: /destination_path/file2.jpeg<br />
&nbsp; inflating: /destination_path/file3.jpeg</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="95651""></a>
  <div class="note">
   <strong class="user">codeslinger at compsalot dot com</strong>
   <a href="#95651" class="date">14-Jan-2010 03:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
it took me a heck of a lot of head banging to finally solve this problem so I thought that I would mention it here.<br />
<br />
If you are using Eclipse and you try to do something like<br />
<br />
<span class="default">&lt;?php<br />
<br />
&nbsp;&nbsp;&nbsp; $out </span><span class="keyword">= </span><span class="default">shell_exec</span><span class="keyword">(</span><span class="string">"php -s </span><span class="default">$File</span><span class="string">"</span><span class="keyword">);&nbsp;&nbsp; </span><span class="comment">//this fails <br />
</span><span class="default">?&gt;<br />
</span><br />
it will always fail when run inside of the Eclipse debugger.&nbsp; This happens on both Linux and Windows.&nbsp; I finally isolated the problem to changes that Eclipse makes to the environment when debugging.&nbsp;&nbsp; <br />
<br />
The fix is to force the ini setting.&nbsp; If you don't need an ini then -n is sufficient.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; $out </span><span class="keyword">= </span><span class="default">shell_exec</span><span class="keyword">(</span><span class="string">"php -n -s </span><span class="default">$File</span><span class="string">"</span><span class="keyword">);&nbsp;&nbsp; </span><span class="comment">//this works<br />
</span><span class="default">?&gt;<br />
</span><br />
Of course if you run it outside of the debugger then it works fine without the -n.&nbsp;&nbsp; You may want to use a debug flag to control this behavior.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="90176""></a>
  <div class="note">
   <strong class="user">joelhy</strong>
   <a href="#90176" class="date">09-Apr-2009 03:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is a easy way to grab STDERR and discard STDOUT:<br />
&nbsp;&nbsp;&nbsp; add&nbsp; '2&gt;&amp;1 1&gt; /dev/null' to the end of your shell command<br />
<br />
For example:<br />
<span class="default">&lt;?php<br />
$output </span><span class="keyword">= </span><span class="default">shell_exec</span><span class="keyword">(</span><span class="string">'ls file_not_exist 2&gt;&amp;1 1&gt; /dev/null'</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="88621""></a>
  <div class="note">
   <strong class="user">dburles@NOSPAMgmailDOTcom</strong>
   <a href="#88621" class="date">01-Feb-2009 12:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Easy way to capture error output in windows<br />
<br />
// we'll execute a php script as an example:<br />
$out = shell_exec("php test.php 2&gt; output");<br />
print $out ? $out : join("", file("output"));<br />
<br />
We assume in this case if the script produces output it has ran ok, the $out variable will then contain the output, if $out is empty then we read the captured error output from a file simply called 'output'.<br />
<br />
Hope this helps someone</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="88239""></a>
  <div class="note">
   <strong class="user">zd</strong>
   <a href="#88239" class="date">16-Jan-2009 07:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It's probably worth noting that shell_exec() return value seems binary safe, while the output array from exec() is not.<br />
<br />
In either case, a more controlled way to launch and interact with a process is proc_open() which allows you to have streams and is also binary safe.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="88052""></a>
  <div class="note">
   <strong class="user">Rgemini</strong>
   <a href="#88052" class="date">08-Jan-2009 12:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A simple way to handle the problem of capturing stderr output when using shell-exec under windows is to call ob_start() before the command and ob_end_clean() afterwards, like this:<br />
<br />
<span class="default">&lt;?php<br />
ob_start</span><span class="keyword">()<br />
</span><span class="default">$dir </span><span class="keyword">= </span><span class="default">shell_exec</span><span class="keyword">(</span><span class="string">'dir B:'</span><span class="keyword">);<br />
if </span><span class="default">is_null</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">)<br />
{&nbsp;&nbsp; </span><span class="comment">// B: does not exist<br />
&nbsp;&nbsp;&nbsp; // do whatever you want with the stderr output here<br />
</span><span class="keyword">}<br />
else<br />
{&nbsp; </span><span class="comment">// B: exists and $dir holds the directory listing<br />
&nbsp;&nbsp; // do whatever you want with it here<br />
</span><span class="keyword">}<br />
</span><span class="default">ob_end_clean</span><span class="keyword">();&nbsp;&nbsp; </span><span class="comment">// get rid of the evidence :-)<br />
</span><span class="default">?&gt;<br />
</span><br />
If B: does not exist then $dir will be Null and the output buffer will have captured the message: <br />
<br />
&nbsp; 'The system cannot find the path specified'. <br />
<br />
(under WinXP, at least). If B: exists then $dir will contain the directory listing and we probably don't care about the output buffer. In any case it needs to be deleted before proceeding.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="87800""></a>
  <div class="note">
   <strong class="user">dae3</strong>
   <a href="#87800" class="date">22-Dec-2008 11:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Beware of the following inconsistency: shell_exec() and the backtick operator will not return a string if the command's output is empty -- they'll return NULL instead.<br />
<br />
This will make strict comparisons to '' return false.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86956""></a>
  <div class="note">
   <strong class="user">redtuugii at yahoo dot com</strong>
   <a href="#86956" class="date">12-Nov-2008 12:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
if you want get exit status
<br />

<br />
<span class="default">&lt;?php
<br />
$command </span><span class="keyword">= </span><span class="string">'ls -lpas'</span><span class="keyword">;
<br />
</span><span class="comment">// Execute the shell command
<br />
</span><span class="default">$shellOutput </span><span class="keyword">= </span><span class="default">shell_exec</span><span class="keyword">(</span><span class="default">$command</span><span class="keyword">.</span><span class="string">' &gt; /dev/null; echo $?'</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; 
<br />
</span><span class="comment">//return execute status;
<br />
</span><span class="keyword">echo </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$shellOutput</span><span class="keyword">);
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85111""></a>
  <div class="note">
   <strong class="user">sa577 at gre dot ac dot uk</strong>
   <a href="#85111" class="date">15-Aug-2008 01:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The problem described by 'concept at conceptonline dot hu' was mine too (writing the output on the Apache error log instead of returning it). But I think the cause explanation is misleading: it is not due to running script in a different path. The clue for this behaviour as Apache documentation mention is:<br />
<br />
"A very wide variety of different messages can appear in the error log. Most look similar to the example above. The error log will also contain debugging output from CGI scripts. Any information written to &lt;i&gt;stderr&lt;/i&gt; by a CGI script will be copied directly to the error log." (<a href="http://httpd.apache.org/docs/1.3/logs.html#errorlog" rel="nofollow" target="_blank">http://httpd.apache.org/docs/1.3/logs.html#errorlog</a>)<br />
<br />
So the most probable cause for this problem is a running script which tends to write its output on stderr instead of stdout. You cannot even capture it by piping (e.g. [command]&gt;[output] syntax of unix).<br />
The smart trick to get rid of this situation (that can become a serious one as I experienced) is one suggested by Anatol Pomozov in his currently non-accessible weblog (I saw his post on archive.com!):<br />
You should add after your command these characters within the qoutation mark:<br />
" 2&gt;&amp;1"<br />
I guess it forces OS to copy stderr on stdout.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84992""></a>
  <div class="note">
   <strong class="user">ben at thelocust dot org</strong>
   <a href="#84992" class="date">08-Aug-2008 07:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For those running PHP on IIS under a 64-bit system, but running IIS in 32-bit mode, you will need to grant the IUSR_&lt;machinename&gt; user Read &amp; Execute / Read permissions not on the C:\WINDOWS\SYSTEM32\cmd.exe file, but instead on the C:\WINDOWS\SysWOW64\cmd.exe - which is the 32-bit version of the command prompt.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83151""></a>
  <div class="note">
   <strong class="user">saivert at saivert dot com</strong>
   <a href="#83151" class="date">13-May-2008 05:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
How to get the volume label of a drive on Windows<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">GetVolumeLabel</span><span class="keyword">(</span><span class="default">$drive</span><span class="keyword">) {<br />
&nbsp; </span><span class="comment">// Try to grab the volume name<br />
&nbsp; </span><span class="keyword">if (</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'#Volume in drive [a-zA-Z]* is (.*)\n#i'</span><span class="keyword">, </span><span class="default">shell_exec</span><span class="keyword">(</span><span class="string">'dir '</span><span class="keyword">.</span><span class="default">$drive</span><span class="keyword">.</span><span class="string">':'</span><span class="keyword">), </span><span class="default">$m</span><span class="keyword">)) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$volname </span><span class="keyword">= </span><span class="string">' ('</span><span class="keyword">.</span><span class="default">$m</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">].</span><span class="string">')'</span><span class="keyword">;<br />
&nbsp; } else {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$volname </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp; }<br />
return </span><span class="default">$volname</span><span class="keyword">;<br />
}<br />
<br />
print </span><span class="default">GetVolumeLabel</span><span class="keyword">(</span><span class="string">"c"</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Note: The regular expression assumes a english version of Windows is in use. modify it accordingly for a different localized copy of Windows.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82370""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#82370" class="date">08-Apr-2008 05:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In response to nathandehert and Paul Cook, rather than sudoing to execute a command, you might want to abstract the command(s) into a yet another script (php, perl, bash, whatever) and make use of the setuid bit.&nbsp; then just execute that script from php.&nbsp; of course, bear in mind the security implications of setuid.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82278""></a>
  <div class="note">
   <strong class="user">gabekon at gmail dot com</strong>
   <a href="#82278" class="date">03-Apr-2008 05:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
RE: kamermans note,<br />
<br />
I was having a similar problem with the PATH variable when using shell_exec. Even with a hard-coded full path to a binary, I also got an error about a .so file that could not be found. After some reading up, I realized I had to set the LD_LIBRARY_PATH variable:<br />
<br />
<span class="default">&lt;?php<br />
<br />
$command </span><span class="keyword">= </span><span class="string">'export LD_LIBRARY_PATH="' </span><span class="keyword">. </span><span class="default">$path_to_library_dir </span><span class="keyword">.</span><span class="string">'"; ' </span><span class="keyword">. </span><span class="default">$path_to_binary</span><span class="keyword">;<br />
</span><span class="default">shell_exec</span><span class="keyword">(</span><span class="default">$command</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Hope this saves someone a headache,<br />
<br />
- G</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="80446""></a>
  <div class="note">
   <strong class="user">guenter at grodotzki dot ph</strong>
   <a href="#80446" class="date">16-Jan-2008 05:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If the return is empty, then command could not be executed or executed command returned an error.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="79061""></a>
  <div class="note">
   <strong class="user">RoBorg</strong>
   <a href="#79061" class="date">08-Nov-2007 04:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The Subversion error "svn: Can't recode string" can be caused by the locale being wrong.&nbsp; Try<br />
<span class="default">&lt;?php<br />
putenv</span><span class="keyword">(</span><span class="string">'LANG=en_US.UTF-8'</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span>(or whatever your preferred locale is) before you call shell_exec()</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="78506""></a>
  <div class="note">
   <strong class="user">kamermans at teratechnologies dot net</strong>
   <a href="#78506" class="date">15-Oct-2007 05:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I'm not sure what shell you are going to get with this function, but you can find out like this:<br />
<br />
<span class="default">&lt;?php<br />
$cmd </span><span class="keyword">= </span><span class="string">'set'</span><span class="keyword">;<br />
echo </span><span class="string">"&lt;pre&gt;"</span><span class="keyword">.</span><span class="default">shell_exec</span><span class="keyword">(</span><span class="default">$cmd</span><span class="keyword">).</span><span class="string">"&lt;/pre&gt;"</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
On my FreeBSD 6.1 box I get this:<br />
<br />
USER=root<br />
LD_LIBRARY_PATH=/usr/local/lib/apache2:<br />
HOME=/root<br />
PS1='$ '<br />
OPTIND=1<br />
PS2='&gt; '<br />
LOGNAME=root<br />
PPID=88057<br />
PATH=/etc:/bin:/sbin:/usr/bin:/usr/sbin<br />
SHELL=/bin/sh<br />
IFS='&nbsp; &nbsp;&nbsp; <br />
'<br />
<br />
Very interesting.&nbsp; Note that the PATH may not be as complete as you need.&nbsp; I wanted to run Ghostscript via ImageMagik's "convert" and ended up having to add my path before running the command:<br />
<br />
<span class="default">&lt;?php<br />
$cmd </span><span class="keyword">= </span><span class="string">'export PATH="/usr/local/bin/"; convert -scale 25%x25% file1.pdf[0] file2.png 2&gt;&amp;1'</span><span class="keyword">;<br />
echo </span><span class="string">"&lt;pre&gt;"</span><span class="keyword">.</span><span class="default">shell_exec</span><span class="keyword">(</span><span class="default">$cmd</span><span class="keyword">).</span><span class="string">"&lt;/pre&gt;"</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
ALSO, note that shell_exec() does not grab STDERR, so use "2&gt;&amp;1" to redirect it to STDOUT and catch it.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="78279""></a>
  <div class="note">
   <strong class="user">eric dot peyremorte at iut-valence dot fr</strong>
   <a href="#78279" class="date">05-Oct-2007 11:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I had trouble with accented caracters and shell_exec.<br />
<br />
ex :<br />
<br />
Executing this command from shell :<br />
<br />
/usr/bin/smbclient '//BREZEME/peyremor' -c 'dir' -U 'peyremor%*********' -d 0 -W 'ADMINISTRATIF' -O 'TCP_NODELAY IPTOS_LOWDELAY SO_KEEPALIVE SO_RCVBUF=8192 SO_SNDBUF=8192' -b 1200 -N 2&gt;&amp;1<br />
<br />
gave me that :<br />
<br />
Vidéos&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; D&nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; Tue Jun 12 14:41:21 2007<br />
&nbsp; Desktop&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DH&nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; Mon Jun 18 17:41:36 2007<br />
<br />
Using php like that :<br />
<br />
shell_exec("/usr/bin/smbclient '//BREZEME/peyremor' -c 'dir' -U 'peyremor%*******' -d 0 -W 'ADMINISTRATIF' -O 'TCP_NODELAY IPTOS_LOWDELAY SO_KEEPALIVE SO_RCVBUF=8192 SO_SNDBUF=8192' -b 1200 -N 2&gt;&amp;1")<br />
<br />
gave me that :<br />
<br />
&nbsp; Vid&nbsp; Desktop&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DH&nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; Mon Jun 18 17:41:36 2007<br />
<br />
The two lines were concatenated from the place where the accent was.<br />
<br />
I found the solution : php execute by default the command with LOCALE=C. <br />
<br />
I just added the following lines before shell_exec and the problem was solved :<br />
<br />
$locale = 'fr_FR.UTF-8';<br />
setlocale(LC_ALL, $locale);<br />
putenv('LC_ALL='.$locale);<br />
<br />
Just adapt it to your language locale.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76373""></a>
  <div class="note">
   <strong class="user">Woody/mC</strong>
   <a href="#76373" class="date">12-Jul-2007 04:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
regarding the "ping" test that was mentioned by andy25it at hotmail dot it:<br />
<br />
this might not work if the target server is behind a firewall which drops icmp packets. a better approach would be the use of fsockopen(), which doesn't use icmp. in the notes section of the function list, Alexander Wegener wrote a nice implementation of an isOnline() function which works with both http and https.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74378""></a>
  <div class="note">
   <strong class="user">d-skyman at gmx dot de</strong>
   <a href="#74378" class="date">08-Apr-2007 07:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Got it! That was a "how does the windows scripting host work" problem.<br />
Here's the answer:<br />
<span class="default">&lt;?php<br />
$runCommand </span><span class="keyword">= </span><span class="string">"C:\\WINDOWS\\system32\\shutdown.exe -t:30"</span><span class="keyword">; </span><span class="comment">//Wrong by purpuse to get some good output<br />
</span><span class="default">$WshShell </span><span class="keyword">= new </span><span class="default">COM</span><span class="keyword">(</span><span class="string">"WScript.Shell"</span><span class="keyword">);<br />
</span><span class="default">$output </span><span class="keyword">= </span><span class="default">$WshShell</span><span class="keyword">-&gt;</span><span class="default">Exec</span><span class="keyword">(</span><span class="default">$runCommand</span><span class="keyword">)-&gt;</span><span class="default">StdOut</span><span class="keyword">-&gt;</span><span class="default">ReadAll</span><span class="keyword">;<br />
echo </span><span class="string">"&lt;p&gt;</span><span class="default">$output</span><span class="string">&lt;/p&gt;"</span><span class="keyword">;<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73490""></a>
  <div class="note">
   <strong class="user">RayJ</strong>
   <a href="#73490" class="date">26-Feb-2007 06:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
After many failed attempts to find a way to run a php script in the background (the script had to be activated from a web browser). Since I create and test my scripts on a windows box, I need an automatic way to detect if the script was running on windows or the Linux server. The activated script will continue to run even if you close your browser.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp; $runCommand </span><span class="keyword">= </span><span class="string">'php -q FULLPATH/FILE.php'</span><span class="keyword">;<br />
<br />
&nbsp; if(isset(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PWD'</span><span class="keyword">])</span><span class="comment">//*nix (aka NOT windows)<br />
&nbsp; </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$nullResult </span><span class="keyword">= `</span><span class="default">$runCommand</span><span class="string"> &gt; /dev/null &amp;</span><span class="keyword">`;<br />
&nbsp; }<br />
&nbsp; else </span><span class="comment">//windowz<br />
&nbsp; </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$WshShell </span><span class="keyword">= new </span><span class="default">COM</span><span class="keyword">(</span><span class="string">"WScript.Shell"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$oExec </span><span class="keyword">= </span><span class="default">$WshShell</span><span class="keyword">-&gt;</span><span class="default">Run</span><span class="keyword">(</span><span class="default">$runCommand</span><span class="keyword">, </span><span class="default">7</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br />
&nbsp; }<br />
</span><span class="default">?&gt;<br />
</span><br />
Also, to get the correct "basepath" from the script that runs in the background. try:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp; ignore_user_abort</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br />
&nbsp; </span><span class="default">set_time_limit</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">);<br />
<br />
&nbsp; if(isset(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PWD'</span><span class="keyword">]))<br />
&nbsp; { </span><span class="default">$basepath </span><span class="keyword">= </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PWD'</span><span class="keyword">]; }<br />
&nbsp; else<br />
&nbsp; { </span><span class="default">$basepath </span><span class="keyword">= </span><span class="default">ereg_replace</span><span class="keyword">(</span><span class="string">'[^/]*$'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'PHP_SELF'</span><span class="keyword">]); }<br />
<br />
&nbsp; </span><span class="default">$extendedpath </span><span class="keyword">= </span><span class="string">'/path1/path2/'</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$basepath </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"|(?:</span><span class="keyword">{</span><span class="default">$extendedpath</span><span class="keyword">}</span><span class="string">)$|i"</span><span class="keyword">,</span><span class="string">''</span><span class="keyword">,</span><span class="default">$basepath</span><span class="keyword">);<br />
<br />
&nbsp; echo </span><span class="string">'Start In: '</span><span class="keyword">.</span><span class="default">$basepath</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
Enjoy!<br />
<br />
Later, RayJ</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="70817""></a>
  <div class="note">
   <strong class="user">arturm at union dot com dot pl</strong>
   <a href="#70817" class="date">29-Oct-2006 11:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If someone has problems with IIS6 and CGI error message "The specified CGI application misbehaved by not returning a complete set of HTTP headers.", simply make sure that headers are already sent:<br />
echo "&lt;head&gt;";<br />
flush();<br />
$result = shell_exec('C:\util\myprog.exe');</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="70338""></a>
  <div class="note">
   <strong class="user">kees dot schepers at infolook dot nl</strong>
   <a href="#70338" class="date">12-Oct-2006 02:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are using a Windows server with IIS, and you try to execture a batch file with shell_exec() function, or his related functions you should do it like this:<br />
<br />
&lt;?<br />
shell_exec("C:\\path\\to\\cmd.exe /c C:\\batchfile.cmd");<br />
?&gt;<br />
<br />
Note the parameter /c which says "Carries out the ommand specified by string and then terminates"<br />
<br />
If you don't add the parameter /c the batch file will not be executed, only the cmd.exe file will.<br />
<br />
As, also mentiod in these commants, put your cmd.exe file in your php folder, and your windows folder for security reasons.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69706""></a>
  <div class="note">
   <strong class="user">Paul Cook</strong>
   <a href="#69706" class="date">16-Sep-2006 08:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The technique mentioned by Nathan De Hert below is rather insecure -- you should never leave a password lying around in a file readable by the apache user.<br />
<br />
If you need this sort of functionality on *nix systems, have a look at the /etc/sudo file (edited with the command 'visudo'). The tag NOPASSWD allows specified commands to be run as root by another user, without needing to specify a password. It's a little extra configuration, but much more secure.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69160""></a>
  <div class="note">
   <strong class="user">ruan at nospam dot tillcor dot com</strong>
   <a href="#69160" class="date">25-Aug-2006 05:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When following Kenneth's method for executing root scripts via the nanoweb server mentioned on this page you would most likely need to be able to run a text-mode browser like lynx and pass the php script to it (works great).<br />
<br />
After struggling for a while (lynx kept asking me to download the file instead of executing it), I realised that I had to install php-cgi additionally and modify the nanoweb config file&nbsp; to use that php interpreter instead of /usr/bin/php. (On Debian this is the CLI version).<br />
<br />
On Ubuntu 6.06:<br />
<br />
apt-get install php5-cgi<br />
<br />
After editing /etc/nanoweb/nanoweb.conf and a quick restart of the web server, lynx and links will execute your PHP scripts properly.<br />
<br />
Hope this helps somebody else out there :)<br />
<br />
Ruan Fourie</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68647""></a>
  <div class="note">
   <strong class="user">Kishan</strong>
   <a href="#68647" class="date">04-Aug-2006 07:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are on windows and has Cygwin, You can execute all your Cygwin binaries using shell_exec() as follows:<br />
<br />
&lt;?<br />
$result = shell_exec("C:\cygwin\bin\bash.exe --login&nbsp; -c '/cygdrive/c/cygwin/bin/convert.exe --version'");<br />
print($result);<br />
?&gt;<br />
<br />
The key is the "--login"&nbsp; option which appends all the required common cygwin binary and library paths to $PATH. Without this option some of the cygwin binaries that links to other libraries ( Like ImageMagick binaries which links to X11 ) will not work and you may see errors like "cygX11-6.dll not found, Could not start convert.exe"</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68589""></a>
  <div class="note">
   <strong class="user">doo_mangle_fus at by_mangle_u dizzot net</strong>
   <a href="#68589" class="date">02-Aug-2006 09:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you're on a host that provides neither shell access nor a way to unzip uploaded archives, you can use PHP to call the unzip utility with shell_exec() (provided they're not also running in safe mode). Just make sure that PHP has write permission to the destination directory, or it won't work.<br />
<br />
Here's an example script that accomplishes this, which you're free to use if you so chose:<br />
<br />
<span class="default">&lt;?php<br />
$passwd </span><span class="keyword">= </span><span class="string">'censored'</span><span class="keyword">;<br />
</span><span class="default">$filename </span><span class="keyword">= </span><span class="string">'archive.zip'</span><span class="keyword">;<br />
</span><span class="default">$options </span><span class="keyword">= </span><span class="string">'-o'</span><span class="keyword">;&nbsp; </span><span class="comment">//Overwrite existing files by default; this is mostly to suppress confirmations<br />
</span><span class="default">$destDir </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
<br />
if (isset (</span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'password'</span><span class="keyword">]))&nbsp; {<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'password'</span><span class="keyword">] == </span><span class="default">$passwd</span><span class="keyword">)&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (isset (</span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'filename'</span><span class="keyword">]))&nbsp; { </span><span class="default">$filename </span><span class="keyword">= </span><span class="default">escapeshellarg </span><span class="keyword">(</span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'filename'</span><span class="keyword">]); }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (isset (</span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'updateExisting'</span><span class="keyword">]))&nbsp; { </span><span class="default">$options </span><span class="keyword">.= </span><span class="string">"u"</span><span class="keyword">; }&nbsp; </span><span class="comment">//use with care, since a timezone mismatch may occur; see man unzip<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (isset (</span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'destDir'</span><span class="keyword">]))&nbsp; { </span><span class="default">$destDir </span><span class="keyword">= </span><span class="string">' -d '</span><span class="keyword">. </span><span class="default">escapeshellarg </span><span class="keyword">(</span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'destDir'</span><span class="keyword">]); }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"&lt;pre&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">shell_exec </span><span class="keyword">(</span><span class="string">"unzip </span><span class="default">$options</span><span class="string"> </span><span class="keyword">{</span><span class="default">$filename</span><span class="keyword">}{</span><span class="default">$destDir</span><span class="keyword">}</span><span class="string">"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"&lt;/pre&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; else&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">outputPage </span><span class="keyword">(</span><span class="string">"Your password didn't check out, mon. Better try it again, eh?"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
else&nbsp; { </span><span class="default">outputPage</span><span class="keyword">(); }<br />
<br />
function </span><span class="default">outputPage </span><span class="keyword">(</span><span class="default">$errorMessage </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">)&nbsp; {<br />
&nbsp;&nbsp;&nbsp; echo &lt;&lt;&lt;HTML<br />
</span><span class="string">&nbsp; &nbsp; &nbsp; &nbsp; &lt;html&gt;&lt;head&gt;&lt;title&gt;Unzip password verification&lt;/title&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;style type="text/css"&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; td.left&nbsp; { text-align: right; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; td.right { text-align: left; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; div&nbsp; { color: red; border: 1px solid gray; padding: 4px; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;/style&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;/head&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;body&gt;<br />
</span><span class="keyword">HTML;<br />
<br />
&nbsp;&nbsp;&nbsp; if (!empty (</span><span class="default">$errorMessage</span><span class="keyword">))&nbsp; { echo </span><span class="string">"\n&lt;div&gt;</span><span class="default">$errorMessage</span><span class="string">&lt;/div&gt;\n"</span><span class="keyword">; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; echo &lt;&lt;&lt;HTMLL<br />
</span><span class="string">&nbsp; &nbsp; &nbsp; &nbsp; &lt;h1&gt;Super Duper File Unzipper&lt;/h1&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;form name="zipform" method="post" action="unzipper.php"&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;table&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;tr&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;td class="left"&gt;Filename:&lt;/td&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;td class="right"&gt;&lt;input type="text" name="filename" size="50" maxlength="255" /&gt;&lt;/td&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;/tr&gt;&lt;tr&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;td class="left"&gt;Destination Directory:&lt;/td&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;td class="right"&gt;&lt;input type="text" name="destdir" size="50" maxlength="1000" /&gt;&lt;/td&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;/tr&gt;&lt;tr&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;td class="left"&gt;Password:&lt;/td&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;td class="right"&gt;&lt;input type="password" name="password" size="15" maxlength="30" /&gt;&lt;/td&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;tr&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;td colspan="2"&gt;&lt;input type="checkbox" name="updateExisting" /&gt;Update existing files&lt;/td&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;/tr&gt;&lt;tr&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;td class="right"&gt;&lt;input type="reset" value="Reset" /&gt;&lt;/td&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;td class="left"&gt;&lt;input type="submit" value="Unzip it!" /&gt;&lt;/td&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;/tr&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;/table&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;/form&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;/body&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;/html&gt;<br />
</span><span class="keyword">HTMLL;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="67183""></a>
  <div class="note">
   <strong class="user">rustleb at hotmail dot com</strong>
   <a href="#67183" class="date">05-Jun-2006 10:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For capturing stdout and stderr, when you don't care about the intermediate files, I've had better results with . . .<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">cmd_exec</span><span class="keyword">(</span><span class="default">$cmd</span><span class="keyword">, &amp;</span><span class="default">$stdout</span><span class="keyword">, &amp;</span><span class="default">$stderr</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$outfile </span><span class="keyword">= </span><span class="default">tempnam</span><span class="keyword">(</span><span class="string">"."</span><span class="keyword">, </span><span class="string">"cmd"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$errfile </span><span class="keyword">= </span><span class="default">tempnam</span><span class="keyword">(</span><span class="string">"."</span><span class="keyword">, </span><span class="string">"cmd"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$descriptorspec </span><span class="keyword">= array(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">0 </span><span class="keyword">=&gt; array(</span><span class="string">"pipe"</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">),<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">1 </span><span class="keyword">=&gt; array(</span><span class="string">"file"</span><span class="keyword">, </span><span class="default">$outfile</span><span class="keyword">, </span><span class="string">"w"</span><span class="keyword">),<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">2 </span><span class="keyword">=&gt; array(</span><span class="string">"file"</span><span class="keyword">, </span><span class="default">$errfile</span><span class="keyword">, </span><span class="string">"w"</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; );<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$proc </span><span class="keyword">= </span><span class="default">proc_open</span><span class="keyword">(</span><span class="default">$cmd</span><span class="keyword">, </span><span class="default">$descriptorspec</span><span class="keyword">, </span><span class="default">$pipes</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; if (!</span><span class="default">is_resource</span><span class="keyword">(</span><span class="default">$proc</span><span class="keyword">)) return </span><span class="default">255</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]);&nbsp; &nbsp; </span><span class="comment">//Don't really want to give any input<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$exit </span><span class="keyword">= </span><span class="default">proc_close</span><span class="keyword">(</span><span class="default">$proc</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$stdout </span><span class="keyword">= </span><span class="default">file</span><span class="keyword">(</span><span class="default">$outfile</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$stderr </span><span class="keyword">= </span><span class="default">file</span><span class="keyword">(</span><span class="default">$errfile</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">unlink</span><span class="keyword">(</span><span class="default">$outfile</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">unlink</span><span class="keyword">(</span><span class="default">$errfile</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$exit</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
This isn't much different than a redirection, except it takes care of the temp files for you (you may need to change the directory from ".") and it blocks automatically due to the proc_close call.&nbsp; This mimics the shell_exec behavior, plus gets you stderr.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="65627""></a>
  <div class="note">
   <strong class="user">squeegee</strong>
   <a href="#65627" class="date">04-May-2006 07:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Each time you call shell_exec, it operates in a completely new shell. So if you need to do different multiple things in it based on whatever criteria, assemble your command ahead of time:<br />
<br />
instead of <br />
<br />
<span class="default">&lt;?php<br />
shell_exec</span><span class="keyword">(</span><span class="string">"cd </span><span class="default">$path_to_dir</span><span class="string">"</span><span class="keyword">);<br />
</span><span class="default">shell_exec</span><span class="keyword">(</span><span class="string">"ls -l"</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
which, as you noted, won't work, do<br />
<br />
<span class="default">&lt;?php<br />
$cmd </span><span class="keyword">= </span><span class="string">"cd </span><span class="default">$path_to_dir</span><span class="string">; "</span><span class="keyword">;<br />
if(</span><span class="default">$a </span><span class="keyword">== </span><span class="default">true</span><span class="keyword">)</span><span class="default">$cmd </span><span class="keyword">.= </span><span class="string">"ls -l"</span><span class="keyword">;<br />
else </span><span class="default">$cmd </span><span class="keyword">.= </span><span class="string">"du -h"</span><span class="keyword">;<br />
</span><span class="default">$result </span><span class="keyword">= </span><span class="default">shell_exec</span><span class="keyword">(</span><span class="default">$cmd</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="62083""></a>
  <div class="note">
   <strong class="user">notmespammers-iain at iaindooley dot com</strong>
   <a href="#62083" class="date">19-Feb-2006 12:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
beware!<br />
<br />
shell_exec('cd /path/to/dir');<br />
shell_exec('ls -l');<br />
<br />
will not give a listing of /path/to/dir!! use chdir() if you need to change directories, or group your commands with &amp;&amp; (not always convenient/possible)<br />
<br />
cheers<br />
<br />
iain</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="61998""></a>
  <div class="note">
   <strong class="user">rigsbr at yahoo dot com dot br</strong>
   <a href="#61998" class="date">17-Feb-2006 03:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you need to execute a command without permission and could not execute it by ssh or install any extension, there is a way in Apache 1.3.x and PHP 4.<br />
Create a file on cgi-bin directory, like this:<br />
<br />
#!/usr/bin/php<br />
&lt;?<br />
&nbsp; echo shell_exec('whoami');<br />
?&gt;<br />
<br />
Don't forget to set the file you created the permission to execute it. Hence, call it from browser and you will se that this script will be executed by the shell user and not the user nobody (apache default user if running a PHP script).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="59898""></a>
  <div class="note">
   <strong class="user">Ashraf Kaabi</strong>
   <a href="#59898" class="date">19-Dec-2005 07:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I've write a Full Class for Run in Background, Kill PID , check if is Running <br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/**<br />
&nbsp;* @author&nbsp; &nbsp;&nbsp; Ashraf M Kaabi<br />
&nbsp;* @name&nbsp; &nbsp; &nbsp;&nbsp; Advance Linux Exec<br />
&nbsp;*/<br />
</span><span class="keyword">class </span><span class="default">exec </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; * Run Application in background<br />
&nbsp;&nbsp; &nbsp; *<br />
&nbsp;&nbsp; &nbsp; * @param&nbsp; &nbsp;&nbsp; unknown_type $Command<br />
&nbsp;&nbsp; &nbsp; * @param&nbsp; &nbsp;&nbsp; unknown_type $Priority<br />
&nbsp;&nbsp; &nbsp; * @return&nbsp; &nbsp;&nbsp; PID<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">background</span><span class="keyword">(</span><span class="default">$Command</span><span class="keyword">, </span><span class="default">$Priority </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; if(</span><span class="default">$Priority</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$PID </span><span class="keyword">= </span><span class="default">shell_exec</span><span class="keyword">(</span><span class="string">"nohup nice -n </span><span class="default">$Priority</span><span class="string"> </span><span class="default">$Command</span><span class="string"> &gt; /dev/null &amp; echo $!"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$PID </span><span class="keyword">= </span><span class="default">shell_exec</span><span class="keyword">(</span><span class="string">"nohup </span><span class="default">$Command</span><span class="string"> &gt; /dev/null &amp; echo $!"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; return(</span><span class="default">$PID</span><span class="keyword">);<br />
&nbsp;&nbsp; }<br />
&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp;&nbsp; * Check if the Application running !<br />
&nbsp;&nbsp;&nbsp; *<br />
&nbsp;&nbsp;&nbsp; * @param&nbsp; &nbsp;&nbsp; unknown_type $PID<br />
&nbsp;&nbsp;&nbsp; * @return&nbsp; &nbsp;&nbsp; boolen<br />
&nbsp;&nbsp;&nbsp; */<br />
&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">is_running</span><span class="keyword">(</span><span class="default">$PID</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">exec</span><span class="keyword">(</span><span class="string">"ps </span><span class="default">$PID</span><span class="string">"</span><span class="keyword">, </span><span class="default">$ProcessState</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; return(</span><span class="default">count</span><span class="keyword">(</span><span class="default">$ProcessState</span><span class="keyword">) &gt;= </span><span class="default">2</span><span class="keyword">);<br />
&nbsp;&nbsp; }<br />
&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp;&nbsp; * Kill Application PID<br />
&nbsp;&nbsp;&nbsp; *<br />
&nbsp;&nbsp;&nbsp; * @param&nbsp; unknown_type $PID<br />
&nbsp;&nbsp;&nbsp; * @return boolen<br />
&nbsp;&nbsp;&nbsp; */<br />
&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">kill</span><span class="keyword">(</span><span class="default">$PID</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; if(</span><span class="default">exec</span><span class="keyword">::</span><span class="default">is_running</span><span class="keyword">(</span><span class="default">$PID</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">exec</span><span class="keyword">(</span><span class="string">"kill -KILL </span><span class="default">$PID</span><span class="string">"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; }else return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; }<br />
};<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="57215""></a>
  <div class="note">
   <strong class="user">php [AT] jsomers [DOT] be</strong>
   <a href="#57215" class="date">27-Sep-2005 03:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">/**<br />
&nbsp;* PHP Kill Process<br />
&nbsp;*<br />
&nbsp;* Sometimes, it can happen a script keeps running when it shouldn't, and it<br />
&nbsp;* won't stop after we close the browser, or shutdown the computer. Because it's<br />
&nbsp;* not always easy to use SSH there's a workaround.<br />
&nbsp;*<br />
&nbsp;* @author&nbsp; &nbsp; &nbsp; Jensen Somers &lt;php@jsomers.be&gt;<br />
&nbsp;* @version&nbsp; &nbsp;&nbsp; 1.0<br />
&nbsp;*/<br />
&nbsp;<br />
</span><span class="keyword">class </span><span class="default">KillAllProcesses </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; * Construct the class<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">killallprocesses</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">listItems</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; * List all the items<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">listItems</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/*<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; * PS&nbsp;&nbsp; Unix command to report process status<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; * -x&nbsp;&nbsp; Select processes without controlling ttys<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; *<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; * Output will look like:<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; 16479 pts/13&nbsp;&nbsp; S&nbsp; &nbsp; &nbsp; 0:00 -bash<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; 21944 pts/13&nbsp;&nbsp; R&nbsp; &nbsp; &nbsp; 0:00 ps -x<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; *<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; */<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$output </span><span class="keyword">=&nbsp;&nbsp; </span><span class="default">shell_exec</span><span class="keyword">(</span><span class="string">'ps -x'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">output</span><span class="keyword">(</span><span class="default">$output</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Put each individual line into an array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$array&nbsp; </span><span class="keyword">=&nbsp;&nbsp; </span><span class="default">explode</span><span class="keyword">(</span><span class="string">"\n"</span><span class="keyword">, </span><span class="default">$output</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">doKill</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; * Print the process list<br />
&nbsp;&nbsp; &nbsp; * @param&nbsp;&nbsp; string&nbsp; $output<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">output</span><span class="keyword">(</span><span class="default">$output</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; print&nbsp;&nbsp; </span><span class="string">"&lt;pre&gt;"</span><span class="keyword">.</span><span class="default">$output</span><span class="keyword">.</span><span class="string">"&lt;/pre&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; * Kill all the processes<br />
&nbsp;&nbsp; &nbsp; * It should be possible to filter in this, but I won't do it now.<br />
&nbsp;&nbsp; &nbsp; * @param&nbsp;&nbsp; array&nbsp;&nbsp; $array<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">doKill</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/*<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; * Because the first line of our $output will look like<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp; PID TTY&nbsp; &nbsp; &nbsp; STAT&nbsp;&nbsp; TIME COMMAND<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; * we'll skip this one.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; */<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">count</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">); </span><span class="default">$i</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$id </span><span class="keyword">=&nbsp;&nbsp; </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">], </span><span class="default">0</span><span class="keyword">, </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$array</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">], </span><span class="string">' ?'</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">shell_exec</span><span class="keyword">(</span><span class="string">'kill '</span><span class="keyword">.</span><span class="default">$id</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
new </span><span class="default">KillAllProcesses</span><span class="keyword">();<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
It's not the very best solution, but I've used it a couple of times when I needed to do it quick without to much trouble.<br />
Make not I kill all the processes, on my server px -x will only return like 4 times /sbin/apache and it's pretty safe to kill them without any trouble.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="56935""></a>
  <div class="note">
   <strong class="user">concept at conceptonline dot hu</strong>
   <a href="#56935" class="date">19-Sep-2005 11:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Interestingly, if you execute a script which is not in your path (or you have made a typo, or if the script does no exist at all), you will get no return value. The error will be logged into the error_log of your webserver.<br />
<br />
Someone could add a note how this can be (if it could be) overriden, as the standard behaviour is not really fool-proof.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="56411""></a>
  <div class="note">
   <strong class="user">ludvig dot ericson at gmail dot com</strong>
   <a href="#56411" class="date">01-Sep-2005 08:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
(if you have any other way of doing this PLEASE send me a mail)<br />
(The following note is interesting to *NIX administrators ONLY)<br />
Jailing a PHP CLI session is not the easiest thing to do.<br />
<br />
PHP has a gigantic list of dependencies, you can check it by<br />
ldd `which php`<br />
Each of these .so files (shared libraries) can have dependencies, and can depend on each other, making the list much bigger.<br />
However, there are tools out there to copy all dependencies into a jailed directory, you just have to search for them - and I had no luck.<br />
<br />
What I did was just to run these few commands:<br />
su<br />
mkdir /jailpath &amp;&amp; mkdir /jailpath/lib<br />
cp /lib/*.so* /jailpath/lib/<br />
mkdir /jailpath/usr &amp;&amp; mkdir /jailpath/usr/bin &amp;&amp; mkdir /jailpath/usr/lib<br />
cp /usr/lib/*.so* /jailpath/usr/lib<br />
cp `which php` /jailpath/usr/bin<br />
chmod -R 0755 /jailpath &amp;&amp; chown -R root:root /jailpath &amp;&amp; chmod 0000 /jailpath<br />
<br />
Do note that this copies _all_ of your shared objects. There is one or two more libraries you have top copy, but chroot will tell you about which one it is.<br />
<br />
Hope this helped somehow.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="52826""></a>
  <div class="note">
   <strong class="user">dk at brightbyte dot de</strong>
   <a href="#52826" class="date">13-May-2005 10:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
her's a function that is similar to shell_exec but captures both stdout and stderr. It's much more complicated than using 2&gt;&amp;1, but it's independent of the shell and should work on windows, too. It uses proc_open with stream_select and non-blocking streams to read stdout and stderr concurrently. It is not guarantied that the lines appear in the correct order or that they are not intermingeled - but it did not happened when I tested it. So, here goes:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">runExternal</span><span class="keyword">(</span><span class="default">$cmd</span><span class="keyword">,&amp;</span><span class="default">$code</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$descriptorspec </span><span class="keyword">= array(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">0 </span><span class="keyword">=&gt; array(</span><span class="string">"pipe"</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">),&nbsp; </span><span class="comment">// stdin is a pipe that the child will read from<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">1 </span><span class="keyword">=&gt; array(</span><span class="string">"pipe"</span><span class="keyword">, </span><span class="string">"w"</span><span class="keyword">),&nbsp; </span><span class="comment">// stdout is a pipe that the child will write to<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">2 </span><span class="keyword">=&gt; array(</span><span class="string">"pipe"</span><span class="keyword">, </span><span class="string">"w"</span><span class="keyword">) </span><span class="comment">// stderr is a file to write to<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pipes</span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$process </span><span class="keyword">= </span><span class="default">proc_open</span><span class="keyword">(</span><span class="default">$cmd</span><span class="keyword">, </span><span class="default">$descriptorspec</span><span class="keyword">, </span><span class="default">$pipes</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$output</span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">is_resource</span><span class="keyword">(</span><span class="default">$process</span><span class="keyword">)) return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">#close child's input imidiately<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">stream_set_blocking</span><span class="keyword">(</span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">],</span><span class="default">false</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">stream_set_blocking</span><span class="keyword">(</span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">],</span><span class="default">false</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$todo</span><span class="keyword">= array(</span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">],</span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while( </span><span class="default">true </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$read</span><span class="keyword">= array(); <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if( !</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]) ) </span><span class="default">$read</span><span class="keyword">[]= </span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if( !</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]) ) </span><span class="default">$read</span><span class="keyword">[]= </span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">$read</span><span class="keyword">) break;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ready</span><span class="keyword">= </span><span class="default">stream_select</span><span class="keyword">(</span><span class="default">$read</span><span class="keyword">, </span><span class="default">$write</span><span class="keyword">=</span><span class="default">NULL</span><span class="keyword">, </span><span class="default">$ex</span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$ready </span><span class="keyword">=== </span><span class="default">false</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break; </span><span class="comment">#should never happen - something died<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">}<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$read </span><span class="keyword">as </span><span class="default">$r</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$s</span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$r</span><span class="keyword">,</span><span class="default">1024</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$output</span><span class="keyword">.= </span><span class="default">$s</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$code</span><span class="keyword">= </span><span class="default">proc_close</span><span class="keyword">(</span><span class="default">$process</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$output</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;<br />
</span><br />
here is how to use it:<br />
<br />
<span class="default">&lt;?php<br />
$result</span><span class="keyword">= </span><span class="default">runExternal</span><span class="keyword">(</span><span class="string">"ls -l some-file.txt"</span><span class="keyword">,</span><span class="default">$code</span><span class="keyword">);<br />
<br />
print </span><span class="string">"&lt;pre&gt;"</span><span class="keyword">;<br />
print </span><span class="default">$result</span><span class="keyword">;<br />
print </span><span class="string">"&lt;/pre&gt;\n"</span><span class="keyword">;<br />
<br />
print </span><span class="string">"&lt;b&gt;code: </span><span class="default">$code</span><span class="string">&lt;/b&gt;\n"</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
enjoy :-)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="51782""></a>
  <div class="note">
   <strong class="user">phillipberry at NOSPAM dot blisswebhosting dot com</strong>
   <a href="#51782" class="date">11-Apr-2005 10:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I found something odd.<br />
<br />
If you run exec then straight after shell_exec the shell_exec will simply not run and will return NULL.<br />
<br />
To get it to work i put a sleep(5) after the exec and now shell_exec works fine.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="50777""></a>
  <div class="note">
   <strong class="user">Kenneth</strong>
   <a href="#50777" class="date">09-Mar-2005 06:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Sometimes it's needed to be able to execute shell commands as root using PHP. For instance, restarting named after adding or changing zones, or adding new alliases for sendmail.<br />
<br />
My approach is to run a server called Nanoweb, available from&nbsp; <a href="http://nanoweb.si.kz/. It" rel="nofollow" target="_blank">http://nanoweb.si.kz/. It</a>'s a webserver written in PHP, and needs only the pcntl extension extra to operate. Nanoweb is configured to only listen for connections on localhost, port 81 for example. From my normal PHP scripts running inside Apache I simply call scripts in Nanoweb to get the messy 'root' tasks done. Much more secure and safer.<br />
<br />
Hope this helps</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="48654""></a>
  <div class="note">
   
   <a href="#48654" class="date">03-Jan-2005 06:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Be careful as to how you elevate privileges to your php script.&nbsp; It's a good idea to use caution and planing.&nbsp; It is easy to open up huge security holes.&nbsp; Here are a couple of helpful hints I've gathered from experimentation and Unix documentation.<br />
<br />
Things to think about:<br />
<br />
1. If you are running php as an Apache module in Unix then every system command you run is run as user apache.&nbsp; This just makes sense.. Unix won't allow privileges to be elevated in this manner.&nbsp; If you need to run a system command with elevated privileges think through the problem carefully!<br />
<br />
2. You are absolutely insane if you decide to run apache as root.&nbsp; You may as well kick yourself in the face.&nbsp; There is always a better way to do it.<br />
<br />
3. If you decide to use a SUID it is best not to SUID a script.&nbsp; SUID is disabled for scripts on many flavors of Unix.&nbsp; SUID scripts open up security holes, so you don't always want to go this route even if it is an option.&nbsp; Write a simple binary and elevate the privileges of the binary as a SUID.&nbsp; In my own opinion it is a horrible idea to pass a system command through a SUID-- ie have the SUID accept the name of a command as a parameter.&nbsp; You may as well run Apache as root!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="44438""></a>
  <div class="note">
   <strong class="user">James McCormack</strong>
   <a href="#44438" class="date">05-Aug-2004 10:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I had a perl program which ran fine from command line but not using shell_exec(), exec() or system() - nothing was being returned. I was using the full path and permissions were set correctly.<br />
<br />
It turned out the perl program was using more memory than my PHP.INI file was set to allow. Increasing "memory_limit" solved the problem.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="43907""></a>
  <div class="note">
   <strong class="user">leaetherstrip at inbox dot ru</strong>
   <a href="#43907" class="date">08-Jul-2004 11:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note on XP users: XP-Home edition does not allow to set rights directly on files and folders. You should use 'cacls' command-line utility to do this.<br />
<br />
For example:<br />
<br />
cacls c:\windows\system32\cmd.exe /E /G IUSR_ADMIN2003:F<br />
<br />
gives IIS user full access to cmd.exe (potential security hole!), so PHP can fork and execute external programs.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="43707""></a>
  <div class="note">
   <strong class="user">vsuarez at vorealis dot com</strong>
   <a href="#43707" class="date">01-Jul-2004 03:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Got the error "Unable to execute..." when trying to run an external program with shell_exec under Windows XP, IIS 5, php 4.3.7&nbsp; Solved by giving the IIS user (IUSR_...) execution privileges on the system file %systemroot%\system32\cmd.exe&nbsp; This should be used carefully because may represent a server's security hole.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="40856""></a>
  <div class="note">
   <strong class="user">dj-bj at gmx dot net</strong>
   <a href="#40856" class="date">17-Mar-2004 02:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
shell_exec passes the result to a variable only if the result of the command is true.<br />
<br />
When the result is false the generated page contains the error string in clear text at the position the result was fetched (which can differ from reload to reload).<br />
<br />
If you would like to recieve also the error messages append 2&gt;&amp;1 to the end of the command you are executing. <br />
However, the result is also passed to the page directly.<br />
<br />
To avoid page destruction you should not fetch the result in your script.<br />
By appending &gt;nul to the shell command you can hide any output.<br />
Hope this helps.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="38905""></a>
  <div class="note">
   <strong class="user">Martin Rampersad</strong>
   <a href="#38905" class="date">11-Jan-2004 10:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I have PHP (CGI) and Apache. I also shell_exec() shell scripts which use PHP CLI. This combination destroys the string value returned from the call. I get binary garbage.&nbsp; Shell scripts that start with #!/usr/bin/bash return their output properly.<br />
<br />
A solution is to force a clean environment.&nbsp; PHP CLI no longer had the CGI environment variables to choke on.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">// Binary garbage.<br />
</span><span class="default">$ExhibitA </span><span class="keyword">= </span><span class="default">shell_exec</span><span class="keyword">(</span><span class="string">'/home/www/myscript'</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Perfect.<br />
</span><span class="default">$ExhibitB </span><span class="keyword">= </span><span class="default">shell_exec</span><span class="keyword">(</span><span class="string">'env -i /home/www/myscript'</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
-- start /home/www/myscript<br />
#!/usr/local/bin/phpcli<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">echo(</span><span class="string">"Output.\n"</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span>-- end /home/www/myscript</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="38358""></a>
  <div class="note">
   <strong class="user">spagmoid at yahoo dot NOSPAMcom</strong>
   <a href="#38358" class="date">17-Dec-2003 11:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that whatever you run with this function seems to use PHP memory, so it will die if it exceeds the limit (usually 8 megs)&nbsp; To do database dumps or other memory-hogging operations use something like system() instead.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="37971""></a>
  <div class="note">
   <strong class="user">jessop &lt;AT&gt; bigfoot &lt;DOT&gt; com</strong>
   <a href="#37971" class="date">03-Dec-2003 09:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just a quick reminder for those trying to use shell_exec on a unix-type platform and can't seem to get it to work. PHP executes as the web user on the system (generally www for Apache), so you need to make sure that the web user has rights to whatever files or directories that you are trying to use in the shell_exec command. Other wise, it won't appear to be doing anything.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="37691""></a>
  <div class="note">
   <strong class="user">ericphp at shepard dot com</strong>
   <a href="#37691" class="date">23-Nov-2003 11:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I had major problems getting sell_exec() to work from PHP. It was working fine via the Telnet command line.<br />
<br />
Turns out (for me anyway) it was a pathing problem. I'm set up on a VPS FreeBSD server the does not (technically) have root access.<br />
<br />
PHP needs to reference the FULL PATH to the app it's calling. But it gets more tricky than that. There may be more than one full path on a server. For instance, on mine there is:<br />
<br />
&gt;find ~/ -name mysqldump (VPS non-root search method)<br />
<br />
/usr/local/bin/mysqldump<br />
/usr/home/myusername/usr/local/bin/mysqldump<br />
/usr/home/myusername/usr/local/mysql-3.23.41/bin/mysqldump<br />
/usr/home/myusername/usr/local/mysql-3.23.43/bin/mysqldump<br />
<br />
Turns out (after 5 hours of hair pulling fun) that /usr/home/myusername/usr/local/mysql-3.23.43/bin/mysqldump was the winner.<br />
<br />
The same applies to using cURL and PHP via Cron. /usr/home/myusername/usr/local/curl-7.10.5/bin/curl&nbsp; works for me there.<br />
<br />
And tar wouldn't work until I dug up PHPTAR /usr/home/myusername/usr/local/bin/phptar. Never new that existed ...<br />
<br />
Good luck.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="34138""></a>
  <div class="note">
   <strong class="user">moneyboi at fuckwindows dot com</strong>
   <a href="#34138" class="date">17-Jul-2003 03:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
shell_exec("yourscript.sh") is great for opening shell scripts.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="32866""></a>
  <div class="note">
   <strong class="user">eremi at eremi dot net</strong>
   <a href="#32866" class="date">09-Jun-2003 07:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To output the command has it should be, you can do the str_replace trick above, or you can put the output in a &lt;pre&gt; tag.<br />
<br />
Example:<br />
<span class="default">&lt;?php<br />
&nbsp; $output </span><span class="keyword">= </span><span class="default">shell_exec</span><span class="keyword">(</span><span class="string">"[command]"</span><span class="keyword">);<br />
&nbsp; echo </span><span class="string">"&lt;pre&gt;</span><span class="default">$output</span><span class="string">&lt;/pre&gt;"</span><span class="keyword">;<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="32692""></a>
  <div class="note">
   <strong class="user">Ben</strong>
   <a href="#32692" class="date">04-Jun-2003 07:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When running subprocesses via shell_exec (and maybe others) from Apache/mod_php4, Apache's environment variables don't seem to be passed on to the subprocess environment unless you specifically force them by using putenv something like this:<br />
<br />
$remaddr = getenv("REMOTE_ADDR");<br />
putenv("REMOTE_ADDR=$remaddr");<br />
shell_exec("/path/to/subprocess");</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="31273""></a>
  <div class="note">
   <strong class="user">dan at mathjunkies.com</strong>
   <a href="#31273" class="date">16-Apr-2003 06:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just a note for anybody who's box is involuntarily running in safemode (i.e. you buy space on a server), or just not working right.&nbsp; Shell commands won't work.&nbsp; You can, however, use PHPs FTP functions to FTP in.&nbsp; I was copying files and making directories, but I assume there might be a way to do something more complex.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="31235""></a>
  <div class="note">
   <strong class="user">mcbeth at broggs dot org</strong>
   <a href="#31235" class="date">14-Apr-2003 11:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As far as error checking on the last example.&nbsp; Several of the shells have the &amp;&amp; operator, so you just string your commands together using it instead of ; If at any time any of the programs fail, you will return without running the rest</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="30549""></a>
  <div class="note">
   <strong class="user">ron dot petty at unigeek dot com</strong>
   <a href="#30549" class="date">21-Mar-2003 08:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is an example on how to install software using php<br />
<br />
shell_exec("cd /usr/local/src/; gunzip program.tar.gz; tar xvf program.tar; cd program; ./configure; make; make install);<br />
<br />
Now depending if your root or not some commands like "make install" may fail.&nbsp; This doesn't do any error checking, the reason for that is I do not know how to cd to a directory and then execute another command unless they are in the same shell.&nbsp; <br />
<br />
So basically, take what you type on the command line and string them together.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="29083""></a>
  <div class="note">
   <strong class="user">bruce at accumatics dot com</strong>
   <a href="#29083" class="date">01-Feb-2003 06:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you're not getting any output from echo shellexec( "count.pl" ) [for instance], at least try "./count.pl" before bothering with the full path.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="28994""></a>
  <div class="note">
   <strong class="user">flame</strong>
   <a href="#28994" class="date">30-Jan-2003 03:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
add&nbsp; '2&gt;&amp;1' to the end of your shell command to have STDERR returned as well as STDOUT.<br />
<br />
$shell_return = shell_exec($shell_command." 2&gt;&amp;1");</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="28573""></a>
  <div class="note">
   <strong class="user">ryon -at- ryon labaw -dot- com</strong>
   <a href="#28573" class="date">17-Jan-2003 09:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note: You cant used shell_exec() when safemode = on (its disabled), instead use<br />
exec() and copy the needed program into the /nonexec directory (by default, set in php.ini).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="27738""></a>
  <div class="note">
   <strong class="user">dj-bj at  gmx dot net</strong>
   <a href="#27738" class="date">17-Dec-2002 03:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Running PHP 4.2.3 on Windows 2000 Server shell_exec works fine and passes its output to the variable when the result of the executed command is true. <br />
However, if the command fails and the DOS-shell returns an error the result is no longer availiable in the variable but is passed directly to the page.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="26396""></a>
  <div class="note">
   <strong class="user">yaacov at pleasedontspamme dot spam</strong>
   <a href="#26396" class="date">29-Oct-2002 07:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you're running scripts or commands and can't figure out what's not working, check to make sure that you're not using an alias in place of a command. PHP (quite reasonably) doesn't seem to recognise aliases.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="22597""></a>
  <div class="note">
   <strong class="user">php at chris-decker dot com</strong>
   <a href="#22597" class="date">24-Jun-2002 08:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I have found it easiest to use the following code to execute a shell command and return all of it's output (not just the last line) to the user as if he/she were sitting at the terminal:<br />
<br />
$output = shell_exec("$command");<br />
echo(nl2br($output));</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="20329""></a>
  <div class="note">
   <strong class="user">tonysb at gmx dot net</strong>
   <a href="#20329" class="date">30-Mar-2002 09:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
shell_exec is extremely useful as a substitute for the virtual() function where unavailable (Microsoft IIS for example). All you have to do is remove the content type string sent in the header:<br />
<br />
&lt;? <br />
$mstrng = shell_exec('yourcgiscript.cgi');<br />
$mstrng = ereg_replace( "Content-type: text/html", "", $mstrng );<br />
echo $mstrng;<br />
?&gt;<br />
<br />
This works fine for me as a substitute for SSI or the virtual() func.<br />
<br />
Anton Babadjanov<br />
<a href="http://www.vbcn.com.ar" rel="nofollow" target="_blank">http://www.vbcn.com.ar</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
