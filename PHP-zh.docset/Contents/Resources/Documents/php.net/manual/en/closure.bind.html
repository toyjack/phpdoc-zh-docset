<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>复制一个闭包，绑定指定的$this对象和类作用域。</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="closure.construct.html">? Closure::__construct</a></li>
      <li style="float: right;"><a href="closure.bindto.html">Closure::bindTo ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="class.closure.html">Closure</a></li>
    <li>复制一个闭包，绑定指定的$this对象和类作用域。</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="closure.bind" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">Closure::bind</h1>
  <p class="verinfo">(PHP 5 &gt;= 5.4.0)</p><p class="refpurpose"><span class="refname">Closure::bind</span> &mdash; <span class="dc-title">
   复制一个闭包，绑定指定的$this对象和类作用域。
  </span></p>

 </div>

 <div class="refsect1 description" id="refsect1-closure.bind-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="modifier">public</span> <span class="modifier">static</span> <span class="type"><a href="class.closure.html" class="type Closure">Closure</a></span> <span class="methodname"><strong>Closure::bind</strong></span>
    ( <span class="methodparam"><span class="type"><a href="class.closure.html" class="type Closure">Closure</a></span> <code class="parameter">$closure</code></span>
   , <span class="methodparam"><span class="type">object</span> <code class="parameter">$newthis</code></span>
   [, <span class="methodparam"><span class="type"><a href="language.pseudo-types.html#language.types.mixed" class="type mixed">mixed</a></span> <code class="parameter">$newscope</code>
   <span class="initializer"> = &#039;static&#039;</span></span>
  ] )</div>

  <p class="para rdfs-comment">
   这个方法是 <span class="methodname"><a href="closure.bindto.html" class="methodname">Closure::bindTo()</a></span> 的静态版本。查看它的文档获取更多信息。
  </p>

 </div>


 <div class="refsect1 parameters" id="refsect1-closure.bind-parameters">
  <h3 class="title">参数</h3>
  <dl>

   
    <dt>
<code class="parameter">closure</code></dt>

    <dd>

     <p class="para">
      需要绑定的匿名函数。
     </p>
    </dd>

   
   
    <dt>
<code class="parameter">newthis</code></dt>

    <dd>

     <p class="para">
      需要绑定到匿名函数的对象，或者
      <strong><code>NULL</code></strong> 创建未绑定的闭包。
     </p>
    </dd>

   
   
    <dt>
<code class="parameter">newscope</code></dt>

    <dd>

     <p class="para">
      想要绑定给闭包的类作用域，或者 &#039;static&#039; 表示不改变。如果传入一个对象，则使用这个对象的类型名。
      类作用域用来决定在闭包中 $this 对象的 私有、保护方法 的可见性。
      The class scope to which associate the closure is to be associated, or
      &#039;static&#039; to keep the current one. If an object is given, the type of the
      object will be used instead. This determines the visibility of protected
      and private methods of the bound object.
     </p>
    </dd>

   
  </dl>

 </div>


 <div class="refsect1 returnvalues" id="refsect1-closure.bind-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   返回一个新的 <a href="class.closure.html" class="classname">Closure</a> 对象  或者在失败时返回 <strong><code>FALSE</code></strong>
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-closure.bind-examples">
  <h3 class="title">范例</h3>
  <div class="example" id="example-322">
   <p><strong>Example #1 <span class="function"><strong>Closure::bind()</strong></span> 实例</strong></p>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">A&nbsp;</span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;</span><span style="color: #0000BB">$sfoo&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;</span><span style="color: #0000BB">$ifoo&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">2</span><span style="color: #007700">;<br />}<br /></span><span style="color: #0000BB">$cl1&nbsp;</span><span style="color: #007700">=&nbsp;static&nbsp;function()&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">A</span><span style="color: #007700">::</span><span style="color: #0000BB">$sfoo</span><span style="color: #007700">;<br />};<br /></span><span style="color: #0000BB">$cl2&nbsp;</span><span style="color: #007700">=&nbsp;function()&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">ifoo</span><span style="color: #007700">;<br />};<br /><br /></span><span style="color: #0000BB">$bcl1&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Closure</span><span style="color: #007700">::</span><span style="color: #0000BB">bind</span><span style="color: #007700">(</span><span style="color: #0000BB">$cl1</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'A'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$bcl2&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Closure</span><span style="color: #007700">::</span><span style="color: #0000BB">bind</span><span style="color: #007700">(</span><span style="color: #0000BB">$cl2</span><span style="color: #007700">,&nbsp;new&nbsp;</span><span style="color: #0000BB">A</span><span style="color: #007700">(),&nbsp;</span><span style="color: #DD0000">'A'</span><span style="color: #007700">);<br />echo&nbsp;</span><span style="color: #0000BB">$bcl1</span><span style="color: #007700">(),&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br />echo&nbsp;</span><span style="color: #0000BB">$bcl2</span><span style="color: #007700">(),&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

   <div class="example-contents"><p>以上例程的输出类似于：</p></div>
   <div class="example-contents screen">
<div class="cdata"><pre>
1
2
</pre></div>
   </div>
  </div>
 </div>



 <div class="refsect1 seealso" id="refsect1-closure.bind-seealso">
  <h3 class="title">参见</h3>
  <ul class="simplelist">
   <li class="member"><a href="functions.anonymous.html" class="link">匿名函数</a></li>
   <li class="member"><span class="methodname"><a href="closure.bindto.html" class="methodname" rel="rdfs-seeAlso">Closure::bindTo()</a> - 复制当前闭包对象，绑定指定的$this对象和类作用域。</span></li>
  </ul>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="116267""></a>
  <div class="note">
   <strong class="user">potherca at hotmail dot com</strong>
   <a href="#116267" class="date">04-Dec-2014 05:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you need to validate whether or not a closure can be bound to a PHP object, you will have to resort to using reflection.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">/**<br />
&nbsp;* @param \Closure $callable<br />
&nbsp;*<br />
&nbsp;* @return bool<br />
&nbsp;*/<br />
</span><span class="keyword">function </span><span class="default">isBindable</span><span class="keyword">(\</span><span class="default">Closure $callable</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$bindable </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$reflectionFunction </span><span class="keyword">= new \</span><span class="default">ReflectionFunction</span><span class="keyword">(</span><span class="default">$callable</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if (<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$reflectionFunction</span><span class="keyword">-&gt;</span><span class="default">getClosureScopeClass</span><span class="keyword">() === </span><span class="default">null<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">|| </span><span class="default">$reflectionFunction</span><span class="keyword">-&gt;</span><span class="default">getClosureThis</span><span class="keyword">() !== </span><span class="default">null<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bindable </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$bindable</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="110845""></a>
  <div class="note">
   <strong class="user">Vincius Krolow</strong>
   <a href="#110845" class="date">14-Dec-2012 09:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
With this class and method, it's possible to do nice things, like add methods on the fly to an object.<br />
<br />
MetaTrait.php<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">trait </span><span class="default">MetaTrait<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$methods </span><span class="keyword">= array();<br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">addMethod</span><span class="keyword">(</span><span class="default">$methodName</span><span class="keyword">, </span><span class="default">$methodCallable</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">is_callable</span><span class="keyword">(</span><span class="default">$methodCallable</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; throw new </span><span class="default">InvalidArgumentException</span><span class="keyword">(</span><span class="string">'Second param must be callable'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">methods</span><span class="keyword">[</span><span class="default">$methodName</span><span class="keyword">] = </span><span class="default">Closure</span><span class="keyword">::</span><span class="default">bind</span><span class="keyword">(</span><span class="default">$methodCallable</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">, </span><span class="default">get_class</span><span class="keyword">());<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__call</span><span class="keyword">(</span><span class="default">$methodName</span><span class="keyword">, array </span><span class="default">$args</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (isset(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">methods</span><span class="keyword">[</span><span class="default">$methodName</span><span class="keyword">])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">call_user_func_array</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">methods</span><span class="keyword">[</span><span class="default">$methodName</span><span class="keyword">], </span><span class="default">$args</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; throw </span><span class="default">RunTimeException</span><span class="keyword">(</span><span class="string">'There is no method with the given name to call'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
test.php<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">require </span><span class="string">'MetaTrait.php'</span><span class="keyword">;<br />
&nbsp;<br />
class </span><span class="default">HackThursday </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; use </span><span class="default">MetaTrait</span><span class="keyword">;<br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$dayOfWeek </span><span class="keyword">= </span><span class="string">'Thursday'</span><span class="keyword">;<br />
&nbsp;<br />
}<br />
&nbsp;<br />
</span><span class="default">$test </span><span class="keyword">= new </span><span class="default">HackThursday</span><span class="keyword">();<br />
</span><span class="default">$test</span><span class="keyword">-&gt;</span><span class="default">addMethod</span><span class="keyword">(</span><span class="string">'when'</span><span class="keyword">, function () {<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">dayOfWeek</span><span class="keyword">;<br />
});<br />
&nbsp;<br />
echo </span><span class="default">$test</span><span class="keyword">-&gt;</span><span class="default">when</span><span class="keyword">();<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
