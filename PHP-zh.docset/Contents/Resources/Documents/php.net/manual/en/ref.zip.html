<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>Zip 函数</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="ziparchive.unchangename.html">? ZipArchive::unchangeName</a></li>
      <li style="float: right;"><a href="function.zip-close.html">zip_close ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="book.zip.html">Zip</a></li>
    <li>Zip 函数</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="ref.zip" class="reference">
 <h1 class="title">Zip 函数</h1>
 
 


































































































 
<h2>Table of Contents</h2><ul class="chunklist chunklist_reference"><li><a href="function.zip-close.html">zip_close</a> &mdash; 关闭一个ZIP档案文件</li><li><a href="function.zip-entry-close.html">zip_entry_close</a> &mdash; 关闭目录项</li><li><a href="function.zip-entry-compressedsize.html">zip_entry_compressedsize</a> &mdash; 检索目录项压缩过后的大小</li><li><a href="function.zip-entry-compressionmethod.html">zip_entry_compressionmethod</a> &mdash; 检索目录实体的压缩方法</li><li><a href="function.zip-entry-filesize.html">zip_entry_filesize</a> &mdash; 检索目录实体的实际大小</li><li><a href="function.zip-entry-name.html">zip_entry_name</a> &mdash; 检索目录项的名称</li><li><a href="function.zip-entry-open.html">zip_entry_open</a> &mdash; 打开用于读取的目录实体</li><li><a href="function.zip-entry-read.html">zip_entry_read</a> &mdash; 读取一个打开了的压缩目录实体</li><li><a href="function.zip-open.html">zip_open</a> &mdash; 打开ZIP存档文件</li><li><a href="function.zip-read.html">zip_read</a> &mdash; 读取ZIP存档文件中下一项</li></ul>
</div>
<div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="105989""></a>
  <div class="note">
   <strong class="user">shadowbranch at gmail dot com</strong>
   <a href="#105989" class="date">30-Sep-2011 02:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is the simplest method to unzip a file. Pass the function your filename and it will unzip it to the current directory of the script with permissions done properly on unix type operating systems. Far simpler to understand and read.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">unzip</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">){
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$zip </span><span class="keyword">= </span><span class="default">zip_open</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">is_resource</span><span class="keyword">(</span><span class="default">$zip</span><span class="keyword">)){
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tree </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while((</span><span class="default">$zip_entry </span><span class="keyword">= </span><span class="default">zip_read</span><span class="keyword">(</span><span class="default">$zip</span><span class="keyword">)) !== </span><span class="default">false</span><span class="keyword">){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Unpacking "</span><span class="keyword">.</span><span class="default">zip_entry_name</span><span class="keyword">(</span><span class="default">$zip_entry</span><span class="keyword">).</span><span class="string">"\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">zip_entry_name</span><span class="keyword">(</span><span class="default">$zip_entry</span><span class="keyword">), </span><span class="default">DIRECTORY_SEPARATOR</span><span class="keyword">) !== </span><span class="default">false</span><span class="keyword">){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$last </span><span class="keyword">= </span><span class="default">strrpos</span><span class="keyword">(</span><span class="default">zip_entry_name</span><span class="keyword">(</span><span class="default">$zip_entry</span><span class="keyword">), </span><span class="default">DIRECTORY_SEPARATOR</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dir </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">zip_entry_name</span><span class="keyword">(</span><span class="default">$zip_entry</span><span class="keyword">), </span><span class="default">0</span><span class="keyword">, </span><span class="default">$last</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$file </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">zip_entry_name</span><span class="keyword">(</span><span class="default">$zip_entry</span><span class="keyword">), </span><span class="default">strrpos</span><span class="keyword">(</span><span class="default">zip_entry_name</span><span class="keyword">(</span><span class="default">$zip_entry</span><span class="keyword">), </span><span class="default">DIRECTORY_SEPARATOR</span><span class="keyword">)+</span><span class="default">1</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(!</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">)){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; @</span><span class="default">mkdir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">, </span><span class="default">0755</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">) or die(</span><span class="string">"Unable to create </span><span class="default">$dir</span><span class="string">\n"</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">trim</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">)) &gt; </span><span class="default">0</span><span class="keyword">){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$return </span><span class="keyword">= @</span><span class="default">file_put_contents</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">.</span><span class="string">"/"</span><span class="keyword">.</span><span class="default">$file</span><span class="keyword">, </span><span class="default">zip_entry_read</span><span class="keyword">(</span><span class="default">$zip_entry</span><span class="keyword">, </span><span class="default">zip_entry_filesize</span><span class="keyword">(</span><span class="default">$zip_entry</span><span class="keyword">)));
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$return </span><span class="keyword">=== </span><span class="default">false</span><span class="keyword">){
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; die(</span><span class="string">"Unable to write file </span><span class="default">$dir</span><span class="string">/</span><span class="default">$file</span><span class="string">\n"</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }else{
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">file_put_contents</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="default">zip_entry_read</span><span class="keyword">(</span><span class="default">$zip_entry</span><span class="keyword">, </span><span class="default">zip_entry_filesize</span><span class="keyword">(</span><span class="default">$zip_entry</span><span class="keyword">)));
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }else{
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Unable to open zip file\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="97279""></a>
  <div class="note">
   <strong class="user">wdtemp at seznam dot cz</strong>
   <a href="#97279" class="date">12-Apr-2010 09:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hi,
<br />
if you have the RAW CONTENT OF THE ZIP FILE IN A STRING ONLY and you can't create files on your server (because of the SAFE MODE) to be able to create a file which you can then pass to zip_open(), you'll be having hard times getting the uncompressed content of your ZIP data.
<br />
This may help:
<br />
I've written simple ZIP decompression function for decompressing the first file from the archive stored in a string (no matter what file it is). It's just about parsing a local file header of the first file, getting raw compressed data of that file and decompression of that data (usually, data in ZIP files are compressed by 'DEFLATE' method, so we'll just decompress it by gzinflate() function then).
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">decompress_first_file_from_zip</span><span class="keyword">(</span><span class="default">$ZIPContentStr</span><span class="keyword">){
<br />
</span><span class="comment">//Input: ZIP archive - content of entire ZIP archive as a string
<br />
//Output: decompressed content of the first file packed in the ZIP archive
<br />
&nbsp;&nbsp;&nbsp; //let's parse the ZIP archive
<br />
&nbsp;&nbsp;&nbsp; //(see '<a href="http://en.wikipedia.org/wiki/ZIP_%28file_format%29" rel="nofollow" target="_blank">http://en.wikipedia.org/wiki/ZIP_%28file_format%29</a>' for details)
<br />
&nbsp;&nbsp;&nbsp; //parse 'local file header' for the first file entry in the ZIP archive
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$ZIPContentStr</span><span class="keyword">)&lt;</span><span class="default">102</span><span class="keyword">){
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//any ZIP file smaller than 102 bytes is invalid
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">printf</span><span class="keyword">(</span><span class="string">"error: input data too short&lt;br /&gt;\n"</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">''</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$CompressedSize</span><span class="keyword">=</span><span class="default">binstrtonum</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$ZIPContentStr</span><span class="keyword">,</span><span class="default">18</span><span class="keyword">,</span><span class="default">4</span><span class="keyword">));
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$UncompressedSize</span><span class="keyword">=</span><span class="default">binstrtonum</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$ZIPContentStr</span><span class="keyword">,</span><span class="default">22</span><span class="keyword">,</span><span class="default">4</span><span class="keyword">));
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$FileNameLen</span><span class="keyword">=</span><span class="default">binstrtonum</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$ZIPContentStr</span><span class="keyword">,</span><span class="default">26</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">));
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ExtraFieldLen</span><span class="keyword">=</span><span class="default">binstrtonum</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$ZIPContentStr</span><span class="keyword">,</span><span class="default">28</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">));
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$Offs</span><span class="keyword">=</span><span class="default">30</span><span class="keyword">+</span><span class="default">$FileNameLen</span><span class="keyword">+</span><span class="default">$ExtraFieldLen</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ZIPData</span><span class="keyword">=</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$ZIPContentStr</span><span class="keyword">,</span><span class="default">$Offs</span><span class="keyword">,</span><span class="default">$CompressedSize</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$Data</span><span class="keyword">=</span><span class="default">gzinflate</span><span class="keyword">(</span><span class="default">$ZIPData</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$Data</span><span class="keyword">)!=</span><span class="default">$UncompressedSize</span><span class="keyword">){
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">printf</span><span class="keyword">(</span><span class="string">"error: uncompressed data have wrong size&lt;br /&gt;\n"</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">''</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; else return </span><span class="default">$Data</span><span class="keyword">;
<br />
}
<br />

<br />
function </span><span class="default">binstrtonum</span><span class="keyword">(</span><span class="default">$Str</span><span class="keyword">){
<br />
</span><span class="comment">//Returns a number represented in a raw binary data passed as string.
<br />
//This is useful for example when reading integers from a file,
<br />
// when we have the content of the file in a string only.
<br />
//Examples:
<br />
// chr(0xFF) will result as 255
<br />
// chr(0xFF).chr(0xFF).chr(0x00).chr(0x00) will result as 65535
<br />
// chr(0xFF).chr(0xFF).chr(0xFF).chr(0x00) will result as 16777215
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$Num</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; for(</span><span class="default">$TC1</span><span class="keyword">=</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$Str</span><span class="keyword">)-</span><span class="default">1</span><span class="keyword">;</span><span class="default">$TC1</span><span class="keyword">&gt;=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$TC1</span><span class="keyword">--){ </span><span class="comment">//go from most significant byte
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$Num</span><span class="keyword">&lt;&lt;=</span><span class="default">8</span><span class="keyword">; </span><span class="comment">//shift to left by one byte (8 bits)
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$Num</span><span class="keyword">|=</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$Str</span><span class="keyword">[</span><span class="default">$TC1</span><span class="keyword">]); </span><span class="comment">//add new byte
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">}
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$Num</span><span class="keyword">;
<br />
}
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
ENJOY!!!
<br />
wdim</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92941""></a>
  <div class="note">
   <strong class="user">yarms at mail dot ru</strong>
   <a href="#92941" class="date">15-Aug-2009 06:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
very short version of function for unzipping files with folders structure:<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">unzip</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">){<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$zip</span><span class="keyword">=</span><span class="default">zip_open</span><span class="keyword">(</span><span class="default">realpath</span><span class="keyword">(</span><span class="string">"."</span><span class="keyword">).</span><span class="string">"/"</span><span class="keyword">.</span><span class="default">$file</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if(!</span><span class="default">$zip</span><span class="keyword">) {return(</span><span class="string">"Unable to proccess file '</span><span class="keyword">{</span><span class="default">$file</span><span class="keyword">}</span><span class="string">'"</span><span class="keyword">);}<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$e</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; while(</span><span class="default">$zip_entry</span><span class="keyword">=</span><span class="default">zip_read</span><span class="keyword">(</span><span class="default">$zip</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$zdir</span><span class="keyword">=</span><span class="default">dirname</span><span class="keyword">(</span><span class="default">zip_entry_name</span><span class="keyword">(</span><span class="default">$zip_entry</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$zname</span><span class="keyword">=</span><span class="default">zip_entry_name</span><span class="keyword">(</span><span class="default">$zip_entry</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; if(!</span><span class="default">zip_entry_open</span><span class="keyword">(</span><span class="default">$zip</span><span class="keyword">,</span><span class="default">$zip_entry</span><span class="keyword">,</span><span class="string">"r"</span><span class="keyword">)) {</span><span class="default">$e</span><span class="keyword">.=</span><span class="string">"Unable to proccess file '</span><span class="keyword">{</span><span class="default">$zname</span><span class="keyword">}</span><span class="string">'"</span><span class="keyword">;continue;}<br />
&nbsp;&nbsp; &nbsp; &nbsp; if(!</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$zdir</span><span class="keyword">)) </span><span class="default">mkdirr</span><span class="keyword">(</span><span class="default">$zdir</span><span class="keyword">,</span><span class="default">0777</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="comment">#print "{$zdir} | {$zname} \n";<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$zip_fs</span><span class="keyword">=</span><span class="default">zip_entry_filesize</span><span class="keyword">(</span><span class="default">$zip_entry</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; if(empty(</span><span class="default">$zip_fs</span><span class="keyword">)) continue;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$zz</span><span class="keyword">=</span><span class="default">zip_entry_read</span><span class="keyword">(</span><span class="default">$zip_entry</span><span class="keyword">,</span><span class="default">$zip_fs</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$z</span><span class="keyword">=</span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$zname</span><span class="keyword">,</span><span class="string">"w"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$z</span><span class="keyword">,</span><span class="default">$zz</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$z</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">zip_entry_close</span><span class="keyword">(</span><span class="default">$zip_entry</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; } <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">zip_close</span><span class="keyword">(</span><span class="default">$zip</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; return(</span><span class="default">$e</span><span class="keyword">);<br />
} <br />
<br />
function </span><span class="default">mkdirr</span><span class="keyword">(</span><span class="default">$pn</span><span class="keyword">,</span><span class="default">$mode</span><span class="keyword">=</span><span class="default">null</span><span class="keyword">) {<br />
<br />
&nbsp; if(</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$pn</span><span class="keyword">)||empty(</span><span class="default">$pn</span><span class="keyword">)) return </span><span class="default">true</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$pn</span><span class="keyword">=</span><span class="default">str_replace</span><span class="keyword">(array(</span><span class="string">'/'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">),</span><span class="default">DIRECTORY_SEPARATOR</span><span class="keyword">,</span><span class="default">$pn</span><span class="keyword">);<br />
<br />
&nbsp; if(</span><span class="default">is_file</span><span class="keyword">(</span><span class="default">$pn</span><span class="keyword">)) {</span><span class="default">trigger_error</span><span class="keyword">(</span><span class="string">'mkdirr() File exists'</span><span class="keyword">, </span><span class="default">E_USER_WARNING</span><span class="keyword">);return </span><span class="default">false</span><span class="keyword">;}<br />
<br />
&nbsp; </span><span class="default">$next_pathname</span><span class="keyword">=</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$pn</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">strrpos</span><span class="keyword">(</span><span class="default">$pn</span><span class="keyword">,</span><span class="default">DIRECTORY_SEPARATOR</span><span class="keyword">));<br />
&nbsp; if(</span><span class="default">mkdirr</span><span class="keyword">(</span><span class="default">$next_pathname</span><span class="keyword">,</span><span class="default">$mode</span><span class="keyword">)) {if(!</span><span class="default">file_exists</span><span class="keyword">(</span><span class="default">$pn</span><span class="keyword">)) {return </span><span class="default">mkdir</span><span class="keyword">(</span><span class="default">$pn</span><span class="keyword">,</span><span class="default">$mode</span><span class="keyword">);} }<br />
&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">unzip</span><span class="keyword">(</span><span class="string">"test.zip"</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
have a nice day :)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83800""></a>
  <div class="note">
   <strong class="user">phillpafford+php at gmail dot com</strong>
   <a href="#83800" class="date">12-Jun-2008 03:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You could just use the linux commands<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">// Get the date<br />
</span><span class="default">$date </span><span class="keyword">= </span><span class="default">date</span><span class="keyword">(</span><span class="string">"m-d-y"</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Make Zip name<br />
</span><span class="default">$zipname </span><span class="keyword">= </span><span class="string">"archive/site-script-backup." </span><span class="keyword">. </span><span class="default">$date </span><span class="keyword">. </span><span class="string">".zip"</span><span class="keyword">;<br />
<br />
</span><span class="comment">// Make a zip file<br />
</span><span class="default">$cmd </span><span class="keyword">= `</span><span class="string">zip -r </span><span class="default">$zipname</span><span class="string"> *</span><span class="keyword">`;<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="80705""></a>
  <div class="note">
   <strong class="user">rodrigo dot moraes at gmail dot com</strong>
   <a href="#80705" class="date">29-Jan-2008 04:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's a more simple extended class to add a whole directory recursively, keeping the same structure. It uses SPL.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">class </span><span class="default">MyZipArchive </span><span class="keyword">extends </span><span class="default">ZipArchive
<br />
</span><span class="keyword">{
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**
<br />
&nbsp;&nbsp; &nbsp; *
<br />
&nbsp;&nbsp; &nbsp; * Adds a directory recursively.
<br />
&nbsp;&nbsp; &nbsp; *
<br />
&nbsp;&nbsp; &nbsp; * @param string $filename The path to the file to add.
<br />
&nbsp;&nbsp; &nbsp; *
<br />
&nbsp;&nbsp; &nbsp; * @param string $localname Local name inside ZIP archive.
<br />
&nbsp;&nbsp; &nbsp; *
<br />
&nbsp;&nbsp; &nbsp; */
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public function </span><span class="default">addDir</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">, </span><span class="default">$localname</span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">addEmptyDir</span><span class="keyword">(</span><span class="default">$localname</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$iter </span><span class="keyword">= new </span><span class="default">RecursiveDirectoryIterator</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">, </span><span class="default">FilesystemIterator</span><span class="keyword">::</span><span class="default">SKIP_DOTS</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$iter </span><span class="keyword">as </span><span class="default">$fileinfo</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (! </span><span class="default">$fileinfo</span><span class="keyword">-&gt;</span><span class="default">isFile</span><span class="keyword">() &amp;&amp; !</span><span class="default">$fileinfo</span><span class="keyword">-&gt;</span><span class="default">isDir</span><span class="keyword">()) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; continue;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$method </span><span class="keyword">= </span><span class="default">$fileinfo</span><span class="keyword">-&gt;</span><span class="default">isFile</span><span class="keyword">() ? </span><span class="string">'addFile' </span><span class="keyword">: </span><span class="string">'addDir'</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">$method</span><span class="keyword">(</span><span class="default">$fileinfo</span><span class="keyword">-&gt;</span><span class="default">getPathname</span><span class="keyword">(), </span><span class="default">$localname </span><span class="keyword">. </span><span class="string">'/' </span><span class="keyword">.
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fileinfo</span><span class="keyword">-&gt;</span><span class="default">getFilename</span><span class="keyword">());
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />
}
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
[EDIT BY danbrown AT php DOT net: Contains a bugfix suggested by (bart AT blueberry DOT nl) on 29-JUN-2011 with the following message. "Fix for the endless Iteratore add the flag FilesystemIterator::SKIP_DOTS"]</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="79057""></a>
  <div class="note">
   <strong class="user">mmj48 at gmail dot com</strong>
   <a href="#79057" class="date">08-Nov-2007 02:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Heres a function I wrote that will extract a zip file with the same directory structure...<br />
<br />
Enjoy:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">unzip</span><span class="keyword">(</span><span class="default">$zipfile</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$zip </span><span class="keyword">= </span><span class="default">zip_open</span><span class="keyword">(</span><span class="default">$zipfile</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; while (</span><span class="default">$zip_entry </span><span class="keyword">= </span><span class="default">zip_read</span><span class="keyword">(</span><span class="default">$zip</span><span class="keyword">))&nbsp; &nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">zip_entry_open</span><span class="keyword">(</span><span class="default">$zip</span><span class="keyword">, </span><span class="default">$zip_entry</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">substr</span><span class="keyword">(</span><span class="default">zip_entry_name</span><span class="keyword">(</span><span class="default">$zip_entry</span><span class="keyword">), -</span><span class="default">1</span><span class="keyword">) == </span><span class="string">'/'</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$zdir </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">zip_entry_name</span><span class="keyword">(</span><span class="default">$zip_entry</span><span class="keyword">), </span><span class="default">0</span><span class="keyword">, -</span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">file_exists</span><span class="keyword">(</span><span class="default">$zdir</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">trigger_error</span><span class="keyword">(</span><span class="string">'Directory "&lt;b&gt;' </span><span class="keyword">. </span><span class="default">$zdir </span><span class="keyword">. </span><span class="string">'&lt;/b&gt;" exists'</span><span class="keyword">, </span><span class="default">E_USER_ERROR</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">mkdir</span><span class="keyword">(</span><span class="default">$zdir</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$name </span><span class="keyword">= </span><span class="default">zip_entry_name</span><span class="keyword">(</span><span class="default">$zip_entry</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">file_exists</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">trigger_error</span><span class="keyword">(</span><span class="string">'File "&lt;b&gt;' </span><span class="keyword">. </span><span class="default">$name </span><span class="keyword">. </span><span class="string">'&lt;/b&gt;" exists'</span><span class="keyword">, </span><span class="default">E_USER_ERROR</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fopen </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">, </span><span class="string">"w"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fopen</span><span class="keyword">, </span><span class="default">zip_entry_read</span><span class="keyword">(</span><span class="default">$zip_entry</span><span class="keyword">, </span><span class="default">zip_entry_filesize</span><span class="keyword">(</span><span class="default">$zip_entry</span><span class="keyword">)), </span><span class="default">zip_entry_filesize</span><span class="keyword">(</span><span class="default">$zip_entry</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">zip_entry_close</span><span class="keyword">(</span><span class="default">$zip_entry</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">zip_close</span><span class="keyword">(</span><span class="default">$zip</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">true</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="78940""></a>
  <div class="note">
   <strong class="user">nheimann at gmx dot net</strong>
   <a href="#78940" class="date">03-Nov-2007 04:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
With this extension you can Add dirs with files with the ZipArchive Object
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="comment">/**
<br />
&nbsp;* FlxZipArchive, Extends ZipArchiv. 
<br />
&nbsp;* Add Dirs with Files and Subdirs.
<br />
&nbsp;*
<br />
&nbsp;* &lt;code&gt;
<br />
&nbsp;*&nbsp; $archive = new FlxZipArchive;
<br />
&nbsp;*&nbsp; // .....
<br />
&nbsp;*&nbsp; $archive-&gt;addDir( 'test/blub', 'blub' );
<br />
&nbsp;* &lt;/code&gt;
<br />
&nbsp;*/
<br />
</span><span class="keyword">class </span><span class="default">FlxZipArchive </span><span class="keyword">extends </span><span class="default">ZipArchive </span><span class="keyword">{
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**
<br />
&nbsp;&nbsp; &nbsp; * Add a Dir with Files and Subdirs to the archive
<br />
&nbsp;&nbsp; &nbsp; *
<br />
&nbsp;&nbsp; &nbsp; * @param string $location Real Location
<br />
&nbsp;&nbsp; &nbsp; * @param string $name Name in Archive
<br />
&nbsp;&nbsp; &nbsp; * @author Nicolas Heimann 
<br />
&nbsp;&nbsp; &nbsp; * @access private
<br />
&nbsp;&nbsp; &nbsp; **/
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public function </span><span class="default">addDir</span><span class="keyword">(</span><span class="default">$location</span><span class="keyword">, </span><span class="default">$name</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">addEmptyDir</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">addDirDo</span><span class="keyword">(</span><span class="default">$location</span><span class="keyword">, </span><span class="default">$name</span><span class="keyword">);
<br />
</span><span class="comment">//&nbsp; &nbsp;&nbsp; } // EO addDir;
<br />

<br />
&nbsp;&nbsp;&nbsp; /**
<br />
&nbsp;&nbsp; &nbsp; * Add Files &amp; Dirs to archive.
<br />
&nbsp;&nbsp; &nbsp; *
<br />
&nbsp;&nbsp; &nbsp; * @param string $location Real Location
<br />
&nbsp;&nbsp; &nbsp; * @param string $name Name in Archive
<br />
&nbsp;&nbsp; &nbsp; * @author Nicolas Heimann 
<br />
&nbsp;&nbsp; &nbsp; * @access private
<br />
&nbsp;&nbsp; &nbsp; **/
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">private function </span><span class="default">addDirDo</span><span class="keyword">(</span><span class="default">$location</span><span class="keyword">, </span><span class="default">$name</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$name </span><span class="keyword">.= </span><span class="string">'/'</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$location </span><span class="keyword">.= </span><span class="string">'/'</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Read all Files in Dir
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dir </span><span class="keyword">= </span><span class="default">opendir </span><span class="keyword">(</span><span class="default">$location</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while (</span><span class="default">$file </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">))
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$file </span><span class="keyword">== </span><span class="string">'.' </span><span class="keyword">|| </span><span class="default">$file </span><span class="keyword">== </span><span class="string">'..'</span><span class="keyword">) continue;
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Rekursiv, If dir: FlxZipArchive::addDir(), else ::File();
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$do </span><span class="keyword">= (</span><span class="default">filetype</span><span class="keyword">() == </span><span class="string">'dir'</span><span class="keyword">) ? </span><span class="string">'addDir' </span><span class="keyword">: </span><span class="string">'addFile'</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">$do</span><span class="keyword">(</span><span class="default">$location </span><span class="keyword">. </span><span class="default">$file</span><span class="keyword">, </span><span class="default">$name </span><span class="keyword">. </span><span class="default">$file</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; } </span><span class="comment">// EO addDirDo();
<br />
</span><span class="keyword">}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75984""></a>
  <div class="note">
   <strong class="user">bushj at rpi dot edu</strong>
   <a href="#75984" class="date">25-Jun-2007 07:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I made a zip stream handler in case your distribution does not have the built in one using the new ZipArchive system. This one also features the ability to grab entries by index as well as by name. It is similar in capabilities to the builtin gzip/bzip2 compression stream handlers (<a href="http://us2.php.net/manual/en/wrappers.compression.php" rel="nofollow" target="_blank">http://us2.php.net/manual/en/wrappers.compression.php</a>) except it does not support writing.<br />
<br />
To use:<br />
fopen('zip://absolute/path/to/file.zip?entryname', $mode) or<br />
fopen('zip://absolute/path/to/file.zip#entryindex', $mode) or<br />
fopen('zip://absolute/path/to/file.zip', $mode)<br />
<br />
$mode can only be 'r' or 'rb'. In the last case the first entry in the zip file is used.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">ZipStream </span><span class="keyword">{<br />
&nbsp; public </span><span class="default">$zip</span><span class="keyword">; </span><span class="comment">//the zip file<br />
&nbsp; </span><span class="keyword">public </span><span class="default">$entry</span><span class="keyword">; </span><span class="comment">//the opened zip entry<br />
&nbsp; </span><span class="keyword">public </span><span class="default">$length</span><span class="keyword">; </span><span class="comment">//the uncompressed size of the zip entry<br />
&nbsp; </span><span class="keyword">public </span><span class="default">$position</span><span class="keyword">; </span><span class="comment">//the current position in the zip entry read<br />
&nbsp; //Opens the zip file then retrieves and opens the entry to stream <br />
&nbsp; </span><span class="keyword">public function </span><span class="default">stream_open</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">, </span><span class="default">$mode</span><span class="keyword">, </span><span class="default">$options</span><span class="keyword">, &amp;</span><span class="default">$opened_path</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$mode </span><span class="keyword">!= </span><span class="string">'r' </span><span class="keyword">&amp;&amp; </span><span class="default">$mode </span><span class="keyword">!= </span><span class="string">'rb'</span><span class="keyword">) </span><span class="comment">//only accept r and rb modes, no writing!<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$path </span><span class="keyword">= </span><span class="string">'file:///'</span><span class="keyword">.</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">, </span><span class="default">6</span><span class="keyword">); </span><span class="comment">//switch out file:/// for zip:// so we can use url_parse<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$url </span><span class="keyword">= </span><span class="default">parse_url</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//open the zip file<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$filename </span><span class="keyword">= </span><span class="default">$url</span><span class="keyword">[</span><span class="string">'path'</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">zip </span><span class="keyword">= </span><span class="default">zip_open</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if (!</span><span class="default">is_resource</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">zip</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//if entry name is given, find that entry&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">array_key_exists</span><span class="keyword">(</span><span class="string">'query'</span><span class="keyword">, </span><span class="default">$url</span><span class="keyword">) &amp;&amp; </span><span class="default">$url</span><span class="keyword">[</span><span class="string">'query'</span><span class="keyword">]) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$path </span><span class="keyword">= </span><span class="default">$url</span><span class="keyword">[</span><span class="string">'query'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp;&nbsp; do {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">entry </span><span class="keyword">= </span><span class="default">zip_read</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">zip</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">is_resource</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">entry</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; } while (</span><span class="default">zip_entry_name</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">entry</span><span class="keyword">) != </span><span class="default">$path</span><span class="keyword">);&nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; } else { </span><span class="comment">//otherwise get it by index (default to 0)<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$id </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (</span><span class="default">array_key_exists</span><span class="keyword">(</span><span class="string">'fragment'</span><span class="keyword">, </span><span class="default">$url</span><span class="keyword">) &amp;&amp; </span><span class="default">is_int</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">[</span><span class="string">'fragment'</span><span class="keyword">]))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$id </span><span class="keyword">= </span><span class="default">$url</span><span class="keyword">[</span><span class="string">'fragment'</span><span class="keyword">]*</span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt;= </span><span class="default">$id</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">entry </span><span class="keyword">= </span><span class="default">zip_read</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">zip</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">is_resource</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">entry</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//setup length and open the entry for reading<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">length </span><span class="keyword">= </span><span class="default">zip_entry_filesize</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">entry</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">position </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">zip_entry_open</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">zip</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">entry</span><span class="keyword">, </span><span class="default">$mode</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">true</span><span class="keyword">;<br />
&nbsp; }<br />
&nbsp; </span><span class="comment">//Closes the zip entry and file<br />
&nbsp; </span><span class="keyword">public function </span><span class="default">stream_close</span><span class="keyword">() { @</span><span class="default">zip_entry_close</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">entry</span><span class="keyword">); @</span><span class="default">zip_close</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">zip</span><span class="keyword">); }<br />
&nbsp; </span><span class="comment">//Returns how many bytes have been read from the zip entry<br />
&nbsp; </span><span class="keyword">public function </span><span class="default">stream_tell</span><span class="keyword">() { return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">position</span><span class="keyword">; }<br />
&nbsp; </span><span class="comment">//Returns true if the end of the zip entry has been reached<br />
&nbsp; </span><span class="keyword">public function </span><span class="default">stream_eof</span><span class="keyword">() { return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">position </span><span class="keyword">&gt;= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">length</span><span class="keyword">; }<br />
&nbsp; </span><span class="comment">//Returns the stat array, only 'size' is filled in with the uncompressed zip entry size<br />
&nbsp; </span><span class="keyword">public function </span><span class="default">url_stat</span><span class="keyword">() { return array(</span><span class="string">'dev'</span><span class="keyword">=&gt;</span><span class="default">0</span><span class="keyword">, </span><span class="string">'ino'</span><span class="keyword">=&gt;</span><span class="default">0</span><span class="keyword">, </span><span class="string">'mode'</span><span class="keyword">=&gt;</span><span class="default">0</span><span class="keyword">, </span><span class="string">'nlink'</span><span class="keyword">=&gt;</span><span class="default">0</span><span class="keyword">, </span><span class="string">'uid'</span><span class="keyword">=&gt;</span><span class="default">0</span><span class="keyword">, </span><span class="string">'gid'</span><span class="keyword">=&gt;</span><span class="default">0</span><span class="keyword">, </span><span class="string">'rdev'</span><span class="keyword">=&gt;</span><span class="default">0</span><span class="keyword">, </span><span class="string">'size'</span><span class="keyword">=&gt;</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">length</span><span class="keyword">, </span><span class="string">'atime'</span><span class="keyword">=&gt;</span><span class="default">0</span><span class="keyword">, </span><span class="string">'mtime'</span><span class="keyword">=&gt;</span><span class="default">0</span><span class="keyword">, </span><span class="string">'ctime'</span><span class="keyword">=&gt;</span><span class="default">0</span><span class="keyword">, </span><span class="string">'blksize'</span><span class="keyword">=&gt;</span><span class="default">0</span><span class="keyword">, </span><span class="string">'blocks'</span><span class="keyword">=&gt;</span><span class="default">0</span><span class="keyword">); }<br />
&nbsp; </span><span class="comment">//Reads the next $count bytes or until the end of the zip entry. Returns the data or false if no data was read.<br />
&nbsp; </span><span class="keyword">public function </span><span class="default">stream_read</span><span class="keyword">(</span><span class="default">$count</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">position </span><span class="keyword">+= </span><span class="default">$count</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">position </span><span class="keyword">&gt; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">length</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">position </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">length</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">zip_entry_read</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">entry</span><span class="keyword">, </span><span class="default">$count</span><span class="keyword">);<br />
&nbsp; }<br />
}<br />
</span><span class="comment">//Register the zip stream handler<br />
</span><span class="default">stream_wrapper_register</span><span class="keyword">(</span><span class="string">'zip'</span><span class="keyword">, </span><span class="string">'ZipStream'</span><span class="keyword">); </span><span class="comment">//if this fails there is already a zip stream handler and we will just use that one<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75079""></a>
  <div class="note">
   <strong class="user">nielsvandenberge at hotmail dot com</strong>
   <a href="#75079" class="date">11-May-2007 11:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is the function I use to unzip a file. <br />
It includes the following options:<br />
* Unzip in any directory you like<br />
* Unzip in the directory of the zip file<br />
* Unzip in a directory with the zipfile's name in the directory of the zip file. (i.e.: C:\test.zip will be unzipped in&nbsp; C:\test\)<br />
* Overwrite existing files or not<br />
* It creates non existing directories with the function Create_dirs($path)<br />
<br />
You should use absolute paths with slashes (/) instead of backslashes (\).<br />
I tested it with PHP 5.2.0 with php_zip.dll extension loaded<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/**<br />
&nbsp;* Unzip the source_file in the destination dir<br />
&nbsp;*<br />
&nbsp;* @param&nbsp;&nbsp; string&nbsp; &nbsp; &nbsp; The path to the ZIP-file.<br />
&nbsp;* @param&nbsp;&nbsp; string&nbsp; &nbsp; &nbsp; The path where the zipfile should be unpacked, if false the directory of the zip-file is used<br />
&nbsp;* @param&nbsp;&nbsp; boolean&nbsp; &nbsp;&nbsp; Indicates if the files will be unpacked in a directory with the name of the zip-file (true) or not (false) (only if the destination directory is set to false!)<br />
&nbsp;* @param&nbsp;&nbsp; boolean&nbsp; &nbsp;&nbsp; Overwrite existing files (true) or not (false)<br />
&nbsp;*&nbsp; <br />
&nbsp;* @return&nbsp; boolean&nbsp; &nbsp;&nbsp; Succesful or not<br />
&nbsp;*/<br />
</span><span class="keyword">function </span><span class="default">unzip</span><span class="keyword">(</span><span class="default">$src_file</span><span class="keyword">, </span><span class="default">$dest_dir</span><span class="keyword">=</span><span class="default">false</span><span class="keyword">, </span><span class="default">$create_zip_name_dir</span><span class="keyword">=</span><span class="default">true</span><span class="keyword">, </span><span class="default">$overwrite</span><span class="keyword">=</span><span class="default">true</span><span class="keyword">) <br />
{<br />
&nbsp; if (</span><span class="default">$zip </span><span class="keyword">= </span><span class="default">zip_open</span><span class="keyword">(</span><span class="default">$src_file</span><span class="keyword">)) <br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$zip</span><span class="keyword">) <br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$splitter </span><span class="keyword">= (</span><span class="default">$create_zip_name_dir </span><span class="keyword">=== </span><span class="default">true</span><span class="keyword">) ? </span><span class="string">"." </span><span class="keyword">: </span><span class="string">"/"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (</span><span class="default">$dest_dir </span><span class="keyword">=== </span><span class="default">false</span><span class="keyword">) </span><span class="default">$dest_dir </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$src_file</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">strrpos</span><span class="keyword">(</span><span class="default">$src_file</span><span class="keyword">, </span><span class="default">$splitter</span><span class="keyword">)).</span><span class="string">"/"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="comment">// Create the directories to the destination dir if they don't already exist<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">create_dirs</span><span class="keyword">(</span><span class="default">$dest_dir</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="comment">// For every file in the zip-packet<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="keyword">while (</span><span class="default">$zip_entry </span><span class="keyword">= </span><span class="default">zip_read</span><span class="keyword">(</span><span class="default">$zip</span><span class="keyword">)) <br />
&nbsp;&nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Now we're going to create the directories in the destination directories<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // If the file is not in the root dir<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pos_last_slash </span><span class="keyword">= </span><span class="default">strrpos</span><span class="keyword">(</span><span class="default">zip_entry_name</span><span class="keyword">(</span><span class="default">$zip_entry</span><span class="keyword">), </span><span class="string">"/"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$pos_last_slash </span><span class="keyword">!== </span><span class="default">false</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Create the directory where the zip-entry should be saved (with a "/" at the end)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">create_dirs</span><span class="keyword">(</span><span class="default">$dest_dir</span><span class="keyword">.</span><span class="default">substr</span><span class="keyword">(</span><span class="default">zip_entry_name</span><span class="keyword">(</span><span class="default">$zip_entry</span><span class="keyword">), </span><span class="default">0</span><span class="keyword">, </span><span class="default">$pos_last_slash</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Open the entry<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">zip_entry_open</span><span class="keyword">(</span><span class="default">$zip</span><span class="keyword">,</span><span class="default">$zip_entry</span><span class="keyword">,</span><span class="string">"r"</span><span class="keyword">)) <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// The name of the file to save on the disk<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$file_name </span><span class="keyword">= </span><span class="default">$dest_dir</span><span class="keyword">.</span><span class="default">zip_entry_name</span><span class="keyword">(</span><span class="default">$zip_entry</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Check if the files should be overwritten or not<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$overwrite </span><span class="keyword">=== </span><span class="default">true </span><span class="keyword">|| </span><span class="default">$overwrite </span><span class="keyword">=== </span><span class="default">false </span><span class="keyword">&amp;&amp; !</span><span class="default">is_file</span><span class="keyword">(</span><span class="default">$file_name</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Get the content of the zip entry<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fstream </span><span class="keyword">= </span><span class="default">zip_entry_read</span><span class="keyword">(</span><span class="default">$zip_entry</span><span class="keyword">, </span><span class="default">zip_entry_filesize</span><span class="keyword">(</span><span class="default">$zip_entry</span><span class="keyword">));<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">file_put_contents</span><span class="keyword">(</span><span class="default">$file_name</span><span class="keyword">, </span><span class="default">$fstream </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Set the rights<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">chmod</span><span class="keyword">(</span><span class="default">$file_name</span><span class="keyword">, </span><span class="default">0777</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"save: "</span><span class="keyword">.</span><span class="default">$file_name</span><span class="keyword">.</span><span class="string">"&lt;br /&gt;"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Close the entry<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">zip_entry_close</span><span class="keyword">(</span><span class="default">$zip_entry</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="comment">// Close the zip-file<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">zip_close</span><span class="keyword">(</span><span class="default">$zip</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; } <br />
&nbsp; else<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp; }<br />
&nbsp; <br />
&nbsp; return </span><span class="default">true</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="comment">/**<br />
&nbsp;* This function creates recursive directories if it doesn't already exist<br />
&nbsp;*<br />
&nbsp;* @param String&nbsp; The path that should be created<br />
&nbsp;*&nbsp; <br />
&nbsp;* @return&nbsp; void<br />
&nbsp;*/<br />
</span><span class="keyword">function </span><span class="default">create_dirs</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">)<br />
{<br />
&nbsp; if (!</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">))<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$directory_path </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$directories </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">"/"</span><span class="keyword">,</span><span class="default">$path</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">array_pop</span><span class="keyword">(</span><span class="default">$directories</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; foreach(</span><span class="default">$directories </span><span class="keyword">as </span><span class="default">$directory</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$directory_path </span><span class="keyword">.= </span><span class="default">$directory</span><span class="keyword">.</span><span class="string">"/"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (!</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$directory_path</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">mkdir</span><span class="keyword">(</span><span class="default">$directory_path</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">chmod</span><span class="keyword">(</span><span class="default">$directory_path</span><span class="keyword">, </span><span class="default">0777</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
}<br />
<br />
</span><span class="comment">// Extract C:/zipfiletest/zip-file.zip to C:/zipfiletest/zip-file/ and overwrites existing files<br />
</span><span class="default">unzip</span><span class="keyword">(</span><span class="string">"C:/zipfiletest/zip-file.zip"</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Extract C:/zipfiletest/zip-file.zip to C:/another_map/zipfiletest/ and doesn't overwrite existing files. NOTE: It doesn't create a map with the zip-file-name!<br />
</span><span class="default">unzip</span><span class="keyword">(</span><span class="string">"C:/zipfiletest/zip-file.zip"</span><span class="keyword">, </span><span class="string">"C:/another_map/zipfiletest/"</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74847""></a>
  <div class="note">
   <strong class="user">jeswanth@gmail</strong>
   <a href="#74847" class="date">30-Apr-2007 09:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hi, all<br />
<br />
There are lot of functions given below which etracts files, but what they lack is setting file permissions. On some servers file permissions are very important and the script cease to work after creating first directory, So I have added chmod to the code. There is only one limitation to the code, files without file extension are neither treated as files or directories so they are not chmoded, anyway this does not affect the code. Hope this helps.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">unpackZip</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">,</span><span class="default">$file</span><span class="keyword">) {<br />
&nbsp;&nbsp; if (</span><span class="default">$zip </span><span class="keyword">= </span><span class="default">zip_open</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">.</span><span class="default">$file</span><span class="keyword">.</span><span class="string">".zip"</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; if (</span><span class="default">$zip</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">mkdir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">.</span><span class="default">$file</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">chmod</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">.</span><span class="default">$file</span><span class="keyword">, </span><span class="default">0777</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; while (</span><span class="default">$zip_entry </span><span class="keyword">= </span><span class="default">zip_read</span><span class="keyword">(</span><span class="default">$zip</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">zip_entry_open</span><span class="keyword">(</span><span class="default">$zip</span><span class="keyword">,</span><span class="default">$zip_entry</span><span class="keyword">,</span><span class="string">"r"</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$buf </span><span class="keyword">= </span><span class="default">zip_entry_read</span><span class="keyword">(</span><span class="default">$zip_entry</span><span class="keyword">, </span><span class="default">zip_entry_filesize</span><span class="keyword">(</span><span class="default">$zip_entry</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$dir_name </span><span class="keyword">= </span><span class="default">dirname</span><span class="keyword">(</span><span class="default">zip_entry_name</span><span class="keyword">(</span><span class="default">$zip_entry</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$dir_name </span><span class="keyword">!= </span><span class="string">"."</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$dir_op </span><span class="keyword">= </span><span class="default">$dir</span><span class="keyword">.</span><span class="default">$file</span><span class="keyword">.</span><span class="string">"/"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach ( </span><span class="default">explode</span><span class="keyword">(</span><span class="string">"/"</span><span class="keyword">,</span><span class="default">$dir_name</span><span class="keyword">) as </span><span class="default">$k</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$dir_op </span><span class="keyword">= </span><span class="default">$dir_op </span><span class="keyword">. </span><span class="default">$k</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">is_file</span><span class="keyword">(</span><span class="default">$dir_op</span><span class="keyword">)) </span><span class="default">unlink</span><span class="keyword">(</span><span class="default">$dir_op</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (!</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$dir_op</span><span class="keyword">)) </span><span class="default">mkdir</span><span class="keyword">(</span><span class="default">$dir_op</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">chmod</span><span class="keyword">(</span><span class="default">$dir_op</span><span class="keyword">, </span><span class="default">0777</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$dir_op </span><span class="keyword">= </span><span class="default">$dir_op </span><span class="keyword">. </span><span class="string">"/" </span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$fp</span><span class="keyword">=</span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">.</span><span class="default">$file</span><span class="keyword">.</span><span class="string">"/"</span><span class="keyword">.</span><span class="default">zip_entry_name</span><span class="keyword">(</span><span class="default">$zip_entry</span><span class="keyword">),</span><span class="string">"w+"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">chmod</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">.</span><span class="default">$file</span><span class="keyword">.</span><span class="string">"/"</span><span class="keyword">.</span><span class="default">zip_entry_name</span><span class="keyword">(</span><span class="default">$zip_entry</span><span class="keyword">), </span><span class="default">0777</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">,</span><span class="default">$buf</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">zip_entry_close</span><span class="keyword">(</span><span class="default">$zip_entry</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; } else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">zip_close</span><span class="keyword">(</span><span class="default">$zip</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; }<br />
&nbsp; } else<br />
&nbsp;&nbsp; &nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
<br />
&nbsp; return </span><span class="default">true</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">$dir </span><span class="keyword">= </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'DOCUMENT_ROOT'</span><span class="keyword">].</span><span class="string">"/"</span><span class="keyword">.</span><span class="string">"destdirectory/"</span><span class="keyword">;<br />
</span><span class="default">$file </span><span class="keyword">= </span><span class="string">'zipfilename_without_extension'</span><span class="keyword">;<br />
</span><span class="default">unpackZip</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">,</span><span class="default">$file</span><span class="keyword">);<br />
</span><span class="default">$print </span><span class="keyword">= </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'DOCUMENT_ROOT'</span><span class="keyword">];<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="70462""></a>
  <div class="note">
   <strong class="user">bholub at chiefprojects dot com</strong>
   <a href="#70462" class="date">17-Oct-2006 09:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This will simply unpack (including directories) $zip to $dir -- in this example the zip is being uploaded.<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; $dir </span><span class="keyword">= </span><span class="string">'C:\\reports-temp\\'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$zip </span><span class="keyword">= </span><span class="default">zip_open</span><span class="keyword">(</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">'report_zip'</span><span class="keyword">][</span><span class="string">'tmp_name'</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; while(</span><span class="default">$zip_entry </span><span class="keyword">= </span><span class="default">zip_read</span><span class="keyword">(</span><span class="default">$zip</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$entry </span><span class="keyword">= </span><span class="default">zip_entry_open</span><span class="keyword">(</span><span class="default">$zip</span><span class="keyword">,</span><span class="default">$zip_entry</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$filename </span><span class="keyword">= </span><span class="default">zip_entry_name</span><span class="keyword">(</span><span class="default">$zip_entry</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$target_dir </span><span class="keyword">= </span><span class="default">$dir</span><span class="keyword">.</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">strrpos</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">,</span><span class="string">'/'</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$filesize </span><span class="keyword">= </span><span class="default">zip_entry_filesize</span><span class="keyword">(</span><span class="default">$zip_entry</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$target_dir</span><span class="keyword">) || </span><span class="default">mkdir</span><span class="keyword">(</span><span class="default">$target_dir</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$filesize </span><span class="keyword">&gt; </span><span class="default">0</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$contents </span><span class="keyword">= </span><span class="default">zip_entry_read</span><span class="keyword">(</span><span class="default">$zip_entry</span><span class="keyword">, </span><span class="default">$filesize</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">file_put_contents</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">.</span><span class="default">$filename</span><span class="keyword">,</span><span class="default">$contents</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="61159""></a>
  <div class="note">
   <strong class="user">angelnsn1 at hotmail dot com</strong>
   <a href="#61159" class="date">27-Jan-2006 03:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
this function extract all files and subdirectories, you can choose verbose mode for get paths of files extracted. the function return a msg what indicate the error, if msg is OK, all is done.
<br />

<br />
---
<br />

<br />
code:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">unzip</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">, </span><span class="default">$file</span><span class="keyword">, </span><span class="default">$verbose </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">) {
<br />

<br />
&nbsp;&nbsp; </span><span class="default">$dir_path </span><span class="keyword">= </span><span class="string">"</span><span class="default">$dir$file</span><span class="string">"</span><span class="keyword">;
<br />
&nbsp;&nbsp; </span><span class="default">$zip_path </span><span class="keyword">= </span><span class="string">"</span><span class="default">$dir$file</span><span class="string">.zip"</span><span class="keyword">;
<br />
&nbsp;&nbsp; 
<br />
&nbsp;&nbsp; </span><span class="default">$ERROR_MSGS</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] = </span><span class="string">"OK"</span><span class="keyword">;
<br />
&nbsp;&nbsp; </span><span class="default">$ERROR_MSGS</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] = </span><span class="string">"Zip path </span><span class="default">$zip_path</span><span class="string"> doesn't exists."</span><span class="keyword">;
<br />
&nbsp;&nbsp; </span><span class="default">$ERROR_MSGS</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">] = </span><span class="string">"Directory </span><span class="default">$dir_path</span><span class="string"> for unzip the pack already exists, impossible continue."</span><span class="keyword">;
<br />
&nbsp;&nbsp; </span><span class="default">$ERROR_MSGS</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">] = </span><span class="string">"Error while opening the </span><span class="default">$zip_path</span><span class="string"> file."</span><span class="keyword">;
<br />
&nbsp;&nbsp; 
<br />
&nbsp;&nbsp; </span><span class="default">$ERROR </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp; 
<br />
&nbsp;&nbsp; if (</span><span class="default">file_exists</span><span class="keyword">(</span><span class="default">$zip_path</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; if (!</span><span class="default">file_exists</span><span class="keyword">(</span><span class="default">$dir_path</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">mkdir</span><span class="keyword">(</span><span class="default">$dir_path</span><span class="keyword">);&nbsp; &nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; if ((</span><span class="default">$link </span><span class="keyword">= </span><span class="default">zip_open</span><span class="keyword">(</span><span class="default">$zip_path</span><span class="keyword">))) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; while ((</span><span class="default">$zip_entry </span><span class="keyword">= </span><span class="default">zip_read</span><span class="keyword">(</span><span class="default">$link</span><span class="keyword">)) &amp;&amp; (!</span><span class="default">$ERROR</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">zip_entry_open</span><span class="keyword">(</span><span class="default">$link</span><span class="keyword">, </span><span class="default">$zip_entry</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">zip_entry_read</span><span class="keyword">(</span><span class="default">$zip_entry</span><span class="keyword">, </span><span class="default">zip_entry_filesize</span><span class="keyword">(</span><span class="default">$zip_entry</span><span class="keyword">));
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dir_name </span><span class="keyword">= </span><span class="default">dirname</span><span class="keyword">(</span><span class="default">zip_entry_name</span><span class="keyword">(</span><span class="default">$zip_entry</span><span class="keyword">));
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$name </span><span class="keyword">= </span><span class="default">zip_entry_name</span><span class="keyword">(</span><span class="default">$zip_entry</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$name</span><span class="keyword">[</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">)-</span><span class="default">1</span><span class="keyword">] == </span><span class="string">'/'</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$base </span><span class="keyword">= </span><span class="string">"</span><span class="default">$dir_path</span><span class="string">/"</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; foreach ( </span><span class="default">explode</span><span class="keyword">(</span><span class="string">"/"</span><span class="keyword">, </span><span class="default">$name</span><span class="keyword">) as </span><span class="default">$k</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$base </span><span class="keyword">.= </span><span class="string">"</span><span class="default">$k</span><span class="string">/"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">file_exists</span><span class="keyword">(</span><span class="default">$base</span><span class="keyword">))
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">mkdir</span><span class="keyword">(</span><span class="default">$base</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }&nbsp; &nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else { 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$name </span><span class="keyword">= </span><span class="string">"</span><span class="default">$dir_path</span><span class="string">/</span><span class="default">$name</span><span class="string">"</span><span class="keyword">; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$verbose</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo </span><span class="string">"extracting: </span><span class="default">$name</span><span class="string">&lt;br&gt;"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$stream </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">, </span><span class="string">"w"</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$stream</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">zip_entry_close</span><span class="keyword">(</span><span class="default">$zip_entry</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ERROR </span><span class="keyword">= </span><span class="default">4</span><span class="keyword">;&nbsp; &nbsp;&nbsp; 
<br />
&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">zip_close</span><span class="keyword">(</span><span class="default">$link</span><span class="keyword">);&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ERROR </span><span class="keyword">= </span><span class="string">"3"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; else 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ERROR </span><span class="keyword">= </span><span class="default">2</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; else 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$ERROR </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; return </span><span class="default">$ERROR_MSGS</span><span class="keyword">[</span><span class="default">$ERROR</span><span class="keyword">];&nbsp; &nbsp; &nbsp; &nbsp; 
<br />
&nbsp;&nbsp;&nbsp; 
<br />
}&nbsp; &nbsp; 
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
---
<br />

<br />
example:
<br />

<br />
<span class="default">&lt;?php
<br />
$error </span><span class="keyword">= </span><span class="default">unzip</span><span class="keyword">(</span><span class="string">"d:/www/dir/"</span><span class="keyword">, </span><span class="string">"zipname"</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);
<br />

<br />
echo </span><span class="default">$error</span><span class="keyword">;
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
---
<br />

<br />
i hope this help you,
<br />
good bye.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="56003""></a>
  <div class="note">
   <strong class="user">ringu at mail dot ru</strong>
   <a href="#56003" class="date">20-Aug-2005 03:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
i try to find function that will show exists file in zip archive or not. of course i not found it. and so write mine:
<br />

<br />
first will just check archive for list of files, if not found all files function return FALSE:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">zipx_entries_exists</span><span class="keyword">()
<br />
{
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$names</span><span class="keyword">=array();
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$args</span><span class="keyword">=</span><span class="default">func_get_args</span><span class="keyword">();
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$far_size</span><span class="keyword">=</span><span class="default">count</span><span class="keyword">(</span><span class="default">$args</span><span class="keyword">);&nbsp; &nbsp; 
<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$args</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">])
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for(; </span><span class="default">$zip_entry</span><span class="keyword">=</span><span class="default">zip_read</span><span class="keyword">(</span><span class="default">$args</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]); </span><span class="default">$names</span><span class="keyword">[]= </span><span class="default">zip_entry_name</span><span class="keyword">(</span><span class="default">$zip_entry</span><span class="keyword">));&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for(</span><span class="default">$x</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">; </span><span class="default">$x</span><span class="keyword">&lt;=</span><span class="default">$far_size</span><span class="keyword">; </span><span class="default">$t</span><span class="keyword">+=</span><span class="default">in_array</span><span class="keyword">(</span><span class="default">$args</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">], </span><span class="default">$names</span><span class="keyword">), </span><span class="default">$x</span><span class="keyword">++);&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$t</span><span class="keyword">==--</span><span class="default">$far_size</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }else{
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="string">'No zip file in descriptor!'</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
}
<br />

<br />
</span><span class="default">example</span><span class="keyword">: 
<br />
</span><span class="default">$zip</span><span class="keyword">=</span><span class="default">zip_open</span><span class="keyword">(</span><span class="string">'any_zip_file_zip'</span><span class="keyword">);
<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">zip_entries_exists</span><span class="keyword">(</span><span class="default">$zip</span><span class="keyword">, </span><span class="string">'photo_1.jpg'</span><span class="keyword">, </span><span class="string">'photo_2.jpg'</span><span class="keyword">));
<br />

<br />
</span><span class="default">second </span><span class="keyword">function </span><span class="default">will </span><span class="keyword">try </span><span class="default">to find files in zip</span><span class="keyword">, if </span><span class="default">not found it </span><span class="keyword">return </span><span class="default">string with names of not found files with specified delimeter</span><span class="keyword">:
<br />

<br />
function </span><span class="default">zipx_entries_nonexists_list</span><span class="keyword">()
<br />
{
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$names</span><span class="keyword">=array();
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$args</span><span class="keyword">=</span><span class="default">func_get_args</span><span class="keyword">();
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$m</span><span class="keyword">=</span><span class="default">NULL</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$far_size</span><span class="keyword">=</span><span class="default">count</span><span class="keyword">(</span><span class="default">$args</span><span class="keyword">);&nbsp; &nbsp; 
<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$args</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">])
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for(; </span><span class="default">$zip_entry</span><span class="keyword">=</span><span class="default">zip_read</span><span class="keyword">(</span><span class="default">$args</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]); </span><span class="default">$names</span><span class="keyword">[]= </span><span class="default">zip_entry_name</span><span class="keyword">(</span><span class="default">$zip_entry</span><span class="keyword">));&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for(</span><span class="default">$x</span><span class="keyword">=</span><span class="default">2</span><span class="keyword">; </span><span class="default">$x</span><span class="keyword">&lt;=</span><span class="default">$far_size</span><span class="keyword">; </span><span class="default">$m</span><span class="keyword">.=(</span><span class="default">in_array</span><span class="keyword">(</span><span class="default">$args</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">], </span><span class="default">$names</span><span class="keyword">) ? </span><span class="default">NULL </span><span class="keyword">: </span><span class="default">$args</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">].</span><span class="default">$args</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]), </span><span class="default">$x</span><span class="keyword">++);&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$m</span><span class="keyword">, </span><span class="default">$args</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }else{
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return </span><span class="string">'No zip file in descriptor!'</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
}
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
example: 
<br />
<span class="default">&lt;?php
<br />
$zip</span><span class="keyword">=</span><span class="default">zip_open</span><span class="keyword">(</span><span class="string">'any_zip_file_zip'</span><span class="keyword">);
<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">zip_entries_nonexists_list</span><span class="keyword">(</span><span class="default">$zip</span><span class="keyword">, </span><span class="string">'&lt;br /&gt;'</span><span class="keyword">, </span><span class="string">'photo_1.jpg'</span><span class="keyword">, </span><span class="string">'photo_2.jpg'</span><span class="keyword">));
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
it will return if not found files:
<br />
photo_1.jpg&lt;br /&gt;photo_2.jpg</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="54232""></a>
  <div class="note">
   <strong class="user">tom</strong>
   <a href="#54232" class="date">28-Jun-2005 06:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you just want to unzip a zip folder an alternative to some of the lengthy functions below is:
<br />

<br />
<span class="default">&lt;?php
<br />

<br />
</span><span class="keyword">function </span><span class="default">unzip</span><span class="keyword">(</span><span class="default">$zip_file</span><span class="keyword">, </span><span class="default">$src_dir</span><span class="keyword">, </span><span class="default">$extract_dir</span><span class="keyword">)
<br />
{
<br />
&nbsp;</span><span class="default">copy</span><span class="keyword">(</span><span class="default">$src_dir </span><span class="keyword">. </span><span class="string">"/" </span><span class="keyword">. </span><span class="default">$zip_file</span><span class="keyword">, </span><span class="default">$extract_dir </span><span class="keyword">. </span><span class="string">"/" </span><span class="keyword">. </span><span class="default">$zip_file</span><span class="keyword">);
<br />
&nbsp;</span><span class="default">chdir</span><span class="keyword">(</span><span class="default">$extract_dir</span><span class="keyword">);
<br />
&nbsp;</span><span class="default">shell_exec</span><span class="keyword">(</span><span class="string">"unzip </span><span class="default">$zip_file</span><span class="string">"</span><span class="keyword">);
<br />
}
<br />

<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
You don't need the ZIP extension for this.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="52310""></a>
  <div class="note">
   <strong class="user">candido1212 at yahoo dot com dot br</strong>
   <a href="#52310" class="date">27-Apr-2005 05:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
New Unzip function, recursive extract
<br />
Require mkdirr() (recursive create dir)
<br />

<br />
<span class="default">&lt;?php
<br />
$file </span><span class="keyword">= </span><span class="string">"2537c61ef7f47fc3ae919da08bcc1911.zip"</span><span class="keyword">;
<br />
</span><span class="default">$dir </span><span class="keyword">= </span><span class="default">getcwd</span><span class="keyword">();
<br />
function </span><span class="default">Unzip</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">, </span><span class="default">$file</span><span class="keyword">, </span><span class="default">$destiny</span><span class="keyword">=</span><span class="string">""</span><span class="keyword">)
<br />
{
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$dir </span><span class="keyword">.= </span><span class="default">DIRECTORY_SEPARATOR</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$path_file </span><span class="keyword">= </span><span class="default">$dir </span><span class="keyword">. </span><span class="default">$file</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$zip </span><span class="keyword">= </span><span class="default">zip_open</span><span class="keyword">(</span><span class="default">$path_file</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$_tmp </span><span class="keyword">= array();
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$count</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$zip</span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while (</span><span class="default">$zip_entry </span><span class="keyword">= </span><span class="default">zip_read</span><span class="keyword">(</span><span class="default">$zip</span><span class="keyword">))
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$_tmp</span><span class="keyword">[</span><span class="default">$count</span><span class="keyword">][</span><span class="string">"filename"</span><span class="keyword">] = </span><span class="default">zip_entry_name</span><span class="keyword">(</span><span class="default">$zip_entry</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$_tmp</span><span class="keyword">[</span><span class="default">$count</span><span class="keyword">][</span><span class="string">"stored_filename"</span><span class="keyword">] = </span><span class="default">zip_entry_name</span><span class="keyword">(</span><span class="default">$zip_entry</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$_tmp</span><span class="keyword">[</span><span class="default">$count</span><span class="keyword">][</span><span class="string">"size"</span><span class="keyword">] = </span><span class="default">zip_entry_filesize</span><span class="keyword">(</span><span class="default">$zip_entry</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$_tmp</span><span class="keyword">[</span><span class="default">$count</span><span class="keyword">][</span><span class="string">"compressed_size"</span><span class="keyword">] = </span><span class="default">zip_entry_compressedsize</span><span class="keyword">(</span><span class="default">$zip_entry</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$_tmp</span><span class="keyword">[</span><span class="default">$count</span><span class="keyword">][</span><span class="string">"mtime"</span><span class="keyword">] = </span><span class="string">""</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$_tmp</span><span class="keyword">[</span><span class="default">$count</span><span class="keyword">][</span><span class="string">"comment"</span><span class="keyword">] = </span><span class="string">""</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$_tmp</span><span class="keyword">[</span><span class="default">$count</span><span class="keyword">][</span><span class="string">"folder"</span><span class="keyword">] = </span><span class="default">dirname</span><span class="keyword">(</span><span class="default">zip_entry_name</span><span class="keyword">(</span><span class="default">$zip_entry</span><span class="keyword">));
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$_tmp</span><span class="keyword">[</span><span class="default">$count</span><span class="keyword">][</span><span class="string">"index"</span><span class="keyword">] = </span><span class="default">$count</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$_tmp</span><span class="keyword">[</span><span class="default">$count</span><span class="keyword">][</span><span class="string">"status"</span><span class="keyword">] = </span><span class="string">"ok"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$_tmp</span><span class="keyword">[</span><span class="default">$count</span><span class="keyword">][</span><span class="string">"method"</span><span class="keyword">] = </span><span class="default">zip_entry_compressionmethod</span><span class="keyword">(</span><span class="default">$zip_entry</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">zip_entry_open</span><span class="keyword">(</span><span class="default">$zip</span><span class="keyword">, </span><span class="default">$zip_entry</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">))
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$buf </span><span class="keyword">= </span><span class="default">zip_entry_read</span><span class="keyword">(</span><span class="default">$zip_entry</span><span class="keyword">, </span><span class="default">zip_entry_filesize</span><span class="keyword">(</span><span class="default">$zip_entry</span><span class="keyword">));
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$destiny</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$path_file </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"/"</span><span class="keyword">,</span><span class="default">DIRECTORY_SEPARATOR</span><span class="keyword">, </span><span class="default">$destiny </span><span class="keyword">. </span><span class="default">zip_entry_name</span><span class="keyword">(</span><span class="default">$zip_entry</span><span class="keyword">));
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$path_file </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"/"</span><span class="keyword">,</span><span class="default">DIRECTORY_SEPARATOR</span><span class="keyword">, </span><span class="default">$dir </span><span class="keyword">. </span><span class="default">zip_entry_name</span><span class="keyword">(</span><span class="default">$zip_entry</span><span class="keyword">));
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_dir </span><span class="keyword">= </span><span class="default">dirname</span><span class="keyword">(</span><span class="default">$path_file</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Create Recursive Directory
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">mkdirr</span><span class="keyword">(</span><span class="default">$new_dir</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$dir </span><span class="keyword">. </span><span class="default">zip_entry_name</span><span class="keyword">(</span><span class="default">$zip_entry</span><span class="keyword">), </span><span class="string">"w"</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">, </span><span class="default">$buf</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">zip_entry_close</span><span class="keyword">(</span><span class="default">$zip_entry</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"\n&lt;/pre&gt;"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$count</span><span class="keyword">++;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } 
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">zip_close</span><span class="keyword">(</span><span class="default">$zip</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; } 
<br />
} 
<br />
</span><span class="default">Unzip</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">,</span><span class="default">$file</span><span class="keyword">);
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="50252""></a>
  <div class="note">
   
   <a href="#50252" class="date">23-Feb-2005 05:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If (as me) all you wanted to do is store a big string (for example, a serialized array or the like) in a mysql BLOB field, remember that mysql has a COMPRESS() and UNCOMPRESS() pair of functions that do exactly that. Compression/decompression is therefore available also when accessing the DB from other languages like java, etc.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="42827""></a>
  <div class="note">
   <strong class="user">krishnendu at spymac dot com</strong>
   <a href="#42827" class="date">31-May-2004 10:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to unzip an password protected file with php..try the following command....it works in Unix/Apache environment...I haven't tested in any other environment...<br />
<br />
system("`which unzip` -P Password $zipfile -d $des",$ret_val)<br />
<br />
Where $zipfile is the path to the .zip to be unzipped and $des is path to the destination directory.....here both absolute and relative path to the script (which contains this system command) will work...<br />
<br />
if everything runs well...file should be unzipped at the $des directory..and you will get 0 value for $ret_val , which means success(info-zip.org)<br />
<br />
Regards<br />
Krishnendu</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="33140""></a>
  <div class="note">
   <strong class="user">travis</strong>
   <a href="#33140" class="date">17-Jun-2003 07:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
just a not of caution--using the dynamic zip class mentioned earlier seems to cause issues with high ascii characters (their values are not preserved correctly, and the file will not unzip)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="30585""></a>
  <div class="note">
   <strong class="user">chris</strong>
   <a href="#30585" class="date">23-Mar-2003 07:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Watch out with archives that contain subfolders if you're using the zip functions to extract archives to actual files.&nbsp; Let's say you're trying to extract foldername/filename.txt from the archive.&nbsp; You can't fopen a directory that doesn't exist, so you'll have to check for the existance of directory foldername and create it if it isn't found, then fopen foldername/filename.txt and begin writing to that.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
