<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>Overrides built-in functions</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.apd-set-session.html">? apd_set_session</a></li>
      <li style="float: right;"><a href="function.rename-function.html">rename_function ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.apd.html">APD 函数</a></li>
    <li>Overrides built-in functions</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.override-function" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">override_function</h1>
  <p class="verinfo">(PECL apd &gt;= 0.2)</p><p class="refpurpose"><span class="refname">override_function</span> &mdash; <span class="dc-title">Overrides built-in functions</span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.override-function-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">bool</span> <span class="methodname"><strong>override_function</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$function_name</code></span>
   , <span class="methodparam"><span class="type">string</span> <code class="parameter">$function_args</code></span>
   , <span class="methodparam"><span class="type">string</span> <code class="parameter">$function_code</code></span>
   )</div>

  <p class="para rdfs-comment">
   Overrides built-in functions by replacing them in the symbol table.
  </p>
 </div>



 <div class="refsect1 parameters" id="refsect1-function.override-function-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">function_name</code></dt>

     <dd>

      <p class="para">
       The function to override.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">function_args</code></dt>

     <dd>

      <p class="para">
       The function arguments, as a comma separated string.
      </p>
      <p class="para">
       Usually you will want to pass this parameter, as well as the 
       <code class="parameter">function_code</code> parameter, as a single quote 
       delimited string. The reason for using single quoted strings, is to
       protect the variable names from parsing, otherwise, if you use double
       quotes there will be a need to escape the variable names, e.g. 
       \<var class="varname"><var class="varname">$your_var</var></var>.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">function_code</code></dt>

     <dd>

      <p class="para">
       The new code for the function.
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.override-function-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   成功时返回 <strong><code>TRUE</code></strong>， 或者在失败时返回 <strong><code>FALSE</code></strong>。
  </p>
 </div>

 
 <div class="refsect1 examples" id="refsect1-function.override-function-examples">
  <h3 class="title">范例</h3>
  <p class="para">
   <div class="example" id="example-427">
    <p><strong>Example #1 <span class="function"><strong>override_function()</strong></span> example</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />override_function</span><span style="color: #007700">(</span><span style="color: #DD0000">'test'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'$a,$b'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'echo&nbsp;"DOING&nbsp;TEST";&nbsp;return&nbsp;$a&nbsp;*&nbsp;$b;'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p> 
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="116504""></a>
  <div class="note">
   <strong class="user">boban dot acimovic at gmail dot com</strong>
   <a href="#116504" class="date">14-Jan-2015 09:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Yes you can if you rename the overridden function. So you first rename original function, then override it and finally rename the overridden one, something like this:<br />
<br />
rename_function('feof', 'real_feof');<br />
override_function('feof', '$handle', 'return true;');<br />
rename_function("__overridden__", 'dummy_feof');</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="115251""></a>
  <div class="note">
   <strong class="user">tothandor at gmail dot com</strong>
   <a href="#115251" class="date">20-Jun-2014 09:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Overriden function name becomes __overridden__(). That's why you can't override two function, and that's how you can use the original function in the override.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="114352""></a>
  <div class="note">
   <strong class="user">Darien H</strong>
   <a href="#114352" class="date">12-Feb-2014 06:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Please note that this function (as of v1.0.1 in PHP 5.3) will &lt;b&gt;not&lt;/b&gt; override some important built-in "functions". Specifically, those which are actually statements/keywords, such as:<br />
<br />
&nbsp;&nbsp;&nbsp; require<br />
&nbsp;&nbsp;&nbsp; include<br />
&nbsp;&nbsp;&nbsp; require_once<br />
&nbsp;&nbsp;&nbsp; include_once<br />
&nbsp;&nbsp;&nbsp; echo<br />
&nbsp;&nbsp;&nbsp; print<br />
<br />
I was hoping to use it to trace the chains of require/include activity among files in a large legacy project, but it seems APD will not do what I need.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86571""></a>
  <div class="note">
   <strong class="user">pagan at o2 dot pl</strong>
   <a href="#86571" class="date">24-Oct-2008 09:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There is not chance to override 2 or more functions, because of the error:<br />
Fatal error: Cannot redeclare __overridden__()</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="56978""></a>
  <div class="note">
   <strong class="user">rojaro at gmail dot com</strong>
   <a href="#56978" class="date">20-Sep-2005 09:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Since Apache 1 &amp; 2 use diffrent methods (Unicode vs. UTF8) on Win32 platforms to encode urls, i've implemented the following workaround to get around this "bug" (which is actually known behaviour and wont get fixed). This workaround is really usefull when writing PHP scripts which have to work on all platforms (Windows, Linux, BSD etc.), must process URLs and must work under both Apache versions.<br />
<br />
<span class="default">&lt;?php<br />
$httpd </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">' '</span><span class="keyword">, </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'SERVER_SOFTWARE'</span><span class="keyword">]);<br />
if(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$httpd</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="default">0</span><span class="keyword">, </span><span class="default">6</span><span class="keyword">)==</span><span class="string">'Apache' </span><span class="keyword">&amp;&amp; </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$httpd</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="default">7</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">)==</span><span class="default">2 </span><span class="keyword">&amp;&amp; </span><span class="default">$httpd</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]==</span><span class="string">'(Win32)'</span><span class="keyword">)<br />
{<br />
&nbsp; if(isset(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'REQUEST_URI'</span><span class="keyword">])) </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'REQUEST_URI'</span><span class="keyword">] = </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'%2F'</span><span class="keyword">, </span><span class="string">'/'</span><span class="keyword">, </span><span class="default">rawurlencode</span><span class="keyword">(</span><span class="default">utf8_decode</span><span class="keyword">(</span><span class="default">rawurldecode</span><span class="keyword">(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'REQUEST_URI'</span><span class="keyword">]))));<br />
&nbsp; if(isset(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'REDIRECT_URL'</span><span class="keyword">])) </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'REDIRECT_URL'</span><span class="keyword">] = </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'%2F'</span><span class="keyword">, </span><span class="string">'/'</span><span class="keyword">, </span><span class="default">rawurlencode</span><span class="keyword">(</span><span class="default">utf8_decode</span><span class="keyword">(</span><span class="default">rawurldecode</span><span class="keyword">(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'REDIRECT_URL'</span><span class="keyword">]))));<br />
&nbsp; </span><span class="default">override_function</span><span class="keyword">(</span><span class="string">'urlencode'</span><span class="keyword">, </span><span class="string">'$url'</span><span class="keyword">, </span><span class="string">'return str_replace("%2F", "/", rawurlencode(utf8_encode($url)));'</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="50821""></a>
  <div class="note">
   <strong class="user">php at undeen dot com</strong>
   <a href="#50821" class="date">10-Mar-2005 09:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I thought the example was not very helpful, because it doesn't even override the function with another function.<br />
My question was: If I override a function, can I call the ORIGINAL function within the OVERRIDING function?<br />
ie, can I do this:<br />
<span class="default">&lt;?php<br />
override_function</span><span class="keyword">(</span><span class="string">'strlen'</span><span class="keyword">, </span><span class="string">'$string'</span><span class="keyword">, </span><span class="string">'return override_strlen($string);'</span><span class="keyword">);<br />
function </span><span class="default">override_strlen</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">);&nbsp; <br />
}<br />
</span><span class="default">?&gt;<br />
</span>The answer: NO, you will get a segfault.<br />
<br />
HOWEVER, if you use rename_function to rename the original function to a third name, then call the third name in the OVERRIDING function, you will get the desired effect:<br />
<span class="default">&lt;?php<br />
rename_function</span><span class="keyword">(</span><span class="string">'strlen'</span><span class="keyword">, </span><span class="string">'new_strlen'</span><span class="keyword">);<br />
</span><span class="default">override_function</span><span class="keyword">(</span><span class="string">'strlen'</span><span class="keyword">, </span><span class="string">'$string'</span><span class="keyword">, </span><span class="string">'return override_strlen($string);'</span><span class="keyword">);<br />
<br />
function </span><span class="default">override_strlen</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">new_strlen</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">);&nbsp; <br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
I plan to use this functionality to generate log reports every time a function is called, with the parameters, time, result, etc... So to wrap a function in logging, that was what I had to do.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
