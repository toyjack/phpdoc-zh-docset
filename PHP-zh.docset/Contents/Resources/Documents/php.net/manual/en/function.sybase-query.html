<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>Sends a Sybase query</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.sybase-pconnect.html">? sybase_pconnect</a></li>
      <li style="float: right;"><a href="function.sybase-result.html">sybase_result ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.sybase.html">Sybase 函数</a></li>
    <li>Sends a Sybase query</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.sybase-query" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">sybase_query</h1>
  <p class="verinfo">(PHP 4, PHP 5, PHP 7)</p><p class="refpurpose"><span class="refname">sybase_query</span> &mdash; <span class="dc-title">Sends a Sybase query</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.sybase-query-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type"><a href="language.pseudo-types.html#language.types.mixed" class="type mixed">mixed</a></span> <span class="methodname"><strong>sybase_query</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$query</code></span>
   [, <span class="methodparam"><span class="type">resource</span> <code class="parameter">$link_identifier</code></span>
  ] )</div>

  <p class="para rdfs-comment">
   <span class="function"><strong>sybase_query()</strong></span> sends a query to the currently
   active database on the server that&#039;s associated with the specified
   link identifier.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.sybase-query-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">query</code></dt>

     <dd>

      <p class="para">
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">link_identifier</code></dt>

     <dd>

      <p class="para">
       If the link identifier isn&#039;t specified, the last opened link is
       assumed. If no link is open, the function tries to establish a link as
       if <span class="function"><a href="function.sybase-connect.html" class="function">sybase_connect()</a></span> was called, and use it.
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.sybase-query-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   Returns a positive Sybase result identifier on success, <strong><code>FALSE</code></strong> on error,
   or <strong><code>TRUE</code></strong> if the query was successful but didn&#039;t return any columns.
  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.sybase-query-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.sybase-select-db.html" class="function" rel="rdfs-seeAlso">sybase_select_db()</a> - Selects a Sybase database</span></li>
    <li class="member"><span class="function"><a href="function.sybase-connect.html" class="function" rel="rdfs-seeAlso">sybase_connect()</a> - Opens a Sybase server connection</span></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="46958""></a>
  <div class="note">
   <strong class="user">matt dot sawyer at gmail dot com</strong>
   <a href="#46958" class="date">28-Oct-2004 06:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I am using PHP 4.1.1 to connect to an older version of Sybase that doesn't work with CT.&nbsp; I found that while attempting to execute an erroneous query, sybase_query() never returns false for non-select query statements.&nbsp; This was reported as a bug but then dismissed because the problem is that Sybase itself does not indicate any error to PHP.&nbsp; <br />
<br />
However I appear to have found a workaround: after each query statement, call sybase_get_last_message().&nbsp; If that function returns you anything, it will be an error message.&nbsp; Then you know your non-select query has truly failed.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="24619""></a>
  <div class="note">
   <strong class="user">cnbluesea at hotmail dot com</strong>
   <a href="#24619" class="date">23-Aug-2002 08:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To use this function to execute stored procedures by parameters like this:<br />
sybase_query("exec p_name '$para1','$para2'",$conn)<br />
$para1 and $para2 are strings.<br />
it works well.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="23091""></a>
  <div class="note">
   <strong class="user">dabratt at ifrance dot com</strong>
   <a href="#23091" class="date">09-Jul-2002 03:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Strange problem... I'm accessing a SQL SERVER 2000 database through freetds with php v4.0.1pl2 on linux.<br />
Thoses instructions work fine :<br />
<br />
// Just a test<br />
sybase_query("SELECT MES_ID FROM T_MESSAGE", $dbproc);<br />
<br />
// data i want to retrieve, stored procedure<br />
$resConfig = sybase_query("exec P_SLC_EMAILCONFIG", $dbproc);<br />
$arrConfig = sybase_fetch_array($resConfig);<br />
<br />
But, when i replace the SELECT statement by an UPDATE statement, i.e:<br />
<br />
// Here's the update<br />
sybase_query("UPDATE T_MESSAGE SET MES_STATE = 0", $dbproc);<br />
<br />
// data i want to retrieve, stored procedure<br />
$resConfig = sybase_query("exec P_SLC_EMAILCONFIG", $dbproc);<br />
$arrConfig = sybase_fetch_array($resConfig);<br />
<br />
Then i've got an error : "Supplied argument is not a valide Sybase result resource.." on the line containing the sybase_fetch_array command.<br />
I don't understand why... I have to close and reopen the connection if i want those lines to work!!!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="10871""></a>
  <div class="note">
   <strong class="user">dezi at digicol dot de</strong>
   <a href="#10871" class="date">24-Jan-2001 09:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
sybase_query stores the whole result set in memory before returning. This function is unusable for real large result sets, ie. dumping a large table from sybase to php.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="3887""></a>
  <div class="note">
   <strong class="user">ilya at vtrails dot com</strong>
   <a href="#3887" class="date">21-Feb-2000 03:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This is true for stored procedures' execution results, too. If you have a result set and a status returned, you will only be able to access the result set. Argh.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="1227""></a>
  <div class="note">
   <strong class="user">verdy_p at wanadoo dot fr</strong>
   <a href="#1227" class="date">25-Jul-1999 12:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This function can be used to call stored procedures, or to process multiple queries in the same call in the same "batch". However there's a limit on the kind of stored procedures you can call, because Sybase allows a stored procedure or "batch" to return multiple result sets, and because the surrent implementation of sybase support in PHP3 has no provision to process each result set, one after one. If your stored procedure or batch has multiple result sets returned, you will only be able to retrieved the first result set in you PHP3 script. Note that other result sets won't be processed by the SQL server until you close the current result set. So this may suspend the execution of a stored procedure or batch on the SQL Server. Note also that if a stored procedure or batch uses "print" or "raiserror" SQL statements, you won't be able to collect the returned messages in the result set, because these statements do not generate a result set but instead return asynchronous server messages which currently have no support in the sybase PHP3 set of functions.
<br />
It would be a good idea for someone to add the support for queries that return multiple result sets and server messages, so that any kind of Sybase SQL queries can be used in PHP3 scripts.
<br />
This would require adding a function to go to the next results set, and a function to retrieve server messages generated before, between, and after each result sets. Note also that server messages could be sent within a result set, this won't be from "print" or "raiserror" SQL statements but internal server errors while processing a result set returned by a SELECT statement, or messages generated by triggers. There could also exist asynchronous client messages while processing any kind of return (result set or server messages), and there's for now no function to return them. Such client messages mainly signal connection status and data conversion errors.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
