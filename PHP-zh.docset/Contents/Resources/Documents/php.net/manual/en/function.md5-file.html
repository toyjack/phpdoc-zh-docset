<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>计算指定文件的 MD5 散列值</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.ltrim.html">? ltrim</a></li>
      <li style="float: right;"><a href="function.md5.html">md5 ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.strings.html">字符串 函数</a></li>
    <li>计算指定文件的 MD5 散列值</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.md5-file" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">md5_file</h1>
  <p class="verinfo">(PHP 4 &gt;= 4.2.0, PHP 5, PHP 7)</p><p class="refpurpose"><span class="refname">md5_file</span> &mdash; <span class="dc-title">计算指定文件的 MD5 散列值</span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.md5-file-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">string</span> <span class="methodname"><strong>md5_file</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$filename</code></span>
   [, <span class="methodparam"><span class="type">bool</span> <code class="parameter">$raw_output</code><span class="initializer"> = false</span></span>
  ] )</div>

  <p class="para rdfs-comment">
   使用 <a href="http://www.faqs.org/rfcs/rfc1321" class="link external" title="Link : http://www.faqs.org/rfcs/rfc1321">&raquo;&nbsp;RSA 数据安全公司的 MD5 报文算法</a>计算 <code class="parameter">filename</code> 文件的 MD5 散列值并返回。该散列值为 32 字符的十六进制数字。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.md5-file-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">filename</code></dt>

     <dd>

      <p class="para">
       文件名
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">raw_output</code></dt>

     <dd>

      <p class="para">
       如果被设置为 <strong><code>TRUE</code></strong>，那么报文摘要将以原始的 16 位二进制格式返回。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.md5-file-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   成功返回字符串，否则返回 <strong><code>FALSE</code></strong>。
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.md5-file-changelog">
  <h3 class="title">更新日志</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead>
      <tr>
       <th>版本</th>
       <th>说明</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
       <td>5.1.0</td>
       <td>
        函数改用流 API。这意味着能够配合封装器使用该函数，比如 <em>md5_file(&#039;http://example.com/..&#039;)</em>。
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.md5-file-examples">
  <h3 class="title">范例</h3>
  <p class="para">
   <div class="example" id="example-5253">
    <p><strong>Example #1 <span class="function"><strong>md5_file()</strong></span> 使用范例</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$file&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'php-5.3.0alpha2-Win32-VC9-x64.zip'</span><span style="color: #007700">;<br /><br />echo&nbsp;</span><span style="color: #DD0000">'MD5&nbsp;file&nbsp;hash&nbsp;of&nbsp;'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$file&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">':&nbsp;'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">md5_file</span><span style="color: #007700">(</span><span style="color: #0000BB">$file</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.md5-file-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.md5.html" class="function" rel="rdfs-seeAlso">md5()</a> - 计算字符串的 MD5 散列值</span></li>
    <li class="member"><span class="function"><a href="function.sha1-file.html" class="function" rel="rdfs-seeAlso">sha1_file()</a> - 计算文件的 sha1 散列值</span></li>
    <li class="member"><span class="function"><a href="function.crc32.html" class="function" rel="rdfs-seeAlso">crc32()</a> - 计算一个字符串的 crc32 多项式</span></li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="113715""></a>
  <div class="note">
   <strong class="user">tommuhler at yahoo dot com</strong>
   <a href="#113715" class="date">21-Nov-2013 01:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Sorry for voting Chris's code down.<br />
<br />
It is great, but there are some brackets missing.&nbsp; If you add more complex conditions than just a mere echo in the top IF ... ELSE structure please include the curly braces ... otherwise php&nbsp; will choke.<br />
<br />
<span class="default">&lt;?php<br />
define</span><span class="keyword">(</span><span class="string">'READ_LEN'</span><span class="keyword">, </span><span class="default">4096</span><span class="keyword">);<br />
<br />
if(</span><span class="default">files_identical</span><span class="keyword">(</span><span class="string">'file1.txt'</span><span class="keyword">, </span><span class="string">'file2.txt'</span><span class="keyword">)) {<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">'files identical'</span><span class="keyword">;<br />
} else {<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">'files not identical'</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="comment">//&nbsp;&nbsp; pass two file names<br />
//&nbsp;&nbsp; returns TRUE if files are the same, FALSE otherwise<br />
</span><span class="keyword">function </span><span class="default">files_identical</span><span class="keyword">(</span><span class="default">$fn1</span><span class="keyword">, </span><span class="default">$fn2</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">filetype</span><span class="keyword">(</span><span class="default">$fn1</span><span class="keyword">) !== </span><span class="default">filetype</span><span class="keyword">(</span><span class="default">$fn2</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">FALSE</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">filesize</span><span class="keyword">(</span><span class="default">$fn1</span><span class="keyword">) !== </span><span class="default">filesize</span><span class="keyword">(</span><span class="default">$fn2</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">FALSE</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; if(!</span><span class="default">$fp1 </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$fn1</span><span class="keyword">, </span><span class="string">'rb'</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">FALSE</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; if(!</span><span class="default">$fp2 </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$fn2</span><span class="keyword">, </span><span class="string">'rb'</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">FALSE</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$same </span><span class="keyword">= </span><span class="default">TRUE</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp1</span><span class="keyword">) and !</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp2</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp1</span><span class="keyword">, </span><span class="default">READ_LEN</span><span class="keyword">) !== </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp2</span><span class="keyword">, </span><span class="default">READ_LEN</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$same </span><span class="keyword">= </span><span class="default">FALSE</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp1</span><span class="keyword">) !== </span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp2</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$same </span><span class="keyword">= </span><span class="default">FALSE</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp1</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp2</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$same</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="107508""></a>
  <div class="note">
   <strong class="user">lukasamd at gmail dot com</strong>
   <a href="#107508" class="date">14-Feb-2012 07:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It's faster to use md5sum than openssl md5:<br />
<br />
<span class="default">&lt;?php<br />
$begin </span><span class="keyword">= </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br />
<br />
</span><span class="default">$file_path </span><span class="keyword">= </span><span class="string">'../backup_file1.tar.gz'</span><span class="keyword">;<br />
</span><span class="default">$result </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">"&nbsp; "</span><span class="keyword">, </span><span class="default">exec</span><span class="keyword">(</span><span class="string">"md5sum </span><span class="default">$file_path</span><span class="string">"</span><span class="keyword">));<br />
echo </span><span class="string">"Hash = "</span><span class="keyword">.</span><span class="default">$result</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">].</span><span class="string">"&lt;br /&gt;"</span><span class="keyword">;<br />
<br />
</span><span class="comment"># Here 7 other big files (20-300 MB)<br />
<br />
</span><span class="default">$end </span><span class="keyword">= </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">) - </span><span class="default">$begin</span><span class="keyword">;<br />
echo </span><span class="string">"Time = </span><span class="default">$end</span><span class="string">"</span><span class="keyword">;<br />
</span><span class="comment"># Time = 4.4475841522217 <br />
<br />
#Method with openssl<br />
# Time = 12.1463856900543<br />
</span><span class="default">?&gt;<br />
</span><br />
About 3x faster</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="94494""></a>
  <div class="note">
   <strong class="user">Chris</strong>
   <a href="#94494" class="date">08-Nov-2009 04:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you just need to find out if two files are identical, comparing file hashes can be inefficient, especially on large files.&nbsp; There's no reason to read two whole files and do all the math if the second byte of each file is different.&nbsp; If you don't need to store the hash value for later use, there may not be a need to calculate the hash value just to compare files.&nbsp; This can be much faster:<br />
<br />
<span class="default">&lt;?php<br />
define</span><span class="keyword">(</span><span class="string">'READ_LEN'</span><span class="keyword">, </span><span class="default">4096</span><span class="keyword">);<br />
<br />
if(</span><span class="default">files_identical</span><span class="keyword">(</span><span class="string">'file1.txt'</span><span class="keyword">, </span><span class="string">'file2.txt'</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">'files identical'</span><span class="keyword">;<br />
else<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">'files not identical'</span><span class="keyword">;<br />
<br />
</span><span class="comment">//&nbsp;&nbsp; pass two file names<br />
//&nbsp;&nbsp; returns TRUE if files are the same, FALSE otherwise<br />
</span><span class="keyword">function </span><span class="default">files_identical</span><span class="keyword">(</span><span class="default">$fn1</span><span class="keyword">, </span><span class="default">$fn2</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">filetype</span><span class="keyword">(</span><span class="default">$fn1</span><span class="keyword">) !== </span><span class="default">filetype</span><span class="keyword">(</span><span class="default">$fn2</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">FALSE</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">filesize</span><span class="keyword">(</span><span class="default">$fn1</span><span class="keyword">) !== </span><span class="default">filesize</span><span class="keyword">(</span><span class="default">$fn2</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">FALSE</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; if(!</span><span class="default">$fp1 </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$fn1</span><span class="keyword">, </span><span class="string">'rb'</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">FALSE</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; if(!</span><span class="default">$fp2 </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$fn2</span><span class="keyword">, </span><span class="string">'rb'</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">FALSE</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$same </span><span class="keyword">= </span><span class="default">TRUE</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp1</span><span class="keyword">) and !</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp2</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp1</span><span class="keyword">, </span><span class="default">READ_LEN</span><span class="keyword">) !== </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp2</span><span class="keyword">, </span><span class="default">READ_LEN</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$same </span><span class="keyword">= </span><span class="default">FALSE</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp1</span><span class="keyword">) !== </span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp2</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$same </span><span class="keyword">= </span><span class="default">FALSE</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp1</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp2</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$same</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81751""></a>
  <div class="note">
   <strong class="user">smartin</strong>
   <a href="#81751" class="date">12-Mar-2008 01:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In response to using exec instead for performance (Nov 13 2007 post), It looks like the performance depends on the size of the file.&nbsp; See the results below using the same script from the original post.&nbsp; The first hash is with md5_file and the second is with openssl md5.<br />
<br />
With a 1MB file:<br />
Hash = df1555ec0c2d7fcad3a03770f9aa238a; time = 0.005006<br />
Hash = df1555ec0c2d7fcad3a03770f9aa238a; time = 0.01498<br />
<br />
With a 2MB file:<br />
<br />
Hash = 4387904830a4245a8ab767e5937d722c; time = 0.010393<br />
Hash = 4387904830a4245a8ab767e5937d722c; time = 0.016691<br />
<br />
With a 10MB file:<br />
<br />
Hash = b89f948e98f3a113dc13fdbd3bdb17ef; time = 0.241907<br />
Hash = b89f948e98f3a113dc13fdbd3bdb17ef; time = 0.037597<br />
<br />
Performance seems to change proportionally with the file size.&nbsp; Judging from the previous post's default file name (.mov) he/she was probably dealing with a large file.&nbsp; These are just quick tests and far from a perfect benchmark, but you might want to test your own files before assuming that the openssl solution is faster (ie, if working with small text files vs. movies, etc)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75393""></a>
  <div class="note">
   <strong class="user">potsed [at] gmail [dot] com</strong>
   <a href="#75393" class="date">27-May-2007 01:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Heres a function to give an md5 for an entire directory..<br />
<br />
function MD5_DIR($dir)<br />
{<br />
&nbsp;&nbsp;&nbsp; if (!is_dir($dir))<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return false;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; $filemd5s = array();<br />
&nbsp;&nbsp;&nbsp; $d = dir($dir);<br />
<br />
&nbsp;&nbsp;&nbsp; while (false !== ($entry = $d-&gt;read()))<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ($entry != '.' &amp;&amp; $entry != '..')<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (is_dir($dir.'/'.$entry))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $filemd5s[] = MD5_DIR($dir.'/'.$entry);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $filemd5s[] = md5_file($dir.'/'.$entry);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; $d-&gt;close();<br />
&nbsp;&nbsp;&nbsp; return md5(implode('', $filemd5s));<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="47429""></a>
  <div class="note">
   <strong class="user">richard at interlink dot com dot au</strong>
   <a href="#47429" class="date">16-Nov-2004 09:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For those of you with PHP 4 that want to output the "raw" 128 bit hash, all you need to do is send it to pack to convert the hex string into the raw output.<br />
<br />
ie:<br />
$filename="checkthisfile.bin";<br />
$rawhash=pack("H*",md5_file($filename));</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
