<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>执行一个cURL会话</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.curl-escape.html">? curl_escape</a></li>
      <li style="float: right;"><a href="function.curl-file-create.html">curl_file_create ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.curl.html">cURL 函数</a></li>
    <li>执行一个cURL会话</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.curl-exec" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">curl_exec</h1>
  <p class="verinfo">(PHP 4 &gt;= 4.0.2, PHP 5, PHP 7)</p><p class="refpurpose"><span class="refname">curl_exec</span> &mdash; <span class="dc-title">执行一个cURL会话</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-function.curl-exec-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type"><a href="language.pseudo-types.html#language.types.mixed" class="type mixed">mixed</a></span> <span class="methodname"><strong>curl_exec</strong></span>
    ( <span class="methodparam"><span class="type">resource</span> <code class="parameter">$ch</code></span>
   )</div>

  <p class="para rdfs-comment">
   执行给定的cURL会话。
  </p>
  <p class="para">
   这个函数应该在初始化一个cURL会话并且全部的选项都被设置后被调用。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.curl-exec-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>

    <dt>
<code class="parameter">ch</code>
</dt>
<dd>
<p class="para">由 <span class="function"><a href="function.curl-init.html" class="function">curl_init()</a></span> 返回的 cURL 句柄。</p></dd>

   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.curl-exec-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   成功时返回 <strong><code>TRUE</code></strong>， 或者在失败时返回 <strong><code>FALSE</code></strong>。 然而，如果 <strong><code>CURLOPT_RETURNTRANSFER</code></strong>选项被设置，函数执行成功时会返回执行的结果，失败时返回 <strong><code>FALSE</code></strong> 。
  </p>
 </div>

   
 <div class="refsect1 examples" id="refsect1-function.curl-exec-examples">
  <h3 class="title">范例</h3>
  <p class="para">
   <div class="example" id="example-4640">
    <p><strong>Example #1 获取一个网页</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;创建一个cURL资源<br /></span><span style="color: #0000BB">$ch&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">curl_init</span><span style="color: #007700">();<br /><br /></span><span style="color: #FF8000">//&nbsp;设置URL和相应的选项<br /></span><span style="color: #0000BB">curl_setopt</span><span style="color: #007700">(</span><span style="color: #0000BB">$ch</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">CURLOPT_URL</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"http://www.example.com/"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">curl_setopt</span><span style="color: #007700">(</span><span style="color: #0000BB">$ch</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">CURLOPT_HEADER</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;抓取URL并把它传递给浏览器<br /></span><span style="color: #0000BB">curl_exec</span><span style="color: #007700">(</span><span style="color: #0000BB">$ch</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;关闭cURL资源，并且释放系统资源<br /></span><span style="color: #0000BB">curl_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$ch</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>

 
 <div class="refsect1 seealso" id="refsect1-function.curl-exec-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.curl-multi-exec.html" class="function" rel="rdfs-seeAlso">curl_multi_exec()</a> - 运行当前 cURL 句柄的子连接</span></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="119059""></a>
  <div class="note">
   <strong class="user">bimal at sanjaal dot com</strong>
   <a href="#119059" class="date">26-Mar-2016 04:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are accessing HTTPS URLs and you do not receive any contents, try to disable verifying SSL.<br />
<br />
<span class="default">&lt;?php<br />
curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_SSL_VERIFYHOST</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_SSL_VERIFYPEER</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="115089""></a>
  <div class="note">
   <strong class="user">hablutzel1 at gmail dot com</strong>
   <a href="#115089" class="date">24-May-2014 02:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Be always aware that CURLOPT_SSL_VERIFYPEER set to FALSE or 0 should never be used for production as it makes the link inmediately vulnerable to man-in-the-middle attack, still you can use it during development, but I would suggest that only if you KNOW what are you doing, otherwise spend some more time making requests to HTTPS sites work without resorting to set that option to FALSE or 0.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="113876""></a>
  <div class="note">
   <strong class="user">Manu Manjunath</strong>
   <a href="#113876" class="date">12-Dec-2013 10:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to get contents of a page through HTTP GET or POST,&nbsp; you can write a small function like below.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/**<br />
&nbsp;* Read entire contents of a URL in a string<br />
&nbsp;* @param string $url URL to fetch data from<br />
&nbsp;* @param mixed $params Parameters to the URL, typically an array. In case of POST, can be a string<br />
&nbsp;* @param string $method HTTP method - can be 'GET' (default) or 'POST'<br />
&nbsp;* @return mixed Contents of the webpage. Returns &lt;i&gt;false&lt;/i&gt; in case of failure.<br />
&nbsp;*/<br />
</span><span class="keyword">function </span><span class="default">url_get_contents</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">, </span><span class="default">$params </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">, </span><span class="default">$method </span><span class="keyword">= </span><span class="string">'GET'</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$contents </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if (!</span><span class="default">in_array</span><span class="keyword">(</span><span class="default">$method</span><span class="keyword">, array(</span><span class="string">'GET'</span><span class="keyword">, </span><span class="string">'POST'</span><span class="keyword">))) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">error_log</span><span class="keyword">(</span><span class="default">__FUNCTION__ </span><span class="keyword">. </span><span class="string">": Unknown method '</span><span class="default">$method</span><span class="string">'"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$method </span><span class="keyword">== </span><span class="string">'GET'</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$params</span><span class="keyword">) &amp;&amp; </span><span class="default">count</span><span class="keyword">(</span><span class="default">$params</span><span class="keyword">) &gt; </span><span class="default">0</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$params </span><span class="keyword">=== </span><span class="default">array_values</span><span class="keyword">(</span><span class="default">$params</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">error_log</span><span class="keyword">(</span><span class="default">__FUNCTION__ </span><span class="keyword">. </span><span class="string">": Numerical array recieved for argument '\$params' (assoc array expected)"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$url </span><span class="keyword">.= </span><span class="string">'?' </span><span class="keyword">. </span><span class="default">http_build_query</span><span class="keyword">(</span><span class="default">$params</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; elseif (!</span><span class="default">is_null</span><span class="keyword">(</span><span class="default">$params</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">error_log</span><span class="keyword">(</span><span class="default">__FUNCTION__ </span><span class="keyword">. </span><span class="string">": If you're making a GET request, argument \$params must be null or assoc array."</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$ch </span><span class="keyword">!== </span><span class="default">false</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt_array</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, array(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">CURLOPT_HEADER </span><span class="keyword">=&gt; </span><span class="default">false</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">CURLOPT_RETURNTRANSFER </span><span class="keyword">=&gt; </span><span class="default">true</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; ));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$method </span><span class="keyword">== </span><span class="string">'POST'</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POST</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_string</span><span class="keyword">(</span><span class="default">$params</span><span class="keyword">) || </span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$params</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, </span><span class="default">$params</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">error_log</span><span class="keyword">(</span><span class="default">__FUNCTION__ </span><span class="keyword">. </span><span class="string">": Argument \$params should be an array of parameters or (if you want to send raw data) a string"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$contents </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$contents</span><span class="keyword">;<br />
}</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="109653""></a>
  <div class="note">
   <strong class="user">bertram dot pereira at gmail dot com</strong>
   <a href="#109653" class="date">06-Aug-2012 08:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There will be times when you need to get the response from curl_exec and capture the transfer - this is not very well documented but you can do so with the CURLOPT_RETURNTRANSFER Option <br />
<br />
curl_setopt($ch, CURLOPT_RETURNTRANSFER, TRUE); <br />
<br />
Bert</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102396""></a>
  <div class="note">
   <strong class="user">tolas777 at gmail dot com</strong>
   <a href="#102396" class="date">11-Feb-2011 05:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I was having a problem, for almost a week, of curl_exec() freezing/hanging when I made a request with it to a page that spends over an hour converting a large video file, and only afterwards sends control-data back to the calling script.<br />
<br />
I'm using windows 7, WampServer-2.1d-64.exe, PHP 5.3.4, libcurl-7.21.3.<br />
<br />
Here's the final solution;<br />
<br />
On Fri, Feb 11, 2011 at 1:32 PM, Daniel Stenberg &lt;daniel-of-haxx.se&gt; wrote:<br />
&gt; On Fri, 11 Feb 2011, Tolas Anon wrote:<br />
&gt;<br />
&gt;&gt;&gt; It is also very easy for an application to enable the options as I've<br />
&gt;&gt;&gt; shown.<br />
&gt;&gt;<br />
&gt;&gt; Just not for the platforms i use, apparently.. :(<br />
&gt;<br />
&gt; Why not? A quick search for "tcp keepalive windows" shows this:<br />
&gt; <a href="http://msdn.microsoft.com/en-us/library/ms819735.aspx" rel="nofollow" target="_blank">http://msdn.microsoft.com/en-us/library/ms819735.aspx</a><br />
<br />
This fixed my problem in the simple test AND in my application!<br />
No need to send keep-alive bytes on the text/html level either.<br />
<br />
I just added the "KeepAliveTime" setting with windows 7 regedit.exe in<br />
HKEY_LOCAL_MACHINE/SYSTEM/CurrentControlSet/services/Tcpip, as a<br />
REG_DWORD value, set it to decimal 25000 (so 25 seconds), rebooted,<br />
and it all works as i want it now..<br />
<br />
Note that windows registry entries key names are case-sensitive, wrong<br />
casing and they'll be deleted on restart.<br />
<br />
Lots of thanks, Daniel. I would've never solved this on my own..<br />
<br />
------------------------------------------------------<br />
(now useless) details at:<br />
<br />
<a href="http://curl.haxx.se/mail/lib-2011-02/0101.html" rel="nofollow" target="_blank">http://curl.haxx.se/mail/lib-2011-02/0101.html</a><br />
<br />
<a href="http://readlist.com/lists/lists.php.net/php-general/16/81195.html" rel="nofollow" target="_blank">http://readlist.com/lists/lists.php.net/php-general/16/81195.html</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="98628""></a>
  <div class="note">
   <strong class="user">David from Code2Design.com</strong>
   <a href="#98628" class="date">28-Jun-2010 04:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just in case anyone is looking for a a couple of simple functions [to help automate cURL processes for POST and GET queries] I thought I'd post these.
<br />

<br />
<span class="default">&lt;?php
<br />

<br />
</span><span class="comment">/**
<br />
&nbsp;* Send a POST requst using cURL
<br />
&nbsp;* @param string $url to request
<br />
&nbsp;* @param array $post values to send
<br />
&nbsp;* @param array $options for cURL
<br />
&nbsp;* @return string
<br />
&nbsp;*/
<br />
</span><span class="keyword">function </span><span class="default">curl_post</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">, array </span><span class="default">$post </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">, array </span><span class="default">$options </span><span class="keyword">= array())
<br />
{
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$defaults </span><span class="keyword">= array(
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">CURLOPT_POST </span><span class="keyword">=&gt; </span><span class="default">1</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">CURLOPT_HEADER </span><span class="keyword">=&gt; </span><span class="default">0</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">CURLOPT_URL </span><span class="keyword">=&gt; </span><span class="default">$url</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">CURLOPT_FRESH_CONNECT </span><span class="keyword">=&gt; </span><span class="default">1</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">CURLOPT_RETURNTRANSFER </span><span class="keyword">=&gt; </span><span class="default">1</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">CURLOPT_FORBID_REUSE </span><span class="keyword">=&gt; </span><span class="default">1</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">CURLOPT_TIMEOUT </span><span class="keyword">=&gt; </span><span class="default">4</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">CURLOPT_POSTFIELDS </span><span class="keyword">=&gt; </span><span class="default">http_build_query</span><span class="keyword">(</span><span class="default">$post</span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; );
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">();
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt_array</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, (</span><span class="default">$options </span><span class="keyword">+ </span><span class="default">$defaults</span><span class="keyword">));
<br />
&nbsp;&nbsp;&nbsp; if( ! </span><span class="default">$result </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">))
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">trigger_error</span><span class="keyword">(</span><span class="default">curl_error</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">));
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$result</span><span class="keyword">;
<br />
}
<br />

<br />
</span><span class="comment">/**
<br />
&nbsp;* Send a GET requst using cURL
<br />
&nbsp;* @param string $url to request
<br />
&nbsp;* @param array $get values to send
<br />
&nbsp;* @param array $options for cURL
<br />
&nbsp;* @return string
<br />
&nbsp;*/
<br />
</span><span class="keyword">function </span><span class="default">curl_get</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">, array </span><span class="default">$get </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">, array </span><span class="default">$options </span><span class="keyword">= array())
<br />
{&nbsp; &nbsp; 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$defaults </span><span class="keyword">= array(
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">CURLOPT_URL </span><span class="keyword">=&gt; </span><span class="default">$url</span><span class="keyword">. (</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">, </span><span class="string">'?'</span><span class="keyword">) === </span><span class="default">FALSE </span><span class="keyword">? </span><span class="string">'?' </span><span class="keyword">: </span><span class="string">''</span><span class="keyword">). </span><span class="default">http_build_query</span><span class="keyword">(</span><span class="default">$get</span><span class="keyword">),
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">CURLOPT_HEADER </span><span class="keyword">=&gt; </span><span class="default">0</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">CURLOPT_RETURNTRANSFER </span><span class="keyword">=&gt; </span><span class="default">TRUE</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">CURLOPT_TIMEOUT </span><span class="keyword">=&gt; </span><span class="default">4
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">();
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt_array</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, (</span><span class="default">$options </span><span class="keyword">+ </span><span class="default">$defaults</span><span class="keyword">));
<br />
&nbsp;&nbsp;&nbsp; if( ! </span><span class="default">$result </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">))
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">trigger_error</span><span class="keyword">(</span><span class="default">curl_error</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">));
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$result</span><span class="keyword">;
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="96174""></a>
  <div class="note">
   <strong class="user">ivanargulo at  NOSPAM gmail dot com</strong>
   <a href="#96174" class="date">12-Feb-2010 12:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If having problems with special chars or entities (like á, ?, à, etc.), using the ISO encode, just decode the values given with the function utf8_decode().<br />
<br />
For example:<br />
<br />
The returned string is the following:<br />
<br />
&lt;xml&gt;&lt;name&gt;Iv??n&lt;/name&gt;&lt;/xml&gt;<br />
<br />
Using utf8_decode, the result in ISO is<br />
<br />
&lt;xml&gt;&lt;name&gt;Iván&lt;/name&gt;&lt;/xml&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92580""></a>
  <div class="note">
   <strong class="user">petermiller1986[nospam] at gmail dot com</strong>
   <a href="#92580" class="date">30-Jul-2009 10:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
so far i have not come across any code or library file that will<br />
extract cookie information from a http header, so i've written<br />
one.<br />
<br />
there are two files:<br />
file1.php - acts as server and sets the cookies<br />
file2.php - acts as browser and retrieves the cookies set by file1<br />
<br />
/*****file1.php****/<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/*set 3 cookies at the end of the execution of this script*/<br />
<br />
</span><span class="default">setcookie</span><span class="keyword">(</span><span class="string">"cookie1"</span><span class="keyword">,</span><span class="string">"cookie 1 data"</span><span class="keyword">, </span><span class="default">time</span><span class="keyword">() - </span><span class="default">123123</span><span class="keyword">);<br />
</span><span class="default">setcookie</span><span class="keyword">(</span><span class="string">"cookie2"</span><span class="keyword">,</span><span class="string">"cookie 2 data"</span><span class="keyword">, </span><span class="default">time</span><span class="keyword">() + </span><span class="default">54326</span><span class="keyword">);<br />
</span><span class="default">setcookie</span><span class="keyword">(</span><span class="string">"cookie3"</span><span class="keyword">,</span><span class="string">"cookie 3 data"</span><span class="keyword">, </span><span class="default">time</span><span class="keyword">());<br />
</span><span class="default">?&gt;<br />
</span>/****end file1.php**/<br />
<br />
/*****file2.php****/<br />
<span class="default">&lt;?php<br />
$url </span><span class="keyword">= </span><span class="string">"<a href="http://[host][uri]/file1.php" rel="nofollow" target="_blank">http://[host][uri]/file1.php</a>"</span><span class="keyword">; </span><span class="comment">/*insert desired host and<br />
uri*/<br />
</span><span class="default">$browser_id </span><span class="keyword">= </span><span class="string">"some crazy browser"</span><span class="keyword">;<br />
</span><span class="default">$curl_handle </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">();<br />
</span><span class="default">$options </span><span class="keyword">= array<br />
(<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">CURLOPT_URL</span><span class="keyword">=&gt;</span><span class="default">$url</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">CURLOPT_HEADER</span><span class="keyword">=&gt;</span><span class="default">true</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">=&gt;</span><span class="default">true</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">CURLOPT_FOLLOWLOCATION</span><span class="keyword">=&gt;</span><span class="default">true</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">CURLOPT_USERAGENT</span><span class="keyword">=&gt;</span><span class="default">$browser_id<br />
</span><span class="keyword">);<br />
</span><span class="default">curl_setopt_array</span><span class="keyword">(</span><span class="default">$curl_handle</span><span class="keyword">,</span><span class="default">$options</span><span class="keyword">);<br />
</span><span class="default">$server_output </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$curl_handle</span><span class="keyword">);<br />
</span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$curl_handle</span><span class="keyword">);<br />
<br />
</span><span class="comment">/*construct the http search pattern for cookies*/<br />
</span><span class="default">$pattern&nbsp; </span><span class="keyword">= </span><span class="string">"/Set-Cookie:"</span><span class="keyword">;<br />
</span><span class="default">$pattern </span><span class="keyword">.= </span><span class="string">"(?P&lt;name&gt;.*?)=(?P&lt;value&gt;.*?); "</span><span class="keyword">;<br />
</span><span class="default">$pattern </span><span class="keyword">.= </span><span class="string">"expires=(?P&lt;expiry_dayname&gt;\w+), "</span><span class="keyword">;<br />
</span><span class="default">$pattern </span><span class="keyword">.= </span><span class="string">"(?P&lt;expiry_day&gt;\d+)-<br />
(?P&lt;expiry_month&gt;\w+)-(?P&lt;expiry_year&gt;\d+) "</span><span class="keyword">;<br />
</span><span class="default">$pattern </span><span class="keyword">.= </span><span class="string">"(?P&lt;expiry_hour&gt;\d+):<br />
(?P&lt;expiry_minute&gt;\d+):(?P&lt;expiry_second&gt;\d+) "</span><span class="keyword">;<br />
</span><span class="default">$pattern </span><span class="keyword">.= </span><span class="string">"(?P&lt;expiry_zone&gt;\w+)/"</span><span class="keyword">;<br />
</span><span class="default">preg_match_all</span><span class="keyword">(</span><span class="default">$pattern</span><span class="keyword">,</span><span class="default">$server_output</span><span class="keyword">,</span><span class="default">$matches</span><span class="keyword">);<br />
<br />
</span><span class="default">$table_string </span><span class="keyword">= </span><span class="string">"<br />
&lt;h1&gt;cookie information table&lt;/h1&gt;<br />
&lt;table border='1'&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;tr&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;td&gt;cookie name&lt;/td&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;td&gt;value&lt;/td&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;td&gt;expiry day&lt;/td&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;td&gt;expiry date&lt;/td&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;td&gt;expiry time&lt;/td&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;td&gt;expiry timezone&lt;/td&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;/tr&gt;<br />
"</span><span class="keyword">;<br />
</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;<br />
foreach(</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">name</span><span class="keyword">] as </span><span class="default">$cookie_name</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$table_string </span><span class="keyword">.= </span><span class="string">"<br />
&nbsp;&nbsp;&nbsp; &lt;tr&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;td&gt;</span><span class="default">$cookie_name</span><span class="string">&lt;/td&gt;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;td&gt;</span><span class="keyword">{</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">value</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">]}</span><span class="string">&lt;/td&gt;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;td&gt;</span><span class="keyword">{</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">expiry_dayname</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">]}</span><span class="string">&lt;/td&gt;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;td&gt;</span><span class="keyword">{</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">expiry_day</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">]}</span><span class="string">-<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">{</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">expiry_month</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">]}</span><span class="string">-<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">{</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">expiry_year</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">]}</span><span class="string">&lt;/td&gt;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;td&gt;</span><span class="keyword">{</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">expiry_hour</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">]}</span><span class="string">:<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">{</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">expiry_minute</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">]}</span><span class="string">:<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">{</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">expiry_second</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">]}</span><span class="string">&lt;/td&gt;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;td&gt;</span><span class="keyword">{</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">expiry_zone</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">]}</span><span class="string">&lt;/td&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;/tr&gt;<br />
&nbsp;&nbsp;&nbsp; "</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$i</span><span class="keyword">++;<br />
}<br />
</span><span class="default">$table_string </span><span class="keyword">.= </span><span class="string">"&lt;/table&gt;"</span><span class="keyword">;<br />
echo </span><span class="default">$table_string</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span>/****end file2.php**/<br />
<br />
i based this code on the following http header:<br />
(obtained by going: echo $server_output; in file2.php)<br />
<br />
HTTP/1.1 200 OK Date: Thu, 30 Jul 2009 07:10:07 GMT<br />
Server: Apache/2.2.11 (Win32) DAV/2 mod_ssl/2.2.11<br />
OpenSSL/0.9.8i PHP/5.2.9 X-Powered-By: PHP/5.2.9<br />
Set-Cookie: cookie1=cookie+1+data; expires=Wed,<br />
29-Jul-2009 03:23:27 GMT Set-Cookie<br />
cookie2=cookie+2+data; expires=Wed, 29-Jul-2009 03:23:27<br />
GMT Set-Cookie: cookie3=cookie+3+data; expires=Wed,<br />
29-Jul-2009 03:23:27 GMT Content-Length: 196<br />
Content-Type: text/html<br />
<br />
if your header differs from this one then $pattern in file2.php<br />
will need to be modified accordingly. hopefully this code will save<br />
you a lot of time though!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="87015""></a>
  <div class="note">
   <strong class="user">Mark Omohundro, ajamyajax.com</strong>
   <a href="#87015" class="date">14-Nov-2008 07:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just a simple curl_exec() example with a twist: I use the familiar http response status code returned from curl_getinfo() to put either data, or a custom error message + curl_error() into a single string.&nbsp; I find this useful when the response ends up in a &lt;div&gt; or &lt;span&gt; tag.<br />
<br />
<span class="default">&lt;?php<br />
curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="default">$url</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
...<br />
<br />
</span><span class="default">$output </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
</span><span class="default">$info </span><span class="keyword">= </span><span class="default">curl_getinfo</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
<br />
if (</span><span class="default">$output </span><span class="keyword">=== </span><span class="default">false </span><span class="keyword">|| </span><span class="default">$info</span><span class="keyword">[</span><span class="string">'http_code'</span><span class="keyword">] != </span><span class="default">200</span><span class="keyword">) {<br />
&nbsp; </span><span class="default">$output </span><span class="keyword">= </span><span class="string">"No cURL data returned for </span><span class="default">$url</span><span class="string"> ["</span><span class="keyword">. </span><span class="default">$info</span><span class="keyword">[</span><span class="string">'http_code'</span><span class="keyword">]. </span><span class="string">"]"</span><span class="keyword">;<br />
&nbsp; if (</span><span class="default">curl_error</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$output </span><span class="keyword">.= </span><span class="string">"\n"</span><span class="keyword">. </span><span class="default">curl_error</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
&nbsp; }<br />
else {<br />
&nbsp; </span><span class="comment">// 'OK' status; format $output data if necessary here:<br />
&nbsp; </span><span class="keyword">...<br />
}<br />
</span><span class="comment">// then return or display the single string $output<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84774""></a>
  <div class="note">
   <strong class="user">lmshad at wp dot pl dot foo dot bar</strong>
   <a href="#84774" class="date">29-Jul-2008 07:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
example:<br />
&nbsp;&nbsp; echo CurlTool::fetchContent('www.onet.pl');<br />
&nbsp;&nbsp; CurlTool::downloadFile('<a href="http://download.gadu-gadu.pl/gg77.exe" rel="nofollow" target="_blank">http://download.gadu-gadu.pl/gg77.exe</a>', 'c:/');<br />
<br />
<span class="default">&lt;?php<br />
error_reporting</span><span class="keyword">(</span><span class="default">E_STRICT </span><span class="keyword">| </span><span class="default">E_ALL</span><span class="keyword">);<br />
class </span><span class="default">CurlTool </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public static </span><span class="default">$userAgents </span><span class="keyword">= array(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'FireFox3' </span><span class="keyword">=&gt; </span><span class="string">'Mozilla/5.0 (Windows; U; Windows NT 5.1; pl; rv:1.9) Gecko/2008052906 Firefox/3.0'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'GoogleBot' </span><span class="keyword">=&gt; </span><span class="string">'Mozilla/5.0 (compatible; Googlebot/2.1; +<a href="http://www.google.com/bot.html" rel="nofollow" target="_blank">http://www.google.com/bot.html</a>)'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'IE7' </span><span class="keyword">=&gt; </span><span class="string">'Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0)'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'Netscape' </span><span class="keyword">=&gt; </span><span class="string">'Mozilla/4.8 [en] (Windows NT 6.0; U)'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'Opera' </span><span class="keyword">=&gt; </span><span class="string">'Opera/9.25 (Windows NT 6.0; U; en)'<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">); <br />
&nbsp;&nbsp;&nbsp; public static </span><span class="default">$options </span><span class="keyword">= array(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">CURLOPT_USERAGENT </span><span class="keyword">=&gt; </span><span class="string">'Mozilla/5.0 (Windows; U; Windows NT 5.1; pl; rv:1.9) Gecko/2008052906 Firefox/3.0'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">CURLOPT_AUTOREFERER </span><span class="keyword">=&gt; </span><span class="default">true</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">CURLOPT_COOKIEFILE </span><span class="keyword">=&gt; </span><span class="string">''</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">CURLOPT_FOLLOWLOCATION </span><span class="keyword">=&gt; </span><span class="default">true<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; private static </span><span class="default">$proxyServers </span><span class="keyword">= array();<br />
&nbsp;&nbsp;&nbsp; private static </span><span class="default">$proxyCount </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; private static </span><span class="default">$currentProxyIndex </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public static function </span><span class="default">addProxyServer</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">$proxyServers</span><span class="keyword">[] = </span><span class="default">$url</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; ++</span><span class="default">self</span><span class="keyword">::</span><span class="default">$proxyCount</span><span class="keyword">;&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public static function </span><span class="default">fetchContent</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">, </span><span class="default">$verbose </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ((</span><span class="default">$curl </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">)) == </span><span class="default">false</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="string">"curl_init error for url </span><span class="default">$url</span><span class="string">."</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">self</span><span class="keyword">::</span><span class="default">$proxyCount </span><span class="keyword">&gt; </span><span class="default">0</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$proxy </span><span class="keyword">= </span><span class="default">self</span><span class="keyword">::</span><span class="default">$proxyServers</span><span class="keyword">[</span><span class="default">self</span><span class="keyword">::</span><span class="default">$currentProxyIndex</span><span class="keyword">++ % </span><span class="default">self</span><span class="keyword">::</span><span class="default">$proxyCount</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">, </span><span class="default">CURLOPT_PROXY</span><span class="keyword">, </span><span class="default">$proxy</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$verbose </span><span class="keyword">=== </span><span class="default">true</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Reading </span><span class="default">$url</span><span class="string"> [Proxy: </span><span class="default">$proxy</span><span class="string">] ... "</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else if (</span><span class="default">$verbose </span><span class="keyword">=== </span><span class="default">true</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Reading </span><span class="default">$url</span><span class="string"> ... "</span><span class="keyword">;&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt_array</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">, </span><span class="default">self</span><span class="keyword">::</span><span class="default">$options</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$content </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$content </span><span class="keyword">=== </span><span class="default">false</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="string">"curl_exec error for url </span><span class="default">$url</span><span class="string">."</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$verbose </span><span class="keyword">=== </span><span class="default">true</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Done.\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$content </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'#\n+#'</span><span class="keyword">, </span><span class="string">' '</span><span class="keyword">, </span><span class="default">$content</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$content </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'#\s+#'</span><span class="keyword">, </span><span class="string">' '</span><span class="keyword">, </span><span class="default">$content</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$content</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public static function </span><span class="default">downloadFile</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">, </span><span class="default">$fileName</span><span class="keyword">, </span><span class="default">$verbose </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ((</span><span class="default">$curl </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">)) == </span><span class="default">false</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="string">"curl_init error for url </span><span class="default">$url</span><span class="string">."</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">self</span><span class="keyword">::</span><span class="default">$proxyCount </span><span class="keyword">&gt; </span><span class="default">0</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$proxy </span><span class="keyword">= </span><span class="default">self</span><span class="keyword">::</span><span class="default">$proxyServers</span><span class="keyword">[</span><span class="default">self</span><span class="keyword">::</span><span class="default">$currentProxyIndex</span><span class="keyword">++ % </span><span class="default">self</span><span class="keyword">::</span><span class="default">$proxyCount</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">, </span><span class="default">CURLOPT_PROXY</span><span class="keyword">, </span><span class="default">$proxy</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$verbose </span><span class="keyword">=== </span><span class="default">true</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Downloading </span><span class="default">$url</span><span class="string"> [Proxy: </span><span class="default">$proxy</span><span class="string">] ... "</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else if (</span><span class="default">$verbose </span><span class="keyword">=== </span><span class="default">true</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Downloading </span><span class="default">$url</span><span class="string"> ... "</span><span class="keyword">;&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt_array</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">, </span><span class="default">self</span><span class="keyword">::</span><span class="default">$options</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$fileName</span><span class="keyword">, -</span><span class="default">1</span><span class="keyword">) == </span><span class="string">'/'</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$targetDir </span><span class="keyword">= </span><span class="default">$fileName</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fileName </span><span class="keyword">= </span><span class="default">tempnam</span><span class="keyword">(</span><span class="default">sys_get_temp_dir</span><span class="keyword">(), </span><span class="string">'c_'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ((</span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$fileName</span><span class="keyword">, </span><span class="string">"wb"</span><span class="keyword">)) === </span><span class="default">false</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="string">"fopen error for filename </span><span class="default">$fileName</span><span class="string">"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">, </span><span class="default">CURLOPT_FILE</span><span class="keyword">, </span><span class="default">$fp</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">, </span><span class="default">CURLOPT_BINARYTRANSFER</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">) === </span><span class="default">false</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">unlink</span><span class="keyword">(</span><span class="default">$fileName</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="string">"curl_exec error for url </span><span class="default">$url</span><span class="string">."</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } elseif (isset(</span><span class="default">$targetDir</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$eurl </span><span class="keyword">= </span><span class="default">curl_getinfo</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">, </span><span class="default">CURLINFO_EFFECTIVE_URL</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'#^.*/(.+)$#'</span><span class="keyword">, </span><span class="default">$eurl</span><span class="keyword">, </span><span class="default">$match</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">rename</span><span class="keyword">(</span><span class="default">$fileName</span><span class="keyword">, </span><span class="string">"</span><span class="default">$targetDir</span><span class="keyword">{</span><span class="default">$match</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]}</span><span class="string">"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fileName </span><span class="keyword">= </span><span class="string">"</span><span class="default">$targetDir</span><span class="keyword">{</span><span class="default">$match</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]}</span><span class="string">"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$verbose </span><span class="keyword">=== </span><span class="default">true</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Done.\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$fileName</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }&nbsp; &nbsp; <br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83676""></a>
  <div class="note">
   <strong class="user">alan at forsyth dot cz</strong>
   <a href="#83676" class="date">07-Jun-2008 12:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Great class Roman - just one fix:<br />
<br />
Replace the following line:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">if (isset(</span><span class="default">$params</span><span class="keyword">[</span><span class="string">'host'</span><span class="keyword">]) &amp;&amp; </span><span class="default">$params</span><span class="keyword">[</span><span class="string">'host'</span><span class="keyword">])&nbsp; &nbsp; &nbsp; </span><span class="default">$header</span><span class="keyword">[]=</span><span class="string">"Host: "</span><span class="keyword">.</span><span class="default">$host</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
with this:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">if (isset(</span><span class="default">$params</span><span class="keyword">[</span><span class="string">'host'</span><span class="keyword">]) &amp;&amp; </span><span class="default">$params</span><span class="keyword">[</span><span class="string">'host'</span><span class="keyword">])&nbsp; &nbsp; &nbsp; </span><span class="default">$header</span><span class="keyword">[]=</span><span class="string">"Host: " </span><span class="keyword">. </span><span class="default">$params</span><span class="keyword">[</span><span class="string">'host'</span><span class="keyword">];<br />
</span><span class="default">?&gt;<br />
</span><br />
CURL automatically creates the host parameter (since it is required for HTTP/1.1 requests), so you don't need to set it. But if you created a custom host parameter, the above bug would cause a '400 Bad Request' response due to invalid host specified.<br />
<br />
Also when copying and pasting the class code, make sure that no line breaks occur (for example in the $header and $user_agent definitions etc.). It will still be valid PHP, but the HTTP request will not be valid, and you may get a '400 Bad Request' response from the server.<br />
<br />
It took me a little playing around with an HTTP Sniffer before I finally got an HTTP POST request fully working!<br />
<br />
Thanks,<br />
Alan</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="80442""></a>
  <div class="note">
   <strong class="user">roman dot ivasyuk at gmail dot com</strong>
   <a href="#80442" class="date">16-Jan-2008 01:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">CurlRequest<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$ch</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; * Init curl session<br />
&nbsp;&nbsp; &nbsp; * <br />
&nbsp;&nbsp; &nbsp; * $params = array('url' =&gt; '',<br />
&nbsp;&nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'host' =&gt; '',<br />
&nbsp;&nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 'header' =&gt; '',<br />
&nbsp;&nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 'method' =&gt; '',<br />
&nbsp;&nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 'referer' =&gt; '',<br />
&nbsp;&nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 'cookie' =&gt; '',<br />
&nbsp;&nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 'post_fields' =&gt; '',<br />
&nbsp;&nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ['login' =&gt; '',]<br />
&nbsp;&nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ['password' =&gt; '',]&nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 'timeout' =&gt; 0<br />
&nbsp;&nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; );<br />
&nbsp;&nbsp; &nbsp; */&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public function </span><span class="default">init</span><span class="keyword">(</span><span class="default">$params</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$user_agent </span><span class="keyword">= </span><span class="string">'Mozilla/5.0 (Windows; U; <br />
Windows NT 5.1; ru; rv:1.8.0.9) Gecko/20061206 Firefox/1.5.0.9'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$header </span><span class="keyword">= array(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"Accept: text/xml,application/xml,application/xhtml+xml,<br />
text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5"</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"Accept-Language: ru-ru,ru;q=0.7,en-us;q=0.5,en;q=0.3"</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"Accept-Charset: windows-1251,utf-8;q=0.7,*;q=0.7"</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"Keep-Alive: 300"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (isset(</span><span class="default">$params</span><span class="keyword">[</span><span class="string">'host'</span><span class="keyword">]) &amp;&amp; </span><span class="default">$params</span><span class="keyword">[</span><span class="string">'host'</span><span class="keyword">])&nbsp; &nbsp; &nbsp; </span><span class="default">$header</span><span class="keyword">[]=</span><span class="string">"Host: "</span><span class="keyword">.</span><span class="default">$host</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (isset(</span><span class="default">$params</span><span class="keyword">[</span><span class="string">'header'</span><span class="keyword">]) &amp;&amp; </span><span class="default">$params</span><span class="keyword">[</span><span class="string">'header'</span><span class="keyword">]) </span><span class="default">$header</span><span class="keyword">[]=</span><span class="default">$params</span><span class="keyword">[</span><span class="string">'header'</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; @</span><span class="default">curl_setopt </span><span class="keyword">( </span><span class="default">$this </span><span class="keyword">-&gt; </span><span class="default">ch </span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER </span><span class="keyword">, </span><span class="default">1 </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; @</span><span class="default">curl_setopt </span><span class="keyword">( </span><span class="default">$this </span><span class="keyword">-&gt; </span><span class="default">ch </span><span class="keyword">, </span><span class="default">CURLOPT_VERBOSE </span><span class="keyword">, </span><span class="default">1 </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; @</span><span class="default">curl_setopt </span><span class="keyword">( </span><span class="default">$this </span><span class="keyword">-&gt; </span><span class="default">ch </span><span class="keyword">, </span><span class="default">CURLOPT_HEADER </span><span class="keyword">, </span><span class="default">1 </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$params</span><span class="keyword">[</span><span class="string">'method'</span><span class="keyword">] == </span><span class="string">"HEAD"</span><span class="keyword">) @</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$this </span><span class="keyword">-&gt; </span><span class="default">ch</span><span class="keyword">,</span><span class="default">CURLOPT_NOBODY</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; @</span><span class="default">curl_setopt </span><span class="keyword">( </span><span class="default">$this </span><span class="keyword">-&gt; </span><span class="default">ch</span><span class="keyword">, </span><span class="default">CURLOPT_FOLLOWLOCATION</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; @</span><span class="default">curl_setopt </span><span class="keyword">( </span><span class="default">$this </span><span class="keyword">-&gt; </span><span class="default">ch </span><span class="keyword">, </span><span class="default">CURLOPT_HTTPHEADER</span><span class="keyword">, </span><span class="default">$header </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$params</span><span class="keyword">[</span><span class="string">'referer'</span><span class="keyword">])&nbsp; &nbsp; @</span><span class="default">curl_setopt </span><span class="keyword">(</span><span class="default">$this </span><span class="keyword">-&gt; </span><span class="default">ch </span><span class="keyword">, </span><span class="default">CURLOPT_REFERER</span><span class="keyword">, </span><span class="default">$params</span><span class="keyword">[</span><span class="string">'referer'</span><span class="keyword">] );<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; @</span><span class="default">curl_setopt </span><span class="keyword">( </span><span class="default">$this </span><span class="keyword">-&gt; </span><span class="default">ch </span><span class="keyword">, </span><span class="default">CURLOPT_USERAGENT</span><span class="keyword">, </span><span class="default">$user_agent</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$params</span><span class="keyword">[</span><span class="string">'cookie'</span><span class="keyword">])&nbsp; &nbsp; @</span><span class="default">curl_setopt </span><span class="keyword">(</span><span class="default">$this </span><span class="keyword">-&gt; </span><span class="default">ch </span><span class="keyword">, </span><span class="default">CURLOPT_COOKIE</span><span class="keyword">, </span><span class="default">$params</span><span class="keyword">[</span><span class="string">'cookie'</span><span class="keyword">]);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( </span><span class="default">$params</span><span class="keyword">[</span><span class="string">'method'</span><span class="keyword">] == </span><span class="string">"POST" </span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">( </span><span class="default">$this </span><span class="keyword">-&gt; </span><span class="default">ch</span><span class="keyword">, </span><span class="default">CURLOPT_POST</span><span class="keyword">, </span><span class="default">true </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">( </span><span class="default">$this </span><span class="keyword">-&gt; </span><span class="default">ch</span><span class="keyword">, </span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">, </span><span class="default">$params</span><span class="keyword">[</span><span class="string">'post_fields'</span><span class="keyword">] );<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; @</span><span class="default">curl_setopt</span><span class="keyword">( </span><span class="default">$this </span><span class="keyword">-&gt; </span><span class="default">ch</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="default">$params</span><span class="keyword">[</span><span class="string">'url'</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; @</span><span class="default">curl_setopt </span><span class="keyword">( </span><span class="default">$this </span><span class="keyword">-&gt; </span><span class="default">ch </span><span class="keyword">, </span><span class="default">CURLOPT_SSL_VERIFYPEER</span><span class="keyword">, </span><span class="default">0 </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; @</span><span class="default">curl_setopt </span><span class="keyword">( </span><span class="default">$this </span><span class="keyword">-&gt; </span><span class="default">ch </span><span class="keyword">, </span><span class="default">CURLOPT_SSL_VERIFYHOST</span><span class="keyword">, </span><span class="default">0 </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (isset(</span><span class="default">$params</span><span class="keyword">[</span><span class="string">'login'</span><span class="keyword">]) &amp; isset(</span><span class="default">$params</span><span class="keyword">[</span><span class="string">'password'</span><span class="keyword">]))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; @</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$this </span><span class="keyword">-&gt; </span><span class="default">ch </span><span class="keyword">, </span><span class="default">CURLOPT_USERPWD</span><span class="keyword">,</span><span class="default">$params</span><span class="keyword">[</span><span class="string">'login'</span><span class="keyword">].</span><span class="string">':'</span><span class="keyword">.</span><span class="default">$params</span><span class="keyword">[</span><span class="string">'password'</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; @</span><span class="default">curl_setopt </span><span class="keyword">( </span><span class="default">$this </span><span class="keyword">-&gt; </span><span class="default">ch </span><span class="keyword">, </span><span class="default">CURLOPT_TIMEOUT</span><span class="keyword">, </span><span class="default">$params</span><span class="keyword">[</span><span class="string">'timeout'</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; * Make curl request<br />
&nbsp;&nbsp; &nbsp; *<br />
&nbsp;&nbsp; &nbsp; * @return array&nbsp; 'header','body','curl_error','http_code','last_url'<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">public function </span><span class="default">exec</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$response </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">ch</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$error </span><span class="keyword">= </span><span class="default">curl_error</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">ch</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">= array( </span><span class="string">'header' </span><span class="keyword">=&gt; </span><span class="string">''</span><span class="keyword">, <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">'body' </span><span class="keyword">=&gt; </span><span class="string">''</span><span class="keyword">, <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">'curl_error' </span><span class="keyword">=&gt; </span><span class="string">''</span><span class="keyword">, <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">'http_code' </span><span class="keyword">=&gt; </span><span class="string">''</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">'last_url' </span><span class="keyword">=&gt; </span><span class="string">''</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( </span><span class="default">$error </span><span class="keyword">!= </span><span class="string">"" </span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result</span><span class="keyword">[</span><span class="string">'curl_error'</span><span class="keyword">] = </span><span class="default">$error</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$result</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$header_size </span><span class="keyword">= </span><span class="default">curl_getinfo</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">ch</span><span class="keyword">,</span><span class="default">CURLINFO_HEADER_SIZE</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result</span><span class="keyword">[</span><span class="string">'header'</span><span class="keyword">] = </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$response</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$header_size</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result</span><span class="keyword">[</span><span class="string">'body'</span><span class="keyword">] = </span><span class="default">substr</span><span class="keyword">( </span><span class="default">$response</span><span class="keyword">, </span><span class="default">$header_size </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result</span><span class="keyword">[</span><span class="string">'http_code'</span><span class="keyword">] = </span><span class="default">curl_getinfo</span><span class="keyword">(</span><span class="default">$this </span><span class="keyword">-&gt; </span><span class="default">ch</span><span class="keyword">,</span><span class="default">CURLINFO_HTTP_CODE</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result</span><span class="keyword">[</span><span class="string">'last_url'</span><span class="keyword">] = </span><span class="default">curl_getinfo</span><span class="keyword">(</span><span class="default">$this </span><span class="keyword">-&gt; </span><span class="default">ch</span><span class="keyword">,</span><span class="default">CURLINFO_EFFECTIVE_URL</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$result</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Example of use:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">..........<br />
try<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$params </span><span class="keyword">= array(</span><span class="string">'url' </span><span class="keyword">=&gt; </span><span class="string">'<a href="http://www.google.com" rel="nofollow" target="_blank">http://www.google.com</a>'</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'host' </span><span class="keyword">=&gt; </span><span class="string">''</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'header' </span><span class="keyword">=&gt; </span><span class="string">''</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'method' </span><span class="keyword">=&gt; </span><span class="string">'GET'</span><span class="keyword">, </span><span class="comment">// 'POST','HEAD'<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'referer' </span><span class="keyword">=&gt; </span><span class="string">''</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'cookie' </span><span class="keyword">=&gt; </span><span class="string">''</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'post_fields' </span><span class="keyword">=&gt; </span><span class="string">''</span><span class="keyword">, </span><span class="comment">// 'var1=value&amp;var2=value<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'timeout' </span><span class="keyword">=&gt; </span><span class="default">20<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">curl</span><span class="keyword">-&gt;</span><span class="default">init</span><span class="keyword">(</span><span class="default">$params</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">curl</span><span class="keyword">-&gt;</span><span class="default">exec</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$result</span><span class="keyword">[</span><span class="string">'curl_error'</span><span class="keyword">])&nbsp; &nbsp; throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">[</span><span class="string">'curl_error'</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$result</span><span class="keyword">[</span><span class="string">'http_code'</span><span class="keyword">]!=</span><span class="string">'200'</span><span class="keyword">)&nbsp; &nbsp; throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="string">"HTTP Code = "</span><span class="keyword">.</span><span class="default">$result</span><span class="keyword">[</span><span class="string">'http_code'</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">$result</span><span class="keyword">[</span><span class="string">'body'</span><span class="keyword">])&nbsp; &nbsp; &nbsp; &nbsp; throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="string">"Body of file is empty"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ...............<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; catch (</span><span class="default">Exception $e</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">$e</span><span class="keyword">-&gt;</span><span class="default">getMessage</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="79572""></a>
  <div class="note">
   <strong class="user">me at lawrencemok dot com</strong>
   <a href="#79572" class="date">04-Dec-2007 08:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that when you use CURL to POST things....e.g:<br />
<br />
curl_setopt($ch, CURLOPT_POSTFIELDS, "string=This is a string"); <br />
<br />
The data part (e.g. "This is a string") inside the 3rd parameter should be applied with urlencode()<br />
<br />
Otherwise, if you intend to send a string like "%2F", you will end up with a "/" on the receiving end, which can cause troubles. (e.g. serialize() data cannot be unserialize() becase of the change in string length).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77167""></a>
  <div class="note">
   <strong class="user">shanto at ultimawebsolutions dot com</strong>
   <a href="#77167" class="date">17-Aug-2007 06:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A function to retrieve the status code of an HTTP request using CURL:<br />
<br />
&nbsp;&nbsp;&nbsp; function getHttpResponseCode($url)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $ch = @curl_init($url);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; @curl_setopt($ch, CURLOPT_HEADER, TRUE);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; @curl_setopt($ch, CURLOPT_NOBODY, TRUE);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; @curl_setopt($ch, CURLOPT_FOLLOWLOCATION, FALSE);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; @curl_setopt($ch, CURLOPT_RETURNTRANSFER, TRUE);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $status = array();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $response = @curl_exec($ch);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; preg_match('/HTTP\/.* ([0-9]+) .*/', $response, $status);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return $status[1];<br />
&nbsp;&nbsp;&nbsp; }</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77058""></a>
  <div class="note">
   <strong class="user">test at test dot com</strong>
   <a href="#77058" class="date">13-Aug-2007 03:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you see a "0" at the end of the output, you might want to switch to HTTP/1.0:<br />
<br />
curl_setopt($ch, CURLOPT_HTTP_VERSION, 1.0);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="70198""></a>
  <div class="note">
   <strong class="user">lukasl at ackleymedia dot com</strong>
   <a href="#70198" class="date">06-Oct-2006 04:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Thank you for sharing this.&nbsp; I was wondering why my result was 1.<br />
<br />
To get around this in a safe way, this is how I check if the result is valid.<br />
<br />
$ch = curl_init(); /// initialize a cURL session <br />
curl_setopt ($ch, CURLOPT_RETURNTRANSFER, true);<br />
$xmlResponse = curl_exec ($ch);<br />
curl_close ($ch);<br />
<br />
if (!is_string($xmlResponse) || !strlen($xmlResponse)) {<br />
&nbsp;&nbsp;&nbsp; return $this-&gt;_set_error( "Failure Contacting Server" );<br />
} else {<br />
&nbsp;&nbsp;&nbsp; return $xmlResponse;<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="70123""></a>
  <div class="note">
   
   <a href="#70123" class="date">04-Oct-2006 10:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Be careful when using curl_exec() and the CURLOPT_RETURNTRANSFER option. According to the manual and assorted documentation:<br />
Set CURLOPT_RETURNTRANSFER to TRUE to return the transfer as a string of the return value of curl_exec() instead of outputting it out directly.<br />
<br />
When retrieving a document with no content (ie. 0 byte file), curl_exec() will return bool(true), not an empty string. I've not seen any mention of this in the manual.<br />
<br />
Example code to reproduce this:<br />
<span class="default">&lt;?php<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// fictional URL to an existing file with no data in it (ie. 0 byte file)<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$url </span><span class="keyword">= </span><span class="string">'<a href="http://www.example.com/empty_file.txt" rel="nofollow" target="_blank">http://www.example.com/empty_file.txt</a>'</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$curl </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="default">$url</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">, </span><span class="default">CURLOPT_HEADER</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// execute and return string (this should be an empty string '')<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$str </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$curl</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// the value of $str is actually bool(true), not empty string ''<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="50734""></a>
  <div class="note">
   <strong class="user"></strong>
   <a href="#50734" class="date">08-Mar-2005 03:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you've got problems with curl_exec not working, you should rather check curl_errno and curl_error than using commandline curl, like so:<br />
<br />
(since this is easier, and also allows you to check for errors runtime, which is a vital part of any well-design piece of code. ;)<br />
<br />
<span class="default">&lt;?php<br />
$creq </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">();<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$creq</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="string">"<a href="http://www.foo.internal" rel="nofollow" target="_blank">http://www.foo.internal</a>"</span><span class="keyword">);<br />
</span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$creq</span><span class="keyword">);<br />
<br />
</span><span class="comment">/* To quote curl_errno documentation:<br />
&nbsp;&nbsp; &nbsp; Returns the error number for the last cURL operation on the resource ch, or 0 (zero) if no error occurred. */<br />
</span><span class="keyword">if (</span><span class="default">curl_errno</span><span class="keyword">(</span><span class="default">$creq</span><span class="keyword">)) {<br />
&nbsp;&nbsp;&nbsp; print </span><span class="default">curl_error</span><span class="keyword">(</span><span class="default">$creq</span><span class="keyword">);<br />
} else {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$creq</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="33582""></a>
  <div class="note">
   <strong class="user">sybren at thirdtower dot com</strong>
   <a href="#33582" class="date">01-Jul-2003 04:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you see a "0" at the end of the output, you might want to switch to HTTP/1.0:<br />
<br />
curl_setopt($ch, CURLOPT_HTTP_VERSION, 1.0);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="31582""></a>
  <div class="note">
   <strong class="user">nagyp at hunaxon dot hu</strong>
   <a href="#31582" class="date">27-Apr-2003 02:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
fyi:<br />
It returns false if there's an error while executing the curl session, no matter how CURLOPT_RETURNTRANSFER is set.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="20998""></a>
  <div class="note">
   <strong class="user">colins at infofind dot com</strong>
   <a href="#20998" class="date">25-Apr-2002 01:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Checking the source, curl_exec seems to return FALSE on failure, TRUE on success (unless CURLOPT_RETURNTRANSFER is set 1, and then it returns the returned data).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="19497""></a>
  <div class="note">
   <strong class="user">ppruett at webengr dot com</strong>
   <a href="#19497" class="date">01-Mar-2002 04:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
fyi - if you are having problems getting a
<br />
webpage to display in your webpage with 
<br />
curl_setopt(CURLOPT_RETURNTRANSFER, 1);
<br />
due to version bugginess perhaps, 
<br />
you may can use output control functions
<br />
like this to show a web page
<br />
inside your webpage:
<br />

<br />
&lt;html&gt;&lt;head&gt;&lt;title&gt;whatever&lt;/title&gt;&lt;/head&gt;
<br />
&lt;body&gt;
<br />
<span class="default">&lt;script language="php"&gt;
<br />
$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">(</span><span class="string">"<a href="http://www.cocoavillage.com/" rel="nofollow" target="_blank">http://www.cocoavillage.com/</a>"</span><span class="keyword">);
<br />
</span><span class="comment">// use output buffering instead of returntransfer -itmaybebuggy
<br />
</span><span class="default">ob_start</span><span class="keyword">();
<br />
</span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">); 
<br />
</span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">); 
<br />
</span><span class="default">$retrievedhtml </span><span class="keyword">= </span><span class="default">ob_get_contents</span><span class="keyword">();
<br />
</span><span class="default">ob_end_clean</span><span class="keyword">();
<br />
</span><span class="comment">// if you intend to print this page with meta tags, better clear out any expiration tag
<br />
//&nbsp; &nbsp; $result = preg_replace('/(?s)&lt;meta http-equiv="Expires"[^&gt;]*&gt;/i', '', $retrievedhtml);
<br />
// for now I just want what is between the body tags so need
<br />
// somehow cut the header footer&nbsp; &nbsp;&nbsp; 
<br />
</span><span class="default">$bodyandend </span><span class="keyword">= </span><span class="default">stristr</span><span class="keyword">(</span><span class="default">$retrievedhtml</span><span class="keyword">,</span><span class="string">"&lt;body"</span><span class="keyword">);
<br />
</span><span class="comment">// not needed- $positionstartbodystring = strlen($retrievedhtml)-strlen($bodyandend);
<br />
</span><span class="default">$positionendstartbodytag </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$bodyandend</span><span class="keyword">,</span><span class="string">"&gt;"</span><span class="keyword">) + </span><span class="default">1</span><span class="keyword">;
<br />
</span><span class="comment">// got to change all to lowercase temporarily 
<br />
// because end body may be upperlowercasemix
<br />
// to bad strirstr does not exist
<br />
</span><span class="default">$temptofindposition</span><span class="keyword">=</span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">$bodyandend</span><span class="keyword">);
<br />
</span><span class="default">$positionendendbodytag</span><span class="keyword">=</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$temptofindposition</span><span class="keyword">,</span><span class="string">"&lt;/body"</span><span class="keyword">);
<br />
</span><span class="comment">//now to get the endbetween body tags
<br />
</span><span class="default">$grabbedbody</span><span class="keyword">=</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$bodyandend</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$positionendstartbodytag</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$positionendendbodytag</span><span class="keyword">); 
<br />
</span><span class="comment">//be sure to fix syntax broke by display on phpwebsite... like above line
<br />
</span><span class="keyword">print(</span><span class="string">"</span><span class="default">$grabbedbody</span><span class="string">"</span><span class="keyword">);
<br />
</span><span class="default">&lt;/script&gt;
<br />
</span>&lt;/body&gt;&lt;/html&gt;
<br />

<br />
tada</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="13020""></a>
  <div class="note">
   <strong class="user">csaba at alum dot mit dot edu</strong>
   <a href="#13020" class="date">22-May-2001 10:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you retrieve a web page and print it (so you can see it in your browser), and the page has an expiration, this expiration now applies to MyProgram.php and next time your program/page is called, even if it's grabbing a different web page, it will show what it just displayed.&nbsp; In Netscape you can get rid of this by going into Edit, Options, Advanced, Cache, and clear out the Disk Cache.&nbsp; But this is really annoying after short order.&nbsp; The following prevents the above scenario:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">GetCurlPage </span><span class="keyword">(</span><span class="default">$pageSpec</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">(</span><span class="default">$pageSpec</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$tmp </span><span class="keyword">= </span><span class="default">curl_exec </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">); 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">curl_close </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">); 
<br />
</span><span class="comment">// if you intend to print this page, better clear out expiration tag
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$tmp </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/(?s)&lt;meta http-equiv="Expires"[^&gt;]*&gt;/i'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$tmp</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$tmp</span><span class="keyword">;
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
