<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>魔术方法</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="language.oop5.iterations.html">? 遍历对象</a></li>
      <li style="float: right;"><a href="language.oop5.final.html">Final 关键字 ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="language.oop5.html">类与对象</a></li>
    <li>魔术方法</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="language.oop5.magic" class="sect1">
  <h2 class="title">魔术方法</h2>
  <p class="para">
   <a href="language.oop5.decon.html#object.construct" class="link">__construct()</a>，
   <a href="language.oop5.decon.html#object.destruct" class="link">__destruct()</a>，
   <a href="language.oop5.overloading.html#object.call" class="link">__call()</a>，
   <a href="language.oop5.overloading.html#object.callstatic" class="link">__callStatic()</a>，
   <a href="language.oop5.overloading.html#object.get" class="link">__get()</a>，
   <a href="language.oop5.overloading.html#object.set" class="link">__set()</a>，
   <a href="language.oop5.overloading.html#object.isset" class="link">__isset()</a>，
   <a href="language.oop5.overloading.html#object.unset" class="link">__unset()</a>，
   <a href="language.oop5.magic.html#object.sleep" class="link">__sleep()</a>，
   <a href="language.oop5.magic.html#object.wakeup" class="link">__wakeup()</a>，
   <a href="language.oop5.magic.html#object.tostring" class="link">__toString()</a>，
   <a href="language.oop5.magic.html#object.invoke" class="link">__invoke()</a>，
   <a href="language.oop5.magic.html#object.set-state" class="link">__set_state()</a>，
   <a href="language.oop5.cloning.html#object.clone" class="link">__clone()</a> 和 
   <a href="language.oop5.magic.html#object.debuginfo" class="link">__debugInfo()</a>
   等方法在 PHP 中被称为"<span class="quote">魔术方法</span>"（Magic
   methods）。在命名自己的类方法时不能使用这些方法名，除非是想使用其魔术功能。
  </p>

  <div class="caution"><strong class="caution">Caution</strong>
   <p class="simpara">
    PHP 将所有以 __（两个下划线）开头的类方法保留为魔术方法。所以在定义类方法时，除了上述魔术方法，建议不要以
    __ 为前缀。
   </p>
  </div>
 
  <div class="sect2" id="language.oop5.magic.sleep">
   <h3 class="title">
    <a href="language.oop5.magic.html#object.sleep" class="link">__sleep()</a> 和
    <a href="language.oop5.magic.html#object.wakeup" class="link">__wakeup()</a>
   </h3>
   
   <div class="methodsynopsis dc-description" id="object.sleep">
    <span class="modifier">public</span> <span class="type">array</span> <span class="methodname"><strong>__sleep</strong></span>
     ( <span class="methodparam">void</span>
    )</div>

   <div class="methodsynopsis dc-description" id="object.wakeup">
    <span class="type"><span class="type void">void</span></span> <span class="methodname"><strong>__wakeup</strong></span>
     ( <span class="methodparam">void</span>
    )</div>

   
   <p class="para">
    <span class="function"><a href="function.serialize.html" class="function">serialize()</a></span> 函数会检查类中是否存在一个魔术方法
    <a href="language.oop5.magic.html#object.sleep" class="link">__sleep()</a>。如果存在，该方法会先被调用，然后才执行序列化操作。此功能可以用于清理对象，并返回一个包含对象中所有应被序列化的变量名称的数组。如果该方法未返回任何内容，则
    <strong><code>NULL</code></strong> 被序列化，并产生一个 <strong><code>E_NOTICE</code></strong> 级别的错误。
    </p>
   <blockquote class="note"><p><strong class="note">Note</strong>: 
    <p class="para">
     <a href="language.oop5.magic.html#object.sleep" class="link">__sleep()</a> 不能返回父类的私有成员的名字。这样做会产生一个
     <strong><code>E_NOTICE</code></strong> 级别的错误。可以用
     <strong class="classname">Serializable</strong> 接口来替代。
    </p>
   </p></blockquote>
    
    
   <p class="para">
    <a href="language.oop5.magic.html#object.sleep" class="link">__sleep()</a> 方法常用于提交未提交的数据，或类似的清理操作。同时，如果有一些很大的对象，但不需要全部保存，这个功能就很好用。
   </p>
   <p class="para">
    与之相反，<span class="function"><a href="function.unserialize.html" class="function">unserialize()</a></span> 会检查是否存在一个 <a href="language.oop5.magic.html#object.wakeup" class="link">__wakeup()</a>
    方法。如果存在，则会先调用 <em>__wakeup</em> 方法，预先准备对象需要的资源。
   </p>
   <p class="para">
    <a href="language.oop5.magic.html#object.wakeup" class="link">__wakeup()</a> 经常用在反序列化操作中，例如重新建立数据库连接，或执行其它初始化操作。
   </p>
   <div class="example" id="example-233">
    <p><strong>Example #1 Sleep 和 wakeup</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">Connection&nbsp;<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;</span><span style="color: #0000BB">$link</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;</span><span style="color: #0000BB">$server</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$username</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$password</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$db</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">__construct</span><span style="color: #007700">(</span><span style="color: #0000BB">$server</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$username</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$password</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$db</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">server&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$server</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">username&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$username</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">password&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$password</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">db&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$db</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">connect</span><span style="color: #007700">();<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;function&nbsp;</span><span style="color: #0000BB">connect</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">link&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mysql_connect</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">server</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">username</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">password</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">mysql_select_db</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">db</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">link</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">__sleep</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;array(</span><span style="color: #DD0000">'server'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'username'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'password'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'db'</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">__wakeup</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">connect</span><span style="color: #007700">();<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </div>

  <div class="sect2" id="language.oop5.magic.tostring">
   <h3 class="title"><a href="language.oop5.magic.html#object.tostring" class="link">__toString()</a></h3>
   <div class="methodsynopsis dc-description" id="object.tostring">
    <span class="modifier">public</span> <span class="type">string</span> <span class="methodname"><strong>__toString</strong></span>
     ( <span class="methodparam">void</span>
    )</div>

   
   <p class="para">
    <a href="language.oop5.magic.html#object.tostring" class="link">__toString()</a> 方法用于一个类被当成字符串时应怎样回应。例如
    <em>echo $obj;</em> 应该显示些什么。此方法必须返回一个字符串，否则将发出一条
    <strong><code>E_RECOVERABLE_ERROR</code></strong> 级别的致命错误。
   </p>
   <div class="warning"><strong class="warning">Warning</strong>
    <p class="simpara">
     不能在 <a href="language.oop5.magic.html#object.tostring" class="link">__toString()</a>
     方法中抛出异常。这么做会导致致命错误。
    </p>
   </div>
   <div class="example" id="example-234">
    <p><strong>Example #2 简单示例</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;Declare&nbsp;a&nbsp;simple&nbsp;class<br /></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">TestClass<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;</span><span style="color: #0000BB">$foo</span><span style="color: #007700">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">__construct</span><span style="color: #007700">(</span><span style="color: #0000BB">$foo</span><span style="color: #007700">)&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">foo&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$foo</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">__toString</span><span style="color: #007700">()&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">foo</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /><br /></span><span style="color: #0000BB">$class&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">TestClass</span><span style="color: #007700">(</span><span style="color: #DD0000">'Hello'</span><span style="color: #007700">);<br />echo&nbsp;</span><span style="color: #0000BB">$class</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>以上例程会输出：</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
Hello
</pre></div>
    </div>
   </div>
   <p class="para">
    需要指出的是在 PHP 5.2.0 之前，<a href="language.oop5.magic.html#object.tostring" class="link">__toString()</a>
    方法只有在直接使用于 <span class="function"><a href="function.echo.html" class="function">echo</a></span> 或 <span class="function"><a href="function.print.html" class="function">print</a></span>
    时才能生效。PHP 5.2.0 之后，则可以在任何字符串环境生效（例如通过
    <span class="function"><a href="function.printf.html" class="function">printf()</a></span>，使用 <em>%s</em> 修饰符），但不能用于非字符串环境（如使用
    <em>%d</em> 修饰符）。自 PHP 5.2.0 起，如果将一个未定义
    <a href="language.oop5.magic.html#object.tostring" class="link">__toString()</a> 方法的对象转换为字符串，会产生
    <strong><code>E_RECOVERABLE_ERROR</code></strong> 级别的错误。
   </p>
  </div>

  <div class="sect2" id="language.oop5.magic.invoke">
   <h3 class="title"><a href="language.oop5.magic.html#object.invoke" class="link">__invoke()</a></h3>
   <div class="methodsynopsis dc-description" id="object.invoke">
    <span class="type"><a href="language.pseudo-types.html#language.types.mixed" class="type mixed">mixed</a></span> <span class="methodname"><strong>__invoke</strong></span>
     ([ <span class="methodparam"> <code class="parameter">$...</code></span>
   ] )</div>

   <p class="para">
    当尝试以调用函数的方式调用一个对象时，<a href="language.oop5.magic.html#object.invoke" class="link">__invoke()</a> 方法会被自动调用。
   </p>
   <blockquote class="note"><p><strong class="note">Note</strong>: 
    <p class="para">     
     本特性只在 PHP 5.3.0 及以上版本有效。
    </p>
   </p></blockquote>
   <div class="example" id="example-235">
    <p><strong>Example #3 使用 <a href="language.oop5.magic.html#object.invoke" class="link">__invoke()</a></strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">CallableClass&nbsp;<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;</span><span style="color: #0000BB">__invoke</span><span style="color: #007700">(</span><span style="color: #0000BB">$x</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$x</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /></span><span style="color: #0000BB">$obj&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">CallableClass</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$obj</span><span style="color: #007700">(</span><span style="color: #0000BB">5</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">is_callable</span><span style="color: #007700">(</span><span style="color: #0000BB">$obj</span><span style="color: #007700">));<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>以上例程会输出：</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
int(5)
bool(true)
</pre></div>
    </div>
   </div>
  </div>

  <div class="sect2" id="language.oop5.magic.set-state">
   <h3 class="title"><a href="language.oop5.magic.html#object.set-state" class="link">__set_state()</a></h3>
   <div class="methodsynopsis dc-description" id="object.set-state">
    <span class="modifier">static</span> <span class="type">object</span> <span class="methodname"><strong>__set_state</strong></span>
     ( <span class="methodparam"><span class="type">array</span> <code class="parameter">$properties</code></span>
    )</div>

   <p class="para">
    自 PHP 5.1.0 起当调用 <span class="function"><a href="function.var-export.html" class="function">var_export()</a></span> 导出类时，此<a href="language.oop5.static.html" class="link">静态</a> 方法会被调用。
   </p>
   <p class="para">
    本方法的唯一参数是一个数组，其中包含按 <em>array(&#039;property&#039; =&gt; value, ...)</em> 格式排列的类属性。
   </p>
   <div class="example" id="example-236">
    <p><strong>Example #4 使用 <a href="language.oop5.magic.html#object.set-state" class="link">__set_state()</a>&gt;（PHP 5.1.0 起）</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br /></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">A<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;</span><span style="color: #0000BB">$var1</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;</span><span style="color: #0000BB">$var2</span><span style="color: #007700">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;</span><span style="color: #0000BB">__set_state</span><span style="color: #007700">(</span><span style="color: #0000BB">$an_array</span><span style="color: #007700">)&nbsp;</span><span style="color: #FF8000">//&nbsp;As&nbsp;of&nbsp;PHP&nbsp;5.1.0<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$obj&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">A</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$obj</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">var1&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$an_array</span><span style="color: #007700">[</span><span style="color: #DD0000">'var1'</span><span style="color: #007700">];<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$obj</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">var2&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$an_array</span><span style="color: #007700">[</span><span style="color: #DD0000">'var2'</span><span style="color: #007700">];<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$obj</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /><br /></span><span style="color: #0000BB">$a&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">A</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$a</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">var1&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">5</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$a</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">var2&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'foo'</span><span style="color: #007700">;<br /><br />eval(</span><span style="color: #DD0000">'$b&nbsp;=&nbsp;'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">var_export</span><span style="color: #007700">(</span><span style="color: #0000BB">$a</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">)&nbsp;.&nbsp;</span><span style="color: #DD0000">';'</span><span style="color: #007700">);&nbsp;</span><span style="color: #FF8000">//&nbsp;$b&nbsp;=&nbsp;A::__set_state(array(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;&nbsp;&nbsp;'var1'&nbsp;=&gt;&nbsp;5,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;&nbsp;&nbsp;'var2'&nbsp;=&gt;&nbsp;'foo',<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;));<br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$b</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>以上例程会输出：</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
object(A)#2 (2) {
  [&quot;var1&quot;]=&gt;
  int(5)
  [&quot;var2&quot;]=&gt;
  string(3) &quot;foo&quot;
}
</pre></div>
    </div>
   </div>
  </div>
  <div class="sect2" id="language.oop5.magic.debuginfo">
   <h3 class="title"><a href="language.oop5.magic.html#object.debuginfo" class="link">__debugInfo()</a></h3>
   <div class="methodsynopsis dc-description" id="object.debuginfo">
    <span class="type">array</span> <span class="methodname"><strong>__debugInfo</strong></span>
     ( <span class="methodparam">void</span>
    )</div>

   <p class="para">
    This method is called by <span class="function"><a href="function.var-dump.html" class="function">var_dump()</a></span> when dumping an
    object to get the properties that should be shown. If the method isn&#039;t
    defined on an object, then all public, protected and private properties
    will be shown.
   </p>
   <p class="para">
    This feature was added in PHP 5.6.0.
   </p>
   <div class="example" id="example-237">
    <p><strong>Example #5 Using <a href="language.oop5.magic.html#object.debuginfo" class="link">__debugInfo()</a></strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">C&nbsp;</span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;</span><span style="color: #0000BB">$prop</span><span style="color: #007700">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">__construct</span><span style="color: #007700">(</span><span style="color: #0000BB">$val</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prop&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$val</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">__debugInfo</span><span style="color: #007700">()&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;[<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'propSquared'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prop&nbsp;</span><span style="color: #007700">**&nbsp;</span><span style="color: #0000BB">2</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;];<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /><br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(new&nbsp;</span><span style="color: #0000BB">C</span><span style="color: #007700">(</span><span style="color: #0000BB">42</span><span style="color: #007700">));<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>以上例程会输出：</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
object(C)#1 (1) {
  [&quot;propSquared&quot;]=&gt;
  int(1764)
}
</pre></div>
    </div>
   </div>
  </div>
 </div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="112209""></a>
  <div class="note">
   <strong class="user">danillo dot paiva dot toledo at gmail dot com</strong>
   <a href="#112209" class="date">17-May-2013 04:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
While I was studying Ruby I saw as such interesting things as properties created + its getters and setters in just one line.<br />
<br />
I tryied to do the same in PHP and this is the code I have<br />
<br />
class Father {<br />
&nbsp;&nbsp;&nbsp; public function __call($name, $args) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(isset($this-&gt;$name)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(isset($args[0]))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return $this-&gt;$name = $args[0];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return $this-&gt;$name;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return false;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
class Child extends Father {<br />
&nbsp;&nbsp;&nbsp; public $country = "Brazil";<br />
&nbsp;&nbsp;&nbsp; public $state = "Sao Paulo";<br />
}<br />
<br />
Sometimes we don't need things like that on all classes but is quite interesting.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="112193""></a>
  <div class="note">
   <strong class="user">staff at pro-unreal dot de</strong>
   <a href="#112193" class="date">16-May-2013 03:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To avoid instanciating the parent instead of the inherited class for __set_state() as reported by jsnell, you could use late static binding introduced in PHP 5.3:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">A </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public static function </span><span class="default">__set_state</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return new static();<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
class </span><span class="default">B </span><span class="keyword">extends </span><span class="default">A </span><span class="keyword">{<br />
}<br />
<br />
</span><span class="default">$instance </span><span class="keyword">= new </span><span class="default">B</span><span class="keyword">();<br />
eval(</span><span class="string">'$test = ' </span><span class="keyword">. </span><span class="default">var_export</span><span class="keyword">(</span><span class="default">$instance</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">) . </span><span class="string">';'</span><span class="keyword">);<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$test</span><span class="keyword">);<br />
</span><span class="comment">// -&gt; object(B)#2 (0) {<br />
// }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="111981""></a>
  <div class="note">
   <strong class="user">igorbt</strong>
   <a href="#111981" class="date">19-Apr-2013 05:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In recent versions of PHP, if you define __toString with arguments it will trigger a Fatal error: "__tostring() cannot take arguments". But, if you really need this (like I needed, because my framework heavily used these arguments), you have a workaround:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">a <br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__toString</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; list(</span><span class="default">$a</span><span class="keyword">) = </span><span class="default">func_get_args</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$a</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">$a </span><span class="keyword">= new </span><span class="default">a</span><span class="keyword">();<br />
echo </span><span class="default">$a</span><span class="keyword">-&gt;</span><span class="default">__toString</span><span class="keyword">(</span><span class="string">'PHP'</span><span class="keyword">); </span><span class="comment">// PHP<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="109967""></a>
  <div class="note">
   <strong class="user">qfox at ya dot ru</strong>
   <a href="#109967" class="date">06-Sep-2012 09:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For those of you who have the same trouble as osbertv.<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// ...<br />
<br />
</span><span class="default">$a </span><span class="keyword">= new </span><span class="default">A</span><span class="keyword">();<br />
</span><span class="default">$b </span><span class="keyword">= new </span><span class="default">B</span><span class="keyword">();<br />
</span><span class="default">$a</span><span class="keyword">();<br />
</span><span class="default">$b</span><span class="keyword">();<br />
</span><span class="default">$b</span><span class="keyword">-&gt;</span><span class="default">a</span><span class="keyword">();<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
PHP Fatal error:&nbsp; Call to undefined method B::a()<br />
<br />
It's because PHP have bug in parsing syntax (a lot of).<br />
Just make it easier to parse and it would work.<br />
For example, like this:<br />
<span class="default">&lt;?php<br />
$c </span><span class="keyword">= </span><span class="default">$b</span><span class="keyword">-&gt;</span><span class="default">a</span><span class="keyword">;<br />
</span><span class="default">$c</span><span class="keyword">();<br />
</span><span class="default">?&gt;<br />
</span><br />
Or this, if you use 5.4 (if you using 5.3 just move call function to the each class which need it or to some base abstract class):<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">trait </span><span class="default">TInnerClosuresInvoker </span><span class="keyword">{<br />
&nbsp; function </span><span class="default">__call</span><span class="keyword">(</span><span class="default">$method</span><span class="keyword">, </span><span class="default">$args</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if (isset(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">$method</span><span class="keyword">) &amp;&amp; </span><span class="default">is_callable</span><span class="keyword">(</span><span class="default">$method</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$closure </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">$method</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">call_user_func_array</span><span class="keyword">(</span><span class="default">$closure</span><span class="keyword">, </span><span class="default">$args</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">trigger_error</span><span class="keyword">(</span><span class="string">'Call to undefined method '</span><span class="keyword">.</span><span class="default">__CLASS__</span><span class="keyword">.</span><span class="string">'::'</span><span class="keyword">.</span><span class="default">$method</span><span class="keyword">.</span><span class="string">'()'</span><span class="keyword">, </span><span class="default">E_USER_ERROR</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
}<br />
class </span><span class="default">A </span><span class="keyword">{<br />
&nbsp; use </span><span class="default">TInnerClosuresInvoker</span><span class="keyword">;<br />
&nbsp; ...<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
It's a little bit dirty, but it works.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="107535""></a>
  <div class="note">
   <strong class="user">Voitcus at wp dot pl</strong>
   <a href="#107535" class="date">16-Feb-2012 06:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You don't need to serialize the class default values, only those which have changed. It might be important for large objects. Note the example below, for simplicity, always serializes arrays and objects.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">MyBaseClass </span><span class="keyword">{<br />
&nbsp; public </span><span class="default">$name</span><span class="keyword">=</span><span class="string">'object'</span><span class="keyword">; </span><span class="comment">// these are default class values<br />
&nbsp; </span><span class="keyword">public </span><span class="default">$test</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">;<br />
&nbsp; public </span><span class="default">$test2</span><span class="keyword">; </span><span class="comment">// equals to NULL in fact<br />
<br />
&nbsp; </span><span class="keyword">public function </span><span class="default">__construct</span><span class="keyword">(){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">test2</span><span class="keyword">=</span><span class="string">'some text'</span><span class="keyword">;&nbsp; </span><span class="comment">// this is not a default value, although called in the constructor<br />
&nbsp; </span><span class="keyword">}<br />
<br />
&nbsp; public function </span><span class="default">__sleep</span><span class="keyword">(){<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// default class values:<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$defaults</span><span class="keyword">=</span><span class="default">get_class_vars</span><span class="keyword">(</span><span class="default">get_class</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">)); </span><span class="comment">// not __CLASS__ or self::, if you'd like to use in descendant classes<br />
&nbsp;&nbsp;&nbsp; // values of $this object:<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$present</span><span class="keyword">=</span><span class="default">get_object_vars</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$result</span><span class="keyword">=array(); </span><span class="comment">// output array<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">foreach(</span><span class="default">$present </span><span class="keyword">as </span><span class="default">$key</span><span class="keyword">=&gt;</span><span class="default">$value</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp;&nbsp; if(!</span><span class="default">is_resource</span><span class="keyword">(</span><span class="default">$defaults</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">]) &amp;&amp; ( </span><span class="comment">// don't store resources<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">is_object</span><span class="keyword">(</span><span class="default">$defaults</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">]) ||&nbsp; &nbsp; </span><span class="comment">// always store objects<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$defaults</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">])&nbsp; ||&nbsp; &nbsp; </span><span class="comment">// and arrays<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$defaults</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">]!==</span><span class="default">$value</span><span class="keyword">) </span><span class="comment">// and of course all that is not the default value<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">) </span><span class="comment">// tip: try is_scalar as well<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$result</span><span class="keyword">[]=</span><span class="default">$key</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; return </span><span class="default">$result</span><span class="keyword">;<br />
&nbsp; }<br />
}<br />
<br />
</span><span class="default">$obj1</span><span class="keyword">=new </span><span class="default">MyBaseClass</span><span class="keyword">();<br />
echo (</span><span class="default">$s1</span><span class="keyword">=</span><span class="default">serialize</span><span class="keyword">(</span><span class="default">$obj1</span><span class="keyword">)).</span><span class="string">"&lt;br&gt;"</span><span class="keyword">; </span><span class="comment">// only test2 is stored, as it was changed in the constructor<br />
<br />
</span><span class="default">$obj2</span><span class="keyword">=new </span><span class="default">MyBaseClass</span><span class="keyword">();<br />
</span><span class="default">$obj2</span><span class="keyword">-&gt;</span><span class="default">name</span><span class="keyword">=</span><span class="string">'object 2'</span><span class="keyword">; </span><span class="comment">// change default value here<br />
</span><span class="keyword">echo (</span><span class="default">$s2</span><span class="keyword">=</span><span class="default">serialize</span><span class="keyword">(</span><span class="default">$obj2</span><span class="keyword">)).</span><span class="string">"&lt;br&gt;"</span><span class="keyword">; </span><span class="comment">// stored name and test2<br />
<br />
</span><span class="default">$obj3</span><span class="keyword">=new </span><span class="default">MyBaseClass</span><span class="keyword">();<br />
</span><span class="default">$obj3</span><span class="keyword">-&gt;</span><span class="default">test2</span><span class="keyword">=</span><span class="default">NULL</span><span class="keyword">; </span><span class="comment">// switch back to default value<br />
</span><span class="keyword">echo (</span><span class="default">$s3</span><span class="keyword">=</span><span class="default">serialize</span><span class="keyword">(</span><span class="default">$obj3</span><span class="keyword">)).</span><span class="string">"&lt;br&gt;"</span><span class="keyword">; </span><span class="comment">// nothing is stored but the class name<br />
<br />
// let us check if we can retrieve the objects<br />
</span><span class="keyword">unset(</span><span class="default">$obj1</span><span class="keyword">, </span><span class="default">$obj2</span><span class="keyword">, </span><span class="default">$obj3</span><span class="keyword">);<br />
</span><span class="default">$obj1</span><span class="keyword">=</span><span class="default">unserialize</span><span class="keyword">(</span><span class="default">$s1</span><span class="keyword">);<br />
</span><span class="default">$obj2</span><span class="keyword">=</span><span class="default">unserialize</span><span class="keyword">(</span><span class="default">$s2</span><span class="keyword">);<br />
</span><span class="default">$obj3</span><span class="keyword">=</span><span class="default">unserialize</span><span class="keyword">(</span><span class="default">$s3</span><span class="keyword">);<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$obj1</span><span class="keyword">);<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$obj2</span><span class="keyword">);<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$obj3</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="107509""></a>
  <div class="note">
   <strong class="user">daan dot broekhof at gmail dot com</strong>
   <a href="#107509" class="date">14-Feb-2012 07:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Ever wondered why you can't throw exceptions from __toString()? Yeah me too. <br />
<br />
Well now you can! This trick allows you to throw any type of exception from within a __toString(), with a full &amp; correct backtrace.<br />
<br />
How does it work? Well PHP __toString() handling is not as strict in every case: throwing an Exception from __toString() triggers a fatal E_ERROR, but returning a non-string value from a __toString() triggers a non-fatal E_RECOVERABLE_ERROR. <br />
Add a little bookkeeping, and can circumvented this PHP deficiency!<br />
(tested to work PHP 5.3+)<br />
<br />
<span class="default">&lt;?php<br />
<br />
set_error_handler</span><span class="keyword">(array(</span><span class="string">'My_ToStringFixer'</span><span class="keyword">, </span><span class="string">'errorHandler'</span><span class="keyword">));<br />
</span><span class="default">error_reporting</span><span class="keyword">(</span><span class="default">E_ALL </span><span class="keyword">| </span><span class="default">E_STRICT</span><span class="keyword">);<br />
<br />
class </span><span class="default">My_ToStringFixer<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; protected static </span><span class="default">$_toStringException</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; public static function </span><span class="default">errorHandler</span><span class="keyword">(</span><span class="default">$errorNumber</span><span class="keyword">, </span><span class="default">$errorMessage</span><span class="keyword">, </span><span class="default">$errorFile</span><span class="keyword">, </span><span class="default">$errorLine</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (isset(</span><span class="default">self</span><span class="keyword">::</span><span class="default">$_toStringException</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$exception </span><span class="keyword">= </span><span class="default">self</span><span class="keyword">::</span><span class="default">$_toStringException</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Always unset '_toStringException', we don't want a straggler to be found later if something came between the setting and the error<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">$_toStringException </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'~^Method .*::__toString\(\) must return a string value$~'</span><span class="keyword">, </span><span class="default">$errorMessage</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; throw </span><span class="default">$exception</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public static function </span><span class="default">throwToStringException</span><span class="keyword">(</span><span class="default">$exception</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// Should not occur with prescribed usage, but in case of recursion: clean out exception, return a valid string, and weep<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (isset(</span><span class="default">self</span><span class="keyword">::</span><span class="default">$_toStringException</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">$_toStringException </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">self</span><span class="keyword">::</span><span class="default">$_toStringException </span><span class="keyword">= </span><span class="default">$exception</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">null</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
class </span><span class="default">My_Class<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">doComplexStuff</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="string">'Oh noes!'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__toString</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; try<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// do your complex thing which might trigger an exception<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">doComplexStuff</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; catch (</span><span class="default">Exception $e</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// The 'return' is required to trigger the trick<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">My_ToStringFixer</span><span class="keyword">::</span><span class="default">throwToStringException</span><span class="keyword">(</span><span class="default">$e</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">$x </span><span class="keyword">= new </span><span class="default">My_Class</span><span class="keyword">();<br />
<br />
try<br />
{<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">$x</span><span class="keyword">;<br />
}<br />
catch (</span><span class="default">Exception $e</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">'Caught Exception! : '</span><span class="keyword">. </span><span class="default">$e</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="107031""></a>
  <div class="note">
   <strong class="user">osbertv at yahoo dot com</strong>
   <a href="#107031" class="date">30-Dec-2011 06:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Invoking a class inside a class results in an error.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">A<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__invoke</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Invoking A() Class"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
class </span><span class="default">B <br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$a</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__construct</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">a </span><span class="keyword">= new </span><span class="default">A</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__invoke</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Invoking B() Class"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">$a </span><span class="keyword">= new </span><span class="default">A</span><span class="keyword">();<br />
</span><span class="default">$b </span><span class="keyword">= new </span><span class="default">B</span><span class="keyword">();<br />
</span><span class="default">$a</span><span class="keyword">();<br />
</span><span class="default">$b</span><span class="keyword">();<br />
</span><span class="default">$b</span><span class="keyword">-&gt;</span><span class="default">a</span><span class="keyword">();<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
returns<br />
Invoking B() Class<br />
PHP Fatal error:&nbsp; Call to undefined method B::a()</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="105936""></a>
  <div class="note">
   <strong class="user">hyponiq at gmail dot com</strong>
   <a href="#105936" class="date">27-Sep-2011 03:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I think it's fair to note the undocumented fact that the __invoke magic method can take any number of arguments (or none).<br />
<br />
Example:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">InvokeNoParams </span><span class="keyword">{<br />
</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;function __invoke</span><span class="keyword">()<br />
</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword">{<br />
</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print __METHOD__ </span><span class="keyword">. </span><span class="default">PHP_EOL</span><span class="keyword">;<br />
</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$i </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;<br />
</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach </span><span class="keyword">(</span><span class="default">func_get_args</span><span class="keyword">() as </span><span class="default">$arg</span><span class="keyword">) {<br />
</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print </span><span class="string">"The value of \$param</span><span class="keyword">{</span><span class="default">$i</span><span class="keyword">}</span><span class="string"> is: " </span><span class="keyword">. </span><span class="default">$arg </span><span class="keyword">. </span><span class="default">PHP_EOL</span><span class="keyword">;<br />
</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword">++</span><span class="default">$i</span><span class="keyword">;<br />
</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword">}<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; print </span><span class="default">PHP_EOL</span><span class="keyword">;<br />
</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword">}<br />
}<br />
</span><span class="default">&nbsp;<br />
</span><span class="keyword">class </span><span class="default">InvokeSingleParam </span><span class="keyword">{<br />
</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;function __invoke</span><span class="keyword">(</span><span class="default">$param1</span><span class="keyword">)<br />
</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword">{<br />
</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print __METHOD__ </span><span class="keyword">. </span><span class="default">PHP_EOL</span><span class="keyword">;<br />
</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print </span><span class="string">"Value of \$param1 is: " </span><span class="keyword">. </span><span class="default">$param1 </span><span class="keyword">. </span><span class="default">PHP_EOL </span><span class="keyword">. </span><span class="default">PHP_EOL</span><span class="keyword">;<br />
</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword">}<br />
}<br />
</span><span class="default">&nbsp;<br />
</span><span class="keyword">class </span><span class="default">InvokeMultiParams </span><span class="keyword">{<br />
</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;function __invoke</span><span class="keyword">(</span><span class="default">$param1</span><span class="keyword">, </span><span class="default">$param2</span><span class="keyword">, </span><span class="default">$param3</span><span class="keyword">) {<br />
</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print __METHOD__ </span><span class="keyword">. </span><span class="default">PHP_EOL</span><span class="keyword">;<br />
</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print </span><span class="string">"Value of \$param1 is: " </span><span class="keyword">. </span><span class="default">$param1 </span><span class="keyword">. </span><span class="default">PHP_EOL</span><span class="keyword">;<br />
</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print </span><span class="string">"Value of \$param2 is: " </span><span class="keyword">. </span><span class="default">$param2 </span><span class="keyword">. </span><span class="default">PHP_EOL</span><span class="keyword">;<br />
</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print </span><span class="string">"Value of \$param3 is: " </span><span class="keyword">. </span><span class="default">$param3 </span><span class="keyword">. </span><span class="default">PHP_EOL </span><span class="keyword">. </span><span class="default">PHP_EOL</span><span class="keyword">;<br />
</span><span class="default">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword">}<br />
}<br />
</span><span class="default">&nbsp;<br />
$no </span><span class="keyword">= new </span><span class="default">InvokeNoParams</span><span class="keyword">;<br />
</span><span class="default">$single </span><span class="keyword">= new </span><span class="default">InvokeSingleParam</span><span class="keyword">;<br />
</span><span class="default">$multi </span><span class="keyword">= new </span><span class="default">InvokeMultiParams</span><span class="keyword">;<br />
</span><span class="default">&nbsp;<br />
$no</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">);<br />
</span><span class="default">$single</span><span class="keyword">(</span><span class="string">'one param'</span><span class="keyword">);<br />
</span><span class="default">$multi</span><span class="keyword">(</span><span class="string">'param 1'</span><span class="keyword">, </span><span class="string">'param 2'</span><span class="keyword">, </span><span class="string">'param 3'</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
This outputs:<br />
InvokeNoParams::__invoke<br />
The value of $param1 is: 1<br />
The value of $param2 is: 2<br />
The value of $param3 is: 3<br />
<br />
InvokeSingleParam::__invoke<br />
Value of $param1 is: one param<br />
<br />
InvokeMultiParams::__invoke<br />
Value of $param1 is: param 1<br />
Value of $param2 is: param 2<br />
Value of $param3 is: param 3</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="104138""></a>
  <div class="note">
   <strong class="user">Wesley</strong>
   <a href="#104138" class="date">25-May-2011 09:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Warning __toString can be triggerd more then one time
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">if(</span><span class="default">strstr</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$obj</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">1024</span><span class="keyword">), </span><span class="string">'somestuff'</span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">$obj</span><span class="keyword">;
<br />
return </span><span class="string">'missing somestuff at the start, create container!'</span><span class="keyword">;
<br />

<br />
</span><span class="default">substr</span><span class="keyword">() </span><span class="default">will trigger a __toString aswell </span><span class="keyword">as echo </span><span class="default">$obj</span><span class="keyword">;
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
wich cause a performance issue since it will gather all data twice.
<br />

<br />
what i used as a hotfix:
<br />

<br />
<span class="default">&lt;?php
<br />
__toString</span><span class="keyword">(){
<br />
&nbsp; if(</span><span class="default">null </span><span class="keyword">=== </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">sToString</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">sToString </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_show</span><span class="keyword">();
<br />
&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">sToString</span><span class="keyword">;
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99058""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#99058" class="date">25-Jul-2010 04:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Concerning __set() with protected/private/overloaded properties, the behavior might not be so intuitive without knowing some underlying rules.&nbsp; Consider this test object for the following examples...<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">A </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; protected </span><span class="default">$test_int </span><span class="keyword">= </span><span class="default">2</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; protected </span><span class="default">$test_array </span><span class="keyword">= array(</span><span class="string">'key' </span><span class="keyword">=&gt; </span><span class="string">'test'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; protected </span><span class="default">$test_obj</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__construct</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">test_obj </span><span class="keyword">= new </span><span class="default">stdClass</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__get</span><span class="keyword">(</span><span class="default">$prop</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">$prop</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__set</span><span class="keyword">(</span><span class="default">$prop</span><span class="keyword">, </span><span class="default">$val</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">$prop </span><span class="keyword">= </span><span class="default">$val</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
</span><span class="default">$a </span><span class="keyword">= new </span><span class="default">A</span><span class="keyword">();<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Combined Operators (.=, +=, *=, etc): you must also define a companion __get() method to grant write -and- read access to the property.&nbsp; Remember, "$x += $y" is shorthand for "$x = $x + $y".&nbsp; In other words, "__set($x, (__get($x) + $y))".<br />
<br />
Properties that are Arrays: attempting to set array values like "$a-&gt;test_array[] = 'asdf';" from outside this object will result in an "Indirect modification of overloaded property" notice and the operation completely ignored.&nbsp; You can't use '[]' for array value assignment in this context (with the exception only if you made __get() return by reference, in which case, it would work fine and bypass the __set() method altogether).&nbsp; You can work around this doing something like unioning the array instead:<br />
<br />
<span class="default">&lt;?php<br />
<br />
$a</span><span class="keyword">-&gt;</span><span class="default">test_array</span><span class="keyword">[] = </span><span class="string">'asdf'</span><span class="keyword">; </span><span class="comment">// notice given and ignored unless __get() was declared to return by reference<br />
</span><span class="default">$a</span><span class="keyword">-&gt;</span><span class="default">test_array </span><span class="keyword">+= array(</span><span class="default">1 </span><span class="keyword">=&gt; </span><span class="string">'asdf'</span><span class="keyword">); </span><span class="comment">// to add a key/value<br />
</span><span class="default">$a</span><span class="keyword">-&gt;</span><span class="default">test_array </span><span class="keyword">= array(</span><span class="string">"key" </span><span class="keyword">=&gt; </span><span class="string">'asdf'</span><span class="keyword">) + </span><span class="default">$a</span><span class="keyword">-&gt;</span><span class="default">test_array</span><span class="keyword">; </span><span class="comment">// to overwrite a&nbsp; key/value.<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Properties that are Objects: as long as you have that __get() method, you can freely access and alter that sub object's own properties, bypassing __set() entirely.&nbsp; Remember, objects are assigned and passed by reference naturally. <br />
<br />
<span class="default">&lt;?php<br />
<br />
$a</span><span class="keyword">-&gt;</span><span class="default">test_obj</span><span class="keyword">-&gt;</span><span class="default">prop </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">; </span><span class="comment">// fine if $a did not have a set method declared.<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
All above tested in 5.3.2.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="98963""></a>
  <div class="note">
   <strong class="user">tom</strong>
   <a href="#98963" class="date">19-Jul-2010 12:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note a common pitfall when using __wakeup.
<br />

<br />
If you unserialize a datastructure, you may not rely on the parent object to have been fully unserialized by the time __wakeup is called. Example
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">class </span><span class="default">A </span><span class="keyword">{
<br />
&nbsp;public </span><span class="default">$b</span><span class="keyword">;
<br />
&nbsp;public </span><span class="default">$name</span><span class="keyword">;
<br />
}
<br />

<br />
class </span><span class="default">B </span><span class="keyword">extends </span><span class="default">A </span><span class="keyword">{
<br />
&nbsp;public </span><span class="default">$parent</span><span class="keyword">;
<br />
&nbsp;public function </span><span class="default">__wakeup</span><span class="keyword">() {
<br />
&nbsp; </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$parent</span><span class="keyword">-&gt;</span><span class="default">name</span><span class="keyword">);
<br />
&nbsp;}
<br />
}
<br />

<br />
</span><span class="default">$a </span><span class="keyword">= new </span><span class="default">A</span><span class="keyword">();
<br />
</span><span class="default">$a</span><span class="keyword">-&gt;</span><span class="default">name </span><span class="keyword">= </span><span class="string">"foo"</span><span class="keyword">;
<br />
</span><span class="default">$a</span><span class="keyword">-&gt;</span><span class="default">b </span><span class="keyword">= new </span><span class="default">B</span><span class="keyword">();
<br />
</span><span class="default">$a</span><span class="keyword">-&gt;</span><span class="default">b</span><span class="keyword">-&gt;</span><span class="default">parent </span><span class="keyword">= </span><span class="default">$a</span><span class="keyword">;
<br />
</span><span class="default">$s </span><span class="keyword">= </span><span class="default">serialize</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">);
<br />
</span><span class="default">$a </span><span class="keyword">= </span><span class="default">unserialize</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">);
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Expected output: "foo".
<br />
Actual output: NULL.
<br />

<br />
Reason: $b is unserialized before $name. By the time B::__wakeup is called, $a-&gt;name does not yet have a value.
<br />

<br />
So be aware that the order in which your class variables are defined is important! You need to manually order them by dependencies - or write a __sleep function and order them by depencies there. (Currently I can't tell which option I hate more)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="98691""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#98691" class="date">01-Jul-2010 06:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
C++-style operator overloading finally makes an appearance with the introduction to __invoke().&nbsp; Unfortunately, with just '()'.&nbsp; In that sense, it is no more useful than having a default class method (probably quite useful actually) and not having to type out an entire method name.&nbsp; Complimenting wbcarts at juno dot com's point class below, the following allows calculating distance between one or more graph points...<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">class </span><span class="default">point </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$x</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$y</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x </span><span class="keyword">= (int) </span><span class="default">$x</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y </span><span class="keyword">= (int) </span><span class="default">$y</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__invoke</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$args </span><span class="keyword">= </span><span class="default">func_get_args</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$total_distance </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$current_loc </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$args </span><span class="keyword">as </span><span class="default">$arg</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_object</span><span class="keyword">(</span><span class="default">$arg</span><span class="keyword">) and (</span><span class="default">get_class</span><span class="keyword">(</span><span class="default">$arg</span><span class="keyword">) === </span><span class="default">get_class</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">))) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$total_distance </span><span class="keyword">+= </span><span class="default">sqrt</span><span class="keyword">(</span><span class="default">pow</span><span class="keyword">(</span><span class="default">$arg</span><span class="keyword">-&gt;</span><span class="default">x </span><span class="keyword">- </span><span class="default">$current_loc</span><span class="keyword">-&gt;</span><span class="default">x</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">) + </span><span class="default">pow</span><span class="keyword">((int) </span><span class="default">$arg</span><span class="keyword">-&gt;</span><span class="default">y </span><span class="keyword">- </span><span class="default">$current_loc</span><span class="keyword">-&gt;</span><span class="default">y</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$current_loc </span><span class="keyword">= </span><span class="default">$arg</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">trigger_error</span><span class="keyword">(</span><span class="string">"Arguments must be objects of this class."</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$total_distance</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
</span><span class="default">$p1 </span><span class="keyword">= new </span><span class="default">point</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">);<br />
</span><span class="default">$p2 </span><span class="keyword">= new </span><span class="default">point</span><span class="keyword">(</span><span class="default">23</span><span class="keyword">,-</span><span class="default">6</span><span class="keyword">);<br />
</span><span class="default">$p3 </span><span class="keyword">= new </span><span class="default">point</span><span class="keyword">(</span><span class="default">15</span><span class="keyword">,</span><span class="default">20</span><span class="keyword">);<br />
echo </span><span class="default">$p1</span><span class="keyword">(</span><span class="default">$p2</span><span class="keyword">,</span><span class="default">$p3</span><span class="keyword">,</span><span class="default">$p1</span><span class="keyword">); </span><span class="comment">// round trip 73.89<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Functionally, __invoke() can also be used to mimic the use of variable functions.&nbsp; Sadly, attempting any calling of __invoke() on a static level will produce a fatal error.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92466""></a>
  <div class="note">
   <strong class="user">moechofe</strong>
   <a href="#92466" class="date">25-Jul-2009 11:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
__invoke() cannot be used to create fluente interface like in the "D language"<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">CallableClass<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$next</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__invoke</span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">;<br />
&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">$obj </span><span class="keyword">= new </span><span class="default">CallableClass</span><span class="keyword">;<br />
</span><span class="default">$obj</span><span class="keyword">-&gt;</span><span class="default">next </span><span class="keyword">= new </span><span class="default">CallableClass</span><span class="keyword">;<br />
</span><span class="default">var_dump</span><span class="keyword">( </span><span class="default">$obj</span><span class="keyword">(</span><span class="default">5</span><span class="keyword">) ); </span><span class="comment">// OK!<br />
</span><span class="default">var_dump</span><span class="keyword">( </span><span class="default">$obj</span><span class="keyword">(</span><span class="default">5</span><span class="keyword">)(</span><span class="default">6</span><span class="keyword">) ); </span><span class="comment">// Parse error<br />
</span><span class="default">var_dump</span><span class="keyword">( </span><span class="default">$obj</span><span class="keyword">-&gt;</span><span class="default">next</span><span class="keyword">(</span><span class="default">7</span><span class="keyword">) ); </span><span class="comment">// Fatal error: Call to undefined method CallableClass::next()<br />
</span><span class="default">var_dump</span><span class="keyword">( {</span><span class="default">$obj</span><span class="keyword">-&gt;</span><span class="default">next</span><span class="keyword">}(</span><span class="default">7</span><span class="keyword">) ); </span><span class="comment">// Parse error<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91104""></a>
  <div class="note">
   <strong class="user">zach at bygeekz dot com</strong>
   <a href="#91104" class="date">25-May-2009 09:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Try this one on. <br />
<br />
<span class="default">&lt;?php<br />
$ret </span><span class="keyword">= new </span><span class="default">Test</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br />
</span><span class="default">var_dump</span><span class="keyword">((bool)(string)</span><span class="default">$ret</span><span class="keyword">);<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$ret</span><span class="keyword">);<br />
</span><span class="default">$ret</span><span class="keyword">=</span><span class="default">null</span><span class="keyword">;<br />
</span><span class="default">$ret </span><span class="keyword">= new </span><span class="default">Test</span><span class="keyword">();<br />
</span><span class="default">var_dump</span><span class="keyword">((bool)(string)</span><span class="default">$ret</span><span class="keyword">);<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$ret</span><span class="keyword">);<br />
<br />
class </span><span class="default">Test </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; protected </span><span class="default">$state</span><span class="keyword">=</span><span class="default">null</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$state</span><span class="keyword">=</span><span class="default">null</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">state </span><span class="keyword">= </span><span class="default">$state</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__toString</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">state</span><span class="keyword">) { return </span><span class="string">"1"</span><span class="keyword">; } else { return </span><span class="string">"0"</span><span class="keyword">; }<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
You could for instance do..<br />
<br />
if(!(bool)(string)$ret) { do_something!; }<br />
<br />
Alternatively, just make state public, and check it.<br />
<br />
if(!$ret-&gt;state) {}. <br />
<br />
There is no automatic way I have found aside from some internal state check to verify a class. It will always return an object. The only way around that is to force it out to string either where I did, or $ret = (string) new Test(); then test the bool of your output.. <br />
<br />
if (!$ret) { echo "noooo!"; } <br />
<br />
But now you have no calling methods, so I hope you passed some data in to get a usable string out.<br />
<br />
Of course, if your class isn't named test, you can add a method..<br />
<br />
public function test() {<br />
&nbsp;&nbsp; &nbsp; return $this-&gt;state;<br />
}<br />
<br />
Logically that will work regardless of the _toString(), but I had hoped to post this to help others see that there are a multitude of ways to check the validity of a class once it is loaded. In __construct you can add any number of checks and set your state appropriately.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="90194""></a>
  <div class="note">
   <strong class="user">rudie-de-hotblocks at osu1 dot php dot net</strong>
   <a href="#90194" class="date">09-Apr-2009 03:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note also that the constructor is executed also, and before __set_state(), making this magic function less magic, imho, (except for the ability to assign private members).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="88045""></a>
  <div class="note">
   <strong class="user">muratyaman at gmail dot com</strong>
   <a href="#88045" class="date">07-Jan-2009 04:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Regarding __toString:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">my_tag_A</span><span class="keyword">{<br />
<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$id</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$href</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$target</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$class</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$label</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$href</span><span class="keyword">, </span><span class="default">$label</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">href </span><span class="keyword">= </span><span class="default">$href</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">label </span><span class="keyword">= </span><span class="default">$label</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__toString</span><span class="keyword">(){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="string">'&lt;a '</span><span class="keyword">.</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">nz_arr</span><span class="keyword">(array(</span><span class="string">'id'</span><span class="keyword">, </span><span class="string">'href'</span><span class="keyword">, </span><span class="string">'target'</span><span class="keyword">, </span><span class="string">'class'</span><span class="keyword">)). </span><span class="string">' &gt;' </span><span class="keyword">. </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">label </span><span class="keyword">. </span><span class="string">'&lt;/a&gt;'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">nz_arr</span><span class="keyword">(</span><span class="default">$attrib_arr</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$s </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$attrib_arr </span><span class="keyword">as </span><span class="default">$attrib</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$s </span><span class="keyword">.= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">nz</span><span class="keyword">(</span><span class="default">$attrib</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$s</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; * Print the tag attribute if it is not blank, such as id="$this-&gt;id"<br />
&nbsp;&nbsp; &nbsp; * @param string $attrib<br />
&nbsp;&nbsp; &nbsp; * @return string<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">nz</span><span class="keyword">(</span><span class="default">$attrib</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$s </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">$attrib </span><span class="keyword">!= </span><span class="string">''</span><span class="keyword">) </span><span class="default">$s </span><span class="keyword">= </span><span class="default">$attrib </span><span class="keyword">.</span><span class="string">' = "' </span><span class="keyword">. </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">$attrib </span><span class="keyword">. </span><span class="string">'"'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$s</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//This causes RECURSION because of parsing between double quotes. This is a very UNEXPECTED behaviour!<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">nz_</span><span class="keyword">(</span><span class="default">$attrib</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$s </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">$attrib </span><span class="keyword">!= </span><span class="string">''</span><span class="keyword">) </span><span class="default">$s </span><span class="keyword">= </span><span class="string">"</span><span class="default">$attrib</span><span class="string"> = \"</span><span class="default">$this</span><span class="string">-&gt;</span><span class="default">$attrib</span><span class="string">\""</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$s</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
}</span><span class="comment">//end&nbsp; class<br />
<br />
//usage<br />
</span><span class="default">$a </span><span class="keyword">= new </span><span class="default">my_tag_A</span><span class="keyword">(</span><span class="string">'abc.php'</span><span class="keyword">, </span><span class="string">'ABC'</span><span class="keyword">); </span><span class="default">$a</span><span class="keyword">-&gt;</span><span class="default">target </span><span class="keyword">= </span><span class="string">'_blank'</span><span class="keyword">;<br />
echo </span><span class="default">$a</span><span class="keyword">;<br />
</span><span class="comment">//prints:<br />
//&nbsp; &nbsp; &lt;a href="abc.php" target="_blank" &gt;ABC&lt;/a&gt;<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="87404""></a>
  <div class="note">
   <strong class="user">jsnell at e-normous dot com</strong>
   <a href="#87404" class="date">03-Dec-2008 11:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Be very careful to define __set_state() in classes which inherit from a parent using it, as the static __set_state() call will be called for any children.&nbsp; If you are not careful, you will end up with an object of the wrong type.&nbsp; Here is an example:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">class </span><span class="default">A
<br />
</span><span class="keyword">{
<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$var1</span><span class="keyword">; 
<br />

<br />
&nbsp;&nbsp;&nbsp; public static function </span><span class="default">__set_state</span><span class="keyword">(</span><span class="default">$an_array</span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$obj </span><span class="keyword">= new </span><span class="default">A</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$obj</span><span class="keyword">-&gt;</span><span class="default">var1 </span><span class="keyword">= </span><span class="default">$an_array</span><span class="keyword">[</span><span class="string">'var1'</span><span class="keyword">];&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$obj</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
}
<br />

<br />
class </span><span class="default">B </span><span class="keyword">extends </span><span class="default">A </span><span class="keyword">{
<br />
}
<br />

<br />
</span><span class="default">$b </span><span class="keyword">= new </span><span class="default">B</span><span class="keyword">;
<br />
</span><span class="default">$b</span><span class="keyword">-&gt;</span><span class="default">var1 </span><span class="keyword">= </span><span class="default">5</span><span class="keyword">;
<br />

<br />
eval(</span><span class="string">'$new_b = ' </span><span class="keyword">. </span><span class="default">var_export</span><span class="keyword">(</span><span class="default">$b</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">) . </span><span class="string">';'</span><span class="keyword">); 
<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$new_b</span><span class="keyword">);
<br />
</span><span class="comment">/*
<br />
object(A)#2 (1) {
<br />
&nbsp; ["var1"]=&gt;
<br />
&nbsp; int(5)
<br />
}
<br />
*/
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86622""></a>
  <div class="note">
   <strong class="user">patricknegri at gmail dot com</strong>
   <a href="#86622" class="date">27-Oct-2008 12:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Imports Pattern - Extend Classes in Real Time:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">class </span><span class="default">BaseClass
<br />
</span><span class="keyword">{
<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$__imported</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; var </span><span class="default">$__imported_functions</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__construct</span><span class="keyword">()
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$__imported </span><span class="keyword">= Array();
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$__imported_functions </span><span class="keyword">= Array();
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">Imports</span><span class="keyword">(</span><span class="default">$object</span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new_imports </span><span class="keyword">= new </span><span class="default">$object</span><span class="keyword">();
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$imports_name </span><span class="keyword">= </span><span class="default">get_class</span><span class="keyword">(</span><span class="default">$new_imports</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">array_push</span><span class="keyword">( </span><span class="default">$__imported</span><span class="keyword">, Array(</span><span class="default">$imports_name</span><span class="keyword">,</span><span class="default">$new_imports</span><span class="keyword">) );
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$imports_function </span><span class="keyword">= </span><span class="default">get_class_methods</span><span class="keyword">(</span><span class="default">$new_imports</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$imports_function </span><span class="keyword">as </span><span class="default">$i</span><span class="keyword">=&gt;</span><span class="default">$function_name</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">__imported_functions</span><span class="keyword">[</span><span class="default">$function_name</span><span class="keyword">] = &amp;</span><span class="default">$new_imports</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }&nbsp; &nbsp; &nbsp; &nbsp; 
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__call</span><span class="keyword">(</span><span class="default">$m</span><span class="keyword">, </span><span class="default">$a</span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; {&nbsp; &nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">array_key_exists</span><span class="keyword">(</span><span class="default">$m</span><span class="keyword">,</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">__imported_functions</span><span class="keyword">))
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">call_user_func_array</span><span class="keyword">(Array(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">__imported_functions</span><span class="keyword">[</span><span class="default">$m</span><span class="keyword">],</span><span class="default">$m</span><span class="keyword">),</span><span class="default">$a</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; throw new </span><span class="default">ErrorException </span><span class="keyword">(</span><span class="string">'Call to Undefined Method/Class Function'</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">E_ERROR</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />
}
<br />

<br />
class </span><span class="default">ExternalFunc
<br />
</span><span class="keyword">{
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">TestB</span><span class="keyword">()
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"External Imported!"</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
}
<br />

<br />
class </span><span class="default">B </span><span class="keyword">extends </span><span class="default">BaseClass
<br />
</span><span class="keyword">{
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__construct</span><span class="keyword">()
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">Imports</span><span class="keyword">(</span><span class="string">"ExternalFunc"</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">Msg</span><span class="keyword">()
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Hello world&lt;br /&gt;"</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
}
<br />

<br />
</span><span class="default">$b </span><span class="keyword">= new </span><span class="default">B</span><span class="keyword">();
<br />
</span><span class="default">$b</span><span class="keyword">-&gt;</span><span class="default">Msg</span><span class="keyword">();
<br />
</span><span class="comment">// or call $b-&gt;Imports("ExternalFunc");
<br />
</span><span class="default">$b</span><span class="keyword">-&gt;</span><span class="default">TestB</span><span class="keyword">();
<br />
</span><span class="comment">//$b-&gt;TestB(1,3,4);
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86111""></a>
  <div class="note">
   <strong class="user">jon at webignition dot net</strong>
   <a href="#86111" class="date">03-Oct-2008 04:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The __toString() method is extremely useful for converting class attribute names and values into common string representations of data (of which there are many choices). I mention this as previous references to __toString() refer only to debugging uses.<br />
<br />
I have previously used the __toString() method in the following ways:<br />
<br />
&nbsp;- representing a data-holding object as:<br />
&nbsp;&nbsp; - XML<br />
&nbsp;&nbsp; - raw POST data<br />
&nbsp;&nbsp; - a GET query string<br />
&nbsp;&nbsp; - header name:value pairs<br />
<br />
&nbsp;- representing a custom mail object as an actual email (headers then body, all correctly represented)<br />
<br />
When creating a class, consider what possible standard string representations are available and, of those, which would be the most relevant with respect to the purpose of the class.<br />
<br />
Being able to represent data-holding objects in standardised string forms makes it much easier for your internal representations of data to be shared in an interoperable way with other applications.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86096""></a>
  <div class="note">
   <strong class="user">wbcarts at juno dot com</strong>
   <a href="#86096" class="date">03-Oct-2008 01:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To be helpful, the __toString() method should return the class name and the state of all its properties inside square brackets.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">Point </span><span class="keyword">{<br />
&nbsp; protected </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">;<br />
<br />
&nbsp; public function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$xVal </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">, </span><span class="default">$yVal </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x </span><span class="keyword">= </span><span class="default">$xVal</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y </span><span class="keyword">= </span><span class="default">$yVal</span><span class="keyword">;<br />
&nbsp; }&nbsp; &nbsp; <br />
<br />
&nbsp; public function </span><span class="default">__toString</span><span class="keyword">() {&nbsp; &nbsp; &nbsp; </span><span class="comment">// the function we're interested in...<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">return </span><span class="string">"Point[x=</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">x</span><span class="string">, y=</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">y</span><span class="string">]"</span><span class="keyword">;<br />
&nbsp; }<br />
}<br />
<br />
</span><span class="default">$point1 </span><span class="keyword">= new </span><span class="default">Point</span><span class="keyword">(</span><span class="default">10</span><span class="keyword">, </span><span class="default">10</span><span class="keyword">);<br />
</span><span class="default">$point2 </span><span class="keyword">= new </span><span class="default">Point</span><span class="keyword">(</span><span class="default">50</span><span class="keyword">, </span><span class="default">50</span><span class="keyword">);<br />
echo </span><span class="default">$point1 </span><span class="keyword">. </span><span class="string">'&lt;br&gt;'</span><span class="keyword">;<br />
echo </span><span class="default">$point2 </span><span class="keyword">. </span><span class="string">'&lt;br&gt;&lt;br&gt;'</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
Point[x=10, y=10]<br />
Point[x=50, y=50]<br />
<br />
Classes that include objects, should call that objects __toString() method.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">Line </span><span class="keyword">{<br />
&nbsp; protected </span><span class="default">$start</span><span class="keyword">, </span><span class="default">$end</span><span class="keyword">;<br />
<br />
&nbsp; public function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">Point $p1</span><span class="keyword">, </span><span class="default">Point $p2</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">start </span><span class="keyword">= </span><span class="default">$p1</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">end </span><span class="keyword">= </span><span class="default">$p2</span><span class="keyword">;<br />
&nbsp; }<br />
<br />
&nbsp; public function </span><span class="default">__toString</span><span class="keyword">() {&nbsp; &nbsp; &nbsp; </span><span class="comment">// the function we're interested in...<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">return </span><span class="string">'Line[start=' </span><span class="keyword">. </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">start</span><span class="keyword">-&gt;</span><span class="default">__toString</span><span class="keyword">() .&nbsp; </span><span class="comment">// call __toString()<br />
&nbsp;&nbsp; &nbsp; </span><span class="string">', end=' </span><span class="keyword">. </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">end</span><span class="keyword">-&gt;</span><span class="default">__toString</span><span class="keyword">() . </span><span class="string">']'</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// call __toString()<br />
&nbsp; </span><span class="keyword">}<br />
}<br />
<br />
echo (new </span><span class="default">Line</span><span class="keyword">(</span><span class="default">$point1</span><span class="keyword">, </span><span class="default">$point2</span><span class="keyword">));<br />
</span><span class="default">?&gt;<br />
</span><br />
Line[start=Point[x=10, y=10], end=Point[x=50, y=50]]</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84960""></a>
  <div class="note">
   <strong class="user">rc @ nospam @ vorklift dot sea oh em</strong>
   <a href="#84960" class="date">07-Aug-2008 04:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A note: __wakeup occurs before saving the unserialization of an session object.<br />
<br />
Therefore, $_SESSION['var']::__wakeup() setting $_SESSION['var'] = new Class() will fail and $_SESSION['var'] will remain unchanged.<br />
<br />
This means that if you have a pseudo-temporary object that contains a class to auto revert to, you have to revert that session object in the initialization of the website rather than via a __wakeup() script.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83556""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#83556" class="date">01-Jun-2008 01:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Serializing objects is problematic with references. This is solved redefining the __sleep() magic method. This is also problematic when parent class has private variables since the parent object is not accessible nor its private variables from within the child object.<br />
<br />
I found a solution that seems working for classes that implements this __sleep() method, and for its subclasses. Without more work in subclasses. The inheritance system does the trick.<br />
<br />
Recursively __sleep() call parent' __sleep() and return the whole array of variables of the object instance to be serialized.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">foo </span><span class="keyword">{<br />
}<br />
<br />
class </span><span class="default">a </span><span class="keyword">{<br />
&nbsp; private </span><span class="default">$var1</span><span class="keyword">;<br />
<br />
&nbsp; function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">foo </span><span class="keyword">&amp;</span><span class="default">$obj </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">var1 </span><span class="keyword">= &amp;</span><span class="default">$obj</span><span class="keyword">;<br />
&nbsp; }<br />
<br />
&nbsp; </span><span class="comment">/** Return its variables array, if its parent exists and the __sleep method is accessible, call it and push the result into the array and return the whole thing. */<br />
&nbsp; </span><span class="keyword">public function </span><span class="default">__sleep</span><span class="keyword">() {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$a </span><span class="keyword">= </span><span class="default">array_keys</span><span class="keyword">(</span><span class="default">get_object_vars</span><span class="keyword">(&amp;</span><span class="default">$this</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">method_exists</span><span class="keyword">(</span><span class="default">parent</span><span class="keyword">, </span><span class="string">'__sleep'</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$p </span><span class="keyword">= </span><span class="default">parent</span><span class="keyword">::</span><span class="default">__sleep</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">array_push</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">, </span><span class="default">$p</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; };<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$a</span><span class="keyword">;<br />
&nbsp; }<br />
}<br />
<br />
class </span><span class="default">b </span><span class="keyword">extends </span><span class="default">a </span><span class="keyword">{<br />
&nbsp; function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">foo </span><span class="keyword">&amp;</span><span class="default">$obj </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">parent</span><span class="keyword">::</span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$obj</span><span class="keyword">);<br />
&nbsp; }<br />
}<br />
<br />
</span><span class="default">session_start</span><span class="keyword">();<br />
</span><span class="default">$myfoo </span><span class="keyword">= &amp;new </span><span class="default">foo</span><span class="keyword">();<br />
</span><span class="default">$myb </span><span class="keyword">= &amp;new </span><span class="default">b</span><span class="keyword">(</span><span class="default">$myfoo</span><span class="keyword">);<br />
</span><span class="default">$myb </span><span class="keyword">= </span><span class="default">unserialize</span><span class="keyword">(</span><span class="default">serialize</span><span class="keyword">(&amp;</span><span class="default">$myb</span><span class="keyword">));<br />
</span><span class="default">?&gt;<br />
</span><br />
This should work, I haven't tested deeper.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83110""></a>
  <div class="note">
   <strong class="user">yanleech at gmail dot com</strong>
   <a href="#83110" class="date">10-May-2008 03:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Maybe we can using unserialize() &amp; __wakeup() instead "new" when creating a new instance of class.<br />
<br />
Consider following codes:<br />
<br />
class foo<br />
{<br />
&nbsp;&nbsp;&nbsp; static public $WAKEUP_STR = 'O:3:"foo":0:{}';<br />
&nbsp;&nbsp;&nbsp; public function foo(){}<br />
&nbsp;&nbsp;&nbsp; public function bar(){}<br />
}<br />
<br />
$foo = unserialize(foo::$WAKEUP_STR);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82629""></a>
  <div class="note">
   <strong class="user">michal dot kocarek at seznam dot cz</strong>
   <a href="#82629" class="date">18-Apr-2008 11:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Remember that setters and getters (__set, __get) will work in your class as long as you NOT SET the property with given name.<br />
<br />
If you still want to have the public property definition in the class source code (phpDocumentor, editor code completition, or any other reason) when using these magic methods, simply unset() your public properties inside the constructor.<br />
__set/__get function will be called and code reader will see at first sight, which public properties are available.<br />
<br />
Example:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">user </span><span class="keyword">{<br />
&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp;&nbsp; * @var int Gets and sets the user ID<br />
&nbsp;&nbsp;&nbsp; */<br />
&nbsp;&nbsp; </span><span class="keyword">public </span><span class="default">$UserID</span><span class="keyword">;<br />
&nbsp;&nbsp; private </span><span class="default">$_userID</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; public function </span><span class="default">__construct</span><span class="keyword">() {<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="comment">// All the magic is in single line:<br />
&nbsp;&nbsp; &nbsp;&nbsp; // We unset public property, so our setters and getters<br />
&nbsp;&nbsp; &nbsp;&nbsp; // are used and phpDoc and editors with code completition are happy<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="keyword">unset(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">UserID</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; public function </span><span class="default">__set</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="comment">// assign value for key UserID to _userID property<br />
&nbsp;&nbsp; </span><span class="keyword">}<br />
<br />
&nbsp;&nbsp; public function </span><span class="default">__get</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="comment">// return value of _userID for UserID property<br />
&nbsp;&nbsp; </span><span class="keyword">}<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81492""></a>
  <div class="note">
   <strong class="user">dhuseby domain getback tld com</strong>
   <a href="#81492" class="date">01-Mar-2008 03:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The above hint for using array_keys((array)$obj) got me investigating how to get __sleep to really work with object hierarchies.<br />
<br />
With PHP 5.2.3, If you want to serialize an object that is part of an object hierarchy and you want to selectively serialize members (public, private, and protected) by manually specifying the array of members, there are a few simple rules for naming members that you must follow:<br />
<br />
1. public members should be named using just their member name, like so:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">Foo </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$bar</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__sleep</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return array(</span><span class="string">"bar"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
2. protected members should be named using "\0" . "*" . "\0" . member name, like so:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">Foo </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; protected </span><span class="default">$bar</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__sleep</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return array(</span><span class="string">"\0*\0bar"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
3. private members should be named using "\0" . class name . "\0" . member name, like so:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">Foo </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$bar</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__sleep</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return array(</span><span class="string">"\0Foo\0bar"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
So with this information let us serialize a class hierarchy correctly:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">class </span><span class="default">Base </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$foo </span><span class="keyword">= </span><span class="string">"foo_value"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; protected </span><span class="default">$bar </span><span class="keyword">= </span><span class="string">"bar_value"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__sleep</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return array(</span><span class="string">"\0Base\0foo"</span><span class="keyword">, </span><span class="string">"\0*\0bar"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
class </span><span class="default">Derived </span><span class="keyword">extends </span><span class="default">Base </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$baz </span><span class="keyword">= </span><span class="string">"baz_value"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$boo </span><span class="keyword">= </span><span class="string">"boo_value"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__sleep</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// we have to merge our members with our parent's<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">array_merge</span><span class="keyword">(array(</span><span class="string">"baz"</span><span class="keyword">, </span><span class="string">"\0Derived\0boo"</span><span class="keyword">), </span><span class="default">parent</span><span class="keyword">::</span><span class="default">__sleep</span><span class="keyword">());<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
class </span><span class="default">Leaf </span><span class="keyword">extends </span><span class="default">Derived </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$qux </span><span class="keyword">= </span><span class="string">"qux_value"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; protected </span><span class="default">$zaz </span><span class="keyword">= </span><span class="string">"zaz_value"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$blah </span><span class="keyword">= </span><span class="string">"blah_value"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__sleep</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// again, merge our members with our parent's<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">array_merge</span><span class="keyword">(array(</span><span class="string">"\0Leaf\0qux"</span><span class="keyword">, </span><span class="string">"\0*\0zaz"</span><span class="keyword">, </span><span class="string">"blah"</span><span class="keyword">), </span><span class="default">parent</span><span class="keyword">::</span><span class="default">__sleep</span><span class="keyword">());<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="comment">// test it<br />
</span><span class="default">$test </span><span class="keyword">= new </span><span class="default">Leaf</span><span class="keyword">();<br />
</span><span class="default">$s </span><span class="keyword">= </span><span class="default">serialize</span><span class="keyword">(</span><span class="default">$test</span><span class="keyword">);<br />
</span><span class="default">$test2 </span><span class="keyword">= </span><span class="default">unserialize</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">);<br />
echo </span><span class="default">$s</span><span class="keyword">;<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$test</span><span class="keyword">);<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$test2</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Now if you comment out all of the __sleep() functions and output the serialized string, you will see that the output doesn't change.&nbsp; The most important part of course is that with the proper __sleep() functions, we can unserialize the string and get a properly set up object.<br />
<br />
I hope this solves the mystery for everybody.&nbsp; __sleep() does work, if you use it correctly :-)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="79062""></a>
  <div class="note">
   <strong class="user">andrew dot minerd at sellingsource dot com</strong>
   <a href="#79062" class="date">08-Nov-2007 04:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Until __sleep is "fixed" (here's hoping), a function that will return ALL members of a given object -- public, protected, AND private:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">public function </span><span class="default">getPropertyNames</span><span class="keyword">(array </span><span class="default">$filter </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$rc </span><span class="keyword">= new </span><span class="default">ReflectionObject</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$names </span><span class="keyword">= array();<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; while (</span><span class="default">$rc </span><span class="keyword">instanceof </span><span class="default">ReflectionClass</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$rc</span><span class="keyword">-&gt;</span><span class="default">getProperties</span><span class="keyword">() as </span><span class="default">$prop</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">$filter </span><span class="keyword">|| !</span><span class="default">in_array</span><span class="keyword">(</span><span class="default">$prop</span><span class="keyword">-&gt;</span><span class="default">getName</span><span class="keyword">(), </span><span class="default">$filter</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$names</span><span class="keyword">[] = </span><span class="default">$prop</span><span class="keyword">-&gt;</span><span class="default">getName</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$rc </span><span class="keyword">= </span><span class="default">$rc</span><span class="keyword">-&gt;</span><span class="default">getParentClass</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$names</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76643""></a>
  <div class="note">
   <strong class="user">amir_abiri at ipcmedia dot com</strong>
   <a href="#76643" class="date">24-Jul-2007 01:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Another small thing that is important to note about __sleep() and privte member variables:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">A<br />
</span><span class="keyword">{<br />
&nbsp; private </span><span class="default">$a</span><span class="keyword">;<br />
&nbsp; <br />
&nbsp; public function </span><span class="default">__construct</span><span class="keyword">()<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">a </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;<br />
&nbsp; }<br />
}<br />
<br />
class </span><span class="default">B </span><span class="keyword">extends </span><span class="default">A<br />
</span><span class="keyword">{<br />
&nbsp; protected </span><span class="default">$b</span><span class="keyword">;<br />
&nbsp; <br />
&nbsp; public function </span><span class="default">__construct</span><span class="keyword">()<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">parent</span><span class="keyword">::</span><span class="default">__construct</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">b </span><span class="keyword">= </span><span class="default">2</span><span class="keyword">;<br />
&nbsp; }<br />
&nbsp; <br />
&nbsp; function </span><span class="default">__sleep</span><span class="keyword">()<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; return array(</span><span class="string">'a'</span><span class="keyword">, </span><span class="string">'b'</span><span class="keyword">);<br />
&nbsp; }<br />
}<br />
<br />
</span><span class="default">serialize</span><span class="keyword">(new </span><span class="default">B</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
result:<br />
Notice: serialize(): "a" returned as member variable from __sleep() but does not exist in ...<br />
<br />
To summerize: in a given class hierarchy in which parent classes contain private member variables, those variables are serialized when __sleep() is not defined. However, once __sleep() is defined, there is no way to make those private member variables serialized as well. From that point on, serialization is performed from the visibility scope of the subclass.<br />
<br />
It is particularly important to note this little quirk when designing base classes that their derivables may be serialized, or when subclassing an external library class.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75037""></a>
  <div class="note">
   <strong class="user">alejandro dot gama at gmail dot com</strong>
   <a href="#75037" class="date">09-May-2007 04:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Referering my previus note: there was an error in the code. But i find a better way:<br />
<br />
&lt;?<br />
session_start();<br />
<br />
class Classes{<br />
&nbsp; private $name;<br />
&nbsp; private $statics;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp; function __construct($name){<br />
&nbsp;&nbsp;&nbsp; $this-&gt;name=$name;<br />
&nbsp;&nbsp;&nbsp; $this-&gt;statics=array();<br />
&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp; function setStatic($k,$v){<br />
&nbsp;&nbsp;&nbsp; if(!is_resource($v))<br />
&nbsp;&nbsp; &nbsp;&nbsp; $this-&gt;statics[$k]=$v;<br />
&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp; function __wakeup(){<br />
&nbsp;&nbsp;&nbsp; foreach($this-&gt;statics as $k=&gt;$v)<br />
&nbsp;&nbsp; &nbsp;&nbsp; eval($this-&gt;name."::\$".$k."=\$this-&gt;statics['".$k."'];");<br />
&nbsp; }<br />
}<br />
<br />
function storeStaticAttributes(){<br />
&nbsp; $classes=get_declared_classes();<br />
&nbsp; foreach($classes as $name){<br />
&nbsp;&nbsp;&nbsp; $reflect=new ReflectionClass($name);<br />
<br />
&nbsp;&nbsp;&nbsp; if($reflect-&gt;isUserDefined()){<br />
&nbsp;&nbsp; &nbsp;&nbsp; $statics=$reflect-&gt;getStaticProperties();<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; if(empty($_SESSION["_classes"]))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $_SESSION["_classes"]=array();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp;&nbsp; if(empty($_SESSION["_classes"][$name]))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $_SESSION["_classes"][$name]=new Classes($name);<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; foreach($statics as $k=&gt;$v)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $_SESSION["_classes"][$name]-&gt;setStatic($k,$v);&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
}<br />
register_shutdown_function('storeStaticAttributes');<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75010""></a>
  <div class="note">
   <strong class="user">Travis Swicegood</strong>
   <a href="#75010" class="date">08-May-2007 04:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There is no need to use eval() to mimic mixins (i.e., multiple inheritance) within PHP 5.&nbsp; You only need to:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">class </span><span class="default">MyClass<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$_obj </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$obj</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_obj </span><span class="keyword">= </span><span class="default">$obj</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__call</span><span class="keyword">(</span><span class="default">$method</span><span class="keyword">, </span><span class="default">$args</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">method_exists</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_obj</span><span class="keyword">, </span><span class="default">$method</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="string">"unknown method [</span><span class="default">$method</span><span class="string">]"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">call_user_func_array</span><span class="keyword">(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; array(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_obj</span><span class="keyword">, </span><span class="default">$method</span><span class="keyword">),<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$args<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
You could just as easily add an addMixin() method that would allow you to add multiple objects to an array, and then iterate over that array until you found the right method.&nbsp; As noted, these are referred to as a Mixins in other languages.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74937""></a>
  <div class="note">
   <strong class="user">adar at darkpoetry dot de</strong>
   <a href="#74937" class="date">05-May-2007 03:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Maybe not really new and all in all definitely not the best solution,but if you cant extend a class (if your class alreay extends an abstract or other things like that) you can 'fake' a extend.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">MyClass<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">extends </span><span class="default">SomeAbstractUnknownClass </span><span class="keyword">{<br />
<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$classObject</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__construct </span><span class="keyword">( </span><span class="default">classObject $classToExtend </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">classObject </span><span class="keyword">= </span><span class="default">$classToExtend</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__call</span><span class="keyword">(</span><span class="default">$func</span><span class="keyword">, </span><span class="default">$var</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( !</span><span class="default">count</span><span class="keyword">(</span><span class="default">$var</span><span class="keyword">) ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">classObject</span><span class="keyword">-&gt;</span><span class="default">$func</span><span class="keyword">(</span><span class="default">$var</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$str </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$values </span><span class="keyword">= </span><span class="default">array_values</span><span class="keyword">(</span><span class="default">$var</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for ( </span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">count</span><span class="keyword">(</span><span class="default">$values</span><span class="keyword">); </span><span class="default">$i</span><span class="keyword">++ ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$str </span><span class="keyword">.= </span><span class="string">"'"</span><span class="keyword">.</span><span class="default">$values</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">].</span><span class="string">"' ,"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }&nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$str </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, -</span><span class="default">2</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return eval(</span><span class="string">'return $this-&gt;classObject-&gt;'</span><span class="keyword">.</span><span class="default">$func</span><span class="keyword">.</span><span class="string">'('</span><span class="keyword">.</span><span class="default">$str</span><span class="keyword">.</span><span class="string">');'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; }&nbsp;&nbsp; <br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
So if you'll do a $myClass-&gt;unknownMethod() and it is found neither in MyClass nor in SomeAbstractUnknownClass, MyClass will try to call this method in $classObject.<br />
<br />
I use this for 'extending' a UserObject-Class which already extends an other one.<br />
<br />
Better solutions are always welcome ;)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="72532""></a>
  <div class="note">
   <strong class="user">Dérico Filho</strong>
   <a href="#72532" class="date">23-Jan-2007 04:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Since PHP 5.2.0, you'll always get an error like this:<br />
"Object of class foo could not be converted to string"<br />
<br />
When one tries to use an object as string, for instance:<br />
<br />
class Test{}<br />
echo new Test();<br />
<br />
Thus, one way to avoid this problem is to programme the magic method __toString.<br />
<br />
However, in the older versions, it would output a string saying that it was an object together a unique obj id. Therefore, the __toString() method must comply with this behaviour.<br />
<br />
My suggestion:<br />
<br />
class Test{<br />
&nbsp;&nbsp;&nbsp; function __toString(){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(!isset($this-&gt;__uniqid))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;__uniqid = md5(uniqid(rand(), true));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return(get_class($this)."@".$this-&gt;__uniqid);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
}<br />
<br />
echo new Test();<br />
<br />
would output something like this:<br />
<br />
Test@6006ba04f5569544c10a588b04849cf7</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69361""></a>
  <div class="note">
   <strong class="user">jstubbs at work-at dot co dot jp</strong>
   <a href="#69361" class="date">02-Sep-2006 09:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
$myclass-&gt;foo['bar'] = 'baz';<br />
<br />
When overriding __get and __set, the above code can work (as expected) but it depends on your __get implementation rather than your __set. In fact, __set is never called with the above code. It appears that PHP (at least as of 5.1) uses a reference to whatever was returned by __get. To be more verbose, the above code is essentially identical to:<br />
<br />
$tmp_array = &amp;$myclass-&gt;foo;<br />
$tmp_array['bar'] = 'baz';<br />
unset($tmp_array);<br />
<br />
Therefore, the above won't do anything if your __get implementation resembles this:<br />
<br />
function __get($name) {<br />
&nbsp;&nbsp;&nbsp; return array_key_exists($name, $this-&gt;values)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; ? $this-&gt;values[$name] : null;<br />
}<br />
<br />
You will actually need to set the value in __get and return that, as in the following code:<br />
<br />
function __get($name) {<br />
&nbsp;&nbsp;&nbsp; if (!array_key_exists($name, $this-&gt;values))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;values[$name] = null;<br />
&nbsp;&nbsp;&nbsp; return $this-&gt;values[$name];<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="66140""></a>
  <div class="note">
   <strong class="user">taylorbarstow at google's mail service</strong>
   <a href="#66140" class="date">15-May-2006 10:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I've just come accross something interesting relating to storing PHP5 objects in a session.&nbsp; If you don't provide an __autoload(), then you MUST load the class definition before calling session_start().&nbsp; I guess that when you call session_start(), any objects in the session are unserialized then and there and placed into $_SESSION.&nbsp; If you don't provide the class definition before calling session_start(), your object will get the class __PHP_Incomplete_Class, and you won't be able to use it for anything.<br />
<br />
Examples:<br />
<br />
<span class="default">&lt;?php<br />
session_start</span><span class="keyword">();<br />
require_once </span><span class="string">'MyClass.php'</span><span class="keyword">;<br />
</span><span class="default">$obj </span><span class="keyword">= new </span><span class="default">MyClass</span><span class="keyword">;<br />
</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'obj'</span><span class="keyword">] = </span><span class="default">$obj</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
Works fine.&nbsp; Then on a subsequent page load:<br />
<br />
<span class="default">&lt;?php<br />
session_start</span><span class="keyword">();<br />
require_once </span><span class="string">'MyClass.php'</span><span class="keyword">;<br />
</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'obj'</span><span class="keyword">]-&gt;</span><span class="default">callSomeMethod</span><span class="keyword">();<br />
</span><span class="default">?&gt;<br />
</span><br />
Fatal error:&nbsp; The script tried to execute a method or access a property of an incomplete object. Please ensure that the class definition "MyClass" of the object you are trying to operate on was loaded _before_ unserialize() gets called or provide a __autoload() function to load the class definition.<br />
<br />
But if you do this instead, it works fine:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">require_once </span><span class="string">'MyClass.php'</span><span class="keyword">;<br />
</span><span class="default">session_start</span><span class="keyword">();<br />
</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'obj'</span><span class="keyword">]-&gt;</span><span class="default">callSomeMethod</span><span class="keyword">();<br />
</span><span class="default">?&gt;<br />
</span><br />
Hopefully in some future release of PHP, __PHP_Incomplete_Class will be smart enough to check for a class definition at time of use (method call or property operation), and, if the class exists, magically "complete" itself and turn into the desired object.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="63863""></a>
  <div class="note">
   <strong class="user">rayRO</strong>
   <a href="#63863" class="date">02-Apr-2006 06:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you use the Magical Method '__set()', be shure that the call of<br />
<span class="default">&lt;?php<br />
$myobject</span><span class="keyword">-&gt;</span><span class="default">test</span><span class="keyword">[</span><span class="string">'myarray'</span><span class="keyword">] = </span><span class="string">'data'</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span>will not appear!<br />
<br />
For that u have to do it the fine way if you want to use __set Method ;)<br />
<span class="default">&lt;?php<br />
$myobject</span><span class="keyword">-&gt;</span><span class="default">test </span><span class="keyword">= array(</span><span class="string">'myarray' </span><span class="keyword">=&gt; </span><span class="string">'data'</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
If a Variable is already set, the __set Magic Method already wont appear!<br />
<br />
My first solution was to use a Caller Class.<br />
With that, i ever knew which Module i currently use!<br />
But who needs it... :]<br />
There are quiet better solutions for this...<br />
Here's the Code:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">Caller </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$caller</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$module</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__call</span><span class="keyword">(</span><span class="default">$funcname</span><span class="keyword">, </span><span class="default">$args </span><span class="keyword">= array()) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">setModuleInformation</span><span class="keyword">();<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_object</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">caller</span><span class="keyword">) &amp;&amp; </span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">'call_user_func_array'</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$return </span><span class="keyword">= </span><span class="default">call_user_func_array</span><span class="keyword">(array(&amp;</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">caller</span><span class="keyword">, </span><span class="default">$funcname</span><span class="keyword">), </span><span class="default">$args</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">trigger_error</span><span class="keyword">(</span><span class="string">"Call to Function with call_user_func_array failed"</span><span class="keyword">, </span><span class="default">E_USER_ERROR</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">unsetModuleInformation</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$return</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$callerClassName </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">, </span><span class="default">$callerModuleName </span><span class="keyword">= </span><span class="string">'Webboard'</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$callerClassName </span><span class="keyword">== </span><span class="default">false</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">trigger_error</span><span class="keyword">(</span><span class="string">'No Classname'</span><span class="keyword">, </span><span class="default">E_USER_ERROR</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">module </span><span class="keyword">= </span><span class="default">$callerModuleName</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">class_exists</span><span class="keyword">(</span><span class="default">$callerClassName</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">caller </span><span class="keyword">= new </span><span class="default">$callerClassName</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">trigger_error</span><span class="keyword">(</span><span class="string">'Class not exists: \''</span><span class="keyword">.</span><span class="default">$callerClassName</span><span class="keyword">.</span><span class="string">'\''</span><span class="keyword">, </span><span class="default">E_USER_ERROR</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_object</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">caller</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">setModuleInformation</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">method_exists</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">caller</span><span class="keyword">, </span><span class="string">'__init'</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">caller</span><span class="keyword">-&gt;</span><span class="default">__init</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">unsetModuleInformation</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">trigger_error</span><span class="keyword">(</span><span class="string">'Caller is no object!'</span><span class="keyword">, </span><span class="default">E_USER_ERROR</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__destruct</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">setModuleInformation</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">method_exists</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">caller</span><span class="keyword">, </span><span class="string">'__deinit'</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">caller</span><span class="keyword">-&gt;</span><span class="default">__deinit</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">unsetModuleInformation</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__isset</span><span class="keyword">(</span><span class="default">$isset</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">setModuleInformation</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_object</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">caller</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$return </span><span class="keyword">= isset(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">caller</span><span class="keyword">-&gt;{</span><span class="default">$isset</span><span class="keyword">});<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">trigger_error</span><span class="keyword">(</span><span class="string">'Caller is no object!'</span><span class="keyword">, </span><span class="default">E_USER_ERROR</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">unsetModuleInformation</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$return</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__unset</span><span class="keyword">(</span><span class="default">$unset</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">setModuleInformation</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_object</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">caller</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (isset(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">caller</span><span class="keyword">-&gt;{</span><span class="default">$unset</span><span class="keyword">}))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; unset(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">caller</span><span class="keyword">-&gt;{</span><span class="default">$unset</span><span class="keyword">});<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">trigger_error</span><span class="keyword">(</span><span class="string">'Caller is no object!'</span><span class="keyword">, </span><span class="default">E_USER_ERROR</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">unsetModuleInformation</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__set</span><span class="keyword">(</span><span class="default">$set</span><span class="keyword">, </span><span class="default">$val</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">setModuleInformation</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_object</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">caller</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">caller</span><span class="keyword">-&gt;{</span><span class="default">$set</span><span class="keyword">} = </span><span class="default">$val</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">trigger_error</span><span class="keyword">(</span><span class="string">'Caller is no object!'</span><span class="keyword">, </span><span class="default">E_USER_ERROR</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">unsetModuleInformation</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__get</span><span class="keyword">(</span><span class="default">$get</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">setModuleInformation</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_object</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">caller</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (isset(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">caller</span><span class="keyword">-&gt;{</span><span class="default">$get</span><span class="keyword">}))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$return </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">caller</span><span class="keyword">-&gt;{</span><span class="default">$get</span><span class="keyword">};<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$return </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">trigger_error</span><span class="keyword">(</span><span class="string">'Caller is no object!'</span><span class="keyword">, </span><span class="default">E_USER_ERROR</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">unsetModuleInformation</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$return</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">setModuleInformation</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">caller</span><span class="keyword">-&gt;</span><span class="default">module </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">module</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">unsetModuleInformation</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">caller</span><span class="keyword">-&gt;</span><span class="default">module </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="comment">// Well this can be a Config Class?<br />
</span><span class="keyword">class </span><span class="default">Config </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$module</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$test</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__construct</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; print(</span><span class="string">'Constructor will have no Module Information... Use __init() instead!&lt;br /&gt;'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; print(</span><span class="string">'--&gt; '</span><span class="keyword">.</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">module</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">).</span><span class="string">' &lt;--'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; print(</span><span class="string">'&lt;br /&gt;'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; print(</span><span class="string">'&lt;br /&gt;'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">test </span><span class="keyword">= </span><span class="string">'123'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__init</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; print(</span><span class="string">'Using of __init()!&lt;br /&gt;'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; print(</span><span class="string">'--&gt; '</span><span class="keyword">.</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">module</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">).</span><span class="string">' &lt;--'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; print(</span><span class="string">'&lt;br /&gt;'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; print(</span><span class="string">'&lt;br /&gt;'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">testFunction</span><span class="keyword">(</span><span class="default">$test </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$test </span><span class="keyword">!= </span><span class="default">false</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">test </span><span class="keyword">= </span><span class="default">$test</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
echo(</span><span class="string">'&lt;pre&gt;'</span><span class="keyword">);<br />
</span><span class="default">$wow </span><span class="keyword">= new </span><span class="default">Caller</span><span class="keyword">(</span><span class="string">'Config'</span><span class="keyword">, </span><span class="string">'Guestbook'</span><span class="keyword">);<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$wow</span><span class="keyword">-&gt;</span><span class="default">test</span><span class="keyword">);<br />
print(</span><span class="string">'&lt;br /&gt;'</span><span class="keyword">);<br />
print(</span><span class="string">'&lt;br /&gt;'</span><span class="keyword">);<br />
</span><span class="default">$wow</span><span class="keyword">-&gt;</span><span class="default">test </span><span class="keyword">= </span><span class="string">'456'</span><span class="keyword">;<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$wow</span><span class="keyword">-&gt;</span><span class="default">test</span><span class="keyword">);<br />
print(</span><span class="string">'&lt;br /&gt;'</span><span class="keyword">);<br />
print(</span><span class="string">'&lt;br /&gt;'</span><span class="keyword">);<br />
</span><span class="default">$wow</span><span class="keyword">-&gt;</span><span class="default">testFunction</span><span class="keyword">(</span><span class="string">'789'</span><span class="keyword">);<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$wow</span><span class="keyword">-&gt;</span><span class="default">test</span><span class="keyword">);<br />
print(</span><span class="string">'&lt;br /&gt;'</span><span class="keyword">);<br />
print(</span><span class="string">'&lt;br /&gt;'</span><span class="keyword">);<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$wow</span><span class="keyword">-&gt;</span><span class="default">module</span><span class="keyword">);<br />
echo(</span><span class="string">'&lt;/pre&gt;'</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Outputs something Like:<br />
<br />
Constructor will have no Module Information... Use __init() instead!<br />
--&gt;&nbsp; &lt;--<br />
<br />
Using of __init()!<br />
--&gt; Guestbook &lt;--<br />
<br />
123<br />
<br />
456<br />
<br />
789<br />
<br />
Guestbook</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="61745""></a>
  <div class="note">
   <strong class="user">ksamvel at gmail dot com</strong>
   <a href="#61745" class="date">10-Feb-2006 06:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To copy base part of derived class appropriate method in base should be defined. E.g.:<br />
<br />
&nbsp; class A {<br />
&nbsp;&nbsp;&nbsp; public function setAVar( $oAVar) { $this-&gt;oAVar = $oAVar; }<br />
&nbsp;&nbsp;&nbsp; public function getAVar() { return $this-&gt;oAVar; }<br />
<br />
&nbsp;&nbsp;&nbsp; public function copyA( &amp;$roDest) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; if( $roDest instanceof A)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;oAVar = $roDest-&gt;oAVar;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; private $oAVar;<br />
&nbsp; }<br />
<br />
&nbsp; class B extends A {<br />
&nbsp;&nbsp;&nbsp; public function setBVar( $oBVar) { $this-&gt;oBVar = $oBVar; }<br />
&nbsp;&nbsp;&nbsp; public function getBVar() { return $this-&gt;oBVar; }<br />
<br />
&nbsp;&nbsp;&nbsp; private $oBVar;<br />
&nbsp; }<br />
<br />
&nbsp; $oA = new A();<br />
&nbsp; $oB = new B();<br />
<br />
&nbsp; $oA-&gt;setAVar( 4);<br />
<br />
&nbsp; $oB-&gt;setAVar( 5);<br />
&nbsp; $oB-&gt;setBVar( 6);<br />
&nbsp; echo "oA::oAVar " . $oA-&gt;getAVar() . "&lt;br&gt;";<br />
&nbsp; echo "oB::oAVar " . $oB-&gt;getAVar() . "&lt;br&gt;";<br />
&nbsp; echo "oB::oBVar " . $oB-&gt;getBVar() . "&lt;br&gt;";<br />
&nbsp; echo "&lt;br&gt;";<br />
<br />
&nbsp; $oB-&gt;copyA( $oA);<br />
<br />
&nbsp; echo "oA::oAVar " . $oA-&gt;getAVar() . "&lt;br&gt;";<br />
&nbsp; echo "oB::oAVar " . $oB-&gt;getAVar() . "&lt;br&gt;";<br />
&nbsp; echo "oB::oBVar " . $oB-&gt;getBVar() . "&lt;br&gt;";<br />
<br />
Output:<br />
<br />
oA::oAVar 4<br />
oB::oAVar 5<br />
oB::oBVar 6<br />
<br />
oA::oAVar 4<br />
oB::oAVar 4<br />
oB::oBVar 6</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="61130""></a>
  <div class="note">
   <strong class="user">b dot schoppmeier at bas-consult dot de</strong>
   <a href="#61130" class="date">26-Jan-2006 12:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The sequence of events regarding __sleep and __destruct is unusual __ as __destruct is called before __sleep. The following code snippet:<br />
<br />
<span class="default">&lt;?php<br />
$sequence </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
class </span><span class="default">foo </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$stuff</span><span class="keyword">;&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$param</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; global </span><span class="default">$sequence</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Seq: "</span><span class="keyword">, </span><span class="default">$sequence</span><span class="keyword">++, </span><span class="string">" - constructor\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">stuff </span><span class="keyword">= </span><span class="default">$param</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__destruct</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; global </span><span class="default">$sequence</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Seq: "</span><span class="keyword">, </span><span class="default">$sequence</span><span class="keyword">++, </span><span class="string">" - destructor\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__sleep</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; global </span><span class="default">$sequence</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Seq: "</span><span class="keyword">, </span><span class="default">$sequence</span><span class="keyword">++, </span><span class="string">" - __sleep\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return array(</span><span class="string">"stuff"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__wakeup</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; global </span><span class="default">$sequence</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Seq: "</span><span class="keyword">, </span><span class="default">$sequence</span><span class="keyword">++, </span><span class="string">" - __wakeup\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">session_start</span><span class="keyword">();<br />
</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">"obj"</span><span class="keyword">] = new </span><span class="default">foo</span><span class="keyword">(</span><span class="string">"A foo"</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
yields the output:<br />
<br />
Seq: 0 - constructor<br />
Seq: 1 - destructor<br />
Seq: 2 - __sleep<br />
<br />
Only when you end your script with a call to session_write_close() as in:<br />
<br />
<span class="default">&lt;?php<br />
$sequence </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
class </span><span class="default">foo </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$stuff</span><span class="keyword">;&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$param</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; global </span><span class="default">$sequence</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Seq: "</span><span class="keyword">, </span><span class="default">$sequence</span><span class="keyword">++, </span><span class="string">" - constructor\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">stuff </span><span class="keyword">= </span><span class="default">$param</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__destruct</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; global </span><span class="default">$sequence</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Seq: "</span><span class="keyword">, </span><span class="default">$sequence</span><span class="keyword">++, </span><span class="string">" - destructor\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__sleep</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; global </span><span class="default">$sequence</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Seq: "</span><span class="keyword">, </span><span class="default">$sequence</span><span class="keyword">++, </span><span class="string">" - __sleep\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return array(</span><span class="string">"stuff"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__wakeup</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; global </span><span class="default">$sequence</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Seq: "</span><span class="keyword">, </span><span class="default">$sequence</span><span class="keyword">++, </span><span class="string">" - __wakeup\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">session_start</span><span class="keyword">();<br />
</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">"obj"</span><span class="keyword">] = new </span><span class="default">foo</span><span class="keyword">(</span><span class="string">"A foo"</span><span class="keyword">);<br />
</span><span class="default">session_write_close</span><span class="keyword">();<br />
</span><span class="default">?&gt;<br />
</span><br />
the sequence is as common sense would expect it to be as the following output shows:<br />
<br />
Seq: 0 - constructor<br />
Seq: 1 - __sleep<br />
Seq: 2 - destructor</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="59560""></a>
  <div class="note">
   <strong class="user">docey</strong>
   <a href="#59560" class="date">09-Dec-2005 05:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
about __sleep and _wakeup, consider using a method like this:<br />
<br />
class core<br />
{<br />
<br />
&nbsp;var $sub_core; //ref of subcore<br />
&nbsp;var $_sleep_subcore; // place where serialize version of sub_core will be stored<br />
<br />
&nbsp;function core(){<br />
&nbsp; $this-&gt;sub_core = new sub_core();<br />
&nbsp; return true;<br />
&nbsp;}<br />
<br />
&nbsp;function __wakeup()<br />
&nbsp;{<br />
&nbsp; // on wakeup of core, core unserializes sub_core<br />
&nbsp; // wich it had stored when it was serialized itself<br />
&nbsp; $this-&gt;sub_core = unserialize($this-&gt;_sleep_subcore);<br />
&nbsp; return true;<br />
&nbsp;}<br />
<br />
&nbsp;function __sleep()<br />
&nbsp;{<br />
&nbsp; // sub_core will be serialized when core is serialized.<br />
&nbsp; // the serialized subcore will be stored as a string inside core.<br />
&nbsp;&nbsp; $this-&gt;_sleep_subcore = serialize($this-&gt;sub_core);<br />
&nbsp;&nbsp; $return_arr[] = "_sleep_subcore";<br />
&nbsp;&nbsp; return $return_arr;<br />
&nbsp;}<br />
<br />
}<br />
<br />
class sub_core<br />
{<br />
&nbsp;var $info;<br />
<br />
&nbsp;function sub_core()<br />
&nbsp;{<br />
&nbsp; $this-&gt;info["somedata"] = "somedata overhere"<br />
&nbsp;}<br />
<br />
&nbsp;function __wakeup()<br />
&nbsp;{<br />
&nbsp; return true;<br />
&nbsp;}<br />
<br />
&nbsp;function __sleep()<br />
&nbsp;{<br />
&nbsp; $return_arr[] = "info"<br />
&nbsp; return $return_arr; <br />
&nbsp;}<br />
<br />
}<br />
<br />
this way subcore is being serialized by core when core is being serialized. subcore handles its own data and core stores it as a serialize string inside itself. on wakeup core unserializes subcore. <br />
<br />
this may have a performance cost, but if you have many objects connected this way this is the best way of serializing them. you only need to serialize the the main object wich will serialize all those below which will serialize all those below them again. in effect causing a sort of chainreaction in wich each object takes care of its own info.<br />
<br />
offcoarse you always need to store the eventualy serialized string in a safe place. somebody got experience with this way of __wakeup and __sleep. <br />
<br />
works in PHP4&amp;5</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="55844""></a>
  <div class="note">
   <strong class="user">martin dot goldinger at netserver dot ch</strong>
   <a href="#55844" class="date">15-Aug-2005 01:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When you use sessions, its very important to keep the sessiondata small, due to low performance with unserialize. Every class shoud extend from this class. The result will be, that no null Values are written to the sessiondata. It will increase performance.<br />
<br />
&lt;?<br />
class BaseObject<br />
{<br />
&nbsp;&nbsp;&nbsp; function __sleep()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $vars = (array)$this;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach ($vars as $key =&gt; $val)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (is_null($val))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; unset($vars[$key]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return array_keys($vars);<br />
&nbsp;&nbsp;&nbsp; }<br />
};<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="55806""></a>
  <div class="note">
   <strong class="user">jeffxlevy at gmail dot com</strong>
   <a href="#55806" class="date">14-Aug-2005 03:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Intriguing what happens when __sleep() and __wakeup() and sessions() are mixed. I had a hunch that, as session data is serialized, __sleep would be called when an object, or whatever, is stored in _SESSION. true. The same hunch applied when session_start() was called. Would __wakeup() be called? True. Very helpful, specifically as I'm building massive objects (well, lots of simple objects stored in sessions), and need lots of automated tasks (potentially) reloaded at "wakeup" time. (for instance, restarting a database session/connection).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="55783""></a>
  <div class="note">
   <strong class="user">mastabog at hotmail dot com</strong>
   <a href="#55783" class="date">13-Aug-2005 02:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In reply to krisj1010 at gmail.com below:
<br />

<br />
__sleep() handles protected/private properties very well. You should never rely on get_class_vars() to retrieve property names since this function only returns the public properties. Use the Reflection API instead for that purpose. Better yet, if you know which ones you want to save it is always faster to specify the return array manually.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="49413""></a>
  <div class="note">
   <strong class="user">ddavenport at newagedigital dot com</strong>
   <a href="#49413" class="date">27-Jan-2005 08:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
One of the principles of OOP is encapsulation--the idea that an object should handle its own data and no others'.&nbsp; Asking base classes to take care of subclasses' data, esp considering that a class can't possibly know how many dozens of ways it will be extended, is irresponsible and dangerous.<br />
<br />
Consider the following...<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">SomeStupidStorageClass<br />
</span><span class="keyword">{<br />
&nbsp; public function </span><span class="default">getContents</span><span class="keyword">(</span><span class="default">$pos</span><span class="keyword">, </span><span class="default">$len</span><span class="keyword">) { ...</span><span class="default">stuff</span><span class="keyword">... }<br />
}<br />
<br />
class </span><span class="default">CryptedStorageClass </span><span class="keyword">extends </span><span class="default">SomeStupidStorageClass<br />
</span><span class="keyword">{<br />
&nbsp; private </span><span class="default">$decrypted_block</span><span class="keyword">;<br />
&nbsp; public function </span><span class="default">getContents</span><span class="keyword">(</span><span class="default">$pos</span><span class="keyword">, </span><span class="default">$len</span><span class="keyword">) { ...</span><span class="default">decrypt</span><span class="keyword">... }<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
If SomeStupidStorageClass decided to serialize its subclasses' data as well as its own, a portion of what was once an encrypted thingie could be stored, in the clear, wherever the thingie was stored.&nbsp; Obviously, CryptedStorageClass would never have chosen this...but it had to either know how to serialize its parent class's data without calling parent::_sleep(), or let the base class do what it wanted to.<br />
<br />
Considering encapsulation again, no class should have to know how the parent handles its own private data.&nbsp; And it certainly shouldn't have to worry that users will find a way to break access controls in the name of convenience.<br />
<br />
If a class wants both to have private/protected data and to survive serialization, it should have its own __sleep() method which asks the parent to report its own fields and then adds to the list if applicable.&nbsp; Like so....<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">class </span><span class="default">BetterClass<br />
</span><span class="keyword">{<br />
&nbsp; private </span><span class="default">$content</span><span class="keyword">;<br />
<br />
&nbsp; public function </span><span class="default">__sleep</span><span class="keyword">()<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; return array(</span><span class="string">'basedata1'</span><span class="keyword">, </span><span class="string">'basedata2'</span><span class="keyword">);<br />
&nbsp; }<br />
<br />
&nbsp; public function </span><span class="default">getContents</span><span class="keyword">() { ...</span><span class="default">stuff</span><span class="keyword">... }<br />
}<br />
<br />
class </span><span class="default">BetterDerivedClass </span><span class="keyword">extends </span><span class="default">BetterClass<br />
</span><span class="keyword">{<br />
&nbsp; private </span><span class="default">$decrypted_block</span><span class="keyword">;<br />
<br />
&nbsp; public function </span><span class="default">__sleep</span><span class="keyword">()<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">parent</span><span class="keyword">::</span><span class="default">__sleep</span><span class="keyword">();<br />
&nbsp; }<br />
<br />
&nbsp; public function </span><span class="default">getContents</span><span class="keyword">() { ...</span><span class="default">decrypt</span><span class="keyword">... }<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
The derived class has better control over its data, and we don't have to worry about something being stored that shouldn't be.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="48849""></a>
  <div class="note">
   <strong class="user">krisj1010 at gmail.com</strong>
   <a href="#48849" class="date">09-Jan-2005 09:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are attempting to write an abstract/base class which automates the __sleep process in PHP5 you will run into some trouble if the subclasses which are being serialized have private/protected variables you need to be serialized.&nbsp; <br />
<br />
The reason is, even though get_class($this) within the base class will return the subclass -- get_class_vars(get_class($this)) will *not* return the subclass' protected/private variables.&nbsp; Which makes sense -- using OO principles.&nbsp; <br />
<br />
However, when automating __sleep it becomes necissary to have access to the private/protected subclass variables because their names have to be returned by __sleep.<br />
<br />
So here is the work around:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">public function </span><span class="default">__sleep</span><span class="keyword">()<br />
{<br />
&nbsp;... </span><span class="default">code </span><span class="keyword">...<br />
</span><span class="default">$sleepVars&nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">array_keys</span><span class="keyword">((array)</span><span class="default">$this</span><span class="keyword">);<br />
return </span><span class="default">$sleepVars</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Even though array_keys includes more information about the variable names than just the variable names -- it still seems to work appropriately.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
