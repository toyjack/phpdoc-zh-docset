<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>SOAP 函数</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="soap.constants.html">? 预定义常量</a></li>
      <li style="float: right;"><a href="function.is-soap-fault.html">is_soap_fault ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="book.soap.html">SOAP</a></li>
    <li>SOAP 函数</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="ref.soap" class="reference">
 <h1 class="title">SOAP 函数</h1>

 















<h2>Table of Contents</h2><ul class="chunklist chunklist_reference"><li><a href="function.is-soap-fault.html">is_soap_fault</a> &mdash; Checks if a SOAP call has failed</li><li><a href="function.use-soap-error-handler.html">use_soap_error_handler</a> &mdash; Set whether to use the SOAP error handler</li></ul>
</div>
<div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="86320""></a>
  <div class="note">
   <strong class="user">admin at localfm dot info</strong>
   <a href="#86320" class="date">13-Oct-2008 09:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As you may find, SOAP functions return result of type stdClass, not array. It means that you'll need to use $row-&gt;id instead of $row['id'] which may be inconvenient.
<br />

<br />
You can cast stdClass to array using this construction:
<br />

<br />
<span class="default">&lt;?php
<br />
$data </span><span class="keyword">= </span><span class="default">$soap</span><span class="keyword">-&gt;</span><span class="default">getMyData</span><span class="keyword">(</span><span class="default">$someParams</span><span class="keyword">);
<br />
</span><span class="default">$data </span><span class="keyword">= (array)</span><span class="default">$data</span><span class="keyword">;
<br />

<br />
print </span><span class="default">$data</span><span class="keyword">[</span><span class="string">'field'</span><span class="keyword">]; </span><span class="comment">// now it works
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85905""></a>
  <div class="note">
   <strong class="user">vIceBerg</strong>
   <a href="#85905" class="date">24-Sep-2008 04:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I have PHP 5.2.5 on my computer. I get this result:<br />
<br />
Array<br />
(<br />
&nbsp;&nbsp;&nbsp; [0] =&gt; stdClass Object<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [Client] =&gt; stdClass Object<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [Nom] =&gt; LeNom:00000<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [Prenom] =&gt; LePrenom:00000<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
My host have 5.1.6, the same call returns this result:<br />
Array<br />
(<br />
&nbsp;&nbsp;&nbsp; [0] =&gt; stdClass Object<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [Client] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [0] =&gt; stdClass Object<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [Nom] =&gt; LeNom:00000<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [Prenom] =&gt; LePrenom:00000<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
5.2.5 is the good structure.<br />
<br />
Take care of the version you're using. It can be a lot of work to change all the code</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84747""></a>
  <div class="note">
   <strong class="user">daniel dot harding at chaptereight dot com</strong>
   <a href="#84747" class="date">28-Jul-2008 05:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Setting Attributes for Complex Type Elements PHP5/SOAP
<br />
=========================================
<br />

<br />

<br />
// Setting attributes for simple elements:
<br />
&lt;parentEl id="ref1"&gt;12345&lt;/foo&gt;
<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">array(</span><span class="string">"parentEl" </span><span class="keyword">=&gt; array(</span><span class="string">"_" </span><span class="keyword">=&gt; </span><span class="default">12345</span><span class="keyword">, </span><span class="string">"id" </span><span class="keyword">=&gt; </span><span class="string">"ref1"</span><span class="keyword">));
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
// Setting attributes for complex elements:
<br />
&lt;parentEl id="ref1"&gt;
<br />
&nbsp;&nbsp;&nbsp; &lt;childEl&gt;blah&lt;/childEl&gt;
<br />
&lt;/parentEl&gt;
<br />

<br />
'parentEl' =&gt; array(
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; array('childEl' =&gt; 'blah')
<br />
&nbsp;&nbsp;&nbsp; ),
<br />
&nbsp;&nbsp;&nbsp; 'id' =&gt; 'ref1'
<br />
)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83410""></a>
  <div class="note">
   <strong class="user">nodkz at mail dot ru</strong>
   <a href="#83410" class="date">24-May-2008 11:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
PROBLEM (with SOAP extension under PHP5) of transferring object, that contains objects or array of objects. Nested object would not transfer.<br />
<br />
SOLUTION:<br />
This class was developed by trial and error by me. So this 23 lines of code for most developers writing under PHP5 solves fate of using SOAP extension.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/*<br />
According to specific of organization process of SOAP class in PHP5, we must wrap up complex objects in SoapVar class. Otherwise objects would not be encoded properly and could not be loaded on remote SOAP handler.<br />
<br />
Function "getAsSoap" call for encoding object for transmission. After encoding it can be properly transmitted.<br />
*/<br />
</span><span class="keyword">abstract class </span><span class="default">SOAPable </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">getAsSOAP</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$this </span><span class="keyword">as </span><span class="default">$key</span><span class="keyword">=&gt;&amp;</span><span class="default">$value</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">prepareSOAPrecursive</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">$key</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; private function </span><span class="default">prepareSOAPrecursive</span><span class="keyword">(&amp;</span><span class="default">$element</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$element</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$element </span><span class="keyword">as </span><span class="default">$key</span><span class="keyword">=&gt;&amp;</span><span class="default">$val</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">prepareSOAPrecursive</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$element</span><span class="keyword">=new </span><span class="default">SoapVar</span><span class="keyword">(</span><span class="default">$element</span><span class="keyword">,</span><span class="default">SOAP_ENC_ARRAY</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }elseif(</span><span class="default">is_object</span><span class="keyword">(</span><span class="default">$element</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$element </span><span class="keyword">instanceof </span><span class="default">SOAPable</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$element</span><span class="keyword">-&gt;</span><span class="default">getAsSOAP</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$element</span><span class="keyword">=new </span><span class="default">SoapVar</span><span class="keyword">(</span><span class="default">$element</span><span class="keyword">,</span><span class="default">SOAP_ENC_OBJECT</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="comment">// ------------------------------------------<br />
//&nbsp; ABSTRACT EXAMPLE<br />
// ------------------------------------------<br />
<br />
</span><span class="keyword">class </span><span class="default">PersonList </span><span class="keyword">extends </span><span class="default">SOAPable </span><span class="keyword">{<br />
&nbsp; protected </span><span class="default">$ArrayOfPerson</span><span class="keyword">; </span><span class="comment">// variable MUST be protected or public!<br />
</span><span class="keyword">}<br />
<br />
class </span><span class="default">Person </span><span class="keyword">extends </span><span class="default">SOAPable </span><span class="keyword">{<br />
&nbsp;&nbsp; </span><span class="comment">//any data<br />
</span><span class="keyword">} <br />
<br />
</span><span class="default">$client</span><span class="keyword">=new </span><span class="default">SoapClient</span><span class="keyword">(</span><span class="string">"test.wsdl"</span><span class="keyword">, array( </span><span class="string">'soap_version'</span><span class="keyword">=&gt;</span><span class="default">SOAP_1_2</span><span class="keyword">, </span><span class="string">'trace'</span><span class="keyword">=&gt;</span><span class="default">1</span><span class="keyword">, </span><span class="string">'classmap' </span><span class="keyword">=&gt; array(</span><span class="string">'Person' </span><span class="keyword">=&gt; </span><span class="string">"Person"</span><span class="keyword">, </span><span class="string">'PersonList' </span><span class="keyword">=&gt; </span><span class="string">"PersonList"</span><span class="keyword">)&nbsp; ));<br />
<br />
</span><span class="default">$PersonList</span><span class="keyword">=new </span><span class="default">PersonList</span><span class="keyword">;<br />
<br />
</span><span class="comment">// some actions<br />
<br />
</span><span class="default">$PersonList</span><span class="keyword">-&gt;</span><span class="default">getAsSOAP</span><span class="keyword">();<br />
<br />
</span><span class="default">$client</span><span class="keyword">-&gt;</span><span class="default">someMethod</span><span class="keyword">(</span><span class="default">$PersonList</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
So every class, which will transfer via SOAP, must be extends from class SOAPable.&nbsp; <br />
As you can see, in code above, function prepareSOAPrecursive search another nested objects in parent object or in arrays, and if does it, tries call function getAsSOAP() for preparation of nested objects, after that simply wrap up via SoapVar class.<br />
<br />
So in code before transmitting simply call $obj-&gt;getAsSOAP()</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83028""></a>
  <div class="note">
   <strong class="user">aeolianmeson at dontfindme dot blitzeclipse dot com</strong>
   <a href="#83028" class="date">07-May-2008 05:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A quick example to do a login using a WSDL, do a second request using the session ID from the login response, and then dump the XML from that request.<br />
<br />
&nbsp;&nbsp;&nbsp; // Setting "trace" will allow us to view the request that we are making, after we have made it.<br />
&nbsp;&nbsp;&nbsp; $objClient = new SoapClient("<a href="http://www.somewhere.com/wsdls/some.wsdl" rel="nofollow" target="_blank">http://www.somewhere.com/wsdls/some.wsdl</a>", array('trace' =&gt; true)); <br />
<br />
&nbsp;&nbsp;&nbsp; // These parameters satisfy this specific remote call.<br />
&nbsp;&nbsp;&nbsp; $arrParameters_Login = array('username' =&gt; 'username', 'password' =&gt; 'password', 'company' =&gt; 'Company');<br />
<br />
&nbsp;&nbsp;&nbsp; // Invoke the remote call "login()".<br />
&nbsp;&nbsp;&nbsp; $objLogin =&nbsp; $objClient-&gt;login($arrParameters_Login); <br />
<br />
&nbsp;&nbsp;&nbsp; // Grab session ID that this remote call will provide.<br />
&nbsp;&nbsp;&nbsp; $strSessionID = $objLogin-&gt;loginReturn-&gt;sessionId;<br />
<br />
&nbsp;&nbsp;&nbsp; // Set headers-- The remote call "query()" will require a header pointing to our session.<br />
<br />
&nbsp;&nbsp;&nbsp; $strHeaderComponent_Session = "&lt;SessionHeader&gt;&lt;sessionId&gt;$strSessionID&lt;/sessionId&gt;&lt;/SessionHeader&gt;";<br />
<br />
&nbsp;&nbsp;&nbsp; $objVar_Session_Inside = new SoapVar($strHeaderComponent_Session, XSD_ANYXML, null, null, null);<br />
&nbsp;&nbsp;&nbsp; $objHeader_Session_Outside = new SoapHeader('namespace.com', 'SessionHeader', $objVar_Session_Inside);<br />
<br />
&nbsp;&nbsp;&nbsp; // More than one header can be provided in this array.<br />
&nbsp;&nbsp;&nbsp; $objClient-&gt;__setSoapHeaders(array($objHeader_Session_Outside));<br />
<br />
&nbsp;&nbsp;&nbsp; // Set the query parameters.<br />
<br />
&nbsp;&nbsp;&nbsp; $strQuery = 'select empID from Time where empID = 92389278';<br />
&nbsp;&nbsp;&nbsp; $arrParameters_Query = array('queryString' =&gt; $strQuery);<br />
<br />
&nbsp;&nbsp;&nbsp; // Make call.<br />
<br />
&nbsp;&nbsp;&nbsp; $objResponse = $objClient-&gt;query($arrParameters_Query);<br />
<br />
&nbsp;&nbsp;&nbsp; header('Content-Type: text/xml; ');<br />
&nbsp;&nbsp;&nbsp; print($objClient-&gt;__getLastRequest());<br />
<br />
The request that goes out:<br />
<br />
&lt;SOAP-ENV:Envelope&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;SOAP-ENV:Header&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;SessionHeader&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;sessionId&gt;8789364113604871127&lt;/sessionId&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;/SessionHeader&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;/SOAP-ENV:Header&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;SOAP-ENV:Body&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;ns1:query&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;ns1:queryString&gt;select empID from Time where empID = 92389278&lt;/ns1:queryString&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &lt;/ns1:query&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;/SOAP-ENV:Body&gt;<br />
&lt;/SOAP-ENV:Envelope&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82919""></a>
  <div class="note">
   <strong class="user">rlee at melbournechapter dot net</strong>
   <a href="#82919" class="date">02-May-2008 02:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just a note on "DTD not recognised..." faults. Check to make sure your wsdl file contains:<br />
<br />
&lt;?xml version ='1.0' encoding ='UTF-8' ?&gt;&nbsp; <br />
<br />
Also make sure you use full paths, to your service (in the wsdl, client and server) <br />
...<br />
&lt;wsdlsoap:address location='<a href="http://www.mysite.com.au/web_services/myserver.php" rel="nofollow" target="_blank">http://www.mysite.com.au/web_services/myserver.php</a>' /&gt;<br />
...<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// SOAP Server<br />
</span><span class="default">$server </span><span class="keyword">= new </span><span class="default">SoapServer</span><span class="keyword">(</span><span class="string">'<a href="http://www.mysite.com.au/web_services/hello.wsdl" rel="nofollow" target="_blank">http://www.mysite.com.au/web_services/hello.wsdl</a>'</span><span class="keyword">);<br />
...<br />
...<br />
</span><span class="default">?&gt;<br />
</span><br />
<span class="default">&lt;?php<br />
</span><span class="comment">// SOAP Client<br />
&nbsp;</span><span class="default">$client </span><span class="keyword">= new </span><span class="default">SoapClient</span><span class="keyword">(</span><span class="string">'<a href="http://www.mysite.com.au/web_services/hello.wsdl" rel="nofollow" target="_blank">http://www.mysite.com.au/web_services/hello.wsdl</a>'</span><span class="keyword">);<br />
...<br />
...<br />
</span><span class="default">?&gt;<br />
</span><br />
FYI im no SOAP expert but I hope this helps someone out ;)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82188""></a>
  <div class="note">
   <strong class="user">Aurlien Christman</strong>
   <a href="#82188" class="date">31-Mar-2008 10:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
From PHP 5, you can use the undocumented method SoapClient::__setLocation() to redefine the target EPR :<br />
<br />
<span class="default">&lt;?php<br />
<br />
$client </span><span class="keyword">= new </span><span class="default">SoapClient</span><span class="keyword">(</span><span class="string">"some_wsdl"</span><span class="keyword">);<br />
</span><span class="default">$client</span><span class="keyword">-&gt;</span><span class="default">__setLocation</span><span class="keyword">(</span><span class="string">"<a href="http://new/target/epr" rel="nofollow" target="_blank">http://new/target/epr</a>"</span><span class="keyword">);<br />
<br />
</span><span class="default">$client</span><span class="keyword">-&gt;</span><span class="default">someFunction</span><span class="keyword">(</span><span class="string">"param1"</span><span class="keyword">, </span><span class="string">"param2"</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82014""></a>
  <div class="note">
   <strong class="user">Andr Hnsel</strong>
   <a href="#82014" class="date">24-Mar-2008 08:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that HTTP auth is not done when fetching the WSDL file, only when carrying out the actual SOAP request.<br />
<br />
Bug #27777 states that it is possible to supply credentials for the WSDL file using URL notation:<br />
<br />
<span class="default">&lt;?php<br />
$client </span><span class="keyword">= new </span><span class="default">SoapClient</span><span class="keyword">(</span><span class="string">"<a href="http://yourLogin:yourPassword@foo.com/bar.wsdl" rel="nofollow" target="_blank">http://yourLogin:yourPassword@foo.com/bar.wsdl</a>"</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81791""></a>
  <div class="note">
   <strong class="user">thomas dot rabaix at gmail dot com</strong>
   <a href="#81791" class="date">13-Mar-2008 05:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I have set up a small article which explains how to use SOAP with NTLM authentication.<br />
<br />
<a href="http://tinyurl.com/328rgv (Ghrrr ! the url is too long" rel="nofollow" target="_blank">http://tinyurl.com/328rgv (Ghrrr ! the url is too long</a>) <br />
<br />
Hope it can help you !<br />
<br />
Thomas</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="80394""></a>
  <div class="note">
   <strong class="user">Drydenmaker</strong>
   <a href="#80394" class="date">14-Jan-2008 04:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Working with a third party service I got: "SOAP-ERROR: Parsing Schema: unexpected &lt;text&gt; in restriction"<br />
<br />
Thought it would be worth it to share.&nbsp; What it is saying is that there is some text in an invalid place.&nbsp; C# seems to ignore it, and if you are using nusoap it doesn't notice it either.&nbsp; But what was causing my problem was something like:<br />
&lt;types&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;schema ...<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;simpleType name="some type"&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;restriction base="xsd:string"&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;enumeration value="foo"/&gt;;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;/restriction&gt;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;/simpleType&gt;<br />
<br />
Note the semicolon (;).&nbsp; Filter that out and your good.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="79666""></a>
  <div class="note">
   <strong class="user">Dominik</strong>
   <a href="#79666" class="date">07-Dec-2007 10:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are working<br />
- on localhost <br />
- in WSDL mode <br />
and encounter the following error when you try to connect the soap client with the soap server<br />
<br />
Fatal error: Uncaught SoapFault exception: [HTTP] Could not connect to host... <br />
<br />
then change "localhost" to "127.0.0.1" in your WSDL file:<br />
&lt;soap:address location='<a href="http://127.0.0.1/soap-server.php" rel="nofollow" target="_blank">http://127.0.0.1/soap-server.php</a>'/&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="79642""></a>
  <div class="note">
   <strong class="user">Emanuele Colonnelli</strong>
   <a href="#79642" class="date">06-Dec-2007 02:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hi,<br />
<br />
I'd like to add this trick to get SoapClient correctly running with a WSDD-generated Axis 1 webservice.<br />
<br />
By default, Apache Axis 1 generates a SOAP RPC/Encoded WSDL with "urn:" prefixes before all &lt;SERVICE_NAME&gt; occurrences.<br />
<br />
Axis 1 WSDL also uses an "impl:" namespace prefix.<br />
<br />
Suppose your service's name is "myWS", your WSDL will contains a "&lt;wsdl:binding&gt;" element with the name attribute valued "urn:myWSSoapBinding":<br />
<br />
&lt;wsdl:binding name="myWSSoapBinding"&gt;<br />
<br />
PHP SoapClient has a problem (I hope it will be fixed soon ) parsing this WSDL and generates this error:<br />
<br />
SOAP-ERROR: Parsing WSDL: No&nbsp; element with name 'myWSSoapBinding'<br />
<br />
This error arise because PHP SoapClient could not resolve the "urn:impl:myWSSoapBinding" QName in generated WSDL:<br />
<br />
&lt;wsdl:service name="myWSService"&gt;<br />
&lt;wsdl:port binding="impl:urn:myWSSoapBinding" name="urn:myWS"&gt;<br />
&lt;wsdlsoap:address location="<a href="http://URL/services/urn:myWS" rel="nofollow" target="_blank">http://URL/services/urn:myWS</a>"/&gt;<br />
&lt;/wsdl:port&gt;<br />
&lt;/wsdl:service&gt;<br />
<br />
To solve this problem I parse WSDL applying a preg_replace to delete all "urn:" occurrences.<br />
<br />
Then I save this generated WSDL somewhere in my site and point my SoapClient to this location.<br />
<br />
I also need to specify additional parameters to SoapClient constructor:<br />
<br />
<span class="default">&lt;?php<br />
$soap </span><span class="keyword">= new </span><span class="default">SoapClient</span><span class="keyword">(</span><span class="string">"wsdl/myWS.wsdl"</span><span class="keyword">,<br />
array(&nbsp; &nbsp; <br />
&nbsp; </span><span class="string">"style" </span><span class="keyword">=&gt; </span><span class="default">SOAP_RPC</span><span class="keyword">,<br />
&nbsp; </span><span class="string">"use" </span><span class="keyword">=&gt; </span><span class="default">SOAP_ENCODED</span><span class="keyword">,<br />
&nbsp; </span><span class="string">"soap_version" </span><span class="keyword">=&gt; </span><span class="default">SOAP_1_1</span><span class="keyword">,<br />
&nbsp; </span><span class="string">"uri"</span><span class="keyword">=&gt;</span><span class="string">"urn:myWS"<br />
</span><span class="keyword">));<br />
</span><span class="default">?&gt;<br />
</span><br />
I suggest you this resources to a full understanding of this kind of problems:<br />
<br />
<a href="http://www.ibm.com/developerworks/" rel="nofollow" target="_blank">http://www.ibm.com/developerworks/</a><br />
webservices/library/ws-whichwsdl/<br />
<br />
<a href="http://wso2.org/wiki/display/wsfphp/" rel="nofollow" target="_blank">http://wso2.org/wiki/display/wsfphp/</a><br />
PHP+SOAP+Extension+API+-+Backward+Compatibility<br />
<br />
I hope this save you hours of imprecations! :)<br />
<br />
Emanuele Colonnelli</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="79457""></a>
  <div class="note">
   <strong class="user">AL13N</strong>
   <a href="#79457" class="date">28-Nov-2007 01:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
this might be helpful, as it took quite some time for me to find this out:<br />
<br />
if you're using some .wsdl and there's a sequence that can be there more than once (ie: maxOccurs &gt; 1), you can specify an non-associative array for it if you have more than 1 items OR you could just specify the one item if there is only one:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="string">'items' </span><span class="keyword">=&gt; array(<br />
&nbsp;&nbsp;&nbsp; array(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'itemId' </span><span class="keyword">=&gt; </span><span class="default">5</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'name' </span><span class="keyword">=&gt; </span><span class="string">'some name'</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; ),<br />
&nbsp;&nbsp;&nbsp; array(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'itemId' </span><span class="keyword">=&gt; </span><span class="default">6</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'name' </span><span class="keyword">=&gt; </span><span class="string">'some other name'</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; ),<br />
),<br />
</span><span class="default">?&gt;<br />
</span><br />
this also works:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="string">'items' </span><span class="keyword">=&gt; array(<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'itemId' </span><span class="keyword">=&gt; </span><span class="default">5</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'name' </span><span class="keyword">=&gt; </span><span class="string">'some name'</span><span class="keyword">,<br />
),<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="79421""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#79421" class="date">26-Nov-2007 08:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
when dealing with wsdl and flash soap with php<br />
(not exactly php, but proper wsdl - took me hours to figure it to work properly in flash webservice)<br />
<br />
when naming definitions,<br />
don't use "tns:" but use "typens:"<br />
<br />
makesure your "definitions/targetNamespace"<br />
is same as your "soap:body" namespace<br />
example: "urn:mynamespace"<br />
<br />
makesure your "binding/type" is declared with "typens"<br />
<br />
makesure your service/port/binding is set to 'typens:...'<br />
<br />
if you did not do it properly, you will end up with<br />
WSDL.UnrecognizedNamespace - in flash<br />
but seems okay in php soapclient...<br />
<br />
happy coding :)<br />
hope this help you to save your time on the wsdl :)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="79384""></a>
  <div class="note">
   <strong class="user">james at mercstudio dot com</strong>
   <a href="#79384" class="date">24-Nov-2007 10:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you use wsdl,<br />
<br />
makesure you define the input correctly.<br />
if your method does not contain any input parameter,<br />
you got to makesure that you:<br />
<br />
&nbsp;- do not create the message tag for the input..<br />
&nbsp;- do not put input within porttype / operation<br />
&nbsp;- do not put input within binding / operation <br />
<br />
if not, you will get the error:<br />
[Client] looks like we got no XML<br />
<br />
d***, took me several hours figuring that out...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="79372""></a>
  <div class="note">
   <strong class="user">Dennis Du Krger</strong>
   <a href="#79372" class="date">23-Nov-2007 04:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A word of warning:<br />
<br />
Do NOT use associative arrays or arrays not starting with element number 0...<br />
<br />
Various versions of the soap extension will not send it through properly.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="79351""></a>
  <div class="note">
   <strong class="user">t dot kloppenburg at billiton dot de</strong>
   <a href="#79351" class="date">22-Nov-2007 12:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I had the "DTD are not supported by SOAP" message, too. It helped me to var_dump the complete "SoapFault" exception to find helpful information in a field "["faultstring"]=&gt;....".<br />
<br />
It was an error my soap handler (adding a non existant function).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75899""></a>
  <div class="note">
   <strong class="user">dirk at waferthin dot com</strong>
   <a href="#75899" class="date">21-Jun-2007 01:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I hope this will save someone time. When developing and testing your SOAP server, remember to disable WSDL caching in BOTH client and server:<br />
<br />
$ini = ini_set("soap.wsdl_cache_enabled", 0);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75676""></a>
  <div class="note">
   <strong class="user">jochen dot munz at municons dot com</strong>
   <a href="#75676" class="date">11-Jun-2007 05:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When encountering an error message like this<br />
<br />
[faultstring] =&gt; Function ("yourMethod") is not a valid method for this service<br />
<br />
although it is present in the WSDL etc., be aware that PHP caches the wsdl locally for better performance. You can disable the caching via php.ini/.htaccess completely or remove the cache file (/tmp/wsdl-.. if you are on Linux) to force regeneration of it.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75187""></a>
  <div class="note">
   <strong class="user">Marcio Annunciato</strong>
   <a href="#75187" class="date">17-May-2007 11:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In case your soap response containts an ampersand, in certain cases you might get an "unterminated entity reference" warning and data might appear truncated (related to bug #36795?). Maybe there is a more formal fix or setting, but since I couldn't find anything I came with the following:<br />
<br />
class MySoapClient extends SoapClient {<br />
&nbsp;&nbsp;&nbsp; function __doRequest($request, $location, $action, $version) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $res = parent::__doRequest($request, $location, $action, $version);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $resx = str_replace('&amp;amp;', '&amp;amp;amp;', $res);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; print_r($resx);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return ($resx);<br />
&nbsp;&nbsp;&nbsp; }<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74140""></a>
  <div class="note">
   <strong class="user">albert at jool dot nl</strong>
   <a href="#74140" class="date">27-Mar-2007 11:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A note for ppl who use certificates with SOAP under a Windows config: it seems to be required to give the full path to the certificate file - and don't prepend 'file://' :<br />
<br />
<span class="default">&lt;?php<br />
<br />
$wsdl </span><span class="keyword">= </span><span class="string">"test.wsdl"</span><span class="keyword">;<br />
</span><span class="default">$local_cert </span><span class="keyword">= </span><span class="string">"c:\htdocs\mycert.pem"</span><span class="keyword">;<br />
</span><span class="default">$passphrase </span><span class="keyword">= </span><span class="string">"xyz"</span><span class="keyword">;<br />
<br />
</span><span class="default">$client </span><span class="keyword">= new </span><span class="default">SoapClient</span><span class="keyword">(</span><span class="default">$wsdl</span><span class="keyword">, array(</span><span class="string">'local_cert' </span><span class="keyword">=&gt; </span><span class="default">$local_cert</span><span class="keyword">, </span><span class="string">'passphrase' </span><span class="keyword">=&gt; </span><span class="default">$passphrase</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73116""></a>
  <div class="note">
   <strong class="user">kroesjnov at hotmail dot com</strong>
   <a href="#73116" class="date">09-Feb-2007 04:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you dont want to manually maintain the classmap, make sure you use the same names for your PHP object classes and your WSDL complexTypes, and use the following code:<br />
<br />
$classmap = array();<br />
$tmpClient = new SoapClient("soapserver.wsdl");<br />
&nbsp;&nbsp;&nbsp; <br />
foreach($tmpClient-&gt;__getTypes() as $type)<br />
{<br />
&nbsp;&nbsp;&nbsp; $array = split(" ", $type);<br />
&nbsp;&nbsp;&nbsp; if($array[0] == "struct" &amp;&amp; class_exists($array[1]))<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $classmap[$array[1]] = $array[1];<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
unset($tmpClient);<br />
&nbsp;&nbsp;&nbsp; <br />
$server = new SoapServer("soapserver.wsdl", array("classmap" =&gt; $classmap));<br />
unset($classmap);<br />
$server-&gt;setClass("someclass");<br />
$server-&gt;handle();</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="72436""></a>
  <div class="note">
   <strong class="user">brephophagist</strong>
   <a href="#72436" class="date">18-Jan-2007 06:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For those working from a wsdl full of complex types that just want a class structure to hang your code on and not worry about typing in long parameter lists (or creating a script to do so): wsdl2php is a wonderful time-saver. Gets a structure going so you can go in and add what validation and special data munging you need: <a href="http://www.urdalen.no/wsdl2php/" rel="nofollow" target="_blank">http://www.urdalen.no/wsdl2php/</a><br />
<br />
Big up yourself, Knut.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71306""></a>
  <div class="note">
   <strong class="user">Olaf Krische</strong>
   <a href="#71306" class="date">21-Nov-2006 10:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you use SSL with a cert and password authentication:<br />
<br />
$wsdl = "https://ws.ecopatz.de/ProductInfo?wsdl";<br />
$pass = 'a password';<br />
$certFile = "./mycert.pem";<br />
<br />
&nbsp; $client = new SoapClient($wsdl,<br />
&nbsp;&nbsp;&nbsp; array(<br />
&nbsp;&nbsp; &nbsp; 'local_cert' =&gt; $certFile,<br />
&nbsp;&nbsp; &nbsp; 'passphrase' =&gt; $pass<br />
&nbsp;&nbsp;&nbsp; )<br />
&nbsp; );<br />
<br />
If you have problems with the certfile like this:<br />
<br />
&nbsp; Warning: SoapClient::__construct(): Unable to set local cert chain file `./mycert.pem'; Check that your cafile/capath settings include details of your certificate and its issuer in productinfo.php on line 27<br />
<br />
then the certFile is probably in the "wrong format" (the wrong format for php maybe). It worked for me, when i appended the content of the private key file and the certificate file to a single file "mycert.pem":<br />
<br />
&nbsp; cat mycert.key &gt;mycert.pem # mycert.key was the private key<br />
&nbsp; cat mycert.crt &gt;&gt;mycert.pem # mycert.crt was the signed certificate<br />
<br />
Thanks to an author somewhere, who pointed to "curl --cert", where this little "so unimportant" dependency has been mentioned.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69173""></a>
  <div class="note">
   <strong class="user">nico</strong>
   <a href="#69173" class="date">25-Aug-2006 03:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to build a Soap Server for Microsoft Office's client (like Microsoft Office Research Service) you need to rewrite SOAP's namespaces :<br />
<br />
<span class="default">&lt;?php <br />
</span><span class="comment">// (...)<br />
<br />
</span><span class="default">$server </span><span class="keyword">= new </span><span class="default">SoapServer</span><span class="keyword">(</span><span class="default">$wsdl</span><span class="keyword">, array(</span><span class="string">'uri' </span><span class="keyword">=&gt; </span><span class="default">$uri</span><span class="keyword">, </span><span class="string">'classmap' </span><span class="keyword">=&gt; </span><span class="default">$classmap</span><span class="keyword">));<br />
</span><span class="default">$server</span><span class="keyword">-&gt;</span><span class="default">setClass</span><span class="keyword">(</span><span class="default">$class</span><span class="keyword">);<br />
function </span><span class="default">callback</span><span class="keyword">(</span><span class="default">$buffer</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$s </span><span class="keyword">= array(</span><span class="string">'&lt;ns1:RegistrationResponse&gt;'</span><span class="keyword">, </span><span class="string">'ns1:'</span><span class="keyword">, </span><span class="string">'xmlns:ns1="urn:Microsoft.Search"'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$r </span><span class="keyword">= array(</span><span class="string">'&lt;RegistrationResponse xmlns="urn:Microsoft.Search"&gt;'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">);<br />
&nbsp;&nbsp; return (</span><span class="default">str_replace</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">, </span><span class="default">$r</span><span class="keyword">, </span><span class="default">$buffer</span><span class="keyword">));<br />
}<br />
</span><span class="default">ob_start</span><span class="keyword">(</span><span class="string">'callback'</span><span class="keyword">);<br />
</span><span class="default">$server</span><span class="keyword">-&gt;</span><span class="default">handle</span><span class="keyword">();<br />
</span><span class="default">ob_end_flush</span><span class="keyword">();<br />
<br />
</span><span class="comment">// (...)<br />
</span><span class="default">?&gt;<br />
</span><br />
There are a complete example at this URL : <a href="http://touv.ouvaton.org/article.php3?id_article=104" rel="nofollow" target="_blank">http://touv.ouvaton.org/article.php3?id_article=104</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="69090""></a>
  <div class="note">
   <strong class="user">info at webability dot info</strong>
   <a href="#69090" class="date">22-Aug-2006 09:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to use soap over https, you *must* compile php with the configure option with-openssl or you will have the error "[HTTP] SSL support not available in this build" while trying to use the web services over SSL</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="67991""></a>
  <div class="note">
   <strong class="user">mini at freebsd dot org</strong>
   <a href="#67991" class="date">09-Jul-2006 01:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
wokan at cox dot net is incorrect about the security of URI-passed values to HTTPS URIs.&nbsp; HTTPS connections are HTTP inside SSL -- all of the HTTP traffic, including the request, are encrypted.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="63124""></a>
  <div class="note">
   <strong class="user">lists at 5etdemi dot com</strong>
   <a href="#63124" class="date">14-Mar-2006 03:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To enable SoapClient on Windows, simply add a line:<br />
<br />
extension=php_soap.dll<br />
<br />
in php.ini in the extensions section.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="62490""></a>
  <div class="note">
   <strong class="user">adm</strong>
   <a href="#62490" class="date">01-Mar-2006 08:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Wondering why the function you just added to your WSDL file is not available to your SOAP client? Turn off WSDL caching, which (as the documentation says) is on by default.<br />
<br />
At the top of your script, use: <br />
<br />
$ini = ini_set("soap.wsdl_cache_enabled","0");</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="60935""></a>
  <div class="note">
   <strong class="user">Matthew Glubb</strong>
   <a href="#60935" class="date">20-Jan-2006 05:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For anyone wondering why they are getting a "DTD are not supported by SOAP" fault string. It is because you are probably being returned an HTML page due to an internal server error, 404, etc.<br />
<br />
Refer to the documentation for SoapClient-&gt;__getLastResponse in order to see what returned by the server.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="60803""></a>
  <div class="note">
   <strong class="user">ckl at ecw dot de</strong>
   <a href="#60803" class="date">17-Jan-2006 08:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To debug a SOAP service using SoapServer(), a WSDL file and Zend Studio Client/Server, you have to append ?start_debug=1&amp;amp;debug_port=10000 to the service location:<br />
--- snip ---<br />
... method / service definition ....<br />
<br />
&lt;service name="SOAPService"&gt;<br />
&nbsp; &lt;port <br />
&nbsp;&nbsp;&nbsp; name="SOAPServicePort"<br />
&nbsp;&nbsp;&nbsp; binding="typens:SOAPServiceBinding"&gt;<br />
&nbsp;&nbsp; &lt;soap:address<br />
&nbsp;&nbsp; location="$URL?start_debug=1&amp;amp;debug_port=10000"/&gt;<br />
&nbsp; &lt;/port&gt;<br />
&lt;/service&gt;<br />
--- snap ---</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="59860""></a>
  <div class="note">
   <strong class="user">Rui Martins</strong>
   <a href="#59860" class="date">18-Dec-2005 05:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's an example on how to pass ArrayOfAnyType arguments
<br />
containing complex types.
<br />

<br />
Suppose your WSDL file defines "<a href="http://any.url.com/" rel="nofollow" target="_blank">http://any.url.com/</a>" as the default namespace and a complex type "SomeComplexType".
<br />

<br />
If you want to call a WebServices which takes an ArrayOfAnyType argument of "SomeComplexType"s you need to perform the following:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="comment">// complexTypes being an array containing several instances of SomeComplexType
<br />

<br />
</span><span class="default">myWSParameter </span><span class="keyword">= array();
<br />
foreach (</span><span class="default">complexTypes </span><span class="keyword">as </span><span class="default">ct</span><span class="keyword">)
<br />
{
<br />
&nbsp;&nbsp; </span><span class="comment">// Don't misspell the type or the namespace. Also note that php won't assume the default namespace defined in the WSDL file.
<br />
&nbsp;&nbsp; </span><span class="default">myWSParameter </span><span class="keyword">[]= new </span><span class="default">SoapVar</span><span class="keyword">(</span><span class="default">ct</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="string">"SomeComplexType"</span><span class="keyword">, </span><span class="string">"<a href="http://any.url.com/" rel="nofollow" target="_blank">http://any.url.com/</a>"</span><span class="keyword">); 
<br />
}
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
On the other hand, when a WebService returns an ArrayOfAnyType you have to do the following to access each of its elements.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="comment">// Here, we will be echoing each return item
<br />
</span><span class="default">$res </span><span class="keyword">= </span><span class="default">$someWS</span><span class="keyword">-&gt;</span><span class="default">myFunction</span><span class="keyword">(</span><span class="default">$myArgs</span><span class="keyword">)
<br />

<br />
</span><span class="comment">// If only one element is returned, an array won't be built
<br />
</span><span class="keyword">if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">myFunctionResult</span><span class="keyword">-&gt;</span><span class="default">anyType</span><span class="keyword">))
<br />
{
<br />
&nbsp;&nbsp; foreach (</span><span class="default">myFunctionResult</span><span class="keyword">-&gt;</span><span class="default">anyType </span><span class="keyword">as </span><span class="default">$soapVar</span><span class="keyword">)
<br />
&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp;&nbsp; echo </span><span class="default">$soapVar</span><span class="keyword">-&gt;</span><span class="default">enc_value</span><span class="keyword">;
<br />
&nbsp;&nbsp; }
<br />
}
<br />
else
<br />
{
<br />
&nbsp;&nbsp; echo </span><span class="default">myFunctionResult</span><span class="keyword">-&gt;</span><span class="default">anyType</span><span class="keyword">-&gt;</span><span class="default">enc_value</span><span class="keyword">;
<br />
}
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
This has all been tested using a .NET WebService.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="58090""></a>
  <div class="note">
   <strong class="user">ChrisB</strong>
   <a href="#58090" class="date">24-Oct-2005 08:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Heads up for anyone using PHP Soap + Sessions + PEAR DB classes.<br />
<br />
Every time you make a call, via the soap client to your web service, your PEAR DB session is put to sleep and it doesnt by default wake upon the next request.<br />
<br />
To fix this I simply called my particular database close call ifx_close() below my $soap-&gt;handle();</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="57702""></a>
  <div class="note">
   <strong class="user">Bob</strong>
   <a href="#57702" class="date">11-Oct-2005 10:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are scratching your head why NuSOAP not working on PHP 5.x , the reason is this built-in SOAP Extenstion uses same soapclient() class name as Nusoap. <br />
<br />
replace 'soapclient' with 'soapclient_xxx'&nbsp; in nusoap.php and you are good to go...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="57065""></a>
  <div class="note">
   <strong class="user">johnjawed at gmail dot com</strong>
   <a href="#57065" class="date">22-Sep-2005 06:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For those wondering on how to set attributes on nodes with PHP5 SOAP, it would be done as such:<br />
<br />
&lt;... soap env/header&gt;<br />
&lt;foo bar="blah"&gt;12345&lt;/foo&gt;<br />
<br />
array("foo" =&gt; array("_" =&gt; 12345, "bar" =&gt; "blah"));</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="54955""></a>
  <div class="note">
   <strong class="user">Darryl</strong>
   <a href="#54955" class="date">20-Jul-2005 08:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Having trouble passing complex types over SOAP using a PHP SoapServer in WSDL mode?&nbsp; Not getting decoded properly?&nbsp; This may be the solution you're looking for!<br />
<br />
When using ComplexType in the schema portion of the WSDL file, You need use an additional step to tell PHP SOAP how to encode the objects.&nbsp; The first method would be to explicitely encapsulate the object in a SoapVar object - telling PHP to use generalized SOAP encoding rules (which encodes all ComplexTypes as Structs).&nbsp; This won't work, though, if the client is expecting the objects to be encoded according to the WSDL's schema.&nbsp; So, The actual way to do this is:<br />
<br />
* First, define a specific PHP class which is actually just a data structure holding the various properties, and the appropriate&nbsp; ComplexType in the WSDL.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;</span><span class="keyword">class </span><span class="default">MyComplexDataType </span><span class="keyword">{<br />
&nbsp;&nbsp; &nbsp; public </span><span class="default">$myProperty1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; public </span><span class="default">$myProperty2</span><span class="keyword">;<br />
&nbsp;}<br />
</span><span class="default">?&gt;<br />
</span> &lt;complexType name="MyWSDLStructure"&gt;<br />
&nbsp;&lt;sequence&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;element name="MyProperty1" type="xsd:integer"/&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;element name="MyProperty2" type="xsd:string"/&gt;<br />
&nbsp;&lt;/sequence&gt;<br />
&nbsp;&lt;/complexType&gt;<br />
<br />
* Next, Tell the SoapServer when you initialize it to map these two structures together.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;$classmap </span><span class="keyword">= array(</span><span class="string">'MyWSDLStructure' </span><span class="keyword">=&gt; </span><span class="string">'MyComplexDataType'</span><span class="keyword">);<br />
&nbsp;</span><span class="default">$server </span><span class="keyword">= new </span><span class="default">SoapServer</span><span class="keyword">(</span><span class="string">"<a href="http://MyServer/MyService.wsdl" rel="nofollow" target="_blank">http://MyServer/MyService.wsdl</a>"</span><span class="keyword">, array(</span><span class="string">'classmap' </span><span class="keyword">=&gt; </span><span class="default">$classmap</span><span class="keyword">))<br />
</span><span class="default">?&gt;<br />
</span><br />
* Finally, have your method return an instance of your class directly, and let the SoapServer take care of encoding!<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;</span><span class="keyword">public function </span><span class="default">MySoapCall</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$o </span><span class="keyword">= new </span><span class="default">MyComplexDataType</span><span class="keyword">();<br />
&nbsp;<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$o</span><span class="keyword">-&gt;</span><span class="default">myProperty1 </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; </span><span class="default">$o</span><span class="keyword">-&gt;</span><span class="default">myProperty2 </span><span class="keyword">= </span><span class="string">"MyString"</span><span class="keyword">;<br />
&nbsp;<br />
&nbsp;&nbsp; &nbsp; return </span><span class="default">$o<br />
&nbsp;</span><span class="keyword">}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="54691""></a>
  <div class="note">
   <strong class="user">Jim Plush</strong>
   <a href="#54691" class="date">13-Jul-2005 01:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you're trying to use the SOAP Extension over SSL with a custom PEM file you need to do this:<br />
<br />
$client-&gt;_local_cert = "C:\\path\myCert.pem";</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="52931""></a>
  <div class="note">
   <strong class="user">pash_ka</strong>
   <a href="#52931" class="date">18-May-2005 09:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
One good tutorial on using this extension is on IBM web site:<br />
"Using the PHP 5 SOAP extension to consume a WebSphere Web service"<br />
<a href="http://www.ibm.com /developerworks/library/os-phpws/?ca=dgr-lnxw06PHP5soap" rel="nofollow" target="_blank">http://www.ibm.com /developerworks/library/os-phpws/?ca=dgr-lnxw06PHP5soap</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="52758""></a>
  <div class="note">
   <strong class="user">flobee at gmail dot com</strong>
   <a href="#52758" class="date">11-May-2005 10:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
wow, actually a cool program and soap is new for me.<br />
I found out some interessting things i can not debug because the scripts exit without any error messages or notes. :-(<br />
<br />
you may have problems with the memory and/or especially on "shared servers" when server load is high. <br />
sometimes the script does the job, sometimes it just stopping at any unknown point.<br />
these are the steps my script does:<br />
* get data from remote server ( ~ 4.5 MB)<br />
* parsing requested object and store the data in a database.<br />
<br />
the return with debug messages was intressting:<br />
-&gt; check Mem limit: 30M<br />
-&gt; $client = new new SoapClient($url_wsdl, $options);<br />
-&gt; Memory usage: 185888<br />
-&gt; $client-&gt;[requested_method_to_get_data]();<br />
-&gt; check: __getLastResponseHeaders() - after:<br />
-&gt; HTTP/1.1 200 OK // remote server is fine with me :-)<br />
-&gt; Content-Length: 4586742&nbsp; // I got the data<br />
-&gt; check: Memory usage now: 23098872 // ups !!! this can't be true!!<br />
<br />
so, and if now someone on the server takes the rest of RAM&nbsp; the walk thought the data breaks :-(<br />
<br />
so, i need to store the xml tree ($client-&gt;client-&gt;__last_response) and parsing it by the classical way. (if you would request more RAM, you may get in trouble with the admin if you run a script like this more often! (on shared servers)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="52004""></a>
  <div class="note">
   <strong class="user">OrionI</strong>
   <a href="#52004" class="date">18-Apr-2005 05:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you're having problems calling a .NET web service, see the comments over on <a href="http://php.net/soap_soapclient_soapcall (the __soapCall method" rel="nofollow" target="_blank">http://php.net/soap_soapclient_soapcall (the __soapCall method</a>).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="51283""></a>
  <div class="note">
   <strong class="user">kucerar at hhmi dot org</strong>
   <a href="#51283" class="date">25-Mar-2005 09:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here are 73 test cases that detail the kinds of schemas that PHP5 currently supports and the structures you are expected to plug into them for the return value from your services.&nbsp;&nbsp; Much better than trying to guess!<br />
<br />
<a href="http://cvs.php.net/co.php/pecl/soap/tests/schema" rel="nofollow" target="_blank">http://cvs.php.net/co.php/pecl/soap/tests/schema</a><br />
<br />
You can cycle through the listings by changing the main index in the URL below,&nbsp; rather than go in and out of the pages<br />
<br />
<a href="http://cvs.php.net/co.php/pecl/soap/tests/schema/schema052.phpt?r=1.2" rel="nofollow" target="_blank">http://cvs.php.net/co.php/pecl/soap/tests/schema/schema052.phpt?r=1.2</a><br />
<br />
I downloaded the whole thing with this,&nbsp; CVS might work too.<br />
<a href="http://www.httrack.com/" rel="nofollow" target="_blank">http://www.httrack.com/</a><br />
<br />
With them all downloaded I just browse them with Textpad.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="50210""></a>
  <div class="note">
   <strong class="user">Norman Clarke &lt;norman at dontblink dot com&gt;</strong>
   <a href="#50210" class="date">22-Feb-2005 01:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that if you should need to set the timeout for your soap request,&nbsp; you can use ini_set to change the value for the default_socket_timeout. I previously used NuSOAP, whose soap client class has a timeout option, and it took me a while to figure out that PHP's soap uses the same socket options as everything else.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="49710""></a>
  <div class="note">
   <strong class="user">wokan at cox dot net</strong>
   <a href="#49710" class="date">06-Feb-2005 02:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It's not good security practice to pass the username and password in the URI when the point of SSL is to prevent that information from being intercepted.&nbsp; Putting that information in the URI makes it interceptable.&nbsp; HTTPS-Posted values are safe because values passed in the headers are sent after the SSL handshake has been completed.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="41068""></a>
  <div class="note">
   <strong class="user">mikx at mikx dot de</strong>
   <a href="#41068" class="date">29-Mar-2004 05:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It took me a while to properly establish a password protected client connection via https on windows/apache1.3. Here my little guide:<br />
<br />
1. The SOAP extension isn't activated by default (PHP5 RC1). Just add "extension=php_soap.dll" to the php.ini and don't forget to set the extension_dir properly (in most cases "c:\php\ext").<br />
<br />
2. Add "extension=php_openssl.dll" to the php.ini. This module depends on libeay32.dll and ssleay32.dll - copy them from your php folder to your system32 folder.<br />
<br />
3. Restart apache <br />
<br />
4. The sourcecode<br />
<br />
$client = new SoapClient("https://yourLogin:yourPassword@foo.com/bar.wsdl", array(<br />
&nbsp;&nbsp;&nbsp; "login"&nbsp; &nbsp; &nbsp; =&gt; "yourLogin", <br />
&nbsp;&nbsp;&nbsp; "password"&nbsp;&nbsp; =&gt; "yourPassword",<br />
&nbsp;&nbsp;&nbsp; "trace"&nbsp; &nbsp; &nbsp; =&gt; 1, <br />
&nbsp;&nbsp;&nbsp; "exceptions" =&gt; 0)); <br />
<br />
$client-&gt;yourFunction();<br />
<br />
print "&lt;pre&gt;\n"; <br />
print "Request: \n".htmlspecialchars($client-&gt;__getLastRequest()) ."\n"; <br />
print "Response: \n".htmlspecialchars($client-&gt;__getLastResponse())."\n"; <br />
print "&lt;/pre&gt;"; <br />
<br />
Currently it seems to be necessary to add your login and password both in the uri and in the options array. Not sure if this is the expected behavior.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
