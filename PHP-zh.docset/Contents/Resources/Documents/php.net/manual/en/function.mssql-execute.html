<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>Executes a stored procedure on a MS SQL server database</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.mssql-data-seek.html">? mssql_data_seek</a></li>
      <li style="float: right;"><a href="function.mssql-fetch-array.html">mssql_fetch_array ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.mssql.html">Mssql 函数</a></li>
    <li>Executes a stored procedure on a MS SQL server database</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.mssql-execute" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">mssql_execute</h1>
  <p class="verinfo">(PHP 4 &gt;= 4.0.7, PHP 5, PECL odbtp &gt;= 1.1.1)</p><p class="refpurpose"><span class="refname">mssql_execute</span> &mdash; <span class="dc-title">Executes a stored procedure on a MS SQL server database</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.mssql-execute-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type"><a href="language.pseudo-types.html#language.types.mixed" class="type mixed">mixed</a></span> <span class="methodname"><strong>mssql_execute</strong></span>
    ( <span class="methodparam"><span class="type">resource</span> <code class="parameter">$stmt</code></span>
   [, <span class="methodparam"><span class="type">bool</span> <code class="parameter">$skip_results</code><span class="initializer"> = false</span></span>
  ] )</div>

  <p class="para rdfs-comment">
   Executes a stored procedure on a MS SQL server database
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.mssql-execute-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">stmt</code></dt>

     <dd>

      <p class="para">
       Statement handle obtained with <span class="function"><a href="function.mssql-init.html" class="function">mssql_init()</a></span>. 
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">skip_results</code></dt>

     <dd>

      <p class="para">
       Whenever to skip the results or not.
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.mssql-execute-examples">
  <h3 class="title">范例</h3>
  <p class="para">
   <div class="example" id="example-1565">
    <p><strong>Example #1 <span class="function"><strong>mssql_execute()</strong></span> example</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;Create&nbsp;a&nbsp;new&nbsp;statement<br /></span><span style="color: #0000BB">$stmt&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mssql_init</span><span style="color: #007700">(</span><span style="color: #DD0000">'NewBlogEntry'</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;Some&nbsp;data&nbsp;strings<br /></span><span style="color: #0000BB">$title&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'Test&nbsp;of&nbsp;blogging&nbsp;system'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$content&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'If&nbsp;you&nbsp;can&nbsp;read&nbsp;this,&nbsp;then&nbsp;the&nbsp;new&nbsp;system&nbsp;is&nbsp;compatible&nbsp;with&nbsp;MSSQL'</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//&nbsp;Bind&nbsp;values<br /></span><span style="color: #0000BB">mssql_bind</span><span style="color: #007700">(</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'@author'</span><span style="color: #007700">,&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'Felipe&nbsp;Pena'</span><span style="color: #007700">,&nbsp;&nbsp;</span><span style="color: #0000BB">SQLVARCHAR</span><span style="color: #007700">,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">,&nbsp;&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">,&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">60</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">mssql_bind</span><span style="color: #007700">(</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'@date'</span><span style="color: #007700">,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'08/10/2008'</span><span style="color: #007700">,&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">SQLVARCHAR</span><span style="color: #007700">,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">,&nbsp;&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">,&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">20</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">mssql_bind</span><span style="color: #007700">(</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'@title'</span><span style="color: #007700">,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$title</span><span style="color: #007700">,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">SQLVARCHAR</span><span style="color: #007700">,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">,&nbsp;&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">,&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">60</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">mssql_bind</span><span style="color: #007700">(</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'@content'</span><span style="color: #007700">,&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$content</span><span style="color: #007700">,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">SQLTEXT</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;Execute&nbsp;the&nbsp;statement<br /></span><span style="color: #0000BB">mssql_execute</span><span style="color: #007700">(</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;And&nbsp;we&nbsp;can&nbsp;free&nbsp;it&nbsp;like&nbsp;so:<br /></span><span style="color: #0000BB">mssql_free_statement</span><span style="color: #007700">(</span><span style="color: #0000BB">$stmt</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 notes" id="refsect1-function.mssql-execute-notes">
  <h3 class="title">注释</h3>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    If the stored procedure returns parameters or a return value these will
    be available after the call to <span class="function"><strong>mssql_execute()</strong></span> unless
    the stored procedure returns more than one result set. In that case
    use <span class="function"><a href="function.mssql-next-result.html" class="function">mssql_next_result()</a></span> to shift through the results.
    When the last result has been processed the output parameters and return
    values will be available.
   </p>
  </p></blockquote>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.mssql-execute-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.mssql-bind.html" class="function" rel="rdfs-seeAlso">mssql_bind()</a> - Adds a parameter to a stored procedure or a remote stored procedure</span></li>
    <li class="member"><span class="function"><a href="function.mssql-free-statement.html" class="function" rel="rdfs-seeAlso">mssql_free_statement()</a> - Free statement memory</span></li>
    <li class="member"><span class="function"><a href="function.mssql-init.html" class="function" rel="rdfs-seeAlso">mssql_init()</a> - Initializes a stored procedure or a remote stored procedure</span></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="110234""></a>
  <div class="note">
   <strong class="user">wl</strong>
   <a href="#110234" class="date">04-Oct-2012 06:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Interesting little quirk I noticed:<br />
<br />
You can't initialize, execute, and free stored procedures in a nested fashion. e.g this pattern:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; $statement1 </span><span class="keyword">= </span><span class="default">mssql_init</span><span class="keyword">(</span><span class="string">'statement1'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//some binds and stuff<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$statement2 </span><span class="keyword">= </span><span class="default">mssql_init</span><span class="keyword">(</span><span class="string">'statement2'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//some binds and stuff<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">mssql_execute</span><span class="keyword">(</span><span class="default">$statement2</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">mssql_free_statement</span><span class="keyword">(</span><span class="default">$statement2</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">mssql_execute</span><span class="keyword">(</span><span class="default">$statement1</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
will fail when you execute statement 2.&nbsp; Not only will it fail, but you won't get any results back from mssql_get_last_message(), so it's super-frustrating. The way around this is to rearrange the structure of your script so that stored procedures are executed sequentially.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="109326""></a>
  <div class="note">
   <strong class="user">skari</strong>
   <a href="#109326" class="date">06-Jul-2012 11:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
want to share with you that I had a hard time with mssql_execute on a platform that was running php using FastCGI. Well, I guess the problem was that mssql_init always returned null. So after investigating this, and plus the fact that I don't have total control over the platform, I gave up and used mssql_query instead.
<br />

<br />
Using the function below, it is possible to generate most stored procedure calls, with the added benefits that one doesn't have to worry to much about datatype mappings, and that the funtion return exception codes and error message. So here goes:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">_mssql_exec_sp</span><span class="keyword">(</span><span class="default">$storedproc</span><span class="keyword">,</span><span class="default">$params</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$varlist </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$setlist </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$parmlist </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$outs </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$params </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$quote </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">],</span><span class="string">'char'</span><span class="keyword">)!==</span><span class="default">false</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$varlist </span><span class="keyword">.= </span><span class="string">"@</span><span class="default">$key</span><span class="string"> "</span><span class="keyword">.</span><span class="default">$value</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">].</span><span class="string">",\\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (isset(</span><span class="default">$value</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">])) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$setlist </span><span class="keyword">.= </span><span class="string">"set @"</span><span class="keyword">.</span><span class="default">$key</span><span class="keyword">.</span><span class="string">"="</span><span class="keyword">.(</span><span class="default">$quote</span><span class="keyword">?</span><span class="string">"'"</span><span class="keyword">:</span><span class="string">''</span><span class="keyword">).</span><span class="default">$value</span><span class="keyword">[</span><span class="string">'value'</span><span class="keyword">].(</span><span class="default">$quote</span><span class="keyword">?</span><span class="string">"'\\n"</span><span class="keyword">:</span><span class="string">"\\n"</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$paramlist </span><span class="keyword">.= </span><span class="string">" @"</span><span class="keyword">.</span><span class="default">$key</span><span class="keyword">.(isset(</span><span class="default">$value</span><span class="keyword">[</span><span class="string">'out'</span><span class="keyword">])?</span><span class="string">' output,'</span><span class="keyword">:</span><span class="string">','</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (isset(</span><span class="default">$value</span><span class="keyword">[</span><span class="string">'out'</span><span class="keyword">])) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$outs </span><span class="keyword">.= </span><span class="string">"@</span><span class="default">$key</span><span class="string"> as </span><span class="default">$key</span><span class="string">,"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$paramlist</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$paramlist </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$paramlist</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$paramlist</span><span class="keyword">)-</span><span class="default">1</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$stmt </span><span class="keyword">= </span><span class="string">"begin try\\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$stmt </span><span class="keyword">.= </span><span class="string">"declare\\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$stmt </span><span class="keyword">.= </span><span class="string">"@ret int"</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$varlist</span><span class="keyword">)) { 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$stmt </span><span class="keyword">.= </span><span class="string">",\\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$stmt </span><span class="keyword">.= </span><span class="default">$varlist</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$stmt </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$stmt</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$stmt</span><span class="keyword">)-</span><span class="default">2</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; else {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$stmt </span><span class="keyword">.= </span><span class="string">"\\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$outs </span><span class="keyword">= </span><span class="string">"@ret as ret,"</span><span class="keyword">.</span><span class="default">$outs</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$outs </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$outs</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$outs</span><span class="keyword">)-</span><span class="default">1</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$stmt </span><span class="keyword">.= </span><span class="string">"\\n"</span><span class="keyword">.</span><span class="default">$setlist</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$stmt </span><span class="keyword">.= </span><span class="string">"exec @ret = "</span><span class="keyword">.</span><span class="default">$storedproc</span><span class="keyword">.</span><span class="default">$paramlist</span><span class="keyword">.</span><span class="string">"\\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$stmt </span><span class="keyword">.= </span><span class="string">"select "</span><span class="keyword">.</span><span class="default">$outs</span><span class="keyword">.</span><span class="string">"\\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$stmt </span><span class="keyword">.= </span><span class="string">"end try\\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$stmt </span><span class="keyword">.= </span><span class="string">"begin catch\\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$stmt </span><span class="keyword">.= </span><span class="string">"select error_number() as ret,error_message() as errorMsg\\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$stmt </span><span class="keyword">.= </span><span class="string">"end catch\\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">mssql_query</span><span class="keyword">(</span><span class="default">$stmt</span><span class="keyword">);
<br />
} 
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
example call:
<br />

<br />
<span class="default">&lt;?php
<br />
&nbsp;&nbsp; &nbsp;&nbsp; $params </span><span class="keyword">= array(
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'socialid' </span><span class="keyword">=&gt; array(
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'type' </span><span class="keyword">=&gt; </span><span class="string">'char(10)'</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'value' </span><span class="keyword">=&gt; </span><span class="default">$sid
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">),
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'cust_name' </span><span class="keyword">=&gt; array(
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'type' </span><span class="keyword">=&gt; </span><span class="string">'varchar(20)'</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'value' </span><span class="keyword">=&gt; </span><span class="string">'our name'
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">),
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'id' </span><span class="keyword">=&gt; array(
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'type' </span><span class="keyword">=&gt; </span><span class="string">'int'</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'out' </span><span class="keyword">=&gt; </span><span class="default">true
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">),
<br />

<br />
&nbsp;&nbsp;&nbsp; );
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$result </span><span class="keyword">= </span><span class="default">_mssql_exec_sp</span><span class="keyword">(</span><span class="string">'sp_register_cust'</span><span class="keyword">, </span><span class="default">$params</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$row </span><span class="keyword">= </span><span class="default">mssql_fetch_array</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">);
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="107084""></a>
  <div class="note">
   <strong class="user">whitep0wer at gmail dot com</strong>
   <a href="#107084" class="date">05-Jan-2012 08:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When calling a stored procedure which is using OUTPUT parameters, be sure not to pass them as NULL in mssql_bind. If you do this, the data received in output gets truncated to one character.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="106257""></a>
  <div class="note">
   <strong class="user">AgusQuiroga</strong>
   <a href="#106257" class="date">21-Oct-2011 11:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
SUBJECT: No OUTPUT parameter recieved on store procedure call.<br />
<br />
If you call a store procedure who binds data to an OUTPUT parameter on a SQL Server 7 or later no response will be produced, or an error perhaps.<br />
<br />
From the Free TDS documentation:<br />
<br />
Output Parameters<br />
<br />
I'm not getting my output parameters returned, but I seem to be doing everything right!<br />
<br />
That's not a question!<br />
<br />
Microsoft SQL Server 7 with SP3, and later versions, quietly changed (which is to say, broke) how they respond to queries that execute stored procedures with output parameters. Earlier servers let you send a query like EXECUTE A @P OUTPUT and fetch the output parameter as a special result row (technique varying by library). Newer servers simply don't send back that data. To elicit output parameters from them, you have to use the RPC protocols such as the DB-Library dbrpcparam.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="105904""></a>
  <div class="note">
   <strong class="user">ian_channing at hotmail dot com</strong>
   <a href="#105904" class="date">24-Sep-2011 04:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Output parameters are cryptic to get out. Here's two examples, one if you have no results returned from your stored procedure, one if you do have results returned:
<br />
<span class="default">&lt;?php 
<br />
</span><span class="comment">/**
<br />
&nbsp;* using OUTPUT param with no results returned from stored procedure 
<br />
&nbsp;*/
<br />
</span><span class="default">$outParamValue </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br />
</span><span class="default">mssql_bind</span><span class="keyword">(</span><span class="default">$stmt</span><span class="keyword">, </span><span class="string">'@'</span><span class="keyword">.</span><span class="default">$outParamName</span><span class="keyword">, </span><span class="default">$outParamValue</span><span class="keyword">, </span><span class="default">$outParamType</span><span class="keyword">, </span><span class="default">$is_output </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">);
<br />
</span><span class="default">mssql_execute</span><span class="keyword">(</span><span class="default">$stmt</span><span class="keyword">, </span><span class="default">$skip_results </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">); 
<br />
</span><span class="comment">/* N.B. If you don't use $skip_results = true you must use mssql_next_result as below **even if there are no results returned from the stored procedure** */
<br />
</span><span class="keyword">echo(</span><span class="default">$outParamValue</span><span class="keyword">);
<br />

<br />
</span><span class="comment">/**
<br />
&nbsp;* using OUTPUT param with one result set returned from stored procedure
<br />
&nbsp;*/
<br />
</span><span class="default">$outParamValue </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br />
</span><span class="default">mssql_bind</span><span class="keyword">(</span><span class="default">$stmt</span><span class="keyword">, </span><span class="string">'@'</span><span class="keyword">.</span><span class="default">$outParamName</span><span class="keyword">, </span><span class="default">$outParamValue</span><span class="keyword">, </span><span class="default">$outParamType</span><span class="keyword">, </span><span class="default">$is_output </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">);
<br />
</span><span class="default">$result </span><span class="keyword">= </span><span class="default">mssql_execute</span><span class="keyword">(</span><span class="default">$stmt</span><span class="keyword">);
<br />
echo(</span><span class="default">$outParamValue</span><span class="keyword">); </span><span class="comment">/* will still be 0 */
<br />
</span><span class="default">mssql_next_result</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">); </span><span class="comment">/* N.B. see the Note above about this */
<br />
</span><span class="keyword">echo(</span><span class="default">$outParamValue</span><span class="keyword">); </span><span class="comment">/* correct output */
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93938""></a>
  <div class="note">
   <strong class="user">berk0081 at umn dot edu</strong>
   <a href="#93938" class="date">07-Oct-2009 06:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Regarding the "stored procedure execution failed" errors mentioned in previous posts -- in addition to using the data source name as defined in freetds.conf under Linux, you may encounter this error when attempting to call a stored procedure&nbsp; after running a standard query with mssql_query()<br />
<br />
Call mssql_free_result() before executing the stored procedure with mssql_execute() to clear this up.<br />
<br />
<span class="default">&lt;?php<br />
$conn </span><span class="keyword">= </span><span class="default">mssql_connect</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">, </span><span class="default">$user</span><span class="keyword">, </span><span class="default">$pass</span><span class="keyword">);<br />
</span><span class="default">mssql_select_db</span><span class="keyword">(</span><span class="string">'somedb'</span><span class="keyword">, </span><span class="default">$conn</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Call a simple query<br />
</span><span class="default">$result </span><span class="keyword">= </span><span class="default">mssql_query</span><span class="keyword">(</span><span class="string">'SELECT * FROM sometable'</span><span class="keyword">, </span><span class="default">$conn</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Release the result resource<br />
</span><span class="default">mssql_free_result</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Then execute the procedure<br />
</span><span class="default">$proc </span><span class="keyword">= </span><span class="default">mssql_init</span><span class="keyword">(</span><span class="string">'some_proc'</span><span class="keyword">, </span><span class="default">$conn</span><span class="keyword">);<br />
</span><span class="default">$proc_result </span><span class="keyword">= </span><span class="default">mssql_execute</span><span class="keyword">(</span><span class="default">$proc</span><span class="keyword">);<br />
<br />
</span><span class="comment">// Etc...<br />
</span><span class="default">mssql_free_statement</span><span class="keyword">(</span><span class="default">$proc</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83379""></a>
  <div class="note">
   <strong class="user">geoff at spacevs dot com</strong>
   <a href="#83379" class="date">23-May-2008 06:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In reply to: mark dot vanrossum at bris dot ac dot uk<br />
<br />
A much simpler solution that allows you to keep the config in the PHP script is to force the TDS version by using putenv before you connect.<br />
<br />
<span class="default">&lt;?PHP<br />
&nbsp; putenv</span><span class="keyword">(</span><span class="string">'TDSVER'</span><span class="keyword">, </span><span class="string">'8.0'</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$dbc </span><span class="keyword">= </span><span class="default">mssql_connect</span><span class="keyword">(</span><span class="string">'123.123.123.123:1433'</span><span class="keyword">, </span><span class="string">'user'</span><span class="keyword">, </span><span class="string">'pass'</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76855""></a>
  <div class="note">
   <strong class="user">Anton Schattenfeld</strong>
   <a href="#76855" class="date">02-Aug-2007 04:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To get info about table structure you can use such a query:<br />
<br />
SELECT<br />
&nbsp; column_name,<br />
&nbsp; data_type,<br />
&nbsp; character_maximum_length,<br />
&nbsp; numeric_precision,<br />
&nbsp; column_default,<br />
&nbsp; is_nullable<br />
FROM<br />
&nbsp; information_schema.tables t <br />
&nbsp; INNER JOIN<br />
&nbsp; information_schema.columns c <br />
&nbsp; ON <br />
&nbsp;&nbsp;&nbsp; t.table_catalog = c.table_catalog AND <br />
&nbsp;&nbsp;&nbsp; t.table_schema = c.table_schema AND <br />
&nbsp;&nbsp;&nbsp; t.table_name = c.table_name<br />
WHERE&nbsp; &nbsp;&nbsp; <br />
&nbsp; (c.table_name = 'TABLE_NAME')</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76157""></a>
  <div class="note">
   <strong class="user">mark dot vanrossum at bris dot ac dot uk</strong>
   <a href="#76157" class="date">03-Jul-2007 02:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I was pulling my hair out getting the error:<br />
&nbsp; "stored procedure execution failed"<br />
when trying to run mssql_execute but you could run:<br />
&nbsp; $results = mssql_query('sp_test'); <br />
fine.<br />
<br />
I was connecting using the string:<br />
&nbsp; $dbserver="xxx.xxx.xxx.xxx:1433";<br />
&nbsp; $cn = mssql_connect($dbserver, $dbuser, $dbpass);<br />
<br />
where xxx is the IP address.<br />
<br />
It seems that this doesn't work, you need to do the following:<br />
edit your freetds.conf file and add the connection in here, eg:<br />
[YourServer]<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; host =xxx.xxx.xxx.xxx<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; port = 1433<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; tds version = 8.0<br />
<br />
Then try and connect as:<br />
$cn = mssql_connect('YourServer', $dbuser, $dbpass);<br />
<br />
And it should work.&nbsp; No idea why it doesn't work before, took me hours to find this out!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="72418""></a>
  <div class="note">
   <strong class="user">Manda Krishna Srikanth</strong>
   <a href="#72418" class="date">18-Jan-2007 05:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
While using stored procedures on SQL EXPRESS (and perhaps on SQL Server), you have to specify the column names in SELECT, instead of asterisk (*). Or else you will get some big Unicode error.<br />
<br />
That is, instead of "select * from table",<br />
use "select col1, col2 from table".<br />
<br />
One more important thing, Before using mssql_execute, you MUST AND SHOULD use mssql_init. mssql_init will generate the MS Sql statement resource, which will be taken as input by mssql_execute. Here is an example,<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">if(</span><span class="default">$conn </span><span class="keyword">= </span><span class="default">mssql_connect</span><span class="keyword">(</span><span class="string">'localhost\SQLEXPRESS'</span><span class="keyword">, </span><span class="string">'krishna'</span><span class="keyword">, </span><span class="string">'srikanth'</span><span class="keyword">)) echo </span><span class="string">'Connected to SQLEXPRESS'</span><span class="keyword">;<br />
<br />
if(</span><span class="default">mssql_select_db</span><span class="keyword">(</span><span class="string">"Northwind"</span><span class="keyword">,</span><span class="default">$conn</span><span class="keyword">)) echo </span><span class="string">'Selected DB: Northwind&lt;BR&gt;'</span><span class="keyword">;<br />
<br />
</span><span class="default">$sql_statement </span><span class="keyword">=&nbsp; </span><span class="default">mssql_init</span><span class="keyword">(</span><span class="string">"[Ten Most Expensive Products]"</span><span class="keyword">, </span><span class="default">$conn</span><span class="keyword">);<br />
</span><span class="default">$result</span><span class="keyword">=</span><span class="default">mssql_execute</span><span class="keyword">(</span><span class="default">$sql_statement</span><span class="keyword">);<br />
<br />
while (</span><span class="default">$row </span><span class="keyword">= </span><span class="default">mssql_fetch_assoc</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$row</span><span class="keyword">); <br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71557""></a>
  <div class="note">
   <strong class="user">stuhood at gmail doooot com</strong>
   <a href="#71557" class="date">05-Dec-2006 09:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you need to get Output params from your stored procedure, make sure to use FreeTDS &gt; 0.6.4... it has a bug that prevents some Output params from being set.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="50196""></a>
  <div class="note">
   <strong class="user">mpoletto at gmail dot com</strong>
   <a href="#50196" class="date">21-Feb-2005 08:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The constant SQLINT4 is not working with datetime. Try using SQLVARCHAR.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="44009""></a>
  <div class="note">
   <strong class="user">SQL dot User at Yandex dot Ru</strong>
   <a href="#44009" class="date">12-Jul-2004 06:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To receive output parameter from the procedure which returns one or several recordsets, try this code:<br />
<br />
...<br />
mssql_bind($my_procedure, "@OutputParameter", SQLVARCHAR, true);<br />
$result = mssql_execute($my_procedure);<br />
while(mssql_next_recordset($result)) {<br />
## do something<br />
}<br />
<br />
after listing last recordset output parameter will be available (strange...).<br />
<br />
If you do not need output recordsets, just parameters, try this:<br />
<br />
mssql_bind($my_procedure, "@OutputParameter", SQLVARCHAR, true);<br />
$result = mssql_execute($my_procedure, true);<br />
<br />
P.S. Tested on PHP 4.3.5.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="43042""></a>
  <div class="note">
   <strong class="user">marco dot carvalho at NOSPAM dot uni-yoga dot org dot br</strong>
   <a href="#43042" class="date">07-Jun-2004 10:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?PHP <br />
<br />
</span><span class="comment">/*This functions will help you to get SQLTYPES direct from systypes and you can associate them with PHPSQLTYPES. */<br />
<br />
/* &lt;font color="#007f00"&gt;Associete PHP types with systypes..xtypes,<br />
&nbsp;&nbsp; see &lt;b&gt;mssql_get_types()&lt;/b&gt; &lt;/font&gt;*/<br />
<br />
</span><span class="keyword">if(!</span><span class="default">defined</span><span class="keyword">(</span><span class="string">'dbMSSQL_Types'</span><span class="keyword">)) <br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">define</span><span class="keyword">(</span><span class="string">'dbMSSqlTypes'</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$MSSQL_types</span><span class="keyword">[</span><span class="default">127</span><span class="keyword">] = </span><span class="default">SQLINT4</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">/* bigint*/ <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$MSSQL_types</span><span class="keyword">[</span><span class="default">104</span><span class="keyword">] = </span><span class="default">SQLBIT</span><span class="keyword">;&nbsp; &nbsp;&nbsp; </span><span class="comment">/* bit*/ <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$MSSQL_types</span><span class="keyword">[</span><span class="default">175</span><span class="keyword">] = </span><span class="default">SQLCHAR</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">/* char*/ <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$MSSQL_types</span><span class="keyword">[</span><span class="default">56</span><span class="keyword">]&nbsp; = </span><span class="default">SQLINT2</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">/* int*/ <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$MSSQL_types</span><span class="keyword">[</span><span class="default">52</span><span class="keyword">]&nbsp; = </span><span class="default">SQLINT2</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">/* smallint*/ <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$MSSQL_types</span><span class="keyword">[</span><span class="default">35</span><span class="keyword">]&nbsp; = </span><span class="default">SQLTEXT</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">/* text*/ <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$MSSQL_types</span><span class="keyword">[</span><span class="default">48</span><span class="keyword">]&nbsp; = </span><span class="default">SQLINT1</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">/* tinyint*/ <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$MSSQL_types</span><span class="keyword">[</span><span class="default">167</span><span class="keyword">] = </span><span class="default">SQLVARCHAR</span><span class="keyword">; </span><span class="comment">/* varchar*/ <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$MSSQL_types</span><span class="keyword">[</span><span class="default">62</span><span class="keyword">]&nbsp; = </span><span class="default">SQLFLT8</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">/* float*/ <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$MSSQL_types</span><span class="keyword">[</span><span class="default">173</span><span class="keyword">] = </span><span class="default">SQLVARCHAR</span><span class="keyword">; </span><span class="comment">/* binary*/&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // Adaptation<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$MSSQL_types</span><span class="keyword">[</span><span class="default">61</span><span class="keyword">]&nbsp; = </span><span class="default">SQLINT4</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">/* datetime*/&nbsp; &nbsp; &nbsp;&nbsp; // Adaptation<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$MSSQL_types</span><span class="keyword">[</span><span class="default">106</span><span class="keyword">] = </span><span class="default">SQLFLT8</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">/* decimal*/&nbsp; &nbsp; &nbsp; &nbsp; // Adaptation<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$MSSQL_types</span><span class="keyword">[</span><span class="default">34</span><span class="keyword">]&nbsp; = </span><span class="default">SQLVARCHAR</span><span class="keyword">; </span><span class="comment">/* image*/&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Adaptation<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$MSSQL_types</span><span class="keyword">[</span><span class="default">60</span><span class="keyword">]&nbsp; = </span><span class="default">SQLFLT8</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">/* money*/&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Adaptation<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$MSSQL_types</span><span class="keyword">[</span><span class="default">239</span><span class="keyword">] = </span><span class="default">SQLCHAR</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">/* nchar*/&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Adaptation<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$MSSQL_types</span><span class="keyword">[</span><span class="default">99</span><span class="keyword">]&nbsp; = </span><span class="default">SQLTEXT</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">/* ntext*/&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Adaptation<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$MSSQL_types</span><span class="keyword">[</span><span class="default">108</span><span class="keyword">] = </span><span class="default">SQLFLT8</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">/* numeric*/&nbsp; &nbsp; &nbsp; &nbsp; // Adaptation<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$MSSQL_types</span><span class="keyword">[</span><span class="default">231</span><span class="keyword">] = </span><span class="default">SQLVARCHAR</span><span class="keyword">; </span><span class="comment">/* nvarchar*/&nbsp; &nbsp; &nbsp;&nbsp; // Adaptation<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$MSSQL_types</span><span class="keyword">[</span><span class="default">59</span><span class="keyword">]&nbsp; = </span><span class="default">SQLFLT8</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">/* real*/&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // Adaptation<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$MSSQL_types</span><span class="keyword">[</span><span class="default">58</span><span class="keyword">]&nbsp; = </span><span class="default">SQLINT4</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">/* smalldatetime*/&nbsp; // Adaptation<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$MSSQL_types</span><span class="keyword">[</span><span class="default">122</span><span class="keyword">] = </span><span class="default">SQLFLT8</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">/* smallmoney*/&nbsp; &nbsp;&nbsp; // Adaptation<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$MSSQL_types</span><span class="keyword">[</span><span class="default">98</span><span class="keyword">]&nbsp; = </span><span class="default">SQLVARCHAR</span><span class="keyword">; </span><span class="comment">/* sql_variant*/&nbsp; &nbsp; // Adaptation<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$MSSQL_types</span><span class="keyword">[</span><span class="default">189</span><span class="keyword">] = </span><span class="default">SQLINT4</span><span class="keyword">;&nbsp; &nbsp; </span><span class="comment">/* timestamp*/&nbsp; &nbsp; &nbsp; // Adaptation<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$MSSQL_types</span><span class="keyword">[</span><span class="default">165</span><span class="keyword">] = </span><span class="default">SQLVARCHAR</span><span class="keyword">; </span><span class="comment">/* varbinary*/&nbsp; &nbsp; &nbsp; // Adaptation<br />
</span><span class="keyword">}<br />
<br />
</span><span class="comment">/* &lt;font color="#007f00"&gt;Gets current connection systypes and shows this:<br />
<br />
$MSSQL_types[systypes..xtype] = PutPHPSqlTypeHere&nbsp; // Name_in_systypes //<br />
<br />
&lt;/font&gt;*/<br />
</span><span class="keyword">function </span><span class="default">mssql_get_types</span><span class="keyword">(){<br />
&nbsp;&nbsp; </span><span class="default">$res </span><span class="keyword">= </span><span class="default">mssql_query</span><span class="keyword">(</span><span class="string">'select name,xtype from systypes'</span><span class="keyword">);<br />
&nbsp;&nbsp; echo(</span><span class="string">'&lt;pre&gt;&lt;CODE&gt;'</span><span class="keyword">);<br />
&nbsp;&nbsp; while((</span><span class="default">$val </span><span class="keyword">= </span><span class="default">mssql_fetch_assoc</span><span class="keyword">(</span><span class="default">$res</span><span class="keyword">))){<br />
&nbsp;&nbsp; &nbsp;&nbsp; echo(</span><span class="string">'$MSSQL_types['</span><span class="keyword">.</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'xtype'</span><span class="keyword">].</span><span class="string">"]\t= ;\t/* "</span><span class="keyword">.</span><span class="default">$val</span><span class="keyword">[</span><span class="string">'name'</span><span class="keyword">].</span><span class="string">" */\n"</span><span class="keyword">);<br />
&nbsp;&nbsp; }<br />
&nbsp;&nbsp; </span><span class="default">print_r</span><span class="keyword">(</span><span class="default">phpinfo</span><span class="keyword">(</span><span class="default">INFO_VARIABLES</span><span class="keyword">));<br />
&nbsp;&nbsp; echo(</span><span class="string">'&lt;/CODE&gt;&lt;/pre&gt;'</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="37002""></a>
  <div class="note">
   <strong class="user">iqq-pp at extreme dot ro</strong>
   <a href="#37002" class="date">30-Oct-2003 12:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
php version 4.3.2<br />
<br />
Take care when using stored procedures returning multiple results, seems that if the first result is empty, the pointer will be automatically moved to the next result. As in this example:<br />
<br />
CREATE PROCEDURE test<br />
AS<br />
SELECT 0 as zero WHERE 0 = 1<br />
SELECT 1 as one<br />
GO<br />
<br />
After executing the stored procedure, mssql_num_rows will report one, ignoring the first result.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="36501""></a>
  <div class="note">
   <strong class="user">eliseo at olografix dot org</strong>
   <a href="#36501" class="date">12-Oct-2003 07:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
After many attempt I resolved the return output of a store procedure on Win2003 box, MSSQL7 and PHP 4.3.<br />
I have problem to process the result from store procedure strCheckUser, and I must to set a R variable, that must be returned from the last select operation (Select @R as R) see below.<br />
<br />
----------------------------<br />
/*<br />
Store procedure to CheckUser Exist<br />
*/<br />
CREATE PROC strCheckUser&nbsp; <br />
(<br />
@AccountLO varchar(20) , <br />
@PasswordLO varchar(20)<br />
)<br />
AS<br />
BEGIN<br />
DECLARE @R INT<br />
IF (SELECT count(*) as count FROM tbl_users WHERE AccountLO = @AccountLO and PasswordLO=@PasswordLO<br />
) = 0<br />
SET @R = '0'<br />
END<br />
<br />
BEGIN<br />
IF (SELECT count(*) as count FROM tbl_users WHERE AccountLO = @AccountLO&nbsp; and PasswordLO=@PasswordLO<br />
) = 1<br />
SET @R = '1'<br />
<br />
END<br />
<br />
Select @R as R<br />
<br />
GO<br />
-------------------------<br />
<br />
This is the php page<br />
&lt;?<br />
<br />
.....<br />
.....<br />
$AccountLO="myuser";<br />
$PassowrdLO="mypass";<br />
<br />
$result=mssql_query("strCheckUser ".$AccountLO.", ".$PasswordLO.""); <br />
//echo gettype($result);<br />
$arr = mssql_fetch_assoc($result);&nbsp; &nbsp; &nbsp; &nbsp; <br />
echo $arr["R"]; <br />
<br />
......<br />
......<br />
?&gt;<br />
<br />
No $arr["R"] print 1 if the user exist and 0 if no exist<br />
<br />
Thanks to duarte at uma dot pt for the suggestion<br />
Bye eliseo@olografix.org</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="34787""></a>
  <div class="note">
   <strong class="user">gstratfordATdas.ca</strong>
   <a href="#34787" class="date">06-Aug-2003 10:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The easiest way to use a stored procedure is:<br />
<br />
$Result = mssql_query("StoredProcedureName Var1, Var2, Var3...");<br />
<br />
$Result is then just like any other result set. You can get the output parameters by:<br />
<br />
$arr = mssql_fetch_row($Result);<br />
<br />
$OutputParam1 = $arr[0];<br />
$OutputParam2 = $arr[1];</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="34781""></a>
  <div class="note">
   <strong class="user">brian_caughlin at hotmail dot com</strong>
   <a href="#34781" class="date">06-Aug-2003 08:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Regarding Output Parameters and RETVAL: A change that appears to have begun around 4.3.<br />
<br />
According to the documentation and previously posted comments, if a stored procedure returns only one Recordset, you could retrieve the RETVAL and Output Params right away.&nbsp; THIS IS NO LONGER THE CASE.&nbsp; Beginning around 4.3, you must always use the mssql_next_result() function if any recordset is returned at all.<br />
<br />
If you consider the example posted below by fjortizATcomunetDOTes on 26-Dec-2001...<br />
<br />
[...]<br />
<br />
// Execute the Stored Proc<br />
$result=mssql_execute($stmt); <br />
<br />
// Get the recordset<br />
$arr=mssql_fetch_row($result); <br />
print ("Answer: " . $arr[0] . "<br />
" ); <br />
<br />
// NEW for 4.3: Switch to the next Recordset<br />
// Since there was only one recordset, it will return false...<br />
mssql_next_result($result);<br />
<br />
// And now RETVAL and Output Params are accessible...<br />
print ("RETVAL = $val ; intval = $ival ; floatval = $fval ; string = $sval"); <br />
<br />
[...]<br />
<br />
There is also another way, and that is to use a new optional skip parameter on the execute.<br />
<br />
mssql_execute($stmt, true);<br />
<br />
This appears to ignore any recordsets, allowing you to get at the retval and output parameters immediately.<br />
<br />
For more information, please see Bug #21089.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="17806""></a>
  <div class="note">
   <strong class="user">fjortizATcomunetDOTes</strong>
   <a href="#17806" class="date">26-Dec-2001 03:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
After initializing a stored procedure 
<br />
with mssql_init, and binding all the 
<br />
parameters (and return value if needed) 
<br />
with mssql_bind, you can execute the 
<br />
statement with mssql_execute.
<br />

<br />
Parameters:
<br />
- stmt: statement resource obtained with 
<br />
mssql_init.
<br />

<br />
From here, you can use any of the other 
<br />
mssql_* functions to retrieve the 
<br />
recordsets as if you had called 
<br />
mssql_query. Any T-SQL error will also 
<br />
be reported in the same way. The 
<br />
variables passed by reference for OUTPUT 
<br />
and RETVAL parameters will be filled 
<br />
with the right values.
<br />

<br />
Now, an example:
<br />

<br />
if we have this procedure:
<br />

<br />
CREATE PROCEDURE [procedure]
<br />
(
<br />
&nbsp;&nbsp; @sval varchar(50) OUTPUT,
<br />
&nbsp;&nbsp; @intval int OUTPUT, 
<br />
&nbsp;&nbsp; @floatval decimal(6,4) OUTPUT
<br />
) AS
<br />

<br />
if @intval is null
<br />
&nbsp;&nbsp;&nbsp; select '@intval is null' as answer
<br />
else&nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; select '@intval is NOT null' as answer
<br />

<br />
set @sval='Hello ' + @sval 
<br />
set @intval=@intval+1
<br />
set @floatval=@floatval+1
<br />

<br />
return 10
<br />

<br />
We can use this PHP code:
<br />

<br />
<span class="default">&lt;?php
<br />

<br />
$conn</span><span class="keyword">=</span><span class="default">mssql_connect</span><span class="keyword">(</span><span class="string">"myhost"</span><span class="keyword">,</span><span class="string">"user"</span><span class="keyword">,</span><span class="string">"pwd"</span><span class="keyword">);
<br />

<br />
if (</span><span class="default">$conn</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">mssql_select_db</span><span class="keyword">(</span><span class="string">"mydb"</span><span class="keyword">,</span><span class="default">$conn</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$stmt</span><span class="keyword">=</span><span class="default">mssql_init</span><span class="keyword">(</span><span class="string">"procedure"</span><span class="keyword">,</span><span class="default">$conn</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">mssql_bind</span><span class="keyword">(</span><span class="default">$stmt</span><span class="keyword">,</span><span class="string">"RETVAL"</span><span class="keyword">,&amp;</span><span class="default">$val</span><span class="keyword">,</span><span class="default">SQLINT4</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ival</span><span class="keyword">=</span><span class="default">11</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fval</span><span class="keyword">=</span><span class="default">2.1416</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$sval</span><span class="keyword">=</span><span class="string">"Frank"</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">mssql_bind</span><span class="keyword">(</span><span class="default">$stmt</span><span class="keyword">,</span><span class="string">"@sval"</span><span class="keyword">,&amp;</span><span class="default">$sval</span><span class="keyword">,</span><span class="default">SQLVARCHAR</span><span class="keyword">,</span><span class="default">TRUE</span><span class="keyword">);&nbsp; &nbsp; 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">mssql_bind</span><span class="keyword">(</span><span class="default">$stmt</span><span class="keyword">,</span><span class="string">"@intval"</span><span class="keyword">,&amp;</span><span class="default">$ival</span><span class="keyword">,</span><span class="default">SQLINT4</span><span class="keyword">,</span><span class="default">TRUE</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">mssql_bind</span><span class="keyword">(</span><span class="default">$stmt</span><span class="keyword">,</span><span class="string">"@floatval"</span><span class="keyword">,&amp;</span><span class="default">$fval</span><span class="keyword">,</span><span class="default">SQLFLT8</span><span class="keyword">,</span><span class="default">TRUE</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$result</span><span class="keyword">=</span><span class="default">mssql_execute</span><span class="keyword">(</span><span class="default">$stmt</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$arr</span><span class="keyword">=</span><span class="default">mssql_fetch_row</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; print (</span><span class="string">"Answer: " </span><span class="keyword">. </span><span class="default">$arr</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] . </span><span class="string">"&lt;br&gt;" </span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; print (</span><span class="string">"RETVAL = </span><span class="default">$val</span><span class="string"> ; intval = </span><span class="default">$ival</span><span class="string"> ; floatval = </span><span class="default">$fval</span><span class="string"> ; string = </span><span class="default">$sval</span><span class="string">"</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">mssql_close</span><span class="keyword">(</span><span class="default">$conn</span><span class="keyword">);
<br />
}
<br />
else print(</span><span class="string">"ooops!"</span><span class="keyword">);
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />

<br />
Hope it helps. Good luck!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
