<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>打开一个到 MySQL 服务器的连接</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.mysql-close.html">? mysql_close</a></li>
      <li style="float: right;"><a href="function.mysql-create-db.html">mysql_create_db ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.mysql.html">MySQL 函数</a></li>
    <li>打开一个到 MySQL 服务器的连接</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.mysql-connect" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">mysql_connect</h1>
  <p class="verinfo">(PHP 4, PHP 5)</p><p class="refpurpose"><span class="refname">mysql_connect</span> &mdash; <span class="dc-title">打开一个到 MySQL 服务器的连接</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-function.mysql-connect-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">resource</span> <span class="methodname"><strong>mysql_connect</strong></span>
    ([ <span class="methodparam"><span class="type">string</span> <code class="parameter">$server</code></span>
   [, <span class="methodparam"><span class="type">string</span> <code class="parameter">$username</code></span>
   [, <span class="methodparam"><span class="type">string</span> <code class="parameter">$password</code></span>
   [, <span class="methodparam"><span class="type">bool</span> <code class="parameter">$new_link</code></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$client_flags</code></span>
  ]]]]] )</div>

  <p class="para rdfs-comment">
   打开或重复使用一个到 MySQL 服务器的连接。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.mysql-connect-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">server</code></dt>

     <dd>

      <p class="para">
       MySQL 服务器。可以包括端口号，例如
       &quot;hostname:port&quot;，或者到本地套接字的路径，例如对于 localhost 的 &quot;:/path/to/socket&quot;。
      </p>
      <p class="para">
       如果 PHP 指令 <a href="mysql.configuration.html#ini.mysql.default-host" class="link">
       mysql.default_host</a> 未定义（默认情况），则默认值是 &#039;localhost:3306&#039;。
       在 <a href="ini.core.html#ini.sql.safe-mode" class="link">SQL 安全模式</a> 时，参数被忽略，总是使用 &#039;localhost:3306&#039;。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">username</code></dt>

     <dd>

      <p class="para">
       用户名。默认值由 <a href="mysql.configuration.html#ini.mysql.default-user" class="link">mysql.default_user</a> 定义。
       在 <a href="ini.core.html#ini.sql.safe-mode" class="link">SQL 安全模式</a> 时，参数被忽略，总是使用服务器进程所有者的用户名。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">password</code></dt>

     <dd>

      <p class="para">
       密码。默认值由<a href="mysql.configuration.html#ini.mysql.default-password" class="link">mysql.default_password</a>定义。在 <a href="ini.core.html#ini.sql.safe-mode" class="link">SQL 安全模式</a> 时，参数被忽略，总是使用空密码。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">new_link</code></dt>

     <dd>

      <p class="para">
       如果用同样的参数第二次调用
       <span class="function"><strong>mysql_connect()</strong></span>，将不会建立新连接，而将返回已经打开的连接标识。参数
       <code class="parameter">new_link</code> 改变此行为并使
       <span class="function"><strong>mysql_connect()</strong></span> 总是打开新的连接，甚至当
       <span class="function"><strong>mysql_connect()</strong></span> 曾在前面被用同样的参数调用过。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">client_flags</code></dt>

     <dd>

      <p class="para">
       <code class="parameter">client_flags</code>
       参数可以是以下常量的组合：<strong><code>MYSQL_CLIENT_SSL</code></strong>，<strong><code>MYSQL_CLIENT_COMPRESS</code></strong>，<strong><code>MYSQL_CLIENT_IGNORE_SPACE</code></strong>
       或 <strong><code>MYSQL_CLIENT_INTERACTIVE</code></strong>。进一步信息见<a href="mysql.constants.html#mysql.client-flags" class="xref">MySQL 客户端常量</a>。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.mysql-connect-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   如果成功则返回一个 MySQL 连接标识， 或者在失败时返回 <strong><code>FALSE</code></strong>。
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.mysql-connect-changelog">
  <h3 class="title">更新日志</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead>
      <tr>
       <th>版本</th>
       <th>说明</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
       <td>4.3.0</td>
       <td>
        添加 <code class="parameter">client_flags</code> 参数。
       </td>
      </tr>

      <tr>
       <td>4.2.0</td>
       <td>
        添加 <code class="parameter">new_link</code> 参数。
       </td>
      </tr>

      <tr>
       <td>3.0.10</td>
       <td>
        对 <code class="parameter">server</code> 添加 &quot;:/path/to/socket&quot; 支持。
       </td>
      </tr>

      <tr>
       <td>3.0.0</td>
       <td>
        对 <code class="parameter">server</code> 添加 &quot;:port&quot; 支持。
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.mysql-connect-examples">
  <h3 class="title">范例</h3>
  <p class="para">
   <div class="example" id="example-1607">
    <p><strong>Example #1 <span class="function"><strong>mysql_connect()</strong></span> 例子</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$link&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mysql_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">'localhost'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'mysql_user'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'mysql_password'</span><span style="color: #007700">);<br />if&nbsp;(!</span><span style="color: #0000BB">$link</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;die(</span><span style="color: #DD0000">'Could&nbsp;not&nbsp;connect:&nbsp;'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">mysql_error</span><span style="color: #007700">());<br />}<br />echo&nbsp;</span><span style="color: #DD0000">'Connected&nbsp;successfully'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">mysql_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$link</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
  <p class="para">
   <div class="example" id="example-1608">
    <p><strong>Example #2 <span class="function"><strong>mysql_connect()</strong></span> 例子：使用 <em>hostname:port</em> 语法</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;we&nbsp;connect&nbsp;to&nbsp;example.com&nbsp;and&nbsp;port&nbsp;3307<br /></span><span style="color: #0000BB">$link&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mysql_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">'example.com:3307'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'mysql_user'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'mysql_password'</span><span style="color: #007700">);<br />if&nbsp;(!</span><span style="color: #0000BB">$link</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;die(</span><span style="color: #DD0000">'Could&nbsp;not&nbsp;connect:&nbsp;'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">mysql_error</span><span style="color: #007700">());<br />}<br />echo&nbsp;</span><span style="color: #DD0000">'Connected&nbsp;successfully'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">mysql_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$link</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;we&nbsp;connect&nbsp;to&nbsp;localhost&nbsp;at&nbsp;port&nbsp;3307<br /></span><span style="color: #0000BB">$link&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mysql_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">'127.0.0.1:3307'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'mysql_user'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'mysql_password'</span><span style="color: #007700">);<br />if&nbsp;(!</span><span style="color: #0000BB">$link</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;die(</span><span style="color: #DD0000">'Could&nbsp;not&nbsp;connect:&nbsp;'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">mysql_error</span><span style="color: #007700">());<br />}<br />echo&nbsp;</span><span style="color: #DD0000">'Connected&nbsp;successfully'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">mysql_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$link</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
  <p class="para">
   <div class="example" id="example-1609">
    <p><strong>Example #3 <span class="function"><strong>mysql_connect()</strong></span> 例子：使用 &quot;:/path/to/socket&quot; 语法</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;we&nbsp;connect&nbsp;to&nbsp;localhost&nbsp;and&nbsp;socket&nbsp;e.g.&nbsp;/tmp/mysql.sock<br /><br />//variant&nbsp;1:&nbsp;ommit&nbsp;localhost<br /></span><span style="color: #0000BB">$link&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mysql_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">'/tmp/mysql'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'mysql_user'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'mysql_password'</span><span style="color: #007700">);<br />if&nbsp;(!</span><span style="color: #0000BB">$link</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;die(</span><span style="color: #DD0000">'Could&nbsp;not&nbsp;connect:&nbsp;'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">mysql_error</span><span style="color: #007700">());<br />}<br />echo&nbsp;</span><span style="color: #DD0000">'Connected&nbsp;successfully'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">mysql_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$link</span><span style="color: #007700">);<br /><br /><br /></span><span style="color: #FF8000">//&nbsp;variant&nbsp;2:&nbsp;with&nbsp;localhost<br /></span><span style="color: #0000BB">$link&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mysql_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">'localhost:/tmp/mysql.sock'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'mysql_user'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'mysql_password'</span><span style="color: #007700">);<br />if&nbsp;(!</span><span style="color: #0000BB">$link</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;die(</span><span style="color: #DD0000">'Could&nbsp;not&nbsp;connect:&nbsp;'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">mysql_error</span><span style="color: #007700">());<br />}<br />echo&nbsp;</span><span style="color: #DD0000">'Connected&nbsp;successfully'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">mysql_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$link</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 notes" id="refsect1-function.mysql-connect-notes">
  <h3 class="title">注释</h3>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">本扩展自 PHP 5.5.0
起已废弃，并在将来会被移除。应使用 <a href="book.mysqli.html" class="link">MySQLi</a> 
或 <a href="ref.pdo-mysql.html" class="link">PDO_MySQL</a> 扩展来替换之。参见
<a href="mysqlinfo.api.choosing.html" class="link">MySQL：选择 API</a> 指南以及<a href="faq.databases.html#faq.databases.mysql.deprecated" class="link">相关 FAQ</a> 以获取更多信息。用以替代本函数的有：</p>
   <p class="para">
    <ul class="simplelist">
     <li class="member"><span class="function"><a href="function.mysqli-connect.html" class="function">mysqli_connect()</a></span></li>
     <li class="member"><span class="methodname"><a href="pdo.construct.html" class="methodname">PDO::__construct()</a></span></li>
    </ul>
   </p>
  </p></blockquote>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    只要将 server 指定为 &quot;localhost&quot; 或
    &quot;localhost:port&quot;，MySQL 客户端库会越过此值并尝试连接到本地套接字（Windows
    中的名字管道）。如果想用 TCP/IP，应该用 &quot;127.0.0.1&quot;
    代替 &quot;localhost&quot;。如果 MySQL 客户端库试图连接到一个错误的本地套接字，则应该在
    PHP 配置中设定 <a href="mysql.configuration.html#ini.mysql.default-host" class="xref"></a>
    的正确路径并把 server 留空。
   </p>
  </p></blockquote>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    脚本一结束，到服务器的连接就被关闭，除非之前已经明确调用
    <span class="function"><a href="function.mysql-close.html" class="function">mysql_close()</a></span> 关闭了。
   </p>
  </p></blockquote>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    可以在函数名前加上一个
    <a href="language.operators.errorcontrol.html" class="link">@</a>
    来抑制出错时的错误信息。
   </p>
  </p></blockquote>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.mysql-connect-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.mysql-pconnect.html" class="function" rel="rdfs-seeAlso">mysql_pconnect()</a> - 打开一个到 MySQL 服务器的持久连接</span></li>
    <li class="member"><span class="function"><a href="function.mysql-close.html" class="function" rel="rdfs-seeAlso">mysql_close()</a> - 关闭 MySQL 连接</span></li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="112461""></a>
  <div class="note">
   <strong class="user">pepik at gmail dot cz</strong>
   <a href="#112461" class="date">19-Jun-2013 08:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
&nbsp;$server </span><span class="keyword">= </span><span class="string">'y.com'</span><span class="keyword">;<br />
&nbsp;</span><span class="default">$login</span><span class="keyword">=</span><span class="string">'x'</span><span class="keyword">;<br />
&nbsp;</span><span class="default">$pass</span><span class="keyword">=</span><span class="string">'x'</span><span class="keyword">;<br />
&nbsp;</span><span class="default">$db</span><span class="keyword">=</span><span class="string">'x'</span><span class="keyword">;<br />
&nbsp;<br />
&nbsp;</span><span class="default">$spojeni</span><span class="keyword">=</span><span class="default">mysql_connect</span><span class="keyword">(</span><span class="default">$server</span><span class="keyword">,</span><span class="default">$login</span><span class="keyword">,</span><span class="default">$pass</span><span class="keyword">) or die (</span><span class="string">'nelze se pripojit'</span><span class="keyword">);<br />
&nbsp;</span><span class="default">mysql_select_db</span><span class="keyword">(</span><span class="default">$db</span><span class="keyword">,</span><span class="default">$spojeni</span><span class="keyword">);<br />
&nbsp;</span><span class="default">mysql_query</span><span class="keyword">(</span><span class="string">"Set names 'utf8'"</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="112223""></a>
  <div class="note">
   <strong class="user">yangqingrong at wudimei dot com</strong>
   <a href="#112223" class="date">18-May-2013 11:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
hello,every one.<br />
&nbsp; do use "127.0.0.1" instead of "localhost" for php5.4-win7 if you feel the speed is slow.because win7 use ipv6 default.<br />
&nbsp;&nbsp; "localhost" is for ipv4.<br />
<br />
&nbsp; <span class="default">&lt;?php<br />
&nbsp;&nbsp; $conn </span><span class="keyword">=</span><span class="default">mysql_connect</span><span class="keyword">( </span><span class="string">"127.0.0.1"</span><span class="keyword">, <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"root"</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"pass"</span><span class="keyword">);<br />
&nbsp;</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="109668""></a>
  <div class="note">
   <strong class="user">trev at dedicate dot co dot uk</strong>
   <a href="#109668" class="date">08-Aug-2012 01:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A little note if your scripts sleep a lot, you want to run exactly the same SQL statement 2+ times and you have the "MySQL has gone away" error a lot.<br />
<br />
Try setting the 4th parameter to TRUE as it seems sometimes PHP doesn't spot that resource ID x which it used for the last identical lookup is now dud and so tries to use it, thus bypassing tests such as is_resource() and causing a failure.<br />
<br />
This is for when mysql_ping() doesn't work for your situation of course.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="108721""></a>
  <div class="note">
   <strong class="user">nicodenboer at yahoo dot com</strong>
   <a href="#108721" class="date">20-May-2012 10:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Be carefull here if you use utf8.<br />
<br />
The file db.opt of your database should contain the following lines:<br />
default-character-set=utf8<br />
default-collation=utf8_general_ci<br />
<br />
It means that your database is created to use the utf8 characterset.<br />
One way to accomplish this is:<br />
CREATE DATABASE my_database DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci;<br />
<br />
Then, after connecting to it from PHP you should use:<br />
mysql_set_charset("UTF8", $connection);<br />
<br />
If you don't do this, you will get ugly problems in case other software is reading and writing to the same database!!!!!!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="108292""></a>
  <div class="note">
   <strong class="user">php at lanar dot com dot au</strong>
   <a href="#108292" class="date">15-Apr-2012 10:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
After upgrading mysql sever to 5.5.21 from 5.0.9 on centos, my WinXP stopped being able to connect with host with the error message <br />
'Bad Handshake'. <br />
<br />
Eventual solution to problem was to remove MYSQL_CLIENT_SSL from the call to mysql_connect().<br />
<br />
I will also report this as a bug.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="104284""></a>
  <div class="note">
   <strong class="user">bimal at sanjaal dot com</strong>
   <a href="#104284" class="date">05-Jun-2011 09:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Portable connections: If you migrate your source code from one to different servers and you would like to avoid re-configuration on a new serve, user the $_SERVER['SERVER_NAME'] flag as:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">switch(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'SERVER_NAME'</span><span class="keyword">])
<br />
{
<br />
case </span><span class="string">'server1.example.com'</span><span class="keyword">:
<br />
&nbsp; </span><span class="default">mysqlconnect</span><span class="keyword">(</span><span class="string">'host1'</span><span class="keyword">, </span><span class="string">'user1'</span><span class="keyword">, </span><span class="string">'password1'</span><span class="keyword">);
<br />
&nbsp; </span><span class="default">mysql_select_db</span><span class="keyword">(</span><span class="string">'db1'</span><span class="keyword">);
<br />
&nbsp; break;
<br />
case </span><span class="string">'server2.example.com'</span><span class="keyword">:
<br />
&nbsp; </span><span class="default">mysqlconnect</span><span class="keyword">(</span><span class="string">'host2'</span><span class="keyword">, </span><span class="string">'user2'</span><span class="keyword">, </span><span class="string">'password2'</span><span class="keyword">);
<br />
&nbsp; </span><span class="default">mysql_select_db</span><span class="keyword">(</span><span class="string">'db2'</span><span class="keyword">);
<br />
&nbsp; break;
<br />
}
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
This makes a conditional connection to mysql database. It automatically chooses the correct server according to the server name from where your script runs.
<br />

<br />
Hopefully, you like this portable configuration.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="103536""></a>
  <div class="note">
   <strong class="user">avinc@live,hk</strong>
   <a href="#103536" class="date">19-Apr-2011 02:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
My situation: "I could connect to MySQL from the PHP via Apache and MySQL via the MySQL console, and could not connect via the PHP"<br />
<br />
But, PHP only can connect to MySQL using mysql_connect("localhost", "root", "password");<br />
<br />
"Its selinux not allowing apache to make remote connections"<br />
<br />
Solution:<br />
setsebool -P httpd_can_network_connect=1</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102131""></a>
  <div class="note">
   <strong class="user">Harouk</strong>
   <a href="#102131" class="date">28-Jan-2011 03:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you encounter speed problems using this command to a distant server, you can add the line "skip-name-resolve" in your my.cnf to fix it.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100896""></a>
  <div class="note">
   <strong class="user">i dot linker at gmail dot com</strong>
   <a href="#100896" class="date">13-Nov-2010 07:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
MySQL connection string regexp:<br />
~mysql://([^:@/]*):?([^@/]*)@?([^/]*)/?([^/]*)~</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="97657""></a>
  <div class="note">
   <strong class="user">tpl99 at yandex dot ru</strong>
   <a href="#97657" class="date">30-Apr-2010 10:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Whenever you open two connections to a single database,<br />
you are likely not to get any error when selecting not existing db.<br />
<br />
<span class="default">&lt;?php<br />
$db1 </span><span class="keyword">= </span><span class="default">mysql_connect</span><span class="keyword">( ... );<br />
</span><span class="default">mysql_select_db</span><span class="keyword">(</span><span class="string">'existing_db'</span><span class="keyword">,</span><span class="default">$db1</span><span class="keyword">);<br />
<br />
</span><span class="default">$db2 </span><span class="keyword">= </span><span class="default">mysql_connect</span><span class="keyword">( ... );<br />
</span><span class="default">mysql_select_db</span><span class="keyword">(</span><span class="string">'not_existing_db'</span><span class="keyword">, </span><span class="default">$db2</span><span class="keyword">);<br />
<br />
</span><span class="default">mysql_query</span><span class="keyword">(... , </span><span class="default">$db2</span><span class="keyword">);<br />
</span><span class="comment">//will return no errors and the query wouldn't be executed.<br />
</span><span class="default">?&gt;<br />
</span><br />
Pay attention and you may save few hours of debugging.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="96824""></a>
  <div class="note">
   <strong class="user">abelcheung at gmail dot com</strong>
   <a href="#96824" class="date">17-Mar-2010 07:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that named pipe on Windows is unusable since PHP 5.3, and TCP connection shall be used even in localhost.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="94927""></a>
  <div class="note">
   <strong class="user">sholland at napervillegi dot com</strong>
   <a href="#94927" class="date">03-Dec-2009 06:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are getting an error "Can't assign requested address" you may have a problem with the mysql port.&nbsp; I had just moved my server to Mac OS X 10.6 and mysql_connect was giving this error.&nbsp; Going into the /etc/php.ini file and setting the default port number to 3306 fixed the problem.&nbsp; <br />
<br />
mysql.default_port = 3306<br />
<br />
The php.ini file suggests that PHP will select the port by using the $MYSQL_TCP_PORT or the mysql-tcp entry in /etc/services, but in this case it is not so.&nbsp; /etc/services on my machine has 3306 listed, but it didn't get picked up.<br />
<br />
This is sort of a bug report, in that the documented feature isn't working.&nbsp; Please don't delete this until the community decides how to address the problem.&nbsp; This is one of those hair pulling exercises to get fixed.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="93476""></a>
  <div class="note">
   <strong class="user">david dot schueler at wapkamera dot de</strong>
   <a href="#93476" class="date">11-Sep-2009 05:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are getting MySQL Errors like #2006: MySQL server has gone away, and you are using mysql_connect() and pcntl_fork() then make shure that you are reconnecting to the mysql server with each created child which you fork()ed.<br />
<br />
I pulled my hair out for many days because i was using the same mysql connection for each child and was getting that "MySQL server has gone away" errors.<br />
<br />
Here is a simple example:<br />
<span class="default">&lt;?php<br />
$link </span><span class="keyword">= </span><span class="default">mysql_connect</span><span class="keyword">(</span><span class="default">$db_server</span><span class="keyword">, </span><span class="default">$db_user</span><span class="keyword">, </span><span class="default">$db_pass</span><span class="keyword">);<br />
</span><span class="default">mysql_select_db</span><span class="keyword">(</span><span class="default">$db_database</span><span class="keyword">,</span><span class="default">$link</span><span class="keyword">));<br />
<br />
</span><span class="default">$pid </span><span class="keyword">= </span><span class="default">pcntl_fork</span><span class="keyword">();<br />
if (</span><span class="default">$pid </span><span class="keyword">== -</span><span class="default">1</span><span class="keyword">)<br />
&nbsp; </span><span class="comment">// Error forking child<br />
</span><span class="keyword">elseif (</span><span class="default">$pid</span><span class="keyword">) {<br />
&nbsp; </span><span class="comment">// Parent will be here<br />
</span><span class="keyword">} else {<br />
&nbsp; </span><span class="comment">// The child has to esablish a *new* mysql connection.<br />
&nbsp; // if you use mysql_connect without the 4th parameter<br />
&nbsp; // then it will use the connection from the parent. But<br />
&nbsp; // if the child dies, the connection will be unaviable in<br />
&nbsp; // the parent too.<br />
&nbsp; // So, note the "true" as 4th parameter.<br />
&nbsp; </span><span class="default">$newlink </span><span class="keyword">= </span><span class="default">mysql_connect</span><span class="keyword">(</span><span class="default">$db_server</span><span class="keyword">, </span><span class="default">$db_user</span><span class="keyword">, </span><span class="default">$db_pass</span><span class="keyword">,</span><span class="default">true</span><span class="keyword">);<br />
&nbsp; </span><span class="default">mysql_select_db</span><span class="keyword">(</span><span class="default">$db_database</span><span class="keyword">,</span><span class="default">$newlink</span><span class="keyword">));<br />
&nbsp; </span><span class="comment">// ...<br />
</span><span class="keyword">}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91965""></a>
  <div class="note">
   <strong class="user">cory dot mawhorter  gmail.com</strong>
   <a href="#91965" class="date">03-Jul-2009 01:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hopefully this saves someone some grief.<br />
<br />
My dev computer is windows and runs wampserver.&nbsp; I have frequent problems with PHP being unable to connect to MySQL after periods of extreme DB activity.<br />
<br />
Long story short, it was because I was not running mysql via named-pipes and Windows was running out of available ports to serve PHP.&nbsp; Apparently, on windows, you have 5000 ports to work with and once they are opened, they remain so for 120 seconds before being released.&nbsp; This causes problems with mysql/networking because a new port is requested for each connection.<br />
<br />
You can read more about the problem at:<br />
(Link too long and had to be broken up)<br />
<a href="http://dev.mysql.com/doc/refman/5.0/en" rel="nofollow" target="_blank">http://dev.mysql.com/doc/refman/5.0/en</a><br />
/can-not-connect-to-server.html#can-not-connect-to-server-on-windows<br />
?&gt;<br />
<br />
Since mysql is on localhost, I can just enable named-pipes (which is how you should have mysql setup if you don't need networking) to get around the problem instead of the workaround listed on that page.<br />
<br />
For details, see:<br />
<a href="http://dev.mysql.com/tech-resources" rel="nofollow" target="_blank">http://dev.mysql.com/tech-resources</a><br />
/articles/securing_mysql_windows.html</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86645""></a>
  <div class="note">
   <strong class="user">Contact at LinuxIntro dot com</strong>
   <a href="#86645" class="date">28-Oct-2008 06:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When you connect and expect to use a stored procedure,you must pass a special flag to MySQL via the connect command, otherwise you will not get the results returned, and it will result in this error:<br />
PROCEDURE AlexGrim.GetStats_ForumCategories can't return a result set in the given context<br />
<br />
To fix this, change you connection string, adding ",false,65536" as the last 2 fields:<br />
$this-&gt;con = mysql_connect($this-&gt;h,$this-&gt;u,$this-&gt;p,false,65536);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85539""></a>
  <div class="note">
   <strong class="user">bmagilavy at avalon-internet dot com</strong>
   <a href="#85539" class="date">04-Sep-2008 10:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you trying to connect to a remote server, here are a few things that can go wrong. Perhaps this list will save someone some time:<br />
<br />
1. You may need to get in touch with the remote server's tech support: <br />
<br />
&nbsp;a. to ensure that you can get through its firewall. It is not necessarily enough to have your server number listed in the recipient site's cpanel remote access host list. It depends on how the server company has things set up;<br />
<br />
&nbsp;b. to find out what port number they are using for database connections, which may not be the default used by mysql_connect;<br />
<br />
&nbsp;c. If you are using ODBC, the host to which you are trying to connect may or may not have any ODBC drivers installed; and<br />
<br />
&nbsp;d. If you are working from a dynamic IP, they may be set up to accommodate it, or you may have to use a proxy. See <a href="http://forge.mysql.com/wiki/MySQL_Proxy ." rel="nofollow" target="_blank">http://forge.mysql.com/wiki/MySQL_Proxy .</a><br />
<br />
2. If you are working from a shared server yourself, the server number you were sent in the sign-up letter is probably NOT the server number you should be using to connect to a remote database. You need the server number of the machine on which your site is sitting, not your virtual account server number on that machine. You can get this from your own tech support.<br />
<br />
I am grateful to Jonathan Jones at Bluehost for this analysis.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85255""></a>
  <div class="note">
   <strong class="user">pascalxusNOSPAM at yahoo dot com</strong>
   <a href="#85255" class="date">22-Aug-2008 09:08</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I just wanted to share a common wrapper that I use for executing one line SQL statements.&nbsp; Its an easy wrapper to use that takes care of the connection open/close.&nbsp; Optionally, the mysql_connect can be replaced with mysql_pconnect for persistent connections.<br />
<br />
&nbsp; function executeQuery( $query, $db, $nocon )<br />
&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp; if( $nocon != "nocon" )<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( $db != "" ) connect( $db );<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else connect( "pascal_crm" );<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; $result= mysql_query( $query );<br />
&nbsp;&nbsp; &nbsp;&nbsp; $err&nbsp;&nbsp; = mysql_error();<br />
&nbsp;&nbsp; &nbsp;&nbsp; if( $err != "" ) echo "error=$err&nbsp; ";<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; if( $nocon != "nocon" )<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; mysql_close();<br />
&nbsp;&nbsp; &nbsp;&nbsp; return $result;<br />
&nbsp; }<br />
<br />
Here's a related mysql_pconnect trivia question:<br />
<a href="http://www.codesplunk.com/nr/questions/php17.html" rel="nofollow" target="_blank">http://www.codesplunk.com/nr/questions/php17.html</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84675""></a>
  <div class="note">
   <strong class="user">Boris K</strong>
   <a href="#84675" class="date">25-Jul-2008 05:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Coderlit and angelo,<br />
<br />
this may be the solution:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (!isset(</span><span class="default">$g_link</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$g_link </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">GetMyConnection</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; global </span><span class="default">$g_link</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="default">$g_link </span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$g_link</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$g_link </span><span class="keyword">= </span><span class="default">mysql_connect</span><span class="keyword">( </span><span class="string">'localhost'</span><span class="keyword">, </span><span class="string">'dbuser'</span><span class="keyword">, </span><span class="string">'dbpass'</span><span class="keyword">) or die(</span><span class="string">'Could not connect to mysql server.' </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">mysql_select_db</span><span class="keyword">(</span><span class="string">'wordpress'</span><span class="keyword">, </span><span class="default">$g_link</span><span class="keyword">) or die(</span><span class="string">'Could not select database.'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$g_link</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">CleanUpDB</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; global </span><span class="default">$g_link</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="default">$g_link </span><span class="keyword">!= </span><span class="default">false </span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">mysql_close</span><span class="keyword">(</span><span class="default">$g_link</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$g_link </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82040""></a>
  <div class="note">
   <strong class="user">arithmetric at gmail dot com</strong>
   <a href="#82040" class="date">25-Mar-2008 07:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are trying to open multiple, separate MySQL connections with the same MySQL user, password, and hostname, you must set $new_link = TRUE to prevent mysql_connect from using an existing connection.<br />
<br />
For example, you are opening two separate connections to two different databases (but on the same host, and with the same user and password):<br />
<br />
$db1 = mysql_connect($dbhost, $dbuser, $dbpass);<br />
$rv = mysql_select_db($dbname1, $db1);<br />
$db2 = mysql_connect($dbhost, $dbuser, $dbpass);<br />
$rv = mysql_select_db($dbname2, $db2);<br />
<br />
At this point, both $db1 and $db2 will have selected the database named by $dbname2.<br />
<br />
The workaround is to require that the second MySQL connection is new:<br />
<br />
$db1 = mysql_connect($dbhost, $dbuser, $dbpass);<br />
$rv = mysql_select_db($dbname1, $db1);<br />
$db2 = mysql_connect($dbhost, $dbuser, $dbpass, TRUE);<br />
$rv = mysql_select_db($dbname2, $db2);<br />
<br />
Now, $db1 should have selected $dbname1, and $db2 should have selected $dbname2.<br />
<br />
This has been documented on the mysql_select_db page as well.<br />
<br />
Note: This occurs only when the server, username, and password parameters are identical for each mysql_connect statement.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81554""></a>
  <div class="note">
   <strong class="user">aeolianmeson at blitzeclipse dot com</strong>
   <a href="#81554" class="date">03-Mar-2008 09:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Recently, I saw an obscure problem where I could connect to MySQL from the PHP via Apache and MySQL via the MySQL console, and could not connect via the PHP-CLI. This was in Windows (XP). I usually use MySQLi extension, but also tried MySQL, and both refused to work.<br />
<br />
I restarted the service multiple times, and the PHP-CLI still would not connect.<br />
<br />
This eventually cleared up.<br />
<br />
I made sure to stop the service. Then, I downloaded a zipped binary-package from dev.mysql.com and started the server a few times from the commandline (mysqld/mysqld-nt, where mysqld-nt is tuned specifically for Windows) and stopped it ("mysqladmin shutdown"). I was then able to successfully connect from the PHP-CLI ("php -r "mysql_connect('localhost', 'root', ''); ").<br />
<br />
Making sure it was stopped, I started the regular server from the commandline, and that was then successful. I then stopped it and started it via the Services panel, and everything still worked.<br />
<br />
I'm assuming that when the service was restarted initially, there was a component that had died and refused to be shutdown even though the service appeared to be stopped, but shutting it down via mysqladmin killed everything entirely.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81028""></a>
  <div class="note">
   <strong class="user">dan at novapulsar dot com</strong>
   <a href="#81028" class="date">11-Feb-2008 08:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
[EDIT by danbrown AT php DOT net: The issue this user is illustrating is a common problem when dealing with multiple databases from PHP.&nbsp; Note his comments at the end of the code for an explanation.]
<br />

<br />

<br />
Looks like I learned this the hard way:
<br />

<br />
<span class="default">&lt;?php
<br />

<br />
</span><span class="comment">//establish connection to master db server
<br />
</span><span class="default">mysql_connect </span><span class="keyword">(</span><span class="default">DB_HOST</span><span class="keyword">, </span><span class="default">DB_USER</span><span class="keyword">, </span><span class="default">DB_PASSWORD</span><span class="keyword">);
<br />
</span><span class="default">mysql_select_db </span><span class="keyword">(</span><span class="default">DB_NAME</span><span class="keyword">);
<br />

<br />
</span><span class="comment">//establish connection to read-only slave cluster
<br />
</span><span class="default">$objMySQL_Read </span><span class="keyword">= </span><span class="default">mysql_connect </span><span class="keyword">(</span><span class="default">SLAVE_DB_HOST</span><span class="keyword">, </span><span class="default">SLAVE_DB_USER</span><span class="keyword">, </span><span class="default">SLAVE_DB_PASSWORD</span><span class="keyword">);
<br />
</span><span class="default">mysql_select_db </span><span class="keyword">(</span><span class="default">DB_NAME</span><span class="keyword">, </span><span class="default">$objMySQL_Read</span><span class="keyword">);
<br />

<br />
</span><span class="default">$strSQL </span><span class="keyword">= </span><span class="string">"SELECT col1,col2 FROM "&nbsp; </span><span class="keyword">. </span><span class="default">DB_NAME </span><span class="keyword">. </span><span class="string">"." </span><span class="keyword">. </span><span class="string">"tbl1 WHERE 1=1"</span><span class="keyword">;
<br />

<br />
</span><span class="default">$objRS </span><span class="keyword">= </span><span class="default">mysql_query </span><span class="keyword">(</span><span class="default">$strSQL</span><span class="keyword">, </span><span class="default">$objMySQL_Read</span><span class="keyword">); </span><span class="comment">//returns data from slaves
<br />

<br />
</span><span class="default">$strSQL </span><span class="keyword">= </span><span class="string">"INSERT INTO " </span><span class="keyword">. </span><span class="default">DB_NAME </span><span class="keyword">. </span><span class="string">"." </span><span class="keyword">. </span><span class="string">"tbl1 (col1,col2) VALUES (val1,val2)"</span><span class="keyword">;
<br />

<br />
</span><span class="default">mysql_query </span><span class="keyword">(</span><span class="default">$strSQL</span><span class="keyword">);
<br />

<br />
</span><span class="comment">//expected behavior, to insert the last statement into the master db, since it doesn't reference the read-only resource explicitly. instead, it inserts the record into the last connection, even though it shouldn't, since the last connection is not a global/anonymous connection like the first one, it's $objMySQL_Read.
<br />

<br />
//you'll get out of sync db's across your cluster unless you explicitly define all connection resources
<br />

<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="80024""></a>
  <div class="note">
   <strong class="user">Steve</strong>
   <a href="#80024" class="date">25-Dec-2007 12:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The too many connections issue can be due to several problems.<br />
<br />
1. you are using pconnect. This can tie up many connections and is not really needed for MySQL as new connections are really fast.<br />
<br />
2. Apache children are hanging around for too long - combine this with pconnect and you have recipe for disaster.<br />
<br />
Suggestions: reduce the amount of time apache child processes stay connected to the client and how many connections before they are killed off. And don't use pconnect.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="78638""></a>
  <div class="note">
   <strong class="user">Ignacio Casinelli Esviza</strong>
   <a href="#78638" class="date">20-Oct-2007 07:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Sometimes, I want that MySQL service start automatically when my app need it. This is specially true if you work in a development PC and/or in an small intranet environment.<br />
<br />
You can do something like this: if the mysql_connect() function returns FALSE, try to force the initialization of the MySQL service!<br />
<br />
For example, under Windows:<br />
<br />
<span class="default">&lt;?php<br />
<br />
$link </span><span class="keyword">= @</span><span class="default">mysql_connect</span><span class="keyword">(</span><span class="default">$server</span><span class="keyword">,</span><span class="default">$user</span><span class="keyword">,</span><span class="default">$pass</span><span class="keyword">);<br />
if (empty(</span><span class="default">$link</span><span class="keyword">)){<br />
&nbsp;&nbsp;&nbsp; @</span><span class="default">exec</span><span class="keyword">(</span><span class="string">"%SystemRoot%\\system32\\net.exe start mysql"</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">sleep</span><span class="keyword">(</span><span class="default">5</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$link </span><span class="keyword">= @</span><span class="default">mysql_connect</span><span class="keyword">(</span><span class="default">$servidor</span><span class="keyword">,</span><span class="default">$usuario</span><span class="keyword">,</span><span class="default">$clave</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
In Linux of course you can try "/etc/init.d/mysqld start" but you will need special permissions.<br />
<br />
Regards.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="78187""></a>
  <div class="note">
   <strong class="user">Peter Robinett</strong>
   <a href="#78187" class="date">02-Oct-2007 03:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The use of mysql connections can become tricky with objects. I am using mysql_connect() in a database class I wrote and the class destructor calls mysql_close. Because I have several of these database objects, mysql_connect reuses existing connections. This is fine except when the script reaches the end of execution and PHP's garabage collection calls all the objects' __destruct() functions. mysql_close() throws a warning that the connection is invalid, in my case for one object. This is happening with objects which use an existing connection, as the connection has already been closed. I solved the problem by forcing mysql_connect() to create a new connection each time. This is not efficient but is sufficient for my purposes for now.<br />
<br />
I wouldn't say this is a bug per-se, but it's something to look out for. I imagine using mysqli is the ultimate solution...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77000""></a>
  <div class="note">
   <strong class="user">martin</strong>
   <a href="#77000" class="date">09-Aug-2007 04:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
MYSQL_CLIENT_SSL is not working, use MySQLi and mysqli-&gt;ssl_set()</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74375""></a>
  <div class="note">
   <strong class="user">jslakva at gmail dot com</strong>
   <a href="#74375" class="date">08-Apr-2007 03:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
if between first and second call with same arguments there was another call with another argument, initial connection link is not reused, but new connection is created instead, regardless of new_link argument.<br />
<br />
for example, here only one single link will be opened and then reused:<br />
<span class="default">&lt;?php<br />
$link1 </span><span class="keyword">= </span><span class="default">mysql_connect</span><span class="keyword">(</span><span class="string">"localhost"</span><span class="keyword">);<br />
</span><span class="default">$link2 </span><span class="keyword">= </span><span class="default">mysql_connect</span><span class="keyword">(</span><span class="string">"localhost"</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
and here _three_ separate links will be opened:<br />
<span class="default">&lt;?php<br />
$link1 </span><span class="keyword">= </span><span class="default">mysql_connect</span><span class="keyword">(</span><span class="string">"localhost"</span><span class="keyword">);<br />
</span><span class="default">$link3 </span><span class="keyword">= </span><span class="default">mysql_connect</span><span class="keyword">(</span><span class="string">"127.0.0.1"</span><span class="keyword">);<br />
</span><span class="default">$link2 </span><span class="keyword">= </span><span class="default">mysql_connect</span><span class="keyword">(</span><span class="string">"localhost"</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
so if you wanted to switch between connections just by call to mysql_connect, and rely on its internal link caching, you can be wasting your database connections.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73983""></a>
  <div class="note">
   <strong class="user">angelo [at] mandato &lt;dot&gt; com</strong>
   <a href="#73983" class="date">19-Mar-2007 10:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The post from 'Graham_Rule at ed dot ac dot uk' should include the following WARNING:<br />
<br />
WARING: THE VALUES OF THESE DIRECTIVES WILL BE EXPOSED IF ANY OF THE CODE INCLUDES THE phpinfo() FUNCTION.<br />
<br />
The phpinfo() function will print these values clear as day.&nbsp; I highly suggest against this method of storing MySQL authentication information.<br />
<br />
I recommend creating connect and cleanup functions in a separate include file.&nbsp; If security is a concern, locate the include file outside of your web root folder.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; $g_link </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">GetMyConnection</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; global </span><span class="default">$g_link</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="default">$g_link </span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$g_link</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$g_link </span><span class="keyword">= </span><span class="default">mysql_connect</span><span class="keyword">( </span><span class="string">'host.name'</span><span class="keyword">, </span><span class="string">'user'</span><span class="keyword">, </span><span class="string">'password'</span><span class="keyword">) or die(</span><span class="string">'Could not connect to server.' </span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">mysql_select_db</span><span class="keyword">(</span><span class="string">'database_name'</span><span class="keyword">, </span><span class="default">$g_link</span><span class="keyword">) or die(</span><span class="string">'Could not select database.'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$g_link</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">CleanUpDB</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; global </span><span class="default">$g_link</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if( </span><span class="default">$g_link </span><span class="keyword">!= </span><span class="default">false </span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">mysql_close</span><span class="keyword">(</span><span class="default">$g_link</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$g_link </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
</span><span class="default">?&gt;<br />
</span><br />
Simply include your connnection.php file in your script and anywhere you use the mysql_query() function include a call to the GetMyConnection() function.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; $res </span><span class="keyword">= </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="string">"SELECT ..."</span><span class="keyword">, </span><span class="default">GetMyConnection</span><span class="keyword">() );<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71703""></a>
  <div class="note">
   <strong class="user">sky dot sama dot remove dot dots at Gmail dot com</strong>
   <a href="#71703" class="date">12-Dec-2006 05:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In case anyone else is getting "Client does not support authentication protocol requested by server; consider upgrading MySQL client" error. The problem is the new password hashing method used by MySQL &gt;= 4.1 mentioned below.<br />
<br />
Either update your PHP to v5 where the new password hashing is supported or use old_password() in MySQL 4.1.<br />
<br />
FROM: <a href="http://www.digitalpeer.com/id/mysql " rel="nofollow" target="_blank">http://www.digitalpeer.com/id/mysql </a><br />
<br />
UPDATE mysql.user SET password=old_password("youroldhashpassword") WHERE user ='youruserid' and host ='yourhost'<br />
<br />
then do<br />
<br />
FLUSH PRIVILEGES</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71078""></a>
  <div class="note">
   <strong class="user">Graham_Rule at ed dot ac dot uk</strong>
   <a href="#71078" class="date">10-Nov-2006 10:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The addition of entries to httpd.conf to stop .inc files being served by Apache is certainly useful and to be recommended.<br />
<br />
But it doesn't change the fact that these files have to be readable by Apache so that the PHP processor can get at them.<br />
<br />
As long as your don't have multiple, possibly untrusted, users on your machine then that's OK.&nbsp; But when you are running a large multi-user service with thousands of users its always possible that one of them will look at your .inc files and take a note of the passwords you have in them.&nbsp; They could even copy them into their own scripts and modify your databases!<br />
<br />
Even if local users are trusted, there is always the possibility of a rogue script (PHP or some nastier language) being installed by an ignorant user.&nbsp; That script might then read your .inc files (whether or not they are in the web publishing tree) and expose your password.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71046""></a>
  <div class="note">
   <strong class="user">brinca at substancia dot com</strong>
   <a href="#71046" class="date">09-Nov-2006 04:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you prefer to use a hostname instead of an ip on your connection string in a script (to be able to change the ip at will), but don't want the overhead of dns lookups, just add it to your /etc/hosts file (in windows: %WINDIR%/system32/drivers/etc/hosts).<br />
<br />
For example, add the following to your hosts file (changing the bogus ip to your server's real ip):<br />
<br />
123.123.123.123&nbsp;&nbsp; mysqlserver1<br />
<br />
Note: On linux, make sure you have "order: hosts,bind" on your /etc/host.conf file.<br />
<br />
On a script, make the mysql connection like so:<br />
<br />
&lt;?<br />
&nbsp; $sid = mysql_connect ("mysqlserver1", "user", "pass");<br />
?&gt;<br />
<br />
Note: this sample is in php, but it can be any other programming language (just type "ping mysqlserver1" on a prompt, on your server)<br />
<br />
And there you have it! If your server ever gets assigned a different ip, just update the hosts file with the new one (every script will work as-is, even if under different hostnames).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="66893""></a>
  <div class="note">
   <strong class="user">rui dot batista at netcabo dot pt</strong>
   <a href="#66893" class="date">31-May-2006 05:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Ever wonder what "default username" is?<br />
<span class="default">&lt;?php<br />
$link </span><span class="keyword">= </span><span class="default">mysql_connect</span><span class="keyword">() or die(</span><span class="default">mysql_error</span><span class="keyword">());<br />
</span><span class="default">$result </span><span class="keyword">= </span><span class="default">mysql_query</span><span class="keyword">(</span><span class="string">"SELECT SESSION_USER(), CURRENT_USER();"</span><span class="keyword">);<br />
</span><span class="default">$row </span><span class="keyword">= </span><span class="default">mysql_fetch_row</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">);<br />
echo </span><span class="string">"SESSION USER: "</span><span class="keyword">, </span><span class="default">$row</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="string">"&lt;br&gt;\n"</span><span class="keyword">;<br />
echo </span><span class="string">"CURRENT USER: "</span><span class="keyword">, </span><span class="default">$row</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">], </span><span class="string">"&lt;br&gt;\n"</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span>Both are ODBC@localhost in my win2k install, so my advice for windows is:<br />
- create a MySQL user named ODBC with no password<br />
- add localhost to ODBC user [right-click ODBC]<br />
- set schema previleges to ODBC@localhost<br />
- use mysql_connect() with no parms, or do not use ;)<br />
This turns to work also with odbc_connect:<br />
odbc_connect("myDSN", "", "")</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="54160""></a>
  <div class="note">
   
   <a href="#54160" class="date">25-Jun-2005 12:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
connect to mysql via named pipe under windows :<br />
<br />
in my.ini, add this:<br />
<br />
[mysqld]<br />
enable-named-pipe<br />
<br />
then connect to the server, then connect to mysql using<br />
<br />
mysql_connect('.')</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="45029""></a>
  <div class="note">
   <strong class="user">chaoscontrol_hq at yahoo dot com</strong>
   <a href="#45029" class="date">23-Aug-2004 11:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In MySQL4.1 and later, the default password hashing format has changed making it incompatible with 3.x clients.<br />
I found out mysql_connect() works on server versions &gt;= 4.1 when your MySQL user password is blank because password authentication isn't done in that case, otherwise you need to use another connection method (e.g. mysqli).<br />
Also if you are using old MySQL tables on a new server (i.e. the passwords are stored in the old format), then the server will use the old auth method automatically and this function should work in all cases.<br />
Hopefully this will help someone, it had me confused for a while because some of the users on my 4.1 server could connect and some couldn't.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="37029""></a>
  <div class="note">
   <strong class="user">martinnitram at excite dot com</strong>
   <a href="#37029" class="date">31-Oct-2003 11:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
to use load data local infile function from mysql (at mysql 4.0.16, php 4.3.3), set fifth parameter of mysql_connect() to CLIENT_LOCAL_FILES(128), which based on MYSQL C API ( also mysql server support load file, check by "show variables like 'local_infile' ")<br />
<br />
Thank&nbsp; 'phpweb at eden2 dot com' to point this out</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="32035""></a>
  <div class="note">
   <strong class="user">Graham_Rule at ed dot ac dot uk</strong>
   <a href="#32035" class="date">14-May-2003 05:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Another solution to the security problems of putting usernames and passwords into scripts. I haven't found this documented anywhere else so thought I'd suggest it for the online documentation. ........
<br />

<br />
Don't put passwords for mysql into scripts which may be read by any user on the machine.&nbsp; Instead put them into an Apache configuration file and make sure that it is not world-readable. (Apache reads its main config files as root.)
<br />

<br />
For example, add this to your httpd.conf (and chmod it to 600 or 660) then tell your apache to reload itself (apachectl graceful).
<br />

<br />
&lt;Directory /var/www/html/mydatabase&gt;
<br />
&nbsp;&nbsp;&nbsp; php_value mysql.default_user fred
<br />
&nbsp;&nbsp;&nbsp; php_value mysql.default_password secret
<br />
&nbsp;&nbsp;&nbsp; php_value mysql.default_host server.example.com
<br />
&lt;/Directory&gt;
<br />

<br />
Then all you need in your PHP code is
<br />

<br />
$handle = mysql_connect() or die(mysql_error());
<br />

<br />
The passwords etc will only be picked up by scripts running in the named directory (or a sub-directory).&nbsp; The same may be done for virtualhosts etc.
<br />

<br />
If you don't want to keep reloading your Apache server then you ay test things putting the php_value directives into a (world readable) .htaccess file. (Clearly not for production use.)
<br />

<br />
If you need to debug the values that are being supplied (or not) then use this snippet:
<br />

<br />
@syslog(LOG_DEBUG, "Using user=".ini_get("mysql.default_user").
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; " pass=".ini_get("mysql.default_password").
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; " host=".ini_get("mysql.default_host"));
<br />

<br />
(This assumes that you are not running in 'safe_mode' and that you are on a unix of some sort.)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="30243""></a>
  <div class="note">
   <strong class="user">amn -at- frognet.net</strong>
   <a href="#30243" class="date">12-Mar-2003 07:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just in case you didn't know. You can use mysql_connect in a function to connect to a database and the connection is a super-global... meaning you can use mysql_query in other functions or in no function at all and PHP will use the connection that you opened. This is a handy bit of knowledge that helps if you have a large site with lots of scripts. If you create one function to connect to a db, and call that function in all your scripts, it makes for easier code maintenance since you only have to update one line of code to change your mysql connection instead of updating all your scripts individually.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
